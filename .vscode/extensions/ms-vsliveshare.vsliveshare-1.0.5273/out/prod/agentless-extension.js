module.exports=function(h){var m={};function __webpack_require__(y){if(m[y])return m[y].exports;var v=m[y]={i:y,l:!1,exports:{}};return h[y].call(v.exports,v,v.exports,__webpack_require__),v.l=!0,v.exports}return __webpack_require__.m=h,__webpack_require__.c=m,__webpack_require__.d=function(h,m,y){__webpack_require__.o(h,m)||Object.defineProperty(h,m,{enumerable:!0,get:y})},__webpack_require__.r=function(h){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(h,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(h,"__esModule",{value:!0})},__webpack_require__.t=function(h,m){if(1&m&&(h=__webpack_require__(h)),8&m)return h;if(4&m&&"object"==typeof h&&h&&h.__esModule)return h;var y=Object.create(null);if(__webpack_require__.r(y),Object.defineProperty(y,"default",{enumerable:!0,value:h}),2&m&&"string"!=typeof h)for(var v in h)__webpack_require__.d(y,v,function(m){return h[m]}.bind(null,v));return y},__webpack_require__.n=function(h){var m=h&&h.__esModule?function getDefault(){return h.default}:function getModuleExports(){return h};return __webpack_require__.d(m,"a",m),m},__webpack_require__.o=function(h,m){return Object.prototype.hasOwnProperty.call(h,m)},__webpack_require__.p="",__webpack_require__(__webpack_require__.s=744)}([function(h,m){h.exports=require("vscode")},function(h,m,y){(function(h){h.exports=function(){"use strict";var m,v;function hooks(){return m.apply(null,arguments)}function isArray(h){return h instanceof Array||"[object Array]"===Object.prototype.toString.call(h)}function isObject(h){return null!=h&&"[object Object]"===Object.prototype.toString.call(h)}function hasOwnProp(h,m){return Object.prototype.hasOwnProperty.call(h,m)}function isObjectEmpty(h){if(Object.getOwnPropertyNames)return 0===Object.getOwnPropertyNames(h).length;var m;for(m in h)if(hasOwnProp(h,m))return!1;return!0}function isUndefined(h){return void 0===h}function isNumber(h){return"number"==typeof h||"[object Number]"===Object.prototype.toString.call(h)}function isDate(h){return h instanceof Date||"[object Date]"===Object.prototype.toString.call(h)}function map(h,m){var y,v=[];for(y=0;y<h.length;++y)v.push(m(h[y],y));return v}function extend(h,m){for(var y in m)hasOwnProp(m,y)&&(h[y]=m[y]);return hasOwnProp(m,"toString")&&(h.toString=m.toString),hasOwnProp(m,"valueOf")&&(h.valueOf=m.valueOf),h}function createUTC(h,m,y,v){return createLocalOrUTC(h,m,y,v,!0).utc()}function getParsingFlags(h){return null==h._pf&&(h._pf={empty:!1,unusedTokens:[],unusedInput:[],overflow:-2,charsLeftOver:0,nullInput:!1,invalidEra:null,invalidMonth:null,invalidFormat:!1,userInvalidated:!1,iso:!1,parsedDateParts:[],era:null,meridiem:null,rfc2822:!1,weekdayMismatch:!1}),h._pf}function isValid(h){if(null==h._isValid){var m=getParsingFlags(h),y=v.call(m.parsedDateParts,(function(h){return null!=h})),C=!isNaN(h._d.getTime())&&m.overflow<0&&!m.empty&&!m.invalidEra&&!m.invalidMonth&&!m.invalidWeekday&&!m.weekdayMismatch&&!m.nullInput&&!m.invalidFormat&&!m.userInvalidated&&(!m.meridiem||m.meridiem&&y);if(h._strict&&(C=C&&0===m.charsLeftOver&&0===m.unusedTokens.length&&void 0===m.bigHour),null!=Object.isFrozen&&Object.isFrozen(h))return C;h._isValid=C}return h._isValid}function createInvalid(h){var m=createUTC(NaN);return null!=h?extend(getParsingFlags(m),h):getParsingFlags(m).userInvalidated=!0,m}v=Array.prototype.some?Array.prototype.some:function(h){var m,y=Object(this),v=y.length>>>0;for(m=0;m<v;m++)if(m in y&&h.call(this,y[m],m,y))return!0;return!1};var C=hooks.momentProperties=[],T=!1;function copyConfig(h,m){var y,v,T;if(isUndefined(m._isAMomentObject)||(h._isAMomentObject=m._isAMomentObject),isUndefined(m._i)||(h._i=m._i),isUndefined(m._f)||(h._f=m._f),isUndefined(m._l)||(h._l=m._l),isUndefined(m._strict)||(h._strict=m._strict),isUndefined(m._tzm)||(h._tzm=m._tzm),isUndefined(m._isUTC)||(h._isUTC=m._isUTC),isUndefined(m._offset)||(h._offset=m._offset),isUndefined(m._pf)||(h._pf=getParsingFlags(m)),isUndefined(m._locale)||(h._locale=m._locale),C.length>0)for(y=0;y<C.length;y++)isUndefined(T=m[v=C[y]])||(h[v]=T);return h}function Moment(h){copyConfig(this,h),this._d=new Date(null!=h._d?h._d.getTime():NaN),this.isValid()||(this._d=new Date(NaN)),!1===T&&(T=!0,hooks.updateOffset(this),T=!1)}function isMoment(h){return h instanceof Moment||null!=h&&null!=h._isAMomentObject}function warn(h){!1===hooks.suppressDeprecationWarnings&&"undefined"!=typeof console&&console.warn&&console.warn("Deprecation warning: "+h)}function deprecate(h,m){var y=!0;return extend((function(){if(null!=hooks.deprecationHandler&&hooks.deprecationHandler(null,h),y){var v,C,T,w=[];for(C=0;C<arguments.length;C++){if(v="","object"==typeof arguments[C]){for(T in v+="\n["+C+"] ",arguments[0])hasOwnProp(arguments[0],T)&&(v+=T+": "+arguments[0][T]+", ");v=v.slice(0,-2)}else v=arguments[C];w.push(v)}warn(h+"\nArguments: "+Array.prototype.slice.call(w).join("")+"\n"+(new Error).stack),y=!1}return m.apply(this,arguments)}),m)}var w,A={};function deprecateSimple(h,m){null!=hooks.deprecationHandler&&hooks.deprecationHandler(h,m),A[h]||(warn(m),A[h]=!0)}function isFunction(h){return"undefined"!=typeof Function&&h instanceof Function||"[object Function]"===Object.prototype.toString.call(h)}function mergeConfigs(h,m){var y,v=extend({},h);for(y in m)hasOwnProp(m,y)&&(isObject(h[y])&&isObject(m[y])?(v[y]={},extend(v[y],h[y]),extend(v[y],m[y])):null!=m[y]?v[y]=m[y]:delete v[y]);for(y in h)hasOwnProp(h,y)&&!hasOwnProp(m,y)&&isObject(h[y])&&(v[y]=extend({},v[y]));return v}function Locale(h){null!=h&&this.set(h)}function zeroFill(h,m,y){var v=""+Math.abs(h),C=m-v.length;return(h>=0?y?"+":"":"-")+Math.pow(10,Math.max(0,C)).toString().substr(1)+v}hooks.suppressDeprecationWarnings=!1,hooks.deprecationHandler=null,w=Object.keys?Object.keys:function(h){var m,y=[];for(m in h)hasOwnProp(h,m)&&y.push(m);return y};var P=/(\[[^\[]*\])|(\\)?([Hh]mm(ss)?|Mo|MM?M?M?|Do|DDDo|DD?D?D?|ddd?d?|do?|w[o|w]?|W[o|W]?|Qo?|N{1,5}|YYYYYY|YYYYY|YYYY|YY|y{2,4}|yo?|gg(ggg?)?|GG(GGG?)?|e|E|a|A|hh?|HH?|kk?|mm?|ss?|S{1,9}|x|X|zz?|ZZ?|.)/g,k=/(\[[^\[]*\])|(\\)?(LTS|LT|LL?L?L?|l{1,4})/g,R={},M={};function addFormatToken(h,m,y,v){var C=v;"string"==typeof v&&(C=function(){return this[v]()}),h&&(M[h]=C),m&&(M[m[0]]=function(){return zeroFill(C.apply(this,arguments),m[1],m[2])}),y&&(M[y]=function(){return this.localeData().ordinal(C.apply(this,arguments),h)})}function formatMoment(h,m){return h.isValid()?(m=expandFormat(m,h.localeData()),R[m]=R[m]||function makeFormatFunction(h){var m,y,v,C=h.match(P);for(m=0,y=C.length;m<y;m++)M[C[m]]?C[m]=M[C[m]]:C[m]=(v=C[m]).match(/\[[\s\S]/)?v.replace(/^\[|\]$/g,""):v.replace(/\\/g,"");return function(m){var v,T="";for(v=0;v<y;v++)T+=isFunction(C[v])?C[v].call(m,h):C[v];return T}}(m),R[m](h)):h.localeData().invalidDate()}function expandFormat(h,m){var y=5;function replaceLongDateFormatTokens(h){return m.longDateFormat(h)||h}for(k.lastIndex=0;y>=0&&k.test(h);)h=h.replace(k,replaceLongDateFormatTokens),k.lastIndex=0,y-=1;return h}var N={};function addUnitAlias(h,m){var y=h.toLowerCase();N[y]=N[y+"s"]=N[m]=h}function normalizeUnits(h){return"string"==typeof h?N[h]||N[h.toLowerCase()]:void 0}function normalizeObjectUnits(h){var m,y,v={};for(y in h)hasOwnProp(h,y)&&(m=normalizeUnits(y))&&(v[m]=h[y]);return v}var D={};function addUnitPriority(h,m){D[h]=m}function isLeapYear(h){return h%4==0&&h%100!=0||h%400==0}function absFloor(h){return h<0?Math.ceil(h)||0:Math.floor(h)}function toInt(h){var m=+h,y=0;return 0!==m&&isFinite(m)&&(y=absFloor(m)),y}function makeGetSet(h,m){return function(y){return null!=y?(set$1(this,h,y),hooks.updateOffset(this,m),this):get(this,h)}}function get(h,m){return h.isValid()?h._d["get"+(h._isUTC?"UTC":"")+m]():NaN}function set$1(h,m,y){h.isValid()&&!isNaN(y)&&("FullYear"===m&&isLeapYear(h.year())&&1===h.month()&&29===h.date()?(y=toInt(y),h._d["set"+(h._isUTC?"UTC":"")+m](y,h.month(),daysInMonth(y,h.month()))):h._d["set"+(h._isUTC?"UTC":"")+m](y))}var I,x=/\d/,O=/\d\d/,L=/\d{3}/,U=/\d{4}/,B=/[+-]?\d{6}/,W=/\d\d?/,q=/\d\d\d\d?/,Y=/\d\d\d\d\d\d?/,V=/\d{1,3}/,$=/\d{1,4}/,z=/[+-]?\d{1,6}/,G=/\d+/,J=/[+-]?\d+/,X=/Z|[+-]\d\d:?\d\d/gi,Z=/Z|[+-]\d\d(?::?\d\d)?/gi,ee=/[0-9]{0,256}['a-z\u00A0-\u05FF\u0700-\uD7FF\uF900-\uFDCF\uFDF0-\uFF07\uFF10-\uFFEF]{1,256}|[\u0600-\u06FF\/]{1,256}(\s*?[\u0600-\u06FF]{1,256}){1,2}/i;function addRegexToken(h,m,y){I[h]=isFunction(m)?m:function(h,v){return h&&y?y:m}}function getParseRegexForToken(h,m){return hasOwnProp(I,h)?I[h](m._strict,m._locale):new RegExp(function unescapeFormat(h){return regexEscape(h.replace("\\","").replace(/\\(\[)|\\(\])|\[([^\]\[]*)\]|\\(.)/g,(function(h,m,y,v,C){return m||y||v||C})))}(h))}function regexEscape(h){return h.replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$&")}I={};var te,re={};function addParseToken(h,m){var y,v=m;for("string"==typeof h&&(h=[h]),isNumber(m)&&(v=function(h,y){y[m]=toInt(h)}),y=0;y<h.length;y++)re[h[y]]=v}function addWeekParseToken(h,m){addParseToken(h,(function(h,y,v,C){v._w=v._w||{},m(h,v._w,v,C)}))}function addTimeToArrayFromToken(h,m,y){null!=m&&hasOwnProp(re,h)&&re[h](m,y._a,y,h)}function daysInMonth(h,m){if(isNaN(h)||isNaN(m))return NaN;var y=function mod(h,m){return(h%m+m)%m}(m,12);return h+=(m-y)/12,1===y?isLeapYear(h)?29:28:31-y%7%2}te=Array.prototype.indexOf?Array.prototype.indexOf:function(h){var m;for(m=0;m<this.length;++m)if(this[m]===h)return m;return-1},addFormatToken("M",["MM",2],"Mo",(function(){return this.month()+1})),addFormatToken("MMM",0,0,(function(h){return this.localeData().monthsShort(this,h)})),addFormatToken("MMMM",0,0,(function(h){return this.localeData().months(this,h)})),addUnitAlias("month","M"),addUnitPriority("month",8),addRegexToken("M",W),addRegexToken("MM",W,O),addRegexToken("MMM",(function(h,m){return m.monthsShortRegex(h)})),addRegexToken("MMMM",(function(h,m){return m.monthsRegex(h)})),addParseToken(["M","MM"],(function(h,m){m[1]=toInt(h)-1})),addParseToken(["MMM","MMMM"],(function(h,m,y,v){var C=y._locale.monthsParse(h,v,y._strict);null!=C?m[1]=C:getParsingFlags(y).invalidMonth=h}));var ie="January_February_March_April_May_June_July_August_September_October_November_December".split("_"),se="Jan_Feb_Mar_Apr_May_Jun_Jul_Aug_Sep_Oct_Nov_Dec".split("_"),oe=/D[oD]?(\[[^\[\]]*\]|\s)+MMMM?/,ae=ee,ce=ee;function handleStrictParse(h,m,y){var v,C,T,w=h.toLocaleLowerCase();if(!this._monthsParse)for(this._monthsParse=[],this._longMonthsParse=[],this._shortMonthsParse=[],v=0;v<12;++v)T=createUTC([2e3,v]),this._shortMonthsParse[v]=this.monthsShort(T,"").toLocaleLowerCase(),this._longMonthsParse[v]=this.months(T,"").toLocaleLowerCase();return y?"MMM"===m?-1!==(C=te.call(this._shortMonthsParse,w))?C:null:-1!==(C=te.call(this._longMonthsParse,w))?C:null:"MMM"===m?-1!==(C=te.call(this._shortMonthsParse,w))||-1!==(C=te.call(this._longMonthsParse,w))?C:null:-1!==(C=te.call(this._longMonthsParse,w))||-1!==(C=te.call(this._shortMonthsParse,w))?C:null}function setMonth(h,m){var y;if(!h.isValid())return h;if("string"==typeof m)if(/^\d+$/.test(m))m=toInt(m);else if(!isNumber(m=h.localeData().monthsParse(m)))return h;return y=Math.min(h.date(),daysInMonth(h.year(),m)),h._d["set"+(h._isUTC?"UTC":"")+"Month"](m,y),h}function getSetMonth(h){return null!=h?(setMonth(this,h),hooks.updateOffset(this,!0),this):get(this,"Month")}function computeMonthsParse(){function cmpLenRev(h,m){return m.length-h.length}var h,m,y=[],v=[],C=[];for(h=0;h<12;h++)m=createUTC([2e3,h]),y.push(this.monthsShort(m,"")),v.push(this.months(m,"")),C.push(this.months(m,"")),C.push(this.monthsShort(m,""));for(y.sort(cmpLenRev),v.sort(cmpLenRev),C.sort(cmpLenRev),h=0;h<12;h++)y[h]=regexEscape(y[h]),v[h]=regexEscape(v[h]);for(h=0;h<24;h++)C[h]=regexEscape(C[h]);this._monthsRegex=new RegExp("^("+C.join("|")+")","i"),this._monthsShortRegex=this._monthsRegex,this._monthsStrictRegex=new RegExp("^("+v.join("|")+")","i"),this._monthsShortStrictRegex=new RegExp("^("+y.join("|")+")","i")}function daysInYear(h){return isLeapYear(h)?366:365}addFormatToken("Y",0,0,(function(){var h=this.year();return h<=9999?zeroFill(h,4):"+"+h})),addFormatToken(0,["YY",2],0,(function(){return this.year()%100})),addFormatToken(0,["YYYY",4],0,"year"),addFormatToken(0,["YYYYY",5],0,"year"),addFormatToken(0,["YYYYYY",6,!0],0,"year"),addUnitAlias("year","y"),addUnitPriority("year",1),addRegexToken("Y",J),addRegexToken("YY",W,O),addRegexToken("YYYY",$,U),addRegexToken("YYYYY",z,B),addRegexToken("YYYYYY",z,B),addParseToken(["YYYYY","YYYYYY"],0),addParseToken("YYYY",(function(h,m){m[0]=2===h.length?hooks.parseTwoDigitYear(h):toInt(h)})),addParseToken("YY",(function(h,m){m[0]=hooks.parseTwoDigitYear(h)})),addParseToken("Y",(function(h,m){m[0]=parseInt(h,10)})),hooks.parseTwoDigitYear=function(h){return toInt(h)+(toInt(h)>68?1900:2e3)};var le=makeGetSet("FullYear",!0);function createDate(h,m,y,v,C,T,w){var A;return h<100&&h>=0?(A=new Date(h+400,m,y,v,C,T,w),isFinite(A.getFullYear())&&A.setFullYear(h)):A=new Date(h,m,y,v,C,T,w),A}function createUTCDate(h){var m,y;return h<100&&h>=0?((y=Array.prototype.slice.call(arguments))[0]=h+400,m=new Date(Date.UTC.apply(null,y)),isFinite(m.getUTCFullYear())&&m.setUTCFullYear(h)):m=new Date(Date.UTC.apply(null,arguments)),m}function firstWeekOffset(h,m,y){var v=7+m-y;return-(7+createUTCDate(h,0,v).getUTCDay()-m)%7+v-1}function dayOfYearFromWeeks(h,m,y,v,C){var T,w,A=1+7*(m-1)+(7+y-v)%7+firstWeekOffset(h,v,C);return A<=0?w=daysInYear(T=h-1)+A:A>daysInYear(h)?(T=h+1,w=A-daysInYear(h)):(T=h,w=A),{year:T,dayOfYear:w}}function weekOfYear(h,m,y){var v,C,T=firstWeekOffset(h.year(),m,y),w=Math.floor((h.dayOfYear()-T-1)/7)+1;return w<1?v=w+weeksInYear(C=h.year()-1,m,y):w>weeksInYear(h.year(),m,y)?(v=w-weeksInYear(h.year(),m,y),C=h.year()+1):(C=h.year(),v=w),{week:v,year:C}}function weeksInYear(h,m,y){var v=firstWeekOffset(h,m,y),C=firstWeekOffset(h+1,m,y);return(daysInYear(h)-v+C)/7}function shiftWeekdays(h,m){return h.slice(m,7).concat(h.slice(0,m))}addFormatToken("w",["ww",2],"wo","week"),addFormatToken("W",["WW",2],"Wo","isoWeek"),addUnitAlias("week","w"),addUnitAlias("isoWeek","W"),addUnitPriority("week",5),addUnitPriority("isoWeek",5),addRegexToken("w",W),addRegexToken("ww",W,O),addRegexToken("W",W),addRegexToken("WW",W,O),addWeekParseToken(["w","ww","W","WW"],(function(h,m,y,v){m[v.substr(0,1)]=toInt(h)})),addFormatToken("d",0,"do","day"),addFormatToken("dd",0,0,(function(h){return this.localeData().weekdaysMin(this,h)})),addFormatToken("ddd",0,0,(function(h){return this.localeData().weekdaysShort(this,h)})),addFormatToken("dddd",0,0,(function(h){return this.localeData().weekdays(this,h)})),addFormatToken("e",0,0,"weekday"),addFormatToken("E",0,0,"isoWeekday"),addUnitAlias("day","d"),addUnitAlias("weekday","e"),addUnitAlias("isoWeekday","E"),addUnitPriority("day",11),addUnitPriority("weekday",11),addUnitPriority("isoWeekday",11),addRegexToken("d",W),addRegexToken("e",W),addRegexToken("E",W),addRegexToken("dd",(function(h,m){return m.weekdaysMinRegex(h)})),addRegexToken("ddd",(function(h,m){return m.weekdaysShortRegex(h)})),addRegexToken("dddd",(function(h,m){return m.weekdaysRegex(h)})),addWeekParseToken(["dd","ddd","dddd"],(function(h,m,y,v){var C=y._locale.weekdaysParse(h,v,y._strict);null!=C?m.d=C:getParsingFlags(y).invalidWeekday=h})),addWeekParseToken(["d","e","E"],(function(h,m,y,v){m[v]=toInt(h)}));var ue="Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_"),de="Sun_Mon_Tue_Wed_Thu_Fri_Sat".split("_"),he="Su_Mo_Tu_We_Th_Fr_Sa".split("_"),pe=ee,me=ee,fe=ee;function handleStrictParse$1(h,m,y){var v,C,T,w=h.toLocaleLowerCase();if(!this._weekdaysParse)for(this._weekdaysParse=[],this._shortWeekdaysParse=[],this._minWeekdaysParse=[],v=0;v<7;++v)T=createUTC([2e3,1]).day(v),this._minWeekdaysParse[v]=this.weekdaysMin(T,"").toLocaleLowerCase(),this._shortWeekdaysParse[v]=this.weekdaysShort(T,"").toLocaleLowerCase(),this._weekdaysParse[v]=this.weekdays(T,"").toLocaleLowerCase();return y?"dddd"===m?-1!==(C=te.call(this._weekdaysParse,w))?C:null:"ddd"===m?-1!==(C=te.call(this._shortWeekdaysParse,w))?C:null:-1!==(C=te.call(this._minWeekdaysParse,w))?C:null:"dddd"===m?-1!==(C=te.call(this._weekdaysParse,w))||-1!==(C=te.call(this._shortWeekdaysParse,w))||-1!==(C=te.call(this._minWeekdaysParse,w))?C:null:"ddd"===m?-1!==(C=te.call(this._shortWeekdaysParse,w))||-1!==(C=te.call(this._weekdaysParse,w))||-1!==(C=te.call(this._minWeekdaysParse,w))?C:null:-1!==(C=te.call(this._minWeekdaysParse,w))||-1!==(C=te.call(this._weekdaysParse,w))||-1!==(C=te.call(this._shortWeekdaysParse,w))?C:null}function computeWeekdaysParse(){function cmpLenRev(h,m){return m.length-h.length}var h,m,y,v,C,T=[],w=[],A=[],P=[];for(h=0;h<7;h++)m=createUTC([2e3,1]).day(h),y=regexEscape(this.weekdaysMin(m,"")),v=regexEscape(this.weekdaysShort(m,"")),C=regexEscape(this.weekdays(m,"")),T.push(y),w.push(v),A.push(C),P.push(y),P.push(v),P.push(C);T.sort(cmpLenRev),w.sort(cmpLenRev),A.sort(cmpLenRev),P.sort(cmpLenRev),this._weekdaysRegex=new RegExp("^("+P.join("|")+")","i"),this._weekdaysShortRegex=this._weekdaysRegex,this._weekdaysMinRegex=this._weekdaysRegex,this._weekdaysStrictRegex=new RegExp("^("+A.join("|")+")","i"),this._weekdaysShortStrictRegex=new RegExp("^("+w.join("|")+")","i"),this._weekdaysMinStrictRegex=new RegExp("^("+T.join("|")+")","i")}function hFormat(){return this.hours()%12||12}function meridiem(h,m){addFormatToken(h,0,0,(function(){return this.localeData().meridiem(this.hours(),this.minutes(),m)}))}function matchMeridiem(h,m){return m._meridiemParse}addFormatToken("H",["HH",2],0,"hour"),addFormatToken("h",["hh",2],0,hFormat),addFormatToken("k",["kk",2],0,(function kFormat(){return this.hours()||24})),addFormatToken("hmm",0,0,(function(){return""+hFormat.apply(this)+zeroFill(this.minutes(),2)})),addFormatToken("hmmss",0,0,(function(){return""+hFormat.apply(this)+zeroFill(this.minutes(),2)+zeroFill(this.seconds(),2)})),addFormatToken("Hmm",0,0,(function(){return""+this.hours()+zeroFill(this.minutes(),2)})),addFormatToken("Hmmss",0,0,(function(){return""+this.hours()+zeroFill(this.minutes(),2)+zeroFill(this.seconds(),2)})),meridiem("a",!0),meridiem("A",!1),addUnitAlias("hour","h"),addUnitPriority("hour",13),addRegexToken("a",matchMeridiem),addRegexToken("A",matchMeridiem),addRegexToken("H",W),addRegexToken("h",W),addRegexToken("k",W),addRegexToken("HH",W,O),addRegexToken("hh",W,O),addRegexToken("kk",W,O),addRegexToken("hmm",q),addRegexToken("hmmss",Y),addRegexToken("Hmm",q),addRegexToken("Hmmss",Y),addParseToken(["H","HH"],3),addParseToken(["k","kk"],(function(h,m,y){var v=toInt(h);m[3]=24===v?0:v})),addParseToken(["a","A"],(function(h,m,y){y._isPm=y._locale.isPM(h),y._meridiem=h})),addParseToken(["h","hh"],(function(h,m,y){m[3]=toInt(h),getParsingFlags(y).bigHour=!0})),addParseToken("hmm",(function(h,m,y){var v=h.length-2;m[3]=toInt(h.substr(0,v)),m[4]=toInt(h.substr(v)),getParsingFlags(y).bigHour=!0})),addParseToken("hmmss",(function(h,m,y){var v=h.length-4,C=h.length-2;m[3]=toInt(h.substr(0,v)),m[4]=toInt(h.substr(v,2)),m[5]=toInt(h.substr(C)),getParsingFlags(y).bigHour=!0})),addParseToken("Hmm",(function(h,m,y){var v=h.length-2;m[3]=toInt(h.substr(0,v)),m[4]=toInt(h.substr(v))})),addParseToken("Hmmss",(function(h,m,y){var v=h.length-4,C=h.length-2;m[3]=toInt(h.substr(0,v)),m[4]=toInt(h.substr(v,2)),m[5]=toInt(h.substr(C))}));var ye,ve=makeGetSet("Hours",!0),Se={calendar:{sameDay:"[Today at] LT",nextDay:"[Tomorrow at] LT",nextWeek:"dddd [at] LT",lastDay:"[Yesterday at] LT",lastWeek:"[Last] dddd [at] LT",sameElse:"L"},longDateFormat:{LTS:"h:mm:ss A",LT:"h:mm A",L:"MM/DD/YYYY",LL:"MMMM D, YYYY",LLL:"MMMM D, YYYY h:mm A",LLLL:"dddd, MMMM D, YYYY h:mm A"},invalidDate:"Invalid date",ordinal:"%d",dayOfMonthOrdinalParse:/\d{1,2}/,relativeTime:{future:"in %s",past:"%s ago",s:"a few seconds",ss:"%d seconds",m:"a minute",mm:"%d minutes",h:"an hour",hh:"%d hours",d:"a day",dd:"%d days",w:"a week",ww:"%d weeks",M:"a month",MM:"%d months",y:"a year",yy:"%d years"},months:ie,monthsShort:se,week:{dow:0,doy:6},weekdays:ue,weekdaysMin:he,weekdaysShort:de,meridiemParse:/[ap]\.?m?\.?/i},Ee={},Ce={};function commonPrefix(h,m){var y,v=Math.min(h.length,m.length);for(y=0;y<v;y+=1)if(h[y]!==m[y])return y;return v}function normalizeLocale(h){return h?h.toLowerCase().replace("_","-"):h}function loadLocale(m){var v=null;if(void 0===Ee[m]&&void 0!==h&&h&&h.exports)try{v=ye._abbr,y(1485)("./"+m),getSetGlobalLocale(v)}catch(h){Ee[m]=null}return Ee[m]}function getSetGlobalLocale(h,m){var y;return h&&((y=isUndefined(m)?getLocale(h):defineLocale(h,m))?ye=y:"undefined"!=typeof console&&console.warn&&console.warn("Locale "+h+" not found. Did you forget to load it?")),ye._abbr}function defineLocale(h,m){if(null!==m){var y,v=Se;if(m.abbr=h,null!=Ee[h])deprecateSimple("defineLocaleOverride","use moment.updateLocale(localeName, config) to change an existing locale. moment.defineLocale(localeName, config) should only be used for creating a new locale See http://momentjs.com/guides/#/warnings/define-locale/ for more info."),v=Ee[h]._config;else if(null!=m.parentLocale)if(null!=Ee[m.parentLocale])v=Ee[m.parentLocale]._config;else{if(null==(y=loadLocale(m.parentLocale)))return Ce[m.parentLocale]||(Ce[m.parentLocale]=[]),Ce[m.parentLocale].push({name:h,config:m}),null;v=y._config}return Ee[h]=new Locale(mergeConfigs(v,m)),Ce[h]&&Ce[h].forEach((function(h){defineLocale(h.name,h.config)})),getSetGlobalLocale(h),Ee[h]}return delete Ee[h],null}function getLocale(h){var m;if(h&&h._locale&&h._locale._abbr&&(h=h._locale._abbr),!h)return ye;if(!isArray(h)){if(m=loadLocale(h))return m;h=[h]}return function chooseLocale(h){for(var m,y,v,C,T=0;T<h.length;){for(m=(C=normalizeLocale(h[T]).split("-")).length,y=(y=normalizeLocale(h[T+1]))?y.split("-"):null;m>0;){if(v=loadLocale(C.slice(0,m).join("-")))return v;if(y&&y.length>=m&&commonPrefix(C,y)>=m-1)break;m--}T++}return ye}(h)}function checkOverflow(h){var m,y=h._a;return y&&-2===getParsingFlags(h).overflow&&(m=y[1]<0||y[1]>11?1:y[2]<1||y[2]>daysInMonth(y[0],y[1])?2:y[3]<0||y[3]>24||24===y[3]&&(0!==y[4]||0!==y[5]||0!==y[6])?3:y[4]<0||y[4]>59?4:y[5]<0||y[5]>59?5:y[6]<0||y[6]>999?6:-1,getParsingFlags(h)._overflowDayOfYear&&(m<0||m>2)&&(m=2),getParsingFlags(h)._overflowWeeks&&-1===m&&(m=7),getParsingFlags(h)._overflowWeekday&&-1===m&&(m=8),getParsingFlags(h).overflow=m),h}var _e=/^\s*((?:[+-]\d{6}|\d{4})-(?:\d\d-\d\d|W\d\d-\d|W\d\d|\d\d\d|\d\d))(?:(T| )(\d\d(?::\d\d(?::\d\d(?:[.,]\d+)?)?)?)([+-]\d\d(?::?\d\d)?|\s*Z)?)?$/,Te=/^\s*((?:[+-]\d{6}|\d{4})(?:\d\d\d\d|W\d\d\d|W\d\d|\d\d\d|\d\d|))(?:(T| )(\d\d(?:\d\d(?:\d\d(?:[.,]\d+)?)?)?)([+-]\d\d(?::?\d\d)?|\s*Z)?)?$/,be=/Z|[+-]\d\d(?::?\d\d)?/,we=[["YYYYYY-MM-DD",/[+-]\d{6}-\d\d-\d\d/],["YYYY-MM-DD",/\d{4}-\d\d-\d\d/],["GGGG-[W]WW-E",/\d{4}-W\d\d-\d/],["GGGG-[W]WW",/\d{4}-W\d\d/,!1],["YYYY-DDD",/\d{4}-\d{3}/],["YYYY-MM",/\d{4}-\d\d/,!1],["YYYYYYMMDD",/[+-]\d{10}/],["YYYYMMDD",/\d{8}/],["GGGG[W]WWE",/\d{4}W\d{3}/],["GGGG[W]WW",/\d{4}W\d{2}/,!1],["YYYYDDD",/\d{7}/],["YYYYMM",/\d{6}/,!1],["YYYY",/\d{4}/,!1]],Ae=[["HH:mm:ss.SSSS",/\d\d:\d\d:\d\d\.\d+/],["HH:mm:ss,SSSS",/\d\d:\d\d:\d\d,\d+/],["HH:mm:ss",/\d\d:\d\d:\d\d/],["HH:mm",/\d\d:\d\d/],["HHmmss.SSSS",/\d\d\d\d\d\d\.\d+/],["HHmmss,SSSS",/\d\d\d\d\d\d,\d+/],["HHmmss",/\d\d\d\d\d\d/],["HHmm",/\d\d\d\d/],["HH",/\d\d/]],Pe=/^\/?Date\((-?\d+)/i,ke=/^(?:(Mon|Tue|Wed|Thu|Fri|Sat|Sun),?\s)?(\d{1,2})\s(Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec)\s(\d{2,4})\s(\d\d):(\d\d)(?::(\d\d))?\s(?:(UT|GMT|[ECMP][SD]T)|([Zz])|([+-]\d{4}))$/,Ne={UT:0,GMT:0,EDT:-240,EST:-300,CDT:-300,CST:-360,MDT:-360,MST:-420,PDT:-420,PST:-480};function configFromISO(h){var m,y,v,C,T,w,A=h._i,P=_e.exec(A)||Te.exec(A);if(P){for(getParsingFlags(h).iso=!0,m=0,y=we.length;m<y;m++)if(we[m][1].exec(P[1])){C=we[m][0],v=!1!==we[m][2];break}if(null==C)return void(h._isValid=!1);if(P[3]){for(m=0,y=Ae.length;m<y;m++)if(Ae[m][1].exec(P[3])){T=(P[2]||" ")+Ae[m][0];break}if(null==T)return void(h._isValid=!1)}if(!v&&null!=T)return void(h._isValid=!1);if(P[4]){if(!be.exec(P[4]))return void(h._isValid=!1);w="Z"}h._f=C+(T||"")+(w||""),configFromStringAndFormat(h)}else h._isValid=!1}function untruncateYear(h){var m=parseInt(h,10);return m<=49?2e3+m:m<=999?1900+m:m}function configFromRFC2822(h){var m,y=ke.exec(function preprocessRFC2822(h){return h.replace(/\([^)]*\)|[\n\t]/g," ").replace(/(\s\s+)/g," ").replace(/^\s\s*/,"").replace(/\s\s*$/,"")}(h._i));if(y){if(m=function extractFromRFC2822Strings(h,m,y,v,C,T){var w=[untruncateYear(h),se.indexOf(m),parseInt(y,10),parseInt(v,10),parseInt(C,10)];return T&&w.push(parseInt(T,10)),w}(y[4],y[3],y[2],y[5],y[6],y[7]),!function checkWeekday(h,m,y){return!h||de.indexOf(h)===new Date(m[0],m[1],m[2]).getDay()||(getParsingFlags(y).weekdayMismatch=!0,y._isValid=!1,!1)}(y[1],m,h))return;h._a=m,h._tzm=function calculateOffset(h,m,y){if(h)return Ne[h];if(m)return 0;var v=parseInt(y,10),C=v%100;return(v-C)/100*60+C}(y[8],y[9],y[10]),h._d=createUTCDate.apply(null,h._a),h._d.setUTCMinutes(h._d.getUTCMinutes()-h._tzm),getParsingFlags(h).rfc2822=!0}else h._isValid=!1}function defaults(h,m,y){return null!=h?h:null!=m?m:y}function configFromArray(h){var m,y,v,C,T,w=[];if(!h._d){for(v=function currentDateArray(h){var m=new Date(hooks.now());return h._useUTC?[m.getUTCFullYear(),m.getUTCMonth(),m.getUTCDate()]:[m.getFullYear(),m.getMonth(),m.getDate()]}(h),h._w&&null==h._a[2]&&null==h._a[1]&&function dayOfYearFromWeekInfo(h){var m,y,v,C,T,w,A,P,k;null!=(m=h._w).GG||null!=m.W||null!=m.E?(T=1,w=4,y=defaults(m.GG,h._a[0],weekOfYear(createLocal(),1,4).year),v=defaults(m.W,1),((C=defaults(m.E,1))<1||C>7)&&(P=!0)):(T=h._locale._week.dow,w=h._locale._week.doy,k=weekOfYear(createLocal(),T,w),y=defaults(m.gg,h._a[0],k.year),v=defaults(m.w,k.week),null!=m.d?((C=m.d)<0||C>6)&&(P=!0):null!=m.e?(C=m.e+T,(m.e<0||m.e>6)&&(P=!0)):C=T),v<1||v>weeksInYear(y,T,w)?getParsingFlags(h)._overflowWeeks=!0:null!=P?getParsingFlags(h)._overflowWeekday=!0:(A=dayOfYearFromWeeks(y,v,C,T,w),h._a[0]=A.year,h._dayOfYear=A.dayOfYear)}(h),null!=h._dayOfYear&&(T=defaults(h._a[0],v[0]),(h._dayOfYear>daysInYear(T)||0===h._dayOfYear)&&(getParsingFlags(h)._overflowDayOfYear=!0),y=createUTCDate(T,0,h._dayOfYear),h._a[1]=y.getUTCMonth(),h._a[2]=y.getUTCDate()),m=0;m<3&&null==h._a[m];++m)h._a[m]=w[m]=v[m];for(;m<7;m++)h._a[m]=w[m]=null==h._a[m]?2===m?1:0:h._a[m];24===h._a[3]&&0===h._a[4]&&0===h._a[5]&&0===h._a[6]&&(h._nextDay=!0,h._a[3]=0),h._d=(h._useUTC?createUTCDate:createDate).apply(null,w),C=h._useUTC?h._d.getUTCDay():h._d.getDay(),null!=h._tzm&&h._d.setUTCMinutes(h._d.getUTCMinutes()-h._tzm),h._nextDay&&(h._a[3]=24),h._w&&void 0!==h._w.d&&h._w.d!==C&&(getParsingFlags(h).weekdayMismatch=!0)}}function configFromStringAndFormat(h){if(h._f!==hooks.ISO_8601)if(h._f!==hooks.RFC_2822){h._a=[],getParsingFlags(h).empty=!0;var m,y,v,C,T,w,A=""+h._i,k=A.length,R=0;for(v=expandFormat(h._f,h._locale).match(P)||[],m=0;m<v.length;m++)C=v[m],(y=(A.match(getParseRegexForToken(C,h))||[])[0])&&((T=A.substr(0,A.indexOf(y))).length>0&&getParsingFlags(h).unusedInput.push(T),A=A.slice(A.indexOf(y)+y.length),R+=y.length),M[C]?(y?getParsingFlags(h).empty=!1:getParsingFlags(h).unusedTokens.push(C),addTimeToArrayFromToken(C,y,h)):h._strict&&!y&&getParsingFlags(h).unusedTokens.push(C);getParsingFlags(h).charsLeftOver=k-R,A.length>0&&getParsingFlags(h).unusedInput.push(A),h._a[3]<=12&&!0===getParsingFlags(h).bigHour&&h._a[3]>0&&(getParsingFlags(h).bigHour=void 0),getParsingFlags(h).parsedDateParts=h._a.slice(0),getParsingFlags(h).meridiem=h._meridiem,h._a[3]=function meridiemFixWrap(h,m,y){var v;return null==y?m:null!=h.meridiemHour?h.meridiemHour(m,y):null!=h.isPM?((v=h.isPM(y))&&m<12&&(m+=12),v||12!==m||(m=0),m):m}(h._locale,h._a[3],h._meridiem),null!==(w=getParsingFlags(h).era)&&(h._a[0]=h._locale.erasConvertYear(w,h._a[0])),configFromArray(h),checkOverflow(h)}else configFromRFC2822(h);else configFromISO(h)}function prepareConfig(h){var m=h._i,y=h._f;return h._locale=h._locale||getLocale(h._l),null===m||void 0===y&&""===m?createInvalid({nullInput:!0}):("string"==typeof m&&(h._i=m=h._locale.preparse(m)),isMoment(m)?new Moment(checkOverflow(m)):(isDate(m)?h._d=m:isArray(y)?function configFromStringAndArray(h){var m,y,v,C,T,w,A=!1;if(0===h._f.length)return getParsingFlags(h).invalidFormat=!0,void(h._d=new Date(NaN));for(C=0;C<h._f.length;C++)T=0,w=!1,m=copyConfig({},h),null!=h._useUTC&&(m._useUTC=h._useUTC),m._f=h._f[C],configFromStringAndFormat(m),isValid(m)&&(w=!0),T+=getParsingFlags(m).charsLeftOver,T+=10*getParsingFlags(m).unusedTokens.length,getParsingFlags(m).score=T,A?T<v&&(v=T,y=m):(null==v||T<v||w)&&(v=T,y=m,w&&(A=!0));extend(h,y||m)}(h):y?configFromStringAndFormat(h):function configFromInput(h){var m=h._i;isUndefined(m)?h._d=new Date(hooks.now()):isDate(m)?h._d=new Date(m.valueOf()):"string"==typeof m?function configFromString(h){var m=Pe.exec(h._i);null===m?(configFromISO(h),!1===h._isValid&&(delete h._isValid,configFromRFC2822(h),!1===h._isValid&&(delete h._isValid,h._strict?h._isValid=!1:hooks.createFromInputFallback(h)))):h._d=new Date(+m[1])}(h):isArray(m)?(h._a=map(m.slice(0),(function(h){return parseInt(h,10)})),configFromArray(h)):isObject(m)?function configFromObject(h){if(!h._d){var m=normalizeObjectUnits(h._i),y=void 0===m.day?m.date:m.day;h._a=map([m.year,m.month,y,m.hour,m.minute,m.second,m.millisecond],(function(h){return h&&parseInt(h,10)})),configFromArray(h)}}(h):isNumber(m)?h._d=new Date(m):hooks.createFromInputFallback(h)}(h),isValid(h)||(h._d=null),h))}function createLocalOrUTC(h,m,y,v,C){var T={};return!0!==m&&!1!==m||(v=m,m=void 0),!0!==y&&!1!==y||(v=y,y=void 0),(isObject(h)&&isObjectEmpty(h)||isArray(h)&&0===h.length)&&(h=void 0),T._isAMomentObject=!0,T._useUTC=T._isUTC=C,T._l=y,T._i=h,T._f=m,T._strict=v,function createFromConfig(h){var m=new Moment(checkOverflow(prepareConfig(h)));return m._nextDay&&(m.add(1,"d"),m._nextDay=void 0),m}(T)}function createLocal(h,m,y,v){return createLocalOrUTC(h,m,y,v,!1)}hooks.createFromInputFallback=deprecate("value provided is not in a recognized RFC2822 or ISO format. moment construction falls back to js Date(), which is not reliable across all browsers and versions. Non RFC2822/ISO date formats are discouraged and will be removed in an upcoming major release. Please refer to http://momentjs.com/guides/#/warnings/js-date/ for more info.",(function(h){h._d=new Date(h._i+(h._useUTC?" UTC":""))})),hooks.ISO_8601=function(){},hooks.RFC_2822=function(){};var De=deprecate("moment().min is deprecated, use moment.max instead. http://momentjs.com/guides/#/warnings/min-max/",(function(){var h=createLocal.apply(null,arguments);return this.isValid()&&h.isValid()?h<this?this:h:createInvalid()})),Ie=deprecate("moment().max is deprecated, use moment.min instead. http://momentjs.com/guides/#/warnings/min-max/",(function(){var h=createLocal.apply(null,arguments);return this.isValid()&&h.isValid()?h>this?this:h:createInvalid()}));function pickBy(h,m){var y,v;if(1===m.length&&isArray(m[0])&&(m=m[0]),!m.length)return createLocal();for(y=m[0],v=1;v<m.length;++v)m[v].isValid()&&!m[v][h](y)||(y=m[v]);return y}var Oe=["year","quarter","month","week","day","hour","minute","second","millisecond"];function Duration(h){var m=normalizeObjectUnits(h),y=m.year||0,v=m.quarter||0,C=m.month||0,T=m.week||m.isoWeek||0,w=m.day||0,A=m.hour||0,P=m.minute||0,k=m.second||0,R=m.millisecond||0;this._isValid=function isDurationValid(h){var m,y,v=!1;for(m in h)if(hasOwnProp(h,m)&&(-1===te.call(Oe,m)||null!=h[m]&&isNaN(h[m])))return!1;for(y=0;y<Oe.length;++y)if(h[Oe[y]]){if(v)return!1;parseFloat(h[Oe[y]])!==toInt(h[Oe[y]])&&(v=!0)}return!0}(m),this._milliseconds=+R+1e3*k+6e4*P+1e3*A*60*60,this._days=+w+7*T,this._months=+C+3*v+12*y,this._data={},this._locale=getLocale(),this._bubble()}function isDuration(h){return h instanceof Duration}function absRound(h){return h<0?-1*Math.round(-1*h):Math.round(h)}function offset(h,m){addFormatToken(h,0,0,(function(){var h=this.utcOffset(),y="+";return h<0&&(h=-h,y="-"),y+zeroFill(~~(h/60),2)+m+zeroFill(~~h%60,2)}))}offset("Z",":"),offset("ZZ",""),addRegexToken("Z",Z),addRegexToken("ZZ",Z),addParseToken(["Z","ZZ"],(function(h,m,y){y._useUTC=!0,y._tzm=offsetFromString(Z,h)}));var Le=/([\+\-]|\d\d)/gi;function offsetFromString(h,m){var y,v,C=(m||"").match(h);return null===C?null:0===(v=60*(y=((C[C.length-1]||[])+"").match(Le)||["-",0,0])[1]+toInt(y[2]))?0:"+"===y[0]?v:-v}function cloneWithOffset(h,m){var y,v;return m._isUTC?(y=m.clone(),v=(isMoment(h)||isDate(h)?h.valueOf():createLocal(h).valueOf())-y.valueOf(),y._d.setTime(y._d.valueOf()+v),hooks.updateOffset(y,!1),y):createLocal(h).local()}function getDateOffset(h){return-Math.round(h._d.getTimezoneOffset())}function isUtc(){return!!this.isValid()&&this._isUTC&&0===this._offset}hooks.updateOffset=function(){};var Ue=/^(-|\+)?(?:(\d*)[. ])?(\d+):(\d+)(?::(\d+)(\.\d*)?)?$/,je=/^(-|\+)?P(?:([-+]?[0-9,.]*)Y)?(?:([-+]?[0-9,.]*)M)?(?:([-+]?[0-9,.]*)W)?(?:([-+]?[0-9,.]*)D)?(?:T(?:([-+]?[0-9,.]*)H)?(?:([-+]?[0-9,.]*)M)?(?:([-+]?[0-9,.]*)S)?)?$/;function createDuration(h,m){var y,v,C,T=h,w=null;return isDuration(h)?T={ms:h._milliseconds,d:h._days,M:h._months}:isNumber(h)||!isNaN(+h)?(T={},m?T[m]=+h:T.milliseconds=+h):(w=Ue.exec(h))?(y="-"===w[1]?-1:1,T={y:0,d:toInt(w[2])*y,h:toInt(w[3])*y,m:toInt(w[4])*y,s:toInt(w[5])*y,ms:toInt(absRound(1e3*w[6]))*y}):(w=je.exec(h))?(y="-"===w[1]?-1:1,T={y:parseIso(w[2],y),M:parseIso(w[3],y),w:parseIso(w[4],y),d:parseIso(w[5],y),h:parseIso(w[6],y),m:parseIso(w[7],y),s:parseIso(w[8],y)}):null==T?T={}:"object"==typeof T&&("from"in T||"to"in T)&&(C=function momentsDifference(h,m){var y;return h.isValid()&&m.isValid()?(m=cloneWithOffset(m,h),h.isBefore(m)?y=positiveMomentsDifference(h,m):((y=positiveMomentsDifference(m,h)).milliseconds=-y.milliseconds,y.months=-y.months),y):{milliseconds:0,months:0}}(createLocal(T.from),createLocal(T.to)),(T={}).ms=C.milliseconds,T.M=C.months),v=new Duration(T),isDuration(h)&&hasOwnProp(h,"_locale")&&(v._locale=h._locale),isDuration(h)&&hasOwnProp(h,"_isValid")&&(v._isValid=h._isValid),v}function parseIso(h,m){var y=h&&parseFloat(h.replace(",","."));return(isNaN(y)?0:y)*m}function positiveMomentsDifference(h,m){var y={};return y.months=m.month()-h.month()+12*(m.year()-h.year()),h.clone().add(y.months,"M").isAfter(m)&&--y.months,y.milliseconds=+m-+h.clone().add(y.months,"M"),y}function createAdder(h,m){return function(y,v){var C;return null===v||isNaN(+v)||(deprecateSimple(m,"moment()."+m+"(period, number) is deprecated. Please use moment()."+m+"(number, period). See http://momentjs.com/guides/#/warnings/add-inverted-param/ for more info."),C=y,y=v,v=C),addSubtract(this,createDuration(y,v),h),this}}function addSubtract(h,m,y,v){var C=m._milliseconds,T=absRound(m._days),w=absRound(m._months);h.isValid()&&(v=null==v||v,w&&setMonth(h,get(h,"Month")+w*y),T&&set$1(h,"Date",get(h,"Date")+T*y),C&&h._d.setTime(h._d.valueOf()+C*y),v&&hooks.updateOffset(h,T||w))}createDuration.fn=Duration.prototype,createDuration.invalid=function createInvalid$1(){return createDuration(NaN)};var Be=createAdder(1,"add"),He=createAdder(-1,"subtract");function isString(h){return"string"==typeof h||h instanceof String}function isMomentInput(h){return isMoment(h)||isDate(h)||isString(h)||isNumber(h)||function isNumberOrStringArray(h){var m=isArray(h),y=!1;return m&&(y=0===h.filter((function(m){return!isNumber(m)&&isString(h)})).length),m&&y}(h)||function isMomentInputObject(h){var m,y,v=isObject(h)&&!isObjectEmpty(h),C=!1,T=["years","year","y","months","month","M","days","day","d","dates","date","D","hours","hour","h","minutes","minute","m","seconds","second","s","milliseconds","millisecond","ms"];for(m=0;m<T.length;m+=1)y=T[m],C=C||hasOwnProp(h,y);return v&&C}(h)||null==h}function isCalendarSpec(h){var m,y=isObject(h)&&!isObjectEmpty(h),v=!1,C=["sameDay","nextDay","lastDay","nextWeek","lastWeek","sameElse"];for(m=0;m<C.length;m+=1)v=v||hasOwnProp(h,C[m]);return y&&v}function monthDiff(h,m){if(h.date()<m.date())return-monthDiff(m,h);var y=12*(m.year()-h.year())+(m.month()-h.month()),v=h.clone().add(y,"months");return-(y+(m-v<0?(m-v)/(v-h.clone().add(y-1,"months")):(m-v)/(h.clone().add(y+1,"months")-v)))||0}function locale(h){var m;return void 0===h?this._locale._abbr:(null!=(m=getLocale(h))&&(this._locale=m),this)}hooks.defaultFormat="YYYY-MM-DDTHH:mm:ssZ",hooks.defaultFormatUtc="YYYY-MM-DDTHH:mm:ss[Z]";var qe=deprecate("moment().lang() is deprecated. Instead, use moment().localeData() to get the language configuration. Use moment().locale() to change languages.",(function(h){return void 0===h?this.localeData():this.locale(h)}));function localeData(){return this._locale}function mod$1(h,m){return(h%m+m)%m}function localStartOfDate(h,m,y){return h<100&&h>=0?new Date(h+400,m,y)-126227808e5:new Date(h,m,y).valueOf()}function utcStartOfDate(h,m,y){return h<100&&h>=0?Date.UTC(h+400,m,y)-126227808e5:Date.UTC(h,m,y)}function matchEraAbbr(h,m){return m.erasAbbrRegex(h)}function computeErasParse(){var h,m,y=[],v=[],C=[],T=[],w=this.eras();for(h=0,m=w.length;h<m;++h)v.push(regexEscape(w[h].name)),y.push(regexEscape(w[h].abbr)),C.push(regexEscape(w[h].narrow)),T.push(regexEscape(w[h].name)),T.push(regexEscape(w[h].abbr)),T.push(regexEscape(w[h].narrow));this._erasRegex=new RegExp("^("+T.join("|")+")","i"),this._erasNameRegex=new RegExp("^("+v.join("|")+")","i"),this._erasAbbrRegex=new RegExp("^("+y.join("|")+")","i"),this._erasNarrowRegex=new RegExp("^("+C.join("|")+")","i")}function addWeekYearFormatToken(h,m){addFormatToken(0,[h,h.length],0,m)}function getSetWeekYearHelper(h,m,y,v,C){var T;return null==h?weekOfYear(this,v,C).year:(m>(T=weeksInYear(h,v,C))&&(m=T),setWeekAll.call(this,h,m,y,v,C))}function setWeekAll(h,m,y,v,C){var T=dayOfYearFromWeeks(h,m,y,v,C),w=createUTCDate(T.year,0,T.dayOfYear);return this.year(w.getUTCFullYear()),this.month(w.getUTCMonth()),this.date(w.getUTCDate()),this}addFormatToken("N",0,0,"eraAbbr"),addFormatToken("NN",0,0,"eraAbbr"),addFormatToken("NNN",0,0,"eraAbbr"),addFormatToken("NNNN",0,0,"eraName"),addFormatToken("NNNNN",0,0,"eraNarrow"),addFormatToken("y",["y",1],"yo","eraYear"),addFormatToken("y",["yy",2],0,"eraYear"),addFormatToken("y",["yyy",3],0,"eraYear"),addFormatToken("y",["yyyy",4],0,"eraYear"),addRegexToken("N",matchEraAbbr),addRegexToken("NN",matchEraAbbr),addRegexToken("NNN",matchEraAbbr),addRegexToken("NNNN",(function matchEraName(h,m){return m.erasNameRegex(h)})),addRegexToken("NNNNN",(function matchEraNarrow(h,m){return m.erasNarrowRegex(h)})),addParseToken(["N","NN","NNN","NNNN","NNNNN"],(function(h,m,y,v){var C=y._locale.erasParse(h,v,y._strict);C?getParsingFlags(y).era=C:getParsingFlags(y).invalidEra=h})),addRegexToken("y",G),addRegexToken("yy",G),addRegexToken("yyy",G),addRegexToken("yyyy",G),addRegexToken("yo",(function matchEraYearOrdinal(h,m){return m._eraYearOrdinalRegex||G})),addParseToken(["y","yy","yyy","yyyy"],0),addParseToken(["yo"],(function(h,m,y,v){var C;y._locale._eraYearOrdinalRegex&&(C=h.match(y._locale._eraYearOrdinalRegex)),y._locale.eraYearOrdinalParse?m[0]=y._locale.eraYearOrdinalParse(h,C):m[0]=parseInt(h,10)})),addFormatToken(0,["gg",2],0,(function(){return this.weekYear()%100})),addFormatToken(0,["GG",2],0,(function(){return this.isoWeekYear()%100})),addWeekYearFormatToken("gggg","weekYear"),addWeekYearFormatToken("ggggg","weekYear"),addWeekYearFormatToken("GGGG","isoWeekYear"),addWeekYearFormatToken("GGGGG","isoWeekYear"),addUnitAlias("weekYear","gg"),addUnitAlias("isoWeekYear","GG"),addUnitPriority("weekYear",1),addUnitPriority("isoWeekYear",1),addRegexToken("G",J),addRegexToken("g",J),addRegexToken("GG",W,O),addRegexToken("gg",W,O),addRegexToken("GGGG",$,U),addRegexToken("gggg",$,U),addRegexToken("GGGGG",z,B),addRegexToken("ggggg",z,B),addWeekParseToken(["gggg","ggggg","GGGG","GGGGG"],(function(h,m,y,v){m[v.substr(0,2)]=toInt(h)})),addWeekParseToken(["gg","GG"],(function(h,m,y,v){m[v]=hooks.parseTwoDigitYear(h)})),addFormatToken("Q",0,"Qo","quarter"),addUnitAlias("quarter","Q"),addUnitPriority("quarter",7),addRegexToken("Q",x),addParseToken("Q",(function(h,m){m[1]=3*(toInt(h)-1)})),addFormatToken("D",["DD",2],"Do","date"),addUnitAlias("date","D"),addUnitPriority("date",9),addRegexToken("D",W),addRegexToken("DD",W,O),addRegexToken("Do",(function(h,m){return h?m._dayOfMonthOrdinalParse||m._ordinalParse:m._dayOfMonthOrdinalParseLenient})),addParseToken(["D","DD"],2),addParseToken("Do",(function(h,m){m[2]=toInt(h.match(W)[0])}));var Ye=makeGetSet("Date",!0);addFormatToken("DDD",["DDDD",3],"DDDo","dayOfYear"),addUnitAlias("dayOfYear","DDD"),addUnitPriority("dayOfYear",4),addRegexToken("DDD",V),addRegexToken("DDDD",L),addParseToken(["DDD","DDDD"],(function(h,m,y){y._dayOfYear=toInt(h)})),addFormatToken("m",["mm",2],0,"minute"),addUnitAlias("minute","m"),addUnitPriority("minute",14),addRegexToken("m",W),addRegexToken("mm",W,O),addParseToken(["m","mm"],4);var Ve=makeGetSet("Minutes",!1);addFormatToken("s",["ss",2],0,"second"),addUnitAlias("second","s"),addUnitPriority("second",15),addRegexToken("s",W),addRegexToken("ss",W,O),addParseToken(["s","ss"],5);var $e,Ke,ze=makeGetSet("Seconds",!1);for(addFormatToken("S",0,0,(function(){return~~(this.millisecond()/100)})),addFormatToken(0,["SS",2],0,(function(){return~~(this.millisecond()/10)})),addFormatToken(0,["SSS",3],0,"millisecond"),addFormatToken(0,["SSSS",4],0,(function(){return 10*this.millisecond()})),addFormatToken(0,["SSSSS",5],0,(function(){return 100*this.millisecond()})),addFormatToken(0,["SSSSSS",6],0,(function(){return 1e3*this.millisecond()})),addFormatToken(0,["SSSSSSS",7],0,(function(){return 1e4*this.millisecond()})),addFormatToken(0,["SSSSSSSS",8],0,(function(){return 1e5*this.millisecond()})),addFormatToken(0,["SSSSSSSSS",9],0,(function(){return 1e6*this.millisecond()})),addUnitAlias("millisecond","ms"),addUnitPriority("millisecond",16),addRegexToken("S",V,x),addRegexToken("SS",V,O),addRegexToken("SSS",V,L),$e="SSSS";$e.length<=9;$e+="S")addRegexToken($e,G);function parseMs(h,m){m[6]=toInt(1e3*("0."+h))}for($e="S";$e.length<=9;$e+="S")addParseToken($e,parseMs);Ke=makeGetSet("Milliseconds",!1),addFormatToken("z",0,0,"zoneAbbr"),addFormatToken("zz",0,0,"zoneName");var Ge=Moment.prototype;function preParsePostFormat(h){return h}Ge.add=Be,Ge.calendar=function calendar$1(h,m){1===arguments.length&&(isMomentInput(arguments[0])?(h=arguments[0],m=void 0):isCalendarSpec(arguments[0])&&(m=arguments[0],h=void 0));var y=h||createLocal(),v=cloneWithOffset(y,this).startOf("day"),C=hooks.calendarFormat(this,v)||"sameElse",T=m&&(isFunction(m[C])?m[C].call(this,y):m[C]);return this.format(T||this.localeData().calendar(C,this,createLocal(y)))},Ge.clone=function clone(){return new Moment(this)},Ge.diff=function diff(h,m,y){var v,C,T;if(!this.isValid())return NaN;if(!(v=cloneWithOffset(h,this)).isValid())return NaN;switch(C=6e4*(v.utcOffset()-this.utcOffset()),m=normalizeUnits(m)){case"year":T=monthDiff(this,v)/12;break;case"month":T=monthDiff(this,v);break;case"quarter":T=monthDiff(this,v)/3;break;case"second":T=(this-v)/1e3;break;case"minute":T=(this-v)/6e4;break;case"hour":T=(this-v)/36e5;break;case"day":T=(this-v-C)/864e5;break;case"week":T=(this-v-C)/6048e5;break;default:T=this-v}return y?T:absFloor(T)},Ge.endOf=function endOf(h){var m,y;if(void 0===(h=normalizeUnits(h))||"millisecond"===h||!this.isValid())return this;switch(y=this._isUTC?utcStartOfDate:localStartOfDate,h){case"year":m=y(this.year()+1,0,1)-1;break;case"quarter":m=y(this.year(),this.month()-this.month()%3+3,1)-1;break;case"month":m=y(this.year(),this.month()+1,1)-1;break;case"week":m=y(this.year(),this.month(),this.date()-this.weekday()+7)-1;break;case"isoWeek":m=y(this.year(),this.month(),this.date()-(this.isoWeekday()-1)+7)-1;break;case"day":case"date":m=y(this.year(),this.month(),this.date()+1)-1;break;case"hour":m=this._d.valueOf(),m+=36e5-mod$1(m+(this._isUTC?0:6e4*this.utcOffset()),36e5)-1;break;case"minute":m=this._d.valueOf(),m+=6e4-mod$1(m,6e4)-1;break;case"second":m=this._d.valueOf(),m+=1e3-mod$1(m,1e3)-1}return this._d.setTime(m),hooks.updateOffset(this,!0),this},Ge.format=function format(h){h||(h=this.isUtc()?hooks.defaultFormatUtc:hooks.defaultFormat);var m=formatMoment(this,h);return this.localeData().postformat(m)},Ge.from=function from(h,m){return this.isValid()&&(isMoment(h)&&h.isValid()||createLocal(h).isValid())?createDuration({to:this,from:h}).locale(this.locale()).humanize(!m):this.localeData().invalidDate()},Ge.fromNow=function fromNow(h){return this.from(createLocal(),h)},Ge.to=function to(h,m){return this.isValid()&&(isMoment(h)&&h.isValid()||createLocal(h).isValid())?createDuration({from:this,to:h}).locale(this.locale()).humanize(!m):this.localeData().invalidDate()},Ge.toNow=function toNow(h){return this.to(createLocal(),h)},Ge.get=function stringGet(h){return isFunction(this[h=normalizeUnits(h)])?this[h]():this},Ge.invalidAt=function invalidAt(){return getParsingFlags(this).overflow},Ge.isAfter=function isAfter(h,m){var y=isMoment(h)?h:createLocal(h);return!(!this.isValid()||!y.isValid())&&("millisecond"===(m=normalizeUnits(m)||"millisecond")?this.valueOf()>y.valueOf():y.valueOf()<this.clone().startOf(m).valueOf())},Ge.isBefore=function isBefore(h,m){var y=isMoment(h)?h:createLocal(h);return!(!this.isValid()||!y.isValid())&&("millisecond"===(m=normalizeUnits(m)||"millisecond")?this.valueOf()<y.valueOf():this.clone().endOf(m).valueOf()<y.valueOf())},Ge.isBetween=function isBetween(h,m,y,v){var C=isMoment(h)?h:createLocal(h),T=isMoment(m)?m:createLocal(m);return!!(this.isValid()&&C.isValid()&&T.isValid())&&(("("===(v=v||"()")[0]?this.isAfter(C,y):!this.isBefore(C,y))&&(")"===v[1]?this.isBefore(T,y):!this.isAfter(T,y)))},Ge.isSame=function isSame(h,m){var y,v=isMoment(h)?h:createLocal(h);return!(!this.isValid()||!v.isValid())&&("millisecond"===(m=normalizeUnits(m)||"millisecond")?this.valueOf()===v.valueOf():(y=v.valueOf(),this.clone().startOf(m).valueOf()<=y&&y<=this.clone().endOf(m).valueOf()))},Ge.isSameOrAfter=function isSameOrAfter(h,m){return this.isSame(h,m)||this.isAfter(h,m)},Ge.isSameOrBefore=function isSameOrBefore(h,m){return this.isSame(h,m)||this.isBefore(h,m)},Ge.isValid=function isValid$2(){return isValid(this)},Ge.lang=qe,Ge.locale=locale,Ge.localeData=localeData,Ge.max=Ie,Ge.min=De,Ge.parsingFlags=function parsingFlags(){return extend({},getParsingFlags(this))},Ge.set=function stringSet(h,m){if("object"==typeof h){var y,v=function getPrioritizedUnits(h){var m,y=[];for(m in h)hasOwnProp(h,m)&&y.push({unit:m,priority:D[m]});return y.sort((function(h,m){return h.priority-m.priority})),y}(h=normalizeObjectUnits(h));for(y=0;y<v.length;y++)this[v[y].unit](h[v[y].unit])}else if(isFunction(this[h=normalizeUnits(h)]))return this[h](m);return this},Ge.startOf=function startOf(h){var m,y;if(void 0===(h=normalizeUnits(h))||"millisecond"===h||!this.isValid())return this;switch(y=this._isUTC?utcStartOfDate:localStartOfDate,h){case"year":m=y(this.year(),0,1);break;case"quarter":m=y(this.year(),this.month()-this.month()%3,1);break;case"month":m=y(this.year(),this.month(),1);break;case"week":m=y(this.year(),this.month(),this.date()-this.weekday());break;case"isoWeek":m=y(this.year(),this.month(),this.date()-(this.isoWeekday()-1));break;case"day":case"date":m=y(this.year(),this.month(),this.date());break;case"hour":m=this._d.valueOf(),m-=mod$1(m+(this._isUTC?0:6e4*this.utcOffset()),36e5);break;case"minute":m=this._d.valueOf(),m-=mod$1(m,6e4);break;case"second":m=this._d.valueOf(),m-=mod$1(m,1e3)}return this._d.setTime(m),hooks.updateOffset(this,!0),this},Ge.subtract=He,Ge.toArray=function toArray(){var h=this;return[h.year(),h.month(),h.date(),h.hour(),h.minute(),h.second(),h.millisecond()]},Ge.toObject=function toObject(){var h=this;return{years:h.year(),months:h.month(),date:h.date(),hours:h.hours(),minutes:h.minutes(),seconds:h.seconds(),milliseconds:h.milliseconds()}},Ge.toDate=function toDate(){return new Date(this.valueOf())},Ge.toISOString=function toISOString(h){if(!this.isValid())return null;var m=!0!==h,y=m?this.clone().utc():this;return y.year()<0||y.year()>9999?formatMoment(y,m?"YYYYYY-MM-DD[T]HH:mm:ss.SSS[Z]":"YYYYYY-MM-DD[T]HH:mm:ss.SSSZ"):isFunction(Date.prototype.toISOString)?m?this.toDate().toISOString():new Date(this.valueOf()+60*this.utcOffset()*1e3).toISOString().replace("Z",formatMoment(y,"Z")):formatMoment(y,m?"YYYY-MM-DD[T]HH:mm:ss.SSS[Z]":"YYYY-MM-DD[T]HH:mm:ss.SSSZ")},Ge.inspect=function inspect(){if(!this.isValid())return"moment.invalid(/* "+this._i+" */)";var h,m,y,v="moment",C="";return this.isLocal()||(v=0===this.utcOffset()?"moment.utc":"moment.parseZone",C="Z"),h="["+v+'("]',m=0<=this.year()&&this.year()<=9999?"YYYY":"YYYYYY",y=C+'[")]',this.format(h+m+"-MM-DD[T]HH:mm:ss.SSS"+y)},"undefined"!=typeof Symbol&&null!=Symbol.for&&(Ge[Symbol.for("nodejs.util.inspect.custom")]=function(){return"Moment<"+this.format()+">"}),Ge.toJSON=function toJSON(){return this.isValid()?this.toISOString():null},Ge.toString=function toString(){return this.clone().locale("en").format("ddd MMM DD YYYY HH:mm:ss [GMT]ZZ")},Ge.unix=function unix(){return Math.floor(this.valueOf()/1e3)},Ge.valueOf=function valueOf(){return this._d.valueOf()-6e4*(this._offset||0)},Ge.creationData=function creationData(){return{input:this._i,format:this._f,locale:this._locale,isUTC:this._isUTC,strict:this._strict}},Ge.eraName=function getEraName(){var h,m,y,v=this.localeData().eras();for(h=0,m=v.length;h<m;++h){if(y=this.startOf("day").valueOf(),v[h].since<=y&&y<=v[h].until)return v[h].name;if(v[h].until<=y&&y<=v[h].since)return v[h].name}return""},Ge.eraNarrow=function getEraNarrow(){var h,m,y,v=this.localeData().eras();for(h=0,m=v.length;h<m;++h){if(y=this.startOf("day").valueOf(),v[h].since<=y&&y<=v[h].until)return v[h].narrow;if(v[h].until<=y&&y<=v[h].since)return v[h].narrow}return""},Ge.eraAbbr=function getEraAbbr(){var h,m,y,v=this.localeData().eras();for(h=0,m=v.length;h<m;++h){if(y=this.startOf("day").valueOf(),v[h].since<=y&&y<=v[h].until)return v[h].abbr;if(v[h].until<=y&&y<=v[h].since)return v[h].abbr}return""},Ge.eraYear=function getEraYear(){var h,m,y,v,C=this.localeData().eras();for(h=0,m=C.length;h<m;++h)if(y=C[h].since<=C[h].until?1:-1,v=this.startOf("day").valueOf(),C[h].since<=v&&v<=C[h].until||C[h].until<=v&&v<=C[h].since)return(this.year()-hooks(C[h].since).year())*y+C[h].offset;return this.year()},Ge.year=le,Ge.isLeapYear=function getIsLeapYear(){return isLeapYear(this.year())},Ge.weekYear=function getSetWeekYear(h){return getSetWeekYearHelper.call(this,h,this.week(),this.weekday(),this.localeData()._week.dow,this.localeData()._week.doy)},Ge.isoWeekYear=function getSetISOWeekYear(h){return getSetWeekYearHelper.call(this,h,this.isoWeek(),this.isoWeekday(),1,4)},Ge.quarter=Ge.quarters=function getSetQuarter(h){return null==h?Math.ceil((this.month()+1)/3):this.month(3*(h-1)+this.month()%3)},Ge.month=getSetMonth,Ge.daysInMonth=function getDaysInMonth(){return daysInMonth(this.year(),this.month())},Ge.week=Ge.weeks=function getSetWeek(h){var m=this.localeData().week(this);return null==h?m:this.add(7*(h-m),"d")},Ge.isoWeek=Ge.isoWeeks=function getSetISOWeek(h){var m=weekOfYear(this,1,4).week;return null==h?m:this.add(7*(h-m),"d")},Ge.weeksInYear=function getWeeksInYear(){var h=this.localeData()._week;return weeksInYear(this.year(),h.dow,h.doy)},Ge.weeksInWeekYear=function getWeeksInWeekYear(){var h=this.localeData()._week;return weeksInYear(this.weekYear(),h.dow,h.doy)},Ge.isoWeeksInYear=function getISOWeeksInYear(){return weeksInYear(this.year(),1,4)},Ge.isoWeeksInISOWeekYear=function getISOWeeksInISOWeekYear(){return weeksInYear(this.isoWeekYear(),1,4)},Ge.date=Ye,Ge.day=Ge.days=function getSetDayOfWeek(h){if(!this.isValid())return null!=h?this:NaN;var m=this._isUTC?this._d.getUTCDay():this._d.getDay();return null!=h?(h=function parseWeekday(h,m){return"string"!=typeof h?h:isNaN(h)?"number"==typeof(h=m.weekdaysParse(h))?h:null:parseInt(h,10)}(h,this.localeData()),this.add(h-m,"d")):m},Ge.weekday=function getSetLocaleDayOfWeek(h){if(!this.isValid())return null!=h?this:NaN;var m=(this.day()+7-this.localeData()._week.dow)%7;return null==h?m:this.add(h-m,"d")},Ge.isoWeekday=function getSetISODayOfWeek(h){if(!this.isValid())return null!=h?this:NaN;if(null!=h){var m=function parseIsoWeekday(h,m){return"string"==typeof h?m.weekdaysParse(h)%7||7:isNaN(h)?null:h}(h,this.localeData());return this.day(this.day()%7?m:m-7)}return this.day()||7},Ge.dayOfYear=function getSetDayOfYear(h){var m=Math.round((this.clone().startOf("day")-this.clone().startOf("year"))/864e5)+1;return null==h?m:this.add(h-m,"d")},Ge.hour=Ge.hours=ve,Ge.minute=Ge.minutes=Ve,Ge.second=Ge.seconds=ze,Ge.millisecond=Ge.milliseconds=Ke,Ge.utcOffset=function getSetOffset(h,m,y){var v,C=this._offset||0;if(!this.isValid())return null!=h?this:NaN;if(null!=h){if("string"==typeof h){if(null===(h=offsetFromString(Z,h)))return this}else Math.abs(h)<16&&!y&&(h*=60);return!this._isUTC&&m&&(v=getDateOffset(this)),this._offset=h,this._isUTC=!0,null!=v&&this.add(v,"m"),C!==h&&(!m||this._changeInProgress?addSubtract(this,createDuration(h-C,"m"),1,!1):this._changeInProgress||(this._changeInProgress=!0,hooks.updateOffset(this,!0),this._changeInProgress=null)),this}return this._isUTC?C:getDateOffset(this)},Ge.utc=function setOffsetToUTC(h){return this.utcOffset(0,h)},Ge.local=function setOffsetToLocal(h){return this._isUTC&&(this.utcOffset(0,h),this._isUTC=!1,h&&this.subtract(getDateOffset(this),"m")),this},Ge.parseZone=function setOffsetToParsedOffset(){if(null!=this._tzm)this.utcOffset(this._tzm,!1,!0);else if("string"==typeof this._i){var h=offsetFromString(X,this._i);null!=h?this.utcOffset(h):this.utcOffset(0,!0)}return this},Ge.hasAlignedHourOffset=function hasAlignedHourOffset(h){return!!this.isValid()&&(h=h?createLocal(h).utcOffset():0,(this.utcOffset()-h)%60==0)},Ge.isDST=function isDaylightSavingTime(){return this.utcOffset()>this.clone().month(0).utcOffset()||this.utcOffset()>this.clone().month(5).utcOffset()},Ge.isLocal=function isLocal(){return!!this.isValid()&&!this._isUTC},Ge.isUtcOffset=function isUtcOffset(){return!!this.isValid()&&this._isUTC},Ge.isUtc=isUtc,Ge.isUTC=isUtc,Ge.zoneAbbr=function getZoneAbbr(){return this._isUTC?"UTC":""},Ge.zoneName=function getZoneName(){return this._isUTC?"Coordinated Universal Time":""},Ge.dates=deprecate("dates accessor is deprecated. Use date instead.",Ye),Ge.months=deprecate("months accessor is deprecated. Use month instead",getSetMonth),Ge.years=deprecate("years accessor is deprecated. Use year instead",le),Ge.zone=deprecate("moment().zone is deprecated, use moment().utcOffset instead. http://momentjs.com/guides/#/warnings/zone/",(function getSetZone(h,m){return null!=h?("string"!=typeof h&&(h=-h),this.utcOffset(h,m),this):-this.utcOffset()})),Ge.isDSTShifted=deprecate("isDSTShifted is deprecated. See http://momentjs.com/guides/#/warnings/dst-shifted/ for more information",(function isDaylightSavingTimeShifted(){if(!isUndefined(this._isDSTShifted))return this._isDSTShifted;var h,m={};return copyConfig(m,this),(m=prepareConfig(m))._a?(h=m._isUTC?createUTC(m._a):createLocal(m._a),this._isDSTShifted=this.isValid()&&function compareArrays(h,m,y){var v,C=Math.min(h.length,m.length),T=Math.abs(h.length-m.length),w=0;for(v=0;v<C;v++)(y&&h[v]!==m[v]||!y&&toInt(h[v])!==toInt(m[v]))&&w++;return w+T}(m._a,h.toArray())>0):this._isDSTShifted=!1,this._isDSTShifted}));var Xe=Locale.prototype;function get$1(h,m,y,v){var C=getLocale(),T=createUTC().set(v,m);return C[y](T,h)}function listMonthsImpl(h,m,y){if(isNumber(h)&&(m=h,h=void 0),h=h||"",null!=m)return get$1(h,m,y,"month");var v,C=[];for(v=0;v<12;v++)C[v]=get$1(h,v,y,"month");return C}function listWeekdaysImpl(h,m,y,v){"boolean"==typeof h?(isNumber(m)&&(y=m,m=void 0),m=m||""):(y=m=h,h=!1,isNumber(m)&&(y=m,m=void 0),m=m||"");var C,T=getLocale(),w=h?T._week.dow:0,A=[];if(null!=y)return get$1(m,(y+w)%7,v,"day");for(C=0;C<7;C++)A[C]=get$1(m,(C+w)%7,v,"day");return A}Xe.calendar=function calendar(h,m,y){var v=this._calendar[h]||this._calendar.sameElse;return isFunction(v)?v.call(m,y):v},Xe.longDateFormat=function longDateFormat(h){var m=this._longDateFormat[h],y=this._longDateFormat[h.toUpperCase()];return m||!y?m:(this._longDateFormat[h]=y.match(P).map((function(h){return"MMMM"===h||"MM"===h||"DD"===h||"dddd"===h?h.slice(1):h})).join(""),this._longDateFormat[h])},Xe.invalidDate=function invalidDate(){return this._invalidDate},Xe.ordinal=function ordinal(h){return this._ordinal.replace("%d",h)},Xe.preparse=preParsePostFormat,Xe.postformat=preParsePostFormat,Xe.relativeTime=function relativeTime(h,m,y,v){var C=this._relativeTime[y];return isFunction(C)?C(h,m,y,v):C.replace(/%d/i,h)},Xe.pastFuture=function pastFuture(h,m){var y=this._relativeTime[h>0?"future":"past"];return isFunction(y)?y(m):y.replace(/%s/i,m)},Xe.set=function set(h){var m,y;for(y in h)hasOwnProp(h,y)&&(isFunction(m=h[y])?this[y]=m:this["_"+y]=m);this._config=h,this._dayOfMonthOrdinalParseLenient=new RegExp((this._dayOfMonthOrdinalParse.source||this._ordinalParse.source)+"|"+/\d{1,2}/.source)},Xe.eras=function localeEras(h,m){var y,v,C,T=this._eras||getLocale("en")._eras;for(y=0,v=T.length;y<v;++y){switch(typeof T[y].since){case"string":C=hooks(T[y].since).startOf("day"),T[y].since=C.valueOf()}switch(typeof T[y].until){case"undefined":T[y].until=1/0;break;case"string":C=hooks(T[y].until).startOf("day").valueOf(),T[y].until=C.valueOf()}}return T},Xe.erasParse=function localeErasParse(h,m,y){var v,C,T,w,A,P=this.eras();for(h=h.toUpperCase(),v=0,C=P.length;v<C;++v)if(T=P[v].name.toUpperCase(),w=P[v].abbr.toUpperCase(),A=P[v].narrow.toUpperCase(),y)switch(m){case"N":case"NN":case"NNN":if(w===h)return P[v];break;case"NNNN":if(T===h)return P[v];break;case"NNNNN":if(A===h)return P[v]}else if([T,w,A].indexOf(h)>=0)return P[v]},Xe.erasConvertYear=function localeErasConvertYear(h,m){var y=h.since<=h.until?1:-1;return void 0===m?hooks(h.since).year():hooks(h.since).year()+(m-h.offset)*y},Xe.erasAbbrRegex=function erasAbbrRegex(h){return hasOwnProp(this,"_erasAbbrRegex")||computeErasParse.call(this),h?this._erasAbbrRegex:this._erasRegex},Xe.erasNameRegex=function erasNameRegex(h){return hasOwnProp(this,"_erasNameRegex")||computeErasParse.call(this),h?this._erasNameRegex:this._erasRegex},Xe.erasNarrowRegex=function erasNarrowRegex(h){return hasOwnProp(this,"_erasNarrowRegex")||computeErasParse.call(this),h?this._erasNarrowRegex:this._erasRegex},Xe.months=function localeMonths(h,m){return h?isArray(this._months)?this._months[h.month()]:this._months[(this._months.isFormat||oe).test(m)?"format":"standalone"][h.month()]:isArray(this._months)?this._months:this._months.standalone},Xe.monthsShort=function localeMonthsShort(h,m){return h?isArray(this._monthsShort)?this._monthsShort[h.month()]:this._monthsShort[oe.test(m)?"format":"standalone"][h.month()]:isArray(this._monthsShort)?this._monthsShort:this._monthsShort.standalone},Xe.monthsParse=function localeMonthsParse(h,m,y){var v,C,T;if(this._monthsParseExact)return handleStrictParse.call(this,h,m,y);for(this._monthsParse||(this._monthsParse=[],this._longMonthsParse=[],this._shortMonthsParse=[]),v=0;v<12;v++){if(C=createUTC([2e3,v]),y&&!this._longMonthsParse[v]&&(this._longMonthsParse[v]=new RegExp("^"+this.months(C,"").replace(".","")+"$","i"),this._shortMonthsParse[v]=new RegExp("^"+this.monthsShort(C,"").replace(".","")+"$","i")),y||this._monthsParse[v]||(T="^"+this.months(C,"")+"|^"+this.monthsShort(C,""),this._monthsParse[v]=new RegExp(T.replace(".",""),"i")),y&&"MMMM"===m&&this._longMonthsParse[v].test(h))return v;if(y&&"MMM"===m&&this._shortMonthsParse[v].test(h))return v;if(!y&&this._monthsParse[v].test(h))return v}},Xe.monthsRegex=function monthsRegex(h){return this._monthsParseExact?(hasOwnProp(this,"_monthsRegex")||computeMonthsParse.call(this),h?this._monthsStrictRegex:this._monthsRegex):(hasOwnProp(this,"_monthsRegex")||(this._monthsRegex=ce),this._monthsStrictRegex&&h?this._monthsStrictRegex:this._monthsRegex)},Xe.monthsShortRegex=function monthsShortRegex(h){return this._monthsParseExact?(hasOwnProp(this,"_monthsRegex")||computeMonthsParse.call(this),h?this._monthsShortStrictRegex:this._monthsShortRegex):(hasOwnProp(this,"_monthsShortRegex")||(this._monthsShortRegex=ae),this._monthsShortStrictRegex&&h?this._monthsShortStrictRegex:this._monthsShortRegex)},Xe.week=function localeWeek(h){return weekOfYear(h,this._week.dow,this._week.doy).week},Xe.firstDayOfYear=function localeFirstDayOfYear(){return this._week.doy},Xe.firstDayOfWeek=function localeFirstDayOfWeek(){return this._week.dow},Xe.weekdays=function localeWeekdays(h,m){var y=isArray(this._weekdays)?this._weekdays:this._weekdays[h&&!0!==h&&this._weekdays.isFormat.test(m)?"format":"standalone"];return!0===h?shiftWeekdays(y,this._week.dow):h?y[h.day()]:y},Xe.weekdaysMin=function localeWeekdaysMin(h){return!0===h?shiftWeekdays(this._weekdaysMin,this._week.dow):h?this._weekdaysMin[h.day()]:this._weekdaysMin},Xe.weekdaysShort=function localeWeekdaysShort(h){return!0===h?shiftWeekdays(this._weekdaysShort,this._week.dow):h?this._weekdaysShort[h.day()]:this._weekdaysShort},Xe.weekdaysParse=function localeWeekdaysParse(h,m,y){var v,C,T;if(this._weekdaysParseExact)return handleStrictParse$1.call(this,h,m,y);for(this._weekdaysParse||(this._weekdaysParse=[],this._minWeekdaysParse=[],this._shortWeekdaysParse=[],this._fullWeekdaysParse=[]),v=0;v<7;v++){if(C=createUTC([2e3,1]).day(v),y&&!this._fullWeekdaysParse[v]&&(this._fullWeekdaysParse[v]=new RegExp("^"+this.weekdays(C,"").replace(".","\\.?")+"$","i"),this._shortWeekdaysParse[v]=new RegExp("^"+this.weekdaysShort(C,"").replace(".","\\.?")+"$","i"),this._minWeekdaysParse[v]=new RegExp("^"+this.weekdaysMin(C,"").replace(".","\\.?")+"$","i")),this._weekdaysParse[v]||(T="^"+this.weekdays(C,"")+"|^"+this.weekdaysShort(C,"")+"|^"+this.weekdaysMin(C,""),this._weekdaysParse[v]=new RegExp(T.replace(".",""),"i")),y&&"dddd"===m&&this._fullWeekdaysParse[v].test(h))return v;if(y&&"ddd"===m&&this._shortWeekdaysParse[v].test(h))return v;if(y&&"dd"===m&&this._minWeekdaysParse[v].test(h))return v;if(!y&&this._weekdaysParse[v].test(h))return v}},Xe.weekdaysRegex=function weekdaysRegex(h){return this._weekdaysParseExact?(hasOwnProp(this,"_weekdaysRegex")||computeWeekdaysParse.call(this),h?this._weekdaysStrictRegex:this._weekdaysRegex):(hasOwnProp(this,"_weekdaysRegex")||(this._weekdaysRegex=pe),this._weekdaysStrictRegex&&h?this._weekdaysStrictRegex:this._weekdaysRegex)},Xe.weekdaysShortRegex=function weekdaysShortRegex(h){return this._weekdaysParseExact?(hasOwnProp(this,"_weekdaysRegex")||computeWeekdaysParse.call(this),h?this._weekdaysShortStrictRegex:this._weekdaysShortRegex):(hasOwnProp(this,"_weekdaysShortRegex")||(this._weekdaysShortRegex=me),this._weekdaysShortStrictRegex&&h?this._weekdaysShortStrictRegex:this._weekdaysShortRegex)},Xe.weekdaysMinRegex=function weekdaysMinRegex(h){return this._weekdaysParseExact?(hasOwnProp(this,"_weekdaysRegex")||computeWeekdaysParse.call(this),h?this._weekdaysMinStrictRegex:this._weekdaysMinRegex):(hasOwnProp(this,"_weekdaysMinRegex")||(this._weekdaysMinRegex=fe),this._weekdaysMinStrictRegex&&h?this._weekdaysMinStrictRegex:this._weekdaysMinRegex)},Xe.isPM=function localeIsPM(h){return"p"===(h+"").toLowerCase().charAt(0)},Xe.meridiem=function localeMeridiem(h,m,y){return h>11?y?"pm":"PM":y?"am":"AM"},getSetGlobalLocale("en",{eras:[{since:"0001-01-01",until:1/0,offset:1,name:"Anno Domini",narrow:"AD",abbr:"AD"},{since:"0000-12-31",until:-1/0,offset:1,name:"Before Christ",narrow:"BC",abbr:"BC"}],dayOfMonthOrdinalParse:/\d{1,2}(th|st|nd|rd)/,ordinal:function(h){var m=h%10;return h+(1===toInt(h%100/10)?"th":1===m?"st":2===m?"nd":3===m?"rd":"th")}}),hooks.lang=deprecate("moment.lang is deprecated. Use moment.locale instead.",getSetGlobalLocale),hooks.langData=deprecate("moment.langData is deprecated. Use moment.localeData instead.",getLocale);var Qe=Math.abs;function addSubtract$1(h,m,y,v){var C=createDuration(m,y);return h._milliseconds+=v*C._milliseconds,h._days+=v*C._days,h._months+=v*C._months,h._bubble()}function absCeil(h){return h<0?Math.floor(h):Math.ceil(h)}function daysToMonths(h){return 4800*h/146097}function monthsToDays(h){return 146097*h/4800}function makeAs(h){return function(){return this.as(h)}}var Ze=makeAs("ms"),et=makeAs("s"),tt=makeAs("m"),nt=makeAs("h"),rt=makeAs("d"),st=makeAs("w"),ot=makeAs("M"),at=makeAs("Q"),ut=makeAs("y");function makeGetter(h){return function(){return this.isValid()?this._data[h]:NaN}}var dt=makeGetter("milliseconds"),ht=makeGetter("seconds"),pt=makeGetter("minutes"),mt=makeGetter("hours"),ft=makeGetter("days"),yt=makeGetter("months"),vt=makeGetter("years"),St=Math.round,Et={ss:44,s:45,m:45,h:22,d:26,w:null,M:11};function substituteTimeAgo(h,m,y,v,C){return C.relativeTime(m||1,!!y,h,v)}var Ct=Math.abs;function sign(h){return(h>0)-(h<0)||+h}function toISOString$1(){if(!this.isValid())return this.localeData().invalidDate();var h,m,y,v,C,T,w,A,P=Ct(this._milliseconds)/1e3,k=Ct(this._days),R=Ct(this._months),M=this.asSeconds();return M?(h=absFloor(P/60),m=absFloor(h/60),P%=60,h%=60,y=absFloor(R/12),R%=12,v=P?P.toFixed(3).replace(/\.?0+$/,""):"",C=M<0?"-":"",T=sign(this._months)!==sign(M)?"-":"",w=sign(this._days)!==sign(M)?"-":"",A=sign(this._milliseconds)!==sign(M)?"-":"",C+"P"+(y?T+y+"Y":"")+(R?T+R+"M":"")+(k?w+k+"D":"")+(m||h||P?"T":"")+(m?A+m+"H":"")+(h?A+h+"M":"")+(P?A+v+"S":"")):"P0D"}var _t=Duration.prototype;return _t.isValid=function isValid$1(){return this._isValid},_t.abs=function abs(){var h=this._data;return this._milliseconds=Qe(this._milliseconds),this._days=Qe(this._days),this._months=Qe(this._months),h.milliseconds=Qe(h.milliseconds),h.seconds=Qe(h.seconds),h.minutes=Qe(h.minutes),h.hours=Qe(h.hours),h.months=Qe(h.months),h.years=Qe(h.years),this},_t.add=function add$1(h,m){return addSubtract$1(this,h,m,1)},_t.subtract=function subtract$1(h,m){return addSubtract$1(this,h,m,-1)},_t.as=function as(h){if(!this.isValid())return NaN;var m,y,v=this._milliseconds;if("month"===(h=normalizeUnits(h))||"quarter"===h||"year"===h)switch(m=this._days+v/864e5,y=this._months+daysToMonths(m),h){case"month":return y;case"quarter":return y/3;case"year":return y/12}else switch(m=this._days+Math.round(monthsToDays(this._months)),h){case"week":return m/7+v/6048e5;case"day":return m+v/864e5;case"hour":return 24*m+v/36e5;case"minute":return 1440*m+v/6e4;case"second":return 86400*m+v/1e3;case"millisecond":return Math.floor(864e5*m)+v;default:throw new Error("Unknown unit "+h)}},_t.asMilliseconds=Ze,_t.asSeconds=et,_t.asMinutes=tt,_t.asHours=nt,_t.asDays=rt,_t.asWeeks=st,_t.asMonths=ot,_t.asQuarters=at,_t.asYears=ut,_t.valueOf=function valueOf$1(){return this.isValid()?this._milliseconds+864e5*this._days+this._months%12*2592e6+31536e6*toInt(this._months/12):NaN},_t._bubble=function bubble(){var h,m,y,v,C,T=this._milliseconds,w=this._days,A=this._months,P=this._data;return T>=0&&w>=0&&A>=0||T<=0&&w<=0&&A<=0||(T+=864e5*absCeil(monthsToDays(A)+w),w=0,A=0),P.milliseconds=T%1e3,h=absFloor(T/1e3),P.seconds=h%60,m=absFloor(h/60),P.minutes=m%60,y=absFloor(m/60),P.hours=y%24,w+=absFloor(y/24),C=absFloor(daysToMonths(w)),A+=C,w-=absCeil(monthsToDays(C)),v=absFloor(A/12),A%=12,P.days=w,P.months=A,P.years=v,this},_t.clone=function clone$1(){return createDuration(this)},_t.get=function get$2(h){return h=normalizeUnits(h),this.isValid()?this[h+"s"]():NaN},_t.milliseconds=dt,_t.seconds=ht,_t.minutes=pt,_t.hours=mt,_t.days=ft,_t.weeks=function weeks(){return absFloor(this.days()/7)},_t.months=yt,_t.years=vt,_t.humanize=function humanize(h,m){if(!this.isValid())return this.localeData().invalidDate();var y,v,C=!1,T=Et;return"object"==typeof h&&(m=h,h=!1),"boolean"==typeof h&&(C=h),"object"==typeof m&&(T=Object.assign({},Et,m),null!=m.s&&null==m.ss&&(T.ss=m.s-1)),y=this.localeData(),v=function relativeTime$1(h,m,y,v){var C=createDuration(h).abs(),T=St(C.as("s")),w=St(C.as("m")),A=St(C.as("h")),P=St(C.as("d")),k=St(C.as("M")),R=St(C.as("w")),M=St(C.as("y")),N=T<=y.ss&&["s",T]||T<y.s&&["ss",T]||w<=1&&["m"]||w<y.m&&["mm",w]||A<=1&&["h"]||A<y.h&&["hh",A]||P<=1&&["d"]||P<y.d&&["dd",P];return null!=y.w&&(N=N||R<=1&&["w"]||R<y.w&&["ww",R]),(N=N||k<=1&&["M"]||k<y.M&&["MM",k]||M<=1&&["y"]||["yy",M])[2]=m,N[3]=+h>0,N[4]=v,substituteTimeAgo.apply(null,N)}(this,!C,T,y),C&&(v=y.pastFuture(+this,v)),y.postformat(v)},_t.toISOString=toISOString$1,_t.toString=toISOString$1,_t.toJSON=toISOString$1,_t.locale=locale,_t.localeData=localeData,_t.toIsoString=deprecate("toIsoString() is deprecated. Please use toISOString() instead (notice the capitals)",toISOString$1),_t.lang=qe,addFormatToken("X",0,0,"unix"),addFormatToken("x",0,0,"valueOf"),addRegexToken("x",J),addRegexToken("X",/[+-]?\d+(\.\d{1,3})?/),addParseToken("X",(function(h,m,y){y._d=new Date(1e3*parseFloat(h))})),addParseToken("x",(function(h,m,y){y._d=new Date(toInt(h))})),
//! moment.js
hooks.version="2.27.0",function setHookCallback(h){m=h}(createLocal),hooks.fn=Ge,hooks.min=function min(){var h=[].slice.call(arguments,0);return pickBy("isBefore",h)},hooks.max=function max(){var h=[].slice.call(arguments,0);return pickBy("isAfter",h)},hooks.now=function(){return Date.now?Date.now():+new Date},hooks.utc=createUTC,hooks.unix=function createUnix(h){return createLocal(1e3*h)},hooks.months=function listMonths(h,m){return listMonthsImpl(h,m,"months")},hooks.isDate=isDate,hooks.locale=getSetGlobalLocale,hooks.invalid=createInvalid,hooks.duration=createDuration,hooks.isMoment=isMoment,hooks.weekdays=function listWeekdays(h,m,y){return listWeekdaysImpl(h,m,y,"weekdays")},hooks.parseZone=function createInZone(){return createLocal.apply(null,arguments).parseZone()},hooks.localeData=getLocale,hooks.isDuration=isDuration,hooks.monthsShort=function listMonthsShort(h,m){return listMonthsImpl(h,m,"monthsShort")},hooks.weekdaysMin=function listWeekdaysMin(h,m,y){return listWeekdaysImpl(h,m,y,"weekdaysMin")},hooks.defineLocale=defineLocale,hooks.updateLocale=function updateLocale(h,m){if(null!=m){var y,v,C=Se;null!=Ee[h]&&null!=Ee[h].parentLocale?Ee[h].set(mergeConfigs(Ee[h]._config,m)):(null!=(v=loadLocale(h))&&(C=v._config),m=mergeConfigs(C,m),null==v&&(m.abbr=h),(y=new Locale(m)).parentLocale=Ee[h],Ee[h]=y),getSetGlobalLocale(h)}else null!=Ee[h]&&(null!=Ee[h].parentLocale?(Ee[h]=Ee[h].parentLocale,h===getSetGlobalLocale()&&getSetGlobalLocale(h)):null!=Ee[h]&&delete Ee[h]);return Ee[h]},hooks.locales=function listLocales(){return w(Ee)},hooks.weekdaysShort=function listWeekdaysShort(h,m,y){return listWeekdaysImpl(h,m,y,"weekdaysShort")},hooks.normalizeUnits=normalizeUnits,hooks.relativeTimeRounding=function getSetRelativeTimeRounding(h){return void 0===h?St:"function"==typeof h&&(St=h,!0)},hooks.relativeTimeThreshold=function getSetRelativeTimeThreshold(h,m){return void 0!==Et[h]&&(void 0===m?Et[h]:(Et[h]=m,"s"===h&&(Et.ss=m-1),!0))},hooks.calendarFormat=function getCalendarFormat(h,m){var y=h.diff(m,"days",!0);return y<-6?"sameElse":y<-1?"lastWeek":y<0?"lastDay":y<1?"sameDay":y<2?"nextDay":y<7?"nextWeek":"sameElse"},hooks.prototype=Ge,hooks.HTML5_FMT={DATETIME_LOCAL:"YYYY-MM-DDTHH:mm",DATETIME_LOCAL_SECONDS:"YYYY-MM-DDTHH:mm:ss",DATETIME_LOCAL_MS:"YYYY-MM-DDTHH:mm:ss.SSS",DATE:"YYYY-MM-DD",TIME:"HH:mm",TIME_SECONDS:"HH:mm:ss",TIME_MS:"HH:mm:ss.SSS",WEEK:"GGGG-[W]WW",MONTH:"YYYY-MM"},hooks}()}).call(this,y(296)(h))},function(h,m,y){"use strict";function __export(h){for(var y in h)m.hasOwnProperty(y)||(m[y]=h[y])}Object.defineProperty(m,"__esModule",{value:!0}),__export(y(151)),__export(y(153)),__export(y(90)),__export(y(821)),__export(y(823))},function(h,m,y){"use strict";function __export(h){for(var y in h)m.hasOwnProperty(y)||(m[y]=h[y])}Object.defineProperty(m,"__esModule",{value:!0});var v=y(352);m.WorkspaceProvider=v.WorkspaceProvider;var C=y(408);m.FileSystemManager=C.FileSystemManager;var T=y(23);m.sessionStateTracker=T.sessionStateTracker,m.setSessionStateTracker=T.setSessionStateTracker;var w=y(233);m.ApplyEditResult=w.ApplyEditResult,m.UpdateCoEditorVisibleRangesReason=w.UpdateCoEditorVisibleRangesReason;var A=y(75);m.CoEditingMessageFactory=A.MessageFactory,m.CoauthoringService=A.CoauthoringService;var P=y(975);m.HostSyncService=P.HostSyncService;var k=y(409);m.VSCodeBufferManager=k.VSCodeBufferManager;var R=y(168);m.SharedColors=R.SharedColors;const M=y(63);m.coeditingUtils=M;const N=y(235);m.textChange=N;var D=y(411);m.OTAlgorithm=D.OTAlgorithm,m.OTAlgorithmStatus=D.OTAlgorithmStatus,m.OTEdit=D.Edit;var I=y(234);m.CollabBuffer=I.CollabBuffer,m.CollabBufferPosition=I.CollabBufferPosition;var x=y(410);m.PrefixSumComputer=x.PrefixSumComputer;var O=y(413);m.SyncManager=O.SyncManager;var L=y(236);m.getTimedArray=L.getTimedArray,m.setArray=L.setArray;var U=y(70);m.dependencies=U.dependencies,m.Dependencies=U.Dependencies,__export(y(22));var B=y(53);m.PathManager=B.PathManager,m.VSLS_SCHEME=B.VSLS_SCHEME,m.FILE_SCHEME=B.FILE_SCHEME,m.GITHUB_DEV_SCHEME=B.GITHUB_DEV_SCHEME,m.KNOWN_SCHEMES=B.KNOWN_SCHEMES;var W=y(14);m.SettingKeys=W.SettingKeys,m.FeatureSet=W.FeatureSet;var q=y(12);m.Settings=q.Settings,m.featureFlags=q.featureFlags;var Y=y(451);m.defaultSettings=Y.defaultSettings;var V=y(94);m.SessionContext=V.SessionContext;var $=y(1087);m.RpcServices=$.RpcServices;var z=y(26);m.workspaceSessionInfoTracker=z.workspaceSessionInfoTracker;var G=y(428);m.AccessControlManager=G.AccessControlManager;var J=y(430);m.WorkspaceAccessControlManager=J.WorkspaceAccessControlManager;var X=y(1088);m.stateLazyLoad=X.stateLazyLoad;var Z=y(24);m.ExtensionUtil=Z.ExtensionUtil;var ee=y(61);m.PathUtil=ee.PathUtil;var te=y(432);m.EnumUtil=te.EnumUtil;var re=y(166);m.checkDebugging=re.checkDebugging;var ie=y(237);m.calculateFileHash=ie.calculateFileHash;var se=y(242);m.TelemetryUtil=se.TelemetryUtil;var oe=y(34);m.DecoratorHelper=oe.DecoratorHelper;var ae=y(95);m.ClipboardUtil=ae.ClipboardUtil;var ce=y(172);m.TimeTracker=ce.TimeTracker;var le=y(1089);m.askToSignInAndReload=le.askToSignInAndReload;var ue=y(452);m.showInvitationLink=ue.showInvitationLink;var de=y(1091);m.copyInvitationLinkToClipboard=de.copyInvitationLinkToClipboard,__export(y(407)),__export(y(453)),__export(y(454));var he=y(244);m.TokenExchangeService=he.TokenExchangeService;var pe=y(97);m.SupportedAuthProviders=pe.SupportedAuthProviders;var me=y(25);m.localize=me.localize,m.setLocalizeCallback=me.setLocalizeCallback;var fe=y(450);m.WorkspaceServices=fe.WorkspaceServices;var ye=y(17);m.TelemetryEventNames=ye.TelemetryEventNames,m.TelemetryPropertyNames=ye.TelemetryPropertyNames,m.TelemetryEventOrigin=ye.TelemetryEventOrigin;var ve=y(160);m.ExtensionTelemetry=ve.ExtensionTelemetry;var Se=y(171);m.ActiveTimeRecorder=Se.ActiveTimeRecorder;var Ee=y(1092);m.SamplingFilter=Ee.SamplingFilter,m.MissingConversationIdFilter=Ee.MissingConversationIdFilter;var Ce=y(93);m.CoauthoringTelemetry=Ce.CoauthoringTelemetry;const _e=y(1093);m.rpcTelemetry=_e;var Te=y(429);m.WellKnownRestrictedOperations=Te.WellKnownRestrictedOperations;var be=y(32);m.userAuthStateTracker=be.userAuthStateTracker;var we=y(1095);m.RpcServiceHelper=we.RpcServiceHelper;const Ae=y(62);m.constants=Ae;var Pe=y(1096);m.EnterpriseConfig=Pe.EnterpriseConfig;var ke=y(71);m.TreeViewItem=ke.TreeViewItem;var Ne=y(1097);m.SessionExplorerProvider=Ne.SessionExplorerProvider;var De=y(102);m.TreeDataProviderContext=De.TreeDataProviderContext;var Ie=y(1098);m.ParticipantsTreeDataProvider=Ie.ParticipantsTreeDataProvider;var Oe=y(1109);m.TerminalsTreeDataProvider=Oe.TerminalsTreeDataProvider;var Le=y(1110);m.ServerSharingTreeDataProvider=Le.ServerSharingTreeDataProvider;var Ue=y(131);m.TreeDataProviderBase=Ue.TreeDataProviderBase;var je=y(1111);m.HelpViewletProvider=je.HelpViewletProvider;var Be=y(1112);m.CollabActionTreeDataProvider=Be.CollabActionTreeDataProvider;var He=y(261);m.getLabelAndLinkTreeViewItems=He.getLabelAndLinkTreeViewItems;var qe=y(240);m.UserError=qe.UserError;var Ye=y(1113);m.decorate=Ye.decorate,m.debounce=Ye.debounce,m.memoize=Ye.memoize;var Ve=y(103);m.telemetryCommandDecorator=Ve.telemetryCommandDecorator;var $e=y(132);m.errorNotificationCommandDecorator=$e.errorNotificationCommandDecorator;var Ke=y(179);m.telemetryStatusCommandDecorator=Ke.telemetryStatusCommandDecorator;var ze=y(1114);m.singleInvocationCommandDecorator=ze.singleInvocationCommandDecorator;var Ge=y(262);m.sessionStateTransitionsCommandDecorator=Ge.sessionStateTransitionsCommandDecorator;var Xe=y(263);m.validationCommandDecorator=Xe.validationCommandDecorator;var Qe=y(180);m.authenticationCommandDecorator=Qe.authenticationCommandDecorator;var Ze=y(181);m.cancellationDecorator=Ze.cancellationDecorator;var et=y(463);m.progressCommandDecorator=et.progressCommandDecorator;var tt=y(1115);m.ExtensionSetupBase=tt.ExtensionSetupBase;var nt=y(425);m.methodDecoratorsFactory=nt.methodDecoratorsFactory,m.commandBindingDecorator=nt.commandBindingDecorator,m.ControllerHelper=nt.ControllerHelper;var rt=y(1124);m.StatusBarController=rt.StatusBarController;var st=y(1125);m.createSimpleStatusBar=st.createSimpleStatusBar;var ot=y(465);m.initDisposableManager=ot.initDisposableManager,m.createInittableDisposable=ot.createInittableDisposable,m.lazyInittable=ot.lazyInittable;var at=y(96);m.auth=at.auth;var ut=y(1126);m.registerProtocolHandler=ut.registerProtocolHandler;var dt=y(1127);m.AuthenticationProviderBase=dt.AuthenticationProvider;var ht=y(431);m.AuthenticationProviderService=ht.AuthenticationProviderService;var pt=y(462);m.setAuthReloadFlag=pt.setAuthReloadFlag,m.resetAuthReloadFlag=pt.resetAuthReloadFlag,m.SignInReloadMode=pt.SignInReloadMode;var mt=y(239);m.liveshareGithubStrategy=mt.liveshareGithubStrategy,m.liveshareAnonymousStrategy=mt.liveshareAnonymousStrategy;var ft=y(464);m.registerCoreCommands=ft.registerCommands;var yt=y(406);m.JoinCommandUtilities=yt.JoinCommandUtilities;var vt=y(1128);m.ShareCommandUtilities=vt.ShareCommandUtilities;var St=y(466);m.getAllRootFileSystemPaths=St.getAllRootFileSystemPaths;var Et=y(1129);m.Commands=Et.Commands,m.VSCODE_OPEN_EXTERNAL_URI_PREFIX=Et.VSCODE_OPEN_EXTERNAL_URI_PREFIX;var Ct=y(264);m.LiveShareCommandBase=Ct.LiveShareCommandBase,__export(y(1131));var _t=y(1235);m.startLocalWorkspaceHubService=_t.startLocalWorkspaceHubService,__export(y(232));var Tt=y(37);m.initExpServiceAsync=Tt.initAsync,m.getExpService=Tt.getExpService;var bt=y(167);m.TreatmentVariables=bt.TreatmentVariables;var wt=y(1245);m.ArgumentError=wt.ArgumentError,m.Requires=wt.Requires;var At=y(1246);m.SearchProvider=At.SearchProvider;var Pt=y(1248);m.reconnectHostCallback=Pt.reconnectHostCallback;var kt=y(1249);m.recordTerminalActivities=kt.recordTerminalActivities,m.disposeActivityListeners=kt.disposeActivityListeners;var Rt=y(231);m.NotebookConstants=Rt.NotebookConstants;var Mt=y(405);m.findNotebookCell=Mt.findNotebookCell,m.findNotebookCellWithCustomMetadata=Mt.findNotebookCellWithCustomMetadata,m.getNotebookCellData=Mt.getNotebookCellData,m.getCellId=Mt.getCellId,m.findNotebookCellById=Mt.findNotebookCellById,m.sortCells=Mt.sortCells,m.getNotebookHash=Mt.getNotebookHash;var Nt=y(404);m.assert=Nt.assert;var Dt=y(1250);m.initInviteLinkSupport=Dt.initInviteLinkSupport;var It=y(178);m.showWelcomePage=It.showWelcomePage,m.WelcomePageSource=It.WelcomePageSource,m.showWelcomeNotification=It.showWelcomeNotification,__export(y(1251));const xt=y(1262);m.rc=xt,__export(y(458)),__export(y(456)),__export(y(459)),__export(y(457)),__export(y(455))},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0}),m.vsls=y(221),m.contactProtocol=y(910)},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0});var v=y(833);m.vslsCommands=v.vslsCommands;var C=y(895);m.telemetryCommandDecorator=C.telemetryCommandDecorator;var T=y(897);m.errorNotificationCommandDecorator=T.errorNotificationCommandDecorator;var w=y(898);m.CommandBase=w.CommandBase;var A=y(91);m.CommandError=A.CommandError;var P=y(899);m.CommandErrorCode=P.CommandErrorCode;var k=y(378);m.CancellationError=k.CancellationError;var R=y(376);m.ByDesignError=R.ByDesignError;var M=y(379);m.NonBlockingError=M.NonBlockingError;var N=y(377);m.UserError=N.UserError;var D=y(900);m.OptOutTelemetryFilter=D.OptOutTelemetryFilter;var I=y(901);m.LogZipExporter=I.LogZipExporter;var x=y(123);m.traceSource=x.traceSource;var O=y(375);m.NotificationUtil=O.NotificationUtil;var L=y(122);m.getExtensionContext=L.getExtensionContext;var U=y(905);m.getExtensionUri=U.getExtensionUri;var B=y(906);m.launchUrlScraper=B.launchUrlScraper;var W=y(220);m.dataScrapingManagerInstance=W.dataScrapingManagerInstance,function __export(h){for(var y in h)m.hasOwnProperty(y)||(m[y]=h[y])}(y(219));var q=y(907);m.createTerminalRenderer=q.createTerminalRenderer;var Y=y(908);m.fileAccess=Y.fileAccessInstance;var V=y(909);m.VscodeSessionStatusProvider=V.VscodeSessionStatusProvider;var $=y(382);m.VscodeSessionStatus=$.VscodeSessionStatus;var z=y(380);m.VscodeActivityProvider=z.VscodeActivityProvider;var G=y(381);m.VscodeActivityType=G.VscodeActivityType;var J=y(218);m.loadJSON=J.loadJSON},function(h,m,y){"use strict";function __export(h){for(var y in h)m.hasOwnProperty(y)||(m[y]=h[y])}Object.defineProperty(m,"__esModule",{value:!0});const v=y(120),C=y(344);m.RequestType=C.RequestType,m.RequestType0=C.RequestType0,m.RequestType1=C.RequestType1,m.RequestType2=C.RequestType2,m.RequestType3=C.RequestType3,m.RequestType4=C.RequestType4,m.RequestType5=C.RequestType5,m.RequestType6=C.RequestType6,m.RequestType7=C.RequestType7,m.RequestType8=C.RequestType8,m.RequestType9=C.RequestType9,m.ResponseError=C.ResponseError,m.ErrorCodes=C.ErrorCodes,m.NotificationType=C.NotificationType,m.NotificationType0=C.NotificationType0,m.NotificationType1=C.NotificationType1,m.NotificationType2=C.NotificationType2,m.NotificationType3=C.NotificationType3,m.NotificationType4=C.NotificationType4,m.NotificationType5=C.NotificationType5,m.NotificationType6=C.NotificationType6,m.NotificationType7=C.NotificationType7,m.NotificationType8=C.NotificationType8,m.NotificationType9=C.NotificationType9;const T=y(206);m.MessageReader=T.MessageReader,m.StreamMessageReader=T.StreamMessageReader,m.IPCMessageReader=T.IPCMessageReader,m.SocketMessageReader=T.SocketMessageReader;const w=y(207);m.MessageWriter=w.MessageWriter,m.StreamMessageWriter=w.StreamMessageWriter,m.IPCMessageWriter=w.IPCMessageWriter,m.SocketMessageWriter=w.SocketMessageWriter;const A=y(154);m.Disposable=A.Disposable,m.Event=A.Event,m.Emitter=A.Emitter;const P=y(795);m.CancellationTokenSource=P.CancellationTokenSource,m.CancellationToken=P.CancellationToken;const k=y(796);var R,M,N,D,I,x,O;__export(y(797)),__export(y(798)),function(h){h.type=new C.NotificationType("$/cancelRequest")}(R||(R={})),m.NullLogger=Object.freeze({error:()=>{},warn:()=>{},info:()=>{},log:()=>{}}),function(h){h[h.Off=0]="Off",h[h.Messages=1]="Messages",h[h.Verbose=2]="Verbose"}(M=m.Trace||(m.Trace={})),function(h){h.fromString=function fromString(m){switch(m=m.toLowerCase()){case"off":return h.Off;case"messages":return h.Messages;case"verbose":return h.Verbose;default:return h.Off}},h.toString=function toString(m){switch(m){case h.Off:return"off";case h.Messages:return"messages";case h.Verbose:return"verbose";default:return"off"}}}(M=m.Trace||(m.Trace={})),function(h){h.Text="text",h.JSON="json"}(m.TraceFormat||(m.TraceFormat={})),function(h){h.fromString=function fromString(m){return"json"===(m=m.toLowerCase())?h.JSON:h.Text}}(N=m.TraceFormat||(m.TraceFormat={})),function(h){h.type=new C.NotificationType("$/setTraceNotification")}(D=m.SetTraceNotification||(m.SetTraceNotification={})),function(h){h.type=new C.NotificationType("$/logTraceNotification")}(I=m.LogTraceNotification||(m.LogTraceNotification={})),function(h){h[h.Closed=1]="Closed",h[h.Disposed=2]="Disposed",h[h.AlreadyListening=3]="AlreadyListening"}(x=m.ConnectionErrors||(m.ConnectionErrors={}));class ConnectionError extends Error{constructor(h,m){super(m),this.code=h,Object.setPrototypeOf(this,ConnectionError.prototype)}}function _createMessageConnection(h,m,y,T){let w=0,L=0,U=0;let B,W,q=void 0,Y=Object.create(null),V=void 0,$=Object.create(null),z=new k.LinkedMap,G=Object.create(null),J=Object.create(null),X=M.Off,Z=N.Text,ee=O.New,te=new A.Emitter,re=new A.Emitter,ie=new A.Emitter,se=new A.Emitter;function createRequestQueueKey(h){return"req-"+h.toString()}function addMessageToQueue(h,m){C.isRequestMessage(m)?h.set(createRequestQueueKey(m.id),m):C.isResponseMessage(m)?h.set(function createResponseQueueKey(h){return null===h?"res-unknown-"+(++U).toString():"res-"+h.toString()}(m.id),m):h.set(function createNotificationQueueKey(){return"not-"+(++L).toString()}(),m)}function cancelUndispatched(h){}function isListening(){return ee===O.Listening}function isClosed(){return ee===O.Closed}function isDisposed(){return ee===O.Disposed}function closeHandler(){ee!==O.New&&ee!==O.Listening||(ee=O.Closed,re.fire(void 0))}function triggerMessageQueue(){B||0===z.size||(B=setImmediate(()=>{B=void 0,function processMessageQueue(){if(0===z.size)return;let h=z.shift();try{C.isRequestMessage(h)?function handleRequest(h){if(isDisposed())return;function reply(y,v,T){let w={jsonrpc:"2.0",id:h.id};y instanceof C.ResponseError?w.error=y.toJson():w.result=void 0===y?null:y,traceSendingResponse(w,v,T),m.write(w)}function replyError(y,v,C){let T={jsonrpc:"2.0",id:h.id,error:y.toJson()};traceSendingResponse(T,v,C),m.write(T)}!function traceReceivedRequest(h){if(X===M.Off||!W)return;if(Z===N.Text){let m=void 0;X===M.Verbose&&h.params&&(m=`Params: ${JSON.stringify(h.params,null,4)}\n\n`),W.log(`Received request '${h.method} - (${h.id})'.`,m)}else logLSPMessage("receive-request",h)}(h);let y,T,w=Y[h.method];w&&(y=w.type,T=w.handler);let A=Date.now();if(T||q){let w=new P.CancellationTokenSource,k=String(h.id);J[k]=w;try{let P;P=void 0===h.params||void 0!==y&&0===y.numberOfParams?T?T(w.token):q(h.method,w.token):v.array(h.params)&&(void 0===y||y.numberOfParams>1)?T?T(...h.params,w.token):q(h.method,...h.params,w.token):T?T(h.params,w.token):q(h.method,h.params,w.token);let R=P;P?R.then?R.then(m=>{delete J[k],reply(m,h.method,A)},m=>{delete J[k],m instanceof C.ResponseError?replyError(m,h.method,A):m&&v.string(m.message)?replyError(new C.ResponseError(C.ErrorCodes.InternalError,`Request ${h.method} failed with message: ${m.message}`),h.method,A):replyError(new C.ResponseError(C.ErrorCodes.InternalError,`Request ${h.method} failed unexpectedly without providing any details.`),h.method,A)}):(delete J[k],reply(P,h.method,A)):(delete J[k],function replySuccess(y,v,C){void 0===y&&(y=null);let T={jsonrpc:"2.0",id:h.id,result:y};traceSendingResponse(T,v,C),m.write(T)}(P,h.method,A))}catch(m){delete J[k],m instanceof C.ResponseError?reply(m,h.method,A):m&&v.string(m.message)?replyError(new C.ResponseError(C.ErrorCodes.InternalError,`Request ${h.method} failed with message: ${m.message}`),h.method,A):replyError(new C.ResponseError(C.ErrorCodes.InternalError,`Request ${h.method} failed unexpectedly without providing any details.`),h.method,A)}}else replyError(new C.ResponseError(C.ErrorCodes.MethodNotFound,`Unhandled method ${h.method}`),h.method,A)}(h):C.isNotificationMessage(h)?function handleNotification(h){if(isDisposed())return;let m,C=void 0;if(h.method===R.type.method)m=h=>{let m=h.id,y=J[String(m)];y&&y.cancel()};else{let y=$[h.method];y&&(m=y.handler,C=y.type)}if(m||V)try{!function traceReceivedNotification(h){if(X===M.Off||!W||h.method===I.type.method)return;if(Z===N.Text){let m=void 0;X===M.Verbose&&(m=h.params?`Params: ${JSON.stringify(h.params,null,4)}\n\n`:"No parameters provided.\n\n"),W.log(`Received notification '${h.method}'.`,m)}else logLSPMessage("receive-notification",h)}(h),void 0===h.params||void 0!==C&&0===C.numberOfParams?m?m():V(h.method):v.array(h.params)&&(void 0===C||C.numberOfParams>1)?m?m(...h.params):V(h.method,...h.params):m?m(h.params):V(h.method,h.params)}catch(m){m.message?y.error(`Notification handler '${h.method}' failed with message: ${m.message}`):y.error(`Notification handler '${h.method}' failed unexpectedly.`)}else ie.fire(h)}(h):C.isResponseMessage(h)?function handleResponse(h){if(isDisposed())return;if(null===h.id)h.error?y.error(`Received response message without id: Error is: \n${JSON.stringify(h.error,void 0,4)}`):y.error("Received response message without id. No further error information provided.");else{let m=String(h.id),v=G[m];if(function traceReceivedResponse(h,m){if(X===M.Off||!W)return;if(Z===N.Text){let y=void 0;if(X===M.Verbose&&(h.error&&h.error.data?y=`Error data: ${JSON.stringify(h.error.data,null,4)}\n\n`:h.result?y=`Result: ${JSON.stringify(h.result,null,4)}\n\n`:void 0===h.error&&(y="No result returned.\n\n")),m){let v=h.error?` Request failed: ${h.error.message} (${h.error.code}).`:"";W.log(`Received response '${m.method} - (${h.id})' in ${Date.now()-m.timerStart}ms.${v}`,y)}else W.log(`Received response ${h.id} without active response promise.`,y)}else logLSPMessage("receive-response",h)}(h,v),v){delete G[m];try{if(h.error){let m=h.error;v.reject(new C.ResponseError(m.code,m.message,m.data))}else{if(void 0===h.result)throw new Error("Should never happen.");v.resolve(h.result)}}catch(h){h.message?y.error(`Response handler '${v.method}' failed with message: ${h.message}`):y.error(`Response handler '${v.method}' failed unexpectedly.`)}}}}(h):function handleInvalidMessage(h){if(!h)return void y.error("Received empty message.");y.error(`Received message which is neither a response nor a notification message:\n${JSON.stringify(h,null,4)}`);let m=h;if(v.string(m.id)||v.number(m.id)){let h=String(m.id),y=G[h];y&&y.reject(new Error("The received response has neither a result nor an error property."))}}(h)}finally{triggerMessageQueue()}}()}))}h.onClose(closeHandler),h.onError((function readErrorHandler(h){te.fire([h,void 0,void 0])})),m.onClose(closeHandler),m.onError((function writeErrorHandler(h){te.fire(h)}));let callback=h=>{try{if(C.isNotificationMessage(h)&&h.method===R.type.method){let y=createRequestQueueKey(h.params.id),v=z.get(y);if(C.isRequestMessage(v)){let C=T&&T.cancelUndispatched?T.cancelUndispatched(v,cancelUndispatched):void 0;if(C&&(void 0!==C.error||void 0!==C.result))return z.delete(y),C.id=v.id,traceSendingResponse(C,h.method,Date.now()),void m.write(C)}}addMessageToQueue(z,h)}finally{triggerMessageQueue()}};function traceSendingResponse(h,m,y){if(X!==M.Off&&W)if(Z===N.Text){let v=void 0;X===M.Verbose&&(h.error&&h.error.data?v=`Error data: ${JSON.stringify(h.error.data,null,4)}\n\n`:h.result?v=`Result: ${JSON.stringify(h.result,null,4)}\n\n`:void 0===h.error&&(v="No result returned.\n\n")),W.log(`Sending response '${m} - (${h.id})'. Processing request took ${Date.now()-y}ms`,v)}else logLSPMessage("send-response",h)}function logLSPMessage(h,m){if(!W||X===M.Off)return;const y={isLSPMessage:!0,type:h,message:m,timestamp:Date.now()};W.log(y)}function throwIfClosedOrDisposed(){if(isClosed())throw new ConnectionError(x.Closed,"Connection is closed.");if(isDisposed())throw new ConnectionError(x.Disposed,"Connection is disposed.")}function undefinedToNull(h){return void 0===h?null:h}function computeMessageParams(h,m){let y,v=h.numberOfParams;switch(v){case 0:y=null;break;case 1:y=undefinedToNull(m[0]);break;default:y=[];for(let h=0;h<m.length&&h<v;h++)y.push(undefinedToNull(m[h]));if(m.length<v)for(let h=m.length;h<v;h++)y.push(null)}return y}let oe={sendNotification:(h,...y)=>{let C,T;if(throwIfClosedOrDisposed(),v.string(h))switch(C=h,y.length){case 0:T=null;break;case 1:T=y[0];break;default:T=y}else C=h.method,T=computeMessageParams(h,y);let w={jsonrpc:"2.0",method:C,params:T};!function traceSendingNotification(h){if(X!==M.Off&&W)if(Z===N.Text){let m=void 0;X===M.Verbose&&(m=h.params?`Params: ${JSON.stringify(h.params,null,4)}\n\n`:"No parameters provided.\n\n"),W.log(`Sending notification '${h.method}'.`,m)}else logLSPMessage("send-notification",h)}(w),m.write(w)},onNotification:(h,m)=>{throwIfClosedOrDisposed(),v.func(h)?V=h:m&&(v.string(h)?$[h]={type:void 0,handler:m}:$[h.method]={type:h,handler:m})},sendRequest:(h,...y)=>{let T,A;throwIfClosedOrDisposed(),function throwIfNotListening(){if(!isListening())throw new Error("Call listen() first.")}();let k=void 0;if(v.string(h))switch(T=h,y.length){case 0:A=null;break;case 1:P.CancellationToken.is(y[0])?(A=null,k=y[0]):A=undefinedToNull(y[0]);break;default:const h=y.length-1;P.CancellationToken.is(y[h])?(k=y[h],A=2===y.length?undefinedToNull(y[0]):y.slice(0,h).map(h=>undefinedToNull(h))):A=y.map(h=>undefinedToNull(h))}else{T=h.method,A=computeMessageParams(h,y);let m=h.numberOfParams;k=P.CancellationToken.is(y[m])?y[m]:void 0}let D=w++,I=new Promise((h,y)=>{let v={jsonrpc:"2.0",id:D,method:T,params:A},w={method:T,timerStart:Date.now(),resolve:h,reject:y};!function traceSendingRequest(h){if(X!==M.Off&&W)if(Z===N.Text){let m=void 0;X===M.Verbose&&h.params&&(m=`Params: ${JSON.stringify(h.params,null,4)}\n\n`),W.log(`Sending request '${h.method} - (${h.id})'.`,m)}else logLSPMessage("send-request",h)}(v);try{m.write(v)}catch(h){w.reject(new C.ResponseError(C.ErrorCodes.MessageWriteError,h.message?h.message:"Unknown reason")),w=null}w&&(G[String(D)]=w)});return k&&k.onCancellationRequested(()=>{oe.sendNotification(R.type,{id:D})}),I},onRequest:(h,m)=>{throwIfClosedOrDisposed(),v.func(h)?q=h:m&&(v.string(h)?Y[h]={type:void 0,handler:m}:Y[h.method]={type:h,handler:m})},trace:(h,m,y)=>{let C=!1,T=N.Text;void 0!==y&&(v.boolean(y)?C=y:(C=y.sendNotification||!1,T=y.traceFormat||N.Text)),X=h,Z=T,W=X===M.Off?void 0:m,!C||isClosed()||isDisposed()||oe.sendNotification(D.type,{value:M.toString(h)})},onError:te.event,onClose:re.event,onUnhandledNotification:ie.event,onDispose:se.event,dispose:()=>{if(isDisposed())return;ee=O.Disposed,se.fire(void 0);let y=new Error("Connection got disposed.");Object.keys(G).forEach(h=>{G[h].reject(y)}),G=Object.create(null),J=Object.create(null),z=new k.LinkedMap,v.func(m.dispose)&&m.dispose(),v.func(h.dispose)&&h.dispose()},listen:()=>{throwIfClosedOrDisposed(),function throwIfListening(){if(isListening())throw new ConnectionError(x.AlreadyListening,"Connection is already listening")}(),ee=O.Listening,h.listen(callback)},inspect:()=>{console.log("inspect")}};return oe.onNotification(I.type,h=>{X!==M.Off&&W&&W.log(h.message,X===M.Verbose?h.verbose:void 0)}),oe}m.ConnectionError=ConnectionError,function(h){h.is=function is(h){let m=h;return m&&v.func(m.cancelUndispatched)}}(m.ConnectionStrategy||(m.ConnectionStrategy={})),function(h){h[h.New=1]="New",h[h.Listening=2]="Listening",h[h.Closed=3]="Closed",h[h.Disposed=4]="Disposed"}(O||(O={})),m.createMessageConnection=function createMessageConnection(h,y,v,C){return v||(v=m.NullLogger),_createMessageConnection(function isMessageReader(h){return void 0!==h.listen&&void 0===h.read}(h)?h:new T.StreamMessageReader(h),function isMessageWriter(h){return void 0!==h.write&&void 0===h.end}(y)?y:new w.StreamMessageWriter(y),v,C)}},function(h,m){h.exports=require("path")},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0});var v=y(836);m.Telemetry=v.Telemetry,m.TelemetryClass=v.TelemetryClass,m.TelemetryEvent=v.TelemetryEvent,m.Fault=v.Fault,m.TimedEvent=v.TimedEvent,m.cleanSensitiveInformation=v.cleanSensitiveInformation,m.propagateOffsetMarkTime=v.propagateOffsetMarkTime;var C=y(214);m.TelemetryPropertyNames=C.TelemetryPropertyNames;var T=y(360);m.FaultType=T.FaultType;var w=y(361);m.TelemetryResult=w.Result;var A=y(839);m.SendOnceFilter=A.SendOnceFilter,m.SamplingFilter=A.SamplingFilter},function(h,m){h.exports=require("buffer")},function(h,m){h.exports=require("util")},function(h,m){h.exports=require("crypto")},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0});const v=y(222),C=y(14),T=y(20);class Settings{static get(h){return Settings.settingsProvider.get(h)}static getMemento(h){return Settings.settingsProvider.mementoConfig.get(h)}static saveMemento(h,m){return Settings.settingsProvider.mementoConfig.save(h,m)}static getUri(h,m){const y=m?Settings.getMemento(h):Settings.get(h);if(y)return parseUrl(y)}static get scheme(){return"vsls"}static get isVSLSTeamMember(){return!!Settings.get(C.SettingKeys.teamStatus)}static get isInternalFeatureSet(){return Settings.get(C.SettingKeys.isInternal)}static get isInsidersFeatureSet(){const h=Settings.get(C.SettingKeys.featureSet);return!!h&&C.FeatureSet[h]===C.FeatureSet.insiders}static get isNativeAuth(){return!!Settings.get(C.SettingKeys.nativeAuthFlow)}static save(h,m,y=!0){return Settings.settingsProvider.save(h,m,y)}}function parseUrl(h){try{return T.parse(h)}catch(h){return}}m.Settings=Settings,Settings.settingsProvider=v.settingsProviderInstance,m.featureFlags={api:!1,localUndo:!1,localRedo:!1,multiRootWorkspaceVSIDE:!1,propagateFolderEvents:!1,agentExtension:!1,comments:!0,attemptReconnection:!0},m.parseUrl=parseUrl},function(h,m){h.exports=require("events")},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0}),function(h){h.accountProvider="accountProvider",h.account="account",h.connectionMode="connectionMode",h.allowGuestDebugControl="allowGuestDebugControl",h.allowGuestTaskControl="allowGuestTaskControl",h.autoShareServers="autoShareServers",h.anonymousGuestApproval="anonymousGuestApproval",h.diagnosticLoggingLevel="diagnosticLoggingLevel",h.diagnosticMode="diagnosticMode",h.accessibilityFeaturesEnabled="accessibility.accessibilityFeaturesEnabled",h.accessibilityOutputDevice="accessibility.outputDevice",h.accessibilityVoiceVolume="accessibility.voiceVolume",h.accessibilitySoundVolume="accessibility.soundVolume",h.accessibilitySpeechRate="accessibility.speechRate",h.accessibilityVoice="accessibility.voice",h.accessibilityVoiceEnabled="accessibility.voiceEnabled",h.accessibilitySoundsEnabled="accessibility.soundsEnabled",h.launcherClient="launcherClient",h.autoShareTerminals="autoShareTerminals",h.sharedTerminalWidth="sharedTerminalWidth",h.sharedTerminalHeight="sharedTerminalHeight",h.allowedDomains="allowedDomains",h.allowReadWriteTerminals="allowReadWriteTerminals",h.featureSet="featureSet",h.nameTagVisibility="nameTagVisibility",h.showReadOnlyUsersInEditor="showReadOnlyUsersInEditor",h.focusBehavior="focusBehavior",h.shareExternalFiles="shareExternalFiles",h.guestApprovalRequired="guestApprovalRequired",h.allowGuestCommandControl="languages.allowGuestCommandControl",h.allowGuestExecuteCells="notebooks.allowGuestExecuteCells",h.joinDebugSessionOption="joinDebugSessionOption",h.showVerboseNotifications="showVerboseNotifications",h.publishWorkspaceInfo="publishWorkspaceInfo",h.diagnosticLogging="diagnosticLogging",h.populateGitCoAuthors="populateGitCoAuthors",h.showInStatusBar="showInStatusBar",h.comments="comments",h.openSharedServers="openSharedServers",h.presence="presence",h.teamStatus="teamStatus",h.allowInvites="allowInvites",h.alwaysFollowHost="alwaysFollowHost",h.remoteLabelAndLinks="remoteLabelAndLinks",h.authFlowTest="authFlowTest",h.nativeAuthFlow="nativeAuthFlow",h.commandPrefix="commandPrefix",h.serviceUri="serviceUri",h.signalRServiceUri="signalRServiceUri",h.scheme="scheme",h.authority="authority",h.canCollectPII="canCollectPII",h.userEmail="userEmail",h.isInternal="isInternal",h.isCloudEnvironment="isCloudEnvironment",h.name="name",h.shortName="shortName",h.abbreviation="abbreviation",h.licenseUrl="licenseUrl",h.privacyUrl="privacyUrl",h.hasUsed="hasUsed",h.configName="configName",h.activityTimeout="activityTimeout",h.customAccountAuthReloadFlag="customAccountAuthReloadFlag",h.anonymousAuthReloadFlag="anonymousAuthReloadFlag",h.extensionPermissions="extensionPermissions",h.authenticationProvider="authenticationProvider",h.useClientFileService="useClientFileService",h.remoteSettingsUri="remoteSettingsUri",h.remoteSettingsUpdateMinutes="remoteSettingsUpdateMinutes",h.textSearchResultsLimit="textSearchResultsLimit",h.textSearchPreviewLimit="textSearchPreviewLimit",h.whatsNewUri="whatsNewUri",h.runsInVSCodeDev="runsInVSCodeDev",h.joinWorkspaceId="joinWorkspaceId",h.performanceLogging="performanceLogging",h.performanceRun="performanceRun",h.logTelemetry="logTelemetry",h.anonymousUserName="anonymousUserName",h.microphoneId="microphoneId",h.speakerId="speakerId",h.newChatDisplayDate="newChatDisplayDate",h.newAudioDisplayDate="newAudioDisplayDate",h.sessionCount="sessionCount",h.dontRequestFeedback="dontRequestFeedback",h.dontRequestAdditionalFeedback="dontRequestAdditionalFeedback",h.surveyShownDate="surveyShownDate",h.firstActivationTime="firstActivationTime",h.hasSelectedLauncherClient="hasSelectedLauncherClient"}(m.SettingKeys||(m.SettingKeys={})),function(h){h.stable="stable",h.insiders="insiders"}(m.FeatureSet||(m.FeatureSet={}))},function(h,m,y){"use strict";function __export(h){for(var y in h)m.hasOwnProperty(y)||(m[y]=h[y])}Object.defineProperty(m,"__esModule",{value:!0}),__export(y(201)),__export(y(746)),__export(y(331)),__export(y(336)),__export(y(770));var v=y(335);m.LoggerSettings=v.LoggerSettings;var C=y(772);m.GlobPatternTraceFilter=C.GlobPatternTraceFilter;var T=y(777);m.VerbosityTraceFilter=T.VerbosityTraceFilter;var w=y(150);m.TraceListener=w.TraceListener;var A=y(118);m.TraceFormat=A.TraceFormat;var P=y(778);m.TraceSource=P.TraceSource;var k=y(779);m.TraceFilters=k.TraceFilters;var R=y(780);m.Logger=R.Logger,m.LoggerBase=R.LoggerBase;var M=y(334);m.Privacy=M.Privacy},function(h,m,y){"use strict";function __export(h){for(var y in h)m.hasOwnProperty(y)||(m[y]=h[y])}var v=this&&this.__importStar||function(h){if(h&&h.__esModule)return h;var m={};if(null!=h)for(var y in h)Object.hasOwnProperty.call(h,y)&&(m[y]=h[y]);return m.default=h,m};Object.defineProperty(m,"__esModule",{value:!0});var C=y(353);m.RpcErrorCodes=C.RpcErrorCodes,m.RpcProxy=C.RpcProxy;var T=y(212);m.RpcServiceHandler=T.RpcServiceHandler,m.methodProgress=T.methodProgress;var w=y(825);m.RpcClient=w.RpcClient;var A=y(211);m.RpcClientProxy=A.RpcClientProxy,m.RpcClientProxyBase=A.RpcClientProxyBase;var P=y(354);m.RpcLoggerAdapter=P.RpcLoggerAdapter;var k=y(355);m.RpcConnectionClosedError=k.RpcConnectionClosedError,m.RpcConnectionShutdownError=k.RpcConnectionShutdownError;var R=y(356);m.RpcError=R.RpcError;var M=y(826);m.RpcServer=M.RpcServer;var N=y(827);m.RpcMessageWriter=N.RpcMessageWriter;var D=y(828);m.DataFormat=D.DataFormat,m.dataFormat=D.dataFormat;var I=y(829);m.RpcProxyCache=I.RpcProxyCache;var x=y(830);m.Channel=x.Channel;const O=v(y(121));m.rpcUtils=O,__export(y(357));var L=y(831);m.createDuplexRpcMessageStreams=L.createDuplexRpcMessageStreams,m.rpcMaxMessageSize=10485760,__export(y(832))},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0});class TelemetryEventNames{}m.TelemetryEventNames=TelemetryEventNames,TelemetryEventNames.ADD_EXTERNAL_FILE="add-external-file",TelemetryEventNames.REMOVE_USER="remove-user",TelemetryEventNames.BLOCK_USER="block-user",TelemetryEventNames.FAULT_PREFIX="Fault/",TelemetryEventNames.ACTIVATE_EXTENSION="activate-extension",TelemetryEventNames.CLICK_SHARE_BUTTON="click-sharebutton",TelemetryEventNames.DEACTIVATE_EXTENSION="deactivate-extension",TelemetryEventNames.ACTIVATE_AGENTASYNC="activate-agentasync",TelemetryEventNames.JOIN_ON_START_EVENT="join-on-start",TelemetryEventNames.START_AGENT="start-agent",TelemetryEventNames.START_AGENT_CONNECTION="start-agentconnection",TelemetryEventNames.SIGN_IN="signin-user",TelemetryEventNames.SIGN_IN_EXPLICIT="signin-user-explicit",TelemetryEventNames.INITIATE_SESSION="initiate-session",TelemetryEventNames.PRE_RELOAD_WORKSPACE="pre-reload-workspace",TelemetryEventNames.JOIN_WORKSPACE="join-workspace",TelemetryEventNames.JOINED_PS_FROM_VIEWLET="join-ps-from-viewlet",TelemetryEventNames.SHARE_WORKSPACE="share-workspace",TelemetryEventNames.HAS_COLLABORATORS="has-collaborators",TelemetryEventNames.CREATE_INVITATION_LINK="create-invitationlink",TelemetryEventNames.CREATE_WORKSPACE="create-workspace",TelemetryEventNames.LIST_PLANNED_SESSION="list-planned-session",TelemetryEventNames.CREATE_PLANNED_SESSION="create-planned-session",TelemetryEventNames.DELETE_PLANNED_SESSION="delete-planned-session",TelemetryEventNames.RENAME_PLANNED_SESSION="rename-planned-session",TelemetryEventNames.COPY_PLANNED_SESSION_LINK="copy-planned-session-link",TelemetryEventNames.SHOW_PLANNED_SESSIONS="show-planned-sessions",TelemetryEventNames.PLANNED_SESSIONS_LIST_IS_NOT_EMPTY="planned-sessions-list-is-not-empty",TelemetryEventNames.WORKSPACE_SIGNIN_RELOAD="signin-reload-workspace",TelemetryEventNames.HTTP_REQUEST_COMPLETE="complete-httprequest",TelemetryEventNames.INITIALIZE_DEBUGGING="initialize-debugging",TelemetryEventNames.INITIALIZE_COAUTHORING="initialize-coauthoring",TelemetryEventNames.VERSION_CHECK_FAIL=TelemetryEventNames.FAULT_PREFIX+"check-version-fault",TelemetryEventNames.ASSERT_FAULT=TelemetryEventNames.FAULT_PREFIX+"assert-fault",TelemetryEventNames.DOWNLOAD_FAULT=TelemetryEventNames.FAULT_PREFIX+"download-fault",TelemetryEventNames.SIGN_IN_FAULT=TelemetryEventNames.FAULT_PREFIX+"signin-user-fault",TelemetryEventNames.SIGN_IN_FAULT_EXPLICIT=TelemetryEventNames.FAULT_PREFIX+"signin-user-fault-explicit",TelemetryEventNames.AGENT_INIT_SIGN_IN_ATTEMPT_FAULT=TelemetryEventNames.FAULT_PREFIX+"signin-agentinit-fault",TelemetryEventNames.USER_ACTION_AGENT_INIT_SIGN_IN_ATTEMPT_FAULT=TelemetryEventNames.FAULT_PREFIX+"userinteraction-agentinit-fault",TelemetryEventNames.UPDATE_WORKPSACE_NAME_FAIL=TelemetryEventNames.FAULT_PREFIX+"update-workspace-name-fault",TelemetryEventNames.LEAVE_COLLABORATION_FAIL=TelemetryEventNames.FAULT_PREFIX+"leave-collaboration-fault",TelemetryEventNames.CREATE_INVITATION_LINK_FAULT=TelemetryEventNames.FAULT_PREFIX+"create-invitationlink-fault",TelemetryEventNames.CREATE_FAULT=TelemetryEventNames.FAULT_PREFIX+"create-workspace-fault",TelemetryEventNames.LIST_PLANNED_SESSION_FAULT=TelemetryEventNames.FAULT_PREFIX+"list-planned-session-fault",TelemetryEventNames.CREATE_PLANNED_SESSION_FAULT=TelemetryEventNames.FAULT_PREFIX+"create-planned-session-fault",TelemetryEventNames.DELETE_PLANNED_SESSION_FAULT=TelemetryEventNames.FAULT_PREFIX+"delete-planned-session-fault",TelemetryEventNames.RENAME_PLANNED_SESSION_FAULT=TelemetryEventNames.FAULT_PREFIX+"rename-planned-session-fault",TelemetryEventNames.COPY_PLANNED_SESSION_LINK_FAULT=TelemetryEventNames.FAULT_PREFIX+"copy-planned-session-link-fault",TelemetryEventNames.JOIN_PLANNED_SESSION_FAULT=TelemetryEventNames.FAULT_PREFIX+"join-planned-session-fault",TelemetryEventNames.SHARE_FAULT=TelemetryEventNames.FAULT_PREFIX+"share-workspace-fault",TelemetryEventNames.JOIN_FAULT=TelemetryEventNames.FAULT_PREFIX+"join-workspace-fault",TelemetryEventNames.ACTIVATE_EXTENSION_FAULT=TelemetryEventNames.FAULT_PREFIX+"activate-extension-fault",TelemetryEventNames.DEACTIVATE_EXTENSION_FAULT=TelemetryEventNames.FAULT_PREFIX+"deactivate-extension-fault",TelemetryEventNames.ACTIVATE_AGENTASYNC_FAULT=TelemetryEventNames.FAULT_PREFIX+"activate-agentasync-fault",TelemetryEventNames.UNHANDLED_COMMAND_ERROR_FAULT=TelemetryEventNames.FAULT_PREFIX+"unhandled-commanderror-fault",TelemetryEventNames.UNHANDLED_REJECTION_FAULT=TelemetryEventNames.FAULT_PREFIX+"unhandled-rejection-fault",TelemetryEventNames.REQUEST_OPERATION_ACCESS_FAULT=TelemetryEventNames.FAULT_PREFIX+"request-operation-access-fault",TelemetryEventNames.TRANSITION="transition-state",TelemetryEventNames.REPORT_AGENTPROGRESS="report-agentprogress",TelemetryEventNames.WRITE_LOGS_FAILED=TelemetryEventNames.FAULT_PREFIX+"write-logs-failed",TelemetryEventNames.OPEN_LOGS_FAILED=TelemetryEventNames.FAULT_PREFIX+"open-logs-failed",TelemetryEventNames.NAME_LOGS_FILE_FAILED=TelemetryEventNames.FAULT_PREFIX+"name-logfile-failed",TelemetryEventNames.ACTIVATE_EXTENSION_API="activate-extensionapi",TelemetryEventNames.SHARE_EXTENSION_SERVICE="share-extensionservice",TelemetryEventNames.INVOKE_EXTENSION_COMMAND="invoke-extensioncommand",TelemetryEventNames.FEEDBACK="report-feedback",TelemetryEventNames.OPEN_LINK="open-link",TelemetryEventNames.PASTE_INVALIDLINK_FAULT=TelemetryEventNames.FAULT_PREFIX+"paste-invalidlink-fault",TelemetryEventNames.LINUX_VERSION="report-linuxversion",TelemetryEventNames.SESSION="participate-session",TelemetryEventNames.SILENT_SIGNIN_TIMEOUT=TelemetryEventNames.FAULT_PREFIX+"signin-timeout-fault",TelemetryEventNames.JOIN_FROM_BROWSER_FAULT=TelemetryEventNames.FAULT_PREFIX+"join-browser-fault",TelemetryEventNames.SHARE_TERMINAL="share-terminal",TelemetryEventNames.SHARE_TERMINAL_FAULT=TelemetryEventNames.FAULT_PREFIX+"share-terminal-fault",TelemetryEventNames.MAKE_TERMINAL_READ_ONLY="make-terminal-read-only",TelemetryEventNames.MAKE_TERMINAL_READ_ONLY_FAULT=TelemetryEventNames.FAULT_PREFIX+"make-terminal-read-only-fault",TelemetryEventNames.MAKE_TERMINAL_READ_WRITE="make-terminal-read-write",TelemetryEventNames.MAKE_TERMINAL_READ_WRITE_FAULT=TelemetryEventNames.FAULT_PREFIX+"make-terminal-read-write-fault",TelemetryEventNames.RUN_SHARED_TERMINAL_FAULT=TelemetryEventNames.FAULT_PREFIX+"run-terminal-fault",TelemetryEventNames.OPEN_TERMINAL="open-terminal",TelemetryEventNames.OPEN_TERMINAL_FAULT=TelemetryEventNames.FAULT_PREFIX+"open-terminal-fault",TelemetryEventNames.REMOVE_TERMINAL="remove-terminal",TelemetryEventNames.REMOVE_TERMINAL_FAULT=TelemetryEventNames.FAULT_PREFIX+"remove-terminal-fault",TelemetryEventNames.LIST_TERMINALS="list-terminals",TelemetryEventNames.LIST_TERMINALS_FAULT=TelemetryEventNames.FAULT_PREFIX+"list-terminals-fault",TelemetryEventNames.SHOW_WHATS_NEW_INFO="show-whatsnew",TelemetryEventNames.WELCOME_PAGE_TOAST_SHOWN="show-welcomepage-toast",TelemetryEventNames.WELCOME_PAGE_TOAST_SHOWN_INTERACTION="interact-welcomepage-toast",TelemetryEventNames.WELCOME_PAGE_SHOWN="show-welcomepage",TelemetryEventNames.WELCOME_PAGE_DISMISSED="dismiss-welcomepage",TelemetryEventNames.WELCOME_PAGE_COPY_CLICKED="copy-clicked-welcomepage",TelemetryEventNames.WELCOME_PAGE_LINK_CLICKED="link-clicked-welcomepage",TelemetryEventNames.SUMMON_PARTICIPANTS_INVOKED="summon-participants",TelemetryEventNames.COPY_COLLABORATION_LINK_INVOKLED="copy-collaborationlink",TelemetryEventNames.COMMAND_INITIATED="command-initiated",TelemetryEventNames.ZEROUSER_SESSION="zerouser-session",TelemetryEventNames.GUEST_INITIATED_DEBUGGING="guest-initiated-debugging-started",TelemetryEventNames.REJECT_RESTRICTED_OPERATION="reject-restrictedOperation",TelemetryEventNames.REQUEST_RESTRICTED_OPERATION="request-restrictedOperationAccess",TelemetryEventNames.SET_RESTRICTED_OPERATION_ACCESS="set-restrictedOperationAccess",TelemetryEventNames.REPORT_SETTINGS="report-settings",TelemetryEventNames.CHANGE_SETTING="change-setting",TelemetryEventNames.WORKSPACE_CONNECTION_ERROR="drop-workspaceconnection-fault",TelemetryEventNames.INVOKE_NEWPROTOCOLHANDLER="invoke-newprotocolhandler",TelemetryEventNames.UNDO_FAILURE="undo-failed",TelemetryEventNames.REDO_FAILURE="redo-failed",TelemetryEventNames.FOLLOW_USER_FAILURE="follow-user-failed",TelemetryEventNames.UNFOLLOW_USER_FAILURE="unfollow-user-failed",TelemetryEventNames.CHAT_WITH_CONTACT="chat-with-contact",TelemetryEventNames.CHAT_WITH_CONTACT_FAULT="chat-with-contact-fault",TelemetryEventNames.CHAT_SELECT_WINDOW="chat-select-window",TelemetryEventNames.CHAT_SELECT_WINDOW_FAULT="chat-select-window-fault",TelemetryEventNames.START_OR_JOIN_AUDIO="start-or-join-audio",TelemetryEventNames.START_OR_JOIN_AUDIO_FAULT="start-or-join-audio-fault",TelemetryEventNames.INVITE_CONTACT="invite-contact",TelemetryEventNames.INVITE_CONTACT_FAULT="invite-contact-fault",TelemetryEventNames.INVITE_CONTACT_BY_EMAIL="invite-contact-by-email",TelemetryEventNames.INVITE_CONTACT_BY_EMAIL_FAULT="invite-contact-by-email-fault",TelemetryEventNames.INVITE_NO_CONTACT_BY_EMAIL="invite-no-contact-by-email",TelemetryEventNames.INVITE_NO_CONTACT_BY_EMAIL_FAULT="invite-no-contact-by-email-fault",TelemetryEventNames.REMOVE_RECENT_CONTACT="remove-recent-contact",TelemetryEventNames.REMOVE_RECENT_CONTACT_FAULT="remove-recent-contact-fault",TelemetryEventNames.INVITE_AVAILABLE_CONTACTS="invite-available-contacts",TelemetryEventNames.INVITE_AVAILABLE_CONTACTS_FAULT="invite-available-contacts-fault",TelemetryEventNames.SELECT_PRESENCE_PROVIDER="select-presence-provider",TelemetryEventNames.SELECT_PRESENCE_PROVIDER_FAULT="select-presence-provider-fault",TelemetryEventNames.INVITE_SEARCH_CONTACTS="invite-search-contacts",TelemetryEventNames.INVITE_SEARCH_CONTACTS_FAULT="invite-search-contacts-fault",TelemetryEventNames.CHANGE_SELF_PRESENCE="change-self-presence",TelemetryEventNames.CHANGE_SELF_PRESENCE_FAULT="change-self-presence-fault",TelemetryEventNames.CHANGE_SELF_PRESENCE_STATUS="change-self-presence-status",TelemetryEventNames.CHANGE_SELF_PRESENCE_STATUS_FAULT="change-self-presence-status-fault",TelemetryEventNames.SIGN_IN_PRESENCE="sign-in-presence",TelemetryEventNames.SIGN_IN_PRESENCE_FAULT="sign-in-presence-fault",TelemetryEventNames.SIGN_OUT_PRESENCE="sign-out-presence",TelemetryEventNames.SIGN_OUT_PRESENCE_FAULT="sign-out-presence-fault",TelemetryEventNames.SHARE_SERVER="share-server",TelemetryEventNames.SHOW_LINK_INVITE_TOAST="show-invitetoast",TelemetryEventNames.RESPOND_TOAST="respond-invitetoast",TelemetryEventNames.SHARE_SERVER_FAULT=TelemetryEventNames.FAULT_PREFIX+"share-server-fault",TelemetryEventNames.UNSHARE_SERVER="unshare-server",TelemetryEventNames.UNSHARE_SERVER_FAULT=TelemetryEventNames.FAULT_PREFIX+"unshare-server-fault",TelemetryEventNames.BROWSE_SERVER="browse-server",TelemetryEventNames.BROWSE_SERVER_FAULT=TelemetryEventNames.FAULT_PREFIX+"browse-server-fault",TelemetryEventNames.COPY_URL_SERVER="copyurl-server",TelemetryEventNames.COPY_URL_SERVER_FAULT=TelemetryEventNames.FAULT_PREFIX+"copyurl-server-fault",TelemetryEventNames.LIST_SERVERS="list-servers",TelemetryEventNames.LIST_SERVERS_FAULT=TelemetryEventNames.FAULT_PREFIX+"list-servers-fault",TelemetryEventNames.OPEN_SCC_RESOURCE="open-scc-resource",TelemetryEventNames.OPEN_SCC_RESOURCE_FAULT=TelemetryEventNames.FAULT_PREFIX+"open-scc-resource-fault",TelemetryEventNames.OPEN_SCC_CHANGE="open-scc-change",TelemetryEventNames.OPEN_SCC_CHANGE_FAULT=TelemetryEventNames.FAULT_PREFIX+"open-scc-change-fault",TelemetryEventNames.DISCARD_SCC_CHANGE="discard-scc-change",TelemetryEventNames.DISCARD_SCC_CHANGE_FAULT=TelemetryEventNames.FAULT_PREFIX+"discard-scc-change-fault",TelemetryEventNames.DISCARD_ALL_SCC_CHANGES="discard-all-scc-changes",TelemetryEventNames.DISCARD_ALL_SCC_CHANGES_FAULT=TelemetryEventNames.FAULT_PREFIX+"discard-all-scc-changes-fault",TelemetryEventNames.REVERT_SCC_CHANGE="revert-scc-change",TelemetryEventNames.REVERT_SCC_CHANGE_FAULT=TelemetryEventNames.FAULT_PREFIX+"revert-scc-change-fault",TelemetryEventNames.USER_ELEVATION_TOGGLE_COMMAND="elevatetoggle-user",TelemetryEventNames.USER_ELEVATION_TOGGLE_COMMAND_FAULT=TelemetryEventNames.USER_ELEVATION_TOGGLE_COMMAND+"-fault",TelemetryEventNames.CREATE_COMMENT_THREAD="create-comment-thread",TelemetryEventNames.CREATE_COMMENT_THREAD_FAULT=TelemetryEventNames.FAULT_PREFIX+"create-comment-thread-fault",TelemetryEventNames.DELETE_COMMENT_THREAD="delete-comment-thread",TelemetryEventNames.DELETE_COMMENT_THREAD_FAULT=TelemetryEventNames.FAULT_PREFIX+"delete-comment-thread-fault",TelemetryEventNames.REPLY_COMMENT="reply-comment",TelemetryEventNames.REPLY_COMMENT_FAULT=TelemetryEventNames.FAULT_PREFIX+"reply-comment-fault",TelemetryEventNames.EDIT_COMMENT="edit-comment",TelemetryEventNames.EDIT_COMMENT_FAULT=TelemetryEventNames.FAULT_PREFIX+"edit-comment-fault",TelemetryEventNames.DELETE_COMMENT="delete-comment",TelemetryEventNames.DELETE_COMMENT_FAULT=TelemetryEventNames.FAULT_PREFIX+"delete-comment-fault",TelemetryEventNames.SAVE_COMMENT="save-comment",TelemetryEventNames.SAVE_COMMENT_FAULT=TelemetryEventNames.FAULT_PREFIX+"save-comment-fault",TelemetryEventNames.CANCEL_EDIT_COMMENT="cancel-edit-comment",TelemetryEventNames.CANCEL_EDIT_COMMENT_FAULT=TelemetryEventNames.FAULT_PREFIX+"cancel-edit-comment-fault",TelemetryEventNames.DISMISS_SURVEY="dismiss-survey",TelemetryEventNames.EVALUATED_CLIENT_FOR_EXPERIMENT="evaluated-client-for-experiment",TelemetryEventNames.TOKEN_EXPIRED="token-expired-presence-fault",TelemetryEventNames.AUDIO_CONNECT_CALL="audio-connect-call",TelemetryEventNames.AUDIO_CALL_STARTED_NOTIFICATION="audio-call-started-notification",TelemetryEventNames.AUDIO_CALL_INFO_NOTIFICATION="audio-call-info-notification",TelemetryEventNames.AUDIO_CALL_UNEXPECTED_NOTIFICATION="audio-call-unexpected-notification",TelemetryEventNames.AUDIO_INVALID_SESSION_TRANSITION="audio-invalid-session-transition",TelemetryEventNames.AUDIO_GET_SELECTED_DEVICES="audio-get-selected-devices",TelemetryEventNames.AUDIO_GET_PARTICIPANTS="audio-get-participants",TelemetryEventNames.AUDIO_END_CALL="audio-end-call",TelemetryEventNames.AUDIO_ENUMERATE_DEVICES="audio-enumerate-devices",TelemetryEventNames.AUDIO_MUTE="audio-mute",TelemetryEventNames.AUDIO_UNMUTE="audio-unmute",TelemetryEventNames.AUDIO_SELECT_DEVICE="audio-select-device",TelemetryEventNames.INSTALL_RECOVERY="install-recovery",TelemetryEventNames.INSTALL_RECOVERY_TOAST="install-recovery-toast",TelemetryEventNames.DELETE_RUNTIME_DEPENDENCIES="delete-runtime-dependencies",TelemetryEventNames.JOIN_PROMPT_DISPLAYED="join-prompt-displayed",TelemetryEventNames.CHAT_HANDSHAKE_REQUEST="chat-handshake-request",TelemetryEventNames.CHAT_HANDSHAKE_RESPONSE="chat-handshake-response",TelemetryEventNames.CHAT_UNKNOWN_USER_ID="chat-unknown-user-id",TelemetryEventNames.CHAT_DISABLED_MESSAGE="chat-disabled-message",TelemetryEventNames.CHAT_COMMAND_INVOKED="chat-command-invoked",TelemetryEventNames.CHAT_CREATE_WINDOW="chat-create-window",TelemetryEventNames.CHAT_UPDATE_WINDOW="chat-update-window",TelemetryEventNames.CHAT_ISCONNECTED_CHANGED="chat-isconnected-changed",TelemetryEventNames.CHAT_NOTIFY="chat-notify",TelemetryEventNames.CHAT_FAULT="chat-fault",TelemetryEventNames.CHAT_OPEN_SESSION="chat-open-session",TelemetryEventNames.CHAT_OPEN_SESSION_FAULT=TelemetryEventNames.FAULT_PREFIX+"chat-open-session-fault",TelemetryEventNames.RESPOND_ANONYMOUS_JOIN_REQUEST="respond-anonymous-join-request",TelemetryEventNames.AUTH_PROMPTED_SIGNIN="auth-prompted-signin",TelemetryEventNames.AUTH_SILENT_CHECK="auth-silent-check",TelemetryEventNames.UPDATE_ANONYMOUS_GUEST_ACCESS_LEVEL="update-anonymous-guest-access-level",TelemetryEventNames.TRY_LOAD_SESSION="try-load-session",TelemetryEventNames.COLLABORATE_BLOCK="collaborate-block",TelemetryEventNames.PIN="pin",TelemetryEventNames.INITIALIZE_ACCESSIBILITY_MANAGER="initialize-accessibilitymanager",TelemetryEventNames.SYNTHESIZE_SPEECH_FAULT="synthesize-speech-fault",TelemetryEventNames.FOCUS_PARTICIPANT="focus-participant",TelemetryEventNames.FOCUS_PARTICIPANTS="focus-participants",TelemetryEventNames.OPEN_IN_OTHER_EDITOR="open-in-other-editor",TelemetryEventNames.LAUNCHER_CLIENT_SELECTION="launcher-client-selection",TelemetryEventNames.LAUNCHER_CLIENT_CANCEL="launcher-client-cancel",TelemetryEventNames.SWITCH_BACK_TO_WEB_EDITOR="switch-back-to-web-editor";class TelemetryPropertyNames{}m.TelemetryPropertyNames=TelemetryPropertyNames,TelemetryPropertyNames.FEATURE_NAME="liveshare.",TelemetryPropertyNames.FEATURE_NAME_V2=TelemetryPropertyNames.FEATURE_NAME+"v2.",TelemetryPropertyNames.AGENT_START_AGENT_FOUND=TelemetryPropertyNames.FEATURE_NAME+"AgentFound",TelemetryPropertyNames.AGENT_SPAWN_START_TIME=TelemetryPropertyNames.FEATURE_NAME+"AgentSpawnStartTime",TelemetryPropertyNames.AGENT_SPAWN_END_TIME=TelemetryPropertyNames.FEATURE_NAME+"AgentSpawnEndTime",TelemetryPropertyNames.CORRELATION_ID=TelemetryPropertyNames.FEATURE_NAME+"CorrelationId",TelemetryPropertyNames.EVENT_RESULT=TelemetryPropertyNames.FEATURE_NAME+"Result",TelemetryPropertyNames.EVENT_MESSAGE=TelemetryPropertyNames.FEATURE_NAME+"Message",TelemetryPropertyNames.EVENT_EXCEPTION_STACK=TelemetryPropertyNames.FEATURE_NAME+"ExceptionStack",TelemetryPropertyNames.EVENT_EXCEPTION_CODE=TelemetryPropertyNames.FEATURE_NAME+"ExceptionCode",TelemetryPropertyNames.EVENT_DURATION=TelemetryPropertyNames.FEATURE_NAME+"Duration",TelemetryPropertyNames.IS_DEBUGGING=TelemetryPropertyNames.FEATURE_NAME+"IsDebugging",TelemetryPropertyNames.IS_VSCODE_ACCOUNT_ENABLED=TelemetryPropertyNames.FEATURE_NAME+"IsVSCodeAccountEnabled",TelemetryPropertyNames.IS_VSCODE_ACCOUNT_AUTH_SUPPORTED=TelemetryPropertyNames.FEATURE_NAME+"IsVSCodeAccountSupported",TelemetryPropertyNames.IS_MAC_OSX_CATALINA_OR_NEWER=TelemetryPropertyNames.FEATURE_NAME+"IsMacOSxCatalinaOrNewer",TelemetryPropertyNames.AUTH_FLOW_INITIALIZATION_COMMAND=TelemetryPropertyNames.FEATURE_NAME+"AuthFlowInitializationCommand",TelemetryPropertyNames.SILENT_SIGN_IN=TelemetryPropertyNames.FEATURE_NAME+"SilentSignIn",TelemetryPropertyNames.SIGN_IN_WITH_CODE=TelemetryPropertyNames.FEATURE_NAME+"WithCode",TelemetryPropertyNames.SIGN_IN_WITH_BROWSER=TelemetryPropertyNames.FEATURE_NAME+"BrowserSignIn",TelemetryPropertyNames.JOIN_WITH_LINK=TelemetryPropertyNames.FEATURE_NAME+"WithLink",TelemetryPropertyNames.COMMAND_TEXT=TelemetryPropertyNames.FEATURE_NAME+"CommandText",TelemetryPropertyNames.JOIN_INVOKE_COMMAND=TelemetryPropertyNames.FEATURE_NAME+"CommandText",TelemetryPropertyNames.TELEMETRY_EVENT_VERSION=TelemetryPropertyNames.FEATURE_NAME+"TelemetryEventVersion",TelemetryPropertyNames.SHARE_WORKSPACE_STARTING=TelemetryPropertyNames.FEATURE_NAME+"ShareWorkspaceStarting",TelemetryPropertyNames.SHARE_WORKSPACE_COMPLETE=TelemetryPropertyNames.FEATURE_NAME+"ShareWorkspaceComplete",TelemetryPropertyNames.SHARE_WORKSPACE_COUNT_OF_WORKSPACE_FOLDERS=TelemetryPropertyNames.FEATURE_NAME+"WorkspaceFolderCount",TelemetryPropertyNames.SHARED_AS_PLANNED_SESSION=TelemetryPropertyNames.FEATURE_NAME+"SharedAsPlannedSession",TelemetryPropertyNames.FIREWALL_CHECK_COMPLETE=TelemetryPropertyNames.FEATURE_NAME+"FirewallCheckComplete",TelemetryPropertyNames.FIREWALL_CHECK_STARTING=TelemetryPropertyNames.FEATURE_NAME+"FirewallCheckStarting",TelemetryPropertyNames.GET_WORKSPACE_COMPLETE=TelemetryPropertyNames.FEATURE_NAME+"GetWorkspaceComplete",TelemetryPropertyNames.INIT_COEDITING_COMPLETE=TelemetryPropertyNames.FEATURE_NAME+"InitCoeditingComplete",TelemetryPropertyNames.INIT_DEBUGGING_COMPLETE=TelemetryPropertyNames.FEATURE_NAME+"InitDebuggingComplete",TelemetryPropertyNames.INIT_LSP_COMPLETE=TelemetryPropertyNames.FEATURE_NAME+"InitLspComplete",TelemetryPropertyNames.INIT_BREAKPOINT_COMPLETE=TelemetryPropertyNames.FEATURE_NAME+"InitBreakpointComplete",TelemetryPropertyNames.INIT_TASK_COMPLETE=TelemetryPropertyNames.FEATURE_NAME+"InitTaskComplete",TelemetryPropertyNames.INIT_ACCESS_CONTROL_COMPLETE=TelemetryPropertyNames.FEATURE_NAME+"InitAccessControlComplete",TelemetryPropertyNames.INIT_TEXT_SEARCH_SERVICE_COMPLETE=TelemetryPropertyNames.FEATURE_NAME+"InitTextSearchServiceComplete",TelemetryPropertyNames.INIT_GUEST_CHANNEL_SERVICE_COMPLETE=TelemetryPropertyNames.FEATURE_NAME+"InitGuestChannelServiceComplete",TelemetryPropertyNames.INIT_GUEST_NOTEBOOKS_SERVICE_COMPLETE=TelemetryPropertyNames.FEATURE_NAME+"InitGuestNotebooksServiceComplete",TelemetryPropertyNames.INIT_SOURCE_CONTROL_SERVICE_COMPLETE=TelemetryPropertyNames.FEATURE_NAME+"InitSourceControlServiceComplete",TelemetryPropertyNames.INIT_COMMENT_SERVICE_COMPLETE=TelemetryPropertyNames.FEATURE_NAME+"InitCommentServiceComplete",TelemetryPropertyNames.INIT_SYNC_SERVICE_COMPLETE=TelemetryPropertyNames.FEATURE_NAME+"InitSyncServiceComplete",TelemetryPropertyNames.INIT_FILE_SERVICE_COMPLETE=TelemetryPropertyNames.FEATURE_NAME+"InitFileServiceComplete",TelemetryPropertyNames.INIT_HOST_NOTEBOOKS_SERVICE_COMPLETE=TelemetryPropertyNames.FEATURE_NAME+"InitHostNotebooksServiceComplete",TelemetryPropertyNames.INIT_COMMENT_MANAGER_COMPLETE=TelemetryPropertyNames.FEATURE_NAME+"InitCommentManagerComplete",TelemetryPropertyNames.INIT_COMMAND_COMPLETE=TelemetryPropertyNames.FEATURE_NAME+"InitCommandComplete",TelemetryPropertyNames.INIT_PATH_MANAGER_COMPLETE=TelemetryPropertyNames.FEATURE_NAME+"InitPathManagerComplete",TelemetryPropertyNames.REJECTED_BY_HOST=TelemetryPropertyNames.FEATURE_NAME+"RejectedByHost",TelemetryPropertyNames.REJECTED_BY_HOST_AS_ANONYMOUS=TelemetryPropertyNames.FEATURE_NAME+"RejectedByHostAsAnonymous",TelemetryPropertyNames.JOIN_REQUEST_TIMED_OUT=TelemetryPropertyNames.FEATURE_NAME+"JoinRequestTimedOut",TelemetryPropertyNames.WORKSPACE_NOT_FOUND=TelemetryPropertyNames.FEATURE_NAME+"WorkspaceNotFound",TelemetryPropertyNames.UNAUTHORIZED=TelemetryPropertyNames.FEATURE_NAME+"Unauthorized",TelemetryPropertyNames.RELOAD_START_TIME=TelemetryPropertyNames.FEATURE_NAME+"ReloadStartTime",TelemetryPropertyNames.RELOAD_RESUMED_TIME=TelemetryPropertyNames.FEATURE_NAME+"ReloadResumedTime",TelemetryPropertyNames.RELOAD_END_TIME=TelemetryPropertyNames.FEATURE_NAME+"ReloadEndTime",TelemetryPropertyNames.JOIN_WORKSPACE_COMPLETE=TelemetryPropertyNames.FEATURE_NAME+"JoinWorkspaceComplete",TelemetryPropertyNames.SERVICE_ENDPOINT=TelemetryPropertyNames.FEATURE_NAME+"ServiceEndpoint",TelemetryPropertyNames.IS_HOST=TelemetryPropertyNames.FEATURE_NAME+"IsHost",TelemetryPropertyNames.IS_READONLY_SESSION=TelemetryPropertyNames.FEATURE_NAME+"IsReadOnlySession",TelemetryPropertyNames.CREATE_WORKSPACE=TelemetryPropertyNames.FEATURE_NAME+"CreateWorkspace",TelemetryPropertyNames.CREATE_PLANNED_SESSION=TelemetryPropertyNames.FEATURE_NAME+"CreatePlannedSession",TelemetryPropertyNames.DELETE_PLANNED_SESSION=TelemetryPropertyNames.FEATURE_NAME+"DeletePlannedSession",TelemetryPropertyNames.RENAME_PLANNED_SESSION=TelemetryPropertyNames.FEATURE_NAME+"RenamePlannedSession",TelemetryPropertyNames.LIST_PLANNED_SESSION=TelemetryPropertyNames.FEATURE_NAME+"ListPlannedSession",TelemetryPropertyNames.COPY_PLANNED_SESSION_LINK=TelemetryPropertyNames.FEATURE_NAME+"CopyPlannedSessionLink",TelemetryPropertyNames.JOIN_PLANNED_SESSION=TelemetryPropertyNames.FEATURE_NAME+"JoinPlannedSession",TelemetryPropertyNames.PERSISTENT_WORKSPACE_EXISTS=TelemetryPropertyNames.FEATURE_NAME+"PersistentWorkspaceExists",TelemetryPropertyNames.SHARE_FROM_CREATE_WORKSPACE=TelemetryPropertyNames.FEATURE_NAME+"ShareFromCreateWorkspace",TelemetryPropertyNames.COPYLINK_FROM_CREATE_WORKSPACE=TelemetryPropertyNames.FEATURE_NAME+"CopyLinkFromCreateWorkspace",TelemetryPropertyNames.MOREINFO_FROM_CREATE_WORKSPACE=TelemetryPropertyNames.FEATURE_NAME+"MoreInfoFromCreateWorkspace",TelemetryPropertyNames.CONVERSATION_ID=TelemetryPropertyNames.FEATURE_NAME_V2+"ConversationId",TelemetryPropertyNames.VERSION_PLATFORMNAME=TelemetryPropertyNames.FEATURE_NAME+"Version.PlatformName",TelemetryPropertyNames.VERSION_PLATFORMVERSION=TelemetryPropertyNames.FEATURE_NAME+"Version.PlatformVersion",TelemetryPropertyNames.VERSION_PLATFORMVERSION_SERVICEPACK=TelemetryPropertyNames.FEATURE_NAME+"Version.PlatformVersion.ServicePack",TelemetryPropertyNames.FAULT_TYPE=TelemetryPropertyNames.FEATURE_NAME+"FaultType",TelemetryPropertyNames.ENVIRONMENT_VECTOR=TelemetryPropertyNames.FEATURE_NAME+"EnvironmentVector",TelemetryPropertyNames.PERFORMANCE_RUN=TelemetryPropertyNames.FEATURE_NAME+"PerformanceRun",TelemetryPropertyNames.CURRENT_STATE=TelemetryPropertyNames.FEATURE_NAME+"CurrentState",TelemetryPropertyNames.NEXT_STATE=TelemetryPropertyNames.FEATURE_NAME+"NextState",TelemetryPropertyNames.TRANSITION_ACTION=TelemetryPropertyNames.FEATURE_NAME+"TransitionAction",TelemetryPropertyNames.EXTENSION_ACTIVATION_INITIAL_INIT_COMPLETE=TelemetryPropertyNames.FEATURE_NAME+"ExtensionActivationInitialInitComplete",TelemetryPropertyNames.EXTENSION_ACTIVATION_COMPAT_CHECK_COMPLETE=TelemetryPropertyNames.FEATURE_NAME+"ExtensionActivationCompatCheckComplete",TelemetryPropertyNames.EXTENSION_ACTIVATION_AGENT_PROCESS_SETUP_COMPLETE=TelemetryPropertyNames.FEATURE_NAME+"ExtensionActivationAgentProcessSetupComplete",TelemetryPropertyNames.EXTENSION_ACTIVATION_POST_JOIN=TelemetryPropertyNames.FEATURE_NAME+"ActivatedPostJoin",TelemetryPropertyNames.JOIN_FROM_BROWSER=TelemetryPropertyNames.FEATURE_NAME+"JoinFromBrowser",TelemetryPropertyNames.JOIN_DEBUG_SESSION_OPTION=TelemetryPropertyNames.FEATURE_NAME+"JoinDebugSessionOption",TelemetryPropertyNames.IS_FIRST_ACTIVATION=TelemetryPropertyNames.FEATURE_NAME+"IsFirstActivation",TelemetryPropertyNames.IS_FIRST_EXTENSION_RUN=TelemetryPropertyNames.FEATURE_NAME+"IsFirstExtensionRun",TelemetryPropertyNames.IS_ELECTRON_DEPENDENCY_SHOULD_BE_INSTALLED=TelemetryPropertyNames.FEATURE_NAME+"IsElectronDependencyShouldBeInstalled",TelemetryPropertyNames.IS_ELECTRON_DEPENDENCY_INSTALLED=TelemetryPropertyNames.FEATURE_NAME+"IsElectronDependencyInstalled",TelemetryPropertyNames.IS_RUNTIME_DEPENDENCIES_INSTALLED=TelemetryPropertyNames.FEATURE_NAME+"IsRuntimeDependenciesInstalled",TelemetryPropertyNames.IS_EXTENSION_BEING_UPDATED=TelemetryPropertyNames.FEATURE_NAME+"isExtensionBeingUpdated",TelemetryPropertyNames.IS_EXTENSION_PACK_CANDIDATE_PRESENT=TelemetryPropertyNames.FEATURE_NAME+"isExtensionPackCandidatePresent",TelemetryPropertyNames.SHOWED_INITIAL_INSTALL_INFO_PAGE=TelemetryPropertyNames.FEATURE_NAME+"ShowedInitialInstallInfoPage",TelemetryPropertyNames.INITIAL_INSTALL_INFO_PAGE_EXPERIMENT_OPEN_BY_DEFAULT=TelemetryPropertyNames.FEATURE_NAME+"InitialInstallInfoPageExperimentOpenByDefault",TelemetryPropertyNames.NAME_TAG_VISIBILITY=TelemetryPropertyNames.FEATURE_NAME+"NameTagVisibility",TelemetryPropertyNames.NUM_DEBUGGING_PROCESSES=TelemetryPropertyNames.FEATURE_NAME+"NumDebuggingProcesses",TelemetryPropertyNames.DEBUG_PROMPT=TelemetryPropertyNames.FEATURE_NAME+"DebugPrompt",TelemetryPropertyNames.NUM_OPEN_FILES=TelemetryPropertyNames.FEATURE_NAME+"NumOpenFiles",TelemetryPropertyNames.IS_INTERNAL=TelemetryPropertyNames.FEATURE_NAME+"IsInternal",TelemetryPropertyNames.IS_CLOUD_ENVIRONMENT=TelemetryPropertyNames.FEATURE_NAME+"IsCloudEnvironment",TelemetryPropertyNames.USER_TEAM_STATUS=TelemetryPropertyNames.FEATURE_NAME+"UserTeamStatus",TelemetryPropertyNames.CONNECTION_MODE=TelemetryPropertyNames.FEATURE_NAME+"ConnectionMode",TelemetryPropertyNames.CONNECTION_MODE_USED=TelemetryPropertyNames.FEATURE_NAME+"ConnectionModeUsed",TelemetryPropertyNames.CREATED_AT=TelemetryPropertyNames.FEATURE_NAME+"CreatedAt",TelemetryPropertyNames.UPDATED_AT=TelemetryPropertyNames.FEATURE_NAME+"UpdatedAt",TelemetryPropertyNames.EXPIRES_AT=TelemetryPropertyNames.FEATURE_NAME+"ExpiresAt",TelemetryPropertyNames.PROGRESS_DURATION=TelemetryPropertyNames.FEATURE_NAME+"ProgressDuration",TelemetryPropertyNames.AGENT_START_INITAL_DATA=TelemetryPropertyNames.FEATURE_NAME+"InitialData",TelemetryPropertyNames.AGENT_START_RESOLVED_STATE=TelemetryPropertyNames.FEATURE_NAME+"ResolvedState",TelemetryPropertyNames.AGENT_START_PROCESS_SPAWN_COMMAND_SENT=TelemetryPropertyNames.FEATURE_NAME+"ProcessSpawnCommandSent",TelemetryPropertyNames.AGENT_START_CONNECTION_RETRY_COUNT=TelemetryPropertyNames.FEATURE_NAME+"RetryCount",TelemetryPropertyNames.AGENT_START_CONNECTION_URI_PROTOCOL=TelemetryPropertyNames.FEATURE_NAME+"UriProtocol",TelemetryPropertyNames.AGENT_START_CONNECTION_OWNER=TelemetryPropertyNames.FEATURE_NAME+"Owner",TelemetryPropertyNames.AGENT_WAS_DOWNLOAD_CORRUPTED=TelemetryPropertyNames.FEATURE_NAME+"WasDownloadCorrupted",TelemetryPropertyNames.CLIENT_LOG_LINES=TelemetryPropertyNames.FEATURE_NAME+"ClientLogLines",TelemetryPropertyNames.AGENT_LOG_LINES=TelemetryPropertyNames.FEATURE_NAME+"AgentLogLines",TelemetryPropertyNames.FEATURE_FLAGS=TelemetryPropertyNames.FEATURE_NAME+"FeatureFlags",TelemetryPropertyNames.EXTENSION_REQUESTED_API_VERSION=TelemetryPropertyNames.FEATURE_NAME+"ExtensionRequestedApiVersion",TelemetryPropertyNames.EXTENSION_NAME=TelemetryPropertyNames.FEATURE_NAME+"ExtensionName",TelemetryPropertyNames.EXTENSION_VERSION=TelemetryPropertyNames.FEATURE_NAME+"ExtensionVersion",TelemetryPropertyNames.EXTENSION_INVOKED_COMMAND=TelemetryPropertyNames.FEATURE_NAME+"ExtensionInvokedCommand",TelemetryPropertyNames.EXTENSION_INVOKED_COMMAND_OPTIONS=TelemetryPropertyNames.FEATURE_NAME+"ExtensionInvokedCommandOptions",TelemetryPropertyNames.EXTENSION_SERVICE_NAME=TelemetryPropertyNames.FEATURE_NAME+"ExtensionServiceName",TelemetryPropertyNames.EXTENSION_SERVICE_PERMITTED=TelemetryPropertyNames.FEATURE_NAME+"ExtensionServicePermitted",TelemetryPropertyNames.START_WAITING_FOR_HOST=TelemetryPropertyNames.FEATURE_NAME+"StartWaitingForHost",TelemetryPropertyNames.DONE_WAITING_FOR_HOST=TelemetryPropertyNames.FEATURE_NAME+"DoneWaitingForHost",TelemetryPropertyNames.RECONNECTING_TO_HOST=TelemetryPropertyNames.FEATURE_NAME+"ReconnectingToHost",TelemetryPropertyNames.RECONNECTED_TO_HOST=TelemetryPropertyNames.FEATURE_NAME+"ReconnectedToHost",TelemetryPropertyNames.GUEST_CANCELED=TelemetryPropertyNames.FEATURE_NAME+"GuestCanceled",TelemetryPropertyNames.TRANSITION_SEQUENCE=TelemetryPropertyNames.FEATURE_NAME+"TransitionSequence",TelemetryPropertyNames.TIME_SINCE_LAST_TRANSITION=TelemetryPropertyNames.FEATURE_NAME+"TimeSinceLastTransition",TelemetryPropertyNames.GUESTS_BY_IDE=TelemetryPropertyNames.FEATURE_NAME+"GuestsByIDE",TelemetryPropertyNames.DISTINCT_GUESTS_BY_IDE=TelemetryPropertyNames.FEATURE_NAME+"DistinctGuestsByIDE",TelemetryPropertyNames.ACTIVE_COLLABORATION_DURATION=TelemetryPropertyNames.FEATURE_NAME+"ActiveCollaborationDuration",TelemetryPropertyNames.ACTIVE_COLLABORATION_BLOCKS=TelemetryPropertyNames.FEATURE_NAME+"ActiveCollaborationBlocks",TelemetryPropertyNames.FILE_NAME=TelemetryPropertyNames.FEATURE_NAME+"FileName",TelemetryPropertyNames.RELOAD_POST_TIMEOUT=TelemetryPropertyNames.FEATURE_NAME+"ReloadPostTimeout",TelemetryPropertyNames.SHARED_TERMINAL_SHELL=TelemetryPropertyNames.FEATURE_NAME+"SharedTerminalShell",TelemetryPropertyNames.SHARED_TERMINAL_READONLY=TelemetryPropertyNames.FEATURE_NAME+"SharedTerminalReadOnly",TelemetryPropertyNames.IS_ALTERNATE_SHARE_BUTTON_TEXT=TelemetryPropertyNames.FEATURE_NAME+"AlternateShareButtonText",TelemetryPropertyNames.COMMAND_AUTH_RETRY_COUNT=TelemetryPropertyNames.FEATURE_NAME+"CommandAuthRetryCount",TelemetryPropertyNames.COMMAND_DID_AUTH=TelemetryPropertyNames.FEATURE_NAME+"CommandDidAuth",TelemetryPropertyNames.COMMAND_ALLOWS_ANONYMOUS=TelemetryPropertyNames.FEATURE_NAME+"COMMAND_ALLOWS_ANONYMOUS",TelemetryPropertyNames.COMMAND_SHOULED_SKIP_ANONYMOUS_PROMPT=TelemetryPropertyNames.FEATURE_NAME+"CommandShouldSkipAnonymousPrompt",TelemetryPropertyNames.COMMAND_DID_AUTH_FULL=TelemetryPropertyNames.FEATURE_NAME+"CommandDidAuthFull",TelemetryPropertyNames.COMMAND_AUTO_AUTHED_ANONYMOUSLY_BUT_ANONYMOUS_NOT_ALLOWED=TelemetryPropertyNames.FEATURE_NAME+"CommandAutoAuthedAnonymouslyButAnonymousNotAllowed",TelemetryPropertyNames.COMMAND_AUTO_AUTHED_RESULT=TelemetryPropertyNames.FEATURE_NAME+"CommandAutoAuthedResult",TelemetryPropertyNames.COMMAND_STARTED_UNAUTHENTICATED=TelemetryPropertyNames.FEATURE_NAME+"CommandStartedUnauthenticated",TelemetryPropertyNames.COMMAND_SHOULD_SHOW_ANONYMOUS_TOAST=TelemetryPropertyNames.FEATURE_NAME+"CommandShouldShowAnonymousToast",TelemetryPropertyNames.COMMAND_STARTED_BLOCKING_AUTH=TelemetryPropertyNames.FEATURE_NAME+"CommandStartedBlockingAuth",TelemetryPropertyNames.COMMAND_BLOCKING_ANONYMOUS_LOGIN_FLOW_RESULT=TelemetryPropertyNames.FEATURE_NAME+"CommandBlockingAnonymousLoginFlowResult",TelemetryPropertyNames.COMMAND_BLOCKING_NON_ANONYMOUS_LOGIN_FLOW_RESULT=TelemetryPropertyNames.FEATURE_NAME+"CommandBlockingNonAnonymousLoginFlowResult",TelemetryPropertyNames.COMMAND_AUTH_PROMPT_QUESTION_RESULT=TelemetryPropertyNames.FEATURE_NAME+"CommandAuthPromptQuestionResult",TelemetryPropertyNames.COMMAND_AUTH_PROMPT_OPENED=TelemetryPropertyNames.FEATURE_NAME+"CommandAuthPromptOpened",TelemetryPropertyNames.USER_OPTED_OUT_TO_AUTH_ON_JOIN=TelemetryPropertyNames.FEATURE_NAME+"UserOptedOutToAuthOnJoin",TelemetryPropertyNames.USER_PICKED_NAME_LENGTH=TelemetryPropertyNames.FEATURE_NAME+"UserPickedNameLength",TelemetryPropertyNames.USER_PICKED_DEFAULT_NAME=TelemetryPropertyNames.FEATURE_NAME+"UserPickedDefaultName",TelemetryPropertyNames.COMMAND_COMPLETED_AUTH_FULL=TelemetryPropertyNames.FEATURE_NAME+"CommandCompleteAuthFull",TelemetryPropertyNames.MORE_INFO_CLICKED=TelemetryPropertyNames.FEATURE_NAME+"MoreInfoClicked",TelemetryPropertyNames.ZEROUSER_SESSION_REASON=TelemetryPropertyNames.FEATURE_NAME+"ZeroUserSessionReason",TelemetryPropertyNames.DEBUGGING_STARTED_WORKSPACE_FOLDER=TelemetryPropertyNames.FEATURE_NAME+"DebuggingStartedForWorkspaceFolder",TelemetryPropertyNames.DEBUGGING_STARTED_WORKSPACE_FOLDER_COUNT=TelemetryPropertyNames.FEATURE_NAME+"DebuggingWorkspaceFolderCount",TelemetryPropertyNames.OPERATION_NAME=TelemetryPropertyNames.FEATURE_NAME+"OperationName",TelemetryPropertyNames.OPERATION_ACCESS=TelemetryPropertyNames.FEATURE_NAME+"OperationAccess",TelemetryPropertyNames.REJECTION_REASON=TelemetryPropertyNames.FEATURE_NAME+"RejectionReason",TelemetryPropertyNames.SETTING_VALUES=TelemetryPropertyNames.FEATURE_NAME+"Settings",TelemetryPropertyNames.USER_DISMISSED_SIGN_IN_MODAL=TelemetryPropertyNames.FEATURE_NAME+"UserDismissedSignInModal",TelemetryPropertyNames.SIGN_IN_MODAL_URL_CHANGES=TelemetryPropertyNames.FEATURE_NAME+"SignInModalURLChanges",TelemetryPropertyNames.SESSION_ID=TelemetryPropertyNames.FEATURE_NAME+"LiveShareSessionId",TelemetryPropertyNames.RELOAD_SELECTED=TelemetryPropertyNames.FEATURE_NAME+"UserSelectedReload",TelemetryPropertyNames.INIT_SEARCHPROVIDER_COMPLETE=TelemetryPropertyNames.FEATURE_NAME+"InitSearchProviderComplete",TelemetryPropertyNames.ADD_ADDITIONALROOTS_COMPLETE=TelemetryPropertyNames.FEATURE_NAME+"AddAdditionalRootsComplete",TelemetryPropertyNames.JOIN_WITHOUT_RELOAD=TelemetryPropertyNames.FEATURE_NAME+"JoinWithoutReload",TelemetryPropertyNames.JOIN_FROM_PROTOCOL_HANDLER=TelemetryPropertyNames.FEATURE_NAME+"JoinFromProtocolHandler",TelemetryPropertyNames.JOIN_FROM_INVITE_LINK=TelemetryPropertyNames.FEATURE_NAME+"JoinFromInviteLink",TelemetryPropertyNames.URI=TelemetryPropertyNames.FEATURE_NAME+"Uri",TelemetryPropertyNames.JOIN_CORRELATION_ID=TelemetryPropertyNames.FEATURE_NAME+"JoinCorrelationId",TelemetryPropertyNames.SIGN_IN_RETRIES=TelemetryPropertyNames.FEATURE_NAME+"SignInRetries",TelemetryPropertyNames.EMPTY_WORKSPACE_FOLDERS_OPENED=TelemetryPropertyNames.FEATURE_NAME+"EmptyWorkspaceFoldersOpened",TelemetryPropertyNames.AUTO_SHARING_ON_LOAD=TelemetryPropertyNames.FEATURE_NAME+"AutoSharingOnLoad",TelemetryPropertyNames.STATE_EVENT_FIRST=TelemetryPropertyNames.FEATURE_NAME+"StateEventFirst",TelemetryPropertyNames.STATE_EVENT_LAST=TelemetryPropertyNames.FEATURE_NAME+"StateEventLast",TelemetryPropertyNames.STATE_EVENT_ORDER=TelemetryPropertyNames.FEATURE_NAME+"StateEventOrder",TelemetryPropertyNames.STATUS_EVENT_ORDER=TelemetryPropertyNames.FEATURE_NAME+"StatusEventOrder",TelemetryPropertyNames.EXTERNAL_SIGNIN_STARTING=TelemetryPropertyNames.FEATURE_NAME+"ExternalSignInStarting",TelemetryPropertyNames.EXTERNAL_SIGNIN_USER_MADE_VENDOR_CHOICE=TelemetryPropertyNames.FEATURE_NAME+"ExternalSignInUserMadeVendorChoice",TelemetryPropertyNames.EXTERNAL_SIGNIN_USER_COMPLETE_FLOW=TelemetryPropertyNames.FEATURE_NAME+"ExternalSignInUserCompleteFlow",TelemetryPropertyNames.EXTERNAL_SIGNIN_USER_COMPLETE_FLOW_TOKEN_SET=TelemetryPropertyNames.FEATURE_NAME+"ExternalSignInUserCompleteFlowTokenSet",TelemetryPropertyNames.BROWSER_NAME=TelemetryPropertyNames.FEATURE_NAME+"BrowserName",TelemetryPropertyNames.BROWSER_VERSION=TelemetryPropertyNames.FEATURE_NAME+"BrowserVersion",TelemetryPropertyNames.EXTERNAL_SIGNIN_SELECTED_VENDOR=TelemetryPropertyNames.FEATURE_NAME+"ExternalSignInSelectedVendor",TelemetryPropertyNames.EXTERNAL_SIGNIN_COMPLETE=TelemetryPropertyNames.FEATURE_NAME+"ExternalSignInComplete",TelemetryPropertyNames.ATTEMPT_DEFAULT_LOGIN_STARTING=TelemetryPropertyNames.FEATURE_NAME+"AttemptDefaultLoginStarting",TelemetryPropertyNames.ATTEMPT_DEFAULT_LOGIN_COMPLETE=TelemetryPropertyNames.FEATURE_NAME+"AttemptDefaultLoginComplete",TelemetryPropertyNames.ATTEMPT_LOGIN_STARTING=TelemetryPropertyNames.FEATURE_NAME+"AttemptLoginStarting",TelemetryPropertyNames.ATTEMPT_LOGIN_COMPLETE=TelemetryPropertyNames.FEATURE_NAME+"AttemptLoginComplete",TelemetryPropertyNames.ATTEMPT_ANONYMOUS_LOGIN_STARTING=TelemetryPropertyNames.FEATURE_NAME+"AttemptAnonymousLoginStarting",TelemetryPropertyNames.ATTEMPT_ANONYMOUS_LOGIN_COMPLETE=TelemetryPropertyNames.FEATURE_NAME+"AttemptAnonymousLoginComplete",TelemetryPropertyNames.SILENT_NATIVE_LOGIN_STARTING=TelemetryPropertyNames.FEATURE_NAME+"SilentNativeLoginStarting",TelemetryPropertyNames.SILENT_NATIVE_LOGIN_RESULT=TelemetryPropertyNames.FEATURE_NAME+"SilentNativeLoginResult",TelemetryPropertyNames.SILENT_NATIVE_LOGIN_SIGNED_IN_WITH_NATIVE_PROVIDER=TelemetryPropertyNames.FEATURE_NAME+"SilentNativeLoginSignedInWithNativeProvider",TelemetryPropertyNames.SILENT_NATIVE_LOGIN_AUTH_PROVIDER=TelemetryPropertyNames.FEATURE_NAME+"SilentNativeLoginAuthProvider",TelemetryPropertyNames.SILENT_NATIVE_LOGIN_SIGNED_IN_AS_ANONYMOUS=TelemetryPropertyNames.FEATURE_NAME+"SilentNativeLoginSignedInAsAnonymous",TelemetryPropertyNames.SILENT_NATIVE_LOGIN_ATTEMPTING_ANONYMOUS_STRATEGY=TelemetryPropertyNames.FEATURE_NAME+"SilentNativeLoginAttemptingAnonymousStrategy",TelemetryPropertyNames.SILENT_NATIVE_LOGIN_IS_ANONYMOUS_TOKEN_SET=TelemetryPropertyNames.FEATURE_NAME+"SilentNativeLoginIsAnonymousTokenSet",TelemetryPropertyNames.PROMPTED_NATIVE_LOGIN_STARTING=TelemetryPropertyNames.FEATURE_NAME+"PromptedNativeLoginStarting",TelemetryPropertyNames.PROMPTED_NATIVE_LOGIN_RESULT=TelemetryPropertyNames.FEATURE_NAME+"PromptedNativeLoginResult",TelemetryPropertyNames.PROMPTED_NATIVE_LOGIN_THE_USER_CANCELED_AUTH_PROVIDER_PICK=TelemetryPropertyNames.FEATURE_NAME+"PromptedNativeLoginTheUserCanceledAuthProviderPick",TelemetryPropertyNames.PROMPTED_NATIVE_LOGIN_CANCELED_VIA_CANCELLATION_TOKEN=TelemetryPropertyNames.FEATURE_NAME+"PromptedNativeLoginCancelledViaCancellationToken",TelemetryPropertyNames.PROMPTED_NATIVE_LOGIN_SELECTED_AUTH_PROVIDER=TelemetryPropertyNames.FEATURE_NAME+"PromptedNativeLoginSelectedAuthProvider",TelemetryPropertyNames.PROMPTED_NATIVE_LOGIN_FAILED_TO_ACQUIRE_AUTH_TOKEN=TelemetryPropertyNames.FEATURE_NAME+"PromptedNativeLoginFailedToAcquireAuthToken",TelemetryPropertyNames.LOGIN_IS_NATIVE=TelemetryPropertyNames.FEATURE_NAME+"IsNative",TelemetryPropertyNames.LOGIN_RESULT=TelemetryPropertyNames.FEATURE_NAME+"Result",TelemetryPropertyNames.LOGIN_IS_CANCELED=TelemetryPropertyNames.FEATURE_NAME+"AuthCanceled",TelemetryPropertyNames.TRY_LOAD_SESSION_RESULT=TelemetryPropertyNames.FEATURE_NAME+"Result",TelemetryPropertyNames.VSCODE_ERROR_CALL_STACK=TelemetryPropertyNames.FEATURE_NAME+"VscodeErrorCallStack",TelemetryPropertyNames.SIGNIN_STARTING=TelemetryPropertyNames.FEATURE_NAME+"SigninStarting",TelemetryPropertyNames.SIGNIN_PROMPT_STARTING=TelemetryPropertyNames.FEATURE_NAME+"SigninPromptStarting",TelemetryPropertyNames.SIGNIN_PROMPT_COMPLETED=TelemetryPropertyNames.FEATURE_NAME+"SigninPromptCompleted",TelemetryPropertyNames.SIGNIN_COMPLETED=TelemetryPropertyNames.FEATURE_NAME+"SigninCompleted",TelemetryPropertyNames.SIGNIN_COMPLETED_ERROR=TelemetryPropertyNames.FEATURE_NAME+"SigninCompletedError",TelemetryPropertyNames.SIGNIN_COMPLETED_CANCEL=TelemetryPropertyNames.FEATURE_NAME+"SigninCompletedCancel",TelemetryPropertyNames.SIGNIN_CHECK_STARTING=TelemetryPropertyNames.FEATURE_NAME+"SigninCheckStarting",TelemetryPropertyNames.SIGNIN_CHECK_COMPLETED=TelemetryPropertyNames.FEATURE_NAME+"SigninCheckCompleted",TelemetryPropertyNames.SIGNIN_CHECK_COMPLETED_ERROR=TelemetryPropertyNames.FEATURE_NAME+"SigninCheckCompletedError",TelemetryPropertyNames.SIGNIN_CHECK_COMPLETED_CANCEL=TelemetryPropertyNames.FEATURE_NAME+"SigninCheckCompletedCancel",TelemetryPropertyNames.WELCOME_PAGE_LINK=TelemetryPropertyNames.FEATURE_NAME+"WelcomePageLink",TelemetryPropertyNames.SHARE_INIT_WORKSPACE_FOLDERS_COUNT=TelemetryPropertyNames.FEATURE_NAME+"ShareInitWorkspaceFoldersCount",TelemetryPropertyNames.CURRENT_AB_EXPERIMENT=TelemetryPropertyNames.FEATURE_NAME+"CurrentAbExperiment",TelemetryPropertyNames.CURRENT_AB_TESTER_VERSION=TelemetryPropertyNames.FEATURE_NAME+"CurrentAbTesterVersion",TelemetryPropertyNames.CURRENT_AB_EXPERIMENT_GROUP=TelemetryPropertyNames.FEATURE_NAME+"CurrentAbExperimentGroup",TelemetryPropertyNames.COUNT_OF_CONCURRENT_AB_EXPERIMENTS=TelemetryPropertyNames.FEATURE_NAME+"CountOfConcurrentAbExperiments",TelemetryPropertyNames.FIRST_LIVESHARE_ACTIVATION=TelemetryPropertyNames.FEATURE_NAME+"FirstLiveShareActivation",TelemetryPropertyNames.SELECTED_FOR_ELECTRON_AUTH_MODAL_EXPERIMENT=TelemetryPropertyNames.FEATURE_NAME+"SelectedForElectronAuthModalExperiment",TelemetryPropertyNames.AUTH_ELECTRON_MODAL_USED=TelemetryPropertyNames.FEATURE_NAME+"AuthElectronModalUsed",TelemetryPropertyNames.AUTH_ELECTRON_MODAL_EXCEPTION=TelemetryPropertyNames.FEATURE_NAME+"AuthElectronModalException",TelemetryPropertyNames.RECOVER_ROOT_FOLDER=TelemetryPropertyNames.FEATURE_NAME+"RecoverRootFolder",TelemetryPropertyNames.SAMPLE_RATE=TelemetryPropertyNames.FEATURE_NAME+"SampleRate",TelemetryPropertyNames.DEFAULT_SIGN_IN=TelemetryPropertyNames.FEATURE_NAME+"DefaultSignIn",TelemetryPropertyNames.EVALUATED_EXPERIMENT_NAME=TelemetryPropertyNames.FEATURE_NAME+"evaluated-experiment-name",TelemetryPropertyNames.EVALUATED_EXPERIMENT_GROUP=TelemetryPropertyNames.FEATURE_NAME+"evaluated-experiment-group",TelemetryPropertyNames.INVITE_CONTACT_TYPE=TelemetryPropertyNames.FEATURE_NAME+"InviteContactType",TelemetryPropertyNames.TOAST_RESULT=TelemetryPropertyNames.FEATURE_NAME+"ToastResult",TelemetryPropertyNames.TOKEN_EXPIRED_DAYS=TelemetryPropertyNames.FEATURE_NAME+"TokenExpiredDays",TelemetryPropertyNames.WAIT_FOR_HOST_PROMPT=TelemetryPropertyNames.FEATURE_NAME+"WaitForHostPrompt",TelemetryPropertyNames.RETRY_JOIN=TelemetryPropertyNames.FEATURE_NAME+"RetryJoin",TelemetryPropertyNames.AUTH_CANCEL_WAIT_FOR_CODE=TelemetryPropertyNames.FEATURE_NAME+"AuthCancelWaitingForExternalCode",TelemetryPropertyNames.AUTH_CANCEL_BROWSER_CANCEL=TelemetryPropertyNames.FEATURE_NAME+"AuthCancelBrowserOperationCancelled",TelemetryPropertyNames.AUTH_CANCEL_NO_TOKEN_USER_CANCELLED=TelemetryPropertyNames.FEATURE_NAME+"AuthCancelNoTokenOrUserCancelled",TelemetryPropertyNames.AUTH_CANCEL_NO_ANON_AUTH=TelemetryPropertyNames.FEATURE_NAME+"AuthCancelNoAnonAuth",TelemetryPropertyNames.AUTH_CANCEL_ANONYMOUS_LOGIN_FLOW=TelemetryPropertyNames.FEATURE_NAME+"AuthCancelAnonymousLoginFlow",TelemetryPropertyNames.CREATE_INVITATION_LINK=TelemetryPropertyNames.FEATURE_NAME+"CreateInvitationLink",TelemetryPropertyNames.INSTALL_RECOVERY_SOURCE=TelemetryPropertyNames.FEATURE_NAME+"install-recovery-source",TelemetryPropertyNames.INSTALL_RECOVERY_TOAST_RESULT=TelemetryPropertyNames.FEATURE_NAME+"install-recovery-toast-result",TelemetryPropertyNames.INSTALL_RECOVERY_RELOAD=TelemetryPropertyNames.FEATURE_NAME+"install-recovery-reload",TelemetryPropertyNames.INSTALL_RECOVERY_CANCELED=TelemetryPropertyNames.FEATURE_NAME+"install-recovery-canceled",TelemetryPropertyNames.INSTALL_RECOVERY_RETRY=TelemetryPropertyNames.FEATURE_NAME+"install-recovery-retry",TelemetryPropertyNames.INSTALL_RECOVERY_RETRY_CANCELED=TelemetryPropertyNames.FEATURE_NAME+"install-recovery-retry-canceled",TelemetryPropertyNames.INSTALL_RECOVERY_DISABLED=TelemetryPropertyNames.FEATURE_NAME+"install-recovery-disabled",TelemetryPropertyNames.DELETE_DEPENDENCIES_DOWNLOAD_FILE=TelemetryPropertyNames.FEATURE_NAME+"delete-dependencies-download-file",TelemetryPropertyNames.DELETE_DEPENDENCIES_INSTALLED_FILE=TelemetryPropertyNames.FEATURE_NAME+"reinstall-dependencies-installed-file",TelemetryPropertyNames.DELETE_DEPENDENCIES_CLEAN_INSTALL_PATH=TelemetryPropertyNames.FEATURE_NAME+"reinstall-dependencies-clean-install-path",TelemetryPropertyNames.SELECTED_ACTION=TelemetryPropertyNames.FEATURE_NAME+"SelectedAction",TelemetryPropertyNames.AUDIO_DEVICE_TYPE=TelemetryPropertyNames.FEATURE_NAME+"AudioDeviceType",TelemetryPropertyNames.AUDIO_SESSION_STATE=TelemetryPropertyNames.FEATURE_NAME+"AudioSessionState",TelemetryPropertyNames.AUDIO_SESSION_ACTION=TelemetryPropertyNames.FEATURE_NAME+"AudioSessionAction",TelemetryPropertyNames.CHAT_IS_DIRECT_MESSAGE=TelemetryPropertyNames.FEATURE_NAME+"ChatIsDirectMessage",TelemetryPropertyNames.CHAT_DISABLED_MESSAGE_KEY=TelemetryPropertyNames.FEATURE_NAME+"ChatDisabledMessageKey",TelemetryPropertyNames.CHAT_NOTIFY_TYPE=TelemetryPropertyNames.FEATURE_NAME+"ChatNotifyType",TelemetryPropertyNames.CHAT_COMMAND=TelemetryPropertyNames.FEATURE_NAME+"ChatCommand",TelemetryPropertyNames.CHAT_ISDISABLED=TelemetryPropertyNames.FEATURE_NAME+"ChatIsDisabled",TelemetryPropertyNames.CHAT_ISCONNECTED=TelemetryPropertyNames.FEATURE_NAME+"ChatIsConnected",TelemetryPropertyNames.PLANNED_SESSIONS_LIST_SIZE=TelemetryPropertyNames.FEATURE_NAME+"PlannedSessionsListSize",TelemetryPropertyNames.ACCEPTED=TelemetryPropertyNames.FEATURE_NAME+"Accepted",TelemetryPropertyNames.READONLY=TelemetryPropertyNames.FEATURE_NAME+"Readonly",TelemetryPropertyNames.IS_ANONYMOUS_ELEVATED=TelemetryPropertyNames.FEATURE_NAME+"IsAnonymousElevated",TelemetryPropertyNames.EDITOR_SELECTION=TelemetryPropertyNames.FEATURE_NAME+"EditorSelection",TelemetryPropertyNames.IS_AGENTLESS=TelemetryPropertyNames.FEATURE_NAME+"IsAgentless",function(h){h[h.StatusBar=0]="StatusBar",h[h.Command=1]="Command"}(m.TelemetryEventOrigin||(m.TelemetryEventOrigin={}))},function(h,m){h.exports=require("os")},function(h,m){h.exports=require("stream")},function(h,m){h.exports=require("url")},function(h,m){h.exports=require("fs")},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0}),function(h){h[h.Initializing=0]="Initializing",h[h.SignedOut=1]="SignedOut",h[h.SigningIn=2]="SigningIn",h[h.ExternallySigningIn=3]="ExternallySigningIn",h[h.SignedIn=4]="SignedIn",h[h.SharingInProgress=5]="SharingInProgress",h[h.Shared=6]="Shared",h[h.JoiningInProgress=7]="JoiningInProgress",h[h.Joined=8]="Joined"}(m.SessionState||(m.SessionState={})),function(h){h[h.AttemptSharing=0]="AttemptSharing",h[h.SharingError=1]="SharingError",h[h.SharingSuccess=2]="SharingSuccess",h[h.EndSharing=3]="EndSharing",h[h.Unjoin=4]="Unjoin",h[h.AttemptJoining=5]="AttemptJoining",h[h.JoiningError=6]="JoiningError",h[h.JoiningPendingReload=7]="JoiningPendingReload",h[h.JoiningSuccess=8]="JoiningSuccess",h[h.AttemptSignIn=9]="AttemptSignIn",h[h.AwaitExternalSignIn=10]="AwaitExternalSignIn",h[h.SignInError=11]="SignInError",h[h.SignInSuccess=12]="SignInSuccess",h[h.SignOut=13]="SignOut",h[h.Create=14]="Create"}(m.SessionAction||(m.SessionAction={})),function(h){h[h.EnvironmentReadyForFileOperation=0]="EnvironmentReadyForFileOperation",h[h.JoiningCompleted=1]="JoiningCompleted"}(m.SessionPromise||(m.SessionPromise={}))},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0});const v=y(0),C=y(22),T=y(911),w=y(160);m.sessionStateTracker=new class SessionStateTracker{constructor(){this.stateChangedEmitter=new v.EventEmitter,this.onStateChanged=this.stateChangedEmitter.event,this.statusChangedEmitter=new v.EventEmitter,this.onStatusChanged=this.statusChangedEmitter.event,this.currentState=C.SessionState.Initializing,this.currentHigherState=void 0}get State(){return this.currentState}get HigherState(){return this.currentHigherState}transitionHigherState(h,m){h===C.SessionState.SharingInProgress||h===C.SessionState.JoiningInProgress||h===C.SessionState.Shared||h===C.SessionState.Joined?this.currentHigherState=h:m!==C.SessionAction.SharingError&&m!==C.SessionAction.JoiningError&&m!==C.SessionAction.EndSharing&&m!==C.SessionAction.Unjoin||(this.currentHigherState=void 0)}transition(h){const m=T.sessionMachine[this.State];if(m){let y=m[h];return void 0!==y?("function"==typeof y&&(y=y()),this.transitionHigherState(y,h),this.sendTransitionTelemetry(y,h),this.setState(y,h),this.State):void 0}}sendTransitionTelemetry(h,m){w.ExtensionTelemetry.sendTransition(C.SessionState[this.State],C.SessionState[h],C.SessionAction[m])}setState(h,m){const y=this.currentState,v=this.currentAction;this.currentState=h,this.currentAction=m,this.stateChangedEmitter.fire({newState:h,oldState:y,newAction:m,oldAction:v})}setStatus(h){const m=this.currentStatus;this.currentStatus=h,this.statusChangedEmitter.fire({newStatus:h,oldStatus:m})}point(h){void 0!==h&&this.setStatus(h)}},m.setSessionStateTracker=function setSessionStateTracker(h){m.sessionStateTracker=h}},function(h,m,y){"use strict";var v=this&&this.__awaiter||function(h,m,y,v){return new(y||(y=Promise))((function(C,T){function fulfilled(h){try{step(v.next(h))}catch(h){T(h)}}function rejected(h){try{step(v.throw(h))}catch(h){T(h)}}function step(h){h.done?C(h.value):function adopt(h){return h instanceof y?h:new y((function(m){m(h)}))}(h.value).then(fulfilled,rejected)}step((v=v.apply(h,m||[])).next())}))};Object.defineProperty(m,"__esModule",{value:!0});const C=y(0),T=y(4),w=y(12),A=y(14),P=y(7),k=y(25),R=y(8),M=y(17),N=y(5),D=y(26),I=y(37),x=y(5),O=y(63),L={location:C.ProgressLocation.Window,title:""},U=Object.assign(Object.assign({},L),{isUserInitiated:!0});class ExtensionUtil{static init(h,m,y){ExtensionUtil.extensionContext=h,ExtensionUtil.extensionUtilId=y,N.traceSource.info("Extension, IDE, OS : "+ExtensionUtil.clientInfoToString(m)),R.Telemetry.addFilter(new R.SendOnceFilter(M.TelemetryEventNames.UNHANDLED_REJECTION_FAULT,[R.TelemetryPropertyNames.EVENT_MESSAGE]))}static getPackage(){return ExtensionUtil.getPackageExtension(ExtensionUtil.extensionUtilId)}static getPackageExtension(h){const m=C.extensions.getExtension(h);if(m)return m.packageJSON}static get extensionId(){return ExtensionUtil.extensionUtilId}static get context(){if(!ExtensionUtil.extensionContext)throw new Error("Extension context not initialized");return ExtensionUtil.extensionContext}static get enableModalNotifications(){return!process.env.VSLS_TEST_DISABLE_MODAL}static setCommandContext(h,m){return v(this,void 0,void 0,(function*(){ExtensionUtil.contextValues[h]=m,yield C.commands.executeCommand("setContext",h,m)}))}static getCommandContext(h){return ExtensionUtil.contextValues[h]}static getErrorString(h){switch(h){case T.vsls.ErrorCodes.CouldNotConnectToServer:return k.localize("error.CouldNotConnectToServer");case T.vsls.ErrorCodes.OlderThanServer:return k.localize("error.OlderThanServer").replace("$(shortName)",w.Settings.get(A.SettingKeys.shortName));case T.vsls.ErrorCodes.NewerThanServer:return k.localize("error.NewerThanServer").replace("$(shortName)",w.Settings.get(A.SettingKeys.shortName));case T.vsls.ErrorCodes.OlderThanPeer:return k.localize("error.OlderThanPeer").replace("$(shortName)",w.Settings.get(A.SettingKeys.shortName));case T.vsls.ErrorCodes.NewerThanPeer:return k.localize("error.NewerThanPeer").replace("$(shortName)",w.Settings.get(A.SettingKeys.shortName));case T.vsls.ErrorCodes.OlderThanAgent:return k.localize("error.OlderThanAgent").replace("$(shortName)",w.Settings.get(A.SettingKeys.shortName));case T.vsls.ErrorCodes.NewerThanAgent:return k.localize("error.NewerThanAgent").replace("$(shortName)",w.Settings.get(A.SettingKeys.shortName));case T.vsls.ErrorCodes.NoIPAddressesDetected:return k.localize("error.NoIPAddressesDetected");case T.vsls.ErrorCodes.NoConnectionAddresses:return k.localize("error.NoConnectionAddresses");case T.vsls.ErrorCodes.AutoConnectionFailed:return k.localize("error.AutoConnectionFailed");case T.vsls.ErrorCodes.RelayConnectionFailed:return k.localize("error.RelayConnectionFailed");case T.vsls.ErrorCodes.DirectConnectionFailed:return k.localize("error.DirectConnectionFailed");case T.vsls.ErrorCodes.SessionProtocolError:return k.localize("error.SessionProtocolError").replace("$(shortName)",w.Settings.get(A.SettingKeys.shortName));case T.vsls.ErrorCodes.SessionAuthenticationFailed:return k.localize("error.SessionAuthenticationFailed");case T.vsls.ErrorCodes.DirectConnectionNotEnabled:return k.localize("error.DirectConnectionNotEnabled");case T.vsls.ErrorCodes.RelayConnectionNotEnabled:return k.localize("error.RelayConnectionNotEnabled");case T.vsls.ErrorCodes.CollaborationSessionUsersLimitReached:return k.localize("error.CollaborationSessionUsersLimitReached");case T.vsls.ErrorCodes.CollaborationSessionGuestRejected:return k.localize("error.CollaborationSessionGuestRejected");case T.vsls.ErrorCodes.CollaborationSessionRequestTimedOut:return k.localize("error.CollaborationSessionRequestTimedOut");case T.vsls.ErrorCodes.CollaborationSessionGuestCanceled:return k.localize("error.CollaborationSessionGuestCanceled");case T.vsls.ErrorCodes.CollaborationSessionNotFound:return k.localize("error.CollaborationSessionNotFound");case T.vsls.ErrorCodes.CollaborationSessionGuestBlocked:return k.localize("error.CollaborationSessionGuestBlocked");case T.vsls.ErrorCodes.NonSuccessHttpStatusCodeReceived:return k.localize("error.NonSuccessHttpStatusCodeReceived");case T.vsls.ErrorCodes.KeychainAccessFailed:return k.localize("error.KeychainAccessFailed");case T.vsls.ErrorCodes.RelayConnectionHostFailure:return k.localize("error.RelayConnectionHostFailure");case T.vsls.ErrorCodes.RelayConnectionGuestFailure:return k.localize("error.RelayConnectionGuestFailure");case T.vsls.ErrorCodes.RemoteLaunchNotEnabled:return k.localize("error.RemoteLaunchNotEnabled");case T.vsls.ErrorCodes.CouldNotConnectToServerAuthFailed:return k.localize("error.CouldNotConnectToServerAuthFailed");default:return""}}static getLocalizedProgressString(h){switch(h){case T.vsls.WorkspaceProgress.OpeningRemoteSession:return k.localize("progress.openingRemoteSession");case T.vsls.WorkspaceProgress.JoiningRemoteSession:return k.localize("progress.joiningRemoteSession");case T.vsls.WorkspaceProgress.WaitingForHost:return k.localize("progress.waitingForHost");case T.vsls.WorkspaceProgress.ReconnectingToHost:return k.localize("progress.reconnectingToHost");default:return""}}static getProgressUpdateString(h){return ExtensionUtil.getLocalizedProgressString(h)}static getWaitingForHostProgressUpdateString(h,m){if(!m)return;let y=this.getLocalizedProgressString(h);if(y){const h=w.Settings.get(A.SettingKeys.anonymousUserName),v=m.isAnonymous&&h?h:m.displayName||m.emailAddress||"Unknown user";y=y.replace("$(userName)",v)}return y}static getWorkspaceFilePath(h){return P.join(h,`${w.Settings.get(A.SettingKeys.name)}.code-workspace`)}static runWithProgress(h,m=U){return v(this,void 0,void 0,(function*(){const y=Object.assign(Object.assign({},U),m),{isUserInitiated:T,cancellationToken:w}=y;if(!w||!w.isCancellationRequested)return T||(y.title=""),yield C.window.withProgress(y,m=>v(this,void 0,void 0,(function*(){return new Promise((y,C)=>v(this,void 0,void 0,(function*(){w&&w.onCancellationRequested(()=>{y(null)});try{y(yield h(m))}catch(h){C(h)}})))})))}))}static showErrorAsync(h,m={},y=[]){return v(this,void 0,void 0,(function*(){const v=("string"==typeof h?h:h.code&&ExtensionUtil.getErrorString(h.code)||h.message)||"Unknown error",{modal:T,hideReportAProblem:w}=m;if(w)return yield C.window.showErrorMessage(v,{modal:T},...y);const A={title:"Report a Problem"},P=yield C.window.showErrorMessage(v,{modal:T},A,...y);return P&&P.title===A.title&&this.reportIssue(),P}))}static reportIssue(){return v(this,void 0,void 0,(function*(){const{name:h,publisher:m}=ExtensionUtil.getPackage();yield C.commands.executeCommand("vscode.openIssueReporter",`${m}.${h}`)}))}static registerCommand(h,m,y){return C.commands.registerCommand(h,(function(...y){return v(this,void 0,void 0,(function*(){try{return new R.TelemetryEvent(M.TelemetryEventNames.COMMAND_INITIATED).addProperty("commandName",h).send(),yield m.call(this,...y)}catch(m){ExtensionUtil.reportCommandError(h,m)}}))}),y)}static addNewTreeViewItemAdornment(h,m){if(!h)return;let y=!1;const v=new Date,C=w.Settings.get(m);if(C){const h=new Date(C),m=new Date;m.setDate(v.getDate()-7),y=h>m}else w.Settings.save(m,v),y=!0;return h.tooltip=`${h.label} ${y?k.localize("treeView.newTooltip"):""}`,h.label=`${h.label}${y?"":""}`,h}static registerTextEditorCommand(h,m,y){return C.commands.registerTextEditorCommand(h,(function(y,v,...C){try{return m.call(this,y,v,...C)}catch(m){ExtensionUtil.reportCommandError(h,m)}}),y)}static tryRegisterCommand(h,m,y,C=!1,T=!1){return v(this,void 0,void 0,(function*(){let v=void 0;if(yield ExtensionUtil.isCommandDefined(h)){if(v=this.registeredCommands[h],!T)return v;if(v){const h=ExtensionUtil.context.subscriptions.indexOf(v);h>=0&&ExtensionUtil.context.subscriptions.splice(h,1),v.dispose()}}try{v=C?ExtensionUtil.registerTextEditorCommand(h,m,y):ExtensionUtil.registerCommand(h,m,y),ExtensionUtil.registeredCommands[h]=v,ExtensionUtil.context.subscriptions.push(v)}catch(m){N.traceSource.error(`Failed to register command:${h}`,m)}return v}))}static isCommandDefined(h){return v(this,void 0,void 0,(function*(){return(yield C.commands.getCommands()).indexOf(h)>=0}))}static disposeCommand(h){this.registeredCommands[h]&&(this.registeredCommands[h].dispose(),delete this.registeredCommands[h])}static clientInfoToString(h){let m="";return h?(h.extensionVersion&&(h.extensionName&&(m+=h.extensionName,m+="/"),m+=h.extensionVersion),h.applicationVersion&&(m.length>0&&(m+=" "),h.applicationName&&(m+=h.applicationName,m+="/"),m+=h.applicationVersion),h.platformVersion&&(m.length>0&&(m+=" "),h.platformName&&(m+=h.platformName,m+="/"),m+=h.platformVersion),m):m}static getExtensionVersion(h,m=!0){let y=ExtensionUtil.getPackageExtension(h).version;return m||(y=y.replace(/-.*/,"")),y}static reportCommandError(h,m){const y=`Unhandled error in '${h}' command: `;N.traceSource.error(y,m),R.Telemetry.sendFault(M.TelemetryEventNames.UNHANDLED_COMMAND_ERROR_FAULT,R.FaultType.Error,y+m.message,m),ExtensionUtil.showErrorAsync(m)}static getGlobalStoragePath(){return ExtensionUtil.context.globalStoragePath||ExtensionUtil.context.extensionPath}static openBrowser(h){process.env.VSLS_TEST_DISABLE_BROWSE?C.window.showInformationMessage("[OPEN] "+h):C.env.openExternal(C.Uri.parse(h))}static isNode(){return"undefined"!=typeof process&&void 0!==process.release&&"node"===process.release.name}static getExtensionUri(h){return N.getExtensionUri(h,ExtensionUtil.context)}static isReadWriteAnonymousEnabled(){var h;return null===(h=I.getExpService())||void 0===h?void 0:h.getTreatmentVariable("vscode","readWriteAnonymous")}static getAnonymousReadOnlyLabel(h,m,y){return v(this,void 0,void 0,(function*(){if(!h)return"";const v=yield h.isClientReadOnly(m.id),C=m.isAnonymous;let T,w=D.workspaceSessionInfoTracker.getAnonymousAccess(m.id),A=this.isReadWriteAnonymousEnabled()&&w===D.AnonymousAccessLevel.readWrite,P="";if(m.isHost)return P;if(y){const m=yield h.isClientExplicitlyReadWrite(y);T=v&&!m&&!C}else T=v&&!C;return T?P=k.localize("guestNameViewlet.ReadOnlyLabel"):C&&(P=A?k.localize("guestNameViewlet.AnonymousReadWriteLabel"):k.localize("guestNameViewlet.ReadOnlyAndAnonymousLabel")),P}))}static setTransientWorkspace(h){return v(this,void 0,void 0,(function*(){try{const m=C.workspace.workspaceFile.fsPath,y=JSON.parse((new TextDecoder).decode(x.fileAccess.readFileSync(m)));y.transient=h,x.fileAccess.writeFileAsync(m,JSON.stringify(y))}catch(h){O.assert(!1,"Setting transient workspace failed.")}}))}static revealFileInOS(h){return v(this,void 0,void 0,(function*(){yield C.commands.executeCommand("revealFileInOS",C.Uri.file(h))}))}}m.ExtensionUtil=ExtensionUtil,ExtensionUtil.contextValues={},ExtensionUtil.registeredCommands={}},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0});const v={"statusbar.placeHolder":"What would you like to do with other collaborators?","statusbar.InviteOthers":"Invite Others (Copy Link)","statusbar.InviteOthersMessage":"Copy the invitation link so you can send it to other participants.","statusbar.FocusParticipants":"Focus Participants","statusbar.FocusParticipantsMessage":"Request other participants to follow you.","statusbar.ShareReadOnlyTerminal":"Share Read-only Terminal","statusbar.ShareTerminal":"Share Terminal","statusbar.ShareTerminalMessage":"Start a new terminal / command prompt for use by all participants.","statusbar.ShareServer":"Share Server","statusbar.ShareServerMessage":"Expose a local TCP port to all participants.","statusbar.ShowSharedServers":"Show Shared Servers","statusbar.ShowSharedServersMessage":"Show local TCP servers shared with collaboration participants.","statusbar.StartCollaboration":"Start Collaboration Session","statusbar.StopSharingServer":"Stop Sharing Server","statusbar.StopSharingServerMessage":"Stop sharing a local TCP port for all participants.","statusbar.StopCollaborationSession":"Stop Collaboration Session","statusbar.StopCollaborationSessionMessage":"Stop collaboration session, stop sharing all content, and remove all participant access.","statusbar.SignInMessage":"Sign in with your GitHub or Microsoft account to gain read/write access.","statusbar.AttachSharedDebuggingSession":"Attach to a Shared Debugging Session","statusbar.AttachSharedDebuggingSessionMessage":"Attach your debugger to a debug session that the host has shared with participants.","statusbar.AccessSharedTerminal":"Access Shared Terminal","statusbar.AccessSharedTerminalMessage":"Open terminal that the host has shared with participants.","statusbar.AccessSharedServer":"Access Shared Server","statusbar.AccessSharedServerMessage":"Copy a named, shared TCP port for use","statusbar.LeaveCollaborationSession":"Leave Collaboration Session","statusbar.LeaveCollaborationSessionMessage":"Stop participating in this collaboration session.","statusbar.SignedUserPlaceholder":"What would you like to do?","statusbar.StartSession":"Start Collaboration Session","statusbar.StartSessionMessage":"Start a collaboration session to share content and invite participants.","statusbar.StartReadOnly":"Start Read-only Collaboration Session","statusbar.StartReadOnlyMessage":"Start a read-only collaboration session to share content and invite participants.","statusbar.JoinSession":"Join Collaboration Session","statusbar.JoinSessionMessage":"Join a collaboration session to access shared content.","generic.Close":"Close","generic.CopyAgain":"Copy again","generic.CopyLink":"Copy link","generic.MakeReadWrite":"Make read/write","generic.MakeReadOnly":"Make read-only","generic.StartSharing":"Start Sharing","generic.Help":"Help","generic.OK":"OK","generic.SignIn":"Sign in","generic.ContinueAsAnonymous":"Continue as anonymous","generic.moreInfo":"More info","generic.dontShowAgain":"Don't show again","error.CouldNotConnectToServer":"Could not connect to the server. Check that you are connected to the internet.","error.OlderThanServer":"The $(shortName) service requires a newer version of the extension than you have installed.","error.NewerThanServer":"The extension you have installed requires a newer version of the $(shortName) service.","error.OlderThanPeer":"The $(shortName) extension you have installed is too old to connect to this collaboration session.","error.NewerThanPeer":"The collaboration session host is on an older version of the $(shortName) extension than you are.","error.OlderThanAgent":"The $(shortName) agent is newer than the extension","error.NewerThanAgent":"The $(shortName) agent is older than the extension","error.NoIPAddressesDetected":'Unable to share in "Direct" mode as there are no suitable IP addresses. Switch to "Auto" or "Relay" mode and retry.',"error.NoConnectionAddresses":'Could not find a compatible connection address. Switch to "Auto" mode and retry.',"error.AutoConnectionFailed":"Unable to connect to the host. Verify both you and the host are online.","error.RelayConnectionFailed":'Unable to connect to the host in "Relay" mode. Verify you and the host are online. If so, switch to "Auto" or "Direct" mode and retry.',"error.DirectConnectionFailed":'Unable to connect to the host in "Direct" mode. Verify you and the host are online. If so, switch to "Auto" or "Relay" mode and retry.',"error.SessionProtocolError":"Unable to join the host due to a protocol error. Verify you and the host are online and are using the latest version of $(shortName).","error.SessionAuthenticationFailed":"Unable to join the host due to an authentication error. Verify the host is online, then sign out and sign in again and retry.","error.AuthTokenConversionFailed":"Live Share didn't succeed reusing a GitHub token for authentication. This could be caused by either a token expiration or revocation. Refresh your GitHub account in VSCode and run Live Share again to fix the problem.","error.AuthTokenConversionFailedWithCode":"Token exchange failed with code: ${code}","error.UnexpectedAuthenticationError":"Unexpected authentication error. Try signing in again.","error.DirectConnectionNotEnabled":'The host does not allow direct connections. Switch to "Auto" or "Relay" mode and retry.',"error.RelayConnectionNotEnabled":'Unable to connect since the host does not allow relayed connections. Switch to "Auto" or "Direct" mode and retry.',"error.CollaborationSessionUsersLimitReached":"Could not join the collaboration session as it has already reached the maximum of 5 participants. To increase the participant limit, please ask the host to change the Increased Guest Limit setting, reload and then start a new collaboration session.","error.CollaborationSessionGuestRejected":"The host has rejected you from joining the collaboration session.","error.CollaborationSessionRequestTimedOut":"Timed out while waiting for the host to respond to your request.","error.CollaborationSessionGuestCanceled":"Request to join the collaboration session was canceled.","error.CollaborationSessionNotFound":"Collaboration session not found.","error.CollaborationSessionGuestBlocked":"The host has blocked you from joining the collaboration. If this was accidental, please ask the host to restart the session.","error.NonSuccessHttpStatusCodeReceived":"Could not connect to the server. Received non success status code.","error.KeychainAccessFailed":"Live Share was unable to access the login keychain. This can happen if you recently changed your password or your login keychain has become corrupted. See more info for details on how to fix it.","error.RelayConnectionHostFailure":"The host's network conditions are poor or they are no longer connected to the Live Share cloud relay. Ask them to check their network conditions, restart the collaboration session, and try again.","error.RelayConnectionGuestFailure":"Unable to connect to Live Share cloud relay. Check your proxy, firewall and network settings and try again.","error.RemoteLaunchNotEnabled":"The host doesnt allow starting the debugger. If needed, ask them to enable it.","error.CouldNotConnectToServerAuthFailed":"Could not connect to the server. HTTPS connection failed, verify there are no self-signed certificates or custom cert validation policies blocking Live Share.","error.CannotCreatePlannedSession":"Failed to create a planned session","error.CannotDeletePlannedSession":"Failed to delete a planned session","error.CannotRenamePlannedSession":"Failed to rename planned session","error.CannotCopyPlannedSessionLink":"Failed to copy planned session link","error.CannotJoinPlannedSession":"Failed to join planned session","error.CaseSensitiveFileSystem":"It looks like you have a directory with files that have the same name, except for the casing. This is currently unsupported and may lead to errors.","error.RunningVsCodeOutsideOfApplicationsFolder":"You are running VS Code outside the Applications folder, so we cannot install support for joining sessions using a browser link. You can still join sessions manually.","error.FailedToInstallJoiningSessionsViaBrowser":"Failed to install support for joining sessions using a browser link. You can still join sessions manually.","error.InvitationLinkExpired":"This invite link has expired. Share again to generate a new link.","progress.openingRemoteSession":"Opening remote session...","progress.joiningRemoteSession":"Joining remote session...","progress.waitingForHost":"Waiting for host approval...","progress.reconnectingToHost":"Connection lost. Reconnecting to host...","progress.creatingPlannedSession":"Creating planned session...","progress.deletingPlannedSession":"Deleting planned session...","fileError.FileNotFound":"Path not found: $(path)","fileError.FileExists":"Path already exists: $(path)","fileError.NoPermissions":"Access denied: $(path)","fileError.FileTooLarge":"File is too large.","fileError.FileNotAvailable":"File is not available.","notification.AcceptRejectGuest":" requested to join the collaboration session.","notification.Accept":"Accept","notification.AcceptReadOnly":"Accept read-only","notification.AcceptReadWrite":"Accept read-write","notification.Reject":"Reject","notification.AlwaysAcceptAnonymous":"Always accept anonymous","notification.InformGuestJoined":" joined the collaboration session.","notification.GuestDisconnected":" was disconnected.","notification.GuestLeft":" left the collaboration session.","notification.FocusAccept":"$(userId) focused your attention.","notification.FocusRequest":"$(userId) requested you to follow them.","notification.CopyPlannedSessionLink":"Session link copied.","notification.CoeditingInformationCopiedToClipboard":"Co-editing information copied to clipboard.","notification.JoiningFromBrowserPermission":"To support joining a session using a browser link, we need permission to run an installer on your system. Your OS may ask you for your admin (sudo) password in a terminal. Install now?","notification.copyInstead":"Copy instead","notification.install":"Install","notification.InvitationLinkCopied":"Invitation link copied to clipboard! Send it to anyone you trust","notification.InvitationLinkSessionShared":'Session shared! Click "Copy link" to get an invitation link ',"notification.InvitationLinkMoreInfo":'or click "More info" to learn about secure sharing.',"notification.ReusableInvitationLinkCopied":'A Reusable Session link is copied to the clipboard. Save the link to a secure location. Learn more about how to use your Session by clicking "More info".',"notification.ReusableInvitationLinkCreated":'A Reusable Session link is created! Click "Copy link" to get the link. Save the link to a secure location. Learn more about how to use your Session by clicking "More info".',"notification.SignIntoJoin":"Sign in with VS Live Share to join a collaboration session.","notification.YouNeedToSignInBeforeJoin":"You need to sign in before joining the collaboration session.","notification.ProgressNotifiers":"$(options.title)","notification.CannotEditTheTerminal":"Cannot edit the terminal in read-only mode (anonymous). Sign in to proceed.","plannedSessions.quickPickSelectWindow":"Select a planned session","plannedSessions.expiresatTooltip":"Expiration: ","plannedSessions.NewLabel":"Create planned session...","plannedSessions.CreateaPlannedSessionTooltip":"Create a planned session","plannedSessions.Name":"Specify the name of the planned session","plannedSessions.NameCannotBeEmpty":"Name cannot be empty. Please enter an alphanumeric name for the session","plannedSessions.NameIsInvalid":"Name is invalid. Please enter an alphanumeric name for the session","guestNameToast.ReadOnlyLabel":" (Read-only)","guestNameToast.ReadOnlyAndAnonymousLabel":" (Anonymous & Read-only)","guestNameToast.AnonymousReadWriteLabel":" (Anonymous & Read-write)","guestNameToast.AnonymousLabel":" (Anonymous)","extension.liveshare.InLiveShareSession":"In a Live Share session","searchContacts.placeholder":"Type to search for contacts","selectPresenceProviderCommand.placeHolder":"Select the presence provider to use","inviteContactStatus.invited":"Invited","inviteContactStatus.dismissed":"Dismissed","inviteContactStatus.joining":"Joining","guestNameViewlet.ReadOnlyLabel":" (read-only)","guestNameViewlet.ReadOnlyAndAnonymousLabel":" (anonymous & read-only)","guestNameViewlet.AnonymousReadWriteLabel":" (anonymous & read-write)","anonymousAuthStrategy.readOnlyUser":"Read-only User","anonymousAuthStrategy.continueAs":"Continue as","anonymousAuthStrategy.continueAsDescription":"Continue without signing in as a Read-only guest","authentication.SignInPromptPlaceholder":"Please select account to sign in","authentication.SignInPrompt":"Sign in using ${key} account","commentManager.cannotCreateCommentThread":"Cannot create comment thread","commentManager.cannotDeleteThread":"Cannot delete comment thread","commentManager.cannotReply":"Cannot reply","commentManager.cannotEditComment":"Cannot edit comment","commentManager.cannotSaveComment":"Cannot save comment","commentManager.cannotCancelEditComment":"Cannot cancel editing comment","commentManager.cannotDeleteComment":"Cannot delete comment","commentManager.deleteOtherComments":"delete other comments on the thread first","commentManager.controllerLabel":"Live Share Session Comments","commentManager.participants":"Participants:","chat.statusBarText":"Live Share Chat: $(unreads) new","chat.sessionChatLabel":"Session Chat","chat.quickPickItemDescription":"Live Share Chat","chat.quickPickSelectWindow":"Select a chat channel","chat.unreadLabel":"($(unread) new)","chat.typingStatus":"$(username) is typing...","chat.sessionStarted":"_has started the Live Share session_","chat.sessionEnded":"_has ended the Live Share session_","chat.sessionJoined":"_has joined the Live Share session_","chat.sessionLeft":"_has left the Live Share session_","chat.hostUnsupported":"The host of this collaboration session is currently disconnected from chat or is using a version of _Live Share_ that does not support this feature. [Learn more](https://aka.ms/vsls-chat)","chat.contactUnsupported":"The person you are trying to contact is currently unavailable or using a version of _Live Share_ that does not support this feature. [Learn more](https://aka.ms/vsls-chat)","chat.legacyExtensionUnsupported":"Please update the `Live Share Chat` companion extension. The version installed is no longer compatible. [Learn more](https://aka.ms/vsls-chat)","chat.unknownUser":"Unknown user","chat.openSessionChatWindow":"Open session chat","chat.chatServiceDisconnected":"The chat service is currently disconnected. Please try again shortly.","calling.quickPickConnectedPlaceholder":"What would you like to do?","calling.quickPickDisconnectLabel":"$(x) Disconnect","calling.quickPickDisconnectDetail":"Disconnect from the audio call.","calling.quickPickMuteYourselfLabel":"$(mute) Mute Yourself","calling.quickPickUnmuteYourselfLabel":"$(unmute) Unmute Yourself","calling.quickPickMuteYourselfDetail":"Mute yourself so others cannot hear you.","calling.quickPickUnmuteYourselfDetail":"Unmute your microphone so others can hear you.","calling.quickPickViewParticipantsLabel":"$(organization) View Participants","calling.quickPickViewParticipantsDetail":"View the list of Live Share participants that are currently in the call.","calling.quickPickConfigureSpeakersLabel":"$(unmute) Configure Speakers","calling.quickPickConfigureSpeakersDetail":"Select which speakers to use for the audio call.","calling.quickPickConfigureMicrophoneLabel":"$(megaphone) Configure Microphone","calling.quickPickConfigureMicrophoneDetail":"Select which microphone to use for the audio call.","calling.treeAudioCallParticipantsInitial":"Participants (0)","calling.treeJoinAudioCall":"Join audio call...","calling.treeStartAudioCall":"Start audio call...","calling.treeJoiningAudioCall":"Joining audio call...","calling.treeStartingAudioCall":"Starting audio call...","calling.treeEndingAudioCall":"Ending audio call...","calling.treeAudioCallLabel":"Audio Call","calling.treeAudioCallParticipantsCount":"Audio Call Participants ($(participantCount))","calling.treeUnknownUser":"Unknown user","calling.treeSelfItem":"$(displayName) (you)","calling.joinButton":"Join","calling.connectingAudio":"Connecting audio...","calling.disconnectingAudio":"Disconnecting audio...","calling.viewParticipantsQuickPickPlaceholder":"Audio Call Participants","calling.selectMicrophoneQuickPickPlaceholder":"Select the microphone to use","calling.selectSpeakersQuickPickPlaceholder":"Select the speaker to use","calling.joinInformationMessage":"An audio call has been started for this collaboration session.","info.SearchResultsLimited":"The result set contains only a subset of all matches. Please be more specific in your search to narrow down the results.","treeView.newTooltip":"[New]","guestServerController-promtHostSharedServer":"The host has shared a server $(sessionName) with you. Would you like to view this in the browser?","guestServerController-yes":"Yes","guestServerController-no":"No","guestServerController-serverUnshared":"Cannot open server $(sessionName) in browser. The host has unshared the server","emptyWorkspace.liveShareWorkspace":"Live Share Workspace","notebooks.openWithDifferentNotebookTypeOnHost1":"The host has the notebook open with","notebooks.openWithDifferentNotebookTypeOnHost2":"Use the same view to open","notebooks.openedWithLocalContentProvider":"Co-editing is not supported for notebooks opened with non-shared views.","notebooks.kernelDetail":"Kernel to execute cells on the host's machine","notebooks.executeCellsAccessGranted":"The host has granted you access to execute notebook cells","notebooks.executeCellsAccessDenied":"The host has rejected your request to execute notebook cells","notebooks.executeCellsReadOnly":"You cannot execute notebook cells in a read-only session","notebooks.executeCellsLackingPermission":"The host has not given you permission to execute notebook cells","notebooks.executeCellsRequestAccess":"Request access","notebooks.executeCellsAllowForSession":"Allow for this session","notebooks.executeCellsAllowAlways":"Allow always","notebooks.executeCellsReject":"Reject","notebooks.executeCellsRequested":"A guest is requesting permission to execute notebook cells",startCollaborationSession:"Start collaboration session...",joinCollaborationSession:"Join collaboration session...",startReadOnlyCollaborationSession:"Start read-only collaboration session...",CreateLinkProgress:"Creating a Reusable Session link...",CannotCreatePersistentSession:"Failed to create a Reusable Session link","accessibility.file":"File","accessibility.line":"Line","accessibility.lines":"Lines","accessibility.to":"to","accessibility.onScreen":"on screen","accessibility.selection":"Selection","accessibility.join":"joined the session","accessibility.leave":"left the session","accessibility.follow":"You are now following","accessibility.unfollow":"You unfollowed","accessibility.leftLine":"left your line","accessibility.theyLeftLine":"They left your line","accessibility.switchFile":"switched to file","accessibility.editingSameLine":"is editing the same line as you","accessibility.theyEditingSameLine":"They are editing the same line as you","accessibility.editingNearby":"is editing nearby","accessibility.theyEditingNearby":"They are editing nearby","accessibility.selectionOnLine":"Selection on line","accessibility.selectedLines":"Selected lines","accessibility.lookingForOutputDevices":"Looking for devices","web.SelectLauncherClient":"How would you like to join this collaboration session?","web.OpenIn":"Open in $(editor)","web.ContinueIn":"Continue in $(editor)","web.Reopen":"Re-open in $(editor)","web.LaunchingIn":"Joining the collaboration session with $(editor)...","presence.signInMessage":"Sign in to presence will allow people to see your status based on your e-mail","sessionExplorer.commentsLabel":"Comments ($(count))"};let localizeInstance=h=>v.hasOwnProperty(h)?v[h]:h;m.setLocalizeCallback=function setLocalizeCallback(h){localizeInstance=h},m.localize=function localize(h){return localizeInstance(h)},m.localizeDate=function localizeDate(h){return h.toLocaleString()}},function(h,m,y){"use strict";var v=this&&this.__awaiter||function(h,m,y,v){return new(y||(y=Promise))((function(C,T){function fulfilled(h){try{step(v.next(h))}catch(h){T(h)}}function rejected(h){try{step(v.throw(h))}catch(h){T(h)}}function step(h){h.done?C(h.value):function adopt(h){return h instanceof y?h:new y((function(m){m(h)}))}(h.value).then(fulfilled,rejected)}step((v=v.apply(h,m||[])).next())}))};Object.defineProperty(m,"__esModule",{value:!0});const C=y(0),T=y(35),w=y(8),A=y(17),P=y(25),k=y(24),R=y(62);var M;!function(h){h.readOnly="readOnly",h.readWrite="readWrite"}(M=m.AnonymousAccessLevel||(m.AnonymousAccessLevel={}));m.workspaceSessionInfoTracker=new class WorkspaceSessionInfoTracker{constructor(){this.vslsWorkspaceSessionInfo=null,this.plannedWorkspaceList=null,this.isReadOnlyPrivate=!1,this.isPlannedSessionsChangedPrivate=!1,this.anonymousAccessMap=new Map,this.readOnlyChangedEmitter=new C.EventEmitter,this.onReadOnlyChanged=this.readOnlyChangedEmitter.event,this.plannedSessionsChangedEmitter=new C.EventEmitter,this.onPlannedSessionsChanged=this.plannedSessionsChangedEmitter.event,this.anonymousAccessLevelChangedInSessionEmitter=new C.EventEmitter,this.onAccessLevelChangedInSession=this.anonymousAccessLevelChangedInSessionEmitter.event}get workspaceSessionInfo(){return this.vslsWorkspaceSessionInfo}set workspaceSessionInfo(h){var m;this.vslsWorkspaceSessionInfo=h,(null===(m=this.vslsWorkspaceSessionInfo)||void 0===m?void 0:m.id)&&k.ExtensionUtil.getCommandContext("liveshare:isWeb")&&!k.ExtensionUtil.getCommandContext("liveshare:isNode")&&(this.vslsWorkspaceSessionInfo.joinUri=`${R.LIVESHARE_JOIN_URI}${this.vslsWorkspaceSessionInfo.id}`),(null==h?void 0:h.conversationId)&&(w.Telemetry.addContextProperty(A.TelemetryPropertyNames.CONVERSATION_ID,h.conversationId),w.Telemetry.addContextProperty(A.TelemetryPropertyNames.SESSION_ID,T()))}get isReadOnly(){return this.isReadOnlyPrivate}set isReadOnly(h){h!==m.workspaceSessionInfoTracker.isReadOnly&&(h?w.Telemetry.addContextProperty(A.TelemetryPropertyNames.IS_READONLY_SESSION,!0,!1):w.Telemetry.removeContextProperty(A.TelemetryPropertyNames.IS_READONLY_SESSION),m.workspaceSessionInfoTracker.isReadOnlyPrivate=h,this.readOnlyChangedEmitter.fire(h))}get isPlannedSessionsChanged(){return this.isPlannedSessionsChangedPrivate}set isPlannedSessionsChanged(h){h!==m.workspaceSessionInfoTracker.isPlannedSessionsChanged&&(m.workspaceSessionInfoTracker.isPlannedSessionsChangedPrivate=h,this.plannedSessionsChangedEmitter.fire(h)),m.workspaceSessionInfoTracker.isPlannedSessionsChangedPrivate=!1}setAnonymousAccess(h,m){return v(this,void 0,void 0,(function*(){const y=new w.TelemetryEvent(A.TelemetryEventNames.RESPOND_ANONYMOUS_JOIN_REQUEST);switch(m){case P.localize("notification.AcceptReadOnly"):case P.localize("notification.Accept"):case P.localize("notification.AlwaysAcceptAnonymous"):this.anonymousAccessMap.set(h,M.readOnly),y.addProperty(A.TelemetryPropertyNames.READONLY,!0),y.addProperty(A.TelemetryPropertyNames.ACCEPTED,!0);break;case P.localize("notification.AcceptReadWrite"):this.anonymousAccessMap.set(h,M.readWrite),y.addProperty(A.TelemetryPropertyNames.READONLY,!1),y.addProperty(A.TelemetryPropertyNames.ACCEPTED,!0);break;case P.localize("notification.Reject"):y.addProperty(A.TelemetryPropertyNames.ACCEPTED,!1)}y.send()}))}updateAnonymousAccess(h,m){return v(this,void 0,void 0,(function*(){const y=new w.TelemetryEvent(A.TelemetryEventNames.UPDATE_ANONYMOUS_GUEST_ACCESS_LEVEL),v=h.participantId,C=h.sessionId;m?(this.anonymousAccessMap.set(v,M.readOnly),this.anonymousAccessLevelChangedInSessionEmitter.fire(),this.anonymousUserId=C,y.addProperty(A.TelemetryPropertyNames.IS_ANONYMOUS_ELEVATED,!1)):(this.anonymousAccessMap.set(v,M.readWrite),this.anonymousAccessLevelChangedInSessionEmitter.fire(),this.anonymousUserId=C,y.addProperty(A.TelemetryPropertyNames.IS_ANONYMOUS_ELEVATED,!0)),y.send()}))}getAnonymousAccess(h){return this.anonymousAccessMap.get(h)}getAnonymousAccessMapHasTheProfile(h){const m=h.participantId;return this.anonymousAccessMap.has(m)}clearAnonymousAccessMap(){this.anonymousAccessMap.clear()}getAccessLevelChangedUserID(){return this.anonymousUserId}}},function(h,m,y){var v,C,T=y(21),w=y(853),A=y(854),P=y(855),k=y(10);"function"==typeof Symbol&&"function"==typeof Symbol.for?(v=Symbol.for("graceful-fs.queue"),C=Symbol.for("graceful-fs.previous")):(v="___graceful-fs.queue",C="___graceful-fs.previous");var R=function noop(){};if(k.debuglog?R=k.debuglog("gfs4"):/\bgfs4\b/i.test(process.env.NODE_DEBUG||"")&&(R=function(){var h=k.format.apply(k,arguments);h="GFS4: "+h.split(/\n/).join("\nGFS4: "),console.error(h)}),!global[v]){var M=[];Object.defineProperty(global,v,{get:function(){return M}}),T.close=function(h){function close(m,y){return h.call(T,m,(function(h){h||retry(),"function"==typeof y&&y.apply(this,arguments)}))}return Object.defineProperty(close,C,{value:h}),close}(T.close),T.closeSync=function(h){function closeSync(m){h.apply(T,arguments),retry()}return Object.defineProperty(closeSync,C,{value:h}),closeSync}(T.closeSync),/\bgfs4\b/i.test(process.env.NODE_DEBUG||"")&&process.on("exit",(function(){R(global[v]),y(28).equal(global[v].length,0)}))}function patch(h){w(h),h.gracefulify=patch,h.createReadStream=function createReadStream(m,y){return new h.ReadStream(m,y)},h.createWriteStream=function createWriteStream(m,y){return new h.WriteStream(m,y)};var m=h.readFile;h.readFile=function readFile(h,y,v){"function"==typeof y&&(v=y,y=null);return function go$readFile(h,y,v){return m(h,y,(function(m){!m||"EMFILE"!==m.code&&"ENFILE"!==m.code?("function"==typeof v&&v.apply(this,arguments),retry()):enqueue([go$readFile,[h,y,v]])}))}(h,y,v)};var y=h.writeFile;h.writeFile=function writeFile(h,m,v,C){"function"==typeof v&&(C=v,v=null);return function go$writeFile(h,m,v,C){return y(h,m,v,(function(y){!y||"EMFILE"!==y.code&&"ENFILE"!==y.code?("function"==typeof C&&C.apply(this,arguments),retry()):enqueue([go$writeFile,[h,m,v,C]])}))}(h,m,v,C)};var v=h.appendFile;v&&(h.appendFile=function appendFile(h,m,y,C){"function"==typeof y&&(C=y,y=null);return function go$appendFile(h,m,y,C){return v(h,m,y,(function(v){!v||"EMFILE"!==v.code&&"ENFILE"!==v.code?("function"==typeof C&&C.apply(this,arguments),retry()):enqueue([go$appendFile,[h,m,y,C]])}))}(h,m,y,C)});var C=h.readdir;function go$readdir(m){return C.apply(h,m)}if(h.readdir=function readdir(h,m,y){var v=[h];"function"!=typeof m?v.push(m):y=m;return v.push((function go$readdir$cb(h,m){m&&m.sort&&m.sort();!h||"EMFILE"!==h.code&&"ENFILE"!==h.code?("function"==typeof y&&y.apply(this,arguments),retry()):enqueue([go$readdir,[v]])})),go$readdir(v)},"v0.8"===process.version.substr(0,4)){var T=A(h);ReadStream=T.ReadStream,WriteStream=T.WriteStream}var P=h.ReadStream;P&&(ReadStream.prototype=Object.create(P.prototype),ReadStream.prototype.open=function ReadStream$open(){var h=this;open(h.path,h.flags,h.mode,(function(m,y){m?(h.autoClose&&h.destroy(),h.emit("error",m)):(h.fd=y,h.emit("open",y),h.read())}))});var k=h.WriteStream;k&&(WriteStream.prototype=Object.create(k.prototype),WriteStream.prototype.open=function WriteStream$open(){var h=this;open(h.path,h.flags,h.mode,(function(m,y){m?(h.destroy(),h.emit("error",m)):(h.fd=y,h.emit("open",y))}))}),Object.defineProperty(h,"ReadStream",{get:function(){return ReadStream},set:function(h){ReadStream=h},enumerable:!0,configurable:!0}),Object.defineProperty(h,"WriteStream",{get:function(){return WriteStream},set:function(h){WriteStream=h},enumerable:!0,configurable:!0});var R=ReadStream;Object.defineProperty(h,"FileReadStream",{get:function(){return R},set:function(h){R=h},enumerable:!0,configurable:!0});var M=WriteStream;function ReadStream(h,m){return this instanceof ReadStream?(P.apply(this,arguments),this):ReadStream.apply(Object.create(ReadStream.prototype),arguments)}function WriteStream(h,m){return this instanceof WriteStream?(k.apply(this,arguments),this):WriteStream.apply(Object.create(WriteStream.prototype),arguments)}Object.defineProperty(h,"FileWriteStream",{get:function(){return M},set:function(h){M=h},enumerable:!0,configurable:!0});var N=h.open;function open(h,m,y,v){return"function"==typeof y&&(v=y,y=null),function go$open(h,m,y,v){return N(h,m,y,(function(C,T){!C||"EMFILE"!==C.code&&"ENFILE"!==C.code?("function"==typeof v&&v.apply(this,arguments),retry()):enqueue([go$open,[h,m,y,v]])}))}(h,m,y,v)}return h.open=open,h}function enqueue(h){R("ENQUEUE",h[0].name,h[1]),global[v].push(h)}function retry(){var h=global[v].shift();h&&(R("RETRY",h[0].name,h[1]),h[0].apply(null,h[1]))}h.exports=patch(P(T)),process.env.TEST_GRACEFUL_FS_GLOBAL_PATCH&&!T.__patched&&(h.exports=patch(T),T.__patched=!0)},function(h,m){h.exports=require("assert")},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0}),m.ObjectDisposedError=m.SshReconnectError=m.SshConnectionError=m.SshChannelError=m.BigInt=m.DerWriter=m.DerReader=m.formatBuffer=m.SshDataWriter=m.SshDataReader=m.ECDsa=m.Rsa=m.Encryption=m.HmacAlgorithm=m.EncryptionAlgorithm=m.PublicKeyAlgorithm=m.KeyExchangeAlgorithm=m.SshAlgorithms=m.CommandRequestMessage=m.ChannelRequestType=m.ChannelRequestMessage=m.ChannelOpenMessage=m.SshChannelOpenFailureReason=m.SshReconnectFailureReason=m.SshDisconnectReason=m.SessionRequestFailureMessage=m.SessionRequestSuccessMessage=m.DebugMessage=m.SessionRequestMessage=m.SshMessage=m.SshChannelClosedEventArgs=m.SshSessionClosedEventArgs=m.SshChannelOpeningEventArgs=m.SshRequestEventArgs=m.SshAuthenticatingEventArgs=m.SshAuthenticationType=m.serviceActivation=m.SshService=m.SshRpcMessageStream=m.WebSocketStream=m.NodeStream=m.BaseStream=m.SshStream=m.SshChannel=m.SshServerSession=m.SshClientSession=m.SshSession=m.SshVersionInfo=m.SshProtocolExtensionNames=m.SshSessionConfiguration=void 0,m.MultiChannelStream=m.SessionContour=m.ChannelMetrics=m.SessionMetrics=m.Queue=m.Semaphore=m.PromiseCompletionSource=m.CancellationError=m.CancellationTokenSource=m.CancellationToken=void 0;var v=y(125);Object.defineProperty(m,"SshSessionConfiguration",{enumerable:!0,get:function(){return v.SshSessionConfiguration}}),Object.defineProperty(m,"SshProtocolExtensionNames",{enumerable:!0,get:function(){return v.SshProtocolExtensionNames}});var C=y(444);Object.defineProperty(m,"SshVersionInfo",{enumerable:!0,get:function(){return C.SshVersionInfo}});var T=y(128);Object.defineProperty(m,"SshSession",{enumerable:!0,get:function(){return T.SshSession}});var w=y(1080);Object.defineProperty(m,"SshClientSession",{enumerable:!0,get:function(){return w.SshClientSession}});var A=y(1081);Object.defineProperty(m,"SshServerSession",{enumerable:!0,get:function(){return A.SshServerSession}});var P=y(255);Object.defineProperty(m,"SshChannel",{enumerable:!0,get:function(){return P.SshChannel}});var k=y(449);Object.defineProperty(m,"SshStream",{enumerable:!0,get:function(){return k.SshStream}});var R=y(1082);Object.defineProperty(m,"BaseStream",{enumerable:!0,get:function(){return R.BaseStream}}),Object.defineProperty(m,"NodeStream",{enumerable:!0,get:function(){return R.NodeStream}}),Object.defineProperty(m,"WebSocketStream",{enumerable:!0,get:function(){return R.WebSocketStream}});var M=y(1083);Object.defineProperty(m,"SshRpcMessageStream",{enumerable:!0,get:function(){return M.SshRpcMessageStream}});var N=y(177);Object.defineProperty(m,"SshService",{enumerable:!0,get:function(){return N.SshService}});var D=y(100);Object.defineProperty(m,"serviceActivation",{enumerable:!0,get:function(){return D.serviceActivation}});var I=y(259);Object.defineProperty(m,"SshAuthenticationType",{enumerable:!0,get:function(){return I.SshAuthenticationType}}),Object.defineProperty(m,"SshAuthenticatingEventArgs",{enumerable:!0,get:function(){return I.SshAuthenticatingEventArgs}});var x=y(256);Object.defineProperty(m,"SshRequestEventArgs",{enumerable:!0,get:function(){return x.SshRequestEventArgs}});var O=y(445);Object.defineProperty(m,"SshChannelOpeningEventArgs",{enumerable:!0,get:function(){return O.SshChannelOpeningEventArgs}});var L=y(448);Object.defineProperty(m,"SshSessionClosedEventArgs",{enumerable:!0,get:function(){return L.SshSessionClosedEventArgs}});var U=y(443);Object.defineProperty(m,"SshChannelClosedEventArgs",{enumerable:!0,get:function(){return U.SshChannelClosedEventArgs}});var B=y(101);Object.defineProperty(m,"SshMessage",{enumerable:!0,get:function(){return B.SshMessage}});var W=y(55);Object.defineProperty(m,"SessionRequestMessage",{enumerable:!0,get:function(){return W.SessionRequestMessage}}),Object.defineProperty(m,"DebugMessage",{enumerable:!0,get:function(){return W.DebugMessage}}),Object.defineProperty(m,"SessionRequestSuccessMessage",{enumerable:!0,get:function(){return W.SessionRequestSuccessMessage}}),Object.defineProperty(m,"SessionRequestFailureMessage",{enumerable:!0,get:function(){return W.SessionRequestFailureMessage}}),Object.defineProperty(m,"SshDisconnectReason",{enumerable:!0,get:function(){return W.SshDisconnectReason}}),Object.defineProperty(m,"SshReconnectFailureReason",{enumerable:!0,get:function(){return W.SshReconnectFailureReason}});var q=y(76);Object.defineProperty(m,"SshChannelOpenFailureReason",{enumerable:!0,get:function(){return q.SshChannelOpenFailureReason}}),Object.defineProperty(m,"ChannelOpenMessage",{enumerable:!0,get:function(){return q.ChannelOpenMessage}}),Object.defineProperty(m,"ChannelRequestMessage",{enumerable:!0,get:function(){return q.ChannelRequestMessage}}),Object.defineProperty(m,"ChannelRequestType",{enumerable:!0,get:function(){return q.ChannelRequestType}}),Object.defineProperty(m,"CommandRequestMessage",{enumerable:!0,get:function(){return q.CommandRequestMessage}});var Y=y(98);Object.defineProperty(m,"SshAlgorithms",{enumerable:!0,get:function(){return Y.SshAlgorithms}}),Object.defineProperty(m,"KeyExchangeAlgorithm",{enumerable:!0,get:function(){return Y.KeyExchangeAlgorithm}}),Object.defineProperty(m,"PublicKeyAlgorithm",{enumerable:!0,get:function(){return Y.PublicKeyAlgorithm}}),Object.defineProperty(m,"EncryptionAlgorithm",{enumerable:!0,get:function(){return Y.EncryptionAlgorithm}}),Object.defineProperty(m,"HmacAlgorithm",{enumerable:!0,get:function(){return Y.HmacAlgorithm}}),Object.defineProperty(m,"Encryption",{enumerable:!0,get:function(){return Y.Encryption}}),Object.defineProperty(m,"Rsa",{enumerable:!0,get:function(){return Y.Rsa}}),Object.defineProperty(m,"ECDsa",{enumerable:!0,get:function(){return Y.ECDsa}});var V=y(38);Object.defineProperty(m,"SshDataReader",{enumerable:!0,get:function(){return V.SshDataReader}}),Object.defineProperty(m,"SshDataWriter",{enumerable:!0,get:function(){return V.SshDataWriter}}),Object.defineProperty(m,"formatBuffer",{enumerable:!0,get:function(){return V.formatBuffer}});var $=y(251);Object.defineProperty(m,"DerReader",{enumerable:!0,get:function(){return $.DerReader}}),Object.defineProperty(m,"DerWriter",{enumerable:!0,get:function(){return $.DerWriter}});var z=y(54);Object.defineProperty(m,"BigInt",{enumerable:!0,get:function(){return z.BigInt}});var G=y(49);Object.defineProperty(m,"SshChannelError",{enumerable:!0,get:function(){return G.SshChannelError}}),Object.defineProperty(m,"SshConnectionError",{enumerable:!0,get:function(){return G.SshConnectionError}}),Object.defineProperty(m,"SshReconnectError",{enumerable:!0,get:function(){return G.SshReconnectError}}),Object.defineProperty(m,"ObjectDisposedError",{enumerable:!0,get:function(){return G.ObjectDisposedError}});var J=y(78);Object.defineProperty(m,"CancellationToken",{enumerable:!0,get:function(){return J.CancellationToken}}),Object.defineProperty(m,"CancellationTokenSource",{enumerable:!0,get:function(){return J.CancellationTokenSource}}),Object.defineProperty(m,"CancellationError",{enumerable:!0,get:function(){return J.CancellationError}});var X=y(77);Object.defineProperty(m,"PromiseCompletionSource",{enumerable:!0,get:function(){return X.PromiseCompletionSource}});var Z=y(129);Object.defineProperty(m,"Semaphore",{enumerable:!0,get:function(){return Z.Semaphore}});var ee=y(176);Object.defineProperty(m,"Queue",{enumerable:!0,get:function(){return ee.Queue}});var te=y(447);Object.defineProperty(m,"SessionMetrics",{enumerable:!0,get:function(){return te.SessionMetrics}});var re=y(442);Object.defineProperty(m,"ChannelMetrics",{enumerable:!0,get:function(){return re.ChannelMetrics}});var ie=y(1084);Object.defineProperty(m,"SessionContour",{enumerable:!0,get:function(){return ie.SessionContour}});var se=y(1085);Object.defineProperty(m,"MultiChannelStream",{enumerable:!0,get:function(){return se.MultiChannelStream}})},function(h,m,y){"use strict";function __export(h){for(var y in h)m.hasOwnProperty(y)||(m[y]=h[y])}Object.defineProperty(m,"__esModule",{value:!0});const v=y(59);m.ErrorCodes=v.ErrorCodes,m.ResponseError=v.ResponseError,m.CancellationToken=v.CancellationToken,m.CancellationTokenSource=v.CancellationTokenSource,m.Disposable=v.Disposable,m.Event=v.Event,m.Emitter=v.Emitter,m.Trace=v.Trace,m.TraceFormat=v.TraceFormat,m.SetTraceNotification=v.SetTraceNotification,m.LogTraceNotification=v.LogTraceNotification,m.RequestType=v.RequestType,m.RequestType0=v.RequestType0,m.NotificationType=v.NotificationType,m.NotificationType0=v.NotificationType0,m.MessageReader=v.MessageReader,m.MessageWriter=v.MessageWriter,m.ConnectionStrategy=v.ConnectionStrategy,m.StreamMessageReader=v.StreamMessageReader,m.StreamMessageWriter=v.StreamMessageWriter,m.IPCMessageReader=v.IPCMessageReader,m.IPCMessageWriter=v.IPCMessageWriter,m.createClientPipeTransport=v.createClientPipeTransport,m.createServerPipeTransport=v.createServerPipeTransport,m.generateRandomPipeName=v.generateRandomPipeName,m.createClientSocketTransport=v.createClientSocketTransport,m.createServerSocketTransport=v.createServerSocketTransport,m.ProgressType=v.ProgressType,__export(y(1422)),__export(y(1423));const C=y(1434),T=y(1435);!function(h){let m,y,v,w,A,P;!function(h){h.method=C.CallHierarchyPrepareRequest.method,h.type=C.CallHierarchyPrepareRequest.type}(m=h.CallHierarchyPrepareRequest||(h.CallHierarchyPrepareRequest={})),function(h){h.method=C.CallHierarchyIncomingCallsRequest.method,h.type=C.CallHierarchyIncomingCallsRequest.type}(y=h.CallHierarchyIncomingCallsRequest||(h.CallHierarchyIncomingCallsRequest={})),function(h){h.method=C.CallHierarchyOutgoingCallsRequest.method,h.type=C.CallHierarchyOutgoingCallsRequest.type}(v=h.CallHierarchyOutgoingCallsRequest||(h.CallHierarchyOutgoingCallsRequest={})),h.SemanticTokenTypes=T.SemanticTokenTypes,h.SemanticTokenModifiers=T.SemanticTokenModifiers,h.SemanticTokens=T.SemanticTokens,function(h){h.method=T.SemanticTokensRequest.method,h.type=T.SemanticTokensRequest.type}(w=h.SemanticTokensRequest||(h.SemanticTokensRequest={})),function(h){h.method=T.SemanticTokensEditsRequest.method,h.type=T.SemanticTokensEditsRequest.type}(A=h.SemanticTokensEditsRequest||(h.SemanticTokensEditsRequest={})),function(h){h.method=T.SemanticTokensRangeRequest.method,h.type=T.SemanticTokensRangeRequest.type}(P=h.SemanticTokensRangeRequest||(h.SemanticTokensRangeRequest={}))}(m.Proposed||(m.Proposed={})),m.createProtocolConnection=function createProtocolConnection(h,m,y,C){return v.createMessageConnection(h,m,y,C)}},function(h,m){h.exports=require("net")},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0});const v=y(0),C=y(2);m.userAuthStateTracker=new class UserAuthStateTracker{constructor(){this.userInfoChangedEmitter=new v.EventEmitter,this.onUserInfoChanged=this.userInfoChangedEmitter.event,this.isCustomAccount=!1,this.defaultAuthAttemptCompleteSignal=new C.Signal}get userInfo(){return this.vslsUserInfo}set userInfo(h){this.vslsUserInfo=h,this.userInfoChangedEmitter.fire()}isCurrentUserAnonymous(){return!(!this.userInfo||!this.userInfo.isAnonymous)}get IsSignedIn(){return!!this.userInfo}completeDefaultAuthAttempt(){this.defaultAuthAttemptCompleteSignal.resolve({})}}},function(h,m,y){"use strict";var v=y(388),C=Object.prototype.toString;function isArray(h){return"[object Array]"===C.call(h)}function isUndefined(h){return void 0===h}function isObject(h){return null!==h&&"object"==typeof h}function isPlainObject(h){if("[object Object]"!==C.call(h))return!1;var m=Object.getPrototypeOf(h);return null===m||m===Object.prototype}function isFunction(h){return"[object Function]"===C.call(h)}function forEach(h,m){if(null!=h)if("object"!=typeof h&&(h=[h]),isArray(h))for(var y=0,v=h.length;y<v;y++)m.call(null,h[y],y,h);else for(var C in h)Object.prototype.hasOwnProperty.call(h,C)&&m.call(null,h[C],C,h)}h.exports={isArray:isArray,isArrayBuffer:function isArrayBuffer(h){return"[object ArrayBuffer]"===C.call(h)},isBuffer:function isBuffer(h){return null!==h&&!isUndefined(h)&&null!==h.constructor&&!isUndefined(h.constructor)&&"function"==typeof h.constructor.isBuffer&&h.constructor.isBuffer(h)},isFormData:function isFormData(h){return"undefined"!=typeof FormData&&h instanceof FormData},isArrayBufferView:function isArrayBufferView(h){return"undefined"!=typeof ArrayBuffer&&ArrayBuffer.isView?ArrayBuffer.isView(h):h&&h.buffer&&h.buffer instanceof ArrayBuffer},isString:function isString(h){return"string"==typeof h},isNumber:function isNumber(h){return"number"==typeof h},isObject:isObject,isPlainObject:isPlainObject,isUndefined:isUndefined,isDate:function isDate(h){return"[object Date]"===C.call(h)},isFile:function isFile(h){return"[object File]"===C.call(h)},isBlob:function isBlob(h){return"[object Blob]"===C.call(h)},isFunction:isFunction,isStream:function isStream(h){return isObject(h)&&isFunction(h.pipe)},isURLSearchParams:function isURLSearchParams(h){return"undefined"!=typeof URLSearchParams&&h instanceof URLSearchParams},isStandardBrowserEnv:function isStandardBrowserEnv(){return("undefined"==typeof navigator||"ReactNative"!==navigator.product&&"NativeScript"!==navigator.product&&"NS"!==navigator.product)&&("undefined"!=typeof window&&"undefined"!=typeof document)},forEach:forEach,merge:function merge(){var h={};function assignValue(m,y){isPlainObject(h[y])&&isPlainObject(m)?h[y]=merge(h[y],m):isPlainObject(m)?h[y]=merge({},m):isArray(m)?h[y]=m.slice():h[y]=m}for(var m=0,y=arguments.length;m<y;m++)forEach(arguments[m],assignValue);return h},extend:function extend(h,m,y){return forEach(m,(function assignValue(m,C){h[C]=y&&"function"==typeof m?v(m,y):m})),h},trim:function trim(h){return h.trim?h.trim():h.replace(/^\s+|\s+$/g,"")},stripBOM:function stripBOM(h){return 65279===h.charCodeAt(0)&&(h=h.slice(1)),h}}},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0});const v=y(1023);class DecoratorHelper{static getCoreCommand(h){const m=h;return m.next?DecoratorHelper.getCoreCommand(m.next):m}static setupDecorator(h){return DecoratorHelper.setupDecoratorInner(m=>DecoratorHelper.buildMetaProfilingCommandDecorator(h(m)))}static setupDecoratorInner(h){return m=>{const f=function(...y){const v="f"===m.name?m.apply(this,y):DecoratorHelper.buildMetaProfilingCommandDecorator(new m(...y));return h(v)};return f.prototype=m.prototype,f}}static buildMetaProfilingCommandDecorator(h){return new v.MetaProfilingCommandDecorator(DecoratorHelper.getCoreCommand(h),h)}}m.DecoratorHelper=DecoratorHelper},function(h,m,y){var v=y(837),C=y(838),T=C;T.v1=v,T.v4=C,h.exports=T},function(h,m,y){"use strict";m.fromCallback=function(h){return Object.defineProperty((function(){if("function"!=typeof arguments[arguments.length-1])return new Promise((m,y)=>{arguments[arguments.length]=(h,v)=>{if(h)return y(h);m(v)},arguments.length++,h.apply(this,arguments)});h.apply(this,arguments)}),"name",{value:h.name})},m.fromPromise=function(h){return Object.defineProperty((function(){const m=arguments[arguments.length-1];if("function"!=typeof m)return h.apply(this,arguments);h.apply(this,arguments).then(h=>m(null,h),m)}),"name",{value:h.name})}},function(h,m,y){"use strict";var v=this&&this.__awaiter||function(h,m,y,v){return new(y||(y=Promise))((function(C,T){function fulfilled(h){try{step(v.next(h))}catch(h){T(h)}}function rejected(h){try{step(v.throw(h))}catch(h){T(h)}}function step(h){h.done?C(h.value):function adopt(h){return h instanceof y?h:new y((function(m){m(h)}))}(h.value).then(fulfilled,rejected)}step((v=v.apply(h,m||[])).next())}))};Object.defineProperty(m,"__esModule",{value:!0});const C=y(386),T=y(8),w=y(24),A=y(62),P=y(12);class ExperimentationTelemetry{setSharedProperty(h,m){T.Telemetry.addContextProperty(h,m)}postEvent(h,m){const y=new T.TelemetryEvent(h);for(let[h,v]of m)y.addProperty(h,v);y.send()}}let k;m.getExpService=function getExpService(){return k},m.initAsync=function initAsync(h,m){return v(this,void 0,void 0,(function*(){const y=`${A.LIVESHARE_EXTENSION_ID}${m?"-web":""}`,v=w.ExtensionUtil.getExtensionVersion(A.LIVESHARE_EXTENSION_ID),T=function getTargetPopulation(){return P.Settings.isVSLSTeamMember?C.TargetPopulation.Team:P.Settings.isInternalFeatureSet?C.TargetPopulation.Internal:P.Settings.isInsidersFeatureSet?C.TargetPopulation.Insiders:C.TargetPopulation.Public}();k=yield C.getExperimentationServiceAsync(y,v,T,new ExperimentationTelemetry,h.globalState)}))}},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0}),m.formatBuffer=m.SshDataWriter=m.SshDataReader=void 0;const v=y(9),C=y(98),T=y(54);class SshDataReader{constructor(h){this.buffer=h,this.position=0}get available(){return this.buffer.length-this.position}read(h){if(this.available<h)throw new Error("Attempted to read past end of buffer.");const m=this.buffer.slice(this.position,this.position+h);return this.position+=h,m}readByte(){if(0===this.available)throw new Error("Attempted to read past end of buffer.");const h=this.buffer[this.position];return this.position++,h}readBinary(){const h=this.readUInt32();if(this.available<h)throw new Error("Attempted to read past end of buffer.");const m=this.buffer.slice(this.position,this.position+h);return this.position+=h,m}readString(h){return this.readBinary().toString()}readList(h){const m=this.readString(h);return 0===m.length?[]:m.split(",")}readBoolean(){return 0!==this.readByte()}readUInt32(){if(this.available<4)throw new Error("Attempted to read past end of buffer.");const h=this.buffer[this.position+0],m=this.buffer[this.position+1],y=this.buffer[this.position+2],v=this.buffer[this.position+3];return this.position+=4,(h<<24|m<<16|y<<8|v)>>>0}readUInt64(){if(this.available<8)throw new Error("Attempted to read past end of buffer.");const h=this.buffer[this.position+0],m=this.buffer[this.position+1],y=this.buffer[this.position+2],v=this.buffer[this.position+3],C=this.buffer[this.position+4],T=this.buffer[this.position+5],w=this.buffer[this.position+6],A=this.buffer[this.position+7];return this.position+=8,4294967296*((h<<24|m<<16|y<<8|v)>>>0)+((C<<24|T<<16|w<<8|A)>>>0)}readBigInt(){const h=this.readBinary();return 0===h.length?T.BigInt.zero:T.BigInt.fromBytes(h)}}m.SshDataReader=SshDataReader,SshDataReader.mpintZero=v.Buffer.alloc(1);let w;m.SshDataWriter=class SshDataWriter{constructor(h){this.buffer=h,this.position=0}write(h){this.ensureCapacity(this.position+h.length),h.copy(this.buffer,this.position),this.position+=h.length}writeByte(h){this.ensureCapacity(this.position+1),this.buffer[this.position]=h,this.position++}writeBinary(h){this.ensureCapacity(this.position+4+h.length),this.writeUInt32(h.length),h.copy(this.buffer,this.position),this.position+=h.length}writeString(h,m){this.writeBinary(v.Buffer.from(h))}writeList(h,m){this.writeString(h?h.join(","):"",m)}writeBoolean(h){this.writeByte(h?1:0)}writeUInt32(h){this.ensureCapacity(this.position+4),this.buffer[this.position+0]=h>>>24,this.buffer[this.position+1]=h>>>16,this.buffer[this.position+2]=h>>>8,this.buffer[this.position+3]=h>>>0,this.position+=4}writeUInt64(h){this.ensureCapacity(this.position+8);const m=4294967295&h,y=(h-m)/4294967296;this.buffer[this.position+0]=y>>>24,this.buffer[this.position+1]=y>>>16,this.buffer[this.position+2]=y>>>8,this.buffer[this.position+3]=y>>>0,this.buffer[this.position+4]=m>>>24,this.buffer[this.position+5]=m>>>16,this.buffer[this.position+6]=m>>>8,this.buffer[this.position+7]=m>>>0,this.position+=8}writeBigInt(h){const m=h.toBytes();1===m.length&&0===m[0]?this.writeUInt32(0):this.writeBinary(m)}writeRandom(h){this.ensureCapacity(this.position+h);const m=this.buffer.slice(this.position,this.position+h);C.SshAlgorithms.random.getBytes(m),this.position+=h}skip(h){this.ensureCapacity(this.position+h),this.position+=h}ensureCapacity(h){if(this.buffer.length<h){let m=Math.max(512,2*this.buffer.length);for(;m<h;)m*=2;const y=v.Buffer.alloc(m);this.buffer.copy(y,0,0,this.position),this.buffer=y}}toBuffer(){return this.buffer.slice(0,this.position)}},m.formatBuffer=function formatBuffer(h,m,y){let v=`${void 0===m?"Buffer":m}[${h.length}] (${function crc32(h){w||(w=function makeCrcTable(){let h;const m=[];for(let y=0;y<256;y++){h=y;for(let m=0;m<8;m++)h=1&h?3988292384^h>>>1:h>>>1;m[y]=h}return m}());let m=-1;for(let y=0;y<h.length;y++)m=m>>>8^w[255&(m^h[y])];return(((-1^m)>>>0)+4294967296).toString(16).substr(-8).toUpperCase()}(h)})\n`;if(!1===y)return v;const C=Math.min(2048,h.length);for(let m=0;m<C;m+=16){m<1e3&&(v+="0"),m<100&&(v+="0"),m<10&&(v+="0"),v+=m+":";for(let y=m;y<m+16;y++)v+=y<C?" "+h.slice(y,y+1).toString("hex"):"   ";v+="  ";for(let y=m;y<m+16;y++)if(y<C){const m=h[y];v+=m>32&&m<=127?h.slice(y,y+1).toString():"."}else v+=" ";v+="\n"}return C<h.length&&(v+="...\n"),v}},function(h,m,y){"use strict";function __export(h){for(var y in h)m.hasOwnProperty(y)||(m[y]=h[y])}Object.defineProperty(m,"__esModule",{value:!0});var v=y(1132);m.ConnectedState=v.ConnectedState,__export(y(1133)),__export(y(1134)),__export(y(1135)),__export(y(1137)),__export(y(1138)),__export(y(1139)),__export(y(1140)),__export(y(468)),__export(y(469));var C=y(1141);m.WorkspaceClientBase=C.WorkspaceClientBase},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0}),m.formatBuffer=m.SshDataWriter=m.SshDataReader=void 0;const v=y(9),C=y(107),T=y(56);class SshDataReader{constructor(h){this.buffer=h,this.position=0}get available(){return this.buffer.length-this.position}read(h){if(this.available<h)throw new Error("Attempted to read past end of buffer.");const m=this.buffer.slice(this.position,this.position+h);return this.position+=h,m}readByte(){if(0===this.available)throw new Error("Attempted to read past end of buffer.");const h=this.buffer[this.position];return this.position++,h}readBinary(){const h=this.readUInt32();if(this.available<h)throw new Error("Attempted to read past end of buffer.");const m=this.buffer.slice(this.position,this.position+h);return this.position+=h,m}readString(h){return this.readBinary().toString()}readList(h){const m=this.readString(h);return 0===m.length?[]:m.split(",")}readBoolean(){return 0!==this.readByte()}readUInt32(){if(this.available<4)throw new Error("Attempted to read past end of buffer.");const h=this.buffer[this.position+0],m=this.buffer[this.position+1],y=this.buffer[this.position+2],v=this.buffer[this.position+3];return this.position+=4,(h<<24|m<<16|y<<8|v)>>>0}readUInt64(){if(this.available<8)throw new Error("Attempted to read past end of buffer.");const h=this.buffer[this.position+0],m=this.buffer[this.position+1],y=this.buffer[this.position+2],v=this.buffer[this.position+3],C=this.buffer[this.position+4],T=this.buffer[this.position+5],w=this.buffer[this.position+6],A=this.buffer[this.position+7];return this.position+=8,4294967296*((h<<24|m<<16|y<<8|v)>>>0)+((C<<24|T<<16|w<<8|A)>>>0)}readBigInt(){const h=this.readBinary();return 0===h.length?T.BigInt.zero:T.BigInt.fromBytes(h)}}m.SshDataReader=SshDataReader,SshDataReader.mpintZero=v.Buffer.alloc(1);let w;m.SshDataWriter=class SshDataWriter{constructor(h){this.buffer=h,this.position=0}write(h){this.ensureCapacity(this.position+h.length),h.copy(this.buffer,this.position),this.position+=h.length}writeByte(h){this.ensureCapacity(this.position+1),this.buffer[this.position]=h,this.position++}writeBinary(h){this.ensureCapacity(this.position+4+h.length),this.writeUInt32(h.length),h.copy(this.buffer,this.position),this.position+=h.length}writeString(h,m){this.writeBinary(v.Buffer.from(h))}writeList(h,m){this.writeString(h?h.join(","):"",m)}writeBoolean(h){this.writeByte(h?1:0)}writeUInt32(h){this.ensureCapacity(this.position+4),this.buffer[this.position+0]=h>>>24,this.buffer[this.position+1]=h>>>16,this.buffer[this.position+2]=h>>>8,this.buffer[this.position+3]=h>>>0,this.position+=4}writeUInt64(h){this.ensureCapacity(this.position+8);const m=4294967295&h,y=(h-m)/4294967296;this.buffer[this.position+0]=y>>>24,this.buffer[this.position+1]=y>>>16,this.buffer[this.position+2]=y>>>8,this.buffer[this.position+3]=y>>>0,this.buffer[this.position+4]=m>>>24,this.buffer[this.position+5]=m>>>16,this.buffer[this.position+6]=m>>>8,this.buffer[this.position+7]=m>>>0,this.position+=8}writeBigInt(h){const m=h.toBytes();1===m.length&&0===m[0]?this.writeUInt32(0):this.writeBinary(m)}writeRandom(h){this.ensureCapacity(this.position+h);const m=this.buffer.slice(this.position,this.position+h);C.SshAlgorithms.random.getBytes(m),this.position+=h}skip(h){this.ensureCapacity(this.position+h),this.position+=h}ensureCapacity(h){if(this.buffer.length<h){let m=Math.max(512,2*this.buffer.length);for(;m<h;)m*=2;const y=v.Buffer.alloc(m);this.buffer.copy(y,0,0,this.position),this.buffer=y}}toBuffer(){return this.buffer.slice(0,this.position)}},m.formatBuffer=function formatBuffer(h,m,y){let v=`${void 0===m?"Buffer":m}[${h.length}] (${function crc32(h){w||(w=function makeCrcTable(){let h;const m=[];for(let y=0;y<256;y++){h=y;for(let m=0;m<8;m++)h=1&h?3988292384^h>>>1:h>>>1;m[y]=h}return m}());let m=-1;for(let y=0;y<h.length;y++)m=m>>>8^w[255&(m^h[y])];return(((-1^m)>>>0)+4294967296).toString(16).substr(-8).toUpperCase()}(h)})\n`;if(!1===y)return v;const C=Math.min(2048,h.length);for(let m=0;m<C;m+=16){m<1e3&&(v+="0"),m<100&&(v+="0"),m<10&&(v+="0"),v+=m+":";for(let y=m;y<m+16;y++)v+=y<C?" "+h.slice(y,y+1).toString("hex"):"   ";v+="  ";for(let y=m;y<m+16;y++)if(y<C){const m=h[y];v+=m>32&&m<=127?h.slice(y,y+1).toString():"."}else v+=" ";v+="\n"}return C<h.length&&(v+="...\n"),v}},function(h,m){h.exports=require("child_process")},function(h,m,y){"use strict";const v=(0,y(36).fromCallback)(y(857)),C=y(858);h.exports={mkdirs:v,mkdirsSync:C,mkdirp:v,mkdirpSync:C,ensureDir:v,ensureDirSync:C}},function(h,m,y){y(11);h.exports.linebrk=function(h,m){for(var y="",v=0;v+m<h.length;)y+=h.substring(v,v+m)+"\n",v+=m;return y+h.substring(v,h.length)},h.exports.detectEnvironment=function(){return"undefined"==typeof window||!window||process&&"node"===process.title?"node":"browser"},h.exports.get32IntFromBuffer=function(h,m){m=m||0;var y;if((y=h.length-m)>0){if(y>=4)return h.readUIntBE(m,y);for(var v=0,C=m+y,T=0;C>m;C--,T+=2)v+=h[C-1]*Math.pow(16,T);return v}return NaN},h.exports._={isObject:function(h){var m=typeof h;return!!h&&("object"==m||"function"==m)},isString:function(h){return"string"==typeof h||h instanceof String},isNumber:function(h){return"number"==typeof h||!isNaN(parseFloat(h))&&isFinite(h)},omit:function(h,m){var y={};for(var v in h)h.hasOwnProperty(v)&&v!==m&&(y[v]=h[v]);return y}},h.exports.trimSurroundingText=function(h,m,y){var v=0,C=h.length,T=h.indexOf(m);T>=0&&(v=T+m.length);var w=h.indexOf(y,T);return w>=0&&(C=w),h.substring(v,C)}},function(h,m,y){var v=m.global=y(1367),C=m.hasBuffer=v&&!!v.isBuffer,T=m.hasArrayBuffer="undefined"!=typeof ArrayBuffer,w=m.isArray=y(186);m.isArrayBuffer=T?function isArrayBuffer(h){return h instanceof ArrayBuffer||D(h)}:_false;var A=m.isBuffer=C?v.isBuffer:_false,P=m.isView=T?ArrayBuffer.isView||_is("ArrayBuffer","buffer"):_false;m.alloc=alloc,m.concat=function concat(h,y){y||(y=0,Array.prototype.forEach.call(h,(function dryrun(h){y+=h.length})));var v=this!==m&&this||h[0],C=alloc.call(v,y),T=0;return Array.prototype.forEach.call(h,(function append(h){T+=N.copy.call(h,C,T)})),C},m.from=function from(h){return"string"==typeof h?fromString.call(this,h):auto(this).from(h)};var k=m.Array=y(1368),R=m.Buffer=y(1369),M=m.Uint8Array=y(1370),N=m.prototype=y(311);function alloc(h){return auto(this).alloc(h)}var D=_is("ArrayBuffer");function fromString(h){var m=3*h.length,y=alloc.call(this,m),v=N.write.call(y,h);return m!==v&&(y=N.slice.call(y,0,v)),y}function auto(h){return A(h)?R:P(h)?M:w(h)?k:C?R:T?M:k}function _false(){return!1}function _is(h,m){return h="[object "+h+"]",function(y){return null!=y&&{}.toString.call(m?y[m]:y)===h}}},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0});const v=y(59);class ProtocolRequestType0 extends v.RequestType0{constructor(h){super(h)}}m.ProtocolRequestType0=ProtocolRequestType0;class ProtocolRequestType extends v.RequestType{constructor(h){super(h)}}m.ProtocolRequestType=ProtocolRequestType;class ProtocolNotificationType extends v.NotificationType{constructor(h){super(h)}}m.ProtocolNotificationType=ProtocolNotificationType;class ProtocolNotificationType0 extends v.NotificationType0{constructor(h){super(h)}}m.ProtocolNotificationType0=ProtocolNotificationType0},function(h,m){h.exports=require("https")},function(h,m){h.exports=require("zlib")},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0}),m.traceData=m.trace=void 0;const v=y(435).name.replace(/^@\w+\//,""),C=y(164),T=C(v);m.trace=T;const w=C(v+":ssh"),A=C(v+":data");m.traceData=A,w.enabled&&(T.enabled=!0)},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0}),m.ObjectDisposedError=m.SshChannelError=m.SshReconnectError=m.SshConnectionError=void 0;class SshConnectionError extends Error{constructor(h,m){super(h),this.reason=m}}m.SshConnectionError=SshConnectionError;class SshReconnectError extends Error{constructor(h,m){super(h),this.reason=m}}m.SshReconnectError=SshReconnectError;class SshChannelError extends Error{constructor(h,m){super(h),this.reason=m}}m.SshChannelError=SshChannelError;class ObjectDisposedError extends Error{constructor(h){var m,y;let v;v="string"==typeof h?h:"function"==typeof h?h.name+" disposed.":(null!==(y=null===(m=null==h?void 0:h.constructor)||void 0===m?void 0:m.name)&&void 0!==y?y:"Object ")+" disposed.",super(v)}}m.ObjectDisposedError=ObjectDisposedError},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0}),m.traceData=m.trace=void 0;const v=y(511).name.replace(/^@\w+\//,""),C=y(164),T=C(v);m.trace=T;const w=C(v+":ssh"),A=C(v+":data");m.traceData=A,w.enabled&&(T.enabled=!0)},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0}),m.ObjectDisposedError=m.SshChannelError=m.SshReconnectError=m.SshConnectionError=void 0;class SshConnectionError extends Error{constructor(h,m){super(h),this.reason=m}}m.SshConnectionError=SshConnectionError;class SshReconnectError extends Error{constructor(h,m){super(h),this.reason=m}}m.SshReconnectError=SshReconnectError;class SshChannelError extends Error{constructor(h,m){super(h),this.reason=m}}m.SshChannelError=SshChannelError;class ObjectDisposedError extends Error{constructor(h){var m,y;let v;v="string"==typeof h?h:"function"==typeof h?h.name+" disposed.":(null!==(y=null===(m=null==h?void 0:h.constructor)||void 0===m?void 0:m.name)&&void 0!==y?y:"Object ")+" disposed.",super(v)}}m.ObjectDisposedError=ObjectDisposedError},function(h,m){h.exports=require("http")},function(h,m,y){"use strict";var v=this&&this.__awaiter||function(h,m,y,v){return new(y||(y=Promise))((function(C,T){function fulfilled(h){try{step(v.next(h))}catch(h){T(h)}}function rejected(h){try{step(v.throw(h))}catch(h){T(h)}}function step(h){h.done?C(h.value):function adopt(h){return h instanceof y?h:new y((function(m){m(h)}))}(h.value).then(fulfilled,rejected)}step((v=v.apply(h,m||[])).next())}))};Object.defineProperty(m,"__esModule",{value:!0});const C=y(7),T=y(35),w=y(0),A=y(4),P=y(61),k=y(404),R=y(22),M=y(23),N=y(12),D=y(231),I=y(405);class PathManager{constructor(h,m){this.forcePrefixedRoot=h,this.fileService=m,this.localPathsToVslsPaths=new Map,this.vslsPathsToLocalPaths=new Map,this.scheme=`${N.Settings.scheme}:`}init(){return v(this,void 0,void 0,(function*(){this.fileService().onExternalFilesChanged(h=>{h.changeType===A.vsls.CollectionChangeType.Add&&this.registerExternalFilesAsync(h.localPaths,h.vslsPaths)})}))}registerExternalFilesAsync(h,m){return v(this,void 0,void 0,(function*(){if(null!=h)for(let y=0;y<h.length;++y){let v=P.PathUtil.normalizePath(h[y]),C=P.PathUtil.normalizePath(m[y]);this.localPathsToVslsPaths.set(v,C),this.vslsPathsToLocalPaths.set(C,v)}}))}code2ProtocolUriConverter(h){if(!h)return;if("http"===h.scheme.toLowerCase()||"https"===h.scheme.toLowerCase()||"command"===h.scheme.toLowerCase())return h.toString();const m=this.code2protocolWorkspaceFilesOnly(h);if(null!==m)return m.toString();let y=h.toString();if(this.localPathsToVslsPaths.has(y))return`${PathManager.rawScheme}:${this.localPathsToVslsPaths.get(y)}`;let v=C.basename(h.fsPath),A=T(),P=w.Uri.parse(`${N.Settings.scheme}:${PathManager.externalPrefix}/${A}/${v}`).toString().toLowerCase();return this.fileService().registerNamedExternalFilesAsync([y],[A]),P}code2protocolWorkspaceFilesOnly(h){let m=w.workspace.getWorkspaceFolder(h);if(!m)return null;const y=w.workspace.asRelativePath(h,!1),v=P.PathUtil.convertToForwardSlashes(y);let C="";return(m.index>0||this.forcePrefixedRoot)&&(C=`~${m.index}/`),w.Uri.parse(`${this.scheme}/${C}${v}`)}protocol2CodeUriConverter(h){if(h)return this.protocolUri2CodeUriConverter(w.Uri.parse(h))}isExternalVslsPath(h){return h.startsWith(PathManager.externalPrefix)&&h.length>PathManager.externalPrefix.length+1}protocolUri2CodeUriConverter(h){const m=w.workspace.workspaceFolders?w.workspace.workspaceFolders[0]:null,y=h.scheme.toLowerCase(),v=h.path.startsWith(PathManager.notebookCellPrefix);if(y===PathManager.rawScheme&&m&&m.uri.scheme===PathManager.rawScheme||"http"===y||"https"===y)return h.path.startsWith(PathManager.gitPrefix)?this.LiveShareSourceControlUriFromRelativeGitUri(h):v?this.NotebookCellUriFromRelativeNotebookCellUri(h):h;if(y!==PathManager.rawScheme)throw new Error("Unknown path format from the client");if(h.path.startsWith(PathManager.untitledPrefix))return w.Uri.parse(`${PathManager.untitledScheme}:${C.basename(h.path)}`);if(h.path.startsWith(PathManager.gitPrefix))return this.GitUriFromRelativeGitUri(h);if(v)return this.NotebookCellUriFromRelativeNotebookCellUri(h);if((M.sessionStateTracker.State===R.SessionState.Shared||M.sessionStateTracker.State===R.SessionState.SharingInProgress)&&this.isExternalVslsPath(h.path)){let m=h.path,y=this.vslsPathsToLocalPaths.get(m);if(y)return w.Uri.parse(y)}if(!m)return h;let{moniker:T,relativePath:A}=P.PathUtil.getMonikerFromUri(h),k=parseInt(T,10);if(void 0===w.Uri.joinPath){let y=m.uri.fsPath;if(""!==T){const m=w.workspace.workspaceFolders[k];if(!m)return h;y=m.uri.fsPath}return(y.endsWith("/")||y.endsWith("\\"))&&(y=y.substr(0,y.length-1)),(A.startsWith("/")||A.startsWith("\\"))&&(A=A.substring(1)),w.Uri.file(C.join(y,A))}let N=m.uri;if(""!==T){const m=w.workspace.workspaceFolders[k];if(!m)return h;N=m.uri}return N.path.length>1&&(N.path.endsWith("/")||N.path.endsWith("\\"))&&(N=N.with({path:N.path.substring(0,N.path.length-1)})),w.Uri.joinPath(N,A)}relativePathToLocalPath(h){if(!h)return null;if(h.startsWith(this.scheme)||h.startsWith("file:"))throw new Error("Supplied path is not a relative path");let m=null;return m=h.startsWith("/")?`${this.scheme}${h}`:`${this.scheme}/${h}`,this.protocol2CodeUriConverter(m)}localPathToRelativePath(h){if(!h||h.scheme===PathManager.outputScheme)return null;if(h.scheme===PathManager.rawScheme)return h.path;if(h.scheme!==PathManager.gitScheme&&h.scheme!==PathManager.vslsSccScheme&&h.scheme!==PathManager.notebookCellScheme){if(!!!w.workspace.getWorkspaceFolder(h)){if(M.sessionStateTracker.State===R.SessionState.Shared||M.sessionStateTracker.State===R.SessionState.SharingInProgress){if(h.scheme===PathManager.untitledScheme){let m=this.localPathsToVslsPaths.get(h.fsPath);if(!m){let y=T().replace(/-/g,"");const v=w.workspace.asRelativePath(h,!1);return m=`${PathManager.untitledPrefix}/${y}/${v}`,this.localPathsToVslsPaths.set(h.fsPath,m),this.vslsPathsToLocalPaths.set(m,h.fsPath),m}return m}let m=P.PathUtil.normalizePath(h.toString()),y=this.localPathsToVslsPaths.get(m);if(y)return y}return null}}if(h.scheme===PathManager.gitScheme){let m=w.workspace.asRelativePath(h.fsPath,!1);return this.RelativeGitUriFromGitUri(h,m)}if(h.scheme===PathManager.vslsSccScheme)return this.RelativeGitUriFromLiveShareSourceControlUri(h);if(h.scheme===PathManager.notebookCellScheme)return this.RelativeNotebookCellPathFromLocalNotebookCellUri(h);const m=this.code2protocolWorkspaceFilesOnly(h);return null==m?void 0:m.path}getFromVslsPathsToLocalPaths(h){return this.vslsPathsToLocalPaths.get(h)}deleteFromVslsPathsToLocalPaths(h){return this.vslsPathsToLocalPaths.delete(h)}getFromLocalPathsToVslsPaths(h){return this.localPathsToVslsPaths.get(h)}deleteFromLocalPathsToVslsPaths(h){return this.localPathsToVslsPaths.delete(h)}LiveShareSourceControlUriFromRelativeGitUri(h){const m=this.GetRelativeGitUriDetails(h.path);if(m){let h=m.ref,y=m.hostPath;y.startsWith("/")&&(y=y.slice(1,y.length));let v=w.Uri.file(y),C=m.guestPath,T={path:v.fsPath,version:JSON.stringify({ref:h}),sccId:1,groupId:"workingTree",resourceUri:C};const A=`vsls-scc:${v.fsPath}?${JSON.stringify(T)}`;return w.Uri.parse(A)}return null}resourceUriFromLiveShareSourceControlUri(h){let m=JSON.parse(h.query).resourceUri;return w.Uri.parse(m)}RelativeGitUriFromLiveShareSourceControlUri(h){let m=JSON.parse(h.query),y=void 0,v=null==m?void 0:m.version;if(v){let h=JSON.parse(v);y=null==h?void 0:h.ref}y||(y="~");let C=P.PathUtil.convertToForwardSlashes(h.path);return C.startsWith("/")&&(C=C.slice(1,C.length)),`${PathManager.gitPrefix}/${y}/${C}::${m.resourceUri}`}RelativeGitUriFromGitUri(h,m){let y=JSON.parse(h.query);return`${PathManager.gitPrefix}/${y.ref}${h.path}::${this.scheme}/${m}`}GitUriFromRelativeGitUri(h){const m=this.GetRelativeGitUriDetails(h.path);if(m){let h={path:w.Uri.file(m.hostPath).fsPath,ref:m.ref};return w.Uri.parse(`${PathManager.gitScheme}:/${m.hostPath}?${JSON.stringify(h)}`)}return null}GetRelativeGitUriDetails(h){if(h.startsWith("/~git/")){let m=h.substr("/~git/".length,h.length-"/~git/".length),y=m.indexOf("/"),v=m.substr(0,y),C=m.substr(y+1,m.length-y).split("::");if(2===C.length)return{ref:v,hostPath:C[0],guestPath:C[1]}}return null}RelativeNotebookCellPathFromLocalNotebookCellUri(h){var m;const y=null===(m=w.workspace.notebookDocuments)||void 0===m?void 0:m.find(m=>m.uri.path===h.path);if(!y)return null;const v=this.localPathToRelativePath(y.uri),C=y.notebookType.startsWith(D.NotebookConstants.mirrorNotebookTypePrefix)?y.notebookType.substring(D.NotebookConstants.mirrorNotebookTypePrefix.length):y.notebookType,T=I.findNotebookCell(h);if(!T)return null;const A=I.getCellId(T);return A?`${PathManager.notebookCellPrefix}${v}?${C}#${A}`:null}getLocalNotebookUriFromRelativeNotebookCellUri(h){const m=h.path.substring(PathManager.notebookCellPrefix.length);return this.relativePathToLocalPath(m)}NotebookCellUriFromRelativeNotebookCellUri(h){var m,y;const v=this.getLocalNotebookUriFromRelativeNotebookCellUri(h);return null===(y=null===(m=I.findNotebookCellById(v,h.fragment))||void 0===m?void 0:m.document)||void 0===y?void 0:y.uri}openNotebookCellDocument(h,m=!1){return v(this,void 0,void 0,(function*(){const y=w.Uri.parse(h),v=this.getLocalNotebookUriFromRelativeNotebookCellUri(y);if(yield w.workspace.openNotebookDocument(v))return this.openRelativePath(h,m,!1);throw new Error(`Could not open notebook ${h}`)}))}openRelativePath(h,m=!1,y=!0){return v(this,void 0,void 0,(function*(){const v=this.relativePathToLocalPath(h);if(v){if(v.scheme===PathManager.notebookCellScheme){const h=I.findNotebookCell(v),y=null==h?void 0:h.document;return m&&h&&(yield w.window.showNotebookDocument(null==h?void 0:h.notebook)),k.assert(null!==y,"Notebook cell document should be non-null"),y}const h=yield w.workspace.openTextDocument(v);return m&&(yield w.window.showTextDocument(h)),h}if(h.startsWith(PathManager.notebookCellPrefix)&&y)return this.openNotebookCellDocument(h,m);throw new Error(`Could not open relative path ${h}`)}))}dispose(){return v(this,void 0,void 0,(function*(){this.localPathsToVslsPaths.clear(),this.vslsPathsToLocalPaths.clear()}))}}m.PathManager=PathManager,PathManager.outputScheme="output",PathManager.githubDevScheme="vscode-vfs",PathManager.fileScheme="file",PathManager.gitScheme="git",PathManager.vslsSccScheme="vsls-scc",PathManager.externalPrefix="/~external",PathManager.untitledPrefix="/~untitled",PathManager.gitPrefix="/~git",PathManager.untitledScheme="untitled",PathManager.notebookCellScheme="vscode-notebook-cell",PathManager.notebookCellPrefix="/~notebook",PathManager.rawScheme=N.Settings.scheme,m.VSLS_SCHEME=PathManager.rawScheme,m.FILE_SCHEME=PathManager.fileScheme,m.GITHUB_DEV_SCHEME=PathManager.githubDevScheme,m.KNOWN_SCHEMES=["http","https",m.VSLS_SCHEME]},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0}),m.BigInt=void 0;const v=y(9),C=y(38);class BigInt{constructor(h){if(this.buffer=h,0===h.length)throw new Error("BigInt buffer length must be greater than zero.")}get sign(){const h=this.buffer[0];return 0===h?this.buffer.length>1?1:0:0==(128&h)?1:-1}static fromInt32(h){if(0===h)return BigInt.zero;let m=!1;h<0&&(m=!0,h=-h);const y=[];for(let m=24;m>=0;m-=8)(h>=1<<m||y.length>0)&&(y.push(h>>m),h&=~((1<<m)-1));return m&&(0==(128&y[0])?y[0]|=128:y.splice(0,0,128)),new BigInt(v.Buffer.from(new Uint8Array(y)))}toInt32(){if(this.buffer.length>4)throw new TypeError("BigInt value cannot be converted to a 32-bit signed integer.");let h=this.buffer[0];this.sign<0&&(h&=127);for(let m=1;m<this.buffer.length;m++)h=(h<<8)+this.buffer[m];return this.sign<0&&(h=-h),h}static fromBytes(h,m){if(!v.Buffer.isBuffer(h))throw new TypeError("Buffer expected.");if(0===h.length)throw new Error("BigInt buffer length must be greater than zero.");m=null!=m?m:{};const y=0!=(128&h[0]),C=m.unsigned&&y?1:0;let T=0;for(let m=0;m<h.length-1&&0===h[m];m++)0==(128&h[m+1])&&T++;const w=v.Buffer.alloc(h.length+C-T);return h.copy(w,C,T,h.length),new BigInt(w)}toBytes(h){h=null!=h?h:{};let m=this.buffer;if(h.unsigned){if(this.sign<0)throw new TypeError("Cannot format a negative BigInt as unsigned.");if(0===m[0]&&m.length>1&&(m=m.slice(1,m.length)),void 0!==h.length){if(m.length>h.length)throw new Error(`BigInt (${m.length} bytes) is too large for length ${h.length}.`);if(m.length<h.length){const y=v.Buffer.alloc(h.length);return m.copy(y,h.length-m.length),y}}}const y=v.Buffer.alloc(m.length);return m.copy(y,0,0,m.length),y}copyTo(h,m=0){this.buffer.copy(h,m,0,this.buffer.length)}equals(h){return h instanceof BigInt&&this.buffer.equals(h.buffer)}toString(h){return(0,C.formatBuffer)(this.buffer,null!=h?h:"BigInt")}}m.BigInt=BigInt,BigInt.zero=new BigInt(v.Buffer.alloc(1))},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0}),m.SessionReconnectFailureMessage=m.SshReconnectFailureReason=m.SessionReconnectResponseMessage=m.SessionReconnectRequestMessage=m.SessionChannelRequestMessage=m.ExtensionInfoMessage=m.SessionRequestFailureMessage=m.SessionRequestSuccessMessage=m.SessionRequestMessage=m.ServiceAcceptMessage=m.ServiceRequestMessage=m.DebugMessage=m.UnimplementedMessage=m.IgnoreMessage=m.DisconnectMessage=m.SshDisconnectReason=void 0;const v=y(101),C=y(76);var T;!function(h){h[h.none=0]="none",h[h.hostNotAllowedToConnect=1]="hostNotAllowedToConnect",h[h.protocolError=2]="protocolError",h[h.keyExchangeFailed=3]="keyExchangeFailed",h[h.reserved=4]="reserved",h[h.macError=5]="macError",h[h.compressionError=6]="compressionError",h[h.serviceNotAvailable=7]="serviceNotAvailable",h[h.protocolVersionNotSupported=8]="protocolVersionNotSupported",h[h.hostKeyNotVerifiable=9]="hostKeyNotVerifiable",h[h.connectionLost=10]="connectionLost",h[h.byApplication=11]="byApplication",h[h.tooManyConnections=12]="tooManyConnections",h[h.authCancelledByUser=13]="authCancelledByUser",h[h.noMoreAuthMethodsAvailable=14]="noMoreAuthMethodsAvailable",h[h.illegalUserName=15]="illegalUserName"}(m.SshDisconnectReason||(m.SshDisconnectReason={}));class DisconnectMessage extends v.SshMessage{get messageType(){return 1}onRead(h){this.reasonCode=h.readUInt32(),this.description=h.readString("utf8"),h.available>=4?this.language=h.readString("ascii"):this.language=null}onWrite(h){h.writeUInt32(this.validateField(this.reasonCode,"reason code")),h.writeString(this.description||"","utf8"),this.language&&h.writeString(this.language,"ascii")}}m.DisconnectMessage=DisconnectMessage;class IgnoreMessage extends v.SshMessage{get messageType(){return 2}onRead(h){}onWrite(h){}}m.IgnoreMessage=IgnoreMessage;class UnimplementedMessage extends v.SshMessage{get messageType(){return 3}onRead(h){this.sequenceNumber=h.readUInt32()}onWrite(h){h.writeUInt32(this.validateField(this.sequenceNumber,"sequence number"))}toString(){return this.unimplementedMessageType?`${super.toString()} (messageType=${this.unimplementedMessageType})`:`${super.toString()} (sequenceNumber=${this.sequenceNumber})`}}m.UnimplementedMessage=UnimplementedMessage;class DebugMessage extends v.SshMessage{constructor(h){super(),this.alwaysDisplay=!1,this.message=h}get messageType(){return 4}onRead(h){this.alwaysDisplay=h.readBoolean(),this.message=h.readString("utf8"),this.language=h.readString("ascii")}onWrite(h){var m,y;h.writeBoolean(this.alwaysDisplay),h.writeString(null!==(m=this.message)&&void 0!==m?m:"","utf8"),h.writeString(null!==(y=this.language)&&void 0!==y?y:"","ascii")}toString(){return`${super.toString()}: ${this.message}`}}m.DebugMessage=DebugMessage;class ServiceRequestMessage extends v.SshMessage{get messageType(){return 5}onRead(h){this.serviceName=h.readString("ascii")}onWrite(h){h.writeString(this.validateField(this.serviceName,"service name"),"ascii")}}m.ServiceRequestMessage=ServiceRequestMessage;class ServiceAcceptMessage extends v.SshMessage{get messageType(){return 6}onRead(h){this.serviceName=h.readString("ascii")}onWrite(h){h.writeString(this.validateField(this.serviceName,"service name"),"ascii")}}m.ServiceAcceptMessage=ServiceAcceptMessage;class SessionRequestMessage extends v.SshMessage{constructor(h,m){super(),this.requestType=h,this.wantReply=null!=m&&m}get messageType(){return 80}onRead(h){this.requestType=h.readString("ascii"),this.wantReply=h.readBoolean()}onWrite(h){h.writeString(this.validateField(this.requestType,"request type"),"ascii"),h.writeBoolean(this.wantReply)}toString(){return`${super.toString()} (requestType=${this.requestType})`}}m.SessionRequestMessage=SessionRequestMessage;class SessionRequestSuccessMessage extends v.SshMessage{get messageType(){return 81}onRead(h){}onWrite(h){}}m.SessionRequestSuccessMessage=SessionRequestSuccessMessage;class SessionRequestFailureMessage extends v.SshMessage{get messageType(){return 82}onRead(h){}onWrite(h){}}m.SessionRequestFailureMessage=SessionRequestFailureMessage;class ExtensionInfoMessage extends v.SshMessage{constructor(){super(...arguments),this.extensionInfo={}}get messageType(){return 7}onRead(h){const m=h.readUInt32();this.extensionInfo={};for(let y=0;y<m;y++){const m=h.readString("ascii"),y=h.readString("utf8");this.extensionInfo[m]=y}}onWrite(h){const m=Object.keys(this.extensionInfo);h.writeUInt32(m.length);for(let y of m)h.writeString(y,"ascii"),h.writeString(this.extensionInfo[y]||"","utf8")}toString(){let h="";for(const[m,y]of Object.entries(this.extensionInfo))h&&(h+="; "),h+=m,y&&(h+="="+y);return`${super.toString()} (${h})`}}m.ExtensionInfoMessage=ExtensionInfoMessage,ExtensionInfoMessage.serverIndicator="ext-info-c",ExtensionInfoMessage.clientIndicator="ext-info-c";m.SessionChannelRequestMessage=class SessionChannelRequestMessage extends SessionRequestMessage{onRead(h){super.onRead(h),this.senderChannel=h.readUInt32();const m=new C.ChannelRequestMessage;m.read(h),this.request=m}onWrite(h){super.onWrite(h),h.writeUInt32(this.validateField(this.senderChannel,"sender channel")),this.validateField(this.request,"request message").write(h)}};m.SessionReconnectRequestMessage=class SessionReconnectRequestMessage extends SessionRequestMessage{onRead(h){super.onRead(h),this.clientReconnectToken=h.readBinary(),this.lastReceivedSequenceNumber=h.readUInt64()}onWrite(h){super.onWrite(h),h.writeBinary(this.validateField(this.clientReconnectToken,"clientReconnectToken")),h.writeUInt64(this.validateField(this.lastReceivedSequenceNumber,"lastReceivedSequenceNumber"))}};m.SessionReconnectResponseMessage=class SessionReconnectResponseMessage extends SessionRequestSuccessMessage{onRead(h){super.onRead(h),this.serverReconnectToken=h.readBinary(),this.lastReceivedSequenceNumber=h.readUInt64()}onWrite(h){super.onWrite(h),h.writeBinary(this.validateField(this.serverReconnectToken,"serverReconnectToken")),h.writeUInt64(this.validateField(this.lastReceivedSequenceNumber,"lastReceivedSequenceNumber"))}},function(h){h[h.none=0]="none",h[h.unknownServerFailure=1]="unknownServerFailure",h[h.sessionNotFound=2]="sessionNotFound",h[h.invalidClientReconnectToken=3]="invalidClientReconnectToken",h[h.serverDroppedMessages=4]="serverDroppedMessages",h[h.unknownClientFailure=101]="unknownClientFailure",h[h.differentServerHostKey=102]="differentServerHostKey",h[h.invalidServerReconnectToken=103]="invalidServerReconnectToken",h[h.clientDroppedMessages=104]="clientDroppedMessages"}(T=m.SshReconnectFailureReason||(m.SshReconnectFailureReason={}));m.SessionReconnectFailureMessage=class SessionReconnectFailureMessage extends SessionRequestFailureMessage{onRead(h){h.available>0&&(this.reasonCode=h.readUInt32(),this.description=h.readString("utf8"),this.language=h.readString("ascii"))}onWrite(h){h.writeUInt32(this.validateField(this.reasonCode,"reason code")),h.writeString(this.description||"","utf8"),h.writeString(this.language||"en","ascii")}toString(){return`${super.toString} (${T[this.reasonCode||0]}: ${this.description})`}},v.SshMessage.index.set(1,DisconnectMessage),v.SshMessage.index.set(2,IgnoreMessage),v.SshMessage.index.set(3,UnimplementedMessage),v.SshMessage.index.set(5,ServiceRequestMessage),v.SshMessage.index.set(6,ServiceAcceptMessage),v.SshMessage.index.set(7,ExtensionInfoMessage),v.SshMessage.index.set(80,SessionRequestMessage),v.SshMessage.index.set(81,SessionRequestSuccessMessage),v.SshMessage.index.set(82,SessionRequestFailureMessage)},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0}),m.BigInt=void 0;const v=y(9),C=y(40);class BigInt{constructor(h){if(this.buffer=h,0===h.length)throw new Error("BigInt buffer length must be greater than zero.")}get sign(){const h=this.buffer[0];return 0===h?this.buffer.length>1?1:0:0==(128&h)?1:-1}static fromInt32(h){if(0===h)return BigInt.zero;let m=!1;h<0&&(m=!0,h=-h);const y=[];for(let m=24;m>=0;m-=8)(h>=1<<m||y.length>0)&&(y.push(h>>m),h&=~((1<<m)-1));return m&&(0==(128&y[0])?y[0]|=128:y.splice(0,0,128)),new BigInt(v.Buffer.from(new Uint8Array(y)))}toInt32(){if(this.buffer.length>4)throw new TypeError("BigInt value cannot be converted to a 32-bit signed integer.");let h=this.buffer[0];this.sign<0&&(h&=127);for(let m=1;m<this.buffer.length;m++)h=(h<<8)+this.buffer[m];return this.sign<0&&(h=-h),h}static fromBytes(h,m){if(!v.Buffer.isBuffer(h))throw new TypeError("Buffer expected.");if(0===h.length)throw new Error("BigInt buffer length must be greater than zero.");m=null!=m?m:{};const y=0!=(128&h[0]),C=m.unsigned&&y?1:0;let T=0;for(let m=0;m<h.length-1&&0===h[m];m++)0==(128&h[m+1])&&T++;const w=v.Buffer.alloc(h.length+C-T);return h.copy(w,C,T,h.length),new BigInt(w)}toBytes(h){h=null!=h?h:{};let m=this.buffer;if(h.unsigned){if(this.sign<0)throw new TypeError("Cannot format a negative BigInt as unsigned.");if(0===m[0]&&m.length>1&&(m=m.slice(1,m.length)),void 0!==h.length){if(m.length>h.length)throw new Error(`BigInt (${m.length} bytes) is too large for length ${h.length}.`);if(m.length<h.length){const y=v.Buffer.alloc(h.length);return m.copy(y,h.length-m.length),y}}}const y=v.Buffer.alloc(m.length);return m.copy(y,0,0,m.length),y}copyTo(h,m=0){this.buffer.copy(h,m,0,this.buffer.length)}equals(h){return h instanceof BigInt&&this.buffer.equals(h.buffer)}toString(h){return(0,C.formatBuffer)(this.buffer,null!=h?h:"BigInt")}}m.BigInt=BigInt,BigInt.zero=new BigInt(v.Buffer.alloc(1))},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0}),m.SessionReconnectFailureMessage=m.SshReconnectFailureReason=m.SessionReconnectResponseMessage=m.SessionReconnectRequestMessage=m.SessionChannelRequestMessage=m.ExtensionInfoMessage=m.SessionRequestFailureMessage=m.SessionRequestSuccessMessage=m.SessionRequestMessage=m.ServiceAcceptMessage=m.ServiceRequestMessage=m.DebugMessage=m.UnimplementedMessage=m.IgnoreMessage=m.DisconnectMessage=m.SshDisconnectReason=void 0;const v=y(109),C=y(81);var T;!function(h){h[h.none=0]="none",h[h.hostNotAllowedToConnect=1]="hostNotAllowedToConnect",h[h.protocolError=2]="protocolError",h[h.keyExchangeFailed=3]="keyExchangeFailed",h[h.reserved=4]="reserved",h[h.macError=5]="macError",h[h.compressionError=6]="compressionError",h[h.serviceNotAvailable=7]="serviceNotAvailable",h[h.protocolVersionNotSupported=8]="protocolVersionNotSupported",h[h.hostKeyNotVerifiable=9]="hostKeyNotVerifiable",h[h.connectionLost=10]="connectionLost",h[h.byApplication=11]="byApplication",h[h.tooManyConnections=12]="tooManyConnections",h[h.authCancelledByUser=13]="authCancelledByUser",h[h.noMoreAuthMethodsAvailable=14]="noMoreAuthMethodsAvailable",h[h.illegalUserName=15]="illegalUserName"}(m.SshDisconnectReason||(m.SshDisconnectReason={}));class DisconnectMessage extends v.SshMessage{get messageType(){return 1}onRead(h){this.reasonCode=h.readUInt32(),this.description=h.readString("utf8"),h.available>=4?this.language=h.readString("ascii"):this.language=null}onWrite(h){h.writeUInt32(this.validateField(this.reasonCode,"reason code")),h.writeString(this.description||"","utf8"),this.language&&h.writeString(this.language,"ascii")}}m.DisconnectMessage=DisconnectMessage;class IgnoreMessage extends v.SshMessage{get messageType(){return 2}onRead(h){}onWrite(h){}}m.IgnoreMessage=IgnoreMessage;class UnimplementedMessage extends v.SshMessage{get messageType(){return 3}onRead(h){this.sequenceNumber=h.readUInt32()}onWrite(h){h.writeUInt32(this.validateField(this.sequenceNumber,"sequence number"))}toString(){return this.unimplementedMessageType?`${super.toString()} (messageType=${this.unimplementedMessageType})`:`${super.toString()} (sequenceNumber=${this.sequenceNumber})`}}m.UnimplementedMessage=UnimplementedMessage;class DebugMessage extends v.SshMessage{constructor(h){super(),this.alwaysDisplay=!1,this.message=h}get messageType(){return 4}onRead(h){this.alwaysDisplay=h.readBoolean(),this.message=h.readString("utf8"),this.language=h.readString("ascii")}onWrite(h){var m,y;h.writeBoolean(this.alwaysDisplay),h.writeString(null!==(m=this.message)&&void 0!==m?m:"","utf8"),h.writeString(null!==(y=this.language)&&void 0!==y?y:"","ascii")}toString(){return`${super.toString()}: ${this.message}`}}m.DebugMessage=DebugMessage;class ServiceRequestMessage extends v.SshMessage{get messageType(){return 5}onRead(h){this.serviceName=h.readString("ascii")}onWrite(h){h.writeString(this.validateField(this.serviceName,"service name"),"ascii")}}m.ServiceRequestMessage=ServiceRequestMessage;class ServiceAcceptMessage extends v.SshMessage{get messageType(){return 6}onRead(h){this.serviceName=h.readString("ascii")}onWrite(h){h.writeString(this.validateField(this.serviceName,"service name"),"ascii")}}m.ServiceAcceptMessage=ServiceAcceptMessage;class SessionRequestMessage extends v.SshMessage{constructor(h,m){super(),this.requestType=h,this.wantReply=null!=m&&m}get messageType(){return 80}onRead(h){this.requestType=h.readString("ascii"),this.wantReply=h.readBoolean()}onWrite(h){h.writeString(this.validateField(this.requestType,"request type"),"ascii"),h.writeBoolean(this.wantReply)}toString(){return`${super.toString()} (requestType=${this.requestType})`}}m.SessionRequestMessage=SessionRequestMessage;class SessionRequestSuccessMessage extends v.SshMessage{get messageType(){return 81}onRead(h){}onWrite(h){}}m.SessionRequestSuccessMessage=SessionRequestSuccessMessage;class SessionRequestFailureMessage extends v.SshMessage{get messageType(){return 82}onRead(h){}onWrite(h){}}m.SessionRequestFailureMessage=SessionRequestFailureMessage;class ExtensionInfoMessage extends v.SshMessage{constructor(){super(...arguments),this.extensionInfo={}}get messageType(){return 7}onRead(h){const m=h.readUInt32();this.extensionInfo={};for(let y=0;y<m;y++){const m=h.readString("ascii"),y=h.readString("utf8");this.extensionInfo[m]=y}}onWrite(h){const m=Object.keys(this.extensionInfo);h.writeUInt32(m.length);for(let y of m)h.writeString(y,"ascii"),h.writeString(this.extensionInfo[y]||"","utf8")}toString(){let h="";for(const[m,y]of Object.entries(this.extensionInfo))h&&(h+="; "),h+=m,y&&(h+="="+y);return`${super.toString()} (${h})`}}m.ExtensionInfoMessage=ExtensionInfoMessage,ExtensionInfoMessage.serverIndicator="ext-info-c",ExtensionInfoMessage.clientIndicator="ext-info-c";m.SessionChannelRequestMessage=class SessionChannelRequestMessage extends SessionRequestMessage{onRead(h){super.onRead(h),this.senderChannel=h.readUInt32();const m=new C.ChannelRequestMessage;m.read(h),this.request=m}onWrite(h){super.onWrite(h),h.writeUInt32(this.validateField(this.senderChannel,"sender channel")),this.validateField(this.request,"request message").write(h)}};m.SessionReconnectRequestMessage=class SessionReconnectRequestMessage extends SessionRequestMessage{onRead(h){super.onRead(h),this.clientReconnectToken=h.readBinary(),this.lastReceivedSequenceNumber=h.readUInt64()}onWrite(h){super.onWrite(h),h.writeBinary(this.validateField(this.clientReconnectToken,"clientReconnectToken")),h.writeUInt64(this.validateField(this.lastReceivedSequenceNumber,"lastReceivedSequenceNumber"))}};m.SessionReconnectResponseMessage=class SessionReconnectResponseMessage extends SessionRequestSuccessMessage{onRead(h){super.onRead(h),this.serverReconnectToken=h.readBinary(),this.lastReceivedSequenceNumber=h.readUInt64()}onWrite(h){super.onWrite(h),h.writeBinary(this.validateField(this.serverReconnectToken,"serverReconnectToken")),h.writeUInt64(this.validateField(this.lastReceivedSequenceNumber,"lastReceivedSequenceNumber"))}},function(h){h[h.none=0]="none",h[h.unknownServerFailure=1]="unknownServerFailure",h[h.sessionNotFound=2]="sessionNotFound",h[h.invalidClientReconnectToken=3]="invalidClientReconnectToken",h[h.serverDroppedMessages=4]="serverDroppedMessages",h[h.unknownClientFailure=101]="unknownClientFailure",h[h.differentServerHostKey=102]="differentServerHostKey",h[h.invalidServerReconnectToken=103]="invalidServerReconnectToken",h[h.clientDroppedMessages=104]="clientDroppedMessages"}(T=m.SshReconnectFailureReason||(m.SshReconnectFailureReason={}));m.SessionReconnectFailureMessage=class SessionReconnectFailureMessage extends SessionRequestFailureMessage{onRead(h){h.available>0&&(this.reasonCode=h.readUInt32(),this.description=h.readString("utf8"),this.language=h.readString("ascii"))}onWrite(h){h.writeUInt32(this.validateField(this.reasonCode,"reason code")),h.writeString(this.description||"","utf8"),h.writeString(this.language||"en","ascii")}toString(){return`${super.toString} (${T[this.reasonCode||0]}: ${this.description})`}},v.SshMessage.index.set(1,DisconnectMessage),v.SshMessage.index.set(2,IgnoreMessage),v.SshMessage.index.set(3,UnimplementedMessage),v.SshMessage.index.set(5,ServiceRequestMessage),v.SshMessage.index.set(6,ServiceAcceptMessage),v.SshMessage.index.set(7,ExtensionInfoMessage),v.SshMessage.index.set(80,SessionRequestMessage),v.SshMessage.index.set(81,SessionRequestSuccessMessage),v.SshMessage.index.set(82,SessionRequestFailureMessage)},function(h,m,y){"use strict";var v=this&&this.__awaiter||function(h,m,y,v){return new(y||(y=Promise))((function(C,T){function fulfilled(h){try{step(v.next(h))}catch(h){T(h)}}function rejected(h){try{step(v.throw(h))}catch(h){T(h)}}function step(h){h.done?C(h.value):function adopt(h){return h instanceof y?h:new y((function(m){m(h)}))}(h.value).then(fulfilled,rejected)}step((v=v.apply(h,m||[])).next())}))};Object.defineProperty(m,"__esModule",{value:!0});const C=y(0),T=y(0),w=y(13),A=y(288),P=y(289),k=y(5),R=y(15),M=y(16),N=y(2),D=y(1263),I=y(1264),x=y(1265),O=y(529),L=y(3),U=y(4);var B;!function(h){h.LiveshareStatus="liveshareStatus",h.WorkspaceName="workspaceName"}(B=m.PublishProperties||(m.PublishProperties={}));class ContactManager extends w.EventEmitter{constructor(){super(...arguments),this.recentContactsPresenceRequests=new RequestPresenceContactHelper,this.recentContacts=[],this.aggregatedSuggestedUsers=[],this.suggestedContactPresenceRequests=new RequestPresenceContactHelper,this.suggestedUserByProvider={},this.updateRecentContactsInProgress=new N.Mutex,this.updateSuggestedContactsInProgress=new N.Mutex,this.requestContactsResults=new Set,this.invitedContactsMap=new Map,this.internalEmitter=new w.EventEmitter,this.supportMultiplePresenceProviders=!1,this.serviceProviders=[],this.presenceStatusProviders=[]}static get Instance(){return ContactManager.singleton||(ContactManager.singleton=new ContactManager),ContactManager.singleton}initialize(h){return this._initialize(h.rpcClient(),h.authService(),h,()=>Promise.resolve(Array.from(h.workspaceServices().registeredServices)))}_initialize(h,m,y,C){return v(this,void 0,void 0,(function*(){this.trace=k.traceSource.withName("Contact.Manager"),this.authCoreService=m,this.once(L.ContactManagerEvents.ProviderAdded,()=>{this.emit(L.ContactManagerEvents.Ready)}),yield L.ExtensionUtil.tryRegisterCommand("liveshare.removeInvitedContactFromFileTreeExplorer",this.removeInvitedContact,this,!1),yield L.ExtensionUtil.tryRegisterCommand("liveshare.removeInvitedContactFromActivityBar",this.removeInvitedContact,this,!1);const contactServiceSearch=m=>v(this,void 0,void 0,(function*(){const y=m.filter(h=>h.startsWith("contactService-"));for(let m of y){const y={name:m,methods:U.contactProtocol.ContactServiceProvider.methods,events:U.contactProtocol.ContactServiceProvider.events},v=M.RpcProxy.create(y,h,k.traceSource.withName(U.vsls.TraceSources.ClientRpcContact));yield this.registerAndInitializeServiceProvider(m.substr("contactService-".length),v)}}));h.ensureConnectionAsync().then(()=>v(this,void 0,void 0,(function*(){const h=yield C();contactServiceSearch(h)}))).catch(h=>{k.traceSource.info("Failed to get context services:"+h)}),y.workspaceService().onServicesChanged(h=>{h.changeType===U.vsls.CollectionChangeType.Add&&contactServiceSearch(h.serviceNames)}),y.workspaceUserService().onWorkspaceSessionChanged(h=>v(this,void 0,void 0,(function*(){if((h.changeType===U.vsls.WorkspaceSessionChangeType.Joined||h.changeType===U.vsls.WorkspaceSessionChangeType.Unjoined)&&!h.userProfile.isAnonymous){h.changeType===U.vsls.WorkspaceSessionChangeType.Joined&&(yield this.addUserProfile(h.userProfile));const m=Array.from(this.invitedContactsMap.values()).find(m=>m.contact.id===h.userProfile.id||m.contact.contact.email===h.userProfile.email);m&&this.setInviteStatus(m.contact.id,U.vsls.InviteContactStatus.None)}})));let T=!1;const onSignedStateChanged=(h,m)=>{T=h,this.trace.verbose(`->loadRecentCollaborators:${m}`),this.loadRecentCollaborators(h)};L.sessionStateTracker.onStateChanged(h=>v(this,void 0,void 0,(function*(){if(this.trace.verbose(`->onStateChanged state:${h.newState}`),h.newState===L.SessionState.Joined){const h=Object.values(L.workspaceSessionInfoTracker.workspaceSessionInfo.sessions).find(h=>h.isHost);h&&(yield this.addUserProfile(h))}h.newState===L.SessionState.SignedOut?onSignedStateChanged(!1,"signedOut"):h.newState>=L.SessionState.SignedIn&&!T&&(onSignedStateChanged(!0,"signedIn"),h.newState===L.SessionState.SignedIn&&this.invitedContactsMap.clear());const m={};m[B.LiveshareStatus]=h.newState,yield this.publishProperties(m)}))),this.trace.verbose(`->initialize state:${L.sessionStateTracker.State}`),L.sessionStateTracker.State>=L.SessionState.SignedIn&&onSignedStateChanged(!0,"initialize");const registerCallback=(h,m)=>this.registerContactProvider(h,m);D.registerGitProvider(registerCallback,this.trace),I.registerSelfInviteProvider(m,registerCallback,this.trace),yield this.updateContexts();const w=L.Settings.get(L.SettingKeys.activityTimeout);this.registerPresenceStatusProvider(new x.IdlePresenceStatus(this.trace,w)),this.registerPresenceStatusProvider(new O.SessionStateStatusProvider)}))}get isPublishEnabeld(){return!0}registerPresenceStatusProvider(h){this.presenceStatusProviders.push(h),h.onStatusChanged(m=>this.onPresenceStatusProviderChanged(h,m))}initializeProvider(h){return v(this,void 0,void 0,(function*(){const m={};m[B.LiveshareStatus]=L.sessionStateTracker.State,!0===L.Settings.get(L.SettingKeys.publishWorkspaceInfo)&&(m[B.WorkspaceName]=T.workspace.name),yield h.initialize(this.isPublishEnabeld,{status:U.contactProtocol.PresenceStatus.Available,properties:m}),this.updatePreferedPresenceProvider(h),h.capabilites.supportsContactPresenceRequest&&(yield this.updateAllContacts()),yield this.updateContexts()}))}registerServiceProvider(h,m){this.trace.info(`registerContactProvider-> serviceId:${h}`);const y=new A.ContactServiceManager(h,m,this);return y.addListener(L.ContactServiceEvents.Initialized,()=>this.fireContactsChanged()),y.addListener(L.ContactServiceEvents.ContactsChanged,()=>this.fireContactsChanged()),y.addListener(L.ContactServiceEvents.AvailableUsersChanged,()=>this.onAvailableUsersChanged()),y.addListener(L.ContactServiceEvents.SelfContactChanged,()=>this.onSelfUserChangedNotification(y)),y.addListener(L.ContactServiceEvents.InviteLinkReceived,h=>this.onInviteLinkReceived(y,h)),y.addListener(L.ContactServiceEvents.MessageReceived,h=>this.onMessageReceived(h)),y.addListener(L.ContactServiceEvents.SuggestedUsersUpdate,h=>this.onSuggestedUsersUpdate(y,h)),y.addListener(L.ContactServiceEvents.ContactsChangedNotification,h=>this.onContactsChangedNotification(y,h)),y.addListener(L.ContactServiceEvents.ContactPropertyChangedNotification,h=>this.onContactPropertiesChangedNotification(h)),y.addListener(L.ContactServiceEvents.SignedStateChanged,h=>this.onPresenceSignedStatusNotification(y)),y.addListener(L.ContactServiceEvents.CapabilitiesChanged,h=>this.onCapabilitiesChanged(y,h)),y.addListener(L.ContactServiceEvents.AuthenticationRequired,h=>this.onAuthenticationRequired(y)),this.serviceProviders.push(y),y}registerAndInitializeServiceProvider(h,m){return v(this,void 0,void 0,(function*(){const y=this.registerServiceProvider(h,m);return yield this.initializeProvider(y),this.emit(L.ContactManagerEvents.ProviderAdded,y),y}))}registerContactProvider(h,m){const y=this.registerServiceProvider(h,m);return this.initializeProvider(y).catch(m=>{this.trace.error(`Failed to register contact provider:${h}`,m)}),this.emit(L.ContactManagerEvents.ProviderAdded,y),new C.Disposable(()=>{const h=this.serviceProviders.indexOf(y);h>=0&&this.serviceProviders.splice(h,1)})}dispose(){return v(this,void 0,void 0,(function*(){for(let h of this.serviceProviders.splice(0,this.serviceProviders.length))yield h._Dispose()}))}get selectedPreferedProviderId(){return L.Settings.getMemento("liveshare.preferedPresenceProviderId")}setPreferedPresenceProvider(h){return v(this,void 0,void 0,(function*(){L.Settings.saveMemento("liveshare.preferedPresenceProviderId",h.serviceId),this.preferedPresenceProvider!==h&&(this.preferedPresenceProvider=h,this.updatePreferedProviderSelfStatus(),this.updatePreferedProviderSignedStatus(),yield this.updateAllContacts())}))}isRecentContat(h){return-1!==this.recentContacts.findIndex(m=>m.contactModel.id===h.id)}isSuggestedContat(h){return-1!==this.aggregatedSuggestedUsers.findIndex(m=>m.id===h.id)}getServiceManager(h){return this.serviceProviders.find(m=>m.serviceId===h)}getSuggestedUsers(h){return h?this.aggregatedSuggestedUsers.filter(h):this.aggregatedSuggestedUsers}getRecentContacts(h){const m=this.recentContacts.map(h=>h.contactModel);return h?m.filter(h):m}getAllAvailableContacts(h){const m=[];return this.serviceProviders.forEach(y=>{let v=y.availableUsers;h&&(v=v.filter(h)),m.push(...v)}),m}get isDoNotDisturbState(){return!!this.serviceProviders.find(h=>h.selfUser&&h.selfUser.contact.status===U.contactProtocol.PresenceStatus.DoNotDisturb)}get selfContact(){var h;return null===(h=this.preferedPresenceProvider)||void 0===h?void 0:h.selfUser}get presenceStatus(){return this.preferedPresenceProvider&&this.preferedPresenceProvider.selfUser?this.preferedPresenceProvider.selfUser.contact.status:U.contactProtocol.PresenceStatus.Unknown}signOut(){return v(this,void 0,void 0,(function*(){this.preferedPresenceProvider&&(yield this.preferedPresenceProvider.signOut())}))}signIn(){return v(this,void 0,void 0,(function*(){this.preferedPresenceProvider&&(yield this.preferedPresenceProvider.signIn())}))}publishPresence(h){return v(this,void 0,void 0,(function*(){h===U.contactProtocol.PresenceStatus.Available?(this.publishedPresenceStatus=void 0,this.presenceStatusProviders.forEach(h=>h.reset()),h=this.getPresenceStatusFromProviders()):this.publishedPresenceStatus=h,yield this.publishPresenceInternal(h,{allowInvites:L.Settings.get(L.SettingKeys.allowInvites)})}))}publishProperties(h){return v(this,void 0,void 0,(function*(){yield this.publishPresenceInternal(U.contactProtocol.PresenceStatus.Unknown,h)}))}get supportedPresenceStatus(){return this.preferedPresenceProvider&&this.preferedPresenceProvider.capabilites&&this.preferedPresenceProvider.capabilites.supportedPresenceStatus?this.preferedPresenceProvider.capabilites.supportedPresenceStatus:[U.contactProtocol.PresenceStatus.Available,U.contactProtocol.PresenceStatus.Busy,U.contactProtocol.PresenceStatus.DoNotDisturb,U.contactProtocol.PresenceStatus.Away]}searchContacts(h,m,y){return v(this,void 0,void 0,(function*(){const C=this.serviceProviders.filter(h=>h.capabilites&&h.capabilites.supportsSearchContacts).map(C=>v(this,void 0,void 0,(function*(){return yield C.searchContactsRequest(h,m,y)}))),T=yield Promise.all(C);return T.length>0?T.reduce((h,m)=>h.concat(m)):[]}))}sendMessage(h,m,y,C){return v(this,void 0,void 0,(function*(){const v=this.getSendMessageProvider();return!!v&&(yield v.sendMessage(h,m,y,C),!0)}))}get signedStatus(){return this.preferedPresenceProvider?this.preferedPresenceProvider.signedStatus:U.contactProtocol.SignedStatus.None}get hasSendMessageProvider(){return void 0!==this.getSendMessageProvider()}removeRecentContact(h){return v(this,void 0,void 0,(function*(){const m=this.recentContacts.findIndex(m=>m.contactModel.contact.id===h.contact.id);if(-1!==m){const y=this.recentContacts.splice(m,1);return yield y[0].dispose(),yield this.authCoreService.removeRecentCollaboratorAsync(h.contact.id),yield this.updateAllContacts(),!0}return!1}))}requestContacts(h){return v(this,void 0,void 0,(function*(){const m=yield this.requestContactsInternal(h);return this.requestContactsResults.add(m),m}))}onInviteStatusChanged(h){this.internalEmitter.addListener("onInviteStatusChanged",h)}get invitedContacts(){return Array.from(this.invitedContactsMap.values()).filter(h=>h.status!==U.vsls.InviteContactStatus.None).map(h=>h.contact)}isContactInvited(h){return this.invitedContactsMap.has(h)}getInviteStatus(h){return this.invitedContactsMap.has(h)?this.invitedContactsMap.get(h).status:U.vsls.InviteContactStatus.None}fireInviteStatusChanged(h,m,y){return v(this,void 0,void 0,(function*(){this.trace.info(`fireInviteStatusChanged-> targetContactId:${R.TraceFormat.formatText(h)} fromContactId:${R.TraceFormat.formatText(m)} status:${y}`),yield this.sendMessage(h,"inviteStatusChanged",{fromContactId:m,status:y})}))}addInviteContact(h){this.invitedContactsMap.set(h.id,{contact:h,status:U.vsls.InviteContactStatus.None}),this.emit(L.ContactManagerEvents.InviteContactsUpdate)}onPresenceStatusProviderChanged(h,m){return v(this,void 0,void 0,(function*(){if(this.trace.verbose(`onActivityStatusChanged-> id:${h.id} newStatus:${m} publishedPresenceStatus:${this.publishedPresenceStatus}`),!this.publishedPresenceStatus){const h=this.getPresenceStatusFromProviders();yield this.publishPresenceInternal(h,{allowInvites:L.Settings.get(L.SettingKeys.allowInvites)})}}))}getPresenceStatusFromProviders(){const h=this.presenceStatusProviders.sort((h,m)=>m.priority-h.priority).find(h=>h.status!==U.contactProtocol.PresenceStatus.Unknown);return h?h.status:U.contactProtocol.PresenceStatus.Available}publishPresenceInternal(h,m){return v(this,void 0,void 0,(function*(){if(this.isPublishEnabeld){const y=this.serviceProviders.map(y=>v(this,void 0,void 0,(function*(){return yield y.publishPresence(h,m)})));yield Promise.all(y)}}))}setInviteStatus(h,m){this.trace.info(`setInviteStatus-> contactId:${R.TraceFormat.formatText(h)} status:${m}`),m===U.vsls.InviteContactStatus.None?(this.invitedContactsMap.delete(h),this.emit(L.ContactManagerEvents.InviteContactsUpdate)):this.invitedContactsMap.has(h)&&(this.invitedContactsMap.get(h).status=m);const y=this.aggregatedSuggestedUsers.find(m=>m.id===h);y&&y.fireChanged("inviteStatus");const v=this.recentContacts.find(m=>m.contactModel.id===h);v&&v.contactModel.fireChanged("inviteStatus"),this.internalEmitter.emit("onInviteStatusChanged")}getSendMessageProvider(){return this.serviceProviders.find(h=>h.capabilites&&h.capabilites.supportsMessageRequest)}removeInvitedContact(h){this.trace.info(`removeInvitedContact-> contactId:${R.TraceFormat.formatText(h.options.contactId)}`),this.setInviteStatus(h.options.contactId,U.vsls.InviteContactStatus.None)}updateContexts(){return v(this,void 0,void 0,(function*(){yield L.ExtensionUtil.setCommandContext("liveshare:hasPresenceProviders",-1!==this.serviceProviders.findIndex(h=>h.capabilites.supportsPresence)),yield L.ExtensionUtil.setCommandContext("liveshare:hasPublishPresenceProviders",-1!==this.serviceProviders.findIndex(h=>h.capabilites.supportsPublishPresence)),yield L.ExtensionUtil.setCommandContext("liveshare:hasSearchContactsProviders",-1!==this.serviceProviders.findIndex(h=>h.capabilites.supportsSearchContacts))}))}fireContactsChanged(){this.emit(L.ContactManagerEvents.ContactsChanged)}updatePreferedPresenceProvider(h){if(h.capabilites.supportsContactPresenceRequest||h.capabilites.supportsSignedStateRequest){const m=this.preferedPresenceProvider&&this.preferedPresenceProvider.serviceId===this.selectedPreferedProviderId;(!this.preferedPresenceProvider||h.serviceId===this.selectedPreferedProviderId||!m&&h.priority>=this.preferedPresenceProvider.priority)&&(this.preferedPresenceProvider=h,this.updatePreferedProviderSelfStatus(),this.updatePreferedProviderSignedStatus())}}onAuthenticationRequired(h){}onCapabilitiesChanged(h,m){return v(this,void 0,void 0,(function*(){const y=m.oldCapabilities,v=m.newCapabilities;this.trace.info(`onCapabilitiesChanged-> serviceId:${h.serviceId} old:${JSON.stringify(y)} new:${JSON.stringify(v)}`),y.supportsPresence===v.supportsPresence&&y.supportsContactPresenceRequest===v.supportsContactPresenceRequest||(yield this.updateAllContacts()),this.updatePreferedPresenceProvider(h),yield this.updateContexts(),this.emit(L.ContactManagerEvents.ProviderCapabilitiesChanged,h)}))}onInviteLinkReceived(h,m){if(m.fromContact&&!m.fromContact.id&&(m.fromContact.id=m.fromContactId),!this.isSelfContact(m.fromContact)){const h=L.Settings.get(L.SettingKeys.allowInvites);let y=!1;if("none"===h)y=!0;else if("contacts"===h||"recentContacts"===h){const v=this.recentContacts.map(h=>h.contactModel.id);"contacts"===h&&v.push(...this.aggregatedSuggestedUsers.map(h=>h.id)),y=-1===v.findIndex(h=>h===m.fromContact.id)}if(y)return void this.trace.info(`invite rejected for contactId:${m.fromContact.id} allowInvites:${h}`)}const y={provider:h,originator:m.fromContact?new P.ContactModelApi(h.serviceId,m.fromContact,{},this):h.lookupContactById(m.fromContactId),link:m.link};this.emit(L.ContactManagerEvents.InviteLinkReceived,y)}onAvailableUsersChanged(){return v(this,void 0,void 0,(function*(){yield L.ExtensionUtil.setCommandContext("liveshare:hasAvailableContacts",-1!==this.serviceProviders.findIndex(h=>h.availableUsers.length>0)),this.fireContactsChanged()}))}onMessageReceived(h){if(this.trace.info(`onMessageReceived-> type:${h.type} body:${JSON.stringify(h.body)}`),"inviteStatusChanged"===h.type){const m=h.body;this.invitedContactsMap.has(m.fromContactId)&&this.setInviteStatus(m.fromContactId,m.status)}}onSuggestedUsersUpdate(h,m){return v(this,void 0,void 0,(function*(){this.trace.info(`onSuggestedUsersUpdate-> serviceId:${h.serviceId} count:${m.contacts.length}`),this.suggestedUserByProvider[h.serviceId]=m,yield this.updateAllContacts()}))}updatePreferedProviderSelfStatus(){if(this.preferedPresenceProvider&&this.preferedPresenceProvider.selfUser){const h=this.preferedPresenceProvider.selfUser.contact.status;T.commands.executeCommand("setContext","liveshare:status",h)}}updatePreferedProviderSignedStatus(){this.preferedPresenceProvider&&T.commands.executeCommand("setContext","liveshare:presenceSignedStatus",this.preferedPresenceProvider.signedStatus)}onPresenceSignedStatusNotification(h){this.preferedPresenceProvider===h&&this.updatePreferedProviderSignedStatus(),this.emit(L.ContactManagerEvents.SignedStateChanged,this.signedStatus)}onSelfUserChangedNotification(h){this.preferedPresenceProvider===h&&this.updatePreferedProviderSelfStatus(),this.fireContactsChanged()}onContactPropertiesChangedNotification(h){let m=this.aggregatedSuggestedUsers.find(m=>m.contact.id===h.contactId);m&&(A.ContactServiceManager.updateContactPropertyChanges(m,h.changes),this.emit(L.ContactManagerEvents.SuggestedUsersUpdate)),m=this.recentContacts.map(h=>h.contactModel).find(m=>m.contact.id===h.contactId),m&&(A.ContactServiceManager.updateContactPropertyChanges(m,h.changes),this.emit(L.ContactManagerEvents.RecentContactsUpdate)),this.requestContactsResults.forEach(y=>{m=y.contactModels.find(m=>m.contact.id===h.contactId),m&&A.ContactServiceManager.updateContactPropertyChanges(m,h.changes)})}onContactsChangedNotification(h,m){this.preferedPresenceProvider===h&&this.updatePreferedProviderSelfStatus();let y=[];A.ContactServiceManager.updateContacts(this.aggregatedSuggestedUsers,m,y),y.length>0&&this.emit(L.ContactManagerEvents.SuggestedUsersUpdate),y=[],A.ContactServiceManager.updateContacts(this.recentContacts.map(h=>h.contactModel),m,y),y.length>0&&this.emit(L.ContactManagerEvents.RecentContactsUpdate),this.requestContactsResults.forEach(h=>{y=[],A.ContactServiceManager.updateContacts(h.contactModels,m,y)})}loadRecentCollaborators(h){return v(this,void 0,void 0,(function*(){this.updateRecentContactsWithProgress(()=>v(this,void 0,void 0,(function*(){if(yield this.disposeRecentContactsInternal(),this.recentContacts=[],h){const h=yield this.authCoreService.getCurrentUserAsync();h&&h.recentCollaborators?(this.trace.verbose(`loading recent collaborators count:${h.recentCollaborators.length}`),yield this.addRecentCollaborators(h.recentCollaborators.map(h=>({id:h.id,email:h.email,displayName:h.name,status:U.contactProtocol.PresenceStatus.Unknown})))):this.trace.warning("no current user retrieved from auth service")}this.emit(L.ContactManagerEvents.RecentContactsUpdate)})))}))}updateRecentContacts(){return v(this,void 0,void 0,(function*(){this.updateRecentContactsWithProgress(()=>this.updateRecentContactsInternal())}))}updateRecentContactsWithProgress(h){return v(this,void 0,void 0,(function*(){yield this.updateRecentContactsInProgress.dispatch(h)}))}disposeRecentContactsInternal(){return v(this,void 0,void 0,(function*(){const h=this.recentContacts.map(h=>(h.contact.status=U.contactProtocol.PresenceStatus.Unknown,h.contact));return yield Promise.all(this.recentContacts.map(h=>h.dispose())),h}))}updateRecentContactsInternal(){return v(this,void 0,void 0,(function*(){this.trace.verbose(`->updateRecentContacts -> count:${this.recentContacts.length}`);const h=yield this.disposeRecentContactsInternal();this.recentContacts=[],yield this.addRecentCollaborators(h),this.trace.verbose("<-updateRecentContacts"),this.emit(L.ContactManagerEvents.RecentContactsUpdate)}))}requestContactsInternal(h){return v(this,void 0,void 0,(function*(){const m=[],y=h.map(h=>{const m=new U.contactProtocol.Contact;return m.id=h,m.email=h,m}),v=new RequestPresenceContactHelper;yield this.requestContactsWithPresenceAsync(m,y,v),y.forEach(h=>{-1===m.findIndex(m=>m.contact.email===h.email)&&(h.status=U.contactProtocol.PresenceStatus.Offline,m.push(new P.ContactModelApi(null,h,{},this)))});const C=new RequestContactsImpl(h,m,()=>(this.requestContactsResults.delete(C),v.clear()));return C}))}updateAllContacts(){return v(this,void 0,void 0,(function*(){yield this.updateRecentContacts(),yield this.updateSuggestedUsers();for(const h of this.requestContactsResults.values()){const m=yield this.requestContactsInternal(h.emails);h.update(m)}}))}addUserProfile(h){return v(this,void 0,void 0,(function*(){this.trace.verbose(`addUserProfile id:${R.TraceFormat.formatText(h.id)} name:${R.TraceFormat.formatText(h.name)} `+`email:${R.TraceFormat.formatEmail(h.email)}`);const m=this.recentContacts.findIndex(m=>m.contact.id===h.id);if(-1===m){const m={id:h.id,displayName:h.name,email:h.email,avatarUri:h.avatarUri};yield this.addRecentContact(m),yield this.updateSuggestedUsers()}else if(0!==m){const h=this.recentContacts.splice(m,1);this.recentContacts.unshift(...h)}this.emit(L.ContactManagerEvents.RecentContactsUpdate)}))}addRecentContact(h){return v(this,void 0,void 0,(function*(){this.trace.verbose(`addRecentContact id:${R.TraceFormat.formatText(h.id)} `+`displayName:${R.TraceFormat.formatText(h.displayName)} email:${R.TraceFormat.formatEmail(h.email)}`);const m=[],y=[h],C=new RequestPresenceContactHelper;h.status=U.contactProtocol.PresenceStatus.Unknown,yield this.requestContactsWithPresenceAsync(m,y,C),this.recentContacts=this.recentContacts.filter(m=>m.contact.id!==h.id),this.recentContacts.push({contact:h,contactModel:m.length>0?m[0]:new P.ContactModelApi(null,h,{},this),dispose:()=>v(this,void 0,void 0,(function*(){return yield C.clear()}))})}))}addRecentCollaborators(h){return v(this,void 0,void 0,(function*(){const m=[];yield this.recentContactsPresenceRequests.clear();const y=yield this.requestContactsWithPresenceAsync(m,h,this.recentContactsPresenceRequests),dispose=()=>Promise.resolve();this.recentContacts.push(...h.map(h=>{let v;const C=y.findIndex(m=>m===h.id);return v=-1!==C?m[C]:new P.ContactModelApi(null,h,{},this),{contact:h,contactModel:v,dispose:dispose}}))}))}selectPresenceProviders(h){let m=this.serviceProviders.filter(m=>h(m.capabilites));return m.length>1&&!this.supportMultiplePresenceProviders&&this.preferedPresenceProvider&&(m=[this.preferedPresenceProvider]),m}requestContactsWithPresenceAsync(h,m,y){return v(this,void 0,void 0,(function*(){const v=[],C=this.selectPresenceProviders(h=>h.supportsPresence);m=m.filter(m=>!C.find(y=>{const C=y.findMatchContact(m);return!!C&&(v.push(m.id),h.push(C),!0)}));const T=this.selectPresenceProviders(h=>h.supportsContactPresenceRequest);for(let C=0;C<T.length&&m.length>0;C++){const w=T[C];try{this.trace.verbose(`Request presence on service:${w.serviceId} for contact ids:${m.map(h=>R.TraceFormat.formatText(h.id)).concat(",")} `+`emails:${m.map(h=>R.TraceFormat.formatEmail(h.email)).join(",")}`);const C=yield w.contactsPresenceRequest(m),T=Object.values(C);T.length>0&&(y.addRequest(w,T),h.push(...T),Object.keys(C).forEach(h=>{this.trace.verbose(`Presence support found for id:${R.TraceFormat.formatText(h)} => id:${R.TraceFormat.formatText(C[h].contact.id)} `+`email:${R.TraceFormat.formatEmail(C[h].contact.email)}`),v.push(h);const y=m.findIndex(m=>m.id===h);-1!==y&&m.splice(y,1)}))}catch(h){this.trace.error(`Failed to request presence for service:${w.serviceId} `)}}return v}))}updateSuggestedUsers(){return v(this,void 0,void 0,(function*(){yield this.updateSuggestedContactsInProgress.dispatch(()=>this.updateSuggestedUsersInternal())}))}isSelfContact(h){return this.serviceProviders.findIndex(m=>m.selfUser&&m.capabilites.supportsInviteLink&&(m.selfUser.contact.id===h.id||m.selfUser.contact.email===h.email))>=0}updateSuggestedUsersInternal(){return v(this,void 0,void 0,(function*(){this.trace.verbose("->updateSuggestedUsers"),yield this.suggestedContactPresenceRequests.clear();let h=[];const m={},y=Object.keys(this.suggestedUserByProvider).filter(h=>this.suggestedUserByProvider[h].exclusive&&this.suggestedUserByProvider[h].contacts.length>0).sort((h,m)=>{const y=this.getServiceManager(h).priority,v=this.getServiceManager(m).priority;return y>v?-1:y<v?1:0});if(y.length>0){const h=y[0];m[h]=this.suggestedUserByProvider[h].contacts}else Object.keys(this.suggestedUserByProvider).forEach(h=>m[h]=this.suggestedUserByProvider[h].contacts);const C=Object.keys(m).map(y=>v(this,void 0,void 0,(function*(){const v=m[y];if(this.trace.verbose(`suggest contacts from provider:${y} ids:${v.map(h=>R.TraceFormat.formatText(h.contact.id)).join(",")} `+`emails:${v.map(h=>R.TraceFormat.formatEmail(h.contact.email)).join(",")}`),!this.getServiceManager(y).capabilites.supportsPresence){const m=v.map(h=>h.contact);(yield this.requestContactsWithPresenceAsync(h,m,this.suggestedContactPresenceRequests)).forEach(h=>{const m=v.findIndex(m=>m.contact.id===h);-1!==m&&v.splice(m,1)})}h.push(...v)})));yield Promise.all(C),this.aggregatedSuggestedUsers=h,this.trace.info(`<- updateSuggestedUsers count:${h.length}`),this.emit(L.ContactManagerEvents.SuggestedUsersUpdate)}))}}class RequestPresenceContactHelper{constructor(){this.contactPresenceRequests=[]}addRequest(h,m){this.contactPresenceRequests.push({serviceProvider:h,contacts:m})}clear(){return v(this,void 0,void 0,(function*(){let h=this.contactPresenceRequests.map(h=>v(this,void 0,void 0,(function*(){h.serviceProvider.capabilites&&h.serviceProvider.capabilites.supportsContactPresenceRequest&&(yield h.serviceProvider.contactsPresenceDispose(h.contacts.map(h=>h.contact.id)))})));try{yield Promise.all(h)}catch(h){}this.contactPresenceRequests=[]}))}}class RequestContactsImpl{constructor(h,m,y){this.emails=h,this.contactModels=m,this.disposeCallback=y,this.contactsChangedEmitter=new T.EventEmitter}get onContactsChanged(){return this.contactsChangedEmitter.event}dispose(){return this.disposeCallback()}update(h){this.contactModels=h.contactModels,this.disposeCallback=h.disposeCallback,this.contactsChangedEmitter.fire()}}const W=ContactManager.Instance;m.ContactManager=W},function(h,m,y){"use strict";function __export(h){for(var y in h)m.hasOwnProperty(y)||(m[y]=h[y])}Object.defineProperty(m,"__esModule",{value:!0});const v=y(149),C=y(1417);m.RequestType=C.RequestType,m.RequestType0=C.RequestType0,m.RequestType1=C.RequestType1,m.RequestType2=C.RequestType2,m.RequestType3=C.RequestType3,m.RequestType4=C.RequestType4,m.RequestType5=C.RequestType5,m.RequestType6=C.RequestType6,m.RequestType7=C.RequestType7,m.RequestType8=C.RequestType8,m.RequestType9=C.RequestType9,m.ResponseError=C.ResponseError,m.ErrorCodes=C.ErrorCodes,m.NotificationType=C.NotificationType,m.NotificationType0=C.NotificationType0,m.NotificationType1=C.NotificationType1,m.NotificationType2=C.NotificationType2,m.NotificationType3=C.NotificationType3,m.NotificationType4=C.NotificationType4,m.NotificationType5=C.NotificationType5,m.NotificationType6=C.NotificationType6,m.NotificationType7=C.NotificationType7,m.NotificationType8=C.NotificationType8,m.NotificationType9=C.NotificationType9;const T=y(321);m.MessageReader=T.MessageReader,m.StreamMessageReader=T.StreamMessageReader,m.IPCMessageReader=T.IPCMessageReader,m.SocketMessageReader=T.SocketMessageReader;const w=y(322);m.MessageWriter=w.MessageWriter,m.StreamMessageWriter=w.StreamMessageWriter,m.IPCMessageWriter=w.IPCMessageWriter,m.SocketMessageWriter=w.SocketMessageWriter;const A=y(195);m.Disposable=A.Disposable,m.Event=A.Event,m.Emitter=A.Emitter;const P=y(1418);m.CancellationTokenSource=P.CancellationTokenSource,m.CancellationToken=P.CancellationToken;const k=y(1419);var R,M,N,D,I,x,O,L;__export(y(1420)),__export(y(1421)),function(h){h.type=new C.NotificationType("$/cancelRequest")}(R||(R={})),function(h){h.type=new C.NotificationType("$/progress")}(M||(M={}));m.ProgressType=class ProgressType{constructor(){}},m.NullLogger=Object.freeze({error:()=>{},warn:()=>{},info:()=>{},log:()=>{}}),function(h){h[h.Off=0]="Off",h[h.Messages=1]="Messages",h[h.Verbose=2]="Verbose"}(N=m.Trace||(m.Trace={})),function(h){h.fromString=function fromString(m){if(!v.string(m))return h.Off;switch(m=m.toLowerCase()){case"off":return h.Off;case"messages":return h.Messages;case"verbose":return h.Verbose;default:return h.Off}},h.toString=function toString(m){switch(m){case h.Off:return"off";case h.Messages:return"messages";case h.Verbose:return"verbose";default:return"off"}}}(N=m.Trace||(m.Trace={})),function(h){h.Text="text",h.JSON="json"}(m.TraceFormat||(m.TraceFormat={})),function(h){h.fromString=function fromString(m){return"json"===(m=m.toLowerCase())?h.JSON:h.Text}}(D=m.TraceFormat||(m.TraceFormat={})),function(h){h.type=new C.NotificationType("$/setTraceNotification")}(I=m.SetTraceNotification||(m.SetTraceNotification={})),function(h){h.type=new C.NotificationType("$/logTraceNotification")}(x=m.LogTraceNotification||(m.LogTraceNotification={})),function(h){h[h.Closed=1]="Closed",h[h.Disposed=2]="Disposed",h[h.AlreadyListening=3]="AlreadyListening"}(O=m.ConnectionErrors||(m.ConnectionErrors={}));class ConnectionError extends Error{constructor(h,m){super(m),this.code=h,Object.setPrototypeOf(this,ConnectionError.prototype)}}function _createMessageConnection(h,m,y,T){let w=0,U=0,B=0;let W,q,Y=void 0,V=Object.create(null),$=void 0,z=Object.create(null),G=new Map,J=new k.LinkedMap,X=Object.create(null),Z=Object.create(null),ee=N.Off,te=D.Text,re=L.New,ie=new A.Emitter,se=new A.Emitter,oe=new A.Emitter,ae=new A.Emitter,ce=new A.Emitter;function createRequestQueueKey(h){return"req-"+h.toString()}function addMessageToQueue(h,m){C.isRequestMessage(m)?h.set(createRequestQueueKey(m.id),m):C.isResponseMessage(m)?h.set(function createResponseQueueKey(h){return null===h?"res-unknown-"+(++B).toString():"res-"+h.toString()}(m.id),m):h.set(function createNotificationQueueKey(){return"not-"+(++U).toString()}(),m)}function cancelUndispatched(h){}function isListening(){return re===L.Listening}function isClosed(){return re===L.Closed}function isDisposed(){return re===L.Disposed}function closeHandler(){re!==L.New&&re!==L.Listening||(re=L.Closed,se.fire(void 0))}function triggerMessageQueue(){W||0===J.size||(W=setImmediate(()=>{W=void 0,function processMessageQueue(){if(0===J.size)return;let h=J.shift();try{C.isRequestMessage(h)?function handleRequest(h){if(isDisposed())return;function reply(y,v,T){let w={jsonrpc:"2.0",id:h.id};y instanceof C.ResponseError?w.error=y.toJson():w.result=void 0===y?null:y,traceSendingResponse(w,v,T),m.write(w)}function replyError(y,v,C){let T={jsonrpc:"2.0",id:h.id,error:y.toJson()};traceSendingResponse(T,v,C),m.write(T)}!function traceReceivedRequest(h){if(ee===N.Off||!q)return;if(te===D.Text){let m=void 0;ee===N.Verbose&&h.params&&(m=`Params: ${JSON.stringify(h.params,null,4)}\n\n`),q.log(`Received request '${h.method} - (${h.id})'.`,m)}else logLSPMessage("receive-request",h)}(h);let y,T,w=V[h.method];w&&(y=w.type,T=w.handler);let A=Date.now();if(T||Y){let w=new P.CancellationTokenSource,k=String(h.id);Z[k]=w;try{let P;P=void 0===h.params||void 0!==y&&0===y.numberOfParams?T?T(w.token):Y(h.method,w.token):v.array(h.params)&&(void 0===y||y.numberOfParams>1)?T?T(...h.params,w.token):Y(h.method,...h.params,w.token):T?T(h.params,w.token):Y(h.method,h.params,w.token);let R=P;P?R.then?R.then(m=>{delete Z[k],reply(m,h.method,A)},m=>{delete Z[k],m instanceof C.ResponseError?replyError(m,h.method,A):m&&v.string(m.message)?replyError(new C.ResponseError(C.ErrorCodes.InternalError,`Request ${h.method} failed with message: ${m.message}`),h.method,A):replyError(new C.ResponseError(C.ErrorCodes.InternalError,`Request ${h.method} failed unexpectedly without providing any details.`),h.method,A)}):(delete Z[k],reply(P,h.method,A)):(delete Z[k],function replySuccess(y,v,C){void 0===y&&(y=null);let T={jsonrpc:"2.0",id:h.id,result:y};traceSendingResponse(T,v,C),m.write(T)}(P,h.method,A))}catch(m){delete Z[k],m instanceof C.ResponseError?reply(m,h.method,A):m&&v.string(m.message)?replyError(new C.ResponseError(C.ErrorCodes.InternalError,`Request ${h.method} failed with message: ${m.message}`),h.method,A):replyError(new C.ResponseError(C.ErrorCodes.InternalError,`Request ${h.method} failed unexpectedly without providing any details.`),h.method,A)}}else replyError(new C.ResponseError(C.ErrorCodes.MethodNotFound,`Unhandled method ${h.method}`),h.method,A)}(h):C.isNotificationMessage(h)?function handleNotification(h){if(isDisposed())return;let m,C=void 0;if(h.method===R.type.method)m=h=>{let m=h.id,y=Z[String(m)];y&&y.cancel()};else{let y=z[h.method];y&&(m=y.handler,C=y.type)}if(m||$)try{!function traceReceivedNotification(h){if(ee===N.Off||!q||h.method===x.type.method)return;if(te===D.Text){let m=void 0;ee===N.Verbose&&(m=h.params?`Params: ${JSON.stringify(h.params,null,4)}\n\n`:"No parameters provided.\n\n"),q.log(`Received notification '${h.method}'.`,m)}else logLSPMessage("receive-notification",h)}(h),void 0===h.params||void 0!==C&&0===C.numberOfParams?m?m():$(h.method):v.array(h.params)&&(void 0===C||C.numberOfParams>1)?m?m(...h.params):$(h.method,...h.params):m?m(h.params):$(h.method,h.params)}catch(m){m.message?y.error(`Notification handler '${h.method}' failed with message: ${m.message}`):y.error(`Notification handler '${h.method}' failed unexpectedly.`)}else oe.fire(h)}(h):C.isResponseMessage(h)?function handleResponse(h){if(isDisposed())return;if(null===h.id)h.error?y.error(`Received response message without id: Error is: \n${JSON.stringify(h.error,void 0,4)}`):y.error("Received response message without id. No further error information provided.");else{let m=String(h.id),v=X[m];if(function traceReceivedResponse(h,m){if(ee===N.Off||!q)return;if(te===D.Text){let y=void 0;if(ee===N.Verbose&&(h.error&&h.error.data?y=`Error data: ${JSON.stringify(h.error.data,null,4)}\n\n`:h.result?y=`Result: ${JSON.stringify(h.result,null,4)}\n\n`:void 0===h.error&&(y="No result returned.\n\n")),m){let v=h.error?` Request failed: ${h.error.message} (${h.error.code}).`:"";q.log(`Received response '${m.method} - (${h.id})' in ${Date.now()-m.timerStart}ms.${v}`,y)}else q.log(`Received response ${h.id} without active response promise.`,y)}else logLSPMessage("receive-response",h)}(h,v),v){delete X[m];try{if(h.error){let m=h.error;v.reject(new C.ResponseError(m.code,m.message,m.data))}else{if(void 0===h.result)throw new Error("Should never happen.");v.resolve(h.result)}}catch(h){h.message?y.error(`Response handler '${v.method}' failed with message: ${h.message}`):y.error(`Response handler '${v.method}' failed unexpectedly.`)}}}}(h):function handleInvalidMessage(h){if(!h)return void y.error("Received empty message.");y.error(`Received message which is neither a response nor a notification message:\n${JSON.stringify(h,null,4)}`);let m=h;if(v.string(m.id)||v.number(m.id)){let h=String(m.id),y=X[h];y&&y.reject(new Error("The received response has neither a result nor an error property."))}}(h)}finally{triggerMessageQueue()}}()}))}h.onClose(closeHandler),h.onError((function readErrorHandler(h){ie.fire([h,void 0,void 0])})),m.onClose(closeHandler),m.onError((function writeErrorHandler(h){ie.fire(h)}));let callback=h=>{try{if(C.isNotificationMessage(h)&&h.method===R.type.method){let y=createRequestQueueKey(h.params.id),v=J.get(y);if(C.isRequestMessage(v)){let C=T&&T.cancelUndispatched?T.cancelUndispatched(v,cancelUndispatched):void 0;if(C&&(void 0!==C.error||void 0!==C.result))return J.delete(y),C.id=v.id,traceSendingResponse(C,h.method,Date.now()),void m.write(C)}}addMessageToQueue(J,h)}finally{triggerMessageQueue()}};function traceSendingResponse(h,m,y){if(ee!==N.Off&&q)if(te===D.Text){let v=void 0;ee===N.Verbose&&(h.error&&h.error.data?v=`Error data: ${JSON.stringify(h.error.data,null,4)}\n\n`:h.result?v=`Result: ${JSON.stringify(h.result,null,4)}\n\n`:void 0===h.error&&(v="No result returned.\n\n")),q.log(`Sending response '${m} - (${h.id})'. Processing request took ${Date.now()-y}ms`,v)}else logLSPMessage("send-response",h)}function logLSPMessage(h,m){if(!q||ee===N.Off)return;const y={isLSPMessage:!0,type:h,message:m,timestamp:Date.now()};q.log(y)}function throwIfClosedOrDisposed(){if(isClosed())throw new ConnectionError(O.Closed,"Connection is closed.");if(isDisposed())throw new ConnectionError(O.Disposed,"Connection is disposed.")}function undefinedToNull(h){return void 0===h?null:h}function computeMessageParams(h,m){let y,v=h.numberOfParams;switch(v){case 0:y=null;break;case 1:y=undefinedToNull(m[0]);break;default:y=[];for(let h=0;h<m.length&&h<v;h++)y.push(undefinedToNull(m[h]));if(m.length<v)for(let h=m.length;h<v;h++)y.push(null)}return y}let le={sendNotification:(h,...y)=>{let C,T;if(throwIfClosedOrDisposed(),v.string(h))switch(C=h,y.length){case 0:T=null;break;case 1:T=y[0];break;default:T=y}else C=h.method,T=computeMessageParams(h,y);let w={jsonrpc:"2.0",method:C,params:T};!function traceSendingNotification(h){if(ee!==N.Off&&q)if(te===D.Text){let m=void 0;ee===N.Verbose&&(m=h.params?`Params: ${JSON.stringify(h.params,null,4)}\n\n`:"No parameters provided.\n\n"),q.log(`Sending notification '${h.method}'.`,m)}else logLSPMessage("send-notification",h)}(w),m.write(w)},onNotification:(h,m)=>{throwIfClosedOrDisposed(),v.func(h)?$=h:m&&(v.string(h)?z[h]={type:void 0,handler:m}:z[h.method]={type:h,handler:m})},onProgress:(h,m,y)=>{if(G.has(m))throw new Error(`Progress handler for token ${m} already registered`);return G.set(m,y),{dispose:()=>{G.delete(m)}}},sendProgress:(h,m,y)=>{le.sendNotification(M.type,{token:m,value:y})},onUnhandledProgress:ae.event,sendRequest:(h,...y)=>{let T,A;throwIfClosedOrDisposed(),function throwIfNotListening(){if(!isListening())throw new Error("Call listen() first.")}();let k=void 0;if(v.string(h))switch(T=h,y.length){case 0:A=null;break;case 1:P.CancellationToken.is(y[0])?(A=null,k=y[0]):A=undefinedToNull(y[0]);break;default:const h=y.length-1;P.CancellationToken.is(y[h])?(k=y[h],A=2===y.length?undefinedToNull(y[0]):y.slice(0,h).map(h=>undefinedToNull(h))):A=y.map(h=>undefinedToNull(h))}else{T=h.method,A=computeMessageParams(h,y);let m=h.numberOfParams;k=P.CancellationToken.is(y[m])?y[m]:void 0}let M=w++,I=new Promise((h,y)=>{let v={jsonrpc:"2.0",id:M,method:T,params:A},w={method:T,timerStart:Date.now(),resolve:h,reject:y};!function traceSendingRequest(h){if(ee!==N.Off&&q)if(te===D.Text){let m=void 0;ee===N.Verbose&&h.params&&(m=`Params: ${JSON.stringify(h.params,null,4)}\n\n`),q.log(`Sending request '${h.method} - (${h.id})'.`,m)}else logLSPMessage("send-request",h)}(v);try{m.write(v)}catch(h){w.reject(new C.ResponseError(C.ErrorCodes.MessageWriteError,h.message?h.message:"Unknown reason")),w=null}w&&(X[String(M)]=w)});return k&&k.onCancellationRequested(()=>{le.sendNotification(R.type,{id:M})}),I},onRequest:(h,m)=>{throwIfClosedOrDisposed(),v.func(h)?Y=h:m&&(v.string(h)?V[h]={type:void 0,handler:m}:V[h.method]={type:h,handler:m})},trace:(h,m,y)=>{let C=!1,T=D.Text;void 0!==y&&(v.boolean(y)?C=y:(C=y.sendNotification||!1,T=y.traceFormat||D.Text)),ee=h,te=T,q=ee===N.Off?void 0:m,!C||isClosed()||isDisposed()||le.sendNotification(I.type,{value:N.toString(h)})},onError:ie.event,onClose:se.event,onUnhandledNotification:oe.event,onDispose:ce.event,dispose:()=>{if(isDisposed())return;re=L.Disposed,ce.fire(void 0);let y=new Error("Connection got disposed.");Object.keys(X).forEach(h=>{X[h].reject(y)}),X=Object.create(null),Z=Object.create(null),J=new k.LinkedMap,v.func(m.dispose)&&m.dispose(),v.func(h.dispose)&&h.dispose()},listen:()=>{throwIfClosedOrDisposed(),function throwIfListening(){if(isListening())throw new ConnectionError(O.AlreadyListening,"Connection is already listening")}(),re=L.Listening,h.listen(callback)},inspect:()=>{console.log("inspect")}};return le.onNotification(x.type,h=>{ee!==N.Off&&q&&q.log(h.message,ee===N.Verbose?h.verbose:void 0)}),le.onNotification(M.type,h=>{const m=G.get(h.token);m?m(h.value):ae.fire(h)}),le}m.ConnectionError=ConnectionError,function(h){h.is=function is(h){let m=h;return m&&v.func(m.cancelUndispatched)}}(m.ConnectionStrategy||(m.ConnectionStrategy={})),function(h){h[h.New=1]="New",h[h.Listening=2]="Listening",h[h.Closed=3]="Closed",h[h.Disposed=4]="Disposed"}(L||(L={})),m.createMessageConnection=function createMessageConnection(h,y,v,C){return v||(v=m.NullLogger),_createMessageConnection(function isMessageReader(h){return void 0!==h.listen&&void 0===h.read}(h)?h:new T.StreamMessageReader(h),function isMessageWriter(h){return void 0!==h.write&&void 0===h.end}(y)?y:new w.StreamMessageWriter(y),v,C)}},function(h,m,y){"use strict";const v=y(36).fromPromise,C=y(368);h.exports={pathExists:v((function pathExists(h){return C.access(h).then(()=>!0).catch(()=>!1)})),pathExistsSync:C.existsSync}},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0});const v=y(0),C=y(7),T=y(12);let w,A;function schemeQualifiedPathRegExp(){return A||(A=new RegExp('"'+T.Settings.scheme+':([^"]*)"',"g")),A}class PathUtil{static replaceSchemeWithPath(h,m){return(m.endsWith("/")||m.endsWith("\\"))&&(m=m.substr(0,m.length-1)),h.replace(function schemeQualifierRegExp(){return w||(w=new RegExp(T.Settings.scheme+":","g")),w}(),m)}static getMonikerFromUri(h){if(h.scheme!==T.Settings.scheme)throw new Error(`Invalid scheme: '${h.scheme}', expected: '${T.Settings.scheme}'`);return PathUtil.getMonikerFromRelativePath(h.path)}static getMonikerFromRelativePath(h){const m=h.indexOf("/",1);if(m<3||"~"!==h[1])return{moniker:"",relativePath:h};const y=(m>1?m:h.length)-2;return{moniker:h.substr(2,y),relativePath:h.substr(2+y)}}static getRelativePathFromPrefixedPath(h){const{moniker:m,relativePath:y}=PathUtil.getMonikerFromRelativePath(h);return"0"!==m?h:y}static getPrefixedRoot(h){return"0"!==h&&h?`/~${h}`:"/"}static replaceSchemeWithPathInLine(h,m){let y=h.replace(schemeQualifiedPathRegExp(),h=>PathUtil.convertToForwardSlashesIfNeeded(h,m));return PathUtil.replaceSchemeWithPath(y,m)}static replacePathWithScheme(h,m){(m.endsWith("/")||m.endsWith("\\"))&&(m=m.substr(0,m.length-1));let y=new RegExp(m.replace(/[\/\\]+/g,"[\\/\\\\]+"),"gi");return h.replace(y,T.Settings.scheme+":")}static replacePathWithSchemeInLine(h,m){return PathUtil.replacePathWithScheme(h,m).replace(schemeQualifiedPathRegExp(),h=>h.replace(/[\/\\]+/g,"/"))}static removeRootFromFileSystemPath(h,m){(m.endsWith("/")||m.endsWith("\\"))&&(m=m.substr(0,m.length-1));let y=new RegExp(m.replace(/[\/\\]+/g,"[\\/\\\\]+"),"gi");return h.replace(y,"")}static convertToForwardSlashes(h){return h.replace(/\\\\/g,"/").replace(/\\/g,"/")}static convertToForwardSlashesIfNeeded(h,m){return"/"===m[0]?PathUtil.convertToForwardSlashes(h):h}static removeLeadingSlash(h){return h.startsWith("/")?h.substring(1):h}static removeFinalSlash(h){return h.endsWith("/")?h.substring(0,h.length-1):h}static ensureFinalSlash(h){return h&&!h.endsWith("/")?`${h}/`:h}static normalizePath(h){return this.removeFinalSlash(this.convertToForwardSlashes(h))}static EscapeBackslash(h){return h.replace(/\\/g,"\\\\")}static removePath(h,m=""){return h.replace(/([A-Za-z]:)?(\S*[\\\/])+\S*/gi,(h,y,v,C,T)=>{if(/^\d{1,4}\/\d{1,2}\/\d{1,4}$/.test(h))return h;{const C=(y?y.length:0)+v.length,T=h.substr(C);return m+T}})}static getWorkspaceName(h){return(C.basename(h)||h).replace(/:[\\|\/]?|\\|\//g,"$")}static getPrimaryWorkspaceFileSystemPath(){if(v.workspace.workspaceFolders&&v.workspace.workspaceFolders.length)return v.workspace.workspaceFolders[0].uri.fsPath}}m.PathUtil=PathUtil},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0}),m.DEFAULT_ANONYMOUS_USER_NAME="Guest User",m.READ_ONLY_LABEL="Read-only",m.READ_WRITE_LABEL="Read-write",m.LIVESHARE_EXTENSION_ID="ms-vsliveshare.vsliveshare",m.LIVESHARE_PRESENCE_PROVIDER_ID="LivesharePresence",m.LIVESHARE_JOIN_URI="https://vscode.dev/liveshare/"},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0});const v=y(166),C=y(5),T=y(93),w=y(4),A=y(230);function makeColorizeFunc(h){return m=>h+m+"[0m"}m.assert=function assert(h,m,y,P){h||(v.checkDebugging(),C.traceSource.withName(w.vsls.TraceSources.ClientCoEditing).error(`Assertion Violation: ${m}`),T.CoauthoringTelemetry.ReportFailedAssertion(y||m,P),A.showDiagnosticErrorMessage(`Coediting Assertion Violation: ${m}`))},function(h){h.black=makeColorizeFunc("[30m"),h.red=makeColorizeFunc("[31m"),h.green=makeColorizeFunc("[32m"),h.yellow=makeColorizeFunc("[33m"),h.blue=makeColorizeFunc("[34m"),h.magenta=makeColorizeFunc("[35m"),h.cyan=makeColorizeFunc("[36m"),h.white=makeColorizeFunc("[37m")}(m.colorize||(m.colorize={}));class LoggerImpl{constructor(){this.indentValue=0}indent(){this.indentValue++}reset(){this.indentValue=0}unindent(){this.indentValue--}logTrace(h,...m){this.logInternal(h.verbose.bind(h),...m)}log(...h){this.logInternal(console.log,...h)}logInternal(h,...m){let y="";for(let h=0;h<this.indentValue;h++)y+="|   ";h(y+m.join(""))}}m.LoggerImpl=LoggerImpl,m.logger=new LoggerImpl},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0});var v=y(1099);m.Access=v.Access,m.Role=v.Role,m.View=v.View,m.ViewItem=v.ViewItem,m.extensionId=v.extensionId,m.ActivityType=v.ActivityType},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0});const v=y(2);class ConnectionError extends v.BaseError{constructor(){super(...arguments),this.errorType="ConnectionError"}}m.ConnectionError=ConnectionError},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0});var v=y(272);m.LogLevel=v.LogLevel;var C=y(183);m.CallbackContainer=C.CallbackContainer;var T=y(493);m.HubMethodOption=T.HubMethodOption;var w=y(1189);m.ConnectionChangeType=w.ConnectionChangeType;var A=y(1190);m.ContactServiceProxy=A.ContactServiceProxy;var P=y(1191);m.RelayServiceProxy=P.RelayServiceProxy;var k=y(495);m.ParticipantChangeType=k.ParticipantChangeType,m.SendOption=k.SendOption;var R=y(496);m.RelayDataHubProxy=R.RelayDataHubProxy;var M=y(1192);m.SequenceRelayDataHubProxy=M.SequenceRelayDataHubProxy;var N=y(497);m.RelayHubMessageProperties=N.RelayHubMessageProperties},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0});var v=y(365);m.getPipePath=v.getPipePath;var C=y(846);m.lockAgent=C.lockAgent;var T=y(849);m.execAgent=T.execAgent,m.sudoExecAgent=T.sudoExecAgent,function __export(h){for(var y in h)m.hasOwnProperty(y)||(m[y]=h[y])}(y(851));var w=y(367);m.fileAccess=w.fileAccess;var A=y(882);m.getPlatformProperty=A.getPlatformProperty;var P=y(883);m.startSocketSession=P.startSocketSession,m.startSocketSessionOnPort=P.startSocketSessionOnPort,m.startSocketSessionOnPipe=P.startSocketSessionOnPipe;var k=y(216);m.OSPlatform=k.OSPlatform},function(h,m){h.exports=require("constants")},function(h,m){var y;m=h.exports=SemVer,y="object"==typeof process&&process.env&&process.env.NODE_DEBUG&&/\bsemver\b/i.test(process.env.NODE_DEBUG)?function(){var h=Array.prototype.slice.call(arguments,0);h.unshift("SEMVER"),console.log.apply(console,h)}:function(){},m.SEMVER_SPEC_VERSION="2.0.0";var v=Number.MAX_SAFE_INTEGER||9007199254740991,C=m.re=[],T=m.src=[],w=0,A=w++;T[A]="0|[1-9]\\d*";var P=w++;T[P]="[0-9]+";var k=w++;T[k]="\\d*[a-zA-Z-][a-zA-Z0-9-]*";var R=w++;T[R]="("+T[A]+")\\.("+T[A]+")\\.("+T[A]+")";var M=w++;T[M]="("+T[P]+")\\.("+T[P]+")\\.("+T[P]+")";var N=w++;T[N]="(?:"+T[A]+"|"+T[k]+")";var D=w++;T[D]="(?:"+T[P]+"|"+T[k]+")";var I=w++;T[I]="(?:-("+T[N]+"(?:\\."+T[N]+")*))";var x=w++;T[x]="(?:-?("+T[D]+"(?:\\."+T[D]+")*))";var O=w++;T[O]="[0-9A-Za-z-]+";var L=w++;T[L]="(?:\\+("+T[O]+"(?:\\."+T[O]+")*))";var U=w++,B="v?"+T[R]+T[I]+"?"+T[L]+"?";T[U]="^"+B+"$";var W="[v=\\s]*"+T[M]+T[x]+"?"+T[L]+"?",q=w++;T[q]="^"+W+"$";var Y=w++;T[Y]="((?:<|>)?=?)";var V=w++;T[V]=T[P]+"|x|X|\\*";var $=w++;T[$]=T[A]+"|x|X|\\*";var z=w++;T[z]="[v=\\s]*("+T[$]+")(?:\\.("+T[$]+")(?:\\.("+T[$]+")(?:"+T[I]+")?"+T[L]+"?)?)?";var G=w++;T[G]="[v=\\s]*("+T[V]+")(?:\\.("+T[V]+")(?:\\.("+T[V]+")(?:"+T[x]+")?"+T[L]+"?)?)?";var J=w++;T[J]="^"+T[Y]+"\\s*"+T[z]+"$";var X=w++;T[X]="^"+T[Y]+"\\s*"+T[G]+"$";var Z=w++;T[Z]="(?:^|[^\\d])(\\d{1,16})(?:\\.(\\d{1,16}))?(?:\\.(\\d{1,16}))?(?:$|[^\\d])";var ee=w++;T[ee]="(?:~>?)";var te=w++;T[te]="(\\s*)"+T[ee]+"\\s+",C[te]=new RegExp(T[te],"g");var re=w++;T[re]="^"+T[ee]+T[z]+"$";var ie=w++;T[ie]="^"+T[ee]+T[G]+"$";var se=w++;T[se]="(?:\\^)";var oe=w++;T[oe]="(\\s*)"+T[se]+"\\s+",C[oe]=new RegExp(T[oe],"g");var ae=w++;T[ae]="^"+T[se]+T[z]+"$";var ce=w++;T[ce]="^"+T[se]+T[G]+"$";var le=w++;T[le]="^"+T[Y]+"\\s*("+W+")$|^$";var ue=w++;T[ue]="^"+T[Y]+"\\s*("+B+")$|^$";var de=w++;T[de]="(\\s*)"+T[Y]+"\\s*("+W+"|"+T[z]+")",C[de]=new RegExp(T[de],"g");var he=w++;T[he]="^\\s*("+T[z]+")\\s+-\\s+("+T[z]+")\\s*$";var pe=w++;T[pe]="^\\s*("+T[G]+")\\s+-\\s+("+T[G]+")\\s*$";var me=w++;T[me]="(<|>)?=?\\s*\\*";for(var fe=0;fe<35;fe++)y(fe,T[fe]),C[fe]||(C[fe]=new RegExp(T[fe]));function parse(h,m){if(m&&"object"==typeof m||(m={loose:!!m,includePrerelease:!1}),h instanceof SemVer)return h;if("string"!=typeof h)return null;if(h.length>256)return null;if(!(m.loose?C[q]:C[U]).test(h))return null;try{return new SemVer(h,m)}catch(h){return null}}function SemVer(h,m){if(m&&"object"==typeof m||(m={loose:!!m,includePrerelease:!1}),h instanceof SemVer){if(h.loose===m.loose)return h;h=h.version}else if("string"!=typeof h)throw new TypeError("Invalid Version: "+h);if(h.length>256)throw new TypeError("version is longer than 256 characters");if(!(this instanceof SemVer))return new SemVer(h,m);y("SemVer",h,m),this.options=m,this.loose=!!m.loose;var T=h.trim().match(m.loose?C[q]:C[U]);if(!T)throw new TypeError("Invalid Version: "+h);if(this.raw=h,this.major=+T[1],this.minor=+T[2],this.patch=+T[3],this.major>v||this.major<0)throw new TypeError("Invalid major version");if(this.minor>v||this.minor<0)throw new TypeError("Invalid minor version");if(this.patch>v||this.patch<0)throw new TypeError("Invalid patch version");T[4]?this.prerelease=T[4].split(".").map((function(h){if(/^[0-9]+$/.test(h)){var m=+h;if(m>=0&&m<v)return m}return h})):this.prerelease=[],this.build=T[5]?T[5].split("."):[],this.format()}m.parse=parse,m.valid=function valid(h,m){var y=parse(h,m);return y?y.version:null},m.clean=function clean(h,m){var y=parse(h.trim().replace(/^[=v]+/,""),m);return y?y.version:null},m.SemVer=SemVer,SemVer.prototype.format=function(){return this.version=this.major+"."+this.minor+"."+this.patch,this.prerelease.length&&(this.version+="-"+this.prerelease.join(".")),this.version},SemVer.prototype.toString=function(){return this.version},SemVer.prototype.compare=function(h){return y("SemVer.compare",this.version,this.options,h),h instanceof SemVer||(h=new SemVer(h,this.options)),this.compareMain(h)||this.comparePre(h)},SemVer.prototype.compareMain=function(h){return h instanceof SemVer||(h=new SemVer(h,this.options)),compareIdentifiers(this.major,h.major)||compareIdentifiers(this.minor,h.minor)||compareIdentifiers(this.patch,h.patch)},SemVer.prototype.comparePre=function(h){if(h instanceof SemVer||(h=new SemVer(h,this.options)),this.prerelease.length&&!h.prerelease.length)return-1;if(!this.prerelease.length&&h.prerelease.length)return 1;if(!this.prerelease.length&&!h.prerelease.length)return 0;var m=0;do{var v=this.prerelease[m],C=h.prerelease[m];if(y("prerelease compare",m,v,C),void 0===v&&void 0===C)return 0;if(void 0===C)return 1;if(void 0===v)return-1;if(v!==C)return compareIdentifiers(v,C)}while(++m)},SemVer.prototype.inc=function(h,m){switch(h){case"premajor":this.prerelease.length=0,this.patch=0,this.minor=0,this.major++,this.inc("pre",m);break;case"preminor":this.prerelease.length=0,this.patch=0,this.minor++,this.inc("pre",m);break;case"prepatch":this.prerelease.length=0,this.inc("patch",m),this.inc("pre",m);break;case"prerelease":0===this.prerelease.length&&this.inc("patch",m),this.inc("pre",m);break;case"major":0===this.minor&&0===this.patch&&0!==this.prerelease.length||this.major++,this.minor=0,this.patch=0,this.prerelease=[];break;case"minor":0===this.patch&&0!==this.prerelease.length||this.minor++,this.patch=0,this.prerelease=[];break;case"patch":0===this.prerelease.length&&this.patch++,this.prerelease=[];break;case"pre":if(0===this.prerelease.length)this.prerelease=[0];else{for(var y=this.prerelease.length;--y>=0;)"number"==typeof this.prerelease[y]&&(this.prerelease[y]++,y=-2);-1===y&&this.prerelease.push(0)}m&&(this.prerelease[0]===m?isNaN(this.prerelease[1])&&(this.prerelease=[m,0]):this.prerelease=[m,0]);break;default:throw new Error("invalid increment argument: "+h)}return this.format(),this.raw=this.version,this},m.inc=function inc(h,m,y,v){"string"==typeof y&&(v=y,y=void 0);try{return new SemVer(h,y).inc(m,v).version}catch(h){return null}},m.diff=function diff(h,m){if(eq(h,m))return null;var y=parse(h),v=parse(m),C="";if(y.prerelease.length||v.prerelease.length){C="pre";var T="prerelease"}for(var w in y)if(("major"===w||"minor"===w||"patch"===w)&&y[w]!==v[w])return C+w;return T},m.compareIdentifiers=compareIdentifiers;var ye=/^[0-9]+$/;function compareIdentifiers(h,m){var y=ye.test(h),v=ye.test(m);return y&&v&&(h=+h,m=+m),h===m?0:y&&!v?-1:v&&!y?1:h<m?-1:1}function compare(h,m,y){return new SemVer(h,y).compare(new SemVer(m,y))}function gt(h,m,y){return compare(h,m,y)>0}function lt(h,m,y){return compare(h,m,y)<0}function eq(h,m,y){return 0===compare(h,m,y)}function neq(h,m,y){return 0!==compare(h,m,y)}function gte(h,m,y){return compare(h,m,y)>=0}function lte(h,m,y){return compare(h,m,y)<=0}function cmp(h,m,y,v){switch(m){case"===":return"object"==typeof h&&(h=h.version),"object"==typeof y&&(y=y.version),h===y;case"!==":return"object"==typeof h&&(h=h.version),"object"==typeof y&&(y=y.version),h!==y;case"":case"=":case"==":return eq(h,y,v);case"!=":return neq(h,y,v);case">":return gt(h,y,v);case">=":return gte(h,y,v);case"<":return lt(h,y,v);case"<=":return lte(h,y,v);default:throw new TypeError("Invalid operator: "+m)}}function Comparator(h,m){if(m&&"object"==typeof m||(m={loose:!!m,includePrerelease:!1}),h instanceof Comparator){if(h.loose===!!m.loose)return h;h=h.value}if(!(this instanceof Comparator))return new Comparator(h,m);y("comparator",h,m),this.options=m,this.loose=!!m.loose,this.parse(h),this.semver===ve?this.value="":this.value=this.operator+this.semver.version,y("comp",this)}m.rcompareIdentifiers=function rcompareIdentifiers(h,m){return compareIdentifiers(m,h)},m.major=function major(h,m){return new SemVer(h,m).major},m.minor=function minor(h,m){return new SemVer(h,m).minor},m.patch=function patch(h,m){return new SemVer(h,m).patch},m.compare=compare,m.compareLoose=function compareLoose(h,m){return compare(h,m,!0)},m.rcompare=function rcompare(h,m,y){return compare(m,h,y)},m.sort=function sort(h,y){return h.sort((function(h,v){return m.compare(h,v,y)}))},m.rsort=function rsort(h,y){return h.sort((function(h,v){return m.rcompare(h,v,y)}))},m.gt=gt,m.lt=lt,m.eq=eq,m.neq=neq,m.gte=gte,m.lte=lte,m.cmp=cmp,m.Comparator=Comparator;var ve={};function Range(h,m){if(m&&"object"==typeof m||(m={loose:!!m,includePrerelease:!1}),h instanceof Range)return h.loose===!!m.loose&&h.includePrerelease===!!m.includePrerelease?h:new Range(h.raw,m);if(h instanceof Comparator)return new Range(h.value,m);if(!(this instanceof Range))return new Range(h,m);if(this.options=m,this.loose=!!m.loose,this.includePrerelease=!!m.includePrerelease,this.raw=h,this.set=h.split(/\s*\|\|\s*/).map((function(h){return this.parseRange(h.trim())}),this).filter((function(h){return h.length})),!this.set.length)throw new TypeError("Invalid SemVer Range: "+h);this.format()}function isX(h){return!h||"x"===h.toLowerCase()||"*"===h}function hyphenReplace(h,m,y,v,C,T,w,A,P,k,R,M,N){return((m=isX(y)?"":isX(v)?">="+y+".0.0":isX(C)?">="+y+"."+v+".0":">="+m)+" "+(A=isX(P)?"":isX(k)?"<"+(+P+1)+".0.0":isX(R)?"<"+P+"."+(+k+1)+".0":M?"<="+P+"."+k+"."+R+"-"+M:"<="+A)).trim()}function testSet(h,m,v){for(var C=0;C<h.length;C++)if(!h[C].test(m))return!1;if(m.prerelease.length&&!v.includePrerelease){for(C=0;C<h.length;C++)if(y(h[C].semver),h[C].semver!==ve&&h[C].semver.prerelease.length>0){var T=h[C].semver;if(T.major===m.major&&T.minor===m.minor&&T.patch===m.patch)return!0}return!1}return!0}function satisfies(h,m,y){try{m=new Range(m,y)}catch(h){return!1}return m.test(h)}function outside(h,m,y,v){var C,T,w,A,P;switch(h=new SemVer(h,v),m=new Range(m,v),y){case">":C=gt,T=lte,w=lt,A=">",P=">=";break;case"<":C=lt,T=gte,w=gt,A="<",P="<=";break;default:throw new TypeError('Must provide a hilo val of "<" or ">"')}if(satisfies(h,m,v))return!1;for(var k=0;k<m.set.length;++k){var R=m.set[k],M=null,N=null;if(R.forEach((function(h){h.semver===ve&&(h=new Comparator(">=0.0.0")),M=M||h,N=N||h,C(h.semver,M.semver,v)?M=h:w(h.semver,N.semver,v)&&(N=h)})),M.operator===A||M.operator===P)return!1;if((!N.operator||N.operator===A)&&T(h,N.semver))return!1;if(N.operator===P&&w(h,N.semver))return!1}return!0}Comparator.prototype.parse=function(h){var m=this.options.loose?C[le]:C[ue],y=h.match(m);if(!y)throw new TypeError("Invalid comparator: "+h);this.operator=y[1],"="===this.operator&&(this.operator=""),y[2]?this.semver=new SemVer(y[2],this.options.loose):this.semver=ve},Comparator.prototype.toString=function(){return this.value},Comparator.prototype.test=function(h){return y("Comparator.test",h,this.options.loose),this.semver===ve||("string"==typeof h&&(h=new SemVer(h,this.options)),cmp(h,this.operator,this.semver,this.options))},Comparator.prototype.intersects=function(h,m){if(!(h instanceof Comparator))throw new TypeError("a Comparator is required");var y;if(m&&"object"==typeof m||(m={loose:!!m,includePrerelease:!1}),""===this.operator)return y=new Range(h.value,m),satisfies(this.value,y,m);if(""===h.operator)return y=new Range(this.value,m),satisfies(h.semver,y,m);var v=!(">="!==this.operator&&">"!==this.operator||">="!==h.operator&&">"!==h.operator),C=!("<="!==this.operator&&"<"!==this.operator||"<="!==h.operator&&"<"!==h.operator),T=this.semver.version===h.semver.version,w=!(">="!==this.operator&&"<="!==this.operator||">="!==h.operator&&"<="!==h.operator),A=cmp(this.semver,"<",h.semver,m)&&(">="===this.operator||">"===this.operator)&&("<="===h.operator||"<"===h.operator),P=cmp(this.semver,">",h.semver,m)&&("<="===this.operator||"<"===this.operator)&&(">="===h.operator||">"===h.operator);return v||C||T&&w||A||P},m.Range=Range,Range.prototype.format=function(){return this.range=this.set.map((function(h){return h.join(" ").trim()})).join("||").trim(),this.range},Range.prototype.toString=function(){return this.range},Range.prototype.parseRange=function(h){var m=this.options.loose;h=h.trim();var v=m?C[pe]:C[he];h=h.replace(v,hyphenReplace),y("hyphen replace",h),h=h.replace(C[de],"$1$2$3"),y("comparator trim",h,C[de]),h=(h=(h=h.replace(C[te],"$1~")).replace(C[oe],"$1^")).split(/\s+/).join(" ");var T=m?C[le]:C[ue],w=h.split(" ").map((function(h){return function parseComparator(h,m){return y("comp",h,m),h=function replaceCarets(h,m){return h.trim().split(/\s+/).map((function(h){return function replaceCaret(h,m){y("caret",h,m);var v=m.loose?C[ce]:C[ae];return h.replace(v,(function(m,v,C,T,w){var A;return y("caret",h,m,v,C,T,w),isX(v)?A="":isX(C)?A=">="+v+".0.0 <"+(+v+1)+".0.0":isX(T)?A="0"===v?">="+v+"."+C+".0 <"+v+"."+(+C+1)+".0":">="+v+"."+C+".0 <"+(+v+1)+".0.0":w?(y("replaceCaret pr",w),A="0"===v?"0"===C?">="+v+"."+C+"."+T+"-"+w+" <"+v+"."+C+"."+(+T+1):">="+v+"."+C+"."+T+"-"+w+" <"+v+"."+(+C+1)+".0":">="+v+"."+C+"."+T+"-"+w+" <"+(+v+1)+".0.0"):(y("no pr"),A="0"===v?"0"===C?">="+v+"."+C+"."+T+" <"+v+"."+C+"."+(+T+1):">="+v+"."+C+"."+T+" <"+v+"."+(+C+1)+".0":">="+v+"."+C+"."+T+" <"+(+v+1)+".0.0"),y("caret return",A),A}))}(h,m)})).join(" ")}(h,m),y("caret",h),h=function replaceTildes(h,m){return h.trim().split(/\s+/).map((function(h){return function replaceTilde(h,m){var v=m.loose?C[ie]:C[re];return h.replace(v,(function(m,v,C,T,w){var A;return y("tilde",h,m,v,C,T,w),isX(v)?A="":isX(C)?A=">="+v+".0.0 <"+(+v+1)+".0.0":isX(T)?A=">="+v+"."+C+".0 <"+v+"."+(+C+1)+".0":w?(y("replaceTilde pr",w),A=">="+v+"."+C+"."+T+"-"+w+" <"+v+"."+(+C+1)+".0"):A=">="+v+"."+C+"."+T+" <"+v+"."+(+C+1)+".0",y("tilde return",A),A}))}(h,m)})).join(" ")}(h,m),y("tildes",h),h=function replaceXRanges(h,m){return y("replaceXRanges",h,m),h.split(/\s+/).map((function(h){return function replaceXRange(h,m){h=h.trim();var v=m.loose?C[X]:C[J];return h.replace(v,(function(m,v,C,T,w,A){y("xRange",h,m,v,C,T,w,A);var P=isX(C),k=P||isX(T),R=k||isX(w);return"="===v&&R&&(v=""),P?m=">"===v||"<"===v?"<0.0.0":"*":v&&R?(k&&(T=0),w=0,">"===v?(v=">=",k?(C=+C+1,T=0,w=0):(T=+T+1,w=0)):"<="===v&&(v="<",k?C=+C+1:T=+T+1),m=v+C+"."+T+"."+w):k?m=">="+C+".0.0 <"+(+C+1)+".0.0":R&&(m=">="+C+"."+T+".0 <"+C+"."+(+T+1)+".0"),y("xRange return",m),m}))}(h,m)})).join(" ")}(h,m),y("xrange",h),h=function replaceStars(h,m){return y("replaceStars",h,m),h.trim().replace(C[me],"")}(h,m),y("stars",h),h}(h,this.options)}),this).join(" ").split(/\s+/);return this.options.loose&&(w=w.filter((function(h){return!!h.match(T)}))),w=w.map((function(h){return new Comparator(h,this.options)}),this)},Range.prototype.intersects=function(h,m){if(!(h instanceof Range))throw new TypeError("a Range is required");return this.set.some((function(y){return y.every((function(y){return h.set.some((function(h){return h.every((function(h){return y.intersects(h,m)}))}))}))}))},m.toComparators=function toComparators(h,m){return new Range(h,m).set.map((function(h){return h.map((function(h){return h.value})).join(" ").trim().split(" ")}))},Range.prototype.test=function(h){if(!h)return!1;"string"==typeof h&&(h=new SemVer(h,this.options));for(var m=0;m<this.set.length;m++)if(testSet(this.set[m],h,this.options))return!0;return!1},m.satisfies=satisfies,m.maxSatisfying=function maxSatisfying(h,m,y){var v=null,C=null;try{var T=new Range(m,y)}catch(h){return null}return h.forEach((function(h){T.test(h)&&(v&&-1!==C.compare(h)||(C=new SemVer(v=h,y)))})),v},m.minSatisfying=function minSatisfying(h,m,y){var v=null,C=null;try{var T=new Range(m,y)}catch(h){return null}return h.forEach((function(h){T.test(h)&&(v&&1!==C.compare(h)||(C=new SemVer(v=h,y)))})),v},m.minVersion=function minVersion(h,m){h=new Range(h,m);var y=new SemVer("0.0.0");if(h.test(y))return y;if(y=new SemVer("0.0.0-0"),h.test(y))return y;y=null;for(var v=0;v<h.set.length;++v){h.set[v].forEach((function(h){var m=new SemVer(h.semver.version);switch(h.operator){case">":0===m.prerelease.length?m.patch++:m.prerelease.push(0),m.raw=m.format();case"":case">=":y&&!gt(y,m)||(y=m);break;case"<":case"<=":break;default:throw new Error("Unexpected operation: "+h.operator)}}))}if(y&&h.test(y))return y;return null},m.validRange=function validRange(h,m){try{return new Range(h,m).range||"*"}catch(h){return null}},m.ltr=function ltr(h,m,y){return outside(h,m,"<",y)},m.gtr=function gtr(h,m,y){return outside(h,m,">",y)},m.outside=outside,m.prerelease=function prerelease(h,m){var y=parse(h,m);return y&&y.prerelease.length?y.prerelease:null},m.intersects=function intersects(h,m,y){return h=new Range(h,y),m=new Range(m,y),h.intersects(m)},m.coerce=function coerce(h){if(h instanceof SemVer)return h;if("string"!=typeof h)return null;var m=h.match(C[Z]);if(null==m)return null;return parse(m[1]+"."+(m[2]||"0")+"."+(m[3]||"0"))}},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0});const v=y(5),C=y(8),T=y(94),w=y(53),A=y(1020),P=y(1021),k=y(2),R=y(1022),M=y(1024),N=y(1025),D=y(408),I=y(1049),x=y(1050),O=y(425),L=y(428),U=y(430),B=y(431),W=y(450);class Dependencies{}function getRpcServices(){if(!Dependencies.rpcServices)throw new Error("rpcServices not defined");return Dependencies.rpcServices}m.Dependencies=Dependencies,m.dependencies=function(h,m,y){const T={rpcClient:k.delayedLoadMutable("rpcClient"),rpcFactory:(h,m)=>getRpcServices().rpcFactory(h,m),sessionContext:()=>h,trace:()=>m,telemetry:()=>y,contextUtil:k.lazyLoad(()=>new A.ContextUtil),workspaceService:k.lazyLoad(()=>getRpcServices().workspaceService()),accessControlService:k.lazyLoad(()=>getRpcServices().accessControlService()),workspaceAccessControlService:k.lazyLoad(()=>getRpcServices().workspaceAccessControlService()),fileService:k.lazyLoad(()=>getRpcServices().fileService()),streamManagerService:k.lazyLoad(()=>getRpcServices().streamManagerService()),streamService:k.lazyLoad(()=>getRpcServices().streamService()),chatService:k.lazyLoad(()=>getRpcServices().chatService()),terminalService:k.lazyLoad(()=>getRpcServices().terminalService()),rpcServiceHandler:()=>getRpcServices().rpcServiceHandler(),fileSystemManager:k.lazyLoad(()=>new D.FileSystemManager(T,T.sessionContext())),coEditingCommands:k.lazyLoad(()=>new I.CoEditingCommands(T.sessionContext())),pathManager:k.lazyLoad(()=>new w.PathManager(!1,T.fileService)),sourceEventService:k.lazyLoad(()=>getRpcServices().sourceEventService()),workspaceUserService:k.lazyLoad(()=>getRpcServices().workspaceUserService()),syncService:k.lazyLoad(()=>getRpcServices().syncService()),serverSharingService:k.lazyLoad(()=>getRpcServices().serverSharingService()),portForwardingService:k.lazyLoad(()=>getRpcServices().portForwardingService()),commandContextBuilder:k.lazyLoad(()=>new R.CommandContextBuilder(v.traceSource)),commandRegistryProvider:k.lazyLoad(()=>new M.CommandRegistryProvider(T.commandContextBuilder(),C.Telemetry,v.traceSource.withName("CommandRegistry"))),progressNotifierUtil:k.lazyLoad(()=>new P.ProgressNotifierUtil(T.contextUtil(),T.workspaceService(),v.traceSource.withName("Progress"))),authenticationFlow:k.lazyLoad(()=>new N.AuthenticationFlow(T.authenticationProvider(),v.traceSource.withName("AuthenticationFlow"))),authenticationProvider:k.delayedLoadMutable("authenticationProvider"),sessionStateManager:k.lazyLoad(()=>new x.SessionStateManager),methodDecorators:k.lazyLoad(()=>O.methodDecoratorsFactory(T)),authService:k.lazyLoadMutable(()=>new B.AuthenticationProviderService(v.traceSource.withName("AuthenticationProviderService"))),workspaceServices:k.lazyLoad(()=>new W.WorkspaceServices(T.workspaceService())),accessControlManager:k.lazyLoad(()=>new L.AccessControlManager(T.workspaceAccessControlService(),T.accessControlService(),T.sessionContext(),T.fileSystemManager(),T.hostSessionId())),hostSessionId:k.delayedLoadMutable("hostSessionId"),workspaceAccessControlManager:k.lazyLoad(()=>new U.WorkspaceAccessControlManager(T,T.hostSessionId())),statusBarController:k.delayedLoadMutable("statusBarController")};return T}(T.SessionContext,v.traceSource,C.Telemetry)},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0});const v=y(0);class TreeViewItem extends v.TreeItem{constructor(h){super(h.label,h.collapsibleState||v.TreeItemCollapsibleState.None),this.options=h,this.tooltip=h.tooltip,this.command=h.command,this.iconPath=h.iconPath,this.contextValue=h.type,this.resourceUri=h.resourceUri,this.description=h.description}}m.TreeViewItem=TreeViewItem},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0});const v=Object.prototype.toString;function string(h){return"[object String]"===v.call(h)}function func(h){return"[object Function]"===v.call(h)}function array(h){return Array.isArray(h)}m.boolean=function boolean(h){return!0===h||!1===h},m.string=string,m.number=function number(h){return"[object Number]"===v.call(h)},m.error=function error(h){return"[object Error]"===v.call(h)},m.func=func,m.array=array,m.stringArray=function stringArray(h){return array(h)&&h.every(h=>string(h))},m.typedArray=function typedArray(h,m){return Array.isArray(h)&&h.every(m)},m.thenable=function thenable(h){return h&&func(h.then)}},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0});const v=y(340);m.assert=(h,m)=>{if(!0!==h){throw"string"==typeof m?new v.AssertionError(m):m}}},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0}),function(h){h.accountProvider="accountProvider",h.account="account",h.connectionMode="connectionMode",h.allowGuestDebugControl="allowGuestDebugControl",h.allowGuestTaskControl="allowGuestTaskControl",h.autoShareServers="autoShareServers",h.anonymousGuestApproval="anonymousGuestApproval",h.diagnosticLoggingLevel="diagnosticLoggingLevel",h.diagnosticMode="diagnosticMode",h.accessibilityFeaturesEnabled="accessibility.accessibilityFeaturesEnabled",h.accessibilityOutputDevice="accessibility.outputDevice",h.accessibilityVoiceVolume="accessibility.voiceVolume",h.accessibilitySoundVolume="accessibility.soundVolume",h.accessibilitySpeechRate="accessibility.speechRate",h.accessibilityVoice="accessibility.voice",h.accessibilityVoiceEnabled="accessibility.voiceEnabled",h.accessibilitySoundsEnabled="accessibility.soundsEnabled",h.launcherClient="launcherClient",h.autoShareTerminals="autoShareTerminals",h.sharedTerminalWidth="sharedTerminalWidth",h.sharedTerminalHeight="sharedTerminalHeight",h.allowedDomains="allowedDomains",h.allowReadWriteTerminals="allowReadWriteTerminals",h.featureSet="featureSet",h.nameTagVisibility="nameTagVisibility",h.showReadOnlyUsersInEditor="showReadOnlyUsersInEditor",h.focusBehavior="focusBehavior",h.shareExternalFiles="shareExternalFiles",h.guestApprovalRequired="guestApprovalRequired",h.allowGuestCommandControl="languages.allowGuestCommandControl",h.allowGuestExecuteCells="notebooks.allowGuestExecuteCells",h.joinDebugSessionOption="joinDebugSessionOption",h.showVerboseNotifications="showVerboseNotifications",h.publishWorkspaceInfo="publishWorkspaceInfo",h.diagnosticLogging="diagnosticLogging",h.populateGitCoAuthors="populateGitCoAuthors",h.showInStatusBar="showInStatusBar",h.comments="comments",h.openSharedServers="openSharedServers",h.presence="presence",h.teamStatus="teamStatus",h.allowInvites="allowInvites",h.alwaysFollowHost="alwaysFollowHost",h.remoteLabelAndLinks="remoteLabelAndLinks",h.authFlowTest="authFlowTest",h.nativeAuthFlow="nativeAuthFlow",h.commandPrefix="commandPrefix",h.serviceUri="serviceUri",h.signalRServiceUri="signalRServiceUri",h.scheme="scheme",h.authority="authority",h.canCollectPII="canCollectPII",h.userEmail="userEmail",h.isInternal="isInternal",h.isCloudEnvironment="isCloudEnvironment",h.name="name",h.shortName="shortName",h.abbreviation="abbreviation",h.licenseUrl="licenseUrl",h.privacyUrl="privacyUrl",h.hasUsed="hasUsed",h.configName="configName",h.activityTimeout="activityTimeout",h.customAccountAuthReloadFlag="customAccountAuthReloadFlag",h.anonymousAuthReloadFlag="anonymousAuthReloadFlag",h.extensionPermissions="extensionPermissions",h.authenticationProvider="authenticationProvider",h.useClientFileService="useClientFileService",h.remoteSettingsUri="remoteSettingsUri",h.remoteSettingsUpdateMinutes="remoteSettingsUpdateMinutes",h.textSearchResultsLimit="textSearchResultsLimit",h.textSearchPreviewLimit="textSearchPreviewLimit",h.whatsNewUri="whatsNewUri",h.runsInVSCodeDev="runsInVSCodeDev",h.joinWorkspaceId="joinWorkspaceId",h.performanceLogging="performanceLogging",h.performanceRun="performanceRun",h.logTelemetry="logTelemetry",h.anonymousUserName="anonymousUserName",h.microphoneId="microphoneId",h.speakerId="speakerId",h.newChatDisplayDate="newChatDisplayDate",h.newAudioDisplayDate="newAudioDisplayDate",h.sessionCount="sessionCount",h.dontRequestFeedback="dontRequestFeedback",h.dontRequestAdditionalFeedback="dontRequestAdditionalFeedback",h.surveyShownDate="surveyShownDate",h.firstActivationTime="firstActivationTime",h.hasSelectedLauncherClient="hasSelectedLauncherClient"}(m.SettingKeys||(m.SettingKeys={})),function(h){h.stable="stable",h.insiders="insiders"}(m.FeatureSet||(m.FeatureSet={}))},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0});const v=y(4);class MessageFactory{static CoauthoringMessage(h){let m;switch(h.messageType){case v.vsls.MessageType.FileOpenAcknowledge:const y=h;m=MessageFactory.FileOpenAcknowledgeMessage(y.clientId,y.fileName,y.fileVersion,y.joinerId,y.savedVersionNumber,y.startServerVersionNumber,y.changes,y.fallbackText,y.history,y.isReadOnly,y.wasUnableToOpen);break;case v.vsls.MessageType.FileOpenRequest:const C=h;m=MessageFactory.FileOpenRequestMessage(C.clientId,C.fileName,C.hashCode,C.sendJumpTo);break;case v.vsls.MessageType.ResetFileClient:const T=h;m=MessageFactory.ResetFileClientMessage(T.clientId,T.fileName);break;case v.vsls.MessageType.Handshake:const w=h;m=MessageFactory.HandshakeMessage(w.clientId,w.fileName,w.hashCode,w.serverVersionNumber);break;case v.vsls.MessageType.FileRelease:const A=h;m=MessageFactory.FileReleaseMessage(A.clientId,A.fileName);break;case v.vsls.MessageType.JoinAcknowledge:const P=h;m=MessageFactory.JoinAcknowledgeMessage(P.clientId,P.joinerId,P.clientIds,P.files);break;case v.vsls.MessageType.JoinRequest:const k=h;m=MessageFactory.JoinRequestMessage(k.clientId);break;case v.vsls.MessageType.PresenterUpdate:const R=h;m=MessageFactory.PresenterUpdateMessage(R.clientId,R.newPresenterId);break;case v.vsls.MessageType.FollowChange:const M=h;m=MessageFactory.FollowChangeMessage(M.clientId,M.followedClient,M.follow);break;case v.vsls.MessageType.SaveFile:const N=h;m=MessageFactory.SaveFileMessage(N.clientId,N.fileName);break;case v.vsls.MessageType.SaveNotebook:const D=h;m=MessageFactory.SaveNotebookMessage(D.clientId,D.fileName);break;case v.vsls.MessageType.UntitledFileOpened:const I=h;m=MessageFactory.UntitledFileOpenedMessage(I.clientId,I.fileName);break;case v.vsls.MessageType.UntitledFileClosed:const x=h;m=MessageFactory.UntitledFileClosedMessage(x.clientId,x.fileName);break;case v.vsls.MessageType.DiffViewOpen:const O=h;m=MessageFactory.DiffViewOpenMessage(O.clientId,O.leftFile,O.rightFile);break;case v.vsls.MessageType.DiffViewClosed:const L=h;m=MessageFactory.DiffViewClosedMessage(L.clientId,L.leftFile,L.rightFile);break;case v.vsls.MessageType.SelectionChange:const U=h;m=MessageFactory.SelectionChangeMessage(U.clientId,U.fileName,U.fileVersion,U.serverVersionNumber,U.start,U.length,U.isReversed,U.kind,U.forceJumpForClientId);break;case v.vsls.MessageType.NotebookSelectionChange:const B=h;m=MessageFactory.NotebookSelectionChangeMessage(B.clientId,B.fileName,B.index);break;case v.vsls.MessageType.VisibleRangesChange:const W=h;m=MessageFactory.VisibleRangesChangeMessage(W.clientId,W.clientVisibleRanges);break;case v.vsls.MessageType.TextChange:const q=h,Y=q.changes&&q.changes.map(h=>MessageFactory.TextChange(h.start,h.length,h.newText));m=MessageFactory.TextChangeMessage(q.clientId,q.fileName,q.fileVersion,q.changeServerVersion,Y);break;case v.vsls.MessageType.Summon:const V=h;m=MessageFactory.SummonMessage(V.clientId,V.recipientId);break;case v.vsls.MessageType.LayoutScroll:const $=h;m=MessageFactory.LayoutScrollMessage($.clientId,$.fileName,$.fileVersion,$.serverVersionNumber,$.start,$.length,$.editorId,$.visibleRanges);break;case v.vsls.MessageType.NotebookScroll:const z=h;m=MessageFactory.NotebookScrollMessage(z.clientId,z.fileName,z.start,z.end);break;case v.vsls.MessageType.AnonymousAccessLevelChange:const G=h;m=MessageFactory.AnonymousAccessLevelChangeMessage(G.clientId,G.fileName);break;case v.vsls.MessageType.Ping:const J=h;m=MessageFactory.PingMessage(J.clientId);break;default:return h}return m.sendId=h.sendId,m}static SummonMessage(h,m){return{messageType:v.vsls.MessageType.Summon,clientId:h||0,recipientId:m}}static FileOpenAcknowledgeMessage(h,m,y,C,T,w,A,P,k,R,M){return{messageType:v.vsls.MessageType.FileOpenAcknowledge,clientId:h||0,fileName:m||"",fileVersion:y||0,joinerId:C||0,savedVersionNumber:T||0,startServerVersionNumber:w||0,changes:A||[],fallbackText:"string"==typeof P?P:void 0,history:k||[],isReadOnly:R||!1,wasUnableToOpen:M||!1}}static FileOpenRequestMessage(h,m,y,C){return{messageType:v.vsls.MessageType.FileOpenRequest,clientId:h||0,fileName:m||"",hashCode:y||0,sendJumpTo:C||!1}}static ResetFileClientMessage(h,m){return{messageType:v.vsls.MessageType.ResetFileClient,clientId:h||0,fileName:m||""}}static HandshakeMessage(h,m,y,C){return{messageType:v.vsls.MessageType.Handshake,clientId:h||0,fileName:m||"",hashCode:y||0,serverVersionNumber:C||0}}static FileReleaseMessage(h,m){return{messageType:v.vsls.MessageType.FileRelease,clientId:h||0,fileName:m||""}}static JoinAcknowledgeMessage(h,m,y,C){return{messageType:v.vsls.MessageType.JoinAcknowledge,clientId:h||0,joinerId:m||0,clientIds:y||[],files:C||[]}}static JoinRequestMessage(h){return{messageType:v.vsls.MessageType.JoinRequest,clientId:h||0}}static PresenterUpdateMessage(h,m){return{messageType:v.vsls.MessageType.PresenterUpdate,clientId:h||0,newPresenterId:m||0}}static FollowChangeMessage(h,m,y){return{messageType:v.vsls.MessageType.FollowChange,clientId:h||0,followedClient:m||0,follow:y||!1}}static AnonymousAccessLevelChangeMessage(h,m){return{messageType:v.vsls.MessageType.AnonymousAccessLevelChange,clientId:h||0,fileName:m||""}}static SaveFileMessage(h,m){return{messageType:v.vsls.MessageType.SaveFile,clientId:h||0,fileName:m||""}}static SaveNotebookMessage(h,m){return{messageType:v.vsls.MessageType.SaveNotebook,clientId:h||0,fileName:m||""}}static UntitledFileOpenedMessage(h,m){return{messageType:v.vsls.MessageType.UntitledFileOpened,clientId:h||0,fileName:m||""}}static UntitledFileClosedMessage(h,m){return{messageType:v.vsls.MessageType.UntitledFileClosed,clientId:h||0,fileName:m||""}}static DiffViewOpenMessage(h,m,y){return{messageType:v.vsls.MessageType.DiffViewOpen,clientId:h||0,leftFile:m||"",rightFile:y||""}}static DiffViewClosedMessage(h,m,y){return{messageType:v.vsls.MessageType.DiffViewClosed,clientId:h||0,leftFile:m||"",rightFile:y||""}}static SelectionChangeMessage(h,m,y,C,T,w,A,P,k){return{messageType:v.vsls.MessageType.SelectionChange,clientId:h||0,fileName:m||"",fileVersion:y,forceJumpForClientId:void 0===k?-1:k,isReversed:A||!1,length:w||0,serverVersionNumber:C||0,start:T||0,kind:P}}static NotebookSelectionChangeMessage(h,m,y){return{messageType:v.vsls.MessageType.NotebookSelectionChange,clientId:h||0,fileName:m||"",index:y||0}}static VisibleRangesChangeMessage(h,m){return{messageType:v.vsls.MessageType.VisibleRangesChange,clientId:h||0,clientVisibleRanges:m||[]}}static LayoutScrollMessage(h,m,y,C,T,w,A,P){return{messageType:v.vsls.MessageType.LayoutScroll,clientId:h||0,fileName:m||"",fileVersion:y,serverVersionNumber:C||0,start:T||0,length:w||0,editorId:A||"",visibleRanges:P||[]}}static NotebookScrollMessage(h,m,y,C){return{messageType:v.vsls.MessageType.NotebookScroll,clientId:h||0,fileName:m||"",start:y||0,end:C||0}}static PingMessage(h){return{messageType:v.vsls.MessageType.Ping,clientId:h||0}}static TextChangeMessage(h,m,y,C,T){return{messageType:v.vsls.MessageType.TextChange,changes:T||[],changeServerVersion:C||0,clientId:h||0,fileName:m||"",fileVersion:y}}static TextChange(h,m,y){return{length:m||0,newText:y||"",start:h||0}}}m.MessageFactory=MessageFactory,m.IsFileContentMessage=function IsFileContentMessage(h){switch(h.messageType){case v.vsls.MessageType.FileRelease:case v.vsls.MessageType.SaveFile:case v.vsls.MessageType.SelectionChange:case v.vsls.MessageType.TextChange:case v.vsls.MessageType.LayoutScroll:return!0;case v.vsls.MessageType.FileOpenAcknowledge:case v.vsls.MessageType.FileOpenRequest:case v.vsls.MessageType.JoinAcknowledge:case v.vsls.MessageType.JoinRequest:default:return!1}};class CoauthoringService{}m.CoauthoringService=CoauthoringService,CoauthoringService.SERVICE="Coauthoring"},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0}),m.ChannelFailureMessage=m.ChannelSuccessMessage=m.ChannelSignalMessage=m.CommandRequestMessage=m.ChannelRequestMessage=m.ChannelRequestType=m.ChannelCloseMessage=m.ChannelEofMessage=m.ChannelDataMessage=m.ChannelWindowAdjustMessage=m.ChannelOpenFailureMessage=m.SshChannelOpenFailureReason=m.ChannelOpenConfirmationMessage=m.ChannelOpenMessage=m.ConnectionMessage=void 0;const v=y(101),C=y(38);class ConnectionMessage extends v.SshMessage{}m.ConnectionMessage=ConnectionMessage;class ChannelOpenMessage extends ConnectionMessage{get messageType(){return 90}onRead(h){this.channelType=h.readString("ascii"),this.senderChannel=h.readUInt32(),this.initialWindowSize=h.readUInt32(),this.maximumPacketSize=h.readUInt32()}onWrite(h){h.writeString(this.validateField(this.channelType,"channel type"),"ascii"),h.writeUInt32(this.validateField(this.senderChannel,"sender channel")),h.writeUInt32(this.initialWindowSize||ChannelOpenMessage.defaultInitialWindowSize),h.writeUInt32(this.maximumPacketSize||ChannelOpenMessage.defaultMaximumPacketSize)}}m.ChannelOpenMessage=ChannelOpenMessage,ChannelOpenMessage.defaultInitialWindowSize=1048576,ChannelOpenMessage.defaultMaximumPacketSize=16384;class ChannelOpenConfirmationMessage extends ConnectionMessage{get messageType(){return 91}onRead(h){this.recipientChannel=h.readUInt32(),this.senderChannel=h.readUInt32(),this.initialWindowSize=h.readUInt32(),this.maximumPacketSize=h.readUInt32()}onWrite(h){h.writeUInt32(this.validateField(this.recipientChannel,"recipient channel")),h.writeUInt32(this.validateField(this.senderChannel,"sender channel")),h.writeUInt32(this.validateField(this.initialWindowSize,"initial window size")),h.writeUInt32(this.validateField(this.maximumPacketSize,"max packet size"))}toString(){return`${super.toString()} (recipientChannel=${this.recipientChannel} senderChannel=${this.senderChannel})`}}var T,w;m.ChannelOpenConfirmationMessage=ChannelOpenConfirmationMessage,function(h){h[h.none=0]="none",h[h.administrativelyProhibited=1]="administrativelyProhibited",h[h.connectFailed=2]="connectFailed",h[h.unknownChannelType=3]="unknownChannelType",h[h.resourceShortage=4]="resourceShortage"}(T=m.SshChannelOpenFailureReason||(m.SshChannelOpenFailureReason={}));class ChannelOpenFailureMessage extends ConnectionMessage{get messageType(){return 92}onRead(h){this.recipientChannel=h.readUInt32(),this.reasonCode=h.readUInt32(),this.description=h.readString("utf8"),this.language=h.readString("ascii")}onWrite(h){h.writeUInt32(this.validateField(this.recipientChannel,"recipient channel")),h.writeUInt32(this.validateField(this.reasonCode,"reason code")),h.writeString(this.description||"","utf8"),h.writeString(this.language||"en","ascii")}toString(){return`${super.toString} (${T[this.reasonCode||0]}: ${this.description})`}}m.ChannelOpenFailureMessage=ChannelOpenFailureMessage;class ChannelWindowAdjustMessage extends ConnectionMessage{get messageType(){return 93}onRead(h){this.recipientChannel=h.readUInt32(),this.bytesToAdd=h.readUInt32()}onWrite(h){h.writeUInt32(this.validateField(this.recipientChannel,"recipient channel")),h.writeUInt32(this.validateField(this.bytesToAdd,"bytes to add"))}}m.ChannelWindowAdjustMessage=ChannelWindowAdjustMessage;class ChannelDataMessage extends ConnectionMessage{get messageType(){return 94}onRead(h){this.recipientChannel=h.readUInt32(),this.data=h.readBinary()}onWrite(h){h.writeUInt32(this.validateField(this.recipientChannel,"recipient channel")),h.writeBinary(this.validateField(this.data,"data"))}toString(){return this.data?(0,C.formatBuffer)(this.data,""):"[0]"}}m.ChannelDataMessage=ChannelDataMessage;class ChannelEofMessage extends ConnectionMessage{get messageType(){return 96}onRead(h){this.recipientChannel=h.readUInt32()}onWrite(h){h.writeUInt32(this.validateField(this.recipientChannel,"recipient channel"))}}m.ChannelEofMessage=ChannelEofMessage;class ChannelCloseMessage extends ConnectionMessage{get messageType(){return 97}onRead(h){this.recipientChannel=h.readUInt32()}onWrite(h){h.writeUInt32(this.validateField(this.recipientChannel,"recipient channel"))}}m.ChannelCloseMessage=ChannelCloseMessage,function(h){h.command="exec",h.shell="shell",h.terminal="pty-req",h.signal="signal",h.exitSignal="exit-signal",h.exitStatus="exit-status"}(w=m.ChannelRequestType||(m.ChannelRequestType={}));class ChannelRequestMessage extends ConnectionMessage{constructor(h,m){super(),this.requestType=h,this.wantReply=null!=m&&m}get messageType(){return 98}onRead(h){this.recipientChannel=h.readUInt32(),this.requestType=h.readString("ascii"),this.wantReply=h.readBoolean()}onWrite(h){h.writeUInt32(this.recipientChannel||0),h.writeString(this.validateField(this.requestType,"request type"),"ascii"),h.writeBoolean(this.wantReply)}}m.ChannelRequestMessage=ChannelRequestMessage;m.CommandRequestMessage=class CommandRequestMessage extends ChannelRequestMessage{constructor(){super(),this.requestType=w.command}onRead(h){super.onRead(h),this.command=h.readString("utf8")}onWrite(h){super.onWrite(h),h.writeString(this.validateField(this.command,"command"),"utf8")}toString(){return`${super.toString()} (requestType=${this.requestType})`}};m.ChannelSignalMessage=class ChannelSignalMessage extends ChannelRequestMessage{constructor(){super()}get signal(){return this.signalValue}set signal(h){this.requestType=w.signal,this.signalValue=h}get exitSignal(){return this.signalValue}set exitSignal(h){this.requestType=w.exitSignal,this.signalValue=h}get errorMessage(){return this.errorMessageValue}set errorMessage(h){if(this.requestType!==w.exitSignal)throw new Error(`Error message property is only valid for ${w.exitSignal} messages.`);this.errorMessageValue=h}get exitStatus(){return this.statusValue}set exitStatus(h){this.requestType=w.exitStatus,this.statusValue=h}onRead(h){switch(super.onRead(h),this.requestType){case w.exitStatus:this.exitStatus=h.readUInt32();break;case w.signal:this.signal=h.readString("ascii");break;case w.exitSignal:this.exitSignal=h.readString("ascii"),h.readBoolean(),this.errorMessage=h.readString("utf8"),h.readString("ascii")}}onWrite(h){if(!this.requestType)throw new Error("Signal message request type not set.");switch(this.wantReply=!1,super.onWrite(h),this.requestType){case w.exitStatus:h.writeUInt32(this.validateField(this.exitStatus,"exit status"));break;case w.signal:h.writeString(this.validateField(this.signal,"signal"),"ascii");break;case w.exitSignal:h.writeString(this.validateField(this.exitSignal,"exit signal"),"ascii"),h.writeBoolean(!1),h.writeString(this.errorMessage||"","utf8"),h.writeString("","ascii");break;default:throw new Error(`Unknown signal message request type: ${this.requestType}`)}}};class ChannelSuccessMessage extends ConnectionMessage{get messageType(){return 99}onRead(h){this.recipientChannel=h.readUInt32()}onWrite(h){h.writeUInt32(this.validateField(this.recipientChannel,"recipient channel"))}}m.ChannelSuccessMessage=ChannelSuccessMessage;class ChannelFailureMessage extends ConnectionMessage{get messageType(){return 100}onRead(h){this.recipientChannel=h.readUInt32()}onWrite(h){h.writeUInt32(this.validateField(this.recipientChannel,"recipient channel"))}}m.ChannelFailureMessage=ChannelFailureMessage,v.SshMessage.index.set(90,ChannelOpenMessage),v.SshMessage.index.set(91,ChannelOpenConfirmationMessage),v.SshMessage.index.set(92,ChannelOpenFailureMessage),v.SshMessage.index.set(93,ChannelWindowAdjustMessage),v.SshMessage.index.set(94,ChannelDataMessage),v.SshMessage.index.set(96,ChannelEofMessage),v.SshMessage.index.set(97,ChannelCloseMessage),v.SshMessage.index.set(98,ChannelRequestMessage),v.SshMessage.index.set(99,ChannelSuccessMessage),v.SshMessage.index.set(100,ChannelFailureMessage)},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0}),m.PromiseCompletionSource=void 0;m.PromiseCompletionSource=class PromiseCompletionSource{constructor(){this.promise=new Promise((h,m)=>{this.resolve=h,this.reject=m})}resolve(h){}reject(h){}}},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0}),m.withCancellation=m.CancellationError=m.CancellationTokenSource=m.CancellationToken=void 0;const v=y(6);Object.defineProperty(m,"CancellationToken",{enumerable:!0,get:function(){return v.CancellationToken}}),Object.defineProperty(m,"CancellationTokenSource",{enumerable:!0,get:function(){return v.CancellationTokenSource}});class CancellationError extends Error{constructor(h){super(h||"Operation cancelled.")}}m.CancellationError=CancellationError,m.withCancellation=function withCancellation(h,m){return m?Promise.race([h,new Promise((h,y)=>{m.isCancellationRequested?y(new CancellationError):m.onCancellationRequested(()=>{y(new CancellationError)})})]):h}},function(h,m,y){var v=m.noop=function(){};function BufferingLogger(h,m,y){this.logFunction=y,this.identifier=h,this.uniqueID=m,this.buffer=[]}m.extend=function extend(h,m){for(var y in m)h[y]=m[y]},m.eventEmitterListenerCount=y(13).EventEmitter.listenerCount||function(h,m){return h.listeners(m).length},m.bufferAllocUnsafe=Buffer.allocUnsafe?Buffer.allocUnsafe:function oldBufferAllocUnsafe(h){return new Buffer(h)},m.bufferFromString=Buffer.from?Buffer.from:function oldBufferFromString(h,m){return new Buffer(h,m)},m.BufferingLogger=function createBufferingLogger(h,m){var C=y(471)(h);if(C.enabled){var T=new BufferingLogger(h,m,C),w=T.log.bind(T);return w.printOutput=T.printOutput.bind(T),w.enabled=C.enabled,w}return C.printOutput=v,C},BufferingLogger.prototype.log=function(){return this.buffer.push([new Date,Array.prototype.slice.call(arguments)]),this},BufferingLogger.prototype.clear=function(){return this.buffer=[],this},BufferingLogger.prototype.printOutput=function(h){h||(h=this.logFunction);var m=this.uniqueID;this.buffer.forEach((function(y){var v=y[0].toLocaleString(),C=y[1].slice(),T=C[0];null!=T&&(T="%s - %s - "+T.toString(),C.splice(0,1,T,v,m),h.apply(global,C))}))}},function(h,m,y){"use strict";function __export(h){for(var y in h)m.hasOwnProperty(y)||(m[y]=h[y])}Object.defineProperty(m,"__esModule",{value:!0}),__export(y(490)),__export(y(491));var v=y(492);m.HubConnectionServiceBase=v.HubConnectionServiceBase;var C=y(273);m.HubConnectionService=C.HubConnectionService;var T=y(506);m.HubConnectionServiceFactoryBase=T.HubConnectionServiceFactoryBase;var w=y(1206);m.HubConnectionServiceFactory=w.HubConnectionServiceFactory;var A=y(1207);m.RpcHubConnectionService=A.RpcHubConnectionService;var P=y(1208);m.dependencies=P.dependencies},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0}),m.ChannelFailureMessage=m.ChannelSuccessMessage=m.ChannelSignalMessage=m.CommandRequestMessage=m.ChannelRequestMessage=m.ChannelRequestType=m.ChannelCloseMessage=m.ChannelEofMessage=m.ChannelDataMessage=m.ChannelWindowAdjustMessage=m.ChannelOpenFailureMessage=m.SshChannelOpenFailureReason=m.ChannelOpenConfirmationMessage=m.ChannelOpenMessage=m.ConnectionMessage=void 0;const v=y(109),C=y(40);class ConnectionMessage extends v.SshMessage{}m.ConnectionMessage=ConnectionMessage;class ChannelOpenMessage extends ConnectionMessage{get messageType(){return 90}onRead(h){this.channelType=h.readString("ascii"),this.senderChannel=h.readUInt32(),this.initialWindowSize=h.readUInt32(),this.maximumPacketSize=h.readUInt32()}onWrite(h){h.writeString(this.validateField(this.channelType,"channel type"),"ascii"),h.writeUInt32(this.validateField(this.senderChannel,"sender channel")),h.writeUInt32(this.initialWindowSize||ChannelOpenMessage.defaultInitialWindowSize),h.writeUInt32(this.maximumPacketSize||ChannelOpenMessage.defaultMaximumPacketSize)}}m.ChannelOpenMessage=ChannelOpenMessage,ChannelOpenMessage.defaultInitialWindowSize=1048576,ChannelOpenMessage.defaultMaximumPacketSize=16384;class ChannelOpenConfirmationMessage extends ConnectionMessage{get messageType(){return 91}onRead(h){this.recipientChannel=h.readUInt32(),this.senderChannel=h.readUInt32(),this.initialWindowSize=h.readUInt32(),this.maximumPacketSize=h.readUInt32()}onWrite(h){h.writeUInt32(this.validateField(this.recipientChannel,"recipient channel")),h.writeUInt32(this.validateField(this.senderChannel,"sender channel")),h.writeUInt32(this.validateField(this.initialWindowSize,"initial window size")),h.writeUInt32(this.validateField(this.maximumPacketSize,"max packet size"))}toString(){return`${super.toString()} (recipientChannel=${this.recipientChannel} senderChannel=${this.senderChannel})`}}var T,w;m.ChannelOpenConfirmationMessage=ChannelOpenConfirmationMessage,function(h){h[h.none=0]="none",h[h.administrativelyProhibited=1]="administrativelyProhibited",h[h.connectFailed=2]="connectFailed",h[h.unknownChannelType=3]="unknownChannelType",h[h.resourceShortage=4]="resourceShortage"}(T=m.SshChannelOpenFailureReason||(m.SshChannelOpenFailureReason={}));class ChannelOpenFailureMessage extends ConnectionMessage{get messageType(){return 92}onRead(h){this.recipientChannel=h.readUInt32(),this.reasonCode=h.readUInt32(),this.description=h.readString("utf8"),this.language=h.readString("ascii")}onWrite(h){h.writeUInt32(this.validateField(this.recipientChannel,"recipient channel")),h.writeUInt32(this.validateField(this.reasonCode,"reason code")),h.writeString(this.description||"","utf8"),h.writeString(this.language||"en","ascii")}toString(){return`${super.toString} (${T[this.reasonCode||0]}: ${this.description})`}}m.ChannelOpenFailureMessage=ChannelOpenFailureMessage;class ChannelWindowAdjustMessage extends ConnectionMessage{get messageType(){return 93}onRead(h){this.recipientChannel=h.readUInt32(),this.bytesToAdd=h.readUInt32()}onWrite(h){h.writeUInt32(this.validateField(this.recipientChannel,"recipient channel")),h.writeUInt32(this.validateField(this.bytesToAdd,"bytes to add"))}}m.ChannelWindowAdjustMessage=ChannelWindowAdjustMessage;class ChannelDataMessage extends ConnectionMessage{get messageType(){return 94}onRead(h){this.recipientChannel=h.readUInt32(),this.data=h.readBinary()}onWrite(h){h.writeUInt32(this.validateField(this.recipientChannel,"recipient channel")),h.writeBinary(this.validateField(this.data,"data"))}toString(){return this.data?(0,C.formatBuffer)(this.data,""):"[0]"}}m.ChannelDataMessage=ChannelDataMessage;class ChannelEofMessage extends ConnectionMessage{get messageType(){return 96}onRead(h){this.recipientChannel=h.readUInt32()}onWrite(h){h.writeUInt32(this.validateField(this.recipientChannel,"recipient channel"))}}m.ChannelEofMessage=ChannelEofMessage;class ChannelCloseMessage extends ConnectionMessage{get messageType(){return 97}onRead(h){this.recipientChannel=h.readUInt32()}onWrite(h){h.writeUInt32(this.validateField(this.recipientChannel,"recipient channel"))}}m.ChannelCloseMessage=ChannelCloseMessage,function(h){h.command="exec",h.shell="shell",h.terminal="pty-req",h.signal="signal",h.exitSignal="exit-signal",h.exitStatus="exit-status"}(w=m.ChannelRequestType||(m.ChannelRequestType={}));class ChannelRequestMessage extends ConnectionMessage{constructor(h,m){super(),this.requestType=h,this.wantReply=null!=m&&m}get messageType(){return 98}onRead(h){this.recipientChannel=h.readUInt32(),this.requestType=h.readString("ascii"),this.wantReply=h.readBoolean()}onWrite(h){h.writeUInt32(this.recipientChannel||0),h.writeString(this.validateField(this.requestType,"request type"),"ascii"),h.writeBoolean(this.wantReply)}}m.ChannelRequestMessage=ChannelRequestMessage;m.CommandRequestMessage=class CommandRequestMessage extends ChannelRequestMessage{constructor(){super(),this.requestType=w.command}onRead(h){super.onRead(h),this.command=h.readString("utf8")}onWrite(h){super.onWrite(h),h.writeString(this.validateField(this.command,"command"),"utf8")}toString(){return`${super.toString()} (requestType=${this.requestType})`}};m.ChannelSignalMessage=class ChannelSignalMessage extends ChannelRequestMessage{constructor(){super()}get signal(){return this.signalValue}set signal(h){this.requestType=w.signal,this.signalValue=h}get exitSignal(){return this.signalValue}set exitSignal(h){this.requestType=w.exitSignal,this.signalValue=h}get errorMessage(){return this.errorMessageValue}set errorMessage(h){if(this.requestType!==w.exitSignal)throw new Error(`Error message property is only valid for ${w.exitSignal} messages.`);this.errorMessageValue=h}get exitStatus(){return this.statusValue}set exitStatus(h){this.requestType=w.exitStatus,this.statusValue=h}onRead(h){switch(super.onRead(h),this.requestType){case w.exitStatus:this.exitStatus=h.readUInt32();break;case w.signal:this.signal=h.readString("ascii");break;case w.exitSignal:this.exitSignal=h.readString("ascii"),h.readBoolean(),this.errorMessage=h.readString("utf8"),h.readString("ascii")}}onWrite(h){if(!this.requestType)throw new Error("Signal message request type not set.");switch(this.wantReply=!1,super.onWrite(h),this.requestType){case w.exitStatus:h.writeUInt32(this.validateField(this.exitStatus,"exit status"));break;case w.signal:h.writeString(this.validateField(this.signal,"signal"),"ascii");break;case w.exitSignal:h.writeString(this.validateField(this.exitSignal,"exit signal"),"ascii"),h.writeBoolean(!1),h.writeString(this.errorMessage||"","utf8"),h.writeString("","ascii");break;default:throw new Error(`Unknown signal message request type: ${this.requestType}`)}}};class ChannelSuccessMessage extends ConnectionMessage{get messageType(){return 99}onRead(h){this.recipientChannel=h.readUInt32()}onWrite(h){h.writeUInt32(this.validateField(this.recipientChannel,"recipient channel"))}}m.ChannelSuccessMessage=ChannelSuccessMessage;class ChannelFailureMessage extends ConnectionMessage{get messageType(){return 100}onRead(h){this.recipientChannel=h.readUInt32()}onWrite(h){h.writeUInt32(this.validateField(this.recipientChannel,"recipient channel"))}}m.ChannelFailureMessage=ChannelFailureMessage,v.SshMessage.index.set(90,ChannelOpenMessage),v.SshMessage.index.set(91,ChannelOpenConfirmationMessage),v.SshMessage.index.set(92,ChannelOpenFailureMessage),v.SshMessage.index.set(93,ChannelWindowAdjustMessage),v.SshMessage.index.set(94,ChannelDataMessage),v.SshMessage.index.set(96,ChannelEofMessage),v.SshMessage.index.set(97,ChannelCloseMessage),v.SshMessage.index.set(98,ChannelRequestMessage),v.SshMessage.index.set(99,ChannelSuccessMessage),v.SshMessage.index.set(100,ChannelFailureMessage)},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0}),m.PromiseCompletionSource=void 0;m.PromiseCompletionSource=class PromiseCompletionSource{constructor(){this.promise=new Promise((h,m)=>{this.resolve=h,this.reject=m})}resolve(h){}reject(h){}}},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0}),m.withCancellation=m.CancellationError=m.CancellationTokenSource=m.CancellationToken=void 0;const v=y(6);Object.defineProperty(m,"CancellationToken",{enumerable:!0,get:function(){return v.CancellationToken}}),Object.defineProperty(m,"CancellationTokenSource",{enumerable:!0,get:function(){return v.CancellationTokenSource}});class CancellationError extends Error{constructor(h){super(h||"Operation cancelled.")}}m.CancellationError=CancellationError,m.withCancellation=function withCancellation(h,m){return m?Promise.race([h,new Promise((h,y)=>{m.isCancellationRequested?y(new CancellationError):m.onCancellationRequested(()=>{y(new CancellationError)})})]):h}},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0});const v=y(3);m.AUTH_TOKEN_TENANT_ID="72f988bf-86f1-41af-91ab-2d7cd011db47",m.VSLS_CHAT_WINDOW={id:"vsls-window-id",displayName:v.localize("chat.sessionChatLabel")},function(h){h.startOrJoinCall="liveshare.callingService.startOrJoinCall",h.endCall="liveshare.callingService.endCall",h.muteSelf="liveshare.callingService.muteSelf",h.unmuteSelf="liveshare.callingService.unmuteSelf",h.muteOrUnmute="liveshare.callingService.muteOrUnmute",h.selectMicrophone="liveshare.callingService.selectMicrophone",h.selectSpeaker="liveshare.callingService.selectSpeaker",h.setMicrophone="liveshare.callingService.setDevice.microphone",h.setSpeaker="liveshare.callingService.setDevice.speaker",h.viewParticipants="liveshare.callingService.viewParticipants",h.callSettings="liveshare.callingService.callSettings"}(m.CallingServiceCommands||(m.CallingServiceCommands={})),m.MESSAGE_SERVICE_NAME="ms-vsliveshare.vsliveshare-audio.MessagingService",m.MESSAGE_SERVICE_NOTIFICATION_EVENT_NAME="notification",function(h){h[h.CallStarted=1]="CallStarted",h[h.CallInformationRequest=2]="CallInformationRequest"}(m.CallingEventType||(m.CallingEventType={}))},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0});var v=y(1366);m.default=v.default},function(h,m,y){var v=m.noop=function(){};function BufferingLogger(h,m,y){this.logFunction=y,this.identifier=h,this.uniqueID=m,this.buffer=[]}m.extend=function extend(h,m){for(var y in m)h[y]=m[y]},m.eventEmitterListenerCount=y(13).EventEmitter.listenerCount||function(h,m){return h.listeners(m).length},m.bufferAllocUnsafe=Buffer.allocUnsafe?Buffer.allocUnsafe:function oldBufferAllocUnsafe(h){return new Buffer(h)},m.bufferFromString=Buffer.from?Buffer.from:function oldBufferFromString(h,m){return new Buffer(h,m)},m.BufferingLogger=function createBufferingLogger(h,m){var C=y(328)(h);if(C.enabled){var T=new BufferingLogger(h,m,C),w=T.log.bind(T);return w.printOutput=T.printOutput.bind(T),w.enabled=C.enabled,w}return C.printOutput=v,C},BufferingLogger.prototype.log=function(){return this.buffer.push([new Date,Array.prototype.slice.call(arguments)]),this},BufferingLogger.prototype.clear=function(){return this.buffer=[],this},BufferingLogger.prototype.printOutput=function(h){h||(h=this.logFunction);var m=this.uniqueID;this.buffer.forEach((function(y){var v=y[0].toLocaleString(),C=y[1].slice(),T=C[0];null!=T&&(T="%s - %s - "+T.toString(),C.splice(0,1,T,v,m),h.apply(global,C))}))}},function(h,m,y){"use strict";var v=y(274).Buffer,C=y(28),T=y(184),w=y(1203),A=y(1204),P=y(1205);h.exports=function msgpack(h){var m=[],y=[];return{encode:P(m,(h=h||{forceFloat64:!1,compatibilityMode:!1,disableTimestampEncoding:!1,protoAction:"error"}).forceFloat64,h.compatibilityMode,h.disableTimestampEncoding),decode:A(y,h),register:function register(h,m,y,w){return C(m,"must have a constructor"),C(y,"must have an encode function"),C(h>=0,"must have a non-negative type"),C(w,"must have a decode function"),this.registerEncoder((function check(h){return h instanceof m}),(function reEncode(m){var C=T(),w=v.allocUnsafe(1);return w.writeInt8(h,0),C.append(w),C.append(y(m)),C})),this.registerDecoder(h,w),this},registerEncoder:function registerEncoder(h,y){return C(h,"must have an encode function"),C(y,"must have an encode function"),m.push({check:h,encode:y}),this},registerDecoder:function registerDecoder(h,m){return C(h>=0,"must have a non-negative type"),C(m,"must have a decode function"),y.push({type:h,decode:m}),this},encoder:w.encoder,decoder:w.decoder,buffer:!0,type:"msgpack5",IncompleteBufferError:A.IncompleteBufferError}}},function(h,m){h.exports=require("tty")},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0});class BaseError extends Error{constructor(h,m){super("string"==typeof h?h:null==h?void 0:h.message),this.errorCode=m,this.errorType="BaseError",h instanceof Error&&(this.originalError=h,this.stack=h.stack,this.originalErrorType=this.getOriginalErrorCode(h),this.errorCode=null!=m?m:h.errorCode)}getOriginalErrorCode(h){const{errorType:m="<no-type>",errorCode:y="<no-code>"}=h;return`[${m}:${y}]`}}m.BaseError=BaseError},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0});var v=y(89);m.BaseError=v.BaseError;var C=y(783);m.ByDesignError=C.ByDesignError;var T=y(784);m.AggregateError=T.AggregateError;var w=y(340);m.AssertionError=w.AssertionError;var A=y(342);m.PromiseRaceError=A.PromiseRaceError;var P=y(204);m.CancellationError=P.CancellationError;var k=y(785);m.NotImplementedError=k.NotImplementedError;var R=y(786);m.AuthenticationError=R.AuthenticationError;var M=y(787);m.TimeoutCancellationError=M.TimeoutCancellationError},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0});const v=y(8);class CommandError extends Error{constructor(h={}){super(h.message),this.isSuppressUserNotification=!1,this.code=h.code,this.userMessage=h.userMessage,this.telemetryResult=h.telemetryResult||v.TelemetryResult.Failure}withUserMessage(h){return this.userMessage=h,this}withSuppressUserNotification(h){return this.isSuppressUserNotification=h,this}}m.CommandError=CommandError},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0});const v=y(222),C=y(74),T=y(20);class Settings{static get(h){return Settings.settingsProvider.get(h)}static getMemento(h){return Settings.settingsProvider.mementoConfig.get(h)}static saveMemento(h,m){return Settings.settingsProvider.mementoConfig.save(h,m)}static getUri(h,m){const y=m?Settings.getMemento(h):Settings.get(h);if(y)return parseUrl(y)}static get scheme(){return"vsls"}static get isVSLSTeamMember(){return!!Settings.get(C.SettingKeys.teamStatus)}static get isInternalFeatureSet(){return Settings.get(C.SettingKeys.isInternal)}static get isInsidersFeatureSet(){const h=Settings.get(C.SettingKeys.featureSet);return!!h&&C.FeatureSet[h]===C.FeatureSet.insiders}static get isNativeAuth(){return!!Settings.get(C.SettingKeys.nativeAuthFlow)}static save(h,m,y=!0){return Settings.settingsProvider.save(h,m,y)}}function parseUrl(h){try{return T.parse(h)}catch(h){return}}m.Settings=Settings,Settings.settingsProvider=v.settingsProviderInstance,m.featureFlags={api:!1,localUndo:!1,localRedo:!1,multiRootWorkspaceVSIDE:!1,propagateFolderEvents:!1,agentExtension:!1,comments:!0,attemptReconnection:!0},m.parseUrl=parseUrl},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0});const v=y(15),C=y(8),T=y(61),w=y(17);class CoauthoringTelemetry{static init(){C.Telemetry.addFilter(new C.SendOnceFilter(Event.ASSERTION_FAILED,[w.TelemetryPropertyNames.EVENT_MESSAGE])),C.Telemetry.addFilter(new C.SendOnceFilter(Event.COEDITING_ERROR,[w.TelemetryPropertyNames.EVENT_MESSAGE])),C.Telemetry.addFilter(new C.SendOnceFilter(Event.DESYNC)),C.Telemetry.addFilter(new C.SendOnceFilter(Event.SYNC_CHECK)),C.Telemetry.addFilter(new C.SendOnceFilter(Event.SYNC_CHECK_LOCAL)),C.Telemetry.addFilter(new C.SendOnceFilter(Event.SYNC_CHECK_FOR_VERSION)),C.Telemetry.addFilter(new C.SendOnceFilter(Event.SLOW_SYNC_CHECK)),C.Telemetry.addFilter(new C.SendOnceFilter(Event.DROPPED_MESSAGE,[Property.ID_TYPE,Property.WITH_DELAY])),C.Telemetry.addFilter(new C.SendOnceFilter("block-coeditattempt",["liveshare.BlockReason"])),C.Telemetry.addFilter(new C.SendOnceFilter(w.TelemetryEventNames.ADD_EXTERNAL_FILE)),C.Telemetry.addFilter(new C.SendOnceFilter(Event.SLOW_PING)),this.coeditingLogs=new v.MemoryTraceListener(50)}static ReportMetrics(h){let m=new C.TelemetryEvent(Event.REPORT_METRICS);for(let y of h)y.AttachToEvent(m);m.send()}static get logListener(){return CoauthoringTelemetry.coeditingLogs}static getLogs(){return this.coeditingLogs.getLogs().reverse().join("\n")}static addLogs(h){let m=this.getLogs();m=m.replace(/[\\|\/]/gi,"-"),h.addProperty(Property.LOGS,m)}static BufferClosed(h,m,y,v,T,w,A,P,k,R,M,N,D){const I=new C.TelemetryEvent(Event.BUFFER_CLOSED);I.addProperty(Property.CONTENT_TYPE,h),I.addMeasure(Property.NUMBER_OF_LOCAL_EDITS,m),I.addMeasure(Property.NUMBER_OF_REMOTE_EDITS,y),I.addProperty(Property.NUMBER_OF_HIGH_DENSITY_EDITS,JSON.stringify(v)),I.addMeasure(Property.NUMBER_OF_LOCAL_UNDOS,T),I.addMeasure(Property.NUMBER_OF_REMOTE_UNDOS,w),I.addMeasure(Property.NUMBER_OF_SIMULTANEOUS_EDITS,k),I.addMeasure(Property.LINE_DIFF_COUNT,R),I.addMeasure(Property.LINE_DIFF_SUM,M),I.addMeasure(Property.NUMBER_OF_VISIBLE_EDITS,N),I.addMeasure(Property.NUMBER_OF_INVISIBLE_EDITS,D),I.send()}static AddSessionClosedEventAugmenter(h){this.sessionClosedEventAugmenters.push(h)}static SessionClosed(h,m,y,v,T,w,A,P,k,R){const M=new C.TelemetryEvent(Event.SESSION_CLOSED);this.sessionClosedEventAugmenters.forEach(h=>h(M)),this.sessionClosedEventAugmenters=[],M.addMeasure(Property.NUMBER_OF_JUMP_TOS,h),M.addMeasure(Property.NUMBER_OF_FAILED_JUMP_TOS,m),M.addMeasure(Property.NUMBER_OF_PINS,y),M.addMeasure(Property.NUMBER_OF_EXPLICIT_UNPINS,v),M.addMeasure(Property.NUMBER_OF_AUTOMATIC_UNPINS,T),M.addMeasure(Property.NUMBER_OF_SYNC_CHECKS,w),M.addMeasure(Property.NUMBER_OF_FAILED_SYNC_CHECKS,A),M.addMeasure(Property.NUMBER_OF_SLOW_SYNC_CHECKS,P),M.addMeasure(Property.NUMBER_OF_OPEN_DIFFS,k),M.addMeasure(Property.NUMBER_OF_CLOSED_DIFFS,R),M.send()}static ReportNonFunctionalNavigation(h){const m=new C.TelemetryEvent(Event.NON_FUNCTIONAL_NAVIGATION);m.addProperty(Property.NON_FUNCTIONAL_NAVIGATION,A[h]),m.send()}static ReportDesync(h,m,y,v=!1){const T=new C.TelemetryEvent(Event.DESYNC);T.addProperty(Property.DESYNC_REASON,P[h]),T.addProperty(Property.FILE_EXTENSION,m),T.addProperty(Property.MONIKER,y),T.addProperty(Property.DESYNC_RECOVERY,v),this.addLogs(T),T.send()}static ReportFuzzyDesync(h,m,y){const v=new C.TelemetryEvent(Event.FUZZY_DESYNC);v.addProperty(Property.FILE_EXTENSION,h),v.addProperty(Property.MONIKER,m),v.addProperty(Property.AUTO_SAVE,y),this.addLogs(v),v.send()}static ReportFalseDesync(){new C.TelemetryEvent(Event.FALSE_DESYNC).send()}static ReportSyncCheck(){new C.TelemetryEvent(Event.SYNC_CHECK).send()}static ReportLocalSyncCheck(){new C.TelemetryEvent(Event.SYNC_CHECK_LOCAL).send()}static ReportSyncCheckForVersion(h){const m=new C.TelemetryEvent(Event.SYNC_CHECK_FOR_VERSION);m.addProperty(Property.SENDING_SYNC_CHECK,h),m.send()}static ReportSlowSyncCheck(){new C.TelemetryEvent(Event.SLOW_SYNC_CHECK).send()}static ReportFailedAssertion(h,m){const y=new C.Fault(Event.ASSERTION_FAILED,C.FaultType.Error,h,new Error("Assertion Failed"));if(m){const h=m.split("."),v=h.length>1?h.pop():"NA",C=T.PathUtil.getMonikerFromRelativePath(m).moniker||"None";y.addProperty(Property.FILE_EXTENSION,v),y.addProperty(Property.MONIKER,C)}this.addLogs(y),y.send()}static ReportCoeditingError(h,m){new C.Fault(Event.COEDITING_ERROR,C.FaultType.Error,h,m).send()}static ReportDroppedMessage(h,m,y,v){const T=new C.TelemetryEvent(Event.DROPPED_MESSAGE);T.addMeasure(Property.EXPECTED_ID,h),T.addMeasure(Property.ACTUAL_ID,m),T.addProperty(Property.ID_TYPE,y),T.addProperty(Property.WITH_DELAY,v),T.send()}static ReportCaseSensitiveFileSystem(){new C.TelemetryEvent(Event.REPORT_CASE_SENSITIVE_FILE_SYSTEM).send()}}m.CoauthoringTelemetry=CoauthoringTelemetry,CoauthoringTelemetry.FEATURE_PREFIX="Coauthoring/",CoauthoringTelemetry.PROPERTY_PREFIX=w.TelemetryPropertyNames.FEATURE_NAME+"Coauthoring.",CoauthoringTelemetry.sessionClosedEventAugmenters=[];m.TimeTelemetry=class TimeTelemetry{constructor(h,m){this.total=0,this.canceled=0,this.failed=0,this.sum=0,this.buckets=[new Bucket(25),new Bucket(50),new Bucket(100),new Bucket(250),new Bucket(500),new Bucket(1e3),new Bucket(2e3),new Bucket(Number.MAX_SAFE_INTEGER)],this.name=h,CoauthoringTelemetry.AddSessionClosedEventAugmenter(h=>{m&&m(),this.AttachToEvent(h)})}RecordTime(h){this.total++,this.sum+=h.valueOf();for(let m=0;m<this.buckets.length;m++)if(this.buckets[m].max>=h)return void this.buckets[m].count++}AttachToEvent(h){this.buckets.forEach(m=>{h.addMeasure(`${CoauthoringTelemetry.PROPERTY_PREFIX}${this.name}.${m.name}`,m.count)}),h.addMeasure(`${CoauthoringTelemetry.PROPERTY_PREFIX}${this.name}.count`,this.total),h.addMeasure(`${CoauthoringTelemetry.PROPERTY_PREFIX}${this.name}.canceled`,this.canceled),h.addMeasure(`${CoauthoringTelemetry.PROPERTY_PREFIX}${this.name}.failed`,this.failed);let m=0;0!==this.total&&(m=this.sum/this.total),h.addMeasure(`${CoauthoringTelemetry.PROPERTY_PREFIX}${this.name}.average`,m)}RecordCancel(){this.canceled++,this.total++}RecordFailed(){this.failed++,this.total++}};class Bucket{constructor(h){this.max=0,this.count=0,this.max=h,this.name="bucket."+(this.max===Number.MAX_SAFE_INTEGER?"max":this.max.toString())}}var A,P;m.Bucket=Bucket,function(h){h[h.FindInFiles=0]="FindInFiles"}(A=m.NonFunctionalNavigation||(m.NonFunctionalNavigation={})),function(h){h[h.Unknown=0]="Unknown",h[h.MessagesOutOfOrder=1]="MessagesOutOfOrder"}(P=m.DesyncReason||(m.DesyncReason={}));class Event{}m.Event=Event,Event.NON_FUNCTIONAL_NAVIGATION=CoauthoringTelemetry.FEATURE_PREFIX+"navigate-nonfunctional",Event.BUFFER_CLOSED=CoauthoringTelemetry.FEATURE_PREFIX+"close-buffer",Event.SESSION_CLOSED=CoauthoringTelemetry.FEATURE_PREFIX+"close-session",Event.REPORT_METRICS=CoauthoringTelemetry.FEATURE_PREFIX+"report-timingmetrics",Event.DESYNC=CoauthoringTelemetry.FEATURE_PREFIX+"desync-coediting",Event.DESYNC_RELOAD=CoauthoringTelemetry.FEATURE_PREFIX+"desync-reload",Event.FUZZY_DESYNC=CoauthoringTelemetry.FEATURE_PREFIX+"desync-fuzzy",Event.FALSE_DESYNC=CoauthoringTelemetry.FEATURE_PREFIX+"desync-falsealarm",Event.SYNC_CHECK=CoauthoringTelemetry.FEATURE_PREFIX+"sync-check",Event.SYNC_CHECK_LOCAL=CoauthoringTelemetry.FEATURE_PREFIX+"sync-checklocal",Event.SYNC_CHECK_FOR_VERSION=CoauthoringTelemetry.FEATURE_PREFIX+"sync-checkforversion",Event.SLOW_SYNC_CHECK=CoauthoringTelemetry.FEATURE_PREFIX+"sync-checkslow",Event.COEDITING_ERROR=CoauthoringTelemetry.FEATURE_PREFIX+"coedit-processing-error",Event.DROPPED_MESSAGE=CoauthoringTelemetry.FEATURE_PREFIX+"drop-message",Event.DROPPED_HOST_MESSAGE_FAULT=w.TelemetryEventNames.FAULT_PREFIX+"drop-hostmessage-fault",Event.ASSERTION_FAILED=w.TelemetryEventNames.FAULT_PREFIX+"assert-coediting-fault",Event.ADD_UNTITLED_FILE=CoauthoringTelemetry.FEATURE_PREFIX+"add-untitledfile",Event.RECEIVE_UNTITLED_FILE=CoauthoringTelemetry.FEATURE_PREFIX+"receive-untitledfile",Event.CLOSE_UNTITLED_FILE=CoauthoringTelemetry.FEATURE_PREFIX+"close-untitledfile",Event.SAVE_UNTITLED_FILE=CoauthoringTelemetry.FEATURE_PREFIX+"save-untitledfile",Event.REPORT_CASE_SENSITIVE_FILE_SYSTEM=CoauthoringTelemetry.FEATURE_PREFIX+"report-casesensitivefilesystem",Event.SLOW_PING="ping-slow",Event.RESYNC_DOCUMENT="resync-document";class Property{}Property.CONTENT_TYPE=CoauthoringTelemetry.PROPERTY_PREFIX+"ContentType",Property.NUMBER_OF_LOCAL_EDITS=CoauthoringTelemetry.PROPERTY_PREFIX+"NumberOfLocalEdits",Property.NUMBER_OF_REMOTE_EDITS=CoauthoringTelemetry.PROPERTY_PREFIX+"NumberOfRemoteEdits",Property.NUMBER_OF_HIGH_DENSITY_EDITS=CoauthoringTelemetry.PROPERTY_PREFIX+"NumberOfHighDensityEdits",Property.NUMBER_OF_LOCAL_UNDOS=CoauthoringTelemetry.PROPERTY_PREFIX+"NumberOfLocalUndos",Property.NUMBER_OF_REMOTE_UNDOS=CoauthoringTelemetry.PROPERTY_PREFIX+"NumberOfRemoteUndos",Property.NUMBER_OF_HIGHLIGHTS=CoauthoringTelemetry.PROPERTY_PREFIX+"NumberOfHighlights",Property.AVERAGE_LATENCY=CoauthoringTelemetry.PROPERTY_PREFIX+"AverageLatency",Property.NUMBER_OF_JUMP_TOS=CoauthoringTelemetry.PROPERTY_PREFIX+"NumberOfJumpTos",Property.NUMBER_OF_FAILED_JUMP_TOS=CoauthoringTelemetry.PROPERTY_PREFIX+"NumberOfFailedJumpTos",Property.NUMBER_OF_PINS=CoauthoringTelemetry.PROPERTY_PREFIX+"NumberOfPins",Property.NUMBER_OF_EXPLICIT_UNPINS=CoauthoringTelemetry.PROPERTY_PREFIX+"NumberOfExplicitUnpins",Property.NUMBER_OF_AUTOMATIC_UNPINS=CoauthoringTelemetry.PROPERTY_PREFIX+"NumberOfAutomaticUnpins",Property.NUMBER_OF_SYNC_CHECKS=CoauthoringTelemetry.PROPERTY_PREFIX+"NumberOfSyncChecks",Property.SENDING_SYNC_CHECK=CoauthoringTelemetry.PROPERTY_PREFIX+"SendingSyncCheck",Property.NUMBER_OF_FAILED_SYNC_CHECKS=CoauthoringTelemetry.PROPERTY_PREFIX+"NumberOfFailedSyncChecks",Property.NUMBER_OF_SLOW_SYNC_CHECKS=CoauthoringTelemetry.PROPERTY_PREFIX+"NumberOfSlowSyncChecks",Property.NON_FUNCTIONAL_NAVIGATION=CoauthoringTelemetry.PROPERTY_PREFIX+"NonFunctionalNavigation",Property.DESYNC_REASON=CoauthoringTelemetry.PROPERTY_PREFIX+"DesyncReason",Property.FILE_EXTENSION=CoauthoringTelemetry.PROPERTY_PREFIX+"FileExtension",Property.MONIKER=CoauthoringTelemetry.PROPERTY_PREFIX+"Moniker",Property.AUTO_SAVE=CoauthoringTelemetry.PROPERTY_PREFIX+"AutoSave",Property.NUMBER_OF_SIMULTANEOUS_EDITS=CoauthoringTelemetry.PROPERTY_PREFIX+"NumSimultaneousEdits",Property.LINE_DIFF_SUM=CoauthoringTelemetry.PROPERTY_PREFIX+"LineDiffSum",Property.LINE_DIFF_COUNT=CoauthoringTelemetry.PROPERTY_PREFIX+"LineDiffCount",Property.NUMBER_OF_VISIBLE_EDITS=CoauthoringTelemetry.PROPERTY_PREFIX+"NumVisibleEdits",Property.NUMBER_OF_INVISIBLE_EDITS=CoauthoringTelemetry.PROPERTY_PREFIX+"NumInvisibleEdits",Property.DESYNC_RECOVERY=CoauthoringTelemetry.PROPERTY_PREFIX+"DesyncRecovery",Property.NUMBER_OF_OPEN_DIFFS=CoauthoringTelemetry.PROPERTY_PREFIX+"NumOpenDiff",Property.NUMBER_OF_CLOSED_DIFFS=CoauthoringTelemetry.PROPERTY_PREFIX+"NumClosedDiff",Property.ID_TYPE=CoauthoringTelemetry.PROPERTY_PREFIX+"IdType",Property.EXPECTED_ID=CoauthoringTelemetry.PROPERTY_PREFIX+"ExpectedEventId",Property.ACTUAL_ID=CoauthoringTelemetry.PROPERTY_PREFIX+"ActualEventId",Property.WITH_DELAY=CoauthoringTelemetry.PROPERTY_PREFIX+"WithDelay",Property.LOGS=CoauthoringTelemetry.PROPERTY_PREFIX+"Logs"},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0});const v=y(0),C=y(2),T=y(24),w=y(979),A=y(23),P=y(26),k=y(32),R=y(1018),M=y(171),N=y(1019),D=y(22),I=y(12),x=y(14),O=y(8),L=y(17);class SessionContext{constructor(){this.guestCountByIDE={},this.distinctGuestCountByIDE={},this.collaboratorChangedEmitter=new v.EventEmitter,this.onCollaboratorChanged=this.collaboratorChangedEmitter.event,this.hasCollaboratorsChangedEmitter=new v.EventEmitter,this.onHasCollaboratorsChanged=this.hasCollaboratorsChangedEmitter.event,this.accessControlChangedEmitter=new v.EventEmitter,this.onAccessControlChanged=this.accessControlChangedEmitter.event,this.collaboratorsJoinedEmitter=new v.EventEmitter,this.onCollaboratorsJoined=this.collaboratorsJoinedEmitter.event,this.coeditingClientChangedEmitter=new v.EventEmitter,this.onCoeditingClientChanged=this.coeditingClientChangedEmitter.event,A.sessionStateTracker.onStateChanged(this.onSessionStateChanged.bind(this)),this.sessionPromiseMap=new Map([[D.SessionPromise.EnvironmentReadyForFileOperation,new C.Signal],[D.SessionPromise.JoiningCompleted,new C.Signal]]),P.workspaceSessionInfoTracker.onReadOnlyChanged(h=>{T.ExtensionUtil.setCommandContext("liveshare:isReadOnlySession",h)})}get coeditingClient(){return this.coeditingClientInstance}updateTelemetryContext(h){let m=[D.SessionState.Shared,D.SessionState.Joined].indexOf(h.oldState)>=0;if(this.isCollaborating){if(P.workspaceSessionInfoTracker.workspaceSessionInfo){let m=h.newState===D.SessionState.Shared;const y=v.workspace.getConfiguration(I.Settings.get(x.SettingKeys.configName));M.SessionTelemetry.startSession(m,y),m&&this.resetTelemetry()}}else m&&(N.CollaboratorsTelemetry.endSession(),M.SessionTelemetry.endSession(this.guestCountByIDE,this.distinctGuestCountByIDE))}onWorkspaceAccessControlChanged(h){this.accessControlChangedEmitter.fire(h)}getLatestPreviousSessionId(h){if(!this.collaboratorManager)return;const{userIdBySessionIdHistory:m}=this.collaboratorManager,y=[];for(let v of Object.keys(m)){const C=parseInt(v,10);h===m[v]&&y.push(C)}return Math.max(...y)}initCoEditingContext(h){if(!P.workspaceSessionInfoTracker.workspaceSessionInfo)throw new Error("Failed to join a collaboration session. The host is offline. Ask them to start the session and rejoin.");let m=O.Telemetry.startTimedEvent(L.TelemetryEventNames.INITIALIZE_COAUTHORING,!0);m.addMeasure(L.TelemetryPropertyNames.NUM_OPEN_FILES,v.window.visibleTextEditors.length),k.userAuthStateTracker.userInfo=h.userInfo,this.collaboratorManager=new R.CollaboratorManager(this,P.workspaceSessionInfoTracker.workspaceSessionInfo.sessions),this.collaboratorManager.onCollaboratorsJoined(()=>this.collaboratorsJoinedEmitter.fire()),this.collaboratorManager.onCollaboratorChanged(h=>{this.collaboratorsChanged(h),N.CollaboratorsTelemetry.sendChangeCollaboratorsEvent(h)});const y=new w.CoEditing({sourceEventService:h.sourceEventService,clientID:P.workspaceSessionInfoTracker.workspaceSessionInfo.sessionNumber,isGuest:h.isGuest,fileService:h.fileSystemService,pathManager:h.pathManager,clientAccessCheck:h.clientAccessCheck,collaboratorManager:this.collaboratorManager,joinCompleted:h.joinCompleted,fileSystemManager:h.fileSystemManager,syncService:h.syncService,presentationMode:P.workspaceSessionInfoTracker.workspaceSessionInfo.isPresentation});return y.init(),this.coeditingClientInstance=y,this.coeditingClientChangedEmitter.fire(y),m.end(O.TelemetryResult.Success),new v.Disposable(()=>y.dispose())}collaboratorsChanged(h){for(let h of this.collaboratorManager.getIDEs())void 0===this.guestCountByIDE[h]&&(this.guestCountByIDE[h]=0),void 0===this.distinctGuestCountByIDE[h]&&(this.distinctGuestCountByIDE[h]=0),this.guestCountByIDE[h]=Math.max(this.guestCountByIDE[h],this.collaboratorManager.getCollaboratorCountByIDE(h)),this.distinctGuestCountByIDE[h]=Math.max(this.distinctGuestCountByIDE[h],this.collaboratorManager.getDistinctCollaboratorCountByIDE(h));this.collaboratorChangedEmitter.fire(h)}disposeCoEditingContext(){P.workspaceSessionInfoTracker.workspaceSessionInfo=null,this.collaboratorManager&&(this.collaboratorManager.dispose(),this.collaboratorManager=null),this.coeditingClientInstance&&(this.coeditingClientInstance.dispose(),this.coeditingClientInstance=null,this.coeditingClientChangedEmitter.fire(null))}get hasServersShared(){return this.serversShared}set hasServersShared(h){this.serversShared=h,T.ExtensionUtil.setCommandContext("liveshare:isServerShared",h)}get hasSharedTerminals(){return this.hasSharedTerminalsFlag}set hasSharedTerminals(h){this.hasSharedTerminalsFlag=h,T.ExtensionUtil.setCommandContext("liveshare:hasSharedTerminals",h)}get isPlannedSessionsReady(){return this.isPlannedSessionsReadyFlag}set isPlannedSessionsReady(h){this.isPlannedSessionsReadyFlag=h,T.ExtensionUtil.setCommandContext("liveshare:isPlannedSessionsReady",h)}get isCollaborating(){return[D.SessionState.Shared,D.SessionState.Joined].indexOf(A.sessionStateTracker.State)>=0}get isStartingCollaboration(){return[D.SessionState.JoiningInProgress,D.SessionState.SharingInProgress].indexOf(A.sessionStateTracker.State)>=0}onSessionStateChanged(h){this.isCollaborating&&I.Settings.save(x.SettingKeys.hasUsed,!0),this.updateTelemetryContext(h);const{newState:m}=h;T.ExtensionUtil.setCommandContext("liveshare:state",D.SessionState[m]),T.ExtensionUtil.setCommandContext("liveshare:isCollaborating",m===D.SessionState.Shared||m===D.SessionState.Joined),m!==D.SessionState.Joined&&m!==D.SessionState.Shared&&(this.disposeCoEditingContext(),this.hasServersShared=!1,this.hasSharedTerminals=!1,P.workspaceSessionInfoTracker.isReadOnly=!1)}get hasCollaborators(){return this.hasCollaboratorsFlag}set hasCollaborators(h){h!==this.hasCollaboratorsFlag&&(this.hasCollaboratorsFlag=h,T.ExtensionUtil.setCommandContext("liveshare:hasCollaborators",h),this.hasCollaboratorsChangedEmitter.fire(h))}waitForSessionPromise(h){return this.sessionPromiseMap.get(h).promise}joined(){this.sessionPromiseMap.get(D.SessionPromise.EnvironmentReadyForFileOperation).isFulfilled||this.environmentReadyForFileOperation(),A.sessionStateTracker.transition(D.SessionAction.JoiningSuccess),this.sessionPromiseMap.get(D.SessionPromise.JoiningCompleted).resolve()}environmentReadyForFileOperation(){this.sessionPromiseMap.get(D.SessionPromise.EnvironmentReadyForFileOperation).resolve()}notJoining(){this.sessionPromiseMap.get(D.SessionPromise.JoiningCompleted).resolve(null)}static get Instance(){return SessionContext.singleton||(SessionContext.singleton=new SessionContext),SessionContext.singleton}resetTelemetry(){N.CollaboratorsTelemetry.resetActiveEvent(!1),N.CollaboratorsTelemetry.listenerAdded||(N.CollaboratorsTelemetry.listenerAdded=!0,this.onHasCollaboratorsChanged(h=>{N.CollaboratorsTelemetry.activeEvent.end(O.TelemetryResult.Success),N.CollaboratorsTelemetry.resetActiveEvent(h)}))}dispose(){this.isCollaborating&&M.SessionTelemetry.endSession(this.guestCountByIDE,this.distinctGuestCountByIDE)}}m.SessionContextClass=SessionContext;const U=SessionContext.Instance;m.SessionContext=U},function(h,m,y){"use strict";var v=this&&this.__awaiter||function(h,m,y,v){return new(y||(y=Promise))((function(C,T){function fulfilled(h){try{step(v.next(h))}catch(h){T(h)}}function rejected(h){try{step(v.throw(h))}catch(h){T(h)}}function step(h){h.done?C(h.value):function adopt(h){return h instanceof y?h:new y((function(m){m(h)}))}(h.value).then(fulfilled,rejected)}step((v=v.apply(h,m||[])).next())}))};Object.defineProperty(m,"__esModule",{value:!0});const C=y(0),T=y(987),w=C.env.clipboard,A=void 0!==w;m.ClipboardUtil=class ClipboardUtil{pasteFromClipboardAsync(){return v(this,void 0,void 0,(function*(){try{return A?yield w.readText():yield T.clipboard.readAsync()}catch(h){return""}}))}copyToClipboardAsync(h){return v(this,void 0,void 0,(function*(){try{return A?yield w.writeText(h):yield T.clipboard.writeAsync(h),!0}catch(h){return!1}}))}}},function(h,m,y){"use strict";var v=this&&this.__awaiter||function(h,m,y,v){return new(y||(y=Promise))((function(C,T){function fulfilled(h){try{step(v.next(h))}catch(h){T(h)}}function rejected(h){try{step(v.throw(h))}catch(h){T(h)}}function step(h){h.done?C(h.value):function adopt(h){return h instanceof y?h:new y((function(m){m(h)}))}(h.value).then(fulfilled,rejected)}step((v=v.apply(h,m||[])).next())}))};Object.defineProperty(m,"__esModule",{value:!0});const C=y(0),T=y(1026),w=y(8);m.getKeytar=()=>function getNodeModule(h){const m=require;try{return m(`${C.env.appRoot}/node_modules.asar/${h}`)}catch(h){}try{return m(`${C.env.appRoot}/node_modules/${h}`)}catch(h){}}("keytar");class Authentication{init(h,y,C=[],A){return v(this,void 0,void 0,(function*(){this.authAPI=yield T.activateInternal(h,y,w.Telemetry,[...C],A||m.getKeytar())}))}get API(){if(!this.authAPI)throw new Error("The auth API wasn't yet initialized. Please call the `init` function first");return this.authAPI}}m.Authentication=Authentication,m.auth=new Authentication},function(h,m,y){"use strict";var v=this&&this.__awaiter||function(h,m,y,v){return new(y||(y=Promise))((function(C,T){function fulfilled(h){try{step(v.next(h))}catch(h){T(h)}}function rejected(h){try{step(v.throw(h))}catch(h){T(h)}}function step(h){h.done?C(h.value):function adopt(h){return h instanceof y?h:new y((function(m){m(h)}))}(h.value).then(fulfilled,rejected)}step((v=v.apply(h,m||[])).next())}))};Object.defineProperty(m,"__esModule",{value:!0});const C=y(0),T=y(5),w=y(1054),A=y(1086);var P;!function(h){h.GitHub="github",h.Microsoft="microsoft"}(P=m.SupportedAuthProviders||(m.SupportedAuthProviders={}));m.NativeAuthProvider=class NativeAuthProvider{constructor(){this.registeredTokenProviders=new Map,this.onSignOutEmitter=new C.EventEmitter,this.onSignOut=this.onSignOutEmitter.event,this.registeredTokenProviders.set(P.GitHub,new w.GitHubAuthTokenProvider),this.registeredTokenProviders.set(P.Microsoft,new A.MicrosoftAuthTokenProvider),this.registeredTokenProviders.forEach(h=>{h.onSignOut(this.handleOnDidSignOut.bind(this))})}getCachedTokenOrLogin(h,m){return v(this,void 0,void 0,(function*(){let y=yield this.getCachedToken(h);if(y)return y;let v=this.registeredTokenProviders.get(h);return v?(yield v.signIn(m))?yield v.getAccessToken():(T.traceSource.verbose(`Attempt to login with ${h} failed`),null):(T.traceSource.verbose(`Attempting to log in with not supported auth provider - ${h}`),null)}))}getCachedToken(h){return v(this,void 0,void 0,(function*(){let m=this.registeredTokenProviders.get(h);return m?yield m.getAccessToken():(T.traceSource.verbose(`Attempting to get a cached auth token from not supported auth provider - ${h}`),null)}))}resetAccessTokenCache(h){let m=this.registeredTokenProviders.get(h);if(!m)return T.traceSource.verbose(`Attempting to reset a cached auth token of unsupported auth provider - ${h}`),null;m.resetCascadeToken()}handleOnDidSignOut(){this.onSignOutEmitter.fire()}}},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0}),m.algorithmNames=m.SshAlgorithms=m.Encryption=m.ECDsa=m.Rsa=m.HmacAlgorithm=m.EncryptionAlgorithm=m.PublicKeyAlgorithm=m.KeyExchangeAlgorithm=void 0;const v=y(245);Object.defineProperty(m,"KeyExchangeAlgorithm",{enumerable:!0,get:function(){return v.KeyExchangeAlgorithm}});const C=y(126);Object.defineProperty(m,"PublicKeyAlgorithm",{enumerable:!0,get:function(){return C.PublicKeyAlgorithm}});const T=y(246);Object.defineProperty(m,"EncryptionAlgorithm",{enumerable:!0,get:function(){return T.EncryptionAlgorithm}});const w=y(247);Object.defineProperty(m,"HmacAlgorithm",{enumerable:!0,get:function(){return w.HmacAlgorithm}});const A=!("object"!=typeof crypto||!crypto.subtle),P=y(1055),k=y(1056),R=y(1057),M=y(1058),N=y(248),D=y(1059),I=A?P.WebDiffieHellman:y(436).NodeDiffieHellman,x=A?P.WebECDiffieHellman:y(436).NodeECDiffieHellman,O=A?k.WebRsa:y(1060).NodeRsa;m.Rsa=O;const L=A?R.WebECDsa:y(1075).NodeECDsa;m.ECDsa=L;const U=A?M.WebEncryption:y(1076).NodeEncryption;m.Encryption=U;const B=A?N.WebHmac:y(250).NodeHmac,W=A?D.WebRandom:y(1077).NodeRandom;class SshAlgorithms{}m.SshAlgorithms=SshAlgorithms,SshAlgorithms.keyExchange={none:null,dhGroup14Sha256:new I("diffie-hellman-group14-sha256",2048,"SHA2-256"),dhGroup16Sha512:new I("diffie-hellman-group16-sha512",4096,"SHA2-512"),ecdhNistp256Sha256:new x("ecdh-sha2-nistp256",256,"SHA2-256"),ecdhNistp384Sha384:new x("ecdh-sha2-nistp384",384,"SHA2-384"),ecdhNistp521Sha512:new x("ecdh-sha2-nistp521",521,"SHA2-512")},SshAlgorithms.publicKey={none:null,rsaWithSha256:new O("rsa-sha2-256","SHA2-256"),rsaWithSha512:new O("rsa-sha2-512","SHA2-512"),ecdsaSha2Nistp256:new L("ecdsa-sha2-nistp256","SHA2-256"),ecdsaSha2Nistp384:new L("ecdsa-sha2-nistp384","SHA2-384"),ecdsaSha2Nistp521:new L("ecdsa-sha2-nistp521","SHA2-512")},SshAlgorithms.encryption={none:null,aes256Ctr:new U("aes256-ctr","AES","CTR",256),aes256Gcm:new U("aes256-gcm@openssh.com","AES","GCM",256)},SshAlgorithms.hmac={none:null,hmacSha256:new B("hmac-sha2-256","SHA2-256"),hmacSha512:new B("hmac-sha2-512","SHA2-512"),hmacSha256Etm:new B("hmac-sha2-256-etm@openssh.com","SHA2-256",!0),hmacSha512Etm:new B("hmac-sha2-512-etm@openssh.com","SHA2-512",!0)},SshAlgorithms.compression={none:null},SshAlgorithms.random=new W,m.algorithmNames=function algorithmNames(h){return h.map(h=>h?h.name:"none")}},function(h,m,y){h.exports={pkcs1:y(1062),pkcs1_oaep:y(1063),pss:y(1064),isEncryption:function(m){return h.exports[m]&&h.exports[m].isEncryption},isSignature:function(m){return h.exports[m]&&h.exports[m].isSignature}}},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0}),m.findService=m.serviceActivation=void 0,m.serviceActivation=function serviceActivation(h){return m=>{m.activations||(m.activations=[]),m.activations.push(h)}},m.findService=function findService(h,m){for(let y of h.keys()){const h=y.activations;let v=!1;for(let C of h)if(v=!0,m(C))return y;if(!v)throw new Error(`SSH service type '${y.name}' must have one or more `+"'serviceActivation' decorators.")}return null}},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0}),m.SshMessage=void 0;const v=y(9),C=y(38);class SshMessage{get messageType(){return 0}toBuffer(){const h=new C.SshDataWriter(v.Buffer.alloc(16));return this.write(h),h.toBuffer()}read(h){this.rawBytes=h.buffer;const m=h.readByte();if(m!==this.messageType)throw new Error(`Message type ${m} is not valid.`);this.onRead(h)}write(h){h.writeByte(this.messageType),this.onWrite(h)}onRead(h){throw new Error("Not supported.")}onWrite(h){throw new Error("Not supported.")}validateField(h,m){if(void 0===h)throw new Error(`${this.constructor.name} ${m} is required.`);return h}toString(){return this.constructor.name}static create(h,m){const y=SshMessage.index.get(h);if(y){const h=new y;return h.read(new C.SshDataReader(m)),h}return null}convertTo(h,m=!1){const y=new C.SshDataReader(m?v.Buffer.from(this.rawBytes):this.rawBytes);return h.read(y),h}}m.SshMessage=SshMessage,SshMessage.index=new Map},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0}),function(h){h[h.None=0]="None",h[h.Sharing=1]="Sharing",h[h.Joined=2]="Joined",h[h.SharedOrJoined=3]="SharedOrJoined",h[h.NotSharedOrJoined=4]="NotSharedOrJoined"}(m.TreeDataProviderContext||(m.TreeDataProviderContext={}))},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0});const v=y(34),C=y(427),T=y(70);m.telemetryCommandDecorator=function telemetryCommandDecorator(h,m,y,w=1,A){return v.DecoratorHelper.setupDecorator(P=>new C.TelemetryCommandDecorator(v.DecoratorHelper.getCoreCommand(P),P,T.dependencies.workspaceService(),T.dependencies.telemetry(),h,m,y,w,A))}},function(h,m,y){"use strict";var v=this&&this.__importStar||function(h){if(h&&h.__esModule)return h;var m={};if(null!=h)for(var y in h)Object.hasOwnProperty.call(h,y)&&(m[y]=h[y]);return m.default=h,m};Object.defineProperty(m,"__esModule",{value:!0});var C=y(133);m.Connection=C.Connection;var T=y(267);m.LiveShareConnection=T.LiveShareConnection;var w=y(1166);m.VSCodeConnection=w.VSCodeConnection;var A=y(1169);m.CodespaceConnection=A.CodespaceConnection;var P=y(1170);m.LiveShareJointConnection=P.LiveShareJointConnection;var k=y(1171);m.VSCodeJointConnection=k.VSCodeJointConnection;var R=y(484);m.ConnectionHub=R.ConnectionHub;var M=y(134);m.errorToConnectionError=M.errorToConnectionError;var N=y(482);m.getVSCodeServerSessionName=N.getVSCodeServerSessionName;var D=y(483);m.isVSCodeServerSession=D.isVSCodeServerSession;var I=y(481);m.vscodeServerHostRPCService=I.vscodeServerHostRPCService;var x=y(479);m.TConnectionTypes=x.TConnectionTypes,function __export(h){for(var y in h)m.hasOwnProperty(y)||(m[y]=h[y])}(y(1174));const O=v(y(1175));m.mocks=O;var L=y(269);m.PerformanceEventIds=L.PerformanceEventIds;var U=y(480);m.PerformanceGroupIds=U.PerformanceGroupIds;var B=y(270);m.VSCODE_SERVER_PORT_NAME=B.VSCODE_SERVER_PORT_NAME},function(h,m,y){try{var v=y(10);if("function"!=typeof v.inherits)throw"";h.exports=v.inherits}catch(m){h.exports=y(1199)}},function(h,m,y){"use strict";var v=y(185),C=Object.keys||function(h){var m=[];for(var y in h)m.push(y);return m};h.exports=Duplex;var T=Object.create(y(136));T.inherits=y(105);var w=y(500),A=y(503);T.inherits(Duplex,w);for(var P=C(A.prototype),k=0;k<P.length;k++){var R=P[k];Duplex.prototype[R]||(Duplex.prototype[R]=A.prototype[R])}function Duplex(h){if(!(this instanceof Duplex))return new Duplex(h);w.call(this,h),A.call(this,h),h&&!1===h.readable&&(this.readable=!1),h&&!1===h.writable&&(this.writable=!1),this.allowHalfOpen=!0,h&&!1===h.allowHalfOpen&&(this.allowHalfOpen=!1),this.once("end",onend)}function onend(){this.allowHalfOpen||this._writableState.ended||v.nextTick(onEndNT,this)}function onEndNT(h){h.end()}Object.defineProperty(Duplex.prototype,"writableHighWaterMark",{enumerable:!1,get:function(){return this._writableState.highWaterMark}}),Object.defineProperty(Duplex.prototype,"destroyed",{get:function(){return void 0!==this._readableState&&void 0!==this._writableState&&(this._readableState.destroyed&&this._writableState.destroyed)},set:function(h){void 0!==this._readableState&&void 0!==this._writableState&&(this._readableState.destroyed=h,this._writableState.destroyed=h)}}),Duplex.prototype._destroy=function(h,m){this.push(null),this.end(),v.nextTick(m,h)}},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0}),m.algorithmNames=m.SshAlgorithms=m.Encryption=m.ECDsa=m.Rsa=m.HmacAlgorithm=m.EncryptionAlgorithm=m.PublicKeyAlgorithm=m.KeyExchangeAlgorithm=void 0;const v=y(276);Object.defineProperty(m,"KeyExchangeAlgorithm",{enumerable:!0,get:function(){return v.KeyExchangeAlgorithm}});const C=y(138);Object.defineProperty(m,"PublicKeyAlgorithm",{enumerable:!0,get:function(){return C.PublicKeyAlgorithm}});const T=y(277);Object.defineProperty(m,"EncryptionAlgorithm",{enumerable:!0,get:function(){return T.EncryptionAlgorithm}});const w=y(278);Object.defineProperty(m,"HmacAlgorithm",{enumerable:!0,get:function(){return w.HmacAlgorithm}});const A=!("object"!=typeof crypto||!crypto.subtle),P=y(1210),k=y(1211),R=y(1212),M=y(1213),N=y(279),D=y(1214),I=A?P.WebDiffieHellman:y(512).NodeDiffieHellman,x=A?P.WebECDiffieHellman:y(512).NodeECDiffieHellman,O=A?k.WebRsa:y(1215).NodeRsa;m.Rsa=O;const L=A?R.WebECDsa:y(1216).NodeECDsa;m.ECDsa=L;const U=A?M.WebEncryption:y(1217).NodeEncryption;m.Encryption=U;const B=A?N.WebHmac:y(281).NodeHmac,W=A?D.WebRandom:y(1218).NodeRandom;class SshAlgorithms{}m.SshAlgorithms=SshAlgorithms,SshAlgorithms.keyExchange={none:null,dhGroup14Sha256:new I("diffie-hellman-group14-sha256",2048,"SHA2-256"),dhGroup16Sha512:new I("diffie-hellman-group16-sha512",4096,"SHA2-512"),ecdhNistp256Sha256:new x("ecdh-sha2-nistp256",256,"SHA2-256"),ecdhNistp384Sha384:new x("ecdh-sha2-nistp384",384,"SHA2-384"),ecdhNistp521Sha512:new x("ecdh-sha2-nistp521",521,"SHA2-512")},SshAlgorithms.publicKey={none:null,rsaWithSha256:new O("rsa-sha2-256","SHA2-256"),rsaWithSha512:new O("rsa-sha2-512","SHA2-512"),ecdsaSha2Nistp256:new L("ecdsa-sha2-nistp256","SHA2-256"),ecdsaSha2Nistp384:new L("ecdsa-sha2-nistp384","SHA2-384"),ecdsaSha2Nistp521:new L("ecdsa-sha2-nistp521","SHA2-512")},SshAlgorithms.encryption={none:null,aes256Ctr:new U("aes256-ctr","AES","CTR",256),aes256Gcm:new U("aes256-gcm@openssh.com","AES","GCM",256)},SshAlgorithms.hmac={none:null,hmacSha256:new B("hmac-sha2-256","SHA2-256"),hmacSha512:new B("hmac-sha2-512","SHA2-512"),hmacSha256Etm:new B("hmac-sha2-256-etm@openssh.com","SHA2-256",!0),hmacSha512Etm:new B("hmac-sha2-512-etm@openssh.com","SHA2-512",!0)},SshAlgorithms.compression={none:null},SshAlgorithms.random=new W,m.algorithmNames=function algorithmNames(h){return h.map(h=>h?h.name:"none")}},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0}),m.findService=m.serviceActivation=void 0,m.serviceActivation=function serviceActivation(h){return m=>{m.activations||(m.activations=[]),m.activations.push(h)}},m.findService=function findService(h,m){for(let y of h.keys()){const h=y.activations;let v=!1;for(let C of h)if(v=!0,m(C))return y;if(!v)throw new Error(`SSH service type '${y.name}' must have one or more `+"'serviceActivation' decorators.")}return null}},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0}),m.SshMessage=void 0;const v=y(9),C=y(40);class SshMessage{get messageType(){return 0}toBuffer(){const h=new C.SshDataWriter(v.Buffer.alloc(16));return this.write(h),h.toBuffer()}read(h){this.rawBytes=h.buffer;const m=h.readByte();if(m!==this.messageType)throw new Error(`Message type ${m} is not valid.`);this.onRead(h)}write(h){h.writeByte(this.messageType),this.onWrite(h)}onRead(h){throw new Error("Not supported.")}onWrite(h){throw new Error("Not supported.")}validateField(h,m){if(void 0===h)throw new Error(`${this.constructor.name} ${m} is required.`);return h}toString(){return this.constructor.name}static create(h,m){const y=SshMessage.index.get(h);if(y){const h=new y;return h.read(new C.SshDataReader(m)),h}return null}convertTo(h,m=!1){const y=new C.SshDataReader(m?v.Buffer.from(this.rawBytes):this.rawBytes);return h.read(y),h}}m.SshMessage=SshMessage,SshMessage.index=new Map},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0});var v=y(58);m.ContactManager=v.ContactManager,m.PublishProperties=v.PublishProperties;var C=y(191);m.defaultCompareContacts=C.defaultCompareContacts;var T=y(529);m.SessionStateStatusProvider=T.SessionStateStatusProvider;var w=y(289);m.ContactModelApi=w.ContactModelApi;var A=y(288);m.ContactServiceManager=A.ContactServiceManager;var P=y(144);m.ContactsProviderViewlet=P.ContactsProviderViewlet,m.ContactServiceExplorerItem=P.ContactServiceExplorerItem,m.ContactTreeExplorerItem=P.ContactTreeExplorerItem;var k=y(111);m.ContactCommandUtilities=k.ContactCommandUtilities;var R=y(1266);m.registerContactCommands=R.registerCommands;var M=y(290);m.ProviderBase=M.ProviderBase,function __export(h){for(var y in h)m.hasOwnProperty(y)||(m[y]=h[y])}(y(291))},function(h,m,y){"use strict";var v=this&&this.__awaiter||function(h,m,y,v){return new(y||(y=Promise))((function(C,T){function fulfilled(h){try{step(v.next(h))}catch(h){T(h)}}function rejected(h){try{step(v.throw(h))}catch(h){T(h)}}function step(h){h.done?C(h.value):function adopt(h){return h instanceof y?h:new y((function(m){m(h)}))}(h.value).then(fulfilled,rejected)}step((v=v.apply(h,m||[])).next())}))};Object.defineProperty(m,"__esModule",{value:!0});const C=y(0),T=y(2),w=y(41),A=y(58),P=y(288),k=y(3);class ContactCommandUtilities{static inviteHelper(h){return v(this,void 0,void 0,(function*(){const m=yield ContactCommandUtilities.getCurrentLink(h.contact.email);if(m){const y=A.ContactManager.getServiceManager(h.serviceId);return y&&y.capabilites.supportsInviteLink&&!P.ContactServiceManager.isOffline(h)?(yield y.sendInviteLink(h.contact.id,m),A.ContactManager.addInviteContact(h)):yield ContactCommandUtilities.inviteByEmailInternal(h.contact.email,h.contact.displayName,m),!0}return!1}))}static inviteByEmail(h,m){return v(this,void 0,void 0,(function*(){const y=yield ContactCommandUtilities.getCurrentLink(h);return!!y&&(yield ContactCommandUtilities.inviteByEmailInternal(h,m,y),!0)}))}static getCurrentLink(h){return v(this,void 0,void 0,(function*(){const m=k.sessionStateTracker.State===k.SessionState.JoiningInProgress||k.sessionStateTracker.State===k.SessionState.Joined;if(!m){yield ContactCommandUtilities.ensureWorkspaceShared();const m=k.getExpService();if(m&&(yield m.isCachedFlightEnabled("invitationLink")))return yield C.commands.executeCommand("liveshare.createInvitationLink",{workspaceId:k.workspaceSessionInfoTracker.workspaceSessionInfo.id,guestUsers:[h]})}return m||k.sessionStateTracker.State===k.SessionState.Shared?k.workspaceSessionInfoTracker.workspaceSessionInfo.joinUri:null}))}static ensureWorkspaceSharedInternal(){return v(this,void 0,void 0,(function*(){const h=k.sessionStateTracker.State;if(h===k.SessionState.SharingInProgress){const h=new T.Signal;k.sessionStateTracker.onStateChanged(m=>{m.newAction===k.SessionAction.SharingError?h.cancel():m.newAction===k.SessionAction.SharingSuccess&&h.resolve()}),yield h.promise}else if(h!==k.SessionState.Shared){const h="liveshare.start";yield C.commands.executeCommand(h,{suppressNotification:!0})}}))}static ensureWorkspaceShared(){return v(this,void 0,void 0,(function*(){yield ContactCommandUtilities.ensureWorkspaceSharedInProgress,ContactCommandUtilities.ensureWorkspaceSharedInProgress=ContactCommandUtilities.ensureWorkspaceSharedInternal(),yield ContactCommandUtilities.ensureWorkspaceSharedInProgress}))}static inviteByEmailInternal(h,m,y){return v(this,void 0,void 0,(function*(){const v=k.getExpService();let T=encodeURIComponent(`${y}`);v&&(yield v.isCachedFlightEnabled("invitationLink"))&&(T=encodeURIComponent(`This Live Share session link is only accessible by ${m} (${h}) : ${y}`));const A=encodeURIComponent("Join my Visual Studio Live Share session");if("win32"===process.platform){const m=`mailto:${h}?subject=${A}^&body=${T}`;w.exec(`start ${m}`)}else if("darwin"===process.platform){const m=`mailto:${h}?subject=${A}&body=${decodeURIComponent(T)}`;w.exec(`open '${m}'`)}else{const m=`mailto:${h}?subject=${A}&body=${T}`;C.commands.executeCommand("vscode.open",C.Uri.parse(m))}}))}}m.ContactCommandUtilities=ContactCommandUtilities,ContactCommandUtilities.ensureWorkspaceSharedInProgress=Promise.resolve()},function(h,m,y){"use strict";var v=this&&this.__awaiter||function(h,m,y,v){return new(y||(y=Promise))((function(C,T){function fulfilled(h){try{step(v.next(h))}catch(h){T(h)}}function rejected(h){try{step(v.throw(h))}catch(h){T(h)}}function step(h){h.done?C(h.value):function adopt(h){return h instanceof y?h:new y((function(m){m(h)}))}(h.value).then(fulfilled,rejected)}step((v=v.apply(h,m||[])).next())}))};Object.defineProperty(m,"__esModule",{value:!0});const C=y(0),T=y(5),w=y(1278);class CommunicationsManager{constructor(){this.tracePrefix="[Communications Manager]",this.chatViewChanged=new C.EventEmitter}static get Instance(){return CommunicationsManager.singleton||(CommunicationsManager.singleton=new CommunicationsManager),CommunicationsManager.singleton}initialize(h){return this._initialize(h.rpcClient(),h.authService(),h.accessControlManager,h,()=>Promise.resolve(Array.from(h.workspaceServices().registeredServices)))}_initialize(h,m,C,A,P){return v(this,void 0,void 0,(function*(){if(this.trace=T.traceSource.withName("Communications.Manager"),(yield this.isChatEnabled())&&(this.chatViewController=new w.ChatViewController(m,C,A,this.chatViewChanged,this.trace)),yield this.isAudioEnabled()){const{CallingServiceManager:v}=y(1326);this.callingServiceManager=new v(m,h,P,this.trace),yield this.callingServiceManager.initialize()}}))}get onChatViewChanged(){return this.chatViewChanged.event}isChatEnabled(h=!1){return v(this,void 0,void 0,(function*(){return!w.ChatViewController.isUnsupportedChatExtensionInstalled(h)}))}isAudioEnabled(){return v(this,void 0,void 0,(function*(){return!1}))}openSessionChat(h){return v(this,void 0,void 0,(function*(){return this.trace.info(`${this.tracePrefix} open session chat`),yield this.chatViewController.openSessionChat(h)}))}}const A=CommunicationsManager.Instance;m.CommunicationsManager=A},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0}),m.uiStoppedEventName="uiStopped",function(h){h[h.Go="go"]="Go",h[h.StepIn="stepIn"]="StepIn",h[h.StepOut="stepOut"]="StepOut",h[h.StepOver="stepOver"]="StepOver"}(m.ContinueReason||(m.ContinueReason={})),function(h){h[h.OutputString=1]="OutputString",h[h.MessageBox=2]="MessageBox",h[h.ReasonException=256]="ReasonException",h[h.ReasonTracepoint=512]="ReasonTracepoint"}(m.MessageType||(m.MessageType={})),m.debugSessionHostService={name:"DebugSessionHostService",methods:["continue","handleProtocolRequest","getCurrentStoppedEvent","initializeRequest"],events:["debugEvent","uIDebugEvent"]}},function(h,m,y){"use strict";var v=this&&this.__awaiter||function(h,m,y,v){return new(y||(y=Promise))((function(C,T){function fulfilled(h){try{step(v.next(h))}catch(h){T(h)}}function rejected(h){try{step(v.throw(h))}catch(h){T(h)}}function step(h){h.done?C(h.value):function adopt(h){return h instanceof y?h:new y((function(m){m(h)}))}(h.value).then(fulfilled,rejected)}step((v=v.apply(h,m||[])).next())}))};Object.defineProperty(m,"__esModule",{value:!0});const C=y(0),T=y(578),w=y(0),A=y(5),P=y(3),k=w.env.clipboard,R=void 0!==k;m.PlannedSessionsUtils=class PlannedSessionsUtils{constructor(){}static getUsernameFromInputAsync(h,m){return v(this,void 0,void 0,(function*(){const y=h;return new Promise((h,C)=>v(this,void 0,void 0,(function*(){m&&m.onCancellationRequested(()=>h(void 0));let v=yield A.NotificationUtil.showInputBox({prompt:P.localize("plannedSessions.Name"),ignoreFocusOut:!0,value:y||T.DEFAULT_PLANNED_SESSION_LABEL},m);for(;""===v;)v=yield A.NotificationUtil.showInputBox({prompt:P.localize("plannedSessions.NameCannotBeEmpty"),ignoreFocusOut:!0,value:y||T.DEFAULT_PLANNED_SESSION_LABEL},m);const C=/^[a-z0-9 ]+$/i;for(;!C.test(v);)v=yield A.NotificationUtil.showInputBox({prompt:P.localize("plannedSessions.NameIsInvalid"),ignoreFocusOut:!0,value:y||T.DEFAULT_PLANNED_SESSION_LABEL},m);const w=(v||"").trim();return h(w?w.slice(0,50):void 0)})))}))}static copyToClipboardAsync(h){return v(this,void 0,void 0,(function*(){try{return R?yield k.writeText(h):yield k.writeAsync(h),!0}catch(h){return!1}}))}static selectPlannedSessionItemFromCommandPaletteAsync(h,m){return v(this,void 0,void 0,(function*(){return new Promise((y,T)=>v(this,void 0,void 0,(function*(){m&&m.onCancellationRequested(()=>y(void 0));const v=h.map(h=>({label:h.label})),T=yield C.window.showQuickPick(v,{placeHolder:P.localize("plannedSessions.quickPickSelectWindow"),matchOnDetail:!0,matchOnDescription:!0},m);if(T){const m=h.find(h=>h.label===T.label);if(m)return y(m)}})))}))}}},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0});const v=y(0),C=y(30),T=y(580),w=y(323),A=y(72),P=y(1436),k=y(116);!function __export(h){for(var y in h)m.hasOwnProperty(y)||(m[y]=h[y])}(y(30));class ConsoleLogger{error(h){console.error(h)}warn(h){console.warn(h)}info(h){console.info(h)}log(h){console.log(h)}}var R,M,N,D,I;!function(h){h[h.Continue=1]="Continue",h[h.Shutdown=2]="Shutdown"}(R=m.ErrorAction||(m.ErrorAction={})),function(h){h[h.DoNotRestart=1]="DoNotRestart",h[h.Restart=2]="Restart"}(M=m.CloseAction||(m.CloseAction={}));class DefaultErrorHandler{constructor(h){this.name=h,this.restarts=[]}error(h,m,y){return y&&y<=3?R.Continue:R.Shutdown}closed(){if(this.restarts.push(Date.now()),this.restarts.length<5)return M.Restart;return this.restarts[this.restarts.length-1]-this.restarts[0]<=18e4?(v.window.showErrorMessage(`The ${this.name} server crashed 5 times in the last 3 minutes. The server will not be restarted.`),M.DoNotRestart):(this.restarts.shift(),M.Restart)}}!function(h){h[h.Info=1]="Info",h[h.Warn=2]="Warn",h[h.Error=3]="Error",h[h.Never=4]="Never"}(N=m.RevealOutputChannelOn||(m.RevealOutputChannelOn={})),function(h){h[h.Stopped=1]="Stopped",h[h.Running=2]="Running"}(D=m.State||(m.State={})),function(h){h[h.Initial=0]="Initial",h[h.Starting=1]="Starting",h[h.StartFailed=2]="StartFailed",h[h.Running=3]="Running",h[h.Stopping=4]="Stopping",h[h.Stopped=5]="Stopped"}(I||(I={}));const x=[C.SymbolKind.File,C.SymbolKind.Module,C.SymbolKind.Namespace,C.SymbolKind.Package,C.SymbolKind.Class,C.SymbolKind.Method,C.SymbolKind.Property,C.SymbolKind.Field,C.SymbolKind.Constructor,C.SymbolKind.Enum,C.SymbolKind.Interface,C.SymbolKind.Function,C.SymbolKind.Variable,C.SymbolKind.Constant,C.SymbolKind.String,C.SymbolKind.Number,C.SymbolKind.Boolean,C.SymbolKind.Array,C.SymbolKind.Object,C.SymbolKind.Key,C.SymbolKind.Null,C.SymbolKind.EnumMember,C.SymbolKind.Struct,C.SymbolKind.Event,C.SymbolKind.Operator,C.SymbolKind.TypeParameter],O=[C.CompletionItemKind.Text,C.CompletionItemKind.Method,C.CompletionItemKind.Function,C.CompletionItemKind.Constructor,C.CompletionItemKind.Field,C.CompletionItemKind.Variable,C.CompletionItemKind.Class,C.CompletionItemKind.Interface,C.CompletionItemKind.Module,C.CompletionItemKind.Property,C.CompletionItemKind.Unit,C.CompletionItemKind.Value,C.CompletionItemKind.Enum,C.CompletionItemKind.Keyword,C.CompletionItemKind.Snippet,C.CompletionItemKind.Color,C.CompletionItemKind.File,C.CompletionItemKind.Reference,C.CompletionItemKind.Folder,C.CompletionItemKind.EnumMember,C.CompletionItemKind.Constant,C.CompletionItemKind.Struct,C.CompletionItemKind.Event,C.CompletionItemKind.Operator,C.CompletionItemKind.TypeParameter];function ensure(h,m){return void 0===h[m]&&(h[m]={}),h[m]}var L;!function(h){h.is=function is(h){let m=h;return m&&A.func(m.register)&&A.func(m.unregister)&&A.func(m.dispose)&&void 0!==m.messages}}(L||(L={}));class DocumentNotifiactions{constructor(h,m,y,v,C,T){this._client=h,this._event=m,this._type=y,this._middleware=v,this._createParams=C,this._selectorFilter=T,this._selectors=new Map}static textDocumentFilter(h,m){for(const y of h)if(v.languages.match(y,m))return!0;return!1}register(h,m){m.registerOptions.documentSelector&&(this._listener||(this._listener=this._event(this.callback,this)),this._selectors.set(m.id,m.registerOptions.documentSelector))}callback(h){this._selectorFilter&&!this._selectorFilter(this._selectors.values(),h)||(this._middleware?this._middleware(h,h=>this._client.sendNotification(this._type,this._createParams(h))):this._client.sendNotification(this._type,this._createParams(h)),this.notificationSent(h))}notificationSent(h){}unregister(h){this._selectors.delete(h),0===this._selectors.size&&this._listener&&(this._listener.dispose(),this._listener=void 0)}dispose(){this._selectors.clear(),this._listener&&this._listener.dispose()}}class DidOpenTextDocumentFeature extends DocumentNotifiactions{constructor(h,m){super(h,v.workspace.onDidOpenTextDocument,C.DidOpenTextDocumentNotification.type,h.clientOptions.middleware.didOpen,m=>h.code2ProtocolConverter.asOpenTextDocumentParams(m),DocumentNotifiactions.textDocumentFilter),this._syncedDocuments=m}get messages(){return C.DidOpenTextDocumentNotification.type}fillClientCapabilities(h){ensure(ensure(h,"textDocument"),"synchronization").dynamicRegistration=!0}initialize(h,m){let y=h.resolvedTextDocumentSync;m&&y&&y.openClose&&this.register(this.messages,{id:k.generateUuid(),registerOptions:{documentSelector:m}})}register(h,m){if(super.register(h,m),!m.registerOptions.documentSelector)return;let y=m.registerOptions.documentSelector;v.workspace.textDocuments.forEach(h=>{let m=h.uri.toString();if(!this._syncedDocuments.has(m)&&v.languages.match(y,h)){let y=this._client.clientOptions.middleware,didOpen=h=>{this._client.sendNotification(this._type,this._createParams(h))};y.didOpen?y.didOpen(h,didOpen):didOpen(h),this._syncedDocuments.set(m,h)}})}notificationSent(h){super.notificationSent(h),this._syncedDocuments.set(h.uri.toString(),h)}}class DidCloseTextDocumentFeature extends DocumentNotifiactions{constructor(h,m){super(h,v.workspace.onDidCloseTextDocument,C.DidCloseTextDocumentNotification.type,h.clientOptions.middleware.didClose,m=>h.code2ProtocolConverter.asCloseTextDocumentParams(m),DocumentNotifiactions.textDocumentFilter),this._syncedDocuments=m}get messages(){return C.DidCloseTextDocumentNotification.type}fillClientCapabilities(h){ensure(ensure(h,"textDocument"),"synchronization").dynamicRegistration=!0}initialize(h,m){let y=h.resolvedTextDocumentSync;m&&y&&y.openClose&&this.register(this.messages,{id:k.generateUuid(),registerOptions:{documentSelector:m}})}notificationSent(h){super.notificationSent(h),this._syncedDocuments.delete(h.uri.toString())}unregister(h){let m=this._selectors.get(h);super.unregister(h);let y=this._selectors.values();this._syncedDocuments.forEach(h=>{if(v.languages.match(m,h)&&!this._selectorFilter(y,h)){let m=this._client.clientOptions.middleware,didClose=h=>{this._client.sendNotification(this._type,this._createParams(h))};this._syncedDocuments.delete(h.uri.toString()),m.didClose?m.didClose(h,didClose):didClose(h)}})}}class DidChangeTextDocumentFeature{constructor(h){this._client=h,this._changeData=new Map,this._forcingDelivery=!1}get messages(){return C.DidChangeTextDocumentNotification.type}fillClientCapabilities(h){ensure(ensure(h,"textDocument"),"synchronization").dynamicRegistration=!0}initialize(h,m){let y=h.resolvedTextDocumentSync;m&&y&&void 0!==y.change&&y.change!==C.TextDocumentSyncKind.None&&this.register(this.messages,{id:k.generateUuid(),registerOptions:Object.assign({},{documentSelector:m},{syncKind:y.change})})}register(h,m){m.registerOptions.documentSelector&&(this._listener||(this._listener=v.workspace.onDidChangeTextDocument(this.callback,this)),this._changeData.set(m.id,{documentSelector:m.registerOptions.documentSelector,syncKind:m.registerOptions.syncKind}))}callback(h){if(0!==h.contentChanges.length)for(const m of this._changeData.values())if(v.languages.match(m.documentSelector,h.document)){let y=this._client.clientOptions.middleware;if(m.syncKind===C.TextDocumentSyncKind.Incremental){let m=this._client.code2ProtocolConverter.asChangeTextDocumentParams(h);y.didChange?y.didChange(h,()=>this._client.sendNotification(C.DidChangeTextDocumentNotification.type,m)):this._client.sendNotification(C.DidChangeTextDocumentNotification.type,m)}else if(m.syncKind===C.TextDocumentSyncKind.Full){let didChange=h=>{this._changeDelayer?(this._changeDelayer.uri!==h.document.uri.toString()&&(this.forceDelivery(),this._changeDelayer.uri=h.document.uri.toString()),this._changeDelayer.delayer.trigger(()=>{this._client.sendNotification(C.DidChangeTextDocumentNotification.type,this._client.code2ProtocolConverter.asChangeTextDocumentParams(h.document))})):(this._changeDelayer={uri:h.document.uri.toString(),delayer:new P.Delayer(200)},this._changeDelayer.delayer.trigger(()=>{this._client.sendNotification(C.DidChangeTextDocumentNotification.type,this._client.code2ProtocolConverter.asChangeTextDocumentParams(h.document))},-1))};y.didChange?y.didChange(h,didChange):didChange(h)}}}unregister(h){this._changeData.delete(h),0===this._changeData.size&&this._listener&&(this._listener.dispose(),this._listener=void 0)}dispose(){this._changeDelayer=void 0,this._forcingDelivery=!1,this._changeData.clear(),this._listener&&(this._listener.dispose(),this._listener=void 0)}forceDelivery(){if(!this._forcingDelivery&&this._changeDelayer)try{this._forcingDelivery=!0,this._changeDelayer.delayer.forceDelivery()}finally{this._forcingDelivery=!1}}}class WillSaveFeature extends DocumentNotifiactions{constructor(h){super(h,v.workspace.onWillSaveTextDocument,C.WillSaveTextDocumentNotification.type,h.clientOptions.middleware.willSave,m=>h.code2ProtocolConverter.asWillSaveTextDocumentParams(m),(h,m)=>DocumentNotifiactions.textDocumentFilter(h,m.document))}get messages(){return C.WillSaveTextDocumentNotification.type}fillClientCapabilities(h){ensure(ensure(h,"textDocument"),"synchronization").willSave=!0}initialize(h,m){let y=h.resolvedTextDocumentSync;m&&y&&y.willSave&&this.register(this.messages,{id:k.generateUuid(),registerOptions:{documentSelector:m}})}}class WillSaveWaitUntilFeature{constructor(h){this._client=h,this._selectors=new Map}get messages(){return C.WillSaveTextDocumentWaitUntilRequest.type}fillClientCapabilities(h){ensure(ensure(h,"textDocument"),"synchronization").willSaveWaitUntil=!0}initialize(h,m){let y=h.resolvedTextDocumentSync;m&&y&&y.willSaveWaitUntil&&this.register(this.messages,{id:k.generateUuid(),registerOptions:{documentSelector:m}})}register(h,m){m.registerOptions.documentSelector&&(this._listener||(this._listener=v.workspace.onWillSaveTextDocument(this.callback,this)),this._selectors.set(m.id,m.registerOptions.documentSelector))}callback(h){if(DocumentNotifiactions.textDocumentFilter(this._selectors.values(),h.document)){let m=this._client.clientOptions.middleware,willSaveWaitUntil=h=>this._client.sendRequest(C.WillSaveTextDocumentWaitUntilRequest.type,this._client.code2ProtocolConverter.asWillSaveTextDocumentParams(h)).then(h=>{let m=this._client.protocol2CodeConverter.asTextEdits(h);return void 0===m?[]:m});h.waitUntil(m.willSaveWaitUntil?m.willSaveWaitUntil(h,willSaveWaitUntil):willSaveWaitUntil(h))}}unregister(h){this._selectors.delete(h),0===this._selectors.size&&this._listener&&(this._listener.dispose(),this._listener=void 0)}dispose(){this._selectors.clear(),this._listener&&(this._listener.dispose(),this._listener=void 0)}}class DidSaveTextDocumentFeature extends DocumentNotifiactions{constructor(h){super(h,v.workspace.onDidSaveTextDocument,C.DidSaveTextDocumentNotification.type,h.clientOptions.middleware.didSave,m=>h.code2ProtocolConverter.asSaveTextDocumentParams(m,this._includeText),DocumentNotifiactions.textDocumentFilter)}get messages(){return C.DidSaveTextDocumentNotification.type}fillClientCapabilities(h){ensure(ensure(h,"textDocument"),"synchronization").didSave=!0}initialize(h,m){let y=h.resolvedTextDocumentSync;m&&y&&y.save&&this.register(this.messages,{id:k.generateUuid(),registerOptions:Object.assign({},{documentSelector:m},{includeText:!!y.save.includeText})})}register(h,m){this._includeText=!!m.registerOptions.includeText,super.register(h,m)}}class FileSystemWatcherFeature{constructor(h,m){this._client=h,this._notifyFileEvent=m,this._watchers=new Map}get messages(){return C.DidChangeWatchedFilesNotification.type}fillClientCapabilities(h){ensure(ensure(h,"workspace"),"didChangeWatchedFiles").dynamicRegistration=!0}initialize(h,m){}register(h,m){if(!Array.isArray(m.registerOptions.watchers))return;let y=[];for(let h of m.registerOptions.watchers){if(!A.string(h.globPattern))continue;let m=!0,T=!0,w=!0;void 0!==h.kind&&null!==h.kind&&(m=0!=(h.kind&C.WatchKind.Create),T=0!=(h.kind&C.WatchKind.Change),w=0!=(h.kind&C.WatchKind.Delete));let P=v.workspace.createFileSystemWatcher(h.globPattern,!m,!T,!w);this.hookListeners(P,m,T,w),y.push(P)}this._watchers.set(m.id,y)}registerRaw(h,m){let y=[];for(let h of m)this.hookListeners(h,!0,!0,!0,y);this._watchers.set(h,y)}hookListeners(h,m,y,v,T){m&&h.onDidCreate(h=>this._notifyFileEvent({uri:this._client.code2ProtocolConverter.asUri(h),type:C.FileChangeType.Created}),null,T),y&&h.onDidChange(h=>this._notifyFileEvent({uri:this._client.code2ProtocolConverter.asUri(h),type:C.FileChangeType.Changed}),null,T),v&&h.onDidDelete(h=>this._notifyFileEvent({uri:this._client.code2ProtocolConverter.asUri(h),type:C.FileChangeType.Deleted}),null,T)}unregister(h){let m=this._watchers.get(h);if(m)for(let h of m)h.dispose()}dispose(){this._watchers.forEach(h=>{for(let m of h)m.dispose()}),this._watchers.clear()}}class TextDocumentFeature{constructor(h,m){this._client=h,this._message=m,this._providers=new Map}get messages(){return this._message}register(h,m){if(h.method!==this.messages.method)throw new Error(`Register called on wrong feature. Requested ${h.method} but reached feature ${this.messages.method}`);if(!m.registerOptions.documentSelector)return;let y=this.registerLanguageProvider(m.registerOptions);y&&this._providers.set(m.id,y)}unregister(h){let m=this._providers.get(h);m&&m.dispose()}dispose(){this._providers.forEach(h=>{h.dispose()}),this._providers.clear()}}m.TextDocumentFeature=TextDocumentFeature;class CompletionItemFeature extends TextDocumentFeature{constructor(h){super(h,C.CompletionRequest.type)}fillClientCapabilities(h){let m=ensure(ensure(h,"textDocument"),"completion");m.dynamicRegistration=!0,m.contextSupport=!0,m.completionItem={snippetSupport:!0,commitCharactersSupport:!0,documentationFormat:[C.MarkupKind.Markdown,C.MarkupKind.PlainText],deprecatedSupport:!0,preselectSupport:!0},m.completionItemKind={valueSet:O}}initialize(h,m){h.completionProvider&&m&&this.register(this.messages,{id:k.generateUuid(),registerOptions:Object.assign({},{documentSelector:m},h.completionProvider)})}registerLanguageProvider(h){let m=h.triggerCharacters||[],y=this._client,provideCompletionItems=(h,m,v,T)=>y.sendRequest(C.CompletionRequest.type,y.code2ProtocolConverter.asCompletionParams(h,m,v),T).then(y.protocol2CodeConverter.asCompletionResult,h=>(y.logFailedRequest(C.CompletionRequest.type,h),Promise.resolve([]))),resolveCompletionItem=(h,m)=>y.sendRequest(C.CompletionResolveRequest.type,y.code2ProtocolConverter.asCompletionItem(h),m).then(y.protocol2CodeConverter.asCompletionItem,m=>(y.logFailedRequest(C.CompletionResolveRequest.type,m),Promise.resolve(h))),T=this._client.clientOptions.middleware;return v.languages.registerCompletionItemProvider(h.documentSelector,{provideCompletionItems:(h,m,y,v)=>T.provideCompletionItem?T.provideCompletionItem(h,m,v,y,provideCompletionItems):provideCompletionItems(h,m,v,y),resolveCompletionItem:h.resolveProvider?(h,m)=>T.resolveCompletionItem?T.resolveCompletionItem(h,m,resolveCompletionItem):resolveCompletionItem(h,m):void 0},...m)}}class HoverFeature extends TextDocumentFeature{constructor(h){super(h,C.HoverRequest.type)}fillClientCapabilities(h){const m=ensure(ensure(h,"textDocument"),"hover");m.dynamicRegistration=!0,m.contentFormat=[C.MarkupKind.Markdown,C.MarkupKind.PlainText]}initialize(h,m){h.hoverProvider&&m&&this.register(this.messages,{id:k.generateUuid(),registerOptions:Object.assign({},{documentSelector:m})})}registerLanguageProvider(h){let m=this._client,provideHover=(h,y,v)=>m.sendRequest(C.HoverRequest.type,m.code2ProtocolConverter.asTextDocumentPositionParams(h,y),v).then(m.protocol2CodeConverter.asHover,h=>(m.logFailedRequest(C.HoverRequest.type,h),Promise.resolve(null))),y=m.clientOptions.middleware;return v.languages.registerHoverProvider(h.documentSelector,{provideHover:(h,m,v)=>y.provideHover?y.provideHover(h,m,v,provideHover):provideHover(h,m,v)})}}class SignatureHelpFeature extends TextDocumentFeature{constructor(h){super(h,C.SignatureHelpRequest.type)}fillClientCapabilities(h){let m=ensure(ensure(h,"textDocument"),"signatureHelp");m.dynamicRegistration=!0,m.signatureInformation={documentationFormat:[C.MarkupKind.Markdown,C.MarkupKind.PlainText]}}initialize(h,m){h.signatureHelpProvider&&m&&this.register(this.messages,{id:k.generateUuid(),registerOptions:Object.assign({},{documentSelector:m},h.signatureHelpProvider)})}registerLanguageProvider(h){let m=this._client,providerSignatureHelp=(h,y,v)=>m.sendRequest(C.SignatureHelpRequest.type,m.code2ProtocolConverter.asTextDocumentPositionParams(h,y),v).then(m.protocol2CodeConverter.asSignatureHelp,h=>(m.logFailedRequest(C.SignatureHelpRequest.type,h),Promise.resolve(null))),y=m.clientOptions.middleware,T=h.triggerCharacters||[];return v.languages.registerSignatureHelpProvider(h.documentSelector,{provideSignatureHelp:(h,m,v)=>y.provideSignatureHelp?y.provideSignatureHelp(h,m,v,providerSignatureHelp):providerSignatureHelp(h,m,v)},...T)}}class DefinitionFeature extends TextDocumentFeature{constructor(h){super(h,C.DefinitionRequest.type)}fillClientCapabilities(h){ensure(ensure(h,"textDocument"),"definition").dynamicRegistration=!0}initialize(h,m){h.definitionProvider&&m&&this.register(this.messages,{id:k.generateUuid(),registerOptions:Object.assign({},{documentSelector:m})})}registerLanguageProvider(h){let m=this._client,provideDefinition=(h,y,v)=>m.sendRequest(C.DefinitionRequest.type,m.code2ProtocolConverter.asTextDocumentPositionParams(h,y),v).then(m.protocol2CodeConverter.asDefinitionResult,h=>(m.logFailedRequest(C.DefinitionRequest.type,h),Promise.resolve(null))),y=m.clientOptions.middleware;return v.languages.registerDefinitionProvider(h.documentSelector,{provideDefinition:(h,m,v)=>y.provideDefinition?y.provideDefinition(h,m,v,provideDefinition):provideDefinition(h,m,v)})}}class ReferencesFeature extends TextDocumentFeature{constructor(h){super(h,C.ReferencesRequest.type)}fillClientCapabilities(h){ensure(ensure(h,"textDocument"),"references").dynamicRegistration=!0}initialize(h,m){h.referencesProvider&&m&&this.register(this.messages,{id:k.generateUuid(),registerOptions:Object.assign({},{documentSelector:m})})}registerLanguageProvider(h){let m=this._client,providerReferences=(h,y,v,T)=>m.sendRequest(C.ReferencesRequest.type,m.code2ProtocolConverter.asReferenceParams(h,y,v),T).then(m.protocol2CodeConverter.asReferences,h=>(m.logFailedRequest(C.ReferencesRequest.type,h),Promise.resolve([]))),y=m.clientOptions.middleware;return v.languages.registerReferenceProvider(h.documentSelector,{provideReferences:(h,m,v,C)=>y.provideReferences?y.provideReferences(h,m,v,C,providerReferences):providerReferences(h,m,v,C)})}}class DocumentHighlightFeature extends TextDocumentFeature{constructor(h){super(h,C.DocumentHighlightRequest.type)}fillClientCapabilities(h){ensure(ensure(h,"textDocument"),"documentHighlight").dynamicRegistration=!0}initialize(h,m){h.documentHighlightProvider&&m&&this.register(this.messages,{id:k.generateUuid(),registerOptions:Object.assign({},{documentSelector:m})})}registerLanguageProvider(h){let m=this._client,provideDocumentHighlights=(h,y,v)=>m.sendRequest(C.DocumentHighlightRequest.type,m.code2ProtocolConverter.asTextDocumentPositionParams(h,y),v).then(m.protocol2CodeConverter.asDocumentHighlights,h=>(m.logFailedRequest(C.DocumentHighlightRequest.type,h),Promise.resolve([]))),y=m.clientOptions.middleware;return v.languages.registerDocumentHighlightProvider(h.documentSelector,{provideDocumentHighlights:(h,m,v)=>y.provideDocumentHighlights?y.provideDocumentHighlights(h,m,v,provideDocumentHighlights):provideDocumentHighlights(h,m,v)})}}class DocumentSymbolFeature extends TextDocumentFeature{constructor(h){super(h,C.DocumentSymbolRequest.type)}fillClientCapabilities(h){let m=ensure(ensure(h,"textDocument"),"documentSymbol");m.dynamicRegistration=!0,m.symbolKind={valueSet:x},m.hierarchicalDocumentSymbolSupport=!0}initialize(h,m){h.documentSymbolProvider&&m&&this.register(this.messages,{id:k.generateUuid(),registerOptions:Object.assign({},{documentSelector:m})})}registerLanguageProvider(h){let m=this._client,provideDocumentSymbols=(h,y)=>m.sendRequest(C.DocumentSymbolRequest.type,m.code2ProtocolConverter.asDocumentSymbolParams(h),y).then(h=>{if(null!==h){if(0===h.length)return[];{let y=h[0];return C.DocumentSymbol.is(y)?m.protocol2CodeConverter.asDocumentSymbols(h):m.protocol2CodeConverter.asSymbolInformations(h)}}},h=>(m.logFailedRequest(C.DocumentSymbolRequest.type,h),Promise.resolve([]))),y=m.clientOptions.middleware;return v.languages.registerDocumentSymbolProvider(h.documentSelector,{provideDocumentSymbols:(h,m)=>y.provideDocumentSymbols?y.provideDocumentSymbols(h,m,provideDocumentSymbols):provideDocumentSymbols(h,m)})}}class WorkspaceSymbolFeature extends class WorkspaceFeature{constructor(h,m){this._client=h,this._message=m,this._providers=new Map}get messages(){return this._message}register(h,m){if(h.method!==this.messages.method)throw new Error(`Register called on wron feature. Requested ${h.method} but reached feature ${this.messages.method}`);let y=this.registerLanguageProvider(m.registerOptions);y&&this._providers.set(m.id,y)}unregister(h){let m=this._providers.get(h);m&&m.dispose()}dispose(){this._providers.forEach(h=>{h.dispose()}),this._providers.clear()}}{constructor(h){super(h,C.WorkspaceSymbolRequest.type)}fillClientCapabilities(h){let m=ensure(ensure(h,"workspace"),"symbol");m.dynamicRegistration=!0,m.symbolKind={valueSet:x}}initialize(h){h.workspaceSymbolProvider&&this.register(this.messages,{id:k.generateUuid(),registerOptions:void 0})}registerLanguageProvider(h){let m=this._client,provideWorkspaceSymbols=(h,y)=>m.sendRequest(C.WorkspaceSymbolRequest.type,{query:h},y).then(m.protocol2CodeConverter.asSymbolInformations,h=>(m.logFailedRequest(C.WorkspaceSymbolRequest.type,h),Promise.resolve([]))),y=m.clientOptions.middleware;return v.languages.registerWorkspaceSymbolProvider({provideWorkspaceSymbols:(h,m)=>y.provideWorkspaceSymbols?y.provideWorkspaceSymbols(h,m,provideWorkspaceSymbols):provideWorkspaceSymbols(h,m)})}}class CodeActionFeature extends TextDocumentFeature{constructor(h){super(h,C.CodeActionRequest.type)}fillClientCapabilities(h){const m=ensure(ensure(h,"textDocument"),"codeAction");m.dynamicRegistration=!0,m.codeActionLiteralSupport={codeActionKind:{valueSet:["",C.CodeActionKind.QuickFix,C.CodeActionKind.Refactor,C.CodeActionKind.RefactorExtract,C.CodeActionKind.RefactorInline,C.CodeActionKind.RefactorRewrite,C.CodeActionKind.Source,C.CodeActionKind.SourceOrganizeImports]}}}initialize(h,m){h.codeActionProvider&&m&&this.register(this.messages,{id:k.generateUuid(),registerOptions:Object.assign({},{documentSelector:m})})}registerLanguageProvider(h){let m=this._client,provideCodeActions=(h,y,v,T)=>{let w={textDocument:m.code2ProtocolConverter.asTextDocumentIdentifier(h),range:m.code2ProtocolConverter.asRange(y),context:m.code2ProtocolConverter.asCodeActionContext(v)};return m.sendRequest(C.CodeActionRequest.type,w,T).then(h=>{if(null===h)return;let y=[];for(let v of h)C.Command.is(v)?y.push(m.protocol2CodeConverter.asCommand(v)):y.push(m.protocol2CodeConverter.asCodeAction(v));return y},h=>(m.logFailedRequest(C.CodeActionRequest.type,h),Promise.resolve([])))},y=m.clientOptions.middleware;return v.languages.registerCodeActionsProvider(h.documentSelector,{provideCodeActions:(h,m,v,C)=>y.provideCodeActions?y.provideCodeActions(h,m,v,C,provideCodeActions):provideCodeActions(h,m,v,C)})}}class CodeLensFeature extends TextDocumentFeature{constructor(h){super(h,C.CodeLensRequest.type)}fillClientCapabilities(h){ensure(ensure(h,"textDocument"),"codeLens").dynamicRegistration=!0}initialize(h,m){h.codeLensProvider&&m&&this.register(this.messages,{id:k.generateUuid(),registerOptions:Object.assign({},{documentSelector:m},h.codeLensProvider)})}registerLanguageProvider(h){let m=this._client,provideCodeLenses=(h,y)=>m.sendRequest(C.CodeLensRequest.type,m.code2ProtocolConverter.asCodeLensParams(h),y).then(m.protocol2CodeConverter.asCodeLenses,h=>(m.logFailedRequest(C.CodeLensRequest.type,h),Promise.resolve([]))),resolveCodeLens=(h,y)=>m.sendRequest(C.CodeLensResolveRequest.type,m.code2ProtocolConverter.asCodeLens(h),y).then(m.protocol2CodeConverter.asCodeLens,y=>(m.logFailedRequest(C.CodeLensResolveRequest.type,y),h)),y=m.clientOptions.middleware;return v.languages.registerCodeLensProvider(h.documentSelector,{provideCodeLenses:(h,m)=>y.provideCodeLenses?y.provideCodeLenses(h,m,provideCodeLenses):provideCodeLenses(h,m),resolveCodeLens:h.resolveProvider?(h,m)=>y.resolveCodeLens?y.resolveCodeLens(h,m,resolveCodeLens):resolveCodeLens(h,m):void 0})}}class DocumentFormattingFeature extends TextDocumentFeature{constructor(h){super(h,C.DocumentFormattingRequest.type)}fillClientCapabilities(h){ensure(ensure(h,"textDocument"),"formatting").dynamicRegistration=!0}initialize(h,m){h.documentFormattingProvider&&m&&this.register(this.messages,{id:k.generateUuid(),registerOptions:Object.assign({},{documentSelector:m})})}registerLanguageProvider(h){let m=this._client,provideDocumentFormattingEdits=(h,y,v)=>{let T={textDocument:m.code2ProtocolConverter.asTextDocumentIdentifier(h),options:m.code2ProtocolConverter.asFormattingOptions(y)};return m.sendRequest(C.DocumentFormattingRequest.type,T,v).then(m.protocol2CodeConverter.asTextEdits,h=>(m.logFailedRequest(C.DocumentFormattingRequest.type,h),Promise.resolve([])))},y=m.clientOptions.middleware;return v.languages.registerDocumentFormattingEditProvider(h.documentSelector,{provideDocumentFormattingEdits:(h,m,v)=>y.provideDocumentFormattingEdits?y.provideDocumentFormattingEdits(h,m,v,provideDocumentFormattingEdits):provideDocumentFormattingEdits(h,m,v)})}}class DocumentRangeFormattingFeature extends TextDocumentFeature{constructor(h){super(h,C.DocumentRangeFormattingRequest.type)}fillClientCapabilities(h){ensure(ensure(h,"textDocument"),"rangeFormatting").dynamicRegistration=!0}initialize(h,m){h.documentRangeFormattingProvider&&m&&this.register(this.messages,{id:k.generateUuid(),registerOptions:Object.assign({},{documentSelector:m})})}registerLanguageProvider(h){let m=this._client,provideDocumentRangeFormattingEdits=(h,y,v,T)=>{let w={textDocument:m.code2ProtocolConverter.asTextDocumentIdentifier(h),range:m.code2ProtocolConverter.asRange(y),options:m.code2ProtocolConverter.asFormattingOptions(v)};return m.sendRequest(C.DocumentRangeFormattingRequest.type,w,T).then(m.protocol2CodeConverter.asTextEdits,h=>(m.logFailedRequest(C.DocumentRangeFormattingRequest.type,h),Promise.resolve([])))},y=m.clientOptions.middleware;return v.languages.registerDocumentRangeFormattingEditProvider(h.documentSelector,{provideDocumentRangeFormattingEdits:(h,m,v,C)=>y.provideDocumentRangeFormattingEdits?y.provideDocumentRangeFormattingEdits(h,m,v,C,provideDocumentRangeFormattingEdits):provideDocumentRangeFormattingEdits(h,m,v,C)})}}class DocumentOnTypeFormattingFeature extends TextDocumentFeature{constructor(h){super(h,C.DocumentOnTypeFormattingRequest.type)}fillClientCapabilities(h){ensure(ensure(h,"textDocument"),"onTypeFormatting").dynamicRegistration=!0}initialize(h,m){h.documentOnTypeFormattingProvider&&m&&this.register(this.messages,{id:k.generateUuid(),registerOptions:Object.assign({},{documentSelector:m},h.documentOnTypeFormattingProvider)})}registerLanguageProvider(h){let m=this._client,y=h.moreTriggerCharacter||[],provideOnTypeFormattingEdits=(h,y,v,T,w)=>{let A={textDocument:m.code2ProtocolConverter.asTextDocumentIdentifier(h),position:m.code2ProtocolConverter.asPosition(y),ch:v,options:m.code2ProtocolConverter.asFormattingOptions(T)};return m.sendRequest(C.DocumentOnTypeFormattingRequest.type,A,w).then(m.protocol2CodeConverter.asTextEdits,h=>(m.logFailedRequest(C.DocumentOnTypeFormattingRequest.type,h),Promise.resolve([])))},T=m.clientOptions.middleware;return v.languages.registerOnTypeFormattingEditProvider(h.documentSelector,{provideOnTypeFormattingEdits:(h,m,y,v,C)=>T.provideOnTypeFormattingEdits?T.provideOnTypeFormattingEdits(h,m,y,v,C,provideOnTypeFormattingEdits):provideOnTypeFormattingEdits(h,m,y,v,C)},h.firstTriggerCharacter,...y)}}class RenameFeature extends TextDocumentFeature{constructor(h){super(h,C.RenameRequest.type)}fillClientCapabilities(h){ensure(ensure(h,"textDocument"),"rename").dynamicRegistration=!0}initialize(h,m){h.renameProvider&&m&&this.register(this.messages,{id:k.generateUuid(),registerOptions:Object.assign({},{documentSelector:m})})}registerLanguageProvider(h){let m=this._client,provideRenameEdits=(h,y,v,T)=>{let w={textDocument:m.code2ProtocolConverter.asTextDocumentIdentifier(h),position:m.code2ProtocolConverter.asPosition(y),newName:v};return m.sendRequest(C.RenameRequest.type,w,T).then(m.protocol2CodeConverter.asWorkspaceEdit,h=>(m.logFailedRequest(C.RenameRequest.type,h),Promise.reject(new Error(h.message))))},y=m.clientOptions.middleware;return v.languages.registerRenameProvider(h.documentSelector,{provideRenameEdits:(h,m,v,C)=>y.provideRenameEdits?y.provideRenameEdits(h,m,v,C,provideRenameEdits):provideRenameEdits(h,m,v,C)})}}class DocumentLinkFeature extends TextDocumentFeature{constructor(h){super(h,C.DocumentLinkRequest.type)}fillClientCapabilities(h){ensure(ensure(h,"textDocument"),"documentLink").dynamicRegistration=!0}initialize(h,m){h.documentLinkProvider&&m&&this.register(this.messages,{id:k.generateUuid(),registerOptions:Object.assign({},{documentSelector:m},h.documentLinkProvider)})}registerLanguageProvider(h){let m=this._client,provideDocumentLinks=(h,y)=>m.sendRequest(C.DocumentLinkRequest.type,m.code2ProtocolConverter.asDocumentLinkParams(h),y).then(m.protocol2CodeConverter.asDocumentLinks,h=>{m.logFailedRequest(C.DocumentLinkRequest.type,h),Promise.resolve(new Error(h.message))}),resolveDocumentLink=(h,y)=>m.sendRequest(C.DocumentLinkResolveRequest.type,m.code2ProtocolConverter.asDocumentLink(h),y).then(m.protocol2CodeConverter.asDocumentLink,h=>{m.logFailedRequest(C.DocumentLinkResolveRequest.type,h),Promise.resolve(new Error(h.message))}),y=m.clientOptions.middleware;return v.languages.registerDocumentLinkProvider(h.documentSelector,{provideDocumentLinks:(h,m)=>y.provideDocumentLinks?y.provideDocumentLinks(h,m,provideDocumentLinks):provideDocumentLinks(h,m),resolveDocumentLink:h.resolveProvider?(h,m)=>y.resolveDocumentLink?y.resolveDocumentLink(h,m,resolveDocumentLink):resolveDocumentLink(h,m):void 0})}}class ConfigurationFeature{constructor(h){this._client=h,this._listeners=new Map}get messages(){return C.DidChangeConfigurationNotification.type}fillClientCapabilities(h){ensure(ensure(h,"workspace"),"didChangeConfiguration").dynamicRegistration=!0}initialize(){let h=this._client.clientOptions.synchronize.configurationSection;void 0!==h&&this.register(this.messages,{id:k.generateUuid(),registerOptions:{section:h}})}register(h,m){let y=v.workspace.onDidChangeConfiguration(h=>{this.onDidChangeConfiguration(m.registerOptions.section,h)});this._listeners.set(m.id,y),void 0!==m.registerOptions.section&&this.onDidChangeConfiguration(m.registerOptions.section,void 0)}unregister(h){let m=this._listeners.get(h);m&&(this._listeners.delete(h),m.dispose())}dispose(){for(let h of this._listeners.values())h.dispose();this._listeners.clear()}onDidChangeConfiguration(h,m){let y;if(y=A.string(h)?[h]:h,void 0!==y&&void 0!==m){if(!y.some(h=>m.affectsConfiguration(h)))return}let didChangeConfiguration=h=>{void 0!==h?this._client.sendNotification(C.DidChangeConfigurationNotification.type,{settings:this.extractSettingsInformation(h)}):this._client.sendNotification(C.DidChangeConfigurationNotification.type,{settings:null})},v=this.getMiddleware();v?v(y,didChangeConfiguration):didChangeConfiguration(y)}extractSettingsInformation(h){function ensurePath(h,m){let y=h;for(let h=0;h<m.length-1;h++){let v=y[m[h]];v||(v=Object.create(null),y[m[h]]=v),y=v}return y}let m=this._client.clientOptions.workspaceFolder?this._client.clientOptions.workspaceFolder.uri:void 0,y=Object.create(null);for(let C=0;C<h.length;C++){let T=h[C],w=T.indexOf("."),A=null;if(A=w>=0?v.workspace.getConfiguration(T.substr(0,w),m).get(T.substr(w+1)):v.workspace.getConfiguration(T,m),A){let m=h[C].split(".");ensurePath(y,m)[m[m.length-1]]=A}}return y}getMiddleware(){let h=this._client.clientOptions.middleware;return h.workspace&&h.workspace.didChangeConfiguration?h.workspace.didChangeConfiguration:void 0}}class ExecuteCommandFeature{constructor(h){this._client=h,this._commands=new Map}get messages(){return C.ExecuteCommandRequest.type}fillClientCapabilities(h){ensure(ensure(h,"workspace"),"executeCommand").dynamicRegistration=!0}initialize(h){h.executeCommandProvider&&this.register(this.messages,{id:k.generateUuid(),registerOptions:Object.assign({},h.executeCommandProvider)})}register(h,m){let y=this._client;if(m.registerOptions.commands){let h=[];for(const T of m.registerOptions.commands)h.push(v.commands.registerCommand(T,(...h)=>{let m={command:T,arguments:h};return y.sendRequest(C.ExecuteCommandRequest.type,m).then(void 0,h=>{y.logFailedRequest(C.ExecuteCommandRequest.type,h)})}));this._commands.set(m.id,h)}}unregister(h){let m=this._commands.get(h);m&&m.forEach(h=>h.dispose())}dispose(){this._commands.forEach(h=>{h.forEach(h=>h.dispose())}),this._commands.clear()}}!function(h){h.is=function is(h){return h&&C.MessageReader.is(h.reader)&&C.MessageWriter.is(h.writer)}}(m.MessageTransports||(m.MessageTransports={}));m.BaseLanguageClient=class BaseLanguageClient{constructor(h,m,y){this._features=[],this._method2Message=new Map,this._dynamicFeatures=new Map,this._id=h,this._name=m,y=y||{},this._clientOptions={documentSelector:y.documentSelector||[],synchronize:y.synchronize||{},diagnosticCollectionName:y.diagnosticCollectionName,outputChannelName:y.outputChannelName||this._name,revealOutputChannelOn:y.revealOutputChannelOn||N.Error,stdioEncoding:y.stdioEncoding||"utf8",initializationOptions:y.initializationOptions,initializationFailedHandler:y.initializationFailedHandler,errorHandler:y.errorHandler||new DefaultErrorHandler(this._name),middleware:y.middleware||{},uriConverters:y.uriConverters,workspaceFolder:y.workspaceFolder},this._clientOptions.synchronize=this._clientOptions.synchronize||{},this.state=I.Initial,this._connectionPromise=void 0,this._resolvedConnection=void 0,this._initializeResult=void 0,y.outputChannel?(this._outputChannel=y.outputChannel,this._disposeOutputChannel=!1):(this._outputChannel=void 0,this._disposeOutputChannel=!0),this._listeners=void 0,this._providers=void 0,this._diagnostics=void 0,this._fileEvents=[],this._fileEventDelayer=new P.Delayer(250),this._onReady=new Promise((h,m)=>{this._onReadyCallbacks={resolve:h,reject:m}}),this._onStop=void 0,this._telemetryEmitter=new C.Emitter,this._stateChangeEmitter=new C.Emitter,this._tracer={log:(h,m)=>{this.logTrace(h,m)}},this._c2p=T.createConverter(y.uriConverters?y.uriConverters.code2Protocol:void 0),this._p2c=w.createConverter(y.uriConverters?y.uriConverters.protocol2Code:void 0),this._syncedDocuments=new Map,this.registerBuiltinFeatures()}get state(){return this._state}set state(h){let m=this.getPublicState();this._state=h;let y=this.getPublicState();y!==m&&this._stateChangeEmitter.fire({oldState:m,newState:y})}getPublicState(){return this.state===I.Running?D.Running:D.Stopped}get initializeResult(){return this._initializeResult}sendRequest(h,...m){if(!this.isConnectionActive())throw new Error("Language client is not ready yet");this.forceDocumentSync();try{return this._resolvedConnection.sendRequest(h,...m)}catch(m){throw this.error(`Sending request ${A.string(h)?h:h.method} failed.`,m),m}}onRequest(h,m){if(!this.isConnectionActive())throw new Error("Language client is not ready yet");try{this._resolvedConnection.onRequest(h,m)}catch(m){throw this.error(`Registering request handler ${A.string(h)?h:h.method} failed.`,m),m}}sendNotification(h,m){if(!this.isConnectionActive())throw new Error("Language client is not ready yet");this.forceDocumentSync();try{this._resolvedConnection.sendNotification(h,m)}catch(m){throw this.error(`Sending notification ${A.string(h)?h:h.method} failed.`,m),m}}onNotification(h,m){if(!this.isConnectionActive())throw new Error("Language client is not ready yet");try{this._resolvedConnection.onNotification(h,m)}catch(m){throw this.error(`Registering notification handler ${A.string(h)?h:h.method} failed.`,m),m}}get clientOptions(){return this._clientOptions}get protocol2CodeConverter(){return this._p2c}get code2ProtocolConverter(){return this._c2p}get onTelemetry(){return this._telemetryEmitter.event}get onDidChangeState(){return this._stateChangeEmitter.event}get outputChannel(){return this._outputChannel||(this._outputChannel=v.window.createOutputChannel(this._clientOptions.outputChannelName?this._clientOptions.outputChannelName:this._name)),this._outputChannel}get diagnostics(){return this._diagnostics}createDefaultErrorHandler(){return new DefaultErrorHandler(this._name)}set trace(h){this._trace=h,this.onReady().then(()=>{this.resolveConnection().then(m=>{m.trace(h,this._tracer)})},()=>{})}data2String(h){if(h instanceof C.ResponseError){const m=h;return`  Message: ${m.message}\n  Code: ${m.code} ${m.data?"\n"+m.data.toString():""}`}return h instanceof Error?A.string(h.stack)?h.stack:h.message:A.string(h)?h:h.toString()}info(h,m){this.outputChannel.appendLine(`[Info  - ${(new Date).toLocaleTimeString()}] ${h}`),m&&this.outputChannel.appendLine(this.data2String(m)),this._clientOptions.revealOutputChannelOn<=N.Info&&this.outputChannel.show(!0)}warn(h,m){this.outputChannel.appendLine(`[Warn  - ${(new Date).toLocaleTimeString()}] ${h}`),m&&this.outputChannel.appendLine(this.data2String(m)),this._clientOptions.revealOutputChannelOn<=N.Warn&&this.outputChannel.show(!0)}error(h,m){this.outputChannel.appendLine(`[Error - ${(new Date).toLocaleTimeString()}] ${h}`),m&&this.outputChannel.appendLine(this.data2String(m)),this._clientOptions.revealOutputChannelOn<=N.Error&&this.outputChannel.show(!0)}logTrace(h,m){this.outputChannel.appendLine(`[Trace - ${(new Date).toLocaleTimeString()}] ${h}`),m&&this.outputChannel.appendLine(this.data2String(m))}needsStart(){return this.state===I.Initial||this.state===I.Stopping||this.state===I.Stopped}needsStop(){return this.state===I.Starting||this.state===I.Running}onReady(){return this._onReady}isConnectionActive(){return this.state===I.Running&&!!this._resolvedConnection}start(){return this._listeners=[],this._providers=[],this._diagnostics||(this._diagnostics=this._clientOptions.diagnosticCollectionName?v.languages.createDiagnosticCollection(this._clientOptions.diagnosticCollectionName):v.languages.createDiagnosticCollection()),this.state=I.Starting,this.resolveConnection().then(h=>(h.onLogMessage(h=>{switch(h.type){case C.MessageType.Error:this.error(h.message);break;case C.MessageType.Warning:this.warn(h.message);break;case C.MessageType.Info:this.info(h.message);break;default:this.outputChannel.appendLine(h.message)}}),h.onShowMessage(h=>{switch(h.type){case C.MessageType.Error:v.window.showErrorMessage(h.message);break;case C.MessageType.Warning:v.window.showWarningMessage(h.message);break;case C.MessageType.Info:v.window.showInformationMessage(h.message);break;default:v.window.showInformationMessage(h.message)}}),h.onRequest(C.ShowMessageRequest.type,h=>{let m;switch(h.type){case C.MessageType.Error:m=v.window.showErrorMessage;break;case C.MessageType.Warning:m=v.window.showWarningMessage;break;case C.MessageType.Info:m=v.window.showInformationMessage;break;default:m=v.window.showInformationMessage}let y=h.actions||[];return m(h.message,...y)}),h.onTelemetry(h=>{this._telemetryEmitter.fire(h)}),h.listen(),this.initialize(h))).then(void 0,h=>{this.state=I.StartFailed,this._onReadyCallbacks.reject(h),this.error("Starting client failed",h),v.window.showErrorMessage(`Couldn't start client ${this._name}`)}),new v.Disposable(()=>{this.needsStop()&&this.stop()})}resolveConnection(){return this._connectionPromise||(this._connectionPromise=this.createConnection()),this._connectionPromise}initialize(h){this.refreshTrace(h,!1);let m=this._clientOptions.initializationOptions,y=this._clientOptions.workspaceFolder?this._clientOptions.workspaceFolder.uri.fsPath:this._clientGetRootPath(),T={processId:process.pid,rootPath:y||null,rootUri:y?this._c2p.asUri(v.Uri.file(y)):null,capabilities:this.computeClientCapabilities(),initializationOptions:A.func(m)?m():m,trace:C.Trace.toString(this._trace),workspaceFolders:null};return this.fillInitializeParams(T),h.initialize(T).then(m=>{this._resolvedConnection=h,this._initializeResult=m,this.state=I.Running;let y=void 0;return A.number(m.capabilities.textDocumentSync)&&m.capabilities.textDocumentSync!==C.TextDocumentSyncKind.None?y={openClose:!0,change:m.capabilities.textDocumentSync,save:{includeText:!1}}:void 0!==m.capabilities.textDocumentSync&&null!==m.capabilities.textDocumentSync&&(y=m.capabilities.textDocumentSync),this._capabilities=Object.assign({},m.capabilities,{resolvedTextDocumentSync:y}),h.onDiagnostics(h=>this.handleDiagnostics(h)),h.onRequest(C.RegistrationRequest.type,h=>this.handleRegistrationRequest(h)),h.onRequest("client/registerFeature",h=>this.handleRegistrationRequest(h)),h.onRequest(C.UnregistrationRequest.type,h=>this.handleUnregistrationRequest(h)),h.onRequest("client/unregisterFeature",h=>this.handleUnregistrationRequest(h)),h.onRequest(C.ApplyWorkspaceEditRequest.type,h=>this.handleApplyWorkspaceEdit(h)),h.sendNotification(C.InitializedNotification.type,{}),this.hookFileEvents(h),this.hookConfigurationChanged(h),this.initializeFeatures(h),this._onReadyCallbacks.resolve(),m}).then(void 0,m=>{this._clientOptions.initializationFailedHandler?this._clientOptions.initializationFailedHandler(m)?this.initialize(h):(this.stop(),this._onReadyCallbacks.reject(m)):m instanceof C.ResponseError&&m.data&&m.data.retry?v.window.showErrorMessage(m.message,{title:"Retry",id:"retry"}).then(y=>{y&&"retry"===y.id?this.initialize(h):(this.stop(),this._onReadyCallbacks.reject(m))}):(m&&m.message&&v.window.showErrorMessage(m.message),this.error("Server initialization failed.",m),this.stop(),this._onReadyCallbacks.reject(m))})}_clientGetRootPath(){let h=v.workspace.workspaceFolders;if(!h||0===h.length)return;let m=h[0];return"file"===m.uri.scheme?m.uri.fsPath:void 0}stop(){return this._initializeResult=void 0,this._connectionPromise?this.state===I.Stopping&&this._onStop?this._onStop:(this.state=I.Stopping,this.cleanUp(),this._onStop=this.resolveConnection().then(h=>h.shutdown().then(()=>{h.exit(),h.dispose(),this.state=I.Stopped,this._onStop=void 0,this._connectionPromise=void 0,this._resolvedConnection=void 0}))):(this.state=I.Stopped,Promise.resolve())}cleanUp(h=!0,m=!0){this._listeners&&(this._listeners.forEach(h=>h.dispose()),this._listeners=void 0),this._providers&&(this._providers.forEach(h=>h.dispose()),this._providers=void 0),this._syncedDocuments&&this._syncedDocuments.clear();for(let h of this._dynamicFeatures.values())h.dispose();h&&this._outputChannel&&this._disposeOutputChannel&&(this._outputChannel.dispose(),this._outputChannel=void 0),m&&this._diagnostics&&(this._diagnostics.dispose(),this._diagnostics=void 0)}notifyFileEvent(h){this._fileEvents.push(h),this._fileEventDelayer.trigger(()=>{this.onReady().then(()=>{this.resolveConnection().then(h=>{this.isConnectionActive()&&h.didChangeWatchedFiles({changes:this._fileEvents}),this._fileEvents=[]})},h=>{this.error("Notify file events failed.",h)})})}forceDocumentSync(){this._dynamicFeatures.get(C.DidChangeTextDocumentNotification.type.method).forceDelivery()}handleDiagnostics(h){if(!this._diagnostics)return;let m=this._p2c.asUri(h.uri),y=this._p2c.asDiagnostics(h.diagnostics),v=this.clientOptions.middleware.handleDiagnostics;v?v(m,y,(h,m)=>this.setDiagnostics(h,m)):this.setDiagnostics(m,y)}setDiagnostics(h,m){this._diagnostics&&this._diagnostics.set(h,m)}createConnection(){let errorHandler=(h,m,y)=>{this.handleConnectionError(h,m,y)},closeHandler=()=>{this.handleConnectionClosed()};return this.createMessageTransports(this._clientOptions.stdioEncoding||"utf8").then(h=>function createConnection(h,m,y,v){let T=new ConsoleLogger,w=C.createProtocolConnection(h,m,T);return w.onError(h=>{y(h[0],h[1],h[2])}),w.onClose(v),{listen:()=>w.listen(),sendRequest:(h,...m)=>w.sendRequest(A.string(h)?h:h.method,...m),onRequest:(h,m)=>w.onRequest(A.string(h)?h:h.method,m),sendNotification:(h,m)=>w.sendNotification(A.string(h)?h:h.method,m),onNotification:(h,m)=>w.onNotification(A.string(h)?h:h.method,m),trace:(h,m,y=!1)=>w.trace(h,m,y),initialize:h=>w.sendRequest(C.InitializeRequest.type,h),shutdown:()=>w.sendRequest(C.ShutdownRequest.type,void 0),exit:()=>w.sendNotification(C.ExitNotification.type),onLogMessage:h=>w.onNotification(C.LogMessageNotification.type,h),onShowMessage:h=>w.onNotification(C.ShowMessageNotification.type,h),onTelemetry:h=>w.onNotification(C.TelemetryEventNotification.type,h),didChangeConfiguration:h=>w.sendNotification(C.DidChangeConfigurationNotification.type,h),didChangeWatchedFiles:h=>w.sendNotification(C.DidChangeWatchedFilesNotification.type,h),didOpenTextDocument:h=>w.sendNotification(C.DidOpenTextDocumentNotification.type,h),didChangeTextDocument:h=>w.sendNotification(C.DidChangeTextDocumentNotification.type,h),didCloseTextDocument:h=>w.sendNotification(C.DidCloseTextDocumentNotification.type,h),didSaveTextDocument:h=>w.sendNotification(C.DidSaveTextDocumentNotification.type,h),onDiagnostics:h=>w.onNotification(C.PublishDiagnosticsNotification.type,h),dispose:()=>w.dispose()}}(h.reader,h.writer,errorHandler,closeHandler))}handleConnectionClosed(){if(this.state===I.Stopping||this.state===I.Stopped)return;try{this._resolvedConnection&&this._resolvedConnection.dispose()}catch(h){}let h=M.DoNotRestart;try{h=this._clientOptions.errorHandler.closed()}catch(h){}this._connectionPromise=void 0,this._resolvedConnection=void 0,h===M.DoNotRestart?(this.error("Connection to server got closed. Server will not be restarted."),this.state=I.Stopped,this.cleanUp(!1,!0)):h===M.Restart&&(this.info("Connection to server got closed. Server will restart."),this.cleanUp(!1,!1),this.state=I.Initial,this.start())}handleConnectionError(h,m,y){this._clientOptions.errorHandler.error(h,m,y)===R.Shutdown&&(this.error("Connection to server is erroring. Shutting down server."),this.stop())}hookConfigurationChanged(h){v.workspace.onDidChangeConfiguration(()=>{this.refreshTrace(h,!0)})}refreshTrace(h,m=!1){let y=v.workspace.getConfiguration(this._id),T=C.Trace.Off;y&&(T=C.Trace.fromString(y.get("trace.server","off"))),this._trace=T,h.trace(this._trace,this._tracer,m)}hookFileEvents(h){let m,y=this._clientOptions.synchronize.fileEvents;y&&(m=A.array(y)?y:[y],m&&this._dynamicFeatures.get(C.DidChangeWatchedFilesNotification.type.method).registerRaw(k.generateUuid(),m))}registerFeatures(h){for(let m of h)this.registerFeature(m)}registerFeature(h){if(this._features.push(h),L.is(h)){let m=h.messages;if(Array.isArray(m))for(let y of m)this._method2Message.set(y.method,y),this._dynamicFeatures.set(y.method,h);else this._method2Message.set(m.method,m),this._dynamicFeatures.set(m.method,h)}}registerBuiltinFeatures(){this.registerFeature(new ConfigurationFeature(this)),this.registerFeature(new DidOpenTextDocumentFeature(this,this._syncedDocuments)),this.registerFeature(new DidChangeTextDocumentFeature(this)),this.registerFeature(new WillSaveFeature(this)),this.registerFeature(new WillSaveWaitUntilFeature(this)),this.registerFeature(new DidSaveTextDocumentFeature(this)),this.registerFeature(new DidCloseTextDocumentFeature(this,this._syncedDocuments)),this.registerFeature(new FileSystemWatcherFeature(this,h=>this.notifyFileEvent(h))),this.registerFeature(new CompletionItemFeature(this)),this.registerFeature(new HoverFeature(this)),this.registerFeature(new SignatureHelpFeature(this)),this.registerFeature(new DefinitionFeature(this)),this.registerFeature(new ReferencesFeature(this)),this.registerFeature(new DocumentHighlightFeature(this)),this.registerFeature(new DocumentSymbolFeature(this)),this.registerFeature(new WorkspaceSymbolFeature(this)),this.registerFeature(new CodeActionFeature(this)),this.registerFeature(new CodeLensFeature(this)),this.registerFeature(new DocumentFormattingFeature(this)),this.registerFeature(new DocumentRangeFormattingFeature(this)),this.registerFeature(new DocumentOnTypeFormattingFeature(this)),this.registerFeature(new RenameFeature(this)),this.registerFeature(new DocumentLinkFeature(this)),this.registerFeature(new ExecuteCommandFeature(this))}fillInitializeParams(h){for(let m of this._features)A.func(m.fillInitializeParams)&&m.fillInitializeParams(h)}computeClientCapabilities(){let h={};ensure(h,"workspace").applyEdit=!0,ensure(ensure(h,"workspace"),"workspaceEdit").documentChanges=!0,ensure(ensure(h,"textDocument"),"publishDiagnostics").relatedInformation=!0;for(let m of this._features)m.fillClientCapabilities(h);return h}initializeFeatures(h){let m=this._clientOptions.documentSelector;for(let h of this._features)h.initialize(this._capabilities,m)}handleRegistrationRequest(h){return new Promise((m,y)=>{for(let m of h.registrations){const h=this._dynamicFeatures.get(m.method);if(!h)return void y(new Error(`No feature implementation for ${m.method} found. Registration failed.`));const v=m.registerOptions||{};v.documentSelector=v.documentSelector||this._clientOptions.documentSelector;const C={id:m.id,registerOptions:v};h.register(this._method2Message.get(m.method),C)}m()})}handleUnregistrationRequest(h){return new Promise((m,y)=>{for(let m of h.unregisterations){const h=this._dynamicFeatures.get(m.method);if(!h)return void y(new Error(`No feature implementation for ${m.method} found. Unregistration failed.`));h.unregister(m.id)}m()})}handleApplyWorkspaceEdit(h){let m=h.edit,y=new Map;v.workspace.textDocuments.forEach(h=>y.set(h.uri.toString(),h));let C=!1;if(m.documentChanges)for(const h of m.documentChanges)if(h.textDocument.version&&h.textDocument.version>=0){let m=y.get(h.textDocument.uri);if(m&&m.version!==h.textDocument.version){C=!0;break}}return C?Promise.resolve({applied:!1}):v.workspace.applyEdit(this._p2c.asWorkspaceEdit(h.edit)).then(h=>({applied:h}))}logFailedRequest(h,m){m instanceof C.ResponseError&&m.code===C.ErrorCodes.RequestCancelled||this.error(`Request ${h.method} failed.`,m)}}},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0});class ValueUUID{constructor(h){this._value=h}asHex(){return this._value}equals(h){return this.asHex()===h.asHex()}}class V4UUID extends ValueUUID{constructor(){super([V4UUID._randomHex(),V4UUID._randomHex(),V4UUID._randomHex(),V4UUID._randomHex(),V4UUID._randomHex(),V4UUID._randomHex(),V4UUID._randomHex(),V4UUID._randomHex(),"-",V4UUID._randomHex(),V4UUID._randomHex(),V4UUID._randomHex(),V4UUID._randomHex(),"-","4",V4UUID._randomHex(),V4UUID._randomHex(),V4UUID._randomHex(),"-",V4UUID._oneOf(V4UUID._timeHighBits),V4UUID._randomHex(),V4UUID._randomHex(),V4UUID._randomHex(),"-",V4UUID._randomHex(),V4UUID._randomHex(),V4UUID._randomHex(),V4UUID._randomHex(),V4UUID._randomHex(),V4UUID._randomHex(),V4UUID._randomHex(),V4UUID._randomHex(),V4UUID._randomHex(),V4UUID._randomHex(),V4UUID._randomHex(),V4UUID._randomHex()].join(""))}static _oneOf(h){return h[Math.floor(h.length*Math.random())]}static _randomHex(){return V4UUID._oneOf(V4UUID._chars)}}function v4(){return new V4UUID}V4UUID._chars=["0","1","2","3","4","5","6","6","7","8","9","a","b","c","d","e","f"],V4UUID._timeHighBits=["8","9","a","b"],m.empty=new ValueUUID("00000000-0000-0000-0000-000000000000"),m.v4=v4;const v=/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/i;function isUUID(h){return v.test(h)}m.isUUID=isUUID,m.parse=function parse(h){if(!isUUID(h))throw new Error("invalid uuid");return new ValueUUID(h)},m.generateUuid=function generateUuid(){return v4().asHex()}},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0}),function(h){h[h.Trace=1]="Trace",h[h.Debug=2]="Debug",h[h.Info=3]="Info",h[h.Warning=4]="Warning",h[h.Error=5]="Error",h[h.Critical=6]="Critical",h[h.Off=7]="Off"}(m.LogLevel||(m.LogLevel={}))},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0});const v=y(755),C=y(7),T=y(334),w=y(335),A=y(117),P=y(202),k=y(336),renderObjectToString=h=>{if(void 0===typeof h)return"<undefined>";if(null===typeof h)return"<null>";if("string"==typeof h)return`"${h}"`;if("number"==typeof h)return`#${h}`;if("boolean"==typeof h)return`${h}`;if(h instanceof Symbol)return h.toString();if(h instanceof Error)return k.errorToString(h);try{return TraceFormat.stringify(h)}catch(m){try{return h.toString()}catch(h){return"<unknown type>"}}};class TraceFormat{static formatDate(h,m){return v(h,m||"yyyy-mm-dd HH:MM:ss.l ",!0)}static formatEvent(h,m,y,v,C,...T){let w;switch(y){case A.LogLevel.Critical:w="C";break;case A.LogLevel.Error:w="E";break;case A.LogLevel.Warning:w="W";break;case A.LogLevel.Info:w="I";break;case A.LogLevel.Debug:w="V";break;default:w="?"}const P=null===h?"":TraceFormat.formatDate(h);let k;return C.length>TraceFormat.maxMessageLength&&(C=C.substr(0,TraceFormat.maxMessageLength)+"..."),k=0!==v?`[${P}${m} ${w}] (${v}) ${C}`:`[${P}${m} ${w}] ${C}`,k+=T.map(renderObjectToString).map((h,m)=>`> object #${m}: ${h}`).join("\n"),k}static parseEventId(h){let m=h.match(/\] \(([0-9]+)\)/);return m?parseInt(m[1],10):0}static formatPath(h){if(!h)return"<null>";if(w.LoggerSettings.disableObfuscation)return h;const m=T.Privacy.getShortHash(C.dirname(h)),y=C.extname(h),v=T.Privacy.getShortHash(C.basename(h,y)),A=h.replace("\\","/").indexOf("/");return 2===A&&":"===h[1]?`<?:${h[2]}${m}${h[2]}${v}${y}>`:0===A?`<${h[0]}${m}${h[0]}${v}${y}>`:A>0?`<${m}${h[A]}${v}${y}>`:`<${v}${y}>`}static formatEmail(h){if(!h)return"<null>";if(w.LoggerSettings.disableObfuscation)return h;const m=T.Privacy.getShortHash(h);return`<${m.substr(0,4)}@${m.substr(4)}>`}static formatText(h){if(!h)return"<null>";if(w.LoggerSettings.disableObfuscation)return h;const m=T.Privacy.getShortHash(h);return`<${h.length}:${m}>`}static stringify(h){return w.LoggerSettings.disableObfuscation?JSON.stringify(h,null,2):JSON.stringify(h,(h,m)=>{if(m instanceof Error)return k.errorToString(m);const y=w.LoggerSettings.obfuscateProperties[h];if(y)switch(y){case P.LogValueType.Text:return TraceFormat.formatText(m);case P.LogValueType.Email:return TraceFormat.formatEmail(m);case P.LogValueType.Path:return TraceFormat.formatPath(m)}return m},2)}}m.TraceFormat=TraceFormat,TraceFormat.maxMessageLength=5120},function(h,m){m.getArg=function getArg(h,m,y){if(m in h)return h[m];if(3===arguments.length)return y;throw new Error('"'+m+'" is a required argument.')};var y=/^(?:([\w+\-.]+):)?\/\/(?:(\w+:\w+)@)?([\w.-]*)(?::(\d+))?(.*)$/,v=/^data:.+\,.+$/;function urlParse(h){var m=h.match(y);return m?{scheme:m[1],auth:m[2],host:m[3],port:m[4],path:m[5]}:null}function urlGenerate(h){var m="";return h.scheme&&(m+=h.scheme+":"),m+="//",h.auth&&(m+=h.auth+"@"),h.host&&(m+=h.host),h.port&&(m+=":"+h.port),h.path&&(m+=h.path),m}function normalize(h){var y=h,v=urlParse(h);if(v){if(!v.path)return h;y=v.path}for(var C,T=m.isAbsolute(y),w=y.split(/\/+/),A=0,P=w.length-1;P>=0;P--)"."===(C=w[P])?w.splice(P,1):".."===C?A++:A>0&&(""===C?(w.splice(P+1,A),A=0):(w.splice(P,2),A--));return""===(y=w.join("/"))&&(y=T?"/":"."),v?(v.path=y,urlGenerate(v)):y}function join(h,m){""===h&&(h="."),""===m&&(m=".");var y=urlParse(m),C=urlParse(h);if(C&&(h=C.path||"/"),y&&!y.scheme)return C&&(y.scheme=C.scheme),urlGenerate(y);if(y||m.match(v))return m;if(C&&!C.host&&!C.path)return C.host=m,urlGenerate(C);var T="/"===m.charAt(0)?m:normalize(h.replace(/\/+$/,"")+"/"+m);return C?(C.path=T,urlGenerate(C)):T}m.urlParse=urlParse,m.urlGenerate=urlGenerate,m.normalize=normalize,m.join=join,m.isAbsolute=function(h){return"/"===h.charAt(0)||y.test(h)},m.relative=function relative(h,m){""===h&&(h="."),h=h.replace(/\/$/,"");for(var y=0;0!==m.indexOf(h+"/");){var v=h.lastIndexOf("/");if(v<0)return m;if((h=h.slice(0,v)).match(/^([^\/]+:\/)?\/*$/))return m;++y}return Array(y+1).join("../")+m.substr(h.length+1)};var C=!("__proto__"in Object.create(null));function identity(h){return h}function isProtoString(h){if(!h)return!1;var m=h.length;if(m<9)return!1;if(95!==h.charCodeAt(m-1)||95!==h.charCodeAt(m-2)||111!==h.charCodeAt(m-3)||116!==h.charCodeAt(m-4)||111!==h.charCodeAt(m-5)||114!==h.charCodeAt(m-6)||112!==h.charCodeAt(m-7)||95!==h.charCodeAt(m-8)||95!==h.charCodeAt(m-9))return!1;for(var y=m-10;y>=0;y--)if(36!==h.charCodeAt(y))return!1;return!0}function strcmp(h,m){return h===m?0:null===h?1:null===m?-1:h>m?1:-1}m.toSetString=C?identity:function toSetString(h){return isProtoString(h)?"$"+h:h},m.fromSetString=C?identity:function fromSetString(h){return isProtoString(h)?h.slice(1):h},m.compareByOriginalPositions=function compareByOriginalPositions(h,m,y){var v=strcmp(h.source,m.source);return 0!==v||0!==(v=h.originalLine-m.originalLine)||0!==(v=h.originalColumn-m.originalColumn)||y||0!==(v=h.generatedColumn-m.generatedColumn)||0!==(v=h.generatedLine-m.generatedLine)?v:strcmp(h.name,m.name)},m.compareByGeneratedPositionsDeflated=function compareByGeneratedPositionsDeflated(h,m,y){var v=h.generatedLine-m.generatedLine;return 0!==v||0!==(v=h.generatedColumn-m.generatedColumn)||y||0!==(v=strcmp(h.source,m.source))||0!==(v=h.originalLine-m.originalLine)||0!==(v=h.originalColumn-m.originalColumn)?v:strcmp(h.name,m.name)},m.compareByGeneratedPositionsInflated=function compareByGeneratedPositionsInflated(h,m){var y=h.generatedLine-m.generatedLine;return 0!==y||0!==(y=h.generatedColumn-m.generatedColumn)||0!==(y=strcmp(h.source,m.source))||0!==(y=h.originalLine-m.originalLine)||0!==(y=h.originalColumn-m.originalColumn)?y:strcmp(h.name,m.name)},m.parseSourceMapInput=function parseSourceMapInput(h){return JSON.parse(h.replace(/^\)]}'[^\n]*\n/,""))},m.computeSourceURL=function computeSourceURL(h,m,y){if(m=m||"",h&&("/"!==h[h.length-1]&&"/"!==m[0]&&(h+="/"),m=h+m),y){var v=urlParse(y);if(!v)throw new Error("sourceMapURL could not be parsed");if(v.path){var C=v.path.lastIndexOf("/");C>=0&&(v.path=v.path.substring(0,C+1))}m=join(urlGenerate(v),m)}return normalize(m)}},function(h,m,y){"use strict";function string(h){return"string"==typeof h||h instanceof String}function array(h){return Array.isArray(h)}Object.defineProperty(m,"__esModule",{value:!0}),m.boolean=function boolean(h){return!0===h||!1===h},m.string=string,m.number=function number(h){return"number"==typeof h||h instanceof Number},m.error=function error(h){return h instanceof Error},m.func=function func(h){return"function"==typeof h},m.array=array,m.stringArray=function stringArray(h){return array(h)&&h.every(h=>string(h))}},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0});const v=y(2),C=y(6);function getEventPropertyName(h){return`on${h.substr(0,1).toUpperCase()}${h.substr(1)}`}m.getEventPropertyName=getEventPropertyName,m.onAllEvents=function onAllEvents(h,m,y){const C=[];for(const v of m){const m=h[getEventPropertyName(v)];C.push(m(h=>y(v,h)))}return v.createDisposable(()=>{C.forEach(h=>h.dispose())})},m.notifyConnections=function notifyConnections(h,m,y,v){h.forEach(C=>{try{C.sendNotification(m,y)}catch(y){null==v||v.error(`failed to send notification method:${m} index:${h.indexOf(C)}`)}})};m.WrappedMessageReader=class WrappedMessageReader{constructor(h,m){this.messageReader=h,this.messageTransformer=m,this.onError=this.messageReader.onError,this.onClose=this.messageReader.onClose,this.onPartialMessage=this.messageReader.onPartialMessage}listen(h){this.messageReader.listen(m=>{h(this.messageTransformer(m))})}dispose(){this.messageReader.dispose()}};m.WrappedMessageWriter=class WrappedMessageWriter{constructor(h,m){this.messageWriter=h,this.messageTransformer=m,this.onError=this.messageWriter.onError,this.onClose=this.messageWriter.onClose}write(h){this.messageWriter.write(this.messageTransformer(h))}dispose(){this.messageWriter.dispose()}};m.TimingFilter=class TimingFilter{constructor(){this.times=new Map}filter(h,m){if("number"!=typeof m.id)return m;if(this.times.has(m.id)){const y=Date.now()-this.times.get(m.id);this.times.delete(m.id),(h||void 0!==m.times)&&(m.times=TimedRpcMessageUtils.addTime(m.times,y))}else this.times.set(m.id,Date.now());return m}};class TimedRpcMessageUtils{static addTime(h,m){void 0===h&&(h=[]);const y=m-TimedRpcMessageUtils.getTotalTime(h);return h.push(y>0?y:0),h}static getLatency(h){let m=0;if(h)for(let y=1;y<h.length;y+=2)m+=h[y];return m}static getProcessingTime(h){let m=0;if(h)for(let y=0;y<h.length;y+=2)m+=h[y];return m}static getTotalTime(h){return TimedRpcMessageUtils.getLatency(h)+TimedRpcMessageUtils.getProcessingTime(h)}}m.TimedRpcMessageUtils=TimedRpcMessageUtils,m.addContextToRpcMessage=function addContextToRpcMessage(h){if(!h)return h;const m=h.context,y=h.params;return"object"!=typeof m||"object"!=typeof y||Array.isArray(y)||y.context?h:Object.assign({},h,{params:Object.assign({context:m},y)})};m.RpcRequestsWithContext=class RpcRequestsWithContext{constructor(){this.methods=new Set,this.readFilter=this.filterMessage.bind(this)}add(h){h&&this.methods.add(h)}filterMessage(h){const m=h;if(!m.method||!this.methods.has(m.method))return h;const y=h.context||{};return m.params?Array.isArray(m.params)&&m.params.push(y):m.params=[y],m}},m.createMethodNotFoundResponse=function createMethodNotFoundResponse(h){return new C.ResponseError(C.ErrorCodes.MethodNotFound,`method:${h} not supported`)}},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0});const v=y(213);m.setExtensionContext=h=>{m.extensionContext=h},m.getExtensionContext=()=>(v.throwNotInitialized(m.extensionContext),m.extensionContext)},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0});const v=y(15);m.traceSource=new v.TraceSource("Client")},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0});const v=y(67);m.fileAccess=v.fileAccess},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0}),m.SshSessionConfiguration=m.SshProtocolExtensionNames=void 0;const v=y(98),C=y(441),T=y(130),w=y(258);var A;!function(h){h.serverSignatureAlgorithms="server-sig-algs",h.openChannelRequest="open-channel-request@microsoft.com",h.sessionReconnect="session-reconnect@microsoft.com",h.sessionLatency="session-latency@microsoft.com"}(A=m.SshProtocolExtensionNames||(m.SshProtocolExtensionNames={}));m.SshSessionConfiguration=class SshSessionConfiguration{constructor(h=!0){this.protocolExtensions=[],this.services=new Map,this.keyExchangeAlgorithms=[],this.publicKeyAlgorithms=[],this.encryptionAlgorithms=[],this.hmacAlgorithms=[],this.compressionAlgorithms=[],this.maxClientAuthenticationAttempts=5,this.enableKeyExchangeGuess=!1,this.keyRotationThreshold=536870912,this.protocolExtensions.push(A.serverSignatureAlgorithms),this.protocolExtensions.push(A.openChannelRequest),this.services.set(C.KeyExchangeService,null),this.services.set(T.ConnectionService,null),this.services.set(w.AuthenticationService,null),h?(this.keyExchangeAlgorithms.push(v.SshAlgorithms.keyExchange.ecdhNistp384Sha384),this.keyExchangeAlgorithms.push(v.SshAlgorithms.keyExchange.ecdhNistp256Sha256),this.keyExchangeAlgorithms.push(v.SshAlgorithms.keyExchange.dhGroup16Sha512),this.keyExchangeAlgorithms.push(v.SshAlgorithms.keyExchange.dhGroup14Sha256),this.publicKeyAlgorithms.push(v.SshAlgorithms.publicKey.rsaWithSha512),this.publicKeyAlgorithms.push(v.SshAlgorithms.publicKey.rsaWithSha256),this.publicKeyAlgorithms.push(v.SshAlgorithms.publicKey.ecdsaSha2Nistp384),this.publicKeyAlgorithms.push(v.SshAlgorithms.publicKey.ecdsaSha2Nistp256),this.encryptionAlgorithms.push(v.SshAlgorithms.encryption.aes256Gcm),this.encryptionAlgorithms.push(v.SshAlgorithms.encryption.aes256Ctr),this.hmacAlgorithms.push(v.SshAlgorithms.hmac.hmacSha512Etm),this.hmacAlgorithms.push(v.SshAlgorithms.hmac.hmacSha256Etm),this.hmacAlgorithms.push(v.SshAlgorithms.hmac.hmacSha512),this.hmacAlgorithms.push(v.SshAlgorithms.hmac.hmacSha256)):(this.keyExchangeAlgorithms.push(v.SshAlgorithms.keyExchange.none),this.publicKeyAlgorithms.push(v.SshAlgorithms.publicKey.none),this.encryptionAlgorithms.push(v.SshAlgorithms.encryption.none),this.hmacAlgorithms.push(v.SshAlgorithms.hmac.none)),this.compressionAlgorithms.push(v.SshAlgorithms.compression.none)}addService(h,m){if(this.services.has(h))throw new Error("Duplicate service entry.");this.services.set(h,m)}getKeyExchangeAlgorithm(h){return this.getAlgorithm(h,this.keyExchangeAlgorithms)}getPublicKeyAlgorithm(h){return this.getAlgorithm(h,this.publicKeyAlgorithms)}getEncryptionAlgorithm(h){return this.getAlgorithm(h,this.encryptionAlgorithms)}getHmacAlgorithm(h){return this.getAlgorithm(h,this.hmacAlgorithms)}getCompressionAlgorithm(h){return this.getAlgorithm(h,this.compressionAlgorithms)}getAlgorithm(h,m){const y=m.find(m=>!!m&&m.name===h);if(!y){if("none"===h)return null;throw new Error("Algorithm not found: "+h)}return y}}},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0}),m.PublicKeyAlgorithm=void 0;const v=y(9),C=y(38);m.PublicKeyAlgorithm=class PublicKeyAlgorithm{constructor(h,m,y){this.name=h,this.keyAlgorithmName=m,this.hashAlgorithmName=y}readSignatureData(h){const m=new C.SshDataReader(h),y=m.readString("ascii");if(y!==this.name)throw new Error("Mismatched public key algorithm: "+`got '${y}', expected '${this.name}'.`);return m.readBinary()}createSignatureData(h){const m=new C.SshDataWriter(v.Buffer.alloc(this.name.length+h.length+20));return m.writeString(this.name,"ascii"),m.writeBinary(h),m.toBuffer()}}},function(h,m,y){var v=y(11),C=y(43)._;function BigInteger(h,m){null!=h&&("number"==typeof h?this.fromNumber(h,m):Buffer.isBuffer(h)?this.fromBuffer(h):null==m&&"string"!=typeof h?this.fromByteArray(h):this.fromString(h,m))}function nbi(){return new BigInteger(null)}BigInteger.prototype.am=function am3(h,m,y,v,C,T){for(var w=16383&m,A=m>>14;--T>=0;){var P=16383&this[h],k=this[h++]>>14,R=A*P+k*w;C=((P=w*P+((16383&R)<<14)+y[v]+C)>>28)+(R>>14)+A*k,y[v++]=268435455&P}return C},BigInteger.prototype.DB=28,BigInteger.prototype.DM=268435455,BigInteger.prototype.DV=1<<28;BigInteger.prototype.FV=Math.pow(2,52),BigInteger.prototype.F1=24,BigInteger.prototype.F2=4;var T,w,A=new Array;for(T="0".charCodeAt(0),w=0;w<=9;++w)A[T++]=w;for(T="a".charCodeAt(0),w=10;w<36;++w)A[T++]=w;for(T="A".charCodeAt(0),w=10;w<36;++w)A[T++]=w;function int2char(h){return"0123456789abcdefghijklmnopqrstuvwxyz".charAt(h)}function intAt(h,m){var y=A[h.charCodeAt(m)];return null==y?-1:y}function nbv(h){var m=nbi();return m.fromInt(h),m}function nbits(h){var m,y=1;return 0!=(m=h>>>16)&&(h=m,y+=16),0!=(m=h>>8)&&(h=m,y+=8),0!=(m=h>>4)&&(h=m,y+=4),0!=(m=h>>2)&&(h=m,y+=2),0!=(m=h>>1)&&(h=m,y+=1),y}function Classic(h){this.m=h}function Montgomery(h){this.m=h,this.mp=h.invDigit(),this.mpl=32767&this.mp,this.mph=this.mp>>15,this.um=(1<<h.DB-15)-1,this.mt2=2*h.t}function op_and(h,m){return h&m}function op_or(h,m){return h|m}function op_xor(h,m){return h^m}function op_andnot(h,m){return h&~m}function lbit(h){if(0===h)return-1;var m=0;return 0==(65535&h)&&(h>>=16,m+=16),0==(255&h)&&(h>>=8,m+=8),0==(15&h)&&(h>>=4,m+=4),0==(3&h)&&(h>>=2,m+=2),0==(1&h)&&++m,m}function cbit(h){for(var m=0;0!=h;)h&=h-1,++m;return m}function NullExp(){}function nNop(h){return h}function Barrett(h){this.r2=nbi(),this.q3=nbi(),BigInteger.ONE.dlShiftTo(2*h.t,this.r2),this.mu=this.r2.divide(h),this.m=h}Classic.prototype.convert=function cConvert(h){return h.s<0||h.compareTo(this.m)>=0?h.mod(this.m):h},Classic.prototype.revert=function cRevert(h){return h},Classic.prototype.reduce=function cReduce(h){h.divRemTo(this.m,null,h)},Classic.prototype.mulTo=function cMulTo(h,m,y){h.multiplyTo(m,y),this.reduce(y)},Classic.prototype.sqrTo=function cSqrTo(h,m){h.squareTo(m),this.reduce(m)},Montgomery.prototype.convert=function montConvert(h){var m=nbi();return h.abs().dlShiftTo(this.m.t,m),m.divRemTo(this.m,null,m),h.s<0&&m.compareTo(BigInteger.ZERO)>0&&this.m.subTo(m,m),m},Montgomery.prototype.revert=function montRevert(h){var m=nbi();return h.copyTo(m),this.reduce(m),m},Montgomery.prototype.reduce=function montReduce(h){for(;h.t<=this.mt2;)h[h.t++]=0;for(var m=0;m<this.m.t;++m){var y=32767&h[m],v=y*this.mpl+((y*this.mph+(h[m]>>15)*this.mpl&this.um)<<15)&h.DM;for(h[y=m+this.m.t]+=this.m.am(0,v,h,m,0,this.m.t);h[y]>=h.DV;)h[y]-=h.DV,h[++y]++}h.clamp(),h.drShiftTo(this.m.t,h),h.compareTo(this.m)>=0&&h.subTo(this.m,h)},Montgomery.prototype.mulTo=function montMulTo(h,m,y){h.multiplyTo(m,y),this.reduce(y)},Montgomery.prototype.sqrTo=function montSqrTo(h,m){h.squareTo(m),this.reduce(m)},NullExp.prototype.convert=nNop,NullExp.prototype.revert=nNop,NullExp.prototype.mulTo=function nMulTo(h,m,y){h.multiplyTo(m,y)},NullExp.prototype.sqrTo=function nSqrTo(h,m){h.squareTo(m)},Barrett.prototype.convert=function barrettConvert(h){if(h.s<0||h.t>2*this.m.t)return h.mod(this.m);if(h.compareTo(this.m)<0)return h;var m=nbi();return h.copyTo(m),this.reduce(m),m},Barrett.prototype.revert=function barrettRevert(h){return h},Barrett.prototype.reduce=function barrettReduce(h){for(h.drShiftTo(this.m.t-1,this.r2),h.t>this.m.t+1&&(h.t=this.m.t+1,h.clamp()),this.mu.multiplyUpperTo(this.r2,this.m.t+1,this.q3),this.m.multiplyLowerTo(this.q3,this.m.t+1,this.r2);h.compareTo(this.r2)<0;)h.dAddOffset(1,this.m.t+1);for(h.subTo(this.r2,h);h.compareTo(this.m)>=0;)h.subTo(this.m,h)},Barrett.prototype.mulTo=function barrettMulTo(h,m,y){h.multiplyTo(m,y),this.reduce(y)},Barrett.prototype.sqrTo=function barrettSqrTo(h,m){h.squareTo(m),this.reduce(m)};var P=[2,3,5,7,11,13,17,19,23,29,31,37,41,43,47,53,59,61,67,71,73,79,83,89,97,101,103,107,109,113,127,131,137,139,149,151,157,163,167,173,179,181,191,193,197,199,211,223,227,229,233,239,241,251,257,263,269,271,277,281,283,293,307,311,313,317,331,337,347,349,353,359,367,373,379,383,389,397,401,409,419,421,431,433,439,443,449,457,461,463,467,479,487,491,499,503,509,521,523,541,547,557,563,569,571,577,587,593,599,601,607,613,617,619,631,641,643,647,653,659,661,673,677,683,691,701,709,719,727,733,739,743,751,757,761,769,773,787,797,809,811,821,823,827,829,839,853,857,859,863,877,881,883,887,907,911,919,929,937,941,947,953,967,971,977,983,991,997],k=(1<<26)/P[P.length-1];BigInteger.prototype.copyTo=function bnpCopyTo(h){for(var m=this.t-1;m>=0;--m)h[m]=this[m];h.t=this.t,h.s=this.s},BigInteger.prototype.fromInt=function bnpFromInt(h){this.t=1,this.s=h<0?-1:0,h>0?this[0]=h:h<-1?this[0]=h+DV:this.t=0},BigInteger.prototype.fromString=function bnpFromString(h,m,y){var v;switch(m){case 2:v=1;break;case 4:v=2;break;case 8:v=3;break;case 16:v=4;break;case 32:v=5;break;case 256:v=8;break;default:return void this.fromRadix(h,m)}this.t=0,this.s=0;for(var C=h.length,T=!1,w=0;--C>=0;){var A=8==v?255&h[C]:intAt(h,C);A<0?"-"==h.charAt(C)&&(T=!0):(T=!1,0===w?this[this.t++]=A:w+v>this.DB?(this[this.t-1]|=(A&(1<<this.DB-w)-1)<<w,this[this.t++]=A>>this.DB-w):this[this.t-1]|=A<<w,(w+=v)>=this.DB&&(w-=this.DB))}y||8!=v||0==(128&h[0])||(this.s=-1,w>0&&(this[this.t-1]|=(1<<this.DB-w)-1<<w)),this.clamp(),T&&BigInteger.ZERO.subTo(this,this)},BigInteger.prototype.fromByteArray=function bnpFromByteArray(h,m){this.fromString(h,256,m)},BigInteger.prototype.fromBuffer=function bnpFromBuffer(h){this.fromString(h,256,!0)},BigInteger.prototype.clamp=function bnpClamp(){for(var h=this.s&this.DM;this.t>0&&this[this.t-1]==h;)--this.t},BigInteger.prototype.dlShiftTo=function bnpDLShiftTo(h,m){var y;for(y=this.t-1;y>=0;--y)m[y+h]=this[y];for(y=h-1;y>=0;--y)m[y]=0;m.t=this.t+h,m.s=this.s},BigInteger.prototype.drShiftTo=function bnpDRShiftTo(h,m){for(var y=h;y<this.t;++y)m[y-h]=this[y];m.t=Math.max(this.t-h,0),m.s=this.s},BigInteger.prototype.lShiftTo=function bnpLShiftTo(h,m){var y,v=h%this.DB,C=this.DB-v,T=(1<<C)-1,w=Math.floor(h/this.DB),A=this.s<<v&this.DM;for(y=this.t-1;y>=0;--y)m[y+w+1]=this[y]>>C|A,A=(this[y]&T)<<v;for(y=w-1;y>=0;--y)m[y]=0;m[w]=A,m.t=this.t+w+1,m.s=this.s,m.clamp()},BigInteger.prototype.rShiftTo=function bnpRShiftTo(h,m){m.s=this.s;var y=Math.floor(h/this.DB);if(y>=this.t)m.t=0;else{var v=h%this.DB,C=this.DB-v,T=(1<<v)-1;m[0]=this[y]>>v;for(var w=y+1;w<this.t;++w)m[w-y-1]|=(this[w]&T)<<C,m[w-y]=this[w]>>v;v>0&&(m[this.t-y-1]|=(this.s&T)<<C),m.t=this.t-y,m.clamp()}},BigInteger.prototype.subTo=function bnpSubTo(h,m){for(var y=0,v=0,C=Math.min(h.t,this.t);y<C;)v+=this[y]-h[y],m[y++]=v&this.DM,v>>=this.DB;if(h.t<this.t){for(v-=h.s;y<this.t;)v+=this[y],m[y++]=v&this.DM,v>>=this.DB;v+=this.s}else{for(v+=this.s;y<h.t;)v-=h[y],m[y++]=v&this.DM,v>>=this.DB;v-=h.s}m.s=v<0?-1:0,v<-1?m[y++]=this.DV+v:v>0&&(m[y++]=v),m.t=y,m.clamp()},BigInteger.prototype.multiplyTo=function bnpMultiplyTo(h,m){var y=this.abs(),v=h.abs(),C=y.t;for(m.t=C+v.t;--C>=0;)m[C]=0;for(C=0;C<v.t;++C)m[C+y.t]=y.am(0,v[C],m,C,0,y.t);m.s=0,m.clamp(),this.s!=h.s&&BigInteger.ZERO.subTo(m,m)},BigInteger.prototype.squareTo=function bnpSquareTo(h){for(var m=this.abs(),y=h.t=2*m.t;--y>=0;)h[y]=0;for(y=0;y<m.t-1;++y){var v=m.am(y,m[y],h,2*y,0,1);(h[y+m.t]+=m.am(y+1,2*m[y],h,2*y+1,v,m.t-y-1))>=m.DV&&(h[y+m.t]-=m.DV,h[y+m.t+1]=1)}h.t>0&&(h[h.t-1]+=m.am(y,m[y],h,2*y,0,1)),h.s=0,h.clamp()},BigInteger.prototype.divRemTo=function bnpDivRemTo(h,m,y){var v=h.abs();if(!(v.t<=0)){var C=this.abs();if(C.t<v.t)return null!=m&&m.fromInt(0),void(null!=y&&this.copyTo(y));null==y&&(y=nbi());var T=nbi(),w=this.s,A=h.s,P=this.DB-nbits(v[v.t-1]);P>0?(v.lShiftTo(P,T),C.lShiftTo(P,y)):(v.copyTo(T),C.copyTo(y));var k=T.t,R=T[k-1];if(0!==R){var M=R*(1<<this.F1)+(k>1?T[k-2]>>this.F2:0),N=this.FV/M,D=(1<<this.F1)/M,I=1<<this.F2,x=y.t,O=x-k,L=null==m?nbi():m;for(T.dlShiftTo(O,L),y.compareTo(L)>=0&&(y[y.t++]=1,y.subTo(L,y)),BigInteger.ONE.dlShiftTo(k,L),L.subTo(T,T);T.t<k;)T[T.t++]=0;for(;--O>=0;){var U=y[--x]==R?this.DM:Math.floor(y[x]*N+(y[x-1]+I)*D);if((y[x]+=T.am(0,U,y,O,0,k))<U)for(T.dlShiftTo(O,L),y.subTo(L,y);y[x]<--U;)y.subTo(L,y)}null!=m&&(y.drShiftTo(k,m),w!=A&&BigInteger.ZERO.subTo(m,m)),y.t=k,y.clamp(),P>0&&y.rShiftTo(P,y),w<0&&BigInteger.ZERO.subTo(y,y)}}},BigInteger.prototype.invDigit=function bnpInvDigit(){if(this.t<1)return 0;var h=this[0];if(0==(1&h))return 0;var m=3&h;return(m=(m=(m=(m=m*(2-(15&h)*m)&15)*(2-(255&h)*m)&255)*(2-((65535&h)*m&65535))&65535)*(2-h*m%this.DV)%this.DV)>0?this.DV-m:-m},BigInteger.prototype.isEven=function bnpIsEven(){return 0===(this.t>0?1&this[0]:this.s)},BigInteger.prototype.exp=function bnpExp(h,m){if(h>4294967295||h<1)return BigInteger.ONE;var y=nbi(),v=nbi(),C=m.convert(this),T=nbits(h)-1;for(C.copyTo(y);--T>=0;)if(m.sqrTo(y,v),(h&1<<T)>0)m.mulTo(v,C,y);else{var w=y;y=v,v=w}return m.revert(y)},BigInteger.prototype.chunkSize=function bnpChunkSize(h){return Math.floor(Math.LN2*this.DB/Math.log(h))},BigInteger.prototype.toRadix=function bnpToRadix(h){if(null==h&&(h=10),0===this.signum()||h<2||h>36)return"0";var m=this.chunkSize(h),y=Math.pow(h,m),v=nbv(y),C=nbi(),T=nbi(),w="";for(this.divRemTo(v,C,T);C.signum()>0;)w=(y+T.intValue()).toString(h).substr(1)+w,C.divRemTo(v,C,T);return T.intValue().toString(h)+w},BigInteger.prototype.fromRadix=function bnpFromRadix(h,m){this.fromInt(0),null==m&&(m=10);for(var y=this.chunkSize(m),v=Math.pow(m,y),C=!1,T=0,w=0,A=0;A<h.length;++A){var P=intAt(h,A);P<0?"-"==h.charAt(A)&&0===this.signum()&&(C=!0):(w=m*w+P,++T>=y&&(this.dMultiply(v),this.dAddOffset(w,0),T=0,w=0))}T>0&&(this.dMultiply(Math.pow(m,T)),this.dAddOffset(w,0)),C&&BigInteger.ZERO.subTo(this,this)},BigInteger.prototype.fromNumber=function bnpFromNumber(h,m){if("number"==typeof m)if(h<2)this.fromInt(1);else for(this.fromNumber(h),this.testBit(h-1)||this.bitwiseTo(BigInteger.ONE.shiftLeft(h-1),op_or,this),this.isEven()&&this.dAddOffset(1,0);!this.isProbablePrime(m);)this.dAddOffset(2,0),this.bitLength()>h&&this.subTo(BigInteger.ONE.shiftLeft(h-1),this);else{var y=v.randomBytes(1+(h>>3)),C=7&h;C>0?y[0]&=(1<<C)-1:y[0]=0,this.fromByteArray(y)}},BigInteger.prototype.bitwiseTo=function bnpBitwiseTo(h,m,y){var v,C,T=Math.min(h.t,this.t);for(v=0;v<T;++v)y[v]=m(this[v],h[v]);if(h.t<this.t){for(C=h.s&this.DM,v=T;v<this.t;++v)y[v]=m(this[v],C);y.t=this.t}else{for(C=this.s&this.DM,v=T;v<h.t;++v)y[v]=m(C,h[v]);y.t=h.t}y.s=m(this.s,h.s),y.clamp()},BigInteger.prototype.changeBit=function bnpChangeBit(h,m){var y=BigInteger.ONE.shiftLeft(h);return this.bitwiseTo(y,m,y),y},BigInteger.prototype.addTo=function bnpAddTo(h,m){for(var y=0,v=0,C=Math.min(h.t,this.t);y<C;)v+=this[y]+h[y],m[y++]=v&this.DM,v>>=this.DB;if(h.t<this.t){for(v+=h.s;y<this.t;)v+=this[y],m[y++]=v&this.DM,v>>=this.DB;v+=this.s}else{for(v+=this.s;y<h.t;)v+=h[y],m[y++]=v&this.DM,v>>=this.DB;v+=h.s}m.s=v<0?-1:0,v>0?m[y++]=v:v<-1&&(m[y++]=this.DV+v),m.t=y,m.clamp()},BigInteger.prototype.dMultiply=function bnpDMultiply(h){this[this.t]=this.am(0,h-1,this,0,0,this.t),++this.t,this.clamp()},BigInteger.prototype.dAddOffset=function bnpDAddOffset(h,m){if(0!==h){for(;this.t<=m;)this[this.t++]=0;for(this[m]+=h;this[m]>=this.DV;)this[m]-=this.DV,++m>=this.t&&(this[this.t++]=0),++this[m]}},BigInteger.prototype.multiplyLowerTo=function bnpMultiplyLowerTo(h,m,y){var v,C=Math.min(this.t+h.t,m);for(y.s=0,y.t=C;C>0;)y[--C]=0;for(v=y.t-this.t;C<v;++C)y[C+this.t]=this.am(0,h[C],y,C,0,this.t);for(v=Math.min(h.t,m);C<v;++C)this.am(0,h[C],y,C,0,m-C);y.clamp()},BigInteger.prototype.multiplyUpperTo=function bnpMultiplyUpperTo(h,m,y){--m;var v=y.t=this.t+h.t-m;for(y.s=0;--v>=0;)y[v]=0;for(v=Math.max(m-this.t,0);v<h.t;++v)y[this.t+v-m]=this.am(m-v,h[v],y,0,0,this.t+v-m);y.clamp(),y.drShiftTo(1,y)},BigInteger.prototype.modInt=function bnpModInt(h){if(h<=0)return 0;var m=this.DV%h,y=this.s<0?h-1:0;if(this.t>0)if(0===m)y=this[0]%h;else for(var v=this.t-1;v>=0;--v)y=(m*y+this[v])%h;return y},BigInteger.prototype.millerRabin=function bnpMillerRabin(h){var m=this.subtract(BigInteger.ONE),y=m.getLowestSetBit();if(y<=0)return!1;var v=m.shiftRight(y);(h=h+1>>1)>P.length&&(h=P.length);for(var C=nbi(),T=0;T<h;++T){C.fromInt(P[Math.floor(Math.random()*P.length)]);var w=C.modPow(v,this);if(0!=w.compareTo(BigInteger.ONE)&&0!=w.compareTo(m)){for(var A=1;A++<y&&0!=w.compareTo(m);)if(0===(w=w.modPowInt(2,this)).compareTo(BigInteger.ONE))return!1;if(0!=w.compareTo(m))return!1}}return!0},BigInteger.prototype.toString=function bnToString(h){if(this.s<0)return"-"+this.negate().toString(h);var m;if(16==h)m=4;else if(8==h)m=3;else if(2==h)m=1;else if(32==h)m=5;else{if(4!=h)return this.toRadix(h);m=2}var y,v=(1<<m)-1,C=!1,T="",w=this.t,A=this.DB-w*this.DB%m;if(w-- >0)for(A<this.DB&&(y=this[w]>>A)>0&&(C=!0,T=int2char(y));w>=0;)A<m?(y=(this[w]&(1<<A)-1)<<m-A,y|=this[--w]>>(A+=this.DB-m)):(y=this[w]>>(A-=m)&v,A<=0&&(A+=this.DB,--w)),y>0&&(C=!0),C&&(T+=int2char(y));return C?T:"0"},BigInteger.prototype.negate=function bnNegate(){var h=nbi();return BigInteger.ZERO.subTo(this,h),h},BigInteger.prototype.abs=function bnAbs(){return this.s<0?this.negate():this},BigInteger.prototype.compareTo=function bnCompareTo(h){var m=this.s-h.s;if(0!=m)return m;var y=this.t;if(0!=(m=y-h.t))return this.s<0?-m:m;for(;--y>=0;)if(0!=(m=this[y]-h[y]))return m;return 0},BigInteger.prototype.bitLength=function bnBitLength(){return this.t<=0?0:this.DB*(this.t-1)+nbits(this[this.t-1]^this.s&this.DM)},BigInteger.prototype.mod=function bnMod(h){var m=nbi();return this.abs().divRemTo(h,null,m),this.s<0&&m.compareTo(BigInteger.ZERO)>0&&h.subTo(m,m),m},BigInteger.prototype.modPowInt=function bnModPowInt(h,m){var y;return y=h<256||m.isEven()?new Classic(m):new Montgomery(m),this.exp(h,y)},BigInteger.prototype.clone=function bnClone(){var h=nbi();return this.copyTo(h),h},BigInteger.prototype.intValue=function bnIntValue(){if(this.s<0){if(1==this.t)return this[0]-this.DV;if(0===this.t)return-1}else{if(1==this.t)return this[0];if(0===this.t)return 0}return(this[1]&(1<<32-this.DB)-1)<<this.DB|this[0]},BigInteger.prototype.byteValue=function bnByteValue(){return 0==this.t?this.s:this[0]<<24>>24},BigInteger.prototype.shortValue=function bnShortValue(){return 0==this.t?this.s:this[0]<<16>>16},BigInteger.prototype.signum=function bnSigNum(){return this.s<0?-1:this.t<=0||1==this.t&&this[0]<=0?0:1},BigInteger.prototype.toByteArray=function bnToByteArray(){var h=this.t,m=new Array;m[0]=this.s;var y,v=this.DB-h*this.DB%8,C=0;if(h-- >0)for(v<this.DB&&(y=this[h]>>v)!=(this.s&this.DM)>>v&&(m[C++]=y|this.s<<this.DB-v);h>=0;)v<8?(y=(this[h]&(1<<v)-1)<<8-v,y|=this[--h]>>(v+=this.DB-8)):(y=this[h]>>(v-=8)&255,v<=0&&(v+=this.DB,--h)),0!=(128&y)&&(y|=-256),0===C&&(128&this.s)!=(128&y)&&++C,(C>0||y!=this.s)&&(m[C++]=y);return m},BigInteger.prototype.toBuffer=function bnToBuffer(h){var m=Buffer.from(this.toByteArray());if(!0===h&&0===m[0])m=m.slice(1);else if(C.isNumber(h)){if(m.length>h){for(var y=0;y<m.length-h;y++)if(0!==m[y])return null;return m.slice(m.length-h)}if(m.length<h){var v=Buffer.alloc(h);return v.fill(0,0,h-m.length),m.copy(v,h-m.length),v}}return m},BigInteger.prototype.equals=function bnEquals(h){return 0==this.compareTo(h)},BigInteger.prototype.min=function bnMin(h){return this.compareTo(h)<0?this:h},BigInteger.prototype.max=function bnMax(h){return this.compareTo(h)>0?this:h},BigInteger.prototype.and=function bnAnd(h){var m=nbi();return this.bitwiseTo(h,op_and,m),m},BigInteger.prototype.or=function bnOr(h){var m=nbi();return this.bitwiseTo(h,op_or,m),m},BigInteger.prototype.xor=function bnXor(h){var m=nbi();return this.bitwiseTo(h,op_xor,m),m},BigInteger.prototype.andNot=function bnAndNot(h){var m=nbi();return this.bitwiseTo(h,op_andnot,m),m},BigInteger.prototype.not=function bnNot(){for(var h=nbi(),m=0;m<this.t;++m)h[m]=this.DM&~this[m];return h.t=this.t,h.s=~this.s,h},BigInteger.prototype.shiftLeft=function bnShiftLeft(h){var m=nbi();return h<0?this.rShiftTo(-h,m):this.lShiftTo(h,m),m},BigInteger.prototype.shiftRight=function bnShiftRight(h){var m=nbi();return h<0?this.lShiftTo(-h,m):this.rShiftTo(h,m),m},BigInteger.prototype.getLowestSetBit=function bnGetLowestSetBit(){for(var h=0;h<this.t;++h)if(0!=this[h])return h*this.DB+lbit(this[h]);return this.s<0?this.t*this.DB:-1},BigInteger.prototype.bitCount=function bnBitCount(){for(var h=0,m=this.s&this.DM,y=0;y<this.t;++y)h+=cbit(this[y]^m);return h},BigInteger.prototype.testBit=function bnTestBit(h){var m=Math.floor(h/this.DB);return m>=this.t?0!=this.s:0!=(this[m]&1<<h%this.DB)},BigInteger.prototype.setBit=function bnSetBit(h){return this.changeBit(h,op_or)},BigInteger.prototype.clearBit=function bnClearBit(h){return this.changeBit(h,op_andnot)},BigInteger.prototype.flipBit=function bnFlipBit(h){return this.changeBit(h,op_xor)},BigInteger.prototype.add=function bnAdd(h){var m=nbi();return this.addTo(h,m),m},BigInteger.prototype.subtract=function bnSubtract(h){var m=nbi();return this.subTo(h,m),m},BigInteger.prototype.multiply=function bnMultiply(h){var m=nbi();return this.multiplyTo(h,m),m},BigInteger.prototype.divide=function bnDivide(h){var m=nbi();return this.divRemTo(h,m,null),m},BigInteger.prototype.remainder=function bnRemainder(h){var m=nbi();return this.divRemTo(h,null,m),m},BigInteger.prototype.divideAndRemainder=function bnDivideAndRemainder(h){var m=nbi(),y=nbi();return this.divRemTo(h,m,y),new Array(m,y)},BigInteger.prototype.modPow=function bnModPow(h,m){var y,v,C=h.bitLength(),T=nbv(1);if(C<=0)return T;y=C<18?1:C<48?3:C<144?4:C<768?5:6,v=C<8?new Classic(m):m.isEven()?new Barrett(m):new Montgomery(m);var w=new Array,A=3,P=y-1,k=(1<<y)-1;if(w[1]=v.convert(this),y>1){var R=nbi();for(v.sqrTo(w[1],R);A<=k;)w[A]=nbi(),v.mulTo(R,w[A-2],w[A]),A+=2}var M,N,D=h.t-1,I=!0,x=nbi();for(C=nbits(h[D])-1;D>=0;){for(C>=P?M=h[D]>>C-P&k:(M=(h[D]&(1<<C+1)-1)<<P-C,D>0&&(M|=h[D-1]>>this.DB+C-P)),A=y;0==(1&M);)M>>=1,--A;if((C-=A)<0&&(C+=this.DB,--D),I)w[M].copyTo(T),I=!1;else{for(;A>1;)v.sqrTo(T,x),v.sqrTo(x,T),A-=2;A>0?v.sqrTo(T,x):(N=T,T=x,x=N),v.mulTo(x,w[M],T)}for(;D>=0&&0==(h[D]&1<<C);)v.sqrTo(T,x),N=T,T=x,x=N,--C<0&&(C=this.DB-1,--D)}return v.revert(T)},BigInteger.prototype.modInverse=function bnModInverse(h){var m=h.isEven();if(this.isEven()&&m||0===h.signum())return BigInteger.ZERO;for(var y=h.clone(),v=this.clone(),C=nbv(1),T=nbv(0),w=nbv(0),A=nbv(1);0!=y.signum();){for(;y.isEven();)y.rShiftTo(1,y),m?(C.isEven()&&T.isEven()||(C.addTo(this,C),T.subTo(h,T)),C.rShiftTo(1,C)):T.isEven()||T.subTo(h,T),T.rShiftTo(1,T);for(;v.isEven();)v.rShiftTo(1,v),m?(w.isEven()&&A.isEven()||(w.addTo(this,w),A.subTo(h,A)),w.rShiftTo(1,w)):A.isEven()||A.subTo(h,A),A.rShiftTo(1,A);y.compareTo(v)>=0?(y.subTo(v,y),m&&C.subTo(w,C),T.subTo(A,T)):(v.subTo(y,v),m&&w.subTo(C,w),A.subTo(T,A))}return 0!=v.compareTo(BigInteger.ONE)?BigInteger.ZERO:A.compareTo(h)>=0?A.subtract(h):A.signum()<0?(A.addTo(h,A),A.signum()<0?A.add(h):A):A},BigInteger.prototype.pow=function bnPow(h){return this.exp(h,new NullExp)},BigInteger.prototype.gcd=function bnGCD(h){var m=this.s<0?this.negate():this.clone(),y=h.s<0?h.negate():h.clone();if(m.compareTo(y)<0){var v=m;m=y,y=v}var C=m.getLowestSetBit(),T=y.getLowestSetBit();if(T<0)return m;for(C<T&&(T=C),T>0&&(m.rShiftTo(T,m),y.rShiftTo(T,y));m.signum()>0;)(C=m.getLowestSetBit())>0&&m.rShiftTo(C,m),(C=y.getLowestSetBit())>0&&y.rShiftTo(C,y),m.compareTo(y)>=0?(m.subTo(y,m),m.rShiftTo(1,m)):(y.subTo(m,y),y.rShiftTo(1,y));return T>0&&y.lShiftTo(T,y),y},BigInteger.prototype.isProbablePrime=function bnIsProbablePrime(h){var m,y=this.abs();if(1==y.t&&y[0]<=P[P.length-1]){for(m=0;m<P.length;++m)if(y[0]==P[m])return!0;return!1}if(y.isEven())return!1;for(m=1;m<P.length;){for(var v=P[m],C=m+1;C<P.length&&v<k;)v*=P[C++];for(v=y.modInt(v);m<C;)if(v%P[m++]==0)return!1}return y.millerRabin(h)},BigInteger.int2char=int2char,BigInteger.ZERO=nbv(0),BigInteger.ONE=nbv(1),BigInteger.prototype.square=function bnSquare(){var h=nbi();return this.squareTo(h),h},h.exports=BigInteger},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0}),m.SshSession=void 0;const v=y(48),C=y(9),T=y(6),w=y(125),A=y(255),P=y(444),k=y(1078),R=y(441),M=y(100),N=y(130),D=y(258),I=y(257),x=y(76),O=y(446),L=y(55),U=y(447),B=y(77),W=y(448),q=y(256),Y=y(98),V=y(78),$=y(49),z=y(129);class SshSession{constructor(h,m){if(this.config=h,this.remoteVersion=null,this.activatedServices=new Map,this.connectionService=null,this.requestHandler=null,this.blockedMessages=[],this.blockedMessagesSemaphore=new z.Semaphore(1),this.connected=!1,this.disposed=!1,this.metrics=new U.SessionMetrics,this.reconnecting=!1,this.sessionId=null,this.principalValue=null,this.authenticatingEmitter=new T.Emitter,this.onAuthenticating=this.authenticatingEmitter.event,this.closedEmitter=new T.Emitter,this.onClosed=this.closedEmitter.event,this.disconnectedEmitter=new T.Emitter,this.onDisconnected=this.disconnectedEmitter.event,this.serviceActivatedEmitter=new T.Emitter,this.onServiceActivated=this.serviceActivatedEmitter.event,this.channelOpeningEmitter=new T.Emitter,this.onChannelOpening=this.channelOpeningEmitter.event,this.requestEmitter=new T.Emitter,this.onRequest=this.requestEmitter.event,!h)throw new TypeError("Session configuration is required.");if(h.keyExchangeAlgorithms.find(h=>!!h))this.kexService=new R.KeyExchangeService(this,null!=m&&m);else{if(h.encryptionAlgorithms.length>0&&h.encryptionAlgorithms.indexOf(null)<0)throw new Error("Encryption requires a key-exchange algorithm to be configured.");if(h.hmacAlgorithms.length>0&&h.hmacAlgorithms.indexOf(null)<0)throw new Error("HMAC requires a key-exchange algorithm to be configured.");if(h.publicKeyAlgorithms.length>0&&h.publicKeyAlgorithms.indexOf(null)<0)throw new Error("Host authentication requires a key-exchange algorithm to be configured.");this.kexService=null}}get algorithms(){return this.protocol?this.protocol.algorithms:null}get principal(){return this.principalValue}set principal(h){this.principalValue=h}get isConnected(){return this.connected}get isClosed(){return this.disposed}get services(){return[...this.activatedServices.values()]}get channels(){var h,m;return null!==(m=null===(h=this.connectionService)||void 0===h?void 0:h.channels)&&void 0!==m?m:[]}get protocolExtensions(){var h;return(null===(h=this.protocol)||void 0===h?void 0:h.extensions)||null}getService(h){const m=this.activatedServices.get(h);return m||null}activateService(h){let m;if("function"==typeof h)m=h;else{let y=h;if(m=(0,M.findService)(this.config.services,h=>h.serviceRequest===y),!m)return null}let y=this.activatedServices.get(m);if(!y){if(!this.config.services.has(m))throw new Error(`Service type not configured: ${m.name}`);y=new m(this,this.config.services.get(m)),m===N.ConnectionService&&(this.connectionService=y),this.activatedServices.set(m,y),this.serviceActivatedEmitter.fire(y)}return y}async connect(h,m){if(!h)throw new TypeError("A session stream is required.");if(this.disposed)throw new $.ObjectDisposedError(this);this.connectPromise||(this.connectPromise=this.doConnect(h,m)),await this.connectPromise}async doConnect(h,m){(0,v.trace)(`${this} ${this.reconnecting?"re":""}connecting...`),this.protocol=new k.SshProtocol(h,this.config,this.metrics),this.protocol.kexService=this.kexService,await this.exchangeVersions(m),this.kexService?await this.encrypt(m):(await(0,V.withCancellation)(this.versionExchangePromise,m),this.connected=!0),this.processMessages().catch(h=>{(0,v.trace)(`Unhandled error processing messages: ${h.message||JSON.stringify(h)}`)})}async exchangeVersions(h){const m=this.protocol.writeProtocolVersion(SshSession.localVersion.toString(),h),y=this.protocol.readProtocolVersion(h);this.versionExchangePromise=y.then(async h=>{let m;(0,v.trace)(`Local version: ${SshSession.localVersion}, remote version: ${h}`);const y=P.SshVersionInfo.tryParse(h);if(y){if(this.remoteVersion=y,"2.0"===y.protocolVersion)return;m=`Remote SSH version ${this.remoteVersion} is not supported. `+"This library only supports SSH v2.0."}else m=`Could not parse remote SSH version ${h}`;await this.close(L.SshDisconnectReason.protocolVersionNotSupported,m,new Error(m))}),await m}async encrypt(h){var m,y;const C=this.protocol;if(!C)throw new $.ObjectDisposedError(this);await C.considerReExchange(!0,h),await(0,V.withCancellation)(this.versionExchangePromise,h),this.connected=!0;let T=null;for(;!(this.isClosed||(null===(m=this.protocol)||void 0===m?void 0:m.algorithms)||T instanceof L.DisconnectMessage)&&(T=await C.receiveMessage(h),T);)await this.dispatchMessage(T,h);if(!(null===(y=this.protocol)||void 0===y?void 0:y.algorithms))throw new $.SshConnectionError("Session closed while encrypting.",L.SshDisconnectReason.connectionLost);this.protocol.algorithms.cipher&&(0,v.trace)(`${this} encrypted.`)}async processMessages(){var h;for(this.connected=!0;!this.disposed;){const m=this.protocol;if(!m)break;let y=null;try{y=await m.receiveMessage()}catch(m){if(!(m instanceof Error))throw m;let y=L.SshDisconnectReason.protocolError;m instanceof $.SshConnectionError?y=null!==(h=m.reason)&&void 0!==h?h:y:(0,v.trace)(`Error receiving message: ${m.message||JSON.stringify(m)}`),await this.close(y,m.message,m)}if(!y){await this.close(L.SshDisconnectReason.connectionLost,"Connection lost.");break}try{await this.dispatchMessage(y)}catch(h){if(!(h instanceof Error))throw h;(0,v.trace)(`Error handling ${y}: ${h.message||JSON.stringify(h)}`),await this.close(L.SshDisconnectReason.protocolError,h.message,h)}}this.connected=!1}get canAcceptRequests(){var h;return!(this.kexService&&(!(null===(h=this.protocol)||void 0===h?void 0:h.algorithms)||this.protocol.algorithms.cipher&&!this.principal))}async sendMessage(h,m){var y,C;if(!h)throw new TypeError("Message expected.");if(m&&m.isCancellationRequested)throw new V.CancellationError;const T=this.protocol;if(!T||this.disposed)throw new $.ObjectDisposedError(this);if(this.kexService&&this.kexService.exchanging&&h.messageType>4&&(h.messageType<20||h.messageType>49))return void this.blockedMessages.push(h);let A;await this.blockedMessagesSemaphore.wait(m);try{A=await T.sendMessage(h,m),this.blockedMessagesSemaphore.release()}catch(m){if(this.blockedMessagesSemaphore.release(),m instanceof $.SshConnectionError){if(m.reason===L.SshDisconnectReason.connectionLost&&(null===(y=this.protocolExtensions)||void 0===y?void 0:y.has(w.SshProtocolExtensionNames.sessionReconnect)))return}if(!(m instanceof Error))throw m;throw(0,v.trace)(`Error sending ${h}: ${m.message||JSON.stringify(m)}`),m}if(!A&&!(null===(C=this.protocolExtensions)||void 0===C?void 0:C.has(w.SshProtocolExtensionNames.sessionReconnect)))throw new $.SshConnectionError("Session disconnected.",L.SshDisconnectReason.connectionLost)}dispatchMessage(h,m){var y;return h instanceof x.ConnectionMessage&&this.connectionService?this.connectionService.handleMessage(h,m):h instanceof I.NewKeysMessage?this.handleNewKeysMessage(h,m):h instanceof I.KeyExchangeMessage?this.handleKeyExchangeMessage(h,m):h instanceof O.AuthenticationMessage?null===(y=this.getService(D.AuthenticationService))||void 0===y?void 0:y.handleMessage(h,m):h instanceof L.ServiceRequestMessage?this.handleServiceRequestMessage(h,m):h instanceof L.ServiceAcceptMessage?this.handleServiceAcceptMessage(h,m):h instanceof L.SessionRequestMessage?this.handleRequestMessage(h,m):h instanceof L.SessionRequestSuccessMessage?this.handleRequestSuccessMessage(h):h instanceof L.SessionRequestFailureMessage?this.handleRequestFailureMessage(h):h instanceof L.ExtensionInfoMessage?this.handleExtensionInfoMessage(h,m):h instanceof L.UnimplementedMessage?this.handleUnimplementedMessage(h,m):h instanceof L.DebugMessage?this.handleDebugMessage(h):void 0}async handleRequestMessage(h,m){var y;let C=!1;if("initial-channel-request@microsoft.com"===h.requestType&&this.config.protocolExtensions.includes(w.SshProtocolExtensionNames.openChannelRequest)){const y=h.convertTo(new L.SessionChannelRequestMessage),v=y.senderChannel,T=this.channels.find(h=>h.remoteChannelId===v);T&&y.request&&(y.request.wantReply=!1,C=await T.handleRequest(y.request,m))}else if("enable-session-reconnect@microsoft.com"===h.requestType&&(null===(y=this.config.protocolExtensions)||void 0===y?void 0:y.includes(w.SshProtocolExtensionNames.sessionReconnect)))this.protocol.incomingMessagesHaveReconnectInfo||(this.protocol.incomingMessagesHaveReconnectInfo=!0,this.protocol.incomingMessagesHaveLatencyInfo=this.protocol.extensions.has(w.SshProtocolExtensionNames.sessionLatency),C=!0);else if(this.canAcceptRequests){const y=new q.SshRequestEventArgs(h.requestType||"",h,this.principal),v=(0,M.findService)(this.config.services,m=>m.sessionRequest===h.requestType);if(v){const h=this.activateService(v);return void await h.onSessionRequest(y,m)}this.raiseSessionRequest(y),C=y.isAuthorized||!1}else(0,v.trace)("Session request blocked because the session is not yet authenticated."),C=!1;h.wantReply&&await this.sendMessage(C?new L.SessionRequestSuccessMessage:new L.SessionRequestFailureMessage,m)}raiseSessionRequest(h){this.requestEmitter.fire(h)}async handleServiceRequestMessage(h,m){}async handleServiceAcceptMessage(h,m){}async handleKeyExchangeMessage(h,m){if(!this.kexService){if(!(h instanceof I.KeyExchangeInitMessage&&this.protocol))return void await this.close(L.SshDisconnectReason.keyExchangeFailed);this.kexService=this.activateService(R.KeyExchangeService),this.protocol.kexService=this.kexService,await this.protocol.considerReExchange(!0,m)}return this.kexService.handleMessage(h,m)}async handleNewKeysMessage(h,m){try{await this.blockedMessagesSemaphore.wait(m),await this.protocol.handleNewKeys(m);try{for(;this.blockedMessages.length>0;){const h=this.blockedMessages.shift();if(!this.protocol)throw new $.ObjectDisposedError(this);await this.protocol.sendMessage(h,m)}}catch(h){if(!(h instanceof Error))throw h;await this.close(L.SshDisconnectReason.protocolError,void 0,h)}}finally{this.blockedMessagesSemaphore.release()}}async handleUnimplementedMessage(h,m){void 0!==h.unimplementedMessageType&&await this.sendMessage(h,m)}handleDebugMessage(h){h.message&&(0,v.trace)(h.message)}async raiseAuthenticatingEvent(h){(0,v.trace)(`${this} Authenticating(${h})`),this.authenticatingEmitter.fire(h);let m=h.authenticationPromise;return m||(m=Promise.resolve(null)),await m}async request(h,m){if(!h)throw new TypeError("Request is required.");if(!h.wantReply)return await this.sendMessage(h,m),!0;return await this.requestResponse(h,L.SessionRequestSuccessMessage,L.SessionRequestFailureMessage,m)instanceof L.SessionRequestSuccessMessage}async requestResponse(h,m,y,v){if(!h)throw new TypeError("Request is required.");if(!m)throw new TypeError("Success response type is required.");if(!y)throw new TypeError("Failure response type is required.");if(this.requestHandler)throw new Error("Another request is already pending.");h.wantReply=!0;const C=new B.PromiseCompletionSource;if(v){if(v.isCancellationRequested)throw new V.CancellationError;v.onCancellationRequested(()=>{this.requestHandler=null,C.reject(new V.CancellationError)})}return this.requestHandler=(h,v)=>{var T,w;if(this.requestHandler=null,h)C.reject(h);else if(v instanceof L.SessionRequestFailureMessage){const h=null!==(T=null==v?void 0:v.convertTo(new y,!0))&&void 0!==T?T:null;C.resolve(h)}else if(v instanceof L.SessionRequestSuccessMessage){const h=null!==(w=null==v?void 0:v.convertTo(new m,!0))&&void 0!==w?w:null;C.resolve(h)}else C.reject(new Error("Unknown response message type."))},await this.sendMessage(h,v),await C.promise}handleRequestSuccessMessage(h){this.requestHandler&&this.requestHandler(void 0,h)}handleRequestFailureMessage(h){this.requestHandler&&this.requestHandler(void 0,h)}async acceptChannel(h,m){const y="string"==typeof h?h:void 0;m||"object"!=typeof h||(m=h),this.activateService(N.ConnectionService);const v=this.connectionService.acceptChannel(y||A.SshChannel.sessionChannelType,m);return await v}async openChannel(h,m,y){let v;if("string"==typeof h||null===h?(v=new x.ChannelOpenMessage,v.channelType=null!=h?h:A.SshChannel.sessionChannelType):h instanceof x.ChannelOpenMessage?v=h:(v=new x.ChannelOpenMessage,v.channelType=A.SshChannel.sessionChannelType,y=h),m instanceof x.ChannelRequestMessage)return await this.openChannelWithInitialRequest(v,m,y);y||null===m||(y=m),this.activateService(N.ConnectionService);const C=new B.PromiseCompletionSource;return await this.connectionService.openChannel(v,C,y),await C.promise}async openChannelWithInitialRequest(h,m,y){var v;this.activateService(N.ConnectionService);const C=new B.PromiseCompletionSource,T=await this.connectionService.openChannel(h,C,y);if(y){if(y.isCancellationRequested)throw new V.CancellationError;y.onCancellationRequested(()=>C.reject(new V.CancellationError))}let A,P;const k=this.config.protocolExtensions.includes(w.SshProtocolExtensionNames.openChannelRequest)&&(null===(v=this.protocolExtensions)||void 0===v?void 0:v.has(w.SshProtocolExtensionNames.openChannelRequest));if(!1===k)A=await C.promise,P=await A.request(m,y);else{const h=m.wantReply||void 0===k,v=new L.SessionChannelRequestMessage;v.requestType="initial-channel-request@microsoft.com",v.senderChannel=T,v.request=m,v.wantReply=h;const w=this.request(v,y);A=await C.promise,h?(P=await w,P||void 0!==k||(P=await A.request(m))):P=!0}if(!P)throw await A.close(),new Error("The initial channel request was denied.");return A}async handleChannelOpening(h,m){const y=(0,M.findService)(this.config.services,m=>m.channelType===h.channel.channelType&&!m.channelRequest);if(y){const v=this.activateService(y);await v.onChannelOpening(h,m)}else this.raiseChannelOpening(h)}raiseChannelOpening(h){this.channelOpeningEmitter.fire(h)}async sendExtensionInfo(h){const m=new L.ExtensionInfoMessage;m.extensionInfo={};for(let h of this.config.protocolExtensions)if(h===w.SshProtocolExtensionNames.serverSignatureAlgorithms){const y=Array.from(new Set((0,Y.algorithmNames)(this.config.publicKeyAlgorithms))).join(",");m.extensionInfo[h]=y}else m.extensionInfo[h]="";await this.sendMessage(m,h)}async handleExtensionInfoMessage(h,m){if(!this.protocol)return;if(this.protocol.extensions=new Map,h.extensionInfo){for(let m of this.config.protocolExtensions){const y=h.extensionInfo[m];"string"==typeof y&&this.protocol.extensions.set(m,y)}this.protocol.extensions.has(w.SshProtocolExtensionNames.sessionReconnect)&&await this.enableReconnect(m)}}async close(h,m,y){var C,T,w;if(!this.disposed&&this.connected){if(this.connected=!1,(0,v.trace)(`${this} Close(${L.SshDisconnectReason[h]}, "${m||""}")`),h!==L.SshDisconnectReason.connectionLost)try{const y=new L.DisconnectMessage;y.reasonCode=h,y.description=m||"",await(null===(C=this.protocol)||void 0===C?void 0:C.sendMessage(y))}catch(h){}else if(this.handleDisconnected())return null===(T=this.protocol)||void 0===T||T.dispose(),(0,v.trace)(`${this} disconnected.`),void this.disconnectedEmitter.fire();this.disposed=!0,y&&(null===(w=this.connectionService)||void 0===w||w.close(y)),this.closedEmitter.fire(new W.SshSessionClosedEventArgs(h,m||"Disconnected.",y||null)),this.dispose()}}handleDisconnected(){var h,m;return this.connectPromise=void 0,null===(h=this.kexService)||void 0===h||h.abortKeyExchange(),!!(null===(m=this.protocolExtensions)||void 0===m?void 0:m.has(w.SshProtocolExtensionNames.sessionReconnect))}dispose(){var h,m;this.disposed||((0,v.trace)(`${this} disposed.`),this.disposed=!0,this.closedEmitter.fire(new W.SshSessionClosedEventArgs(L.SshDisconnectReason.none,"SshSession disposed",null))),this.requestHandler&&this.requestHandler(new $.SshConnectionError("Connection closed.")),this.metrics.close(),null===(h=this.connectionService)||void 0===h||h.dispose();for(let h of this.activatedServices.values())h!==this.connectionService&&h.dispose();this.activatedServices.clear(),null===(m=this.protocol)||void 0===m||m.dispose(),this.protocol=void 0}async enableReconnect(h){var m;try{if(await this.blockedMessagesSemaphore.wait(),null===(m=this.kexService)||void 0===m?void 0:m.exchanging)(0,v.trace)("Failed to initialize session reconnect because a key-exchange was in-progress.");else{const m=new L.SessionRequestMessage("enable-session-reconnect@microsoft.com",!1);await this.protocol.sendMessage(m,h),this.protocol&&(this.protocol.outgoingMessagesHaveReconnectInfo=!0,this.protocol.outgoingMessagesHaveLatencyInfo=this.protocol.extensions.has(w.SshProtocolExtensionNames.sessionLatency))}this.blockedMessagesSemaphore.release()}catch(h){throw this.blockedMessagesSemaphore.release(),h instanceof Error&&await this.close(L.SshDisconnectReason.protocolError,void 0,h),h}}async createReconnectToken(h,m){return await this.algorithms.signer.sign(C.Buffer.concat([h,m]))}async verifyReconnectToken(h,m,y){return await this.algorithms.verifier.verify(C.Buffer.concat([h,m]),y)}toString(){return this.constructor.name}}m.SshSession=SshSession,SshSession.localVersion=P.SshVersionInfo.getLocalVersion()},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0}),m.Semaphore=void 0;const v=y(77),C=y(78),T=y(49);m.Semaphore=class Semaphore{constructor(h=0){this.completions=[],this.disposed=!1,this.count=h}get currentCount(){return this.count}release(h=1){if(this.disposed)throw new T.ObjectDisposedError(this);const m=this.count;for(;h>0;h--)if(this.completions.length>0){this.completions.shift().resolve(!0)}else this.count++;return m}tryRelease(){try{this.release()}catch(h){if(!(h instanceof T.ObjectDisposedError))throw h}}async wait(h,m){const y="number"==typeof h?h:void 0;if(void 0===m&&"object"==typeof h&&(m=h),this.disposed)throw new T.ObjectDisposedError(this);if(null==m?void 0:m.isCancellationRequested)throw new C.CancellationError;if(this.count>0)return this.count--,!0;if(0===y)return!1;{const h=new v.PromiseCompletionSource;this.completions.push(h);const T=[h.promise];if(y&&T.push(new Promise(h=>setTimeout(()=>h(!1),y))),m){const h=new v.PromiseCompletionSource;m.onCancellationRequested(()=>{h.reject(new C.CancellationError)}),T.push(h.promise)}if(await Promise.race(T))return!0;{const m=this.completions.indexOf(h);return m>=0&&this.completions.splice(m,1),!1}}}dispose(){if(!this.disposed){this.disposed=!0;for(let h of this.completions)h.reject(new T.ObjectDisposedError(this));this.completions.splice(0,this.completions.length),this.count=0}}}},function(h,m,y){"use strict";var v,C=this&&this.__decorate||function(h,m,y,v){var C,T=arguments.length,w=T<3?m:null===v?v=Object.getOwnPropertyDescriptor(m,y):v;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)w=Reflect.decorate(h,m,y,v);else for(var A=h.length-1;A>=0;A--)(C=h[A])&&(w=(T<3?C(w):T>3?C(m,y,w):C(m,y))||w);return T>3&&w&&Object.defineProperty(m,y,w),w};Object.defineProperty(m,"__esModule",{value:!0}),m.ConnectionService=void 0;const T=y(48),w=y(177),A=y(76),P=y(77),k=y(255),R=y(78),M=y(49),N=y(445),D=y(100);let I=v=class ConnectionService extends w.SshService{constructor(h){super(h),this.channelCounter=0,this.channelMap=new Map,this.nonAcceptedChannels=new Map,this.pendingChannels=new Map,this.pendingAcceptChannels=new Map}get channels(){return Array.from(this.channelMap.values())}close(h){for(let m of this.channelMap.values())m.close(h)}dispose(){const h=[...this.channelMap.values()];let m=[...this.pendingChannels.values()].map(h=>h.completionSource);this.pendingAcceptChannels.size>0&&(m=m.concat([...this.pendingAcceptChannels.values()].reduce((h,m)=>h.concat(m))));for(let m of h)m.dispose();for(let h of m)h.reject(new M.SshConnectionError("Session closed."));super.dispose()}async acceptChannel(h,m){const y=new P.PromiseCompletionSource;let v;if(m){if(m.isCancellationRequested)throw new R.CancellationError;v=m.onCancellationRequested(()=>{const m=this.pendingAcceptChannels.get(h);if(m){const h=m.findIndex(h=>Object.is(h,y));h>=0&&m.splice(h,1)}y.reject(new R.CancellationError)})}let C=null;if(C=Array.from(this.nonAcceptedChannels.values()).find(m=>m.channelType===h)||null,C)this.nonAcceptedChannels.delete(C.channelId);else{let m=this.pendingAcceptChannels.get(h);m||(m=[],this.pendingAcceptChannels.set(h,m)),m.push(y)}try{return C||await y.promise}finally{v&&v.dispose()}}async openChannel(h,m,y){const v=++this.channelCounter;h.senderChannel=v;let C=null;if(y){if(y.isCancellationRequested)throw new R.CancellationError;C=y.onCancellationRequested(()=>{this.pendingChannels.delete(v)&&m.reject(new R.CancellationError)})}return this.pendingChannels.set(v,{openMessage:h,completionSource:m,cancellationRegistration:C}),await this.session.sendMessage(h),v}handleMessage(h,m){if(h instanceof A.ChannelDataMessage)return this.handleDataMessage(h);if(h instanceof A.ChannelWindowAdjustMessage)return this.handleAdjustWindowMessage(h);if(h instanceof A.ChannelEofMessage)return this.handleEofMessage(h);if(h instanceof A.ChannelOpenMessage)return this.handleOpenMessage(h,m);if(h instanceof A.ChannelCloseMessage)return this.handleCloseMessage(h);if(h instanceof A.ChannelOpenConfirmationMessage)return this.handleOpenConfirmationMessage(h,m);if(h instanceof A.ChannelOpenFailureMessage)return this.handleOpenFailureMessage(h);if(h instanceof A.ChannelRequestMessage)return this.handleRequestMessage(h,m);if(h instanceof A.ChannelSuccessMessage)return this.handleSuccessMessage(h);if(h instanceof A.ChannelFailureMessage)return this.handleFailureMessage(h);throw new Error(`Message not implemented: ${h}`)}async handleOpenMessage(h,m){if(!this.session.canAcceptRequests){(0,T.trace)("Channel open request blocked because the session is not yet authenticated.");const y=new A.ChannelOpenFailureMessage;return y.recipientChannel=h.senderChannel,y.reasonCode=A.SshChannelOpenFailureReason.administrativelyProhibited,y.description="Authenticate before opening channels.",void await this.session.sendMessage(y,m)}if(!h.channelType){const y=new A.ChannelOpenFailureMessage;return y.recipientChannel=h.senderChannel,y.reasonCode=A.SshChannelOpenFailureReason.unknownChannelType,y.description="Channel type not specified.",void await this.session.sendMessage(y,m)}const y=new k.SshChannel(this,h.channelType,h.senderChannel,h.initialWindowSize,h.maximumPacketSize,++this.channelCounter),v=new N.SshChannelOpeningEventArgs(h,y,!0);try{await this.session.handleChannelOpening(v,m)}catch(h){throw y.dispose(),h}if(v.failureReason!==A.SshChannelOpenFailureReason.none){const h=new A.ChannelOpenFailureMessage;h.recipientChannel=y.remoteChannelId,h.reasonCode=v.failureReason,h.description=v.failureDescription||void 0;try{await this.session.sendMessage(h,m)}finally{y.dispose()}return}if(this.session.isClosed)return void y.dispose();this.channelMap.set(y.channelId,y);const C=new A.ChannelOpenConfirmationMessage;C.recipientChannel=y.remoteChannelId,C.senderChannel=y.channelId,C.initialWindowSize=h.initialWindowSize,C.maximumPacketSize=h.maximumPacketSize,await this.session.sendMessage(C,m);let w=!1;const P=this.pendingAcceptChannels.get(y.channelType);for(;P&&P.length>0;){P.shift().resolve(y),w=!0;break}w||this.nonAcceptedChannels.set(y.channelId,y),this.onChannelOpenCompleted(y.channelId,y),y.enableSending()}handleCloseMessage(h){const m=this.findChannelById(h.recipientChannel);m&&m.handleClose()}async handleOpenConfirmationMessage(h,m){var y;let v,C=null;const T=this.pendingChannels.get(h.recipientChannel);if(!T)throw this.channelMap.has(h.recipientChannel)?new Error("Duplicate channel ID."):new Error("Channel confirmation was not requested.");v=T.openMessage,C=T.completionSource,T.cancellationRegistration&&T.cancellationRegistration.dispose(),this.pendingChannels.delete(h.recipientChannel);const w=new k.SshChannel(this,v.channelType||k.SshChannel.sessionChannelType,h.senderChannel,h.initialWindowSize,h.maximumPacketSize,h.recipientChannel);this.channelMap.set(w.channelId,w);const P=new N.SshChannelOpeningEventArgs(v,w,!1);if(await this.session.handleChannelOpening(P,m),C){if(P.failureReason!==A.SshChannelOpenFailureReason.none)return void C.reject(new M.SshChannelError(null!==(y=P.failureDescription)&&void 0!==y?y:"Channel open failure.",P.failureReason));C.resolve(w)}else this.onChannelOpenCompleted(w.channelId,w);w.enableSending()}handleOpenFailureMessage(h){let m=null;const y=this.pendingChannels.get(h.recipientChannel);y&&(m=y.completionSource,y.cancellationRegistration&&y.cancellationRegistration.dispose(),this.pendingChannels.delete(h.recipientChannel)),null!=m?m.reject(new M.SshChannelError(h.description||"Channel open rejected.",h.reasonCode)):this.onChannelOpenCompleted(h.recipientChannel,null)}async handleRequestMessage(h,m){const y=this.findChannelById(h.recipientChannel);y?await y.handleRequest(h,m):(0,T.trace)(`Invalid channel ID ${h.recipientChannel} in channel request message.`)}handleSuccessMessage(h){const m=this.findChannelById(h.recipientChannel);m?m.handleResponse(!0):(0,T.trace)(`Invalid channel ID ${h.recipientChannel} in channel success message.`)}handleFailureMessage(h){const m=this.findChannelById(h.recipientChannel);m?m.handleResponse(!1):(0,T.trace)(`Invalid channel ID ${h.recipientChannel} in channel failure message.`)}handleDataMessage(h){const m=this.findChannelById(h.recipientChannel);if(m)return m.handleDataReceived(h.data)}handleAdjustWindowMessage(h){const m=this.findChannelById(h.recipientChannel);m&&m.adjustRemoteWindow(h.bytesToAdd)}handleEofMessage(h){const m=this.findChannelById(h.recipientChannel);m&&m.handleEof()}onChannelOpenCompleted(h,m){m?(0,T.trace)(`${this.session} ChannelOpenCompleted(${m})`):(0,T.trace)(`${this.session} ChannelOpenCompleted(${h} failed)`)}findChannelById(h){var m;return null!==(m=this.channelMap.get(h))&&void 0!==m?m:null}_removeChannel(h){this.channelMap.delete(h.channelId),this.pendingChannels.delete(h.channelId)}};I.serviceName="ssh-connection",I=v=C([(0,D.serviceActivation)({serviceRequest:v.serviceName})],I),m.ConnectionService=I},function(h,m,y){"use strict";var v=this&&this.__awaiter||function(h,m,y,v){return new(y||(y=Promise))((function(C,T){function fulfilled(h){try{step(v.next(h))}catch(h){T(h)}}function rejected(h){try{step(v.throw(h))}catch(h){T(h)}}function step(h){h.done?C(h.value):function adopt(h){return h instanceof y?h:new y((function(m){m(h)}))}(h.value).then(fulfilled,rejected)}step((v=v.apply(h,m||[])).next())}))};Object.defineProperty(m,"__esModule",{value:!0});const C=y(0),T=y(24);m.TreeDataProviderBase=class TreeDataProviderBase{constructor(h,m){this.id=h,this.supportedContext=m,this.isChildItemCacheDisabled=!1,this.changeEventEmitter=new C.EventEmitter,this.onDidChangeTreeData=this.changeEventEmitter.event}static getThemeIconPath(h){return{dark:T.ExtensionUtil.getExtensionUri(`images/dark/${h}.svg`),light:T.ExtensionUtil.getExtensionUri(`images/light/${h}.svg`)}}refresh(h){this.changeEventEmitter.fire(h)}getTreeItem(h){return h}getChildren(h){return v(this,void 0,void 0,(function*(){if(h)return this.items&&!this.isChildItemCacheDisabled||(this.items=yield this.getChildrenItems(h)),this.items;const m=yield this.getRootItem();return m?[m]:[]}))}refreshItems(){this.items=void 0}forceRefreshItems(){this.refreshItems(),this.refresh()}}},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0});const v=y(70),C=y(426),T=y(34);m.errorNotificationCommandDecorator=function errorNotificationCommandDecorator(h,m,y=!1,w,A){return T.DecoratorHelper.setupDecorator(P=>new C.ErrorNotificationCommandDecorator(T.DecoratorHelper.getCoreCommand(P),P,v.dependencies.telemetry(),m,h,y,w,A))}},function(h,m,y){"use strict";var v=this&&this.__awaiter||function(h,m,y,v){return new(y||(y=Promise))((function(C,T){function fulfilled(h){try{step(v.next(h))}catch(h){T(h)}}function rejected(h){try{step(v.throw(h))}catch(h){T(h)}}function step(h){h.done?C(h.value):function adopt(h){return h instanceof y?h:new y((function(m){m(h)}))}(h.value).then(fulfilled,rejected)}step((v=v.apply(h,m||[])).next())}))};Object.defineProperty(m,"__esModule",{value:!0});const C=y(2),T=y(6),w=y(265),A=y(134),P=y(467),k=y(65),R=y(266);class Connection extends C.DisposableClass{constructor(h,m,y={}){super(h),this.traceName=h,this.performance=m,this.options=y,this.isDisconnectedFlag=!1,this.isDisposingRef=!1,this.onConnectionChangedEventEmitter=new T.Emitter,this.connectionStatus="none",this.previousConnectionStatus="none",this.addToDisposables(this.onConnectionChangedEventEmitter)}get isDisconnected(){return this.isDisconnectedFlag}getId(h){throw new k.ConnectionError("Not implemented.")}get onConnectionChanged(){if(this.isDisposed)throw new P.ConnectionStateError("Cannot listen to `onConnectionChanged`, connection already disposed.");return this.onConnectionChangedEventEmitter.event}get isDisposing(){return this.isDisposingRef}get status(){return this.connectionStatus}get previousStatus(){return this.previousConnectionStatus}connect(){var h,m;return v(this,void 0,void 0,(function*(){try{return this.trace.info("asked to connect"),(null===(h=this.connectionSignal)||void 0===h?void 0:h.isCancelled)||(null===(m=this.connectionSignal)||void 0===m?void 0:m.isRejected)?yield this.connectionSignal.promise:(C.assert("disconnected"!==this.status,new P.ConnectionStateError("Connection already disconnected, please create a new one.")),C.assert(!this.isDisposed,new P.ConnectionStateError("Connection is already disposed, please create a new one.")),this.connectionSignal?(this.trace.info(`return promise, resolved: ${this.connectionSignal.isResolved}`),yield this.connectionSignal.promise):(this.trace.info("creating new connection"),yield this.createConnection()))}catch(h){throw this.handleConnectionError(h),A.errorToConnectionError(h)}}))}disconnect(h){this.isDisconnectedFlag=!0,this.dispose(h)}dispose(h){this.isDisposingRef=!0,this.isDisposed||(this.onConnectionChangedHandler("disconnected",new w.ConnectionCancellationError("Disposing the connection.")),super.dispose(h))}connectWithTimeout(h){return v(this,void 0,void 0,(function*(){try{return this.trace.info(`asked to connect with timeout of ${h} ms`),isFinite(h)?yield C.timeoutPromise(this.connect(),h,new R.ConnectionTimeoutError(`Could not establish connection in ${h}ms.`)):yield this.connect()}catch(h){throw this.handleConnectionError(h),A.errorToConnectionError(h)}}))}onConnectionChangedHandler(h,m){if(h===this.connectionStatus)return;this.trace.info(`connection status changed: ${this.connectionStatus} -> ${h}, error:`,m),this.previousConnectionStatus=this.connectionStatus,this.connectionStatus=h;const y={status:h,previousStatus:this.previousConnectionStatus};this.trace.info("firing change event: ",y),this.onConnectionChangedEventEmitter.fire(y),C.assertDefined(this.connectionSignal,"No `connectionSignal` found."),this.connectionSignal.isFulfilled||("connected"===h&&(this.trace.info(" connected"),this.connectionSignal.resolve(this)),"disconnected"===h&&(this.trace.info("disconnected"),this.connectionSignal.reject(A.errorToConnectionError(null!=m?m:new k.ConnectionError("Connection failed.")))))}initializeConnection(){return this.trace.info("creating connection"),this.connectionSignal=new C.Signal,this.connectionSignal.promise.catch(h=>{this.trace.verbose(`signal rejected reason -> ${C.propertiesToString(h)}`)}),this.addToDisposables(this.connectionSignal),this.onConnectionChangedHandler("connecting"),this}createConnection(){return v(this,void 0,void 0,(function*(){throw this.initializeConnection(),C.assertDefined(this.connectionSignal,new k.ConnectionError("No `connectionSignal` found.")),yield this.connectionSignal.promise,new k.ConnectionError("Not implemented.")}))}handleConnectionError(h){var m;this.trace.error("connection failed: ",h),this.onConnectionChangedHandler("disconnected",h),null===(m=this.connectionSignal)||void 0===m||m.reject(A.errorToConnectionError(h)),this.dispose()}}m.Connection=Connection},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0});const v=y(2),C=y(265),T=y(65);m.errorToConnectionError=h=>h instanceof T.ConnectionError?h:h instanceof v.CancellationError?new C.ConnectionCancellationError(h):new T.ConnectionError(h)},function(h,m,y){"use strict";var v=this&&this.__importStar||function(h){if(h&&h.__esModule)return h;var m={};if(null!=h)for(var y in h)Object.hasOwnProperty.call(h,y)&&(m[y]=h[y]);return m.default=h,m};Object.defineProperty(m,"__esModule",{value:!0});var C=y(485);m.Performance=C.Performance,m.initializePerformanceInstance=C.initializePerformanceInstance,m.getOrCreatePerformance=C.getOrCreatePerformance;var T=y(1182);m.logPerformanceWaterfall=T.logPerformanceWaterfall,m.mocks=v(y(1186))},function(h,m){function objectToString(h){return Object.prototype.toString.call(h)}m.isArray=function isArray(h){return Array.isArray?Array.isArray(h):"[object Array]"===objectToString(h)},m.isBoolean=function isBoolean(h){return"boolean"==typeof h},m.isNull=function isNull(h){return null===h},m.isNullOrUndefined=function isNullOrUndefined(h){return null==h},m.isNumber=function isNumber(h){return"number"==typeof h},m.isString=function isString(h){return"string"==typeof h},m.isSymbol=function isSymbol(h){return"symbol"==typeof h},m.isUndefined=function isUndefined(h){return void 0===h},m.isRegExp=function isRegExp(h){return"[object RegExp]"===objectToString(h)},m.isObject=function isObject(h){return"object"==typeof h&&null!==h},m.isDate=function isDate(h){return"[object Date]"===objectToString(h)},m.isError=function isError(h){return"[object Error]"===objectToString(h)||h instanceof Error},m.isFunction=function isFunction(h){return"function"==typeof h},m.isPrimitive=function isPrimitive(h){return null===h||"boolean"==typeof h||"number"==typeof h||"string"==typeof h||"symbol"==typeof h||void 0===h},m.isBuffer=Buffer.isBuffer},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0}),m.SshSessionConfiguration=m.SshProtocolExtensionNames=void 0;const v=y(107),C=y(514),T=y(141),w=y(286);var A;!function(h){h.serverSignatureAlgorithms="server-sig-algs",h.openChannelRequest="open-channel-request@microsoft.com",h.sessionReconnect="session-reconnect@microsoft.com",h.sessionLatency="session-latency@microsoft.com"}(A=m.SshProtocolExtensionNames||(m.SshProtocolExtensionNames={}));m.SshSessionConfiguration=class SshSessionConfiguration{constructor(h=!0){this.protocolExtensions=[],this.services=new Map,this.keyExchangeAlgorithms=[],this.publicKeyAlgorithms=[],this.encryptionAlgorithms=[],this.hmacAlgorithms=[],this.compressionAlgorithms=[],this.maxClientAuthenticationAttempts=5,this.enableKeyExchangeGuess=!1,this.keyRotationThreshold=536870912,this.protocolExtensions.push(A.serverSignatureAlgorithms),this.protocolExtensions.push(A.openChannelRequest),this.services.set(C.KeyExchangeService,null),this.services.set(T.ConnectionService,null),this.services.set(w.AuthenticationService,null),h?(this.keyExchangeAlgorithms.push(v.SshAlgorithms.keyExchange.ecdhNistp384Sha384),this.keyExchangeAlgorithms.push(v.SshAlgorithms.keyExchange.ecdhNistp256Sha256),this.keyExchangeAlgorithms.push(v.SshAlgorithms.keyExchange.dhGroup16Sha512),this.keyExchangeAlgorithms.push(v.SshAlgorithms.keyExchange.dhGroup14Sha256),this.publicKeyAlgorithms.push(v.SshAlgorithms.publicKey.rsaWithSha512),this.publicKeyAlgorithms.push(v.SshAlgorithms.publicKey.rsaWithSha256),this.publicKeyAlgorithms.push(v.SshAlgorithms.publicKey.ecdsaSha2Nistp384),this.publicKeyAlgorithms.push(v.SshAlgorithms.publicKey.ecdsaSha2Nistp256),this.encryptionAlgorithms.push(v.SshAlgorithms.encryption.aes256Gcm),this.encryptionAlgorithms.push(v.SshAlgorithms.encryption.aes256Ctr),this.hmacAlgorithms.push(v.SshAlgorithms.hmac.hmacSha512Etm),this.hmacAlgorithms.push(v.SshAlgorithms.hmac.hmacSha256Etm),this.hmacAlgorithms.push(v.SshAlgorithms.hmac.hmacSha512),this.hmacAlgorithms.push(v.SshAlgorithms.hmac.hmacSha256)):(this.keyExchangeAlgorithms.push(v.SshAlgorithms.keyExchange.none),this.publicKeyAlgorithms.push(v.SshAlgorithms.publicKey.none),this.encryptionAlgorithms.push(v.SshAlgorithms.encryption.none),this.hmacAlgorithms.push(v.SshAlgorithms.hmac.none)),this.compressionAlgorithms.push(v.SshAlgorithms.compression.none)}addService(h,m){if(this.services.has(h))throw new Error("Duplicate service entry.");this.services.set(h,m)}getKeyExchangeAlgorithm(h){return this.getAlgorithm(h,this.keyExchangeAlgorithms)}getPublicKeyAlgorithm(h){return this.getAlgorithm(h,this.publicKeyAlgorithms)}getEncryptionAlgorithm(h){return this.getAlgorithm(h,this.encryptionAlgorithms)}getHmacAlgorithm(h){return this.getAlgorithm(h,this.hmacAlgorithms)}getCompressionAlgorithm(h){return this.getAlgorithm(h,this.compressionAlgorithms)}getAlgorithm(h,m){const y=m.find(m=>!!m&&m.name===h);if(!y){if("none"===h)return null;throw new Error("Algorithm not found: "+h)}return y}}},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0}),m.PublicKeyAlgorithm=void 0;const v=y(9),C=y(40);m.PublicKeyAlgorithm=class PublicKeyAlgorithm{constructor(h,m,y){this.name=h,this.keyAlgorithmName=m,this.hashAlgorithmName=y}readSignatureData(h){const m=new C.SshDataReader(h),y=m.readString("ascii");if(y!==this.name)throw new Error("Mismatched public key algorithm: "+`got '${y}', expected '${this.name}'.`);return m.readBinary()}createSignatureData(h){const m=new C.SshDataWriter(v.Buffer.alloc(this.name.length+h.length+20));return m.writeString(this.name,"ascii"),m.writeBinary(h),m.toBuffer()}}},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0}),m.SshSession=void 0;const v=y(50),C=y(9),T=y(6),w=y(137),A=y(283),P=y(517),k=y(1219),R=y(514),M=y(108),N=y(141),D=y(286),I=y(285),x=y(81),O=y(519),L=y(57),U=y(520),B=y(82),W=y(521),q=y(284),Y=y(107),V=y(83),$=y(51),z=y(140);class SshSession{constructor(h,m){if(this.config=h,this.remoteVersion=null,this.activatedServices=new Map,this.connectionService=null,this.requestHandler=null,this.blockedMessages=[],this.blockedMessagesSemaphore=new z.Semaphore(1),this.connected=!1,this.disposed=!1,this.metrics=new U.SessionMetrics,this.reconnecting=!1,this.sessionId=null,this.principalValue=null,this.authenticatingEmitter=new T.Emitter,this.onAuthenticating=this.authenticatingEmitter.event,this.closedEmitter=new T.Emitter,this.onClosed=this.closedEmitter.event,this.disconnectedEmitter=new T.Emitter,this.onDisconnected=this.disconnectedEmitter.event,this.serviceActivatedEmitter=new T.Emitter,this.onServiceActivated=this.serviceActivatedEmitter.event,this.channelOpeningEmitter=new T.Emitter,this.onChannelOpening=this.channelOpeningEmitter.event,this.requestEmitter=new T.Emitter,this.onRequest=this.requestEmitter.event,!h)throw new TypeError("Session configuration is required.");if(h.keyExchangeAlgorithms.find(h=>!!h))this.kexService=new R.KeyExchangeService(this,null!=m&&m);else{if(h.encryptionAlgorithms.length>0&&h.encryptionAlgorithms.indexOf(null)<0)throw new Error("Encryption requires a key-exchange algorithm to be configured.");if(h.hmacAlgorithms.length>0&&h.hmacAlgorithms.indexOf(null)<0)throw new Error("HMAC requires a key-exchange algorithm to be configured.");if(h.publicKeyAlgorithms.length>0&&h.publicKeyAlgorithms.indexOf(null)<0)throw new Error("Host authentication requires a key-exchange algorithm to be configured.");this.kexService=null}}get algorithms(){return this.protocol?this.protocol.algorithms:null}get principal(){return this.principalValue}set principal(h){this.principalValue=h}get isConnected(){return this.connected}get isClosed(){return this.disposed}get services(){return[...this.activatedServices.values()]}get channels(){var h,m;return null!==(m=null===(h=this.connectionService)||void 0===h?void 0:h.channels)&&void 0!==m?m:[]}get protocolExtensions(){var h;return(null===(h=this.protocol)||void 0===h?void 0:h.extensions)||null}getService(h){const m=this.activatedServices.get(h);return m||null}activateService(h){let m;if("function"==typeof h)m=h;else{let y=h;if(m=(0,M.findService)(this.config.services,h=>h.serviceRequest===y),!m)return null}let y=this.activatedServices.get(m);if(!y){if(!this.config.services.has(m))throw new Error(`Service type not configured: ${m.name}`);y=new m(this,this.config.services.get(m)),m===N.ConnectionService&&(this.connectionService=y),this.activatedServices.set(m,y),this.serviceActivatedEmitter.fire(y)}return y}async connect(h,m){if(!h)throw new TypeError("A session stream is required.");if(this.disposed)throw new $.ObjectDisposedError(this);this.connectPromise||(this.connectPromise=this.doConnect(h,m)),await this.connectPromise}async doConnect(h,m){(0,v.trace)(`${this} ${this.reconnecting?"re":""}connecting...`),this.protocol=new k.SshProtocol(h,this.config,this.metrics),this.protocol.kexService=this.kexService,await this.exchangeVersions(m),this.kexService?await this.encrypt(m):(await(0,V.withCancellation)(this.versionExchangePromise,m),this.connected=!0),this.processMessages().catch(h=>{(0,v.trace)(`Unhandled error processing messages: ${h.message||JSON.stringify(h)}`)})}async exchangeVersions(h){const m=this.protocol.writeProtocolVersion(SshSession.localVersion.toString(),h),y=this.protocol.readProtocolVersion(h);this.versionExchangePromise=y.then(async h=>{let m;(0,v.trace)(`Local version: ${SshSession.localVersion}, remote version: ${h}`);const y=P.SshVersionInfo.tryParse(h);if(y){if(this.remoteVersion=y,"2.0"===y.protocolVersion)return;m=`Remote SSH version ${this.remoteVersion} is not supported. `+"This library only supports SSH v2.0."}else m=`Could not parse remote SSH version ${h}`;await this.close(L.SshDisconnectReason.protocolVersionNotSupported,m,new Error(m))}),await m}async encrypt(h){var m,y;const C=this.protocol;if(!C)throw new $.ObjectDisposedError(this);await C.considerReExchange(!0,h),await(0,V.withCancellation)(this.versionExchangePromise,h),this.connected=!0;let T=null;for(;!(this.isClosed||(null===(m=this.protocol)||void 0===m?void 0:m.algorithms)||T instanceof L.DisconnectMessage)&&(T=await C.receiveMessage(h),T);)await this.dispatchMessage(T,h);if(!(null===(y=this.protocol)||void 0===y?void 0:y.algorithms))throw new $.SshConnectionError("Session closed while encrypting.",L.SshDisconnectReason.connectionLost);this.protocol.algorithms.cipher&&(0,v.trace)(`${this} encrypted.`)}async processMessages(){var h;for(this.connected=!0;!this.disposed;){const m=this.protocol;if(!m)break;let y=null;try{y=await m.receiveMessage()}catch(m){if(!(m instanceof Error))throw m;let y=L.SshDisconnectReason.protocolError;m instanceof $.SshConnectionError?y=null!==(h=m.reason)&&void 0!==h?h:y:(0,v.trace)(`Error receiving message: ${m.message||JSON.stringify(m)}`),await this.close(y,m.message,m)}if(!y){await this.close(L.SshDisconnectReason.connectionLost,"Connection lost.");break}try{await this.dispatchMessage(y)}catch(h){if(!(h instanceof Error))throw h;(0,v.trace)(`Error handling ${y}: ${h.message||JSON.stringify(h)}`),await this.close(L.SshDisconnectReason.protocolError,h.message,h)}}this.connected=!1}get canAcceptRequests(){var h;return!(this.kexService&&(!(null===(h=this.protocol)||void 0===h?void 0:h.algorithms)||this.protocol.algorithms.cipher&&!this.principal))}async sendMessage(h,m){var y,C;if(!h)throw new TypeError("Message expected.");if(m&&m.isCancellationRequested)throw new V.CancellationError;const T=this.protocol;if(!T||this.disposed)throw new $.ObjectDisposedError(this);if(this.kexService&&this.kexService.exchanging&&h.messageType>4&&(h.messageType<20||h.messageType>49))return void this.blockedMessages.push(h);let A;await this.blockedMessagesSemaphore.wait(m);try{A=await T.sendMessage(h,m),this.blockedMessagesSemaphore.release()}catch(m){if(this.blockedMessagesSemaphore.release(),m instanceof $.SshConnectionError){if(m.reason===L.SshDisconnectReason.connectionLost&&(null===(y=this.protocolExtensions)||void 0===y?void 0:y.has(w.SshProtocolExtensionNames.sessionReconnect)))return}if(!(m instanceof Error))throw m;throw(0,v.trace)(`Error sending ${h}: ${m.message||JSON.stringify(m)}`),m}if(!A&&!(null===(C=this.protocolExtensions)||void 0===C?void 0:C.has(w.SshProtocolExtensionNames.sessionReconnect)))throw new $.SshConnectionError("Session disconnected.",L.SshDisconnectReason.connectionLost)}dispatchMessage(h,m){var y;return h instanceof x.ConnectionMessage&&this.connectionService?this.connectionService.handleMessage(h,m):h instanceof I.NewKeysMessage?this.handleNewKeysMessage(h,m):h instanceof I.KeyExchangeMessage?this.handleKeyExchangeMessage(h,m):h instanceof O.AuthenticationMessage?null===(y=this.getService(D.AuthenticationService))||void 0===y?void 0:y.handleMessage(h,m):h instanceof L.ServiceRequestMessage?this.handleServiceRequestMessage(h,m):h instanceof L.ServiceAcceptMessage?this.handleServiceAcceptMessage(h,m):h instanceof L.SessionRequestMessage?this.handleRequestMessage(h,m):h instanceof L.SessionRequestSuccessMessage?this.handleRequestSuccessMessage(h):h instanceof L.SessionRequestFailureMessage?this.handleRequestFailureMessage(h):h instanceof L.ExtensionInfoMessage?this.handleExtensionInfoMessage(h,m):h instanceof L.UnimplementedMessage?this.handleUnimplementedMessage(h,m):h instanceof L.DebugMessage?this.handleDebugMessage(h):void 0}async handleRequestMessage(h,m){var y;let C=!1;if("initial-channel-request@microsoft.com"===h.requestType&&this.config.protocolExtensions.includes(w.SshProtocolExtensionNames.openChannelRequest)){const y=h.convertTo(new L.SessionChannelRequestMessage),v=y.senderChannel,T=this.channels.find(h=>h.remoteChannelId===v);T&&y.request&&(y.request.wantReply=!1,C=await T.handleRequest(y.request,m))}else if("enable-session-reconnect@microsoft.com"===h.requestType&&(null===(y=this.config.protocolExtensions)||void 0===y?void 0:y.includes(w.SshProtocolExtensionNames.sessionReconnect)))this.protocol.incomingMessagesHaveReconnectInfo||(this.protocol.incomingMessagesHaveReconnectInfo=!0,this.protocol.incomingMessagesHaveLatencyInfo=this.protocol.extensions.has(w.SshProtocolExtensionNames.sessionLatency),C=!0);else if(this.canAcceptRequests){const y=new q.SshRequestEventArgs(h.requestType||"",h,this.principal),v=(0,M.findService)(this.config.services,m=>m.sessionRequest===h.requestType);if(v){const h=this.activateService(v);return void await h.onSessionRequest(y,m)}this.raiseSessionRequest(y),C=y.isAuthorized||!1}else(0,v.trace)("Session request blocked because the session is not yet authenticated."),C=!1;h.wantReply&&await this.sendMessage(C?new L.SessionRequestSuccessMessage:new L.SessionRequestFailureMessage,m)}raiseSessionRequest(h){this.requestEmitter.fire(h)}async handleServiceRequestMessage(h,m){}async handleServiceAcceptMessage(h,m){}async handleKeyExchangeMessage(h,m){if(!this.kexService){if(!(h instanceof I.KeyExchangeInitMessage&&this.protocol))return void await this.close(L.SshDisconnectReason.keyExchangeFailed);this.kexService=this.activateService(R.KeyExchangeService),this.protocol.kexService=this.kexService,await this.protocol.considerReExchange(!0,m)}return this.kexService.handleMessage(h,m)}async handleNewKeysMessage(h,m){try{await this.blockedMessagesSemaphore.wait(m),await this.protocol.handleNewKeys(m);try{for(;this.blockedMessages.length>0;){const h=this.blockedMessages.shift();if(!this.protocol)throw new $.ObjectDisposedError(this);await this.protocol.sendMessage(h,m)}}catch(h){if(!(h instanceof Error))throw h;await this.close(L.SshDisconnectReason.protocolError,void 0,h)}}finally{this.blockedMessagesSemaphore.release()}}async handleUnimplementedMessage(h,m){void 0!==h.unimplementedMessageType&&await this.sendMessage(h,m)}handleDebugMessage(h){h.message&&(0,v.trace)(h.message)}async raiseAuthenticatingEvent(h){(0,v.trace)(`${this} Authenticating(${h})`),this.authenticatingEmitter.fire(h);let m=h.authenticationPromise;return m||(m=Promise.resolve(null)),await m}async request(h,m){if(!h)throw new TypeError("Request is required.");if(!h.wantReply)return await this.sendMessage(h,m),!0;return await this.requestResponse(h,L.SessionRequestSuccessMessage,L.SessionRequestFailureMessage,m)instanceof L.SessionRequestSuccessMessage}async requestResponse(h,m,y,v){if(!h)throw new TypeError("Request is required.");if(!m)throw new TypeError("Success response type is required.");if(!y)throw new TypeError("Failure response type is required.");if(this.requestHandler)throw new Error("Another request is already pending.");h.wantReply=!0;const C=new B.PromiseCompletionSource;if(v){if(v.isCancellationRequested)throw new V.CancellationError;v.onCancellationRequested(()=>{this.requestHandler=null,C.reject(new V.CancellationError)})}return this.requestHandler=(h,v)=>{var T,w;if(this.requestHandler=null,h)C.reject(h);else if(v instanceof L.SessionRequestFailureMessage){const h=null!==(T=null==v?void 0:v.convertTo(new y,!0))&&void 0!==T?T:null;C.resolve(h)}else if(v instanceof L.SessionRequestSuccessMessage){const h=null!==(w=null==v?void 0:v.convertTo(new m,!0))&&void 0!==w?w:null;C.resolve(h)}else C.reject(new Error("Unknown response message type."))},await this.sendMessage(h,v),await C.promise}handleRequestSuccessMessage(h){this.requestHandler&&this.requestHandler(void 0,h)}handleRequestFailureMessage(h){this.requestHandler&&this.requestHandler(void 0,h)}async acceptChannel(h,m){const y="string"==typeof h?h:void 0;m||"object"!=typeof h||(m=h),this.activateService(N.ConnectionService);const v=this.connectionService.acceptChannel(y||A.SshChannel.sessionChannelType,m);return await v}async openChannel(h,m,y){let v;if("string"==typeof h||null===h?(v=new x.ChannelOpenMessage,v.channelType=null!=h?h:A.SshChannel.sessionChannelType):h instanceof x.ChannelOpenMessage?v=h:(v=new x.ChannelOpenMessage,v.channelType=A.SshChannel.sessionChannelType,y=h),m instanceof x.ChannelRequestMessage)return await this.openChannelWithInitialRequest(v,m,y);y||null===m||(y=m),this.activateService(N.ConnectionService);const C=new B.PromiseCompletionSource;return await this.connectionService.openChannel(v,C,y),await C.promise}async openChannelWithInitialRequest(h,m,y){var v;this.activateService(N.ConnectionService);const C=new B.PromiseCompletionSource,T=await this.connectionService.openChannel(h,C,y);if(y){if(y.isCancellationRequested)throw new V.CancellationError;y.onCancellationRequested(()=>C.reject(new V.CancellationError))}let A,P;const k=this.config.protocolExtensions.includes(w.SshProtocolExtensionNames.openChannelRequest)&&(null===(v=this.protocolExtensions)||void 0===v?void 0:v.has(w.SshProtocolExtensionNames.openChannelRequest));if(!1===k)A=await C.promise,P=await A.request(m,y);else{const h=m.wantReply||void 0===k,v=new L.SessionChannelRequestMessage;v.requestType="initial-channel-request@microsoft.com",v.senderChannel=T,v.request=m,v.wantReply=h;const w=this.request(v,y);A=await C.promise,h?(P=await w,P||void 0!==k||(P=await A.request(m))):P=!0}if(!P)throw await A.close(),new Error("The initial channel request was denied.");return A}async handleChannelOpening(h,m){const y=(0,M.findService)(this.config.services,m=>m.channelType===h.channel.channelType&&!m.channelRequest);if(y){const v=this.activateService(y);await v.onChannelOpening(h,m)}else this.raiseChannelOpening(h)}raiseChannelOpening(h){this.channelOpeningEmitter.fire(h)}async sendExtensionInfo(h){const m=new L.ExtensionInfoMessage;m.extensionInfo={};for(let h of this.config.protocolExtensions)if(h===w.SshProtocolExtensionNames.serverSignatureAlgorithms){const y=Array.from(new Set((0,Y.algorithmNames)(this.config.publicKeyAlgorithms))).join(",");m.extensionInfo[h]=y}else m.extensionInfo[h]="";await this.sendMessage(m,h)}async handleExtensionInfoMessage(h,m){if(!this.protocol)return;if(this.protocol.extensions=new Map,h.extensionInfo){for(let m of this.config.protocolExtensions){const y=h.extensionInfo[m];"string"==typeof y&&this.protocol.extensions.set(m,y)}this.protocol.extensions.has(w.SshProtocolExtensionNames.sessionReconnect)&&await this.enableReconnect(m)}}async close(h,m,y){var C,T,w;if(!this.disposed&&this.connected){if(this.connected=!1,(0,v.trace)(`${this} Close(${L.SshDisconnectReason[h]}, "${m||""}")`),h!==L.SshDisconnectReason.connectionLost)try{const y=new L.DisconnectMessage;y.reasonCode=h,y.description=m||"",await(null===(C=this.protocol)||void 0===C?void 0:C.sendMessage(y))}catch(h){}else if(this.handleDisconnected())return null===(T=this.protocol)||void 0===T||T.dispose(),(0,v.trace)(`${this} disconnected.`),void this.disconnectedEmitter.fire();this.disposed=!0,y&&(null===(w=this.connectionService)||void 0===w||w.close(y)),this.closedEmitter.fire(new W.SshSessionClosedEventArgs(h,m||"Disconnected.",y||null)),this.dispose()}}handleDisconnected(){var h,m;return this.connectPromise=void 0,null===(h=this.kexService)||void 0===h||h.abortKeyExchange(),!!(null===(m=this.protocolExtensions)||void 0===m?void 0:m.has(w.SshProtocolExtensionNames.sessionReconnect))}dispose(){var h,m;this.disposed||((0,v.trace)(`${this} disposed.`),this.disposed=!0,this.closedEmitter.fire(new W.SshSessionClosedEventArgs(L.SshDisconnectReason.none,"SshSession disposed",null))),this.requestHandler&&this.requestHandler(new $.SshConnectionError("Connection closed.")),this.metrics.close(),null===(h=this.connectionService)||void 0===h||h.dispose();for(let h of this.activatedServices.values())h!==this.connectionService&&h.dispose();this.activatedServices.clear(),null===(m=this.protocol)||void 0===m||m.dispose(),this.protocol=void 0}async enableReconnect(h){var m;try{if(await this.blockedMessagesSemaphore.wait(),null===(m=this.kexService)||void 0===m?void 0:m.exchanging)(0,v.trace)("Failed to initialize session reconnect because a key-exchange was in-progress.");else{const m=new L.SessionRequestMessage("enable-session-reconnect@microsoft.com",!1);await this.protocol.sendMessage(m,h),this.protocol&&(this.protocol.outgoingMessagesHaveReconnectInfo=!0,this.protocol.outgoingMessagesHaveLatencyInfo=this.protocol.extensions.has(w.SshProtocolExtensionNames.sessionLatency))}this.blockedMessagesSemaphore.release()}catch(h){throw this.blockedMessagesSemaphore.release(),h instanceof Error&&await this.close(L.SshDisconnectReason.protocolError,void 0,h),h}}async createReconnectToken(h,m){return await this.algorithms.signer.sign(C.Buffer.concat([h,m]))}async verifyReconnectToken(h,m,y){return await this.algorithms.verifier.verify(C.Buffer.concat([h,m]),y)}toString(){return this.constructor.name}}m.SshSession=SshSession,SshSession.localVersion=P.SshVersionInfo.getLocalVersion()},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0}),m.Semaphore=void 0;const v=y(82),C=y(83),T=y(51);m.Semaphore=class Semaphore{constructor(h=0){this.completions=[],this.disposed=!1,this.count=h}get currentCount(){return this.count}release(h=1){if(this.disposed)throw new T.ObjectDisposedError(this);const m=this.count;for(;h>0;h--)if(this.completions.length>0){this.completions.shift().resolve(!0)}else this.count++;return m}tryRelease(){try{this.release()}catch(h){if(!(h instanceof T.ObjectDisposedError))throw h}}async wait(h,m){const y="number"==typeof h?h:void 0;if(void 0===m&&"object"==typeof h&&(m=h),this.disposed)throw new T.ObjectDisposedError(this);if(null==m?void 0:m.isCancellationRequested)throw new C.CancellationError;if(this.count>0)return this.count--,!0;if(0===y)return!1;{const h=new v.PromiseCompletionSource;this.completions.push(h);const T=[h.promise];if(y&&T.push(new Promise(h=>setTimeout(()=>h(!1),y))),m){const h=new v.PromiseCompletionSource;m.onCancellationRequested(()=>{h.reject(new C.CancellationError)}),T.push(h.promise)}if(await Promise.race(T))return!0;{const m=this.completions.indexOf(h);return m>=0&&this.completions.splice(m,1),!1}}}dispose(){if(!this.disposed){this.disposed=!0;for(let h of this.completions)h.reject(new T.ObjectDisposedError(this));this.completions.splice(0,this.completions.length),this.count=0}}}},function(h,m,y){"use strict";var v,C=this&&this.__decorate||function(h,m,y,v){var C,T=arguments.length,w=T<3?m:null===v?v=Object.getOwnPropertyDescriptor(m,y):v;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)w=Reflect.decorate(h,m,y,v);else for(var A=h.length-1;A>=0;A--)(C=h[A])&&(w=(T<3?C(w):T>3?C(m,y,w):C(m,y))||w);return T>3&&w&&Object.defineProperty(m,y,w),w};Object.defineProperty(m,"__esModule",{value:!0}),m.ConnectionService=void 0;const T=y(50),w=y(190),A=y(81),P=y(82),k=y(283),R=y(83),M=y(51),N=y(518),D=y(108);let I=v=class ConnectionService extends w.SshService{constructor(h){super(h),this.channelCounter=0,this.channelMap=new Map,this.nonAcceptedChannels=new Map,this.pendingChannels=new Map,this.pendingAcceptChannels=new Map}get channels(){return Array.from(this.channelMap.values())}close(h){for(let m of this.channelMap.values())m.close(h)}dispose(){const h=[...this.channelMap.values()];let m=[...this.pendingChannels.values()].map(h=>h.completionSource);this.pendingAcceptChannels.size>0&&(m=m.concat([...this.pendingAcceptChannels.values()].reduce((h,m)=>h.concat(m))));for(let m of h)m.dispose();for(let h of m)h.reject(new M.SshConnectionError("Session closed."));super.dispose()}async acceptChannel(h,m){const y=new P.PromiseCompletionSource;let v;if(m){if(m.isCancellationRequested)throw new R.CancellationError;v=m.onCancellationRequested(()=>{const m=this.pendingAcceptChannels.get(h);if(m){const h=m.findIndex(h=>Object.is(h,y));h>=0&&m.splice(h,1)}y.reject(new R.CancellationError)})}let C=null;if(C=Array.from(this.nonAcceptedChannels.values()).find(m=>m.channelType===h)||null,C)this.nonAcceptedChannels.delete(C.channelId);else{let m=this.pendingAcceptChannels.get(h);m||(m=[],this.pendingAcceptChannels.set(h,m)),m.push(y)}try{return C||await y.promise}finally{v&&v.dispose()}}async openChannel(h,m,y){const v=++this.channelCounter;h.senderChannel=v;let C=null;if(y){if(y.isCancellationRequested)throw new R.CancellationError;C=y.onCancellationRequested(()=>{this.pendingChannels.delete(v)&&m.reject(new R.CancellationError)})}return this.pendingChannels.set(v,{openMessage:h,completionSource:m,cancellationRegistration:C}),await this.session.sendMessage(h),v}handleMessage(h,m){if(h instanceof A.ChannelDataMessage)return this.handleDataMessage(h);if(h instanceof A.ChannelWindowAdjustMessage)return this.handleAdjustWindowMessage(h);if(h instanceof A.ChannelEofMessage)return this.handleEofMessage(h);if(h instanceof A.ChannelOpenMessage)return this.handleOpenMessage(h,m);if(h instanceof A.ChannelCloseMessage)return this.handleCloseMessage(h);if(h instanceof A.ChannelOpenConfirmationMessage)return this.handleOpenConfirmationMessage(h,m);if(h instanceof A.ChannelOpenFailureMessage)return this.handleOpenFailureMessage(h);if(h instanceof A.ChannelRequestMessage)return this.handleRequestMessage(h,m);if(h instanceof A.ChannelSuccessMessage)return this.handleSuccessMessage(h);if(h instanceof A.ChannelFailureMessage)return this.handleFailureMessage(h);throw new Error(`Message not implemented: ${h}`)}async handleOpenMessage(h,m){if(!this.session.canAcceptRequests){(0,T.trace)("Channel open request blocked because the session is not yet authenticated.");const y=new A.ChannelOpenFailureMessage;return y.recipientChannel=h.senderChannel,y.reasonCode=A.SshChannelOpenFailureReason.administrativelyProhibited,y.description="Authenticate before opening channels.",void await this.session.sendMessage(y,m)}if(!h.channelType){const y=new A.ChannelOpenFailureMessage;return y.recipientChannel=h.senderChannel,y.reasonCode=A.SshChannelOpenFailureReason.unknownChannelType,y.description="Channel type not specified.",void await this.session.sendMessage(y,m)}const y=new k.SshChannel(this,h.channelType,h.senderChannel,h.initialWindowSize,h.maximumPacketSize,++this.channelCounter),v=new N.SshChannelOpeningEventArgs(h,y,!0);try{await this.session.handleChannelOpening(v,m)}catch(h){throw y.dispose(),h}if(v.failureReason!==A.SshChannelOpenFailureReason.none){const h=new A.ChannelOpenFailureMessage;h.recipientChannel=y.remoteChannelId,h.reasonCode=v.failureReason,h.description=v.failureDescription||void 0;try{await this.session.sendMessage(h,m)}finally{y.dispose()}return}if(this.session.isClosed)return void y.dispose();this.channelMap.set(y.channelId,y);const C=new A.ChannelOpenConfirmationMessage;C.recipientChannel=y.remoteChannelId,C.senderChannel=y.channelId,C.initialWindowSize=h.initialWindowSize,C.maximumPacketSize=h.maximumPacketSize,await this.session.sendMessage(C,m);let w=!1;const P=this.pendingAcceptChannels.get(y.channelType);for(;P&&P.length>0;){P.shift().resolve(y),w=!0;break}w||this.nonAcceptedChannels.set(y.channelId,y),this.onChannelOpenCompleted(y.channelId,y),y.enableSending()}handleCloseMessage(h){const m=this.findChannelById(h.recipientChannel);m&&m.dispose()}async handleOpenConfirmationMessage(h,m){var y;let v,C=null;const T=this.pendingChannels.get(h.recipientChannel);if(!T)throw this.channelMap.has(h.recipientChannel)?new Error("Duplicate channel ID."):new Error("Channel confirmation was not requested.");v=T.openMessage,C=T.completionSource,T.cancellationRegistration&&T.cancellationRegistration.dispose(),this.pendingChannels.delete(h.recipientChannel);const w=new k.SshChannel(this,v.channelType||k.SshChannel.sessionChannelType,h.senderChannel,h.initialWindowSize,h.maximumPacketSize,h.recipientChannel);this.channelMap.set(w.channelId,w);const P=new N.SshChannelOpeningEventArgs(v,w,!1);if(await this.session.handleChannelOpening(P,m),C){if(P.failureReason!==A.SshChannelOpenFailureReason.none)return void C.reject(new M.SshChannelError(null!==(y=P.failureDescription)&&void 0!==y?y:"Channel open failure.",P.failureReason));C.resolve(w)}else this.onChannelOpenCompleted(w.channelId,w);w.enableSending()}handleOpenFailureMessage(h){let m=null;const y=this.pendingChannels.get(h.recipientChannel);y&&(m=y.completionSource,y.cancellationRegistration&&y.cancellationRegistration.dispose(),this.pendingChannels.delete(h.recipientChannel)),null!=m?m.reject(new M.SshChannelError(h.description||"Channel open rejected.",h.reasonCode)):this.onChannelOpenCompleted(h.recipientChannel,null)}async handleRequestMessage(h,m){const y=this.findChannelById(h.recipientChannel);y?await y.handleRequest(h,m):(0,T.trace)(`Invalid channel ID ${h.recipientChannel} in channel request message.`)}handleSuccessMessage(h){const m=this.findChannelById(h.recipientChannel);m?m.handleResponse(!0):(0,T.trace)(`Invalid channel ID ${h.recipientChannel} in channel success message.`)}handleFailureMessage(h){const m=this.findChannelById(h.recipientChannel);m?m.handleResponse(!1):(0,T.trace)(`Invalid channel ID ${h.recipientChannel} in channel failure message.`)}handleDataMessage(h){const m=this.findChannelById(h.recipientChannel);if(m)return m.handleDataReceived(h.data)}handleAdjustWindowMessage(h){const m=this.findChannelById(h.recipientChannel);m&&m.adjustRemoteWindow(h.bytesToAdd)}handleEofMessage(h){const m=this.findChannelById(h.recipientChannel);m&&m.handleEof()}onChannelOpenCompleted(h,m){m?(0,T.trace)(`${this.session} ChannelOpenCompleted(${m})`):(0,T.trace)(`${this.session} ChannelOpenCompleted(${h} failed)`)}findChannelById(h){var m;return null!==(m=this.channelMap.get(h))&&void 0!==m?m:null}_removeChannel(h){this.channelMap.delete(h.channelId),this.pendingChannels.delete(h.channelId)}};I.serviceName="ssh-connection",I=v=C([(0,D.serviceActivation)({serviceRequest:v.serviceName})],I),m.ConnectionService=I},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0}),m.PARTICIPANT_PROPERTY_IS_HOST="isHost",m.PARTICIPANT_PROPERTY_HOST_FLAGS="hostFlags",m.DATA_TYPE_JOINED_READY="joined-ready",m.DATA_TYPE_JOINED_READY_ACK="joined-ready.ack",m.DATA_TYPE_LIVESHARE_HUB="ms-liveshare-hub",m.POST_FIX_NOTIFY="-notify",function(h){h[h.JoinReadAck=1]="JoinReadAck"}(m.HostFlags||(m.HostFlags={}))},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0});var v=y(1238);m.SshRpcServer=v.SshRpcServer;var C=y(1239);m.MultiChannelRpcServer=C.MultiChannelRpcServer;var T=y(525);m.createDuplexStreams=T.createDuplexStreams;var w=y(1240);m.createDuplexMultiChannelRpcClient=w.createDuplexMultiChannelRpcClient,function __export(h){for(var y in h)m.hasOwnProperty(y)||(m[y]=h[y])}(y(526))},function(h,m,y){"use strict";var v=this&&this.__awaiter||function(h,m,y,v){return new(y||(y=Promise))((function(C,T){function fulfilled(h){try{step(v.next(h))}catch(h){T(h)}}function rejected(h){try{step(v.throw(h))}catch(h){T(h)}}function step(h){h.done?C(h.value):function adopt(h){return h instanceof y?h:new y((function(m){m(h)}))}(h.value).then(fulfilled,rejected)}step((v=v.apply(h,m||[])).next())}))};Object.defineProperty(m,"__esModule",{value:!0});const C=y(0),T=y(7);var w;!function(h){h.SuggestedContacts="contacts.suggested",h.AvailableContacts="contacts.available",h.ContactsProvider="contacts.provider",h.SelfContact="contacts.selfContact",h.Contact="contacts.contact",h.ContactInvited="contacts.contact.invited",h.ContactOffline="contacts.contact.offline",h.RecentContact="contacts.recentContact",h.RecentContactOffline="contacts.recentContact.offline",h.RecentContactInvited="contacts.recentContact.invited",h.NoContact="contacts.noContact",h.RecentContacts="contacts.RecentContacts",h.NoSuggestedContacts="contacts.NoSuggestedUsers",h.NoRecentContacts="contacts.NoRecentContacts",h.InvitedContact="contacts.invited"}(w||(w={}));const A=y(58),P=y(191),k=y(3),R=y(4);class ContactsProviderViewlet{constructor(h){this.sessionContext=h,this.changeEventEmitter=new C.EventEmitter,this.onDidChangeTreeData=this.changeEventEmitter.event,this.joinedUserProfiles=new Map,this.refresh=()=>{this.changeEventEmitter.fire(void 0)},A.ContactManager.addListener(k.ContactManagerEvents.ContactsChanged,this.refresh),A.ContactManager.addListener(k.ContactManagerEvents.SuggestedUsersUpdate,this.refresh),A.ContactManager.addListener(k.ContactManagerEvents.RecentContactsUpdate,this.refresh),A.ContactManager.addListener(k.ContactManagerEvents.InviteContactsUpdate,this.refresh),this.sessionContext.onCollaboratorChanged(h=>this.onCollaboratorChanged(h))}getTreeItem(h){return h}getChildren(h){return v(this,void 0,void 0,(function*(){return h?yield this.getElementChildren(h):yield this.getDefaultRootChildren()}))}getElementChildren(h){return v(this,void 0,void 0,(function*(){switch(h.contextValue){case w.SuggestedContacts:return this.getSuggestedUsersChildren();case w.RecentContacts:return this.getRecentContactsChildren();case w.ContactsProvider:return this.getContactServiceChildren(h.contactServiceManager);case w.AvailableContacts:return this.getAvailableContactsChildren(h.contactServiceManager);case w.NoRecentContacts:case w.NoSuggestedContacts:return[new k.TreeViewItem({type:w.NoContact,label:"Invite participants...",command:{title:"Invite participants...",command:"liveshare.inviteNoUserJoinByEmail"}})];default:return[]}}))}createContactTreeExplorerItem(h,m,y){const v=ContactsProviderViewlet.getPresenceStatusName(m);let C=`${m.contact.displayName} - ${v} (${m.contact.email})`;const addPropertyText=(h,y,v)=>{const C=m.properties[h];C&&y(C)&&v(C)};return addPropertyText(A.PublishProperties.LiveshareStatus,h=>{const m=h;return m===k.SessionState.Joined||m===k.SessionState.Shared},h=>{const y=k.localize("extension.liveshare.InLiveShareSession");C=`${m.contact.displayName} - ${y} (${m.contact.email})`}),addPropertyText(A.PublishProperties.WorkspaceName,h=>""!==h,h=>C+=`\nWorkspace: ${h}`),new ContactTreeExplorerItem(m,h,{type:y,label:`${m.contact.displayName}`,tooltip:C,iconPath:this.getPresenceIconUri(m)})}getContactModelChildren(h,m){return h.sort(P.defaultCompareContacts).map(h=>{const y=A.ContactManager.getServiceManager(h.serviceId);return this.createContactTreeExplorerItem(y,h,m(h))})}onCollaboratorChanged(h){h.changeType===R.vsls.WorkspaceSessionChangeType.Joined?this.joinedUserProfiles.set(h.userProfile.id,h.userProfile):h.changeType!==R.vsls.WorkspaceSessionChangeType.Unjoined&&h.changeType!==R.vsls.WorkspaceSessionChangeType.Canceled||this.joinedUserProfiles.delete(h.userProfile.id),this.refresh()}getSuggestedUsersChildren(){return this.getContactModelChildren(A.ContactManager.getSuggestedUsers(),h=>this.isContactCollaborator(h)||A.ContactManager.isContactInvited(h.id)?w.ContactInvited:ContactsProviderViewlet.isContactOffline(h)?w.ContactOffline:w.Contact)}getRecentContactsChildren(){return this.getContactModelChildren(A.ContactManager.getRecentContacts(),h=>this.isContactCollaborator(h)||A.ContactManager.isContactInvited(h.id)?w.RecentContactInvited:ContactsProviderViewlet.isContactOffline(h)?w.RecentContactOffline:w.RecentContact)}getAvailableContactsChildren(h){return ContactsProviderViewlet.getContactsWithPresence(h.availableUsers).map(m=>this.createContactTreeExplorerItem(h,m,w.Contact))}getCollaborators(){return Object.values(this.sessionContext.collaboratorManager.getCollaborators())}isContactCollaborator(h){if(!this.sessionContext.collaboratorManager)return!1;return void 0!==this.getCollaborators().filter(h=>!h.isOwner).concat(Array.from(this.joinedUserProfiles.values())).find(m=>m.id===h.id||m.email===h.contact.email)}getContactServiceChildren(h){let m=[];if(h.capabilites.supportsAvailableContacts){const y=new ContactServiceExplorerItem(h,{type:w.AvailableContacts,collapsibleState:C.TreeItemCollapsibleState.Collapsed,label:`Available contacts (${ContactsProviderViewlet.getContactsWithPresence(h.availableUsers).length})`});m.push(y)}const y=h.selfUser;if(y){const v=new ContactTreeExplorerItem(y,h,{type:w.SelfContact,label:`${y.contact.displayName} - ${ContactsProviderViewlet.getPresenceStatusName(y)}`,iconPath:this.getPresenceIconUri(y)});m.unshift(v)}return m}getDefaultRootChildren(){return v(this,void 0,void 0,(function*(){const h=[],m=A.ContactManager.getSuggestedUsers(),y=A.ContactManager.getRecentContacts(),v=y.length>0,T=new k.TreeViewItem({type:v?w.RecentContacts:w.NoRecentContacts,collapsibleState:C.TreeItemCollapsibleState.Expanded,label:`Recent contacts (${y.length})`});h.push(T);const P=m.length>0,R=new k.TreeViewItem({type:P?w.SuggestedContacts:w.NoSuggestedContacts,collapsibleState:C.TreeItemCollapsibleState.Expanded,label:`Suggested contacts (${m.length})`});return h.push(R),h}))}static getPresenceIcon(h){switch(h.contact.status){case R.contactProtocol.PresenceStatus.Available:return"available.svg";case R.contactProtocol.PresenceStatus.DoNotDisturb:return"dnd.svg";case R.contactProtocol.PresenceStatus.Away:return"away.svg";case R.contactProtocol.PresenceStatus.Busy:return"busy.svg";default:return"invisible.svg"}}getPresenceIconUri(h){return k.ExtensionUtil.getExtensionUri(T.join("images","presence",ContactsProviderViewlet.getPresenceIcon(h)))}static getContactsWithPresence(h){return h.filter(h=>h.contact.status!==R.contactProtocol.PresenceStatus.Offline)}static getPresenceStatusName(h){return ContactsProviderViewlet.toPresenceStatusName(h.contact.status)}static toPresenceStatusName(h){switch(h){case R.contactProtocol.PresenceStatus.Available:return"Available";case R.contactProtocol.PresenceStatus.DoNotDisturb:return"Do not disturb";case R.contactProtocol.PresenceStatus.Away:return"Away";case R.contactProtocol.PresenceStatus.Busy:return"Busy";case R.contactProtocol.PresenceStatus.Offline:default:return"Offline"}}static isContactOffline(h){const m=h.contact.status;return void 0===m||m===R.contactProtocol.PresenceStatus.Offline||m===R.contactProtocol.PresenceStatus.Unknown}}m.ContactsProviderViewlet=ContactsProviderViewlet;class ContactServiceExplorerItem extends k.TreeViewItem{constructor(h,m){super(m),this.contactServiceManager=h}}m.ContactServiceExplorerItem=ContactServiceExplorerItem;class ContactTreeExplorerItem extends ContactServiceExplorerItem{constructor(h,m,y){super(m,y),this.contactModel=h}}m.ContactTreeExplorerItem=ContactTreeExplorerItem},function(h,m,y){var v=y(294),C=y(1285),T=y(1286),w=v?v.toStringTag:void 0;h.exports=function baseGetTag(h){return null==h?void 0===h?"[object Undefined]":"[object Null]":w&&w in Object(h)?C(h):T(h)}},function(h,m){h.exports=function isObjectLike(h){return null!=h&&"object"==typeof h}},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0}),m.availabilityChangedEvent=m.RemoteServiceConnections=m.MessageDelimiters=m.Formatters=void 0,function(h){h[h.Utf8=0]="Utf8",h[h.MessagePack=1]="MessagePack"}(m.Formatters||(m.Formatters={})),function(h){h[h.HttpLikeHeaders=0]="HttpLikeHeaders",h[h.BigEndianInt32LengthHeader=1]="BigEndianInt32LengthHeader"}(m.MessageDelimiters||(m.MessageDelimiters={})),function(h){h[h.None=0]="None",h[h.Multiplexing=1]="Multiplexing",h[h.IpcPipe=2]="IpcPipe",h[h.ClrActivation=8]="ClrActivation"}(m.RemoteServiceConnections||(m.RemoteServiceConnections={})),m.availabilityChangedEvent="availabilityChanged"},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0});const v=y(19),C=y(192);async function writeAsync(h,m){const y=new C.Deferred;return h.write(m,h=>{h?y.reject(h):y.resolve()}),y.promise}async function getBufferFrom(h,m,y=!1,v){const T=new C.Deferred;for(;m>0;){const w=h.read(m);if(null===w){const m=new C.Deferred;h.once("readable",m.resolve.bind(m)),h.once("end",T.resolve.bind(T));const y=Promise.race([m.promise,T.promise]);if(await(v?v.racePromise(y):y),m.isCompleted)continue}if(!y&&(!w||w.length<m))throw new Error("Stream terminated before required bytes were read.");return w}return new Buffer([])}m.writeAsync=writeAsync,m.writeSubstream=function writeSubstream(h){return new v.Writable({async write(m,y,v){try{const y=new DataView(new ArrayBuffer(4));y.setUint32(0,m.length,!1),await writeAsync(h,Buffer.from(y.buffer)),await writeAsync(h,m),v()}catch(h){v(h)}},final(m){h.write(new Uint8Array(4),m)}})},m.readSubstream=function readSubstream(h){return new v.Readable({async read(m){const y=await getBufferFrom(h,4),v=new DataView(y.buffer,y.byteOffset,y.length).getUint32(0,!1);if(0===v)return void this.push(null);const C=await getBufferFrom(h,v);this.push(C)}})},m.getBufferFrom=getBufferFrom,m.throwIfDisposed=function throwIfDisposed(h){if(h.isDisposed)throw new Error("disposed")},m.requireInteger=function requireInteger(h,m,y,v="signed"){if(!Number.isInteger(m))throw new Error(`${h} must be an integer.`);let C=8*y;"signed"===v&&C--;const T=Math.pow(2,C)-1,w="signed"===v?-Math.pow(2,C):0;if(m>T||m<w)throw new Error(`${h} must be in the range ${w}-${T}.`)},m.removeFromQueue=function removeFromQueue(h,m){if(m){const y=m.indexOf(h);y>=0&&m.splice(y,1)}}},function(h,m,y){"use strict";function string(h){return"string"==typeof h||h instanceof String}function array(h){return Array.isArray(h)}Object.defineProperty(m,"__esModule",{value:!0}),m.boolean=function boolean(h){return!0===h||!1===h},m.string=string,m.number=function number(h){return"number"==typeof h||h instanceof Number},m.error=function error(h){return h instanceof Error},m.func=function func(h){return"function"==typeof h},m.array=array,m.stringArray=function stringArray(h){return array(h)&&h.every(h=>string(h))}},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0});const v=y(118);m.TraceListener=class TraceListener{constructor(){this.filter=null}traceEvent(h,m,y,v,...C){this.filter&&!this.filter.shouldTrace(h,m,y)||this.writeEvent(h,m,y,v,...C)}writeLine(h,m,y){y&&(m=`[${v.TraceFormat.formatDate(new Date)} ${h}] ${m}`),this.writeTo(m)}}},function(h,m,y){"use strict";function __export(h){for(var y in h)m.hasOwnProperty(y)||(m[y]=h[y])}Object.defineProperty(m,"__esModule",{value:!0}),__export(y(781)),__export(y(343));var v=y(205);m.wait=v.wait;var C=y(791);m.once=C.once;var T=y(792);m.onlyOnce=T.onlyOnce;var w=y(793);m.raceAsync=w.raceAsync;var A=y(802);m.withCache=A.withCache;var P=y(803);m.continueWhen=P.continueWhen;var k=y(804);m.getPromiseState=k.getPromiseState;var R=y(805);m.idFunction=R.idFunction;var M=y(341);m.withRetries=M.withRetries;var N=y(806);m.connectEvents=N.connectEvents;var D=y(807);m.withMutexByArguments=D.withMutexByArguments;var I=y(349);m.cleanupPII=I.cleanupPII,m.cleanupObjectValuesPII=I.cleanupObjectValuesPII,m.obfusticatePaths=I.obfusticatePaths,m.obfusticateEmailAddresses=I.obfusticateEmailAddresses,m.obfusticateCodespaceNames=I.obfusticateCodespaceNames,m.CODESPACE_URL_PII_LABEL=I.CODESPACE_URL_PII_LABEL;var x=y(210);m.randomInt=x.randomInt;var O=y(808);m.randomItem=O.randomItem;var L=y(350);m.randomBytes=L.randomBytes;var U=y(810);m.randomString=U.randomString;var B=y(811);m.randomBoolean=B.randomBoolean;var W=y(348);m.hashString=W.hashString;var q=y(812);m.debounce=q.debounce;var Y=y(813);m.throttle=Y.throttle;var V=y(209);m.defer=V.defer;var $=y(814);m.arrayUnique=$.arrayUnique;var z=y(815);m.isThenable=z.isThenable;var G=y(347);m.createDisposable=G.createDisposable;var J=y(346);m.timeoutPromise=J.timeoutPromise;var X=y(351);m.errorToObject=X.errorToObject;var Z=y(816);m.errorToString=Z.errorToString;var ee=y(817);m.notImplemented=ee.notImplemented;var te=y(818);m.promiseAny=te.promiseAny;var re=y(819);m.toCamelCase=re.toCamelCase;var ie=y(820);function propertiesToJSON(h){if(h)return JSON.stringify(h,Object.getOwnPropertyNames(h))}m.crc32=ie.crc32,__export(y(345)),m.propertiesToJSON=propertiesToJSON,m.propertiesToString=function propertiesToString(h){var m;return`type:${null===(m=null==h?void 0:h.constructor)||void 0===m?void 0:m.name} props:${propertiesToJSON(h)}`}},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0});const v=y(73);m.assertDefined=(h,m)=>v.assert(null!=h,m)},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0});var v=y(794);m.DisposableClass=v.DisposableClass;var C=y(208);m.Signal=C.Signal;var T=y(799);m.Mutex=T.Mutex;var w=y(800);m.CallbackContainer=w.CallbackContainer,function __export(h){for(var y in h)m.hasOwnProperty(y)||(m[y]=h[y])}(y(801))},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0}),function(h){h.create=function create(h){return{dispose:h}}}(m.Disposable||(m.Disposable={})),function(h){const m={dispose(){}};h.None=function(){return m}}(m.Event||(m.Event={}));class CallbackList{add(h,m=null,y){this._callbacks||(this._callbacks=[],this._contexts=[]),this._callbacks.push(h),this._contexts.push(m),Array.isArray(y)&&y.push({dispose:()=>this.remove(h,m)})}remove(h,m=null){if(this._callbacks){for(var y=!1,v=0,C=this._callbacks.length;v<C;v++)if(this._callbacks[v]===h){if(this._contexts[v]===m)return this._callbacks.splice(v,1),void this._contexts.splice(v,1);y=!0}if(y)throw new Error("When adding a listener with a context, you should remove it with the same context")}}invoke(...h){if(!this._callbacks)return[];for(var m=[],y=this._callbacks.slice(0),v=this._contexts.slice(0),C=0,T=y.length;C<T;C++)try{m.push(y[C].apply(v[C],h))}catch(h){console.error(h)}return m}isEmpty(){return!this._callbacks||0===this._callbacks.length}dispose(){this._callbacks=void 0,this._contexts=void 0}}class Emitter{constructor(h){this._options=h}get event(){return this._event||(this._event=(h,m,y)=>{let v;return this._callbacks||(this._callbacks=new CallbackList),this._options&&this._options.onFirstListenerAdd&&this._callbacks.isEmpty()&&this._options.onFirstListenerAdd(this),this._callbacks.add(h,m),v={dispose:()=>{this._callbacks.remove(h,m),v.dispose=Emitter._noop,this._options&&this._options.onLastListenerRemove&&this._callbacks.isEmpty()&&this._options.onLastListenerRemove(this)}},Array.isArray(y)&&y.push(v),v}),this._event}fire(h){this._callbacks&&this._callbacks.invoke.call(this._callbacks,h)}dispose(){this._callbacks&&(this._callbacks.dispose(),this._callbacks=void 0)}}Emitter._noop=function(){},m.Emitter=Emitter},function(h,m,y){"use strict";function assertPath(h){if("string"!=typeof h)throw new TypeError("Path must be a string. Received "+JSON.stringify(h))}function normalizeStringPosix(h,m){for(var y,v="",C=0,T=-1,w=0,A=0;A<=h.length;++A){if(A<h.length)y=h.charCodeAt(A);else{if(47===y)break;y=47}if(47===y){if(T===A-1||1===w);else if(T!==A-1&&2===w){if(v.length<2||2!==C||46!==v.charCodeAt(v.length-1)||46!==v.charCodeAt(v.length-2))if(v.length>2){var P=v.lastIndexOf("/");if(P!==v.length-1){-1===P?(v="",C=0):C=(v=v.slice(0,P)).length-1-v.lastIndexOf("/"),T=A,w=0;continue}}else if(2===v.length||1===v.length){v="",C=0,T=A,w=0;continue}m&&(v.length>0?v+="/..":v="..",C=2)}else v.length>0?v+="/"+h.slice(T+1,A):v=h.slice(T+1,A),C=A-T-1;T=A,w=0}else 46===y&&-1!==w?++w:w=-1}return v}var v={resolve:function resolve(){for(var h,m="",y=!1,v=arguments.length-1;v>=-1&&!y;v--){var C;v>=0?C=arguments[v]:(void 0===h&&(h=process.cwd()),C=h),assertPath(C),0!==C.length&&(m=C+"/"+m,y=47===C.charCodeAt(0))}return m=normalizeStringPosix(m,!y),y?m.length>0?"/"+m:"/":m.length>0?m:"."},normalize:function normalize(h){if(assertPath(h),0===h.length)return".";var m=47===h.charCodeAt(0),y=47===h.charCodeAt(h.length-1);return 0!==(h=normalizeStringPosix(h,!m)).length||m||(h="."),h.length>0&&y&&(h+="/"),m?"/"+h:h},isAbsolute:function isAbsolute(h){return assertPath(h),h.length>0&&47===h.charCodeAt(0)},join:function join(){if(0===arguments.length)return".";for(var h,m=0;m<arguments.length;++m){var y=arguments[m];assertPath(y),y.length>0&&(void 0===h?h=y:h+="/"+y)}return void 0===h?".":v.normalize(h)},relative:function relative(h,m){if(assertPath(h),assertPath(m),h===m)return"";if((h=v.resolve(h))===(m=v.resolve(m)))return"";for(var y=1;y<h.length&&47===h.charCodeAt(y);++y);for(var C=h.length,T=C-y,w=1;w<m.length&&47===m.charCodeAt(w);++w);for(var A=m.length-w,P=T<A?T:A,k=-1,R=0;R<=P;++R){if(R===P){if(A>P){if(47===m.charCodeAt(w+R))return m.slice(w+R+1);if(0===R)return m.slice(w+R)}else T>P&&(47===h.charCodeAt(y+R)?k=R:0===R&&(k=0));break}var M=h.charCodeAt(y+R);if(M!==m.charCodeAt(w+R))break;47===M&&(k=R)}var N="";for(R=y+k+1;R<=C;++R)R!==C&&47!==h.charCodeAt(R)||(0===N.length?N+="..":N+="/..");return N.length>0?N+m.slice(w+k):(w+=k,47===m.charCodeAt(w)&&++w,m.slice(w))},_makeLong:function _makeLong(h){return h},dirname:function dirname(h){if(assertPath(h),0===h.length)return".";for(var m=h.charCodeAt(0),y=47===m,v=-1,C=!0,T=h.length-1;T>=1;--T)if(47===(m=h.charCodeAt(T))){if(!C){v=T;break}}else C=!1;return-1===v?y?"/":".":y&&1===v?"//":h.slice(0,v)},basename:function basename(h,m){if(void 0!==m&&"string"!=typeof m)throw new TypeError('"ext" argument must be a string');assertPath(h);var y,v=0,C=-1,T=!0;if(void 0!==m&&m.length>0&&m.length<=h.length){if(m.length===h.length&&m===h)return"";var w=m.length-1,A=-1;for(y=h.length-1;y>=0;--y){var P=h.charCodeAt(y);if(47===P){if(!T){v=y+1;break}}else-1===A&&(T=!1,A=y+1),w>=0&&(P===m.charCodeAt(w)?-1==--w&&(C=y):(w=-1,C=A))}return v===C?C=A:-1===C&&(C=h.length),h.slice(v,C)}for(y=h.length-1;y>=0;--y)if(47===h.charCodeAt(y)){if(!T){v=y+1;break}}else-1===C&&(T=!1,C=y+1);return-1===C?"":h.slice(v,C)},extname:function extname(h){assertPath(h);for(var m=-1,y=0,v=-1,C=!0,T=0,w=h.length-1;w>=0;--w){var A=h.charCodeAt(w);if(47!==A)-1===v&&(C=!1,v=w+1),46===A?-1===m?m=w:1!==T&&(T=1):-1!==m&&(T=-1);else if(!C){y=w+1;break}}return-1===m||-1===v||0===T||1===T&&m===v-1&&m===y+1?"":h.slice(m,v)},format:function format(h){if(null===h||"object"!=typeof h)throw new TypeError('The "pathObject" argument must be of type Object. Received type '+typeof h);return function _format(h,m){var y=m.dir||m.root,v=m.base||(m.name||"")+(m.ext||"");return y?y===m.root?y+v:y+h+v:v}("/",h)},parse:function parse(h){assertPath(h);var m={root:"",dir:"",base:"",ext:"",name:""};if(0===h.length)return m;var y,v=h.charCodeAt(0),C=47===v;C?(m.root="/",y=1):y=0;for(var T=-1,w=0,A=-1,P=!0,k=h.length-1,R=0;k>=y;--k)if(47!==(v=h.charCodeAt(k)))-1===A&&(P=!1,A=k+1),46===v?-1===T?T=k:1!==R&&(R=1):-1!==T&&(R=-1);else if(!P){w=k+1;break}return-1===T||-1===A||0===R||1===R&&T===A-1&&T===w+1?-1!==A&&(m.base=m.name=0===w&&C?h.slice(1,A):h.slice(w,A)):(0===w&&C?(m.name=h.slice(1,T),m.base=h.slice(1,A)):(m.name=h.slice(w,T),m.base=h.slice(w,A)),m.ext=h.slice(T,A)),w>0?m.dir=h.slice(0,w-1):C&&(m.dir="/"),m},sep:"/",delimiter:":",win32:null,posix:null};v.posix=v,h.exports=v},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0});class TelemetryEventNames{}m.TelemetryEventNames=TelemetryEventNames,TelemetryEventNames.FAULT_PREFIX="Fault/",TelemetryEventNames.NAME_LOGS_FILE_FAILED=TelemetryEventNames.FAULT_PREFIX+"name-logfile-failed",TelemetryEventNames.OPEN_LOGS_FAILED=TelemetryEventNames.FAULT_PREFIX+"open-logs-failed",TelemetryEventNames.WRITE_LOGS_FAILED=TelemetryEventNames.FAULT_PREFIX+"write-logs-failed",TelemetryEventNames.UNHANDLED_COMMAND_ERROR_FAULT=TelemetryEventNames.FAULT_PREFIX+"unhandled-commanderror-fault";class TelemetryPropertyNames{}m.TelemetryPropertyNames=TelemetryPropertyNames,TelemetryPropertyNames.FEATURE_NAME="vscode-vsls-command.",TelemetryPropertyNames.FEATURE_NAME_V2=TelemetryPropertyNames.FEATURE_NAME+"v2.",TelemetryPropertyNames.COMMAND_TEXT=TelemetryPropertyNames.FEATURE_NAME+"CommandText",TelemetryPropertyNames.TELEMETRY_EVENT_VERSION=TelemetryPropertyNames.FEATURE_NAME+"TelemetryEventVersion",TelemetryPropertyNames.CURRENT_AB_EXPERIMENT=TelemetryPropertyNames.FEATURE_NAME+"CurrentAbExperiment",TelemetryPropertyNames.CURRENT_AB_EXPERIMENT_GROUP=TelemetryPropertyNames.FEATURE_NAME+"CurrentAbExperimentGroup",TelemetryPropertyNames.COUNT_OF_CONCURRENT_AB_EXPERIMENTS=TelemetryPropertyNames.FEATURE_NAME+"CountOfConcurrentAbExperiments",TelemetryPropertyNames.IS_FIRST_ACTIVATION=TelemetryPropertyNames.FEATURE_NAME+"IsFirstActivation"},function(h,m,y){"use strict";const v=y(27),C=y(7),T=process.versions.node.split("."),w=Number.parseInt(T[0],10),A=Number.parseInt(T[1],10),P=Number.parseInt(T[2],10);function nodeSupportsBigInt(){if(w>10)return!0;if(10===w){if(A>5)return!0;if(5===A&&P>=0)return!0}return!1}function isSrcSubdir(h,m){const y=C.resolve(h).split(C.sep).filter(h=>h),v=C.resolve(m).split(C.sep).filter(h=>h);return y.reduce((h,m,y)=>h&&v[y]===m,!0)}function errMsg(h,m,y){return`Cannot ${y} '${h}' to a subdirectory of itself, '${m}'.`}h.exports={checkPaths:function checkPaths(h,m,y,C){!function getStats(h,m,y){nodeSupportsBigInt()?v.stat(h,{bigint:!0},(h,C)=>{if(h)return y(h);v.stat(m,{bigint:!0},(h,m)=>h?"ENOENT"===h.code?y(null,{srcStat:C,destStat:null}):y(h):y(null,{srcStat:C,destStat:m}))}):v.stat(h,(h,C)=>{if(h)return y(h);v.stat(m,(h,m)=>h?"ENOENT"===h.code?y(null,{srcStat:C,destStat:null}):y(h):y(null,{srcStat:C,destStat:m}))})}(h,m,(v,T)=>{if(v)return C(v);const{srcStat:w,destStat:A}=T;return A&&A.ino&&A.dev&&A.ino===w.ino&&A.dev===w.dev?C(new Error("Source and destination must not be the same.")):w.isDirectory()&&isSrcSubdir(h,m)?C(new Error(errMsg(h,m,y))):C(null,{srcStat:w,destStat:A})})},checkPathsSync:function checkPathsSync(h,m,y){const{srcStat:C,destStat:T}=function getStatsSync(h,m){let y,C;y=nodeSupportsBigInt()?v.statSync(h,{bigint:!0}):v.statSync(h);try{C=nodeSupportsBigInt()?v.statSync(m,{bigint:!0}):v.statSync(m)}catch(h){if("ENOENT"===h.code)return{srcStat:y,destStat:null};throw h}return{srcStat:y,destStat:C}}(h,m);if(T&&T.ino&&T.dev&&T.ino===C.ino&&T.dev===C.dev)throw new Error("Source and destination must not be the same.");if(C.isDirectory()&&isSrcSubdir(h,m))throw new Error(errMsg(h,m,y));return{srcStat:C,destStat:T}},checkParentPaths:function checkParentPaths(h,m,y,T,w){const A=C.resolve(C.dirname(h)),P=C.resolve(C.dirname(y));if(P===A||P===C.parse(P).root)return w();nodeSupportsBigInt()?v.stat(P,{bigint:!0},(v,C)=>v?"ENOENT"===v.code?w():w(v):C.ino&&C.dev&&C.ino===m.ino&&C.dev===m.dev?w(new Error(errMsg(h,y,T))):checkParentPaths(h,m,P,T,w)):v.stat(P,(v,C)=>v?"ENOENT"===v.code?w():w(v):C.ino&&C.dev&&C.ino===m.ino&&C.dev===m.dev?w(new Error(errMsg(h,y,T))):checkParentPaths(h,m,P,T,w))},checkParentPathsSync:function checkParentPathsSync(h,m,y,T){const w=C.resolve(C.dirname(h)),A=C.resolve(C.dirname(y));if(A===w||A===C.parse(A).root)return;let P;try{P=nodeSupportsBigInt()?v.statSync(A,{bigint:!0}):v.statSync(A)}catch(h){if("ENOENT"===h.code)return;throw h}if(P.ino&&P.dev&&P.ino===m.ino&&P.dev===m.dev)throw new Error(errMsg(h,y,T));return checkParentPathsSync(h,m,A,T)},isSrcSubdir:isSrcSubdir}},function(h,m,y){"use strict";const v=y(36).fromCallback,C=y(862);h.exports={remove:v(C),removeSync:C.sync}},function(h,m){h.exports=require("timers")},function(h,m,y){"use strict";var v=this&&this.__awaiter||function(h,m,y,v){return new(y||(y=Promise))((function(C,T){function fulfilled(h){try{step(v.next(h))}catch(h){T(h)}}function rejected(h){try{step(v.throw(h))}catch(h){T(h)}}function step(h){h.done?C(h.value):function adopt(h){return h instanceof y?h:new y((function(m){m(h)}))}(h.value).then(fulfilled,rejected)}step((v=v.apply(h,m||[])).next())}))};Object.defineProperty(m,"__esModule",{value:!0});const C=y(12),T=y(14),w=y(8),A=y(17);class ExtensionTelemetry{static sendShareFault(h,m,y,v){w.Telemetry.sendFault(A.TelemetryEventNames.SHARE_FAULT,h,m,y,v)}static sendJoinFault(h,m,y,v){w.Telemetry.sendFault(A.TelemetryEventNames.JOIN_FAULT,h,m,y,v)}static sendSignInFault(h,m,y,v){w.Telemetry.sendFault(A.TelemetryEventNames.SIGN_IN_FAULT,h,m,y,v)}static sendActivateExtensionFault(h,m,y,v){w.Telemetry.sendFault(A.TelemetryEventNames.ACTIVATE_EXTENSION_FAULT,h,m,y,v)}static sendDeactivateExtensionFault(h,m,y,v){w.Telemetry.sendFault(A.TelemetryEventNames.DEACTIVATE_EXTENSION_FAULT,h,m,y,v)}static sendActivateAgentAsyncFault(h,m,y,v){w.Telemetry.sendFault(A.TelemetryEventNames.ACTIVATE_AGENTASYNC_FAULT,h,m,y,v)}static sendTransition(h,m,y){let v=(new Date).getTime(),C=v-this.lastTransitionTime;this.lastTransitionTime=v;let T=new w.TelemetryEvent(A.TelemetryEventNames.TRANSITION);T.addProperty(A.TelemetryPropertyNames.CURRENT_STATE,h),T.addProperty(A.TelemetryPropertyNames.NEXT_STATE,m),T.addProperty(A.TelemetryPropertyNames.TRANSITION_ACTION,y),T.addMeasure(A.TelemetryPropertyNames.TRANSITION_SEQUENCE,this.transitionSeq++),T.addMeasure(A.TelemetryPropertyNames.TIME_SINCE_LAST_TRANSITION,C),T.send()}static reportChangedSetting(){new w.TelemetryEvent(A.TelemetryEventNames.CHANGE_SETTING).send()}static versionCheckFail(h,m,y){let v=new w.Fault(A.TelemetryEventNames.VERSION_CHECK_FAIL,w.FaultType.User,"Version check failed.");v.addProperty(A.TelemetryPropertyNames.VERSION_PLATFORMNAME,h),v.addProperty(A.TelemetryPropertyNames.VERSION_PLATFORMVERSION,m),v.addProperty(A.TelemetryPropertyNames.VERSION_PLATFORMVERSION_SERVICEPACK,String(y)),v.send()}static ReportFailedAssertion(h){new w.Fault(A.TelemetryEventNames.ASSERT_FAULT,w.FaultType.Error,h,new Error("Assertion Failed")).send()}static setUserInfo(h){return v(this,void 0,void 0,(function*(){h&&h.emailAddress&&(h.emailAddress!==C.Settings.get(T.SettingKeys.userEmail)&&(yield C.Settings.save(T.SettingKeys.userEmail,h.emailAddress)),h.emailAddress.endsWith("microsoft.com")&&!C.Settings.get(T.SettingKeys.isInternal)&&(yield C.Settings.save(T.SettingKeys.isInternal,!0),w.Telemetry.addContextProperty(A.TelemetryPropertyNames.IS_INTERNAL,"true")))}))}static setServiceEndpoint(h){w.Telemetry.addContextProperty(A.TelemetryPropertyNames.SERVICE_ENDPOINT,h)}static setSettingsContextProperties(){w.Telemetry.addContextProperty(A.TelemetryPropertyNames.IS_INTERNAL,C.Settings.get(T.SettingKeys.isInternal)?"true":"false"),w.Telemetry.addContextProperty(A.TelemetryPropertyNames.IS_CLOUD_ENVIRONMENT,C.Settings.get(T.SettingKeys.isCloudEnvironment)?"true":"false"),w.Telemetry.addContextProperty(A.TelemetryPropertyNames.USER_TEAM_STATUS,C.Settings.get(T.SettingKeys.teamStatus)),w.Telemetry.addContextProperty(A.TelemetryPropertyNames.CONNECTION_MODE,C.Settings.get(T.SettingKeys.connectionMode)),w.Telemetry.addContextProperty(A.TelemetryPropertyNames.FEATURE_FLAGS,JSON.stringify(C.featureFlags))}static genericOperation(h,m,y){const v=new w.TelemetryEvent(h);v.addProperty(A.TelemetryPropertyNames.EVENT_RESULT,this.capitalizeFirstChar(m)),this.setPayloadAndSend(v,y)}static sendFault(h,m,y,v){const C=new w.Fault(h,v||w.FaultType.Error,m);this.setPayloadAndSend(C,y)}static setPayloadAndSend(h,m){if(m)for(let y in m)if(m.hasOwnProperty(y)){const v=void 0===m[y]||null===m[y]?void 0:m[y].toString();h.addProperty(A.TelemetryPropertyNames.FEATURE_NAME+this.capitalizeFirstChar(y),v)}w.Telemetry.correlate(h),h.send()}static capitalizeFirstChar(h){return h.charAt(0).toUpperCase()+h.slice(1)}}m.ExtensionTelemetry=ExtensionTelemetry,ExtensionTelemetry.transitionSeq=0,ExtensionTelemetry.lastTransitionTime=(new Date).getTime()},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0});const v=y(0),C=y(4),T=y(92),w=y(74),A=y(7),P=y(384),k=y(8),R=y(162),M=y(5),N=y(914),D=y(385),I=y(5),x=y(951),O={location:v.ProgressLocation.Window,title:""},L=Object.assign(Object.assign({},O),{isUserInitiated:!0});class ExtensionUtil{static init(h,m,y){ExtensionUtil.extensionContext=h,ExtensionUtil.extensionUtilId=y,M.traceSource.info("Extension, IDE, OS : "+ExtensionUtil.clientInfoToString(m)),k.Telemetry.addFilter(new k.SendOnceFilter(R.TelemetryEventNames.UNHANDLED_REJECTION_FAULT,[k.TelemetryPropertyNames.EVENT_MESSAGE]))}static getPackage(){return ExtensionUtil.getPackageExtension(ExtensionUtil.extensionUtilId)}static getPackageExtension(h){const m=v.extensions.getExtension(h);if(m)return m.packageJSON}static get extensionId(){return ExtensionUtil.extensionUtilId}static get context(){if(!ExtensionUtil.extensionContext)throw new Error("Extension context not initialized");return ExtensionUtil.extensionContext}static get enableModalNotifications(){return!process.env.VSLS_TEST_DISABLE_MODAL}static async setCommandContext(h,m){ExtensionUtil.contextValues[h]=m,await v.commands.executeCommand("setContext",h,m)}static getCommandContext(h){return ExtensionUtil.contextValues[h]}static getErrorString(h){switch(h){case C.vsls.ErrorCodes.CouldNotConnectToServer:return P.localize("error.CouldNotConnectToServer");case C.vsls.ErrorCodes.OlderThanServer:return P.localize("error.OlderThanServer").replace("$(shortName)",T.Settings.get(w.SettingKeys.shortName));case C.vsls.ErrorCodes.NewerThanServer:return P.localize("error.NewerThanServer").replace("$(shortName)",T.Settings.get(w.SettingKeys.shortName));case C.vsls.ErrorCodes.OlderThanPeer:return P.localize("error.OlderThanPeer").replace("$(shortName)",T.Settings.get(w.SettingKeys.shortName));case C.vsls.ErrorCodes.NewerThanPeer:return P.localize("error.NewerThanPeer").replace("$(shortName)",T.Settings.get(w.SettingKeys.shortName));case C.vsls.ErrorCodes.OlderThanAgent:return P.localize("error.OlderThanAgent").replace("$(shortName)",T.Settings.get(w.SettingKeys.shortName));case C.vsls.ErrorCodes.NewerThanAgent:return P.localize("error.NewerThanAgent").replace("$(shortName)",T.Settings.get(w.SettingKeys.shortName));case C.vsls.ErrorCodes.NoIPAddressesDetected:return P.localize("error.NoIPAddressesDetected");case C.vsls.ErrorCodes.NoConnectionAddresses:return P.localize("error.NoConnectionAddresses");case C.vsls.ErrorCodes.AutoConnectionFailed:return P.localize("error.AutoConnectionFailed");case C.vsls.ErrorCodes.RelayConnectionFailed:return P.localize("error.RelayConnectionFailed");case C.vsls.ErrorCodes.DirectConnectionFailed:return P.localize("error.DirectConnectionFailed");case C.vsls.ErrorCodes.SessionProtocolError:return P.localize("error.SessionProtocolError").replace("$(shortName)",T.Settings.get(w.SettingKeys.shortName));case C.vsls.ErrorCodes.SessionAuthenticationFailed:return P.localize("error.SessionAuthenticationFailed");case C.vsls.ErrorCodes.DirectConnectionNotEnabled:return P.localize("error.DirectConnectionNotEnabled");case C.vsls.ErrorCodes.RelayConnectionNotEnabled:return P.localize("error.RelayConnectionNotEnabled");case C.vsls.ErrorCodes.CollaborationSessionUsersLimitReached:return P.localize("error.CollaborationSessionUsersLimitReached");case C.vsls.ErrorCodes.CollaborationSessionGuestRejected:return P.localize("error.CollaborationSessionGuestRejected");case C.vsls.ErrorCodes.CollaborationSessionRequestTimedOut:return P.localize("error.CollaborationSessionRequestTimedOut");case C.vsls.ErrorCodes.CollaborationSessionGuestCanceled:return P.localize("error.CollaborationSessionGuestCanceled");case C.vsls.ErrorCodes.CollaborationSessionNotFound:return P.localize("error.CollaborationSessionNotFound");case C.vsls.ErrorCodes.CollaborationSessionGuestBlocked:return P.localize("error.CollaborationSessionGuestBlocked");case C.vsls.ErrorCodes.NonSuccessHttpStatusCodeReceived:return P.localize("error.NonSuccessHttpStatusCodeReceived");case C.vsls.ErrorCodes.KeychainAccessFailed:return P.localize("error.KeychainAccessFailed");case C.vsls.ErrorCodes.RelayConnectionHostFailure:return P.localize("error.RelayConnectionHostFailure");case C.vsls.ErrorCodes.RelayConnectionGuestFailure:return P.localize("error.RelayConnectionGuestFailure");case C.vsls.ErrorCodes.RemoteLaunchNotEnabled:return P.localize("error.RemoteLaunchNotEnabled");case C.vsls.ErrorCodes.CouldNotConnectToServerAuthFailed:return P.localize("error.CouldNotConnectToServerAuthFailed");default:return""}}static getLocalizedProgressString(h){switch(h){case C.vsls.WorkspaceProgress.OpeningRemoteSession:return P.localize("progress.openingRemoteSession");case C.vsls.WorkspaceProgress.JoiningRemoteSession:return P.localize("progress.joiningRemoteSession");case C.vsls.WorkspaceProgress.WaitingForHost:return P.localize("progress.waitingForHost");case C.vsls.WorkspaceProgress.ReconnectingToHost:return P.localize("progress.reconnectingToHost");default:return""}}static getProgressUpdateString(h){return ExtensionUtil.getLocalizedProgressString(h)}static getWaitingForHostProgressUpdateString(h,m){if(!m)return;let y=this.getLocalizedProgressString(h);if(y){const h=T.Settings.get(w.SettingKeys.anonymousUserName),v=m.isAnonymous&&h?h:m.displayName||m.emailAddress||"Unknown user";y=y.replace("$(userName)",v)}return y}static getWorkspaceFilePath(h){return A.join(h,`${T.Settings.get(w.SettingKeys.name)}.code-workspace`)}static async runWithProgress(h,m=L){const y=Object.assign(Object.assign({},L),m),{isUserInitiated:C,cancellationToken:T}=y;if(!T||!T.isCancellationRequested)return C||(y.title=""),await v.window.withProgress(y,async m=>new Promise(async(y,v)=>{T&&T.onCancellationRequested(()=>{y(null)});try{y(await h(m))}catch(h){v(h)}}))}static async showErrorAsync(h,m={},y=[]){const C=("string"==typeof h?h:h.code&&ExtensionUtil.getErrorString(h.code)||h.message)||"Unknown error",{modal:T,hideReportAProblem:w}=m;if(w)return await v.window.showErrorMessage(C,{modal:T},...y);const A={title:"Report a Problem"},P=await v.window.showErrorMessage(C,{modal:T},A,...y);return P&&P.title===A.title&&this.reportIssue(),P}static async reportIssue(){const{name:h,publisher:m}=ExtensionUtil.getPackage();await v.commands.executeCommand("vscode.openIssueReporter",`${m}.${h}`)}static registerCommand(h,m,y){return v.commands.registerCommand(h,(async function(...y){try{return new k.TelemetryEvent(R.TelemetryEventNames.COMMAND_INITIATED).addProperty("commandName",h).send(),await m.call(this,...y)}catch(m){ExtensionUtil.reportCommandError(h,m)}}),y)}static addNewTreeViewItemAdornment(h,m){if(!h)return;let y=!1;const v=new Date,C=T.Settings.get(m);if(C){const h=new Date(C),m=new Date;m.setDate(v.getDate()-7),y=h>m}else T.Settings.save(m,v),y=!0;return h.tooltip=`${h.label} ${y?P.localize("treeView.newTooltip"):""}`,h.label=`${h.label}${y?"":""}`,h}static registerTextEditorCommand(h,m,y){return v.commands.registerTextEditorCommand(h,(function(y,v,...C){try{return m.call(this,y,v,...C)}catch(m){ExtensionUtil.reportCommandError(h,m)}}),y)}static async tryRegisterCommand(h,m,y,v=!1,C=!1){let T=void 0;if(await ExtensionUtil.isCommandDefined(h)){if(T=this.registeredCommands[h],!C)return T;if(T){const h=ExtensionUtil.context.subscriptions.indexOf(T);h>=0&&ExtensionUtil.context.subscriptions.splice(h,1),T.dispose()}}try{T=v?ExtensionUtil.registerTextEditorCommand(h,m,y):ExtensionUtil.registerCommand(h,m,y),ExtensionUtil.registeredCommands[h]=T,ExtensionUtil.context.subscriptions.push(T)}catch(m){M.traceSource.error(`Failed to register command:${h}`,m)}return T}static async isCommandDefined(h){return(await v.commands.getCommands()).indexOf(h)>=0}static disposeCommand(h){this.registeredCommands[h]&&(this.registeredCommands[h].dispose(),delete this.registeredCommands[h])}static clientInfoToString(h){let m="";return h?(h.extensionVersion&&(h.extensionName&&(m+=h.extensionName,m+="/"),m+=h.extensionVersion),h.applicationVersion&&(m.length>0&&(m+=" "),h.applicationName&&(m+=h.applicationName,m+="/"),m+=h.applicationVersion),h.platformVersion&&(m.length>0&&(m+=" "),h.platformName&&(m+=h.platformName,m+="/"),m+=h.platformVersion),m):m}static getExtensionVersion(h,m=!0){let y=ExtensionUtil.getPackageExtension(h).version;return m||(y=y.replace(/-.*/,"")),y}static reportCommandError(h,m){const y=`Unhandled error in '${h}' command: `;M.traceSource.error(y,m),k.Telemetry.sendFault(R.TelemetryEventNames.UNHANDLED_COMMAND_ERROR_FAULT,k.FaultType.Error,y+m.message,m),ExtensionUtil.showErrorAsync(m)}static getGlobalStoragePath(){return ExtensionUtil.context.globalStoragePath||ExtensionUtil.context.extensionPath}static openBrowser(h){process.env.VSLS_TEST_DISABLE_BROWSE?v.window.showInformationMessage("[OPEN] "+h):v.env.openExternal(v.Uri.parse(h))}static isNode(){return"undefined"!=typeof process&&void 0!==process.release&&"node"===process.release.name}static getExtensionUri(h){return M.getExtensionUri(h,ExtensionUtil.context)}static isReadWriteAnonymousEnabled(){var h;return null===(h=D.getExpService())||void 0===h?void 0:h.getTreatmentVariable("vscode","readWriteAnonymous")}static async getAnonymousReadOnlyLabel(h,m,y){if(!h)return"";const v=await h.isClientReadOnly(m.id),C=m.isAnonymous;let T,w=N.workspaceSessionInfoTracker.getAnonymousAccess(m.id),A=this.isReadWriteAnonymousEnabled()&&w===N.AnonymousAccessLevel.readWrite,k="";if(m.isHost)return k;if(y){const m=await h.isClientExplicitlyReadWrite(y);T=v&&!m&&!C}else T=v&&!C;return T?k=P.localize("guestNameViewlet.ReadOnlyLabel"):C&&(k=A?P.localize("guestNameViewlet.AnonymousReadWriteLabel"):P.localize("guestNameViewlet.ReadOnlyAndAnonymousLabel")),k}static async setTransientWorkspace(h){try{const m=v.workspace.workspaceFile.fsPath,y=JSON.parse((new TextDecoder).decode(I.fileAccess.readFileSync(m)));y.transient=h,I.fileAccess.writeFileAsync(m,JSON.stringify(y))}catch(h){x.assert(!1,"Setting transient workspace failed.")}}static async revealFileInOS(h){await v.commands.executeCommand("revealFileInOS",v.Uri.file(h))}}m.ExtensionUtil=ExtensionUtil,ExtensionUtil.contextValues={},ExtensionUtil.registeredCommands={}},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0});class TelemetryEventNames{}m.TelemetryEventNames=TelemetryEventNames,TelemetryEventNames.ADD_EXTERNAL_FILE="add-external-file",TelemetryEventNames.REMOVE_USER="remove-user",TelemetryEventNames.BLOCK_USER="block-user",TelemetryEventNames.FAULT_PREFIX="Fault/",TelemetryEventNames.ACTIVATE_EXTENSION="activate-extension",TelemetryEventNames.CLICK_SHARE_BUTTON="click-sharebutton",TelemetryEventNames.DEACTIVATE_EXTENSION="deactivate-extension",TelemetryEventNames.ACTIVATE_AGENTASYNC="activate-agentasync",TelemetryEventNames.JOIN_ON_START_EVENT="join-on-start",TelemetryEventNames.START_AGENT="start-agent",TelemetryEventNames.START_AGENT_CONNECTION="start-agentconnection",TelemetryEventNames.SIGN_IN="signin-user",TelemetryEventNames.SIGN_IN_EXPLICIT="signin-user-explicit",TelemetryEventNames.INITIATE_SESSION="initiate-session",TelemetryEventNames.PRE_RELOAD_WORKSPACE="pre-reload-workspace",TelemetryEventNames.JOIN_WORKSPACE="join-workspace",TelemetryEventNames.JOINED_PS_FROM_VIEWLET="join-ps-from-viewlet",TelemetryEventNames.SHARE_WORKSPACE="share-workspace",TelemetryEventNames.HAS_COLLABORATORS="has-collaborators",TelemetryEventNames.CREATE_INVITATION_LINK="create-invitationlink",TelemetryEventNames.CREATE_WORKSPACE="create-workspace",TelemetryEventNames.LIST_PLANNED_SESSION="list-planned-session",TelemetryEventNames.CREATE_PLANNED_SESSION="create-planned-session",TelemetryEventNames.DELETE_PLANNED_SESSION="delete-planned-session",TelemetryEventNames.RENAME_PLANNED_SESSION="rename-planned-session",TelemetryEventNames.COPY_PLANNED_SESSION_LINK="copy-planned-session-link",TelemetryEventNames.SHOW_PLANNED_SESSIONS="show-planned-sessions",TelemetryEventNames.PLANNED_SESSIONS_LIST_IS_NOT_EMPTY="planned-sessions-list-is-not-empty",TelemetryEventNames.WORKSPACE_SIGNIN_RELOAD="signin-reload-workspace",TelemetryEventNames.HTTP_REQUEST_COMPLETE="complete-httprequest",TelemetryEventNames.INITIALIZE_DEBUGGING="initialize-debugging",TelemetryEventNames.INITIALIZE_COAUTHORING="initialize-coauthoring",TelemetryEventNames.VERSION_CHECK_FAIL=TelemetryEventNames.FAULT_PREFIX+"check-version-fault",TelemetryEventNames.ASSERT_FAULT=TelemetryEventNames.FAULT_PREFIX+"assert-fault",TelemetryEventNames.DOWNLOAD_FAULT=TelemetryEventNames.FAULT_PREFIX+"download-fault",TelemetryEventNames.SIGN_IN_FAULT=TelemetryEventNames.FAULT_PREFIX+"signin-user-fault",TelemetryEventNames.SIGN_IN_FAULT_EXPLICIT=TelemetryEventNames.FAULT_PREFIX+"signin-user-fault-explicit",TelemetryEventNames.AGENT_INIT_SIGN_IN_ATTEMPT_FAULT=TelemetryEventNames.FAULT_PREFIX+"signin-agentinit-fault",TelemetryEventNames.USER_ACTION_AGENT_INIT_SIGN_IN_ATTEMPT_FAULT=TelemetryEventNames.FAULT_PREFIX+"userinteraction-agentinit-fault",TelemetryEventNames.UPDATE_WORKPSACE_NAME_FAIL=TelemetryEventNames.FAULT_PREFIX+"update-workspace-name-fault",TelemetryEventNames.LEAVE_COLLABORATION_FAIL=TelemetryEventNames.FAULT_PREFIX+"leave-collaboration-fault",TelemetryEventNames.CREATE_INVITATION_LINK_FAULT=TelemetryEventNames.FAULT_PREFIX+"create-invitationlink-fault",TelemetryEventNames.CREATE_FAULT=TelemetryEventNames.FAULT_PREFIX+"create-workspace-fault",TelemetryEventNames.LIST_PLANNED_SESSION_FAULT=TelemetryEventNames.FAULT_PREFIX+"list-planned-session-fault",TelemetryEventNames.CREATE_PLANNED_SESSION_FAULT=TelemetryEventNames.FAULT_PREFIX+"create-planned-session-fault",TelemetryEventNames.DELETE_PLANNED_SESSION_FAULT=TelemetryEventNames.FAULT_PREFIX+"delete-planned-session-fault",TelemetryEventNames.RENAME_PLANNED_SESSION_FAULT=TelemetryEventNames.FAULT_PREFIX+"rename-planned-session-fault",TelemetryEventNames.COPY_PLANNED_SESSION_LINK_FAULT=TelemetryEventNames.FAULT_PREFIX+"copy-planned-session-link-fault",TelemetryEventNames.JOIN_PLANNED_SESSION_FAULT=TelemetryEventNames.FAULT_PREFIX+"join-planned-session-fault",TelemetryEventNames.SHARE_FAULT=TelemetryEventNames.FAULT_PREFIX+"share-workspace-fault",TelemetryEventNames.JOIN_FAULT=TelemetryEventNames.FAULT_PREFIX+"join-workspace-fault",TelemetryEventNames.ACTIVATE_EXTENSION_FAULT=TelemetryEventNames.FAULT_PREFIX+"activate-extension-fault",TelemetryEventNames.DEACTIVATE_EXTENSION_FAULT=TelemetryEventNames.FAULT_PREFIX+"deactivate-extension-fault",TelemetryEventNames.ACTIVATE_AGENTASYNC_FAULT=TelemetryEventNames.FAULT_PREFIX+"activate-agentasync-fault",TelemetryEventNames.UNHANDLED_COMMAND_ERROR_FAULT=TelemetryEventNames.FAULT_PREFIX+"unhandled-commanderror-fault",TelemetryEventNames.UNHANDLED_REJECTION_FAULT=TelemetryEventNames.FAULT_PREFIX+"unhandled-rejection-fault",TelemetryEventNames.REQUEST_OPERATION_ACCESS_FAULT=TelemetryEventNames.FAULT_PREFIX+"request-operation-access-fault",TelemetryEventNames.TRANSITION="transition-state",TelemetryEventNames.REPORT_AGENTPROGRESS="report-agentprogress",TelemetryEventNames.WRITE_LOGS_FAILED=TelemetryEventNames.FAULT_PREFIX+"write-logs-failed",TelemetryEventNames.OPEN_LOGS_FAILED=TelemetryEventNames.FAULT_PREFIX+"open-logs-failed",TelemetryEventNames.NAME_LOGS_FILE_FAILED=TelemetryEventNames.FAULT_PREFIX+"name-logfile-failed",TelemetryEventNames.ACTIVATE_EXTENSION_API="activate-extensionapi",TelemetryEventNames.SHARE_EXTENSION_SERVICE="share-extensionservice",TelemetryEventNames.INVOKE_EXTENSION_COMMAND="invoke-extensioncommand",TelemetryEventNames.FEEDBACK="report-feedback",TelemetryEventNames.OPEN_LINK="open-link",TelemetryEventNames.PASTE_INVALIDLINK_FAULT=TelemetryEventNames.FAULT_PREFIX+"paste-invalidlink-fault",TelemetryEventNames.LINUX_VERSION="report-linuxversion",TelemetryEventNames.SESSION="participate-session",TelemetryEventNames.SILENT_SIGNIN_TIMEOUT=TelemetryEventNames.FAULT_PREFIX+"signin-timeout-fault",TelemetryEventNames.JOIN_FROM_BROWSER_FAULT=TelemetryEventNames.FAULT_PREFIX+"join-browser-fault",TelemetryEventNames.SHARE_TERMINAL="share-terminal",TelemetryEventNames.SHARE_TERMINAL_FAULT=TelemetryEventNames.FAULT_PREFIX+"share-terminal-fault",TelemetryEventNames.MAKE_TERMINAL_READ_ONLY="make-terminal-read-only",TelemetryEventNames.MAKE_TERMINAL_READ_ONLY_FAULT=TelemetryEventNames.FAULT_PREFIX+"make-terminal-read-only-fault",TelemetryEventNames.MAKE_TERMINAL_READ_WRITE="make-terminal-read-write",TelemetryEventNames.MAKE_TERMINAL_READ_WRITE_FAULT=TelemetryEventNames.FAULT_PREFIX+"make-terminal-read-write-fault",TelemetryEventNames.RUN_SHARED_TERMINAL_FAULT=TelemetryEventNames.FAULT_PREFIX+"run-terminal-fault",TelemetryEventNames.OPEN_TERMINAL="open-terminal",TelemetryEventNames.OPEN_TERMINAL_FAULT=TelemetryEventNames.FAULT_PREFIX+"open-terminal-fault",TelemetryEventNames.REMOVE_TERMINAL="remove-terminal",TelemetryEventNames.REMOVE_TERMINAL_FAULT=TelemetryEventNames.FAULT_PREFIX+"remove-terminal-fault",TelemetryEventNames.LIST_TERMINALS="list-terminals",TelemetryEventNames.LIST_TERMINALS_FAULT=TelemetryEventNames.FAULT_PREFIX+"list-terminals-fault",TelemetryEventNames.SHOW_WHATS_NEW_INFO="show-whatsnew",TelemetryEventNames.WELCOME_PAGE_TOAST_SHOWN="show-welcomepage-toast",TelemetryEventNames.WELCOME_PAGE_TOAST_SHOWN_INTERACTION="interact-welcomepage-toast",TelemetryEventNames.WELCOME_PAGE_SHOWN="show-welcomepage",TelemetryEventNames.WELCOME_PAGE_DISMISSED="dismiss-welcomepage",TelemetryEventNames.WELCOME_PAGE_COPY_CLICKED="copy-clicked-welcomepage",TelemetryEventNames.WELCOME_PAGE_LINK_CLICKED="link-clicked-welcomepage",TelemetryEventNames.SUMMON_PARTICIPANTS_INVOKED="summon-participants",TelemetryEventNames.COPY_COLLABORATION_LINK_INVOKLED="copy-collaborationlink",TelemetryEventNames.COMMAND_INITIATED="command-initiated",TelemetryEventNames.ZEROUSER_SESSION="zerouser-session",TelemetryEventNames.GUEST_INITIATED_DEBUGGING="guest-initiated-debugging-started",TelemetryEventNames.REJECT_RESTRICTED_OPERATION="reject-restrictedOperation",TelemetryEventNames.REQUEST_RESTRICTED_OPERATION="request-restrictedOperationAccess",TelemetryEventNames.SET_RESTRICTED_OPERATION_ACCESS="set-restrictedOperationAccess",TelemetryEventNames.REPORT_SETTINGS="report-settings",TelemetryEventNames.CHANGE_SETTING="change-setting",TelemetryEventNames.WORKSPACE_CONNECTION_ERROR="drop-workspaceconnection-fault",TelemetryEventNames.INVOKE_NEWPROTOCOLHANDLER="invoke-newprotocolhandler",TelemetryEventNames.UNDO_FAILURE="undo-failed",TelemetryEventNames.REDO_FAILURE="redo-failed",TelemetryEventNames.FOLLOW_USER_FAILURE="follow-user-failed",TelemetryEventNames.UNFOLLOW_USER_FAILURE="unfollow-user-failed",TelemetryEventNames.CHAT_WITH_CONTACT="chat-with-contact",TelemetryEventNames.CHAT_WITH_CONTACT_FAULT="chat-with-contact-fault",TelemetryEventNames.CHAT_SELECT_WINDOW="chat-select-window",TelemetryEventNames.CHAT_SELECT_WINDOW_FAULT="chat-select-window-fault",TelemetryEventNames.START_OR_JOIN_AUDIO="start-or-join-audio",TelemetryEventNames.START_OR_JOIN_AUDIO_FAULT="start-or-join-audio-fault",TelemetryEventNames.INVITE_CONTACT="invite-contact",TelemetryEventNames.INVITE_CONTACT_FAULT="invite-contact-fault",TelemetryEventNames.INVITE_CONTACT_BY_EMAIL="invite-contact-by-email",TelemetryEventNames.INVITE_CONTACT_BY_EMAIL_FAULT="invite-contact-by-email-fault",TelemetryEventNames.INVITE_NO_CONTACT_BY_EMAIL="invite-no-contact-by-email",TelemetryEventNames.INVITE_NO_CONTACT_BY_EMAIL_FAULT="invite-no-contact-by-email-fault",TelemetryEventNames.REMOVE_RECENT_CONTACT="remove-recent-contact",TelemetryEventNames.REMOVE_RECENT_CONTACT_FAULT="remove-recent-contact-fault",TelemetryEventNames.INVITE_AVAILABLE_CONTACTS="invite-available-contacts",TelemetryEventNames.INVITE_AVAILABLE_CONTACTS_FAULT="invite-available-contacts-fault",TelemetryEventNames.SELECT_PRESENCE_PROVIDER="select-presence-provider",TelemetryEventNames.SELECT_PRESENCE_PROVIDER_FAULT="select-presence-provider-fault",TelemetryEventNames.INVITE_SEARCH_CONTACTS="invite-search-contacts",TelemetryEventNames.INVITE_SEARCH_CONTACTS_FAULT="invite-search-contacts-fault",TelemetryEventNames.CHANGE_SELF_PRESENCE="change-self-presence",TelemetryEventNames.CHANGE_SELF_PRESENCE_FAULT="change-self-presence-fault",TelemetryEventNames.CHANGE_SELF_PRESENCE_STATUS="change-self-presence-status",TelemetryEventNames.CHANGE_SELF_PRESENCE_STATUS_FAULT="change-self-presence-status-fault",TelemetryEventNames.SIGN_IN_PRESENCE="sign-in-presence",TelemetryEventNames.SIGN_IN_PRESENCE_FAULT="sign-in-presence-fault",TelemetryEventNames.SIGN_OUT_PRESENCE="sign-out-presence",TelemetryEventNames.SIGN_OUT_PRESENCE_FAULT="sign-out-presence-fault",TelemetryEventNames.SHARE_SERVER="share-server",TelemetryEventNames.SHOW_LINK_INVITE_TOAST="show-invitetoast",TelemetryEventNames.RESPOND_TOAST="respond-invitetoast",TelemetryEventNames.SHARE_SERVER_FAULT=TelemetryEventNames.FAULT_PREFIX+"share-server-fault",TelemetryEventNames.UNSHARE_SERVER="unshare-server",TelemetryEventNames.UNSHARE_SERVER_FAULT=TelemetryEventNames.FAULT_PREFIX+"unshare-server-fault",TelemetryEventNames.BROWSE_SERVER="browse-server",TelemetryEventNames.BROWSE_SERVER_FAULT=TelemetryEventNames.FAULT_PREFIX+"browse-server-fault",TelemetryEventNames.COPY_URL_SERVER="copyurl-server",TelemetryEventNames.COPY_URL_SERVER_FAULT=TelemetryEventNames.FAULT_PREFIX+"copyurl-server-fault",TelemetryEventNames.LIST_SERVERS="list-servers",TelemetryEventNames.LIST_SERVERS_FAULT=TelemetryEventNames.FAULT_PREFIX+"list-servers-fault",TelemetryEventNames.OPEN_SCC_RESOURCE="open-scc-resource",TelemetryEventNames.OPEN_SCC_RESOURCE_FAULT=TelemetryEventNames.FAULT_PREFIX+"open-scc-resource-fault",TelemetryEventNames.OPEN_SCC_CHANGE="open-scc-change",TelemetryEventNames.OPEN_SCC_CHANGE_FAULT=TelemetryEventNames.FAULT_PREFIX+"open-scc-change-fault",TelemetryEventNames.DISCARD_SCC_CHANGE="discard-scc-change",TelemetryEventNames.DISCARD_SCC_CHANGE_FAULT=TelemetryEventNames.FAULT_PREFIX+"discard-scc-change-fault",TelemetryEventNames.DISCARD_ALL_SCC_CHANGES="discard-all-scc-changes",TelemetryEventNames.DISCARD_ALL_SCC_CHANGES_FAULT=TelemetryEventNames.FAULT_PREFIX+"discard-all-scc-changes-fault",TelemetryEventNames.REVERT_SCC_CHANGE="revert-scc-change",TelemetryEventNames.REVERT_SCC_CHANGE_FAULT=TelemetryEventNames.FAULT_PREFIX+"revert-scc-change-fault",TelemetryEventNames.USER_ELEVATION_TOGGLE_COMMAND="elevatetoggle-user",TelemetryEventNames.USER_ELEVATION_TOGGLE_COMMAND_FAULT=TelemetryEventNames.USER_ELEVATION_TOGGLE_COMMAND+"-fault",TelemetryEventNames.CREATE_COMMENT_THREAD="create-comment-thread",TelemetryEventNames.CREATE_COMMENT_THREAD_FAULT=TelemetryEventNames.FAULT_PREFIX+"create-comment-thread-fault",TelemetryEventNames.DELETE_COMMENT_THREAD="delete-comment-thread",TelemetryEventNames.DELETE_COMMENT_THREAD_FAULT=TelemetryEventNames.FAULT_PREFIX+"delete-comment-thread-fault",TelemetryEventNames.REPLY_COMMENT="reply-comment",TelemetryEventNames.REPLY_COMMENT_FAULT=TelemetryEventNames.FAULT_PREFIX+"reply-comment-fault",TelemetryEventNames.EDIT_COMMENT="edit-comment",TelemetryEventNames.EDIT_COMMENT_FAULT=TelemetryEventNames.FAULT_PREFIX+"edit-comment-fault",TelemetryEventNames.DELETE_COMMENT="delete-comment",TelemetryEventNames.DELETE_COMMENT_FAULT=TelemetryEventNames.FAULT_PREFIX+"delete-comment-fault",TelemetryEventNames.SAVE_COMMENT="save-comment",TelemetryEventNames.SAVE_COMMENT_FAULT=TelemetryEventNames.FAULT_PREFIX+"save-comment-fault",TelemetryEventNames.CANCEL_EDIT_COMMENT="cancel-edit-comment",TelemetryEventNames.CANCEL_EDIT_COMMENT_FAULT=TelemetryEventNames.FAULT_PREFIX+"cancel-edit-comment-fault",TelemetryEventNames.DISMISS_SURVEY="dismiss-survey",TelemetryEventNames.EVALUATED_CLIENT_FOR_EXPERIMENT="evaluated-client-for-experiment",TelemetryEventNames.TOKEN_EXPIRED="token-expired-presence-fault",TelemetryEventNames.AUDIO_CONNECT_CALL="audio-connect-call",TelemetryEventNames.AUDIO_CALL_STARTED_NOTIFICATION="audio-call-started-notification",TelemetryEventNames.AUDIO_CALL_INFO_NOTIFICATION="audio-call-info-notification",TelemetryEventNames.AUDIO_CALL_UNEXPECTED_NOTIFICATION="audio-call-unexpected-notification",TelemetryEventNames.AUDIO_INVALID_SESSION_TRANSITION="audio-invalid-session-transition",TelemetryEventNames.AUDIO_GET_SELECTED_DEVICES="audio-get-selected-devices",TelemetryEventNames.AUDIO_GET_PARTICIPANTS="audio-get-participants",TelemetryEventNames.AUDIO_END_CALL="audio-end-call",TelemetryEventNames.AUDIO_ENUMERATE_DEVICES="audio-enumerate-devices",TelemetryEventNames.AUDIO_MUTE="audio-mute",TelemetryEventNames.AUDIO_UNMUTE="audio-unmute",TelemetryEventNames.AUDIO_SELECT_DEVICE="audio-select-device",TelemetryEventNames.INSTALL_RECOVERY="install-recovery",TelemetryEventNames.INSTALL_RECOVERY_TOAST="install-recovery-toast",TelemetryEventNames.DELETE_RUNTIME_DEPENDENCIES="delete-runtime-dependencies",TelemetryEventNames.JOIN_PROMPT_DISPLAYED="join-prompt-displayed",TelemetryEventNames.CHAT_HANDSHAKE_REQUEST="chat-handshake-request",TelemetryEventNames.CHAT_HANDSHAKE_RESPONSE="chat-handshake-response",TelemetryEventNames.CHAT_UNKNOWN_USER_ID="chat-unknown-user-id",TelemetryEventNames.CHAT_DISABLED_MESSAGE="chat-disabled-message",TelemetryEventNames.CHAT_COMMAND_INVOKED="chat-command-invoked",TelemetryEventNames.CHAT_CREATE_WINDOW="chat-create-window",TelemetryEventNames.CHAT_UPDATE_WINDOW="chat-update-window",TelemetryEventNames.CHAT_ISCONNECTED_CHANGED="chat-isconnected-changed",TelemetryEventNames.CHAT_NOTIFY="chat-notify",TelemetryEventNames.CHAT_FAULT="chat-fault",TelemetryEventNames.CHAT_OPEN_SESSION="chat-open-session",TelemetryEventNames.CHAT_OPEN_SESSION_FAULT=TelemetryEventNames.FAULT_PREFIX+"chat-open-session-fault",TelemetryEventNames.RESPOND_ANONYMOUS_JOIN_REQUEST="respond-anonymous-join-request",TelemetryEventNames.AUTH_PROMPTED_SIGNIN="auth-prompted-signin",TelemetryEventNames.AUTH_SILENT_CHECK="auth-silent-check",TelemetryEventNames.UPDATE_ANONYMOUS_GUEST_ACCESS_LEVEL="update-anonymous-guest-access-level",TelemetryEventNames.TRY_LOAD_SESSION="try-load-session",TelemetryEventNames.COLLABORATE_BLOCK="collaborate-block",TelemetryEventNames.PIN="pin",TelemetryEventNames.INITIALIZE_ACCESSIBILITY_MANAGER="initialize-accessibilitymanager",TelemetryEventNames.SYNTHESIZE_SPEECH_FAULT="synthesize-speech-fault",TelemetryEventNames.FOCUS_PARTICIPANT="focus-participant",TelemetryEventNames.FOCUS_PARTICIPANTS="focus-participants",TelemetryEventNames.OPEN_IN_OTHER_EDITOR="open-in-other-editor",TelemetryEventNames.LAUNCHER_CLIENT_SELECTION="launcher-client-selection",TelemetryEventNames.LAUNCHER_CLIENT_CANCEL="launcher-client-cancel",TelemetryEventNames.SWITCH_BACK_TO_WEB_EDITOR="switch-back-to-web-editor";class TelemetryPropertyNames{}m.TelemetryPropertyNames=TelemetryPropertyNames,TelemetryPropertyNames.FEATURE_NAME="liveshare.",TelemetryPropertyNames.FEATURE_NAME_V2=TelemetryPropertyNames.FEATURE_NAME+"v2.",TelemetryPropertyNames.AGENT_START_AGENT_FOUND=TelemetryPropertyNames.FEATURE_NAME+"AgentFound",TelemetryPropertyNames.AGENT_SPAWN_START_TIME=TelemetryPropertyNames.FEATURE_NAME+"AgentSpawnStartTime",TelemetryPropertyNames.AGENT_SPAWN_END_TIME=TelemetryPropertyNames.FEATURE_NAME+"AgentSpawnEndTime",TelemetryPropertyNames.CORRELATION_ID=TelemetryPropertyNames.FEATURE_NAME+"CorrelationId",TelemetryPropertyNames.EVENT_RESULT=TelemetryPropertyNames.FEATURE_NAME+"Result",TelemetryPropertyNames.EVENT_MESSAGE=TelemetryPropertyNames.FEATURE_NAME+"Message",TelemetryPropertyNames.EVENT_EXCEPTION_STACK=TelemetryPropertyNames.FEATURE_NAME+"ExceptionStack",TelemetryPropertyNames.EVENT_EXCEPTION_CODE=TelemetryPropertyNames.FEATURE_NAME+"ExceptionCode",TelemetryPropertyNames.EVENT_DURATION=TelemetryPropertyNames.FEATURE_NAME+"Duration",TelemetryPropertyNames.IS_DEBUGGING=TelemetryPropertyNames.FEATURE_NAME+"IsDebugging",TelemetryPropertyNames.IS_VSCODE_ACCOUNT_ENABLED=TelemetryPropertyNames.FEATURE_NAME+"IsVSCodeAccountEnabled",TelemetryPropertyNames.IS_VSCODE_ACCOUNT_AUTH_SUPPORTED=TelemetryPropertyNames.FEATURE_NAME+"IsVSCodeAccountSupported",TelemetryPropertyNames.IS_MAC_OSX_CATALINA_OR_NEWER=TelemetryPropertyNames.FEATURE_NAME+"IsMacOSxCatalinaOrNewer",TelemetryPropertyNames.AUTH_FLOW_INITIALIZATION_COMMAND=TelemetryPropertyNames.FEATURE_NAME+"AuthFlowInitializationCommand",TelemetryPropertyNames.SILENT_SIGN_IN=TelemetryPropertyNames.FEATURE_NAME+"SilentSignIn",TelemetryPropertyNames.SIGN_IN_WITH_CODE=TelemetryPropertyNames.FEATURE_NAME+"WithCode",TelemetryPropertyNames.SIGN_IN_WITH_BROWSER=TelemetryPropertyNames.FEATURE_NAME+"BrowserSignIn",TelemetryPropertyNames.JOIN_WITH_LINK=TelemetryPropertyNames.FEATURE_NAME+"WithLink",TelemetryPropertyNames.COMMAND_TEXT=TelemetryPropertyNames.FEATURE_NAME+"CommandText",TelemetryPropertyNames.JOIN_INVOKE_COMMAND=TelemetryPropertyNames.FEATURE_NAME+"CommandText",TelemetryPropertyNames.TELEMETRY_EVENT_VERSION=TelemetryPropertyNames.FEATURE_NAME+"TelemetryEventVersion",TelemetryPropertyNames.SHARE_WORKSPACE_STARTING=TelemetryPropertyNames.FEATURE_NAME+"ShareWorkspaceStarting",TelemetryPropertyNames.SHARE_WORKSPACE_COMPLETE=TelemetryPropertyNames.FEATURE_NAME+"ShareWorkspaceComplete",TelemetryPropertyNames.SHARE_WORKSPACE_COUNT_OF_WORKSPACE_FOLDERS=TelemetryPropertyNames.FEATURE_NAME+"WorkspaceFolderCount",TelemetryPropertyNames.SHARED_AS_PLANNED_SESSION=TelemetryPropertyNames.FEATURE_NAME+"SharedAsPlannedSession",TelemetryPropertyNames.FIREWALL_CHECK_COMPLETE=TelemetryPropertyNames.FEATURE_NAME+"FirewallCheckComplete",TelemetryPropertyNames.FIREWALL_CHECK_STARTING=TelemetryPropertyNames.FEATURE_NAME+"FirewallCheckStarting",TelemetryPropertyNames.GET_WORKSPACE_COMPLETE=TelemetryPropertyNames.FEATURE_NAME+"GetWorkspaceComplete",TelemetryPropertyNames.INIT_COEDITING_COMPLETE=TelemetryPropertyNames.FEATURE_NAME+"InitCoeditingComplete",TelemetryPropertyNames.INIT_DEBUGGING_COMPLETE=TelemetryPropertyNames.FEATURE_NAME+"InitDebuggingComplete",TelemetryPropertyNames.INIT_LSP_COMPLETE=TelemetryPropertyNames.FEATURE_NAME+"InitLspComplete",TelemetryPropertyNames.INIT_BREAKPOINT_COMPLETE=TelemetryPropertyNames.FEATURE_NAME+"InitBreakpointComplete",TelemetryPropertyNames.INIT_TASK_COMPLETE=TelemetryPropertyNames.FEATURE_NAME+"InitTaskComplete",TelemetryPropertyNames.INIT_ACCESS_CONTROL_COMPLETE=TelemetryPropertyNames.FEATURE_NAME+"InitAccessControlComplete",TelemetryPropertyNames.INIT_TEXT_SEARCH_SERVICE_COMPLETE=TelemetryPropertyNames.FEATURE_NAME+"InitTextSearchServiceComplete",TelemetryPropertyNames.INIT_GUEST_CHANNEL_SERVICE_COMPLETE=TelemetryPropertyNames.FEATURE_NAME+"InitGuestChannelServiceComplete",TelemetryPropertyNames.INIT_GUEST_NOTEBOOKS_SERVICE_COMPLETE=TelemetryPropertyNames.FEATURE_NAME+"InitGuestNotebooksServiceComplete",TelemetryPropertyNames.INIT_SOURCE_CONTROL_SERVICE_COMPLETE=TelemetryPropertyNames.FEATURE_NAME+"InitSourceControlServiceComplete",TelemetryPropertyNames.INIT_COMMENT_SERVICE_COMPLETE=TelemetryPropertyNames.FEATURE_NAME+"InitCommentServiceComplete",TelemetryPropertyNames.INIT_SYNC_SERVICE_COMPLETE=TelemetryPropertyNames.FEATURE_NAME+"InitSyncServiceComplete",TelemetryPropertyNames.INIT_FILE_SERVICE_COMPLETE=TelemetryPropertyNames.FEATURE_NAME+"InitFileServiceComplete",TelemetryPropertyNames.INIT_HOST_NOTEBOOKS_SERVICE_COMPLETE=TelemetryPropertyNames.FEATURE_NAME+"InitHostNotebooksServiceComplete",TelemetryPropertyNames.INIT_COMMENT_MANAGER_COMPLETE=TelemetryPropertyNames.FEATURE_NAME+"InitCommentManagerComplete",TelemetryPropertyNames.INIT_COMMAND_COMPLETE=TelemetryPropertyNames.FEATURE_NAME+"InitCommandComplete",TelemetryPropertyNames.INIT_PATH_MANAGER_COMPLETE=TelemetryPropertyNames.FEATURE_NAME+"InitPathManagerComplete",TelemetryPropertyNames.REJECTED_BY_HOST=TelemetryPropertyNames.FEATURE_NAME+"RejectedByHost",TelemetryPropertyNames.REJECTED_BY_HOST_AS_ANONYMOUS=TelemetryPropertyNames.FEATURE_NAME+"RejectedByHostAsAnonymous",TelemetryPropertyNames.JOIN_REQUEST_TIMED_OUT=TelemetryPropertyNames.FEATURE_NAME+"JoinRequestTimedOut",TelemetryPropertyNames.WORKSPACE_NOT_FOUND=TelemetryPropertyNames.FEATURE_NAME+"WorkspaceNotFound",TelemetryPropertyNames.UNAUTHORIZED=TelemetryPropertyNames.FEATURE_NAME+"Unauthorized",TelemetryPropertyNames.RELOAD_START_TIME=TelemetryPropertyNames.FEATURE_NAME+"ReloadStartTime",TelemetryPropertyNames.RELOAD_RESUMED_TIME=TelemetryPropertyNames.FEATURE_NAME+"ReloadResumedTime",TelemetryPropertyNames.RELOAD_END_TIME=TelemetryPropertyNames.FEATURE_NAME+"ReloadEndTime",TelemetryPropertyNames.JOIN_WORKSPACE_COMPLETE=TelemetryPropertyNames.FEATURE_NAME+"JoinWorkspaceComplete",TelemetryPropertyNames.SERVICE_ENDPOINT=TelemetryPropertyNames.FEATURE_NAME+"ServiceEndpoint",TelemetryPropertyNames.IS_HOST=TelemetryPropertyNames.FEATURE_NAME+"IsHost",TelemetryPropertyNames.IS_READONLY_SESSION=TelemetryPropertyNames.FEATURE_NAME+"IsReadOnlySession",TelemetryPropertyNames.CREATE_WORKSPACE=TelemetryPropertyNames.FEATURE_NAME+"CreateWorkspace",TelemetryPropertyNames.CREATE_PLANNED_SESSION=TelemetryPropertyNames.FEATURE_NAME+"CreatePlannedSession",TelemetryPropertyNames.DELETE_PLANNED_SESSION=TelemetryPropertyNames.FEATURE_NAME+"DeletePlannedSession",TelemetryPropertyNames.RENAME_PLANNED_SESSION=TelemetryPropertyNames.FEATURE_NAME+"RenamePlannedSession",TelemetryPropertyNames.LIST_PLANNED_SESSION=TelemetryPropertyNames.FEATURE_NAME+"ListPlannedSession",TelemetryPropertyNames.COPY_PLANNED_SESSION_LINK=TelemetryPropertyNames.FEATURE_NAME+"CopyPlannedSessionLink",TelemetryPropertyNames.JOIN_PLANNED_SESSION=TelemetryPropertyNames.FEATURE_NAME+"JoinPlannedSession",TelemetryPropertyNames.PERSISTENT_WORKSPACE_EXISTS=TelemetryPropertyNames.FEATURE_NAME+"PersistentWorkspaceExists",TelemetryPropertyNames.SHARE_FROM_CREATE_WORKSPACE=TelemetryPropertyNames.FEATURE_NAME+"ShareFromCreateWorkspace",TelemetryPropertyNames.COPYLINK_FROM_CREATE_WORKSPACE=TelemetryPropertyNames.FEATURE_NAME+"CopyLinkFromCreateWorkspace",TelemetryPropertyNames.MOREINFO_FROM_CREATE_WORKSPACE=TelemetryPropertyNames.FEATURE_NAME+"MoreInfoFromCreateWorkspace",TelemetryPropertyNames.CONVERSATION_ID=TelemetryPropertyNames.FEATURE_NAME_V2+"ConversationId",TelemetryPropertyNames.VERSION_PLATFORMNAME=TelemetryPropertyNames.FEATURE_NAME+"Version.PlatformName",TelemetryPropertyNames.VERSION_PLATFORMVERSION=TelemetryPropertyNames.FEATURE_NAME+"Version.PlatformVersion",TelemetryPropertyNames.VERSION_PLATFORMVERSION_SERVICEPACK=TelemetryPropertyNames.FEATURE_NAME+"Version.PlatformVersion.ServicePack",TelemetryPropertyNames.FAULT_TYPE=TelemetryPropertyNames.FEATURE_NAME+"FaultType",TelemetryPropertyNames.ENVIRONMENT_VECTOR=TelemetryPropertyNames.FEATURE_NAME+"EnvironmentVector",TelemetryPropertyNames.PERFORMANCE_RUN=TelemetryPropertyNames.FEATURE_NAME+"PerformanceRun",TelemetryPropertyNames.CURRENT_STATE=TelemetryPropertyNames.FEATURE_NAME+"CurrentState",TelemetryPropertyNames.NEXT_STATE=TelemetryPropertyNames.FEATURE_NAME+"NextState",TelemetryPropertyNames.TRANSITION_ACTION=TelemetryPropertyNames.FEATURE_NAME+"TransitionAction",TelemetryPropertyNames.EXTENSION_ACTIVATION_INITIAL_INIT_COMPLETE=TelemetryPropertyNames.FEATURE_NAME+"ExtensionActivationInitialInitComplete",TelemetryPropertyNames.EXTENSION_ACTIVATION_COMPAT_CHECK_COMPLETE=TelemetryPropertyNames.FEATURE_NAME+"ExtensionActivationCompatCheckComplete",TelemetryPropertyNames.EXTENSION_ACTIVATION_AGENT_PROCESS_SETUP_COMPLETE=TelemetryPropertyNames.FEATURE_NAME+"ExtensionActivationAgentProcessSetupComplete",TelemetryPropertyNames.EXTENSION_ACTIVATION_POST_JOIN=TelemetryPropertyNames.FEATURE_NAME+"ActivatedPostJoin",TelemetryPropertyNames.JOIN_FROM_BROWSER=TelemetryPropertyNames.FEATURE_NAME+"JoinFromBrowser",TelemetryPropertyNames.JOIN_DEBUG_SESSION_OPTION=TelemetryPropertyNames.FEATURE_NAME+"JoinDebugSessionOption",TelemetryPropertyNames.IS_FIRST_ACTIVATION=TelemetryPropertyNames.FEATURE_NAME+"IsFirstActivation",TelemetryPropertyNames.IS_FIRST_EXTENSION_RUN=TelemetryPropertyNames.FEATURE_NAME+"IsFirstExtensionRun",TelemetryPropertyNames.IS_ELECTRON_DEPENDENCY_SHOULD_BE_INSTALLED=TelemetryPropertyNames.FEATURE_NAME+"IsElectronDependencyShouldBeInstalled",TelemetryPropertyNames.IS_ELECTRON_DEPENDENCY_INSTALLED=TelemetryPropertyNames.FEATURE_NAME+"IsElectronDependencyInstalled",TelemetryPropertyNames.IS_RUNTIME_DEPENDENCIES_INSTALLED=TelemetryPropertyNames.FEATURE_NAME+"IsRuntimeDependenciesInstalled",TelemetryPropertyNames.IS_EXTENSION_BEING_UPDATED=TelemetryPropertyNames.FEATURE_NAME+"isExtensionBeingUpdated",TelemetryPropertyNames.IS_EXTENSION_PACK_CANDIDATE_PRESENT=TelemetryPropertyNames.FEATURE_NAME+"isExtensionPackCandidatePresent",TelemetryPropertyNames.SHOWED_INITIAL_INSTALL_INFO_PAGE=TelemetryPropertyNames.FEATURE_NAME+"ShowedInitialInstallInfoPage",TelemetryPropertyNames.INITIAL_INSTALL_INFO_PAGE_EXPERIMENT_OPEN_BY_DEFAULT=TelemetryPropertyNames.FEATURE_NAME+"InitialInstallInfoPageExperimentOpenByDefault",TelemetryPropertyNames.NAME_TAG_VISIBILITY=TelemetryPropertyNames.FEATURE_NAME+"NameTagVisibility",TelemetryPropertyNames.NUM_DEBUGGING_PROCESSES=TelemetryPropertyNames.FEATURE_NAME+"NumDebuggingProcesses",TelemetryPropertyNames.DEBUG_PROMPT=TelemetryPropertyNames.FEATURE_NAME+"DebugPrompt",TelemetryPropertyNames.NUM_OPEN_FILES=TelemetryPropertyNames.FEATURE_NAME+"NumOpenFiles",TelemetryPropertyNames.IS_INTERNAL=TelemetryPropertyNames.FEATURE_NAME+"IsInternal",TelemetryPropertyNames.IS_CLOUD_ENVIRONMENT=TelemetryPropertyNames.FEATURE_NAME+"IsCloudEnvironment",TelemetryPropertyNames.USER_TEAM_STATUS=TelemetryPropertyNames.FEATURE_NAME+"UserTeamStatus",TelemetryPropertyNames.CONNECTION_MODE=TelemetryPropertyNames.FEATURE_NAME+"ConnectionMode",TelemetryPropertyNames.CONNECTION_MODE_USED=TelemetryPropertyNames.FEATURE_NAME+"ConnectionModeUsed",TelemetryPropertyNames.CREATED_AT=TelemetryPropertyNames.FEATURE_NAME+"CreatedAt",TelemetryPropertyNames.UPDATED_AT=TelemetryPropertyNames.FEATURE_NAME+"UpdatedAt",TelemetryPropertyNames.EXPIRES_AT=TelemetryPropertyNames.FEATURE_NAME+"ExpiresAt",TelemetryPropertyNames.PROGRESS_DURATION=TelemetryPropertyNames.FEATURE_NAME+"ProgressDuration",TelemetryPropertyNames.AGENT_START_INITAL_DATA=TelemetryPropertyNames.FEATURE_NAME+"InitialData",TelemetryPropertyNames.AGENT_START_RESOLVED_STATE=TelemetryPropertyNames.FEATURE_NAME+"ResolvedState",TelemetryPropertyNames.AGENT_START_PROCESS_SPAWN_COMMAND_SENT=TelemetryPropertyNames.FEATURE_NAME+"ProcessSpawnCommandSent",TelemetryPropertyNames.AGENT_START_CONNECTION_RETRY_COUNT=TelemetryPropertyNames.FEATURE_NAME+"RetryCount",TelemetryPropertyNames.AGENT_START_CONNECTION_URI_PROTOCOL=TelemetryPropertyNames.FEATURE_NAME+"UriProtocol",TelemetryPropertyNames.AGENT_START_CONNECTION_OWNER=TelemetryPropertyNames.FEATURE_NAME+"Owner",TelemetryPropertyNames.AGENT_WAS_DOWNLOAD_CORRUPTED=TelemetryPropertyNames.FEATURE_NAME+"WasDownloadCorrupted",TelemetryPropertyNames.CLIENT_LOG_LINES=TelemetryPropertyNames.FEATURE_NAME+"ClientLogLines",TelemetryPropertyNames.AGENT_LOG_LINES=TelemetryPropertyNames.FEATURE_NAME+"AgentLogLines",TelemetryPropertyNames.FEATURE_FLAGS=TelemetryPropertyNames.FEATURE_NAME+"FeatureFlags",TelemetryPropertyNames.EXTENSION_REQUESTED_API_VERSION=TelemetryPropertyNames.FEATURE_NAME+"ExtensionRequestedApiVersion",TelemetryPropertyNames.EXTENSION_NAME=TelemetryPropertyNames.FEATURE_NAME+"ExtensionName",TelemetryPropertyNames.EXTENSION_VERSION=TelemetryPropertyNames.FEATURE_NAME+"ExtensionVersion",TelemetryPropertyNames.EXTENSION_INVOKED_COMMAND=TelemetryPropertyNames.FEATURE_NAME+"ExtensionInvokedCommand",TelemetryPropertyNames.EXTENSION_INVOKED_COMMAND_OPTIONS=TelemetryPropertyNames.FEATURE_NAME+"ExtensionInvokedCommandOptions",TelemetryPropertyNames.EXTENSION_SERVICE_NAME=TelemetryPropertyNames.FEATURE_NAME+"ExtensionServiceName",TelemetryPropertyNames.EXTENSION_SERVICE_PERMITTED=TelemetryPropertyNames.FEATURE_NAME+"ExtensionServicePermitted",TelemetryPropertyNames.START_WAITING_FOR_HOST=TelemetryPropertyNames.FEATURE_NAME+"StartWaitingForHost",TelemetryPropertyNames.DONE_WAITING_FOR_HOST=TelemetryPropertyNames.FEATURE_NAME+"DoneWaitingForHost",TelemetryPropertyNames.RECONNECTING_TO_HOST=TelemetryPropertyNames.FEATURE_NAME+"ReconnectingToHost",TelemetryPropertyNames.RECONNECTED_TO_HOST=TelemetryPropertyNames.FEATURE_NAME+"ReconnectedToHost",TelemetryPropertyNames.GUEST_CANCELED=TelemetryPropertyNames.FEATURE_NAME+"GuestCanceled",TelemetryPropertyNames.TRANSITION_SEQUENCE=TelemetryPropertyNames.FEATURE_NAME+"TransitionSequence",TelemetryPropertyNames.TIME_SINCE_LAST_TRANSITION=TelemetryPropertyNames.FEATURE_NAME+"TimeSinceLastTransition",TelemetryPropertyNames.GUESTS_BY_IDE=TelemetryPropertyNames.FEATURE_NAME+"GuestsByIDE",TelemetryPropertyNames.DISTINCT_GUESTS_BY_IDE=TelemetryPropertyNames.FEATURE_NAME+"DistinctGuestsByIDE",TelemetryPropertyNames.ACTIVE_COLLABORATION_DURATION=TelemetryPropertyNames.FEATURE_NAME+"ActiveCollaborationDuration",TelemetryPropertyNames.ACTIVE_COLLABORATION_BLOCKS=TelemetryPropertyNames.FEATURE_NAME+"ActiveCollaborationBlocks",TelemetryPropertyNames.FILE_NAME=TelemetryPropertyNames.FEATURE_NAME+"FileName",TelemetryPropertyNames.RELOAD_POST_TIMEOUT=TelemetryPropertyNames.FEATURE_NAME+"ReloadPostTimeout",TelemetryPropertyNames.SHARED_TERMINAL_SHELL=TelemetryPropertyNames.FEATURE_NAME+"SharedTerminalShell",TelemetryPropertyNames.SHARED_TERMINAL_READONLY=TelemetryPropertyNames.FEATURE_NAME+"SharedTerminalReadOnly",TelemetryPropertyNames.IS_ALTERNATE_SHARE_BUTTON_TEXT=TelemetryPropertyNames.FEATURE_NAME+"AlternateShareButtonText",TelemetryPropertyNames.COMMAND_AUTH_RETRY_COUNT=TelemetryPropertyNames.FEATURE_NAME+"CommandAuthRetryCount",TelemetryPropertyNames.COMMAND_DID_AUTH=TelemetryPropertyNames.FEATURE_NAME+"CommandDidAuth",TelemetryPropertyNames.COMMAND_ALLOWS_ANONYMOUS=TelemetryPropertyNames.FEATURE_NAME+"COMMAND_ALLOWS_ANONYMOUS",TelemetryPropertyNames.COMMAND_SHOULED_SKIP_ANONYMOUS_PROMPT=TelemetryPropertyNames.FEATURE_NAME+"CommandShouldSkipAnonymousPrompt",TelemetryPropertyNames.COMMAND_DID_AUTH_FULL=TelemetryPropertyNames.FEATURE_NAME+"CommandDidAuthFull",TelemetryPropertyNames.COMMAND_AUTO_AUTHED_ANONYMOUSLY_BUT_ANONYMOUS_NOT_ALLOWED=TelemetryPropertyNames.FEATURE_NAME+"CommandAutoAuthedAnonymouslyButAnonymousNotAllowed",TelemetryPropertyNames.COMMAND_AUTO_AUTHED_RESULT=TelemetryPropertyNames.FEATURE_NAME+"CommandAutoAuthedResult",TelemetryPropertyNames.COMMAND_STARTED_UNAUTHENTICATED=TelemetryPropertyNames.FEATURE_NAME+"CommandStartedUnauthenticated",TelemetryPropertyNames.COMMAND_SHOULD_SHOW_ANONYMOUS_TOAST=TelemetryPropertyNames.FEATURE_NAME+"CommandShouldShowAnonymousToast",TelemetryPropertyNames.COMMAND_STARTED_BLOCKING_AUTH=TelemetryPropertyNames.FEATURE_NAME+"CommandStartedBlockingAuth",TelemetryPropertyNames.COMMAND_BLOCKING_ANONYMOUS_LOGIN_FLOW_RESULT=TelemetryPropertyNames.FEATURE_NAME+"CommandBlockingAnonymousLoginFlowResult",TelemetryPropertyNames.COMMAND_BLOCKING_NON_ANONYMOUS_LOGIN_FLOW_RESULT=TelemetryPropertyNames.FEATURE_NAME+"CommandBlockingNonAnonymousLoginFlowResult",TelemetryPropertyNames.COMMAND_AUTH_PROMPT_QUESTION_RESULT=TelemetryPropertyNames.FEATURE_NAME+"CommandAuthPromptQuestionResult",TelemetryPropertyNames.COMMAND_AUTH_PROMPT_OPENED=TelemetryPropertyNames.FEATURE_NAME+"CommandAuthPromptOpened",TelemetryPropertyNames.USER_OPTED_OUT_TO_AUTH_ON_JOIN=TelemetryPropertyNames.FEATURE_NAME+"UserOptedOutToAuthOnJoin",TelemetryPropertyNames.USER_PICKED_NAME_LENGTH=TelemetryPropertyNames.FEATURE_NAME+"UserPickedNameLength",TelemetryPropertyNames.USER_PICKED_DEFAULT_NAME=TelemetryPropertyNames.FEATURE_NAME+"UserPickedDefaultName",TelemetryPropertyNames.COMMAND_COMPLETED_AUTH_FULL=TelemetryPropertyNames.FEATURE_NAME+"CommandCompleteAuthFull",TelemetryPropertyNames.MORE_INFO_CLICKED=TelemetryPropertyNames.FEATURE_NAME+"MoreInfoClicked",TelemetryPropertyNames.ZEROUSER_SESSION_REASON=TelemetryPropertyNames.FEATURE_NAME+"ZeroUserSessionReason",TelemetryPropertyNames.DEBUGGING_STARTED_WORKSPACE_FOLDER=TelemetryPropertyNames.FEATURE_NAME+"DebuggingStartedForWorkspaceFolder",TelemetryPropertyNames.DEBUGGING_STARTED_WORKSPACE_FOLDER_COUNT=TelemetryPropertyNames.FEATURE_NAME+"DebuggingWorkspaceFolderCount",TelemetryPropertyNames.OPERATION_NAME=TelemetryPropertyNames.FEATURE_NAME+"OperationName",TelemetryPropertyNames.OPERATION_ACCESS=TelemetryPropertyNames.FEATURE_NAME+"OperationAccess",TelemetryPropertyNames.REJECTION_REASON=TelemetryPropertyNames.FEATURE_NAME+"RejectionReason",TelemetryPropertyNames.SETTING_VALUES=TelemetryPropertyNames.FEATURE_NAME+"Settings",TelemetryPropertyNames.USER_DISMISSED_SIGN_IN_MODAL=TelemetryPropertyNames.FEATURE_NAME+"UserDismissedSignInModal",TelemetryPropertyNames.SIGN_IN_MODAL_URL_CHANGES=TelemetryPropertyNames.FEATURE_NAME+"SignInModalURLChanges",TelemetryPropertyNames.SESSION_ID=TelemetryPropertyNames.FEATURE_NAME+"LiveShareSessionId",TelemetryPropertyNames.RELOAD_SELECTED=TelemetryPropertyNames.FEATURE_NAME+"UserSelectedReload",TelemetryPropertyNames.INIT_SEARCHPROVIDER_COMPLETE=TelemetryPropertyNames.FEATURE_NAME+"InitSearchProviderComplete",TelemetryPropertyNames.ADD_ADDITIONALROOTS_COMPLETE=TelemetryPropertyNames.FEATURE_NAME+"AddAdditionalRootsComplete",TelemetryPropertyNames.JOIN_WITHOUT_RELOAD=TelemetryPropertyNames.FEATURE_NAME+"JoinWithoutReload",TelemetryPropertyNames.JOIN_FROM_PROTOCOL_HANDLER=TelemetryPropertyNames.FEATURE_NAME+"JoinFromProtocolHandler",TelemetryPropertyNames.JOIN_FROM_INVITE_LINK=TelemetryPropertyNames.FEATURE_NAME+"JoinFromInviteLink",TelemetryPropertyNames.URI=TelemetryPropertyNames.FEATURE_NAME+"Uri",TelemetryPropertyNames.JOIN_CORRELATION_ID=TelemetryPropertyNames.FEATURE_NAME+"JoinCorrelationId",TelemetryPropertyNames.SIGN_IN_RETRIES=TelemetryPropertyNames.FEATURE_NAME+"SignInRetries",TelemetryPropertyNames.EMPTY_WORKSPACE_FOLDERS_OPENED=TelemetryPropertyNames.FEATURE_NAME+"EmptyWorkspaceFoldersOpened",TelemetryPropertyNames.AUTO_SHARING_ON_LOAD=TelemetryPropertyNames.FEATURE_NAME+"AutoSharingOnLoad",TelemetryPropertyNames.STATE_EVENT_FIRST=TelemetryPropertyNames.FEATURE_NAME+"StateEventFirst",TelemetryPropertyNames.STATE_EVENT_LAST=TelemetryPropertyNames.FEATURE_NAME+"StateEventLast",TelemetryPropertyNames.STATE_EVENT_ORDER=TelemetryPropertyNames.FEATURE_NAME+"StateEventOrder",TelemetryPropertyNames.STATUS_EVENT_ORDER=TelemetryPropertyNames.FEATURE_NAME+"StatusEventOrder",TelemetryPropertyNames.EXTERNAL_SIGNIN_STARTING=TelemetryPropertyNames.FEATURE_NAME+"ExternalSignInStarting",TelemetryPropertyNames.EXTERNAL_SIGNIN_USER_MADE_VENDOR_CHOICE=TelemetryPropertyNames.FEATURE_NAME+"ExternalSignInUserMadeVendorChoice",TelemetryPropertyNames.EXTERNAL_SIGNIN_USER_COMPLETE_FLOW=TelemetryPropertyNames.FEATURE_NAME+"ExternalSignInUserCompleteFlow",TelemetryPropertyNames.EXTERNAL_SIGNIN_USER_COMPLETE_FLOW_TOKEN_SET=TelemetryPropertyNames.FEATURE_NAME+"ExternalSignInUserCompleteFlowTokenSet",TelemetryPropertyNames.BROWSER_NAME=TelemetryPropertyNames.FEATURE_NAME+"BrowserName",TelemetryPropertyNames.BROWSER_VERSION=TelemetryPropertyNames.FEATURE_NAME+"BrowserVersion",TelemetryPropertyNames.EXTERNAL_SIGNIN_SELECTED_VENDOR=TelemetryPropertyNames.FEATURE_NAME+"ExternalSignInSelectedVendor",TelemetryPropertyNames.EXTERNAL_SIGNIN_COMPLETE=TelemetryPropertyNames.FEATURE_NAME+"ExternalSignInComplete",TelemetryPropertyNames.ATTEMPT_DEFAULT_LOGIN_STARTING=TelemetryPropertyNames.FEATURE_NAME+"AttemptDefaultLoginStarting",TelemetryPropertyNames.ATTEMPT_DEFAULT_LOGIN_COMPLETE=TelemetryPropertyNames.FEATURE_NAME+"AttemptDefaultLoginComplete",TelemetryPropertyNames.ATTEMPT_LOGIN_STARTING=TelemetryPropertyNames.FEATURE_NAME+"AttemptLoginStarting",TelemetryPropertyNames.ATTEMPT_LOGIN_COMPLETE=TelemetryPropertyNames.FEATURE_NAME+"AttemptLoginComplete",TelemetryPropertyNames.ATTEMPT_ANONYMOUS_LOGIN_STARTING=TelemetryPropertyNames.FEATURE_NAME+"AttemptAnonymousLoginStarting",TelemetryPropertyNames.ATTEMPT_ANONYMOUS_LOGIN_COMPLETE=TelemetryPropertyNames.FEATURE_NAME+"AttemptAnonymousLoginComplete",TelemetryPropertyNames.SILENT_NATIVE_LOGIN_STARTING=TelemetryPropertyNames.FEATURE_NAME+"SilentNativeLoginStarting",TelemetryPropertyNames.SILENT_NATIVE_LOGIN_RESULT=TelemetryPropertyNames.FEATURE_NAME+"SilentNativeLoginResult",TelemetryPropertyNames.SILENT_NATIVE_LOGIN_SIGNED_IN_WITH_NATIVE_PROVIDER=TelemetryPropertyNames.FEATURE_NAME+"SilentNativeLoginSignedInWithNativeProvider",TelemetryPropertyNames.SILENT_NATIVE_LOGIN_AUTH_PROVIDER=TelemetryPropertyNames.FEATURE_NAME+"SilentNativeLoginAuthProvider",TelemetryPropertyNames.SILENT_NATIVE_LOGIN_SIGNED_IN_AS_ANONYMOUS=TelemetryPropertyNames.FEATURE_NAME+"SilentNativeLoginSignedInAsAnonymous",TelemetryPropertyNames.SILENT_NATIVE_LOGIN_ATTEMPTING_ANONYMOUS_STRATEGY=TelemetryPropertyNames.FEATURE_NAME+"SilentNativeLoginAttemptingAnonymousStrategy",TelemetryPropertyNames.SILENT_NATIVE_LOGIN_IS_ANONYMOUS_TOKEN_SET=TelemetryPropertyNames.FEATURE_NAME+"SilentNativeLoginIsAnonymousTokenSet",TelemetryPropertyNames.PROMPTED_NATIVE_LOGIN_STARTING=TelemetryPropertyNames.FEATURE_NAME+"PromptedNativeLoginStarting",TelemetryPropertyNames.PROMPTED_NATIVE_LOGIN_RESULT=TelemetryPropertyNames.FEATURE_NAME+"PromptedNativeLoginResult",TelemetryPropertyNames.PROMPTED_NATIVE_LOGIN_THE_USER_CANCELED_AUTH_PROVIDER_PICK=TelemetryPropertyNames.FEATURE_NAME+"PromptedNativeLoginTheUserCanceledAuthProviderPick",TelemetryPropertyNames.PROMPTED_NATIVE_LOGIN_CANCELED_VIA_CANCELLATION_TOKEN=TelemetryPropertyNames.FEATURE_NAME+"PromptedNativeLoginCancelledViaCancellationToken",TelemetryPropertyNames.PROMPTED_NATIVE_LOGIN_SELECTED_AUTH_PROVIDER=TelemetryPropertyNames.FEATURE_NAME+"PromptedNativeLoginSelectedAuthProvider",TelemetryPropertyNames.PROMPTED_NATIVE_LOGIN_FAILED_TO_ACQUIRE_AUTH_TOKEN=TelemetryPropertyNames.FEATURE_NAME+"PromptedNativeLoginFailedToAcquireAuthToken",TelemetryPropertyNames.LOGIN_IS_NATIVE=TelemetryPropertyNames.FEATURE_NAME+"IsNative",TelemetryPropertyNames.LOGIN_RESULT=TelemetryPropertyNames.FEATURE_NAME+"Result",TelemetryPropertyNames.LOGIN_IS_CANCELED=TelemetryPropertyNames.FEATURE_NAME+"AuthCanceled",TelemetryPropertyNames.TRY_LOAD_SESSION_RESULT=TelemetryPropertyNames.FEATURE_NAME+"Result",TelemetryPropertyNames.VSCODE_ERROR_CALL_STACK=TelemetryPropertyNames.FEATURE_NAME+"VscodeErrorCallStack",TelemetryPropertyNames.SIGNIN_STARTING=TelemetryPropertyNames.FEATURE_NAME+"SigninStarting",TelemetryPropertyNames.SIGNIN_PROMPT_STARTING=TelemetryPropertyNames.FEATURE_NAME+"SigninPromptStarting",TelemetryPropertyNames.SIGNIN_PROMPT_COMPLETED=TelemetryPropertyNames.FEATURE_NAME+"SigninPromptCompleted",TelemetryPropertyNames.SIGNIN_COMPLETED=TelemetryPropertyNames.FEATURE_NAME+"SigninCompleted",TelemetryPropertyNames.SIGNIN_COMPLETED_ERROR=TelemetryPropertyNames.FEATURE_NAME+"SigninCompletedError",TelemetryPropertyNames.SIGNIN_COMPLETED_CANCEL=TelemetryPropertyNames.FEATURE_NAME+"SigninCompletedCancel",TelemetryPropertyNames.SIGNIN_CHECK_STARTING=TelemetryPropertyNames.FEATURE_NAME+"SigninCheckStarting",TelemetryPropertyNames.SIGNIN_CHECK_COMPLETED=TelemetryPropertyNames.FEATURE_NAME+"SigninCheckCompleted",TelemetryPropertyNames.SIGNIN_CHECK_COMPLETED_ERROR=TelemetryPropertyNames.FEATURE_NAME+"SigninCheckCompletedError",TelemetryPropertyNames.SIGNIN_CHECK_COMPLETED_CANCEL=TelemetryPropertyNames.FEATURE_NAME+"SigninCheckCompletedCancel",TelemetryPropertyNames.WELCOME_PAGE_LINK=TelemetryPropertyNames.FEATURE_NAME+"WelcomePageLink",TelemetryPropertyNames.SHARE_INIT_WORKSPACE_FOLDERS_COUNT=TelemetryPropertyNames.FEATURE_NAME+"ShareInitWorkspaceFoldersCount",TelemetryPropertyNames.CURRENT_AB_EXPERIMENT=TelemetryPropertyNames.FEATURE_NAME+"CurrentAbExperiment",TelemetryPropertyNames.CURRENT_AB_TESTER_VERSION=TelemetryPropertyNames.FEATURE_NAME+"CurrentAbTesterVersion",TelemetryPropertyNames.CURRENT_AB_EXPERIMENT_GROUP=TelemetryPropertyNames.FEATURE_NAME+"CurrentAbExperimentGroup",TelemetryPropertyNames.COUNT_OF_CONCURRENT_AB_EXPERIMENTS=TelemetryPropertyNames.FEATURE_NAME+"CountOfConcurrentAbExperiments",TelemetryPropertyNames.FIRST_LIVESHARE_ACTIVATION=TelemetryPropertyNames.FEATURE_NAME+"FirstLiveShareActivation",TelemetryPropertyNames.SELECTED_FOR_ELECTRON_AUTH_MODAL_EXPERIMENT=TelemetryPropertyNames.FEATURE_NAME+"SelectedForElectronAuthModalExperiment",TelemetryPropertyNames.AUTH_ELECTRON_MODAL_USED=TelemetryPropertyNames.FEATURE_NAME+"AuthElectronModalUsed",TelemetryPropertyNames.AUTH_ELECTRON_MODAL_EXCEPTION=TelemetryPropertyNames.FEATURE_NAME+"AuthElectronModalException",TelemetryPropertyNames.RECOVER_ROOT_FOLDER=TelemetryPropertyNames.FEATURE_NAME+"RecoverRootFolder",TelemetryPropertyNames.SAMPLE_RATE=TelemetryPropertyNames.FEATURE_NAME+"SampleRate",TelemetryPropertyNames.DEFAULT_SIGN_IN=TelemetryPropertyNames.FEATURE_NAME+"DefaultSignIn",TelemetryPropertyNames.EVALUATED_EXPERIMENT_NAME=TelemetryPropertyNames.FEATURE_NAME+"evaluated-experiment-name",TelemetryPropertyNames.EVALUATED_EXPERIMENT_GROUP=TelemetryPropertyNames.FEATURE_NAME+"evaluated-experiment-group",TelemetryPropertyNames.INVITE_CONTACT_TYPE=TelemetryPropertyNames.FEATURE_NAME+"InviteContactType",TelemetryPropertyNames.TOAST_RESULT=TelemetryPropertyNames.FEATURE_NAME+"ToastResult",TelemetryPropertyNames.TOKEN_EXPIRED_DAYS=TelemetryPropertyNames.FEATURE_NAME+"TokenExpiredDays",TelemetryPropertyNames.WAIT_FOR_HOST_PROMPT=TelemetryPropertyNames.FEATURE_NAME+"WaitForHostPrompt",TelemetryPropertyNames.RETRY_JOIN=TelemetryPropertyNames.FEATURE_NAME+"RetryJoin",TelemetryPropertyNames.AUTH_CANCEL_WAIT_FOR_CODE=TelemetryPropertyNames.FEATURE_NAME+"AuthCancelWaitingForExternalCode",TelemetryPropertyNames.AUTH_CANCEL_BROWSER_CANCEL=TelemetryPropertyNames.FEATURE_NAME+"AuthCancelBrowserOperationCancelled",TelemetryPropertyNames.AUTH_CANCEL_NO_TOKEN_USER_CANCELLED=TelemetryPropertyNames.FEATURE_NAME+"AuthCancelNoTokenOrUserCancelled",TelemetryPropertyNames.AUTH_CANCEL_NO_ANON_AUTH=TelemetryPropertyNames.FEATURE_NAME+"AuthCancelNoAnonAuth",TelemetryPropertyNames.AUTH_CANCEL_ANONYMOUS_LOGIN_FLOW=TelemetryPropertyNames.FEATURE_NAME+"AuthCancelAnonymousLoginFlow",TelemetryPropertyNames.CREATE_INVITATION_LINK=TelemetryPropertyNames.FEATURE_NAME+"CreateInvitationLink",TelemetryPropertyNames.INSTALL_RECOVERY_SOURCE=TelemetryPropertyNames.FEATURE_NAME+"install-recovery-source",TelemetryPropertyNames.INSTALL_RECOVERY_TOAST_RESULT=TelemetryPropertyNames.FEATURE_NAME+"install-recovery-toast-result",TelemetryPropertyNames.INSTALL_RECOVERY_RELOAD=TelemetryPropertyNames.FEATURE_NAME+"install-recovery-reload",TelemetryPropertyNames.INSTALL_RECOVERY_CANCELED=TelemetryPropertyNames.FEATURE_NAME+"install-recovery-canceled",TelemetryPropertyNames.INSTALL_RECOVERY_RETRY=TelemetryPropertyNames.FEATURE_NAME+"install-recovery-retry",TelemetryPropertyNames.INSTALL_RECOVERY_RETRY_CANCELED=TelemetryPropertyNames.FEATURE_NAME+"install-recovery-retry-canceled",TelemetryPropertyNames.INSTALL_RECOVERY_DISABLED=TelemetryPropertyNames.FEATURE_NAME+"install-recovery-disabled",TelemetryPropertyNames.DELETE_DEPENDENCIES_DOWNLOAD_FILE=TelemetryPropertyNames.FEATURE_NAME+"delete-dependencies-download-file",TelemetryPropertyNames.DELETE_DEPENDENCIES_INSTALLED_FILE=TelemetryPropertyNames.FEATURE_NAME+"reinstall-dependencies-installed-file",TelemetryPropertyNames.DELETE_DEPENDENCIES_CLEAN_INSTALL_PATH=TelemetryPropertyNames.FEATURE_NAME+"reinstall-dependencies-clean-install-path",TelemetryPropertyNames.SELECTED_ACTION=TelemetryPropertyNames.FEATURE_NAME+"SelectedAction",TelemetryPropertyNames.AUDIO_DEVICE_TYPE=TelemetryPropertyNames.FEATURE_NAME+"AudioDeviceType",TelemetryPropertyNames.AUDIO_SESSION_STATE=TelemetryPropertyNames.FEATURE_NAME+"AudioSessionState",TelemetryPropertyNames.AUDIO_SESSION_ACTION=TelemetryPropertyNames.FEATURE_NAME+"AudioSessionAction",TelemetryPropertyNames.CHAT_IS_DIRECT_MESSAGE=TelemetryPropertyNames.FEATURE_NAME+"ChatIsDirectMessage",TelemetryPropertyNames.CHAT_DISABLED_MESSAGE_KEY=TelemetryPropertyNames.FEATURE_NAME+"ChatDisabledMessageKey",TelemetryPropertyNames.CHAT_NOTIFY_TYPE=TelemetryPropertyNames.FEATURE_NAME+"ChatNotifyType",TelemetryPropertyNames.CHAT_COMMAND=TelemetryPropertyNames.FEATURE_NAME+"ChatCommand",TelemetryPropertyNames.CHAT_ISDISABLED=TelemetryPropertyNames.FEATURE_NAME+"ChatIsDisabled",TelemetryPropertyNames.CHAT_ISCONNECTED=TelemetryPropertyNames.FEATURE_NAME+"ChatIsConnected",TelemetryPropertyNames.PLANNED_SESSIONS_LIST_SIZE=TelemetryPropertyNames.FEATURE_NAME+"PlannedSessionsListSize",TelemetryPropertyNames.ACCEPTED=TelemetryPropertyNames.FEATURE_NAME+"Accepted",TelemetryPropertyNames.READONLY=TelemetryPropertyNames.FEATURE_NAME+"Readonly",TelemetryPropertyNames.IS_ANONYMOUS_ELEVATED=TelemetryPropertyNames.FEATURE_NAME+"IsAnonymousElevated",TelemetryPropertyNames.EDITOR_SELECTION=TelemetryPropertyNames.FEATURE_NAME+"EditorSelection",TelemetryPropertyNames.IS_AGENTLESS=TelemetryPropertyNames.FEATURE_NAME+"IsAgentless",function(h){h[h.StatusBar=0]="StatusBar",h[h.Command=1]="Command"}(m.TelemetryEventOrigin||(m.TelemetryEventOrigin={}))},function(h,m,y){h.exports=y(922)},function(h,m,y){"undefined"==typeof process||"renderer"===process.type||!0===process.browser||process.__nwjs?h.exports=y(936):h.exports=y(938)},function(h,m,y){const v=y(964),{isObject:C,isArray:T}=y(229),w="before",A="before-all",P="after-all",k=[w,"after-prop","after-colon","after-value","after"],R=[w,A,P].map(Symbol.for),symbol=(h,m)=>Symbol.for(h+":"+m),define=(h,m,y)=>Object.defineProperty(h,m,{value:y,writable:!0,configurable:!0}),copy_comments_by_kind=(h,m,y,C,T,w)=>{const A=symbol(T,C);if(!v(m,A))return;const P=y===C?A:symbol(T,y);define(h,P,m[A]),w&&delete m[A]},copy_comments=(h,m,y,v,C)=>{k.forEach(T=>{copy_comments_by_kind(h,m,y,v,T,C)})},assign_non_prop_comments=(h,m)=>{R.forEach(y=>{const v=m[y];v&&define(h,y,v)})};h.exports={SYMBOL_PREFIXES:k,PREFIX_BEFORE:w,PREFIX_AFTER_PROP:"after-prop",PREFIX_AFTER_COLON:"after-colon",PREFIX_AFTER_VALUE:"after-value",PREFIX_AFTER:"after",PREFIX_BEFORE_ALL:A,PREFIX_AFTER_ALL:P,BRACKET_OPEN:"[",BRACKET_CLOSE:"]",CURLY_BRACKET_OPEN:"{",CURLY_BRACKET_CLOSE:"}",COLON:":",COMMA:",",MINUS:"-",EMPTY:"",UNDEFINED:void 0,symbol:symbol,define:define,copy_comments:copy_comments,swap_comments:(h,m,y)=>{m!==y&&k.forEach(C=>{const T=symbol(C,y);if(!v(h,T))return void copy_comments_by_kind(h,h,y,m,C,!0);const w=h[T];delete h[T],copy_comments_by_kind(h,h,y,m,C,!0),define(h,symbol(C,m),w)})},assign_non_prop_comments:assign_non_prop_comments,assign(h,m,y){if(!C(h))throw new TypeError("Cannot convert undefined or null to object");if(!C(m))return h;if(void 0===y)y=Object.keys(m),assign_non_prop_comments(h,m);else{if(!T(y))throw new TypeError("keys must be array or undefined");0===y.length&&assign_non_prop_comments(h,m)}return((h,m,y)=>(y.forEach(y=>{v(m,y)&&(h[y]=m[y],copy_comments(h,m,y,y))}),h))(h,m,y)}}},function(h,m,y){"use strict";var v;Object.defineProperty(m,"__esModule",{value:!0}),function(h){h[h.Unknown=0]="Unknown",h[h.Yes=1]="Yes",h[h.No=2]="No"}(v||(v={}));let C=v.Unknown;m.checkDebugging=function checkDebugging(){if(C===v.Unknown){C=v.No;for(let h of process.execArgv)if(h.startsWith("--inspect-brk")||h.startsWith("--debug")){C=v.Yes;break}}return C===v.Yes}},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0});class TreatmentVariables{}m.TreatmentVariables=TreatmentVariables,TreatmentVariables.VSCodeConfig="vscode",TreatmentVariables.NativeAuthEnabled="nativeAuth",TreatmentVariables.CheckForCancelBeforeReturningResponse="checkForCancelBeforeReturningResponse",TreatmentVariables.TransientWorkspaces="transientWorkspaces",TreatmentVariables.DontShowWelcomePage="dontShowLiveShareWelcomePage",TreatmentVariables.FollowIndicator="followIndicator",TreatmentVariables.ResyncOnMisappliedEdit="resyncOnMisappliedEdit",TreatmentVariables.FocusIndividual="focusIndividual",TreatmentVariables.FollowIndicators="followIndicators",TreatmentVariables.WaitForPendingEditOnDispose="waitForPendingEditOnDispose"},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0});const v=y(0),C=y(414),T=y(53);var w;!function(h){h.Never="Never",h.Activity="Activity",h.Always="Always"}(w=m.NameTagVisibility||(m.NameTagVisibility={}));class TextEditorDecoratorBase{constructor(h){this.color=h,this.backgroundCssColor=DecoratorUtils.toCssColor(this.color.backgroundColor),this.textCssColor=DecoratorUtils.toCssColor(this.color.textColor)}dispose(){this.decoration&&this.decoration.dispose()}render(h,m,y,v){this.decoration&&(this.decoration.dispose(),this.decoration=void 0),h&&h.length&&m&&y&&(this._createDecorationStyle(m,y,v),this._renderCore(h,m,y))}}m.TextEditorDecoratorBase=TextEditorDecoratorBase;class CursorDecorator extends TextEditorDecoratorBase{constructor(h,m){super(h),this.displayName=m}_renderCore(h,m,y){if(!this.decoration)return;const C={range:new v.Range(m,m)};y.isEmpty&&(C.hoverMessage=this.displayName),h.forEach(h=>{h.setDecorations(this.decoration,[C])})}_createDecorationStyle(h,m){const y=0===h.character?"0.17":"0.25",C={position:"absolute",display:"inline-block",top:"0","font-size":"200%","font-weight":"bold","z-index":1},T=DecoratorUtils.stringifyCssProperties(C),w={rangeBehavior:v.DecorationRangeBehavior.ClosedClosed,before:{contentText:"",margin:`0px 0px 0px -${y}ch`,color:this.backgroundCssColor,textDecoration:`none; ${T}`}};this.decoration=v.window.createTextEditorDecorationType(w)}}m.CursorDecorator=CursorDecorator;class NameTagDecorator extends TextEditorDecoratorBase{constructor(h,m){super(h),this.displayName=m}updateDisplayName(h){this.displayName=h}_renderCore(h,m,y){if(!this.decoration)return;const C=new v.Range(m,m);h.forEach(h=>{h.setDecorations(this.decoration,[C])})}_createDecorationStyle(h,m,y){let C=!0;(0===h.line||m&&!m.isEmpty&&!m.isSingleLine&&m.end.isEqual(h))&&(C=!(!y||0!==h.line||1!==y));const T={position:"absolute",top:`${C?-1:1}rem`,"border-radius":"0.15rem",padding:"0px 0.5ch",display:"inline-block","pointer-events":"none",color:this.textCssColor,"font-size":"0.7rem","z-index":1,"font-weight":"bold"},w=DecoratorUtils.stringifyCssProperties(T),A={backgroundColor:this.backgroundCssColor,rangeBehavior:v.DecorationRangeBehavior.ClosedClosed,textDecoration:"none; position: relative; z-index: 1;",after:{contentText:this.displayName,backgroundColor:this.backgroundCssColor,textDecoration:`none; ${w}`}};this.decoration=v.window.createTextEditorDecorationType(A)}}m.NameTagDecorator=NameTagDecorator;class RulerDecorator extends TextEditorDecoratorBase{constructor(h){super(h.withBackgroundAlpha(.6))}_renderCore(h,m,y){if(!this.decoration)return;const C=new v.Range(m,m);h.forEach(h=>{h.setDecorations(this.decoration,[C])})}_createDecorationStyle(h,m){this.decoration=v.window.createTextEditorDecorationType({overviewRulerLane:v.OverviewRulerLane.Full,overviewRulerColor:this.backgroundCssColor})}}m.RulerDecorator=RulerDecorator;class SelectionDecorator extends TextEditorDecoratorBase{constructor(h,m){super(h.withBackgroundAlpha(.35)),this.displayName=m}_renderCore(h,m,y){if(y.isEmpty)return;const v={range:y,hoverMessage:this.displayName};h.forEach(h=>{h.setDecorations(this.decoration,[v])})}_createDecorationStyle(h,m){this.decoration=v.window.createTextEditorDecorationType({backgroundColor:this.backgroundCssColor,borderRadius:"0.1rem"})}}m.SelectionDecorator=SelectionDecorator;m.ClientDecoratorManager=class ClientDecoratorManager{constructor(h,m,y,v){this.clientId=h,this.clientDisplayName=m,this.clientColor=SharedColors.requestColor(h),this.nameTagVisibility=y,this.positionTracker=v,this.selectionDecorator=new SelectionDecorator(this.clientColor,this.clientDisplayName),this.cursorDecorator=new CursorDecorator(this.clientColor,this.clientDisplayName),this.nameTagDecorator=new NameTagDecorator(this.clientColor,this.clientDisplayName),this.rulerDecorator=new RulerDecorator(this.clientColor)}dispose(){this.nameTagVisibilityTimer&&clearTimeout(this.nameTagVisibilityTimer),this.disposeDecorators()}updateNameTag(h){this.nameTagDecorator.updateDisplayName(h)}updateDecorators(){var h;const m=this.positionTracker.getClientPosition(this.clientId),y=[],C=(null==m?void 0:m.documentPosition)||(null==m?void 0:m.notebookPosition);let A;if(C){v.window.visibleTextEditors.forEach(h=>{h.document.uri.toString()===C.documentUri.toString()&&(h.document.uri.scheme.startsWith(T.PathManager.notebookCellScheme)&&(A=h.document.lineCount),y.push(h))});try{v.window.visibleNotebookEditors.forEach(h=>{h.document.uri.toString()===C.documentUri.toString()&&y.push(h)})}catch(h){}}if(!y.length)return void this.disposeDecorators();const P=C.range,k=(null===(h=m.documentPosition)||void 0===h?void 0:h.isReversed)?P.start:P.end;switch(this.selectionDecorator.render(y,k,P),this.rulerDecorator.render(y,k,P),this.nameTagVisibility){case w.Always:this.cursorDecorator.render(y,k,P),this.nameTagDecorator.render(y,k,P,A);break;case w.Never:this.cursorDecorator.render(y,k,P),this.nameTagDecorator&&this.nameTagDecorator.dispose();break;case w.Activity:default:this.nameTagVisibilityTimer&&clearTimeout(this.nameTagVisibilityTimer),this.cursorDecorator.render(y,k,P),this.nameTagDecorator.render(y,k,P,A),this.nameTagVisibilityTimer=setTimeout(()=>{this.nameTagDecorator.dispose()},1500)}}disposeDecorators(){this.selectionDecorator.dispose(),this.cursorDecorator.dispose(),this.nameTagDecorator.dispose(),this.rulerDecorator.dispose()}};class DecoratorColor{constructor(h,m){this.backgroundColor=h,this.textColor=m}withBackgroundAlpha(h){h=Math.max(0,h),h=Math.min(1,h);const m=new v.Color(this.backgroundColor.red,this.backgroundColor.green,this.backgroundColor.blue,h);return new DecoratorColor(m,this.textColor)}}class SharedColors{static requestColor(h){return SharedColors._initcolors(),SharedColors.allColors[h%SharedColors.allColors.length]}static _initcolors(){if(SharedColors.allColors)return;const h=[["rgba(0, 0, 0, 1)","rgba(255, 185, 0, 1)"],["rgba(255, 255, 255, 1)","rgba(16, 124, 16, 1)"],["rgba(255, 255, 255, 1)","rgba(180, 0, 158, 1)"],["rgba(0, 0, 0, 1)","rgba(186, 216, 10, 1)"],["rgba(0, 0, 0, 1)","rgba(255, 140, 0, 1)"],["rgba(255, 255, 255, 1)","rgba(227, 0, 140, 1)"],["rgba(255, 255, 255, 1)","rgba(92, 45, 145, 1)"],["rgba(0, 0, 0, 1)","rgba(0, 178, 148, 1)"],["rgba(0, 0, 0, 1)","rgba(255, 241, 0, 1)"],["rgba(0, 0, 0, 1)","rgba(180, 160, 255, 1)"]],m=v.workspace.getConfiguration("workbench.colorCustomizations");let y=m&&m["cascade.cursorForegroundBackgroundColors"];y&&Array.isArray(y)&&(SharedColors.allColors=SharedColors.parseColors(y)),SharedColors.allColors&&SharedColors.allColors.length||(SharedColors.allColors=SharedColors.parseColors(h))}static parseColors(h){return h.map(h=>{if(h&&2===h.length){const m=DecoratorUtils.toVSCodeColor(h[0]),y=DecoratorUtils.toVSCodeColor(h[1]);if(m&&y)return new DecoratorColor(y,m)}}).filter(h=>!!h).reverse()}}m.SharedColors=SharedColors;class DecoratorUtils{static stringifyCssProperties(h){return Object.keys(h).map(m=>`${m}: ${h[m]};`).join(" ")}static toCssColor(h){return`rgba(${Math.round(255*h.red)}, ${Math.round(255*h.green)}, ${Math.round(255*h.blue)}, ${h.alpha})`}static toVSCodeColor(h){const m=C.get.rgb(h);if(m){const[h,y,C,T]=m;return new v.Color(h/255,y/255,C/255,T)}return null}static isSamePosition(h,m){return null!==h&&null!==m&&h.isEqual(m)}static isSameRange(h,m){return null!==h&&null!==m&&h.isEqual(m)}}m.DecoratorUtils=DecoratorUtils},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0});var v=y(981);m.ActivityType=v.ActivityType,m.activitySource=v.activitySource},function(h,m,y){"use strict";const v=y(41),C=y(10),T=y(990),w=y(1005),A=y(1006),P=y(1008),k=y(1009),R=y(1011),M=y(366),N=y(1012),D=y(1013);function handleArgs(h,m,y){let v;return(y=Object.assign({extendEnv:!0,env:{}},y)).extendEnv&&(y.env=Object.assign({},process.env,y.env)),!0===y.__winShell?(delete y.__winShell,v={command:h,args:m,options:y,file:h,original:h}):v=T._parse(h,m,y),(y=Object.assign({maxBuffer:1e7,stripEof:!0,preferLocal:!0,localDir:v.options.cwd||process.cwd(),encoding:"utf8",reject:!0,cleanup:!0},v.options)).stdio=D(y),y.preferLocal&&(y.env=A.env(Object.assign({},y,{cwd:y.localDir}))),{cmd:v.command,args:v.args,opts:y,parsed:v}}function handleOutput(h,m){return m&&h.stripEof&&(m=w(m)),m}function handleShell(h,m,y){let v="/bin/sh",C=["-c",m];return y=Object.assign({},y),"win32"===process.platform&&(y.__winShell=!0,v=process.env.comspec||"cmd.exe",C=["/s","/c",`"${m}"`],y.windowsVerbatimArguments=!0),y.shell&&(v=y.shell,delete y.shell),h(v,C,y)}function getStream(h,m,y,v){if(!h[m])return null;let C;return C=y?k(h[m],{encoding:y,maxBuffer:v}):k.buffer(h[m],{maxBuffer:v}),C.catch(h=>{throw h.stream=m,h.message=`${m} ${h.message}`,h})}h.exports=(h,m,y)=>{let C=h;Array.isArray(m)&&m.length>0&&(C+=" "+m.join(" "));const w=handleArgs(h,m,y),A=w.opts.encoding,k=w.opts.maxBuffer;let D,I;try{D=v.spawn(w.cmd,w.args,w.opts)}catch(h){return Promise.reject(h)}w.opts.cleanup&&(I=M(()=>{D.kill()}));let x=null,O=!1;const cleanupTimeout=()=>{x&&(clearTimeout(x),x=null)};w.opts.timeout>0&&(x=setTimeout(()=>{x=null,O=!0,D.kill(w.opts.killSignal)},w.opts.timeout));const L=new Promise(h=>{D.on("exit",(m,y)=>{cleanupTimeout(),h({code:m,signal:y})}),D.on("error",m=>{cleanupTimeout(),h({err:m})}),D.stdin&&D.stdin.on("error",m=>{cleanupTimeout(),h({err:m})})});function destroy(){D.stdout&&D.stdout.destroy(),D.stderr&&D.stderr.destroy()}const handlePromise=()=>R(Promise.all([L,getStream(D,"stdout",A,k),getStream(D,"stderr",A,k)]).then(h=>{const m=h[0],y=h[1],v=h[2];let T=m.err;const A=m.code,P=m.signal;if(I&&I(),T||0!==A||null!==P){if(!T){let h="";Array.isArray(w.opts.stdio)?("inherit"!==w.opts.stdio[2]&&(h+=h.length>0?v:`\n${v}`),"inherit"!==w.opts.stdio[1]&&(h+=`\n${y}`)):"inherit"!==w.opts.stdio&&(h=`\n${v}${y}`),T=new Error(`Command failed: ${C}${h}`),T.code=A<0?N(A):A}if(T.killed=T.killed||D.killed,T.stdout=y,T.stderr=v,T.failed=!0,T.signal=P||null,T.cmd=C,T.timedOut=O,!w.opts.reject)return T;throw T}return{stdout:handleOutput(w.opts,y),stderr:handleOutput(w.opts,v),code:0,failed:!1,killed:!1,signal:null,cmd:C,timedOut:!1}}),destroy);return T._enoent.hookChildProcess(D,w.parsed),function handleInput(h,m){const y=m.input;null!=y&&(P(y)?y.pipe(h.stdin):h.stdin.end(y))}(D,w.opts),D.then=(h,m)=>handlePromise().then(h,m),D.catch=h=>handlePromise().catch(h),D},h.exports.stdout=function(){return h.exports.apply(null,arguments).then(h=>h.stdout)},h.exports.stderr=function(){return h.exports.apply(null,arguments).then(h=>h.stderr)},h.exports.shell=(m,y)=>handleShell(h.exports,m,y),h.exports.sync=(h,m,y)=>{const C=handleArgs(h,m,y);if(P(C.opts.input))throw new TypeError("The `input` option cannot be a stream in sync mode");const T=v.spawnSync(C.cmd,C.args,C.opts);if(T.error||0!==T.status)throw T.error||new Error(""===T.stderr?T.stdout:T.stderr);return T.stdout=handleOutput(C.opts,T.stdout),T.stderr=handleOutput(C.opts,T.stderr),T},h.exports.shellSync=(m,y)=>handleShell(h.exports.sync,m,y),h.exports.spawn=C.deprecate(h.exports,"execa.spawn() is deprecated. Use execa() instead.")},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0});const v=y(13),C=y(94),T=y(14),w=y(8),A=y(17);class SessionTelemetry{static startSession(h,m){this.activeTimeRecorder=new ActiveTimeRecorder(()=>{this.collaborateBlockEvent=new w.TimedEvent(A.TelemetryEventNames.COLLABORATE_BLOCK,!1,!0)},h=>{this.collaborateBlockEvent.addMeasure(A.TelemetryPropertyNames.ACTIVE_COLLABORATION_DURATION,h),this.collaborateBlockEvent.end(w.TelemetryResult.Success)}),SessionTelemetry.sessionTimedEvent=w.Telemetry.startTimedEvent(A.TelemetryEventNames.SESSION),w.Telemetry.addContextProperty(A.TelemetryPropertyNames.IS_HOST,h),SessionTelemetry.reportSettings(m)}static endSession(h,m){this.activeTimeRecorder.stop(),SessionTelemetry.sessionEvent.emit(SessionTelemetry.sessionEndEventName),SessionTelemetry.sessionTimedEvent.addProperty(A.TelemetryPropertyNames.GUESTS_BY_IDE,JSON.stringify(h)),SessionTelemetry.sessionTimedEvent.addProperty(A.TelemetryPropertyNames.DISTINCT_GUESTS_BY_IDE,JSON.stringify(m)),SessionTelemetry.sessionTimedEvent.addMeasure(A.TelemetryPropertyNames.ACTIVE_COLLABORATION_DURATION,this.activeTimeRecorder.activeDuration),SessionTelemetry.sessionTimedEvent.addMeasure(A.TelemetryPropertyNames.ACTIVE_COLLABORATION_BLOCKS,this.activeTimeRecorder.activeBlocks),SessionTelemetry.sessionTimedEvent.end(w.TelemetryResult.Success),w.Telemetry.removeContextProperty(A.TelemetryPropertyNames.CONVERSATION_ID),w.Telemetry.removeContextProperty(A.TelemetryPropertyNames.IS_HOST),w.Telemetry.removeContextProperty(A.TelemetryPropertyNames.SESSION_ID)}static reportSettings(h){const m=Object.assign({},h);m[T.SettingKeys.account]=w.cleanSensitiveInformation(h[T.SettingKeys.account]),m[T.SettingKeys.accountProvider]=w.cleanSensitiveInformation(h[T.SettingKeys.accountProvider]);const y=new w.TelemetryEvent(A.TelemetryEventNames.REPORT_SETTINGS);y.addProperty(A.TelemetryPropertyNames.SETTING_VALUES,JSON.stringify(m)),y.send()}static recordActivity(){var h;C.SessionContext.hasCollaborators&&(null===(h=this.activeTimeRecorder)||void 0===h||h.recordActivity())}}m.SessionTelemetry=SessionTelemetry,SessionTelemetry.sessionEvent=new v.EventEmitter,SessionTelemetry.sessionEndEventName="sessionEnd";class ActiveTimeRecorder{constructor(h,m,y=P){this.onBlockStart=h,this.onBlockEnd=m,this.idleTime=y,this.duration=0,this.blocks=0,this.firstActivity=0,this.lastActivity=0,this.newBlock=!0}endActiveBlock(){if(this.newBlock)return;const h=this.lastActivity-this.firstActivity;this.duration+=h,this.blocks++,this.newBlock=!0,this.onBlockEnd(h)}recordActivity(){clearTimeout(this.idleTimer);const h=(new Date).getTime();this.newBlock&&(this.newBlock=!1,this.firstActivity=h,this.onBlockStart()),this.lastActivity=h,this.idleTimer=setTimeout(()=>this.endActiveBlock(),this.idleTime)}stop(){this.endActiveBlock()}get activeDuration(){return this.duration}get activeBlocks(){return this.blocks}}m.ActiveTimeRecorder=ActiveTimeRecorder;const P=3e5},function(h,m,y){"use strict";var v=this&&this.__awaiter||function(h,m,y,v){return new(y||(y=Promise))((function(C,T){function fulfilled(h){try{step(v.next(h))}catch(h){T(h)}}function rejected(h){try{step(v.throw(h))}catch(h){T(h)}}function step(h){h.done?C(h.value):function adopt(h){return h instanceof y?h:new y((function(m){m(h)}))}(h.value).then(fulfilled,rejected)}step((v=v.apply(h,m||[])).next())}))};Object.defineProperty(m,"__esModule",{value:!0});const C=y(5),T=y(15),w=y(12),A=y(14);class TimeTracker{static initialize(){if(w.Settings.get(A.SettingKeys.performanceLogging)){const h="Live Share: Performance";this.perfLogger=C.traceSource.withName(h);const m=new T.OutputTraceListener(h);this.perfLogger.addTraceListener(m),m.addOutputChannel(!0)}TimeTracker.start("extension:start")}static start(h,m){const y=TimeTracker.getTime();this.originTime||(this.originTime=y),this.timings.set(h,y);const v=m?`${m} ${h}`:h;this.markTime(v,y)}static stop(h,m,y){var v;let C=this.timings.get(h);if(this.timings.delete(h),!C)return;const T=TimeTracker.getTime(),w=T-C,A=m?`${m} ${h}`:h,P=y?`${y} `:"";null===(v=this.perfLogger)||void 0===v||v.verbose(`${A}, Since start: (${T-TimeTracker.originTime}ms) Completed ${P}(${w}ms)`)}static markTime(h,m){var y;const v=m||TimeTracker.getTime();null===(y=this.perfLogger)||void 0===y||y.verbose(`${h} starting, Since start: (${v-TimeTracker.originTime}ms)`)}static timeIt(h,m){return v(this,void 0,void 0,(function*(){this.start(h);const y=yield m();return this.stop(h),y}))}static getTime(){return(new Date).getTime()}}m.TimeTracker=TimeTracker,TimeTracker.timings=new Map},function(h,m,y){"use strict";var v=y(1037);function InvalidTokenError(h){this.message=h}InvalidTokenError.prototype=new Error,InvalidTokenError.prototype.name="InvalidTokenError",h.exports=function(h,m){if("string"!=typeof h)throw new InvalidTokenError("Invalid token specified");var y=!0===(m=m||{}).header?0:1;try{return JSON.parse(v(h.split(".")[y]))}catch(h){throw new InvalidTokenError("Invalid token specified: "+h.message)}},h.exports.InvalidTokenError=InvalidTokenError},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0});class Constants{static get extensionName(){if(!this.extensionNameInternal)throw new Error("`extensionName` is not set, set `extensionName` first.");return this.extensionNameInternal}static set extensionName(h){if(this.extensionNameInternal)throw new Error("`extensionName` is already set.");this.extensionNameInternal=h}}m.Constants=Constants,Constants.PRODUCT_NAME="Account",Constants.UPDATE_TOKENS_THROTTLE_PERIOD_MS=5e3,Constants.VSONLINE_INTEGRATION_TEST="vso-integration-test",Constants.extensionNameInternal=null},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0}),m.curves=void 0,m.curves=[{shortName:"P-256",name:"nistp256",oid:"1.2.840.10045.3.1.7",keySize:256},{shortName:"P-384",name:"nistp384",oid:"1.3.132.0.34",keySize:384},{shortName:"P-521",name:"nistp521",oid:"1.3.132.0.35",keySize:521}]},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0}),m.Queue=void 0;class Queue{constructor(){this.array=new Array,this.first=0,this.count=0,this.version=0}get size(){return this.count}enqueue(h){if(this.count===this.array.length){const h=new Array(Math.max(16,2*this.count));for(let m=0;m<this.count;m++)h[m]=this.array[(this.first+m)%this.count];this.array=h,this.first=0}this.array[(this.first+this.count)%this.array.length]=h,this.count++,this.version++}dequeue(){if(0===this.count)return;const h=this.array[this.first];return this.array[this.first]=void 0,this.first=(this.first+1)%this.array.length,this.count--,this.version++,h}peek(){if(0===this.count)return;return this.array[this.first]}clear(){this.first=0,this.count=0,this.array.fill(void 0),this.version++}*[Symbol.iterator](){const h=this.version;for(let m=0;m<this.count;m++){const y=this.array[(this.first+m)%this.array.length];if(yield y,this.version!==h)throw new Error("Iterator is invalid due to changes in the collection.")}}}m.Queue=Queue},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0}),m.SshService=void 0;m.SshService=class SshService{constructor(h){this.session=h}dispose(){}async onSessionRequest(h,m){this.session.raiseSessionRequest(h)}async onChannelOpening(h,m){this.session.raiseChannelOpening(h)}async onChannelRequest(h,m,y){}async sendMessage(h,m){await this.session.sendMessage(h,m)}}},function(h,m,y){"use strict";var v=this&&this.__awaiter||function(h,m,y,v){return new(y||(y=Promise))((function(C,T){function fulfilled(h){try{step(v.next(h))}catch(h){T(h)}}function rejected(h){try{step(v.throw(h))}catch(h){T(h)}}function step(h){h.done?C(h.value):function adopt(h){return h instanceof y?h:new y((function(m){m(h)}))}(h.value).then(fulfilled,rejected)}step((v=v.apply(h,m||[])).next())}))};Object.defineProperty(m,"__esModule",{value:!0});const C=y(0),T=y(8),w=y(1090),A=y(17),P=y(26),k=y(94),R=y(22),M=y(23),N=y(32),D=y(24),I=y(14),x=y(12),O=y(35);let L,U;var B;function getJoinUri(){return M.sessionStateTracker.State===R.SessionState.Shared&&P.workspaceSessionInfoTracker.workspaceSessionInfo?P.workspaceSessionInfoTracker.workspaceSessionInfo.joinUri:null}m.showWelcomeNotification=()=>v(void 0,void 0,void 0,(function*(){yield x.Settings.save(I.SettingKeys.whatsNewUri,""),new T.TelemetryEvent(A.TelemetryEventNames.WELCOME_PAGE_TOAST_SHOWN).send();const h={title:"Get started"},y=yield C.window.showInformationMessage("VS Live Share installed! You can now collaboratively edit and debug with your team in real time.",h),v=new T.TelemetryEvent(A.TelemetryEventNames.WELCOME_PAGE_TOAST_SHOWN_INTERACTION);let w=!1;y&&y.title===h.title?(yield m.showWelcomePage(B.Install),v.addProperty("openedPage",!0),w=!0):v.addProperty("openedPage",!1),v.addProperty(A.TelemetryPropertyNames.SHOWED_INITIAL_INSTALL_INFO_PAGE,w),v.send()})),m.showWelcomePage=h=>v(void 0,void 0,void 0,(function*(){const m=new T.TelemetryEvent(A.TelemetryEventNames.WELCOME_PAGE_SHOWN);m.addProperty("source",h),m.addProperty("state",R.SessionState[M.sessionStateTracker.State]),m.addProperty("type","web-view"),yield function showWebViewWelcomePage(h){return v(this,void 0,void 0,(function*(){if(L)return void L.reveal(C.ViewColumn.One);let m=D.ExtensionUtil.getExtensionUri("welcomePage");const y=[m];D.ExtensionUtil.isNode()&&(m=m.with({scheme:"vscode-resource"})),L=C.window.createWebviewPanel("vsliveshare-welcome-page","vsliveshare-welcome-page",C.ViewColumn.Active,{enableScripts:!0,localResourceRoots:y});const w=C.workspace.getConfiguration();U||(U=new WelcomePageHTMLProvider(m)),U.joinUri=getJoinUri(),U.sessionState=M.sessionStateTracker.State,U.sessionHigherState=M.sessionStateTracker.HigherState,U.isWebview=!0,U.isFirstTimeJoin=h===B.FirstJoin,U.isPostReloadJoin=!!w.get("vsliveshare.join.reload.workspaceId"),U.isAuthenticated=N.userAuthStateTracker.IsSignedIn,U.hasCollaborators=k.SessionContext.hasCollaborators,L.webview.html=U.html,L.webview.onDidReceiveMessage((function(h){switch(h.command){case"copyUrl":return new T.TelemetryEvent(A.TelemetryEventNames.WELCOME_PAGE_COPY_CLICKED).send(),void C.commands.executeCommand("liveshare.collaboration.link.copy");case"onClick":return void new T.TelemetryEvent(A.TelemetryEventNames.WELCOME_PAGE_LINK_CLICKED).addProperty(A.TelemetryPropertyNames.WELCOME_PAGE_LINK,h.text).send();case"shareWithYourself":new T.TelemetryEvent(A.TelemetryEventNames.WELCOME_PAGE_LINK_CLICKED).addProperty(A.TelemetryPropertyNames.WELCOME_PAGE_LINK,h.text).send();const m={link:getJoinUri(),newWindow:!0};return void C.commands.executeCommand(`${x.Settings.get(I.SettingKeys.commandPrefix)}.join`,m);case"signIn":new T.TelemetryEvent(A.TelemetryEventNames.WELCOME_PAGE_LINK_CLICKED).addProperty(A.TelemetryPropertyNames.WELCOME_PAGE_LINK,h.text).send();const y={};return void C.commands.executeCommand("liveshare.start",y);case"startFromWelcomePage":return void C.commands.executeCommand("liveshare.startFromWelcomePage");default:return}}));let P=[];P.push(M.sessionStateTracker.onStateChanged(h=>v(this,void 0,void 0,(function*(){U.isPostReloadJoin=!!w.get("vsliveshare.join.reload.workspaceId"),U.joinUri=getJoinUri(),U.sessionState=h.newState,U.sessionHigherState=M.sessionStateTracker.HigherState,U.sessionAction=h.newAction,U.isAuthenticated=N.userAuthStateTracker.IsSignedIn,L.webview.html=U.html}))));P.push(k.SessionContext.onCollaboratorsJoined(()=>v(this,void 0,void 0,(function*(){U.hasCollaborators=k.SessionContext.hasCollaborators,L.webview.html=U.html})))),L.onDidDispose(()=>{const h=new T.TelemetryEvent(A.TelemetryEventNames.WELCOME_PAGE_DISMISSED);for(const h of P)h.dispose();P=[],L=null,h.send()})}))}(h)})),function(h){h.Help="Help",h.Install="Install",h.Sharing="Sharing",h.FirstShare="FirstShare",h.FirstJoin="FirstJoin"}(B=m.WelcomePageSource||(m.WelcomePageSource={}));class WelcomePageHTMLProvider{constructor(h){this.baseWelcomePagePath=h}get html(){const h=`${this.baseWelcomePagePath.toString()}/welcomePageMain.js`,m=`${this.baseWelcomePagePath.toString()}/welcomePage.css`;let y=w.welcomePage;const v=O().replace(/-/g,""),C=`<script nonce="${v}">const vslsCurrentSessionState=${this.sessionState}; vslsCurrentSessionHigherState=${this.sessionHigherState}; \n        vslsCurrentSessionAction=${this.sessionAction}; const vslsIsWebView=true; const vslsIsFirstTimeJoin=${this.isFirstTimeJoin}; \n        const vslsIsPostReloadJoin = ${this.isPostReloadJoin}; const vslsSessionState=${JSON.stringify(R.SessionState)}; const vslsSessionAction=${JSON.stringify(R.SessionAction)}; \n        const vslsIsAuthenticated=${this.isAuthenticated};\n        const hasCollaborators=${this.hasCollaborators};<\/script>`;return y=y.replace("${mainScriptUri}",h).replace("${styleUri}",m),y.replace(/\$\{joinUri\}/g,this.joinUri).replace('<script nonce="${nonce}"><\/script>',C).replace(/\$\{nonce\}/g,v)}}},function(h,m,y){"use strict";var v=this&&this.__awaiter||function(h,m,y,v){return new(y||(y=Promise))((function(C,T){function fulfilled(h){try{step(v.next(h))}catch(h){T(h)}}function rejected(h){try{step(v.throw(h))}catch(h){T(h)}}function step(h){h.done?C(h.value):function adopt(h){return h instanceof y?h:new y((function(m){m(h)}))}(h.value).then(fulfilled,rejected)}step((v=v.apply(h,m||[])).next())}))};Object.defineProperty(m,"__esModule",{value:!0});const C=y(34),T=y(70),w=y(23),A=y(17),P=y(22);m.telemetryStatusCommandDecorator=function telemetryStatusCommandDecorator(){return C.DecoratorHelper.setupDecorator(h=>new TelemetryStatusCommandDecorator(C.DecoratorHelper.getCoreCommand(h),h,T.dependencies.sessionContext(),T.dependencies.contextUtil()))};class TelemetryStatusCommandDecorator{constructor(h,m,y,v){this.command=h,this.next=m,this.sessionContext=y,this.contextUtil=v}invoke(h,m){return v(this,void 0,void 0,(function*(){let y=void 0;const v={},C=[`liveshare.SessionState.${this.deriveEventName(P.SessionState[w.sessionStateTracker.State],v)}`],T={},k=[],R={},M=[],stateCallback=h=>{m.trace.info(`SessionContext: State update from "${P.SessionState[h.oldState]}" (${P.SessionAction[h.oldAction]}) to "${P.SessionState[h.newState]}" (${P.SessionAction[h.newAction]}).`);const y=`liveshare.SessionState.${this.deriveEventName(P.SessionState[h.newState],v)}`;C.push(y);const w=`liveshare.SessionAction.${this.deriveEventName(P.SessionAction[h.newAction],T)}`;k.push(w)},statusCallback=h=>{const y=this.contextUtil.scrubPrefix(h.oldStatus),v=this.contextUtil.scrubPrefix(h.newStatus);m.trace.info(`SessionContext: Status update from "${y}" to "${v}".`);const C=`liveshare.SessionStatus.${this.deriveEventName(v,R)}`;m.telemetryEvent.markTime(C),M.push(C)};let N,D;try{N=w.sessionStateTracker.onStateChanged(stateCallback),D=w.sessionStateTracker.onStatusChanged(statusCallback),m.telemetryEvent.addProperty(A.TelemetryPropertyNames.STATE_EVENT_FIRST,`liveshare.SessionState.${P.SessionState[w.sessionStateTracker.State]}`.toLowerCase()),y=yield this.next.invoke(h,m)}finally{m.telemetryEvent.addProperty(A.TelemetryPropertyNames.STATE_EVENT_ORDER,C.length>0?String(C).toLowerCase():""),m.telemetryEvent.addProperty(A.TelemetryPropertyNames.STATUS_EVENT_ORDER,M.length>0?String(M).toLowerCase():""),m.telemetryEvent.addProperty(A.TelemetryPropertyNames.STATE_EVENT_LAST,`liveshare.SessionState.${P.SessionState[w.sessionStateTracker.State]}`.toLowerCase()),N&&N.dispose(),D&&D.dispose()}return y}))}deriveEventName(h,m){const y=m[h]=void 0!==m[h]?m[h]+1:0;return y>0?`${h+y}`:h}}m.TelemetryStatusCommandDecorator=TelemetryStatusCommandDecorator},function(h,m,y){"use strict";var v=this&&this.__awaiter||function(h,m,y,v){return new(y||(y=Promise))((function(C,T){function fulfilled(h){try{step(v.next(h))}catch(h){T(h)}}function rejected(h){try{step(v.throw(h))}catch(h){T(h)}}function step(h){h.done?C(h.value):function adopt(h){return h instanceof y?h:new y((function(m){m(h)}))}(h.value).then(fulfilled,rejected)}step((v=v.apply(h,m||[])).next())}))};Object.defineProperty(m,"__esModule",{value:!0});const C=y(4),T=y(70),w=y(34),A=y(24),P=y(32),k=y(23),R=y(17),M=y(12),N=y(462),D=y(14),I=y(241),x=y(172);m.authenticationCommandDecorator=function authenticationCommandDecorator(h){return w.DecoratorHelper.setupDecorator(m=>new AuthenticationCommandDecorator(m,T.dependencies.authenticationFlow(),T.dependencies.authenticationProvider(),N.isAnonymousAuthReloadFlagValid,h))};class AuthenticationCommandDecorator{constructor(h,m,y,v,C){this.next=h,this.authenticationFlow=m,this.authenticationProvider=y,this.isAnonymousAuthReloadFlagValidFunction=v,this.authDecoratorOptions=C,this.authAttemptCount=0,this.authDecoratorOptions=Object.assign({authAttemptMax:1},this.authDecoratorOptions)}shouldShowAnonymousToast(h,m){return v(this,void 0,void 0,(function*(){const y=h.isAllowAnonymous;if(y&&h.disableAnonymousPrompt)return!1;let v="liveshare.join.postReload"===m.commandText||(yield this.isAnonymousAuthReloadFlagValidFunction());return P.userAuthStateTracker.isCurrentUserAnonymous()&&y&&!v}))}invoke(h,m){return v(this,void 0,void 0,(function*(){h=Object.assign({isNativeAuth:M.Settings.get(D.SettingKeys.nativeAuthFlow)},h),m.telemetryEvent.addProperty(R.TelemetryPropertyNames.DEFAULT_SIGN_IN,!!h.isDefaultSignIn),h.isDefaultSignIn||(yield P.userAuthStateTracker.defaultAuthAttemptCompleteSignal.promise);let y=void 0;try{let C=this.authenticationProvider.isAuthenticated();if(m.telemetryEvent.addProperty(R.TelemetryPropertyNames.COMMAND_ALLOWS_ANONYMOUS,h.isAllowAnonymous),m.telemetryEvent.addProperty(R.TelemetryPropertyNames.COMMAND_SHOULED_SKIP_ANONYMOUS_PROMPT,h.disableAnonymousPrompt),m.telemetryEvent.addMeasure(R.TelemetryPropertyNames.COMMAND_AUTH_RETRY_COUNT,this.authAttemptCount),m.telemetryEvent.addPropertyIfNotExists(R.TelemetryPropertyNames.COMMAND_STARTED_UNAUTHENTICATED,!C),m.telemetryEvent.addProperty(R.TelemetryPropertyNames.COMMAND_STARTED_BLOCKING_AUTH,!1),!C){try{C=yield x.TimeTracker.timeIt("attemptAuthenticationCheckFlow",()=>v(this,void 0,void 0,(function*(){return yield this.authenticationFlow.attemptAuthenticationCheckFlow(h,m)})))}catch(h){m.trace.error(`Authentication check error: ${h}`),C=!1}if(m.telemetryEvent.addProperty(R.TelemetryPropertyNames.COMMAND_AUTO_AUTHED_RESULT,C),h.isDefaultSignIn){if(P.userAuthStateTracker.completeDefaultAuthAttempt(),!C)throw new I.NonBlockingError("Authentication check returned false.");return C}}!h.isAllowAnonymous&&P.userAuthStateTracker.isCurrentUserAnonymous()&&(C=!1,m.telemetryEvent.addProperty(R.TelemetryPropertyNames.COMMAND_AUTO_AUTHED_ANONYMOUSLY_BUT_ANONYMOUS_NOT_ALLOWED,!0));const T=yield this.shouldShowAnonymousToast(h,m);if(!C||T){let y;m.telemetryEvent.addProperty(R.TelemetryPropertyNames.COMMAND_DID_AUTH_FULL,!C),m.telemetryEvent.addProperty(R.TelemetryPropertyNames.COMMAND_STARTED_BLOCKING_AUTH,!0),m.telemetryEvent.addProperty(R.TelemetryPropertyNames.COMMAND_SHOULD_SHOW_ANONYMOUS_TOAST,T),h.isAllowAnonymous&&(y=yield this.authenticationFlow.attemptPromptedUserAnonymousLoginFlow(h,m),m.telemetryEvent.addProperty(R.TelemetryPropertyNames.COMMAND_BLOCKING_ANONYMOUS_LOGIN_FLOW_RESULT,y)),y||(m.telemetryEvent.addProperty(R.TelemetryPropertyNames.COMMAND_BLOCKING_NON_ANONYMOUS_LOGIN_FLOW_RESULT,!1),yield this.authenticationFlow.attemptPromptedUserLoginFlow(h,m),m.telemetryEvent.addProperty(R.TelemetryPropertyNames.COMMAND_BLOCKING_NON_ANONYMOUS_LOGIN_FLOW_RESULT,!0)),C=!0}const{cancellationTokenSource:w}=m;if(w&&w.token.isCancellationRequested)return;A.ExtensionUtil.setCommandContext("liveshare:isAnonymousUser",P.userAuthStateTracker.isCurrentUserAnonymous()),void 0!==this.authDecoratorOptions.statusPostAuth&&this.shouldPerformSessionAction(h)&&k.sessionStateTracker.transition(this.authDecoratorOptions.statusPostAuth),y=yield this.next.invoke(h,m)}catch(v){if(v.code!==C.vsls.ErrorCodes.UnauthorizedHttpStatusCode)throw v;if(!(this.authAttemptCount++<this.authDecoratorOptions.authAttemptMax))throw m.trace.info("AuthRetry: No authentication fail retries left."),v;m.trace.info(`AuthRetry: About to retry, attempt ${this.authAttemptCount}.`),m.telemetryEvent.addProperty(R.TelemetryPropertyNames.SIGN_IN_RETRIES,this.authAttemptCount),yield this.authenticationProvider.clearCache(),y=yield this.invoke(h,m)}return y}))}shouldPerformSessionAction(h){return!this.authDecoratorOptions.validateSessionAction||this.authDecoratorOptions.validateSessionAction(h)}}m.AuthenticationCommandDecorator=AuthenticationCommandDecorator},function(h,m,y){"use strict";var v=this&&this.__awaiter||function(h,m,y,v){return new(y||(y=Promise))((function(C,T){function fulfilled(h){try{step(v.next(h))}catch(h){T(h)}}function rejected(h){try{step(v.throw(h))}catch(h){T(h)}}function step(h){h.done?C(h.value):function adopt(h){return h instanceof y?h:new y((function(m){m(h)}))}(h.value).then(fulfilled,rejected)}step((v=v.apply(h,m||[])).next())}))};Object.defineProperty(m,"__esModule",{value:!0});const C=y(0),T=y(34),w=y(70);m.cancellationDecorator=function cancellationDecorator(){return T.DecoratorHelper.setupDecorator(h=>new CancellationDecorator(T.DecoratorHelper.getCoreCommand(h),h,w.dependencies.sessionContext()))};class CancellationDecorator{constructor(h,m,y){this.command=h,this.next=m,this.sessionContext=y}invoke(h,m){return v(this,void 0,void 0,(function*(){let y;return this.cancelPreviousCommandIfRunning(),CancellationDecorator.currentCancellationTokenSource=new C.CancellationTokenSource,m.cancellationTokenSource=CancellationDecorator.currentCancellationTokenSource,y=yield this.next.invoke(h,m),y}))}cancelPreviousCommandIfRunning(){const h=CancellationDecorator.currentCancellationTokenSource,m=h&&h.token;m&&!m.isCancellationRequested&&h.cancel()}}m.CancellationDecorator=CancellationDecorator},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0});var v=y(1142);m.WorkspaceClient=v.WorkspaceClient;var C=y(470);m.SshHelpers=C.SshHelpers,m.isNode=C.isNode},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0});m.CallbackContainer=class CallbackContainer{constructor(){this.callbacks=[]}get items(){return this.callbacks}add(h){return h&&this.callbacks.push(h),{dispose:()=>{const m=this.callbacks.indexOf(h);-1!==m&&this.callbacks.splice(m,1)}}}}},function(h,m,y){"use strict";var v=y(499).Duplex,C=y(10),T=y(274).Buffer;function BufferList(h){if(!(this instanceof BufferList))return new BufferList(h);if(this._bufs=[],this.length=0,"function"==typeof h){this._callback=h;var m=function piper(h){this._callback&&(this._callback(h),this._callback=null)}.bind(this);this.on("pipe",(function onPipe(h){h.on("error",m)})),this.on("unpipe",(function onUnpipe(h){h.removeListener("error",m)}))}else this.append(h);v.call(this)}C.inherits(BufferList,v),BufferList.prototype._offset=function _offset(h){var m,y=0,v=0;if(0===h)return[0,0];for(;v<this._bufs.length;v++){if(h<(m=y+this._bufs[v].length)||v==this._bufs.length-1)return[v,h-y];y=m}},BufferList.prototype._reverseOffset=function(h){for(var m=h[0],y=h[1],v=0;v<m;v++)y+=this._bufs[v].length;return y},BufferList.prototype.append=function append(h){var m=0;if(T.isBuffer(h))this._appendBuffer(h);else if(Array.isArray(h))for(;m<h.length;m++)this.append(h[m]);else if(h instanceof BufferList)for(;m<h._bufs.length;m++)this.append(h._bufs[m]);else null!=h&&("number"==typeof h&&(h=h.toString()),this._appendBuffer(T.from(h)));return this},BufferList.prototype._appendBuffer=function appendBuffer(h){this._bufs.push(h),this.length+=h.length},BufferList.prototype._write=function _write(h,m,y){this._appendBuffer(h),"function"==typeof y&&y()},BufferList.prototype._read=function _read(h){if(!this.length)return this.push(null);h=Math.min(h,this.length),this.push(this.slice(0,h)),this.consume(h)},BufferList.prototype.end=function end(h){v.prototype.end.call(this,h),this._callback&&(this._callback(null,this.slice()),this._callback=null)},BufferList.prototype.get=function get(h){if(!(h>this.length||h<0)){var m=this._offset(h);return this._bufs[m[0]][m[1]]}},BufferList.prototype.slice=function slice(h,m){return"number"==typeof h&&h<0&&(h+=this.length),"number"==typeof m&&m<0&&(m+=this.length),this.copy(null,0,h,m)},BufferList.prototype.copy=function copy(h,m,y,v){if(("number"!=typeof y||y<0)&&(y=0),("number"!=typeof v||v>this.length)&&(v=this.length),y>=this.length)return h||T.alloc(0);if(v<=0)return h||T.alloc(0);var C,w,copy=!!h,A=this._offset(y),P=v-y,k=P,R=copy&&m||0,M=A[1];if(0===y&&v==this.length){if(!copy)return 1===this._bufs.length?this._bufs[0]:T.concat(this._bufs,this.length);for(w=0;w<this._bufs.length;w++)this._bufs[w].copy(h,R),R+=this._bufs[w].length;return h}if(k<=this._bufs[A[0]].length-M)return copy?this._bufs[A[0]].copy(h,m,M,M+k):this._bufs[A[0]].slice(M,M+k);for(copy||(h=T.allocUnsafe(P)),w=A[0];w<this._bufs.length;w++){if(!(k>(C=this._bufs[w].length-M))){this._bufs[w].copy(h,R,M,M+k),R+=C;break}this._bufs[w].copy(h,R,M),R+=C,k-=C,M&&(M=0)}return h.length>R?h.slice(0,R):h},BufferList.prototype.shallowSlice=function shallowSlice(h,m){if(h=h||0,m="number"!=typeof m?this.length:m,h<0&&(h+=this.length),m<0&&(m+=this.length),h===m)return new BufferList;var y=this._offset(h),v=this._offset(m),C=this._bufs.slice(y[0],v[0]+1);return 0==v[1]?C.pop():C[C.length-1]=C[C.length-1].slice(0,v[1]),0!=y[1]&&(C[0]=C[0].slice(y[1])),new BufferList(C)},BufferList.prototype.toString=function toString(h,m,y){return this.slice(m,y).toString(h)},BufferList.prototype.consume=function consume(h){if(h=Math.trunc(h),Number.isNaN(h)||h<=0)return this;for(;this._bufs.length;){if(!(h>=this._bufs[0].length)){this._bufs[0]=this._bufs[0].slice(h),this.length-=h;break}h-=this._bufs[0].length,this.length-=this._bufs[0].length,this._bufs.shift()}return this},BufferList.prototype.duplicate=function duplicate(){for(var h=0,m=new BufferList;h<this._bufs.length;h++)m.append(this._bufs[h]);return m},BufferList.prototype.destroy=function destroy(){this._bufs.length=0,this.length=0,this.push(null)},BufferList.prototype.indexOf=function(h,m,y){if(void 0===y&&"string"==typeof m&&(y=m,m=void 0),"function"==typeof h||Array.isArray(h))throw new TypeError('The "value" argument must be one of type string, Buffer, BufferList, or Uint8Array.');if("number"==typeof h?h=T.from([h]):"string"==typeof h?h=T.from(h,y):h instanceof BufferList?h=h.slice():T.isBuffer(h)||(h=T.from(h)),m=Number(m||0),isNaN(m)&&(m=0),m<0&&(m=this.length+m),m<0&&(m=0),0===h.length)return m>this.length?this.length:m;for(var v=this._offset(m),C=v[0],w=v[1];C<this._bufs.length;C++){for(var A=this._bufs[C];w<A.length;){if(A.length-w>=h.length){var P=A.indexOf(h,w);if(-1!==P)return this._reverseOffset([C,P]);w=A.length-h.length+1}else{var k=this._reverseOffset([C,w]);if(this._match(k,h))return k;w++}}w=0}return-1},BufferList.prototype._match=function(h,m){if(this.length-h<m.length)return!1;for(var y=0;y<m.length;y++)if(this.get(h+y)!==m[y])return!1;return!0},function(){var h={readDoubleBE:8,readDoubleLE:8,readFloatBE:4,readFloatLE:4,readInt32BE:4,readInt32LE:4,readUInt32BE:4,readUInt32LE:4,readInt16BE:2,readInt16LE:2,readUInt16BE:2,readUInt16LE:2,readInt8:1,readUInt8:1,readIntBE:null,readIntLE:null,readUIntBE:null,readUIntLE:null};for(var m in h)!function(m){BufferList.prototype[m]=null===h[m]?function(h,y){return this.slice(h,h+y)[m](0,y)}:function(y){return this.slice(y,y+h[m])[m](0)}}(m)}(),h.exports=BufferList},function(h,m,y){"use strict";"undefined"==typeof process||!process.version||0===process.version.indexOf("v0.")||0===process.version.indexOf("v1.")&&0!==process.version.indexOf("v1.8.")?h.exports={nextTick:function nextTick(h,m,y,v){if("function"!=typeof h)throw new TypeError('"callback" argument must be a function');var C,T,w=arguments.length;switch(w){case 0:case 1:return process.nextTick(h);case 2:return process.nextTick((function afterTickOne(){h.call(null,m)}));case 3:return process.nextTick((function afterTickTwo(){h.call(null,m,y)}));case 4:return process.nextTick((function afterTickThree(){h.call(null,m,y,v)}));default:for(C=new Array(w-1),T=0;T<C.length;)C[T++]=arguments[T];return process.nextTick((function afterTick(){h.apply(null,C)}))}}}:h.exports=process},function(h,m){var y={}.toString;h.exports=Array.isArray||function(h){return"[object Array]"==y.call(h)}},function(h,m,y){var v=y(9),C=v.Buffer;function copyProps(h,m){for(var y in h)m[y]=h[y]}function SafeBuffer(h,m,y){return C(h,m,y)}C.from&&C.alloc&&C.allocUnsafe&&C.allocUnsafeSlow?h.exports=v:(copyProps(v,m),m.Buffer=SafeBuffer),copyProps(C,SafeBuffer),SafeBuffer.from=function(h,m,y){if("number"==typeof h)throw new TypeError("Argument must not be a number");return C(h,m,y)},SafeBuffer.alloc=function(h,m,y){if("number"!=typeof h)throw new TypeError("Argument must be a number");var v=C(h);return void 0!==m?"string"==typeof y?v.fill(m,y):v.fill(m):v.fill(0),v},SafeBuffer.allocUnsafe=function(h){if("number"!=typeof h)throw new TypeError("Argument must be a number");return C(h)},SafeBuffer.allocUnsafeSlow=function(h){if("number"!=typeof h)throw new TypeError("Argument must be a number");return v.SlowBuffer(h)}},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0}),m.curves=void 0,m.curves=[{shortName:"P-256",name:"nistp256",oid:"1.2.840.10045.3.1.7",keySize:256},{shortName:"P-384",name:"nistp384",oid:"1.3.132.0.34",keySize:384},{shortName:"P-521",name:"nistp521",oid:"1.3.132.0.35",keySize:521}]},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0}),m.Queue=void 0;class Queue{constructor(){this.array=new Array,this.first=0,this.count=0,this.version=0}get size(){return this.count}enqueue(h){if(this.count===this.array.length){const h=new Array(Math.max(16,2*this.count));for(let m=0;m<this.count;m++)h[m]=this.array[(this.first+m)%this.count];this.array=h,this.first=0}this.array[(this.first+this.count)%this.array.length]=h,this.count++,this.version++}dequeue(){if(0===this.count)return;const h=this.array[this.first];return this.array[this.first]=void 0,this.first=(this.first+1)%this.array.length,this.count--,this.version++,h}peek(){if(0===this.count)return;return this.array[this.first]}clear(){this.first=0,this.count=0,this.array.fill(void 0),this.version++}*[Symbol.iterator](){const h=this.version;for(let m=0;m<this.count;m++){const y=this.array[(this.first+m)%this.array.length];if(yield y,this.version!==h)throw new Error("Iterator is invalid due to changes in the collection.")}}}m.Queue=Queue},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0}),m.SshService=void 0;m.SshService=class SshService{constructor(h){this.session=h}dispose(){}async onSessionRequest(h,m){this.session.raiseSessionRequest(h)}async onChannelOpening(h,m){this.session.raiseChannelOpening(h)}async onChannelRequest(h,m,y){}async sendMessage(h,m){await this.session.sendMessage(h,m)}}},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0});const v=y(4);function toPresenceSort(h){switch(h){case v.contactProtocol.PresenceStatus.Available:return 1;case v.contactProtocol.PresenceStatus.Away:return 2;case v.contactProtocol.PresenceStatus.Busy:return 3;case v.contactProtocol.PresenceStatus.DoNotDisturb:return 4;default:return 100}}m.defaultCompareContacts=function defaultCompareContacts(h,m){const y=toPresenceSort(h.contact.status),v=toPresenceSort(m.contact.status);return y>v?1:y<v?-1:h.contact.displayName>m.contact.displayName?1:h.contact.displayName<m.contact.displayName?-1:0}},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0});m.Deferred=class Deferred{constructor(h){this.state=h,this._isResolved=!1,this._isRejected=!1,this.promise=new Promise((h,m)=>{this.resolvePromise=h,this.rejectPromise=m})}get isCompleted(){return this._isResolved||this._isRejected}get isResolved(){return this._isResolved}get isRejected(){return this._isRejected}get error(){return this._error}resolve(h){return!this.isCompleted&&(this.resolvePromise(h),this._isResolved=!0,!0)}reject(h){return!this.isCompleted&&(this.rejectPromise(h),this._error=h,this._isRejected=!0,!0)}}},function(h,m,y){var v=y(186);m.createCodec=createCodec,m.install=function install(h){for(var m in h)Codec.prototype[m]=add(Codec.prototype[m],h[m])},m.filter=function filter(h){return v(h)?function join(h){return h=h.slice(),function(m){return h.reduce(iterator,m)};function iterator(h,m){return m(h)}}(h):h};var C=y(44);function Codec(h){if(!(this instanceof Codec))return new Codec(h);this.options=h,this.init()}function add(h,m){return h&&m?function ab(){return h.apply(this,arguments),m.apply(this,arguments)}:h||m}function createCodec(h){return new Codec(h)}Codec.prototype.init=function(){var h=this.options;return h&&h.uint8array&&(this.bufferish=C.Uint8Array),this},m.preset=createCodec({preset:!0})},function(h,m,y){"use strict";var v=this&&this.__decorate||function(h,m,y,v){var C,T=arguments.length,w=T<3?m:null===v?v=Object.getOwnPropertyDescriptor(m,y):v;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)w=Reflect.decorate(h,m,y,v);else for(var A=h.length-1;A>=0;A--)(C=h[A])&&(w=(T<3?C(w):T>3?C(m,y,w):C(m,y))||w);return T>3&&w&&Object.defineProperty(m,y,w),w},C=this&&this.__metadata||function(h,m){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(h,m)},T=this&&this.__awaiter||function(h,m,y,v){return new(y||(y=Promise))((function(C,T){function fulfilled(h){try{step(v.next(h))}catch(h){T(h)}}function rejected(h){try{step(v.throw(h))}catch(h){T(h)}}function step(h){h.done?C(h.value):function adopt(h){return h instanceof y?h:new y((function(m){m(h)}))}(h.value).then(fulfilled,rejected)}step((v=v.apply(h,m||[])).next())}))};Object.defineProperty(m,"__esModule",{value:!0});const w=y(3),A=y(4),P=y(0),k=y(69),R=y(0),M=y(3),N=y(2);function commentsSupported(){return P.comments&&P.comments.createCommentController&&k.gte(k.coerce(P.version),"1.35.0")&&w.Settings.get(w.SettingKeys.comments)}m.commentsSupported=commentsSupported;m.commentManagerFactory=(h,m)=>{const{controllerDecorator:y,errorNotificationMethodDecorator:w,telemetryMethodDecorator:k}=h.methodDecorators();let D=class CommentManager{constructor(h,m){this.threads=new Map,this.commentCountChanged=new P.EventEmitter,this.disposables=[],this.pathManager=h.pathManager,this.service=m.commentService,this.session=h.sessionContext(),this.hostCommentService=m.hostCommentService,this.fileService=h.fileService,this.trace=h.trace().withName("CommentManager")}get sessionId(){return this.session.coeditingClient.clientID}get participantId(){const h=this.session.collaboratorManager.getUserId(this.sessionId);if(!h)throw new Error("Cannot get UserId for current Live Share user");return h}get commentCount(){let h=0;for(let[,{vscodeThread:{comments:m}}]of this.threads)h+=m.length;return h}get onCommentCountChanged(){return this.commentCountChanged.event}init(){return T(this,void 0,void 0,(function*(){commentsSupported()&&(M.ControllerHelper.register(this,this.disposables),this.isActive=!0,this.service().onCommentThreadChanged(this.serviceCommentThreadChanged,this,this.disposables),this.session.coeditingClient.positionTracker.onNamedPositionsChanged(h=>this.positionChanged(h)),this.getThreads().catch(h=>this.trace.error("Error getting comment threads",h)))}))}dispose(){return T(this,void 0,void 0,(function*(){if(!this.isActive)return;this.isActive=!1,this.commentController=void 0;for(const h of this.disposables)h.dispose();this.disposables=[],this.getThreadsPromise=void 0;const h=this.threads.size>0;this.threads.clear(),h&&this.commentCountChanged.fire()}))}provideCommentingRanges(h,m){return T(this,void 0,void 0,(function*(){if(!this.isActive||!h)return[];const m=this.getDocumentPath(h);if(!m)return[];if(isSharing()){const[h]=yield this.fileService().listAsync([m],{includeExcluded:!0,includeHidden:!0});if(!h||!this.isActive)return[];const{attributes:y}=h;if(y===A.vsls.FileAttributes.External||y===A.vsls.FileAttributes.Excluded||y===A.vsls.FileAttributes.Hidden)return[]}else if(h.uri.path.startsWith(M.PathManager.externalPrefix))return[];return this.trackThreadPositions(h,m),[new P.Range(0,0,h.lineCount-1,0)]}))}createThread({text:h,thread:m}){return T(this,void 0,void 0,(function*(){if(m)if(this.isActive)try{const{resource:y,range:v}=m;if(!y)throw new Error("No resource provided on VSCode thread");if(!this.isSupportedScheme(y))throw new Error(`Unexpected scheme '${y.scheme}' of VSCode thread.resource`);const C=this.pathManager().localPathToRelativePath(y);if(!C)throw new Error(`Failed to get relative document path for VSCode document ${y.toString()}`);const T=this.createVslsComment(h),w={threadContext:{documentVersion:0,filePath:C,rightFileStart:{line:v.start.line,offset:v.start.character},rightFileEnd:{line:v.end.line,offset:v.end.character}},lastUpdatedSessionId:this.sessionId,rightSnapshotIndex:1,comments:[T]},A=yield P.workspace.openTextDocument(y),k=this.cloneVslsThreadIfNeeded(yield this.service().createCommentThreadAsync(w));if(!this.isActive)return void m.dispose();if(!k)throw new Error("CommentService.createCommentThreadAsync() returned null unexpectedly");const R=k.threadId;if("number"!=typeof R)throw new Error("CommentService.createCommentThreadAsync() returned a thread with missing or incorrect type threadId");if(!k.comments||0===k.comments.length)throw new Error("CommentService.createCommentThreadAsync() returned a thread without comments");if(k.comments.length>1)throw new Error("CommentService.createCommentThreadAsync() returned a thread with more than one comment");this.addVSCodeComment(k,m),isSharing()&&(m.contextValue="deletable"),this.threads.set(R,{vslsThread:k,vscodeThread:m}),this.trackThreadPosition(R,A),this.commentCountChanged.fire()}catch(h){throw m.dispose(),h}else m.dispose()}))}deleteThread(h){return T(this,void 0,void 0,(function*(){if(h){if(h.comments.length){const{threadId:m}=h.comments[0];for(let y=h.comments.length-1;y>=0&&this.isActive;--y){const{commentId:v}=h.comments[y];yield this.service().deleteCommentAsync(m,v,this.sessionId)}this.threads.delete(m),this.commentCountChanged.fire()}h.dispose()}}))}reply({text:h,thread:m}){return T(this,void 0,void 0,(function*(){if(!this.isActive)return;if(!m)return;if(!m.comments.length)return;const{vslsThread:y}=m.comments[0],v=y.comments.length?y.comments[y.comments.length-1].commentId:-1,C=this.createVslsComment(h,y.threadId,v),T=yield this.service().createCommentAsync(C);this.isActive?(this.addVSCodeComment(y,m,T),this.commentCountChanged.fire()):m.dispose()}))}editComment(h){return T(this,void 0,void 0,(function*(){tryUpdateVSCodeComment(h,!0)}))}saveComment(h){return T(this,void 0,void 0,(function*(){if(!tryUpdateVSCodeComment(h,!1))return;if(!this.isActive)return;const{commentId:m,text:y,threadId:v,vslsThread:C,vscodeThread:T}=h,w=C.comments.findIndex(h=>h.commentId===m);if(-1===w)return;const A=this.cloneVslsCommentIfNeeded(yield this.service().updateCommentAsync(v,m,this.sessionId,y));if(A.commentId!==m)throw new Error("Comment service updateCommentAsync() changed commentId unexpectedly");C.comments[w]=A}))}cancelEditComment(h){return T(this,void 0,void 0,(function*(){if(!h)return;if(!this.isActive)return;const{commentId:m,vslsThread:y,vscodeThread:v}=h,{text:C}=y.comments.find(h=>h.commentId===m);C&&tryUpdateVSCodeComment(h,!1,C)}))}deleteComment(h){return T(this,void 0,void 0,(function*(){if(!h)return;if(!this.isActive)return;const{commentId:m,vscodeThread:y,threadId:v,vslsThread:C}=h;if(!C.comments.length)return void y.dispose();const T=C.comments.findIndex(h=>h.commentId===m);if(-1!==T){if(C.comments.length>1){if(0===T)throw new N.ByDesignError(M.localize("commentManager.deleteOtherComments"));C.comments.splice(T,1)}else this.threads.delete(v);deleteVSCodeComment(y,m),yield this.service().deleteCommentAsync(v,m,this.sessionId),this.commentCountChanged.fire()}else deleteVSCodeComment(y,m)}))}getThreads(){return T(this,void 0,void 0,(function*(){this.getThreadsPromise||(this.getThreadsPromise=this.getThreadsFromService()),yield this.getThreadsPromise}))}getThreadsFromService(){return T(this,void 0,void 0,(function*(){let h;try{h=yield this.service().getAllCommentThreadsAsync()}catch(h){return this.trace.info("Cannot get comment threads from the host. Comments may be disabled or not supported on the host.",h),void(yield this.dispose())}if(this.isActive){if(!this.commentController){const h=M.localize("commentManager.controllerLabel");this.commentController=P.comments.createCommentController("vsls-comments",h),this.commentController.commentingRangeProvider=this,this.disposables.push(this.commentController)}for(const m of h)this.createVscodeThread(m);h.length&&this.commentCountChanged.fire()}}))}createVscodeThread(h){if(!this.isActive||!h||this.threads.has(h.threadId))return;h=this.cloneVslsThreadIfNeeded(h);const{threadId:m,threadContext:y,comments:v}=h;if(!y||!y.rightFileStart)return;const C=this.getResource(y.filePath);if(!C)return;const T=getRange(y),w=this.commentController.createCommentThread(C,T,[]);w.comments=(v||[]).map(m=>this.createVscodeComment(m,w,h)),w.label=getParticipants(w),w.collapsibleState=P.CommentThreadCollapsibleState.Collapsed,isSharing()&&(w.contextValue="deletable"),this.threads.set(m,{vslsThread:h,vscodeThread:w})}cloneVslsThreadIfNeeded(h){if(!isSharing()||!h)return h;const m=h.threadContext?Object.assign({},h.threadContext):void 0,y=h.comments?h.comments.map(h=>this.cloneVslsCommentIfNeeded(h)):void 0;return Object.assign({},h,{comments:y,threadContext:m})}cloneVslsCommentIfNeeded(h){if(!h)throw new Error("The comment is null or undefined");if(!isSharing())return h;const m=h.likers?h.likers.slice():void 0;return Object.assign({},h,{likers:m})}getResource(h){return h&&(isSharing()?this.pathManager().relativePathToLocalPath(h):R.Uri.parse(`${M.VSLS_SCHEME}:${h}`))}trackThreadPositions(h,m){return T(this,void 0,void 0,(function*(){try{if(yield this.getThreads(),!this.isActive)return;if(isSharing()){for(const m of this.threads.keys())this.trackThreadPosition(m,h);return}const y=yield this.service().getAllCommentThreadsAsync();if(!this.isActive)return;for(const{threadId:v,threadContext:C}of y){if(C.filePath!==m)continue;const{vslsThread:y,vscodeThread:T,isTracked:w}=this.threads.get(v);if(!T||w)continue;const A=getRange(C);A.start.line===T.range.start.line&&A.start.character===T.range.start.character&&A.end.line===T.range.end.line&&A.end.character===T.range.end.character||(y.threadContext=C,T.range=A),this.trackThreadPosition(v,h)}}catch(h){this.trace.error(`Error tracking document positions in ${m}`,h)}}))}trackThreadPosition(h,m){const y=this.threads.get(h);if(y&&!y.isTracked&&y.vscodeThread.resource.toString()===m.uri.toString()&&this.isActive){const v=this.pathManager().localPathToRelativePath(m.uri),C="commentThread_"+h.toString(10);this.session.coeditingClient.positionTracker.setNamedPosition(C,v,m,y.vscodeThread.range,!1),y.isTracked=!0}}getDocumentPath(h){if(h&&h.uri&&this.isSupportedScheme(h.uri))return this.pathManager().localPathToRelativePath(h.uri)}isSupportedScheme(h){return(isSharing()?[M.FILE_SCHEME,M.GITHUB_DEV_SCHEME]:[M.VSLS_SCHEME]).includes(h.scheme)}createVslsComment(h,m=0,y=-1){const v=this.sessionId,C=this.participantId;return{lastUpdatedSessionId:v,parentId:y,threadId:m,participantLabel:this.session.collaboratorManager.getDisplayName(v),participantId:C,text:h}}createVscodeComment(h,m,y){if(!h)throw new Error("The comment is null or undefined");const{commentId:v,text:C,participantId:T,participantLabel:w}=h,A=new P.MarkdownString(C),k=w||T,R=T===this.participantId;return new VSCodeComment(v,A,k,R,m,y)}addVSCodeComment(h,m,y,v){y?(y=this.cloneVslsCommentIfNeeded(y),h.comments.push(y)):y=h.comments[h.comments.length-1];const C=this.createVscodeComment(y,m,h);m.comments=[...m.comments,C],m.label=getParticipants(m)}serviceCommentThreadChanged(h){if(!h)return;if(h.newThread)return void(h.newThread.lastUpdatedSessionId!==this.sessionId&&(this.createVscodeThread(h.newThread),this.commentCountChanged.fire()));if(!h.changedComment||h.changedComment.lastUpdatedSessionId===this.sessionId)return;const{commentId:m,threadId:y,isDeleted:v}=h.changedComment,{vslsThread:C,vscodeThread:T}=this.threads.get(y);if(!T)return;const w=C.comments.findIndex(h=>h.commentId===m);if(v){if(-1===w)return;return deleteVSCodeComment(T,m),C.comments.splice(w,1),C.comments.length||this.threads.delete(y),void this.commentCountChanged.fire()}if(-1===w)return this.addVSCodeComment(C,T,h.changedComment),void this.commentCountChanged.fire();const A=this.cloneVslsCommentIfNeeded(h.changedComment),P=this.createVscodeComment(A,T,C);C.comments[w]=A,T.comments=T.comments.map(h=>h.commentId===m?P:h)}positionChanged(h){for(const m of h){if(!m.name||!m.name.startsWith("commentThread_"))continue;const h=Number.parseInt(m.name.substr("commentThread_".length),10);if(isNaN(h))continue;const{vslsThread:y,vscodeThread:v}=this.threads.get(h);if(!v||!y)continue;const{rightFileStart:C,rightFileEnd:T}=y.threadContext;if(!C||!T)continue;const w={line:m.range.start.line,offset:m.range.start.character},A={line:m.range.end.line,offset:m.range.end.character};C.line===w.line&&C.offset===w.offset&&T.line===A.line&&T.offset===A.offset||(y.threadContext.rightFileStart=w,y.threadContext.rightFileEnd=A,v.range=m.range,isSharing()&&this.hostCommentService().updateThreadPosition(h,w,A))}}};return v([w(M.localize("commentManager.cannotCreateCommentThread"),M.TelemetryEventNames.CREATE_COMMENT_THREAD_FAULT),k(M.TelemetryEventNames.CREATE_COMMENT_THREAD,M.TelemetryEventNames.CREATE_COMMENT_THREAD_FAULT,"CommentManager.createThread"),M.commandBindingDecorator("liveshare.comments.createThread"),C("design:type",Function),C("design:paramtypes",[Object]),C("design:returntype",Promise)],D.prototype,"createThread",null),v([w(M.localize("commentManager.cannotDeleteThread"),M.TelemetryEventNames.DELETE_COMMENT_THREAD_FAULT),k(M.TelemetryEventNames.DELETE_COMMENT_THREAD,M.TelemetryEventNames.DELETE_COMMENT_THREAD_FAULT,"CommentManager.deleteThread"),M.commandBindingDecorator("liveshare.comments.deleteThread"),C("design:type",Function),C("design:paramtypes",[Object]),C("design:returntype",Promise)],D.prototype,"deleteThread",null),v([w(M.localize("commentManager.cannotReply"),M.TelemetryEventNames.REPLY_COMMENT_FAULT),k(M.TelemetryEventNames.REPLY_COMMENT,M.TelemetryEventNames.REPLY_COMMENT_FAULT,"CommentManager.reply"),M.commandBindingDecorator("liveshare.comments.reply"),C("design:type",Function),C("design:paramtypes",[Object]),C("design:returntype",Promise)],D.prototype,"reply",null),v([w(M.localize("commentManager.cannotEditComment"),M.TelemetryEventNames.EDIT_COMMENT_FAULT),k(M.TelemetryEventNames.EDIT_COMMENT,M.TelemetryEventNames.EDIT_COMMENT_FAULT,"CommentManager.editComment"),M.commandBindingDecorator("liveshare.comments.editComment"),C("design:type",Function),C("design:paramtypes",[VSCodeComment]),C("design:returntype",Promise)],D.prototype,"editComment",null),v([w(M.localize("commentManager.cannotSaveComment"),M.TelemetryEventNames.SAVE_COMMENT_FAULT),k(M.TelemetryEventNames.SAVE_COMMENT,M.TelemetryEventNames.SAVE_COMMENT_FAULT,"CommentManager.saveComment"),M.commandBindingDecorator("liveshare.comments.saveComment"),C("design:type",Function),C("design:paramtypes",[VSCodeComment]),C("design:returntype",Promise)],D.prototype,"saveComment",null),v([w(M.localize("commentManager.cannotCancelEditComment"),M.TelemetryEventNames.CANCEL_EDIT_COMMENT_FAULT),k(M.TelemetryEventNames.CANCEL_EDIT_COMMENT,M.TelemetryEventNames.CANCEL_EDIT_COMMENT_FAULT,"CommentManager.cancelEditComment"),M.commandBindingDecorator("liveshare.comments.cancelEditComment"),C("design:type",Function),C("design:paramtypes",[VSCodeComment]),C("design:returntype",Promise)],D.prototype,"cancelEditComment",null),v([w(M.localize("commentManager.cannotDeleteComment"),M.TelemetryEventNames.DELETE_COMMENT_FAULT),k(M.TelemetryEventNames.DELETE_COMMENT,M.TelemetryEventNames.DELETE_COMMENT_FAULT,"CommentManager.deleteComment"),M.commandBindingDecorator("liveshare.comments.deleteComment"),C("design:type",Function),C("design:paramtypes",[VSCodeComment]),C("design:returntype",Promise)],D.prototype,"deleteComment",null),D=v([y,C("design:paramtypes",[Object,Object])],D),new D(h,m)};class VSCodeComment{constructor(h,m,y,v,C,T){this.commentId=h,this.body=m,this.vscodeThread=C,this.vslsThread=T,this.mode=P.CommentMode.Preview,this.author={name:y},v?this.contextValue="editable_deletable":isSharing()&&(this.contextValue="deletable")}get text(){return"string"==typeof this.body?this.body:this.body?this.body.value:void 0}get threadId(){return this.vslsThread.threadId}}function getRange(h){const m=new P.Position(h.rightFileStart.line,h.rightFileStart.offset),y=h.rightFileEnd?new P.Position(h.rightFileEnd.line,h.rightFileEnd.offset):m;return new P.Range(m,y)}function isSharing(){return M.sessionStateTracker.State===M.SessionState.Shared||M.sessionStateTracker.State===M.SessionState.SharingInProgress}function tryUpdateVSCodeComment(h,m,y){if(!h)return!1;const{vscodeThread:v,commentId:C}=h;if("number"!=typeof C||isNaN(C))throw new Error("VSCode comment does not have id");if(!v)throw new Error("VSCode comment does not have parent");return v.comments=v.comments.map(h=>(h.commentId===C&&(h.mode=m?P.CommentMode.Editing:P.CommentMode.Preview,y&&(h.body=new P.MarkdownString(y))),h)),v.collapsibleState=P.CommentThreadCollapsibleState.Expanded,!0}function deleteVSCodeComment(h,m){h.comments=h.comments.filter(h=>h.commentId!==m),h.comments.length?h.label=getParticipants(h):h.dispose()}function getParticipants(h){if(!h)throw new Error("vscodeThread is null or undefined");const m=new Set(h.comments.map(h=>h.author.name));let y="";for(const h of m)h&&(y=y?`${y}, ${h}`:h);const v=M.localize("commentManager.participants");return y?`${v} ${y}`:void 0}},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0}),function(h){h.create=function create(h){return{dispose:h}}}(m.Disposable||(m.Disposable={})),function(h){const m={dispose(){}};h.None=function(){return m}}(m.Event||(m.Event={}));class CallbackList{add(h,m=null,y){this._callbacks||(this._callbacks=[],this._contexts=[]),this._callbacks.push(h),this._contexts.push(m),Array.isArray(y)&&y.push({dispose:()=>this.remove(h,m)})}remove(h,m=null){if(this._callbacks){for(var y=!1,v=0,C=this._callbacks.length;v<C;v++)if(this._callbacks[v]===h){if(this._contexts[v]===m)return this._callbacks.splice(v,1),void this._contexts.splice(v,1);y=!0}if(y)throw new Error("When adding a listener with a context, you should remove it with the same context")}}invoke(...h){if(!this._callbacks)return[];for(var m=[],y=this._callbacks.slice(0),v=this._contexts.slice(0),C=0,T=y.length;C<T;C++)try{m.push(y[C].apply(v[C],h))}catch(h){console.error(h)}return m}isEmpty(){return!this._callbacks||0===this._callbacks.length}dispose(){this._callbacks=void 0,this._contexts=void 0}}class Emitter{constructor(h){this._options=h}get event(){return this._event||(this._event=(h,m,y)=>{let v;return this._callbacks||(this._callbacks=new CallbackList),this._options&&this._options.onFirstListenerAdd&&this._callbacks.isEmpty()&&this._options.onFirstListenerAdd(this),this._callbacks.add(h,m),v={dispose:()=>{this._callbacks.remove(h,m),v.dispose=Emitter._noop,this._options&&this._options.onLastListenerRemove&&this._callbacks.isEmpty()&&this._options.onLastListenerRemove(this)}},Array.isArray(y)&&y.push(v),v}),this._event}fire(h){this._callbacks&&this._callbacks.invoke.call(this._callbacks,h)}dispose(){this._callbacks&&(this._callbacks.dispose(),this._callbacks=void 0)}}m.Emitter=Emitter,Emitter._noop=function(){}},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0});const v=y(8),C=y(3);class LanguageServiceTelemetryEventNames{}m.LanguageServiceTelemetryEventNames=LanguageServiceTelemetryEventNames,LanguageServiceTelemetryEventNames.LSPSERVER_INIT_FAULT=C.TelemetryEventNames.FAULT_PREFIX+"init-lspserver-fault",LanguageServiceTelemetryEventNames.SUMMARIZE_LSREQUESTS="summarize-lsrequests",LanguageServiceTelemetryEventNames.GET_DIAGNOSTICS_FAULT=C.TelemetryEventNames.FAULT_PREFIX+"get-diagnostics-fault",LanguageServiceTelemetryEventNames.RESET_LANGUAGE_SERVICES="reset-languageservices",LanguageServiceTelemetryEventNames.SHOW_OPPORTUNISTIC_CODE_LENS="show-opportunisticcodelens",LanguageServiceTelemetryEventNames.INVOKE_OPPORTUNISTIC_CODE_LENS="invoke-opportunisticcodelens";class LanuageServiceTelemetryPropertyNames{}m.LanuageServiceTelemetryPropertyNames=LanuageServiceTelemetryPropertyNames,LanuageServiceTelemetryPropertyNames.SERVICED_REQUESTS=C.TelemetryPropertyNames.FEATURE_NAME+"ServicedRequests",LanuageServiceTelemetryPropertyNames.REJECTED_REQUESTS=C.TelemetryPropertyNames.FEATURE_NAME+"RejectedRequests",LanuageServiceTelemetryPropertyNames.UNACKNOWLEDGED_HOST_CHANGES_REJECTS=C.TelemetryPropertyNames.FEATURE_NAME+"UnacknowledgedHostChangesRejects",LanuageServiceTelemetryPropertyNames.REJECTED_REQUESTS_DETAILS=C.TelemetryPropertyNames.FEATURE_NAME+"RejectedRequestsDetails",m.summarizeLsRequests=function summarizeLsRequests(h,m,y,C){let T=new v.TelemetryEvent(LanguageServiceTelemetryEventNames.SUMMARIZE_LSREQUESTS);T.addMeasure(LanuageServiceTelemetryPropertyNames.SERVICED_REQUESTS,h),T.addMeasure(LanuageServiceTelemetryPropertyNames.REJECTED_REQUESTS,m),T.addMeasure(LanuageServiceTelemetryPropertyNames.UNACKNOWLEDGED_HOST_CHANGES_REJECTS,y),T.addProperty(LanuageServiceTelemetryPropertyNames.REJECTED_REQUESTS_DETAILS,JSON.stringify(C)),T.send()}},function(h,m,y){"use strict";function isAsciiLetter(h){return function isLowerAsciiLetter(h){return h>=97&&h<=122}(h)||function isUpperAsciiLetter(h){return h>=65&&h<=90}(h)}function doEqualsIgnoreCase(h,m,y=h.length){if("string"!=typeof h||"string"!=typeof m)return!1;for(let v=0;v<y;v++){const y=h.charCodeAt(v),C=m.charCodeAt(v);if(y!==C)if(isAsciiLetter(y)&&isAsciiLetter(C)){let h=Math.abs(y-C);if(0!==h&&32!==h)return!1}else if(String.fromCharCode(y).toLowerCase()!==String.fromCharCode(C).toLowerCase())return!1}return!0}Object.defineProperty(m,"__esModule",{value:!0}),m.stripWildcards=function stripWildcards(h){return h.replace(/\*/g,"")},m.startsWith=function startsWith(h,m){if(h.length<m.length)return!1;if(h===m)return!0;for(let y=0;y<m.length;y++)if(h[y]!==m[y])return!1;return!0},m.startsWithIgnoreCase=function startsWithIgnoreCase(h,m){const y=m.length;return!(m.length>h.length)&&doEqualsIgnoreCase(h,m,y)},m.endsWith=function endsWith(h,m){let y=h.length-m.length;return y>0?h.indexOf(m,y)===y:0===y&&h===m},m.equalsIgnoreCase=function equalsIgnoreCase(h,m){return(h?h.length:0)===(m?m.length:0)&&doEqualsIgnoreCase(h,m)},m.fuzzyContains=function fuzzyContains(h,m){if(!h||!m)return!1;if(h.length<m.length)return!1;const y=m.length,v=h.toLowerCase();let C=0,T=-1;for(;C<y;){let h=v.indexOf(m[C],T+1);if(h<0)return!1;T=h,C++}return!0}},function(h,m,y){"use strict";var v;Object.defineProperty(m,"__esModule",{value:!0}),function(h){h.id="id",h.prompt="prompt"}(v=m.MetadataKey||(m.MetadataKey={}));class TerminalEntry{constructor(h,m,y){this.terminal=h,this.own=m,this.workers=y,this.metadata={}}dispose(){this.workers.forEach(h=>h.dispose()),this.own&&this.terminal.dispose()}get(h){return this.metadata[h]}update(h,m){this.metadata[h]=m}}m.TerminalEntry=TerminalEntry;m.TerminalCache=class TerminalCache{constructor(){this.terminalEntries=[]}clean(h){if(h){this.terminalEntries.filter(h=>h.own).map(h=>h.terminal).forEach(h=>this.remove(h));for(const h of this.terminalEntries)h.workers.splice(0).forEach(h=>h.dispose())}else{this.terminalEntries.splice(0).forEach(h=>h.dispose())}}has(h){return!!this.terminalEntries.find(m=>m.terminal===h)}get(h){return this.terminalEntries.find(m=>m.terminal===h)}hasId(h){return!!this.terminalEntries.find(m=>m.get(v.id)===`${h}`)}getById(h){return this.terminalEntries.find(m=>m.get(v.id)===`${h}`)}register(h,m,y,...C){let T;return this.has(h)?(T=this.get(h),T.own=y||T.own,T.workers.push(...C)):(T=new TerminalEntry(h,y,C),this.terminalEntries.push(T)),null!==m&&T.update(v.id,`${m}`),T}remove(h){const m=this.terminalEntries.findIndex(m=>m.terminal===h);if(-1!==m){this.terminalEntries[m].dispose(),this.terminalEntries.splice(m,1)}}}},function(h,m,y){h.exports=y(1487)},function(h,m,y){"use strict";y.r(m),y.d(m,"HttpClient",(function(){return http_client_HttpClient})),y.d(m,"HttpError",(function(){return HttpError})),y.d(m,"HttpClientError",(function(){return HttpClientError})),y.d(m,"HttpClientAuthenticationError",(function(){return HttpClientAuthenticationError})),y.d(m,"HttpClientResponseError",(function(){return HttpClientResponseError})),y.d(m,"HttpCancellationError",(function(){return HttpCancellationError}));var v=y(19),C=y(52),T=y(20),w=y(46),A=y(47);const P=v.Readable,k=Symbol("buffer"),R=Symbol("type");class Blob{constructor(){this[R]="";const h=arguments[0],m=arguments[1],y=[];let v=0;if(h){const m=h,C=Number(m.length);for(let h=0;h<C;h++){const C=m[h];let T;T=C instanceof Buffer?C:ArrayBuffer.isView(C)?Buffer.from(C.buffer,C.byteOffset,C.byteLength):C instanceof ArrayBuffer?Buffer.from(C):C instanceof Blob?C[k]:Buffer.from("string"==typeof C?C:String(C)),v+=T.length,y.push(T)}}this[k]=Buffer.concat(y);let C=m&&void 0!==m.type&&String(m.type).toLowerCase();C&&!/[^\u0020-\u007E]/.test(C)&&(this[R]=C)}get size(){return this[k].length}get type(){return this[R]}text(){return Promise.resolve(this[k].toString())}arrayBuffer(){const h=this[k],m=h.buffer.slice(h.byteOffset,h.byteOffset+h.byteLength);return Promise.resolve(m)}stream(){const h=new P;return h._read=function(){},h.push(this[k]),h.push(null),h}toString(){return"[object Blob]"}slice(){const h=this.size,m=arguments[0],y=arguments[1];let v,C;v=void 0===m?0:m<0?Math.max(h+m,0):Math.min(m,h),C=void 0===y?h:y<0?Math.max(h+y,0):Math.min(y,h);const T=Math.max(C-v,0),w=this[k].slice(v,v+T),A=new Blob([],{type:arguments[2]});return A[k]=w,A}}function FetchError(h,m,y){Error.call(this,h),this.message=h,this.type=m,y&&(this.code=this.errno=y.code),Error.captureStackTrace(this,this.constructor)}let M;Object.defineProperties(Blob.prototype,{size:{enumerable:!0},type:{enumerable:!0},slice:{enumerable:!0}}),Object.defineProperty(Blob.prototype,Symbol.toStringTag,{value:"Blob",writable:!1,enumerable:!1,configurable:!0}),FetchError.prototype=Object.create(Error.prototype),FetchError.prototype.constructor=FetchError,FetchError.prototype.name="FetchError";try{M=require("encoding").convert}catch(h){}const N=Symbol("Body internals"),D=v.PassThrough;function Body(h){var m=this,y=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},C=y.size;let T=void 0===C?0:C;var w=y.timeout;let A=void 0===w?0:w;null==h?h=null:isURLSearchParams(h)?h=Buffer.from(h.toString()):isBlob(h)||Buffer.isBuffer(h)||("[object ArrayBuffer]"===Object.prototype.toString.call(h)?h=Buffer.from(h):ArrayBuffer.isView(h)?h=Buffer.from(h.buffer,h.byteOffset,h.byteLength):h instanceof v||(h=Buffer.from(String(h)))),this[N]={body:h,disturbed:!1,error:null},this.size=T,this.timeout=A,h instanceof v&&h.on("error",(function(h){const y="AbortError"===h.name?h:new FetchError(`Invalid response body while trying to fetch ${m.url}: ${h.message}`,"system",h);m[N].error=y}))}function consumeBody(){var h=this;if(this[N].disturbed)return Body.Promise.reject(new TypeError(`body used already for: ${this.url}`));if(this[N].disturbed=!0,this[N].error)return Body.Promise.reject(this[N].error);let m=this.body;if(null===m)return Body.Promise.resolve(Buffer.alloc(0));if(isBlob(m)&&(m=m.stream()),Buffer.isBuffer(m))return Body.Promise.resolve(m);if(!(m instanceof v))return Body.Promise.resolve(Buffer.alloc(0));let y=[],C=0,T=!1;return new Body.Promise((function(v,w){let A;h.timeout&&(A=setTimeout((function(){T=!0,w(new FetchError(`Response timeout while trying to fetch ${h.url} (over ${h.timeout}ms)`,"body-timeout"))}),h.timeout)),m.on("error",(function(m){"AbortError"===m.name?(T=!0,w(m)):w(new FetchError(`Invalid response body while trying to fetch ${h.url}: ${m.message}`,"system",m))})),m.on("data",(function(m){if(!T&&null!==m){if(h.size&&C+m.length>h.size)return T=!0,void w(new FetchError(`content size at ${h.url} over limit: ${h.size}`,"max-size"));C+=m.length,y.push(m)}})),m.on("end",(function(){if(!T){clearTimeout(A);try{v(Buffer.concat(y,C))}catch(m){w(new FetchError(`Could not create Buffer from response body for ${h.url}: ${m.message}`,"system",m))}}}))}))}function isURLSearchParams(h){return"object"==typeof h&&"function"==typeof h.append&&"function"==typeof h.delete&&"function"==typeof h.get&&"function"==typeof h.getAll&&"function"==typeof h.has&&"function"==typeof h.set&&("URLSearchParams"===h.constructor.name||"[object URLSearchParams]"===Object.prototype.toString.call(h)||"function"==typeof h.sort)}function isBlob(h){return"object"==typeof h&&"function"==typeof h.arrayBuffer&&"string"==typeof h.type&&"function"==typeof h.stream&&"function"==typeof h.constructor&&"string"==typeof h.constructor.name&&/^(Blob|File)$/.test(h.constructor.name)&&/^(Blob|File)$/.test(h[Symbol.toStringTag])}function clone(h){let m,y,C=h.body;if(h.bodyUsed)throw new Error("cannot clone body after it is used");return C instanceof v&&"function"!=typeof C.getBoundary&&(m=new D,y=new D,C.pipe(m),C.pipe(y),h[N].body=m,C=y),C}function extractContentType(h){return null===h?null:"string"==typeof h?"text/plain;charset=UTF-8":isURLSearchParams(h)?"application/x-www-form-urlencoded;charset=UTF-8":isBlob(h)?h.type||null:Buffer.isBuffer(h)||"[object ArrayBuffer]"===Object.prototype.toString.call(h)||ArrayBuffer.isView(h)?null:"function"==typeof h.getBoundary?`multipart/form-data;boundary=${h.getBoundary()}`:h instanceof v?null:"text/plain;charset=UTF-8"}function getTotalBytes(h){const m=h.body;return null===m?0:isBlob(m)?m.size:Buffer.isBuffer(m)?m.length:m&&"function"==typeof m.getLengthSync&&(m._lengthRetrievers&&0==m._lengthRetrievers.length||m.hasKnownLength&&m.hasKnownLength())?m.getLengthSync():null}Body.prototype={get body(){return this[N].body},get bodyUsed(){return this[N].disturbed},arrayBuffer(){return consumeBody.call(this).then((function(h){return h.buffer.slice(h.byteOffset,h.byteOffset+h.byteLength)}))},blob(){let h=this.headers&&this.headers.get("content-type")||"";return consumeBody.call(this).then((function(m){return Object.assign(new Blob([],{type:h.toLowerCase()}),{[k]:m})}))},json(){var h=this;return consumeBody.call(this).then((function(m){try{return JSON.parse(m.toString())}catch(m){return Body.Promise.reject(new FetchError(`invalid json response body at ${h.url} reason: ${m.message}`,"invalid-json"))}}))},text(){return consumeBody.call(this).then((function(h){return h.toString()}))},buffer(){return consumeBody.call(this)},textConverted(){var h=this;return consumeBody.call(this).then((function(m){return function convertBody(h,m){if("function"!=typeof M)throw new Error("The package `encoding` must be installed to use the textConverted() function");const y=m.get("content-type");let v,C,T="utf-8";y&&(v=/charset=([^;]*)/i.exec(y));C=h.slice(0,1024).toString(),!v&&C&&(v=/<meta.+?charset=(['"])(.+?)\1/i.exec(C));!v&&C&&(v=/<meta[\s]+?http-equiv=(['"])content-type\1[\s]+?content=(['"])(.+?)\2/i.exec(C),v&&(v=/charset=(.*)/i.exec(v.pop())));!v&&C&&(v=/<\?xml.+?encoding=(['"])(.+?)\1/i.exec(C));v&&(T=v.pop(),"gb2312"!==T&&"gbk"!==T||(T="gb18030"));return M(h,"UTF-8",T).toString()}(m,h.headers)}))}},Object.defineProperties(Body.prototype,{body:{enumerable:!0},bodyUsed:{enumerable:!0},arrayBuffer:{enumerable:!0},blob:{enumerable:!0},json:{enumerable:!0},text:{enumerable:!0}}),Body.mixIn=function(h){for(const m of Object.getOwnPropertyNames(Body.prototype))if(!(m in h)){const y=Object.getOwnPropertyDescriptor(Body.prototype,m);Object.defineProperty(h,m,y)}},Body.Promise=global.Promise;const I=/[^\^_`a-zA-Z\-0-9!#$%&'*+.|~]/,x=/[^\t\x20-\x7e\x80-\xff]/;function validateName(h){if(h=`${h}`,I.test(h)||""===h)throw new TypeError(`${h} is not a legal HTTP header name`)}function validateValue(h){if(h=`${h}`,x.test(h))throw new TypeError(`${h} is not a legal HTTP header value`)}function find(h,m){m=m.toLowerCase();for(const y in h)if(y.toLowerCase()===m)return y}const O=Symbol("map");class Headers{constructor(){let h=arguments.length>0&&void 0!==arguments[0]?arguments[0]:void 0;if(this[O]=Object.create(null),h instanceof Headers){const m=h.raw(),y=Object.keys(m);for(const h of y)for(const y of m[h])this.append(h,y)}else if(null==h);else{if("object"!=typeof h)throw new TypeError("Provided initializer must be an object");{const m=h[Symbol.iterator];if(null!=m){if("function"!=typeof m)throw new TypeError("Header pairs must be iterable");const y=[];for(const m of h){if("object"!=typeof m||"function"!=typeof m[Symbol.iterator])throw new TypeError("Each header pair must be iterable");y.push(Array.from(m))}for(const h of y){if(2!==h.length)throw new TypeError("Each header pair must be a name/value tuple");this.append(h[0],h[1])}}else for(const m of Object.keys(h)){const y=h[m];this.append(m,y)}}}}get(h){validateName(h=`${h}`);const m=find(this[O],h);return void 0===m?null:this[O][m].join(", ")}forEach(h){let m=arguments.length>1&&void 0!==arguments[1]?arguments[1]:void 0,y=getHeaders(this),v=0;for(;v<y.length;){var C=y[v];const T=C[0],w=C[1];h.call(m,w,T,this),y=getHeaders(this),v++}}set(h,m){m=`${m}`,validateName(h=`${h}`),validateValue(m);const y=find(this[O],h);this[O][void 0!==y?y:h]=[m]}append(h,m){m=`${m}`,validateName(h=`${h}`),validateValue(m);const y=find(this[O],h);void 0!==y?this[O][y].push(m):this[O][h]=[m]}has(h){return validateName(h=`${h}`),void 0!==find(this[O],h)}delete(h){validateName(h=`${h}`);const m=find(this[O],h);void 0!==m&&delete this[O][m]}raw(){return this[O]}keys(){return createHeadersIterator(this,"key")}values(){return createHeadersIterator(this,"value")}[Symbol.iterator](){return createHeadersIterator(this,"key+value")}}function getHeaders(h){let m=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"key+value";const y=Object.keys(h[O]).sort();return y.map("key"===m?function(h){return h.toLowerCase()}:"value"===m?function(m){return h[O][m].join(", ")}:function(m){return[m.toLowerCase(),h[O][m].join(", ")]})}Headers.prototype.entries=Headers.prototype[Symbol.iterator],Object.defineProperty(Headers.prototype,Symbol.toStringTag,{value:"Headers",writable:!1,enumerable:!1,configurable:!0}),Object.defineProperties(Headers.prototype,{get:{enumerable:!0},forEach:{enumerable:!0},set:{enumerable:!0},append:{enumerable:!0},has:{enumerable:!0},delete:{enumerable:!0},keys:{enumerable:!0},values:{enumerable:!0},entries:{enumerable:!0}});const L=Symbol("internal");function createHeadersIterator(h,m){const y=Object.create(U);return y[L]={target:h,kind:m,index:0},y}const U=Object.setPrototypeOf({next(){if(!this||Object.getPrototypeOf(this)!==U)throw new TypeError("Value of `this` is not a HeadersIterator");var h=this[L];const m=h.target,y=h.kind,v=h.index,C=getHeaders(m,y);return v>=C.length?{value:void 0,done:!0}:(this[L].index=v+1,{value:C[v],done:!1})}},Object.getPrototypeOf(Object.getPrototypeOf([][Symbol.iterator]())));function exportNodeCompatibleHeaders(h){const m=Object.assign({__proto__:null},h[O]),y=find(h[O],"Host");return void 0!==y&&(m[y]=m[y][0]),m}Object.defineProperty(U,Symbol.toStringTag,{value:"HeadersIterator",writable:!1,enumerable:!1,configurable:!0});const B=Symbol("Response internals"),W=C.STATUS_CODES;class Response{constructor(){let h=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,m=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};Body.call(this,h,m);const y=m.status||200,v=new Headers(m.headers);if(null!=h&&!v.has("Content-Type")){const m=extractContentType(h);m&&v.append("Content-Type",m)}this[B]={url:m.url,status:y,statusText:m.statusText||W[y],headers:v,counter:m.counter}}get url(){return this[B].url||""}get status(){return this[B].status}get ok(){return this[B].status>=200&&this[B].status<300}get redirected(){return this[B].counter>0}get statusText(){return this[B].statusText}get headers(){return this[B].headers}clone(){return new Response(clone(this),{url:this.url,status:this.status,statusText:this.statusText,headers:this.headers,ok:this.ok,redirected:this.redirected})}}Body.mixIn(Response.prototype),Object.defineProperties(Response.prototype,{url:{enumerable:!0},status:{enumerable:!0},ok:{enumerable:!0},redirected:{enumerable:!0},statusText:{enumerable:!0},headers:{enumerable:!0},clone:{enumerable:!0}}),Object.defineProperty(Response.prototype,Symbol.toStringTag,{value:"Response",writable:!1,enumerable:!1,configurable:!0});const q=Symbol("Request internals"),Y=T.parse,V=T.format,$="destroy"in v.Readable.prototype;function isRequest(h){return"object"==typeof h&&"object"==typeof h[q]}class Request{constructor(h){let m,y=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};isRequest(h)?m=Y(h.url):(m=h&&h.href?Y(h.href):Y(`${h}`),h={});let v=y.method||h.method||"GET";if(v=v.toUpperCase(),(null!=y.body||isRequest(h)&&null!==h.body)&&("GET"===v||"HEAD"===v))throw new TypeError("Request with GET/HEAD method cannot have body");let C=null!=y.body?y.body:isRequest(h)&&null!==h.body?clone(h):null;Body.call(this,C,{timeout:y.timeout||h.timeout||0,size:y.size||h.size||0});const T=new Headers(y.headers||h.headers||{});if(null!=C&&!T.has("Content-Type")){const h=extractContentType(C);h&&T.append("Content-Type",h)}let w=isRequest(h)?h.signal:null;if("signal"in y&&(w=y.signal),null!=w&&!function isAbortSignal(h){const m=h&&"object"==typeof h&&Object.getPrototypeOf(h);return!(!m||"AbortSignal"!==m.constructor.name)}(w))throw new TypeError("Expected signal to be an instanceof AbortSignal");this[q]={method:v,redirect:y.redirect||h.redirect||"follow",headers:T,parsedURL:m,signal:w},this.follow=void 0!==y.follow?y.follow:void 0!==h.follow?h.follow:20,this.compress=void 0!==y.compress?y.compress:void 0===h.compress||h.compress,this.counter=y.counter||h.counter||0,this.agent=y.agent||h.agent}get method(){return this[q].method}get url(){return V(this[q].parsedURL)}get headers(){return this[q].headers}get redirect(){return this[q].redirect}get signal(){return this[q].signal}clone(){return new Request(this)}}function AbortError(h){Error.call(this,h),this.type="aborted",this.message=h,Error.captureStackTrace(this,this.constructor)}Body.mixIn(Request.prototype),Object.defineProperty(Request.prototype,Symbol.toStringTag,{value:"Request",writable:!1,enumerable:!1,configurable:!0}),Object.defineProperties(Request.prototype,{method:{enumerable:!0},url:{enumerable:!0},headers:{enumerable:!0},redirect:{enumerable:!0},clone:{enumerable:!0},signal:{enumerable:!0}}),AbortError.prototype=Object.create(Error.prototype),AbortError.prototype.constructor=AbortError,AbortError.prototype.name="AbortError";const z=v.PassThrough,G=T.resolve;function fetch(h,m){if(!fetch.Promise)throw new Error("native promise missing, set fetch.Promise to your favorite alternative");return Body.Promise=fetch.Promise,new fetch.Promise((function(y,T){const P=new Request(h,m),k=function getNodeRequestOptions(h){const m=h[q].parsedURL,y=new Headers(h[q].headers);if(y.has("Accept")||y.set("Accept","*/*"),!m.protocol||!m.hostname)throw new TypeError("Only absolute URLs are supported");if(!/^https?:$/.test(m.protocol))throw new TypeError("Only HTTP(S) protocols are supported");if(h.signal&&h.body instanceof v.Readable&&!$)throw new Error("Cancellation of streamed requests with AbortSignal is not supported in node < 8");let C=null;if(null==h.body&&/^(POST|PUT)$/i.test(h.method)&&(C="0"),null!=h.body){const m=getTotalBytes(h);"number"==typeof m&&(C=String(m))}C&&y.set("Content-Length",C),y.has("User-Agent")||y.set("User-Agent","node-fetch/1.0 (+https://github.com/bitinn/node-fetch)"),h.compress&&!y.has("Accept-Encoding")&&y.set("Accept-Encoding","gzip,deflate");let T=h.agent;return"function"==typeof T&&(T=T(m)),y.has("Connection")||T||y.set("Connection","close"),Object.assign({},m,{method:h.method,headers:exportNodeCompatibleHeaders(y),agent:T})}(P),R=("https:"===k.protocol?w:C).request,M=P.signal;let N=null;const D=function abort(){let h=new AbortError("The user aborted a request.");T(h),P.body&&P.body instanceof v.Readable&&P.body.destroy(h),N&&N.body&&N.body.emit("error",h)};if(M&&M.aborted)return void D();const L=function abortAndFinalize(){D(),finalize()},U=R(k);let B;function finalize(){U.abort(),M&&M.removeEventListener("abort",L),clearTimeout(B)}M&&M.addEventListener("abort",L),P.timeout&&U.once("socket",(function(h){B=setTimeout((function(){T(new FetchError(`network timeout at: ${P.url}`,"request-timeout")),finalize()}),P.timeout)})),U.on("error",(function(h){T(new FetchError(`request to ${P.url} failed, reason: ${h.message}`,"system",h)),finalize()})),U.on("response",(function(h){clearTimeout(B);const m=function createHeadersLenient(h){const m=new Headers;for(const y of Object.keys(h))if(!I.test(y))if(Array.isArray(h[y]))for(const v of h[y])x.test(v)||(void 0===m[O][y]?m[O][y]=[v]:m[O][y].push(v));else x.test(h[y])||(m[O][y]=[h[y]]);return m}(h.headers);if(fetch.isRedirect(h.statusCode)){const v=m.get("Location"),C=null===v?null:G(P.url,v);switch(P.redirect){case"error":return T(new FetchError(`redirect mode is set to error: ${P.url}`,"no-redirect")),void finalize();case"manual":if(null!==C)try{m.set("Location",C)}catch(h){T(h)}break;case"follow":if(null===C)break;if(P.counter>=P.follow)return T(new FetchError(`maximum redirect reached at: ${P.url}`,"max-redirect")),void finalize();const v={headers:new Headers(P.headers),follow:P.follow,counter:P.counter+1,agent:P.agent,compress:P.compress,method:P.method,body:P.body,signal:P.signal,timeout:P.timeout};return 303!==h.statusCode&&P.body&&null===getTotalBytes(P)?(T(new FetchError("Cannot follow redirect with body being a readable stream","unsupported-redirect")),void finalize()):(303!==h.statusCode&&(301!==h.statusCode&&302!==h.statusCode||"POST"!==P.method)||(v.method="GET",v.body=void 0,v.headers.delete("content-length")),y(fetch(new Request(C,v))),void finalize())}}h.once("end",(function(){M&&M.removeEventListener("abort",L)}));let v=h.pipe(new z);const C={url:P.url,status:h.statusCode,statusText:h.statusMessage,headers:m,size:P.size,timeout:P.timeout,counter:P.counter},w=m.get("Content-Encoding");if(!P.compress||"HEAD"===P.method||null===w||204===h.statusCode||304===h.statusCode)return N=new Response(v,C),void y(N);const k={flush:A.Z_SYNC_FLUSH,finishFlush:A.Z_SYNC_FLUSH};if("gzip"==w||"x-gzip"==w)return v=v.pipe(A.createGunzip(k)),N=new Response(v,C),void y(N);if("deflate"!=w&&"x-deflate"!=w){if("br"==w&&"function"==typeof A.createBrotliDecompress)return v=v.pipe(A.createBrotliDecompress()),N=new Response(v,C),void y(N);N=new Response(v,C),y(N)}else{h.pipe(new z).once("data",(function(h){v=8==(15&h[0])?v.pipe(A.createInflate()):v.pipe(A.createInflateRaw()),N=new Response(v,C),y(N)}))}})),function writeToStream(h,m){const y=m.body;null===y?h.end():isBlob(y)?y.stream().pipe(h):Buffer.isBuffer(y)?(h.write(y),h.end()):y.pipe(h)}(U,P)}))}fetch.isRedirect=function(h){return 301===h||302===h||303===h||307===h||308===h},fetch.Promise=global.Promise;var J=fetch,X=y(743);const Z={fetch:void 0,Request:void 0,AbortController:void 0},{fetch:ee,Request:te,AbortController:re}="undefined"!=typeof self?self:"undefined"!=typeof window?window:Z;var ie=null!=ee?ee:J,se=null!=te?te:Request,oe=null!=re?re:X.AbortController;function toAbortSignal(h){const m=new oe;h.isCancellationRequested&&m.abort();const y=h.onCancellationRequested(()=>{y.dispose(),m.abort()});return m.signal}var ae=y(6);function createTimeoutTokenSource(h){const m=new ae.CancellationTokenSource,y=setTimeout(()=>{m.cancel()},h);return{cancel:m.cancel.bind(m),dispose(){clearTimeout(y),m.dispose()},token:m.token}}class HttpError extends Error{constructor(){super(...arguments),this.errorType="HttpError"}}class HttpClientError extends HttpError{constructor(h){if(super(h),this.errorType="HttpClientError",h instanceof HttpClientError)return h;let m;m=h instanceof Error?h.message:"string"==typeof h?h:"",this.message=m,this.name="HttpClientError","function"==typeof Error.captureStackTrace&&Error.captureStackTrace(this,HttpClientError)}}class HttpClientAuthenticationError extends HttpError{constructor(h){super(`Request failed with status code ${h.status}.`),this.response=h,this.errorType="HttpClientAuthenticationError",this.name="HttpClientAuthenticationError","function"==typeof Error.captureStackTrace&&Error.captureStackTrace(this,HttpClientAuthenticationError)}}class HttpClientResponseError extends HttpError{constructor(h){super(`Request failed with status code ${h.status}.`),this.response=h,this.errorType="HttpClientResponseError",this.name="HttpClientResponseError","function"==typeof Error.captureStackTrace&&Error.captureStackTrace(this,HttpClientResponseError)}}class HttpCancellationError extends HttpError{constructor(h){super(h),this.errorType="HttpCancellationError",this.name="CancellationError","function"==typeof Error.captureStackTrace&&Error.captureStackTrace(this,HttpCancellationError)}}class FetchRequest_FetchRequest{constructor(h,m,y,v,C){var T;this.logger=h,this.configuration=m,this.request=y,this.init=v,this.cancellationToken=C,this.retry=0,this.input=this.request instanceof URL?this.request.toString():this.request;let w="GET";"string"!=typeof this.input&&(w=this.input.method),(null===(T=this.init)||void 0===T?void 0:T.method)&&(w=this.init.method),this.method=w,this.url="string"==typeof this.input?this.input:this.input.url}then(h,m){return this.fetch().then(h,m)}async text(){const h=await this.fetchWithCancellationCheck();return await h.text()}async json(){const h=await this.fetchWithCancellationCheck();return await h.json()}async arrayBuffer(){const h=await this.fetchWithCancellationCheck();return await h.arrayBuffer()}async blob(){const h=await this.fetchWithCancellationCheck();return await h.blob()}async formData(){const h=await this.fetchWithCancellationCheck();return await h.formData()}async value(){return await this.json()}async fetch(){var h;if(this.logger.verbose(`${this.method} - fetch start`),null===(h=this.cancellationToken)||void 0===h?void 0:h.isCancellationRequested)throw new HttpCancellationError;const m=await this.prepareRequest();return this.ongoingPromise=this.retryRequest(m),await this.ongoingPromise}async fetchWithCancellationCheck(){var h;const m=await this.fetch();if(null===(h=this.cancellationToken)||void 0===h?void 0:h.isCancellationRequested)throw new HttpCancellationError;return m}async makeRequest(h){let m;try{m=await ie(h),this.logger.verbose(`${this.method} - fetch response. (url=${this.url};status=${m.status})`)}catch(h){if("AbortError"===h.name)throw this.logger.verbose(`${this.method} - fetch cancelled. (url=${this.url};cancelled=true)`),new HttpCancellationError(h.message);throw this.logger.verbose(`${this.method} - fetch failed. (url=${this.url};reason=${h.message};failed=true)`),new HttpClientError(h)}if(this.configuration.throwOnErrorStatus&&(401===m.status||403===m.status))throw new HttpClientAuthenticationError(m);if(this.configuration.throwOnErrorStatus&&!m.ok)throw new HttpClientResponseError(m);return m}async retryRequest(h){try{return await this.makeRequest(h)}catch(m){if(!this.shouldRetry(m))throw m;const y=await this.prepareRetryRequest(h,m.response);return await this.delayRetry(m),this.retry++,await this.retryRequest(y)}}shouldRetry(h){return!(this.retry>=this.configuration.retryCount)&&!!(h instanceof HttpClientResponseError&&h.response&&this.configuration.retryStatusCodes.includes(h.response.status))}delayRetry(h){let m=1e3*this.retry;if(h instanceof HttpClientResponseError){const y=h.response.headers.get("Retry-After");if(null!==y){let h=Number(y);isNaN(h)?h=Math.max(Date.parse(y)-Date.now(),0):h*=1e3,isNaN(h)||(m=Math.max(m,h))}}return new Promise(h=>{setTimeout(h,m)})}async prepareRequest(){var h;let m=new se(this.input,Object.assign({credentials:"same-origin"},this.init));this.configuration.beforeRequest&&(m=await this.configuration.beforeRequest(m));const y=null!==(h=this.cancellationToken)&&void 0!==h?h:createTimeoutTokenSource(this.configuration.timeout).token;return new se(m,{signal:toAbortSignal(y)})}async prepareRetryRequest(h,m){var y;let v=h;if(this.configuration.beforeRetry){const y=await this.configuration.beforeRetry(h,m,this.retry);Array.isArray(y)?(this.retry=y[1],v=y[0]):v=y}const C=null!==(y=this.cancellationToken)&&void 0!==y?y:createTimeoutTokenSource(this.configuration.timeout).token;return new se(v,{signal:toAbortSignal(C)})}}const ce={requestNumber:1},le={timeout:3e4,throwOnErrorStatus:!0,beforeRequest:void 0,beforeRetry:void 0,retryCount:2,retryStatusCodes:[429,500,503]};class http_client_HttpClient{constructor(h,m={}){this.logger=h,this.configuration=Object.assign(Object.assign({},le),m)}fetch(h,m,y){return new FetchRequest_FetchRequest(this.logger.withName(`FetchRequest:${ce.requestNumber++}`),this.configuration,h,m,y)}method(h,m,y,v){return this.fetch(m,Object.assign(Object.assign({},y),{method:h}),v)}get(h,m,y){return this.method("GET",h,m,y)}post(h,m,y){return this.method("POST",h,m,y)}put(h,m,y){return this.method("PUT",h,m,y)}patch(h,m,y){return this.method("PATCH",h,m,y)}head(h,m,y){return this.method("HEAD",h,m,y)}delete(h,m,y){return this.method("DELETE",h,m,y)}}},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0});var v=y(117);m.LogLevel=v.LogLevel;var C=y(202);m.LogValueType=C.LogValueType},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0}),function(h){h[h.None=0]="None",h[h.Text=1]="Text",h[h.Path=2]="Path",h[h.Email=3]="Email"}(m.LogValueType||(m.LogValueType={}))},function(h,m){h.exports=require("module")},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0});const v=y(89);class CancellationError extends v.BaseError{constructor(){super(...arguments),this.errorType="CancellationError"}}m.CancellationError=CancellationError},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0}),m.wait=h=>new Promise(m=>{setTimeout(m,h)})},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0});const v=y(154),C=y(120);let T=Buffer.from("\r","ascii")[0],w=Buffer.from("\n","ascii")[0];class MessageBuffer{constructor(h="utf8"){this.encoding=h,this.index=0,this.buffer=Buffer.allocUnsafe(8192)}append(h){var m=h;if("string"==typeof h){var y=h,v=Buffer.byteLength(y,this.encoding);(m=Buffer.allocUnsafe(v)).write(y,0,v,this.encoding)}if(this.buffer.length-this.index>=m.length)m.copy(this.buffer,this.index,0,m.length);else{var C=8192*(Math.ceil((this.index+m.length)/8192)+1);0===this.index?(this.buffer=Buffer.allocUnsafe(C),m.copy(this.buffer,0,0,m.length)):this.buffer=Buffer.concat([this.buffer.slice(0,this.index),m],C)}this.index+=m.length}tryReadHeaders(){let h=void 0,m=0;for(;m+3<this.index&&(this.buffer[m]!==T||this.buffer[m+1]!==w||this.buffer[m+2]!==T||this.buffer[m+3]!==w);)m++;if(m+3>=this.index)return h;h=Object.create(null),this.buffer.toString("ascii",0,m).split("\r\n").forEach(m=>{let y=m.indexOf(":");if(-1===y)throw new Error("Message header must separate key and value using :");let v=m.substr(0,y),C=m.substr(y+1).trim();h[v]=C});let y=m+4;return this.buffer=this.buffer.slice(y),this.index=this.index-y,h}tryReadContent(h){if(this.index<h)return null;let m=this.buffer.toString(this.encoding,0,h),y=h;return this.buffer.copy(this.buffer,0,y),this.index=this.index-y,m}get numberOfBytes(){return this.index}}!function(h){h.is=function is(h){let m=h;return m&&C.func(m.listen)&&C.func(m.dispose)&&C.func(m.onError)&&C.func(m.onClose)&&C.func(m.onPartialMessage)}}(m.MessageReader||(m.MessageReader={}));class AbstractMessageReader{constructor(){this.errorEmitter=new v.Emitter,this.closeEmitter=new v.Emitter,this.partialMessageEmitter=new v.Emitter}dispose(){this.errorEmitter.dispose(),this.closeEmitter.dispose()}get onError(){return this.errorEmitter.event}fireError(h){this.errorEmitter.fire(this.asError(h))}get onClose(){return this.closeEmitter.event}fireClose(){this.closeEmitter.fire(void 0)}get onPartialMessage(){return this.partialMessageEmitter.event}firePartialMessage(h){this.partialMessageEmitter.fire(h)}asError(h){return h instanceof Error?h:new Error(`Reader recevied error. Reason: ${C.string(h.message)?h.message:"unknown"}`)}}m.AbstractMessageReader=AbstractMessageReader;class StreamMessageReader extends AbstractMessageReader{constructor(h,m="utf8"){super(),this.readable=h,this.buffer=new MessageBuffer(m),this._partialMessageTimeout=1e4}set partialMessageTimeout(h){this._partialMessageTimeout=h}get partialMessageTimeout(){return this._partialMessageTimeout}listen(h){this.nextMessageLength=-1,this.messageToken=0,this.partialMessageTimer=void 0,this.callback=h,this.readable.on("data",h=>{this.onData(h)}),this.readable.on("error",h=>this.fireError(h)),this.readable.on("close",()=>this.fireClose())}onData(h){for(this.buffer.append(h);;){if(-1===this.nextMessageLength){let h=this.buffer.tryReadHeaders();if(!h)return;let m=h["Content-Length"];if(!m)throw new Error("Header must provide a Content-Length property.");let y=parseInt(m);if(isNaN(y))throw new Error("Content-Length value must be a number.");this.nextMessageLength=y}var m=this.buffer.tryReadContent(this.nextMessageLength);if(null===m)return void this.setPartialMessageTimer();this.clearPartialMessageTimer(),this.nextMessageLength=-1,this.messageToken++;var y=JSON.parse(m);this.callback(y)}}clearPartialMessageTimer(){this.partialMessageTimer&&(clearTimeout(this.partialMessageTimer),this.partialMessageTimer=void 0)}setPartialMessageTimer(){this.clearPartialMessageTimer(),this._partialMessageTimeout<=0||(this.partialMessageTimer=setTimeout((h,m)=>{this.partialMessageTimer=void 0,h===this.messageToken&&(this.firePartialMessage({messageToken:h,waitingTime:m}),this.setPartialMessageTimer())},this._partialMessageTimeout,this.messageToken,this._partialMessageTimeout))}}m.StreamMessageReader=StreamMessageReader;m.IPCMessageReader=class IPCMessageReader extends AbstractMessageReader{constructor(h){super(),this.process=h;let m=this.process;m.on("error",h=>this.fireError(h)),m.on("close",()=>this.fireClose())}listen(h){this.process.on("message",h)}};m.SocketMessageReader=class SocketMessageReader extends StreamMessageReader{constructor(h,m="utf-8"){super(h,m)}}},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0});const v=y(154),C=y(120);!function(h){h.is=function is(h){let m=h;return m&&C.func(m.dispose)&&C.func(m.onClose)&&C.func(m.onError)&&C.func(m.write)}}(m.MessageWriter||(m.MessageWriter={}));class AbstractMessageWriter{constructor(){this.errorEmitter=new v.Emitter,this.closeEmitter=new v.Emitter}dispose(){this.errorEmitter.dispose(),this.closeEmitter.dispose()}get onError(){return this.errorEmitter.event}fireError(h,m,y){this.errorEmitter.fire([this.asError(h),m,y])}get onClose(){return this.closeEmitter.event}fireClose(){this.closeEmitter.fire(void 0)}asError(h){return h instanceof Error?h:new Error(`Writer recevied error. Reason: ${C.string(h.message)?h.message:"unknown"}`)}}m.AbstractMessageWriter=AbstractMessageWriter;m.StreamMessageWriter=class StreamMessageWriter extends AbstractMessageWriter{constructor(h,m="utf8"){super(),this.writable=h,this.encoding=m,this.errorCount=0,this.writable.on("error",h=>this.fireError(h)),this.writable.on("close",()=>this.fireClose())}write(h){let m=JSON.stringify(h),y=["Content-Length: ",Buffer.byteLength(m,this.encoding).toString(),"\r\n","\r\n"];try{this.writable.write(y.join(""),"ascii"),this.writable.write(m,this.encoding),this.errorCount=0}catch(m){this.errorCount++,this.fireError(m,h,this.errorCount)}}};m.IPCMessageWriter=class IPCMessageWriter extends AbstractMessageWriter{constructor(h){super(),this.process=h,this.errorCount=0,this.queue=[],this.sending=!1;let m=this.process;m.on("error",h=>this.fireError(h)),m.on("close",()=>this.fireClose)}write(h){this.sending||0!==this.queue.length?this.queue.push(h):this.doWriteMessage(h)}doWriteMessage(h){try{this.process.send&&(this.sending=!0,this.process.send(h,void 0,void 0,m=>{this.sending=!1,m?(this.errorCount++,this.fireError(m,h,this.errorCount)):this.errorCount=0,this.queue.length>0&&this.doWriteMessage(this.queue.shift())}))}catch(m){this.errorCount++,this.fireError(m,h,this.errorCount)}}};m.SocketMessageWriter=class SocketMessageWriter extends AbstractMessageWriter{constructor(h,m="utf8"){super(),this.socket=h,this.queue=[],this.sending=!1,this.encoding=m,this.errorCount=0,this.socket.on("error",h=>this.fireError(h)),this.socket.on("close",()=>this.fireClose())}write(h){this.sending||0!==this.queue.length?this.queue.push(h):this.doWriteMessage(h)}doWriteMessage(h){let m=JSON.stringify(h),y=["Content-Length: ",Buffer.byteLength(m,this.encoding).toString(),"\r\n","\r\n"];try{this.sending=!0,this.socket.write(y.join(""),"ascii",y=>{y&&this.handleError(y,h);try{this.socket.write(m,this.encoding,m=>{this.sending=!1,m?this.handleError(m,h):this.errorCount=0,this.queue.length>0&&this.doWriteMessage(this.queue.shift())})}catch(y){this.handleError(y,h)}})}catch(m){this.handleError(m,h)}}handleError(h,m){this.errorCount++,this.fireError(h,m,this.errorCount)}}},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0});const v=y(151),C=y(90);class Signal{constructor(h){this.stateReference="pending",this.promiseReference=new Promise((h,m)=>{this.promiseResolve=h,this.promiseReject=m}),this.resolve=this.resolve.bind(this),this.reject=this.reject.bind(this),this.cancel=this.cancel.bind(this),h&&(h.isCancellationRequested?this.cancel():h.onCancellationRequested&&h.onCancellationRequested(()=>{this.isFulfilled||this.cancel()}))}get isFulfilled(){return"pending"!==this.state}get state(){return this.stateReference}get isResolved(){return"resolved"===this.state}get isRejected(){return"rejected"===this.state}get isCancelled(){return"cancelled"===this.state}resolve(h){this.isFulfilled||(this.stateReference="resolved",v.assertDefined(this.promiseResolve,"No `promiseResolve` function found."),this.promiseResolve(h))}reject(h){this.isFulfilled||(this.stateReference="rejected",v.assertDefined(this.promiseReject,"No `promiseReject` function found."),this.promiseReject(h))}cancel(){this.isFulfilled||(this.stateReference="cancelled",v.assertDefined(this.promiseReject,"No `promiseReject` function found."),this.promiseReject(new C.CancellationError))}get promise(){return this.promiseReference}static from(h){const m=new Signal;return v.isThenable(h)?h.then(m.resolve,m.reject):m.resolve(h),m}dispose(){this.isFulfilled||this.cancel()}}m.Signal=Signal},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0}),m.defer=(h,m=1)=>setTimeout(h,m)},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0});const v=y(73);m.randomInt=(h,m=0)=>{v.assert(!isNaN(m),'"min" param is not a number.'),v.assert(!isNaN(h),'"max" param is not a number.'),v.assert(isFinite(h),'"max" param is not finite.'),v.assert(isFinite(m),'"min" param is not finite.'),v.assert(h>m,`"max"(${h}) param should be greater than "min"(${m}).`);const y=(h-m)*Math.random();return Math.round(m+y)}},function(h,m,y){"use strict";var v=this&&this.__awaiter||function(h,m,y,v){return new(y||(y=Promise))((function(C,T){function fulfilled(h){try{step(v.next(h))}catch(h){T(h)}}function rejected(h){try{step(v.throw(h))}catch(h){T(h)}}function step(h){h.done?C(h.value):function adopt(h){return h instanceof y?h:new y((function(m){m(h)}))}(h.value).then(fulfilled,rejected)}step((v=v.apply(h,m||[])).next())}))};Object.defineProperty(m,"__esModule",{value:!0});const C=y(15),T=y(2);class RpcClientProxyBase extends T.DisposableClass{constructor(h){super(h)}sendNotification(h,m,y){return v(this,void 0,void 0,(function*(){const v=yield this.ensureConnectionAsync(),T=C.LoggerSettings.disableObfuscation?JSON.stringify(y):"";h.verbose(`sendNotification-> ${m}: ${T}`),Array.isArray(y)?v.sendNotification(m,...y):v.sendNotification(m,y)}))}sendRequest(h,m,y,w,...A){return v(this,void 0,void 0,(function*(){let v=!1;const P=yield Promise.race([this.ensureConnectionAsync(),new Promise((h,m)=>{if(w){if(w.isCancellationRequested)return m(new T.CancellationError("The request was cancelled."));w.onCancellationRequested(()=>{v||m(new T.CancellationError("The request was cancelled."))})}})]);v=!0;let k="";C.LoggerSettings.disableObfuscation&&(k=JSON.stringify(A),k=k.substr(1,k.length-2)),h.verbose(`< ${m}(${k})`);const R=Date.now();let M;try{let h;y&&(y.cancellation=w,A.progress=y),h=w?P.sendRequest(m,A,w):P.sendRequest(m,A),M=yield h}catch(y){throw this.isDisposed,h.error(`> ${m}() error: `+y.data),y}const N=(Date.now()-R).toFixed(1);return C.LoggerSettings.disableObfuscation?h.verbose(`> ${m}() => ${JSON.stringify(M)} t:${N}`):h.verbose(`> ${m}() succeeded t:${N}`),M}))}}m.RpcClientProxyBase=RpcClientProxyBase;class RpcClientProxy extends RpcClientProxyBase{constructor(h,m){super(m),this.promise=h,this.initPromise=Promise.resolve()}static fromRpcConnection(h,m){return new RpcClientProxy(Promise.resolve(h),m)}static fromPromise(h,m){return new RpcClientProxy(h,m)}ensureConnectionAsync(){return this.promise}}m.RpcClientProxy=RpcClientProxy},function(h,m,y){"use strict";var v=this&&this.__importStar||function(h){if(h&&h.__esModule)return h;var m={};if(null!=h)for(var y in h)Object.hasOwnProperty.call(h,y)&&(m[y]=h[y]);return m.default=h,m};Object.defineProperty(m,"__esModule",{value:!0});const C=v(y(6)),T=y(2),w=y(121),A=y(354),P=y(121);m.methodProgress="$/progress";class RpcServiceHandlerBase extends T.DisposableClass{constructor(h){super(h),this.rpcRequestsWithContext=new w.RpcRequestsWithContext,this.rpcReadFilters=[this.rpcRequestsWithContext.readFilter],this.rpcWriteFilters=[],this.progressHandlers=new Map,this.requests=new Map,this.requestsWithProgress=new Set,this.notifications=new Map,this.notificationsCookies=0,this.handleNoneRequestCallbacks=new T.CallbackContainer,this.handleNoneNotificationCallbacks=new T.CallbackContainer,this.addProgressFilters()}get serviceNames(){const h=new Set,addServices=m=>{for(const y of m)h.add(y.split(".")[0])};return addServices(this.requests.keys()),addServices(this.notifications.keys()),Array.from(h)}clear(){this.requests.clear(),this.requestsWithProgress.clear(),this.notifications.clear(),this.handleNoneRequestCallbacks.clear(),this.handleNoneNotificationCallbacks.clear()}onHandleNoneRequest(h){return this.handleNoneRequestCallbacks.add(h)}onHandleNoneNotification(h){return this.handleNoneNotificationCallbacks.add(h)}createRpcConnection(h,m){return C.createMessageConnection(this.createFilteredMessageReader(h.reader),this.createFilteredMessageWriter(h.writer),new A.RpcLoggerAdapter(m))}addReadFilter(h){return addRpcFilter(this.rpcReadFilters,h)}addWriteFilter(h){return addRpcFilter(this.rpcWriteFilters,h)}addRequestMethod(h,m){this.requests.set(h,m)}addRequestMethodWithContext(h,m){this.addRequestMethod(h,m),this.rpcRequestsWithContext.add(h)}addRequestMethodWithProgress(h,m){this.addRequestMethod(h,m),this.requestsWithProgress.add(h)}removeRequestMethod(h){this.requests.delete(h),this.requestsWithProgress.delete(h)}addNotificationHandler(h,m){let y=this.notifications.get(h);y||(y=[],this.notifications.set(h,y));const v={cookie:++this.notificationsCookies,notificationHandler:m};return y.push(v),v.cookie}removeNotificationHandler(h,m){const y=this.notifications.get(h);if(y){const h=y.findIndex(h=>h.cookie===m);if(-1!==h)return y.splice(h,1)[0].notificationHandler}}onRequest(h,y,v,...C){const T=this.requests.get(v);if(!T){for(const h of this.handleNoneRequestCallbacks.items){const m=h(y,v,...C);if(void 0!==m)return m}return Promise.resolve(P.createMethodNotFoundResponse(v))}const[w]=C.splice(0,1);if(this.requestsWithProgress.has(v)){const h={report:h=>{y.sendNotification(m.methodProgress,{id:w,value:h})}};C.splice(C.length-1,0,h)}return h?h(T,...C):T(...C)}onNotification(h,y,...v){if(y!==m.methodProgress||"object"!=typeof v[0])if(this.notifications.has(y))this.notifications.get(y).forEach(h=>{h.notificationHandler(...v)});else for(const m of this.handleNoneNotificationCallbacks.items)m(h,y,...v)}createFilteredMessageReader(h){return new w.WrappedMessageReader(h,h=>RpcServiceHandlerBase.filterMessage(h,this.rpcReadFilters))}createFilteredMessageWriter(h){return new w.WrappedMessageWriter(h,h=>RpcServiceHandlerBase.filterMessage(h,this.rpcWriteFilters))}static filterMessage(h,m){for(const y of m)h=y(h);return h}addProgressFilters(){this.rpcReadFilters.push(h=>{const y=h,v=y.id;if(void 0!==v)Array.isArray(y.params)?y.params.splice(0,0,v):void 0!==y.params?y.params=[v,y.params]:y.params=[v],void 0===y.result&&void 0===y.error||this.progressHandlers.delete(v);else if(y.method===m.methodProgress){let h=y.params;void 0===h.id&&(h=y.params[0]);const m=this.progressHandlers.get(h.id);m&&m.report(h.value,h.id)}return h}),this.rpcWriteFilters.push(h=>{const m=h,y=m.id,v=m.params;if(void 0!==y&&v&&v.progress&&"function"==typeof v.progress.report){this.progressHandlers.set(m.id,m.params.progress);const h=v.progress.cancellation;h&&h.onCancellationRequested(()=>{this.progressHandlers.delete(y)}),delete v.progress}return h})}}m.RpcServiceHandlerBase=RpcServiceHandlerBase;function addRpcFilter(h,m){return h.push(m),{dispose:()=>{const y=h.indexOf(m);-1!==y&&h.splice(y,1)}}}m.RpcServiceHandler=class RpcServiceHandler extends RpcServiceHandlerBase{registerRpcService(h,m,y,v){if(!h)throw new Error("service argument is missing or undefined");if(!m)throw new Error("serviceInfo argument is missing or undefined");if(y&&y.filter(h=>m.methods.indexOf(h)<0).length>0)throw new Error("invalid context method");const C=m.name;if(!C)throw new Error("serviceInfo.serviceName is empty or undefined");let T=!0;const w=new Set,A=new Map;let k=[];const R={dispose:()=>{T=!1;for(const h of k)h.dispose();k=[];for(const h of w)this.removeRequestMethod(h);w.clear();for(const[h,m]of A)this.removeNotificationHandler(h,m);A.clear()}},M=h.$RestrictedHandlers$;try{for(const T of m.methods){const A=`${C}.${T}`,P=M&&M.get(T);if(P){this.addRequestMethodWithContext(A,(...m)=>P.apply(h,m)),w.add(A);continue}const k=h[T]||h[T+"Async"];if("function"==typeof k)y&&y.indexOf(T)>=0?this.addRequestMethodWithContext(A,(...m)=>k.apply(h,m)):this.addRequestMethod(A,(...m)=>k.apply(h,m)),w.add(A);else if(v||void 0===v)throw new Error(`Object ${m.name} does not implement method '${T}' of service '${C}'.`)}if(m.voidMethods)for(const y of m.voidMethods){const T=`${C}.${y}`;if(M&&M.get(y))throw new Error(`Restricted operation check is not supported yet for notification methods. Object ${m.name} restricts notification '${y}' of service '${C}'.`);const w=this[y]||h[y];if("function"!=typeof w){if(v)throw new Error(`Object ${m.name} does not implement notification '${y}' of service '${C}'.`);continue}const P=this.addNotificationHandler(T,(...m)=>w.apply(h,m));A.set(T,P)}if(m.events)for(const y of m.events){if(!y)continue;const m=P.getEventPropertyName(y),v=h[m];"function"==typeof v&&v(h=>{T&&this.sendNotification(this.trace,`${C}.${y}`,h).catch(h=>this.trace.error(`Failed to send notification:${C}.${y}`,h))},k)}}catch(h){throw R.dispose(),h}return R}}},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0}),m.throwNotInitialized=h=>{if(!h)throw new Error("The API was not initialized, please call `initialize` method first.");return h}},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0});class TelemetryPropertyNames{static get FAULT_TYPE(){return TelemetryPropertyNames.FEATURE_NAME+"FaultType"}static get EVENT_ID(){return TelemetryPropertyNames.FEATURE_NAME+"EventId"}static get CORRELATION_ID(){return TelemetryPropertyNames.FEATURE_NAME+"CorrelationId"}static get LOG_LINES(){return TelemetryPropertyNames.FEATURE_NAME+"LogLines"}static get EVENT_MESSAGE(){return TelemetryPropertyNames.FEATURE_NAME+"Message"}static get EVENT_EXCEPTION_STACK(){return TelemetryPropertyNames.FEATURE_NAME+"ExceptionStack"}static get EVENT_RESULT(){return TelemetryPropertyNames.FEATURE_NAME+"Result"}static get EVENT_TYPE(){return TelemetryPropertyNames.FEATURE_NAME+"Type"}static get EVENT_DURATION(){return TelemetryPropertyNames.FEATURE_NAME+"Duration"}static get EVENT_CREATION_TIME(){return TelemetryPropertyNames.FEATURE_NAME+"CreationTime"}static get SESSION_ID(){return TelemetryPropertyNames.FEATURE_NAME+"SessionId"}static get EVENT_EXCEPTION_CODE(){return TelemetryPropertyNames.FEATURE_NAME+"ExceptionCode"}static get SAMPLE_RATE(){return TelemetryPropertyNames.FEATURE_NAME+"SampleRate"}static get SEQUENCE_NUMBER(){return TelemetryPropertyNames.FEATURE_NAME+"SequenceNumber"}}m.TelemetryPropertyNames=TelemetryPropertyNames,TelemetryPropertyNames.FEATURE_NAME="liveshare.";class TelemetryPropertyValues{}m.TelemetryPropertyValues=TelemetryPropertyValues,TelemetryPropertyValues.START="start",TelemetryPropertyValues.END="end"},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0});var v=y(363);m.LogFileTraceListener=v.LogFileTraceListener;var C=y(364);m.LogLocations=C.LogLocations;var T=y(842);m.TelemetryLogFilter=T.LogFilter},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0}),function(h){h.MACOS="darwin",h.WINDOWS="win32",h.LINUX="linux"}(m.OSPlatform||(m.OSPlatform={}))},function(h,m,y){"use strict";const v=y(36).fromCallback,C=y(870);h.exports={readJson:v(C.readFile),readJsonSync:C.readFileSync,writeJson:v(C.writeFile),writeJsonSync:C.writeFileSync}},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0});const v=y(124),C=y(884),T=new Map;m.loadJSON=(h,m=!1)=>{if(m){const m=T.get(h);if(void 0!==m)return m}const y=v.fileAccess.readFileSync(h,"utf8"),w=C(y),A=JSON.parse(w);return m&&T.set(h,A),A}},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0}),m.Activatable=function Activatable(h){return class extends h{activate(){return this.isActivated=!0,Promise.resolve(this.isActivated)}deactivate(){return this.isActivated=!1,Promise.resolve()}}},m.Inittable=function Inittable(h){return class extends h{init(){return this.isInitialized=!0,Promise.resolve()}}},m.Disposable=function Disposable(h){return class extends h{dispose(){return this.isDisposed=!0,Promise.resolve()}}}},function(h,m,y){"use strict";var v=this&&this.__awaiter||function(h,m,y,v){return new(y||(y=Promise))((function(C,T){function fulfilled(h){try{step(v.next(h))}catch(h){T(h)}}function rejected(h){try{step(v.throw(h))}catch(h){T(h)}}function step(h){h.done?C(h.value):function adopt(h){return h instanceof y?h:new y((function(m){m(h)}))}(h.value).then(fulfilled,rejected)}step((v=v.apply(h,m||[])).next())}))};Object.defineProperty(m,"__esModule",{value:!0});const C=y(219),T=y(123);class DataScrapingManager extends(C.Inittable(C.Disposable(Object))){constructor(){super(),this.disposables=[],this.deferredWork=Promise.resolve(!0),this.builders=new Map,this.jobs=[],this.trace=T.traceSource.withName("DataScrapingManager"),this.deferredWork=this.deferredWork.then(()=>this.init()).catch(h=>{this.trace.error(h.message)})}static get vscode(){return y(0)}static get Instance(){return DataScrapingManager.singleton||(DataScrapingManager.singleton=new DataScrapingManager),DataScrapingManager.singleton}get onScrappingStarted(){return this.eventEmitter||(this.eventEmitter=new DataScrapingManager.vscode.EventEmitter),this.eventEmitter.event}dispose(){const h=Object.create(null,{dispose:{get:()=>super.dispose}});return v(this,void 0,void 0,(function*(){yield this.deferredWork,this.disposables.splice(0).forEach(h=>h.dispose()),this.jobs.splice(0).forEach(h=>h.dispose()),yield h.dispose.call(this)}))}init(){const h=Object.create(null,{init:{get:()=>super.init}});return v(this,void 0,void 0,(function*(){!this.isInitialized&&DataScrapingManager.vscode.window.onDidOpenTerminal&&(DataScrapingManager.vscode.window.onDidOpenTerminal(this.handleTerminalCreated,this,this.disposables),DataScrapingManager.vscode.window.onDidCloseTerminal(this.handleTerminalClosed,this,this.disposables),DataScrapingManager.vscode.window.terminals.forEach(this.handleTerminalCreated,this),yield h.init.call(this))}))}registerDataScraper(h,m){return v(this,void 0,void 0,(function*(){if(yield this.deferredWork,this.builders.set(h,m),this.isInitialized){const y=DataScrapingManager.vscode.window.terminals.map(y=>v(this,void 0,void 0,(function*(){const v=m(y);v&&(yield v.init(),this.createJob(y,v,h))})));yield Promise.all(y)}return new DataScrapingManager.vscode.Disposable(()=>this.unregisterDataScraper(h))}))}unregisterDataScraper(h){this.builders.delete(h);const m=this.jobs.splice(0);m.filter(m=>m.kind===h).forEach(h=>h.dispose()),this.jobs.push(...m.filter(m=>m.kind!==h))}handleTerminalCreated(h){return v(this,void 0,void 0,(function*(){const m=[...this.builders.entries()].map(m=>v(this,void 0,void 0,(function*(){const[y,v]=m,C=v(h);C&&(yield C.init(),this.createJob(h,C,y))})));this.deferredWork=this.deferredWork.then(()=>Promise.all(m)).catch(h=>{this.trace.error(h.message)})}))}createJob(h,m,y){let v;v="function"==typeof DataScrapingManager.vscode.window.onDidWriteTerminalData?DataScrapingManager.vscode.window.onDidWriteTerminalData(y=>{y.terminal===h&&m.processData(y.data)}):h.creationOptions.pty.onDidWrite(m.processData,m);const C={kind:y,dataScraper:m,terminal:h,registration:v,dispose:()=>(v.dispose(),m.dispose())};return this.jobs.push(C),this.eventEmitter||(this.eventEmitter=new DataScrapingManager.vscode.EventEmitter),this.eventEmitter.fire(C.terminal),C}handleTerminalClosed(h){const m=this.jobs.splice(0);m.filter(m=>m.terminal===h).forEach(h=>h.dispose()),this.jobs.push(...m.filter(m=>m.terminal!==h))}}m.DataScrapingManager=DataScrapingManager;const w=DataScrapingManager.Instance;m.dataScrapingManagerInstance=w},function(h,m,y){"use strict";var v=this&&this.__decorate||function(h,m,y,v){var C,T=arguments.length,w=T<3?m:null===v?v=Object.getOwnPropertyDescriptor(m,y):v;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)w=Reflect.decorate(h,m,y,v);else for(var A=h.length-1;A>=0;A--)(C=h[A])&&(w=(T<3?C(w):T>3?C(m,y,w):C(m,y))||w);return T>3&&w&&Object.defineProperty(m,y,w),w},C=this&&this.__metadata||function(h,m){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(h,m)};Object.defineProperty(m,"__esModule",{value:!0});const T=y(16);class RemoteStreamMoniker{}m.RemoteStreamMoniker=RemoteStreamMoniker;class FileServiceRootDirectoryConfiguration{}m.FileServiceRootDirectoryConfiguration=FileServiceRootDirectoryConfiguration;class FileServiceRootConfiguration{}v([T.dataFormat(FileServiceRootDirectoryConfiguration),C("design:type",Array)],FileServiceRootConfiguration.prototype,"directories",void 0),m.FileServiceRootConfiguration=FileServiceRootConfiguration;class MaybeImmutableOfAccessControl{}m.MaybeImmutableOfAccessControl=MaybeImmutableOfAccessControl;class AccessControl extends MaybeImmutableOfAccessControl{}var w,A,P;m.AccessControl=AccessControl,function(h){h[h.Begin="begin"]="Begin",h[h.Current="current"]="Current",h[h.End="end"]="End"}(m.SeekOrigin||(m.SeekOrigin={}));class FeatureFlagStore{}m.FeatureFlagStore=FeatureFlagStore;class EventArgs{}m.EventArgs=EventArgs;m.AttemptHubConnectionEventArgs=class AttemptHubConnectionEventArgs extends EventArgs{},function(h){h[h.None="none"]="None",h[h.TokenExpired="tokenExpired"]="TokenExpired",h[h.ServiceUnavailable="serviceUnavailable"]="ServiceUnavailable"}(m.HubConnectionError||(m.HubConnectionError={}));m.AgentTraceEventArgs=class AgentTraceEventArgs extends EventArgs{};m.AgentSessionRequest=class AgentSessionRequest{};m.AgentSessionResponse=class AgentSessionResponse{};class AuthenticationToken{}v([T.dataFormat(T.DataFormat.Omit),C("design:type",String)],AuthenticationToken.prototype,"token",void 0),v([T.dataFormat(T.DataFormat.Omit),C("design:type",String)],AuthenticationToken.prototype,"code",void 0),m.AuthenticationToken=AuthenticationToken;class UserAccountInfo{}v([T.dataFormat(T.DataFormat.Hide),C("design:type",String)],UserAccountInfo.prototype,"accountId",void 0),m.UserAccountInfo=UserAccountInfo;class UserInfo extends UserAccountInfo{}v([T.dataFormat(T.DataFormat.Hide),C("design:type",String)],UserInfo.prototype,"id",void 0),v([T.dataFormat(T.DataFormat.Hide),C("design:type",String)],UserInfo.prototype,"displayName",void 0),v([T.dataFormat(T.DataFormat.Email),C("design:type",String)],UserInfo.prototype,"emailAddress",void 0),v([T.dataFormat(T.DataFormat.Hide),C("design:type",String)],UserInfo.prototype,"userName",void 0),v([T.dataFormat(T.DataFormat.Uri),C("design:type",String)],UserInfo.prototype,"avatarUri",void 0),m.UserInfo=UserInfo,function(h){h[h.Unknown="unknown"]="Unknown",h[h.Transient="transient"]="Transient",h[h.Pending="pending"]="Pending",h[h.Accepted="accepted"]="Accepted",h[h.Deleted="deleted"]="Deleted"}(m.UserAccountStatus||(m.UserAccountStatus={}));class RecentCollaborator{}v([T.dataFormat(T.DataFormat.Email),C("design:type",String)],RecentCollaborator.prototype,"email",void 0),v([T.dataFormat(T.DataFormat.Hide),C("design:type",String)],RecentCollaborator.prototype,"name",void 0),v([T.dataFormat(T.DataFormat.Uri),C("design:type",String)],RecentCollaborator.prototype,"avatarUri",void 0),m.RecentCollaborator=RecentCollaborator;m.AuthenticationOptions=class AuthenticationOptions{};class AuthenticationChangedEventArgs extends EventArgs{}v([T.dataFormat(UserInfo),C("design:type",UserInfo)],AuthenticationChangedEventArgs.prototype,"account",void 0),v([T.dataFormat(T.DataFormat.Omit),C("design:type",String)],AuthenticationChangedEventArgs.prototype,"accessToken",void 0),m.AuthenticationChangedEventArgs=AuthenticationChangedEventArgs;class AuthenticatedUserInfo{}v([T.dataFormat(UserInfo),C("design:type",UserInfo)],AuthenticatedUserInfo.prototype,"userInfo",void 0),v([T.dataFormat(T.DataFormat.Omit),C("design:type",String)],AuthenticatedUserInfo.prototype,"accessToken",void 0),m.AuthenticatedUserInfo=AuthenticatedUserInfo;m.BrokerManifest=class BrokerManifest{};m.BrokerEventArgs=class BrokerEventArgs extends EventArgs{},function(h){h[h.Text="text"]="Text",h[h.Typing="typing"]="Typing"}(m.ChatMessageType||(m.ChatMessageType={}));m.ChatParticipant=class ChatParticipant{};class ChatMessageBody{}m.ChatMessageBody=ChatMessageBody;class ChatMessage{}v([T.dataFormat(ChatMessageBody),C("design:type",ChatMessageBody)],ChatMessage.prototype,"body",void 0),m.ChatMessage=ChatMessage;class MessageReceivedEventArgs extends EventArgs{}v([T.dataFormat(ChatMessage),C("design:type",ChatMessage)],MessageReceivedEventArgs.prototype,"message",void 0),m.MessageReceivedEventArgs=MessageReceivedEventArgs;class Position{constructor(){this.startOffset=-1}}m.Position=Position,function(h){h[h.Active="active"]="Active",h[h.Closed="closed"]="Closed"}(m.CommentThreadStatus||(m.CommentThreadStatus={}));class CommentThreadContext{}v([T.dataFormat(T.DataFormat.Path),C("design:type",String)],CommentThreadContext.prototype,"filePath",void 0),v([T.dataFormat(Position),C("design:type",Position)],CommentThreadContext.prototype,"leftFileStart",void 0),v([T.dataFormat(Position),C("design:type",Position)],CommentThreadContext.prototype,"leftFileEnd",void 0),v([T.dataFormat(Position),C("design:type",Position)],CommentThreadContext.prototype,"rightFileStart",void 0),v([T.dataFormat(Position),C("design:type",Position)],CommentThreadContext.prototype,"rightFileEnd",void 0),m.CommentThreadContext=CommentThreadContext;class Comment{}v([T.dataFormat(T.DataFormat.Text),C("design:type",String)],Comment.prototype,"participantId",void 0),v([T.dataFormat(T.DataFormat.Text),C("design:type",String)],Comment.prototype,"participantLabel",void 0),v([T.dataFormat(T.DataFormat.Text),C("design:type",String)],Comment.prototype,"text",void 0),m.Comment=Comment;class CommentThread{}v([T.dataFormat(Comment),C("design:type",Array)],CommentThread.prototype,"comments",void 0),v([T.dataFormat(CommentThreadContext),C("design:type",CommentThreadContext)],CommentThread.prototype,"threadContext",void 0),m.CommentThread=CommentThread;class CommentThreadChangedEventArgs extends EventArgs{}v([T.dataFormat(CommentThread),C("design:type",CommentThread)],CommentThreadChangedEventArgs.prototype,"newThread",void 0),v([T.dataFormat(Comment),C("design:type",Comment)],CommentThreadChangedEventArgs.prototype,"changedComment",void 0),m.CommentThreadChangedEventArgs=CommentThreadChangedEventArgs;class CommentThreadLocation{}v([T.dataFormat(CommentThreadContext),T.dataFormat(CommentThreadContext),C("design:type",CommentThreadContext)],CommentThreadLocation.prototype,"threadContext",void 0),m.CommentThreadLocation=CommentThreadLocation;m.AddressAndMask=class AddressAndMask{};m.AgentVersionInfo=class AgentVersionInfo{};m.ClientVersionInfo=class ClientVersionInfo{},function(h){h[h.None="none"]="None",h[h.Allow="allow"]="Allow",h[h.Block="block"]="Block"}(m.FirewallStatus||(m.FirewallStatus={}));m.HubMethodNotifyEventArgs=class HubMethodNotifyEventArgs extends EventArgs{};m.HubConnectionStateEventArgs=class HubConnectionStateEventArgs extends EventArgs{},function(h){h[h.None="none"]="None",h[h.Invited="invited"]="Invited",h[h.Dismissed="dismissed"]="Dismissed",h[h.Joining="joining"]="Joining",h[h.Joined="joined"]="Joined"}(m.InviteContactStatus||(m.InviteContactStatus={}));m.InviteStatusNotify=class InviteStatusNotify{},function(h){h[h.Idle="idle"]="Idle",h[h.Shared="shared"]="Shared"}(m.LiveShareSessionState||(m.LiveShareSessionState={})),function(h){h[h.Private="private"]="Private",h[h.Public="public"]="Public",h[h.Org="org"]="Org"}(w=m.PrivacyEnum||(m.PrivacyEnum={}));class SharedServer{}v([T.dataFormat(T.DataFormat.Uri),C("design:type",String)],SharedServer.prototype,"browseUrl",void 0),v([T.dataFormat(w),C("design:type",Number)],SharedServer.prototype,"privacy",void 0),m.SharedServer=SharedServer;class SharedPipe{}m.SharedPipe=SharedPipe;class ServerSharingStartedEventArgs extends EventArgs{}v([T.dataFormat(SharedServer),C("design:type",SharedServer)],ServerSharingStartedEventArgs.prototype,"server",void 0),m.ServerSharingStartedEventArgs=ServerSharingStartedEventArgs;class PipeSharingStartedEventArgs extends EventArgs{}v([T.dataFormat(SharedPipe),C("design:type",SharedPipe)],PipeSharingStartedEventArgs.prototype,"pipe",void 0),m.PipeSharingStartedEventArgs=PipeSharingStartedEventArgs;class ServerSharingStoppedEventArgs extends EventArgs{}v([T.dataFormat(SharedServer),C("design:type",SharedServer)],ServerSharingStoppedEventArgs.prototype,"server",void 0),m.ServerSharingStoppedEventArgs=ServerSharingStoppedEventArgs;class PipeSharingStoppedEventArgs extends EventArgs{}v([T.dataFormat(SharedPipe),C("design:type",SharedPipe)],PipeSharingStoppedEventArgs.prototype,"pipe",void 0),m.PipeSharingStoppedEventArgs=PipeSharingStoppedEventArgs;class ServerSharingChangedEventArgs extends EventArgs{}v([T.dataFormat(SharedServer),C("design:type",SharedServer)],ServerSharingChangedEventArgs.prototype,"server",void 0),m.ServerSharingChangedEventArgs=ServerSharingChangedEventArgs,function(h){h[h.Start="start"]="Start",h[h.Update="update"]="Update",h[h.Stop="stop"]="Stop"}(A=m.ChangeKind||(m.ChangeKind={})),function(h){h[h.Basis="basis"]="Basis",h[h.Liveshare="liveshare"]="Liveshare"}(m.TunnelType||(m.TunnelType={}));class ServerSharingSucceededEventArgs extends EventArgs{}v([T.dataFormat(A),C("design:type",Number)],ServerSharingSucceededEventArgs.prototype,"changeKind",void 0),m.ServerSharingSucceededEventArgs=ServerSharingSucceededEventArgs;class ServerSharingFailedEventArgs extends EventArgs{}v([T.dataFormat(A),C("design:type",Number)],ServerSharingFailedEventArgs.prototype,"changeKind",void 0),m.ServerSharingFailedEventArgs=ServerSharingFailedEventArgs;m.SessionUpdateEventArgs=class SessionUpdateEventArgs extends EventArgs{};class SourceControlIdentifier{}v([T.dataFormat(T.DataFormat.Path),C("design:type",String)],SourceControlIdentifier.prototype,"instanceId",void 0),m.SourceControlIdentifier=SourceControlIdentifier;class SourceControlVersion{}v([T.dataFormat(T.DataFormat.Path),C("design:type",String)],SourceControlVersion.prototype,"version",void 0),m.SourceControlVersion=SourceControlVersion,function(h){h[h.Workspace="workspace"]="Workspace",h[h.External="external"]="External",h[h.SpecificVerision="specificVerision"]="SpecificVerision",h[h.WorkspaceWithSpecificVersion="workspaceWithSpecificVersion"]="WorkspaceWithSpecificVersion"}(m.SourceControlResourceType||(m.SourceControlResourceType={})),function(h){h[h.None="none"]="None",h[h.Add="add"]="Add",h[h.Edit="edit"]="Edit",h[h.Delete="delete"]="Delete",h[h.Rename="rename"]="Rename",h[h.Conflict="conflict"]="Conflict",h[h.IndexEdit="indexEdit"]="IndexEdit",h[h.IndexDelete="indexDelete"]="IndexDelete",h[h.IndexCopy="indexCopy"]="IndexCopy",h[h.Untracked="untracked"]="Untracked",h[h.Ignored="ignored"]="Ignored",h[h.AddByUs="addByUs"]="AddByUs",h[h.AddByThem="addByThem"]="AddByThem",h[h.DeleteByUs="deleteByUs"]="DeleteByUs",h[h.DeleteByThem="deleteByThem"]="DeleteByThem",h[h.AddBoth="addBoth"]="AddBoth",h[h.DeleteBoth="deleteBoth"]="DeleteBoth"}(m.SourceControlChangeType||(m.SourceControlChangeType={}));class SourceControlResource{}v([T.dataFormat(T.DataFormat.Path),C("design:type",String)],SourceControlResource.prototype,"path",void 0),v([T.dataFormat(T.DataFormat.Path),C("design:type",String)],SourceControlResource.prototype,"version",void 0),m.SourceControlResource=SourceControlResource;class SourceControlResourceState{}v([T.dataFormat(SourceControlResource),C("design:type",SourceControlResource)],SourceControlResourceState.prototype,"current",void 0),v([T.dataFormat(SourceControlResource),C("design:type",SourceControlResource)],SourceControlResourceState.prototype,"original",void 0),m.SourceControlResourceState=SourceControlResourceState;class SourceControlResourceIdentifier extends SourceControlResource{}v([T.dataFormat(T.DataFormat.Uri),C("design:type",String)],SourceControlResourceIdentifier.prototype,"instanceId",void 0),m.SourceControlResourceIdentifier=SourceControlResourceIdentifier;class SourceControlResourceGroup{}v([T.dataFormat(SourceControlResourceState),C("design:type",Array)],SourceControlResourceGroup.prototype,"resourceStates",void 0),m.SourceControlResourceGroup=SourceControlResourceGroup;class SourceControlInstance extends SourceControlIdentifier{}v([T.dataFormat(T.DataFormat.Path),C("design:type",String)],SourceControlInstance.prototype,"name",void 0),v([T.dataFormat(SourceControlResourceGroup),C("design:type",Array)],SourceControlInstance.prototype,"resourceGroups",void 0),m.SourceControlInstance=SourceControlInstance;class SourceControlResourceDiff{}v([T.dataFormat(SourceControlResource),C("design:type",SourceControlResource)],SourceControlResourceDiff.prototype,"right",void 0),v([T.dataFormat(SourceControlResource),C("design:type",SourceControlResource)],SourceControlResourceDiff.prototype,"left",void 0),v([T.dataFormat(T.DataFormat.Path),C("design:type",String)],SourceControlResourceDiff.prototype,"title",void 0),m.SourceControlResourceDiff=SourceControlResourceDiff,function(h){h[h.Updated="updated"]="Updated",h[h.Added="added"]="Added",h[h.Removed="removed"]="Removed"}(m.SourceControlChange||(m.SourceControlChange={}));class SourceControlChangedEventArgs extends EventArgs{}v([T.dataFormat(SourceControlIdentifier),C("design:type",SourceControlIdentifier)],SourceControlChangedEventArgs.prototype,"sourceControl",void 0),m.SourceControlChangedEventArgs=SourceControlChangedEventArgs;class SourceControlResourceChangedEventArgs extends EventArgs{}v([T.dataFormat(SourceControlIdentifier),C("design:type",SourceControlIdentifier)],SourceControlResourceChangedEventArgs.prototype,"sourceControl",void 0),v([T.dataFormat(SourceControlResource),C("design:type",Array)],SourceControlResourceChangedEventArgs.prototype,"resources",void 0),m.SourceControlResourceChangedEventArgs=SourceControlResourceChangedEventArgs;m.SyncStatus=class SyncStatus{},function(h){h[h.PlainText="plainText"]="PlainText",h[h.TextWithAnsiEscapeCodes="textWithAnsiEscapeCodes"]="TextWithAnsiEscapeCodes"}(m.TaskOutputContentType||(m.TaskOutputContentType={}));class TaskOutputFeedInfo{}v([T.dataFormat(RemoteStreamMoniker),C("design:type",RemoteStreamMoniker)],TaskOutputFeedInfo.prototype,"streamMoniker",void 0),m.TaskOutputFeedInfo=TaskOutputFeedInfo;class TaskOutputOptions{}m.TaskOutputOptions=TaskOutputOptions;class TaskOutputInfo{}v([T.dataFormat(TaskOutputFeedInfo),C("design:type",TaskOutputFeedInfo)],TaskOutputInfo.prototype,"feed",void 0),v([T.dataFormat(TaskOutputOptions),C("design:type",TaskOutputOptions)],TaskOutputInfo.prototype,"options",void 0),m.TaskOutputInfo=TaskOutputInfo;class TaskOutputEventArgs extends EventArgs{}v([T.dataFormat(TaskOutputInfo),C("design:type",TaskOutputInfo)],TaskOutputEventArgs.prototype,"taskOutput",void 0),m.TaskOutputEventArgs=TaskOutputEventArgs;m.TelemetrySettings=class TelemetrySettings{};class GenericOperationEventArgs extends EventArgs{}v([T.dataFormat(T.DataFormat.Omit),C("design:type",Object)],GenericOperationEventArgs.prototype,"payload",void 0),m.GenericOperationEventArgs=GenericOperationEventArgs,function(h){h[h.None="none"]="None",h[h.Success="success"]="Success",h[h.Failure="failure"]="Failure",h[h.UserFault="userFault"]="UserFault",h[h.UserCancel="userCancel"]="UserCancel"}(m.TelemetryResult||(m.TelemetryResult={}));class FaultTelemetryEventArgs extends EventArgs{}v([T.dataFormat(T.DataFormat.Omit),C("design:type",Object)],FaultTelemetryEventArgs.prototype,"payload",void 0),m.FaultTelemetryEventArgs=FaultTelemetryEventArgs;class TerminalOptions{}v([T.dataFormat(T.DataFormat.Path),C("design:type",String)],TerminalOptions.prototype,"cwd",void 0),v([T.dataFormat(T.DataFormat.Path),C("design:type",String)],TerminalOptions.prototype,"app",void 0),v([T.dataFormat(T.DataFormat.Hide),C("design:type",Array)],TerminalOptions.prototype,"commandLine",void 0),v([T.dataFormat(T.DataFormat.Omit),C("design:type",Boolean)],TerminalOptions.prototype,"verbatimCommandLine",void 0),v([T.dataFormat(T.DataFormat.Omit),C("design:type",Object)],TerminalOptions.prototype,"environment",void 0),m.TerminalOptions=TerminalOptions;class TerminalInfo{}v([T.dataFormat(TerminalOptions),C("design:type",TerminalOptions)],TerminalInfo.prototype,"options",void 0),m.TerminalInfo=TerminalInfo;class TerminalEventArgs extends EventArgs{}v([T.dataFormat(TerminalInfo),C("design:type",TerminalInfo)],TerminalEventArgs.prototype,"terminal",void 0),m.TerminalEventArgs=TerminalEventArgs;class RestrictedOperation{}m.RestrictedOperation=RestrictedOperation;m.SharedTerminalRestrictedOperation=class SharedTerminalRestrictedOperation extends RestrictedOperation{};class MaybeImmutableOfWorkspaceAccessControl{}m.MaybeImmutableOfWorkspaceAccessControl=MaybeImmutableOfWorkspaceAccessControl;class WorkspaceAccessControl extends MaybeImmutableOfWorkspaceAccessControl{}v([T.dataFormat(AccessControl),C("design:type",AccessControl)],WorkspaceAccessControl.prototype,"defaultAccessControl",void 0),m.WorkspaceAccessControl=WorkspaceAccessControl;class WorkspaceAccessControlEventArgs extends EventArgs{}v([T.dataFormat(WorkspaceAccessControl),C("design:type",WorkspaceAccessControl)],WorkspaceAccessControlEventArgs.prototype,"accessControl",void 0),m.WorkspaceAccessControlEventArgs=WorkspaceAccessControlEventArgs;class RestrictedOperationAccessRequestedEventArgs extends EventArgs{}v([T.dataFormat(RestrictedOperation),C("design:type",RestrictedOperation)],RestrictedOperationAccessRequestedEventArgs.prototype,"operation",void 0),m.RestrictedOperationAccessRequestedEventArgs=RestrictedOperationAccessRequestedEventArgs,function(h){h[h.Error="error"]="Error",h[h.Warning="warning"]="Warning",h[h.Message="message"]="Message"}(m.ErrorSeverity||(m.ErrorSeverity={}));class DiagnosticEntry{}v([T.dataFormat(T.DataFormat.Path),C("design:type",String)],DiagnosticEntry.prototype,"fileId",void 0),v([T.dataFormat(T.DataFormat.Hide),C("design:type",String)],DiagnosticEntry.prototype,"message",void 0),v([T.dataFormat(T.DataFormat.Omit),C("design:type",Object)],DiagnosticEntry.prototype,"properties",void 0),m.DiagnosticEntry=DiagnosticEntry;class DiagnosticDataChangedEventArgs extends EventArgs{}v([T.dataFormat(DiagnosticEntry),C("design:type",Array)],DiagnosticDataChangedEventArgs.prototype,"entries",void 0),m.DiagnosticDataChangedEventArgs=DiagnosticDataChangedEventArgs;m.InvitationLinkInfo=class InvitationLinkInfo{};class WorkspaceInfo{}v([T.dataFormat(T.DataFormat.Omit),C("design:type",String)],WorkspaceInfo.prototype,"conversationId",void 0),v([T.dataFormat(T.DataFormat.Text),C("design:type",String)],WorkspaceInfo.prototype,"name",void 0),v([T.dataFormat(T.DataFormat.Omit),C("design:type",String)],WorkspaceInfo.prototype,"joinUri",void 0),v([T.dataFormat(T.DataFormat.Omit),C("design:type",String)],WorkspaceInfo.prototype,"ownerId",void 0),m.WorkspaceInfo=WorkspaceInfo,function(h){h[h.Unknown="unknown"]="Unknown",h[h.Available="available"]="Available",h[h.Unavailable="unavailable"]="Unavailable",h[h.Connected="connected"]="Connected",h[h.Disconnected="disconnected"]="Disconnected"}(m.WorkspaceConnectionStatus||(m.WorkspaceConnectionStatus={})),function(h){h[h.None="none"]="None",h[h.Requested="requested"]="Requested",h[h.UserRemoved="userRemoved"]="UserRemoved",h[h.UserBlocked="userBlocked"]="UserBlocked",h[h.SessionEnded="sessionEnded"]="SessionEnded",h[h.ConnectionLost="connectionLost"]="ConnectionLost",h[h.InternalError="internalError"]="InternalError",h[h.SessionExpired="sessionExpired"]="SessionExpired",h[h.NetworkDisconnected="networkDisconnected"]="NetworkDisconnected",h[h.ListenerWentOffline="listenerWentOffline"]="ListenerWentOffline",h[h.CollaborationServiceFactoryCriticalFailure="collaborationServiceFactoryCriticalFailure"]="CollaborationServiceFactoryCriticalFailure"}(m.WorkspaceDisconnectedReason||(m.WorkspaceDisconnectedReason={}));m.WorkspaceConnectionStatusChangedEventArgs=class WorkspaceConnectionStatusChangedEventArgs extends EventArgs{};class WorkspaceReadyForConnectionEventArgs extends EventArgs{}v([T.dataFormat(WorkspaceInfo),C("design:type",WorkspaceInfo)],WorkspaceReadyForConnectionEventArgs.prototype,"workspace",void 0),m.WorkspaceReadyForConnectionEventArgs=WorkspaceReadyForConnectionEventArgs,function(h){h[h.None="none"]="None",h[h.CreatedWorkspace="createdWorkspace"]="CreatedWorkspace",h[h.InitializedAgentServices="initializedAgentServices"]="InitializedAgentServices",h[h.InitializedRelayAndTCP="initializedRelayAndTCP"]="InitializedRelayAndTCP",h[h.AddedUserToWorkspace="addedUserToWorkspace"]="AddedUserToWorkspace",h[h.JoinedLocalWorkspace="joinedLocalWorkspace"]="JoinedLocalWorkspace",h[h.ReadWorkspaceInfo="readWorkspaceInfo"]="ReadWorkspaceInfo",h[h.OpeningRemoteSession="openingRemoteSession"]="OpeningRemoteSession",h[h.OpenedRemoteSession="openedRemoteSession"]="OpenedRemoteSession",h[h.JoiningRemoteSession="joiningRemoteSession"]="JoiningRemoteSession",h[h.JoinedRemoteSession="joinedRemoteSession"]="JoinedRemoteSession",h[h.WaitingForHost="waitingForHost"]="WaitingForHost",h[h.DoneWaitingForHost="doneWaitingForHost"]="DoneWaitingForHost",h[h.ReconnectingToHost="reconnectingToHost"]="ReconnectingToHost",h[h.ReconnectedToHost="reconnectedToHost"]="ReconnectedToHost",h[h.ReconnectionFailed="reconnectionFailed"]="ReconnectionFailed",h[h.UpdatedWorkspace="updatedWorkspace"]="UpdatedWorkspace"}(m.WorkspaceProgress||(m.WorkspaceProgress={}));m.WorkspaceProgressEventArgs=class WorkspaceProgressEventArgs extends EventArgs{};class WorkspaceShareInfo extends WorkspaceInfo{}v([T.dataFormat(T.DataFormat.Path),C("design:type",Array)],WorkspaceShareInfo.prototype,"rootDirectories",void 0),v([T.dataFormat(FileServiceRootConfiguration),C("design:type",FileServiceRootConfiguration)],WorkspaceShareInfo.prototype,"persistentRootConfiguration",void 0),m.WorkspaceShareInfo=WorkspaceShareInfo,function(h){h[h.Auto="auto"]="Auto",h[h.Direct="direct"]="Direct",h[h.Relay="relay"]="Relay",h[h.Local="local"]="Local",h[h.SignalR="signalR"]="SignalR"}(m.ConnectionMode||(m.ConnectionMode={}));class ClientCapabilities{}m.ClientCapabilities=ClientCapabilities;class WorkspaceJoinInfo{}v([T.dataFormat(T.DataFormat.Text),C("design:type",String)],WorkspaceJoinInfo.prototype,"directAddress",void 0),v([T.dataFormat(T.DataFormat.Text),C("design:type",String)],WorkspaceJoinInfo.prototype,"relayAddress",void 0),v([T.dataFormat(T.DataFormat.Token),C("design:type",String)],WorkspaceJoinInfo.prototype,"relaySharedAccessSignature",void 0),v([T.dataFormat(T.DataFormat.Token),C("design:type",String)],WorkspaceJoinInfo.prototype,"joiningUserSessionToken",void 0),v([T.dataFormat(ClientCapabilities),C("design:type",ClientCapabilities)],WorkspaceJoinInfo.prototype,"clientCapabilities",void 0),v([T.dataFormat(T.DataFormat.Token),C("design:type",String)],WorkspaceJoinInfo.prototype,"userIdentity",void 0),v([T.dataFormat(T.DataFormat.Token),C("design:type",String)],WorkspaceJoinInfo.prototype,"initialViewName",void 0),m.WorkspaceJoinInfo=WorkspaceJoinInfo;m.WorkspaceListOptions=class WorkspaceListOptions{constructor(){this.includeRemoteWorkspaces=!0,this.onlyManagedWorkspaces=!1}};m.WorkspaceSessionInfo=class WorkspaceSessionInfo extends WorkspaceInfo{};class WorkspaceUserProfile{}v([T.dataFormat(T.DataFormat.Text),C("design:type",String)],WorkspaceUserProfile.prototype,"name",void 0),v([T.dataFormat(T.DataFormat.Email),C("design:type",String)],WorkspaceUserProfile.prototype,"email",void 0),v([T.dataFormat(T.DataFormat.Text),C("design:type",String)],WorkspaceUserProfile.prototype,"userName",void 0),v([T.dataFormat(T.DataFormat.Text),C("design:type",String)],WorkspaceUserProfile.prototype,"provider",void 0),v([T.dataFormat(T.DataFormat.Uri),C("design:type",String)],WorkspaceUserProfile.prototype,"avatarUri",void 0),v([T.dataFormat(ClientCapabilities),C("design:type",ClientCapabilities)],WorkspaceUserProfile.prototype,"clientCapabilities",void 0),m.WorkspaceUserProfile=WorkspaceUserProfile;m.WorkspaceServicesChangedEventArgs=class WorkspaceServicesChangedEventArgs extends EventArgs{},function(h){h[h.None="none"]="None",h[h.Add="add"]="Add",h[h.Remove="remove"]="Remove",h[h.Replace="replace"]="Replace"}(m.CollectionChangeType||(m.CollectionChangeType={}));m.GuestAcceptance=class GuestAcceptance{},function(h){h[h.None="none"]="None",h[h.Joined="joined"]="Joined",h[h.Unjoined="unjoined"]="Unjoined",h[h.Canceled="canceled"]="Canceled",h[h.Requested="requested"]="Requested"}(m.WorkspaceSessionChangeType||(m.WorkspaceSessionChangeType={}));class WorkspaceSessionChangedEventArgs extends EventArgs{}v([T.dataFormat(WorkspaceUserProfile),C("design:type",WorkspaceUserProfile)],WorkspaceSessionChangedEventArgs.prototype,"userProfile",void 0),m.WorkspaceSessionChangedEventArgs=WorkspaceSessionChangedEventArgs;class UserSettings{}v([T.dataFormat(FeatureFlagStore),C("design:type",FeatureFlagStore)],UserSettings.prototype,"experimentalFeatures",void 0),m.UserSettings=UserSettings;m.VSOnlineSettings=class VSOnlineSettings{};class TextChange{}v([T.dataFormat(T.DataFormat.Text),C("design:type",String)],TextChange.prototype,"newText",void 0),m.TextChange=TextChange;class MessageBase{constructor(){this.messageType=P.Unknown}}m.MessageBase=MessageBase,function(h){h[h.SelectionChange="selectionChange"]="SelectionChange",h[h.NotebookSelectionChange="notebookSelectionChange"]="NotebookSelectionChange",h[h.VisibleRangesChange="visibleRangesChange"]="VisibleRangesChange",h[h.TextChange="textChange"]="TextChange",h[h.FileOpenRequest="fileOpenRequest"]="FileOpenRequest",h[h.ResetFileClient="resetFileClient"]="ResetFileClient",h[h.UntitledFileSaved="untitledFileSaved"]="UntitledFileSaved",h[h.UntitledFileOpened="untitledFileOpened"]="UntitledFileOpened",h[h.UntitledFileClosed="untitledFileClosed"]="UntitledFileClosed",h[h.DiffViewOpen="diffViewOpen"]="DiffViewOpen",h[h.DiffViewClosed="diffViewClosed"]="DiffViewClosed",h[h.FileOpenAcknowledge="fileOpenAcknowledge"]="FileOpenAcknowledge",h[h.FileRelease="fileRelease"]="FileRelease",h[h.SaveFile="saveFile"]="SaveFile",h[h.SaveNotebook="saveNotebook"]="SaveNotebook",h[h.JoinRequest="joinRequest"]="JoinRequest",h[h.JoinAcknowledge="joinAcknowledge"]="JoinAcknowledge",h[h.ReadOnlyChange="readOnlyChange"]="ReadOnlyChange",h[h.Handshake="handshake"]="Handshake",h[h.Summon="summon"]="Summon",h[h.LayoutScroll="layoutScroll"]="LayoutScroll",h[h.NotebookScroll="notebookScroll"]="NotebookScroll",h[h.ProjectFileOpened="projectFileOpened"]="ProjectFileOpened",h[h.ProjectFileClosed="projectFileClosed"]="ProjectFileClosed",h[h.PresenterUpdate="presenterUpdate"]="PresenterUpdate",h[h.FollowChange="followChange"]="FollowChange",h[h.AnonymousAccessLevelChange="anonymousAccessLevelChange"]="AnonymousAccessLevelChange",h[h.Ping="ping"]="Ping",h[h.Unknown="unknown"]="Unknown"}(P=m.MessageType||(m.MessageType={}));class FileMessageBase extends MessageBase{}v([T.dataFormat(T.DataFormat.Path),C("design:type",String)],FileMessageBase.prototype,"fileName",void 0),m.FileMessageBase=FileMessageBase;m.JoinRequestMessage=class JoinRequestMessage extends MessageBase{};class JoinAcknowledgeMessage extends MessageBase{}v([T.dataFormat(T.DataFormat.Path),C("design:type",Array)],JoinAcknowledgeMessage.prototype,"files",void 0),m.JoinAcknowledgeMessage=JoinAcknowledgeMessage;m.PresenterUpdateMessage=class PresenterUpdateMessage extends MessageBase{};m.FollowChangeMessage=class FollowChangeMessage extends MessageBase{};m.SelectionChangeMessage=class SelectionChangeMessage extends FileMessageBase{};m.NotebookSelectionChangeMessage=class NotebookSelectionChangeMessage extends FileMessageBase{};class Range{}m.Range=Range;class LayoutScrollMessage extends FileMessageBase{}v([T.dataFormat(Range),C("design:type",Array)],LayoutScrollMessage.prototype,"visibleRanges",void 0),m.LayoutScrollMessage=LayoutScrollMessage;m.NotebookScrollMessage=class NotebookScrollMessage extends FileMessageBase{};class EditorVisibleRanges{}v([T.dataFormat(T.DataFormat.Path),C("design:type",String)],EditorVisibleRanges.prototype,"fileName",void 0),v([T.dataFormat(Range),C("design:type",Array)],EditorVisibleRanges.prototype,"visibleRanges",void 0),m.EditorVisibleRanges=EditorVisibleRanges;class VisibleRangesChangeMessage extends MessageBase{}v([T.dataFormat(EditorVisibleRanges),C("design:type",Array)],VisibleRangesChangeMessage.prototype,"clientVisibleRanges",void 0),m.VisibleRangesChangeMessage=VisibleRangesChangeMessage;m.FileOpenRequestMessage=class FileOpenRequestMessage extends FileMessageBase{};m.ResetFileClientMessage=class ResetFileClientMessage extends FileMessageBase{};m.UntitledFileSavedMessage=class UntitledFileSavedMessage extends FileMessageBase{};m.UntitledFileOpenedMessage=class UntitledFileOpenedMessage extends FileMessageBase{};m.UntitledFileClosedMessage=class UntitledFileClosedMessage extends FileMessageBase{};class DiffViewMessage extends MessageBase{}m.DiffViewMessage=DiffViewMessage;m.DiffViewOpenMessage=class DiffViewOpenMessage extends DiffViewMessage{};m.DiffViewClosedMessage=class DiffViewClosedMessage extends DiffViewMessage{};m.HandshakeMessage=class HandshakeMessage extends FileMessageBase{};m.SaveFileMessage=class SaveFileMessage extends FileMessageBase{};m.SaveNotebookMessage=class SaveNotebookMessage extends FileMessageBase{};m.FileReleaseMessage=class FileReleaseMessage extends FileMessageBase{};m.AnonymousAcccessLevelChangedMessage=class AnonymousAcccessLevelChangedMessage extends FileMessageBase{};class TextChangeMessage extends FileMessageBase{}v([T.dataFormat(TextChange),C("design:type",Array)],TextChangeMessage.prototype,"changes",void 0),m.TextChangeMessage=TextChangeMessage;m.ReadOnlyChangeMessage=class ReadOnlyChangeMessage extends FileMessageBase{};m.ProjectFileOpenedMessage=class ProjectFileOpenedMessage extends FileMessageBase{};m.ProjectFileClosedMessage=class ProjectFileClosedMessage extends FileMessageBase{};class ServerVersionSnapshot{}v([T.dataFormat(TextChangeMessage),C("design:type",TextChangeMessage)],ServerVersionSnapshot.prototype,"message",void 0),m.ServerVersionSnapshot=ServerVersionSnapshot;class FileOpenAcknowledgeMessage extends FileMessageBase{}v([T.dataFormat(ServerVersionSnapshot),C("design:type",Array)],FileOpenAcknowledgeMessage.prototype,"history",void 0),m.FileOpenAcknowledgeMessage=FileOpenAcknowledgeMessage;m.SummonMessage=class SummonMessage extends MessageBase{};m.PingMessage=class PingMessage extends MessageBase{},function(h){h[h.NotifyDidOpenClose="notifyDidOpenClose"]="NotifyDidOpenClose",h[h.NotifyDidChange="notifyDidChange"]="NotifyDidChange",h[h.NotifyDidSave="notifyDidSave"]="NotifyDidSave",h[h.NotifyAll="notifyAll"]="NotifyAll"}(m.DocumentChangesNotificationFlags||(m.DocumentChangesNotificationFlags={}));m.CoeditingInformation=class CoeditingInformation{};class DocumentFilter{}m.DocumentFilter=DocumentFilter;class LanguageServerProviderMetadata{}v([T.dataFormat(DocumentFilter),C("design:type",Array)],LanguageServerProviderMetadata.prototype,"documentFilters",void 0),m.LanguageServerProviderMetadata=LanguageServerProviderMetadata;m.NotificationEventArgs=class NotificationEventArgs extends EventArgs{};m.LspMessage=class LspMessage{};class DebugSession{}m.DebugSession=DebugSession,function(h){h[h.None="none"]="None",h[h.Add="add"]="Add",h[h.Remove="remove"]="Remove"}(m.DebugSessionChangeType||(m.DebugSessionChangeType={}));class DebugSessionChangedEventArgs extends EventArgs{}v([T.dataFormat(DebugSession),C("design:type",DebugSession)],DebugSessionChangedEventArgs.prototype,"debugSession",void 0),m.DebugSessionChangedEventArgs=DebugSessionChangedEventArgs;m.LaunchConfigurationChangedEventArgs=class LaunchConfigurationChangedEventArgs extends EventArgs{},function(h){h[h.Go="go"]="Go",h[h.StepIn="stepIn"]="StepIn",h[h.StepOut="stepOut"]="StepOut",h[h.StepOver="stepOver"]="StepOver"}(m.ContinueReason||(m.ContinueReason={}));class AccessControlEventArgs extends EventArgs{}v([T.dataFormat(AccessControl),C("design:type",AccessControl)],AccessControlEventArgs.prototype,"accessControl",void 0),m.AccessControlEventArgs=AccessControlEventArgs,function(h){h[h.Allowed="allowed"]="Allowed",h[h.RejectedInReadOnlySession="rejectedInReadOnlySession"]="RejectedInReadOnlySession",h[h.RejectedForNotOwner="rejectedForNotOwner"]="RejectedForNotOwner",h[h.DisabledByHostConfiguration="disabledByHostConfiguration"]="DisabledByHostConfiguration",h[h.ExplicitlyRejectedByHost="explicitlyRejectedByHost"]="ExplicitlyRejectedByHost",h[h.RejectedPersistentRootNotSupported="rejectedPersistentRootNotSupported"]="RejectedPersistentRootNotSupported"}(m.RestrictedOperationAccess||(m.RestrictedOperationAccess={}));class RestrictedOperationAccessEventArgs extends EventArgs{}v([T.dataFormat(RestrictedOperation),C("design:type",RestrictedOperation)],RestrictedOperationAccessEventArgs.prototype,"operation",void 0),m.RestrictedOperationAccessEventArgs=RestrictedOperationAccessEventArgs;m.FileListOptions=class FileListOptions{},function(h){h[h.None="none"]="None",h[h.Children="children"]="Children",h[h.SingleChildDescendants="singleChildDescendants"]="SingleChildDescendants",h[h.AllDescendants="allDescendants"]="AllDescendants"}(m.FileRecurseMode||(m.FileRecurseMode={})),function(h){h[h.None="none"]="None",h[h.Hidden="hidden"]="Hidden",h[h.ReadOnly="readOnly"]="ReadOnly",h[h.Excluded="excluded"]="Excluded",h[h.External="external"]="External"}(m.FileAttributes||(m.FileAttributes={}));class FileInfo{constructor(){this.exists=!0}}v([T.dataFormat(T.DataFormat.Path),C("design:type",String)],FileInfo.prototype,"path",void 0),v([T.dataFormat(FileInfo),C("design:type",Array)],FileInfo.prototype,"children",void 0),m.FileInfo=FileInfo;m.FileRootInfo=class FileRootInfo extends FileInfo{};class FileTextInfo extends FileInfo{}v([T.dataFormat(T.DataFormat.Text),C("design:type",String)],FileTextInfo.prototype,"text",void 0),m.FileTextInfo=FileTextInfo;m.FileReadOptions=class FileReadOptions{};m.FileWriteOptions=class FileWriteOptions{};m.FileMoveOptions=class FileMoveOptions{};m.FileDeleteOptions=class FileDeleteOptions{};m.FileWatchOptions=class FileWatchOptions{};class FileChange{}v([T.dataFormat(T.DataFormat.Path),C("design:type",String)],FileChange.prototype,"path",void 0),v([T.dataFormat(T.DataFormat.Path),C("design:type",String)],FileChange.prototype,"fullPath",void 0),v([T.dataFormat(T.DataFormat.Path),C("design:type",String)],FileChange.prototype,"localFullPath",void 0),m.FileChange=FileChange,function(h){h[h.None="none"]="None",h[h.Updated="updated"]="Updated",h[h.Added="added"]="Added",h[h.Deleted="deleted"]="Deleted"}(m.FileChangeType||(m.FileChangeType={}));class FilesChangedEventArgs extends EventArgs{}v([T.dataFormat(FileChange),C("design:type",Array)],FilesChangedEventArgs.prototype,"changes",void 0),m.FilesChangedEventArgs=FilesChangedEventArgs;class ExternalFilesChangedEventArgs extends EventArgs{}v([T.dataFormat(T.DataFormat.Path),C("design:type",Array)],ExternalFilesChangedEventArgs.prototype,"localPaths",void 0),v([T.dataFormat(T.DataFormat.Path),C("design:type",Array)],ExternalFilesChangedEventArgs.prototype,"vslsPaths",void 0),m.ExternalFilesChangedEventArgs=ExternalFilesChangedEventArgs;class RootsChangedEventArgs extends EventArgs{}v([T.dataFormat(T.DataFormat.Path),C("design:type",String)],RootsChangedEventArgs.prototype,"root",void 0),v([T.dataFormat(T.DataFormat.Path),C("design:type",String)],RootsChangedEventArgs.prototype,"fullPath",void 0),m.RootsChangedEventArgs=RootsChangedEventArgs;class DiffBaseInfo{}v([T.dataFormat(T.DataFormat.Text),C("design:type",String)],DiffBaseInfo.prototype,"description",void 0),m.DiffBaseInfo=DiffBaseInfo;m.ExternalFileMapResult=class ExternalFileMapResult{};class TextSearchResultRange{}m.TextSearchResultRange=TextSearchResultRange;class TextSearchResult{}v([T.dataFormat(T.DataFormat.Path),C("design:type",String)],TextSearchResult.prototype,"path",void 0),v([T.dataFormat(T.DataFormat.Text),C("design:type",String)],TextSearchResult.prototype,"text",void 0),v([T.dataFormat(TextSearchResultRange),C("design:type",Array)],TextSearchResult.prototype,"ranges",void 0),v([T.dataFormat(TextSearchResultRange),C("design:type",Array)],TextSearchResult.prototype,"previewRanges",void 0),m.TextSearchResult=TextSearchResult;class ReadTextResult{}v([T.dataFormat(FileTextInfo),C("design:type",Array)],ReadTextResult.prototype,"results",void 0),m.ReadTextResult=ReadTextResult;class TextSearchOptions{}v([T.dataFormat(T.DataFormat.Text),C("design:type",Array)],TextSearchOptions.prototype,"fileIncludes",void 0),v([T.dataFormat(T.DataFormat.Text),C("design:type",Array)],TextSearchOptions.prototype,"fileExcludes",void 0),v([T.dataFormat(T.DataFormat.Text),C("design:type",String)],TextSearchOptions.prototype,"pattern",void 0),m.TextSearchOptions=TextSearchOptions;m.NodeType=class NodeType{};m.SolutionWorkspaceNode=class SolutionWorkspaceNode{};m.SolutionChangedEventArgs=class SolutionChangedEventArgs extends EventArgs{};m.WorkspaceRootChangedEventArgs=class WorkspaceRootChangedEventArgs extends EventArgs{},function(h){h[h.Empty="empty"]="Empty",h[h.Folder="folder"]="Folder",h[h.Solution="solution"]="Solution"}(m.WorkspaceMode||(m.WorkspaceMode={}));m.SolutionChangeType=class SolutionChangeType{};class SourceEventArgs extends EventArgs{}v([T.dataFormat(T.DataFormat.Hide),C("design:type",String)],SourceEventArgs.prototype,"jsonContent",void 0),m.SourceEventArgs=SourceEventArgs,function(h){h[h.None="none"]="None",h[h.CanRead="canRead"]="CanRead",h[h.CanWrite="canWrite"]="CanWrite",h[h.CanSeek="canSeek"]="CanSeek"}(m.StreamTraits||(m.StreamTraits={})),function(h){h[h.Global="global"]="Global",h[h.Workspace="workspace"]="Workspace",h[h.WorkspaceFolder="workspaceFolder"]="WorkspaceFolder"}(m.TaskScope||(m.TaskScope={}));class WorkspaceTask{}m.WorkspaceTask=WorkspaceTask;class TaskExecutionMoniker{}m.TaskExecutionMoniker=TaskExecutionMoniker,function(h){h[h.Started="started"]="Started",h[h.Terminated="terminated"]="Terminated"}(m.TaskExecutionStatusChange||(m.TaskExecutionStatusChange={}));class TaskExecutionStatusEventArgs extends EventArgs{}v([T.dataFormat(TaskExecutionMoniker),C("design:type",TaskExecutionMoniker)],TaskExecutionStatusEventArgs.prototype,"taskExecution",void 0),v([T.dataFormat(WorkspaceTask),C("design:type",WorkspaceTask)],TaskExecutionStatusEventArgs.prototype,"task",void 0),m.TaskExecutionStatusEventArgs=TaskExecutionStatusEventArgs,function(h){h[h.Started="started"]="Started",h[h.AlreadyRunning="alreadyRunning"]="AlreadyRunning",h[h.RetryLater="retryLater"]="RetryLater",h[h.TaskNotFound="taskNotFound"]="TaskNotFound",h[h.RejectedByHost="rejectedByHost"]="RejectedByHost"}(m.RunTaskStatus||(m.RunTaskStatus={}));class RunTaskResult{}v([T.dataFormat(TaskExecutionMoniker),C("design:type",TaskExecutionMoniker)],RunTaskResult.prototype,"taskExecution",void 0),m.RunTaskResult=RunTaskResult;m.WorkspaceTaskRestrictedOperation=class WorkspaceTaskRestrictedOperation extends RestrictedOperation{},function(h){h[h.CouldNotConnectToServer=-32e3]="CouldNotConnectToServer",h[h.OlderThanServer=-32001]="OlderThanServer",h[h.NewerThanServer=-32002]="NewerThanServer",h[h.OlderThanPeer=-32003]="OlderThanPeer",h[h.NewerThanPeer=-32004]="NewerThanPeer",h[h.OlderThanAgent=-32005]="OlderThanAgent",h[h.NewerThanAgent=-32006]="NewerThanAgent",h[h.NoIPAddressesDetected=-32010]="NoIPAddressesDetected",h[h.NoConnectionAddresses=-32011]="NoConnectionAddresses",h[h.AutoConnectionFailed=-32012]="AutoConnectionFailed",h[h.RelayConnectionFailed=-32013]="RelayConnectionFailed",h[h.DirectConnectionFailed=-32014]="DirectConnectionFailed",h[h.SessionProtocolError=-32015]="SessionProtocolError",h[h.SessionAuthenticationFailed=-32016]="SessionAuthenticationFailed",h[h.ReconnectFailed=-32017]="ReconnectFailed",h[h.DirectConnectionNotEnabled=-32020]="DirectConnectionNotEnabled",h[h.RelayConnectionNotEnabled=-32021]="RelayConnectionNotEnabled",h[h.CollaborationSessionUsersLimitReached=-32022]="CollaborationSessionUsersLimitReached",h[h.CollaborationSessionGuestRejected=-32023]="CollaborationSessionGuestRejected",h[h.CollaborationSessionRequestTimedOut=-32024]="CollaborationSessionRequestTimedOut",h[h.CollaborationSessionGuestCanceled=-32025]="CollaborationSessionGuestCanceled",h[h.CollaborationSessionNotFound=-32026]="CollaborationSessionNotFound",h[h.CollaborationSessionEnded=-32027]="CollaborationSessionEnded",h[h.CollaborationSessionGuestBlocked=-32028]="CollaborationSessionGuestBlocked",h[h.NonSuccessHttpStatusCodeReceived=-32030]="NonSuccessHttpStatusCodeReceived",h[h.KeychainAccessFailed=-32031]="KeychainAccessFailed",h[h.UnauthorizedHttpStatusCode=-32032]="UnauthorizedHttpStatusCode",h[h.ForbiddenHttpStatusCode=-32033]="ForbiddenHttpStatusCode",h[h.RelayConnectionHostFailure=-32040]="RelayConnectionHostFailure",h[h.RelayConnectionGuestFailure=-32041]="RelayConnectionGuestFailure",h[h.RelayHubNotFoundFailure=-32045]="RelayHubNotFoundFailure",h[h.RelayHubNoHostFailure=-32046]="RelayHubNoHostFailure",h[h.RelayHubNotConnectedFailure=-32047]="RelayHubNotConnectedFailure",h[h.BrokerNotAuthorized=-32050]="BrokerNotAuthorized",h[h.CouldNotConnectToServerAuthFailed=-32060]="CouldNotConnectToServerAuthFailed",h[h.RemoteLaunchNotEnabled=-32200]="RemoteLaunchNotEnabled",h[h.CollaborationSessionGuestRejectedWithSpecificReason=-32300]="CollaborationSessionGuestRejectedWithSpecificReason",h[h.OperationRejected=-32400]="OperationRejected",h[h.OperationRejectedInReadOnlySession=-32401]="OperationRejectedInReadOnlySession",h[h.OperationRejectedForNotOwner=-32402]="OperationRejectedForNotOwner",h[h.OperationRejectedAsPersistentRootNotSupported=-32403]="OperationRejectedAsPersistentRootNotSupported",h[h.FileOperationNotSupported=-32500]="FileOperationNotSupported",h[h.ErrorFileAdditionFailed=-32501]="ErrorFileAdditionFailed",h[h.ErrorFileDeleteFailed=-32502]="ErrorFileDeleteFailed",h[h.ErrorFileRenameFailed=-32503]="ErrorFileRenameFailed",h[h.FileAlreadyExists=-32504]="FileAlreadyExists",h[h.ErrorFolderAdditionFailed=-32505]="ErrorFolderAdditionFailed",h[h.ErrorFolderRenameFailed=-32506]="ErrorFolderRenameFailed"}(m.ErrorCodes||(m.ErrorCodes={})),function(h){h[h.None=0]="None",h[h.AgentLogCreated=1002]="AgentLogCreated",h[h.AgentOutput=2001]="AgentOutput",h[h.CallingOutput=10001]="CallingOutput",h[h.RpcListeningOnPipe=1001]="RpcListeningOnPipe"}(m.TraceEventIds||(m.TraceEventIds={})),function(h){h.Agent="Agent",h.AgentAuth="Agent.Auth",h.AgentCSharpLS="Agent.CSharpLS",h.AgentFile="Agent.File",h.AgentFirewall="Agent.Firewall",h.AgentHttp="Agent.Http",h.AgentProxy="Agent.Proxy",h.AgentPortForwarding="Agent.PortFowrading",h.AgentTcpListenersObserver="Agent.TcpListeners",h.AgentRpc="Agent.Rpc",h.AgentRpcAuth="Agent.Rpc.Auth",h.AgentRpcChat="Agent.Rpc.Chat",h.AgentRpcFile="Agent.Rpc.File",h.AgentRpcFirewall="Agent.Rpc.Firewall",h.AgentRpcServerSharing="Agent.Rpc.ServerSharing",h.AgentRpcSourceEvent="Agent.Rpc.SourceEvent",h.AgentRpcStream="Agent.Rpc.Stream",h.AgentRpcStreamManager="Agent.Rpc.StreamManager",h.AgentRpcStreamTransport="Agent.Rpc.StreamTransport",h.AgentRpcTerminal="Agent.Rpc.Terminal",h.AgentTerminalConnection="Agent.Terminal.Connection",h.AgentRpcWorkspace="Agent.Rpc.Workspace",h.AgentRpcWorkspaceUser="Agent.Rpc.WorkspaceUser",h.AgentRpcTaskOutput="Agent.Rpc.TaskOutput",h.AgentSsh="Agent.Ssh",h.AgentTSLS="Agent.TSLS",h.AgentWorkspace="Agent.Workspace",h.AgentWorkspaceSessionAccessControl="Agent.WorkspaceSession.AccessControl",h.ClientAgent="Client.Agent",h.ClientCoEditing="Client.CoEditing",h.ClientCoEditingBufferManager="Client.CoEditing.BufferManager",h.ClientCoEditingVSCodeEvent="Client.CoEditing.VSCodeEvent",h.ClientFileProvider="Client.FileProvider",h.ClientLauncher="Client.Launcher",h.ClientRpc="Client.Rpc",h.ClientRpcAgentSession="Client.Rpc.AgentSession",h.ClientRpcAuth="Client.Rpc.Auth",h.ClientRpcFile="Client.Rpc.File",h.ClientRpcPortForwarding="Client.Rpc.PortForwarding",h.ClientRpcServerSharing="Client.Rpc.ServerSharing",h.ClientRpcSourceEvent="Client.Rpc.SourceEvent",h.ClientRpcStream="Client.Rpc.Stream",h.ClientRpcStreamManager="Client.Rpc.StreamManager",h.ClientRpcTerminal="Client.Rpc.Terminal",h.ClientRpcChat="Client.Rpc.Chat",h.ClientRpcTerminalEndpoint="Client.Rpc.TerminalEndpoint",h.ClientRpcWorkspace="Client.Rpc.Workspace",h.ClientRpcWorkspaceUser="Client.Rpc.WorkspaceUser",h.ClientRpcSessionContext="Client.Rpc.SessionContext",h.ClientRpcContact="Client.Rpc.Contact",h.ClientWorkspace="Client.Workspace",h.ClientRemoteBuild="Client.RemoteBuild",h.ClientCSharpLS="Client.CSharpLS",h.ClientSharedTerminal="Client.SharedTerminal",h.ClientWorkspaceAccessControl="Client.Workspace.AccessControl",h.ClientAccessControl="Client.AccessControl",h.ClientSearch="Client.Search",h.ClientSourceControl="Client.SourceControl",h.ClientSyncService="Client.SyncService",h.ClientCommentService="Client.CommentService",h.ClientGettingStartedPageContentProvider="Client.GettingStartedPageContentProvider",h.ClientPortForwardingBrowser="Client.PortForwardingBrowser",h.ClientOnlineEnvironmentSessionService="Client.OnlineEnvironmentSessionService",h.Calling="Calling",h.DebugHostAdapter="Debug.HostAdapter",h.DebugRpcHostAdapter="Debug.Rpc.HostAdapter",h.DebugAdapterHost="Debug.AdapterHost",h.ForwardingTcpServer="ForwardingTcpServer",h.ForwardingPipeServer="ForwardingPipeServer",h.Telemetry="Telemetry",h.ClientAccessCheck="ClientAccessCheck",h.LSPCoauthoringManager="LSP.CoauthoringManager",h.RemoteServiceBroker="RemoteServiceBroker",h.ReviewsDiffs="Reviews.Diffs",h.Cli="CLI",h.CliRestore="CLI.restore",h.CliStart="CLI.start",h.CliStop="CLI.stop",h.TTY="TTY",h.Settings="Settings",h.API="API",h.VmAgent="VmAgent",h.SelfHostedAgent="SelfHostedAgent",h.EnvironmentConfig="EnvConfig",h.VMConfig="VMCFG",h.LinuxContainerUpdate="LinuxContainerUpdate",h.ShutDownEnvironmentHandler="ShutdownEnvironment",h.StartEnvironmentHandler="StartEnvironment",h.VmAgentRpcService="VmAgentRpcService",h.RebuildEnvironmentHandler="RebuildEnvironment",h.WarmupEnvironmentHandler="WarmupEnvironment",h.StartLiveShareHandler="StartLiveShare",h.StartPortForwardingHandler="StartPortForwardingHandler",h.ContainerEnvironmentMonitor="ContainerMonitor",h.SSHServerMonitor="SSHServerMonitor",h.ContainerTunnel="ContainerTunnel",h.RunningContainerInfoProvider="RunningContainerInfo",h.DevContainerChangesWatcher="DevContainerChangesWatcher",h.VSCodeServerHostService="VSCodeServerHostService",h.SshServerHostService="SSHServerHostService",h.CodespaceHostService="CodespaceHostService",h.ClientAutoSuspendMonitor="ClientAutoSuspendMonitor",h.DockerImagePrune="DockerImagePrune",h.PrebuildPoolUpdateHandler="PrebuildPoolUpdate",h.StandAloneAgent="StandAloneAgent",h.StopCodespacePolicyMonitor="StopCodespacePolicy",h.Viewlet="Viewlet",h.VSIX="VSIX",h.ClientPrefix="Client.",h.ClientLSP="Client.LSP",h.LSPHost="LSP.Host",h.BreakpointManager="BreakpointManager",h.DebugAdapter="Debug.Adapter",h.DebugRemote="Debug.Remote",h.DebugSessionHost="Debug.SessionHost",h.DebugHost="Debug.Host",h.DebugRpcHost="Debug.Rpc.Host",h.DebugTargetHostProcess="Debug.TargetHostProcess",h.DebugRpcSessionHost="Debug.Rpc.SessionHost"}(m.TraceSources||(m.TraceSources={})),m.AgentSessionService={name:"agentSessionService",methods:["initializeSession","enableReconnect","keepAlive","forceKill"],events:[]},m.AuthenticationCoreService={methods:["getCurrentAuthenticatedUser","getCurrentUser","removeRecentCollaborator","removeAllRecentCollaborators"],events:["authenticationChanged"]},m.AuthenticationService={name:"auth",methods:["getLoginUri","findLoginCode","login","loginAsAnonymous","loginWithCachedToken","loginWithExternalToken","logout","getCachedToken","getCurrentAuthenticatedUser","getCurrentUser","removeRecentCollaborator","removeAllRecentCollaborators"],events:["authenticationChanged"]},m.BrokerAuthorizationService={name:"brokerAuthorization",methods:["authorize"],events:[]},m.BrokerManagerService={name:"brokerManager",methods:["register","tryRevoke"],events:[]},m.ChatService={name:"chat",methods:["getMessageHistory","getParticipants","sendMessage","dispose"],events:["messageReceived"]},m.CommentService={name:"commentService",methods:["createCommentThread","createComment","updateComment","deleteComment","getAllCommentThreads","getCommentThreadPositions","updateLike"],events:["commentThreadChanged"]},m.ConfigurationService={name:"version",methods:["exchangeVersions","exchangeSettings","getSubnetMasks"],events:[]},m.FirewallService={name:"firewall",methods:["getFirewallStatus"],events:[]},m.HubConnectionService={name:"hubConnection",methods:["getIsConnected","getIsAttempting","getEnabled","setEnabled","registerHubMethodNotify","unregisterHubMethodNotify","invokeHubMethod","sendHubMethod"],events:["hubConnectionStateChanged","hubConnectionAttempted","hubMethodNotified"]},m.OnlineEnvironmentSessionService={name:"onlineEnvironmentLiveShareSessionService",methods:["getSessionState","updateSessionState"],events:[]},m.PortForwardingService={name:"portForwarding",methods:["getSharedServers","getSharedPipes","getLastAccessTime","setDestinationPort"],events:["sharingStarted","pipeSharingStarted","browseSharingStarted","sharingStopped","pipeSharingStopped","sharingChanged"]},m.ServerSharingService={name:"serverSharing",methods:["startSharing","startSharingPipe","stopSharing","stopSharingPipe","stopSharingBrowseSessions","getSharedServers","getSharedPipes","updateSessionName","updateSharedServerVisibility","updateSharedServerProtocol","updateSharedServerPrivacy"],voidMethods:["invokeSharingSucceeded","invokeSharingFailed"],events:["sharingStarted","pipeSharingStarted","browseSharingStarted","sharingStopped","pipeSharingStopped","sharingChanged","sharingSucceeded","sharingFailed"]},m.SessionContextService={name:"sessionContext",methods:["getServiceNames"],voidMethods:["sendSessionStateUpdateToClient","sendSessionStatusUpdateToClient"],events:["sessionStateUpdate","sessionStatusUpdate"]},m.SourceControlService={name:"sourceControl",methods:["getAllSourceControls","getSourceControls","getSourceControl","getRecentVersions","getRecentVersionsTillMergeVersion","getDiffsForVersion","getDiffForResource","getResource","cleanResources","getMergeVersion","getRemoteVersionsNames","getCurrentVersionName"],events:["sourceControlChanged","resourceChanged"]},m.SyncService={name:"syncService",methods:["checkSync","checkSyncForVersion","checkSyncForVersion2"],events:[]},m.TaskOutputService={name:"taskOutput",methods:["getTaskOutputs","shareTaskOutput","updateTaskOutputFeed","closeTaskOutput"],events:["taskOutputShared","taskOutputFeedUpdated","taskOutputClosed"]},m.TelemetryService={name:"telemetry",methods:["initialize","getServiceUri"],events:["genericOperation","fault"]},m.TerminalEndpoint={name:"terminalEndpoint",methods:["readBytes","writeBytes","readString","writeString"],events:[]},m.TerminalService={name:"terminal",methods:["startTerminal","getRunningTerminals","resizeTerminal","stopTerminal","clearTerminalBuffer","setTerminalReadOnlyForGuests"],events:["terminalStarted","terminalResized","terminalStopped","terminalReadOnlyChanged"]},m.TextSearchService={name:"textSearch",methods:["getTextSearchResults","getTextSearchResultsWithProgress"],events:[]},m.WorkspaceAccessControlService={name:"workspaceAccessControl",methods:["getAccessControl","setAccessControl","requestOperationAccess","setOperationAccess","rejectOperation"],events:["accessControlChanged","operationRejected","operationAccessChanged","opeationAccessRequested"]},m.WorkspaceDiagnosticsService={name:"workspaceDiagnostics",methods:["getDiagnostics"],events:["diagnosticDataChanged"]},m.WorkspaceService={name:"workspace",methods:["getWorkspace","listWorkspaces","createPersistentWorkspace","deleteWorkspace","renameWorkspace","shareWorkspace","createInvitationLink","getInvitationLinks","unshareWorkspace","beginJoinWorkspace","joinWorkspace","unjoinWorkspace","registerServices","canUserShareWorkspace","canUserHostWorkspace","createPublicInviteLink","disconnectGuest","unjoinOnlineEnvironmentsGuests","setWorkspaceReadyForConnection","updateWorkspaceOwner"],events:["servicesChanged","connectionStatusChanged","progressUpdated","userRemoved","userBlocked","workspaceReadyForConnection"]},m.WorkspaceUserService={name:"workspaceuser",methods:["acceptOrRejectGuest","autoAcceptGuests","removeUser","removeAllInteractiveUsers","fireProgressUpdatedToGuest","getCountOfGuestsWithSameAccount","createGuestDisplayName","getCachedGuestDisplayName","getGuestUserProfile","getCountOfInteractiveGuests"],events:["workspaceSessionChanged"]},m.LanguageServerProvider={methods:["getMetadata","request"],voidMethods:["notify"],events:["notified"]},m.DebuggerHostService={name:"DebuggerHostService",methods:["getCurrentDebugSessions","launchDebugSession","getLaunchConfigurations"],events:["debugSessionChanged","launchConfigurationsChanged"]},m.AccessControlService={name:"accessControl",methods:["getAccessControl"],events:["accessControlChanged"]},m.FileService={name:"file",methods:["registerExternalFiles","registerNamedExternalFiles","listRoots","list","readText","readTextWithProgress","writeText","createDirectory","delete","copy","move","getFiles","isExcluded","findFiles","getTextSearchResults","getTextSearchResultsWithProgress","clearRoots","addRoot","removeRoot","replaceRoot"],events:["filesChanged","rootsChanged","externalFilesChanged"]},m.SolutionViewService={name:"solutionView",methods:["getSolutionMode","getSolutionCaption","getChildrenNodes","getRootNodes","addNewItem","renameItem","deleteItem"],events:["solutionChanged","workspaceRootChanged"]},m.SourceEventService={name:"sourceEvent",methods:["fireEvent","setSourceData","getSourceData"],events:["event"]},m.StreamManagerService={name:"streamManager",methods:["getStream"],events:[]},m.StreamService={name:"stream",methods:["getStreamTraits","getLength","setLength","seek","readBytes","writeBytes","disposeStream"],events:[]},m.WorkspaceTaskService={name:"workspaceTask",methods:["getSupportedTasks","getTaskExecutions","runTask","runProjectTask","runDefaultBuildTask","terminateTask"],events:["taskStarted","taskTerminated"]}},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0});const v=y(912),C=y(7),T=y(18),w=y(5),A=y(15);m.settingsProviderInstance=new v.DefaultSettingsProvider,m.readUserSettings=async function readUserSettings(){let h=C.join(T.homedir(),".vs-liveshare-settings.json");const m={};try{await w.fileAccess.accessAsync(h)}catch(y){return w.traceSource.info("Did not find user settings at "+A.TraceFormat.formatPath(h)),m}try{return await w.fileAccess.readJson(h)}catch(h){return w.traceSource.info("User settings are not valid JSON"),m}}},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0}),m.DEFAULT_ANONYMOUS_USER_NAME="Guest User",m.READ_ONLY_LABEL="Read-only",m.READ_WRITE_LABEL="Read-write",m.LIVESHARE_EXTENSION_ID="ms-vsliveshare.vsliveshare",m.LIVESHARE_PRESENCE_PROVIDER_ID="LivesharePresence",m.LIVESHARE_JOIN_URI="https://vscode.dev/liveshare/"},function(h,m,y){"use strict";var v=y(33);function encode(h){return encodeURIComponent(h).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}h.exports=function buildURL(h,m,y){if(!m)return h;var C;if(y)C=y(m);else if(v.isURLSearchParams(m))C=m.toString();else{var T=[];v.forEach(m,(function serialize(h,m){null!=h&&(v.isArray(h)?m+="[]":h=[h],v.forEach(h,(function parseValue(h){v.isDate(h)?h=h.toISOString():v.isObject(h)&&(h=JSON.stringify(h)),T.push(encode(m)+"="+encode(h))})))})),C=T.join("&")}if(C){var w=h.indexOf("#");-1!==w&&(h=h.slice(0,w)),h+=(-1===h.indexOf("?")?"?":"&")+C}return h}},function(h,m,y){"use strict";var v=y(33),C=y(927),T=y(226),w={"Content-Type":"application/x-www-form-urlencoded"};function setContentTypeIfUnset(h,m){!v.isUndefined(h)&&v.isUndefined(h["Content-Type"])&&(h["Content-Type"]=m)}var A={transitional:{silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},adapter:function getDefaultAdapter(){var h;return"undefined"!=typeof XMLHttpRequest?h=y(928):"undefined"!=typeof process&&"[object process]"===Object.prototype.toString.call(process)&&(h=y(934)),h}(),transformRequest:[function transformRequest(h,m){return C(m,"Accept"),C(m,"Content-Type"),v.isFormData(h)||v.isArrayBuffer(h)||v.isBuffer(h)||v.isStream(h)||v.isFile(h)||v.isBlob(h)?h:v.isArrayBufferView(h)?h.buffer:v.isURLSearchParams(h)?(setContentTypeIfUnset(m,"application/x-www-form-urlencoded;charset=utf-8"),h.toString()):v.isObject(h)||m&&"application/json"===m["Content-Type"]?(setContentTypeIfUnset(m,"application/json"),function stringifySafely(h,m,y){if(v.isString(h))try{return(m||JSON.parse)(h),v.trim(h)}catch(h){if("SyntaxError"!==h.name)throw h}return(y||JSON.stringify)(h)}(h)):h}],transformResponse:[function transformResponse(h){var m=this.transitional,y=m&&m.silentJSONParsing,C=m&&m.forcedJSONParsing,w=!y&&"json"===this.responseType;if(w||C&&v.isString(h)&&h.length)try{return JSON.parse(h)}catch(h){if(w){if("SyntaxError"===h.name)throw T(h,this,"E_JSON_PARSE");throw h}}return h}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,validateStatus:function validateStatus(h){return h>=200&&h<300},headers:{common:{Accept:"application/json, text/plain, */*"}}};v.forEach(["delete","get","head"],(function forEachMethodNoData(h){A.headers[h]={}})),v.forEach(["post","put","patch"],(function forEachMethodWithData(h){A.headers[h]=v.merge(w)})),h.exports=A},function(h,m,y){"use strict";h.exports=function enhanceError(h,m,y,v,C){return h.config=m,y&&(h.code=y),h.request=v,h.response=C,h.isAxiosError=!0,h.toJSON=function toJSON(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:this.config,code:this.code}},h}},function(h,m,y){"use strict";var v=y(226);h.exports=function createError(h,m,y,C,T){var w=new Error(h);return v(w,m,y,C,T)}},function(h,m,y){const{parse:v,tokenize:C}=y(961),T=y(965),{CommentArray:w}=y(402),{assign:A}=y(165);h.exports={parse:v,stringify:T,tokenize:C,CommentArray:w,assign:A}},function(h,m,y){function objectToString(h){return Object.prototype.toString.call(h)}m.isArray=function isArray(h){return Array.isArray?Array.isArray(h):"[object Array]"===objectToString(h)},m.isBoolean=function isBoolean(h){return"boolean"==typeof h},m.isNull=function isNull(h){return null===h},m.isNullOrUndefined=function isNullOrUndefined(h){return null==h},m.isNumber=function isNumber(h){return"number"==typeof h},m.isString=function isString(h){return"string"==typeof h},m.isSymbol=function isSymbol(h){return"symbol"==typeof h},m.isUndefined=function isUndefined(h){return void 0===h},m.isRegExp=function isRegExp(h){return"[object RegExp]"===objectToString(h)},m.isObject=function isObject(h){return"object"==typeof h&&null!==h},m.isDate=function isDate(h){return"[object Date]"===objectToString(h)},m.isError=function isError(h){return"[object Error]"===objectToString(h)||h instanceof Error},m.isFunction=function isFunction(h){return"function"==typeof h},m.isPrimitive=function isPrimitive(h){return null===h||"boolean"==typeof h||"number"==typeof h||"string"==typeof h||"symbol"==typeof h||void 0===h},m.isBuffer=y(9).Buffer.isBuffer},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0});const v=y(12),C=y(14),T=y(5);m.showDiagnosticErrorMessage=function showDiagnosticErrorMessage(h){v.Settings.get(C.SettingKeys.diagnosticMode)&&T.NotificationUtil.showErrorMessage(h)}},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0});class NotebookConstants{}m.NotebookConstants=NotebookConstants,NotebookConstants.cellIdPropertyName="vsls_cell_id",NotebookConstants.mirrorNotebookTypePrefix="vsls-",NotebookConstants.notebookErrorMimeType="application/vnd.code.notebook.error",NotebookConstants.notebookStandardErrorMimeType="application/vnd.code.notebook.stderr"},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0}),function(h){h.ProviderAdded="ProviderAdded",h.ContactsChanged="ContactsChanged",h.InviteLinkReceived="MessageReceived",h.SuggestedUsersUpdate="SuggestedUsersUpdate",h.RecentContactsUpdate="RecentContactsUpdate",h.InviteContactsUpdate="InviteContactsUpdate",h.Ready="Ready",h.ProviderCapabilitiesChanged="ProviderCapabilitiesChanged",h.SignedStateChanged="SignedStateChanged"}(m.ContactManagerEvents||(m.ContactManagerEvents={})),function(h){h.Initialized="Initialized",h.SelfContactChanged="UsersPresenceChanged",h.AvailableUsersChanged="AvailableUsersChanged",h.ContactsChanged="ContactsChanged",h.InviteLinkReceived="InviteLinkReceived",h.MessageReceived="MessageReceived",h.ContactsChangedNotification="ContactsChangedNotification",h.ContactPropertyChangedNotification="ContactPropertyChangedNotification",h.SuggestedUsersUpdate="SuggestedUsersUpdate",h.CapabilitiesChanged="CapabilitiesChanged",h.SignedStateChanged="SignedStateChanged",h.AuthenticationRequired="AuthenticationRequired"}(m.ContactServiceEvents||(m.ContactServiceEvents={}))},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0}),function(h){h[h.SCROLL=0]="SCROLL",h[h.EDITORS=1]="EDITORS"}(m.UpdateCoEditorVisibleRangesReason||(m.UpdateCoEditorVisibleRangesReason={})),function(h){h[h.SUCCESSFUL=0]="SUCCESSFUL",h[h.FAILED=1]="FAILED",h[h.MODIFIED=2]="MODIFIED"}(m.ApplyEditResult||(m.ApplyEditResult={}))},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0});const v=y(63),C=y(235),T=y(410),w=y(166);class CollabBufferPosition{constructor(h,m){this.line=h,this.character=m}}m.CollabBufferPosition=CollabBufferPosition;class InternalEdit{constructor(h,m,y,v,C,T){this.offset=h,this.length=m,this.start=y,this.end=v,this.oldText=C,this.newText=T}}class InternalOffsetEdit{constructor(h,m,y,v){this.index=h,this.offset=m,this.length=y,this.text=v}}class CollabBuffer{constructor(h,m){this.trace=m,this.recording=!1,this.recordedEdits=null,this.unexpandedRecordedEdits=null,this.recordEditsForUndo=!1,this.recordedUndoEdits=null,this.lines=CollabBuffer.convertStringToLines(h);const y=new Uint32Array(this.lines.length);this.lines.forEach((h,m)=>{y[m]=h.length}),this.lineStarts=new T.PrefixSumComputer(y)}static convertStringToLines(h){const m=h.length;let y=[],v=0,C=0,T=0;for(let w=0;w<m;w++){const m=h.charCodeAt(w);10===m?(y[v++]=h.substring(C,w+1),C=w+1):13===T&&(y[v++]=h.substring(C,w),C=w),T=m}return y[v++]=h.substring(C,m+1),13===T&&(y[v++]=""),y}static convertVsCodeContentChangeToCollabChange(h,m){let y=new CollabBufferPosition(h.range.start.line,h.range.start.character),v=new CollabBufferPosition(h.range.end.line,h.range.end.character),C=h.text;return function isDanglingNewLine(h,m){return h.length>0&&10===h.charCodeAt(0)&&(m.line>0||m.character>0)}(C,y)&&([C,y]=function adjustContentAndPositionForNewLineType(h,m,y){let v,C;return 0===m.character?(C=y.getLineContent(m.line-1),v=new CollabBufferPosition(m.line-1,C.length-1)):(C=y.getLineContent(m.line),v=new CollabBufferPosition(m.line,m.character-1)),13===C.charCodeAt(v.character)&&(m=v,h="\r\n"+h),[h,m]}(C,y,m)),[y,v,C]}_validatePosition(h){let{line:m,character:y}=h;if(m<0)return m=0,y=0,new CollabBufferPosition(m,y);if(m>=this.lines.length)return m=this.lines.length-1,y=this.lines[m].length,new CollabBufferPosition(m,y);let v=this.lines[m].length;return y<0?(y=0,new CollabBufferPosition(m,y)):y>v?(y=v,new CollabBufferPosition(m,y)):h}offsetAt(h){return h=this._validatePosition(h),this.lineStarts.getAccumulatedValue(h.line-1)+h.character}positionAt(h){h=Math.floor(h),h=Math.max(0,h);const m=this.lineStarts.getIndexOf(h),y=this.lines[m.index].length;return new CollabBufferPosition(m.index,Math.min(m.remainder,y))}getContent(){return this.lines.join("")}getLineContent(h){return v.assert(h<this.lines.length,"Line content requested outside of buffer"),this.lines[h]}getMaximumOffset(){return this.lineStarts.getAccumulatedValue(this.lines.length)}startCapturingEditsFromUndoing(){this.recordEditsForUndo=!0,this.recordedUndoEdits=[]}stopCapturingEditsFromUndoing(){this.recordEditsForUndo=!1;let h=this.recordedUndoEdits;return this.recordedUndoEdits=null,h}beginRecording(){this.recording=!0,this.recordedEdits=null,this.unexpandedRecordedEdits=null}endRecording(){const h=this.recordedEdits||[],m=this.unexpandedRecordedEdits||[];return this.recordedEdits=null,this.unexpandedRecordedEdits=null,this.recording=!1,[h,m]}_convertToInternalEditWithValidation(h,m,y){h=this._validatePosition(h),m=this._validatePosition(m);const v=this.offsetAt(h),C=this.offsetAt(m),T=this._getContentInRange(h,m);return new InternalEdit(v,C-v,h,m,T,y)}_convertInternalEditsToTextChange(h){const m=this._expandCRLFEdits(h);let y=new Array(m.length),v=new Array(m.length),T=0,w=0;for(let A=0;A<m.length;A++){const P=h[A],k=m[A];y[A]=new C.TextChange(k.offset,k.oldText,k.offset+T,k.newText),v[A]=new C.TextChange(P.offset,P.oldText,P.offset+w,P.newText),T+=k.newText.length-k.length,w+=P.newText.length-P.length}return[y,v,m]}convertCollabufferChangeToITextChange(h,m,y){const v=this._convertToInternalEditWithValidation(h,m,y),[C]=this._convertInternalEditsToTextChange([v]);return C[0]}applyLocalEdit(h,m,y){const v=this._convertToInternalEditWithValidation(h,m,y);this._applyInternalEdits([v])}_convertEditsToInternalEdits(h){let m=h.map((h,m)=>new InternalOffsetEdit(m,h.position,h.length,h.text));return m=CollabBuffer._sortAndValidateEdits(this.getMaximumOffset(),m),m=CollabBuffer._mergeAdjacentEdits(m),m.map(h=>{const m=this.positionAt(h.offset),y=this.positionAt(h.offset+h.length),v=this._getContentInRange(m,y);return new InternalEdit(h.offset,h.length,m,y,v,h.text)})}transformEditsToTextChanges(h){const m=this._convertEditsToInternalEdits(h),[y]=this._convertInternalEditsToTextChange(m);return y}applyRemoteEdits(h){const m=this._convertEditsToInternalEdits(h);return this._applyInternalEdits(m)}static _sortAndValidateEdits(h,m){return w.checkDebugging()&&m.forEach(m=>{v.assert(m.offset>=0,"invalid position"),v.assert(m.offset<=h,"invalid position"),v.assert(m.length>=0,"invalid length"),v.assert(m.offset+m.length<=h,"invalid length")}),m.sort(CollabBuffer._compareEdits),w.checkDebugging()&&m.forEach((h,m,y)=>{if(0===m)return;const C=y[m-1];C.offset+C.length>h.offset&&v.assert(!1,"invalid edits: overlapping")}),m}static _compareEdits(h,m){const y=h.offset-m.offset;return 0===y?h.index-m.index:y}static _mergeAdjacentEdits(h){if(h.length<=1)return h;let m=[],y=0,v=h[0];for(let C=1,T=h.length;C<T;C++){const T=h[C];v.offset+v.length!==T.offset?(m[y++]=v,v=T):v=new InternalOffsetEdit(v.index,v.offset,v.length+T.length,v.text+T.text)}return m[y++]=v,m}_getContentInRange(h,m){if(h.line===m.line)return this.lines[h.line].substring(h.character,m.character);let y=[],v=0;y[v++]=this.lines[h.line].substr(h.character);for(let C=h.line+1;C<m.line;C++)y[v++]=this.lines[C];return y[v++]=this.lines[m.line].substr(0,m.character),y.join("")}_expandCRLFEdits(h){let m=[],y=0;for(let v=0,C=h.length;v<C;v++){const C=h[v];let T=C.offset,w=C.length,A=C.start,P=C.end,k=C.oldText,R=C.newText;if(T>0){let h,m;0===A.character?(m=this.lines[A.line-1],h=new CollabBufferPosition(A.line-1,m.length-1)):(m=this.lines[A.line],h=new CollabBufferPosition(A.line,A.character-1)),13===m.charCodeAt(h.character)&&(T--,w++,R="\r"+R,k="\r"+k,A=h)}const M=this.lines[P.line];P.character<M.length&&10===M.charCodeAt(P.character)&&(w++,R+="\n",k+="\n",P=new CollabBufferPosition(P.line+1,0)),m[y++]=new InternalEdit(T,w,A,P,k,R)}return m}_applyInternalEdits(h){this.trace.verbose(`CollabBuffer._applyInternalEdits ${JSON.stringify(h.map(h=>({start:h.start,end:h.end,length:h.length,offset:h.offset,newText:h.newText.length,oldText:h.oldText.length})))}`);const[m,y,v]=this._convertInternalEditsToTextChange(h);for(let h=v.length-1;h>=0;h--){const m=v[h];this._delete(m.start,m.end),this._insert(m.start,m.newText)}return this.recording&&(this.recordedEdits=C.compressConsecutiveTextChanges(this.recordedEdits||[],m),this.unexpandedRecordedEdits=C.compressConsecutiveTextChanges(this.unexpandedRecordedEdits||[],y)),this.recordEditsForUndo&&(this.recordedUndoEdits=C.compressConsecutiveTextChanges(this.recordedUndoEdits||[],m)),m}_setLineText(h,m){this.lines[h]=m,this.lineStarts.changeValue(h,m.length)}_delete(h,m){if(h.line===m.line){if(h.character===m.character)return;let y=this.lines[h.line];return void this._setLineText(h.line,y.substring(0,h.character)+y.substring(m.character))}let y=this.lines[h.line],v=this.lines[m.line];this._setLineText(h.line,y.substring(0,h.character)+v.substring(m.character)),this.lines.splice(h.line+1,m.line-h.line),this.lineStarts.removeValues(h.line+1,m.line-h.line)}_insert(h,m){if(0===m.length)return;let y=CollabBuffer.convertStringToLines(m);if(1===y.length){let m=this.lines[h.line];return void this._setLineText(h.line,m.substring(0,h.character)+y[0]+m.substring(h.character))}y[y.length-1]+=this.lines[h.line].substring(h.character),this._setLineText(h.line,this.lines[h.line].substring(0,h.character)+y[0]),y.shift();let v=new Uint32Array(y.length);for(let h=0;h<y.length;h++)v[h]=y[h].length;this.lines=function insertIntoNewArray(h,m,y){const v=h.slice(0,m),C=h.slice(m);return v.concat(y,C)}(this.lines,h.line+1,y),this.lineStarts.insertValues(h.line+1,v)}}m.CollabBuffer=CollabBuffer},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0});const v=y(63);class TextChange{constructor(h,m,y,v){this.oldPosition=h,this.oldLength=m.length,this.oldEnd=this.oldPosition+this.oldLength,this.oldText=m,this.newPosition=y,this.newLength=v.length,this.newEnd=this.newPosition+this.newLength,this.newText=v}}m.TextChange=TextChange,m.compressConsecutiveTextChanges=function compressConsecutiveTextChanges(h,m){return h?(new TextChangeCompressor).compress(h,m):m};class TextChangeCompressor{constructor(){}static _rebaseCurr(h,m){return new TextChange(m.oldPosition-h,m.oldText,m.newPosition,m.newText)}static _rebasePrev(h,m){return new TextChange(m.oldPosition,m.oldText,m.newPosition+h,m.newText)}compress(h,m){this.prevEdits=h,this.currEdits=m,this.result=[],this.resultLen=0;let y=0;this.prevLen=this.prevEdits.length,this.prevDeltaOffset=0;let C=0;this.currLen=this.currEdits.length,this.currDeltaOffset=0;let T=this._getPrev(y),w=this._getCurr(C);for(;y<this.prevLen||C<this.currLen;){if(null===T){this._acceptCurr(w),w=this._getCurr(++C);continue}if(null===w){this._acceptPrev(T),T=this._getPrev(++y);continue}if(w.oldEnd<=T.newPosition){this._acceptCurr(w),w=this._getCurr(++C);continue}if(T.newEnd<=w.oldPosition){this._acceptPrev(T),T=this._getPrev(++y);continue}if(w.oldPosition<T.newPosition){let[h,m]=TextChangeCompressor._splitCurr(w,T.newPosition-w.oldPosition);this._acceptCurr(h),w=m;continue}if(T.newPosition<w.oldPosition){let[h,m]=TextChangeCompressor._splitPrev(T,w.oldPosition-T.newPosition);this._acceptPrev(h),T=m;continue}let h,m;if(v.assert(w.oldPosition===T.newPosition,"unexpected"),w.oldEnd===T.newEnd)h=T,m=w,T=this._getPrev(++y),w=this._getCurr(++C);else if(w.oldEnd<T.newEnd){let[y,v]=TextChangeCompressor._splitPrev(T,w.oldLength);h=y,m=w,T=v,w=this._getCurr(++C)}else{let[v,C]=TextChangeCompressor._splitCurr(w,T.newLength);h=T,m=v,T=this._getPrev(++y),w=C}this.result[this.resultLen++]=new TextChange(h.oldPosition,h.oldText,m.newPosition,m.newText),this.prevDeltaOffset+=h.newLength-h.oldLength,this.currDeltaOffset+=m.newLength-m.oldLength}let A=TextChangeCompressor._merge(this.result);return TextChangeCompressor._removeNoOps(A)}_acceptCurr(h){this.result[this.resultLen++]=TextChangeCompressor._rebaseCurr(this.prevDeltaOffset,h),this.currDeltaOffset+=h.newLength-h.oldLength}_getCurr(h){return h<this.currLen?this.currEdits[h]:null}_acceptPrev(h){this.result[this.resultLen++]=TextChangeCompressor._rebasePrev(this.currDeltaOffset,h),this.prevDeltaOffset+=h.newLength-h.oldLength}_getPrev(h){return h<this.prevLen?this.prevEdits[h]:null}static _splitPrev(h,m){let y=h.newText.substr(0,m),v=h.newText.substr(m);return[new TextChange(h.oldPosition,h.oldText,h.newPosition,y),new TextChange(h.oldEnd,"",h.newPosition+m,v)]}static _splitCurr(h,m){let y=h.oldText.substr(0,m),v=h.oldText.substr(m);return[new TextChange(h.oldPosition,y,h.newPosition,h.newText),new TextChange(h.oldPosition+m,v,h.newEnd,"")]}static _merge(h){if(0===h.length)return h;let m=[],y=0,v=h[0];for(let C=1;C<h.length;C++){let T=h[C];v.oldEnd===T.oldPosition?v=new TextChange(v.oldPosition,v.oldText+T.oldText,v.newPosition,v.newText+T.newText):(m[y++]=v,v=T)}return m[y++]=v,m}static _removeNoOps(h){if(0===h.length)return h;let m=[],y=0;for(let v=0;v<h.length;v++){let C=h[v];C.oldText!==C.newText&&(m[y++]=C)}return m}}},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0});const v=y(93);m.getTimedArray=function getTimedArray(h){const m=new TimedArray(h);return new Proxy([],{set:function(h,y,v){return h[y]=v,m.arrayUpdated(h),!0}})},m.setArray=function setArray(h,m){h.length>m.length&&h.splice(m.length),h.splice(0,m.length,...m)};class TimedArray{constructor(h){this.wasZeroLength=!0,this.timeAtLastZeroLength=0,this.telemetry=new v.TimeTelemetry(h,()=>{this.arrayUpdated([])})}arrayUpdated(h){const m=0===h.length;if(m&&!this.wasZeroLength){const h=(new Date).getTime()-this.timeAtLastZeroLength;this.telemetry.RecordTime(h)}else!m&&this.wasZeroLength&&(this.timeAtLastZeroLength=(new Date).getTime());this.wasZeroLength=m}}},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0});const v=new RegExp(/\r?\n|\r/g);m.removeLineEndings=function removeLineEndings(h){return h.replace(v,"")},m.calculateFileHash=function calculateFileHash(h){let m=352654597,y=m,v=0;const C=h.length;for(;C>=v+4;){m=(m<<5)+m+(m>>27)^(h.charCodeAt(v+1)<<16)+h.charCodeAt(v),y=(y<<5)+y+(y>>27)^(h.charCodeAt(v+3)<<16)+h.charCodeAt(v+2),v+=4}if(C>v){let y=h.charCodeAt(v);C>v+1&&(y+=h.charCodeAt(v+1)<<16),m=(m<<5)+m+(m>>27)^y}if(C>v+2){let m=h.charCodeAt(v+2);C>v+3&&(m+=h.charCodeAt(v+3)<<16),y=(y<<5)+y+(y>>27)^m}return m+function mul32(h,m){const y=65535&m;return((m-y)*h|0)+(y*h|0)|0}(y,1566083941)|0}},function(h,m,y){"use strict";m.__esModule=!0;var v=y(415);m.default=v.default,function __export(h){for(var y in h)m.hasOwnProperty(y)||(m[y]=h[y])}(y(980))},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0});const v=y(1047),C=y(1048);m.liveshareGithubStrategy=new v.LiveShareGithubStrategy,m.liveshareAnonymousStrategy=new C.LiveShareAnonymousStrategy},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0});class UserError extends Error{constructor(h,m){super(h),this.code=m}}m.UserError=UserError},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0});class NonBlockingError extends Error{constructor(h,m){super(h),this.code=m}}m.NonBlockingError=NonBlockingError},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0});const v=y(4),C=y(15),T=y(240),w=y(2),A=y(1053),P=y(241),k=y(8);class TelemetryUtil{static DeriveTelemetryResultFromErrorCode(h){switch(h.code){case v.vsls.ErrorCodes.CollaborationSessionGuestRejected:case v.vsls.ErrorCodes.ForbiddenHttpStatusCode:case v.vsls.ErrorCodes.CollaborationSessionGuestCanceled:case v.vsls.ErrorCodes.CollaborationSessionRequestTimedOut:case v.vsls.ErrorCodes.CollaborationSessionNotFound:case v.vsls.ErrorCodes.CollaborationSessionUsersLimitReached:case v.vsls.ErrorCodes.RelayConnectionHostFailure:return k.TelemetryResult.UserFailure}}static DeriveTelemetryResultFromErrorType(h){return h instanceof T.UserError?k.TelemetryResult.UserFailure:h instanceof w.CancellationError?k.TelemetryResult.Cancel:h instanceof A.IndeterminateError?k.TelemetryResult.IndeterminateFailure:h instanceof P.NonBlockingError?k.TelemetryResult.NonBlockingFailure:void 0}static DeriveTelemetryResult(h){const m=TelemetryUtil.DeriveTelemetryResultFromErrorCode(h);if(void 0!==m)return m;const y=TelemetryUtil.DeriveTelemetryResultFromErrorType(h);return void 0!==y?y:k.TelemetryResult.Failure}static DeriveTelemetryTitle(h,m){let y="Success";return m===k.TelemetryResult.UserFailure?y="User Failure":m===k.TelemetryResult.Cancel?y="Cancelled":m===k.TelemetryResult.IndeterminateFailure?y="Indeterminate Failure":m===k.TelemetryResult.Failure?y="Failure":m===k.TelemetryResult.NonBlockingFailure&&(y="Non Blocking Failure"),`${h} ${y}`}static BuildTelemetryMessage(h,m,y){let v="";return void 0!==y&&(v=`: ${y}`),`${this.DeriveTelemetryTitle(h,m)}${v}`}static MapTelemetryResultToFaultType(h){switch(h){case k.TelemetryResult.UserFailure:return k.FaultType.User;case k.TelemetryResult.Cancel:return k.FaultType.UserCancelled;case k.TelemetryResult.Failure:return k.FaultType.Error;case k.TelemetryResult.NonBlockingFailure:return k.FaultType.NonBlockingFault;case k.TelemetryResult.IndeterminateFailure:default:return k.FaultType.Unknown}}static MapTelemetryResultToTraceEventType(h){return h===k.TelemetryResult.Success?C.LogLevel.Info:C.LogLevel.Error}}m.TelemetryUtil=TelemetryUtil},function(h,m,y){"use strict";var v=this&&this.__awaiter||function(h,m,y,v){return new(y||(y=Promise))((function(C,T){function fulfilled(h){try{step(v.next(h))}catch(h){T(h)}}function rejected(h){try{step(v.throw(h))}catch(h){T(h)}}function step(h){h.done?C(h.value):function adopt(h){return h instanceof y?h:new y((function(m){m(h)}))}(h.value).then(fulfilled,rejected)}step((v=v.apply(h,m||[])).next())}))};Object.defineProperty(m,"__esModule",{value:!0});const C=y(4),T=y(6),w=y(429),A=y(8),P=y(17);m.ClientAccessCheck=class ClientAccessCheck{constructor(h,m){this.workspaceAccessControlService=h,this.hostSessionId=m}getContextSessionId(h){if(h&&"object"==typeof h&&(h=void 0!==h.GuestSessionId?h.GuestSessionId:"object"==typeof h.context?h.context.GuestSessionId:void 0),"number"==typeof h&&(h=h.toString()),"string"==typeof h)return h}isHostSession(h){return this.hostSessionId.toString()===h}isHostSessionContext(h){return this.isHostSession(this.getContextSessionId(h))}isReadOnlySession(){return v(this,void 0,void 0,(function*(){yield this.ensureWorkspaceAccessControl();const{defaultAccessControl:h={}}=this.workspaceAccessControl;return!!h.isReadOnly}))}isClientExplicitlyReadWrite(h){return v(this,void 0,void 0,(function*(){const m=this.getContextSessionId(h);if(this.isHostSession(m)||!m)return!1;yield this.ensureWorkspaceAccessControl();const{defaultAccessControl:y={},userAccessControl:v={}}=this.workspaceAccessControl,C=v[m];return!!C&&(y.isReadOnly&&!C.isReadOnly)}))}isClientReadOnly(h){return v(this,void 0,void 0,(function*(){const m=this.getContextSessionId(h);return!(this.isHostSession(m)||!m)&&(yield this.ensureWorkspaceAccessControl(),!!(this.workspaceAccessControl.userAccessControl[m]||this.workspaceAccessControl.defaultAccessControl||{}).isReadOnly)}))}canPerformOperation(h,m){return v(this,void 0,void 0,(function*(){return!m||(m.ownerOnly&&!this.isHostSessionContext(h)?(this.sendRejectedOperationTelemetry(m,w.RestrictedOperationRejectionReason.RejectedForNotOwner),!1):!m.enabledInReadOnlySession&&(yield this.isClientReadOnly(h))?(this.sendRejectedOperationTelemetry(m,w.RestrictedOperationRejectionReason.RejectedInReadOnlySession),!1):!m.isEnabled||!0===m.isEnabled()||(this.sendRejectedOperationTelemetry(m,w.RestrictedOperationRejectionReason.DisabledByHost),!1))}))}verifyCanPerformOperation(h,m){return v(this,void 0,void 0,(function*(){if(!(yield this.canPerformOperation(h,m))){if(m.ownerOnly&&!this.isHostSessionContext(h))throw new T.ResponseError(C.vsls.ErrorCodes.OperationRejectedForNotOwner,"This operation is not allowed for non owners.");if(!m.enabledInReadOnlySession&&(yield this.isClientReadOnly(h)))throw new T.ResponseError(C.vsls.ErrorCodes.OperationRejectedInReadOnlySession,"This operation is not allowed in read-only collaboration session.");if(m.isEnabled){const h=m.isEnabled();if(h&&"object"==typeof h)throw new T.ResponseError(h.errorCode,h.errorMessage)}throw new T.ResponseError(C.vsls.ErrorCodes.OperationRejected,"Insufficient access rights to perform this operation.")}}))}init(){return v(this,void 0,void 0,(function*(){yield this.initWorkspaceAccessControl()}))}dispose(){return v(this,void 0,void 0,(function*(){this.endCollaboration()}))}endCollaboration(){this.accessControlChangedEvent&&(this.accessControlChangedEvent.dispose(),this.accessControlChangedEvent=void 0),this.workspaceAccessControl=void 0}onWorkspaceAccessControlChanged(h){this.workspaceAccessControl=h.accessControl||{},this.workspaceAccessControl.defaultAccessControl=this.workspaceAccessControl.defaultAccessControl||{}}initWorkspaceAccessControl(){return v(this,void 0,void 0,(function*(){try{this.workspaceAccessControl=(yield this.workspaceAccessControlService.getAccessControlAsync())||{},this.accessControlChangedEvent=this.workspaceAccessControlService.onAccessControlChanged(this.onWorkspaceAccessControlChanged,this)}catch(h){this.workspaceAccessControl={userAccessControl:{}}}}))}ensureWorkspaceAccessControl(){return v(this,void 0,void 0,(function*(){this.workspaceAccessControl||(yield this.initWorkspaceAccessControl())}))}sendRejectedOperationTelemetry(h,m){new A.TelemetryEvent(P.TelemetryEventNames.REJECT_RESTRICTED_OPERATION).addProperty(P.TelemetryPropertyNames.OPERATION_NAME,h.name).addProperty(P.TelemetryPropertyNames.REJECTION_REASON,m).send()}}},function(h,m,y){"use strict";var v=this&&this.__awaiter||function(h,m,y,v){return new(y||(y=Promise))((function(C,T){function fulfilled(h){try{step(v.next(h))}catch(h){T(h)}}function rejected(h){try{step(v.throw(h))}catch(h){T(h)}}function step(h){h.done?C(h.value):function adopt(h){return h instanceof y?h:new y((function(m){m(h)}))}(h.value).then(fulfilled,rejected)}step((v=v.apply(h,m||[])).next())}))};Object.defineProperty(m,"__esModule",{value:!0});const C=y(12),T=y(14),w=y(163),A=y(25);var P;!function(h){h[h.AuthTokenService=0]="AuthTokenService",h[h.AuthTokenServiceAudience=1]="AuthTokenServiceAudience"}(P||(P={}));m.TokenExchangeService=class TokenExchangeService{constructor(h){this.logger=h,this.devEnvRegExp=new RegExp(".*.dev.liveshare.vsengsaas.visualstudio.com"),this.endpointsByEnvironment={dev:{[P.AuthTokenService]:"https://sts.dev.core.vsengsaas.visualstudio.com/api/v1/tokens/exchange",[P.AuthTokenServiceAudience]:"https://ci.dev.liveshare.vsengsaas.visualstudio.com/"},ppe:{[P.AuthTokenService]:"https://sts-ppe.core.vsengsaas.visualstudio.com/api/v1/tokens/exchange",[P.AuthTokenServiceAudience]:"https://ppe.liveshare.vsengsaas.visualstudio.com/"},prod:{[P.AuthTokenService]:"https://sts.online.visualstudio.com/api/v1/tokens/exchange",[P.AuthTokenServiceAudience]:"https://insiders.liveshare.vsengsaas.visualstudio.com/"}};const m=C.Settings.get(T.SettingKeys.serviceUri);let y=void 0;m?y=this.getEnvironment(m):(h.info("Service Uri is not set. Default to production"),y="prod"),"unknown"===y&&(h.warning(`Can not determine environment for ${m} service Uri. Default to production`),y="prod"),this.currentEndpoints=this.endpointsByEnvironment[y]}exchange(h,m){return v(this,void 0,void 0,(function*(){const y=(yield w.default(this.currentEndpoints[P.AuthTokenService],{method:"POST",headers:{"Content-Type":"application/json-patch+json"},data:JSON.stringify({provider:`${h}`,token:`${m}`,audience:`${this.currentEndpoints[P.AuthTokenServiceAudience]}`,lifetime:"25"}),proxy:!1})).data;if(y.token)return y.token;switch(y.status){case 401:throw new Error(A.localize("error.AuthTokenConversionFailed"));default:throw new Error(A.localize("error.AuthTokenConversionFailedWithCode").replace("${code}",y.status))}}))}getEnvironment(h){const m=new URL(h.trim());if(this.devEnvRegExp.test(m.hostname))return"dev";switch(m.hostname){case"ppe.liveshare.vsengsaas.visualstudio.com":return"ppe";case"prod.liveshare.vsengsaas.visualstudio.com":return"prod";default:return"unknown"}}}},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0}),m.KeyExchangeAlgorithm=void 0;m.KeyExchangeAlgorithm=class KeyExchangeAlgorithm{constructor(h,m,y,v){this.name=h,this.keySizeInBits=m,this.hashAlgorithmName=y,this.hashDigestLength=v}}},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0}),m.EncryptionAlgorithm=void 0;m.EncryptionAlgorithm=class EncryptionAlgorithm{constructor(h){this.name=h}}},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0}),m.HmacAlgorithm=void 0;m.HmacAlgorithm=class HmacAlgorithm{constructor(h,m,y,v){this.name=h,this.algorithmName=m,this.keyLength=y,this.digestLength=v}}},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0}),m.WebHmac=void 0;const v=y(9),C=y(247);class WebHmac extends C.HmacAlgorithm{constructor(h,m,y=!1){super(h,m,WebHmac.getHashKeyLength(m),WebHmac.getHashDigestLength(m)),this.encryptThenMac=y}async createSigner(h){const m=new WebSignerVerifier(this.algorithmName,!0,this.digestLength,this.encryptThenMac);return await m.init(h),m}async createVerifier(h){const m=new WebSignerVerifier(this.algorithmName,!1,this.digestLength,this.encryptThenMac);return await m.init(h),m}static getHashKeyLength(h){if("SHA2-512"===h)return 64;if("SHA2-384"===h)return 48;if("SHA2-256"===h)return 32;throw new Error(`Unsupported hash algorithm: ${h}`)}static getHashDigestLength(h){return this.getHashKeyLength(h)}static getWebHashAlgorithmName(h){if("SHA2-512"===h)return"SHA-512";if("SHA2-384"===h)return"SHA-384";if("SHA2-256"===h)return"SHA-256";throw new Error(`Unsupported hash algorithm: ${h}`)}}m.WebHmac=WebHmac;class WebSignerVerifier{constructor(h,m,y,v){this.algorithmName=h,this.isSigning=m,this.digestLength=y,this.encryptThenMac=v}async init(h){try{const m=this.algorithmName.replace("SHA2-","SHA-");this.key=await crypto.subtle.importKey("raw",h,{name:"HMAC",hash:{name:m}},!1,this.isSigning?["sign"]:["verify"])}catch(h){throw new Error("Failed to initialize HMAC: "+h)}}async sign(h){return v.Buffer.from(await crypto.subtle.sign({name:"HMAC",hash:{name:this.algorithmName}},this.key,h))}async verify(h,m){return await crypto.subtle.verify({name:"HMAC",hash:{name:this.algorithmName}},this.key,m,h)}dispose(){}}},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0}),m.JsonWebKeyFormatter=void 0;const v=y(54),C=y(175);class JsonWebKeyFormatter{static formatRsa(h,m){const y=JsonWebKeyFormatter.formatBigInt;let v;if(!1!==m&&h.d&&h.p&&h.q&&h.dp&&h.dq&&h.qi)v={kty:"RSA",n:y(h.modulus),e:y(h.exponent),d:y(h.d),p:y(h.p),q:y(h.q),dp:y(h.dp),dq:y(h.dq),qi:y(h.qi)};else{if(m)throw new Error("Missing private key parameters.");v={kty:"RSA",n:y(h.modulus),e:y(h.exponent)}}return v}static parseRsa(h,m){if("RSA"!==(null==h?void 0:h.kty)||!h.n||!h.e)throw new Error("Invalid RSA JWK.");const y=JsonWebKeyFormatter.parseBigInt;let v;return v=!1!==m&&h.d&&h.p&&h.q&&h.dp&&h.dq&&h.qi?{modulus:y(h.n),exponent:y(h.e),d:y(h.d),p:y(h.p),q:y(h.q),dp:y(h.dp),dq:y(h.dq),qi:y(h.qi)}:{modulus:y(h.n),exponent:y(h.e)},v}static formatEC(h,m){const y=JsonWebKeyFormatter.formatBigInt,v=C.curves.find(m=>m.oid===h.curve.oid||m.name===h.curve.name||m.shortName===h.curve.name),T=Math.ceil(v.keySize/8),w={kty:"EC",crv:h.curve.name,x:y(h.x,T),y:y(h.y,T)};if(!1!==m&&h.d)w.d=y(h.d,T);else if(m)throw new Error("Missing private key parameters.");return w}static parseEC(h,m){if("EC"!==(null==h?void 0:h.kty)||!(h.crv&&h.x&&h.y))throw new Error("Invalid EC JWK.");const y=JsonWebKeyFormatter.parseBigInt,v={curve:{name:h.crv},x:y(h.x),y:y(h.y)};return!1!==m&&h.d&&(v.d=y(h.d)),v}static formatBigInt(h,m){return JsonWebKeyFormatter.base64UrlEncode(h.toBytes({unsigned:!0,length:m}))}static parseBigInt(h){return v.BigInt.fromBytes(Buffer.from(h,"base64"),{unsigned:!0})}static base64UrlEncode(h){return h.toString("base64").replace(/=+$/g,"").replace(/\+/g,"-").replace(/\//g,"_")}}m.JsonWebKeyFormatter=JsonWebKeyFormatter},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0}),m.NodeHmac=void 0;const v=y(11),C=y(9),T=y(247);class NodeHmac extends T.HmacAlgorithm{constructor(h,m,y=!1){super(h,m,NodeHmac.getHashKeyLength(m),NodeHmac.getHashDigestLength(m)),this.encryptThenMac=y}async createSigner(h){return new NodeSignerVerifier(NodeHmac.getNodeHashAlgorithmName(this.algorithmName),this.digestLength,this.encryptThenMac,h)}async createVerifier(h){return new NodeSignerVerifier(NodeHmac.getNodeHashAlgorithmName(this.algorithmName),this.digestLength,this.encryptThenMac,h)}static getHashKeyLength(h){if("SHA2-512"===h)return 64;if("SHA2-384"===h)return 48;if("SHA2-256"===h)return 32;throw new Error(`Unsupported hash algorithm: ${h}`)}static getHashDigestLength(h){return this.getHashKeyLength(h)}static getNodeHashAlgorithmName(h){if("SHA2-512"===h)return"sha512";if("SHA2-384"===h)return"sha384";if("SHA2-256"===h)return"sha256";throw new Error(`Unsupported hash algorithm: ${h}`)}}m.NodeHmac=NodeHmac;class NodeSignerVerifier{constructor(h,m,y,T){this.algorithmName=h,this.digestLength=m,this.encryptThenMac=y,this.key=v.createSecretKey?v.createSecretKey(T):C.Buffer.from(T)}async sign(h){const m=v.createHmac(this.algorithmName,this.key);return m.update(h),m.digest()}async verify(h,m){const y=v.createHmac(this.algorithmName,this.key);return y.update(h),y.digest().equals(m)}dispose(){}}},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0}),m.DerWriter=m.DerReader=void 0;const v=y(9),C=y(54);class DerReader{constructor(h,m=48){this.buffer=h,this.position=0,this.readType(m);const y=this.readLength();if(y>this.buffer.length-this.position)throw new Error("Read out of bounds.");this.buffer=this.buffer.slice(0,this.position+y)}get available(){return this.buffer.length-this.position}readNull(){if(this.readType(5),0!==this.readByte())throw new Error("Expected a 0 after Null type.")}readInteger(){this.readType(2);const h=this.readLength(),m=this.readBytes(h);return new C.BigInt(m)}readOctetString(){this.readType(4);const h=this.readLength();return this.readBytes(h)}readBitString(){this.readType(3);const h=this.readLength();if(0!==this.readByte())throw new Error("Padded bit strings are not supported.");return this.readBytes(h-1)}readObjectIdentifier(h){this.readType(6);const m=this.readLength(),y=this.position+m,v=[],C=this.readByte();v.push(Math.trunc(C/40)),v.push(C%40);let T=0;for(;this.position<y;){const h=this.readByte();0!=(128&h)?T=128*T+(127&h):(T=128*T+h,v.push(T),T=0)}if(0!==T)throw new Error("Invalid OID format.");const w=v.join(".");if(h&&w!==h)throw new Error(`Expected OID ${h}, found: ${w}`);return w}readSequence(){const h=this.position;this.readType(48);const m=this.readLength();return this.position+=m,new DerReader(this.buffer.slice(h,this.position))}tryReadTagged(h){if(this.position>=this.buffer.length)return null;const m=this.buffer[this.position];if(0==(160&m)||(-161&m)!==h)return null;const y=this.position;this.position++;const v=this.readLength();return this.position+=v,new DerReader(this.buffer.slice(y,this.position),m)}peek(){if(this.position>=this.buffer.length)throw new Error("Read out of bounds.");return this.buffer[this.position]}readLength(){let h=this.readByte();if(128===h)throw new Error("Indefinite-length encoding is not supported.");if(h>127){const m=127&h;if(m>4)throw new Error(`DER length size is ${m} and cannot be more than 4 bytes.`);h=0;for(let y=0;y<m;y++){h=(h<<8)+this.readByte()}if(h<0)throw new Error("Corrupted data - negative length found")}return h}readByte(){if(this.position>=this.buffer.length)throw new Error("Read out of bounds.");return this.buffer[this.position++]}readBytes(h){if(this.position+h>this.buffer.length)throw new Error("Read out of bounds.");const m=this.buffer.slice(this.position,this.position+h);return this.position+=h,m}readType(h){const m=this.readByte();if(m!==h)throw new Error(`Expected ${h} data type, found : ${m}`)}}m.DerReader=DerReader;class DerWriter{constructor(h,m=48){this.buffer=h,this.dataType=m,this.position=0,this.buffer=h}toBuffer(){const h=this.position,m=DerWriter.getLength(h);this.ensureCapacity(1+m.length+h);const y=this.buffer.slice(0,1+m.length+h);return this.buffer.copy(y,1+m.length),y[0]=this.dataType,m.copy(y,1,0),this.buffer=this.buffer.slice(1+m.length,y.length),this.position=h,y}writeSequence(h){this.writeBytes(h.toBuffer())}writeTagged(h,m){if(h>15)throw new Error("Invalid DER tag.");this.writeByte(160|h);const y=DerWriter.getLength(m.position);this.writeBytes(y),this.writeBytes(m.buffer.slice(0,m.position))}writeNull(){this.writeByte(5),this.writeByte(0)}writeInteger(h){this.writeByte(2);const m=h.toBytes(),y=DerWriter.getLength(m.length);this.writeBytes(y),this.writeBytes(m)}writeOctetString(h){this.writeByte(4);const m=DerWriter.getLength(h.length);this.writeBytes(m),this.writeBytes(h)}writeBitString(h){this.writeByte(3);const m=DerWriter.getLength(1+h.length);this.writeBytes(m),this.writeByte(0),this.writeBytes(h)}writeObjectIdentifier(h){if(!h)throw new TypeError("OID value is null or empty.");const m=h.split(".").map(Number);if(m.length<2||m[0]>3||m[1]>=40)throw new Error(`Invalid OID: ${h}`);this.writeByte(6);let y=m.length-1;for(let h=2;h<m.length;h++){let v=m[h];for(;v>128;)y++,v/=128}const v=DerWriter.getLength(y);this.writeBytes(v),this.writeByte(40*m[0]+m[1]);for(let h=2;h<m.length;h++){let y=m[h];if(y>=128){let h=[];for(h.push(127&y);y>=128;)y/=128,h.push(128|127&y);for(;h.length>0;)this.writeByte(h.pop())}else this.writeByte(y)}}static getLength(h){if(h>127){let m=1;for(let y=h>>8;0!==y;y>>=8)m++;const y=DerWriter.lengthBuffer.slice(0,m+1);y[0]=128|m;for(let v=8*(m-1),C=1;v>=0;v-=8,C++)y[C]=h>>v;return y}{const m=DerWriter.lengthBuffer.slice(0,1);return m[0]=h,m}}writeByte(h){this.ensureCapacity(this.position+1),this.buffer[this.position++]=h}writeBytes(h){this.ensureCapacity(this.position+h.length),h.copy(this.buffer,this.position),this.position+=h.length}ensureCapacity(h){if(this.buffer.length<h){let m=Math.max(512,2*this.buffer.length);for(;m<h;)m*=2;const y=v.Buffer.alloc(m);this.buffer.copy(y,0,0,this.position),this.buffer=y}}}m.DerWriter=DerWriter,DerWriter.lengthBuffer=v.Buffer.alloc(10)},function(h,m,y){var v=y(1068);h.exports={Ber:v,BerReader:v.Reader,BerWriter:v.Writer}},function(h,m){h.exports={newInvalidAsn1Error:function(h){var m=new Error;return m.name="InvalidAsn1Error",m.message=h||"",m}}},function(h,m){h.exports={EOC:0,Boolean:1,Integer:2,BitString:3,OctetString:4,Null:5,OID:6,ObjectDescriptor:7,External:8,Real:9,Enumeration:10,PDV:11,Utf8String:12,RelativeOID:13,Sequence:16,Set:17,NumericString:18,PrintableString:19,T61String:20,VideotexString:21,IA5String:22,UTCTime:23,GeneralizedTime:24,GraphicString:25,VisibleString:26,GeneralString:28,UniversalString:29,CharacterString:30,BMPString:31,Constructor:32,Context:128}},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0}),m.SshChannel=void 0;const v=y(48),C=y(6),T=y(100),w=y(76),A=y(55),P=y(442),k=y(77),R=y(49),M=y(256),N=y(443),D=y(78),I=y(129);class SshChannel{constructor(h,m,y,v,T,w){this.connectionService=h,this.channelType=m,this.remoteChannelId=y,this.remoteWindowSize=v,this.remoteMaxPacketSize=T,this.channelId=w,this.remoteClosed=!1,this.localClosed=!1,this.sentEof=!1,this.disposed=!1,this.openSendingWindowCompletionSource=null,this.requestCompletionSource=null,this.sendSemaphore=new I.Semaphore(0),this.metrics=new P.ChannelMetrics,this.dataReceivedEmitter=new C.Emitter,this.onDataReceived=this.dataReceivedEmitter.event,this.eofEmitter=new C.Emitter,this.onEof=this.eofEmitter.event,this.closedEmitter=new C.Emitter,this.onClosed=this.closedEmitter.event,this.requestEmitter=new C.Emitter,this.onRequest=this.requestEmitter.event,this.windowSize=SshChannel.initialWindowSize,this.maxPacketSize=SshChannel.dataPacketSize}get session(){return this.connectionService.session}get isClosed(){return this.localClosed||this.remoteClosed}async request(h,m){if(!h)throw new TypeError("Request is required.");if(this.disposed)throw new R.ObjectDisposedError(this);if(h.recipientChannel=this.remoteChannelId,!h.wantReply)return await this.session.sendMessage(h,m),!0;if(null!=this.requestCompletionSource)throw new Error("Another request is already pending.");const y=new k.PromiseCompletionSource;if(this.requestCompletionSource=y,m){if(m.isCancellationRequested)throw new D.CancellationError;m.onCancellationRequested(()=>{y.reject(new D.CancellationError)})}return await this.session.sendMessage(h,m),await y.promise}async send(h,m){if(this.disposed)throw new R.ObjectDisposedError(this);if(0!==h.length){if(this.sentEof)throw new Error("Cannot send more data after EOF.");await this.sendSemaphore.wait(m);try{let y=0,C=h.length;for(;C>0;){let T=Math.min(Math.min(this.remoteWindowSize,this.remoteMaxPacketSize),C);for(;0===T;)this.openSendingWindowCompletionSource||(this.openSendingWindowCompletionSource=new k.PromiseCompletionSource),(0,v.trace)(`${this} send window is full. Waiting for window adjustment before sending.`),await(0,D.withCancellation)(this.openSendingWindowCompletionSource.promise,m),this.openSendingWindowCompletionSource=null,T=Math.min(Math.min(this.remoteWindowSize,this.remoteMaxPacketSize),C);const A=new w.ChannelDataMessage;A.recipientChannel=this.remoteChannelId,A.data=Buffer.from(h.slice(y,y+T)),await this.session.sendMessage(A,m),this.remoteWindowSize-=T,C-=T,y+=T,this.metrics.addBytesSent(T)}}finally{this.sendSemaphore.tryRelease()}}else await this.sendEof()}enableSending(){this.sendSemaphore.tryRelease()}async sendEof(h){if(!this.sentEof){await this.sendSemaphore.wait(h);try{this.sentEof=!0;const m=new w.ChannelEofMessage;m.recipientChannel=this.remoteChannelId,await this.session.sendMessage(m,h)}finally{this.sendSemaphore.tryRelease()}}}async handleRequest(h,m){if(!h.requestType)throw new R.SshConnectionError("Channel request type not specified.",A.SshDisconnectReason.protocolError);if(h.requestType===w.ChannelRequestType.exitStatus){const m=new w.ChannelSignalMessage;return h.convertTo(m),this.exitStatus=m.exitStatus,!0}if(h.requestType===w.ChannelRequestType.exitSignal){const m=new w.ChannelSignalMessage;return h.convertTo(m),this.exitSignal=m.exitSignal,this.exitErrorMessage=m.errorMessage,!0}if(h.requestType===w.ChannelRequestType.signal){const m=new w.ChannelSignalMessage;h.convertTo(m)}const y=new M.SshRequestEventArgs(h.requestType,h,this.session.principal),v=(0,T.findService)(this.session.config.services,m=>(!m.channelType||m.channelType===this.channelType)&&m.channelRequest===h.requestType);await this.sendSemaphore.wait(m);try{if(v){const h=this.session.activateService(v);await h.onChannelRequest(this,y,m)}else this.requestEmitter.fire(y);if(h.wantReply){let h;if(y.isAuthorized){const m=new w.ChannelSuccessMessage;m.recipientChannel=this.remoteChannelId,h=m}else{const m=new w.ChannelFailureMessage;m.recipientChannel=this.remoteChannelId,h=m}await this.session.sendMessage(h,m)}}finally{this.sendSemaphore.tryRelease()}return y.isAuthorized||!1}handleResponse(h){this.requestCompletionSource&&(this.requestCompletionSource.resolve(h),this.requestCompletionSource=null)}handleDataReceived(h){this.metrics.addBytesReceived(h.length),this.dataReceivedEmitter.fire(h)}adjustWindow(h){if(!this.disposed&&(this.windowSize-=h,this.windowSize<=this.maxPacketSize)){const h=new w.ChannelWindowAdjustMessage;h.recipientChannel=this.remoteChannelId,h.bytesToAdd=SshChannel.initialWindowSize-this.windowSize,this.windowSize=SshChannel.initialWindowSize,this.session.sendMessage(h).catch(h=>{(0,v.trace)(`Error sending window adjust message: ${h.message||JSON.stringify(h)}`)})}}adjustRemoteWindow(h){this.remoteWindowSize+=h,this.openSendingWindowCompletionSource&&this.openSendingWindowCompletionSource.resolve(void 0)}handleEof(){(0,v.trace)(`${this} EOF received.`),this.eofEmitter.fire()}close(h,m,y){if(h instanceof Error){const m=h;return this.localClosed||(this.localClosed=!0,(0,v.trace)(`${this} Closed: ${m.message}`),this.closedEmitter.fire(new N.SshChannelClosedEventArgs(m))),void this.disposeInternal()}return"number"==typeof h?this.closeWithStatus(h,m):"string"==typeof h?this.closeWithSignal(h,m,y):this.closeDefault(h)}async closeDefault(h){var m;if(!this.remoteClosed&&!this.localClosed){this.remoteClosed=!0,await this.sendSemaphore.wait(h);try{const h=new w.ChannelCloseMessage;h.recipientChannel=this.remoteChannelId,await this.session.sendMessage(h)}catch(h){}finally{this.sendSemaphore.tryRelease()}}if(!this.localClosed){this.localClosed=!0;const h=this.raiseClosedEvent();null===(m=this.requestCompletionSource)||void 0===m||m.reject(new R.SshChannelError(h))}this.disposeInternal()}async closeWithStatus(h,m){if(!this.remoteClosed&&!this.localClosed){this.exitStatus=h;const m=new w.ChannelSignalMessage;m.recipientChannel=this.remoteChannelId,m.exitStatus=h,await this.session.sendMessage(m)}await this.closeDefault(m)}async closeWithSignal(h,m,y){if(!this.remoteClosed&&!this.localClosed){this.exitSignal=h,this.exitErrorMessage=m;const y=new w.ChannelSignalMessage;y.recipientChannel=this.remoteChannelId,y.exitSignal=h,y.errorMessage=m,await this.session.sendMessage(y)}await this.closeDefault(y)}handleClose(){var h;if(!this.localClosed){this.localClosed=!0;const m=this.raiseClosedEvent(!0);null===(h=this.requestCompletionSource)||void 0===h||h.reject(new R.SshChannelError(m))}this.disposeInternal()}raiseClosedEvent(h=!1){const m=` (S: ${this.metrics.bytesSent}, R: ${this.metrics.bytesReceived})`,y=h?"remotely":"locally";let C,T;return void 0!==this.exitStatus?(T=new N.SshChannelClosedEventArgs(this.exitStatus),C=`${this} closed ${y}: status=${this.exitStatus}`):void 0!==this.exitSignal?(T=new N.SshChannelClosedEventArgs(this.exitSignal,this.exitErrorMessage),C=`${this} closed ${y}: signal=${this.exitSignal} ${this.exitErrorMessage}`):(T=new N.SshChannelClosedEventArgs,C=`${this} closed ${y}.`),(0,v.trace)(C+m),this.closedEmitter.fire(T),C}dispose(){var h;if(!this.disposed&&!this.localClosed){if(!this.remoteClosed){this.remoteClosed=!0;const h=new w.ChannelCloseMessage;h.recipientChannel=this.remoteChannelId,this.session.sendMessage(h).catch(h=>{})}const m=this.session.isClosed?`${this.session} closed.`:`${this} disposed.`;(0,v.trace)(m);const y=new N.SshChannelClosedEventArgs("SIGABRT",m);this.localClosed=!0,this.closedEmitter.fire(y),null===(h=this.requestCompletionSource)||void 0===h||h.reject(new R.SshChannelError(m))}this.disposeInternal()}disposeInternal(){var h;this.disposed||(this.disposed=!0,null===(h=this.requestCompletionSource)||void 0===h||h.reject(new R.ObjectDisposedError(this)),this.connectionService._removeChannel(this),this.sendSemaphore.dispose())}toString(){return`SshChannel(Type: ${this.channelType}, Id: ${this.channelId}, RemoteId: ${this.remoteChannelId})`}}m.SshChannel=SshChannel,SshChannel.sessionChannelType="session",SshChannel.dataPacketSize=32768,SshChannel.initialWindowSize=32*SshChannel.dataPacketSize},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0}),m.SshRequestEventArgs=void 0;m.SshRequestEventArgs=class SshRequestEventArgs{constructor(h,m,y){this.requestType=h,this.request=m,this.principal=y}toString(){return`RequestType: ${this.requestType}`+this.request?` Request: ${this.request}`:""}}},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0}),m.NewKeysMessage=m.KeyExchangeDhReplyMessage=m.KeyExchangeDhInitMessage=m.KeyExchangeInitMessage=m.KeyExchangeMessage=void 0;const v=y(9),C=y(101),T=y(98);class KeyExchangeMessage extends C.SshMessage{}m.KeyExchangeMessage=KeyExchangeMessage;class KeyExchangeInitMessage extends KeyExchangeMessage{get messageType(){return 20}onRead(h){this.cookie=h.read(16),this.keyExchangeAlgorithms=h.readList("ascii"),this.serverHostKeyAlgorithms=h.readList("ascii"),this.encryptionAlgorithmsClientToServer=h.readList("ascii"),this.encryptionAlgorithmsServerToClient=h.readList("ascii"),this.macAlgorithmsClientToServer=h.readList("ascii"),this.macAlgorithmsServerToClient=h.readList("ascii"),this.compressionAlgorithmsClientToServer=h.readList("ascii"),this.compressionAlgorithmsServerToClient=h.readList("ascii"),this.languagesClientToServer=h.readList("ascii"),this.languagesServerToClient=h.readList("ascii"),this.firstKexPacketFollows=h.readBoolean(),this.reserved=h.readUInt32()}onWrite(h){this.cookie||(this.cookie=v.Buffer.alloc(16),T.SshAlgorithms.random.getBytes(this.cookie)),h.write(this.cookie),h.writeList(this.keyExchangeAlgorithms||[],"ascii"),h.writeList(this.serverHostKeyAlgorithms||[],"ascii"),h.writeList(this.encryptionAlgorithmsClientToServer||[],"ascii"),h.writeList(this.encryptionAlgorithmsServerToClient||[],"ascii"),h.writeList(this.macAlgorithmsClientToServer||[],"ascii"),h.writeList(this.macAlgorithmsServerToClient||[],"ascii"),h.writeList(this.compressionAlgorithmsClientToServer||[],"ascii"),h.writeList(this.compressionAlgorithmsServerToClient||[],"ascii"),h.writeList(this.languagesClientToServer||[],"ascii"),h.writeList(this.languagesServerToClient||[],"ascii"),h.writeBoolean(this.validateField(this.firstKexPacketFollows,"first KEX package follows")),h.writeUInt32(this.reserved||0)}}m.KeyExchangeInitMessage=KeyExchangeInitMessage;class KeyExchangeDhInitMessage extends KeyExchangeMessage{get messageType(){return 30}onRead(h){this.e=h.readBinary()}onWrite(h){h.writeBinary(this.validateField(this.e,"E"))}}m.KeyExchangeDhInitMessage=KeyExchangeDhInitMessage;class KeyExchangeDhReplyMessage extends KeyExchangeMessage{get messageType(){return 31}onRead(h){this.hostKey=h.readBinary(),this.f=h.readBinary(),this.signature=h.readBinary()}onWrite(h){h.writeBinary(this.validateField(this.hostKey,"host key")),h.writeBinary(this.validateField(this.f,"F")),h.writeBinary(this.validateField(this.signature,"signature"))}}m.KeyExchangeDhReplyMessage=KeyExchangeDhReplyMessage;class NewKeysMessage extends KeyExchangeMessage{get messageType(){return 21}onRead(h){}onWrite(h){}}m.NewKeysMessage=NewKeysMessage,C.SshMessage.index.set(20,KeyExchangeInitMessage),C.SshMessage.index.set(30,KeyExchangeDhInitMessage),C.SshMessage.index.set(31,KeyExchangeDhReplyMessage),C.SshMessage.index.set(21,NewKeysMessage)},function(h,m,y){"use strict";var v,C=this&&this.__decorate||function(h,m,y,v){var C,T=arguments.length,w=T<3?m:null===v?v=Object.getOwnPropertyDescriptor(m,y):v;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)w=Reflect.decorate(h,m,y,v);else for(var A=h.length-1;A>=0;A--)(C=h[A])&&(w=(T<3?C(w):T>3?C(m,y,w):C(m,y))||w);return T>3&&w&&Object.defineProperty(m,y,w),w};Object.defineProperty(m,"__esModule",{value:!0}),m.AuthenticationService=void 0;const T=y(48),w=y(177),A=y(446),P=y(6),k=y(38),R=y(55),M=y(259),N=y(130),D=y(100),I=y(176);let x=v=class AuthenticationService extends w.SshService{constructor(h){var m;super(h),this.authenticationFailureCount=0,this.disposeCancellationSource=new P.CancellationTokenSource;const y=null===(m=h.algorithms)||void 0===m?void 0:m.publicKeyAlgorithmName;if(!y)throw new Error("Algorithms not initialized.");this.publicKeyAlgorithmName=y}handleMessage(h,m){if(h instanceof A.AuthenticationSuccessMessage)return this.handleSuccessMessage(h);if(h instanceof A.AuthenticationFailureMessage)return this.handleFailureMessage(h);if(h instanceof A.AuthenticationRequestMessage)return this.handleAuthenticationRequestMessage(h,m);throw new Error(`Message not implemented: ${h}`)}async handleAuthenticationRequestMessage(h,m){if((0,T.trace)(`Authentication request: ${h.methodName}`),"publickey"===h.methodName||"hostbased"===h.methodName)return this.handlePublicKeyRequestMessage(h.convertTo(new A.PublicKeyRequestMessage),m);if("password"===h.methodName)return this.handlePasswordRequestMessage(h.convertTo(new A.PasswordRequestMessage),m);if("none"===h.methodName)return this.handleAuthenticating(h,new M.SshAuthenticatingEventArgs(M.SshAuthenticationType.clientNone,{username:h.username},m));{const h=new A.AuthenticationFailureMessage;h.methodNames=["publickey","password","hostbased"],await this.session.sendMessage(h,m)}}async handlePublicKeyRequestMessage(h,m){var y,v,C;const T=this.session.config.getPublicKeyAlgorithm(h.keyAlgorithmName);if(!T){const h=new A.AuthenticationFailureMessage;return h.methodNames=["publickey","password"],void await this.session.sendMessage(h,m)}const w=T.createKeyPair();let P;if(await w.setPublicKeyBytes(h.publicKey),"hostbased"===h.methodName)P=new M.SshAuthenticatingEventArgs(M.SshAuthenticationType.clientHostBased,{username:null!==(y=h.username)&&void 0!==y?y:"",publicKey:w,clientHostname:h.clientHostname,clientUsername:h.clientUsername});else if(h.hasSignature){const y=T.readSignatureData(h.signature),v=this.session.sessionId;if(null==v)throw new Error("Session ID not initialized.");const A=new k.SshDataWriter(Buffer.alloc(v.length+h.payloadWithoutSignature.length+20));A.writeBinary(v),A.write(h.payloadWithoutSignature);const R=A.toBuffer(),N=T.createVerifier(w);await N.verify(R,y)||await this.handleAuthenticationFailure("Public key authentication failed: invalid signature.",m),P=new M.SshAuthenticatingEventArgs(M.SshAuthenticationType.clientPublicKey,{username:null!==(C=h.username)&&void 0!==C?C:"",publicKey:w})}else P=new M.SshAuthenticatingEventArgs(M.SshAuthenticationType.clientPublicKeyQuery,{username:null!==(v=h.username)&&void 0!==v?v:"",publicKey:w});await this.handleAuthenticating(h,P,m)}async handlePasswordRequestMessage(h,m){var y,v;const C=new M.SshAuthenticatingEventArgs(M.SshAuthenticationType.clientPassword,{username:null!==(y=h.username)&&void 0!==y?y:"",password:null!==(v=h.password)&&void 0!==v?v:""});await this.handleAuthenticating(h,C,m)}async handleAuthenticating(h,m,y){var v;let C=null;try{C=await this.session.raiseAuthenticatingEvent(m)}catch(h){if(!(h instanceof Error))throw h;(0,T.trace)("Error while authenticating client: "+(null!==(v=h.message)&&void 0!==v?v:h)),C=null}if(C)if(m.authenticationType===M.SshAuthenticationType.clientPublicKeyQuery){const m=h,v=new A.PublicKeyOKMessage;v.keyAlgorithmName=m.keyAlgorithmName,v.publicKey=m.publicKey,await this.session.sendMessage(v,y)}else this.session.principal=C,h.serviceName&&this.session.activateService(h.serviceName),(0,T.trace)(`${M.SshAuthenticationType[m.authenticationType]} authentication succeeded.`),await this.session.sendMessage(new A.AuthenticationSuccessMessage,y);else await this.handleAuthenticationFailure(`${M.SshAuthenticationType[m.authenticationType]} authentication failed.`)}async handleAuthenticationFailure(h,m){this.authenticationFailureCount++,(0,T.trace)(h);const y=new A.AuthenticationFailureMessage;y.methodNames=["publickey","password","hostbased"],await this.session.sendMessage(y,m),this.authenticationFailureCount>=this.session.config.maxClientAuthenticationAttempts&&await this.session.close(R.SshDisconnectReason.noMoreAuthMethodsAvailable,"Authentication failed.")}async authenticateClient(h,m){var y,v,C,T;this.clientAuthenticationMethods=new I.Queue;for(let m of null!==(y=h.publicKeys)&&void 0!==y?y:[]){if(!m)continue;const y=null!==(v=h.username)&&void 0!==v?v:"";let C=m;const T=h.privateKeyProvider;this.clientAuthenticationMethods.enqueue(async h=>{if(!C.hasPrivateKey){if(null==T)throw new Error("A private key provider is required.");C=await T(m,null!=h?h:P.CancellationToken.None)}C?await this.requestPublicKeyAuthentication(y,C,h):await this.session.close(R.SshDisconnectReason.authCancelledByUser)})}const w=h.passwordProvider;if(w)this.clientAuthenticationMethods.enqueue(async h=>{var m;const y=w(null!=h?h:P.CancellationToken.None),v=y?await y:null;v?await this.requestPasswordAuthentication(null!==(m=v[0])&&void 0!==m?m:"",v[1],h):await this.session.close(R.SshDisconnectReason.authCancelledByUser)});else if(h.password){const m=null!==(C=h.username)&&void 0!==C?C:"",y=h.password;this.clientAuthenticationMethods.enqueue(async h=>{await this.requestPasswordAuthentication(m,y,h)})}if(0===this.clientAuthenticationMethods.size){const m=null!==(T=h.username)&&void 0!==T?T:"";this.clientAuthenticationMethods.enqueue(async h=>{await this.requestUsernameAuthentication(m,h)})}const A=this.clientAuthenticationMethods.dequeue();await A(m)}async requestUsernameAuthentication(h,m){const y=new A.AuthenticationRequestMessage;y.serviceName=N.ConnectionService.serviceName,y.methodName="none",y.username=h,await this.session.sendMessage(y,m),this.session.activateService(N.ConnectionService)}async requestPublicKeyAuthentication(h,m,y){const v=this.session.config.publicKeyAlgorithms.find(h=>(null==h?void 0:h.keyAlgorithmName)===m.keyAlgorithmName);if(!v)throw new Error(`Public key algorithm '${m.keyAlgorithmName}' is not in session config.`);const C=new A.PublicKeyRequestMessage;C.serviceName=N.ConnectionService.serviceName,C.username=h,C.keyAlgorithmName=v.name,C.publicKey=await m.getPublicKeyBytes(v.name),C.signature=await this.createAuthenticationSignature(C,v,m),await this.session.sendMessage(C,y),0===this.clientAuthenticationMethods.size&&this.session.activateService(N.ConnectionService)}async requestPasswordAuthentication(h,m,y){const v=new A.PasswordRequestMessage;v.serviceName=N.ConnectionService.serviceName,v.username=h,v.password=m,await this.session.sendMessage(v,y),this.session.activateService(N.ConnectionService)}handleFailureMessage(h){this.session.onAuthenticationComplete(!1)}handleSuccessMessage(h){this.session.activateService(N.ConnectionService),this.session.onAuthenticationComplete(!0)}async createAuthenticationSignature(h,m,y){const v=this.session.sessionId;if(null==v)throw new Error("Session ID not initialized.");const C=new k.SshDataWriter(Buffer.alloc(h.publicKey.length+(h.username||"").length+400));C.writeBinary(v),C.writeByte(h.messageType),C.writeString(h.username||"","utf8"),C.writeString(h.serviceName||"","ascii"),C.writeString("publickey","ascii"),C.writeBoolean(!0),C.writeString(h.keyAlgorithmName,"ascii"),C.writeBinary(h.publicKey);const T=m.createSigner(y),w=await T.sign(C.toBuffer());return m.createSignatureData(w)}};x.serviceName="ssh-userauth",x=v=C([(0,D.serviceActivation)({serviceRequest:v.serviceName})],x),m.AuthenticationService=x},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0}),m.SshAuthenticatingEventArgs=m.SshAuthenticationType=void 0;const v=y(6);var C;!function(h){h[h.clientNone=0]="clientNone",h[h.clientHostBased=1]="clientHostBased",h[h.clientPassword=2]="clientPassword",h[h.clientPublicKeyQuery=3]="clientPublicKeyQuery",h[h.clientPublicKey=4]="clientPublicKey",h[h.serverPublicKey=10]="serverPublicKey"}(C=m.SshAuthenticationType||(m.SshAuthenticationType={}));m.SshAuthenticatingEventArgs=class SshAuthenticatingEventArgs{constructor(h,{username:m,password:y,publicKey:T,clientHostname:w,clientUsername:A},P){this.authenticationType=h;const validate=({usernameRequired:h,passwordRequired:v,publicKeyRequired:C,clientHostnameRequired:P,clientUsernameRequired:k})=>"string"==typeof m==!!h&&("string"==typeof y==!!v&&(!!T==!!C&&("string"==typeof w==!!P&&"string"==typeof A==!!k)));let k;switch(h){case C.clientNone:k=validate({usernameRequired:!0});break;case C.clientHostBased:k=validate({usernameRequired:!0,publicKeyRequired:!0,clientHostnameRequired:!0,clientUsernameRequired:!0});break;case C.clientPassword:k=validate({usernameRequired:!0,passwordRequired:!0});break;case C.clientPublicKeyQuery:case C.clientPublicKey:k=validate({usernameRequired:!0,publicKeyRequired:!0});break;case C.serverPublicKey:k=validate({publicKeyRequired:!0});break;default:throw new Error(`Invalid authentication type: ${h}`)}if(!k)throw new Error(`Invalid arguments for authentication type: ${h}`);this.username=null!=m?m:null,this.password=null!=y?y:null,this.publicKey=null!=T?T:null,this.clientHostname=null!=w?w:null,this.clientUsername=null!=A?A:null,this.cancellationValue=null!=P?P:v.CancellationToken.None}get cancellation(){return this.cancellationValue}set cancellation(h){this.cancellationValue=h}toString(){return this.password?`${this.username?'"'+this.username+'" ':""}[password]`:this.publicKey?`${this.username?'"'+this.username+'" ':""}[${this.publicKey.keyAlgorithmName}]`:`"${this.username}"`}}},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0}),function(h){h[h.Initializing=0]="Initializing",h[h.SignedOut=1]="SignedOut",h[h.SigningIn=2]="SigningIn",h[h.ExternallySigningIn=3]="ExternallySigningIn",h[h.SignedIn=4]="SignedIn",h[h.SharingInProgress=5]="SharingInProgress",h[h.Shared=6]="Shared",h[h.JoiningInProgress=7]="JoiningInProgress",h[h.Joined=8]="Joined"}(m.SessionState||(m.SessionState={})),function(h){h[h.AttemptSharing=0]="AttemptSharing",h[h.SharingError=1]="SharingError",h[h.SharingSuccess=2]="SharingSuccess",h[h.EndSharing=3]="EndSharing",h[h.Unjoin=4]="Unjoin",h[h.AttemptJoining=5]="AttemptJoining",h[h.JoiningError=6]="JoiningError",h[h.JoiningPendingReload=7]="JoiningPendingReload",h[h.JoiningSuccess=8]="JoiningSuccess",h[h.AttemptSignIn=9]="AttemptSignIn",h[h.AwaitExternalSignIn=10]="AwaitExternalSignIn",h[h.SignInError=11]="SignInError",h[h.SignInSuccess=12]="SignInSuccess",h[h.SignOut=13]="SignOut",h[h.Create=14]="Create"}(m.SessionAction||(m.SessionAction={})),function(h){h[h.EnvironmentReadyForFileOperation=0]="EnvironmentReadyForFileOperation",h[h.JoiningCompleted=1]="JoiningCompleted"}(m.SessionPromise||(m.SessionPromise={}))},function(h,m,y){"use strict";var v=this&&this.__awaiter||function(h,m,y,v){return new(y||(y=Promise))((function(C,T){function fulfilled(h){try{step(v.next(h))}catch(h){T(h)}}function rejected(h){try{step(v.throw(h))}catch(h){T(h)}}function step(h){h.done?C(h.value):function adopt(h){return h instanceof y?h:new y((function(m){m(h)}))}(h.value).then(fulfilled,rejected)}step((v=v.apply(h,m||[])).next())}))};Object.defineProperty(m,"__esModule",{value:!0});const C=y(0),T=y(71),w=y(14),A=y(12),P=y(64);m.getLabelAndLinkTreeViewItems=function getLabelAndLinkTreeViewItems(h){return v(this,void 0,void 0,(function*(){const m=A.Settings.get(w.SettingKeys.remoteLabelAndLinks)||[],y=[];return(A.Settings.isInsidersFeatureSet||A.Settings.isInternalFeatureSet)&&A.Settings.get(w.SettingKeys.sessionCount)>=5&&m.filter(m=>m.location===h).forEach(h=>{y.push(new T.TreeViewItem({type:P.ViewItem.Other,collapsibleState:C.TreeItemCollapsibleState.None,label:h.label,command:{title:h.label,command:"liveshare.openLink",arguments:[h.link]}}))}),y}))}},function(h,m,y){"use strict";var v=this&&this.__awaiter||function(h,m,y,v){return new(y||(y=Promise))((function(C,T){function fulfilled(h){try{step(v.next(h))}catch(h){T(h)}}function rejected(h){try{step(v.throw(h))}catch(h){T(h)}}function step(h){h.done?C(h.value):function adopt(h){return h instanceof y?h:new y((function(m){m(h)}))}(h.value).then(fulfilled,rejected)}step((v=v.apply(h,m||[])).next())}))};Object.defineProperty(m,"__esModule",{value:!0});const C=y(70),T=y(2),w=y(6),A=y(34),P=y(23);m.sessionStateTransitionsCommandDecorator=function sessionStateTransitionsCommandDecorator(h,m,y,v){return A.DecoratorHelper.setupDecorator(T=>new SessionStateTransitionsCommandDecorator(A.DecoratorHelper.getCoreCommand(T),T,C.dependencies.sessionContext(),v,h,m,y))};class SessionStateTransitionsCommandDecorator{constructor(h,m,y,v,C,T,w){this.command=h,this.next=m,this.sessionContext=y,this.validateSessionAction=v,this.statusStart=C,this.statusComplete=T,this.statusCompleteError=w}invoke(h,m){return v(this,void 0,void 0,(function*(){let y=void 0;SessionStateTransitionsCommandDecorator.count++;try{void 0!==this.statusStart&&this.shouldPerformSessionAction(h)&&P.sessionStateTracker.transition(this.statusStart),y=yield this.next.invoke(h,m),void 0!==this.statusComplete&&this.shouldPerformSessionAction(h)&&P.sessionStateTracker.transition(this.statusComplete)}catch(m){const y=m instanceof T.CancellationError||m.code===w.ErrorCodes.RequestCancelled;if(1!==SessionStateTransitionsCommandDecorator.count&&y)return;throw this.shouldPerformSessionAction(h)&&P.sessionStateTracker.transition(this.statusCompleteError),m}finally{SessionStateTransitionsCommandDecorator.count--}return y}))}shouldPerformSessionAction(h){return!this.validateSessionAction||this.validateSessionAction(h)}}m.SessionStateTransitionsCommandDecorator=SessionStateTransitionsCommandDecorator,SessionStateTransitionsCommandDecorator.count=0},function(h,m,y){"use strict";var v=this&&this.__awaiter||function(h,m,y,v){return new(y||(y=Promise))((function(C,T){function fulfilled(h){try{step(v.next(h))}catch(h){T(h)}}function rejected(h){try{step(v.throw(h))}catch(h){T(h)}}function step(h){h.done?C(h.value):function adopt(h){return h instanceof y?h:new y((function(m){m(h)}))}(h.value).then(fulfilled,rejected)}step((v=v.apply(h,m||[])).next())}))};Object.defineProperty(m,"__esModule",{value:!0});const C=y(34);m.validationCommandDecorator=function validationCommandDecorator(){return C.DecoratorHelper.setupDecorator(h=>new ValidationCommandDecorator(C.DecoratorHelper.getCoreCommand(h),h))};class ValidationCommandDecorator{constructor(h,m){this.command=h,this.next=m}invoke(h,m){return v(this,void 0,void 0,(function*(){let y=void 0,v=this.command;return v.validate&&(yield v.validate(h,m)),y=yield this.next.invoke(h,m),y}))}}m.ValidationCommandDecorator=ValidationCommandDecorator},function(h,m,y){"use strict";var v=this&&this.__awaiter||function(h,m,y,v){return new(y||(y=Promise))((function(C,T){function fulfilled(h){try{step(v.next(h))}catch(h){T(h)}}function rejected(h){try{step(v.throw(h))}catch(h){T(h)}}function step(h){h.done?C(h.value):function adopt(h){return h instanceof y?h:new y((function(m){m(h)}))}(h.value).then(fulfilled,rejected)}step((v=v.apply(h,m||[])).next())}))};Object.defineProperty(m,"__esModule",{value:!0});const C=y(5),T=y(465);class LiveShareCommandBase extends C.CommandBase{constructor(){super(...arguments),this.postSetupManagers=[]}invoke(h,m){return v(this,void 0,void 0,(function*(){return!0}))}invokePostSetupManagers(h,m){return T.initDisposableManager(null!=h?h:this.postSetupManagers,m)}}m.LiveShareCommandBase=LiveShareCommandBase},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0});const v=y(65);class ConnectionCancellationError extends v.ConnectionError{constructor(){super(...arguments),this.errorType="ConnectionCancellationError"}}m.ConnectionCancellationError=ConnectionCancellationError},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0});const v=y(65);class ConnectionTimeoutError extends v.ConnectionError{constructor(){super(...arguments),this.errorType="ConnectionTimeoutError"}}m.ConnectionTimeoutError=ConnectionTimeoutError},function(h,m,y){"use strict";var v=this&&this.__awaiter||function(h,m,y,v){return new(y||(y=Promise))((function(C,T){function fulfilled(h){try{step(v.next(h))}catch(h){T(h)}}function rejected(h){try{step(v.throw(h))}catch(h){T(h)}}function step(h){h.done?C(h.value):function adopt(h){return h instanceof y?h:new y((function(m){m(h)}))}(h.value).then(fulfilled,rejected)}step((v=v.apply(h,m||[])).next())}))};Object.defineProperty(m,"__esModule",{value:!0});const C=y(2),T=y(4),w=y(39),A=y(182),P=y(479),k=y(65),R=y(133),M=y(269),N=y(134);class LiveShareConnection extends R.Connection{constructor(h,m,y){super(h.createChild("liveshare"),m),this.performance=m,this.options=y}getId(h){const{workspaceId:m}=h;return m}get type(){return P.TConnectionTypes.MainThread}get workspaceClient(){return C.assertDefined(this.workspaceClientReference,"No `WorkspaceClient` found."),this.workspaceClientReference}getRpcService(h){return this.workspaceClient.getServiceProxy(h)}dispose(h){super.dispose(h),this.workspaceClientReference=void 0,this.workspaceSessionInfoReference=void 0}get workspaceSessionInfo(){return this.workspaceSessionInfoReference}createWorkspaceClient(){return v(this,void 0,void 0,(function*(){return new A.WorkspaceClient(this.trace.createChild("WorkspaceClient"),void 0,{enabled:!0,retryTimeout:.25*C.TIME_SECOND_MS,maxTimeReconnect:10*C.TIME_SECOND_MS})}))}setWorkspaceSessionInfo(h){this.workspaceSessionInfoReference=h}createConnection(){return v(this,void 0,void 0,(function*(){try{this.initializeConnection(),this.trace.info("creating workspace client",this.options);const h=yield this.createWorkspaceClient();this.addToDisposables({dispose:()=>{h.dispose("Disposed from LiveShareConnection")}});const m=yield this.performance.measure({id:M.PerformanceEventIds.LiveshareJoinWorkspace,name:"join LiveShare session"},()=>v(this,void 0,void 0,(function*(){return yield h.join(Object.assign(Object.assign({},this.options),{performance:this.performance.createGroup(`${this.trace.name}:${this.options.workspaceId}`),checkConnectionOptions:{enabled:!0}}))})));return this.workspaceClientReference=h,this.setWorkspaceSessionInfo(m),this.trace.info("LS session joined and authenticated"),yield this.performance.measure({name:"create workspace service"},()=>v(this,void 0,void 0,(function*(){const m=h.getServiceProxy(T.vsls.WorkspaceService);C.assertDefined(m,"WorkspaceService not set."),yield h.rpcClient.onClose(()=>{this.onConnectionChangedHandler("disconnected",new k.ConnectionError("RPC client closed."))}),this.addToDisposables(m.onConnectionStatusChanged(h=>{h.connectionStatus===T.vsls.WorkspaceConnectionStatus.Disconnected&&this.onConnectionChangedHandler("disconnected",new k.ConnectionError(`Workspace service disconnected with status: "${h.disconnectedReason}".`))}))}))),this.onConnectionChangedHandler("connected"),h.onHostConnectionChanged(h=>{this.trace.info(`host connection changed to "${w.ConnectedState[h.state]}"`),h.state===w.ConnectedState.Reconnecting?this.initializeConnection():h.state===w.ConnectedState.Reconnected?this.onConnectionChangedHandler("connected"):h.state===w.ConnectedState.Closed&&this.onConnectionChangedHandler("disconnected")}),this}catch(h){throw this.handleConnectionError(h),N.errorToConnectionError(h)}}))}}m.LiveShareConnection=LiveShareConnection},function(h,m,y){var v=y(10),C=y(79),T=y(13).EventEmitter,w=y(474),A=y(1152),P=y(1153),k=C.bufferAllocUnsafe,R=C.bufferFromString;var M="setImmediate"in global?global.setImmediate.bind(global):process.nextTick.bind(process),N=0;function WebSocketConnection(h,m,y,v,P){if(this._debug=C.BufferingLogger("websocket:connection",++N),this._debug("constructor"),this._debug.enabled&&function instrumentSocketForDebugging(h,m){if(!h._debug.enabled)return;var y=m.emit;for(var v in m.emit=function(m){h._debug("||| Socket Event  '%s'",m),y.apply(this,arguments)},m)"function"==typeof m[v]&&-1===["emit"].indexOf(v)&&function(y){var v=m[y];m[y]="on"!==y?function proxyMethod(){return h._debug("||| Socket method called:  %s",y),v.apply(this,arguments)}:function proxyMethod__EventEmitter__On(){return h._debug("||| Socket method called:  %s (%s)",y,arguments[0]),v.apply(this,arguments)}}(v)}(this,h),T.call(this),this._pingListenerCount=0,this.on("newListener",(function(h){"ping"===h&&this._pingListenerCount++})).on("removeListener",(function(h){"ping"===h&&this._pingListenerCount--})),this.config=P,this.socket=h,this.protocol=y,this.extensions=m,this.remoteAddress=h.remoteAddress,this.closeReasonCode=-1,this.closeDescription=null,this.closeEventEmitted=!1,this.maskOutgoingPackets=v,this.maskBytes=k(4),this.frameHeader=k(10),this.bufferList=new A,this.currentFrame=new w(this.maskBytes,this.frameHeader,this.config),this.fragmentationSize=0,this.frameQueue=[],this.connected=!0,this.state="open",this.waitingForCloseResponse=!1,this.receivedEnd=!1,this.closeTimeout=this.config.closeTimeout,this.assembleFragments=this.config.assembleFragments,this.maxReceivedMessageSize=this.config.maxReceivedMessageSize,this.outputBufferFull=!1,this.inputPaused=!1,this.receivedDataHandler=this.processReceivedData.bind(this),this._closeTimerHandler=this.handleCloseTimer.bind(this),this.socket.setNoDelay(this.config.disableNagleAlgorithm),this.socket.setTimeout(0),this.config.keepalive&&!this.config.useNativeKeepalive){if("number"!=typeof this.config.keepaliveInterval)throw new Error("keepaliveInterval must be specified and numeric if keepalive is true.");if(this._keepaliveTimerHandler=this.handleKeepaliveTimer.bind(this),this.setKeepaliveTimer(),this.config.dropConnectionOnKeepaliveTimeout){if("number"!=typeof this.config.keepaliveGracePeriod)throw new Error("keepaliveGracePeriod  must be specified and numeric if dropConnectionOnKeepaliveTimeout is true.");this._gracePeriodTimerHandler=this.handleGracePeriodTimer.bind(this)}}else if(this.config.keepalive&&this.config.useNativeKeepalive){if(!("setKeepAlive"in this.socket))throw new Error("Unable to use native keepalive: unsupported by this version of Node.");this.socket.setKeepAlive(!0,this.config.keepaliveInterval)}this.socket.removeAllListeners("error")}function validateCloseReason(h){return!(h<1e3)&&(h>=1e3&&h<=2999?-1!==[1e3,1001,1002,1003,1007,1008,1009,1010,1011,1012,1013,1014,1015].indexOf(h):h>=3e3&&h<=3999||(h>=4e3&&h<=4999||!(h>=5e3)&&void 0))}WebSocketConnection.CLOSE_REASON_NORMAL=1e3,WebSocketConnection.CLOSE_REASON_GOING_AWAY=1001,WebSocketConnection.CLOSE_REASON_PROTOCOL_ERROR=1002,WebSocketConnection.CLOSE_REASON_UNPROCESSABLE_INPUT=1003,WebSocketConnection.CLOSE_REASON_RESERVED=1004,WebSocketConnection.CLOSE_REASON_NOT_PROVIDED=1005,WebSocketConnection.CLOSE_REASON_ABNORMAL=1006,WebSocketConnection.CLOSE_REASON_INVALID_DATA=1007,WebSocketConnection.CLOSE_REASON_POLICY_VIOLATION=1008,WebSocketConnection.CLOSE_REASON_MESSAGE_TOO_BIG=1009,WebSocketConnection.CLOSE_REASON_EXTENSION_REQUIRED=1010,WebSocketConnection.CLOSE_REASON_INTERNAL_SERVER_ERROR=1011,WebSocketConnection.CLOSE_REASON_TLS_HANDSHAKE_FAILED=1015,WebSocketConnection.CLOSE_DESCRIPTIONS={1e3:"Normal connection closure",1001:"Remote peer is going away",1002:"Protocol error",1003:"Unprocessable input",1004:"Reserved",1005:"Reason not provided",1006:"Abnormal closure, no further detail available",1007:"Invalid data received",1008:"Policy violation",1009:"Message too big",1010:"Extension requested by client is required",1011:"Internal Server Error",1015:"TLS Handshake Failed"},v.inherits(WebSocketConnection,T),WebSocketConnection.prototype._addSocketEventListeners=function(){this.socket.on("error",this.handleSocketError.bind(this)),this.socket.on("end",this.handleSocketEnd.bind(this)),this.socket.on("close",this.handleSocketClose.bind(this)),this.socket.on("drain",this.handleSocketDrain.bind(this)),this.socket.on("pause",this.handleSocketPause.bind(this)),this.socket.on("resume",this.handleSocketResume.bind(this)),this.socket.on("data",this.handleSocketData.bind(this))},WebSocketConnection.prototype.setKeepaliveTimer=function(){this._debug("setKeepaliveTimer"),this.config.keepalive&&!this.config.useNativeKeepalive&&(this.clearKeepaliveTimer(),this.clearGracePeriodTimer(),this._keepaliveTimeoutID=setTimeout(this._keepaliveTimerHandler,this.config.keepaliveInterval))},WebSocketConnection.prototype.clearKeepaliveTimer=function(){this._keepaliveTimeoutID&&clearTimeout(this._keepaliveTimeoutID)},WebSocketConnection.prototype.handleKeepaliveTimer=function(){this._debug("handleKeepaliveTimer"),this._keepaliveTimeoutID=null,this.ping(),this.config.dropConnectionOnKeepaliveTimeout?this.setGracePeriodTimer():this.setKeepaliveTimer()},WebSocketConnection.prototype.setGracePeriodTimer=function(){this._debug("setGracePeriodTimer"),this.clearGracePeriodTimer(),this._gracePeriodTimeoutID=setTimeout(this._gracePeriodTimerHandler,this.config.keepaliveGracePeriod)},WebSocketConnection.prototype.clearGracePeriodTimer=function(){this._gracePeriodTimeoutID&&clearTimeout(this._gracePeriodTimeoutID)},WebSocketConnection.prototype.handleGracePeriodTimer=function(){this._debug("handleGracePeriodTimer"),this._gracePeriodTimeoutID=null,this.drop(WebSocketConnection.CLOSE_REASON_ABNORMAL,"Peer not responding.",!0)},WebSocketConnection.prototype.handleSocketData=function(h){this._debug("handleSocketData"),this.setKeepaliveTimer(),this.bufferList.write(h),this.processReceivedData()},WebSocketConnection.prototype.processReceivedData=function(){if(this._debug("processReceivedData"),this.connected&&!this.inputPaused){var h=this.currentFrame;if(h.addData(this.bufferList)){var m=this;if(h.protocolError)return this._debug("-- protocol error"),void process.nextTick((function(){m.drop(WebSocketConnection.CLOSE_REASON_PROTOCOL_ERROR,h.dropReason)}));if(h.frameTooLarge)return this._debug("-- frame too large"),void process.nextTick((function(){m.drop(WebSocketConnection.CLOSE_REASON_MESSAGE_TOO_BIG,h.dropReason)}));if(h.rsv1||h.rsv2||h.rsv3)return this._debug("-- illegal rsv flag"),void process.nextTick((function(){m.drop(WebSocketConnection.CLOSE_REASON_PROTOCOL_ERROR,"Unsupported usage of rsv bits without negotiated extension.")}));this.assembleFragments||(this._debug("-- emitting frame"),process.nextTick((function(){m.emit("frame",h)}))),process.nextTick((function(){m.processFrame(h)})),this.currentFrame=new w(this.maskBytes,this.frameHeader,this.config),this.bufferList.length>0&&M(this.receivedDataHandler)}else this._debug("-- insufficient data for frame")}},WebSocketConnection.prototype.handleSocketError=function(h){this._debug("handleSocketError: %j",h),"closed"!==this.state?(this.closeReasonCode=WebSocketConnection.CLOSE_REASON_ABNORMAL,this.closeDescription="Socket Error: "+h.syscall+" "+h.code,this.connected=!1,this.state="closed",this.fragmentationSize=0,C.eventEmitterListenerCount(this,"error")>0&&this.emit("error",h),this.socket.destroy(),this._debug.printOutput()):this._debug("  --- Socket 'error' after 'close'")},WebSocketConnection.prototype.handleSocketEnd=function(){this._debug("handleSocketEnd: received socket end.  state = %s",this.state),this.receivedEnd=!0,"closed"!==this.state?"peer_requested_close"!==this.state&&"ending"!==this.state&&(this._debug("  --- UNEXPECTED socket end."),this.socket.end()):this._debug("  --- Socket 'end' after 'close'")},WebSocketConnection.prototype.handleSocketClose=function(h){this._debug("handleSocketClose: received socket close"),this.socketHadError=h,this.connected=!1,this.state="closed",-1===this.closeReasonCode&&(this.closeReasonCode=WebSocketConnection.CLOSE_REASON_ABNORMAL,this.closeDescription="Connection dropped by remote peer."),this.clearCloseTimer(),this.clearKeepaliveTimer(),this.clearGracePeriodTimer(),this.closeEventEmitted||(this.closeEventEmitted=!0,this._debug("-- Emitting WebSocketConnection close event"),this.emit("close",this.closeReasonCode,this.closeDescription))},WebSocketConnection.prototype.handleSocketDrain=function(){this._debug("handleSocketDrain: socket drain event"),this.outputBufferFull=!1,this.emit("drain")},WebSocketConnection.prototype.handleSocketPause=function(){this._debug("handleSocketPause: socket pause event"),this.inputPaused=!0,this.emit("pause")},WebSocketConnection.prototype.handleSocketResume=function(){this._debug("handleSocketResume: socket resume event"),this.inputPaused=!1,this.emit("resume"),this.processReceivedData()},WebSocketConnection.prototype.pause=function(){this._debug("pause: pause requested"),this.socket.pause()},WebSocketConnection.prototype.resume=function(){this._debug("resume: resume requested"),this.socket.resume()},WebSocketConnection.prototype.close=function(h,m){if(this.connected){if(this._debug("close: Initating clean WebSocket close sequence."),"number"!=typeof h&&(h=WebSocketConnection.CLOSE_REASON_NORMAL),!validateCloseReason(h))throw new Error("Close code "+h+" is not valid.");"string"!=typeof m&&(m=WebSocketConnection.CLOSE_DESCRIPTIONS[h]),this.closeReasonCode=h,this.closeDescription=m,this.setCloseTimer(),this.sendCloseFrame(this.closeReasonCode,this.closeDescription),this.state="ending",this.connected=!1}},WebSocketConnection.prototype.drop=function(h,m,y){this._debug("drop"),"number"!=typeof h&&(h=WebSocketConnection.CLOSE_REASON_PROTOCOL_ERROR),"string"!=typeof m&&(m=WebSocketConnection.CLOSE_DESCRIPTIONS[h]),this._debug("Forcefully dropping connection. skipCloseFrame: %s, code: %d, description: %s",y,h,m),this.closeReasonCode=h,this.closeDescription=m,this.frameQueue=[],this.fragmentationSize=0,y||this.sendCloseFrame(h,m),this.connected=!1,this.state="closed",this.clearCloseTimer(),this.clearKeepaliveTimer(),this.clearGracePeriodTimer(),this.closeEventEmitted||(this.closeEventEmitted=!0,this._debug("Emitting WebSocketConnection close event"),this.emit("close",this.closeReasonCode,this.closeDescription)),this._debug("Drop: destroying socket"),this.socket.destroy()},WebSocketConnection.prototype.setCloseTimer=function(){this._debug("setCloseTimer"),this.clearCloseTimer(),this._debug("Setting close timer"),this.waitingForCloseResponse=!0,this.closeTimer=setTimeout(this._closeTimerHandler,this.closeTimeout)},WebSocketConnection.prototype.clearCloseTimer=function(){this._debug("clearCloseTimer"),this.closeTimer&&(this._debug("Clearing close timer"),clearTimeout(this.closeTimer),this.waitingForCloseResponse=!1,this.closeTimer=null)},WebSocketConnection.prototype.handleCloseTimer=function(){this._debug("handleCloseTimer"),this.closeTimer=null,this.waitingForCloseResponse&&(this._debug("Close response not received from client.  Forcing socket end."),this.waitingForCloseResponse=!1,this.state="closed",this.socket.end())},WebSocketConnection.prototype.processFrame=function(h){if(this._debug("processFrame"),this._debug(" -- frame: %s",h),0!==this.frameQueue.length&&h.opcode>0&&h.opcode<8)this.drop(WebSocketConnection.CLOSE_REASON_PROTOCOL_ERROR,"Illegal frame opcode 0x"+h.opcode.toString(16)+" received in middle of fragmented message.");else switch(h.opcode){case 2:this._debug("-- Binary Frame"),this.assembleFragments&&(h.fin?(this._debug("---- Emitting 'message' event"),this.emit("message",{type:"binary",binaryData:h.binaryPayload})):(this.frameQueue.push(h),this.fragmentationSize=h.length));break;case 1:if(this._debug("-- Text Frame"),this.assembleFragments)if(h.fin){if(!P(h.binaryPayload))return void this.drop(WebSocketConnection.CLOSE_REASON_INVALID_DATA,"Invalid UTF-8 Data Received");this._debug("---- Emitting 'message' event"),this.emit("message",{type:"utf8",utf8Data:h.binaryPayload.toString("utf8")})}else this.frameQueue.push(h),this.fragmentationSize=h.length;break;case 0:if(this._debug("-- Continuation Frame"),this.assembleFragments){if(0===this.frameQueue.length)return void this.drop(WebSocketConnection.CLOSE_REASON_PROTOCOL_ERROR,"Unexpected Continuation Frame");if(this.fragmentationSize+=h.length,this.fragmentationSize>this.maxReceivedMessageSize)return void this.drop(WebSocketConnection.CLOSE_REASON_MESSAGE_TOO_BIG,"Maximum message size exceeded.");if(this.frameQueue.push(h),h.fin){var m=0,y=k(this.fragmentationSize),v=this.frameQueue[0].opcode;switch(this.frameQueue.forEach((function(h){h.binaryPayload.copy(y,m),m+=h.binaryPayload.length})),this.frameQueue=[],this.fragmentationSize=0,v){case 2:this.emit("message",{type:"binary",binaryData:y});break;case 1:if(!P(y))return void this.drop(WebSocketConnection.CLOSE_REASON_INVALID_DATA,"Invalid UTF-8 Data Received");this.emit("message",{type:"utf8",utf8Data:y.toString("utf8")});break;default:return void this.drop(WebSocketConnection.CLOSE_REASON_PROTOCOL_ERROR,"Unexpected first opcode in fragmentation sequence: 0x"+v.toString(16))}}}break;case 9:if(this._debug("-- Ping Frame"),this._pingListenerCount>0){var C=!1;this.emit("ping",(function(){C=!0}),h.binaryPayload),C||this.pong(h.binaryPayload)}else this.pong(h.binaryPayload);break;case 10:this._debug("-- Pong Frame"),this.emit("pong",h.binaryPayload);break;case 8:if(this._debug("-- Close Frame"),this.waitingForCloseResponse)return this._debug("---- Got close response from peer.  Completing closing handshake."),this.clearCloseTimer(),this.waitingForCloseResponse=!1,this.state="closed",void this.socket.end();var T;if(this._debug("---- Closing handshake initiated by peer."),this.state="peer_requested_close",h.invalidCloseFrameLength?(this.closeReasonCode=1005,T=WebSocketConnection.CLOSE_REASON_PROTOCOL_ERROR):-1===h.closeStatus||validateCloseReason(h.closeStatus)?(this.closeReasonCode=h.closeStatus,T=WebSocketConnection.CLOSE_REASON_NORMAL):(this.closeReasonCode=h.closeStatus,T=WebSocketConnection.CLOSE_REASON_PROTOCOL_ERROR),h.binaryPayload.length>1){if(!P(h.binaryPayload))return void this.drop(WebSocketConnection.CLOSE_REASON_INVALID_DATA,"Invalid UTF-8 Data Received");this.closeDescription=h.binaryPayload.toString("utf8")}else this.closeDescription=WebSocketConnection.CLOSE_DESCRIPTIONS[this.closeReasonCode];this._debug("------ Remote peer %s - code: %d - %s - close frame payload length: %d",this.remoteAddress,this.closeReasonCode,this.closeDescription,h.length),this._debug("------ responding to remote peer's close request."),this.sendCloseFrame(T,null),this.connected=!1;break;default:this._debug("-- Unrecognized Opcode %d",h.opcode),this.drop(WebSocketConnection.CLOSE_REASON_PROTOCOL_ERROR,"Unrecognized Opcode: 0x"+h.opcode.toString(16))}},WebSocketConnection.prototype.send=function(h,m){if(this._debug("send"),Buffer.isBuffer(h))this.sendBytes(h,m);else{if("function"!=typeof h.toString)throw new Error("Data provided must either be a Node Buffer or implement toString()");this.sendUTF(h,m)}},WebSocketConnection.prototype.sendUTF=function(h,m){h=R(h.toString(),"utf8"),this._debug("sendUTF: %d bytes",h.length);var y=new w(this.maskBytes,this.frameHeader,this.config);y.opcode=1,y.binaryPayload=h,this.fragmentAndSend(y,m)},WebSocketConnection.prototype.sendBytes=function(h,m){if(this._debug("sendBytes"),!Buffer.isBuffer(h))throw new Error("You must pass a Node Buffer object to WebSocketConnection.prototype.sendBytes()");var y=new w(this.maskBytes,this.frameHeader,this.config);y.opcode=2,y.binaryPayload=h,this.fragmentAndSend(y,m)},WebSocketConnection.prototype.ping=function(h){this._debug("ping");var m=new w(this.maskBytes,this.frameHeader,this.config);m.opcode=9,m.fin=!0,h&&(Buffer.isBuffer(h)||(h=R(h.toString(),"utf8")),h.length>125&&(this._debug("WebSocket: Data for ping is longer than 125 bytes.  Truncating."),h=h.slice(0,124)),m.binaryPayload=h),this.sendFrame(m)},WebSocketConnection.prototype.pong=function(h){this._debug("pong");var m=new w(this.maskBytes,this.frameHeader,this.config);m.opcode=10,Buffer.isBuffer(h)&&h.length>125&&(this._debug("WebSocket: Data for pong is longer than 125 bytes.  Truncating."),h=h.slice(0,124)),m.binaryPayload=h,m.fin=!0,this.sendFrame(m)},WebSocketConnection.prototype.fragmentAndSend=function(h,m){if(this._debug("fragmentAndSend"),h.opcode>7)throw new Error("You cannot fragment control frames.");var y=this.config.fragmentationThreshold,v=h.binaryPayload.length;if(!this.config.fragmentOutgoingMessages||h.binaryPayload&&v<=y)return h.fin=!0,void this.sendFrame(h,m);for(var C=Math.ceil(v/y),T=0,A=function fragmentSentCallback(h){h?"function"==typeof m&&(m(h),m=null):++T===C&&"function"==typeof m&&m()},P=1;P<=C;P++){var k=new w(this.maskBytes,this.frameHeader,this.config);k.opcode=1===P?h.opcode:0,k.fin=P===C;var R=P===C?v-y*(P-1):y,M=y*(P-1);k.binaryPayload=h.binaryPayload.slice(M,M+R),this.sendFrame(k,A)}},WebSocketConnection.prototype.sendCloseFrame=function(h,m,y){if("number"!=typeof h&&(h=WebSocketConnection.CLOSE_REASON_NORMAL),this._debug("sendCloseFrame state: %s, reasonCode: %d, description: %s",this.state,h,m),"open"===this.state||"peer_requested_close"===this.state){var v=new w(this.maskBytes,this.frameHeader,this.config);v.fin=!0,v.opcode=8,v.closeStatus=h,"string"==typeof m&&(v.binaryPayload=R(m,"utf8")),this.sendFrame(v,y),this.socket.end()}},WebSocketConnection.prototype.sendFrame=function(h,m){this._debug("sendFrame"),h.mask=this.maskOutgoingPackets;var y=this.socket.write(h.toBuffer(),m);return this.outputBufferFull=!y,y},h.exports=WebSocketConnection},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0}),function(h){h.LiveshareJoinWorkspace="LiveshareJoinWorkspace",h.VSCodeServerStartupServerStart="VSCodeServerStartupServerStart",h.VSCodeServerStartupServerTcpPortForwarding="VSCodeServerStartupServerTCPPortForwarding"}(m.PerformanceEventIds||(m.PerformanceEventIds={}))},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0}),m.VSCODE_SERVER_PORT_NAME="VSCodeServerInternal"},function(h,m,y){"use strict";var v=this&&this.__awaiter||function(h,m,y,v){return new(y||(y=Promise))((function(C,T){function fulfilled(h){try{step(v.next(h))}catch(h){T(h)}}function rejected(h){try{step(v.throw(h))}catch(h){T(h)}}function step(h){h.done?C(h.value):function adopt(h){return h instanceof y?h:new y((function(m){m(h)}))}(h.value).then(fulfilled,rejected)}step((v=v.apply(h,m||[])).next())}))};Object.defineProperty(m,"__esModule",{value:!0});const C=y(2),T=y(2),w=y(133),A=y(65);class ConnectionMock extends w.Connection{constructor(){super(...arguments),this.onConnectionChangedEventEmitterMock=this.onConnectionChangedEventEmitter}getId(h){const{id:m,someProp:y,numericProp:v}=h;return`${m}_${y}_${v}`}onConnectionChangedHandlerMock(h,m){return this.onConnectionChangedHandler(h,m)}get connectionSignalMock(){return this.connectionSignal}finish(h){return C.assertDefined(this.connectionSignal,"No `Connection Signal` found."),h?(this.connectionSignal.reject(h),this):(this.connectionSignal.resolve(this),this)}finishWithDelay(h,m=0){return m?(T.defer(()=>{this.finish(h)},m),this):this.finish(h)}createConnection(){return v(this,void 0,void 0,(function*(){return this.initializeConnection(),C.assertDefined(this.connectionSignal,new A.ConnectionError("No `connectionSignal` found.")),yield this.connectionSignal.promise,this.onConnectionChangedHandler("connected"),this}))}initializeConnectionMock(){return this.initializeConnection()}get performanceMock(){return this.performance}}m.ConnectionMock=ConnectionMock},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0}),function(h){h[h.Trace=0]="Trace",h[h.Debug=1]="Debug",h[h.Information=2]="Information",h[h.Warning=3]="Warning",h[h.Error=4]="Error",h[h.Critical=5]="Critical",h[h.None=6]="None"}(m.LogLevel||(m.LogLevel={}))},function(h,m,y){"use strict";var v=this&&this.__awaiter||function(h,m,y,v){return new(y||(y=Promise))((function(C,T){function fulfilled(h){try{step(v.next(h))}catch(h){T(h)}}function rejected(h){try{step(v.throw(h))}catch(h){T(h)}}function step(h){h.done?C(h.value):function adopt(h){return h instanceof y?h:new y((function(m){m(h)}))}(h.value).then(fulfilled,rejected)}step((v=v.apply(h,m||[])).next())}))};Object.defineProperty(m,"__esModule",{value:!0});const C=y(1193),T=y(330),w=y(1514),A=y(492),P=y(498);class HubConnectionService extends A.HubConnectionServiceBase{constructor(h,m,y,v){super(h,y),this.onMethods=new Map;const A=P.createLoggerAdapter(y,T.LogLevel.Information);let k=(new T.HubConnectionBuilder).withUrl(m,{logger:v?P.createLoggerAdapter(y):void 0,accessTokenFactory:()=>this.accessToken()}).configureLogging(A);k=k.withHubProtocol(new w.MessagePackHubProtocol),this.hubClientInstance=C.HubClient.createWithHub(k.build(),A),this.hubClientInstance.onConnectionStateChanged(()=>(this.traceSource.verbose(`ConnectionStateChanged isConnected:${this.isConnected}`),this.connectionStateChangedEmitter.fire(),Promise.resolve())),this.hubClientInstance.onAttemptConnection((h,m,y)=>(this.traceSource.verbose(`onAttemptConnection retries:${h} error:${null!=y?y:"n/a"}`),this.attemptConnectionEmitter.fire({retries:h,backoffTime:m,error:y}),Promise.resolve()))}static create(h,m,y){return v(this,void 0,void 0,(function*(){const v=new HubConnectionService(h,m,y),C=yield h.getCurrentAuthenticatedUserAsync();return null!=C&&v.setCurrentUserInfo(C),v}))}registerMethod(h,m){this.traceSource.verbose(`registerMethod method:${h}`);let y=this.onMethods.get(h);return y?y.push(m):(y=[m],this.hubConnection.on(h,(...h)=>{y.forEach(m=>m(...h))})),{dispose:()=>{const v=y.indexOf(m);v>-1&&(y.splice(v,1),0===y.length&&this.hubConnection.off(h))}}}get hubProxy(){return this.hubClientInstance.hubProxy}get hubClient(){return this.hubClientInstance}get hubConnection(){return this.hubClientInstance.hubConnection}get isConnected(){return this.hubClientInstance.isConnected}get isRunning(){return this.hubClientInstance.isRunning}updateHubClientConnection(){this.shouldConnect()&&this.enabled?this.enabled&&this.shouldConnect()&&!this.hubClientInstance.isRunning&&(this.traceSource.verbose("updateHubClientConnection->StartAsync"),this.hubClientInstance.start().catch(h=>{this.traceSource.error("Failed to start hub",h)}),this.fireIsRunningStateChanged()):this.hubClientInstance.isRunning&&(this.traceSource.verbose("updateHubClientConnection->StopAsync"),this.hubClientInstance.stop().catch(h=>{this.traceSource.error("Failed to stop hub",h)}),this.fireIsRunningStateChanged())}fireIsRunningStateChanged(){this.runningStateChangedEmitter.fire()}}m.HubConnectionService=HubConnectionService},function(h,m,y){var v=y(9),C=v.Buffer;function copyProps(h,m){for(var y in h)m[y]=h[y]}function SafeBuffer(h,m,y){return C(h,m,y)}C.from&&C.alloc&&C.allocUnsafe&&C.allocUnsafeSlow?h.exports=v:(copyProps(v,m),m.Buffer=SafeBuffer),SafeBuffer.prototype=Object.create(C.prototype),copyProps(C,SafeBuffer),SafeBuffer.from=function(h,m,y){if("number"==typeof h)throw new TypeError("Argument must not be a number");return C(h,m,y)},SafeBuffer.alloc=function(h,m,y){if("number"!=typeof h)throw new TypeError("Argument must be a number");var v=C(h);return void 0!==m?"string"==typeof y?v.fill(m,y):v.fill(m):v.fill(0),v},SafeBuffer.allocUnsafe=function(h){if("number"!=typeof h)throw new TypeError("Argument must be a number");return C(h)},SafeBuffer.allocUnsafeSlow=function(h){if("number"!=typeof h)throw new TypeError("Argument must be a number");return v.SlowBuffer(h)}},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0});var v=y(1209);m.HubStream=v.HubStream;var C=y(1227);m.createSshRpcMessageStream=C.createSshRpcMessageStream},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0}),m.KeyExchangeAlgorithm=void 0;m.KeyExchangeAlgorithm=class KeyExchangeAlgorithm{constructor(h,m,y,v){this.name=h,this.keySizeInBits=m,this.hashAlgorithmName=y,this.hashDigestLength=v}}},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0}),m.EncryptionAlgorithm=void 0;m.EncryptionAlgorithm=class EncryptionAlgorithm{constructor(h){this.name=h}}},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0}),m.HmacAlgorithm=void 0;m.HmacAlgorithm=class HmacAlgorithm{constructor(h,m,y,v){this.name=h,this.algorithmName=m,this.keyLength=y,this.digestLength=v}}},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0}),m.WebHmac=void 0;const v=y(9),C=y(278);class WebHmac extends C.HmacAlgorithm{constructor(h,m,y=!1){super(h,m,WebHmac.getHashKeyLength(m),WebHmac.getHashDigestLength(m)),this.encryptThenMac=y}async createSigner(h){const m=new WebSignerVerifier(this.algorithmName,!0,this.digestLength,this.encryptThenMac);return await m.init(h),m}async createVerifier(h){const m=new WebSignerVerifier(this.algorithmName,!1,this.digestLength,this.encryptThenMac);return await m.init(h),m}static getHashKeyLength(h){if("SHA2-512"===h)return 64;if("SHA2-384"===h)return 48;if("SHA2-256"===h)return 32;throw new Error(`Unsupported hash algorithm: ${h}`)}static getHashDigestLength(h){return this.getHashKeyLength(h)}static getWebHashAlgorithmName(h){if("SHA2-512"===h)return"SHA-512";if("SHA2-384"===h)return"SHA-384";if("SHA2-256"===h)return"SHA-256";throw new Error(`Unsupported hash algorithm: ${h}`)}}m.WebHmac=WebHmac;class WebSignerVerifier{constructor(h,m,y,v){this.algorithmName=h,this.isSigning=m,this.digestLength=y,this.encryptThenMac=v}async init(h){try{const m=this.algorithmName.replace("SHA2-","SHA-");this.key=await crypto.subtle.importKey("raw",h,{name:"HMAC",hash:{name:m}},!1,this.isSigning?["sign"]:["verify"])}catch(h){throw new Error("Failed to initialize HMAC: "+h)}}async sign(h){return v.Buffer.from(await crypto.subtle.sign({name:"HMAC",hash:{name:this.algorithmName}},this.key,h))}async verify(h,m){return await crypto.subtle.verify({name:"HMAC",hash:{name:this.algorithmName}},this.key,m,h)}dispose(){}}},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0}),m.JsonWebKeyFormatter=void 0;const v=y(56),C=y(188);class JsonWebKeyFormatter{static formatRsa(h,m){const y=JsonWebKeyFormatter.formatBigInt;let v;if(!1!==m&&h.d&&h.p&&h.q&&h.dp&&h.dq&&h.qi)v={kty:"RSA",n:y(h.modulus),e:y(h.exponent),d:y(h.d),p:y(h.p),q:y(h.q),dp:y(h.dp),dq:y(h.dq),qi:y(h.qi)};else{if(m)throw new Error("Missing private key parameters.");v={kty:"RSA",n:y(h.modulus),e:y(h.exponent)}}return v}static parseRsa(h,m){if("RSA"!==(null==h?void 0:h.kty)||!h.n||!h.e)throw new Error("Invalid RSA JWK.");const y=JsonWebKeyFormatter.parseBigInt;let v;return v=!1!==m&&h.d&&h.p&&h.q&&h.dp&&h.dq&&h.qi?{modulus:y(h.n),exponent:y(h.e),d:y(h.d),p:y(h.p),q:y(h.q),dp:y(h.dp),dq:y(h.dq),qi:y(h.qi)}:{modulus:y(h.n),exponent:y(h.e)},v}static formatEC(h,m){const y=JsonWebKeyFormatter.formatBigInt,v=C.curves.find(m=>m.oid===h.curve.oid||m.name===h.curve.name||m.shortName===h.curve.name),T=Math.ceil(v.keySize/8),w={kty:"EC",crv:h.curve.name,x:y(h.x,T),y:y(h.y,T)};if(!1!==m&&h.d)w.d=y(h.d,T);else if(m)throw new Error("Missing private key parameters.");return w}static parseEC(h,m){if("EC"!==(null==h?void 0:h.kty)||!(h.crv&&h.x&&h.y))throw new Error("Invalid EC JWK.");const y=JsonWebKeyFormatter.parseBigInt,v={curve:{name:h.crv},x:y(h.x),y:y(h.y)};return!1!==m&&h.d&&(v.d=y(h.d)),v}static formatBigInt(h,m){return JsonWebKeyFormatter.base64UrlEncode(h.toBytes({unsigned:!0,length:m}))}static parseBigInt(h){return v.BigInt.fromBytes(Buffer.from(h,"base64"),{unsigned:!0})}static base64UrlEncode(h){return h.toString("base64").replace(/=+$/g,"").replace(/\+/g,"-").replace(/\//g,"_")}}m.JsonWebKeyFormatter=JsonWebKeyFormatter},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0}),m.NodeHmac=void 0;const v=y(11),C=y(9),T=y(278);class NodeHmac extends T.HmacAlgorithm{constructor(h,m,y=!1){super(h,m,NodeHmac.getHashKeyLength(m),NodeHmac.getHashDigestLength(m)),this.encryptThenMac=y}async createSigner(h){return new NodeSignerVerifier(NodeHmac.getNodeHashAlgorithmName(this.algorithmName),this.digestLength,this.encryptThenMac,h)}async createVerifier(h){return new NodeSignerVerifier(NodeHmac.getNodeHashAlgorithmName(this.algorithmName),this.digestLength,this.encryptThenMac,h)}static getHashKeyLength(h){if("SHA2-512"===h)return 64;if("SHA2-384"===h)return 48;if("SHA2-256"===h)return 32;throw new Error(`Unsupported hash algorithm: ${h}`)}static getHashDigestLength(h){return this.getHashKeyLength(h)}static getNodeHashAlgorithmName(h){if("SHA2-512"===h)return"sha512";if("SHA2-384"===h)return"sha384";if("SHA2-256"===h)return"sha256";throw new Error(`Unsupported hash algorithm: ${h}`)}}m.NodeHmac=NodeHmac;class NodeSignerVerifier{constructor(h,m,y,T){this.algorithmName=h,this.digestLength=m,this.encryptThenMac=y,this.key=v.createSecretKey?v.createSecretKey(T):C.Buffer.from(T)}async sign(h){const m=v.createHmac(this.algorithmName,this.key);return m.update(h),m.digest()}async verify(h,m){const y=v.createHmac(this.algorithmName,this.key);return y.update(h),y.digest().equals(m)}dispose(){}}},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0}),m.DerWriter=m.DerReader=void 0;const v=y(9),C=y(56);class DerReader{constructor(h,m=48){this.buffer=h,this.position=0,this.readType(m);const y=this.readLength();if(y>this.buffer.length-this.position)throw new Error("Read out of bounds.");this.buffer=this.buffer.slice(0,this.position+y)}get available(){return this.buffer.length-this.position}readNull(){if(this.readType(5),0!==this.readByte())throw new Error("Expected a 0 after Null type.")}readInteger(){this.readType(2);const h=this.readLength(),m=this.readBytes(h);return new C.BigInt(m)}readOctetString(){this.readType(4);const h=this.readLength();return this.readBytes(h)}readBitString(){this.readType(3);const h=this.readLength();if(0!==this.readByte())throw new Error("Padded bit strings are not supported.");return this.readBytes(h-1)}readObjectIdentifier(h){this.readType(6);const m=this.readLength(),y=this.position+m,v=[],C=this.readByte();v.push(Math.trunc(C/40)),v.push(C%40);let T=0;for(;this.position<y;){const h=this.readByte();0!=(128&h)?T=128*T+(127&h):(T=128*T+h,v.push(T),T=0)}if(0!==T)throw new Error("Invalid OID format.");const w=v.join(".");if(h&&w!==h)throw new Error(`Expected OID ${h}, found: ${w}`);return w}readSequence(){const h=this.position;this.readType(48);const m=this.readLength();return this.position+=m,new DerReader(this.buffer.slice(h,this.position))}tryReadTagged(h){if(this.position>=this.buffer.length)return null;const m=this.buffer[this.position];if(0==(160&m)||(-161&m)!==h)return null;const y=this.position;this.position++;const v=this.readLength();return this.position+=v,new DerReader(this.buffer.slice(y,this.position),m)}peek(){if(this.position>=this.buffer.length)throw new Error("Read out of bounds.");return this.buffer[this.position]}readLength(){let h=this.readByte();if(128===h)throw new Error("Indefinite-length encoding is not supported.");if(h>127){const m=127&h;if(m>4)throw new Error(`DER length size is ${m} and cannot be more than 4 bytes.`);h=0;for(let y=0;y<m;y++){h=(h<<8)+this.readByte()}if(h<0)throw new Error("Corrupted data - negative length found")}return h}readByte(){if(this.position>=this.buffer.length)throw new Error("Read out of bounds.");return this.buffer[this.position++]}readBytes(h){if(this.position+h>this.buffer.length)throw new Error("Read out of bounds.");const m=this.buffer.slice(this.position,this.position+h);return this.position+=h,m}readType(h){const m=this.readByte();if(m!==h)throw new Error(`Expected ${h} data type, found : ${m}`)}}m.DerReader=DerReader;class DerWriter{constructor(h,m=48){this.buffer=h,this.dataType=m,this.position=0,this.buffer=h}toBuffer(){const h=this.position,m=DerWriter.getLength(h);this.ensureCapacity(1+m.length+h);const y=this.buffer.slice(0,1+m.length+h);return this.buffer.copy(y,1+m.length),y[0]=this.dataType,m.copy(y,1,0),this.buffer=this.buffer.slice(1+m.length,y.length),this.position=h,y}writeSequence(h){this.writeBytes(h.toBuffer())}writeTagged(h,m){if(h>15)throw new Error("Invalid DER tag.");this.writeByte(160|h);const y=DerWriter.getLength(m.position);this.writeBytes(y),this.writeBytes(m.buffer.slice(0,m.position))}writeNull(){this.writeByte(5),this.writeByte(0)}writeInteger(h){this.writeByte(2);const m=h.toBytes(),y=DerWriter.getLength(m.length);this.writeBytes(y),this.writeBytes(m)}writeOctetString(h){this.writeByte(4);const m=DerWriter.getLength(h.length);this.writeBytes(m),this.writeBytes(h)}writeBitString(h){this.writeByte(3);const m=DerWriter.getLength(1+h.length);this.writeBytes(m),this.writeByte(0),this.writeBytes(h)}writeObjectIdentifier(h){if(!h)throw new TypeError("OID value is null or empty.");const m=h.split(".").map(Number);if(m.length<2||m[0]>3||m[1]>=40)throw new Error(`Invalid OID: ${h}`);this.writeByte(6);let y=m.length-1;for(let h=2;h<m.length;h++){let v=m[h];for(;v>128;)y++,v/=128}const v=DerWriter.getLength(y);this.writeBytes(v),this.writeByte(40*m[0]+m[1]);for(let h=2;h<m.length;h++){let y=m[h];if(y>=128){let h=[];for(h.push(127&y);y>=128;)y/=128,h.push(128|127&y);for(;h.length>0;)this.writeByte(h.pop())}else this.writeByte(y)}}static getLength(h){if(h>127){let m=1;for(let y=h>>8;0!==y;y>>=8)m++;const y=DerWriter.lengthBuffer.slice(0,m+1);y[0]=128|m;for(let v=8*(m-1),C=1;v>=0;v-=8,C++)y[C]=h>>v;return y}{const m=DerWriter.lengthBuffer.slice(0,1);return m[0]=h,m}}writeByte(h){this.ensureCapacity(this.position+1),this.buffer[this.position++]=h}writeBytes(h){this.ensureCapacity(this.position+h.length),h.copy(this.buffer,this.position),this.position+=h.length}ensureCapacity(h){if(this.buffer.length<h){let m=Math.max(512,2*this.buffer.length);for(;m<h;)m*=2;const y=v.Buffer.alloc(m);this.buffer.copy(y,0,0,this.position),this.buffer=y}}}m.DerWriter=DerWriter,DerWriter.lengthBuffer=v.Buffer.alloc(10)},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0}),m.SshChannel=void 0;const v=y(50),C=y(6),T=y(108),w=y(81),A=y(57),P=y(515),k=y(82),R=y(51),M=y(284),N=y(516),D=y(83),I=y(140);class SshChannel{constructor(h,m,y,v,T,w){this.connectionService=h,this.channelType=m,this.remoteChannelId=y,this.remoteWindowSize=v,this.remoteMaxPacketSize=T,this.channelId=w,this.remoteClosed=!1,this.localClosed=!1,this.sentEof=!1,this.disposed=!1,this.openSendingWindowCompletionSource=null,this.requestCompletionSource=null,this.sendSemaphore=new I.Semaphore(0),this.metrics=new P.ChannelMetrics,this.dataReceivedEmitter=new C.Emitter,this.onDataReceived=this.dataReceivedEmitter.event,this.eofEmitter=new C.Emitter,this.onEof=this.eofEmitter.event,this.closedEmitter=new C.Emitter,this.onClosed=this.closedEmitter.event,this.requestEmitter=new C.Emitter,this.onRequest=this.requestEmitter.event,this.windowSize=SshChannel.initialWindowSize,this.maxPacketSize=SshChannel.dataPacketSize}get session(){return this.connectionService.session}get isClosed(){return this.localClosed||this.remoteClosed}async request(h,m){if(!h)throw new TypeError("Request is required.");if(this.disposed)throw new R.ObjectDisposedError(this);if(h.recipientChannel=this.remoteChannelId,!h.wantReply)return await this.session.sendMessage(h,m),!0;if(null!=this.requestCompletionSource)throw new Error("Another request is already pending.");const y=new k.PromiseCompletionSource;if(this.requestCompletionSource=y,m){if(m.isCancellationRequested)throw new D.CancellationError;m.onCancellationRequested(()=>{y.reject(new D.CancellationError)})}return await this.session.sendMessage(h,m),await y.promise}async send(h,m){if(this.disposed)throw new R.ObjectDisposedError(this);if(0!==h.length){if(this.sentEof)throw new Error("Cannot send more data after EOF.");await this.sendSemaphore.wait(m);try{let y=0,C=h.length;for(;C>0;){let T=Math.min(Math.min(this.remoteWindowSize,this.remoteMaxPacketSize),C);for(;0===T;)this.openSendingWindowCompletionSource||(this.openSendingWindowCompletionSource=new k.PromiseCompletionSource),(0,v.trace)(`${this} send window is full. Waiting for window adjustment before sending.`),await(0,D.withCancellation)(this.openSendingWindowCompletionSource.promise,m),this.openSendingWindowCompletionSource=null,T=Math.min(Math.min(this.remoteWindowSize,this.remoteMaxPacketSize),C);const A=new w.ChannelDataMessage;A.recipientChannel=this.remoteChannelId,A.data=Buffer.from(h.slice(y,y+T)),await this.session.sendMessage(A,m),this.remoteWindowSize-=T,C-=T,y+=T,this.metrics.addBytesSent(T)}}finally{this.sendSemaphore.tryRelease()}}else await this.sendEof()}enableSending(){this.sendSemaphore.tryRelease()}async sendEof(h){if(!this.sentEof){await this.sendSemaphore.wait(h);try{this.sentEof=!0;const m=new w.ChannelEofMessage;m.recipientChannel=this.remoteChannelId,await this.session.sendMessage(m,h)}finally{this.sendSemaphore.tryRelease()}}}async handleRequest(h,m){if(!h.requestType)throw new R.SshConnectionError("Channel request type not specified.",A.SshDisconnectReason.protocolError);if(h.requestType===w.ChannelRequestType.exitStatus){const m=new w.ChannelSignalMessage;return h.convertTo(m),this.exitStatus=m.exitStatus,!0}if(h.requestType===w.ChannelRequestType.exitSignal){const m=new w.ChannelSignalMessage;return h.convertTo(m),this.exitSignal=m.exitSignal,this.exitErrorMessage=m.errorMessage,!0}if(h.requestType===w.ChannelRequestType.signal){const m=new w.ChannelSignalMessage;h.convertTo(m)}const y=new M.SshRequestEventArgs(h.requestType,h,this.session.principal),v=(0,T.findService)(this.session.config.services,m=>(!m.channelType||m.channelType===this.channelType)&&m.channelRequest===h.requestType);await this.sendSemaphore.wait(m);try{if(v){const h=this.session.activateService(v);await h.onChannelRequest(this,y,m)}else this.requestEmitter.fire(y);if(h.wantReply){let h;if(y.isAuthorized){const m=new w.ChannelSuccessMessage;m.recipientChannel=this.remoteChannelId,h=m}else{const m=new w.ChannelFailureMessage;m.recipientChannel=this.remoteChannelId,h=m}await this.session.sendMessage(h,m)}}finally{this.sendSemaphore.tryRelease()}return y.isAuthorized||!1}handleResponse(h){this.requestCompletionSource&&(this.requestCompletionSource.resolve(h),this.requestCompletionSource=null)}handleDataReceived(h){this.metrics.addBytesReceived(h.length),this.dataReceivedEmitter.fire(h)}adjustWindow(h){if(!this.disposed&&(this.windowSize-=h,this.windowSize<=this.maxPacketSize)){const h=new w.ChannelWindowAdjustMessage;h.recipientChannel=this.remoteChannelId,h.bytesToAdd=SshChannel.initialWindowSize-this.windowSize,this.windowSize=SshChannel.initialWindowSize,this.session.sendMessage(h).catch(h=>{(0,v.trace)(`Error sending window adjust message: ${h.message||JSON.stringify(h)}`)})}}adjustRemoteWindow(h){this.remoteWindowSize+=h,this.openSendingWindowCompletionSource&&this.openSendingWindowCompletionSource.resolve(void 0)}handleEof(){(0,v.trace)(`${this} EOF received.`),this.eofEmitter.fire()}close(h,m,y){if(!(h instanceof Error))return"number"==typeof h?this.closeWithStatus(h,m):"string"==typeof h?this.closeWithSignal(h,m,y):this.closeDefault(h);{const m=h;this.localClosed||((0,v.trace)(`${this} Closed: ${m.message}`),this.closedEmitter.fire(new N.SshChannelClosedEventArgs(m)),this.disposeInternal())}}async closeDefault(h){var m;if(!this.remoteClosed&&!this.localClosed){this.remoteClosed=!0,await this.sendSemaphore.wait(h);try{const h=new w.ChannelCloseMessage;h.recipientChannel=this.remoteChannelId,await this.session.sendMessage(h)}catch(h){}finally{this.sendSemaphore.tryRelease()}}if(!this.localClosed){this.localClosed=!0;const h=`${this} closed.`;(0,v.trace)(h),this.closedEmitter.fire(new N.SshChannelClosedEventArgs),null===(m=this.requestCompletionSource)||void 0===m||m.reject(new R.SshChannelError(h)),this.disposeInternal()}}async closeWithStatus(h,m){if(!this.remoteClosed&&!this.localClosed){this.exitStatus=h;const m=new w.ChannelSignalMessage;m.recipientChannel=this.remoteChannelId,m.exitStatus=h,await this.session.sendMessage(m)}this.localClosed||await this.closeDefault(m)}async closeWithSignal(h,m,y){if(!this.remoteClosed&&!this.localClosed){this.exitSignal=h,this.exitErrorMessage=m;const y=new w.ChannelSignalMessage;y.recipientChannel=this.remoteChannelId,y.exitSignal=h,y.errorMessage=m,await this.session.sendMessage(y)}this.localClosed||await this.closeDefault(y)}dispose(){var h;if(!this.disposed&&!this.localClosed){if(!this.remoteClosed){this.remoteClosed=!0;const h=new w.ChannelCloseMessage;h.recipientChannel=this.remoteChannelId,this.session.sendMessage(h).catch(h=>{})}let m,y;void 0!==this.exitStatus?(y=new N.SshChannelClosedEventArgs(this.exitStatus),m=`${this} disposed: status=${this.exitStatus}`):void 0!==this.exitSignal?(y=new N.SshChannelClosedEventArgs(this.exitSignal,this.exitErrorMessage),m=`${this} disposed: signal=${this.exitSignal} ${this.exitErrorMessage}`):(y=new N.SshChannelClosedEventArgs,m=`${this} disposed.`),this.localClosed=!0,(0,v.trace)(m),this.closedEmitter.fire(y),null===(h=this.requestCompletionSource)||void 0===h||h.reject(new R.SshChannelError(m))}this.disposeInternal()}disposeInternal(){var h;this.disposed||(this.disposed=!0,null===(h=this.requestCompletionSource)||void 0===h||h.reject(new R.ObjectDisposedError(this)),this.connectionService._removeChannel(this),this.sendSemaphore.dispose())}toString(){return`SshChannel(Type: ${this.channelType}, Id: ${this.channelId}, RemoteId: ${this.remoteChannelId})`}}m.SshChannel=SshChannel,SshChannel.sessionChannelType="session",SshChannel.dataPacketSize=32768,SshChannel.initialWindowSize=32*SshChannel.dataPacketSize},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0}),m.SshRequestEventArgs=void 0;m.SshRequestEventArgs=class SshRequestEventArgs{constructor(h,m,y){this.requestType=h,this.request=m,this.principal=y}toString(){return`RequestType: ${this.requestType}`+this.request?` Request: ${this.request}`:""}}},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0}),m.NewKeysMessage=m.KeyExchangeDhReplyMessage=m.KeyExchangeDhInitMessage=m.KeyExchangeInitMessage=m.KeyExchangeMessage=void 0;const v=y(9),C=y(109),T=y(107);class KeyExchangeMessage extends C.SshMessage{}m.KeyExchangeMessage=KeyExchangeMessage;class KeyExchangeInitMessage extends KeyExchangeMessage{get messageType(){return 20}onRead(h){this.cookie=h.read(16),this.keyExchangeAlgorithms=h.readList("ascii"),this.serverHostKeyAlgorithms=h.readList("ascii"),this.encryptionAlgorithmsClientToServer=h.readList("ascii"),this.encryptionAlgorithmsServerToClient=h.readList("ascii"),this.macAlgorithmsClientToServer=h.readList("ascii"),this.macAlgorithmsServerToClient=h.readList("ascii"),this.compressionAlgorithmsClientToServer=h.readList("ascii"),this.compressionAlgorithmsServerToClient=h.readList("ascii"),this.languagesClientToServer=h.readList("ascii"),this.languagesServerToClient=h.readList("ascii"),this.firstKexPacketFollows=h.readBoolean(),this.reserved=h.readUInt32()}onWrite(h){this.cookie||(this.cookie=v.Buffer.alloc(16),T.SshAlgorithms.random.getBytes(this.cookie)),h.write(this.cookie),h.writeList(this.keyExchangeAlgorithms||[],"ascii"),h.writeList(this.serverHostKeyAlgorithms||[],"ascii"),h.writeList(this.encryptionAlgorithmsClientToServer||[],"ascii"),h.writeList(this.encryptionAlgorithmsServerToClient||[],"ascii"),h.writeList(this.macAlgorithmsClientToServer||[],"ascii"),h.writeList(this.macAlgorithmsServerToClient||[],"ascii"),h.writeList(this.compressionAlgorithmsClientToServer||[],"ascii"),h.writeList(this.compressionAlgorithmsServerToClient||[],"ascii"),h.writeList(this.languagesClientToServer||[],"ascii"),h.writeList(this.languagesServerToClient||[],"ascii"),h.writeBoolean(this.validateField(this.firstKexPacketFollows,"first KEX package follows")),h.writeUInt32(this.reserved||0)}}m.KeyExchangeInitMessage=KeyExchangeInitMessage;class KeyExchangeDhInitMessage extends KeyExchangeMessage{get messageType(){return 30}onRead(h){this.e=h.readBinary()}onWrite(h){h.writeBinary(this.validateField(this.e,"E"))}}m.KeyExchangeDhInitMessage=KeyExchangeDhInitMessage;class KeyExchangeDhReplyMessage extends KeyExchangeMessage{get messageType(){return 31}onRead(h){this.hostKey=h.readBinary(),this.f=h.readBinary(),this.signature=h.readBinary()}onWrite(h){h.writeBinary(this.validateField(this.hostKey,"host key")),h.writeBinary(this.validateField(this.f,"F")),h.writeBinary(this.validateField(this.signature,"signature"))}}m.KeyExchangeDhReplyMessage=KeyExchangeDhReplyMessage;class NewKeysMessage extends KeyExchangeMessage{get messageType(){return 21}onRead(h){}onWrite(h){}}m.NewKeysMessage=NewKeysMessage,C.SshMessage.index.set(20,KeyExchangeInitMessage),C.SshMessage.index.set(30,KeyExchangeDhInitMessage),C.SshMessage.index.set(31,KeyExchangeDhReplyMessage),C.SshMessage.index.set(21,NewKeysMessage)},function(h,m,y){"use strict";var v,C=this&&this.__decorate||function(h,m,y,v){var C,T=arguments.length,w=T<3?m:null===v?v=Object.getOwnPropertyDescriptor(m,y):v;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)w=Reflect.decorate(h,m,y,v);else for(var A=h.length-1;A>=0;A--)(C=h[A])&&(w=(T<3?C(w):T>3?C(m,y,w):C(m,y))||w);return T>3&&w&&Object.defineProperty(m,y,w),w};Object.defineProperty(m,"__esModule",{value:!0}),m.AuthenticationService=void 0;const T=y(50),w=y(190),A=y(519),P=y(6),k=y(40),R=y(57),M=y(287),N=y(141),D=y(108),I=y(189);let x=v=class AuthenticationService extends w.SshService{constructor(h){var m;super(h),this.authenticationFailureCount=0,this.disposeCancellationSource=new P.CancellationTokenSource;const y=null===(m=h.algorithms)||void 0===m?void 0:m.publicKeyAlgorithmName;if(!y)throw new Error("Algorithms not initialized.");this.publicKeyAlgorithmName=y}handleMessage(h,m){if(h instanceof A.AuthenticationSuccessMessage)return this.handleSuccessMessage(h);if(h instanceof A.AuthenticationFailureMessage)return this.handleFailureMessage(h);if(h instanceof A.AuthenticationRequestMessage)return this.handleAuthenticationRequestMessage(h,m);throw new Error(`Message not implemented: ${h}`)}async handleAuthenticationRequestMessage(h,m){if((0,T.trace)(`Authentication request: ${h.methodName}`),"publickey"===h.methodName||"hostbased"===h.methodName)return this.handlePublicKeyRequestMessage(h.convertTo(new A.PublicKeyRequestMessage),m);if("password"===h.methodName)return this.handlePasswordRequestMessage(h.convertTo(new A.PasswordRequestMessage),m);if("none"===h.methodName)return this.handleAuthenticating(h,new M.SshAuthenticatingEventArgs(M.SshAuthenticationType.clientNone,{username:h.username},m));{const h=new A.AuthenticationFailureMessage;h.methodNames=["publickey","password","hostbased"],await this.session.sendMessage(h,m)}}async handlePublicKeyRequestMessage(h,m){var y,v,C;const T=this.session.config.getPublicKeyAlgorithm(h.keyAlgorithmName);if(!T){const h=new A.AuthenticationFailureMessage;return h.methodNames=["publickey","password"],void await this.session.sendMessage(h,m)}const w=T.createKeyPair();let P;if(await w.setPublicKeyBytes(h.publicKey),"hostbased"===h.methodName)P=new M.SshAuthenticatingEventArgs(M.SshAuthenticationType.clientHostBased,{username:null!==(y=h.username)&&void 0!==y?y:"",publicKey:w,clientHostname:h.clientHostname,clientUsername:h.clientUsername});else if(h.hasSignature){const y=T.readSignatureData(h.signature),v=this.session.sessionId;if(null==v)throw new Error("Session ID not initialized.");const A=new k.SshDataWriter(Buffer.alloc(v.length+h.payloadWithoutSignature.length+20));A.writeBinary(v),A.write(h.payloadWithoutSignature);const R=A.toBuffer(),N=T.createVerifier(w);await N.verify(R,y)||await this.handleAuthenticationFailure("Public key authentication failed: invalid signature.",m),P=new M.SshAuthenticatingEventArgs(M.SshAuthenticationType.clientPublicKey,{username:null!==(C=h.username)&&void 0!==C?C:"",publicKey:w})}else P=new M.SshAuthenticatingEventArgs(M.SshAuthenticationType.clientPublicKeyQuery,{username:null!==(v=h.username)&&void 0!==v?v:"",publicKey:w});await this.handleAuthenticating(h,P,m)}async handlePasswordRequestMessage(h,m){var y,v;const C=new M.SshAuthenticatingEventArgs(M.SshAuthenticationType.clientPassword,{username:null!==(y=h.username)&&void 0!==y?y:"",password:null!==(v=h.password)&&void 0!==v?v:""});await this.handleAuthenticating(h,C,m)}async handleAuthenticating(h,m,y){var v;let C=null;try{C=await this.session.raiseAuthenticatingEvent(m)}catch(h){if(!(h instanceof Error))throw h;(0,T.trace)("Error while authenticating client: "+(null!==(v=h.message)&&void 0!==v?v:h)),C=null}if(C)if(m.authenticationType===M.SshAuthenticationType.clientPublicKeyQuery){const m=h,v=new A.PublicKeyOKMessage;v.keyAlgorithmName=m.keyAlgorithmName,v.publicKey=m.publicKey,await this.session.sendMessage(v,y)}else this.session.principal=C,h.serviceName&&this.session.activateService(h.serviceName),(0,T.trace)(`${M.SshAuthenticationType[m.authenticationType]} authentication succeeded.`),await this.session.sendMessage(new A.AuthenticationSuccessMessage,y);else await this.handleAuthenticationFailure(`${M.SshAuthenticationType[m.authenticationType]} authentication failed.`)}async handleAuthenticationFailure(h,m){this.authenticationFailureCount++,(0,T.trace)(h);const y=new A.AuthenticationFailureMessage;y.methodNames=["publickey","password","hostbased"],await this.session.sendMessage(y,m),this.authenticationFailureCount>=this.session.config.maxClientAuthenticationAttempts&&await this.session.close(R.SshDisconnectReason.noMoreAuthMethodsAvailable,"Authentication failed.")}async authenticateClient(h,m){var y,v,C,T;this.clientAuthenticationMethods=new I.Queue;for(let m of null!==(y=h.publicKeys)&&void 0!==y?y:[]){if(!m)continue;const y=null!==(v=h.username)&&void 0!==v?v:"";let C=m;const T=h.privateKeyProvider;this.clientAuthenticationMethods.enqueue(async h=>{if(!C.hasPrivateKey){if(null==T)throw new Error("A private key provider is required.");C=await T(m,null!=h?h:P.CancellationToken.None)}C?await this.requestPublicKeyAuthentication(y,C,h):await this.session.close(R.SshDisconnectReason.authCancelledByUser)})}const w=h.passwordProvider;if(w)this.clientAuthenticationMethods.enqueue(async h=>{var m;const y=w(null!=h?h:P.CancellationToken.None),v=y?await y:null;v?await this.requestPasswordAuthentication(null!==(m=v[0])&&void 0!==m?m:"",v[1],h):await this.session.close(R.SshDisconnectReason.authCancelledByUser)});else if(h.password){const m=null!==(C=h.username)&&void 0!==C?C:"",y=h.password;this.clientAuthenticationMethods.enqueue(async h=>{await this.requestPasswordAuthentication(m,y,h)})}if(0===this.clientAuthenticationMethods.size){const m=null!==(T=h.username)&&void 0!==T?T:"";this.clientAuthenticationMethods.enqueue(async h=>{await this.requestUsernameAuthentication(m,h)})}const A=this.clientAuthenticationMethods.dequeue();await A(m)}async requestUsernameAuthentication(h,m){const y=new A.AuthenticationRequestMessage;y.serviceName=N.ConnectionService.serviceName,y.methodName="none",y.username=h,await this.session.sendMessage(y,m),this.session.activateService(N.ConnectionService)}async requestPublicKeyAuthentication(h,m,y){const v=this.session.config.publicKeyAlgorithms.find(h=>(null==h?void 0:h.keyAlgorithmName)===m.keyAlgorithmName);if(!v)throw new Error(`Public key algorithm '${m.keyAlgorithmName}' is not in session config.`);const C=new A.PublicKeyRequestMessage;C.serviceName=N.ConnectionService.serviceName,C.username=h,C.keyAlgorithmName=v.name,C.publicKey=await m.getPublicKeyBytes(v.name),C.signature=await this.createAuthenticationSignature(C,v,m),await this.session.sendMessage(C,y),0===this.clientAuthenticationMethods.size&&this.session.activateService(N.ConnectionService)}async requestPasswordAuthentication(h,m,y){const v=new A.PasswordRequestMessage;v.serviceName=N.ConnectionService.serviceName,v.username=h,v.password=m,await this.session.sendMessage(v,y),this.session.activateService(N.ConnectionService)}handleFailureMessage(h){this.session.onAuthenticationComplete(!1)}handleSuccessMessage(h){this.session.activateService(N.ConnectionService),this.session.onAuthenticationComplete(!0)}async createAuthenticationSignature(h,m,y){const v=this.session.sessionId;if(null==v)throw new Error("Session ID not initialized.");const C=new k.SshDataWriter(Buffer.alloc(h.publicKey.length+(h.username||"").length+400));C.writeBinary(v),C.writeByte(h.messageType),C.writeString(h.username||"","utf8"),C.writeString(h.serviceName||"","ascii"),C.writeString("publickey","ascii"),C.writeBoolean(!0),C.writeString(h.keyAlgorithmName,"ascii"),C.writeBinary(h.publicKey);const T=m.createSigner(y),w=await T.sign(C.toBuffer());return m.createSignatureData(w)}};x.serviceName="ssh-userauth",x=v=C([(0,D.serviceActivation)({serviceRequest:v.serviceName})],x),m.AuthenticationService=x},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0}),m.SshAuthenticatingEventArgs=m.SshAuthenticationType=void 0;const v=y(6);var C;!function(h){h[h.clientNone=0]="clientNone",h[h.clientHostBased=1]="clientHostBased",h[h.clientPassword=2]="clientPassword",h[h.clientPublicKeyQuery=3]="clientPublicKeyQuery",h[h.clientPublicKey=4]="clientPublicKey",h[h.serverPublicKey=10]="serverPublicKey"}(C=m.SshAuthenticationType||(m.SshAuthenticationType={}));m.SshAuthenticatingEventArgs=class SshAuthenticatingEventArgs{constructor(h,{username:m,password:y,publicKey:T,clientHostname:w,clientUsername:A},P){this.authenticationType=h;const validate=({usernameRequired:h,passwordRequired:v,publicKeyRequired:C,clientHostnameRequired:P,clientUsernameRequired:k})=>"string"==typeof m==!!h&&("string"==typeof y==!!v&&(!!T==!!C&&("string"==typeof w==!!P&&"string"==typeof A==!!k)));let k;switch(h){case C.clientNone:k=validate({usernameRequired:!0});break;case C.clientHostBased:k=validate({usernameRequired:!0,publicKeyRequired:!0,clientHostnameRequired:!0,clientUsernameRequired:!0});break;case C.clientPassword:k=validate({usernameRequired:!0,passwordRequired:!0});break;case C.clientPublicKeyQuery:case C.clientPublicKey:k=validate({usernameRequired:!0,publicKeyRequired:!0});break;case C.serverPublicKey:k=validate({publicKeyRequired:!0});break;default:throw new Error(`Invalid authentication type: ${h}`)}if(!k)throw new Error(`Invalid arguments for authentication type: ${h}`);this.username=null!=m?m:null,this.password=null!=y?y:null,this.publicKey=null!=T?T:null,this.clientHostname=null!=w?w:null,this.clientUsername=null!=A?A:null,this.cancellationValue=null!=P?P:v.CancellationToken.None}get cancellation(){return this.cancellationValue}set cancellation(h){this.cancellationValue=h}toString(){return this.password?`${this.username?'"'+this.username+'" ':""}[password]`:this.publicKey?`${this.username?'"'+this.username+'" ':""}[${this.publicKey.keyAlgorithmName}]`:`"${this.username}"`}}},function(h,m,y){"use strict";var v=this&&this.__awaiter||function(h,m,y,v){return new(y||(y=Promise))((function(C,T){function fulfilled(h){try{step(v.next(h))}catch(h){T(h)}}function rejected(h){try{step(v.throw(h))}catch(h){T(h)}}function step(h){h.done?C(h.value):function adopt(h){return h instanceof y?h:new y((function(m){m(h)}))}(h.value).then(fulfilled,rejected)}step((v=v.apply(h,m||[])).next())}))};Object.defineProperty(m,"__esModule",{value:!0});const C=y(0),T=y(13),w=y(289),A=y(5),P=y(3),k=y(4);class ContactServiceManager extends T.EventEmitter{constructor(h,m,y){super(),this.serviceId=h,this.contactServiceProvider=m,this.contactManager=y,this._selfUser=null,this._capabilites={},this._availableUsers=[],this._suggestedUsers=[],this.signedState=k.contactProtocol.SignedStatus.None,this.queueEmitEvents=[],this.trace=A.traceSource.withName("Contact.Service")}request(h,m,y){return v(this,void 0,void 0,(function*(){this.trace.verbose(`Request '${h}' serviceId:${this.serviceId}`);try{return yield this.contactServiceProvider.requestAsync(h,m,y)}catch(m){throw this.trace.error(`Request '${h}' failed with error:${m} serviceId:${this.serviceId}`),m}}))}initialize(h,m){return v(this,void 0,void 0,(function*(){this.trace.verbose(`_Initialize:${this.serviceId}`),this.contactServiceProvider.onNotified(h=>this.onNotified(h.type,h.body));const y=yield this.request(k.contactProtocol.Methods.RequestInitializeName,{clientID:"vscode",workspaceFolders:C.workspace.workspaceFolders,enablePublish:h,publishPresence:m});this._descriptionName=y.description,this._capabilites=y.capabilities,this._providerPriority=y.providerPriority,y.selfContact&&this.setSelfUser({contact:y.selfContact}),y.signedState&&(this.signedState=y.signedState),this.initialized=!0,this.queueEmitEvents.length>0&&(this.trace.info(`flush events-> serviceId:${this.serviceId} count:${this.queueEmitEvents.length}`),this.queueEmitEvents.forEach(h=>this.emit(h.event,h.parameter)),this.queueEmitEvents=[]),this.emit(P.ContactServiceEvents.Initialized)}))}signIn(){return v(this,void 0,void 0,(function*(){this._capabilites&&this._capabilites.supportsSignedStateRequest&&(yield this.request(k.contactProtocol.Methods.RequestSignInName,{}))}))}signOut(){return v(this,void 0,void 0,(function*(){this._capabilites&&this._capabilites.supportsSignedStateRequest&&(yield this.request(k.contactProtocol.Methods.RequestSignOutName,{}))}))}_Dispose(){return v(this,void 0,void 0,(function*(){this._capabilites&&this._capabilites.supportsDispose&&(yield this.request(k.contactProtocol.Methods.RequestDisposeName,{}))}))}publishPresence(h,m){return v(this,void 0,void 0,(function*(){this._capabilites&&this._capabilites.supportsPublishPresence&&(yield this.request(k.contactProtocol.Methods.RequestPublishPresenceName,{status:h,properties:m}))}))}sendInviteLink(h,m){return v(this,void 0,void 0,(function*(){this._capabilites&&this._capabilites.supportsInviteLink&&(yield this.request(k.contactProtocol.Methods.RequestInviteName,{targetContactId:h,link:m}))}))}contactsPresenceRequest(h){return v(this,void 0,void 0,(function*(){if(this._capabilites&&!this._capabilites.supportsContactPresenceRequest)return{};const m=yield this.request(k.contactProtocol.Methods.RequestContactPresenceName,{contacts:h}),y={};return m.contacts.forEach(h=>y[h.contactId]=new w.ContactModelApi(this.serviceId,h.contact,h.properties?h.properties:{},this.contactManager)),y}))}contactsPresenceDispose(h){return v(this,void 0,void 0,(function*(){yield this.request(k.contactProtocol.Methods.RequestContactPresenceDisposeName,{contactIds:h})}))}searchContactsRequest(h,m,y){return v(this,void 0,void 0,(function*(){return(yield this.request(k.contactProtocol.Methods.RequestSearchContactsName,{queryOptions:h,maxCount:m},y)).results.map(h=>new w.ContactModelApi(this.serviceId,h,{},this.contactManager))}))}sendMessage(h,m,y,C){return v(this,void 0,void 0,(function*(){const v={targetContactId:h,type:m,body:y};yield this.request(k.contactProtocol.Methods.RequestSendMessageName,v,C)}))}get capabilites(){return this._capabilites}get descriptionName(){return this._descriptionName}get priority(){return void 0!==this._providerPriority?this._providerPriority:100}get selfUser(){return this._selfUser}get selfUserId(){return this._selfUser?this._selfUser.contact.id:null}get signedStatus(){return this.signedState}get availableUsers(){return this._availableUsers}lookupContactById(h){return this.availableUsers.concat(this._suggestedUsers).find(m=>m.contact.id===h)}findMatchContact(h){return ContactServiceManager.findMatchContact(this.availableUsers.concat(this._suggestedUsers),h)}static isOffline(h){return h.contact.status===k.contactProtocol.PresenceStatus.Unknown||h.contact.status===k.contactProtocol.PresenceStatus.Offline}emitEvent(h,m){this.initialized?this.emit(h,m):this.queueEmitEvents.push({event:h,parameter:m})}setSelfUser(h){var m;this._selfUser=new w.ContactModelApi(this.serviceId,h.contact,null!==(m=h.registrationInfo)&&void 0!==m?m:{},this.contactManager)}onNotified(h,m){switch(this.trace.verbose(`onNotified-> serviceId:${this.serviceId} name:${h}`),h){case k.contactProtocol.Methods.NotifySelfContactName:this.setSelfUser(m),this.emitEvent(P.ContactServiceEvents.SelfContactChanged);break;case k.contactProtocol.Methods.NotifyAvailableUsersName:const h=m;this._availableUsers=this.toContactModels(h),this.emitEvent(P.ContactServiceEvents.AvailableUsersChanged);break;case k.contactProtocol.Methods.NotifyAvailableUsersAddedName:const y=m;this._availableUsers.push(...this.toContactModels(y)),this.emitEvent(P.ContactServiceEvents.AvailableUsersChanged);break;case k.contactProtocol.Methods.NotifyAvailableUsersRemovedName:this.emitEvent(P.ContactServiceEvents.AvailableUsersChanged);break;case k.contactProtocol.Methods.NotifyPresenceChangedName:const v=m,C=[];v.changes.forEach(h=>this.updatePresenceStatus(h,C)),C.length>0&&this.emitEvent(P.ContactServiceEvents.ContactsChanged,C);const T={};v.changes.forEach(h=>{T[h.contactId]=[{property:k.contactProtocol.ContactProperty.Status,value:h.status}]}),this.emitEvent(P.ContactServiceEvents.ContactsChangedNotification,T);break;case k.contactProtocol.Methods.NotifyContactChangedName:const w=m,A=[],R=this.selfUser?[this.selfUser].concat(this.availableUsers):this.availableUsers;ContactServiceManager.updateContacts(R,w.changes,A),A.length>0&&this.emitEvent(P.ContactServiceEvents.ContactsChanged,A),this.emitEvent(P.ContactServiceEvents.ContactsChangedNotification,w.changes);break;case k.contactProtocol.Methods.NotifyContactPropertiesChangedName:const M=m;this.emitEvent(P.ContactServiceEvents.ContactPropertyChangedNotification,M);break;case k.contactProtocol.Methods.NotifyInviteReceivedName:const N=m;this.emitEvent(P.ContactServiceEvents.InviteLinkReceived,N);break;case k.contactProtocol.Methods.NotifyMessageReceivedName:const D=m;this.emitEvent(P.ContactServiceEvents.MessageReceived,D);break;case k.contactProtocol.Methods.NotifySuggestedUsersName:const I=m;this._suggestedUsers=this.toContactModels(I,50),this.emitEvent(P.ContactServiceEvents.SuggestedUsersUpdate,{contacts:this._suggestedUsers,exclusive:I.exclusive});break;case k.contactProtocol.Methods.NotifyCapabilitiesUpdateName:const x=this._capabilites,O=m;this._capabilites=O,this.emitEvent(P.ContactServiceEvents.CapabilitiesChanged,{oldCapabilities:x,newCapabilities:O}),!O.supportsSelfContact&&this._selfUser&&(this._selfUser=null,this.emitEvent(P.ContactServiceEvents.SelfContactChanged));break;case k.contactProtocol.Methods.NotifySignedStateChangedName:const L=m;this.signedState=L.state,this.emitEvent(P.ContactServiceEvents.SignedStateChanged,this.signedState);break;case k.contactProtocol.Methods.NotifyAuthenticationRequiredName:this.emitEvent(P.ContactServiceEvents.AuthenticationRequired)}}static updatePresenceStatus(h,m,y){const v={};m.forEach(h=>{v[h.contactId]=[{property:k.contactProtocol.ContactProperty.Status,value:h.status}]}),ContactServiceManager.updateContacts(h,v,y)}static updateContacts(h,m,y){Object.keys(m).forEach(v=>{const C=h.find(h=>h.contact.id===v);if(C){ContactServiceManager.updateContactChanges(C,m[v])&&y&&y.push(C)}})}static updateContactPropertyChanges(h,m){const y=Object.keys(m);y.forEach(y=>{h.properties[y]=m[y]}),h.fireChanged(...y)}static updateContactChanges(h,m){const y=h.contact,v=[];return m.forEach(h=>{if(h.value)switch(h.property){case k.contactProtocol.ContactProperty.Status:y.status!==h.value&&(y.status=h.value,v.push("status"));break;case k.contactProtocol.ContactProperty.Email:y.email!==h.value&&(y.email=h.value,v.push("email"));break;case k.contactProtocol.ContactProperty.AvatarUri:y.avatarUri!==h.value&&(y.avatarUri=h.value,v.push("avatarUri"));break;case k.contactProtocol.ContactProperty.DisplayName:y.displayName!==h.value&&(y.displayName=h.value,v.push("displayName"))}}),v.length>0&&h.fireChanged(...v),v.length>0}updatePresenceStatus(h,m){const y=this._selfUser&&this._selfUser.contact.id===h.contactId?[this._selfUser]:this.availableUsers;ContactServiceManager.updatePresenceStatus(y,[h],m)}toContactModels(h,m){let y=h.contacts;return m&&y.length>m&&(y=y.slice(0,m)),y.map(h=>(h.status||(h.status=k.contactProtocol.PresenceStatus.Unknown),new w.ContactModelApi(this.serviceId,h,{},this.contactManager)))}static findMatchContact(h,m){return h.find(h=>m.id===h.contact.id||m.email===h.contact.id)}}m.ContactServiceManager=ContactServiceManager},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0});const v=y(0);m.ContactModelApi=class ContactModelApi{constructor(h,m,y,C){this.serviceId=h,this.contact=m,this.properties=y,this.contactManager=C,this.onDidChangePropertyEmitter=new v.EventEmitter}get inviteStatus(){return this.contactManager.getInviteStatus(this.id)}get id(){return this.contact.id}fireChanged(...h){this.onDidChangePropertyEmitter.fire(h)}get onDidChangeProperty(){return this.onDidChangePropertyEmitter.event}}},function(h,m,y){"use strict";var v=this&&this.__awaiter||function(h,m,y,v){return new(y||(y=Promise))((function(C,T){function fulfilled(h){try{step(v.next(h))}catch(h){T(h)}}function rejected(h){try{step(v.throw(h))}catch(h){T(h)}}function step(h){h.done?C(h.value):function adopt(h){return h instanceof y?h:new y((function(m){m(h)}))}(h.value).then(fulfilled,rejected)}step((v=v.apply(h,m||[])).next())}))};Object.defineProperty(m,"__esModule",{value:!0});const C=y(0),T=y(4);m.ProviderBase=class ProviderBase{constructor(){this.onNotifiedEmitter=new C.EventEmitter}requestAsync(h,m,y){return v(this,void 0,void 0,(function*(){let y=null;switch(h){case T.contactProtocol.Methods.RequestInitializeName:y=yield this.requestInitialize(m);break;default:throw new Error(`type:${h} not supported`)}return y}))}get onNotified(){return this.onNotifiedEmitter.event}notify(h,m){this.onNotifiedEmitter.fire({type:h,body:m})}notifySuggestedUsers(h){this.notify(T.contactProtocol.Methods.NotifySuggestedUsersName,{contacts:h})}notifyPresenceChanged(h,m){const y=new T.contactProtocol.ContactPresenceUpdate;y.contactId=h,y.status=m;const v=new T.contactProtocol.PresenceChangedNotification;v.changes=[y],this.notify(T.contactProtocol.Methods.NotifyPresenceChangedName,v)}notifyContactChanged(h,m){const y={changes:{}};y.changes[h]=m,this.notify(T.contactProtocol.Methods.NotifyContactChangedName,y)}notifyContactPropertiesChanged(h,m){this.notify(T.contactProtocol.Methods.NotifyContactPropertiesChangedName,{contactId:h,changes:m})}notifySignedStateChanged(h){this.notify(T.contactProtocol.Methods.NotifySignedStateChangedName,{state:h})}}},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0});const v=y(3);m.setLivesharePresenceEnabled=h=>v.Settings.save(v.SettingKeys.presence,h),m.isLivesharePresenceEnabled=()=>!0===v.Settings.get(v.SettingKeys.presence),m.isSignalRServiceEnabled=()=>void 0!==v.Settings.getUri(v.SettingKeys.signalRServiceUri)},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0});var v=y(112);m.CommunicationsManager=v.CommunicationsManager;var C=y(1331);m.ChatTreeDataProvider=C.ChatTreeDataProvider;var T=y(1332);m.AudioTreeDataProvider=T.AudioTreeDataProvider;var w=y(1333);m.registerCommunicationsCommands=w.registerCommands;var A=y(1336);m.ChatService=A.ChatService},function(h,m,y){var v=y(1281),C=y(1282),T=y(1283);h.exports=function baseIndexOf(h,m,y){return m==m?T(h,m,y):v(h,C,y)}},function(h,m,y){var v=y(532).Symbol;h.exports=v},function(h,m){var y=Array.isArray;h.exports=y},function(h,m){h.exports=function(h){return h.webpackPolyfill||(h.deprecate=function(){},h.paths=[],h.children||(h.children=[]),Object.defineProperty(h,"loaded",{enumerable:!0,get:function(){return h.l}}),Object.defineProperty(h,"id",{enumerable:!0,get:function(){return h.i}}),h.webpackPolyfill=1),h}},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0});const v=y(13),C=y(5),T=y(8),w=y(3);var A,P,k;!function(h){h.AudioConnecting="AudioConnecting",h.AudioDisconnecting="AudioDisconnecting",h.Initializing="Initializing",h.LiveShareWithoutAudio="LiveShareWithoutAudio",h.LiveShareWithAudio="LiveShareWithAudio",h.NoLiveShare="NoLiveShare"}(A=m.AudioSessionState||(m.AudioSessionState={})),function(h){h[h.InitializeDone=0]="InitializeDone",h[h.LiveShareSessionStarted=1]="LiveShareSessionStarted",h[h.LiveShareSessionEnded=2]="LiveShareSessionEnded",h[h.AttemptConnectAudio=3]="AttemptConnectAudio",h[h.AttemptDisconnectAudio=4]="AttemptDisconnectAudio",h[h.AudioConnected=5]="AudioConnected",h[h.AudioDisconnected=6]="AudioDisconnected",h[h.AudioConnectionFailed=7]="AudioConnectionFailed"}(P=m.AudioSessionAction||(m.AudioSessionAction={})),m.sessionMachine={[A.Initializing]:{[P.InitializeDone]:A.NoLiveShare},[A.NoLiveShare]:{[P.LiveShareSessionStarted]:A.LiveShareWithoutAudio},[A.LiveShareWithoutAudio]:{[P.AttemptConnectAudio]:A.AudioConnecting,[P.AudioConnected]:A.LiveShareWithAudio,[P.LiveShareSessionEnded]:A.NoLiveShare},[A.AudioConnecting]:{[P.AudioConnected]:A.LiveShareWithAudio,[P.AudioDisconnected]:A.LiveShareWithoutAudio,[P.AudioConnectionFailed]:A.LiveShareWithoutAudio,[P.LiveShareSessionEnded]:A.NoLiveShare},[A.AudioDisconnecting]:{[P.AudioDisconnected]:A.LiveShareWithoutAudio,[P.AudioConnectionFailed]:A.LiveShareWithoutAudio,[P.LiveShareSessionEnded]:A.NoLiveShare},[A.LiveShareWithAudio]:{[P.AttemptDisconnectAudio]:A.AudioDisconnecting,[P.AudioDisconnected]:A.LiveShareWithoutAudio,[P.LiveShareSessionEnded]:A.NoLiveShare}},function(h){h.StateChanged="StateChanged"}(k=m.AudioSessionEvents||(m.AudioSessionEvents={}));class AudioSessionContext extends v.EventEmitter{constructor(){super(),this.currentState=A.Initializing,this.trace=C.traceSource.withName("Calling.AudioSessionContext")}static get Instance(){return AudioSessionContext.singleton||(AudioSessionContext.singleton=new AudioSessionContext),AudioSessionContext.singleton}get State(){return AudioSessionContext.Instance.currentState}transition(h){const y=m.sessionMachine[this.State];if(this.trace.verbose(`Current state: ${this.State}, Action: ${P[h]}`),y){const m=y[h];return void 0!==m?(AudioSessionContext.Instance.setState(m),AudioSessionContext.Instance.State):(T.Telemetry.sendTelemetryEvent(w.TelemetryEventNames.AUDIO_INVALID_SESSION_TRANSITION,{[w.TelemetryPropertyNames.AUDIO_SESSION_STATE]:this.State.toString(),[w.TelemetryPropertyNames.AUDIO_SESSION_ACTION]:h.toString()}),void this.trace.warning(`No transition exists for state: ${this.State}, action: ${P[h]}`))}this.trace.warning(`No config for the given state exists in the machine: action ${P[h]}`)}setState(h){const m=AudioSessionContext.Instance.currentState;m!==h&&(AudioSessionContext.Instance.currentState=h,AudioSessionContext.Instance.emit(k.StateChanged,h,m))}}const R=AudioSessionContext.Instance;m.AudioSessionContext=R},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0});var v=y(299);m.EventReason=v.EventReason;var C=y(1342);m.JoinDebugManager=C.JoinDebugManager;var T=y(1343);m.JoinDebugAdapterDescriptorFactory=T.JoinDebugAdapterDescriptorFactory;var w=y(1356);m.BreakpointManager=w.BreakpointManager,function __export(h){for(var y in h)m.hasOwnProperty(y)||(m[y]=h[y])}(y(304));var A=y(543);m.ShareDebugManagerBase=A.ShareDebugManagerBase;var P=y(544);m.DebugAdapterTrackerBase=P.DebugAdapterTrackerBase;var k=y(1357);m.TrackDebugManager=k.TrackDebugManager},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0}),function(h){h[h.None=1]="None",h[h.Go=2]="Go",h[h.AttachProgram=3]="AttachProgram",h[h.DetachProgram=4]="DetachProgram",h[h.LaunchProgram=5]="LaunchProgram",h[h.EndProgram=6]="EndProgram",h[h.StopDebugging=7]="StopDebugging",h[h.Step=8]="Step",h[h.Breakpoint=9]="Breakpoint",h[h.ExceptionThrown=10]="ExceptionThrown",h[h.ExceptionNotHandled=11]="ExceptionNotHandled",h[h.UserBreak=12]="UserBreak",h[h.ContextSwitch=13]="ContextSwitch"}(m.EventReason||(m.EventReason={}))},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0}),m.Handles=m.Response=m.Event=m.ErrorDestination=m.CompletionItem=m.Module=m.Source=m.Breakpoint=m.Variable=m.Scope=m.StackFrame=m.Thread=m.InvalidatedEvent=m.ProgressEndEvent=m.ProgressUpdateEvent=m.ProgressStartEvent=m.CapabilitiesEvent=m.LoadedSourceEvent=m.ModuleEvent=m.BreakpointEvent=m.ThreadEvent=m.OutputEvent=m.ContinuedEvent=m.StoppedEvent=m.ExitedEvent=m.TerminatedEvent=m.InitializedEvent=m.logger=m.Logger=m.LoggingDebugSession=m.DebugSession=void 0;const v=y(301);Object.defineProperty(m,"DebugSession",{enumerable:!0,get:function(){return v.DebugSession}}),Object.defineProperty(m,"InitializedEvent",{enumerable:!0,get:function(){return v.InitializedEvent}}),Object.defineProperty(m,"TerminatedEvent",{enumerable:!0,get:function(){return v.TerminatedEvent}}),Object.defineProperty(m,"ExitedEvent",{enumerable:!0,get:function(){return v.ExitedEvent}}),Object.defineProperty(m,"StoppedEvent",{enumerable:!0,get:function(){return v.StoppedEvent}}),Object.defineProperty(m,"ContinuedEvent",{enumerable:!0,get:function(){return v.ContinuedEvent}}),Object.defineProperty(m,"OutputEvent",{enumerable:!0,get:function(){return v.OutputEvent}}),Object.defineProperty(m,"ThreadEvent",{enumerable:!0,get:function(){return v.ThreadEvent}}),Object.defineProperty(m,"BreakpointEvent",{enumerable:!0,get:function(){return v.BreakpointEvent}}),Object.defineProperty(m,"ModuleEvent",{enumerable:!0,get:function(){return v.ModuleEvent}}),Object.defineProperty(m,"LoadedSourceEvent",{enumerable:!0,get:function(){return v.LoadedSourceEvent}}),Object.defineProperty(m,"CapabilitiesEvent",{enumerable:!0,get:function(){return v.CapabilitiesEvent}}),Object.defineProperty(m,"ProgressStartEvent",{enumerable:!0,get:function(){return v.ProgressStartEvent}}),Object.defineProperty(m,"ProgressUpdateEvent",{enumerable:!0,get:function(){return v.ProgressUpdateEvent}}),Object.defineProperty(m,"ProgressEndEvent",{enumerable:!0,get:function(){return v.ProgressEndEvent}}),Object.defineProperty(m,"InvalidatedEvent",{enumerable:!0,get:function(){return v.InvalidatedEvent}}),Object.defineProperty(m,"Thread",{enumerable:!0,get:function(){return v.Thread}}),Object.defineProperty(m,"StackFrame",{enumerable:!0,get:function(){return v.StackFrame}}),Object.defineProperty(m,"Scope",{enumerable:!0,get:function(){return v.Scope}}),Object.defineProperty(m,"Variable",{enumerable:!0,get:function(){return v.Variable}}),Object.defineProperty(m,"Breakpoint",{enumerable:!0,get:function(){return v.Breakpoint}}),Object.defineProperty(m,"Source",{enumerable:!0,get:function(){return v.Source}}),Object.defineProperty(m,"Module",{enumerable:!0,get:function(){return v.Module}}),Object.defineProperty(m,"CompletionItem",{enumerable:!0,get:function(){return v.CompletionItem}}),Object.defineProperty(m,"ErrorDestination",{enumerable:!0,get:function(){return v.ErrorDestination}});const C=y(1347);Object.defineProperty(m,"LoggingDebugSession",{enumerable:!0,get:function(){return C.LoggingDebugSession}});const T=y(303);m.Logger=T;const w=y(302);Object.defineProperty(m,"Event",{enumerable:!0,get:function(){return w.Event}}),Object.defineProperty(m,"Response",{enumerable:!0,get:function(){return w.Response}});const A=y(1355);Object.defineProperty(m,"Handles",{enumerable:!0,get:function(){return A.Handles}});const P=T.logger;m.logger=P},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0}),m.DebugSession=m.ErrorDestination=m.InvalidatedEvent=m.ProgressEndEvent=m.ProgressUpdateEvent=m.ProgressStartEvent=m.CapabilitiesEvent=m.LoadedSourceEvent=m.ModuleEvent=m.BreakpointEvent=m.ThreadEvent=m.OutputEvent=m.ExitedEvent=m.TerminatedEvent=m.InitializedEvent=m.ContinuedEvent=m.StoppedEvent=m.CompletionItem=m.Module=m.Breakpoint=m.Variable=m.Thread=m.StackFrame=m.Scope=m.Source=void 0;const v=y(1345),C=y(302),T=y(1346),w=y(20);m.Source=class Source{constructor(h,m,y=0,v,C){this.name=h,this.path=m,this.sourceReference=y,v&&(this.origin=v),C&&(this.adapterData=C)}};m.Scope=class Scope{constructor(h,m,y=!1){this.name=h,this.variablesReference=m,this.expensive=y}};m.StackFrame=class StackFrame{constructor(h,m,y,v=0,C=0){this.id=h,this.source=y,this.line=v,this.column=C,this.name=m}};m.Thread=class Thread{constructor(h,m){this.id=h,this.name=m||"Thread #"+h}};m.Variable=class Variable{constructor(h,m,y=0,v,C){this.name=h,this.value=m,this.variablesReference=y,"number"==typeof C&&(this.namedVariables=C),"number"==typeof v&&(this.indexedVariables=v)}};m.Breakpoint=class Breakpoint{constructor(h,m,y,v){this.verified=h;const C=this;"number"==typeof m&&(C.line=m),"number"==typeof y&&(C.column=y),v&&(C.source=v)}setId(h){this.id=h}};m.Module=class Module{constructor(h,m){this.id=h,this.name=m}};m.CompletionItem=class CompletionItem{constructor(h,m,y=0){this.label=h,this.start=m,this.length=y}};class StoppedEvent extends C.Event{constructor(h,m,y){super("stopped"),this.body={reason:h},"number"==typeof m&&(this.body.threadId=m),"string"==typeof y&&(this.body.text=y)}}m.StoppedEvent=StoppedEvent;class ContinuedEvent extends C.Event{constructor(h,m){super("continued"),this.body={threadId:h},"boolean"==typeof m&&(this.body.allThreadsContinued=m)}}m.ContinuedEvent=ContinuedEvent;class InitializedEvent extends C.Event{constructor(){super("initialized")}}m.InitializedEvent=InitializedEvent;class TerminatedEvent extends C.Event{constructor(h){if(super("terminated"),"boolean"==typeof h||h){this.body={restart:h}}}}m.TerminatedEvent=TerminatedEvent;class ExitedEvent extends C.Event{constructor(h){super("exited"),this.body={exitCode:h}}}m.ExitedEvent=ExitedEvent;class OutputEvent extends C.Event{constructor(h,m="console",y){super("output"),this.body={category:m,output:h},void 0!==y&&(this.body.data=y)}}m.OutputEvent=OutputEvent;class ThreadEvent extends C.Event{constructor(h,m){super("thread"),this.body={reason:h,threadId:m}}}m.ThreadEvent=ThreadEvent;class BreakpointEvent extends C.Event{constructor(h,m){super("breakpoint"),this.body={reason:h,breakpoint:m}}}m.BreakpointEvent=BreakpointEvent;class ModuleEvent extends C.Event{constructor(h,m){super("module"),this.body={reason:h,module:m}}}m.ModuleEvent=ModuleEvent;class LoadedSourceEvent extends C.Event{constructor(h,m){super("loadedSource"),this.body={reason:h,source:m}}}m.LoadedSourceEvent=LoadedSourceEvent;class CapabilitiesEvent extends C.Event{constructor(h){super("capabilities"),this.body={capabilities:h}}}m.CapabilitiesEvent=CapabilitiesEvent;class ProgressStartEvent extends C.Event{constructor(h,m,y){super("progressStart"),this.body={progressId:h,title:m},"string"==typeof y&&(this.body.message=y)}}m.ProgressStartEvent=ProgressStartEvent;class ProgressUpdateEvent extends C.Event{constructor(h,m){super("progressUpdate"),this.body={progressId:h},"string"==typeof m&&(this.body.message=m)}}m.ProgressUpdateEvent=ProgressUpdateEvent;class ProgressEndEvent extends C.Event{constructor(h,m){super("progressEnd"),this.body={progressId:h},"string"==typeof m&&(this.body.message=m)}}m.ProgressEndEvent=ProgressEndEvent;class InvalidatedEvent extends C.Event{constructor(h,m,y){super("invalidated"),this.body={},h&&(this.body.areas=h),m&&(this.body.threadId=m),y&&(this.body.stackFrameId=y)}}var A;m.InvalidatedEvent=InvalidatedEvent,function(h){h[h.User=1]="User",h[h.Telemetry=2]="Telemetry"}(A=m.ErrorDestination||(m.ErrorDestination={}));class DebugSession extends v.ProtocolServer{constructor(h,m){super();const y="boolean"==typeof h&&h;this._debuggerLinesStartAt1=y,this._debuggerColumnsStartAt1=y,this._debuggerPathsAreURIs=!1,this._clientLinesStartAt1=!0,this._clientColumnsStartAt1=!0,this._clientPathsAreURIs=!1,this._isServer="boolean"==typeof m&&m,this.on("close",()=>{this.shutdown()}),this.on("error",h=>{this.shutdown()})}setDebuggerPathFormat(h){this._debuggerPathsAreURIs="path"!==h}setDebuggerLinesStartAt1(h){this._debuggerLinesStartAt1=h}setDebuggerColumnsStartAt1(h){this._debuggerColumnsStartAt1=h}setRunAsServer(h){this._isServer=h}static run(h){(0,T.runDebugAdapter)(h)}shutdown(){this._isServer||this._isRunningInline()||setTimeout(()=>{process.exit(0)},100)}sendErrorResponse(h,m,y,v,C=A.User){let T;"number"==typeof m?(T={id:m,format:y},v&&(T.variables=v),C&A.User&&(T.showUser=!0),C&A.Telemetry&&(T.sendTelemetry=!0)):T=m,h.success=!1,h.message=DebugSession.formatPII(T.format,!0,T.variables),h.body||(h.body={}),h.body.error=T,this.sendResponse(h)}runInTerminalRequest(h,m,y){this.sendRequest("runInTerminal",h,m,y)}dispatchRequest(h){const m=new C.Response(h);try{if("initialize"===h.command){var y=h.arguments;if("boolean"==typeof y.linesStartAt1&&(this._clientLinesStartAt1=y.linesStartAt1),"boolean"==typeof y.columnsStartAt1&&(this._clientColumnsStartAt1=y.columnsStartAt1),"path"!==y.pathFormat)this.sendErrorResponse(m,2018,"debug adapter only supports native paths",null,A.Telemetry);else{const h=m;h.body={},this.initializeRequest(h,y)}}else"launch"===h.command?this.launchRequest(m,h.arguments,h):"attach"===h.command?this.attachRequest(m,h.arguments,h):"disconnect"===h.command?this.disconnectRequest(m,h.arguments,h):"terminate"===h.command?this.terminateRequest(m,h.arguments,h):"restart"===h.command?this.restartRequest(m,h.arguments,h):"setBreakpoints"===h.command?this.setBreakPointsRequest(m,h.arguments,h):"setFunctionBreakpoints"===h.command?this.setFunctionBreakPointsRequest(m,h.arguments,h):"setExceptionBreakpoints"===h.command?this.setExceptionBreakPointsRequest(m,h.arguments,h):"configurationDone"===h.command?this.configurationDoneRequest(m,h.arguments,h):"continue"===h.command?this.continueRequest(m,h.arguments,h):"next"===h.command?this.nextRequest(m,h.arguments,h):"stepIn"===h.command?this.stepInRequest(m,h.arguments,h):"stepOut"===h.command?this.stepOutRequest(m,h.arguments,h):"stepBack"===h.command?this.stepBackRequest(m,h.arguments,h):"reverseContinue"===h.command?this.reverseContinueRequest(m,h.arguments,h):"restartFrame"===h.command?this.restartFrameRequest(m,h.arguments,h):"goto"===h.command?this.gotoRequest(m,h.arguments,h):"pause"===h.command?this.pauseRequest(m,h.arguments,h):"stackTrace"===h.command?this.stackTraceRequest(m,h.arguments,h):"scopes"===h.command?this.scopesRequest(m,h.arguments,h):"variables"===h.command?this.variablesRequest(m,h.arguments,h):"setVariable"===h.command?this.setVariableRequest(m,h.arguments,h):"setExpression"===h.command?this.setExpressionRequest(m,h.arguments,h):"source"===h.command?this.sourceRequest(m,h.arguments,h):"threads"===h.command?this.threadsRequest(m,h):"terminateThreads"===h.command?this.terminateThreadsRequest(m,h.arguments,h):"evaluate"===h.command?this.evaluateRequest(m,h.arguments,h):"stepInTargets"===h.command?this.stepInTargetsRequest(m,h.arguments,h):"gotoTargets"===h.command?this.gotoTargetsRequest(m,h.arguments,h):"completions"===h.command?this.completionsRequest(m,h.arguments,h):"exceptionInfo"===h.command?this.exceptionInfoRequest(m,h.arguments,h):"loadedSources"===h.command?this.loadedSourcesRequest(m,h.arguments,h):"dataBreakpointInfo"===h.command?this.dataBreakpointInfoRequest(m,h.arguments,h):"setDataBreakpoints"===h.command?this.setDataBreakpointsRequest(m,h.arguments,h):"readMemory"===h.command?this.readMemoryRequest(m,h.arguments,h):"writeMemory"===h.command?this.writeMemoryRequest(m,h.arguments,h):"disassemble"===h.command?this.disassembleRequest(m,h.arguments,h):"cancel"===h.command?this.cancelRequest(m,h.arguments,h):"breakpointLocations"===h.command?this.breakpointLocationsRequest(m,h.arguments,h):"setInstructionBreakpoints"===h.command?this.setInstructionBreakpointsRequest(m,h.arguments,h):this.customRequest(h.command,m,h.arguments,h)}catch(h){this.sendErrorResponse(m,1104,"{_stack}",{_exception:h.message,_stack:h.stack},A.Telemetry)}}initializeRequest(h,m){h.body.supportsConditionalBreakpoints=!1,h.body.supportsHitConditionalBreakpoints=!1,h.body.supportsFunctionBreakpoints=!1,h.body.supportsConfigurationDoneRequest=!0,h.body.supportsEvaluateForHovers=!1,h.body.supportsStepBack=!1,h.body.supportsSetVariable=!1,h.body.supportsRestartFrame=!1,h.body.supportsStepInTargetsRequest=!1,h.body.supportsGotoTargetsRequest=!1,h.body.supportsCompletionsRequest=!1,h.body.supportsRestartRequest=!1,h.body.supportsExceptionOptions=!1,h.body.supportsValueFormattingOptions=!1,h.body.supportsExceptionInfoRequest=!1,h.body.supportTerminateDebuggee=!1,h.body.supportsDelayedStackTraceLoading=!1,h.body.supportsLoadedSourcesRequest=!1,h.body.supportsLogPoints=!1,h.body.supportsTerminateThreadsRequest=!1,h.body.supportsSetExpression=!1,h.body.supportsTerminateRequest=!1,h.body.supportsDataBreakpoints=!1,h.body.supportsReadMemoryRequest=!1,h.body.supportsDisassembleRequest=!1,h.body.supportsCancelRequest=!1,h.body.supportsBreakpointLocationsRequest=!1,h.body.supportsClipboardContext=!1,h.body.supportsSteppingGranularity=!1,h.body.supportsInstructionBreakpoints=!1,h.body.supportsExceptionFilterOptions=!1,this.sendResponse(h)}disconnectRequest(h,m,y){this.sendResponse(h),this.shutdown()}launchRequest(h,m,y){this.sendResponse(h)}attachRequest(h,m,y){this.sendResponse(h)}terminateRequest(h,m,y){this.sendResponse(h)}restartRequest(h,m,y){this.sendResponse(h)}setBreakPointsRequest(h,m,y){this.sendResponse(h)}setFunctionBreakPointsRequest(h,m,y){this.sendResponse(h)}setExceptionBreakPointsRequest(h,m,y){this.sendResponse(h)}configurationDoneRequest(h,m,y){this.sendResponse(h)}continueRequest(h,m,y){this.sendResponse(h)}nextRequest(h,m,y){this.sendResponse(h)}stepInRequest(h,m,y){this.sendResponse(h)}stepOutRequest(h,m,y){this.sendResponse(h)}stepBackRequest(h,m,y){this.sendResponse(h)}reverseContinueRequest(h,m,y){this.sendResponse(h)}restartFrameRequest(h,m,y){this.sendResponse(h)}gotoRequest(h,m,y){this.sendResponse(h)}pauseRequest(h,m,y){this.sendResponse(h)}sourceRequest(h,m,y){this.sendResponse(h)}threadsRequest(h,m){this.sendResponse(h)}terminateThreadsRequest(h,m,y){this.sendResponse(h)}stackTraceRequest(h,m,y){this.sendResponse(h)}scopesRequest(h,m,y){this.sendResponse(h)}variablesRequest(h,m,y){this.sendResponse(h)}setVariableRequest(h,m,y){this.sendResponse(h)}setExpressionRequest(h,m,y){this.sendResponse(h)}evaluateRequest(h,m,y){this.sendResponse(h)}stepInTargetsRequest(h,m,y){this.sendResponse(h)}gotoTargetsRequest(h,m,y){this.sendResponse(h)}completionsRequest(h,m,y){this.sendResponse(h)}exceptionInfoRequest(h,m,y){this.sendResponse(h)}loadedSourcesRequest(h,m,y){this.sendResponse(h)}dataBreakpointInfoRequest(h,m,y){this.sendResponse(h)}setDataBreakpointsRequest(h,m,y){this.sendResponse(h)}readMemoryRequest(h,m,y){this.sendResponse(h)}writeMemoryRequest(h,m,y){this.sendResponse(h)}disassembleRequest(h,m,y){this.sendResponse(h)}cancelRequest(h,m,y){this.sendResponse(h)}breakpointLocationsRequest(h,m,y){this.sendResponse(h)}setInstructionBreakpointsRequest(h,m,y){this.sendResponse(h)}customRequest(h,m,y,v){this.sendErrorResponse(m,1014,"unrecognized request",null,A.Telemetry)}convertClientLineToDebugger(h){return this._debuggerLinesStartAt1?this._clientLinesStartAt1?h:h+1:this._clientLinesStartAt1?h-1:h}convertDebuggerLineToClient(h){return this._debuggerLinesStartAt1?this._clientLinesStartAt1?h:h-1:this._clientLinesStartAt1?h+1:h}convertClientColumnToDebugger(h){return this._debuggerColumnsStartAt1?this._clientColumnsStartAt1?h:h+1:this._clientColumnsStartAt1?h-1:h}convertDebuggerColumnToClient(h){return this._debuggerColumnsStartAt1?this._clientColumnsStartAt1?h:h-1:this._clientColumnsStartAt1?h+1:h}convertClientPathToDebugger(h){return this._clientPathsAreURIs!==this._debuggerPathsAreURIs?this._clientPathsAreURIs?DebugSession.uri2path(h):DebugSession.path2uri(h):h}convertDebuggerPathToClient(h){return this._debuggerPathsAreURIs!==this._clientPathsAreURIs?this._debuggerPathsAreURIs?DebugSession.uri2path(h):DebugSession.path2uri(h):h}static path2uri(h){"win32"===process.platform&&(/^[A-Z]:/.test(h)&&(h=h[0].toLowerCase()+h.substr(1)),h=h.replace(/\\/g,"/")),h=encodeURI(h);let m=new w.URL("file:");return m.pathname=h,m.toString()}static uri2path(h){let m=new w.URL(h),y=decodeURIComponent(m.pathname);return"win32"===process.platform&&(/^\/[a-zA-Z]:/.test(y)&&(y=y[1].toLowerCase()+y.substr(2)),y=y.replace(/\//g,"\\")),y}static formatPII(h,m,y){return h.replace(DebugSession._formatPIIRegexp,(function(h,v){return m&&v.length>0&&"_"!==v[0]?h:y[v]&&y.hasOwnProperty(v)?y[v]:h}))}}m.DebugSession=DebugSession,DebugSession._formatPIIRegexp=/{([^}]+)}/g},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0}),m.Event=m.Response=m.Message=void 0;class Message{constructor(h){this.seq=0,this.type=h}}m.Message=Message;m.Response=class Response extends Message{constructor(h,m){super("response"),this.request_seq=h.seq,this.command=h.command,m?(this.success=!1,this.message=m):this.success=!0}};m.Event=class Event extends Message{constructor(h,m){super("event"),this.event=h,m&&(this.body=m)}}},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0}),m.trimLastNewline=m.LogOutputEvent=m.logger=m.Logger=m.LogLevel=void 0;const v=y(1348),C=y(301);var T;!function(h){h[h.Verbose=0]="Verbose",h[h.Log=1]="Log",h[h.Warn=2]="Warn",h[h.Error=3]="Error",h[h.Stop=4]="Stop"}(T=m.LogLevel||(m.LogLevel={}));class Logger{constructor(){this._pendingLogQ=[]}log(h,m=T.Log){h+="\n",this._write(h,m)}verbose(h){this.log(h,T.Verbose)}warn(h){this.log(h,T.Warn)}error(h){this.log(h,T.Error)}dispose(){if(this._currentLogger){const h=this._currentLogger.dispose();return this._currentLogger=null,h}return Promise.resolve()}_write(h,m=T.Log){h+="",this._pendingLogQ?this._pendingLogQ.push({msg:h,level:m}):this._currentLogger&&this._currentLogger.log(h,m)}setup(h,m,y=!0){const v="string"==typeof m?m:m&&this._logFilePathFromInit;if(this._currentLogger){const m={consoleMinLogLevel:h,logFilePath:v,prependTimestamp:y};this._currentLogger.setup(m).then(()=>{if(this._pendingLogQ){const h=this._pendingLogQ;this._pendingLogQ=null,h.forEach(h=>this._write(h.msg,h.level))}})}}init(h,m,y){this._pendingLogQ=this._pendingLogQ||[],this._currentLogger=new v.InternalLogger(h,y),this._logFilePathFromInit=m}}m.Logger=Logger,m.logger=new Logger;class LogOutputEvent extends C.OutputEvent{constructor(h,m){super(h,m===T.Error?"stderr":m===T.Warn?"console":"stdout")}}m.LogOutputEvent=LogOutputEvent,m.trimLastNewline=function trimLastNewline(h){return h.replace(/(\n|\r\n)$/,"")}},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0}),m.copyDebugSession=function copyDebugSession(h,m,y,v){h.sessionId=m.id,h.name=m.name,h.processId=void 0,h.capabilities=y,h.configurationProperties=v},m.getStackTrace=function getStackTrace(h,m,y){let v=void 0;const C=h.threadId.toString();if(m.stackFrames.hasOwnProperty(C)){const y=m.stackFrames[C];let T=h.startFrame?h.startFrame:0,w=T+(h.levels?h.levels:0);const verifyRange=m=>{if(!h.levels)return w=m.totalFrames,!0;m.totalFrames&&(T=Math.min(T,m.totalFrames),w=Math.min(w,m.totalFrames));const y=m.stackFrames.length;return T<=y&&w<=y},A=y.find(m=>(!h.format&&0===Object.keys(m.key).length||h.format&&JSON.stringify(h.format)===JSON.stringify(m.key))&&verifyRange(m.value));A&&(v={stackFrames:A.value.stackFrames.slice(T,w),totalFrames:w-T})}return v}},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0});var v=y(1360);m.ServerManager=v.ServerManager;var C=y(545);m.guestServerControllerFactory=C.guestServerControllerFactory;var T=y(547);m.hostServerControllerFactory=T.hostServerControllerFactory;var w=y(1393);m.portForwardingService=w.portForwardingService;var A=y(1395);m.workspaceHubPortFowardingServiceFactory=A.workspaceHubPortFowardingServiceFactory;var P=y(1406);m.ServerSharingService=P.ServerSharingService},function(h,m,y){"use strict";var v=this&&this.__awaiter||function(h,m,y,v){return new(y||(y=Promise))((function(C,T){function fulfilled(h){try{step(v.next(h))}catch(h){T(h)}}function rejected(h){try{step(v.throw(h))}catch(h){T(h)}}function step(h){h.done?C(h.value):function adopt(h){return h instanceof y?h:new y((function(m){m(h)}))}(h.value).then(fulfilled,rejected)}step((v=v.apply(h,m||[])).next())}))};Object.defineProperty(m,"__esModule",{value:!0});const C=y(0),T=y(8),w=y(3);class ExtensionContributions{constructor(h,m){this.packageInfo=h,this.trace=m,this.commands=new Map}static getContributions(h,m){let y=ExtensionContributions.map.get(h.fullName);return y||(y=new ExtensionContributions(h,m),ExtensionContributions.map.set(h.fullName,y)),y}registerCommand(h,m,y){const v=this.packageInfo.contributes;if(!v||!v.commands||!v.commands.find(m=>m.command===h))return void this.trace.warning("Command not declared in extension manifest: "+h);const C=v.commands.find(m=>m.command===h);if(!C["vsls-label"]||!C["vsls-detail"])return void this.trace.warning("Missing VSLS extended properties in extension manifest for command: "+h);return ExtensionContributions.extensionCommandRegistered||(w.ExtensionUtil.registerCommand("_liveshare.extensionCommand",h=>h.thisArg.invokeExtensionCommand(h.command)),ExtensionContributions.extensionCommandRegistered=!0),this.commands.set(h,{command:"_liveshare.extensionCommand",commandArg:{command:h,thisArg:this},label:C["vsls-label"],detail:C["vsls-detail"],enabled:m&&m.bind(y),description:""}),{dispose:()=>{this.commands.delete(h)}}}invokeExtensionCommand(h){return v(this,void 0,void 0,(function*(){return this.trace.verbose(`invoke(${h})`),this.sendInvokeCommandTelemetryEvent(h),yield C.commands.executeCommand(h)}))}static getQuickPickItems(){const h=[];for(let[m,y]of this.map)for(let[m,v]of y.commands)h.push(v);return h}sendInvokeCommandTelemetryEvent(h){T.Telemetry.sendTelemetryEvent(w.TelemetryEventNames.INVOKE_EXTENSION_COMMAND,{[w.TelemetryPropertyNames.EXTENSION_NAME]:this.packageInfo.fullName,[w.TelemetryPropertyNames.EXTENSION_VERSION]:this.packageInfo.version,[w.TelemetryPropertyNames.EXTENSION_INVOKED_COMMAND]:h})}}m.ExtensionContributions=ExtensionContributions,ExtensionContributions.map=new Map,ExtensionContributions.extensionCommandRegistered=!1},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0}),m.ServiceMoniker=void 0,function(h){h.create=function create(h,m){if(!h||""===h)throw new Error("name cannot be empty.");return Object.freeze({name:h,version:m})},h.equals=function equals(h,m){return h===m||!(!h||!m)&&(h.name===m.name&&h.version===m.version)}}(m.ServiceMoniker||(m.ServiceMoniker={}))},function(h,m,y){m.EncodeBuffer=EncodeBuffer;var v=y(309).preset;function EncodeBuffer(h){if(!(this instanceof EncodeBuffer))return new EncodeBuffer(h);if(h&&(this.options=h,h.codec)){var m=this.codec=h.codec;m.bufferish&&(this.bufferish=m.bufferish)}}y(563).FlexEncoder.mixin(EncodeBuffer.prototype),EncodeBuffer.prototype.codec=v,EncodeBuffer.prototype.write=function(h){this.codec.encode(this,h)}},function(h,m,y){var v=y(310).ExtBuffer,C=y(1372),T=y(1373),w=y(193);function init(){var h=this.options;return this.encode=function getEncoder(h){var m=T.getWriteType(h);return function encode(h,y){var v=m[typeof y];if(!v)throw new Error('Unsupported type "'+typeof y+'": '+y);v(h,y)}}(h),h&&h.preset&&C.setExtPackers(this),this}w.install({addExtPacker:function addExtPacker(h,m,y){y=w.filter(y);var C=m.name;if(C&&"Object"!==C){(this.extPackers||(this.extPackers={}))[C]=extPacker}else{(this.extEncoderList||(this.extEncoderList=[])).unshift([m,extPacker])}function extPacker(m){return y&&(m=y(m)),new v(m,h)}},getExtPacker:function getExtPacker(h){var m=this.extPackers||(this.extPackers={}),y=h.constructor,v=y&&y.name&&m[y.name];if(v)return v;for(var C=this.extEncoderList||(this.extEncoderList=[]),T=C.length,w=0;w<T;w++){var A=C[w];if(y===A[0])return A[1]}},init:init}),m.preset=init.call(w.preset)},function(h,m,y){m.ExtBuffer=function ExtBuffer(h,m){if(!(this instanceof ExtBuffer))return new ExtBuffer(h,m);this.buffer=v.from(h),this.type=m};var v=y(44)},function(h,m,y){var v=y(1371);m.copy=copy,m.slice=slice,m.toString=function toString(h,m,y){var T=!w&&C.isBuffer(this)?this.toString:v.toString;return T.apply(this,arguments)},m.write=function gen(h){return function wrap(){var m=this[h]||v[h];return m.apply(this,arguments)}}("write");var C=y(44),T=C.global,w=C.hasBuffer&&"TYPED_ARRAY_SUPPORT"in T,A=w&&!T.TYPED_ARRAY_SUPPORT;function copy(h,m,y,T){var w=C.isBuffer(this),P=C.isBuffer(h);if(w&&P)return this.copy(h,m,y,T);if(A||w||P||!C.isView(this)||!C.isView(h))return v.copy.call(this,h,m,y,T);var k=y||null!=T?slice.call(this,y,T):this;return h.set(k,m),k.length}function slice(h,m){var y=this.slice||!A&&this.subarray;if(y)return y.call(this,h,m);var v=C.alloc.call(this,m-h);return copy.call(this,v,0,h,m),v}},function(h,m,y){!function(h){var m,y="undefined"!=typeof Buffer&&Buffer,v="undefined"!=typeof Uint8Array&&Uint8Array,C="undefined"!=typeof ArrayBuffer&&ArrayBuffer,T=[0,0,0,0,0,0,0,0],w=Array.isArray||function _isArray(h){return!!h&&"[object Array]"==Object.prototype.toString.call(h)},A=4294967296;function factory(w,P,k){var R=P?0:4,M=P?4:0,N=P?0:3,D=P?1:2,I=P?2:1,x=P?3:0,O=P?fromPositiveBE:fromPositiveLE,L=P?fromNegativeBE:fromNegativeLE,U=Int64.prototype,B="is"+w,W="_"+B;return U.buffer=void 0,U.offset=0,U[W]=!0,U.toNumber=toNumber,U.toString=function toString(h){var m=this.buffer,y=this.offset,v=readInt32(m,y+R),C=readInt32(m,y+M),T="",w=!k&&2147483648&v;w&&(v=~v,C=A-C);h=h||10;for(;;){var P=v%h*A+C;if(v=Math.floor(v/h),C=Math.floor(P/h),T=(P%h).toString(h)+T,!v&&!C)break}w&&(T="-"+T);return T},U.toJSON=toNumber,U.toArray=toArray,y&&(U.toBuffer=toBuffer),v&&(U.toArrayBuffer=toArrayBuffer),Int64[B]=function isInt64(h){return!(!h||!h[W])},h[w]=Int64,Int64;function Int64(h,y,w,P){return this instanceof Int64?function init(h,y,w,P,k){v&&C&&(y instanceof C&&(y=new v(y)),P instanceof C&&(P=new v(P)));if(!(y||w||P||m))return void(h.buffer=newArray(T,0));if(!isValidBuffer(y,w)){k=w,P=y,w=0,y=new(m||Array)(8)}if(h.buffer=y,h.offset=w|=0,void 0===P)return;"string"==typeof P?function fromString(h,m,y,v){var C=0,T=y.length,w=0,P=0;"-"===y[0]&&C++;var k=C;for(;C<T;){var N=parseInt(y[C++],v);if(!(N>=0))break;P=P*v+N,w=w*v+Math.floor(P/A),P%=A}k&&(w=~w,P?P=A-P:w++);writeInt32(h,m+R,w),writeInt32(h,m+M,P)}(y,w,P,k||10):isValidBuffer(P,k)?fromArray(y,w,P,k):"number"==typeof k?(writeInt32(y,w+R,P),writeInt32(y,w+M,k)):P>0?O(y,w,P):P<0?L(y,w,P):fromArray(y,w,T,0)}(this,h,y,w,P):new Int64(h,y,w,P)}function toNumber(){var h=this.buffer,m=this.offset,y=readInt32(h,m+R),v=readInt32(h,m+M);return k||(y|=0),y?y*A+v:v}function writeInt32(h,m,y){h[m+x]=255&y,y>>=8,h[m+I]=255&y,y>>=8,h[m+D]=255&y,y>>=8,h[m+N]=255&y}function readInt32(h,m){return 16777216*h[m+N]+(h[m+D]<<16)+(h[m+I]<<8)+h[m+x]}}function toArray(h){var y=this.buffer,v=this.offset;return m=null,!1!==h&&0===v&&8===y.length&&w(y)?y:newArray(y,v)}function toBuffer(h){var v=this.buffer,C=this.offset;if(m=y,!1!==h&&0===C&&8===v.length&&Buffer.isBuffer(v))return v;var T=new y(8);return fromArray(T,0,v,C),T}function toArrayBuffer(h){var y=this.buffer,T=this.offset,w=y.buffer;if(m=v,!1!==h&&0===T&&w instanceof C&&8===w.byteLength)return w;var A=new v(8);return fromArray(A,0,y,T),A.buffer}function isValidBuffer(h,m){var y=h&&h.length;return m|=0,y&&m+8<=y&&"string"!=typeof h[m]}function fromArray(h,m,y,v){m|=0,v|=0;for(var C=0;C<8;C++)h[m++]=255&y[v++]}function newArray(h,m){return Array.prototype.slice.call(h,m,m+8)}function fromPositiveBE(h,m,y){for(var v=m+8;v>m;)h[--v]=255&y,y/=256}function fromNegativeBE(h,m,y){var v=m+8;for(y++;v>m;)h[--v]=255&-y^255,y/=256}function fromPositiveLE(h,m,y){for(var v=m+8;m<v;)h[m++]=255&y,y/=256}function fromNegativeLE(h,m,y){var v=m+8;for(y++;m<v;)h[m++]=255&-y^255,y/=256}factory("Uint64BE",!0,!0),factory("Int64BE",!0,!1),factory("Uint64LE",!1,!0),factory("Int64LE",!1,!1)}("string"!=typeof m.nodeName?m:this||{})},function(h,m,y){m.DecodeBuffer=DecodeBuffer;var v=y(314).preset;function DecodeBuffer(h){if(!(this instanceof DecodeBuffer))return new DecodeBuffer(h);if(h&&(this.options=h,h.codec)){var m=this.codec=h.codec;m.bufferish&&(this.bufferish=m.bufferish)}}y(563).FlexDecoder.mixin(DecodeBuffer.prototype),DecodeBuffer.prototype.codec=v,DecodeBuffer.prototype.fetch=function(){return this.codec.decode(this)}},function(h,m,y){var v=y(310).ExtBuffer,C=y(1375),T=y(565).readUint8,w=y(1376),A=y(193);function init(){var h=this.options;return this.decode=function getDecoder(h){var m=w.getReadToken(h);return function decode(h){var y=T(h),v=m[y];if(!v)throw new Error("Invalid type: "+(y?"0x"+y.toString(16):y));return v(h)}}(h),h&&h.preset&&C.setExtUnpackers(this),this}A.install({addExtUnpacker:function addExtUnpacker(h,m){(this.extUnpackers||(this.extUnpackers=[]))[h]=A.filter(m)},getExtUnpacker:function getExtUnpacker(h){return(this.extUnpackers||(this.extUnpackers=[]))[h]||function extUnpacker(m){return new v(m,h)}},init:init}),m.preset=init.call(A.preset)},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0});const v=y(148);m.FrameHeader=class FrameHeader{constructor(h,m){m&&v.requireInteger("channelId",m,4,"signed"),this.code=h,this.channelId=m}get requiredChannelId(){if(this.channelId)return this.channelId;throw new Error("Expected ChannelId not present in frame header.")}}},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0});const v=y(85),C=y(1386),T=y(13),w=y(568),A=y(569),P=y(192),k=y(315);y(317);const R=y(317),M=y(148),N=y(1387),D=y(558);class MultiplexingStream{constructor(h,m){var y,C;this._completionSource=new P.Deferred,this.openChannels={},this.channelsOfferedByThemByName={},this.acceptingChannels={},this.eventEmitter=new T.EventEmitter,this.disposalTokenSource=v.default.create(),this.defaultChannelReceivingWindowSize=null!==(y=m.defaultChannelReceivingWindowSize)&&void 0!==y?y:MultiplexingStream.recommendedDefaultChannelReceivingWindowSize,this.protocolMajorVersion=null!==(C=m.protocolMajorVersion)&&void 0!==C?C:1;const w=1==m.protocolMajorVersion?new N.MultiplexingStreamV1Formatter(h):2==m.protocolMajorVersion?new N.MultiplexingStreamV2Formatter(h):void 0;if(void 0===w)throw new Error(`Unsupported major protocol version: ${m.protocolMajorVersion}`);this.formatter=w}get disposalToken(){return this.disposalTokenSource.token}get completion(){return this._completionSource.promise}get isDisposed(){return this.disposalTokenSource.token.isCancelled}static async CreateAsync(h,m,y=v.default.CONTINUE){if(!h)throw new Error("stream must be specified.");(m=m||new R.MultiplexingStreamOptions).protocolMajorVersion=m.protocolMajorVersion||1,m.defaultChannelReceivingWindowSize=m.defaultChannelReceivingWindowSize||MultiplexingStream.recommendedDefaultChannelReceivingWindowSize;const C=1==m.protocolMajorVersion?new N.MultiplexingStreamV1Formatter(h):2==m.protocolMajorVersion?new N.MultiplexingStreamV2Formatter(h):void 0;if(!C)throw new Error(`Protocol major version ${m.protocolMajorVersion} is not supported.`);const T=await C.writeHandshakeAsync(),w=await C.readHandshakeAsync(T,y);return new MultiplexingStreamClass(h,w.isOdd,m)}createChannel(h){var m;const y={name:"",remoteWindowSize:null!==(m=null==h?void 0:h.channelReceivingWindowSize)&&void 0!==m?m:this.defaultChannelReceivingWindowSize},v=this.formatter.serializeOfferParameters(y),C=new w.ChannelClass(this,!0,this.getUnusedChannelId(),y);return this.openChannels[C.id]=C,this.rejectOnFailure(this.sendFrameAsync(new k.FrameHeader(A.ControlCode.Offer,C.id),v,this.disposalToken)),C}acceptChannel(h,m){const y=this.openChannels[h];if(!y)throw new Error("No channel with ID "+h);return this.removeChannelFromOfferedQueue(y),this.acceptChannelOrThrow(y,m),y}rejectChannel(h){const m=this.openChannels[h];if(!m)throw new Error("No channel with that ID found.");M.removeFromQueue(m,this.channelsOfferedByThemByName[m.name]),C(m.acceptance),C(m.completion),m.dispose()}async offerChannelAsync(h,m,y=v.default.CONTINUE){var T;if(null==h)throw new Error("Name must be specified (but may be empty).");y.throwIfCancelled(),M.throwIfDisposed(this);const P={name:h,remoteWindowSize:null!==(T=null==m?void 0:m.channelReceivingWindowSize)&&void 0!==T?T:this.defaultChannelReceivingWindowSize},R=this.formatter.serializeOfferParameters(P),N=new w.ChannelClass(this,!0,this.getUnusedChannelId(),P);this.openChannels[N.id]=N;const D=new k.FrameHeader(A.ControlCode.Offer,N.id),I=y.onCancelled(h=>this.offerChannelCanceled(N,h));try{return C(N.acceptance),await this.sendFrameAsync(D,R,y),await N.acceptance,N}finally{I()}}async acceptChannelAsync(h,m,y=v.default.CONTINUE){if(null==h)throw new Error("Name must be specified (but may be empty).");let C,T;y.throwIfCancelled(),M.throwIfDisposed(this);const w=this.channelsOfferedByThemByName[h];if(w)for(;void 0===C&&w.length>0;)C=w.shift(),(C.isAccepted||C.isRejectedOrCanceled)&&(C=void 0);if(void 0===C){let y=this.acceptingChannels[h];y||(this.acceptingChannels[h]=y=[]),T=new P.Deferred(m),y.push(T)}if(void 0!==C)return this.acceptChannelOrThrow(C,m),C;{const m=y.onCancelled(m=>this.acceptChannelCanceled(T,h,m));try{return await T.promise}finally{m()}}}dispose(){this.disposalTokenSource.cancel(),this._completionSource.resolve(),this.formatter.end();for(const h in this.openChannels){const m=this.openChannels[h];C(m.acceptance),m.dispose()}}on(h,m){this.eventEmitter.on(h,m)}off(h,m){this.eventEmitter.off(h,m)}once(h,m){this.eventEmitter.once(h,m)}raiseChannelOffered(h,m,y){const v={id:h,isAccepted:y,name:m};try{this.eventEmitter.emit("channelOffered",v)}catch(h){this._completionSource.reject(h)}}acceptChannelOrThrow(h,m){var y,v;if(!h.tryAcceptOffer(m))throw h.isAccepted?new Error("Channel is already accepted."):h.isRejectedOrCanceled?new Error("Channel is no longer available for acceptance."):new Error("Channel could not be accepted.");{const C={remoteWindowSize:null!==(v=null!==(y=null==m?void 0:m.channelReceivingWindowSize)&&void 0!==y?y:h.localWindowSize)&&void 0!==v?v:this.defaultChannelReceivingWindowSize};C.remoteWindowSize<this.defaultChannelReceivingWindowSize&&(C.remoteWindowSize=this.defaultChannelReceivingWindowSize);const T=this.formatter.serializerAcceptanceParameters(C);this.rejectOnFailure(this.sendFrameAsync(new k.FrameHeader(A.ControlCode.OfferAccepted,h.id),T,this.disposalToken))}}async rejectOnFailure(h){try{await h}catch(h){this._completionSource.reject(h)}}removeChannelFromOfferedQueue(h){h.name&&M.removeFromQueue(h,this.channelsOfferedByThemByName[h.name])}acceptChannelCanceled(h,m,y){h.reject(new v.default.CancellationError(y))&&M.removeFromQueue(h,this.acceptingChannels[m])}offerChannelCanceled(h,m){h.tryCancelOffer(m)}getUnusedChannelId(){return this.lastOfferedChannelId+=2}}m.MultiplexingStream=MultiplexingStream,MultiplexingStream.framePayloadMaxLength=20480,MultiplexingStream.recommendedDefaultChannelReceivingWindowSize=5*MultiplexingStream.framePayloadMaxLength,MultiplexingStream.defaultChannelOptions={},MultiplexingStream.ControlFrameEncoding="utf-8";class MultiplexingStreamClass extends MultiplexingStream{constructor(h,m,y){super(h,y),this.sendingSemaphore=new D.Semaphore(1),this.lastOfferedChannelId=m?-1:0,this.readFromStream(this.disposalToken).catch(h=>this._completionSource.reject(h))}get backpressureSupportEnabled(){return this.protocolMajorVersion>1}async sendFrameAsync(h,m,y=v.default.CONTINUE){if(!h)throw new Error("Header is required.");await this.sendingSemaphore.use(async()=>{y.throwIfCancelled(),M.throwIfDisposed(this),await this.formatter.writeFrameAsync(h,m)})}async sendFrame(h,m){try{if(this._completionSource.isCompleted)return;const y=new k.FrameHeader(h,m);await this.sendFrameAsync(y)}catch(h){this._completionSource.reject(h)}}onChannelWritingCompleted(h){!h.isDisposed&&this.openChannels[h.id]&&this.sendFrame(A.ControlCode.ContentWritingCompleted,h.id)}onChannelDisposed(h){this._completionSource.isCompleted||this.sendFrame(A.ControlCode.ChannelTerminated,h.id)}localContentExamined(h,m){const y=this.formatter.serializeContentProcessed(m);this.rejectOnFailure(this.sendFrameAsync(new k.FrameHeader(A.ControlCode.ContentProcessed,h.id),y))}async readFromStream(h){for(;!this.isDisposed;){const m=await this.formatter.readFrameAsync(h);if(null===m)break;switch(m.header.code){case A.ControlCode.Offer:this.onOffer(m.header.requiredChannelId,m.payload);break;case A.ControlCode.OfferAccepted:this.onOfferAccepted(m.header.requiredChannelId,m.payload);break;case A.ControlCode.Content:this.onContent(m.header.requiredChannelId,m.payload);break;case A.ControlCode.ContentProcessed:this.onContentProcessed(m.header.requiredChannelId,m.payload);break;case A.ControlCode.ContentWritingCompleted:this.onContentWritingCompleted(m.header.requiredChannelId);break;case A.ControlCode.ChannelTerminated:this.onChannelTerminated(m.header.requiredChannelId)}}this.dispose()}onOffer(h,m){const y=this.formatter.deserializeOfferParameters(m),v=new w.ChannelClass(this,!1,h,y);let C,T,A=!1;if(void 0!==(T=this.acceptingChannels[y.name]))for(;T.length>0;){const h=T.shift();if(h.resolve(v)){A=!0,C=h.state;break}}if(!A&&null!=y.name){let h;(h=this.channelsOfferedByThemByName[y.name])||(this.channelsOfferedByThemByName[y.name]=h=[]),h.push(v)}this.openChannels[h]=v,A&&this.acceptChannelOrThrow(v,C),this.raiseChannelOffered(v.id,v.name,A)}onOfferAccepted(h,m){const y=this.formatter.deserializerAcceptanceParameters(m),v=this.openChannels[h];if(!v)throw new Error("Unexpected channel created with ID "+h);v.onAccepted(y)}onContent(h,m){this.openChannels[h].onContent(m)}onContentProcessed(h,m){const y=this.openChannels[h],v=this.formatter.deserializeContentProcessed(m);y.onContentProcessed(v)}onContentWritingCompleted(h){this.openChannels[h].onContent(null)}onChannelTerminated(h){const m=this.openChannels[h];m&&(delete this.openChannels[h],this.removeChannelFromOfferedQueue(m),m.dispose())}}m.MultiplexingStreamClass=MultiplexingStreamClass},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0});m.MultiplexingStreamOptions=class MultiplexingStreamOptions{}},function(h,m,y){"use strict";var v=this&&this.__importStar||function(h){if(h&&h.__esModule)return h;var m={};if(null!=h)for(var y in h)Object.hasOwnProperty.call(h,y)&&(m[y]=h[y]);return m.default=h,m};Object.defineProperty(m,"__esModule",{value:!0});const C=v(y(18)),T=v(y(7)),w=v(y(11)),A=y(2);m.vscodeModule=A.once(()=>y(0)),m.getExtension=h=>m.vscodeModule().extensions.getExtension(h),m.getAppFilePath=function getAppFilePath(h,y){const v=m.getExtension(y);return A.assertDefined(v,`No extension "${y}" found.`),T.join(v.extensionPath,h)},m.getAgentPipeName=function getAgentPipeName(h,m,y){return`${m}.${w.createHash("md5").update(h+C.userInfo().username+(y||"")).digest("hex")}`}},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0});var v=y(194);m.commentsSupported=v.commentsSupported,m.commentManagerFactory=v.commentManagerFactory;var C=y(579);m.HostCommentService=C.HostCommentService;var T=y(1445);m.CommentsTreeDataProvider=T.CommentsTreeDataProvider,m.CommentsViewItem=T.CommentsViewItem;var w=y(1446);m.HostCoauthorCommitMessageUpdater=w.HostCoauthorCommitMessageUpdater;var A=y(1447);m.HostSourceControlService=A.HostSourceControlService;var P=y(1450);m.reviewsDependencies=P.dependencies},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0});const v=y(41),C=y(21),T=y(115),w=y(0),A=y(30),P=y(1437),k=y(1438),R=y(1439),M=y(1440),N=y(1441),D=y(1442),I=y(72),x=y(1443),O=y(1444);var L,U,B,W,q,Y,V;!function __export(h){for(var y in h)m.hasOwnProperty(y)||(m[y]=h[y])}(y(115)),function(h){h.is=function is(h){return I.string(h.command)}}(L||(L={})),function(h){h[h.stdio=0]="stdio",h[h.ipc=1]="ipc",h[h.pipe=2]="pipe",h[h.socket=3]="socket"}(U=m.TransportKind||(m.TransportKind={})),function(h){h.isSocket=function isSocket(h){let m=h;return m&&m.kind===U.socket&&I.number(m.port)}}(B||(B={})),function(h){h.is=function is(h){return I.string(h.module)}}(W||(W={})),function(h){h.is=function is(h){let m=h;return m&&void 0!==m.writer&&void 0!==m.reader}}(q||(q={})),function(h){h.is=function is(h){let m=h;return m&&void 0!==m.process&&"boolean"==typeof m.detached}}(Y||(Y={}));class LanguageClient extends T.BaseLanguageClient{constructor(h,m,y,v,C){let T,w,A,P,k;I.string(m)?(T=h,w=m,A=y,P=v,k=!!C):(T=h.toLowerCase(),w=h,A=m,P=y,k=v),void 0===k&&(k=!1),super(T,w,P),this._serverOptions=A,this._forceDebug=k}stop(){return super.stop().then(()=>{if(this._serverProcess){let h=this._serverProcess;this._serverProcess=void 0,void 0!==this._isDetached&&this._isDetached||this.checkProcessDied(h),this._isDetached=void 0}})}checkProcessDied(h){h&&setTimeout(()=>{try{process.kill(h.pid,0),O.terminate(h)}catch(h){}},2e3)}handleConnectionClosed(){this._serverProcess=void 0,super.handleConnectionClosed()}createMessageTransports(h){let m,y=this._serverOptions;if(I.func(y))return y().then(m=>{if(T.MessageTransports.is(m))return this._isDetached=!!m.detached,m;if(q.is(m))return this._isDetached=!!m.detached,{reader:new A.StreamMessageReader(m.reader),writer:new A.StreamMessageWriter(m.writer)};{let y;return Y.is(m)?(y=m.process,this._isDetached=m.detached):(y=m,this._isDetached=!1),y.stderr.on("data",m=>this.outputChannel.append(I.string(m)?m:m.toString(h))),{reader:new A.StreamMessageReader(y.stdout),writer:new A.StreamMessageWriter(y.stdin)}}});let C=y;return m=C.run||C.debug?"object"==typeof v8debug||this._forceDebug||function startedInDebugMode(){let h=process.execArgv;return!!h&&h.some(h=>/^--debug=?/.test(h)||/^--debug-brk=?/.test(h)||/^--inspect=?/.test(h)||/^--inspect-brk=?/.test(h))}()?C.debug:C.run:y,this._getServerWorkingDir(m.options).then(C=>{if(W.is(m)&&m.module){let y=m,T=y.transport||U.stdio;if(!y.runtime){let m=void 0;return new Promise((v,w)=>{let P=y.args&&y.args.slice()||[];T===U.ipc?P.push("--node-ipc"):T===U.stdio?P.push("--stdio"):T===U.pipe?(m=A.generateRandomPipeName(),P.push(`--pipe=${m}`)):B.isSocket(T)&&P.push(`--socket=${T.port}`),P.push(`--clientProcessId=${process.pid.toString()}`);let k=y.options||Object.create(null);k.execArgv=k.execArgv||[],k.cwd=C,T===U.ipc||T===U.stdio?x.fork(y.module,P||[],k,(m,y)=>{m||!y?w(m):(this._serverProcess=y,y.stderr.on("data",m=>this.outputChannel.append(I.string(m)?m:m.toString(h))),T===U.ipc?(y.stdout.on("data",m=>this.outputChannel.append(I.string(m)?m:m.toString(h))),v({reader:new A.IPCMessageReader(this._serverProcess),writer:new A.IPCMessageWriter(this._serverProcess)})):v({reader:new A.StreamMessageReader(y.stdout),writer:new A.StreamMessageWriter(y.stdin)}))}):T===U.pipe?A.createClientPipeTransport(m).then(m=>{x.fork(y.module,P||[],k,(y,C)=>{y||!C?w(y):(this._serverProcess=C,C.stderr.on("data",m=>this.outputChannel.append(I.string(m)?m:m.toString(h))),C.stdout.on("data",m=>this.outputChannel.append(I.string(m)?m:m.toString(h))),m.onConnected().then(h=>{v({reader:h[0],writer:h[1]})}))})}):B.isSocket(T)&&A.createClientSocketTransport(T.port).then(m=>{x.fork(y.module,P||[],k,(y,C)=>{y||!C?w(y):(this._serverProcess=C,C.stderr.on("data",m=>this.outputChannel.append(I.string(m)?m:m.toString(h))),C.stdout.on("data",m=>this.outputChannel.append(I.string(m)?m:m.toString(h))),m.onConnected().then(h=>{v({reader:h[0],writer:h[1]})}))})})})}{let m=[],w=y.options||Object.create(null);w.execArgv&&w.execArgv.forEach(h=>m.push(h)),m.push(y.module),y.args&&y.args.forEach(h=>m.push(h));let P=Object.create(null);P.cwd=C,P.env=function getEnvironment(h){if(!h)return process.env;let m=Object.create(null);return Object.keys(process.env).forEach(h=>m[h]=process.env[h]),Object.keys(h).forEach(y=>m[y]=h[y]),m}(w.env);let k=void 0;if(T===U.ipc?(P.stdio=[null,null,null,"ipc"],m.push("--node-ipc")):T===U.stdio?m.push("--stdio"):T===U.pipe?(k=A.generateRandomPipeName(),m.push(`--pipe=${k}`)):B.isSocket(T)&&m.push(`--socket=${T.port}`),m.push(`--clientProcessId=${process.pid.toString()}`),T===U.ipc||T===U.stdio){let C=v.spawn(y.runtime,m,P);return C&&C.pid?(this._serverProcess=C,C.stderr.on("data",m=>this.outputChannel.append(I.string(m)?m:m.toString(h))),T===U.ipc?(C.stdout.on("data",m=>this.outputChannel.append(I.string(m)?m:m.toString(h))),Promise.resolve({reader:new A.IPCMessageReader(C),writer:new A.IPCMessageWriter(C)})):Promise.resolve({reader:new A.StreamMessageReader(C.stdout),writer:new A.StreamMessageWriter(C.stdin)})):Promise.reject(`Launching server using runtime ${y.runtime} failed.`)}if(T==U.pipe)return A.createClientPipeTransport(k).then(C=>{let T=v.spawn(y.runtime,m,P);return T&&T.pid?(this._serverProcess=T,T.stderr.on("data",m=>this.outputChannel.append(I.string(m)?m:m.toString(h))),T.stdout.on("data",m=>this.outputChannel.append(I.string(m)?m:m.toString(h))),C.onConnected().then(h=>({reader:h[0],writer:h[1]}))):Promise.reject(`Launching server using runtime ${y.runtime} failed.`)});if(B.isSocket(T))return A.createClientSocketTransport(T.port).then(C=>{let T=v.spawn(y.runtime,m,P);return T&&T.pid?(this._serverProcess=T,T.stderr.on("data",m=>this.outputChannel.append(I.string(m)?m:m.toString(h))),T.stdout.on("data",m=>this.outputChannel.append(I.string(m)?m:m.toString(h))),C.onConnected().then(h=>({reader:h[0],writer:h[1]}))):Promise.reject(`Launching server using runtime ${y.runtime} failed.`)})}}else if(L.is(m)&&m.command){let y=m,T=y.args||[],w=Object.assign({},y.options);w.cwd=w.cwd||C;let P=v.spawn(y.command,T,w);return P&&P.pid?(P.stderr.on("data",m=>this.outputChannel.append(I.string(m)?m:m.toString(h))),this._serverProcess=P,this._isDetached=!!w.detached,Promise.resolve({reader:new A.StreamMessageReader(P.stdout),writer:new A.StreamMessageWriter(P.stdin)})):Promise.reject(`Launching server using command ${y.command} failed.`)}return Promise.reject(new Error("Unsupported server configuration "+JSON.stringify(y,null,4)))})}registerProposedFeatures(){this.registerFeatures(V.createAll(this))}registerBuiltinFeatures(){super.registerBuiltinFeatures(),this.registerFeature(new k.ConfigurationFeature(this)),this.registerFeature(new M.TypeDefinitionFeature(this)),this.registerFeature(new R.ImplementationFeature(this)),this.registerFeature(new P.ColorProviderFeature(this)),this.registerFeature(new N.WorkspaceFoldersFeature(this)),this.registerFeature(new D.FoldingRangeFeature(this))}_mainGetRootPath(){let h=w.workspace.workspaceFolders;if(!h||0===h.length)return;let m=h[0];return"file"===m.uri.scheme?m.uri.fsPath:void 0}_getServerWorkingDir(h){let m=h&&h.cwd;return m||(m=this.clientOptions.workspaceFolder?this.clientOptions.workspaceFolder.uri.fsPath:this._mainGetRootPath()),m?new Promise(h=>{C.lstat(m,(y,v)=>{h(!y&&v.isDirectory()?m:void 0)})}):Promise.resolve(void 0)}}m.LanguageClient=LanguageClient;m.SettingMonitor=class SettingMonitor{constructor(h,m){this._client=h,this._setting=m,this._listeners=[]}start(){return w.workspace.onDidChangeConfiguration(this.onDidChangeConfiguration,this,this._listeners),this.onDidChangeConfiguration(),new w.Disposable(()=>{this._client.needsStop()&&this._client.stop()})}onDidChangeConfiguration(){let h=this._setting.indexOf("."),m=h>=0?this._setting.substr(0,h):this._setting,y=h>=0?this._setting.substr(h+1):void 0,v=y?w.workspace.getConfiguration(m).get(y,!1):w.workspace.getConfiguration(m);v&&this._client.needsStart()?this._client.start():!v&&this._client.needsStop()&&this._client.stop()}},function(h){h.createAll=function createAll(h){return[]}}(V=m.ProposedFeatures||(m.ProposedFeatures={}))},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0});const v=y(195),C=y(149);let T=Buffer.from("\r","ascii")[0],w=Buffer.from("\n","ascii")[0];class MessageBuffer{constructor(h="utf8"){this.encoding=h,this.index=0,this.buffer=Buffer.allocUnsafe(8192)}append(h){var m=h;if("string"==typeof h){var y=h,v=Buffer.byteLength(y,this.encoding);(m=Buffer.allocUnsafe(v)).write(y,0,v,this.encoding)}if(this.buffer.length-this.index>=m.length)m.copy(this.buffer,this.index,0,m.length);else{var C=8192*(Math.ceil((this.index+m.length)/8192)+1);0===this.index?(this.buffer=Buffer.allocUnsafe(C),m.copy(this.buffer,0,0,m.length)):this.buffer=Buffer.concat([this.buffer.slice(0,this.index),m],C)}this.index+=m.length}tryReadHeaders(){let h=void 0,m=0;for(;m+3<this.index&&(this.buffer[m]!==T||this.buffer[m+1]!==w||this.buffer[m+2]!==T||this.buffer[m+3]!==w);)m++;if(m+3>=this.index)return h;h=Object.create(null),this.buffer.toString("ascii",0,m).split("\r\n").forEach(m=>{let y=m.indexOf(":");if(-1===y)throw new Error("Message header must separate key and value using :");let v=m.substr(0,y),C=m.substr(y+1).trim();h[v]=C});let y=m+4;return this.buffer=this.buffer.slice(y),this.index=this.index-y,h}tryReadContent(h){if(this.index<h)return null;let m=this.buffer.toString(this.encoding,0,h),y=h;return this.buffer.copy(this.buffer,0,y),this.index=this.index-y,m}get numberOfBytes(){return this.index}}!function(h){h.is=function is(h){let m=h;return m&&C.func(m.listen)&&C.func(m.dispose)&&C.func(m.onError)&&C.func(m.onClose)&&C.func(m.onPartialMessage)}}(m.MessageReader||(m.MessageReader={}));class AbstractMessageReader{constructor(){this.errorEmitter=new v.Emitter,this.closeEmitter=new v.Emitter,this.partialMessageEmitter=new v.Emitter}dispose(){this.errorEmitter.dispose(),this.closeEmitter.dispose()}get onError(){return this.errorEmitter.event}fireError(h){this.errorEmitter.fire(this.asError(h))}get onClose(){return this.closeEmitter.event}fireClose(){this.closeEmitter.fire(void 0)}get onPartialMessage(){return this.partialMessageEmitter.event}firePartialMessage(h){this.partialMessageEmitter.fire(h)}asError(h){return h instanceof Error?h:new Error(`Reader received error. Reason: ${C.string(h.message)?h.message:"unknown"}`)}}m.AbstractMessageReader=AbstractMessageReader;class StreamMessageReader extends AbstractMessageReader{constructor(h,m="utf8"){super(),this.readable=h,this.buffer=new MessageBuffer(m),this._partialMessageTimeout=1e4}set partialMessageTimeout(h){this._partialMessageTimeout=h}get partialMessageTimeout(){return this._partialMessageTimeout}listen(h){this.nextMessageLength=-1,this.messageToken=0,this.partialMessageTimer=void 0,this.callback=h,this.readable.on("data",h=>{this.onData(h)}),this.readable.on("error",h=>this.fireError(h)),this.readable.on("close",()=>this.fireClose())}onData(h){for(this.buffer.append(h);;){if(-1===this.nextMessageLength){let h=this.buffer.tryReadHeaders();if(!h)return;let m=h["Content-Length"];if(!m)throw new Error("Header must provide a Content-Length property.");let y=parseInt(m);if(isNaN(y))throw new Error("Content-Length value must be a number.");this.nextMessageLength=y}var m=this.buffer.tryReadContent(this.nextMessageLength);if(null===m)return void this.setPartialMessageTimer();this.clearPartialMessageTimer(),this.nextMessageLength=-1,this.messageToken++;var y=JSON.parse(m);this.callback(y)}}clearPartialMessageTimer(){this.partialMessageTimer&&(clearTimeout(this.partialMessageTimer),this.partialMessageTimer=void 0)}setPartialMessageTimer(){this.clearPartialMessageTimer(),this._partialMessageTimeout<=0||(this.partialMessageTimer=setTimeout((h,m)=>{this.partialMessageTimer=void 0,h===this.messageToken&&(this.firePartialMessage({messageToken:h,waitingTime:m}),this.setPartialMessageTimer())},this._partialMessageTimeout,this.messageToken,this._partialMessageTimeout))}}m.StreamMessageReader=StreamMessageReader;m.IPCMessageReader=class IPCMessageReader extends AbstractMessageReader{constructor(h){super(),this.process=h;let m=this.process;m.on("error",h=>this.fireError(h)),m.on("close",()=>this.fireClose())}listen(h){this.process.on("message",h)}};m.SocketMessageReader=class SocketMessageReader extends StreamMessageReader{constructor(h,m="utf-8"){super(h,m)}}},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0});const v=y(195),C=y(149);!function(h){h.is=function is(h){let m=h;return m&&C.func(m.dispose)&&C.func(m.onClose)&&C.func(m.onError)&&C.func(m.write)}}(m.MessageWriter||(m.MessageWriter={}));class AbstractMessageWriter{constructor(){this.errorEmitter=new v.Emitter,this.closeEmitter=new v.Emitter}dispose(){this.errorEmitter.dispose(),this.closeEmitter.dispose()}get onError(){return this.errorEmitter.event}fireError(h,m,y){this.errorEmitter.fire([this.asError(h),m,y])}get onClose(){return this.closeEmitter.event}fireClose(){this.closeEmitter.fire(void 0)}asError(h){return h instanceof Error?h:new Error(`Writer received error. Reason: ${C.string(h.message)?h.message:"unknown"}`)}}m.AbstractMessageWriter=AbstractMessageWriter;m.StreamMessageWriter=class StreamMessageWriter extends AbstractMessageWriter{constructor(h,m="utf8"){super(),this.writable=h,this.encoding=m,this.errorCount=0,this.writable.on("error",h=>this.fireError(h)),this.writable.on("close",()=>this.fireClose())}write(h){let m=JSON.stringify(h),y=["Content-Length: ",Buffer.byteLength(m,this.encoding).toString(),"\r\n","\r\n"];try{this.writable.write(y.join(""),"ascii"),this.writable.write(m,this.encoding),this.errorCount=0}catch(m){this.errorCount++,this.fireError(m,h,this.errorCount)}}};m.IPCMessageWriter=class IPCMessageWriter extends AbstractMessageWriter{constructor(h){super(),this.process=h,this.errorCount=0,this.queue=[],this.sending=!1;let m=this.process;m.on("error",h=>this.fireError(h)),m.on("close",()=>this.fireClose)}write(h){this.sending||0!==this.queue.length?this.queue.push(h):this.doWriteMessage(h)}doWriteMessage(h){try{this.process.send&&(this.sending=!0,this.process.send(h,void 0,void 0,m=>{this.sending=!1,m?(this.errorCount++,this.fireError(m,h,this.errorCount)):this.errorCount=0,this.queue.length>0&&this.doWriteMessage(this.queue.shift())}))}catch(m){this.errorCount++,this.fireError(m,h,this.errorCount)}}};m.SocketMessageWriter=class SocketMessageWriter extends AbstractMessageWriter{constructor(h,m="utf8"){super(),this.socket=h,this.queue=[],this.sending=!1,this.encoding=m,this.errorCount=0,this.socket.on("error",h=>this.fireError(h)),this.socket.on("close",()=>this.fireClose())}dispose(){super.dispose(),this.socket.destroy()}write(h){this.sending||0!==this.queue.length?this.queue.push(h):this.doWriteMessage(h)}doWriteMessage(h){let m=JSON.stringify(h),y=["Content-Length: ",Buffer.byteLength(m,this.encoding).toString(),"\r\n","\r\n"];try{this.sending=!0,this.socket.write(y.join(""),"ascii",y=>{y&&this.handleError(y,h);try{this.socket.write(m,this.encoding,m=>{this.sending=!1,m?this.handleError(m,h):this.errorCount=0,this.queue.length>0&&this.doWriteMessage(this.queue.shift())})}catch(y){this.handleError(y,h)}})}catch(m){this.handleError(m,h)}}handleError(h,m){this.errorCount++,this.fireError(h,m,this.errorCount)}}},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0});const v=y(0),C=y(30),T=y(72),w=y(581),A=y(582),P=y(583);var k;!function(h){h.is=function is(h){let m=h;return m&&T.string(m.language)&&T.string(m.value)}}(k||(k={})),m.createConverter=function createConverter(h){const m=h||(h=>v.Uri.parse(h));function asUri(h){return m(h)}function asDiagnostics(h){return h.map(asDiagnostic)}function asDiagnostic(h){let m=new v.Diagnostic(asRange(h.range),h.message,asDiagnosticSeverity(h.severity));return(T.number(h.code)||T.string(h.code))&&(m.code=h.code),h.source&&(m.source=h.source),h.relatedInformation&&(m.relatedInformation=function asRelatedInformation(h){return h.map(asDiagnosticRelatedInformation)}(h.relatedInformation)),m}function asDiagnosticRelatedInformation(h){return new v.DiagnosticRelatedInformation(asLocation(h.location),h.message)}function asPosition(h){if(h)return new v.Position(h.line,h.character)}function asRange(h){if(h)return new v.Range(asPosition(h.start),asPosition(h.end))}function asDiagnosticSeverity(h){if(null==h)return v.DiagnosticSeverity.Error;switch(h){case C.DiagnosticSeverity.Error:return v.DiagnosticSeverity.Error;case C.DiagnosticSeverity.Warning:return v.DiagnosticSeverity.Warning;case C.DiagnosticSeverity.Information:return v.DiagnosticSeverity.Information;case C.DiagnosticSeverity.Hint:return v.DiagnosticSeverity.Hint}return v.DiagnosticSeverity.Error}function asDocumentation(h){if(T.string(h))return h;switch(h.kind){case C.MarkupKind.Markdown:return new v.MarkdownString(h.value);case C.MarkupKind.PlainText:return h.value;default:return`Unsupported Markup content received. Kind is: ${h.kind}`}}function asCompletionItem(h){let m=new w.default(h.label);h.detail&&(m.detail=h.detail),h.documentation&&(m.documentation=asDocumentation(h.documentation),m.documentationFormat=T.string(h.documentation)?"$string":h.documentation.kind),h.filterText&&(m.filterText=h.filterText);let y=function asCompletionInsertText(h){return h.textEdit?h.insertTextFormat===C.InsertTextFormat.Snippet?{text:new v.SnippetString(h.textEdit.newText),range:asRange(h.textEdit.range),fromEdit:!0}:{text:h.textEdit.newText,range:asRange(h.textEdit.range),fromEdit:!0}:h.insertText?h.insertTextFormat===C.InsertTextFormat.Snippet?{text:new v.SnippetString(h.insertText),fromEdit:!1}:{text:h.insertText,fromEdit:!1}:void 0}(h);if(y&&(m.insertText=y.text,m.range=y.range,m.fromEdit=y.fromEdit),T.number(h.kind)){let[y,T]=function asCompletionItemKind(h){return C.CompletionItemKind.Text<=h&&h<=C.CompletionItemKind.TypeParameter?[h-1,void 0]:[v.CompletionItemKind.Text,h]}(h.kind);m.kind=y,T&&(m.originalItemKind=T)}return h.sortText&&(m.sortText=h.sortText),h.additionalTextEdits&&(m.additionalTextEdits=asTextEdits(h.additionalTextEdits)),T.stringArray(h.commitCharacters)&&(m.commitCharacters=h.commitCharacters.slice()),h.command&&(m.command=asCommand(h.command)),!0!==h.deprecated&&!1!==h.deprecated||(m.deprecated=h.deprecated),!0!==h.preselect&&!1!==h.preselect||(m.preselect=h.preselect),void 0!==h.data&&(m.data=h.data),m}function asTextEdit(h){if(h)return new v.TextEdit(asRange(h.range),h.newText)}function asTextEdits(h){if(h)return h.map(asTextEdit)}function asSignatureInformations(h){return h.map(asSignatureInformation)}function asSignatureInformation(h){let m=new v.SignatureInformation(h.label);return h.documentation&&(m.documentation=asDocumentation(h.documentation)),h.parameters&&(m.parameters=asParameterInformations(h.parameters)),m}function asParameterInformations(h){return h.map(asParameterInformation)}function asParameterInformation(h){let m=new v.ParameterInformation(h.label);return h.documentation&&(m.documentation=asDocumentation(h.documentation)),m}function asLocation(h){if(h)return new v.Location(m(h.uri),asRange(h.range))}function asDocumentHighlight(h){let m=new v.DocumentHighlight(asRange(h.range));return T.number(h.kind)&&(m.kind=asDocumentHighlightKind(h.kind)),m}function asDocumentHighlightKind(h){switch(h){case C.DocumentHighlightKind.Text:return v.DocumentHighlightKind.Text;case C.DocumentHighlightKind.Read:return v.DocumentHighlightKind.Read;case C.DocumentHighlightKind.Write:return v.DocumentHighlightKind.Write}return v.DocumentHighlightKind.Text}function asSymbolKind(h){return h<=C.SymbolKind.TypeParameter?h-1:v.SymbolKind.Property}function asSymbolInformation(h,y){let C=new v.SymbolInformation(h.name,asSymbolKind(h.kind),asRange(h.location.range),h.location.uri?m(h.location.uri):y);return h.containerName&&(C.containerName=h.containerName),C}function asDocumentSymbol(h){let m=new v.DocumentSymbol(h.name,h.detail||"",asSymbolKind(h.kind),asRange(h.range),asRange(h.selectionRange));if(void 0!==h.children&&h.children.length>0){let y=[];for(let m of h.children)y.push(asDocumentSymbol(m));m.children=y}return m}function asCommand(h){let m={title:h.title,command:h.command};return h.arguments&&(m.arguments=h.arguments),m}const y=new Map;function asCodeLens(h){if(!h)return;let m=new A.default(asRange(h.range));return h.command&&(m.command=asCommand(h.command)),void 0!==h.data&&null!==h.data&&(m.data=h.data),m}function asWorkspaceEdit(h){if(!h)return;let y=new v.WorkspaceEdit;return h.documentChanges?h.documentChanges.forEach(h=>{y.set(m(h.textDocument.uri),asTextEdits(h.edits))}):h.changes&&Object.keys(h.changes).forEach(v=>{y.set(m(v),asTextEdits(h.changes[v]))}),y}function asDocumentLink(h){let m=asRange(h.range),y=h.target?asUri(h.target):void 0,v=new P.default(m,y);return void 0!==h.data&&null!==h.data&&(v.data=h.data),v}function asColor(h){return new v.Color(h.red,h.green,h.blue,h.alpha)}function asColorInformation(h){return new v.ColorInformation(asRange(h.range),asColor(h.color))}function asColorPresentation(h){let m=new v.ColorPresentation(h.label);return m.additionalTextEdits=asTextEdits(h.additionalTextEdits),h.textEdit&&(m.textEdit=asTextEdit(h.textEdit)),m}function asFoldingRangeKind(h){if(h)switch(h){case C.FoldingRangeKind.Comment:return v.FoldingRangeKind.Comment;case C.FoldingRangeKind.Imports:return v.FoldingRangeKind.Imports;case C.FoldingRangeKind.Region:return v.FoldingRangeKind.Region}}function asFoldingRange(h){return new v.FoldingRange(h.startLine,h.endLine,asFoldingRangeKind(h.kind))}return y.set("",v.CodeActionKind.Empty),y.set(C.CodeActionKind.QuickFix,v.CodeActionKind.QuickFix),y.set(C.CodeActionKind.Refactor,v.CodeActionKind.Refactor),y.set(C.CodeActionKind.RefactorExtract,v.CodeActionKind.RefactorExtract),y.set(C.CodeActionKind.RefactorInline,v.CodeActionKind.RefactorInline),y.set(C.CodeActionKind.RefactorRewrite,v.CodeActionKind.RefactorRewrite),y.set(C.CodeActionKind.Source,v.CodeActionKind.Source),y.set(C.CodeActionKind.SourceOrganizeImports,v.CodeActionKind.SourceOrganizeImports),{asUri:asUri,asDiagnostics:asDiagnostics,asDiagnostic:asDiagnostic,asRange:asRange,asPosition:asPosition,asDiagnosticSeverity:asDiagnosticSeverity,asHover:function asHover(h){if(h)return new v.Hover(function asHoverContent(h){if(T.string(h))return new v.MarkdownString(h);if(k.is(h)){return(new v.MarkdownString).appendCodeblock(h.value,h.language)}if(Array.isArray(h)){let m=[];for(let y of h){let h=new v.MarkdownString;k.is(y)?h.appendCodeblock(y.value,y.language):h.appendMarkdown(y),m.push(h)}return m}{let m;switch(h.kind){case C.MarkupKind.Markdown:return new v.MarkdownString(h.value);case C.MarkupKind.PlainText:return m=new v.MarkdownString,m.appendText(h.value),m;default:return m=new v.MarkdownString,m.appendText(`Unsupported Markup content received. Kind is: ${h.kind}`),m}}}(h.contents),asRange(h.range))},asCompletionResult:function asCompletionResult(h){if(!h)return;if(Array.isArray(h)){return h.map(asCompletionItem)}let m=h;return new v.CompletionList(m.items.map(asCompletionItem),m.isIncomplete)},asCompletionItem:asCompletionItem,asTextEdit:asTextEdit,asTextEdits:asTextEdits,asSignatureHelp:function asSignatureHelp(h){if(!h)return;let m=new v.SignatureHelp;return T.number(h.activeSignature)?m.activeSignature=h.activeSignature:m.activeSignature=0,T.number(h.activeParameter)?m.activeParameter=h.activeParameter:m.activeParameter=0,h.signatures&&(m.signatures=asSignatureInformations(h.signatures)),m},asSignatureInformations:asSignatureInformations,asSignatureInformation:asSignatureInformation,asParameterInformations:asParameterInformations,asParameterInformation:asParameterInformation,asDefinitionResult:function asDefinitionResult(h){if(h)return T.array(h)?h.map(h=>asLocation(h)):asLocation(h)},asLocation:asLocation,asReferences:function asReferences(h){if(h)return h.map(h=>asLocation(h))},asDocumentHighlights:function asDocumentHighlights(h){if(h)return h.map(asDocumentHighlight)},asDocumentHighlight:asDocumentHighlight,asDocumentHighlightKind:asDocumentHighlightKind,asSymbolInformations:function asSymbolInformations(h,m){if(h)return h.map(h=>asSymbolInformation(h,m))},asSymbolInformation:asSymbolInformation,asDocumentSymbols:function asDocumentSymbols(h){if(null!=h)return h.map(asDocumentSymbol)},asDocumentSymbol:asDocumentSymbol,asCommand:asCommand,asCommands:function asCommands(h){if(h)return h.map(asCommand)},asCodeAction:function asCodeAction(h){if(null==h)return;let m=new v.CodeAction(h.title);return void 0!==h.kind&&(m.kind=function asCodeActionKind(h){if(null==h)return;let m=y.get(h);if(m)return m;let C=h.split(".");m=v.CodeActionKind.Empty;for(let h of C)m=m.append(h);return m}(h.kind)),h.diagnostics&&(m.diagnostics=asDiagnostics(h.diagnostics)),h.edit&&(m.edit=asWorkspaceEdit(h.edit)),h.command&&(m.command=asCommand(h.command)),m},asCodeLens:asCodeLens,asCodeLenses:function asCodeLenses(h){if(h)return h.map(h=>asCodeLens(h))},asWorkspaceEdit:asWorkspaceEdit,asDocumentLink:asDocumentLink,asDocumentLinks:function asDocumentLinks(h){if(h)return h.map(asDocumentLink)},asFoldingRangeKind:asFoldingRangeKind,asFoldingRange:asFoldingRange,asFoldingRanges:function asFoldingRanges(h){if(Array.isArray(h))return h.map(asFoldingRange)},asColor:asColor,asColorInformation:asColorInformation,asColorInformations:function asColorInformations(h){if(Array.isArray(h))return h.map(asColorInformation)},asColorPresentation:asColorPresentation,asColorPresentations:function asColorPresentations(h){if(Array.isArray(h))return h.map(asColorPresentation)}}}},function(h,m,y){"use strict";var v=this&&this.__awaiter||function(h,m,y,v){return new(y||(y=Promise))((function(C,T){function fulfilled(h){try{step(v.next(h))}catch(h){T(h)}}function rejected(h){try{step(v.throw(h))}catch(h){T(h)}}function step(h){h.done?C(h.value):function adopt(h){return h instanceof y?h:new y((function(m){m(h)}))}(h.value).then(fulfilled,rejected)}step((v=v.apply(h,m||[])).next())}))};Object.defineProperty(m,"__esModule",{value:!0});const C=y(0),T=y(320),w=y(1459),A=y(11),P=y(1460);m.REMOTE_COMMAND_NAME="_liveshare.remotecommand",m.REMOTE_CODE_LENS_NAME="liveshare.remotecodelens",m.REMOTE_CODE_ACTION_NAME="liveshare.remotecodeaction";const k=["vscode.open","editor.action.showReferences","merge-conflict.compare"],R={};function constructRemoteCommand(h,y,v){let C={title:h.title,command:m.REMOTE_COMMAND_NAME,tooltip:h.tooltip,arguments:y};return v.asCommand(C)}function hashCommand(h){let m;try{m=JSON.stringify(h)}catch(y){m=w.stringify(h)}const y=A.createHmac("sha256","key");return y.update(m),y.digest("hex")}function wrapCommand(h,m,y,v,C){if(k.indexOf(m.command)>=0){const h=R[m.command];return h&&(m=h.toProtocol(m,y,v)),constructRemoteCommand(m,[m],y)}{let v=[h,hashCommand(m)];return C&&(v=v.concat(C)),constructRemoteCommand(m,[{title:"DummyTitle",command:"NotALocalCommand",arguments:v}],y)}}m.isSafeCommand=function isSafeCommand(h){return h.startsWith("vscode")||h.startsWith("editor")},m.hashCommand=hashCommand,m.wrapCodeLensCommand=function wrapCodeLensCommand(h,y,v,C){return wrapCommand(m.REMOTE_CODE_LENS_NAME,h,v,C,[v.asUri(y)])},m.wrapCodeActionCommand=function wrapCodeActionCommand(h,y,v,C,T){return wrapCommand(m.REMOTE_CODE_ACTION_NAME,h,C,T,[C.asUri(y),C.asRange(v)])},m.handleLiveShareRemoteCommand=function handleLiveShareRemoteCommand(h,m,y){return v(this,void 0,void 0,(function*(){if(h.command){let w=h;k.indexOf(w.command)>=0?function executeLocalCommand(h,m){const y=R[h.command];y&&(h=y.toCode(h,m));let v=h.arguments||[];C.commands.executeCommand(h.command,...v)}(w,y):yield function executeRemoteCommand(h,m){return v(this,void 0,void 0,(function*(){let y={command:h.command,arguments:h.arguments};const v=yield m.sendRequest(T.ExecuteCommandRequest.type,y);if("boolean"==typeof v&&!v){(yield C.window.showErrorMessage("The host doesnt allow running this command. If needed, ask them to enable it.","More info"))&&C.env.openExternal(C.Uri.parse("https://aka.ms/vsls-security#code-commands"))}}))}(w,m)}else if(h.edit){let m=h.edit;C.workspace.applyEdit(y.asWorkspaceEdit(m))}}))};const M={toProtocol:(h,m,y)=>{let v=h.arguments[0],C=h.arguments[1],T=h.arguments[2];return h.arguments[0]=m.asUri(v),h.arguments[1]=m.asPosition(C),h.arguments[2]=T.map(h=>y.asLocation(h)),h},toCode:(h,m)=>{let y=h.arguments[0],v=h.arguments[1],C=h.arguments[2];return h.arguments[0]=m.asUri(y),h.arguments[1]=m.asPosition(v),h.arguments[2]=C.map(h=>P.asLocation(h,m)),h}};R["vscode.open"]={toProtocol:(h,m,y)=>{let v=h.arguments[0];return h.arguments[0]=m.asUri(v),h},toCode:(h,m)=>{let y=h.arguments[0];return h.arguments[0]=m.asUri(y),h}},R["editor.action.showReferences"]=M,R["merge-conflict.compare"]={toProtocol:(h,m,y)=>{const v=m.asRange(h.arguments[0].current.content),C=m.asRange(h.arguments[0].incoming.content);return h.arguments=[v,C],h},toCode:(h,m)=>(h.arguments=[{current:{content:m.asRange(h.arguments[0])},incoming:{content:m.asRange(h.arguments[1])}}],h)}},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0});const v=y(3),C=y(5),T=y(2);m.isLiveshareHubEnabled=T.once(()=>{var h;if(!v.ExtensionUtil.isNode())return!1;let m=v.Settings.get("isLiveshareHubEnabled");return void 0===m&&(m=!!(null===(h=v.getExpService())||void 0===h?void 0:h.getTreatmentVariable(v.TreatmentVariables.VSCodeConfig,"use-liveshare-hub"))),m&&C.traceSource.info("Experiment liveshare hub is enabled..."),m})},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0});const v=y(0),C=y(3),T=y(5),w=y(8);var A,P;m.initCoEditingContext=async function initCoEditingContext(h,m){const{userInfo:y}=await h.authService().getCurrentAuthenticatedUserAsync();return C.SessionContext.initCoEditingContext({joinCompleted:Promise.resolve(),isGuest:m,fileSystemService:h.fileService(),pathManager:h.pathManager(),sourceEventService:h.sourceEventService(),userInfo:y,clientAccessCheck:h.accessControlManager,fileSystemManager:h.fileSystemManager,syncService:h.syncService()})},function(h){h.web="web",h.visualStudioCode="visualStudioCode",h.visualStudio="visualStudio"}(A||(A={})),function(h){h.web="Web",h.visualStudioCode="Visual Studio Code",h.visualStudio="Visual Studio"}(P||(P={})),m.openInOtherClient=async function openInOtherClient(h){if(C.ExtensionUtil.isNode()||!h)return!1;if(!C.Settings.get(C.SettingKeys.hasSelectedLauncherClient)){const h={title:C.localize("web.OpenIn").replace("$(editor)",P.visualStudioCode),isCloseAffordance:!1},m={title:C.localize("web.ContinueIn").replace("$(editor)",P.web),isCloseAffordance:!0},y=await T.NotificationUtil.showInformationMessage(C.localize("web.SelectLauncherClient"),!1,{modal:!0},m,h);let v;switch(y){case h:v=A.visualStudioCode;break;case m:v=A.web;break;default:throw new Error(`Unexpected default editor selection: ${y}`)}await C.Settings.save(C.SettingKeys.hasSelectedLauncherClient,!0),await C.Settings.save(C.SettingKeys.launcherClient,v),w.Telemetry.sendTelemetryEvent(C.TelemetryEventNames.LAUNCHER_CLIENT_SELECTION,{[C.TelemetryPropertyNames.EDITOR_SELECTION]:v})}return C.Settings.get(C.SettingKeys.launcherClient)===A.visualStudioCode&&await async function launchInVSCode(h){w.Telemetry.sendTelemetryEvent(C.TelemetryEventNames.OPEN_IN_OTHER_EDITOR,{[C.TelemetryPropertyNames.EDITOR_SELECTION]:A.visualStudioCode});const m=`${C.VSCODE_OPEN_EXTERNAL_URI_PREFIX}${encodeURI(`${C.constants.LIVESHARE_JOIN_URI}${h}`)}`;await v.env.openExternal(v.Uri.parse(m));const y={title:C.localize("web.Reopen").replace("$(editor)",P.visualStudioCode),isCloseAffordance:!1},k={title:C.localize("web.ContinueIn").replace("$(editor)",P.web),isCloseAffordance:!1};switch(await T.NotificationUtil.showInformationMessage(C.localize("web.LaunchingIn").replace("$(editor)",P.visualStudioCode),!1,{modal:!0},y,k)){case y:return await launchInVSCode(h);case k:await C.Settings.save(C.SettingKeys.launcherClient,A.web),w.Telemetry.sendTelemetryEvent(C.TelemetryEventNames.SWITCH_BACK_TO_WEB_EDITOR);break;default:return w.Telemetry.sendTelemetryEvent(C.TelemetryEventNames.LAUNCHER_CLIENT_CANCEL),await v.commands.executeCommand("vscode.openFolder",v.Uri.parse("vsls:/")),!0}return!1}(h)}},function(h,m,y){"use strict";var v=this&&this.__awaiter||function(h,m,y,v){return new(y||(y=Promise))((function(C,T){function fulfilled(h){try{step(v.next(h))}catch(h){T(h)}}function rejected(h){try{step(v.throw(h))}catch(h){T(h)}}function step(h){h.done?C(h.value):function adopt(h){return h instanceof y?h:new y((function(m){m(h)}))}(h.value).then(fulfilled,rejected)}step((v=v.apply(h,m||[])).next())}))};Object.defineProperty(m,"__esModule",{value:!0});const C=y(0),T=y(5),w=y(198),A=y(3);class TerminalControllerBase extends(T.Activatable(T.Disposable(Object))){constructor(h,m){super(),this.lazyTerminalService=h,this.trace=m,this.terminalCache=new w.TerminalCache,this.sessionSubscriptions=[],this.globalSubscriptions=[],this.deferredWork=Promise.resolve(),C.window.onDidCloseTerminal(h=>{this.terminalCache.remove(h)},null,this.globalSubscriptions)}get terminalService(){return this.lazyTerminalService()}dispose(){const h=Object.create(null,{dispose:{get:()=>super.dispose}});return v(this,void 0,void 0,(function*(){yield this.deferredWork,yield this.deactivate(),this.globalSubscriptions.splice(0).forEach(h=>h.dispose()),this.terminalCache.clean(),A.SessionContext.hasSharedTerminals=!1,yield h.dispose.call(this)}))}deactivate(){const h=Object.create(null,{deactivate:{get:()=>super.deactivate}});return v(this,void 0,void 0,(function*(){yield this.deferredWork,this.sessionSubscriptions.splice(0).forEach(h=>h.dispose()),this.terminalCache.clean(!0),yield h.deactivate.call(this)}))}deferWork(h){this.deferredWork=this.deferredWork.then(h).catch(h=>{this.trace.error(h.message)})}showTerminal(h){const m=this.terminalCache.getById(h.id);return m?(m.terminal.show(),m.terminal):null}}m.TerminalControllerBase=TerminalControllerBase},function(h,m,y){"undefined"!=typeof process&&"renderer"===process.type?h.exports=y(1489):h.exports=y(1491)},function(h,m,y){var v=y(10),C=y(86),T=y(13).EventEmitter,w=y(739),A=y(1494),P=y(1495).Validation,k=C.bufferAllocUnsafe,R=C.bufferFromString;var M="setImmediate"in global?global.setImmediate.bind(global):process.nextTick.bind(process),N=0;function WebSocketConnection(h,m,y,v,P){if(this._debug=C.BufferingLogger("websocket:connection",++N),this._debug("constructor"),this._debug.enabled&&function instrumentSocketForDebugging(h,m){if(!h._debug.enabled)return;var y=m.emit;for(var v in m.emit=function(m){h._debug("||| Socket Event  '%s'",m),y.apply(this,arguments)},m)"function"==typeof m[v]&&-1===["emit"].indexOf(v)&&function(y){var v=m[y];m[y]="on"!==y?function proxyMethod(){return h._debug("||| Socket method called:  %s",y),v.apply(this,arguments)}:function proxyMethod__EventEmitter__On(){return h._debug("||| Socket method called:  %s (%s)",y,arguments[0]),v.apply(this,arguments)}}(v)}(this,h),T.call(this),this._pingListenerCount=0,this.on("newListener",(function(h){"ping"===h&&this._pingListenerCount++})).on("removeListener",(function(h){"ping"===h&&this._pingListenerCount--})),this.config=P,this.socket=h,this.protocol=y,this.extensions=m,this.remoteAddress=h.remoteAddress,this.closeReasonCode=-1,this.closeDescription=null,this.closeEventEmitted=!1,this.maskOutgoingPackets=v,this.maskBytes=k(4),this.frameHeader=k(10),this.bufferList=new A,this.currentFrame=new w(this.maskBytes,this.frameHeader,this.config),this.fragmentationSize=0,this.frameQueue=[],this.connected=!0,this.state="open",this.waitingForCloseResponse=!1,this.receivedEnd=!1,this.closeTimeout=this.config.closeTimeout,this.assembleFragments=this.config.assembleFragments,this.maxReceivedMessageSize=this.config.maxReceivedMessageSize,this.outputBufferFull=!1,this.inputPaused=!1,this.receivedDataHandler=this.processReceivedData.bind(this),this._closeTimerHandler=this.handleCloseTimer.bind(this),this.socket.setNoDelay(this.config.disableNagleAlgorithm),this.socket.setTimeout(0),this.config.keepalive&&!this.config.useNativeKeepalive){if("number"!=typeof this.config.keepaliveInterval)throw new Error("keepaliveInterval must be specified and numeric if keepalive is true.");if(this._keepaliveTimerHandler=this.handleKeepaliveTimer.bind(this),this.setKeepaliveTimer(),this.config.dropConnectionOnKeepaliveTimeout){if("number"!=typeof this.config.keepaliveGracePeriod)throw new Error("keepaliveGracePeriod  must be specified and numeric if dropConnectionOnKeepaliveTimeout is true.");this._gracePeriodTimerHandler=this.handleGracePeriodTimer.bind(this)}}else if(this.config.keepalive&&this.config.useNativeKeepalive){if(!("setKeepAlive"in this.socket))throw new Error("Unable to use native keepalive: unsupported by this version of Node.");this.socket.setKeepAlive(!0,this.config.keepaliveInterval)}this.socket.removeAllListeners("error")}function validateCloseReason(h){return!(h<1e3)&&(h>=1e3&&h<=2999?-1!==[1e3,1001,1002,1003,1007,1008,1009,1010,1011,1012,1013,1014].indexOf(h):h>=3e3&&h<=3999||(h>=4e3&&h<=4999||!(h>=5e3)&&void 0))}WebSocketConnection.CLOSE_REASON_NORMAL=1e3,WebSocketConnection.CLOSE_REASON_GOING_AWAY=1001,WebSocketConnection.CLOSE_REASON_PROTOCOL_ERROR=1002,WebSocketConnection.CLOSE_REASON_UNPROCESSABLE_INPUT=1003,WebSocketConnection.CLOSE_REASON_RESERVED=1004,WebSocketConnection.CLOSE_REASON_NOT_PROVIDED=1005,WebSocketConnection.CLOSE_REASON_ABNORMAL=1006,WebSocketConnection.CLOSE_REASON_INVALID_DATA=1007,WebSocketConnection.CLOSE_REASON_POLICY_VIOLATION=1008,WebSocketConnection.CLOSE_REASON_MESSAGE_TOO_BIG=1009,WebSocketConnection.CLOSE_REASON_EXTENSION_REQUIRED=1010,WebSocketConnection.CLOSE_REASON_INTERNAL_SERVER_ERROR=1011,WebSocketConnection.CLOSE_REASON_TLS_HANDSHAKE_FAILED=1015,WebSocketConnection.CLOSE_DESCRIPTIONS={1e3:"Normal connection closure",1001:"Remote peer is going away",1002:"Protocol error",1003:"Unprocessable input",1004:"Reserved",1005:"Reason not provided",1006:"Abnormal closure, no further detail available",1007:"Invalid data received",1008:"Policy violation",1009:"Message too big",1010:"Extension requested by client is required",1011:"Internal Server Error",1015:"TLS Handshake Failed"},v.inherits(WebSocketConnection,T),WebSocketConnection.prototype._addSocketEventListeners=function(){this.socket.on("error",this.handleSocketError.bind(this)),this.socket.on("end",this.handleSocketEnd.bind(this)),this.socket.on("close",this.handleSocketClose.bind(this)),this.socket.on("drain",this.handleSocketDrain.bind(this)),this.socket.on("pause",this.handleSocketPause.bind(this)),this.socket.on("resume",this.handleSocketResume.bind(this)),this.socket.on("data",this.handleSocketData.bind(this))},WebSocketConnection.prototype.setKeepaliveTimer=function(){this._debug("setKeepaliveTimer"),this.config.keepalive&&!this.config.useNativeKeepalive&&(this.clearKeepaliveTimer(),this.clearGracePeriodTimer(),this._keepaliveTimeoutID=setTimeout(this._keepaliveTimerHandler,this.config.keepaliveInterval))},WebSocketConnection.prototype.clearKeepaliveTimer=function(){this._keepaliveTimeoutID&&clearTimeout(this._keepaliveTimeoutID)},WebSocketConnection.prototype.handleKeepaliveTimer=function(){this._debug("handleKeepaliveTimer"),this._keepaliveTimeoutID=null,this.ping(),this.config.dropConnectionOnKeepaliveTimeout?this.setGracePeriodTimer():this.setKeepaliveTimer()},WebSocketConnection.prototype.setGracePeriodTimer=function(){this._debug("setGracePeriodTimer"),this.clearGracePeriodTimer(),this._gracePeriodTimeoutID=setTimeout(this._gracePeriodTimerHandler,this.config.keepaliveGracePeriod)},WebSocketConnection.prototype.clearGracePeriodTimer=function(){this._gracePeriodTimeoutID&&clearTimeout(this._gracePeriodTimeoutID)},WebSocketConnection.prototype.handleGracePeriodTimer=function(){this._debug("handleGracePeriodTimer"),this._gracePeriodTimeoutID=null,this.drop(WebSocketConnection.CLOSE_REASON_ABNORMAL,"Peer not responding.",!0)},WebSocketConnection.prototype.handleSocketData=function(h){this._debug("handleSocketData"),this.setKeepaliveTimer(),this.bufferList.write(h),this.processReceivedData()},WebSocketConnection.prototype.processReceivedData=function(){if(this._debug("processReceivedData"),this.connected&&!this.inputPaused){var h=this.currentFrame;if(h.addData(this.bufferList)){var m=this;if(h.protocolError)return this._debug("-- protocol error"),void process.nextTick((function(){m.drop(WebSocketConnection.CLOSE_REASON_PROTOCOL_ERROR,h.dropReason)}));if(h.frameTooLarge)return this._debug("-- frame too large"),void process.nextTick((function(){m.drop(WebSocketConnection.CLOSE_REASON_MESSAGE_TOO_BIG,h.dropReason)}));if(h.rsv1||h.rsv2||h.rsv3)return this._debug("-- illegal rsv flag"),void process.nextTick((function(){m.drop(WebSocketConnection.CLOSE_REASON_PROTOCOL_ERROR,"Unsupported usage of rsv bits without negotiated extension.")}));this.assembleFragments||(this._debug("-- emitting frame"),process.nextTick((function(){m.emit("frame",h)}))),process.nextTick((function(){m.processFrame(h)})),this.currentFrame=new w(this.maskBytes,this.frameHeader,this.config),this.bufferList.length>0&&M(this.receivedDataHandler)}else this._debug("-- insufficient data for frame")}},WebSocketConnection.prototype.handleSocketError=function(h){this._debug("handleSocketError: %j",h),"closed"!==this.state?(this.closeReasonCode=WebSocketConnection.CLOSE_REASON_ABNORMAL,this.closeDescription="Socket Error: "+h.syscall+" "+h.code,this.connected=!1,this.state="closed",this.fragmentationSize=0,C.eventEmitterListenerCount(this,"error")>0&&this.emit("error",h),this.socket.destroy(),this._debug.printOutput()):this._debug("  --- Socket 'error' after 'close'")},WebSocketConnection.prototype.handleSocketEnd=function(){this._debug("handleSocketEnd: received socket end.  state = %s",this.state),this.receivedEnd=!0,"closed"!==this.state?"peer_requested_close"!==this.state&&"ending"!==this.state&&(this._debug("  --- UNEXPECTED socket end."),this.socket.end()):this._debug("  --- Socket 'end' after 'close'")},WebSocketConnection.prototype.handleSocketClose=function(h){this._debug("handleSocketClose: received socket close"),this.socketHadError=h,this.connected=!1,this.state="closed",-1===this.closeReasonCode&&(this.closeReasonCode=WebSocketConnection.CLOSE_REASON_ABNORMAL,this.closeDescription="Connection dropped by remote peer."),this.clearCloseTimer(),this.clearKeepaliveTimer(),this.clearGracePeriodTimer(),this.closeEventEmitted||(this.closeEventEmitted=!0,this._debug("-- Emitting WebSocketConnection close event"),this.emit("close",this.closeReasonCode,this.closeDescription))},WebSocketConnection.prototype.handleSocketDrain=function(){this._debug("handleSocketDrain: socket drain event"),this.outputBufferFull=!1,this.emit("drain")},WebSocketConnection.prototype.handleSocketPause=function(){this._debug("handleSocketPause: socket pause event"),this.inputPaused=!0,this.emit("pause")},WebSocketConnection.prototype.handleSocketResume=function(){this._debug("handleSocketResume: socket resume event"),this.inputPaused=!1,this.emit("resume"),this.processReceivedData()},WebSocketConnection.prototype.pause=function(){this._debug("pause: pause requested"),this.socket.pause()},WebSocketConnection.prototype.resume=function(){this._debug("resume: resume requested"),this.socket.resume()},WebSocketConnection.prototype.close=function(h,m){if(this.connected){if(this._debug("close: Initating clean WebSocket close sequence."),"number"!=typeof h&&(h=WebSocketConnection.CLOSE_REASON_NORMAL),!validateCloseReason(h))throw new Error("Close code "+h+" is not valid.");"string"!=typeof m&&(m=WebSocketConnection.CLOSE_DESCRIPTIONS[h]),this.closeReasonCode=h,this.closeDescription=m,this.setCloseTimer(),this.sendCloseFrame(this.closeReasonCode,this.closeDescription),this.state="ending",this.connected=!1}},WebSocketConnection.prototype.drop=function(h,m,y){this._debug("drop"),"number"!=typeof h&&(h=WebSocketConnection.CLOSE_REASON_PROTOCOL_ERROR),"string"!=typeof m&&(m=WebSocketConnection.CLOSE_DESCRIPTIONS[h]),this._debug("Forcefully dropping connection. skipCloseFrame: %s, code: %d, description: %s",y,h,m),this.closeReasonCode=h,this.closeDescription=m,this.frameQueue=[],this.fragmentationSize=0,y||this.sendCloseFrame(h,m),this.connected=!1,this.state="closed",this.clearCloseTimer(),this.clearKeepaliveTimer(),this.clearGracePeriodTimer(),this.closeEventEmitted||(this.closeEventEmitted=!0,this._debug("Emitting WebSocketConnection close event"),this.emit("close",this.closeReasonCode,this.closeDescription)),this._debug("Drop: destroying socket"),this.socket.destroy()},WebSocketConnection.prototype.setCloseTimer=function(){this._debug("setCloseTimer"),this.clearCloseTimer(),this._debug("Setting close timer"),this.waitingForCloseResponse=!0,this.closeTimer=setTimeout(this._closeTimerHandler,this.closeTimeout)},WebSocketConnection.prototype.clearCloseTimer=function(){this._debug("clearCloseTimer"),this.closeTimer&&(this._debug("Clearing close timer"),clearTimeout(this.closeTimer),this.waitingForCloseResponse=!1,this.closeTimer=null)},WebSocketConnection.prototype.handleCloseTimer=function(){this._debug("handleCloseTimer"),this.closeTimer=null,this.waitingForCloseResponse&&(this._debug("Close response not received from client.  Forcing socket end."),this.waitingForCloseResponse=!1,this.state="closed",this.socket.end())},WebSocketConnection.prototype.processFrame=function(h){if(this._debug("processFrame"),this._debug(" -- frame: %s",h),0!==this.frameQueue.length&&h.opcode>0&&h.opcode<8)this.drop(WebSocketConnection.CLOSE_REASON_PROTOCOL_ERROR,"Illegal frame opcode 0x"+h.opcode.toString(16)+" received in middle of fragmented message.");else switch(h.opcode){case 2:this._debug("-- Binary Frame"),this.assembleFragments&&(h.fin?(this._debug("---- Emitting 'message' event"),this.emit("message",{type:"binary",binaryData:h.binaryPayload})):(this.frameQueue.push(h),this.fragmentationSize=h.length));break;case 1:if(this._debug("-- Text Frame"),this.assembleFragments)if(h.fin){if(!P.isValidUTF8(h.binaryPayload))return void this.drop(WebSocketConnection.CLOSE_REASON_INVALID_DATA,"Invalid UTF-8 Data Received");this._debug("---- Emitting 'message' event"),this.emit("message",{type:"utf8",utf8Data:h.binaryPayload.toString("utf8")})}else this.frameQueue.push(h),this.fragmentationSize=h.length;break;case 0:if(this._debug("-- Continuation Frame"),this.assembleFragments){if(0===this.frameQueue.length)return void this.drop(WebSocketConnection.CLOSE_REASON_PROTOCOL_ERROR,"Unexpected Continuation Frame");if(this.fragmentationSize+=h.length,this.fragmentationSize>this.maxReceivedMessageSize)return void this.drop(WebSocketConnection.CLOSE_REASON_MESSAGE_TOO_BIG,"Maximum message size exceeded.");if(this.frameQueue.push(h),h.fin){var m=0,y=k(this.fragmentationSize),v=this.frameQueue[0].opcode;switch(this.frameQueue.forEach((function(h){h.binaryPayload.copy(y,m),m+=h.binaryPayload.length})),this.frameQueue=[],this.fragmentationSize=0,v){case 2:this.emit("message",{type:"binary",binaryData:y});break;case 1:if(!P.isValidUTF8(y))return void this.drop(WebSocketConnection.CLOSE_REASON_INVALID_DATA,"Invalid UTF-8 Data Received");this.emit("message",{type:"utf8",utf8Data:y.toString("utf8")});break;default:return void this.drop(WebSocketConnection.CLOSE_REASON_PROTOCOL_ERROR,"Unexpected first opcode in fragmentation sequence: 0x"+v.toString(16))}}}break;case 9:if(this._debug("-- Ping Frame"),this._pingListenerCount>0){var C=!1;this.emit("ping",(function(){C=!0}),h.binaryPayload),C||this.pong(h.binaryPayload)}else this.pong(h.binaryPayload);break;case 10:this._debug("-- Pong Frame"),this.emit("pong",h.binaryPayload);break;case 8:if(this._debug("-- Close Frame"),this.waitingForCloseResponse)return this._debug("---- Got close response from peer.  Completing closing handshake."),this.clearCloseTimer(),this.waitingForCloseResponse=!1,this.state="closed",void this.socket.end();var T;if(this._debug("---- Closing handshake initiated by peer."),this.state="peer_requested_close",h.invalidCloseFrameLength?(this.closeReasonCode=1005,T=WebSocketConnection.CLOSE_REASON_PROTOCOL_ERROR):-1===h.closeStatus||validateCloseReason(h.closeStatus)?(this.closeReasonCode=h.closeStatus,T=WebSocketConnection.CLOSE_REASON_NORMAL):(this.closeReasonCode=h.closeStatus,T=WebSocketConnection.CLOSE_REASON_PROTOCOL_ERROR),h.binaryPayload.length>1){if(!P.isValidUTF8(h.binaryPayload))return void this.drop(WebSocketConnection.CLOSE_REASON_INVALID_DATA,"Invalid UTF-8 Data Received");this.closeDescription=h.binaryPayload.toString("utf8")}else this.closeDescription=WebSocketConnection.CLOSE_DESCRIPTIONS[this.closeReasonCode];this._debug("------ Remote peer %s - code: %d - %s - close frame payload length: %d",this.remoteAddress,this.closeReasonCode,this.closeDescription,h.length),this._debug("------ responding to remote peer's close request."),this.sendCloseFrame(T,null),this.connected=!1;break;default:this._debug("-- Unrecognized Opcode %d",h.opcode),this.drop(WebSocketConnection.CLOSE_REASON_PROTOCOL_ERROR,"Unrecognized Opcode: 0x"+h.opcode.toString(16))}},WebSocketConnection.prototype.send=function(h,m){if(this._debug("send"),Buffer.isBuffer(h))this.sendBytes(h,m);else{if("function"!=typeof h.toString)throw new Error("Data provided must either be a Node Buffer or implement toString()");this.sendUTF(h,m)}},WebSocketConnection.prototype.sendUTF=function(h,m){h=R(h.toString(),"utf8"),this._debug("sendUTF: %d bytes",h.length);var y=new w(this.maskBytes,this.frameHeader,this.config);y.opcode=1,y.binaryPayload=h,this.fragmentAndSend(y,m)},WebSocketConnection.prototype.sendBytes=function(h,m){if(this._debug("sendBytes"),!Buffer.isBuffer(h))throw new Error("You must pass a Node Buffer object to WebSocketConnection.prototype.sendBytes()");var y=new w(this.maskBytes,this.frameHeader,this.config);y.opcode=2,y.binaryPayload=h,this.fragmentAndSend(y,m)},WebSocketConnection.prototype.ping=function(h){this._debug("ping");var m=new w(this.maskBytes,this.frameHeader,this.config);m.opcode=9,m.fin=!0,h&&(Buffer.isBuffer(h)||(h=R(h.toString(),"utf8")),h.length>125&&(this._debug("WebSocket: Data for ping is longer than 125 bytes.  Truncating."),h=h.slice(0,124)),m.binaryPayload=h),this.sendFrame(m)},WebSocketConnection.prototype.pong=function(h){this._debug("pong");var m=new w(this.maskBytes,this.frameHeader,this.config);m.opcode=10,Buffer.isBuffer(h)&&h.length>125&&(this._debug("WebSocket: Data for pong is longer than 125 bytes.  Truncating."),h=h.slice(0,124)),m.binaryPayload=h,m.fin=!0,this.sendFrame(m)},WebSocketConnection.prototype.fragmentAndSend=function(h,m){if(this._debug("fragmentAndSend"),h.opcode>7)throw new Error("You cannot fragment control frames.");var y=this.config.fragmentationThreshold,v=h.binaryPayload.length;if(!this.config.fragmentOutgoingMessages||h.binaryPayload&&v<=y)return h.fin=!0,void this.sendFrame(h,m);for(var C=Math.ceil(v/y),T=0,A=function fragmentSentCallback(h){h?"function"==typeof m&&(m(h),m=null):++T===C&&"function"==typeof m&&m()},P=1;P<=C;P++){var k=new w(this.maskBytes,this.frameHeader,this.config);k.opcode=1===P?h.opcode:0,k.fin=P===C;var R=P===C?v-y*(P-1):y,M=y*(P-1);k.binaryPayload=h.binaryPayload.slice(M,M+R),this.sendFrame(k,A)}},WebSocketConnection.prototype.sendCloseFrame=function(h,m,y){if("number"!=typeof h&&(h=WebSocketConnection.CLOSE_REASON_NORMAL),this._debug("sendCloseFrame state: %s, reasonCode: %d, description: %s",this.state,h,m),"open"===this.state||"peer_requested_close"===this.state){var v=new w(this.maskBytes,this.frameHeader,this.config);v.fin=!0,v.opcode=8,v.closeStatus=h,"string"==typeof m&&(v.binaryPayload=R(m,"utf8")),this.sendFrame(v,y),this.socket.end()}},WebSocketConnection.prototype.sendFrame=function(h,m){this._debug("sendFrame"),h.mask=this.maskOutgoingPackets;var y=this.socket.write(h.toBuffer(),m);return this.outputBufferFull=!y,y},h.exports=WebSocketConnection},function(h,m,y){"use strict";y.r(m),y.d(m,"AbortError",(function(){return P})),y.d(m,"HttpError",(function(){return w})),y.d(m,"TimeoutError",(function(){return A})),y.d(m,"HttpClient",(function(){return M})),y.d(m,"HttpResponse",(function(){return R})),y.d(m,"DefaultHttpClient",(function(){return G})),y.d(m,"HubConnection",(function(){return ie})),y.d(m,"HubConnectionState",(function(){return Z})),y.d(m,"HubConnectionBuilder",(function(){return _e})),y.d(m,"MessageType",(function(){return Y})),y.d(m,"LogLevel",(function(){return C})),y.d(m,"HttpTransportType",(function(){return te})),y.d(m,"TransferFormat",(function(){return re})),y.d(m,"NullLogger",(function(){return N})),y.d(m,"JsonHubProtocol",(function(){return Se})),y.d(m,"Subject",(function(){return ee})),y.d(m,"VERSION",(function(){return I}));var v,C,T=(v=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(h,m){h.__proto__=m}||function(h,m){for(var y in m)m.hasOwnProperty(y)&&(h[y]=m[y])},function(h,m){function __(){this.constructor=h}v(h,m),h.prototype=null===m?Object.create(m):(__.prototype=m.prototype,new __)}),w=function(h){function HttpError(m,y){var v=this,C=this.constructor.prototype;return(v=h.call(this,m)||this).statusCode=y,v.__proto__=C,v}return T(HttpError,h),HttpError}(Error),A=function(h){function TimeoutError(m){void 0===m&&(m="A timeout occurred.");var y=this,v=this.constructor.prototype;return(y=h.call(this,m)||this).__proto__=v,y}return T(TimeoutError,h),TimeoutError}(Error),P=function(h){function AbortError(m){void 0===m&&(m="An abort occurred.");var y=this,v=this.constructor.prototype;return(y=h.call(this,m)||this).__proto__=v,y}return T(AbortError,h),AbortError}(Error),k=Object.assign||function(h){for(var m,y=1,v=arguments.length;y<v;y++)for(var C in m=arguments[y])Object.prototype.hasOwnProperty.call(m,C)&&(h[C]=m[C]);return h},R=function R(h,m,y){this.statusCode=h,this.statusText=m,this.content=y},M=function(){function HttpClient(){}return HttpClient.prototype.get=function(h,m){return this.send(k({},m,{method:"GET",url:h}))},HttpClient.prototype.post=function(h,m){return this.send(k({},m,{method:"POST",url:h}))},HttpClient.prototype.delete=function(h,m){return this.send(k({},m,{method:"DELETE",url:h}))},HttpClient.prototype.getCookieString=function(h){return""},HttpClient}();!function(h){h[h.Trace=0]="Trace",h[h.Debug=1]="Debug",h[h.Information=2]="Information",h[h.Warning=3]="Warning",h[h.Error=4]="Error",h[h.Critical=5]="Critical",h[h.None=6]="None"}(C||(C={}));var N=function(){function NullLogger(){}return NullLogger.prototype.log=function(h,m){},NullLogger.instance=new NullLogger,NullLogger}(),D=Object.assign||function(h){for(var m,y=1,v=arguments.length;y<v;y++)for(var C in m=arguments[y])Object.prototype.hasOwnProperty.call(m,C)&&(h[C]=m[C]);return h},__awaiter=function(h,m,y,v){return new(y||(y=Promise))((function(C,T){function fulfilled(h){try{step(v.next(h))}catch(h){T(h)}}function rejected(h){try{step(v.throw(h))}catch(h){T(h)}}function step(h){h.done?C(h.value):new y((function(m){m(h.value)})).then(fulfilled,rejected)}step((v=v.apply(h,m||[])).next())}))},__generator=function(h,m){var y,v,C,T,w={label:0,sent:function(){if(1&C[0])throw C[1];return C[1]},trys:[],ops:[]};return T={next:verb(0),throw:verb(1),return:verb(2)},"function"==typeof Symbol&&(T[Symbol.iterator]=function(){return this}),T;function verb(T){return function(A){return function step(T){if(y)throw new TypeError("Generator is already executing.");for(;w;)try{if(y=1,v&&(C=2&T[0]?v.return:T[0]?v.throw||((C=v.return)&&C.call(v),0):v.next)&&!(C=C.call(v,T[1])).done)return C;switch(v=0,C&&(T=[2&T[0],C.value]),T[0]){case 0:case 1:C=T;break;case 4:return w.label++,{value:T[1],done:!1};case 5:w.label++,v=T[1],T=[0];continue;case 7:T=w.ops.pop(),w.trys.pop();continue;default:if(!(C=w.trys,(C=C.length>0&&C[C.length-1])||6!==T[0]&&2!==T[0])){w=0;continue}if(3===T[0]&&(!C||T[1]>C[0]&&T[1]<C[3])){w.label=T[1];break}if(6===T[0]&&w.label<C[1]){w.label=C[1],C=T;break}if(C&&w.label<C[2]){w.label=C[2],w.ops.push(T);break}C[2]&&w.ops.pop(),w.trys.pop();continue}T=m.call(h,w)}catch(h){T=[6,h],v=0}finally{y=C=0}if(5&T[0])throw T[1];return{value:T[0]?T[1]:void 0,done:!0}}([T,A])}}},I="5.0.12",x=function(){function Arg(){}return Arg.isRequired=function(h,m){if(null==h)throw new Error("The '"+m+"' argument is required.")},Arg.isNotEmpty=function(h,m){if(!h||h.match(/^\s*$/))throw new Error("The '"+m+"' argument should not be empty.")},Arg.isIn=function(h,m,y){if(!(h in m))throw new Error("Unknown "+y+" value: "+h+".")},Arg}(),O=function(){function Platform(){}return Object.defineProperty(Platform,"isBrowser",{get:function(){return"object"==typeof window},enumerable:!0,configurable:!0}),Object.defineProperty(Platform,"isWebWorker",{get:function(){return"object"==typeof self&&"importScripts"in self},enumerable:!0,configurable:!0}),Object.defineProperty(Platform,"isNode",{get:function(){return!this.isBrowser&&!this.isWebWorker},enumerable:!0,configurable:!0}),Platform}();function getDataDetail(h,m){var y="";return isArrayBuffer(h)?(y="Binary data of length "+h.byteLength,m&&(y+=". Content: '"+function formatArrayBuffer(h){var m=new Uint8Array(h),y="";return m.forEach((function(h){y+="0x"+(h<16?"0":"")+h.toString(16)+" "})),y.substr(0,y.length-1)}(h)+"'")):"string"==typeof h&&(y="String data of length "+h.length,m&&(y+=". Content: '"+h+"'")),y}function isArrayBuffer(h){return h&&"undefined"!=typeof ArrayBuffer&&(h instanceof ArrayBuffer||h.constructor&&"ArrayBuffer"===h.constructor.name)}function sendMessage(h,m,y,v,T,w,A,P,k){return __awaiter(this,void 0,void 0,(function(){var R,M,N,I,x,O,L,U;return __generator(this,(function(B){switch(B.label){case 0:return M={},T?[4,T()]:[3,2];case 1:(N=B.sent())&&((R={}).Authorization="Bearer "+N,M=R),B.label=2;case 2:return I=getUserAgentHeader(),x=I[0],O=I[1],M[x]=O,h.log(C.Trace,"("+m+" transport) sending data. "+getDataDetail(w,A)+"."),L=isArrayBuffer(w)?"arraybuffer":"text",[4,y.post(v,{content:w,headers:D({},M,k),responseType:L,withCredentials:P})];case 3:return U=B.sent(),h.log(C.Trace,"("+m+" transport) request complete. Response status: "+U.statusCode+"."),[2]}}))}))}var L=function(){function SubjectSubscription(h,m){this.subject=h,this.observer=m}return SubjectSubscription.prototype.dispose=function(){var h=this.subject.observers.indexOf(this.observer);h>-1&&this.subject.observers.splice(h,1),0===this.subject.observers.length&&this.subject.cancelCallback&&this.subject.cancelCallback().catch((function(h){}))},SubjectSubscription}(),U=function(){function ConsoleLogger(h){this.minimumLogLevel=h,this.outputConsole=console}return ConsoleLogger.prototype.log=function(h,m){if(h>=this.minimumLogLevel)switch(h){case C.Critical:case C.Error:this.outputConsole.error("["+(new Date).toISOString()+"] "+C[h]+": "+m);break;case C.Warning:this.outputConsole.warn("["+(new Date).toISOString()+"] "+C[h]+": "+m);break;case C.Information:this.outputConsole.info("["+(new Date).toISOString()+"] "+C[h]+": "+m);break;default:this.outputConsole.log("["+(new Date).toISOString()+"] "+C[h]+": "+m)}},ConsoleLogger}();function getUserAgentHeader(){var h="X-SignalR-User-Agent";return O.isNode&&(h="User-Agent"),[h,constructUserAgent(I,getOsName(),getRuntime(),getRuntimeVersion())]}function constructUserAgent(h,m,y,v){var C="Microsoft SignalR/",T=h.split(".");return C+=T[0]+"."+T[1],C+=" ("+h+"; ",C+=m&&""!==m?m+"; ":"Unknown OS; ",C+=""+y,C+=v?"; "+v:"; Unknown Runtime Version",C+=")"}function getOsName(){if(!O.isNode)return"";switch(process.platform){case"win32":return"Windows NT";case"darwin":return"macOS";case"linux":return"Linux";default:return process.platform}}function getRuntimeVersion(){if(O.isNode)return process.versions.node}function getRuntime(){return O.isNode?"NodeJS":"Browser"}var B=function(){var h=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(h,m){h.__proto__=m}||function(h,m){for(var y in m)m.hasOwnProperty(y)&&(h[y]=m[y])};return function(m,y){function __(){this.constructor=m}h(m,y),m.prototype=null===y?Object.create(y):(__.prototype=y.prototype,new __)}}(),W=Object.assign||function(h){for(var m,y=1,v=arguments.length;y<v;y++)for(var C in m=arguments[y])Object.prototype.hasOwnProperty.call(m,C)&&(h[C]=m[C]);return h},FetchHttpClient_awaiter=function(h,m,y,v){return new(y||(y=Promise))((function(C,T){function fulfilled(h){try{step(v.next(h))}catch(h){T(h)}}function rejected(h){try{step(v.throw(h))}catch(h){T(h)}}function step(h){h.done?C(h.value):new y((function(m){m(h.value)})).then(fulfilled,rejected)}step((v=v.apply(h,m||[])).next())}))},FetchHttpClient_generator=function(h,m){var y,v,C,T,w={label:0,sent:function(){if(1&C[0])throw C[1];return C[1]},trys:[],ops:[]};return T={next:verb(0),throw:verb(1),return:verb(2)},"function"==typeof Symbol&&(T[Symbol.iterator]=function(){return this}),T;function verb(T){return function(A){return function step(T){if(y)throw new TypeError("Generator is already executing.");for(;w;)try{if(y=1,v&&(C=2&T[0]?v.return:T[0]?v.throw||((C=v.return)&&C.call(v),0):v.next)&&!(C=C.call(v,T[1])).done)return C;switch(v=0,C&&(T=[2&T[0],C.value]),T[0]){case 0:case 1:C=T;break;case 4:return w.label++,{value:T[1],done:!1};case 5:w.label++,v=T[1],T=[0];continue;case 7:T=w.ops.pop(),w.trys.pop();continue;default:if(!(C=w.trys,(C=C.length>0&&C[C.length-1])||6!==T[0]&&2!==T[0])){w=0;continue}if(3===T[0]&&(!C||T[1]>C[0]&&T[1]<C[3])){w.label=T[1];break}if(6===T[0]&&w.label<C[1]){w.label=C[1],C=T;break}if(C&&w.label<C[2]){w.label=C[2],w.ops.push(T);break}C[2]&&w.ops.pop(),w.trys.pop();continue}T=m.call(h,w)}catch(h){T=[6,h],v=0}finally{y=C=0}if(5&T[0])throw T[1];return{value:T[0]?T[1]:void 0,done:!0}}([T,A])}}},q=function(h){function FetchHttpClient(m){var y=h.call(this)||this;if(y.logger=m,"undefined"==typeof fetch){var v=require;y.jar=new(v("tough-cookie").CookieJar),y.fetchType=v("node-fetch"),y.fetchType=v("fetch-cookie")(y.fetchType,y.jar),y.abortControllerType=v("abort-controller")}else y.fetchType=fetch.bind(self),y.abortControllerType=AbortController;return y}return B(FetchHttpClient,h),FetchHttpClient.prototype.send=function(h){return FetchHttpClient_awaiter(this,void 0,void 0,(function(){var m,y,v,T,k,M,N,D=this;return FetchHttpClient_generator(this,(function(I){switch(I.label){case 0:if(h.abortSignal&&h.abortSignal.aborted)throw new P;if(!h.method)throw new Error("No method defined.");if(!h.url)throw new Error("No url defined.");m=new this.abortControllerType,h.abortSignal&&(h.abortSignal.onabort=function(){m.abort(),y=new P}),v=null,h.timeout&&(T=h.timeout,v=setTimeout((function(){m.abort(),D.logger.log(C.Warning,"Timeout from HTTP request."),y=new A}),T)),I.label=1;case 1:return I.trys.push([1,3,4,5]),[4,this.fetchType(h.url,{body:h.content,cache:"no-cache",credentials:!0===h.withCredentials?"include":"same-origin",headers:W({"Content-Type":"text/plain;charset=UTF-8","X-Requested-With":"XMLHttpRequest"},h.headers),method:h.method,mode:"cors",redirect:"manual",signal:m.signal})];case 2:return k=I.sent(),[3,5];case 3:if(M=I.sent(),y)throw y;throw this.logger.log(C.Warning,"Error from HTTP request. "+M+"."),M;case 4:return v&&clearTimeout(v),h.abortSignal&&(h.abortSignal.onabort=null),[7];case 5:if(!k.ok)throw new w(k.statusText,k.status);return[4,function deserializeContent(h,m){var y;switch(m){case"arraybuffer":y=h.arrayBuffer();break;case"text":y=h.text();break;case"blob":case"document":case"json":throw new Error(m+" is not supported.");default:y=h.text()}return y}(k,h.responseType)];case 6:return N=I.sent(),[2,new R(k.status,k.statusText,N)]}}))}))},FetchHttpClient.prototype.getCookieString=function(h){var m="";return O.isNode&&this.jar&&this.jar.getCookies(h,(function(h,y){return m=y.join("; ")})),m},FetchHttpClient}(M);var Y,V=function(){var h=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(h,m){h.__proto__=m}||function(h,m){for(var y in m)m.hasOwnProperty(y)&&(h[y]=m[y])};return function(m,y){function __(){this.constructor=m}h(m,y),m.prototype=null===y?Object.create(y):(__.prototype=y.prototype,new __)}}(),$=function(h){function XhrHttpClient(m){var y=h.call(this)||this;return y.logger=m,y}return V(XhrHttpClient,h),XhrHttpClient.prototype.send=function(h){var m=this;return h.abortSignal&&h.abortSignal.aborted?Promise.reject(new P):h.method?h.url?new Promise((function(y,v){var T=new XMLHttpRequest;T.open(h.method,h.url,!0),T.withCredentials=void 0===h.withCredentials||h.withCredentials,T.setRequestHeader("X-Requested-With","XMLHttpRequest"),T.setRequestHeader("Content-Type","text/plain;charset=UTF-8");var k=h.headers;k&&Object.keys(k).forEach((function(h){T.setRequestHeader(h,k[h])})),h.responseType&&(T.responseType=h.responseType),h.abortSignal&&(h.abortSignal.onabort=function(){T.abort(),v(new P)}),h.timeout&&(T.timeout=h.timeout),T.onload=function(){h.abortSignal&&(h.abortSignal.onabort=null),T.status>=200&&T.status<300?y(new R(T.status,T.statusText,T.response||T.responseText)):v(new w(T.statusText,T.status))},T.onerror=function(){m.logger.log(C.Warning,"Error from HTTP request. "+T.status+": "+T.statusText+"."),v(new w(T.statusText,T.status))},T.ontimeout=function(){m.logger.log(C.Warning,"Timeout from HTTP request."),v(new A)},T.send(h.content||"")})):Promise.reject(new Error("No url defined.")):Promise.reject(new Error("No method defined."))},XhrHttpClient}(M),z=function(){var h=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(h,m){h.__proto__=m}||function(h,m){for(var y in m)m.hasOwnProperty(y)&&(h[y]=m[y])};return function(m,y){function __(){this.constructor=m}h(m,y),m.prototype=null===y?Object.create(y):(__.prototype=y.prototype,new __)}}(),G=function(h){function DefaultHttpClient(m){var y=h.call(this)||this;if("undefined"!=typeof fetch||O.isNode)y.httpClient=new q(m);else{if("undefined"==typeof XMLHttpRequest)throw new Error("No usable HttpClient found.");y.httpClient=new $(m)}return y}return z(DefaultHttpClient,h),DefaultHttpClient.prototype.send=function(h){return h.abortSignal&&h.abortSignal.aborted?Promise.reject(new P):h.method?h.url?this.httpClient.send(h):Promise.reject(new Error("No url defined.")):Promise.reject(new Error("No method defined."))},DefaultHttpClient.prototype.getCookieString=function(h){return this.httpClient.getCookieString(h)},DefaultHttpClient}(M),J=function(){function TextMessageFormat(){}return TextMessageFormat.write=function(h){return""+h+TextMessageFormat.RecordSeparator},TextMessageFormat.parse=function(h){if(h[h.length-1]!==TextMessageFormat.RecordSeparator)throw new Error("Message is incomplete.");var m=h.split(TextMessageFormat.RecordSeparator);return m.pop(),m},TextMessageFormat.RecordSeparatorCode=30,TextMessageFormat.RecordSeparator=String.fromCharCode(TextMessageFormat.RecordSeparatorCode),TextMessageFormat}(),X=function(){function HandshakeProtocol(){}return HandshakeProtocol.prototype.writeHandshakeRequest=function(h){return J.write(JSON.stringify(h))},HandshakeProtocol.prototype.parseHandshakeResponse=function(h){var m,y;if(isArrayBuffer(h)||"undefined"!=typeof Buffer&&h instanceof Buffer){var v=new Uint8Array(h);if(-1===(T=v.indexOf(J.RecordSeparatorCode)))throw new Error("Message is incomplete.");var C=T+1;m=String.fromCharCode.apply(null,v.slice(0,C)),y=v.byteLength>C?v.slice(C).buffer:null}else{var T,w=h;if(-1===(T=w.indexOf(J.RecordSeparator)))throw new Error("Message is incomplete.");C=T+1;m=w.substring(0,C),y=w.length>C?w.substring(C):null}var A=J.parse(m),P=JSON.parse(A[0]);if(P.type)throw new Error("Expected a handshake response from the server.");return[y,P]},HandshakeProtocol}();!function(h){h[h.Invocation=1]="Invocation",h[h.StreamItem=2]="StreamItem",h[h.Completion=3]="Completion",h[h.StreamInvocation=4]="StreamInvocation",h[h.CancelInvocation=5]="CancelInvocation",h[h.Ping=6]="Ping",h[h.Close=7]="Close"}(Y||(Y={}));var Z,ee=function(){function Subject(){this.observers=[]}return Subject.prototype.next=function(h){for(var m=0,y=this.observers;m<y.length;m++){y[m].next(h)}},Subject.prototype.error=function(h){for(var m=0,y=this.observers;m<y.length;m++){var v=y[m];v.error&&v.error(h)}},Subject.prototype.complete=function(){for(var h=0,m=this.observers;h<m.length;h++){var y=m[h];y.complete&&y.complete()}},Subject.prototype.subscribe=function(h){return this.observers.push(h),new L(this,h)},Subject}(),HubConnection_awaiter=function(h,m,y,v){return new(y||(y=Promise))((function(C,T){function fulfilled(h){try{step(v.next(h))}catch(h){T(h)}}function rejected(h){try{step(v.throw(h))}catch(h){T(h)}}function step(h){h.done?C(h.value):new y((function(m){m(h.value)})).then(fulfilled,rejected)}step((v=v.apply(h,m||[])).next())}))},HubConnection_generator=function(h,m){var y,v,C,T,w={label:0,sent:function(){if(1&C[0])throw C[1];return C[1]},trys:[],ops:[]};return T={next:verb(0),throw:verb(1),return:verb(2)},"function"==typeof Symbol&&(T[Symbol.iterator]=function(){return this}),T;function verb(T){return function(A){return function step(T){if(y)throw new TypeError("Generator is already executing.");for(;w;)try{if(y=1,v&&(C=2&T[0]?v.return:T[0]?v.throw||((C=v.return)&&C.call(v),0):v.next)&&!(C=C.call(v,T[1])).done)return C;switch(v=0,C&&(T=[2&T[0],C.value]),T[0]){case 0:case 1:C=T;break;case 4:return w.label++,{value:T[1],done:!1};case 5:w.label++,v=T[1],T=[0];continue;case 7:T=w.ops.pop(),w.trys.pop();continue;default:if(!(C=w.trys,(C=C.length>0&&C[C.length-1])||6!==T[0]&&2!==T[0])){w=0;continue}if(3===T[0]&&(!C||T[1]>C[0]&&T[1]<C[3])){w.label=T[1];break}if(6===T[0]&&w.label<C[1]){w.label=C[1],C=T;break}if(C&&w.label<C[2]){w.label=C[2],w.ops.push(T);break}C[2]&&w.ops.pop(),w.trys.pop();continue}T=m.call(h,w)}catch(h){T=[6,h],v=0}finally{y=C=0}if(5&T[0])throw T[1];return{value:T[0]?T[1]:void 0,done:!0}}([T,A])}}};!function(h){h.Disconnected="Disconnected",h.Connecting="Connecting",h.Connected="Connected",h.Disconnecting="Disconnecting",h.Reconnecting="Reconnecting"}(Z||(Z={}));var te,re,ie=function(){function HubConnection(h,m,y,v){var C=this;this.nextKeepAlive=0,x.isRequired(h,"connection"),x.isRequired(m,"logger"),x.isRequired(y,"protocol"),this.serverTimeoutInMilliseconds=3e4,this.keepAliveIntervalInMilliseconds=15e3,this.logger=m,this.protocol=y,this.connection=h,this.reconnectPolicy=v,this.handshakeProtocol=new X,this.connection.onreceive=function(h){return C.processIncomingData(h)},this.connection.onclose=function(h){return C.connectionClosed(h)},this.callbacks={},this.methods={},this.closedCallbacks=[],this.reconnectingCallbacks=[],this.reconnectedCallbacks=[],this.invocationId=0,this.receivedHandshakeResponse=!1,this.connectionState=Z.Disconnected,this.connectionStarted=!1,this.cachedPingMessage=this.protocol.writeMessage({type:Y.Ping})}return HubConnection.create=function(h,m,y,v){return new HubConnection(h,m,y,v)},Object.defineProperty(HubConnection.prototype,"state",{get:function(){return this.connectionState},enumerable:!0,configurable:!0}),Object.defineProperty(HubConnection.prototype,"connectionId",{get:function(){return this.connection&&this.connection.connectionId||null},enumerable:!0,configurable:!0}),Object.defineProperty(HubConnection.prototype,"baseUrl",{get:function(){return this.connection.baseUrl||""},set:function(h){if(this.connectionState!==Z.Disconnected&&this.connectionState!==Z.Reconnecting)throw new Error("The HubConnection must be in the Disconnected or Reconnecting state to change the url.");if(!h)throw new Error("The HubConnection url must be a valid url.");this.connection.baseUrl=h},enumerable:!0,configurable:!0}),HubConnection.prototype.start=function(){return this.startPromise=this.startWithStateTransitions(),this.startPromise},HubConnection.prototype.startWithStateTransitions=function(){return HubConnection_awaiter(this,void 0,void 0,(function(){var h;return HubConnection_generator(this,(function(m){switch(m.label){case 0:if(this.connectionState!==Z.Disconnected)return[2,Promise.reject(new Error("Cannot start a HubConnection that is not in the 'Disconnected' state."))];this.connectionState=Z.Connecting,this.logger.log(C.Debug,"Starting HubConnection."),m.label=1;case 1:return m.trys.push([1,3,,4]),[4,this.startInternal()];case 2:return m.sent(),this.connectionState=Z.Connected,this.connectionStarted=!0,this.logger.log(C.Debug,"HubConnection connected successfully."),[3,4];case 3:return h=m.sent(),this.connectionState=Z.Disconnected,this.logger.log(C.Debug,"HubConnection failed to start successfully because of error '"+h+"'."),[2,Promise.reject(h)];case 4:return[2]}}))}))},HubConnection.prototype.startInternal=function(){return HubConnection_awaiter(this,void 0,void 0,(function(){var h,m,y,v=this;return HubConnection_generator(this,(function(T){switch(T.label){case 0:return this.stopDuringStartError=void 0,this.receivedHandshakeResponse=!1,h=new Promise((function(h,m){v.handshakeResolver=h,v.handshakeRejecter=m})),[4,this.connection.start(this.protocol.transferFormat)];case 1:T.sent(),T.label=2;case 2:return T.trys.push([2,5,,7]),m={protocol:this.protocol.name,version:this.protocol.version},this.logger.log(C.Debug,"Sending handshake request."),[4,this.sendMessage(this.handshakeProtocol.writeHandshakeRequest(m))];case 3:return T.sent(),this.logger.log(C.Information,"Using HubProtocol '"+this.protocol.name+"'."),this.cleanupTimeout(),this.resetTimeoutPeriod(),this.resetKeepAliveInterval(),[4,h];case 4:if(T.sent(),this.stopDuringStartError)throw this.stopDuringStartError;return[3,7];case 5:return y=T.sent(),this.logger.log(C.Debug,"Hub handshake failed with error '"+y+"' during start(). Stopping HubConnection."),this.cleanupTimeout(),this.cleanupPingTimer(),[4,this.connection.stop(y)];case 6:throw T.sent(),y;case 7:return[2]}}))}))},HubConnection.prototype.stop=function(){return HubConnection_awaiter(this,void 0,void 0,(function(){var h;return HubConnection_generator(this,(function(m){switch(m.label){case 0:return h=this.startPromise,this.stopPromise=this.stopInternal(),[4,this.stopPromise];case 1:m.sent(),m.label=2;case 2:return m.trys.push([2,4,,5]),[4,h];case 3:return m.sent(),[3,5];case 4:return m.sent(),[3,5];case 5:return[2]}}))}))},HubConnection.prototype.stopInternal=function(h){return this.connectionState===Z.Disconnected?(this.logger.log(C.Debug,"Call to HubConnection.stop("+h+") ignored because it is already in the disconnected state."),Promise.resolve()):this.connectionState===Z.Disconnecting?(this.logger.log(C.Debug,"Call to HttpConnection.stop("+h+") ignored because the connection is already in the disconnecting state."),this.stopPromise):(this.connectionState=Z.Disconnecting,this.logger.log(C.Debug,"Stopping HubConnection."),this.reconnectDelayHandle?(this.logger.log(C.Debug,"Connection stopped during reconnect delay. Done reconnecting."),clearTimeout(this.reconnectDelayHandle),this.reconnectDelayHandle=void 0,this.completeClose(),Promise.resolve()):(this.cleanupTimeout(),this.cleanupPingTimer(),this.stopDuringStartError=h||new Error("The connection was stopped before the hub handshake could complete."),this.connection.stop(h)))},HubConnection.prototype.stream=function(h){for(var m=this,y=[],v=1;v<arguments.length;v++)y[v-1]=arguments[v];var C,T=this.replaceStreamingParams(y),w=T[0],A=T[1],P=this.createStreamInvocation(h,y,A),k=new ee;return k.cancelCallback=function(){var h=m.createCancelInvocation(P.invocationId);return delete m.callbacks[P.invocationId],C.then((function(){return m.sendWithProtocol(h)}))},this.callbacks[P.invocationId]=function(h,m){m?k.error(m):h&&(h.type===Y.Completion?h.error?k.error(new Error(h.error)):k.complete():k.next(h.item))},C=this.sendWithProtocol(P).catch((function(h){k.error(h),delete m.callbacks[P.invocationId]})),this.launchStreams(w,C),k},HubConnection.prototype.sendMessage=function(h){return this.resetKeepAliveInterval(),this.connection.send(h)},HubConnection.prototype.sendWithProtocol=function(h){return this.sendMessage(this.protocol.writeMessage(h))},HubConnection.prototype.send=function(h){for(var m=[],y=1;y<arguments.length;y++)m[y-1]=arguments[y];var v=this.replaceStreamingParams(m),C=v[0],T=v[1],w=this.sendWithProtocol(this.createInvocation(h,m,!0,T));return this.launchStreams(C,w),w},HubConnection.prototype.invoke=function(h){for(var m=this,y=[],v=1;v<arguments.length;v++)y[v-1]=arguments[v];var C=this.replaceStreamingParams(y),T=C[0],w=C[1],A=this.createInvocation(h,y,!1,w),P=new Promise((function(h,y){m.callbacks[A.invocationId]=function(m,v){v?y(v):m&&(m.type===Y.Completion?m.error?y(new Error(m.error)):h(m.result):y(new Error("Unexpected message type: "+m.type)))};var v=m.sendWithProtocol(A).catch((function(h){y(h),delete m.callbacks[A.invocationId]}));m.launchStreams(T,v)}));return P},HubConnection.prototype.on=function(h,m){h&&m&&(h=h.toLowerCase(),this.methods[h]||(this.methods[h]=[]),-1===this.methods[h].indexOf(m)&&this.methods[h].push(m))},HubConnection.prototype.off=function(h,m){if(h){h=h.toLowerCase();var y=this.methods[h];if(y)if(m){var v=y.indexOf(m);-1!==v&&(y.splice(v,1),0===y.length&&delete this.methods[h])}else delete this.methods[h]}},HubConnection.prototype.onclose=function(h){h&&this.closedCallbacks.push(h)},HubConnection.prototype.onreconnecting=function(h){h&&this.reconnectingCallbacks.push(h)},HubConnection.prototype.onreconnected=function(h){h&&this.reconnectedCallbacks.push(h)},HubConnection.prototype.processIncomingData=function(h){if(this.cleanupTimeout(),this.receivedHandshakeResponse||(h=this.processHandshakeResponse(h),this.receivedHandshakeResponse=!0),h)for(var m=0,y=this.protocol.parseMessages(h,this.logger);m<y.length;m++){var v=y[m];switch(v.type){case Y.Invocation:this.invokeClientMethod(v);break;case Y.StreamItem:case Y.Completion:var T=this.callbacks[v.invocationId];T&&(v.type===Y.Completion&&delete this.callbacks[v.invocationId],T(v));break;case Y.Ping:break;case Y.Close:this.logger.log(C.Information,"Close message received from server.");var w=v.error?new Error("Server returned an error on close: "+v.error):void 0;!0===v.allowReconnect?this.connection.stop(w):this.stopPromise=this.stopInternal(w);break;default:this.logger.log(C.Warning,"Invalid message type: "+v.type+".")}}this.resetTimeoutPeriod()},HubConnection.prototype.processHandshakeResponse=function(h){var m,y,v;try{v=(m=this.handshakeProtocol.parseHandshakeResponse(h))[0],y=m[1]}catch(h){var T="Error parsing handshake response: "+h;this.logger.log(C.Error,T);var w=new Error(T);throw this.handshakeRejecter(w),w}if(y.error){T="Server returned handshake error: "+y.error;this.logger.log(C.Error,T);w=new Error(T);throw this.handshakeRejecter(w),w}return this.logger.log(C.Debug,"Server handshake complete."),this.handshakeResolver(),v},HubConnection.prototype.resetKeepAliveInterval=function(){this.connection.features.inherentKeepAlive||(this.nextKeepAlive=(new Date).getTime()+this.keepAliveIntervalInMilliseconds,this.cleanupPingTimer())},HubConnection.prototype.resetTimeoutPeriod=function(){var h=this;if(!(this.connection.features&&this.connection.features.inherentKeepAlive||(this.timeoutHandle=setTimeout((function(){return h.serverTimeout()}),this.serverTimeoutInMilliseconds),void 0!==this.pingServerHandle))){var m=this.nextKeepAlive-(new Date).getTime();m<0&&(m=0),this.pingServerHandle=setTimeout((function(){return HubConnection_awaiter(h,void 0,void 0,(function(){return HubConnection_generator(this,(function(h){switch(h.label){case 0:if(this.connectionState!==Z.Connected)return[3,4];h.label=1;case 1:return h.trys.push([1,3,,4]),[4,this.sendMessage(this.cachedPingMessage)];case 2:return h.sent(),[3,4];case 3:return h.sent(),this.cleanupPingTimer(),[3,4];case 4:return[2]}}))}))}),m)}},HubConnection.prototype.serverTimeout=function(){this.connection.stop(new Error("Server timeout elapsed without receiving a message from the server."))},HubConnection.prototype.invokeClientMethod=function(h){var m=this,y=this.methods[h.target.toLowerCase()];if(y){try{y.forEach((function(y){return y.apply(m,h.arguments)}))}catch(m){this.logger.log(C.Error,"A callback for the method "+h.target.toLowerCase()+" threw error '"+m+"'.")}if(h.invocationId){var v="Server requested a response, which is not supported in this version of the client.";this.logger.log(C.Error,v),this.stopPromise=this.stopInternal(new Error(v))}}else this.logger.log(C.Warning,"No client method with the name '"+h.target+"' found.")},HubConnection.prototype.connectionClosed=function(h){this.logger.log(C.Debug,"HubConnection.connectionClosed("+h+") called while in state "+this.connectionState+"."),this.stopDuringStartError=this.stopDuringStartError||h||new Error("The underlying connection was closed before the hub handshake could complete."),this.handshakeResolver&&this.handshakeResolver(),this.cancelCallbacksWithError(h||new Error("Invocation canceled due to the underlying connection being closed.")),this.cleanupTimeout(),this.cleanupPingTimer(),this.connectionState===Z.Disconnecting?this.completeClose(h):this.connectionState===Z.Connected&&this.reconnectPolicy?this.reconnect(h):this.connectionState===Z.Connected&&this.completeClose(h)},HubConnection.prototype.completeClose=function(h){var m=this;if(this.connectionStarted){this.connectionState=Z.Disconnected,this.connectionStarted=!1;try{this.closedCallbacks.forEach((function(y){return y.apply(m,[h])}))}catch(m){this.logger.log(C.Error,"An onclose callback called with error '"+h+"' threw error '"+m+"'.")}}},HubConnection.prototype.reconnect=function(h){return HubConnection_awaiter(this,void 0,void 0,(function(){var m,y,v,T,w,A=this;return HubConnection_generator(this,(function(P){switch(P.label){case 0:if(m=Date.now(),y=0,v=void 0!==h?h:new Error("Attempting to reconnect due to a unknown error."),null===(T=this.getNextRetryDelay(y++,0,v)))return this.logger.log(C.Debug,"Connection not reconnecting because the IRetryPolicy returned null on the first reconnect attempt."),this.completeClose(h),[2];if(this.connectionState=Z.Reconnecting,h?this.logger.log(C.Information,"Connection reconnecting because of error '"+h+"'."):this.logger.log(C.Information,"Connection reconnecting."),this.onreconnecting){try{this.reconnectingCallbacks.forEach((function(m){return m.apply(A,[h])}))}catch(m){this.logger.log(C.Error,"An onreconnecting callback called with error '"+h+"' threw error '"+m+"'.")}if(this.connectionState!==Z.Reconnecting)return this.logger.log(C.Debug,"Connection left the reconnecting state in onreconnecting callback. Done reconnecting."),[2]}P.label=1;case 1:return null===T?[3,7]:(this.logger.log(C.Information,"Reconnect attempt number "+y+" will start in "+T+" ms."),[4,new Promise((function(h){A.reconnectDelayHandle=setTimeout(h,T)}))]);case 2:if(P.sent(),this.reconnectDelayHandle=void 0,this.connectionState!==Z.Reconnecting)return this.logger.log(C.Debug,"Connection left the reconnecting state during reconnect delay. Done reconnecting."),[2];P.label=3;case 3:return P.trys.push([3,5,,6]),[4,this.startInternal()];case 4:if(P.sent(),this.connectionState=Z.Connected,this.logger.log(C.Information,"HubConnection reconnected successfully."),this.onreconnected)try{this.reconnectedCallbacks.forEach((function(h){return h.apply(A,[A.connection.connectionId])}))}catch(h){this.logger.log(C.Error,"An onreconnected callback called with connectionId '"+this.connection.connectionId+"; threw error '"+h+"'.")}return[2];case 5:return w=P.sent(),this.logger.log(C.Information,"Reconnect attempt failed because of error '"+w+"'."),this.connectionState!==Z.Reconnecting?(this.logger.log(C.Debug,"Connection moved to the '"+this.connectionState+"' from the reconnecting state during reconnect attempt. Done reconnecting."),this.connectionState===Z.Disconnecting&&this.completeClose(),[2]):(v=w instanceof Error?w:new Error(w.toString()),T=this.getNextRetryDelay(y++,Date.now()-m,v),[3,6]);case 6:return[3,1];case 7:return this.logger.log(C.Information,"Reconnect retries have been exhausted after "+(Date.now()-m)+" ms and "+y+" failed attempts. Connection disconnecting."),this.completeClose(),[2]}}))}))},HubConnection.prototype.getNextRetryDelay=function(h,m,y){try{return this.reconnectPolicy.nextRetryDelayInMilliseconds({elapsedMilliseconds:m,previousRetryCount:h,retryReason:y})}catch(y){return this.logger.log(C.Error,"IRetryPolicy.nextRetryDelayInMilliseconds("+h+", "+m+") threw error '"+y+"'."),null}},HubConnection.prototype.cancelCallbacksWithError=function(h){var m=this.callbacks;this.callbacks={},Object.keys(m).forEach((function(y){(0,m[y])(null,h)}))},HubConnection.prototype.cleanupPingTimer=function(){this.pingServerHandle&&(clearTimeout(this.pingServerHandle),this.pingServerHandle=void 0)},HubConnection.prototype.cleanupTimeout=function(){this.timeoutHandle&&clearTimeout(this.timeoutHandle)},HubConnection.prototype.createInvocation=function(h,m,y,v){if(y)return 0!==v.length?{arguments:m,streamIds:v,target:h,type:Y.Invocation}:{arguments:m,target:h,type:Y.Invocation};var C=this.invocationId;return this.invocationId++,0!==v.length?{arguments:m,invocationId:C.toString(),streamIds:v,target:h,type:Y.Invocation}:{arguments:m,invocationId:C.toString(),target:h,type:Y.Invocation}},HubConnection.prototype.launchStreams=function(h,m){var y=this;if(0!==h.length){m||(m=Promise.resolve());var _loop_1=function(v){h[v].subscribe({complete:function(){m=m.then((function(){return y.sendWithProtocol(y.createCompletionMessage(v))}))},error:function(h){var C;C=h instanceof Error?h.message:h&&h.toString?h.toString():"Unknown error",m=m.then((function(){return y.sendWithProtocol(y.createCompletionMessage(v,C))}))},next:function(h){m=m.then((function(){return y.sendWithProtocol(y.createStreamItemMessage(v,h))}))}})};for(var v in h)_loop_1(v)}},HubConnection.prototype.replaceStreamingParams=function(h){for(var m=[],y=[],v=0;v<h.length;v++){var C=h[v];if(this.isObservable(C)){var T=this.invocationId;this.invocationId++,m[T]=C,y.push(T.toString()),h.splice(v,1)}}return[m,y]},HubConnection.prototype.isObservable=function(h){return h&&h.subscribe&&"function"==typeof h.subscribe},HubConnection.prototype.createStreamInvocation=function(h,m,y){var v=this.invocationId;return this.invocationId++,0!==y.length?{arguments:m,invocationId:v.toString(),streamIds:y,target:h,type:Y.StreamInvocation}:{arguments:m,invocationId:v.toString(),target:h,type:Y.StreamInvocation}},HubConnection.prototype.createCancelInvocation=function(h){return{invocationId:h,type:Y.CancelInvocation}},HubConnection.prototype.createStreamItemMessage=function(h,m){return{invocationId:h,item:m,type:Y.StreamItem}},HubConnection.prototype.createCompletionMessage=function(h,m,y){return m?{error:m,invocationId:h,type:Y.Completion}:{invocationId:h,result:y,type:Y.Completion}},HubConnection}(),se=[0,2e3,1e4,3e4,null],oe=function(){function DefaultReconnectPolicy(h){this.retryDelays=void 0!==h?h.concat([null]):se}return DefaultReconnectPolicy.prototype.nextRetryDelayInMilliseconds=function(h){return this.retryDelays[h.previousRetryCount]},DefaultReconnectPolicy}();!function(h){h[h.None=0]="None",h[h.WebSockets=1]="WebSockets",h[h.ServerSentEvents=2]="ServerSentEvents",h[h.LongPolling=4]="LongPolling"}(te||(te={})),function(h){h[h.Text=1]="Text",h[h.Binary=2]="Binary"}(re||(re={}));var ae=function(){function AbortController(){this.isAborted=!1,this.onabort=null}return AbortController.prototype.abort=function(){this.isAborted||(this.isAborted=!0,this.onabort&&this.onabort())},Object.defineProperty(AbortController.prototype,"signal",{get:function(){return this},enumerable:!0,configurable:!0}),Object.defineProperty(AbortController.prototype,"aborted",{get:function(){return this.isAborted},enumerable:!0,configurable:!0}),AbortController}(),ce=Object.assign||function(h){for(var m,y=1,v=arguments.length;y<v;y++)for(var C in m=arguments[y])Object.prototype.hasOwnProperty.call(m,C)&&(h[C]=m[C]);return h},LongPollingTransport_awaiter=function(h,m,y,v){return new(y||(y=Promise))((function(C,T){function fulfilled(h){try{step(v.next(h))}catch(h){T(h)}}function rejected(h){try{step(v.throw(h))}catch(h){T(h)}}function step(h){h.done?C(h.value):new y((function(m){m(h.value)})).then(fulfilled,rejected)}step((v=v.apply(h,m||[])).next())}))},LongPollingTransport_generator=function(h,m){var y,v,C,T,w={label:0,sent:function(){if(1&C[0])throw C[1];return C[1]},trys:[],ops:[]};return T={next:verb(0),throw:verb(1),return:verb(2)},"function"==typeof Symbol&&(T[Symbol.iterator]=function(){return this}),T;function verb(T){return function(A){return function step(T){if(y)throw new TypeError("Generator is already executing.");for(;w;)try{if(y=1,v&&(C=2&T[0]?v.return:T[0]?v.throw||((C=v.return)&&C.call(v),0):v.next)&&!(C=C.call(v,T[1])).done)return C;switch(v=0,C&&(T=[2&T[0],C.value]),T[0]){case 0:case 1:C=T;break;case 4:return w.label++,{value:T[1],done:!1};case 5:w.label++,v=T[1],T=[0];continue;case 7:T=w.ops.pop(),w.trys.pop();continue;default:if(!(C=w.trys,(C=C.length>0&&C[C.length-1])||6!==T[0]&&2!==T[0])){w=0;continue}if(3===T[0]&&(!C||T[1]>C[0]&&T[1]<C[3])){w.label=T[1];break}if(6===T[0]&&w.label<C[1]){w.label=C[1],C=T;break}if(C&&w.label<C[2]){w.label=C[2],w.ops.push(T);break}C[2]&&w.ops.pop(),w.trys.pop();continue}T=m.call(h,w)}catch(h){T=[6,h],v=0}finally{y=C=0}if(5&T[0])throw T[1];return{value:T[0]?T[1]:void 0,done:!0}}([T,A])}}},le=function(){function LongPollingTransport(h,m,y,v,C,T){this.httpClient=h,this.accessTokenFactory=m,this.logger=y,this.pollAbort=new ae,this.logMessageContent=v,this.withCredentials=C,this.headers=T,this.running=!1,this.onreceive=null,this.onclose=null}return Object.defineProperty(LongPollingTransport.prototype,"pollAborted",{get:function(){return this.pollAbort.aborted},enumerable:!0,configurable:!0}),LongPollingTransport.prototype.connect=function(h,m){return LongPollingTransport_awaiter(this,void 0,void 0,(function(){var y,v,T,A,P,k,R,M,N;return LongPollingTransport_generator(this,(function(D){switch(D.label){case 0:if(x.isRequired(h,"url"),x.isRequired(m,"transferFormat"),x.isIn(m,re,"transferFormat"),this.url=h,this.logger.log(C.Trace,"(LongPolling transport) Connecting."),m===re.Binary&&"undefined"!=typeof XMLHttpRequest&&"string"!=typeof(new XMLHttpRequest).responseType)throw new Error("Binary protocols over XmlHttpRequest not implementing advanced features are not supported.");return v=getUserAgentHeader(),T=v[0],A=v[1],P=ce(((y={})[T]=A,y),this.headers),k={abortSignal:this.pollAbort.signal,headers:P,timeout:1e5,withCredentials:this.withCredentials},m===re.Binary&&(k.responseType="arraybuffer"),[4,this.getAccessToken()];case 1:return R=D.sent(),this.updateHeaderToken(k,R),M=h+"&_="+Date.now(),this.logger.log(C.Trace,"(LongPolling transport) polling: "+M+"."),[4,this.httpClient.get(M,k)];case 2:return 200!==(N=D.sent()).statusCode?(this.logger.log(C.Error,"(LongPolling transport) Unexpected response code: "+N.statusCode+"."),this.closeError=new w(N.statusText||"",N.statusCode),this.running=!1):this.running=!0,this.receiving=this.poll(this.url,k),[2]}}))}))},LongPollingTransport.prototype.getAccessToken=function(){return LongPollingTransport_awaiter(this,void 0,void 0,(function(){return LongPollingTransport_generator(this,(function(h){switch(h.label){case 0:return this.accessTokenFactory?[4,this.accessTokenFactory()]:[3,2];case 1:return[2,h.sent()];case 2:return[2,null]}}))}))},LongPollingTransport.prototype.updateHeaderToken=function(h,m){h.headers||(h.headers={}),m?h.headers.Authorization="Bearer "+m:h.headers.Authorization&&delete h.headers.Authorization},LongPollingTransport.prototype.poll=function(h,m){return LongPollingTransport_awaiter(this,void 0,void 0,(function(){var y,v,T,P;return LongPollingTransport_generator(this,(function(k){switch(k.label){case 0:k.trys.push([0,,8,9]),k.label=1;case 1:return this.running?[4,this.getAccessToken()]:[3,7];case 2:y=k.sent(),this.updateHeaderToken(m,y),k.label=3;case 3:return k.trys.push([3,5,,6]),v=h+"&_="+Date.now(),this.logger.log(C.Trace,"(LongPolling transport) polling: "+v+"."),[4,this.httpClient.get(v,m)];case 4:return 204===(T=k.sent()).statusCode?(this.logger.log(C.Information,"(LongPolling transport) Poll terminated by server."),this.running=!1):200!==T.statusCode?(this.logger.log(C.Error,"(LongPolling transport) Unexpected response code: "+T.statusCode+"."),this.closeError=new w(T.statusText||"",T.statusCode),this.running=!1):T.content?(this.logger.log(C.Trace,"(LongPolling transport) data received. "+getDataDetail(T.content,this.logMessageContent)+"."),this.onreceive&&this.onreceive(T.content)):this.logger.log(C.Trace,"(LongPolling transport) Poll timed out, reissuing."),[3,6];case 5:return P=k.sent(),this.running?P instanceof A?this.logger.log(C.Trace,"(LongPolling transport) Poll timed out, reissuing."):(this.closeError=P,this.running=!1):this.logger.log(C.Trace,"(LongPolling transport) Poll errored after shutdown: "+P.message),[3,6];case 6:return[3,1];case 7:return[3,9];case 8:return this.logger.log(C.Trace,"(LongPolling transport) Polling complete."),this.pollAborted||this.raiseOnClose(),[7];case 9:return[2]}}))}))},LongPollingTransport.prototype.send=function(h){return LongPollingTransport_awaiter(this,void 0,void 0,(function(){return LongPollingTransport_generator(this,(function(m){return this.running?[2,sendMessage(this.logger,"LongPolling",this.httpClient,this.url,this.accessTokenFactory,h,this.logMessageContent,this.withCredentials,this.headers)]:[2,Promise.reject(new Error("Cannot send until the transport is connected"))]}))}))},LongPollingTransport.prototype.stop=function(){return LongPollingTransport_awaiter(this,void 0,void 0,(function(){var h,m,y,v,T,w;return LongPollingTransport_generator(this,(function(A){switch(A.label){case 0:this.logger.log(C.Trace,"(LongPolling transport) Stopping polling."),this.running=!1,this.pollAbort.abort(),A.label=1;case 1:return A.trys.push([1,,5,6]),[4,this.receiving];case 2:return A.sent(),this.logger.log(C.Trace,"(LongPolling transport) sending DELETE request to "+this.url+"."),h={},m=getUserAgentHeader(),y=m[0],v=m[1],h[y]=v,T={headers:ce({},h,this.headers),withCredentials:this.withCredentials},[4,this.getAccessToken()];case 3:return w=A.sent(),this.updateHeaderToken(T,w),[4,this.httpClient.delete(this.url,T)];case 4:return A.sent(),this.logger.log(C.Trace,"(LongPolling transport) DELETE request sent."),[3,6];case 5:return this.logger.log(C.Trace,"(LongPolling transport) Stop finished."),this.raiseOnClose(),[7];case 6:return[2]}}))}))},LongPollingTransport.prototype.raiseOnClose=function(){if(this.onclose){var h="(LongPolling transport) Firing onclose event.";this.closeError&&(h+=" Error: "+this.closeError),this.logger.log(C.Trace,h),this.onclose(this.closeError)}},LongPollingTransport}(),ue=Object.assign||function(h){for(var m,y=1,v=arguments.length;y<v;y++)for(var C in m=arguments[y])Object.prototype.hasOwnProperty.call(m,C)&&(h[C]=m[C]);return h},ServerSentEventsTransport_awaiter=function(h,m,y,v){return new(y||(y=Promise))((function(C,T){function fulfilled(h){try{step(v.next(h))}catch(h){T(h)}}function rejected(h){try{step(v.throw(h))}catch(h){T(h)}}function step(h){h.done?C(h.value):new y((function(m){m(h.value)})).then(fulfilled,rejected)}step((v=v.apply(h,m||[])).next())}))},ServerSentEventsTransport_generator=function(h,m){var y,v,C,T,w={label:0,sent:function(){if(1&C[0])throw C[1];return C[1]},trys:[],ops:[]};return T={next:verb(0),throw:verb(1),return:verb(2)},"function"==typeof Symbol&&(T[Symbol.iterator]=function(){return this}),T;function verb(T){return function(A){return function step(T){if(y)throw new TypeError("Generator is already executing.");for(;w;)try{if(y=1,v&&(C=2&T[0]?v.return:T[0]?v.throw||((C=v.return)&&C.call(v),0):v.next)&&!(C=C.call(v,T[1])).done)return C;switch(v=0,C&&(T=[2&T[0],C.value]),T[0]){case 0:case 1:C=T;break;case 4:return w.label++,{value:T[1],done:!1};case 5:w.label++,v=T[1],T=[0];continue;case 7:T=w.ops.pop(),w.trys.pop();continue;default:if(!(C=w.trys,(C=C.length>0&&C[C.length-1])||6!==T[0]&&2!==T[0])){w=0;continue}if(3===T[0]&&(!C||T[1]>C[0]&&T[1]<C[3])){w.label=T[1];break}if(6===T[0]&&w.label<C[1]){w.label=C[1],C=T;break}if(C&&w.label<C[2]){w.label=C[2],w.ops.push(T);break}C[2]&&w.ops.pop(),w.trys.pop();continue}T=m.call(h,w)}catch(h){T=[6,h],v=0}finally{y=C=0}if(5&T[0])throw T[1];return{value:T[0]?T[1]:void 0,done:!0}}([T,A])}}},de=function(){function ServerSentEventsTransport(h,m,y,v,C,T,w){this.httpClient=h,this.accessTokenFactory=m,this.logger=y,this.logMessageContent=v,this.withCredentials=T,this.eventSourceConstructor=C,this.headers=w,this.onreceive=null,this.onclose=null}return ServerSentEventsTransport.prototype.connect=function(h,m){return ServerSentEventsTransport_awaiter(this,void 0,void 0,(function(){var y,v=this;return ServerSentEventsTransport_generator(this,(function(T){switch(T.label){case 0:return x.isRequired(h,"url"),x.isRequired(m,"transferFormat"),x.isIn(m,re,"transferFormat"),this.logger.log(C.Trace,"(SSE transport) Connecting."),this.url=h,this.accessTokenFactory?[4,this.accessTokenFactory()]:[3,2];case 1:(y=T.sent())&&(h+=(h.indexOf("?")<0?"?":"&")+"access_token="+encodeURIComponent(y)),T.label=2;case 2:return[2,new Promise((function(y,T){var w=!1;if(m===re.Text){var A;if(O.isBrowser||O.isWebWorker)A=new v.eventSourceConstructor(h,{withCredentials:v.withCredentials});else{var P=v.httpClient.getCookieString(h),k={};k.Cookie=P;var R=getUserAgentHeader(),M=R[0],N=R[1];k[M]=N,A=new v.eventSourceConstructor(h,{withCredentials:v.withCredentials,headers:ue({},k,v.headers)})}try{A.onmessage=function(h){if(v.onreceive)try{v.logger.log(C.Trace,"(SSE transport) data received. "+getDataDetail(h.data,v.logMessageContent)+"."),v.onreceive(h.data)}catch(h){return void v.close(h)}},A.onerror=function(h){var m=new Error(h.data||"Error occurred");w?v.close(m):T(m)},A.onopen=function(){v.logger.log(C.Information,"SSE connected to "+v.url),v.eventSource=A,w=!0,y()}}catch(h){return void T(h)}}else T(new Error("The Server-Sent Events transport only supports the 'Text' transfer format"))}))]}}))}))},ServerSentEventsTransport.prototype.send=function(h){return ServerSentEventsTransport_awaiter(this,void 0,void 0,(function(){return ServerSentEventsTransport_generator(this,(function(m){return this.eventSource?[2,sendMessage(this.logger,"SSE",this.httpClient,this.url,this.accessTokenFactory,h,this.logMessageContent,this.withCredentials,this.headers)]:[2,Promise.reject(new Error("Cannot send until the transport is connected"))]}))}))},ServerSentEventsTransport.prototype.stop=function(){return this.close(),Promise.resolve()},ServerSentEventsTransport.prototype.close=function(h){this.eventSource&&(this.eventSource.close(),this.eventSource=void 0,this.onclose&&this.onclose(h))},ServerSentEventsTransport}(),he=Object.assign||function(h){for(var m,y=1,v=arguments.length;y<v;y++)for(var C in m=arguments[y])Object.prototype.hasOwnProperty.call(m,C)&&(h[C]=m[C]);return h},WebSocketTransport_awaiter=function(h,m,y,v){return new(y||(y=Promise))((function(C,T){function fulfilled(h){try{step(v.next(h))}catch(h){T(h)}}function rejected(h){try{step(v.throw(h))}catch(h){T(h)}}function step(h){h.done?C(h.value):new y((function(m){m(h.value)})).then(fulfilled,rejected)}step((v=v.apply(h,m||[])).next())}))},WebSocketTransport_generator=function(h,m){var y,v,C,T,w={label:0,sent:function(){if(1&C[0])throw C[1];return C[1]},trys:[],ops:[]};return T={next:verb(0),throw:verb(1),return:verb(2)},"function"==typeof Symbol&&(T[Symbol.iterator]=function(){return this}),T;function verb(T){return function(A){return function step(T){if(y)throw new TypeError("Generator is already executing.");for(;w;)try{if(y=1,v&&(C=2&T[0]?v.return:T[0]?v.throw||((C=v.return)&&C.call(v),0):v.next)&&!(C=C.call(v,T[1])).done)return C;switch(v=0,C&&(T=[2&T[0],C.value]),T[0]){case 0:case 1:C=T;break;case 4:return w.label++,{value:T[1],done:!1};case 5:w.label++,v=T[1],T=[0];continue;case 7:T=w.ops.pop(),w.trys.pop();continue;default:if(!(C=w.trys,(C=C.length>0&&C[C.length-1])||6!==T[0]&&2!==T[0])){w=0;continue}if(3===T[0]&&(!C||T[1]>C[0]&&T[1]<C[3])){w.label=T[1];break}if(6===T[0]&&w.label<C[1]){w.label=C[1],C=T;break}if(C&&w.label<C[2]){w.label=C[2],w.ops.push(T);break}C[2]&&w.ops.pop(),w.trys.pop();continue}T=m.call(h,w)}catch(h){T=[6,h],v=0}finally{y=C=0}if(5&T[0])throw T[1];return{value:T[0]?T[1]:void 0,done:!0}}([T,A])}}},pe=function(){function WebSocketTransport(h,m,y,v,C,T){this.logger=y,this.accessTokenFactory=m,this.logMessageContent=v,this.webSocketConstructor=C,this.httpClient=h,this.onreceive=null,this.onclose=null,this.headers=T}return WebSocketTransport.prototype.connect=function(h,m){return WebSocketTransport_awaiter(this,void 0,void 0,(function(){var y,v=this;return WebSocketTransport_generator(this,(function(T){switch(T.label){case 0:return x.isRequired(h,"url"),x.isRequired(m,"transferFormat"),x.isIn(m,re,"transferFormat"),this.logger.log(C.Trace,"(WebSockets transport) Connecting."),this.accessTokenFactory?[4,this.accessTokenFactory()]:[3,2];case 1:(y=T.sent())&&(h+=(h.indexOf("?")<0?"?":"&")+"access_token="+encodeURIComponent(y)),T.label=2;case 2:return[2,new Promise((function(y,T){var w;h=h.replace(/^http/,"ws");var A=v.httpClient.getCookieString(h),P=!1;if(O.isNode){var k={},R=getUserAgentHeader(),M=R[0],N=R[1];k[M]=N,A&&(k.Cookie=""+A),w=new v.webSocketConstructor(h,void 0,{headers:he({},k,v.headers)})}w||(w=new v.webSocketConstructor(h)),m===re.Binary&&(w.binaryType="arraybuffer"),w.onopen=function(m){v.logger.log(C.Information,"WebSocket connected to "+h+"."),v.webSocket=w,P=!0,y()},w.onerror=function(h){var m=null;m="undefined"!=typeof ErrorEvent&&h instanceof ErrorEvent?h.error:new Error("There was an error with the transport."),T(m)},w.onmessage=function(h){if(v.logger.log(C.Trace,"(WebSockets transport) data received. "+getDataDetail(h.data,v.logMessageContent)+"."),v.onreceive)try{v.onreceive(h.data)}catch(h){return void v.close(h)}},w.onclose=function(h){if(P)v.close(h);else{var m=null;m="undefined"!=typeof ErrorEvent&&h instanceof ErrorEvent?h.error:new Error("There was an error with the transport."),T(m)}}}))]}}))}))},WebSocketTransport.prototype.send=function(h){return this.webSocket&&this.webSocket.readyState===this.webSocketConstructor.OPEN?(this.logger.log(C.Trace,"(WebSockets transport) sending data. "+getDataDetail(h,this.logMessageContent)+"."),this.webSocket.send(h),Promise.resolve()):Promise.reject("WebSocket is not in the OPEN state")},WebSocketTransport.prototype.stop=function(){return this.webSocket&&this.close(void 0),Promise.resolve()},WebSocketTransport.prototype.close=function(h){this.webSocket&&(this.webSocket.onclose=function(){},this.webSocket.onmessage=function(){},this.webSocket.onerror=function(){},this.webSocket.close(),this.webSocket=void 0),this.logger.log(C.Trace,"(WebSockets transport) socket closed."),this.onclose&&(!this.isCloseEvent(h)||!1!==h.wasClean&&1e3===h.code?h instanceof Error?this.onclose(h):this.onclose():this.onclose(new Error("WebSocket closed with status code: "+h.code+" ("+h.reason+").")))},WebSocketTransport.prototype.isCloseEvent=function(h){return h&&"boolean"==typeof h.wasClean&&"number"==typeof h.code},WebSocketTransport}(),me=Object.assign||function(h){for(var m,y=1,v=arguments.length;y<v;y++)for(var C in m=arguments[y])Object.prototype.hasOwnProperty.call(m,C)&&(h[C]=m[C]);return h},HttpConnection_awaiter=function(h,m,y,v){return new(y||(y=Promise))((function(C,T){function fulfilled(h){try{step(v.next(h))}catch(h){T(h)}}function rejected(h){try{step(v.throw(h))}catch(h){T(h)}}function step(h){h.done?C(h.value):new y((function(m){m(h.value)})).then(fulfilled,rejected)}step((v=v.apply(h,m||[])).next())}))},HttpConnection_generator=function(h,m){var y,v,C,T,w={label:0,sent:function(){if(1&C[0])throw C[1];return C[1]},trys:[],ops:[]};return T={next:verb(0),throw:verb(1),return:verb(2)},"function"==typeof Symbol&&(T[Symbol.iterator]=function(){return this}),T;function verb(T){return function(A){return function step(T){if(y)throw new TypeError("Generator is already executing.");for(;w;)try{if(y=1,v&&(C=2&T[0]?v.return:T[0]?v.throw||((C=v.return)&&C.call(v),0):v.next)&&!(C=C.call(v,T[1])).done)return C;switch(v=0,C&&(T=[2&T[0],C.value]),T[0]){case 0:case 1:C=T;break;case 4:return w.label++,{value:T[1],done:!1};case 5:w.label++,v=T[1],T=[0];continue;case 7:T=w.ops.pop(),w.trys.pop();continue;default:if(!(C=w.trys,(C=C.length>0&&C[C.length-1])||6!==T[0]&&2!==T[0])){w=0;continue}if(3===T[0]&&(!C||T[1]>C[0]&&T[1]<C[3])){w.label=T[1];break}if(6===T[0]&&w.label<C[1]){w.label=C[1],C=T;break}if(C&&w.label<C[2]){w.label=C[2],w.ops.push(T);break}C[2]&&w.ops.pop(),w.trys.pop();continue}T=m.call(h,w)}catch(h){T=[6,h],v=0}finally{y=C=0}if(5&T[0])throw T[1];return{value:T[0]?T[1]:void 0,done:!0}}([T,A])}}},fe=function(){function HttpConnection(h,m){if(void 0===m&&(m={}),this.stopPromiseResolver=function(){},this.features={},this.negotiateVersion=1,x.isRequired(h,"url"),this.logger=function createLogger(h){return void 0===h?new U(C.Information):null===h?N.instance:h.log?h:new U(h)}(m.logger),this.baseUrl=this.resolveUrl(h),(m=m||{}).logMessageContent=void 0!==m.logMessageContent&&m.logMessageContent,"boolean"!=typeof m.withCredentials&&void 0!==m.withCredentials)throw new Error("withCredentials option was not a 'boolean' or 'undefined' value");m.withCredentials=void 0===m.withCredentials||m.withCredentials;var y=null,v=null;if(O.isNode){var T=require;y=T("ws"),v=T("eventsource")}O.isNode||"undefined"==typeof WebSocket||m.WebSocket?O.isNode&&!m.WebSocket&&y&&(m.WebSocket=y):m.WebSocket=WebSocket,O.isNode||"undefined"==typeof EventSource||m.EventSource?O.isNode&&!m.EventSource&&void 0!==v&&(m.EventSource=v):m.EventSource=EventSource,this.httpClient=m.httpClient||new G(this.logger),this.connectionState="Disconnected",this.connectionStarted=!1,this.options=m,this.onreceive=null,this.onclose=null}return HttpConnection.prototype.start=function(h){return HttpConnection_awaiter(this,void 0,void 0,(function(){var m;return HttpConnection_generator(this,(function(y){switch(y.label){case 0:return h=h||re.Binary,x.isIn(h,re,"transferFormat"),this.logger.log(C.Debug,"Starting connection with transfer format '"+re[h]+"'."),"Disconnected"!==this.connectionState?[2,Promise.reject(new Error("Cannot start an HttpConnection that is not in the 'Disconnected' state."))]:(this.connectionState="Connecting",this.startInternalPromise=this.startInternal(h),[4,this.startInternalPromise]);case 1:return y.sent(),"Disconnecting"!==this.connectionState?[3,3]:(m="Failed to start the HttpConnection before stop() was called.",this.logger.log(C.Error,m),[4,this.stopPromise]);case 2:return y.sent(),[2,Promise.reject(new Error(m))];case 3:if("Connected"!==this.connectionState)return m="HttpConnection.startInternal completed gracefully but didn't enter the connection into the connected state!",this.logger.log(C.Error,m),[2,Promise.reject(new Error(m))];y.label=4;case 4:return this.connectionStarted=!0,[2]}}))}))},HttpConnection.prototype.send=function(h){return"Connected"!==this.connectionState?Promise.reject(new Error("Cannot send data if the connection is not in the 'Connected' State.")):(this.sendQueue||(this.sendQueue=new ye(this.transport)),this.sendQueue.send(h))},HttpConnection.prototype.stop=function(h){return HttpConnection_awaiter(this,void 0,void 0,(function(){var m=this;return HttpConnection_generator(this,(function(y){switch(y.label){case 0:return"Disconnected"===this.connectionState?(this.logger.log(C.Debug,"Call to HttpConnection.stop("+h+") ignored because the connection is already in the disconnected state."),[2,Promise.resolve()]):"Disconnecting"===this.connectionState?(this.logger.log(C.Debug,"Call to HttpConnection.stop("+h+") ignored because the connection is already in the disconnecting state."),[2,this.stopPromise]):(this.connectionState="Disconnecting",this.stopPromise=new Promise((function(h){m.stopPromiseResolver=h})),[4,this.stopInternal(h)]);case 1:return y.sent(),[4,this.stopPromise];case 2:return y.sent(),[2]}}))}))},HttpConnection.prototype.stopInternal=function(h){return HttpConnection_awaiter(this,void 0,void 0,(function(){var m;return HttpConnection_generator(this,(function(y){switch(y.label){case 0:this.stopError=h,y.label=1;case 1:return y.trys.push([1,3,,4]),[4,this.startInternalPromise];case 2:return y.sent(),[3,4];case 3:return y.sent(),[3,4];case 4:if(!this.transport)return[3,9];y.label=5;case 5:return y.trys.push([5,7,,8]),[4,this.transport.stop()];case 6:return y.sent(),[3,8];case 7:return m=y.sent(),this.logger.log(C.Error,"HttpConnection.transport.stop() threw error '"+m+"'."),this.stopConnection(),[3,8];case 8:return this.transport=void 0,[3,10];case 9:this.logger.log(C.Debug,"HttpConnection.transport is undefined in HttpConnection.stop() because start() failed."),y.label=10;case 10:return[2]}}))}))},HttpConnection.prototype.startInternal=function(h){return HttpConnection_awaiter(this,void 0,void 0,(function(){var m,y,v,T,w,A;return HttpConnection_generator(this,(function(P){switch(P.label){case 0:m=this.baseUrl,this.accessTokenFactory=this.options.accessTokenFactory,P.label=1;case 1:return P.trys.push([1,12,,13]),this.options.skipNegotiation?this.options.transport!==te.WebSockets?[3,3]:(this.transport=this.constructTransport(te.WebSockets),[4,this.startTransport(m,h)]):[3,5];case 2:return P.sent(),[3,4];case 3:throw new Error("Negotiation can only be skipped when using the WebSocket transport directly.");case 4:return[3,11];case 5:y=null,v=0,T=function(){var h;return HttpConnection_generator(this,(function(C){switch(C.label){case 0:return[4,w.getNegotiationResponse(m)];case 1:if(y=C.sent(),"Disconnecting"===w.connectionState||"Disconnected"===w.connectionState)throw new Error("The connection was stopped during negotiation.");if(y.error)throw new Error(y.error);if(y.ProtocolVersion)throw new Error("Detected a connection attempt to an ASP.NET SignalR Server. This client only supports connecting to an ASP.NET Core SignalR Server. See https://aka.ms/signalr-core-differences for details.");return y.url&&(m=y.url),y.accessToken&&(h=y.accessToken,w.accessTokenFactory=function(){return h}),v++,[2]}}))},w=this,P.label=6;case 6:return[5,T()];case 7:P.sent(),P.label=8;case 8:if(y.url&&v<100)return[3,6];P.label=9;case 9:if(100===v&&y.url)throw new Error("Negotiate redirection limit exceeded.");return[4,this.createTransport(m,this.options.transport,y,h)];case 10:P.sent(),P.label=11;case 11:return this.transport instanceof le&&(this.features.inherentKeepAlive=!0),"Connecting"===this.connectionState&&(this.logger.log(C.Debug,"The HttpConnection connected successfully."),this.connectionState="Connected"),[3,13];case 12:return A=P.sent(),this.logger.log(C.Error,"Failed to start the connection: "+A),this.connectionState="Disconnected",this.transport=void 0,this.stopPromiseResolver(),[2,Promise.reject(A)];case 13:return[2]}}))}))},HttpConnection.prototype.getNegotiationResponse=function(h){return HttpConnection_awaiter(this,void 0,void 0,(function(){var m,y,v,T,w,A,P,k,R;return HttpConnection_generator(this,(function(M){switch(M.label){case 0:return m={},this.accessTokenFactory?[4,this.accessTokenFactory()]:[3,2];case 1:(y=M.sent())&&(m.Authorization="Bearer "+y),M.label=2;case 2:v=getUserAgentHeader(),T=v[0],w=v[1],m[T]=w,A=this.resolveNegotiateUrl(h),this.logger.log(C.Debug,"Sending negotiation request: "+A+"."),M.label=3;case 3:return M.trys.push([3,5,,6]),[4,this.httpClient.post(A,{content:"",headers:me({},m,this.options.headers),withCredentials:this.options.withCredentials})];case 4:return 200!==(P=M.sent()).statusCode?[2,Promise.reject(new Error("Unexpected status code returned from negotiate '"+P.statusCode+"'"))]:((!(k=JSON.parse(P.content)).negotiateVersion||k.negotiateVersion<1)&&(k.connectionToken=k.connectionId),[2,k]);case 5:return R=M.sent(),this.logger.log(C.Error,"Failed to complete negotiation with the server: "+R),[2,Promise.reject(R)];case 6:return[2]}}))}))},HttpConnection.prototype.createConnectUrl=function(h,m){return m?h+(-1===h.indexOf("?")?"?":"&")+"id="+m:h},HttpConnection.prototype.createTransport=function(h,m,y,v){return HttpConnection_awaiter(this,void 0,void 0,(function(){var T,w,A,P,k,R,M,N,D,I,x;return HttpConnection_generator(this,(function(O){switch(O.label){case 0:return T=this.createConnectUrl(h,y.connectionToken),this.isITransport(m)?(this.logger.log(C.Debug,"Connection was provided an instance of ITransport, using that directly."),this.transport=m,[4,this.startTransport(T,v)]):[3,2];case 1:return O.sent(),this.connectionId=y.connectionId,[2];case 2:w=[],A=y.availableTransports||[],P=y,k=0,R=A,O.label=3;case 3:return k<R.length?(M=R[k],(N=this.resolveTransportOrError(M,m,v))instanceof Error?(w.push(M.transport+" failed: "+N),[3,12]):[3,4]):[3,13];case 4:if(!this.isITransport(N))return[3,12];if(this.transport=N,P)return[3,9];O.label=5;case 5:return O.trys.push([5,7,,8]),[4,this.getNegotiationResponse(h)];case 6:return P=O.sent(),[3,8];case 7:return D=O.sent(),[2,Promise.reject(D)];case 8:T=this.createConnectUrl(h,P.connectionToken),O.label=9;case 9:return O.trys.push([9,11,,12]),[4,this.startTransport(T,v)];case 10:return O.sent(),this.connectionId=P.connectionId,[2];case 11:return I=O.sent(),this.logger.log(C.Error,"Failed to start the transport '"+M.transport+"': "+I),P=void 0,w.push(M.transport+" failed: "+I),"Connecting"!==this.connectionState?(x="Failed to select transport before stop() was called.",this.logger.log(C.Debug,x),[2,Promise.reject(new Error(x))]):[3,12];case 12:return k++,[3,3];case 13:return w.length>0?[2,Promise.reject(new Error("Unable to connect to the server with any of the available transports. "+w.join(" ")))]:[2,Promise.reject(new Error("None of the transports supported by the client are supported by the server."))]}}))}))},HttpConnection.prototype.constructTransport=function(h){switch(h){case te.WebSockets:if(!this.options.WebSocket)throw new Error("'WebSocket' is not supported in your environment.");return new pe(this.httpClient,this.accessTokenFactory,this.logger,this.options.logMessageContent||!1,this.options.WebSocket,this.options.headers||{});case te.ServerSentEvents:if(!this.options.EventSource)throw new Error("'EventSource' is not supported in your environment.");return new de(this.httpClient,this.accessTokenFactory,this.logger,this.options.logMessageContent||!1,this.options.EventSource,this.options.withCredentials,this.options.headers||{});case te.LongPolling:return new le(this.httpClient,this.accessTokenFactory,this.logger,this.options.logMessageContent||!1,this.options.withCredentials,this.options.headers||{});default:throw new Error("Unknown transport: "+h+".")}},HttpConnection.prototype.startTransport=function(h,m){var y=this;return this.transport.onreceive=this.onreceive,this.transport.onclose=function(h){return y.stopConnection(h)},this.transport.connect(h,m)},HttpConnection.prototype.resolveTransportOrError=function(h,m,y){var v=te[h.transport];if(null==v)return this.logger.log(C.Debug,"Skipping transport '"+h.transport+"' because it is not supported by this client."),new Error("Skipping transport '"+h.transport+"' because it is not supported by this client.");if(!function transportMatches(h,m){return!h||0!=(m&h)}(m,v))return this.logger.log(C.Debug,"Skipping transport '"+te[v]+"' because it was disabled by the client."),new Error("'"+te[v]+"' is disabled by the client.");if(!(h.transferFormats.map((function(h){return re[h]})).indexOf(y)>=0))return this.logger.log(C.Debug,"Skipping transport '"+te[v]+"' because it does not support the requested transfer format '"+re[y]+"'."),new Error("'"+te[v]+"' does not support "+re[y]+".");if(v===te.WebSockets&&!this.options.WebSocket||v===te.ServerSentEvents&&!this.options.EventSource)return this.logger.log(C.Debug,"Skipping transport '"+te[v]+"' because it is not supported in your environment.'"),new Error("'"+te[v]+"' is not supported in your environment.");this.logger.log(C.Debug,"Selecting transport '"+te[v]+"'.");try{return this.constructTransport(v)}catch(h){return h}},HttpConnection.prototype.isITransport=function(h){return h&&"object"==typeof h&&"connect"in h},HttpConnection.prototype.stopConnection=function(h){var m=this;if(this.logger.log(C.Debug,"HttpConnection.stopConnection("+h+") called while in state "+this.connectionState+"."),this.transport=void 0,h=this.stopError||h,this.stopError=void 0,"Disconnected"!==this.connectionState){if("Connecting"===this.connectionState)throw this.logger.log(C.Warning,"Call to HttpConnection.stopConnection("+h+") was ignored because the connection is still in the connecting state."),new Error("HttpConnection.stopConnection("+h+") was called while the connection is still in the connecting state.");if("Disconnecting"===this.connectionState&&this.stopPromiseResolver(),h?this.logger.log(C.Error,"Connection disconnected with error '"+h+"'."):this.logger.log(C.Information,"Connection disconnected."),this.sendQueue&&(this.sendQueue.stop().catch((function(h){m.logger.log(C.Error,"TransportSendQueue.stop() threw error '"+h+"'.")})),this.sendQueue=void 0),this.connectionId=void 0,this.connectionState="Disconnected",this.connectionStarted){this.connectionStarted=!1;try{this.onclose&&this.onclose(h)}catch(m){this.logger.log(C.Error,"HttpConnection.onclose("+h+") threw error '"+m+"'.")}}}else this.logger.log(C.Debug,"Call to HttpConnection.stopConnection("+h+") was ignored because the connection is already in the disconnected state.")},HttpConnection.prototype.resolveUrl=function(h){if(0===h.lastIndexOf("https://",0)||0===h.lastIndexOf("http://",0))return h;if(!O.isBrowser||!window.document)throw new Error("Cannot resolve '"+h+"'.");var m=window.document.createElement("a");return m.href=h,this.logger.log(C.Information,"Normalizing '"+h+"' to '"+m.href+"'."),m.href},HttpConnection.prototype.resolveNegotiateUrl=function(h){var m=h.indexOf("?"),y=h.substring(0,-1===m?h.length:m);return"/"!==y[y.length-1]&&(y+="/"),y+="negotiate",-1===(y+=-1===m?"":h.substring(m)).indexOf("negotiateVersion")&&(y+=-1===m?"?":"&",y+="negotiateVersion="+this.negotiateVersion),y},HttpConnection}();var ye=function(){function TransportSendQueue(h){this.transport=h,this.buffer=[],this.executing=!0,this.sendBufferedData=new ve,this.transportResult=new ve,this.sendLoopPromise=this.sendLoop()}return TransportSendQueue.prototype.send=function(h){return this.bufferData(h),this.transportResult||(this.transportResult=new ve),this.transportResult.promise},TransportSendQueue.prototype.stop=function(){return this.executing=!1,this.sendBufferedData.resolve(),this.sendLoopPromise},TransportSendQueue.prototype.bufferData=function(h){if(this.buffer.length&&typeof this.buffer[0]!=typeof h)throw new Error("Expected data to be of type "+typeof this.buffer+" but was of type "+typeof h);this.buffer.push(h),this.sendBufferedData.resolve()},TransportSendQueue.prototype.sendLoop=function(){return HttpConnection_awaiter(this,void 0,void 0,(function(){var h,m,y;return HttpConnection_generator(this,(function(v){switch(v.label){case 0:return[4,this.sendBufferedData.promise];case 1:if(v.sent(),!this.executing)return this.transportResult&&this.transportResult.reject("Connection stopped."),[3,6];this.sendBufferedData=new ve,h=this.transportResult,this.transportResult=void 0,m="string"==typeof this.buffer[0]?this.buffer.join(""):TransportSendQueue.concatBuffers(this.buffer),this.buffer.length=0,v.label=2;case 2:return v.trys.push([2,4,,5]),[4,this.transport.send(m)];case 3:return v.sent(),h.resolve(),[3,5];case 4:return y=v.sent(),h.reject(y),[3,5];case 5:return[3,0];case 6:return[2]}}))}))},TransportSendQueue.concatBuffers=function(h){for(var m=h.map((function(h){return h.byteLength})).reduce((function(h,m){return h+m})),y=new Uint8Array(m),v=0,C=0,T=h;C<T.length;C++){var w=T[C];y.set(new Uint8Array(w),v),v+=w.byteLength}return y.buffer},TransportSendQueue}(),ve=function(){function PromiseSource(){var h=this;this.promise=new Promise((function(m,y){var v;return v=[m,y],h.resolver=v[0],h.rejecter=v[1],v}))}return PromiseSource.prototype.resolve=function(){this.resolver()},PromiseSource.prototype.reject=function(h){this.rejecter(h)},PromiseSource}(),Se=function(){function JsonHubProtocol(){this.name="json",this.version=1,this.transferFormat=re.Text}return JsonHubProtocol.prototype.parseMessages=function(h,m){if("string"!=typeof h)throw new Error("Invalid input for JSON hub protocol. Expected a string.");if(!h)return[];null===m&&(m=N.instance);for(var y=[],v=0,T=J.parse(h);v<T.length;v++){var w=T[v],A=JSON.parse(w);if("number"!=typeof A.type)throw new Error("Invalid payload.");switch(A.type){case Y.Invocation:this.isInvocationMessage(A);break;case Y.StreamItem:this.isStreamItemMessage(A);break;case Y.Completion:this.isCompletionMessage(A);break;case Y.Ping:case Y.Close:break;default:m.log(C.Information,"Unknown message type '"+A.type+"' ignored.");continue}y.push(A)}return y},JsonHubProtocol.prototype.writeMessage=function(h){return J.write(JSON.stringify(h))},JsonHubProtocol.prototype.isInvocationMessage=function(h){this.assertNotEmptyString(h.target,"Invalid payload for Invocation message."),void 0!==h.invocationId&&this.assertNotEmptyString(h.invocationId,"Invalid payload for Invocation message.")},JsonHubProtocol.prototype.isStreamItemMessage=function(h){if(this.assertNotEmptyString(h.invocationId,"Invalid payload for StreamItem message."),void 0===h.item)throw new Error("Invalid payload for StreamItem message.")},JsonHubProtocol.prototype.isCompletionMessage=function(h){if(h.result&&h.error)throw new Error("Invalid payload for Completion message.");!h.result&&h.error&&this.assertNotEmptyString(h.error,"Invalid payload for Completion message."),this.assertNotEmptyString(h.invocationId,"Invalid payload for Completion message.")},JsonHubProtocol.prototype.assertNotEmptyString=function(h,m){if("string"!=typeof h||""===h)throw new Error(m)},JsonHubProtocol}(),Ee=Object.assign||function(h){for(var m,y=1,v=arguments.length;y<v;y++)for(var C in m=arguments[y])Object.prototype.hasOwnProperty.call(m,C)&&(h[C]=m[C]);return h},Ce={trace:C.Trace,debug:C.Debug,info:C.Information,information:C.Information,warn:C.Warning,warning:C.Warning,error:C.Error,critical:C.Critical,none:C.None};var _e=function(){function HubConnectionBuilder(){}return HubConnectionBuilder.prototype.configureLogging=function(h){if(x.isRequired(h,"logging"),function isLogger(h){return void 0!==h.log}(h))this.logger=h;else if("string"==typeof h){var m=function parseLogLevel(h){var m=Ce[h.toLowerCase()];if(void 0!==m)return m;throw new Error("Unknown log level: "+h)}(h);this.logger=new U(m)}else this.logger=new U(h);return this},HubConnectionBuilder.prototype.withUrl=function(h,m){return x.isRequired(h,"url"),x.isNotEmpty(h,"url"),this.url=h,this.httpConnectionOptions=Ee({},this.httpConnectionOptions,"object"==typeof m?m:{transport:m}),this},HubConnectionBuilder.prototype.withHubProtocol=function(h){return x.isRequired(h,"protocol"),this.protocol=h,this},HubConnectionBuilder.prototype.withAutomaticReconnect=function(h){if(this.reconnectPolicy)throw new Error("A reconnectPolicy has already been set.");return h?Array.isArray(h)?this.reconnectPolicy=new oe(h):this.reconnectPolicy=h:this.reconnectPolicy=new oe,this},HubConnectionBuilder.prototype.build=function(){var h=this.httpConnectionOptions||{};if(void 0===h.logger&&(h.logger=this.logger),!this.url)throw new Error("The 'HubConnectionBuilder.withUrl' method must be called before building the connection.");var m=new fe(this.url,h);return ie.create(m,this.logger||N.instance,this.protocol||new Se,this.reconnectPolicy)},HubConnectionBuilder}()},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0});var v=y(748);m.DebugConsoleLogger=v.DebugConsoleLogger},function(h,m,y){h.exports=function setup(h){function createDebug(h){let m,y=null;function debug(...h){if(!debug.enabled)return;const y=debug,v=Number(new Date),C=v-(m||v);y.diff=C,y.prev=m,y.curr=v,m=v,h[0]=createDebug.coerce(h[0]),"string"!=typeof h[0]&&h.unshift("%O");let T=0;h[0]=h[0].replace(/%([a-zA-Z%])/g,(m,v)=>{if("%%"===m)return"%";T++;const C=createDebug.formatters[v];if("function"==typeof C){const v=h[T];m=C.call(y,v),h.splice(T,1),T--}return m}),createDebug.formatArgs.call(y,h),(y.log||createDebug.log).apply(y,h)}return debug.namespace=h,debug.useColors=createDebug.useColors(),debug.color=createDebug.selectColor(h),debug.extend=extend,debug.destroy=createDebug.destroy,Object.defineProperty(debug,"enabled",{enumerable:!0,configurable:!1,get:()=>null===y?createDebug.enabled(h):y,set:h=>{y=h}}),"function"==typeof createDebug.init&&createDebug.init(debug),debug}function extend(h,m){const y=createDebug(this.namespace+(void 0===m?":":m)+h);return y.log=this.log,y}function toNamespace(h){return h.toString().substring(2,h.toString().length-2).replace(/\.\*\?$/,"*")}return createDebug.debug=createDebug,createDebug.default=createDebug,createDebug.coerce=function coerce(h){if(h instanceof Error)return h.stack||h.message;return h},createDebug.disable=function disable(){const h=[...createDebug.names.map(toNamespace),...createDebug.skips.map(toNamespace).map(h=>"-"+h)].join(",");return createDebug.enable(""),h},createDebug.enable=function enable(h){let m;createDebug.save(h),createDebug.names=[],createDebug.skips=[];const y=("string"==typeof h?h:"").split(/[\s,]+/),v=y.length;for(m=0;m<v;m++)y[m]&&("-"===(h=y[m].replace(/\*/g,".*?"))[0]?createDebug.skips.push(new RegExp("^"+h.substr(1)+"$")):createDebug.names.push(new RegExp("^"+h+"$")))},createDebug.enabled=function enabled(h){if("*"===h[h.length-1])return!0;let m,y;for(m=0,y=createDebug.skips.length;m<y;m++)if(createDebug.skips[m].test(h))return!1;for(m=0,y=createDebug.names.length;m<y;m++)if(createDebug.names[m].test(h))return!0;return!1},createDebug.humanize=y(751),createDebug.destroy=function destroy(){console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.")},Object.keys(h).forEach(m=>{createDebug[m]=h[m]}),createDebug.names=[],createDebug.skips=[],createDebug.formatters={},createDebug.selectColor=function selectColor(h){let m=0;for(let y=0;y<h.length;y++)m=(m<<5)-m+h.charCodeAt(y),m|=0;return createDebug.colors[Math.abs(m)%createDebug.colors.length]},createDebug.enable(createDebug.load()),createDebug}},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0});const v=y(117),C=y(118),T=y(150);class ConsoleTraceListener extends T.TraceListener{constructor(h=console){super(),this.consoleReference=h}writeTo(h){this.consoleReference.log(h)}writeEvent(h,m,y,T,...w){const A=C.TraceFormat.formatEvent(null,h,m,y,T,...w);switch(m){case v.LogLevel.Critical:case v.LogLevel.Error:return this.consoleReference.error(A);case v.LogLevel.Warning:return this.consoleReference.warn(A);case v.LogLevel.Debug:return this.consoleReference.debug?this.consoleReference.debug(A):this.consoleReference.log(A);default:return this.consoleReference.log(A)}}}m.ConsoleTraceListener=ConsoleTraceListener},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0});const v=y(756);class Privacy{static setKey(h){Privacy.privacyKey=h}static getShortHash(h,m=8,y=!1){return this.getHash(h,y).substr(0,m)}static getHash(h,m=!1){if(!h)return"<null>";let y;if(m)y=v.sha256.create();else{if(!Privacy.privacyKey)return"<redacted>";y=v.sha256.hmac.create(Privacy.privacyKey)}return y.update(h).hex()}static getSha256Hash(h,m){const y=v.sha256.create().update((new TextEncoder).encode(h||"")).toString();return"number"==typeof m&&m>0&&y.length>m?y.substr(0,m):y}}m.Privacy=Privacy},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0});const v=y(202);class LoggerSettings{}m.LoggerSettings=LoggerSettings,LoggerSettings.disableObfuscation=!1,LoggerSettings.obfuscateProperties={email:v.LogValueType.Email,name:v.LogValueType.Text,token:v.LogValueType.Text,sessionToken:v.LogValueType.Text}},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0});var v=y(758);m.errorToString=v.errorToString},function(h,m,y){var v=y(338),C=y(119),T=y(339).ArraySet,w=y(762).MappingList;function SourceMapGenerator(h){h||(h={}),this._file=C.getArg(h,"file",null),this._sourceRoot=C.getArg(h,"sourceRoot",null),this._skipValidation=C.getArg(h,"skipValidation",!1),this._sources=new T,this._names=new T,this._mappings=new w,this._sourcesContents=null}SourceMapGenerator.prototype._version=3,SourceMapGenerator.fromSourceMap=function SourceMapGenerator_fromSourceMap(h){var m=h.sourceRoot,y=new SourceMapGenerator({file:h.file,sourceRoot:m});return h.eachMapping((function(h){var v={generated:{line:h.generatedLine,column:h.generatedColumn}};null!=h.source&&(v.source=h.source,null!=m&&(v.source=C.relative(m,v.source)),v.original={line:h.originalLine,column:h.originalColumn},null!=h.name&&(v.name=h.name)),y.addMapping(v)})),h.sources.forEach((function(v){var T=v;null!==m&&(T=C.relative(m,v)),y._sources.has(T)||y._sources.add(T);var w=h.sourceContentFor(v);null!=w&&y.setSourceContent(v,w)})),y},SourceMapGenerator.prototype.addMapping=function SourceMapGenerator_addMapping(h){var m=C.getArg(h,"generated"),y=C.getArg(h,"original",null),v=C.getArg(h,"source",null),T=C.getArg(h,"name",null);this._skipValidation||this._validateMapping(m,y,v,T),null!=v&&(v=String(v),this._sources.has(v)||this._sources.add(v)),null!=T&&(T=String(T),this._names.has(T)||this._names.add(T)),this._mappings.add({generatedLine:m.line,generatedColumn:m.column,originalLine:null!=y&&y.line,originalColumn:null!=y&&y.column,source:v,name:T})},SourceMapGenerator.prototype.setSourceContent=function SourceMapGenerator_setSourceContent(h,m){var y=h;null!=this._sourceRoot&&(y=C.relative(this._sourceRoot,y)),null!=m?(this._sourcesContents||(this._sourcesContents=Object.create(null)),this._sourcesContents[C.toSetString(y)]=m):this._sourcesContents&&(delete this._sourcesContents[C.toSetString(y)],0===Object.keys(this._sourcesContents).length&&(this._sourcesContents=null))},SourceMapGenerator.prototype.applySourceMap=function SourceMapGenerator_applySourceMap(h,m,y){var v=m;if(null==m){if(null==h.file)throw new Error('SourceMapGenerator.prototype.applySourceMap requires either an explicit source file, or the source map\'s "file" property. Both were omitted.');v=h.file}var w=this._sourceRoot;null!=w&&(v=C.relative(w,v));var A=new T,P=new T;this._mappings.unsortedForEach((function(m){if(m.source===v&&null!=m.originalLine){var T=h.originalPositionFor({line:m.originalLine,column:m.originalColumn});null!=T.source&&(m.source=T.source,null!=y&&(m.source=C.join(y,m.source)),null!=w&&(m.source=C.relative(w,m.source)),m.originalLine=T.line,m.originalColumn=T.column,null!=T.name&&(m.name=T.name))}var k=m.source;null==k||A.has(k)||A.add(k);var R=m.name;null==R||P.has(R)||P.add(R)}),this),this._sources=A,this._names=P,h.sources.forEach((function(m){var v=h.sourceContentFor(m);null!=v&&(null!=y&&(m=C.join(y,m)),null!=w&&(m=C.relative(w,m)),this.setSourceContent(m,v))}),this)},SourceMapGenerator.prototype._validateMapping=function SourceMapGenerator_validateMapping(h,m,y,v){if(m&&"number"!=typeof m.line&&"number"!=typeof m.column)throw new Error("original.line and original.column are not numbers -- you probably meant to omit the original mapping entirely and only map the generated position. If so, pass null for the original mapping instead of an object with empty or null values.");if((!(h&&"line"in h&&"column"in h&&h.line>0&&h.column>=0)||m||y||v)&&!(h&&"line"in h&&"column"in h&&m&&"line"in m&&"column"in m&&h.line>0&&h.column>=0&&m.line>0&&m.column>=0&&y))throw new Error("Invalid mapping: "+JSON.stringify({generated:h,source:y,original:m,name:v}))},SourceMapGenerator.prototype._serializeMappings=function SourceMapGenerator_serializeMappings(){for(var h,m,y,T,w=0,A=1,P=0,k=0,R=0,M=0,N="",D=this._mappings.toArray(),I=0,x=D.length;I<x;I++){if(h="",(m=D[I]).generatedLine!==A)for(w=0;m.generatedLine!==A;)h+=";",A++;else if(I>0){if(!C.compareByGeneratedPositionsInflated(m,D[I-1]))continue;h+=","}h+=v.encode(m.generatedColumn-w),w=m.generatedColumn,null!=m.source&&(T=this._sources.indexOf(m.source),h+=v.encode(T-M),M=T,h+=v.encode(m.originalLine-1-k),k=m.originalLine-1,h+=v.encode(m.originalColumn-P),P=m.originalColumn,null!=m.name&&(y=this._names.indexOf(m.name),h+=v.encode(y-R),R=y)),N+=h}return N},SourceMapGenerator.prototype._generateSourcesContent=function SourceMapGenerator_generateSourcesContent(h,m){return h.map((function(h){if(!this._sourcesContents)return null;null!=m&&(h=C.relative(m,h));var y=C.toSetString(h);return Object.prototype.hasOwnProperty.call(this._sourcesContents,y)?this._sourcesContents[y]:null}),this)},SourceMapGenerator.prototype.toJSON=function SourceMapGenerator_toJSON(){var h={version:this._version,sources:this._sources.toArray(),names:this._names.toArray(),mappings:this._serializeMappings()};return null!=this._file&&(h.file=this._file),null!=this._sourceRoot&&(h.sourceRoot=this._sourceRoot),this._sourcesContents&&(h.sourcesContent=this._generateSourcesContent(h.sources,h.sourceRoot)),h},SourceMapGenerator.prototype.toString=function SourceMapGenerator_toString(){return JSON.stringify(this.toJSON())},m.SourceMapGenerator=SourceMapGenerator},function(h,m,y){var v=y(761);m.encode=function base64VLQ_encode(h){var m,y="",C=function toVLQSigned(h){return h<0?1+(-h<<1):0+(h<<1)}(h);do{m=31&C,(C>>>=5)>0&&(m|=32),y+=v.encode(m)}while(C>0);return y},m.decode=function base64VLQ_decode(h,m,y){var C,T,w=h.length,A=0,P=0;do{if(m>=w)throw new Error("Expected more digits in base 64 VLQ value.");if(-1===(T=v.decode(h.charCodeAt(m++))))throw new Error("Invalid base64 digit: "+h.charAt(m-1));C=!!(32&T),A+=(T&=31)<<P,P+=5}while(C);y.value=function fromVLQSigned(h){var m=h>>1;return 1==(1&h)?-m:m}(A),y.rest=m}},function(h,m,y){var v=y(119),C=Object.prototype.hasOwnProperty,T="undefined"!=typeof Map;function ArraySet(){this._array=[],this._set=T?new Map:Object.create(null)}ArraySet.fromArray=function ArraySet_fromArray(h,m){for(var y=new ArraySet,v=0,C=h.length;v<C;v++)y.add(h[v],m);return y},ArraySet.prototype.size=function ArraySet_size(){return T?this._set.size:Object.getOwnPropertyNames(this._set).length},ArraySet.prototype.add=function ArraySet_add(h,m){var y=T?h:v.toSetString(h),w=T?this.has(h):C.call(this._set,y),A=this._array.length;w&&!m||this._array.push(h),w||(T?this._set.set(h,A):this._set[y]=A)},ArraySet.prototype.has=function ArraySet_has(h){if(T)return this._set.has(h);var m=v.toSetString(h);return C.call(this._set,m)},ArraySet.prototype.indexOf=function ArraySet_indexOf(h){if(T){var m=this._set.get(h);if(m>=0)return m}else{var y=v.toSetString(h);if(C.call(this._set,y))return this._set[y]}throw new Error('"'+h+'" is not in the set.')},ArraySet.prototype.at=function ArraySet_at(h){if(h>=0&&h<this._array.length)return this._array[h];throw new Error("No element indexed by "+h)},ArraySet.prototype.toArray=function ArraySet_toArray(){return this._array.slice()},m.ArraySet=ArraySet},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0});const v=y(89);class AssertionError extends v.BaseError{constructor(){super(...arguments),this.errorType="AssertionError"}}m.AssertionError=AssertionError},function(h,m,y){"use strict";var v=this&&this.__awaiter||function(h,m,y,v){return new(y||(y=Promise))((function(C,T){function fulfilled(h){try{step(v.next(h))}catch(h){T(h)}}function rejected(h){try{step(v.throw(h))}catch(h){T(h)}}function step(h){h.done?C(h.value):function adopt(h){return h instanceof y?h:new y((function(m){m(h)}))}(h.value).then(fulfilled,rejected)}step((v=v.apply(h,m||[])).next())}))};Object.defineProperty(m,"__esModule",{value:!0});const C=y(90),T=y(73),w=y(205),throwAggregateError=(h,m)=>{if(m)throw h.lastError;throw h},A={retries:2,retryDelay:0,shouldStopRetries:()=>!1,isAggregateError:!0};m.withRetries=(h,y={},P=new C.AggregateError)=>v(void 0,void 0,void 0,(function*(){const v=Object.assign(Object.assign({},A),y),{retries:k,retryDelay:R,shouldStopRetries:M,cancellationToken:N,isAggregateError:D}=v,I=new C.AssertionError("Retries should have at least zero retries.");T.assert(k>-1,D?P.cloneWithErrors(I):I);try{return T.assert(!(null==N?void 0:N.isCancellationRequested),new C.CancellationError("CancellationToken is cancelled.")),yield h(k)}catch(y){if(P.addErrors(y),yield M(y))return throwAggregateError(P,!D);if(y instanceof C.CancellationError)return throwAggregateError(P,!D);const A=new C.CancellationError("CancellationToken is cancelled after retry.");return T.assert(!(null==N?void 0:N.isCancellationRequested),D?P.cloneWithErrors(A):A),k>0?(yield w.wait(R),yield m.withRetries(h,Object.assign(Object.assign({},v),{retries:k-1}),P)):throwAggregateError(P,!D)}}))},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0});const v=y(89);class PromiseRaceError extends v.BaseError{constructor(h,m,y){super(m,y),this.errorList=h,this.errorType="PromiseRaceError"}}m.PromiseRaceError=PromiseRaceError},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0});var v=y(789);m.assertInstance=v.assertInstance;var C=y(152);m.assertDefined=C.assertDefined;var T=y(790);m.assertNever=T.assertNever;var w=y(73);m.assert=w.assert},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0});const v=y(120);var C;!function(h){h.ParseError=-32700,h.InvalidRequest=-32600,h.MethodNotFound=-32601,h.InvalidParams=-32602,h.InternalError=-32603,h.serverErrorStart=-32099,h.serverErrorEnd=-32e3,h.ServerNotInitialized=-32002,h.UnknownErrorCode=-32001,h.RequestCancelled=-32800,h.MessageWriteError=1,h.MessageReadError=2}(C=m.ErrorCodes||(m.ErrorCodes={}));class ResponseError extends Error{constructor(h,m,y){super(m),this.code=v.number(h)?h:C.UnknownErrorCode,this.data=y,Object.setPrototypeOf(this,ResponseError.prototype)}toJson(){return{code:this.code,message:this.message,data:this.data}}}m.ResponseError=ResponseError;class AbstractMessageType{constructor(h,m){this._method=h,this._numberOfParams=m}get method(){return this._method}get numberOfParams(){return this._numberOfParams}}m.AbstractMessageType=AbstractMessageType;m.RequestType0=class RequestType0 extends AbstractMessageType{constructor(h){super(h,0),this._=void 0}};m.RequestType=class RequestType extends AbstractMessageType{constructor(h){super(h,1),this._=void 0}};m.RequestType1=class RequestType1 extends AbstractMessageType{constructor(h){super(h,1),this._=void 0}};m.RequestType2=class RequestType2 extends AbstractMessageType{constructor(h){super(h,2),this._=void 0}};m.RequestType3=class RequestType3 extends AbstractMessageType{constructor(h){super(h,3),this._=void 0}};m.RequestType4=class RequestType4 extends AbstractMessageType{constructor(h){super(h,4),this._=void 0}};m.RequestType5=class RequestType5 extends AbstractMessageType{constructor(h){super(h,5),this._=void 0}};m.RequestType6=class RequestType6 extends AbstractMessageType{constructor(h){super(h,6),this._=void 0}};m.RequestType7=class RequestType7 extends AbstractMessageType{constructor(h){super(h,7),this._=void 0}};m.RequestType8=class RequestType8 extends AbstractMessageType{constructor(h){super(h,8),this._=void 0}};m.RequestType9=class RequestType9 extends AbstractMessageType{constructor(h){super(h,9),this._=void 0}};m.NotificationType=class NotificationType extends AbstractMessageType{constructor(h){super(h,1),this._=void 0}};m.NotificationType0=class NotificationType0 extends AbstractMessageType{constructor(h){super(h,0),this._=void 0}};m.NotificationType1=class NotificationType1 extends AbstractMessageType{constructor(h){super(h,1),this._=void 0}};m.NotificationType2=class NotificationType2 extends AbstractMessageType{constructor(h){super(h,2),this._=void 0}};m.NotificationType3=class NotificationType3 extends AbstractMessageType{constructor(h){super(h,3),this._=void 0}};m.NotificationType4=class NotificationType4 extends AbstractMessageType{constructor(h){super(h,4),this._=void 0}};m.NotificationType5=class NotificationType5 extends AbstractMessageType{constructor(h){super(h,5),this._=void 0}};m.NotificationType6=class NotificationType6 extends AbstractMessageType{constructor(h){super(h,6),this._=void 0}};m.NotificationType7=class NotificationType7 extends AbstractMessageType{constructor(h){super(h,7),this._=void 0}};m.NotificationType8=class NotificationType8 extends AbstractMessageType{constructor(h){super(h,8),this._=void 0}};m.NotificationType9=class NotificationType9 extends AbstractMessageType{constructor(h){super(h,9),this._=void 0}},m.isRequestMessage=function isRequestMessage(h){let m=h;return m&&v.string(m.method)&&(v.string(m.id)||v.number(m.id))},m.isNotificationMessage=function isNotificationMessage(h){let m=h;return m&&v.string(m.method)&&void 0===h.id},m.isResponseMessage=function isResponseMessage(h){let m=h;return m&&(void 0!==m.result||!!m.error)&&(v.string(m.id)||v.number(m.id)||null===m.id)}},function(h,m,y){"use strict";var v=this&&this.__awaiter||function(h,m,y,v){return new(y||(y=Promise))((function(C,T){function fulfilled(h){try{step(v.next(h))}catch(h){T(h)}}function rejected(h){try{step(v.throw(h))}catch(h){T(h)}}function step(h){h.done?C(h.value):function adopt(h){return h instanceof y?h:new y((function(m){m(h)}))}(h.value).then(fulfilled,rejected)}step((v=v.apply(h,m||[])).next())}))};Object.defineProperty(m,"__esModule",{value:!0}),m.createDisposable=function createDisposable(h,m){return{dispose:y=>(null==m||m.verbose(`Disposing reason:${y}`),h(y))}},m.createDisposablesAll=function createDisposablesAll(h,...m){return{dispose:y=>(null==h||h.verbose(`createDisposablesAll->dispose reason:${y}`),Promise.all(m.map(h=>h.dispose(y))))}},m.createDisposablesSeries=function createDisposablesSeries(h,...m){return{dispose:y=>v(this,void 0,void 0,(function*(){null==h||h.verbose(`createDisposablesSeries->dispose reason:${y}`);for(let v of m)try{yield v.dispose(y)}catch(m){null==h||h.error("Failed to dispose",m)}}))}}},function(h,m,y){"use strict";var v=this&&this.__awaiter||function(h,m,y,v){return new(y||(y=Promise))((function(C,T){function fulfilled(h){try{step(v.next(h))}catch(h){T(h)}}function rejected(h){try{step(v.throw(h))}catch(h){T(h)}}function step(h){h.done?C(h.value):function adopt(h){return h instanceof y?h:new y((function(m){m(h)}))}(h.value).then(fulfilled,rejected)}step((v=v.apply(h,m||[])).next())}))};Object.defineProperty(m,"__esModule",{value:!0});const C=y(204),T=y(90);m.timeoutPromise=(h,m,y,w)=>v(void 0,void 0,void 0,(function*(){let v,A;const dispose=()=>{null==A||A.dispose(),clearTimeout(v)};return yield Promise.race([h.finally(()=>{dispose()}),new Promise((h,P)=>{A=null==w?void 0:w.token.onCancellationRequested(()=>{dispose(),P(new C.CancellationError)}),v=setTimeout(()=>{dispose(),P(((h,m)=>void 0===m?new T.TimeoutCancellationError(`Promise rejected after ${h}ms`):"string"==typeof m?new T.TimeoutCancellationError(m):m instanceof Error?m:void 0)(m,y))},m)})])}))},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0}),m.createDisposable=h=>({dispose:h})},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0}),m.hashString=h=>h.split("").reduce((h,m)=>(h=((h<<5)-h+m).charCodeAt(0))&h,0).toString()},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0});const v=/([A-Za-z]:)?(\S*[\\\/])+\S*/gim,C=/[\S]+@[\S]+/gim,T=/(https?:\/\/)?([\w|-]+)\.github\.dev((\S*[\\\/])+\S*)?/gim;m.PATH_PII_LABEL="[PATH]/",m.EMAIL_PII_LABEL="[EMAIL]",m.CODESPACE_URL_PII_LABEL="[CODESPACE_URL]",m.obfusticateCodespaceNames=(h,y=m.CODESPACE_URL_PII_LABEL)=>h.replace(T,y),m.obfusticatePaths=(h,y=m.PATH_PII_LABEL)=>h.replace(v,(h,m,v,C,T)=>{if(/^\d{1,4}\/\d{1,2}\/\d{1,4}$/.test(h))return h;{const C=(m?m.length:0)+v.length,T=h.substr(C);return y+T}}),m.obfusticateEmailAddresses=(h,y=m.EMAIL_PII_LABEL)=>h.replace(C,y),m.cleanupPII=h=>h?m.obfusticateEmailAddresses(m.obfusticatePaths(m.obfusticateCodespaceNames(h))):h,m.cleanupObjectValuesPII=h=>{for(let[y,v]of Object.entries(h))"string"==typeof v&&(h[y]=m.cleanupPII(v));return h}},function(h,m,y){"use strict";var v=this&&this.__importDefault||function(h){return h&&h.__esModule?h:{default:h}};Object.defineProperty(m,"__esModule",{value:!0});const C=v(y(809));m.randomBytes=h=>C.default(h)},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0});const v=y(349);m.errorToObject=(h,m=!0)=>{const y=h,{errorCode:C=-1,errorType:T="GenericError",message:w="<no message>",originalErrorType:A="<no original type>"}=y;return{errorMessage:w,originalErrorType:A,errorCode:C,errorType:T,stack:m?y.stack:v.cleanupPII(y.stack)}}},function(h,m,y){"use strict";var v=this&&this.__awaiter||function(h,m,y,v){return new(y||(y=Promise))((function(C,T){function fulfilled(h){try{step(v.next(h))}catch(h){T(h)}}function rejected(h){try{step(v.throw(h))}catch(h){T(h)}}function step(h){h.done?C(h.value):function adopt(h){return h instanceof y?h:new y((function(m){m(h)}))}(h.value).then(fulfilled,rejected)}step((v=v.apply(h,m||[])).next())}))};Object.defineProperty(m,"__esModule",{value:!0});const C=y(0),T=y(7),w=y(9),A=y(15),P=y(16),k=y(5),R=y(4),M=y(20),N=y(22),D=y(23),I=y(12),x=y(61),O=y(53),L=y(93),U=y(25),B=y(8),W=y(973),q=y(974),Y=y(37),V=y(2),$=y(406);class WorkspaceProvider{constructor(h,m,y){this.workspaceService=h,this.fileService=m,this.sessionContext=y,this._version=8,this.onFilesChangedEmitter=new C.EventEmitter,this.eventRegistrations=[],this.workspaceProviders=[],this.isDisposed=!1,this.multiRootWorkspaceEnabled=!0,this.uriPrefix=I.Settings.scheme+":",this.generation=0,this.enableFileServiceCacheMutex=new V.Mutex,this.onDidChangeFile=this.onFilesChangedEmitter.event,this.getFileStat=(h,m)=>({mtime:Date.parse(h.mtime),ctime:Date.parse(h.mtime),size:void 0,type:h.isDirectory?C.FileType.Directory:C.FileType.File}),this.trace=k.traceSource.withName(R.vsls.TraceSources.ClientFileProvider),this.workspaceService.onConnectionStatusChanged(this.onWorkspaceConnectionStatusChanged,this,this.eventRegistrations),this.fileOperationStartedOnce=new Map([[1,!1],[0,!1]])}init(){this.fileService().onFilesChanged(this.onFilesChanged,this,this.eventRegistrations)}registerWorkspaceProvider(h){this.workspaceProviders.push(h)}fireFilesChanged(h){this.onFilesChangedEmitter.fire(h)}onWorkspaceConnectionStatusChanged(h){this.currentConnectionStatus=h.connectionStatus}waitForSessionPromise(h){return v(this,void 0,void 0,(function*(){this.fileOperationStartedOnce.get(h)?yield this.sessionContext.waitForSessionPromise(N.SessionPromise.JoiningCompleted):(this.fileOperationStartedOnce.set(h,!0),yield this.sessionContext.waitForSessionPromise(N.SessionPromise.EnvironmentReadyForFileOperation))}))}bumpGeneration(){this.generation++}createorUpdateWorkspaceFile(h,m){const y=C.Uri.parse("vsls:/Live Share.code-workspace");this.workspaceFile=new W.MemoryFile(y,"Live Share");const v=(new TextEncoder).encode(JSON.stringify({folders:[{uri:`vsls:/?${h}`,name:m}],settings:$.baseWorkspaceSettings},void 0,"\t"));this.setWorkspaceFileInfo(y,v)}onFilesChanged(h){let m=!1;const y=h.changes.map(h=>{const y=x.PathUtil.getRelativePathFromPrefixedPath(h.fullPath),v=C.Uri.parse(`${this.uriPrefix}${y}`),T=WorkspaceProvider.toFileChangeType(h.changeType);return T===C.FileChangeType.Created&&(m=!0),{type:T,uri:v}});this.onFilesChangedEmitter.fire(y),m&&this.workspaceFile&&C.commands.executeCommand("workbench.files.action.refreshFilesExplorer")}static toFileChangeType(h){switch(h){case R.vsls.FileChangeType.Added:return C.FileChangeType.Created;case R.vsls.FileChangeType.Deleted:return C.FileChangeType.Deleted;case R.vsls.FileChangeType.Updated:return C.FileChangeType.Changed;default:throw new Error("changeType not supported")}}dispose(){this.isDisposed=!0,this.eventRegistrations.forEach(h=>h.dispose())}watch(h,m){return{dispose(){}}}stat(h){var m;return v(this,void 0,void 0,(function*(){if(h.path===(null===(m=this.workspaceFile)||void 0===m?void 0:m.uri.path))return this.workspaceFile;if("/"===h.path||""===h.path)return{type:C.FileType.Directory,ctime:0,mtime:0,size:0};const y=this.generation;if(yield this.waitForSessionPromise(1),y!==this.generation)throw this.fileError("FileNotFound",h);if(!this.isConnected)return{type:C.FileType.Unknown,ctime:0,mtime:0,size:0};const v=[h.path];let T={recurseMode:R.vsls.FileRecurseMode.None,excludePatterns:void 0,includeDetails:!0,enableMultipleRoots:this.multiRootWorkspaceEnabled};const w=yield this.listAsync(v,T);if(w[0].path.startsWith(O.PathManager.untitledPrefix))try{return this.sessionContext.coeditingClient.openUntitledFiles.get(h.path)}catch(m){throw this.fileError("FileNotFound",h)}for(const h of this.workspaceProviders.filter(h=>h.onStat))yield h.onStat(w);if(0===w.length||!1===w[0].exists)throw this.fileError("FileNotFound",h);return this.getFileStat(w[0],h.toString())}))}readFile(h){var m;return v(this,void 0,void 0,(function*(){if(h.path===(null===(m=this.workspaceFile)||void 0===m?void 0:m.uri.path))return Promise.resolve(this.workspaceFile.data);if(yield this.waitForSessionPromise(0),!h.path.length||!this.isConnected)throw this.fileError("FileNotFound",h);let y;try{if(h.path.startsWith(O.PathManager.untitledPrefix)){if(!this.sessionContext.coeditingClient.openUntitledFiles.has(h.path))throw this.fileError("FileNotFound",h);y={exists:!0,path:h.path,text:"",isDirectory:!1},new B.TelemetryEvent(L.Event.RECEIVE_UNTITLED_FILE).send()}else y=yield this.readTextAsync(h,{})}catch(m){throw this.trace.error("readFile error:",m),m.code===P.RpcErrorCodes.MessageTooLarge?this.fileError("FileTooLarge",h):"FileNotFound"===m?this.fileError("FileNotFound",h):this.fileError("FileNotAvailable",h)}for(const h of this.workspaceProviders.filter(h=>h.onReadFile))yield h.onReadFile(y);if(!1===y.exists)throw this.fileError("FileNotFound",h,A.LogLevel.Debug);let v=y.text;const C=this.sessionContext.coeditingClient.uriToFileName(h);if(C&&y.attributes!==R.vsls.FileAttributes.Hidden&&(v=!this.sessionContext.coeditingClient.sharedBinaryFileClients[C.toLowerCase()]&&(yield this.sessionContext.coeditingClient.performFileOpenHandshake(C,v)),"boolean"==typeof v&&!1===v)){const m=yield this.sessionContext.coeditingClient.performBinaryFileOpenHandshake(C,h);let y=w.Buffer.from(m.text,"base64");return Promise.resolve(y)}let T=w.Buffer.from(v,"utf8");return Promise.resolve(T)}))}writeFile(h,m,y){var C;return v(this,void 0,void 0,(function*(){if(h.path!==(null===(C=this.workspaceFile)||void 0===C?void 0:C.uri.path)){if(yield this.sessionContext.waitForSessionPromise(N.SessionPromise.JoiningCompleted),this.isSessionActive)try{if(h.path.startsWith(O.PathManager.untitledPrefix)){if(this.sessionContext.coeditingClient.openUntitledFiles.has(h.path)){return void(this.sessionContext.coeditingClient.openUntitledFiles.get(h.path).mtime=(new Date).getTime())}throw this.fileError("FileNotFound",h)}const v=yield this.fileExists(h);if(!(!v||y&&y.overwrite))throw this.fileError("FileExists",h);if(!(v||y&&y.create))throw this.fileError("FileNotFound",h);if(v)return;const C=m.toString();if(!1===(yield this.fileService().writeTextAsync(h.path,C,{append:!1,createIfNotExist:!0})).exists)throw this.fileError("NoPermissions",h)}catch(h){return void this.trace.error(h.message)}}else this.setWorkspaceFileInfo(h,m)}))}rename(h,m,y){return v(this,void 0,void 0,(function*(){if(yield this.sessionContext.waitForSessionPromise(N.SessionPromise.JoiningCompleted),!this.isSessionActive)throw this.fileError("FileNotFound",h);if(!(yield this.fileExists(h)))throw this.fileError("FileNotFound",h);if(!y||!y.overwrite){if(yield this.fileExists(m))throw this.fileError("FileExists",m)}if(!1===(yield this.fileService().moveAsync(h.path,M.parse(m.path).path,{overwrite:!1})).exists)throw this.fileError("NoPermissions",m)}))}createDirectory(h){return v(this,void 0,void 0,(function*(){if(yield this.sessionContext.waitForSessionPromise(N.SessionPromise.JoiningCompleted),!this.isSessionActive)throw this.fileError("FileNotFound",h);if(h.path.startsWith(O.PathManager.externalPrefix))return;if(!1===(yield this.fileService().createDirectoryAsync(h.path)).exists)throw this.fileError("NoPermissions",h)}))}readDirectory(h){return v(this,void 0,void 0,(function*(){yield this.sessionContext.waitForSessionPromise(N.SessionPromise.JoiningCompleted);const m=[];if(!this.isSessionActive)return m;let y,v={recurseMode:R.vsls.FileRecurseMode.Children,excludePatterns:void 0,includeDetails:!0,enableMultipleRoots:this.multiRootWorkspaceEnabled};y=yield this.listAsync([h.path],v);for(const h of this.workspaceProviders.filter(h=>h.onReadDirectory))yield h.onReadDirectory(y);if(1!==y.length||!1===y[0].exists)throw this.fileError("FileNotFound",h);return y=y[0].children,function checkForCaseSensitiveFileSystem(h){const m=new Set;for(let y of h){if(y.isDirectory)continue;const h=y.path.toLowerCase();if(m.has(h))return void reportCaseSensitiveFileSystem();m.add(h)}}(y),y&&y.forEach(y=>{let v=h.with({path:y.path}),C=this.getFileStat(y,v.toString()),w=T.basename(y.path);m.push([w,C.type])}),m}))}delete(h){return v(this,void 0,void 0,(function*(){if(yield this.sessionContext.waitForSessionPromise(N.SessionPromise.JoiningCompleted),!this.isSessionActive)throw this.fileError("FileNotFound",h);return this.fileService().deleteAsync(h.path,{useTrash:!0})}))}get isConnected(){return this.currentConnectionStatus!==R.vsls.WorkspaceConnectionStatus.Disconnected&&!this.isDisposed}get isSessionActive(){return D.sessionStateTracker.State===N.SessionState.Joined&&this.isConnected}setWorkspaceFileInfo(h,m){this.workspaceFile.mtime=Date.now(),this.workspaceFile.size=m.byteLength,this.workspaceFile.data=m,this.onFilesChangedEmitter.fire([{type:C.FileChangeType.Changed,uri:h}])}fileExists(h){let m={recurseMode:R.vsls.FileRecurseMode.None,excludePatterns:void 0,includeDetails:!0,enableMultipleRoots:this.multiRootWorkspaceEnabled},y=[];return y.push(h.path),this.listAsync(y,m).then(h=>!1!==h[0].exists)}ensureStatusFileServiceCache(){return v(this,void 0,void 0,(function*(){yield this.enableFileServiceCacheMutex.dispatch(()=>v(this,void 0,void 0,(function*(){var h;void 0===this.enableFileServiceCache&&(this.enableFileServiceCache=!!(yield null===(h=Y.getExpService())||void 0===h?void 0:h.getTreatmentVariableAsync("vscode","file-service-cache")),this.enableFileServiceCache&&(this.fileServiceCache=new q.FileServiceCache(this.fileService(),k.traceSource.withName("FileServiceCache")),this.trace.info("File service cache is enabled")))})))}))}readTextAsync(h,m,y){return v(this,void 0,void 0,(function*(){if(void 0===this.enableFileServiceCache&&(yield this.ensureStatusFileServiceCache()),this.enableFileServiceCache){return(yield this.fileServiceCache.readTextAsync([h.path],m,3e4,y))[0]}return yield this.fileService().readTextAsync(h.path,m,y)}))}listAsync(h,m,y){return v(this,void 0,void 0,(function*(){return void 0===this.enableFileServiceCache&&(yield this.ensureStatusFileServiceCache()),this.enableFileServiceCache?yield this.fileServiceCache.listAsync(h,m,3e4,y):yield this.fileService().listAsync(h,m,y)}))}fileError(h,m,y){let v;switch(this.trace.traceEvent(y||A.LogLevel.Error,0,`fileError: ${h} uri path:${null==m?void 0:m.path}`),h){case"FileNotFound":v=U.localize("fileError.FileNotFound");break;case"FileExists":v=U.localize("fileError.FileExists");break;case"NoPermissions":v=U.localize("fileError.NoPermissions");break;case"FileTooLarge":v=U.localize("fileError.FileTooLarge");break;case"FileNotAvailable":v=U.localize("fileError.FileNotAvailable");break;default:v=""}v=v||`Error (${h}): ${m.path}`,m&&(v=v.replace("$(path)",m.path));const T=C.FileSystemError[h];return T?T(v):new Error(v)}}function reportCaseSensitiveFileSystem(){L.CoauthoringTelemetry.ReportCaseSensitiveFileSystem(),C.window.showErrorMessage(U.localize("error.CaseSensitiveFileSystem"))}m.WorkspaceProvider=WorkspaceProvider},function(h,m,y){"use strict";var v=this&&this.__importStar||function(h){if(h&&h.__esModule)return h;var m={};if(null!=h)for(var y in h)Object.hasOwnProperty.call(h,y)&&(m[y]=h[y]);return m.default=h,m};Object.defineProperty(m,"__esModule",{value:!0});const C=v(y(6)),T=y(211),w=y(15),A=y(121);!function(h){h[h.ParseError=C.ErrorCodes.ParseError]="ParseError",h[h.InvalidRequest=C.ErrorCodes.InvalidRequest]="InvalidRequest",h[h.MethodNotFound=C.ErrorCodes.MethodNotFound]="MethodNotFound",h[h.InvalidParams=C.ErrorCodes.InvalidParams]="InvalidParams",h[h.InternalError=C.ErrorCodes.InternalError]="InternalError",h[h.ServerNotInitialized=C.ErrorCodes.ServerNotInitialized]="ServerNotInitialized",h[h.UnknownErrorCode=C.ErrorCodes.UnknownErrorCode]="UnknownErrorCode",h[h.RequestCancelled=C.ErrorCodes.RequestCancelled]="RequestCancelled",h[h.MessageWriteError=C.ErrorCodes.MessageWriteError]="MessageWriteError",h[h.MessageReadError=C.ErrorCodes.MessageReadError]="MessageReadError",h[h.ServiceNotAvailable=-32099]="ServiceNotAvailable",h[h.InvocationException=-32098]="InvocationException",h[h.MessageTooLarge=-32097]="MessageTooLarge"}(m.RpcErrorCodes||(m.RpcErrorCodes={}));class RpcProxy{constructor(h,m,y){this.client=h,this.serviceName=m,this.logger=y}static create(h,m,y){if(!h||!h.name)throw new Error("Missing RPC service name.");const v=new RpcProxy(m,h.name,y);for(const m of h.methods){v[`${m}Async`]=function(){let h,y=arguments[arguments.length-1];y&&"object"==typeof y&&"boolean"==typeof y.isCancellationRequested?h=Array.prototype.slice.call(arguments,0,arguments.length-1):(h=Array.prototype.slice.call(arguments,0,arguments.length),y=null);let C=h[h.length-1];C&&"object"==typeof C&&"function"==typeof C.report?h.splice(h.length-1,1):C=null;const T=v.serviceName+"."+m;return v.client.sendRequest(this.logger,T,C,y,...h)}}for(const m of h.voidMethods||[])v[m]=function(){const h=Array.prototype.slice.call(arguments,0,arguments.length),y=v.serviceName+"."+m;v.client.sendNotification(this.logger,y,h).then().catch()};for(const m of h.events){const h=new C.Emitter,y=A.getEventPropertyName(m);v[y]=h.event;const T=v.serviceName+"."+m;v.client.ensureConnectionAsync().then(m=>{m.onNotification(T,(...m)=>{const y=m[0],C=w.LoggerSettings.disableObfuscation?JSON.stringify(y):"";v.logger.log(w.LogLevel.Debug,`> ${T}: ${C}`),h.fire(y)})}).catch(h=>{})}return v}static createWithConnection(h,m,y){return RpcProxy.create(h,T.RpcClientProxy.fromRpcConnection(m,y),y)}static createWithPromise(h,m,y){return RpcProxy.create(h,T.RpcClientProxy.fromPromise(m,y),y)}static notifyAsync(h,m,y){const v=h,C=v.serviceName+"."+m;return v.client.sendNotification(v.logger,C,y)}}m.RpcProxy=RpcProxy},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0});m.RpcLoggerAdapter=class RpcLoggerAdapter{constructor(h){this.trace=h}error(h){this.trace.error(h)}warn(h){this.trace.warning(h)}info(h){this.trace.info(h)}log(h){this.trace.verbose(h)}}},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0});const v=y(356);class RpcConnectionClosedError extends v.RpcError{constructor(){super("RPC connection closed."),this.code=RpcConnectionClosedError.code,Object.setPrototypeOf(this,RpcConnectionClosedError.prototype)}}m.RpcConnectionClosedError=RpcConnectionClosedError,RpcConnectionClosedError.code="EPIPE";class RpcConnectionShutdownError extends v.RpcError{constructor(){super("RPC connection closed due to client shut down."),this.code=RpcConnectionShutdownError.code,Object.setPrototypeOf(this,RpcConnectionShutdownError.prototype)}}m.RpcConnectionShutdownError=RpcConnectionShutdownError,RpcConnectionShutdownError.code="ECONNRESET"},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0});class RpcError extends Error{constructor(h){super(h),this.code=RpcError.code}}m.RpcError=RpcError,RpcError.code="RpcError"},function(h,m,y){"use strict";var v=this&&this.__awaiter||function(h,m,y,v){return new(y||(y=Promise))((function(C,T){function fulfilled(h){try{step(v.next(h))}catch(h){T(h)}}function rejected(h){try{step(v.throw(h))}catch(h){T(h)}}function step(h){h.done?C(h.value):function adopt(h){return h instanceof y?h:new y((function(m){m(h)}))}(h.value).then(fulfilled,rejected)}step((v=v.apply(h,m||[])).next())}))};Object.defineProperty(m,"__esModule",{value:!0});const C=y(15);function getRawRpcParameters(h){const m=[...h];return normalizeRpcParameters(m),m}function normalizeRpcParameters(h){const m=h.splice(0,1)[0];if(h.length>0){const y=h[h.length-1];if(y&&"isCancellationRequested"in y&&"onCancellationRequested"in y){return[m,h.splice(h.length-1,1)[0]]}}return[m,null]}m.getRawRpcParameters=getRawRpcParameters,m.normalizeRpcParameters=normalizeRpcParameters,m.sendRpcRequest=function sendRpcRequest(h,m,y,T){return v(this,void 0,void 0,(function*(){try{const v=Date.now(),w=yield h.sendRequest(m,getRawRpcParameters(y)),A=(Date.now()-v).toFixed(1);return null==T||T.info(`remote rpc request method: "${m}" result: "${C.TraceFormat.stringify(w)}\n            t:${A}`),w}catch(h){throw null==T||T.error(`failed to handle request for method:${m}`,h),h}}))}},function(h,m,y){var v=y(11);h.exports=function nodeRNG(){return v.randomBytes(16)}},function(h,m){for(var y=[],v=0;v<256;++v)y[v]=(v+256).toString(16).substr(1);h.exports=function bytesToUuid(h,m){var v=m||0,C=y;return[C[h[v++]],C[h[v++]],C[h[v++]],C[h[v++]],"-",C[h[v++]],C[h[v++]],"-",C[h[v++]],C[h[v++]],"-",C[h[v++]],C[h[v++]],"-",C[h[v++]],C[h[v++]],C[h[v++]],C[h[v++]],C[h[v++]],C[h[v++]]].join("")}},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0}),function(h){h[h.Error=0]="Error",h[h.User=1]="User",h[h.Unknown=2]="Unknown",h[h.NonBlockingFault=3]="NonBlockingFault",h[h.UserCancelled=4]="UserCancelled",h[h.ByDesign=5]="ByDesign"}(m.FaultType||(m.FaultType={}))},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0}),function(h){h[h.Cancel=0]="Cancel",h[h.Success=1]="Success",h[h.Failure=2]="Failure",h[h.UserFailure=3]="UserFailure",h[h.IndeterminateFailure=4]="IndeterminateFailure",h[h.NonBlockingFailure=5]="NonBlockingFailure",h[h.ByDesignFailure=6]="ByDesignFailure"}(m.Result||(m.Result={}))},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0});const v=y(215),C=y(843);m.setLogLocation=function setLogLocation(h){v.LogLocations.clientLogFilePath=h},m.getLogLocation=function getLogLocation(){return v.LogLocations.clientLogFilePath},m.createLogFileListener=async function createLogFileListener(){const h=new v.LogFileTraceListener("VSCode");if(await h.openAsync())return C.traceSource.info("Trace log: "+h.logFileName),h}},function(h,m,y){"use strict";var v=this&&this.__awaiter||function(h,m,y,v){return new(y||(y=Promise))((function(C,T){function fulfilled(h){try{step(v.next(h))}catch(h){T(h)}}function rejected(h){try{step(v.throw(h))}catch(h){T(h)}}function step(h){h.done?C(h.value):function adopt(h){return h instanceof y?h:new y((function(m){m(h)}))}(h.value).then(fulfilled,rejected)}step((v=v.apply(h,m||[])).next())}))},C=this&&this.__importStar||function(h){if(h&&h.__esModule)return h;var m={};if(null!=h)for(var y in h)Object.hasOwnProperty.call(h,y)&&(m[y]=h[y]);return m.default=h,m};Object.defineProperty(m,"__esModule",{value:!0});const T=C(y(155)),w=C(y(21)),A=C(y(10)),P=C(y(18)),k=y(8),R=y(15),M=y(841),N=y(364),D=A.promisify(w.mkdir),I=A.promisify(w.open),x=A.promisify(w.write);class LogFileTraceListener extends R.TraceListener{constructor(h,m=LogFileTraceListener.defaultLogDirectory,y){super(),this.processName=h,this.logDirectory=m,this.fileDescriptor=y,this.writePromise=Promise.resolve(),this.canWriteLogs=!0,this.openLogFileAsync=(h=0)=>v(this,void 0,void 0,(function*(){if(5===h)return this.canWriteLogs=!1,void k.Telemetry.sendFault(M.TelemetryEventNames.NAME_LOGS_FILE_FAILED,k.FaultType.Error,"Name Log File Failed - Reached maximum number of attempts.");const m=(new Date).toISOString().replace(/T/,"_").replace(/:|-/g,"").replace(/\..+/,""),y=T.join(this.logDirectory,`${m}_${Date.now()}${h}_${this.processName}.log`);try{const h=yield I(y,"ax");this.fileDescriptor=h,this.fileName=y}catch(m){"EEXIST"===m.code?yield this.openLogFileAsync(h+1):(this.canWriteLogs=!1,k.Telemetry.sendFault(M.TelemetryEventNames.OPEN_LOGS_FAILED,k.FaultType.Error,`Name Log File Failed. ${m.message}`,m))}return y})),this.flushEvents=()=>this.writePromise}static get defaultLogDirectory(){return N.LogLocations.clientLogFilePath}get logFileName(){return this.fileName}openAsync(){return v(this,void 0,void 0,(function*(){try{yield D(this.logDirectory)}catch(h){}return yield this.openLogFileAsync()}))}writeTo(h){if(!this.fileDescriptor)throw new Error("No file descriptor defined, please open file first.");w.writeFileSync(this.fileDescriptor,h+P.EOL)}writeEvent(h,m,y,v,...C){if(!1===this.canWriteLogs)return;const T=R.TraceFormat.formatEvent(new Date,h,m,y,v,...C);this.writePromise=this.writePromise.then(()=>{x(this.fileDescriptor,T+P.EOL).catch(h=>{this.canWriteLogs=!1,k.Telemetry.sendFault(M.TelemetryEventNames.WRITE_LOGS_FAILED,k.FaultType.Error,h.message,h)})})}}m.LogFileTraceListener=LogFileTraceListener},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0});m.LogLocations=class LogLocations{}},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0});const v=y(18);m.getPipePath=function getPipePath(h){return"win32"===process.platform?`\\\\.\\pipe\\${h}`:`${v.tmpdir()}/CoreFxPipe_${h}`}},function(h,m,y){var v,C=y(28),T=y(848),w=/^win/i.test(process.platform),A=y(13);function unload(){k&&(k=!1,T.forEach((function(h){try{process.removeListener(h,P[h])}catch(h){}})),process.emit=M,process.reallyExit=R,v.count-=1)}function emit(h,m,y){v.emitted[h]||(v.emitted[h]=!0,v.emit(h,m,y))}"function"!=typeof A&&(A=A.EventEmitter),process.__signal_exit_emitter__?v=process.__signal_exit_emitter__:((v=process.__signal_exit_emitter__=new A).count=0,v.emitted={}),v.infinite||(v.setMaxListeners(1/0),v.infinite=!0),h.exports=function(h,m){C.equal(typeof h,"function","a callback must be provided for exit handler"),!1===k&&load();var y="exit";m&&m.alwaysLast&&(y="afterexit");return v.on(y,h),function(){v.removeListener(y,h),0===v.listeners("exit").length&&0===v.listeners("afterexit").length&&unload()}},h.exports.unload=unload;var P={};T.forEach((function(h){P[h]=function listener(){process.listeners(h).length===v.count&&(unload(),emit("exit",null,h),emit("afterexit",null,h),w&&"SIGHUP"===h&&(h="SIGINT"),process.kill(process.pid,h))}})),h.exports.signals=function(){return T},h.exports.load=load;var k=!1;function load(){k||(k=!0,v.count+=1,T=T.filter((function(h){try{return process.on(h,P[h]),!0}catch(h){return!1}})),process.emit=processEmit,process.reallyExit=processReallyExit)}var R=process.reallyExit;function processReallyExit(h){process.exitCode=h||0,emit("exit",process.exitCode,null),emit("afterexit",process.exitCode,null),R.call(process,process.exitCode)}var M=process.emit;function processEmit(h,m){if("exit"===h){void 0!==m&&(process.exitCode=m);var y=M.apply(this,arguments);return emit("exit",process.exitCode,null),emit("afterexit",process.exitCode,null),y}return M.apply(this,arguments)}},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0});const v=y(21),C=y(10),T=y(852),w=C.promisify(v.mkdir),A=C.promisify(v.open),P=C.promisify(v.close),k=C.promisify(v.write),R=C.promisify(v.chmod),M=C.promisify(v.exists),N=C.promisify(v.access),D=C.promisify(v.readdir),I=C.promisify(v.unlink);m.fileAccess=new class NodeFileAccess{constructor(){this.existsAsync=M,this.chmodAsync=R,this.accessAsync=N}mkdirAsync(h){return w(h)}mkdirSync(h){v.mkdirSync(h)}openFileAsync(h,m){return A(h,m)}openSync(h,m){return v.openSync(h,m)}openAsync(h,m){return A(h,m)}closeSync(h){v.closeSync(h)}closeAsync(h){return P(h)}writeAsync(h,m){return k(h,m)}writeFile(h,m,y){if(void 0===y)return T.writeFile(h,m);v.writeFile(h,m,y)}writeFileAsync(h,m){return T.writeFile(h,m)}appendFileSync(h,m,y){v.appendFileSync(h,m,y)}chmod(h,m,y){v.chmod(h,m,y)}stat(h,m){v.stat(h,m)}statSync(h){return v.statSync(h)}lstatSync(h){return v.lstatSync(h)}lstat(h,m){v.lstat(h,m)}existsSync(h){return v.existsSync(h)}readdirSync(h){return v.readdirSync(h)}readdirAsync(h){return D(h)}readFileSync(h,m){return void 0!==m?v.readFileSync(h,m):v.readFileSync(h)}readFile(h,m,y){if(void 0===y||void 0===m)return T.readFile(h);v.readFile(h,m,y)}unlink(h,m){v.unlink(h,m)}unlinkSync(h){v.unlinkSync(h)}unlinkAsync(h){return I(h)}copySync(h,m){T.copySync(h,m)}readdir(h,m){if(void 0===m)return T.readdir(h);T.readdir(h,m)}remove(h){return T.remove(h)}renameSync(h,m){T.renameSync(h,m)}ensureDir(h){return T.ensureDir(h)}ensureDirAsync(h){return T.ensureDir(h)}writeFileSync(h,m){T.writeFileSync(h,m)}pathExistsSync(h){return T.pathExistsSync(h)}access(h){return T.access(h)}copyFileSync(h,m){return T.copyFileSync(h,m)}copyFile(h,m){return T.copyFile(h,m)}readJson(h){return T.readJson(h)}writeJson(h,m,y){return T.writeJson(h,m,y)}createReadStream(h){return T.createReadStream(h)}createWriteStream(h){return T.createWriteStream(h)}pathExists(h){return T.pathExists(h)}}},function(h,m,y){"use strict";const v=y(36).fromCallback,C=y(27),T=["access","appendFile","chmod","chown","close","copyFile","fchmod","fchown","fdatasync","fstat","fsync","ftruncate","futimes","lchown","lchmod","link","lstat","mkdir","mkdtemp","open","readFile","readdir","readlink","realpath","rename","rmdir","stat","symlink","truncate","unlink","utimes","writeFile"].filter(h=>"function"==typeof C[h]);Object.keys(C).forEach(h=>{"promises"!==h&&(m[h]=C[h])}),T.forEach(h=>{m[h]=v(C[h])}),m.exists=function(h,m){return"function"==typeof m?C.exists(h,m):new Promise(m=>C.exists(h,m))},m.read=function(h,m,y,v,T,w){return"function"==typeof w?C.read(h,m,y,v,T,w):new Promise((w,A)=>{C.read(h,m,y,v,T,(h,m,y)=>{if(h)return A(h);w({bytesRead:m,buffer:y})})})},m.write=function(h,m,...y){return"function"==typeof y[y.length-1]?C.write(h,m,...y):new Promise((v,T)=>{C.write(h,m,...y,(h,m,y)=>{if(h)return T(h);v({bytesWritten:m,buffer:y})})})},"function"==typeof C.realpath.native&&(m.realpath.native=v(C.realpath.native))},function(h,m,y){"use strict";h.exports={copySync:y(856)}},function(h,m,y){"use strict";const v=y(7);function getRootPath(h){return(h=v.normalize(v.resolve(h)).split(v.sep)).length>0?h[0]:null}const C=/[<>:"|?*]/;h.exports={getRootPath:getRootPath,invalidWin32Path:function invalidWin32Path(h){const m=getRootPath(h);return h=h.replace(m,""),C.test(h)}}},function(h,m,y){"use strict";const v=y(27),C=y(18),T=y(7);h.exports={hasMillisRes:function hasMillisRes(h){let m=T.join("millis-test"+Date.now().toString()+Math.random().toString().slice(2));m=T.join(C.tmpdir(),m);const y=new Date(1435410243862);v.writeFile(m,"https://github.com/jprichardson/node-fs-extra/pull/141",C=>{if(C)return h(C);v.open(m,"r+",(C,T)=>{if(C)return h(C);v.futimes(T,y,y,y=>{if(y)return h(y);v.close(T,y=>{if(y)return h(y);v.stat(m,(m,y)=>{if(m)return h(m);h(null,y.mtime>1435410243e3)})})})})})},hasMillisResSync:function hasMillisResSync(){let h=T.join("millis-test-sync"+Date.now().toString()+Math.random().toString().slice(2));h=T.join(C.tmpdir(),h);const m=new Date(1435410243862);v.writeFileSync(h,"https://github.com/jprichardson/node-fs-extra/pull/141");const y=v.openSync(h,"r+");return v.futimesSync(y,m,m),v.closeSync(y),v.statSync(h).mtime>1435410243e3},timeRemoveMillis:function timeRemoveMillis(h){if("number"==typeof h)return 1e3*Math.floor(h/1e3);if(h instanceof Date)return new Date(1e3*Math.floor(h.getTime()/1e3));throw new Error("fs-extra: timeRemoveMillis() unknown parameter type")},utimesMillis:function utimesMillis(h,m,y,C){v.open(h,"r+",(h,T)=>{if(h)return C(h);v.futimes(T,m,y,h=>{v.close(T,m=>{C&&C(h||m)})})})},utimesMillisSync:function utimesMillisSync(h,m,y){const C=v.openSync(h,"r+");return v.futimesSync(C,m,y),v.closeSync(C)}}},function(h,m,y){"use strict";const v=y(36).fromCallback;h.exports={copy:v(y(860))}},function(h,m){h.exports=require("perf_hooks")},function(h,m,y){"use strict";var v=this&&this.__awaiter||function(h,m,y,v){return new(y||(y=Promise))((function(C,T){function fulfilled(h){try{step(v.next(h))}catch(h){T(h)}}function rejected(h){try{step(v.throw(h))}catch(h){T(h)}}function step(h){h.done?C(h.value):function adopt(h){return h instanceof y?h:new y((function(m){m(h)}))}(h.value).then(fulfilled,rejected)}step((v=v.apply(h,m||[])).next())}))};Object.defineProperty(m,"__esModule",{value:!0});m.CommandDecoratorBase=class CommandDecoratorBase{constructor(h=!0){this.enableProfiling=h}setup(){const h=this,m=h.constructor.name.replace("CommandDecorator","");return this.enableProfiling?function(y){const C=class extends y{constructor(...m){super(...m),h.decorate&&h.decorate(this)}invoke(y,C){const T=Object.create(null,{invoke:{get:()=>super.invoke}});return v(this,void 0,void 0,(function*(){let w,A;C.trace.info(`Decorator starting: ${m}`);const P=T.invoke.bind(this),innerInvoke=(h,m)=>v(this,void 0,void 0,(function*(){w=Date.now();try{return yield P(h,m)}finally{A=Date.now()}})),k=Date.now();try{return yield h.invoke(innerInvoke,y,C)}finally{const h=Date.now(),y=(w||h)-k,v=h-(A||h),T=y+v;C.trace.info(`Decorator finishing: ${m}. `+`Duration: ${T}ms (${y} + ${v})`)}}))}};return Object.defineProperty(C,"name",{writable:!1,value:y.name}),C}:function(m){const y=class extends m{constructor(...m){super(...m),h.decorate&&h.decorate(this)}invoke(m,y){const v=super.invoke.bind(this);return h.invoke(v,m,y)}};return Object.defineProperty(y,"name",{writable:!1,value:m.name}),y}}}},function(h,m,y){"use strict";var v=this&&this.__awaiter||function(h,m,y,v){return new(y||(y=Promise))((function(C,T){function fulfilled(h){try{step(v.next(h))}catch(h){T(h)}}function rejected(h){try{step(v.throw(h))}catch(h){T(h)}}function step(h){h.done?C(h.value):function adopt(h){return h instanceof y?h:new y((function(m){m(h)}))}(h.value).then(fulfilled,rejected)}step((v=v.apply(h,m||[])).next())}))};Object.defineProperty(m,"__esModule",{value:!0});class NotificationUtilClass{static get Instance(){return NotificationUtilClass.singleton||(NotificationUtilClass.singleton=new NotificationUtilClass),NotificationUtilClass.singleton}get notificationProgressLocation(){return y(0).ProgressLocation.Notification}showInformationMessage(h,m,...C){return v(this,void 0,void 0,(function*(){if(!m)return(yield Promise.resolve().then(()=>y(0))).window.showInformationMessage(h,...C)}))}showErrorMessage(h,...m){return v(this,void 0,void 0,(function*(){return(yield Promise.resolve().then(()=>y(0))).window.showErrorMessage(h,...m)}))}showWarningMessage(h,m,...C){return v(this,void 0,void 0,(function*(){return m?(yield Promise.resolve().then(()=>y(0))).window.showWarningMessage(h,m,...C):(yield Promise.resolve().then(()=>y(0))).window.showWarningMessage(h,...C)}))}showInputBox(h,m){return v(this,void 0,void 0,(function*(){return(yield Promise.resolve().then(()=>y(0))).window.showInputBox(h,m)}))}showQuickPick(h,m,C,T,w={}){return v(this,void 0,void 0,(function*(){let C=!1;Array.isArray(h)?Array.isArray(h)&&"string"==typeof h[0]&&(C=!0,h=h.map(h=>({label:h}))):h=yield h;let A=yield new Promise((C,A)=>v(this,void 0,void 0,(function*(){const A=(yield Promise.resolve().then(()=>y(0))).window.createQuickPick();A.items=h,A.activeItems=h.filter(h=>h.picked),A.canSelectMany=(null==m?void 0:m.canPickMany)||!1,A.placeholder=(null==m?void 0:m.placeHolder)||"",A.ignoreFocusOut=(null==m?void 0:m.ignoreFocusOut)||!1,A.matchOnDetail=(null==m?void 0:m.matchOnDetail)||!1,A.matchOnDescription=(null==m?void 0:m.matchOnDescription)||!1,A.value=T,w.onDidChangeValue&&A.onDidChangeValue(h=>{const m=w.onDidChangeValue(h);m.activeItems&&(A.activeItems=m.activeItems),m.selectedItems&&(A.selectedItems=m.selectedItems)}),A.onDidAccept(()=>v(this,void 0,void 0,(function*(){if(w.onDidAccept){if(!1===(yield w.onDidAccept(A.selectedItems,A.value)))return}A.hide(),C(A.canSelectMany?A.selectedItems:A.selectedItems[0])}))),A.onDidHide(()=>{w.onDidHide&&w.onDidHide(),C(null)}),A.show()})));return C&&A&&(A=Array.isArray(A)?A.map(h=>h.label):A.label),A}))}withProgress(h,m,C){return v(this,void 0,void 0,(function*(){return(yield Promise.resolve().then(()=>y(0))).window.withProgress(h,m)}))}showOpenDialog(h){return v(this,void 0,void 0,(function*(){return(yield Promise.resolve().then(()=>y(0))).window.showOpenDialog(h)}))}createQuickPick(h,m,C){return v(this,void 0,void 0,(function*(){const v=m.map(h=>({label:h}));return new Promise((m,T)=>{const w=y(0).window.createQuickPick();w.placeholder=h,w.items=v,w.activeItems=w.items.filter(h=>h.label===C),w.onDidChangeValue(h=>{w.items=h?[{label:h},...v]:v}),w.onDidAccept(()=>{w.hide(),m(w.selectedItems[0].label)}),w.show()})}))}createQuickPickWithRefresh(h,m,C,T){const w=y(0).window.createQuickPick();return{setItems:h=>{w.placeholder=m,w.items=h,w.busy=!1},cancel:()=>{w.dispose()},valuePromise:new Promise(m=>{w.placeholder=h,w.items=[],w.ignoreFocusOut=!0,w.busy=!0;let y="";w.onDidChangeValue(h=>{y=h,C&&(w.busy=!0,C(h).then(h=>{w.items=h,w.busy=!1}))}),w.onDidAccept(()=>v(this,void 0,void 0,(function*(){if(w.enabled=!1,w.selectedItems.length<1){const h=y;if(!T||!(yield T(h)))return void(w.enabled=!0);m(h),w.dispose()}else m(w.selectedItems[0]),w.dispose()}))),w.show()})}}showSaveDialog(h){return v(this,void 0,void 0,(function*(){return(yield Promise.resolve().then(()=>y(0))).window.showSaveDialog(h)}))}}m.NotificationUtilClass=NotificationUtilClass;const C=NotificationUtilClass.Instance;m.NotificationUtil=C},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0});const v=y(91),C=y(8);class ByDesignError extends v.CommandError{constructor(h,m){super({message:h,code:m,telemetryResult:C.TelemetryResult.ByDesignFailure})}}m.ByDesignError=ByDesignError},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0});const v=y(91),C=y(8);class UserError extends v.CommandError{constructor(h,m){super({message:h,code:m,telemetryResult:C.TelemetryResult.UserFailure})}}m.UserError=UserError},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0});const v=y(91),C=y(8);class CancellationError extends v.CommandError{constructor(h,m){super({message:h,code:m,telemetryResult:C.TelemetryResult.Cancel})}}m.CancellationError=CancellationError},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0});const v=y(91),C=y(8);class NonBlockingError extends v.CommandError{constructor(h,m){super({message:h,code:m,telemetryResult:C.TelemetryResult.NonBlockingFailure})}}m.NonBlockingError=NonBlockingError},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0});const v=y(2),C=y(220),T=y(381);class VscodeActivityProvider extends v.DisposableClass{constructor(h){super(h.createChild("vscode-activity-provider")),this.addToDisposables(VscodeActivityProvider.vscode.workspace.onDidChangeTextDocument(h=>{this.onActivity(T.VscodeActivityType.changeTextDocument)}),VscodeActivityProvider.vscode.workspace.onDidOpenTextDocument(h=>{this.onActivity(T.VscodeActivityType.openTextDocument)}),VscodeActivityProvider.vscode.workspace.onDidCloseTextDocument(h=>{this.onActivity(T.VscodeActivityType.closeTextDocument)}),VscodeActivityProvider.vscode.workspace.onDidSaveTextDocument(h=>{this.onActivity(T.VscodeActivityType.saveTextDocument)}),VscodeActivityProvider.vscode.workspace.onDidOpenNotebookDocument(h=>{this.onActivity(T.VscodeActivityType.openNotebookDocument)}),VscodeActivityProvider.vscode.workspace.onDidCloseNotebookDocument(h=>{this.onActivity(T.VscodeActivityType.closeNotebookDocument)}),VscodeActivityProvider.vscode.debug.onDidStartDebugSession(h=>{this.onActivity(T.VscodeActivityType.startDebugSession)}),VscodeActivityProvider.vscode.debug.onDidTerminateDebugSession(h=>{this.onActivity(T.VscodeActivityType.terminateDebugSession)}),VscodeActivityProvider.vscode.debug.onDidChangeBreakpoints(h=>{this.onActivity(T.VscodeActivityType.changeBreakpoints)}),VscodeActivityProvider.vscode.tasks.onDidStartTask(h=>{this.onActivity(T.VscodeActivityType.startTask)}),VscodeActivityProvider.vscode.tasks.onDidEndTask(h=>{this.onActivity(T.VscodeActivityType.endTask)}),VscodeActivityProvider.vscode.tasks.onDidStartTaskProcess(h=>{this.onActivity(T.VscodeActivityType.startTaskProcess)}),VscodeActivityProvider.vscode.tasks.onDidEndTaskProcess(h=>{this.onActivity(T.VscodeActivityType.endTaskProcess)}),VscodeActivityProvider.vscode.window.onDidChangeActiveTextEditor(h=>{this.onActivity(T.VscodeActivityType.changeActiveTextEditor)}),VscodeActivityProvider.vscode.window.onDidOpenTerminal(h=>{this.onActivity(T.VscodeActivityType.openTerminal)}),VscodeActivityProvider.vscode.window.onDidCloseTerminal(h=>{this.onActivity(T.VscodeActivityType.closeTerminal)})),C.dataScrapingManagerInstance.registerDataScraper("vscodeEventsRegistration",()=>({init:this.onActivity.bind(this),processData:this.onActivity.bind(this),dispose(){}})).then(h=>{this.addToDisposables(h)});const m=VscodeActivityProvider.vscode.notebooks;if(m)try{"function"==typeof m.onDidSaveNotebookDocument&&this.addToDisposables(m.onDidSaveNotebookDocument(()=>{this.onActivity(T.VscodeActivityType.saveNotebookDocument)})),"function"==typeof m.onDidChangeVisibleNotebookEditors&&this.addToDisposables(m.onDidChangeVisibleNotebookEditors(()=>{this.onActivity(T.VscodeActivityType.changeVisibleNotebookEditors)})),"function"==typeof m.onDidChangeNotebookEditorSelection&&this.addToDisposables(m.onDidChangeNotebookEditorSelection(()=>{this.onActivity(T.VscodeActivityType.changeNotebookEditorSelection)})),"function"==typeof m.onDidChangeNotebookCells&&this.addToDisposables(m.onDidChangeNotebookCells(()=>{this.onActivity(T.VscodeActivityType.changeNotebookCells)})),"function"==typeof m.onDidChangeCellOutputs&&this.addToDisposables(m.onDidChangeCellOutputs(()=>{this.onActivity(T.VscodeActivityType.changeCellOutputs)})),"function"==typeof m.onDidChangeActiveNotebookEditor&&this.addToDisposables(m.onDidChangeActiveNotebookEditor(()=>{this.onActivity(T.VscodeActivityType.changeActiveNotebookEditor)})),"function"==typeof m.onDidChangeActiveNotebookKernel&&this.addToDisposables(m.onDidChangeActiveNotebookKernel(()=>{this.onActivity(T.VscodeActivityType.changeActiveNotebookKernel)}))}catch(h){if(!(h instanceof Error&&h.message.includes("Proposed API")))throw h}this.addToDisposables(VscodeActivityProvider.vscode.languages.registerHoverProvider("*",{provideHover:()=>(this.onActivity(T.VscodeActivityType.registerHoverProvider),null)}))}static get vscode(){return y(0)}}m.VscodeActivityProvider=VscodeActivityProvider},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0}),function(h){h[h.changeTextDocument=0]="changeTextDocument",h[h.openTextDocument=1]="openTextDocument",h[h.closeTextDocument=2]="closeTextDocument",h[h.saveTextDocument=3]="saveTextDocument",h[h.startDebugSession=4]="startDebugSession",h[h.terminateDebugSession=5]="terminateDebugSession",h[h.changeBreakpoints=6]="changeBreakpoints",h[h.startTask=7]="startTask",h[h.endTask=8]="endTask",h[h.startTaskProcess=9]="startTaskProcess",h[h.endTaskProcess=10]="endTaskProcess",h[h.changeActiveTextEditor=11]="changeActiveTextEditor",h[h.openTerminal=12]="openTerminal",h[h.closeTerminal=13]="closeTerminal",h[h.openNotebookDocument=14]="openNotebookDocument",h[h.closeNotebookDocument=15]="closeNotebookDocument",h[h.saveNotebookDocument=16]="saveNotebookDocument",h[h.changeVisibleNotebookEditors=17]="changeVisibleNotebookEditors",h[h.changeNotebookEditorSelection=18]="changeNotebookEditorSelection",h[h.changeNotebookCells=19]="changeNotebookCells",h[h.changeCellOutputs=20]="changeCellOutputs",h[h.changeActiveNotebookEditor=21]="changeActiveNotebookEditor",h[h.changeActiveNotebookKernel=22]="changeActiveNotebookKernel",h[h.registerHoverProvider=23]="registerHoverProvider",h[h.initialActivitySignal=24]="initialActivitySignal",h[h.typeInTerminal=25]="typeInTerminal",h[h.clickedDialog=26]="clickedDialog"}(m.VscodeActivityType||(m.VscodeActivityType={}))},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0}),function(h){h[h.Active=0]="Active",h[h.Idle=1]="Idle"}(m.VscodeSessionStatus||(m.VscodeSessionStatus={}))},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0}),m.defaultSettings={name:"Visual Studio Live Share",configName:"liveshare",serviceUri:"https://prod.liveshare.vsengsaas.visualstudio.com/",signalRServiceUri:"https://signlr-prod.core.vsengsaas.visualstudio.com/api/signalr/signalrhub",abbreviation:"VSLS",scheme:"vsls",authority:"vsls",canCollectPII:!1,activityTimeout:3e5,commandPrefix:"liveshare",featureSet:"stable",remoteSettingsUri:"https://az700632.vo.msecnd.net/pub/VSLiveShare/VSCode/",remoteSettingsUpdateMinutes:"60",textSearchResultsLimit:1e4,textSearchPreviewLimit:200}},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0});const v={"statusbar.placeHolder":"What would you like to do with other collaborators?","statusbar.InviteOthers":"Invite Others (Copy Link)","statusbar.InviteOthersMessage":"Copy the invitation link so you can send it to other participants.","statusbar.FocusParticipants":"Focus Participants","statusbar.FocusParticipantsMessage":"Request other participants to follow you.","statusbar.ShareReadOnlyTerminal":"Share Read-only Terminal","statusbar.ShareTerminal":"Share Terminal","statusbar.ShareTerminalMessage":"Start a new terminal / command prompt for use by all participants.","statusbar.ShareServer":"Share Server","statusbar.ShareServerMessage":"Expose a local TCP port to all participants.","statusbar.ShowSharedServers":"Show Shared Servers","statusbar.ShowSharedServersMessage":"Show local TCP servers shared with collaboration participants.","statusbar.StartCollaboration":"Start Collaboration Session","statusbar.StopSharingServer":"Stop Sharing Server","statusbar.StopSharingServerMessage":"Stop sharing a local TCP port for all participants.","statusbar.StopCollaborationSession":"Stop Collaboration Session","statusbar.StopCollaborationSessionMessage":"Stop collaboration session, stop sharing all content, and remove all participant access.","statusbar.SignInMessage":"Sign in with your GitHub or Microsoft account to gain read/write access.","statusbar.AttachSharedDebuggingSession":"Attach to a Shared Debugging Session","statusbar.AttachSharedDebuggingSessionMessage":"Attach your debugger to a debug session that the host has shared with participants.","statusbar.AccessSharedTerminal":"Access Shared Terminal","statusbar.AccessSharedTerminalMessage":"Open terminal that the host has shared with participants.","statusbar.AccessSharedServer":"Access Shared Server","statusbar.AccessSharedServerMessage":"Copy a named, shared TCP port for use","statusbar.LeaveCollaborationSession":"Leave Collaboration Session","statusbar.LeaveCollaborationSessionMessage":"Stop participating in this collaboration session.","statusbar.SignedUserPlaceholder":"What would you like to do?","statusbar.StartSession":"Start Collaboration Session","statusbar.StartSessionMessage":"Start a collaboration session to share content and invite participants.","statusbar.StartReadOnly":"Start Read-only Collaboration Session","statusbar.StartReadOnlyMessage":"Start a read-only collaboration session to share content and invite participants.","statusbar.JoinSession":"Join Collaboration Session","statusbar.JoinSessionMessage":"Join a collaboration session to access shared content.","generic.Close":"Close","generic.CopyAgain":"Copy again","generic.CopyLink":"Copy link","generic.MakeReadWrite":"Make read/write","generic.MakeReadOnly":"Make read-only","generic.StartSharing":"Start Sharing","generic.Help":"Help","generic.OK":"OK","generic.SignIn":"Sign in","generic.ContinueAsAnonymous":"Continue as anonymous","generic.moreInfo":"More info","generic.dontShowAgain":"Don't show again","error.CouldNotConnectToServer":"Could not connect to the server. Check that you are connected to the internet.","error.OlderThanServer":"The $(shortName) service requires a newer version of the extension than you have installed.","error.NewerThanServer":"The extension you have installed requires a newer version of the $(shortName) service.","error.OlderThanPeer":"The $(shortName) extension you have installed is too old to connect to this collaboration session.","error.NewerThanPeer":"The collaboration session host is on an older version of the $(shortName) extension than you are.","error.OlderThanAgent":"The $(shortName) agent is newer than the extension","error.NewerThanAgent":"The $(shortName) agent is older than the extension","error.NoIPAddressesDetected":'Unable to share in "Direct" mode as there are no suitable IP addresses. Switch to "Auto" or "Relay" mode and retry.',"error.NoConnectionAddresses":'Could not find a compatible connection address. Switch to "Auto" mode and retry.',"error.AutoConnectionFailed":"Unable to connect to the host. Verify both you and the host are online.","error.RelayConnectionFailed":'Unable to connect to the host in "Relay" mode. Verify you and the host are online. If so, switch to "Auto" or "Direct" mode and retry.',"error.DirectConnectionFailed":'Unable to connect to the host in "Direct" mode. Verify you and the host are online. If so, switch to "Auto" or "Relay" mode and retry.',"error.SessionProtocolError":"Unable to join the host due to a protocol error. Verify you and the host are online and are using the latest version of $(shortName).","error.SessionAuthenticationFailed":"Unable to join the host due to an authentication error. Verify the host is online, then sign out and sign in again and retry.","error.AuthTokenConversionFailed":"Live Share didn't succeed reusing a GitHub token for authentication. This could be caused by either a token expiration or revocation. Refresh your GitHub account in VSCode and run Live Share again to fix the problem.","error.AuthTokenConversionFailedWithCode":"Token exchange failed with code: ${code}","error.UnexpectedAuthenticationError":"Unexpected authentication error. Try signing in again.","error.DirectConnectionNotEnabled":'The host does not allow direct connections. Switch to "Auto" or "Relay" mode and retry.',"error.RelayConnectionNotEnabled":'Unable to connect since the host does not allow relayed connections. Switch to "Auto" or "Direct" mode and retry.',"error.CollaborationSessionUsersLimitReached":"Could not join the collaboration session as it has already reached the maximum of 5 participants. To increase the participant limit, please ask the host to change the Increased Guest Limit setting, reload and then start a new collaboration session.","error.CollaborationSessionGuestRejected":"The host has rejected you from joining the collaboration session.","error.CollaborationSessionRequestTimedOut":"Timed out while waiting for the host to respond to your request.","error.CollaborationSessionGuestCanceled":"Request to join the collaboration session was canceled.","error.CollaborationSessionNotFound":"Collaboration session not found.","error.CollaborationSessionGuestBlocked":"The host has blocked you from joining the collaboration. If this was accidental, please ask the host to restart the session.","error.NonSuccessHttpStatusCodeReceived":"Could not connect to the server. Received non success status code.","error.KeychainAccessFailed":"Live Share was unable to access the login keychain. This can happen if you recently changed your password or your login keychain has become corrupted. See more info for details on how to fix it.","error.RelayConnectionHostFailure":"The host's network conditions are poor or they are no longer connected to the Live Share cloud relay. Ask them to check their network conditions, restart the collaboration session, and try again.","error.RelayConnectionGuestFailure":"Unable to connect to Live Share cloud relay. Check your proxy, firewall and network settings and try again.","error.RemoteLaunchNotEnabled":"The host doesnt allow starting the debugger. If needed, ask them to enable it.","error.CouldNotConnectToServerAuthFailed":"Could not connect to the server. HTTPS connection failed, verify there are no self-signed certificates or custom cert validation policies blocking Live Share.","error.CannotCreatePlannedSession":"Failed to create a planned session","error.CannotDeletePlannedSession":"Failed to delete a planned session","error.CannotRenamePlannedSession":"Failed to rename planned session","error.CannotCopyPlannedSessionLink":"Failed to copy planned session link","error.CannotJoinPlannedSession":"Failed to join planned session","error.CaseSensitiveFileSystem":"It looks like you have a directory with files that have the same name, except for the casing. This is currently unsupported and may lead to errors.","error.RunningVsCodeOutsideOfApplicationsFolder":"You are running VS Code outside the Applications folder, so we cannot install support for joining sessions using a browser link. You can still join sessions manually.","error.FailedToInstallJoiningSessionsViaBrowser":"Failed to install support for joining sessions using a browser link. You can still join sessions manually.","error.InvitationLinkExpired":"This invite link has expired. Share again to generate a new link.","progress.openingRemoteSession":"Opening remote session...","progress.joiningRemoteSession":"Joining remote session...","progress.waitingForHost":"Waiting for host approval...","progress.reconnectingToHost":"Connection lost. Reconnecting to host...","progress.creatingPlannedSession":"Creating planned session...","progress.deletingPlannedSession":"Deleting planned session...","fileError.FileNotFound":"Path not found: $(path)","fileError.FileExists":"Path already exists: $(path)","fileError.NoPermissions":"Access denied: $(path)","fileError.FileTooLarge":"File is too large.","fileError.FileNotAvailable":"File is not available.","notification.AcceptRejectGuest":" requested to join the collaboration session.","notification.Accept":"Accept","notification.AcceptReadOnly":"Accept read-only","notification.AcceptReadWrite":"Accept read-write","notification.Reject":"Reject","notification.AlwaysAcceptAnonymous":"Always accept anonymous","notification.InformGuestJoined":" joined the collaboration session.","notification.GuestDisconnected":" was disconnected.","notification.GuestLeft":" left the collaboration session.","notification.FocusAccept":"$(userId) focused your attention.","notification.FocusRequest":"$(userId) requested you to follow them.","notification.CopyPlannedSessionLink":"Session link copied.","notification.CoeditingInformationCopiedToClipboard":"Co-editing information copied to clipboard.","notification.JoiningFromBrowserPermission":"To support joining a session using a browser link, we need permission to run an installer on your system. Your OS may ask you for your admin (sudo) password in a terminal. Install now?","notification.copyInstead":"Copy instead","notification.install":"Install","notification.InvitationLinkCopied":"Invitation link copied to clipboard! Send it to anyone you trust","notification.InvitationLinkSessionShared":'Session shared! Click "Copy link" to get an invitation link ',"notification.InvitationLinkMoreInfo":'or click "More info" to learn about secure sharing.',"notification.ReusableInvitationLinkCopied":'A Reusable Session link is copied to the clipboard. Save the link to a secure location. Learn more about how to use your Session by clicking "More info".',"notification.ReusableInvitationLinkCreated":'A Reusable Session link is created! Click "Copy link" to get the link. Save the link to a secure location. Learn more about how to use your Session by clicking "More info".',"notification.SignIntoJoin":"Sign in with VS Live Share to join a collaboration session.","notification.YouNeedToSignInBeforeJoin":"You need to sign in before joining the collaboration session.","notification.ProgressNotifiers":"$(options.title)","notification.CannotEditTheTerminal":"Cannot edit the terminal in read-only mode (anonymous). Sign in to proceed.","plannedSessions.quickPickSelectWindow":"Select a planned session","plannedSessions.expiresatTooltip":"Expiration: ","plannedSessions.NewLabel":"Create planned session...","plannedSessions.CreateaPlannedSessionTooltip":"Create a planned session","plannedSessions.Name":"Specify the name of the planned session","plannedSessions.NameCannotBeEmpty":"Name cannot be empty. Please enter an alphanumeric name for the session","plannedSessions.NameIsInvalid":"Name is invalid. Please enter an alphanumeric name for the session","guestNameToast.ReadOnlyLabel":" (Read-only)","guestNameToast.ReadOnlyAndAnonymousLabel":" (Anonymous & Read-only)","guestNameToast.AnonymousReadWriteLabel":" (Anonymous & Read-write)","guestNameToast.AnonymousLabel":" (Anonymous)","extension.liveshare.InLiveShareSession":"In a Live Share session","searchContacts.placeholder":"Type to search for contacts","selectPresenceProviderCommand.placeHolder":"Select the presence provider to use","inviteContactStatus.invited":"Invited","inviteContactStatus.dismissed":"Dismissed","inviteContactStatus.joining":"Joining","guestNameViewlet.ReadOnlyLabel":" (read-only)","guestNameViewlet.ReadOnlyAndAnonymousLabel":" (anonymous & read-only)","guestNameViewlet.AnonymousReadWriteLabel":" (anonymous & read-write)","anonymousAuthStrategy.readOnlyUser":"Read-only User","anonymousAuthStrategy.continueAs":"Continue as","anonymousAuthStrategy.continueAsDescription":"Continue without signing in as a Read-only guest","authentication.SignInPromptPlaceholder":"Please select account to sign in","authentication.SignInPrompt":"Sign in using ${key} account","commentManager.cannotCreateCommentThread":"Cannot create comment thread","commentManager.cannotDeleteThread":"Cannot delete comment thread","commentManager.cannotReply":"Cannot reply","commentManager.cannotEditComment":"Cannot edit comment","commentManager.cannotSaveComment":"Cannot save comment","commentManager.cannotCancelEditComment":"Cannot cancel editing comment","commentManager.cannotDeleteComment":"Cannot delete comment","commentManager.deleteOtherComments":"delete other comments on the thread first","commentManager.controllerLabel":"Live Share Session Comments","commentManager.participants":"Participants:","chat.statusBarText":"Live Share Chat: $(unreads) new","chat.sessionChatLabel":"Session Chat","chat.quickPickItemDescription":"Live Share Chat","chat.quickPickSelectWindow":"Select a chat channel","chat.unreadLabel":"($(unread) new)","chat.typingStatus":"$(username) is typing...","chat.sessionStarted":"_has started the Live Share session_","chat.sessionEnded":"_has ended the Live Share session_","chat.sessionJoined":"_has joined the Live Share session_","chat.sessionLeft":"_has left the Live Share session_","chat.hostUnsupported":"The host of this collaboration session is currently disconnected from chat or is using a version of _Live Share_ that does not support this feature. [Learn more](https://aka.ms/vsls-chat)","chat.contactUnsupported":"The person you are trying to contact is currently unavailable or using a version of _Live Share_ that does not support this feature. [Learn more](https://aka.ms/vsls-chat)","chat.legacyExtensionUnsupported":"Please update the `Live Share Chat` companion extension. The version installed is no longer compatible. [Learn more](https://aka.ms/vsls-chat)","chat.unknownUser":"Unknown user","chat.openSessionChatWindow":"Open session chat","chat.chatServiceDisconnected":"The chat service is currently disconnected. Please try again shortly.","calling.quickPickConnectedPlaceholder":"What would you like to do?","calling.quickPickDisconnectLabel":"$(x) Disconnect","calling.quickPickDisconnectDetail":"Disconnect from the audio call.","calling.quickPickMuteYourselfLabel":"$(mute) Mute Yourself","calling.quickPickUnmuteYourselfLabel":"$(unmute) Unmute Yourself","calling.quickPickMuteYourselfDetail":"Mute yourself so others cannot hear you.","calling.quickPickUnmuteYourselfDetail":"Unmute your microphone so others can hear you.","calling.quickPickViewParticipantsLabel":"$(organization) View Participants","calling.quickPickViewParticipantsDetail":"View the list of Live Share participants that are currently in the call.","calling.quickPickConfigureSpeakersLabel":"$(unmute) Configure Speakers","calling.quickPickConfigureSpeakersDetail":"Select which speakers to use for the audio call.","calling.quickPickConfigureMicrophoneLabel":"$(megaphone) Configure Microphone","calling.quickPickConfigureMicrophoneDetail":"Select which microphone to use for the audio call.","calling.treeAudioCallParticipantsInitial":"Participants (0)","calling.treeJoinAudioCall":"Join audio call...","calling.treeStartAudioCall":"Start audio call...","calling.treeJoiningAudioCall":"Joining audio call...","calling.treeStartingAudioCall":"Starting audio call...","calling.treeEndingAudioCall":"Ending audio call...","calling.treeAudioCallLabel":"Audio Call","calling.treeAudioCallParticipantsCount":"Audio Call Participants ($(participantCount))","calling.treeUnknownUser":"Unknown user","calling.treeSelfItem":"$(displayName) (you)","calling.joinButton":"Join","calling.connectingAudio":"Connecting audio...","calling.disconnectingAudio":"Disconnecting audio...","calling.viewParticipantsQuickPickPlaceholder":"Audio Call Participants","calling.selectMicrophoneQuickPickPlaceholder":"Select the microphone to use","calling.selectSpeakersQuickPickPlaceholder":"Select the speaker to use","calling.joinInformationMessage":"An audio call has been started for this collaboration session.","info.SearchResultsLimited":"The result set contains only a subset of all matches. Please be more specific in your search to narrow down the results.","treeView.newTooltip":"[New]","guestServerController-promtHostSharedServer":"The host has shared a server $(sessionName) with you. Would you like to view this in the browser?","guestServerController-yes":"Yes","guestServerController-no":"No","guestServerController-serverUnshared":"Cannot open server $(sessionName) in browser. The host has unshared the server","emptyWorkspace.liveShareWorkspace":"Live Share Workspace","notebooks.openWithDifferentNotebookTypeOnHost1":"The host has the notebook open with","notebooks.openWithDifferentNotebookTypeOnHost2":"Use the same view to open","notebooks.openedWithLocalContentProvider":"Co-editing is not supported for notebooks opened with non-shared views.","notebooks.kernelDetail":"Kernel to execute cells on the host's machine","notebooks.executeCellsAccessGranted":"The host has granted you access to execute notebook cells","notebooks.executeCellsAccessDenied":"The host has rejected your request to execute notebook cells","notebooks.executeCellsReadOnly":"You cannot execute notebook cells in a read-only session","notebooks.executeCellsLackingPermission":"The host has not given you permission to execute notebook cells","notebooks.executeCellsRequestAccess":"Request access","notebooks.executeCellsAllowForSession":"Allow for this session","notebooks.executeCellsAllowAlways":"Allow always","notebooks.executeCellsReject":"Reject","notebooks.executeCellsRequested":"A guest is requesting permission to execute notebook cells",startCollaborationSession:"Start collaboration session...",joinCollaborationSession:"Join collaboration session...",startReadOnlyCollaborationSession:"Start read-only collaboration session...",CreateLinkProgress:"Creating a Reusable Session link...",CannotCreatePersistentSession:"Failed to create a Reusable Session link","accessibility.file":"File","accessibility.line":"Line","accessibility.lines":"Lines","accessibility.to":"to","accessibility.onScreen":"on screen","accessibility.selection":"Selection","accessibility.join":"joined the session","accessibility.leave":"left the session","accessibility.follow":"You are now following","accessibility.unfollow":"You unfollowed","accessibility.leftLine":"left your line","accessibility.theyLeftLine":"They left your line","accessibility.switchFile":"switched to file","accessibility.editingSameLine":"is editing the same line as you","accessibility.theyEditingSameLine":"They are editing the same line as you","accessibility.editingNearby":"is editing nearby","accessibility.theyEditingNearby":"They are editing nearby","accessibility.selectionOnLine":"Selection on line","accessibility.selectedLines":"Selected lines","accessibility.lookingForOutputDevices":"Looking for devices","web.SelectLauncherClient":"How would you like to join this collaboration session?","web.OpenIn":"Open in $(editor)","web.ContinueIn":"Continue in $(editor)","web.Reopen":"Re-open in $(editor)","web.LaunchingIn":"Joining the collaboration session with $(editor)...","presence.signInMessage":"Sign in to presence will allow people to see your status based on your e-mail","sessionExplorer.commentsLabel":"Comments ($(count))"};let localizeInstance=h=>v.hasOwnProperty(h)?v[h]:h;m.setLocalizeCallback=function setLocalizeCallback(h){localizeInstance=h},m.localize=function localize(h){return localizeInstance(h)},m.localizeDate=function localizeDate(h){return h.toLocaleString()}},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0});const v=y(386),C=y(8),T=y(161),w=y(223),A=y(92);class ExperimentationTelemetry{setSharedProperty(h,m){C.Telemetry.addContextProperty(h,m)}postEvent(h,m){const y=new C.TelemetryEvent(h);for(let[h,v]of m)y.addProperty(h,v);y.send()}}let P;m.getExpService=function getExpService(){return P},m.initAsync=async function initAsync(h,m){const y=`${w.LIVESHARE_EXTENSION_ID}${m?"-web":""}`,C=T.ExtensionUtil.getExtensionVersion(w.LIVESHARE_EXTENSION_ID),k=function getTargetPopulation(){return A.Settings.isVSLSTeamMember?v.TargetPopulation.Team:A.Settings.isInternalFeatureSet?v.TargetPopulation.Internal:A.Settings.isInsidersFeatureSet?v.TargetPopulation.Insiders:v.TargetPopulation.Public}();P=await v.getExperimentationServiceAsync(y,C,k,new ExperimentationTelemetry,h.globalState)}},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0});var v=y(915);m.getExperimentationService=v.getExperimentationService,m.getExperimentationServiceAsync=v.getExperimentationServiceAsync;var C=y(387);m.TargetPopulation=C.TargetPopulation},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0});const v=y(0);class VSCodeFilterProvider{constructor(h,m,y){this.extensionName=h,this.extensionVersion=m,this.targetPopulation=y}static trimVersionSuffix(h){return h.split(/\-[a-zA-Z0-9]+$/)[0]}getFilterValue(h){switch(h){case C.ApplicationVersion:return VSCodeFilterProvider.trimVersionSuffix(v.version);case C.Build:return v.env.appName;case C.ClientId:return v.env.machineId;case C.ExtensionName:return this.extensionName;case C.ExtensionVersion:return VSCodeFilterProvider.trimVersionSuffix(this.extensionVersion);case C.Language:return v.env.language;case C.TargetPopulation:return this.targetPopulation;default:return""}}getFilters(){let h=new Map,m=Object.values(C);for(let y of m)h.set(y,this.getFilterValue(y));return h}}var C;m.VSCodeFilterProvider=VSCodeFilterProvider,function(h){h.Market="X-MSEdge-Market",h.CorpNet="X-FD-Corpnet",h.ApplicationVersion="X-VSCode-AppVersion",h.Build="X-VSCode-Build",h.ClientId="X-MSEdge-ClientId",h.ExtensionName="X-VSCode-ExtensionName",h.ExtensionVersion="X-VSCode-ExtensionVersion",h.Language="X-VSCode-Language",h.TargetPopulation="X-VSCode-TargetPopulation"}(C=m.Filters||(m.Filters={})),function(h){h.Team="team",h.Internal="internal",h.Insiders="insider",h.Public="public"}(m.TargetPopulation||(m.TargetPopulation={}))},function(h,m,y){"use strict";h.exports=function bind(h,m){return function wrap(){for(var y=new Array(arguments.length),v=0;v<y.length;v++)y[v]=arguments[v];return h.apply(m,y)}}},function(h,m,y){"use strict";var v=y(227);h.exports=function settle(h,m,y){var C=y.config.validateStatus;y.status&&C&&!C(y.status)?m(v("Request failed with status code "+y.status,y.config,null,y.request,y)):h(y)}},function(h,m,y){"use strict";var v=y(930),C=y(931);h.exports=function buildFullPath(h,m){return h&&!v(m)?C(h,m):m}},function(h,m,y){var v=y(20),C=v.URL,T=y(52),w=y(46),A=y(19).Writable,P=y(28),k=y(935),R=["abort","aborted","connect","error","socket","timeout"],M=Object.create(null);R.forEach((function(h){M[h]=function(m,y,v){this._redirectable.emit(h,m,y,v)}}));var N=createErrorType("ERR_FR_REDIRECTION_FAILURE",""),D=createErrorType("ERR_FR_TOO_MANY_REDIRECTS","Maximum number of redirects exceeded"),I=createErrorType("ERR_FR_MAX_BODY_LENGTH_EXCEEDED","Request body larger than maxBodyLength limit"),x=createErrorType("ERR_STREAM_WRITE_AFTER_END","write after end");function RedirectableRequest(h,m){A.call(this),this._sanitizeOptions(h),this._options=h,this._ended=!1,this._ending=!1,this._redirectCount=0,this._redirects=[],this._requestBodyLength=0,this._requestBodyBuffers=[],m&&this.on("response",m);var y=this;this._onNativeResponse=function(h){y._processResponse(h)},this._performRequest()}function wrap(h){var m={maxRedirects:21,maxBodyLength:10485760},y={};return Object.keys(h).forEach((function(T){var w=T+":",A=y[w]=h[T],R=m[T]=Object.create(A);Object.defineProperties(R,{request:{value:function request(h,T,A){if("string"==typeof h){var R=h;try{h=urlToOptions(new C(R))}catch(m){h=v.parse(R)}}else C&&h instanceof C?h=urlToOptions(h):(A=T,T=h,h={protocol:w});return"function"==typeof T&&(A=T,T=null),(T=Object.assign({maxRedirects:m.maxRedirects,maxBodyLength:m.maxBodyLength},h,T)).nativeProtocols=y,P.equal(T.protocol,w,"protocol mismatch"),k("options",T),new RedirectableRequest(T,A)},configurable:!0,enumerable:!0,writable:!0},get:{value:function get(h,m,y){var v=R.request(h,m,y);return v.end(),v},configurable:!0,enumerable:!0,writable:!0}})})),m}function noop(){}function urlToOptions(h){var m={protocol:h.protocol,hostname:h.hostname.startsWith("[")?h.hostname.slice(1,-1):h.hostname,hash:h.hash,search:h.search,pathname:h.pathname,path:h.pathname+h.search,href:h.href};return""!==h.port&&(m.port=Number(h.port)),m}function removeMatchingHeaders(h,m){var y;for(var v in m)h.test(v)&&(y=m[v],delete m[v]);return y}function createErrorType(h,m){function CustomError(h){Error.captureStackTrace(this,this.constructor),this.message=h||m}return CustomError.prototype=new Error,CustomError.prototype.constructor=CustomError,CustomError.prototype.name="Error ["+h+"]",CustomError.prototype.code=h,CustomError}function abortRequest(h){for(var m=0;m<R.length;m++)h.removeListener(R[m],M[R[m]]);h.on("error",noop),h.abort()}RedirectableRequest.prototype=Object.create(A.prototype),RedirectableRequest.prototype.abort=function(){abortRequest(this._currentRequest),this.emit("abort")},RedirectableRequest.prototype.write=function(h,m,y){if(this._ending)throw new x;if(!("string"==typeof h||"object"==typeof h&&"length"in h))throw new TypeError("data should be a string, Buffer or Uint8Array");"function"==typeof m&&(y=m,m=null),0!==h.length?this._requestBodyLength+h.length<=this._options.maxBodyLength?(this._requestBodyLength+=h.length,this._requestBodyBuffers.push({data:h,encoding:m}),this._currentRequest.write(h,m,y)):(this.emit("error",new I),this.abort()):y&&y()},RedirectableRequest.prototype.end=function(h,m,y){if("function"==typeof h?(y=h,h=m=null):"function"==typeof m&&(y=m,m=null),h){var v=this,C=this._currentRequest;this.write(h,m,(function(){v._ended=!0,C.end(null,null,y)})),this._ending=!0}else this._ended=this._ending=!0,this._currentRequest.end(null,null,y)},RedirectableRequest.prototype.setHeader=function(h,m){this._options.headers[h]=m,this._currentRequest.setHeader(h,m)},RedirectableRequest.prototype.removeHeader=function(h){delete this._options.headers[h],this._currentRequest.removeHeader(h)},RedirectableRequest.prototype.setTimeout=function(h,m){var y=this;function destroyOnTimeout(m){m.setTimeout(h),m.removeListener("timeout",m.destroy),m.addListener("timeout",m.destroy)}function startTimer(m){y._timeout&&clearTimeout(y._timeout),y._timeout=setTimeout((function(){y.emit("timeout"),clearTimer()}),h),destroyOnTimeout(m)}function clearTimer(){y._timeout&&(clearTimeout(y._timeout),y._timeout=null),m&&y.removeListener("timeout",m),y.socket||y._currentRequest.removeListener("socket",startTimer)}return m&&this.on("timeout",m),this.socket?startTimer(this.socket):this._currentRequest.once("socket",startTimer),this.on("socket",destroyOnTimeout),this.once("response",clearTimer),this.once("error",clearTimer),this},["flushHeaders","getHeader","setNoDelay","setSocketKeepAlive"].forEach((function(h){RedirectableRequest.prototype[h]=function(m,y){return this._currentRequest[h](m,y)}})),["aborted","connection","socket"].forEach((function(h){Object.defineProperty(RedirectableRequest.prototype,h,{get:function(){return this._currentRequest[h]}})})),RedirectableRequest.prototype._sanitizeOptions=function(h){if(h.headers||(h.headers={}),h.host&&(h.hostname||(h.hostname=h.host),delete h.host),!h.pathname&&h.path){var m=h.path.indexOf("?");m<0?h.pathname=h.path:(h.pathname=h.path.substring(0,m),h.search=h.path.substring(m))}},RedirectableRequest.prototype._performRequest=function(){var h=this._options.protocol,m=this._options.nativeProtocols[h];if(m){if(this._options.agents){var y=h.substr(0,h.length-1);this._options.agent=this._options.agents[y]}var C=this._currentRequest=m.request(this._options,this._onNativeResponse);this._currentUrl=v.format(this._options),C._redirectable=this;for(var T=0;T<R.length;T++)C.on(R[T],M[R[T]]);if(this._isRedirect){var w=0,A=this,P=this._requestBodyBuffers;!function writeNext(h){if(C===A._currentRequest)if(h)A.emit("error",h);else if(w<P.length){var m=P[w++];C.finished||C.write(m.data,m.encoding,writeNext)}else A._ended&&C.end()}()}}else this.emit("error",new TypeError("Unsupported protocol "+h))},RedirectableRequest.prototype._processResponse=function(h){var m=h.statusCode;this._options.trackRedirects&&this._redirects.push({url:this._currentUrl,headers:h.headers,statusCode:m});var y=h.headers.location;if(y&&!1!==this._options.followRedirects&&m>=300&&m<400){if(abortRequest(this._currentRequest),h.destroy(),++this._redirectCount>this._options.maxRedirects)return void this.emit("error",new D);((301===m||302===m)&&"POST"===this._options.method||303===m&&!/^(?:GET|HEAD)$/.test(this._options.method))&&(this._options.method="GET",this._requestBodyBuffers=[],removeMatchingHeaders(/^content-/i,this._options.headers));var C=removeMatchingHeaders(/^host$/i,this._options.headers)||v.parse(this._currentUrl).hostname,T=v.resolve(this._currentUrl,y);k("redirecting to",T),this._isRedirect=!0;var w=v.parse(T);if(Object.assign(this._options,w),w.hostname!==C&&removeMatchingHeaders(/^authorization$/i,this._options.headers),"function"==typeof this._options.beforeRedirect){var A={headers:h.headers};try{this._options.beforeRedirect.call(null,this._options,A)}catch(h){return void this.emit("error",h)}this._sanitizeOptions(this._options)}try{this._performRequest()}catch(h){var P=new N("Redirected request failed: "+h.message);P.cause=h,this.emit("error",P)}}else h.responseUrl=this._currentUrl,h.redirects=this._redirects,this.emit("response",h),this._requestBodyBuffers=[]},h.exports=wrap({http:T,https:w}),h.exports.wrap=wrap},function(h,m,y){h.exports=function setup(h){function selectColor(h){let m=0;for(let y=0;y<h.length;y++)m=(m<<5)-m+h.charCodeAt(y),m|=0;return createDebug.colors[Math.abs(m)%createDebug.colors.length]}function createDebug(h){let m;function debug(...h){if(!debug.enabled)return;const y=debug,v=Number(new Date),C=v-(m||v);y.diff=C,y.prev=m,y.curr=v,m=v,h[0]=createDebug.coerce(h[0]),"string"!=typeof h[0]&&h.unshift("%O");let T=0;h[0]=h[0].replace(/%([a-zA-Z%])/g,(m,v)=>{if("%%"===m)return m;T++;const C=createDebug.formatters[v];if("function"==typeof C){const v=h[T];m=C.call(y,v),h.splice(T,1),T--}return m}),createDebug.formatArgs.call(y,h),(y.log||createDebug.log).apply(y,h)}return debug.namespace=h,debug.enabled=createDebug.enabled(h),debug.useColors=createDebug.useColors(),debug.color=selectColor(h),debug.destroy=destroy,debug.extend=extend,"function"==typeof createDebug.init&&createDebug.init(debug),createDebug.instances.push(debug),debug}function destroy(){const h=createDebug.instances.indexOf(this);return-1!==h&&(createDebug.instances.splice(h,1),!0)}function extend(h,m){const y=createDebug(this.namespace+(void 0===m?":":m)+h);return y.log=this.log,y}function toNamespace(h){return h.toString().substring(2,h.toString().length-2).replace(/\.\*\?$/,"*")}return createDebug.debug=createDebug,createDebug.default=createDebug,createDebug.coerce=function coerce(h){if(h instanceof Error)return h.stack||h.message;return h},createDebug.disable=function disable(){const h=[...createDebug.names.map(toNamespace),...createDebug.skips.map(toNamespace).map(h=>"-"+h)].join(",");return createDebug.enable(""),h},createDebug.enable=function enable(h){let m;createDebug.save(h),createDebug.names=[],createDebug.skips=[];const y=("string"==typeof h?h:"").split(/[\s,]+/),v=y.length;for(m=0;m<v;m++)y[m]&&("-"===(h=y[m].replace(/\*/g,".*?"))[0]?createDebug.skips.push(new RegExp("^"+h.substr(1)+"$")):createDebug.names.push(new RegExp("^"+h+"$")));for(m=0;m<createDebug.instances.length;m++){const h=createDebug.instances[m];h.enabled=createDebug.enabled(h.namespace)}},createDebug.enabled=function enabled(h){if("*"===h[h.length-1])return!0;let m,y;for(m=0,y=createDebug.skips.length;m<y;m++)if(createDebug.skips[m].test(h))return!1;for(m=0,y=createDebug.names.length;m<y;m++)if(createDebug.names[m].test(h))return!0;return!1},createDebug.humanize=y(937),Object.keys(h).forEach(m=>{createDebug[m]=h[m]}),createDebug.instances=[],createDebug.names=[],createDebug.skips=[],createDebug.formatters={},createDebug.selectColor=selectColor,createDebug.enable(createDebug.load()),createDebug}},function(h){h.exports=JSON.parse('{"name":"axios","version":"0.21.4","description":"Promise based HTTP client for the browser and node.js","main":"index.js","scripts":{"test":"grunt test","start":"node ./sandbox/server.js","build":"NODE_ENV=production grunt build","preversion":"npm test","version":"npm run build && grunt version && git add -A dist && git add CHANGELOG.md bower.json package.json","postversion":"git push && git push --tags","examples":"node ./examples/server.js","coveralls":"cat coverage/lcov.info | ./node_modules/coveralls/bin/coveralls.js","fix":"eslint --fix lib/**/*.js"},"repository":{"type":"git","url":"https://github.com/axios/axios.git"},"keywords":["xhr","http","ajax","promise","node"],"author":"Matt Zabriskie","license":"MIT","bugs":{"url":"https://github.com/axios/axios/issues"},"homepage":"https://axios-http.com","devDependencies":{"coveralls":"^3.0.0","es6-promise":"^4.2.4","grunt":"^1.3.0","grunt-banner":"^0.6.0","grunt-cli":"^1.2.0","grunt-contrib-clean":"^1.1.0","grunt-contrib-watch":"^1.0.0","grunt-eslint":"^23.0.0","grunt-karma":"^4.0.0","grunt-mocha-test":"^0.13.3","grunt-ts":"^6.0.0-beta.19","grunt-webpack":"^4.0.2","istanbul-instrumenter-loader":"^1.0.0","jasmine-core":"^2.4.1","karma":"^6.3.2","karma-chrome-launcher":"^3.1.0","karma-firefox-launcher":"^2.1.0","karma-jasmine":"^1.1.1","karma-jasmine-ajax":"^0.1.13","karma-safari-launcher":"^1.0.0","karma-sauce-launcher":"^4.3.6","karma-sinon":"^1.0.5","karma-sourcemap-loader":"^0.3.8","karma-webpack":"^4.0.2","load-grunt-tasks":"^3.5.2","minimist":"^1.2.0","mocha":"^8.2.1","sinon":"^4.5.0","terser-webpack-plugin":"^4.2.3","typescript":"^4.0.5","url-search-params":"^0.10.0","webpack":"^4.44.2","webpack-dev-server":"^3.11.0"},"browser":{"./lib/adapters/http.js":"./lib/adapters/xhr.js"},"jsdelivr":"dist/axios.min.js","unpkg":"dist/axios.min.js","typings":"./index.d.ts","dependencies":{"follow-redirects":"^1.14.0"},"bundlesize":[{"path":"./dist/axios.min.js","threshold":"5kB"}]}')},function(h,m,y){"use strict";h.exports=function isCancel(h){return!(!h||!h.__CANCEL__)}},function(h,m,y){"use strict";var v=y(33);h.exports=function mergeConfig(h,m){m=m||{};var y={},C=["url","method","data"],T=["headers","auth","proxy","params"],w=["baseURL","transformRequest","transformResponse","paramsSerializer","timeout","timeoutMessage","withCredentials","adapter","responseType","xsrfCookieName","xsrfHeaderName","onUploadProgress","onDownloadProgress","decompress","maxContentLength","maxBodyLength","maxRedirects","transport","httpAgent","httpsAgent","cancelToken","socketPath","responseEncoding"],A=["validateStatus"];function getMergedValue(h,m){return v.isPlainObject(h)&&v.isPlainObject(m)?v.merge(h,m):v.isPlainObject(m)?v.merge({},m):v.isArray(m)?m.slice():m}function mergeDeepProperties(C){v.isUndefined(m[C])?v.isUndefined(h[C])||(y[C]=getMergedValue(void 0,h[C])):y[C]=getMergedValue(h[C],m[C])}v.forEach(C,(function valueFromConfig2(h){v.isUndefined(m[h])||(y[h]=getMergedValue(void 0,m[h]))})),v.forEach(T,mergeDeepProperties),v.forEach(w,(function defaultToConfig2(C){v.isUndefined(m[C])?v.isUndefined(h[C])||(y[C]=getMergedValue(void 0,h[C])):y[C]=getMergedValue(void 0,m[C])})),v.forEach(A,(function merge(v){v in m?y[v]=getMergedValue(h[v],m[v]):v in h&&(y[v]=getMergedValue(void 0,h[v]))}));var P=C.concat(T).concat(w).concat(A),k=Object.keys(h).concat(Object.keys(m)).filter((function filterAxiosKeys(h){return-1===P.indexOf(h)}));return v.forEach(k,mergeDeepProperties),y}},function(h,m,y){"use strict";function Cancel(h){this.message=h}Cancel.prototype.toString=function toString(){return"Cancel"+(this.message?": "+this.message:"")},Cancel.prototype.__CANCEL__=!0,h.exports=Cancel},function(h,m,y){"use strict";var v;Object.defineProperty(m,"__esModule",{value:!0}),function(h){h[h.Unknown=0]="Unknown",h[h.Yes=1]="Yes",h[h.No=2]="No"}(v||(v={}));let C=v.Unknown;m.checkDebugging=function checkDebugging(){if(C===v.Unknown){C=v.No;for(let h of process.execArgv)if(h.startsWith("--inspect-brk")||h.startsWith("--debug")){C=v.Yes;break}}return C===v.Yes}},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0});const v=y(0),C=y(7),T=y(92);let w,A;function schemeQualifiedPathRegExp(){return A||(A=new RegExp('"'+T.Settings.scheme+':([^"]*)"',"g")),A}class PathUtil{static replaceSchemeWithPath(h,m){return(m.endsWith("/")||m.endsWith("\\"))&&(m=m.substr(0,m.length-1)),h.replace(function schemeQualifierRegExp(){return w||(w=new RegExp(T.Settings.scheme+":","g")),w}(),m)}static getMonikerFromUri(h){if(h.scheme!==T.Settings.scheme)throw new Error(`Invalid scheme: '${h.scheme}', expected: '${T.Settings.scheme}'`);return PathUtil.getMonikerFromRelativePath(h.path)}static getMonikerFromRelativePath(h){const m=h.indexOf("/",1);if(m<3||"~"!==h[1])return{moniker:"",relativePath:h};const y=(m>1?m:h.length)-2;return{moniker:h.substr(2,y),relativePath:h.substr(2+y)}}static getRelativePathFromPrefixedPath(h){const{moniker:m,relativePath:y}=PathUtil.getMonikerFromRelativePath(h);return"0"!==m?h:y}static getPrefixedRoot(h){return"0"!==h&&h?`/~${h}`:"/"}static replaceSchemeWithPathInLine(h,m){let y=h.replace(schemeQualifiedPathRegExp(),h=>PathUtil.convertToForwardSlashesIfNeeded(h,m));return PathUtil.replaceSchemeWithPath(y,m)}static replacePathWithScheme(h,m){(m.endsWith("/")||m.endsWith("\\"))&&(m=m.substr(0,m.length-1));let y=new RegExp(m.replace(/[\/\\]+/g,"[\\/\\\\]+"),"gi");return h.replace(y,T.Settings.scheme+":")}static replacePathWithSchemeInLine(h,m){return PathUtil.replacePathWithScheme(h,m).replace(schemeQualifiedPathRegExp(),h=>h.replace(/[\/\\]+/g,"/"))}static removeRootFromFileSystemPath(h,m){(m.endsWith("/")||m.endsWith("\\"))&&(m=m.substr(0,m.length-1));let y=new RegExp(m.replace(/[\/\\]+/g,"[\\/\\\\]+"),"gi");return h.replace(y,"")}static convertToForwardSlashes(h){return h.replace(/\\\\/g,"/").replace(/\\/g,"/")}static convertToForwardSlashesIfNeeded(h,m){return"/"===m[0]?PathUtil.convertToForwardSlashes(h):h}static removeLeadingSlash(h){return h.startsWith("/")?h.substring(1):h}static removeFinalSlash(h){return h.endsWith("/")?h.substring(0,h.length-1):h}static ensureFinalSlash(h){return h&&!h.endsWith("/")?`${h}/`:h}static normalizePath(h){return this.removeFinalSlash(this.convertToForwardSlashes(h))}static EscapeBackslash(h){return h.replace(/\\/g,"\\\\")}static removePath(h,m=""){return h.replace(/([A-Za-z]:)?(\S*[\\\/])+\S*/gi,(h,y,v,C,T)=>{if(/^\d{1,4}\/\d{1,2}\/\d{1,4}$/.test(h))return h;{const C=(y?y.length:0)+v.length,T=h.substr(C);return m+T}})}static getWorkspaceName(h){return(C.basename(h)||h).replace(/:[\\|\/]?|\\|\//g,"$")}static getPrimaryWorkspaceFileSystemPath(){if(v.workspace.workspaceFolders&&v.workspace.workspaceFolders.length)return v.workspace.workspaceFolders[0].uri.fsPath}}m.PathUtil=PathUtil},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0});const v=y(92),C=y(74),T=y(5);m.showDiagnosticErrorMessage=function showDiagnosticErrorMessage(h){v.Settings.get(C.SettingKeys.diagnosticMode)&&T.NotificationUtil.showErrorMessage(h)}},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0});const v=y(953),C=y(11),T=y(228);m.initRemoteFileSubscribe=async function initRemoteFileSubscribe(h,m,y,C,w){const A=v.subscribeOnFileUpdate(m,h=>{if(h)try{y(T.parse(h.toString()))}catch(h){null==w||w.warning("Failed to parse remote settings. "+h)}else null==w||w.verbose("Remote settings not found."),y(null)},60*(C||60)*1e3);return await A.init()},m.loadFilefromCache=async function loadFilefromCache(h,m){const v=y(401),w=C.createHash("sha256").update(h).digest("hex");let A;try{A=(await v.getCachedFile(w)).getBuffer()}catch(h){return"ENOENT"===h.code?null==m||m.verbose("Remote settings not found in local cache."):null==m||m.warning("Failed to load remote settings from local cache. "+h),null}try{return T.parse(A.toString())}catch(h){return null==m||m.warning("Failed to parse remote settings in local cache: "+h),null}}},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0});const v=y(18),C=y(7),T=y(954),w=y(5);class Paths{constructor(h){this._cache=C.join(v.tmpdir(),"remote-file-71752ccfe2464e99"),this._key=C.join(this._cache,h)}getCachePath(){return this._cache}getKeyPath(){return this._key}}class RemoteFile{constructor(h,m,y){this._date=h,this._etag=m||"",this._buffer=y||null}getDate(){return this._date}getETag(){return this._etag}getBuffer(){return this._buffer}getFileName(){return toHexString(this.getDate(),12)+"-"+this.getETag()}getFilePath(h){return C.join(h,this.getFileName())}saveFileAndClean(h){const m=new Paths(h),y=m.getKeyPath(),mkdir=h=>w.fileAccess.mkdirAsync(h).catch(()=>null);return mkdir(m.getCachePath()).then(()=>mkdir(y)).then(()=>{let h=this.getBuffer(),m="";null!=h&&(m=h),w.fileAccess.writeFileAsync(this.getFilePath(y),m)}).then(()=>w.fileAccess.readdir(y)).then(h=>h.sort().filter((h,m,y)=>m+2<y.length).reduce((h,m)=>w.fileAccess.unlinkAsync(C.join(y,m)).catch(()=>null).then(()=>h),Promise.resolve())).then(()=>this,()=>this)}}function getLatest(h){return h.reduce((h,m)=>m&&(!h||h.getDate()<m.getDate())?m:h,null)}function toHexString(h,m){return T(h.toString(16)).padLeft(m,"0").toString()}function parseFileName(h){const m=h.split("-"),y=parseInt(m[0],16),v=m[1];if(isNaN(y)||void 0===v)return null;const C=new RemoteFile(y,v);return C.getFileName()===h?C:null}function getRemoteFileList(h){return h.map(parseFileName).filter(h=>!!h)}m.RemoteFile=RemoteFile,m.getLatest=getLatest,m.toHexString=toHexString,m.parseFileName=parseFileName,m.getRemoteFileList=getRemoteFileList,m.getCachedFile=function getCachedFile(h,m,y){const v=new Paths(h).getKeyPath();return w.fileAccess.readdir(v).then(h=>{let C=getLatest(getRemoteFileList(h));return C&&null!==C?y&&C.getDate()<y||m&&C.getETag()===m?C:w.fileAccess.readFile(C.getFilePath(v)).then(h=>new RemoteFile(C.getDate(),C.getETag(),h)):Promise.reject("no file")})}},function(h,m,y){const{isArray:v}=y(229),{sort:C}=y(963),{SYMBOL_PREFIXES:T,UNDEFINED:w,symbol:A,copy_comments:P,swap_comments:k}=y(165),move_comment=(h,m,y,v,C)=>{P(h,m,y+v,y,C)},move_comments=(h,m,y,v,C,T)=>{if(C>0){let w=v;for(;w-- >0;)move_comment(h,m,y+w,C,T);return}let w=0;for(;w<v;){const v=w++;move_comment(h,m,y+v,C,T)}},remove_comments=(h,m)=>{T.forEach(y=>{const v=A(y,m);delete h[v]})};class CommentArray extends Array{splice(...h){const{length:m}=this,y=super.splice(...h);let[v,C,...T]=h;v<0&&(v+=m),C=1===arguments.length?m-v:Math.min(m-v,C);const{length:w}=T,A=v+C;return move_comments(this,this,A,m-A,w-C,!0),y}slice(...h){const{length:m}=this,y=super.slice(...h);if(!y.length)return new CommentArray;let[v,C]=h;return C===w?C=m:C<0&&(C+=m),v<0?v+=m:v===w&&(v=0),move_comments(y,this,v,C-v,-v),y}unshift(...h){const{length:m}=this,y=super.unshift(...h),{length:v}=h;return v>0&&move_comments(this,this,0,m,v,!0),y}shift(){const h=super.shift(),{length:m}=this;return remove_comments(this,0),move_comments(this,this,1,m,-1,!0),h}reverse(){return super.reverse(),(h=>{const{length:m}=h;let y=0;const v=m/2;for(;y<v;y++)k(h,y,m-y-1)})(this),this}pop(){const h=super.pop();return remove_comments(this,this.length),h}concat(...h){let{length:m}=this;const y=super.concat(...h);return h.length?(move_comments(y,this,0,this.length,0),h.forEach(h=>{const C=m;m+=v(h)?h.length:1,h instanceof CommentArray&&move_comments(y,h,0,h.length,C)}),y):y}sort(...h){const m=C(this,...h.slice(0,1)),y=Object.create(null);return m.forEach((h,m)=>{if(h===m)return;const v=((h,m)=>{let y=m;for(;y in h;)y=h[y];return y})(y,h);v!==m&&(y[m]=v,k(this,m,v))}),this}}h.exports={CommentArray:CommentArray}},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0});const v=y(18);m.getPlatform=function getPlatform(){return v.platform()}},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0});const v=y(5),C=y(166),T=y(230),w=y(160);m.assert=function assert(h,m,y){h||(C.checkDebugging(),v.traceSource.withName("Asserts").error(`Assertion Violation: ${m}`),w.ExtensionTelemetry.ReportFailedAssertion(y||m),T.showDiagnosticErrorMessage(`Assertion Violation: ${m}`))}},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0});const v=y(0),C=y(231);function findNotebookCellWithCustomMetadata(h,m,y){var C;if(!v.workspace.notebookDocuments)return;const T=v.workspace.notebookDocuments.find(m=>m.uri.toString()===h.toString());return T?null===(C=T.getCells())||void 0===C?void 0:C.find(h=>h.metadata[m]===y):void 0}function getCellId(h){var m;if(null===(m=null==h?void 0:h.metadata)||void 0===m?void 0:m.hasOwnProperty(C.NotebookConstants.cellIdPropertyName))return h.metadata[C.NotebookConstants.cellIdPropertyName]}m.findNotebookCell=function findNotebookCell(h){var m;if(v.workspace.notebookDocuments)for(let y of v.workspace.notebookDocuments){const v=null===(m=y.getCells())||void 0===m?void 0:m.find(m=>m.document.uri.path===h.path&&m.document.uri.fragment===h.fragment);if(v)return v}},m.findNotebookCellWithCustomMetadata=findNotebookCellWithCustomMetadata,m.findNotebookCellById=function findNotebookCellById(h,m){return findNotebookCellWithCustomMetadata(h,C.NotebookConstants.cellIdPropertyName,m)},m.getNotebookCellData=function getNotebookCellData(h){let m=new v.NotebookCellData(h.kind,h.document.getText(),h.document.languageId);return m.metadata=h.metadata,m},m.getCellId=getCellId,m.sortCells=function sortCells(h){h.sort((h,m)=>h.index-m.index)},m.getNotebookHash=function getNotebookHash(h){return h.map(h=>getCellId(h)).join("")}},function(h,m,y){"use strict";var v=this&&this.__awaiter||function(h,m,y,v){return new(y||(y=Promise))((function(C,T){function fulfilled(h){try{step(v.next(h))}catch(h){T(h)}}function rejected(h){try{step(v.throw(h))}catch(h){T(h)}}function step(h){h.done?C(h.value):function adopt(h){return h instanceof y?h:new y((function(m){m(h)}))}(h.value).then(fulfilled,rejected)}step((v=v.apply(h,m||[])).next())}))};Object.defineProperty(m,"__esModule",{value:!0});const C=y(0),T=y(4),w=y(17),A=y(5),P=y(25),k=y(12),R=y(2),M=y(37),N=y(232),D=y(407);m.baseWorkspaceSettings={"extensions.ignoreRecommendations":!0,"editor.detectIndentation":!0,"editor.formatOnSave":!1,"files.hotExit":"off","files.autoSave":"off","files.trimTrailingWhitespace":!1,"files.insertFinalNewline":!1,"files.trimFinalNewlines":!1,"typescript.tsc.autoDetect":"off","jake.autoDetect":"off","grunt.autoDetect":"off","gulp.autoDetect":"off","npm.autoDetect":"off","debug.allowBreakpointsEverywhere":!0,"html.autoClosingTags":!1};class JoinCommandUtilities{static finishInviteLinkJoining(h,m){return v(this,void 0,void 0,(function*(){const y=JoinCommandUtilities.getInviteLinkJoining(m);if(!y)return;const finishInviteWorkflow=()=>h.fireInviteStatusChanged(y.targetContactId,y.fromContactId,T.vsls.InviteContactStatus.None);h.hasSendMessageProvider?yield finishInviteWorkflow():new Promise(m=>{h.once(N.ContactManagerEvents.ProviderCapabilitiesChanged,()=>{h.hasSendMessageProvider&&m(null)})}).then(finishInviteWorkflow)}))}static extractLiveshareWorkspaceId(h=""){const{linkMatch:m,linkEncodedMatch:y,vscodeDevLinkMatch:v,cascadeMatch:C}=JoinCommandUtilities.getLiveshareLinkMatch(h);return m?m[3]:y?y[3]:v?v[1]:C?C[1]:void 0}static extractLiveshareLink(h=""){const{linkMatch:m,linkEncodedMatch:y,vscodeDevLinkMatch:v,cascadeMatch:C}=JoinCommandUtilities.getLiveshareLinkMatch(h);return m?`https://${m[0]}`:y?`https://${decodeURIComponent(y[0])}`:v?`https://${v[0]}`:C?C[0]:void 0}static applyGuestSettingsToWorkspace(h){return v(this,void 0,void 0,(function*(){const y=C.workspace.getConfiguration();for(const v of Object.keys(m.baseWorkspaceSettings))try{const T=y.get(v),w=m.baseWorkspaceSettings[v];w!==T&&(A.traceSource.verbose(`settingName:${v} old:${T} new:${w}`),yield y.update(v,w,h||C.ConfigurationTarget.Workspace))}catch(h){A.traceSource.info(`[applying guest workspace settings]: Failed to set the "${v}" setting on the workspace.`)}}))}static getBaseWorkspaceSettings(){return Object.assign({},m.baseWorkspaceSettings)}static showInformationMessage(h,m,...C){return v(this,void 0,void 0,(function*(){if(!m)return(yield Promise.resolve().then(()=>y(0))).window.showInformationMessage(h,...C)}))}static showWaitingForHostProgressBar(h,m,y,C){return v(this,void 0,void 0,(function*(){let T=!1;const{cancellationTokenSource:A,telemetryEvent:P}=C,k=A&&A.token;return yield h.progressNotifierUtil().create({title:"Waiting for the host to start the session..."},k,h=>v(this,void 0,void 0,(function*(){return new Promise((C,A)=>v(this,void 0,void 0,(function*(){const cancel=()=>{T=!0,P.addProperty(w.TelemetryPropertyNames.RETRY_JOIN,"True"),A(new R.CancellationError("The operation was cancelled."))};h&&(h.isCancellationRequested?cancel():h.onCancellationRequested(()=>v(this,void 0,void 0,(function*(){cancel()}))));try{const h=new Date;let v;for(h.setMinutes(h.getMinutes()+y);new Date<h&&!T;)yield R.wait(1e3),v=yield m(),v||C(!1),!0===v.isHostConnected&&C(!0);C(!1)}catch(h){A(h)}})))})))}))}static addAdditionalRootsFromFileServiceToWorkspace(h,m){const vslsUriFactory=h=>C.Uri.parse(`${k.Settings.scheme}:${h.path}`);h.listRootsAsync({enableMultipleRoots:!0}).then(h=>v(this,void 0,void 0,(function*(){try{const y=C.workspace.workspaceFolders&&C.workspace.workspaceFolders.length>0?C.workspace.workspaceFolders[0].uri:vslsUriFactory(h[0]);if(yield function ensureWorkspaceName(h,m){var y;if(C.workspace.workspaceFolders&&h&&!(C.workspace.workspaceFolders.length>0&&C.workspace.workspaceFolders[0].name===h.name)&&!(C.workspace.workspaceFolders.length<=0&&!m&&(null===(y=M.getExpService())||void 0===y?void 0:y.getTreatmentVariable("vscode","joinFailureUriOfUndefined"))))return m?D.updateWorkspaceFolders(0,C.workspace.workspaceFolders.length,{uri:m,name:h.name||P.localize("emptyWorkspace.liveShareWorkspace")}):void 0}(m,y),h.length<2)return;const v=h.slice(1).map((h,m)=>({uri:vslsUriFactory(h),name:h.friendlyName||`Workspace ${m+1}`}));if(!(yield D.updateWorkspaceFolders(1,0,...v)))throw new Error("Unable to add non-primary workspace folders")}catch(h){A.traceSource.error("Failed to update workspace folders",h)}})))}static restoreLiveshareWorkspaceState(h,m="Loading file tree..."){return v(this,void 0,void 0,(function*(){const y=C.workspace.getConfiguration();yield y.update("vsliveshare.join.reload.workspaceId",h,C.ConfigurationTarget.Workspace),yield JoinCommandUtilities.applyGuestSettingsToWorkspace();let v=`${k.Settings.scheme}:/`;yield D.updateWorkspaceFolders(0,null,{uri:C.Uri.parse(v),name:m})}))}static isLiveshareWorkspaceName(h){return"Visual Studio Live Share (Workspace)"===(null==h?void 0:h.name)}static getLiveShareWorkspaceFile(h){return v(this,void 0,void 0,(function*(){if(JoinCommandUtilities.isLiveshareWorkspaceName(h)){const m=h.workspaceFile;if(m&&"file"===m.scheme)return m.fsPath}}))}static isBrokenLiveshareWorkspaceFile(h){return JoinCommandUtilities.isLiveshareWorkspaceName(h)&&JoinCommandUtilities.isEmptyWorkspace(h)}static isEmptyWorkspace(h){return!h.workspaceFolders||0===h.workspaceFolders.length}static setInviteLinkJoining(h,m,y){var C;return v(this,void 0,void 0,(function*(){m.inviteLinkJoining&&(null===(C=y.telemetryEvent)||void 0===C||C.addProperty(w.TelemetryPropertyNames.JOIN_FROM_INVITE_LINK,"True"),yield k.Settings.saveMemento(h,m.inviteLinkJoining))}))}static getInviteLinkJoining(h){const m=k.Settings.getMemento(h);return m&&k.Settings.saveMemento(h,null),m}static getLiveshareLinkMatch(h=""){return{linkMatch:h.match(this.joinLinkRegex),linkEncodedMatch:h.match(this.joinLinkEncodedRegex),vscodeDevLinkMatch:h.match(this.vscodeDevJoinLinkRegex),cascadeMatch:h.match(this.vslsLinkRegex)}}}m.JoinCommandUtilities=JoinCommandUtilities,JoinCommandUtilities.vslsLinkRegex=new RegExp(`${k.Settings.scheme}:?.*join.*workspaceId=([0-9A-Z-]+)`,"i"),JoinCommandUtilities.joinLinkRegex=/([a-z|\-]+\.)+liveshare.*\/join(\/)?\?([0-9a-z]{36})/im,JoinCommandUtilities.joinLinkEncodedRegex=/([^\dF][a-z|\-]+\.)+liveshare.*\%2Fjoin(\%2F)?\%3F([0-9a-z]{36})/im,JoinCommandUtilities.vscodeDevJoinLinkRegex=/vscode.dev\/liveshare\/([0-9a-z]{36})/im},function(h,m,y){"use strict";var v=this&&this.__awaiter||function(h,m,y,v){return new(y||(y=Promise))((function(C,T){function fulfilled(h){try{step(v.next(h))}catch(h){T(h)}}function rejected(h){try{step(v.throw(h))}catch(h){T(h)}}function step(h){h.done?C(h.value):function adopt(h){return h instanceof y?h:new y((function(m){m(h)}))}(h.value).then(fulfilled,rejected)}step((v=v.apply(h,m||[])).next())}))};Object.defineProperty(m,"__esModule",{value:!0});const C=y(2),T=y(0);m.updateWorkspaceFolders=function updateWorkspaceFolders(h,m,...y){return v(this,void 0,void 0,(function*(){const v=new C.Signal,w=T.workspace.onDidChangeWorkspaceFolders(h=>{w.dispose(),v.resolve()});return T.workspace.updateWorkspaceFolders(h,m,...y)?(yield C.timeoutPromise(v.promise,5e3,new Error("Failed to update workspace folders")),!0):(w.dispose(),!1)}))}},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0});const v=y(69),C=y(0),T=y(12),w=y(14),A=y(24),P=y(352);m.FileSystemManager=class FileSystemManager{constructor(h,m){this.rpcServices=h,this.sessionContext=m}get workspaceProvider(){return this.provider}registerFileSystemProvider(h=!1){const m=v.gte(v.coerce(C.version),"1.23.0");if(this.providerRegistration){if(h===this.isFileSystemProviderReadOnly||!m)return;this.unregisterProvider()}else A.ExtensionUtil.context.subscriptions.push(this);this.provider||(this.provider=new P.WorkspaceProvider(this.rpcServices.workspaceService(),this.rpcServices.fileService,this.sessionContext)),this.provider.bumpGeneration(),this.providerRegistration=C.workspace.registerFileSystemProvider(T.Settings.get(w.SettingKeys.authority),this.provider,{isCaseSensitive:!0,isReadonly:h||!1}),this.isFileSystemProviderReadOnly=h}disposeWorkspaceProvider(){this.provider&&(this.provider.dispose(),this.provider=null)}dispose(){this.unregisterProvider(),this.disposeWorkspaceProvider()}unregisterProvider(){this.providerRegistration&&(this.providerRegistration.dispose(),this.providerRegistration=null)}}},function(h,m,y){"use strict";var v=this&&this.__awaiter||function(h,m,y,v){return new(y||(y=Promise))((function(C,T){function fulfilled(h){try{step(v.next(h))}catch(h){T(h)}}function rejected(h){try{step(v.throw(h))}catch(h){T(h)}}function step(h){h.done?C(h.value):function adopt(h){return h instanceof y?h:new y((function(m){m(h)}))}(h.value).then(fulfilled,rejected)}step((v=v.apply(h,m||[])).next())}))};Object.defineProperty(m,"__esModule",{value:!0});const C=y(0),T=y(4),w=y(12),A=y(15),P=y(2),k=y(234),R=y(411),M=y(413),N=y(75),D=y(63),I=y(237),x=y(61),O=y(235),L=y(412),U=y(236),B=y(8),W=y(93),q=y(17),Y=y(233),V=y(37),$=y(167);class MessageAndVersionNumber{constructor(h,m){this.message=h,this.serverVersionNumber=m}}var z,G,J;m.MessageAndVersionNumber=MessageAndVersionNumber,function(h){h[h.None=0]="None",h[h.Queue=1]="Queue",h[h.QueueAndProcess=2]="QueueAndProcess"}(z=m.CoeditingIncomingMessageBehavior||(m.CoeditingIncomingMessageBehavior={})),function(h){h[h.None=0]="None",h[h.ApplyingEdits=1]="ApplyingEdits",h[h.CapturingEdits=2]="CapturingEdits"}(G||(G={}));class PendingEdit{constructor(h,m){this.algorithmState=h,this.pendingEdit=m}}function acceptLocalChangeOnBuffer(h,m,y){m.beginRecording(),h.contentChanges.forEach(h=>{const[y,v,C]=k.CollabBuffer.convertVsCodeContentChangeToCollabChange(h,m);m.applyLocalEdit(y,v,C)});const[v,C]=m.endRecording();y.acceptLocalChange(v,C,h.trackingId)}function mapTextChangeToEditorEditForBuffer(h,m){let y,v=h.newText;const T=h.oldText,w=m.positionAt(h.oldPosition),A=m.positionAt(h.oldEnd),P=1===h.oldLength&&10===h.oldText.charCodeAt(0),k=v.length>0&&10===v.charCodeAt(v.length-1),R=v.length>1&&v.endsWith("\r\n"),M=1===h.newLength&&10===h.newText.charCodeAt(0),N=T.length>0&&10===T.charCodeAt(T.length-1);if(P&&k&&!R)y=new C.Range(w.line,w.character,w.line,w.character),v=v.substr(0,v.length-1);else if(M&&N){const T=m.positionAt(h.oldEnd-1);y=new C.Range(w.line,w.character,T.line,T.character),v=""}else y=new C.Range(w.line,w.character,A.line,A.character);return new C.TextEdit(y,v)}!function(h){h[h.Unknown=0]="Unknown",h[h.Local=1]="Local",h[h.Remote=2]="Remote"}(J||(J={}));m.VSCodeBufferManager=class VSCodeBufferManager{constructor(h,m,y,v,C=!1){this.isHost=v,this.saveSnapshots={},this.cachedHandshakes=[],this.pendingApplicationOfRemoteEdit=null,this.localChangesQueue=U.getTimedArray("localchangesqueuetime"),this.remoteMessagesQueue=U.getTimedArray("remotemessagesqueuetime"),this.highestQueuedEventId=-2,this.localToRemoteTransitions=[],this.localRedoStack=[],this.initialHistoryHighWaterMark=-1,this.performingUndo=G.None,this.lastChangeSource=J.Unknown,this.hasEverHadALocalEdit=!1,this.redoWouldRedoLocalUndo=!1,this.localUndoCount=0,this.remoteUndoCount=0,this.selectionChangedDebounce=null,this.scrollHappenedDebounce=[],this.isDisposed=!1,this.host=h,this.diagnosticTrace=C,this.collabBuffer=new k.CollabBuffer(y,h.trace),this.fileName=m,this.syncManager=new M.SyncManager;let T=this;const w=new class{constructor(){this.clientID=h.clientID,this.clientCount=h.clientCount,this.trace=h.trace}get fileName(){return T.fileName}postMessage(m){h.postMessage(m)}};this.otAlgorithm=new R.OTAlgorithm(w,this.diagnosticTrace),this.otAlgorithm.serverVersionChangedEvent.on(R.serverVersionChangedEventName,()=>{this.onServerVersionChange()}),this.pendingApplicationOfRemoteEditSignal=new P.Signal,this.pendingApplicationOfRemoteEditSignal.resolve()}get numberOfLocalUndos(){return this.localUndoCount}get numberOfRemoteUndos(){return this.remoteUndoCount}updateFileName(h){this.fileName=h}onServerVersionChange(){0===this.otAlgorithm.getOperationalTransformStatus().unacknowledgedCount&&(this.isHost?this.postHandshake():this.cachedHandshakes.push(this.makeSnapshot()))}clearLocalChangesQueue(){for(;this.localChangesQueue.length>0;)this.localChangesQueue.pop()}onDidChangeTextDocument(h){this.performingUndo>G.ApplyingEdits||(this.localChangesQueue.push(h),this.processQueuedMessages())}vscodeRangeToVslsRange(h){const m=this.toCollabOffset(h.start);return{start:m,length:this.toCollabOffset(h.end)-m}}onDidChangeTextEditorVisibleRanges(h,m,y,v,C){if(v.length<1)return;if(this.seenSelectionWithinDebouncePeriod())return void this.resetSelectionDebounce();const T=v.map(h=>this.vscodeRangeToVslsRange(h)),w=this.otAlgorithm.getOperationalTransformStatus().serverVersion,A=N.MessageFactory.LayoutScrollMessage(this.host.clientID,h,m,w,T[0].start,T[0].length,y,T);let P=setTimeout(()=>{const h=this.scrollHappenedDebounce.indexOf(P);h>-1&&this.scrollHappenedDebounce.splice(h,1),A.trackingId=C,this.host.postMessage(A)},100);this.scrollHappenedDebounce.push(P)}getEditorVisibleRanges(h){const m=h.map(h=>this.vscodeRangeToVslsRange(h));return{fileName:this.fileName,serverVersionNumber:this.otAlgorithm.getOperationalTransformStatus().serverVersion,visibleRanges:m}}clearSelectionDebounce(){null!==this.selectionChangedDebounce&&(clearTimeout(this.selectionChangedDebounce),this.selectionChangedDebounce=null)}clearScrollHappenedDebounce(){this.scrollHappenedDebounce.forEach(h=>{clearTimeout(h)}),this.scrollHappenedDebounce=[]}seenSelectionWithinDebouncePeriod(){return null!==this.selectionChangedDebounce}havePendingScrolls(){return this.scrollHappenedDebounce.length>0}resetSelectionDebounce(){this.clearSelectionDebounce(),this.clearScrollHappenedDebounce(),this.selectionChangedDebounce=setTimeout(()=>this.clearSelectionDebounce(),100)}onDidChangeTextEditorSelection(h,m,y,v,C){if(this.pendingApplicationOfRemoteEdit)return;const T=h[0],w=this.toCollabOffset(T.start),A=this.toCollabOffset(T.end)-w,P=this.otAlgorithm.getOperationalTransformStatus().serverVersion,k=N.MessageFactory.SelectionChangeMessage(this.host.clientID,m,void 0,P,w,A,T.isReversed,y,v);k.trackingId=C,this.host.postMessage(k),this.resetSelectionDebounce()}onIncomingMessage(h,m,y=z.QueueAndProcess){m<=this.highestQueuedEventId||(this.host.trace.verbose(`Queueing remote message for ${A.TraceFormat.formatPath(this.fileName)}`),this.highestQueuedEventId=m,this.remoteMessagesQueue.push(new MessageAndVersionNumber(h,m)),y===z.Queue||this.performingUndo||this.processQueuedMessages())}toVSCodeDocumentPos(h){const m=this.collabBuffer.positionAt(h);return new C.Position(m.line,m.character)}toCollabOffset(h){const m=new k.CollabBufferPosition(h.line,h.character);return this.collabBuffer.offsetAt(m)}getBufferManagerStatus(){let h=this.otAlgorithm.getOperationalTransformStatus();return{serverVersion:h.serverVersion,unacknowledgedCount:h.unacknowledgedCount,waitingForRemoteEditsToBeApplied:!!this.pendingApplicationOfRemoteEdit,localChangesQueue:this.localChangesQueue.length,remoteMessagesQueue:this.remoteMessagesQueue.length,collabBufferText:this.collabBuffer.getContent()}}getCurrentHistory(){return this.otAlgorithm.getCurrentHistory().map(h=>({message:h.Message||void 0,serverVersionNumber:h.serverVersionNumber}))}initializeHistory(h){const m=h.history||[],y=[new L.ServerVersion(h.startServerVersionNumber||-1,null)];m.forEach(m=>{const v=m.serverVersionNumber;if(v<=(h.savedVersionNumber||0))return y.push(new L.ServerVersion(v,m.message)),void(this.highestQueuedEventId=v);v>this.initialHistoryHighWaterMark&&(this.initialHistoryHighWaterMark=v);const C=N.MessageFactory.CoauthoringMessage(m.message);this.onIncomingMessage(C,v,z.Queue)}),this.otAlgorithm.setInitialHistory(y)}updateInitialHistoryHighWatermark(h){this.initialHistoryHighWaterMark>h||(this.initialHistoryHighWaterMark=h)}undoLastLocalEdit(){if(this.host.trace.verbose(`Undo: Received Local Undo Request for ${A.TraceFormat.formatPath(this.fileName)}`),this.performingUndo)return this.host.trace.verbose("Undo: Already performing undo, not handling this undo"),!0;if(this.lastChangeSource===J.Local&&this.localToRemoteTransitions.length<1||this.lastChangeSource===J.Unknown&&0===this.localToRemoteTransitions.length)return this.localUndoCount++,this.redoWouldRedoLocalUndo=!0,this.host.trace.verbose(`Undo: Last change was local, let editor handle. Source: ${this.lastChangeSource}, Count: ${this.localToRemoteTransitions.length}`),!1;if(!this.hasEverHadALocalEdit)return this.host.trace.verbose("Undo: No local edits ever seen, with remote edits, nothing to undo"),!0;if(this.lastChangeSource===J.Local&&this.localToRemoteTransitions.length>0)return this.host.trace.verbose("Undo: Last edit was local, performing undo to update transitions"),this.performingUndo=G.ApplyingEdits,this.redoWouldRedoLocalUndo=!0,this.localUndoCount++,this.host.performSingleUndo().then(()=>{this.performingUndo=G.None;const h=this.localToRemoteTransitions[this.localToRemoteTransitions.length-1];this.collabBuffer.getContent()===h.beforeTransitionToLocal?(this.host.trace.verbose("Undo: Reached state of last remote edit. Updating status"),h.beforeTransitionToLocal=null,this.lastChangeSource=J.Remote,this.hasEverHadALocalEdit=h.hadLocalEdits):this.host.trace.verbose("Undo: Editor undo complete, but still more that could be undo")}),!0;D.assert(this.localToRemoteTransitions.length>0,"No local changes, but no transitions");let h,m,y,v,C,T=this.localToRemoteTransitions.length,w=this.localToRemoteTransitions[this.localToRemoteTransitions.length-1];if(!w.beforeTransitionToRemote)return!0;this.performingUndo=G.CapturingEdits,this.remoteUndoCount++,this.collabBuffer.startCapturingEditsFromUndoing(),this.host.trace.verbose("Undo: Rolling back buffer to before the last remote edit");const P=[];let M,I;return this.host.undoBufferToMatchContents(w.beforeTransitionToRemote).then(h=>(I=h,this.host.performSingleUndo())).then(m=>{h=m.edits,y=m.contents,D.assert(this.localToRemoteTransitions.length===T,"Didn't expect transitions while we were undoing"),this.localToRemoteTransitions.pop();let v=this.localToRemoteTransitions.length>0?this.localToRemoteTransitions[this.localToRemoteTransitions.length-1]:null;const C=y===I;return v&&v.beforeTransitionToLocal!==y&&(this.host.trace.verbose("Undo: Still more local undos; updating state"),w.beforeTransitionToRemote=y,this.localToRemoteTransitions.push(w)),this.localToRemoteTransitions.length<1&&(this.host.trace.verbose("Undo: No more local-remote states changes, cleaning up"),this.lastChangeSource=J.Remote,this.localToRemoteTransitions.push({beforeTransitionToRemote:y,hadLocalEdits:!C}),this.hasEverHadALocalEdit=!C),this.host.performSingleRedo()}).then(y=>{v=new k.CollabBuffer(y,this.host.trace);const T=this,w=new class{constructor(){this.clientID=1,this.clientCount=T.host.clientCount,this.trace=T.host.trace}get fileName(){return T.fileName}postMessage(h){P.push(h)}};return C=new R.OTAlgorithm(w,this.diagnosticTrace),m=h.reduce((h,m)=>{const[y,C,T]=k.CollabBuffer.convertVsCodeContentChangeToCollabChange(m,v),w=v.convertCollabufferChangeToITextChange(y,C,T);return O.compressConsecutiveTextChanges(h,[w])},[]),this.host.redoUntilNoMoreToRedo(I,h=>acceptLocalChangeOnBuffer(h,v,C))}).then(()=>{P.forEach((h,m)=>{C.acceptTextChangeAcknowledge(h,m)});const h=m.map(h=>N.MessageFactory.TextChange(h.oldPosition,h.oldLength,h.newText));let y=N.MessageFactory.TextChangeMessage(2,this.fileName,void 0,-1,h);y=C.TransformMessageToCurrent(y);const T=C.transformMessageToEdits(v.getMaximumOffset(),y),w=v.transformEditsToTextChanges(T),A=w.map(h=>mapTextChangeToEditorEditForBuffer(h,v));return M=w.map(h=>N.MessageFactory.TextChange(h.newPosition,h.newLength,h.oldText)),this.performingUndo=G.ApplyingEdits,this.host.applyEdit(A)}).then(()=>{const h=this.otAlgorithm.getOperationalTransformStatus().serverVersion;this.localRedoStack.push({redoChanges:M,serverVersion:h}),this.host.trace.verbose("Undo: Local undo complete"),this.performingUndo=G.None},h=>{B.Telemetry.sendFault(q.TelemetryEventNames.UNDO_FAILURE,B.FaultType.Error,"Failure to apply a local undo with remote edits",h),this.performingUndo=G.None}),!0}redoLastLocalEdit(){if(this.lastChangeSource===J.Local||this.redoWouldRedoLocalUndo)return!1;if(!w.featureFlags.localRedo)return!0;if(this.localRedoStack.length<1)return!0;D.assert(this.localRedoStack.length>0,"We don't have any items to redo");const h=this.localRedoStack.pop();let m=N.MessageFactory.TextChangeMessage(-1,this.fileName,void 0,h.serverVersion,h.redoChanges);m=this.otAlgorithm.TransformMessageToCurrent(m);const y=this.otAlgorithm.transformMessageToEdits(this.collabBuffer.getMaximumOffset(),m),v=this.collabBuffer.transformEditsToTextChanges(y).map(h=>mapTextChangeToEditorEditForBuffer(h,this.collabBuffer));return this.performingUndo=G.ApplyingEdits,this.host.applyEdit(v).then(()=>this.performingUndo=G.None,h=>{B.Telemetry.sendFault(q.TelemetryEventNames.REDO_FAILURE,B.FaultType.Error,"Failure to apply a local redo with remote edits",h),this.performingUndo=G.None}),!0}clearUndoStateDueToDocumentClosing(){this.localRedoStack.length=0,this.localToRemoteTransitions.length=0,this.hasEverHadALocalEdit=!1,this.host.trace.verbose(`Undo: Clearing Local Undo State due to document close: ${A.TraceFormat.formatPath(this.fileName)}`),this.lastChangeSource=J.Remote,this.localToRemoteTransitions.push({hadLocalEdits:this.hasEverHadALocalEdit,beforeTransitionToRemote:this.collabBuffer.getContent()})}takeSnapshot(){const h=this.makeSnapshot();this.saveSnapshots[h.hashCode]=h}getSavedSnapshotOrFallback(h){if(this.saveSnapshots[h])return this.saveSnapshots[h];const m=this.makeSnapshot();return m.fallbackText=this.collabBuffer.getContent(),m}makeSnapshot(){const h=this.collabBuffer.getContent(),m=this.otAlgorithm.getOperationalTransformStatus();return{changes:m.unacknowledged.map(h=>h.rollbackEdits).reverse(),hasUnacknowledgedChanges:m.unacknowledgedCount>0,hashCode:I.calculateFileHash(h),serverVersionNumber:m.serverVersion}}checkSync(){this.host.trace.verbose(`checkSync for ${A.TraceFormat.formatPath(this.fileName)}`),this.host.checkSync(this.collabBuffer.getContent())}recordSyncedState(){const h=this.makeSnapshot();this.isHost?this.syncManager.recordSnapshot(h):h.hasUnacknowledgedChanges||this.host.checkHostSync(h.serverVersionNumber,h.hashCode)}processQueuedMessages(){if(this.isDisposed)return;if(null!==this.pendingApplicationOfRemoteEdit)return void this.host.trace.verbose("Skipping step due to pending edit");this.diagnosticTrace&&(D.logger.logTrace(this.host.trace,"step"),D.logger.indent(),D.logger.logTrace(this.host.trace,"before local changes - collabbuffer: "+D.colorize.cyan(JSON.stringify(this.collabBuffer.getContent()))));const h=this.localChangesQueue.length>0;for(;this.localChangesQueue.length>0;){let h=this.localChangesQueue.shift();this._acceptLocalChange(h)}h&&this.checkSync(),this.diagnosticTrace&&D.logger.logTrace(this.host.trace,"after localchanges - collabbuffer: "+D.colorize.cyan(JSON.stringify(this.collabBuffer.getContent())));let m=!0;for(;this.remoteMessagesQueue.length>0&&m;){const h=this.remoteMessagesQueue[0],y=h.message.clientId,v=h.message.messageType;if(void 0!==y)switch(v){case T.vsls.MessageType.TextChange:m=this._handleTextChangeMessage(y,h);continue;case T.vsls.MessageType.SelectionChange:try{this._handleSelectionChangeMessageIfMostRecent(y,h)}catch(h){throw this.host.trace.error(`Error handling selection change in file: ${A.TraceFormat.formatPath(this.fileName)}`),h}break;default:const C=`Unexpected message type in buffer manager (${A.TraceFormat.formatPath(this.fileName)}): ${v}`;this.host.trace.error(C),this.remoteMessagesQueue.shift(),D.assert(!1,C)}else this.host.trace.error(`Message ${v} is missing client ID.`)}this.diagnosticTrace&&D.logger.unindent()}_handleTextChangeMessage(h,m){return h===this.host.clientID?(this.host.trace.verbose(`Received text change acknowledge for ${A.TraceFormat.formatPath(this.fileName)}`),this.remoteMessagesQueue.shift(),this.otAlgorithm.acceptTextChangeAcknowledge(m.message,m.serverVersionNumber),this.recordSyncedState(),!0):(this._beginApplyingRemoteChange(m.message,m.serverVersionNumber),!1)}_handleSelectionChangeMessageIfMostRecent(h,m){let y=!1;for(let m=1;m<this.remoteMessagesQueue.length;++m){const v=this.remoteMessagesQueue[m].message;if(v.clientId===h){y=v.messageType===T.vsls.MessageType.SelectionChange;break}}if(!y){const h=this.transformSelectionToCurrent(m.message);this.host.updateClientPosition(h)}this.remoteMessagesQueue.shift()}_acceptLocalChange(h){this.host.trace.verbose(`_acceptLocalChange for ${A.TraceFormat.formatPath(this.fileName)}`),this.lastChangeSource!==J.Remote||this.performingUndo||(this.host.trace.verbose(`Undo: Transitioning to local for ${A.TraceFormat.formatPath(this.fileName)}`),this.localToRemoteTransitions[this.localToRemoteTransitions.length-1].beforeTransitionToLocal=this.collabBuffer.getContent()),this.performingUndo||(this.hasEverHadALocalEdit=!0,this.lastChangeSource=J.Local,this.redoWouldRedoLocalUndo=!1,this.localRedoStack.length=0),acceptLocalChangeOnBuffer(h,this.collabBuffer,this.otAlgorithm)}_beginApplyingRemoteChange(h,m){this.host.trace.verbose(`_beginApplyingRemoteChange for ${A.TraceFormat.formatPath(this.fileName)}`);let y=-1;if(this.lastChangeSource!==J.Remote){D.assert(!this.performingUndo,"Shouldn't see remote changes while undoing"),this.host.trace.verbose(`Undo: Transitioning to Remote for ${A.TraceFormat.formatPath(this.fileName)}`);const h=m>this.initialHistoryHighWaterMark?this.collabBuffer.getContent():null;y=this.localToRemoteTransitions.push({beforeTransitionToRemote:h,hadLocalEdits:this.hasEverHadALocalEdit})}let v=this.lastChangeSource;this.lastChangeSource=J.Remote,this.redoWouldRedoLocalUndo=!1;let C=this.otAlgorithm.saveState();this.collabBuffer.beginRecording(),this.otAlgorithm.acceptRemoteChange(this.collabBuffer,h,m);let[T]=this.collabBuffer.endRecording();if(T=T.filter(h=>!(0===h.newLength&&0===h.oldLength)),0===T.length)return this.remoteMessagesQueue.shift(),void this.processQueuedMessages();this.host.trace.verbose(`Rolling back changes made by OT to the collab buffer for ${A.TraceFormat.formatPath(this.fileName)}`),this.collabBuffer.applyRemoteEdits(T.map(h=>({position:h.newPosition,length:h.newLength,text:h.oldText})));let w=T.map(h=>mapTextChangeToEditorEditForBuffer(h,this.collabBuffer));this.diagnosticTrace&&(D.logger.logTrace(this.host.trace,"sending edit request to ext host: "+JSON.stringify(T)),D.logger.logTrace(this.host.trace,"sending edit request to ext host: "+JSON.stringify(w))),this.pendingApplicationOfRemoteEdit=new PendingEdit(C,T),this.pendingApplicationOfRemoteEditSignal=new P.Signal,this.host.applyEdit(w,h.trackingId).then(h=>{if(this.pendingApplicationOfRemoteEditSignal.resolve(),!this.isDisposed)return h===Y.ApplyEditResult.FAILED?(W.CoauthoringTelemetry.ReportCoeditingError("Failed to apply edits"),void this._finishApplyingRemoteChangeFail(v,y)):void this._finishApplyingRemoteChangeOK(h)},h=>{this.pendingApplicationOfRemoteEditSignal.resolve(),this.isDisposed||(this.host.trace.warning("Error while applying edits"),W.CoauthoringTelemetry.ReportCoeditingError("Error while applying edits",h),this._finishApplyingRemoteChangeFail(v,y))})}_finishApplyingRemoteChangeOK(h){return v(this,void 0,void 0,(function*(){if(this.host.trace.verbose(`_finishApplyingRemoteChangeOK for ${A.TraceFormat.formatPath(this.fileName)}`),D.assert(1===this.localChangesQueue.length,`expected a single local change caused by my own edit, but got ${this.localChangesQueue.length}`),this.localChangesQueue.shift(),this.remoteMessagesQueue.shift(),this.host.trace.verbose(`Applying remote edits to collab buffer for ${A.TraceFormat.formatPath(this.fileName)}`),this.collabBuffer.applyRemoteEdits(this.pendingApplicationOfRemoteEdit.pendingEdit.map(h=>({position:h.oldPosition,length:h.oldLength,text:h.newText}))),h===Y.ApplyEditResult.MODIFIED)try{yield this.host.resync()}catch(h){D.assert(!1,"Resync should complete successfully")}this.pendingApplicationOfRemoteEdit=null,0===this.localChangesQueue.length&&this.checkSync(),this.recordSyncedState(),this.processQueuedMessages()}))}_finishApplyingRemoteChangeFail(h,m){this.host.trace.info(`Applying edits to main buffer failed for ${A.TraceFormat.formatPath(this.fileName)}`);let y=this.pendingApplicationOfRemoteEdit;this.pendingApplicationOfRemoteEdit=null,m>-1&&m===this.localToRemoteTransitions.length-1&&this.lastChangeSource!==h&&(this.localToRemoteTransitions.pop(),this.lastChangeSource=h),this.otAlgorithm.loadState(y.algorithmState),this.processQueuedMessages()}transformRangeToCurrent(h,m,y,v,C){const T=N.MessageFactory.TextChange(C.start,C.length,""),w=N.MessageFactory.TextChangeMessage(h,m,y,v,[T]),A=this.otAlgorithm.TransformMessageToCurrent(w);return{start:A.changes&&A.changes[0].start||0,length:A.changes&&A.changes[0].length||0,changeServerVersion:A.changeServerVersion}}transformSelectionToCurrent(h){const m=this.transformRangeToCurrent(h.clientId,h.fileName,h.fileVersion,h.serverVersionNumber,{start:h.start,length:h.length});return N.MessageFactory.SelectionChangeMessage(h.clientId,h.fileName,h.fileVersion,m.changeServerVersion,m.start,m.length,h.isReversed,h.kind,h.forceJumpForClientId)}transformVisibleRangesToCurrent(h,m){const y=m.visibleRanges.map(y=>this.transformRangeToCurrent(h,m.fileName,void 0,m.serverVersionNumber,y));return{fileName:m.fileName,serverVersionNumber:m.serverVersionNumber,visibleRanges:y}}remoteQueueContainsSelectionChange(){return this.remoteMessagesQueue.some(h=>h.message.messageType===T.vsls.MessageType.SelectionChange)}transformScrollSelectionToCurrent(h){if(this.remoteQueueContainsSelectionChange())return null;const m=this.transformRangeToCurrent(h.clientId,h.fileName,h.fileVersion,h.serverVersionNumber,{start:h.start,length:h.length}),y=(h.visibleRanges||[]).map(m=>this.transformRangeToCurrent(h.clientId,h.fileName,h.fileVersion,h.serverVersionNumber,m));return N.MessageFactory.LayoutScrollMessage(h.clientId,h.fileName,h.fileVersion,m.changeServerVersion,m.start,m.length,h.editorId,y)}postHandshake(){const h=this.makeSnapshot(),m=N.MessageFactory.HandshakeMessage(this.host.clientID,this.fileName,h.hashCode,h.serverVersionNumber);this.host.postMessage(m)}isFileSyncedForVersion(h,m){return this.syncManager.isFileSyncedForVersion(h,m)}onHandshake(h){for(let m=0;m<this.cachedHandshakes.length;m++){const y=this.cachedHandshakes[m];if(y.serverVersionNumber===h.serverVersionNumber){this.cachedHandshakes.splice(0,m+1),this.compareHandshake(h,y);break}if(void 0!==h.serverVersionNumber&&y.serverVersionNumber>h.serverVersionNumber){this.cachedHandshakes.splice(0,m);break}}}compareHandshake(h,m){return v(this,void 0,void 0,(function*(){if(h.hashCode!==m.hashCode){const h=this.fileName.split("."),m=h.length>1?h.pop():"NA",y=x.PathUtil.getMonikerFromRelativePath(this.fileName).moniker||"None";W.CoauthoringTelemetry.ReportDesync(W.DesyncReason.Unknown,m,y),D.assert(!1,"Document out of sync with the host - handshake does not match")}}))}dispose(){return v(this,void 0,void 0,(function*(){this.isDisposed=!0,this.pendingApplicationOfRemoteEditSignal.isResolved||V.getExpService().getTreatmentVariable($.TreatmentVariables.VSCodeConfig,$.TreatmentVariables.WaitForPendingEditOnDispose)&&(yield this.pendingApplicationOfRemoteEditSignal.promise)}))}}},function(h,m,y){"use strict";function toUint32(h){return h<0?0:h>4294967295?4294967295:0|h}Object.defineProperty(m,"__esModule",{value:!0});class PrefixSumIndexOfResult{constructor(h,m){this.index=h,this.remainder=m}}m.PrefixSumIndexOfResult=PrefixSumIndexOfResult;m.PrefixSumComputer=class PrefixSumComputer{constructor(h){this.values=h,this.prefixSum=new Uint32Array(h.length),this.prefixSumValidIndex=new Int32Array(1),this.prefixSumValidIndex[0]=-1}getCount(){return this.values.length}insertValues(h,m){h=toUint32(h);const y=this.values,v=this.prefixSum,C=m.length;return 0!==C&&(this.values=new Uint32Array(y.length+C),this.values.set(y.subarray(0,h),0),this.values.set(y.subarray(h),h+C),this.values.set(m,h),h-1<this.prefixSumValidIndex[0]&&(this.prefixSumValidIndex[0]=h-1),this.prefixSum=new Uint32Array(this.values.length),this.prefixSumValidIndex[0]>=0&&this.prefixSum.set(v.subarray(0,this.prefixSumValidIndex[0]+1)),!0)}changeValue(h,m){return h=toUint32(h),m=toUint32(m),this.values[h]!==m&&(this.values[h]=m,h-1<this.prefixSumValidIndex[0]&&(this.prefixSumValidIndex[0]=h-1),!0)}removeValues(h,m){h=toUint32(h),m=toUint32(m);const y=this.values,v=this.prefixSum;if(h>=y.length)return!1;let C=y.length-h;return m>=C&&(m=C),0!==m&&(this.values=new Uint32Array(y.length-m),this.values.set(y.subarray(0,h),0),this.values.set(y.subarray(h+m),h),this.prefixSum=new Uint32Array(this.values.length),h-1<this.prefixSumValidIndex[0]&&(this.prefixSumValidIndex[0]=h-1),this.prefixSumValidIndex[0]>=0&&this.prefixSum.set(v.subarray(0,this.prefixSumValidIndex[0]+1)),!0)}getTotalValue(){return 0===this.values.length?0:this._getAccumulatedValue(this.values.length-1)}getAccumulatedValue(h){return h<0?0:(h=toUint32(h),this._getAccumulatedValue(h))}_getAccumulatedValue(h){if(h<=this.prefixSumValidIndex[0])return this.prefixSum[h];let m=this.prefixSumValidIndex[0]+1;0===m&&(this.prefixSum[0]=this.values[0],m++),h>=this.values.length&&(h=this.values.length-1);for(let y=m;y<=h;y++)this.prefixSum[y]=this.prefixSum[y-1]+this.values[y];return this.prefixSumValidIndex[0]=Math.max(this.prefixSumValidIndex[0],h),this.prefixSum[h]}getIndexOf(h){h=Math.floor(h),this.getTotalValue();let m=0,y=this.values.length-1,v=0,C=0;for(;m<=y;){v=m+(y-m)/2|0;const T=this.prefixSum[v];if(C=T-this.values[v],h<C)y=v-1;else{if(!(h>=T))break;m=v+1}}return new PrefixSumIndexOfResult(v,h-C)}}},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0});const v=y(75),C=y(412),T=y(63),w=y(13),A=y(236);class Edit{constructor(h,m,y){this.position=h,this.length=m,this.text=y}}m.Edit=Edit;class OTAlgorithmStatus{constructor(h,m){this.serverVersion=h,this.unacknowledged=m,this.unacknowledgedCount=m.length}}m.OTAlgorithmStatus=OTAlgorithmStatus;class OTAlgorithmState{constructor(h,m){this.currentServerVersionNumber=h,this.unacknowledgedChanges=m}}m.OTAlgorithmState=OTAlgorithmState,m.serverVersionChangedEventName="serverVersionChanged";class OTAlgorithm{constructor(h,m){this.unacknowledgedChanges=A.getTimedArray("unacknowledgedchangestime"),this.serverVersionChangedEvent=new w.EventEmitter,this.host=h,this.diagnosticTrace=m;const y=new class{constructor(){this.trace=h.trace}get fileName(){return h.fileName}};this.transformManager=new C.TransformManager(y)}getOperationalTransformStatus(){return new OTAlgorithmStatus(this.transformManager.CurrentServerVersionNumber,this.unacknowledgedChanges)}getCurrentHistory(){return this.transformManager.CurrentHistory}setInitialHistory(h){this.transformManager.setInitialHistory(h)}saveState(){let h=this.transformManager.CurrentServerVersionNumber,m=[];for(let h=0;h<this.unacknowledgedChanges.length;++h)m.push(this.unacknowledgedChanges[h].clone());return new OTAlgorithmState(h,m)}loadState(h){this.transformManager.RollbackTo(h.currentServerVersionNumber),A.setArray(this.unacknowledgedChanges,h.unacknowledgedChanges)}acceptLocalChange(h,m,y){this.diagnosticTrace&&(T.logger.log(`acceptOriginalBufferChange: ${JSON.stringify(h)}`),T.logger.indent());let C=OTAlgorithm._toTextChangeArr(m),w=v.MessageFactory.TextChangeMessage(this.host.clientID,this.host.fileName,void 0,this.transformManager.CurrentServerVersionNumber,C);w.trackingId=y,this.unacknowledgedChanges.push(new UnacknowledgedChange(w,h)),this.host.postMessage(w),this.diagnosticTrace&&T.logger.unindent()}acceptRemoteChange(h,y,v){if(this.host.trace.verbose("OTAlgorithm.acceptRemoteChange"),this.diagnosticTrace&&(T.logger.log(`acceptRemoteChange: ${JSON.stringify(y)}`),T.logger.indent()),T.assert(y.clientId!==this.host.clientID,"Changes must be from a remote client"),y.clientId===this.host.clientID)return void(this.diagnosticTrace&&T.logger.unindent());this.diagnosticTrace&&(T.logger.log("beginning to undo unacknowledged changes."),T.logger.indent());for(let m=this.unacknowledgedChanges.length-1;m>=0;--m)this.host.trace.verbose("Undoing unacknowledged change so we can apply remote change"),this._applyUndoChangeOnBuffer(h,this.unacknowledgedChanges[m].previousVersion);this.diagnosticTrace&&(T.logger.unindent(),T.logger.log("finished undo of unacknowledged changes."),T.logger.log("beginning to apply server message."),T.logger.indent());let C=this.transformManager.TransformMessageToCurrent(y);this.host.trace.verbose("OTAlgorithm applying remote change to buffer"),this._applyOperationOnBuffer(h,C),this.transformManager.AddToServersionHistory(v,y,C),this.diagnosticTrace&&(T.logger.unindent(),T.logger.log("finished applying server message."),T.logger.log("beginning to redo unacknowledged changes."),T.logger.indent());for(let m=0;m<this.unacknowledgedChanges.length;++m){let y=this.unacknowledgedChanges[m].message,C=this.transformManager.TransformMessageToCurrent(y);this.host.trace.verbose("Redoing unacknowledged change");let T=this._applyOperationOnBuffer(h,C);this.unacknowledgedChanges[m].previousVersion=T,this.transformManager.AddToServersionHistory(++v,y,C)}this.transformManager.RemoveUnacknowledgedChangesFromServerVersionHistory(this.unacknowledgedChanges.length),this.diagnosticTrace&&(T.logger.unindent(),T.logger.log("finished redo of unacknowledged changes."),T.logger.unindent()),this.serverVersionChangedEvent.emit(m.serverVersionChangedEventName)}_applyUndoChangeOnBuffer(h,m){let y=new Array(m.length);for(let h=0;h<m.length;++h){let v=m[h];y[h]=new Edit(v.newPosition,v.newLength,v.oldText)}h.applyRemoteEdits(y)}transformMessageToEdits(h,m){if(T.assert(m.changeServerVersion===this.transformManager.CurrentServerVersionNumber,"Cannot apply change on buffer due to different contexts."),m.changeServerVersion!==this.transformManager.CurrentServerVersionNumber)return[];const y=m.changes||[];let v=new Array(y.length),C=-1,w=-1;for(let m=0;m<y.length;++m){let A=y[m],P=A.start,k=A.start+A.length;{let h=Math.max(w,P),m=Math.max(w,k);h===P&&m===k||(this.diagnosticTrace&&T.logger.log(T.colorize.red("warning")+`: overlapping edits: position: ${P}, length: ${k-P} has been clamped to position: ${h}, length: ${m-h}`),P=h,k=m)}{let m=Math.min(Math.max(0,P),h),y=Math.min(Math.max(m,k),h);m===P&&y===k||(this.diagnosticTrace&&T.logger.log(T.colorize.red("warning")+`: edit out of bounds: position: ${P}, length: ${k-P} has been clamped to position: ${m}, length: ${y-m}`),P=m,k=y)}C=P,w=k,v[m]=new Edit(P,k-P,A.newText||"")}return v}_applyOperationOnBuffer(h,m){const y=this.transformMessageToEdits(h.getMaximumOffset(),m);return h.applyRemoteEdits(y)}acceptTextChangeAcknowledge(h,y){this.diagnosticTrace&&(T.logger.log("acceptTextChangeAcknowledge"),T.logger.indent());try{if(T.assert(h.clientId===this.host.clientID,"Changes must a change we initiated"),h.clientId!==this.host.clientID)return;let v=this.unacknowledgedChanges[0];this.unacknowledgedChanges.splice(0,1),this.transformManager.AddToServersionHistory(y,v.message),this.serverVersionChangedEvent.emit(m.serverVersionChangedEventName)}finally{this.diagnosticTrace&&T.logger.unindent()}}TransformMessageToCurrent(h){return this.transformManager.TransformMessageToCurrent(h)}static _toTextChangeArr(h){let m=new Array(h.length);for(let y=h.length-1;y>=0;--y){let C=h[y];m[y]=v.MessageFactory.TextChange(C.oldPosition,C.oldLength,C.newText)}return m}}m.OTAlgorithm=OTAlgorithm;class UnacknowledgedChange{constructor(h,m){this.message=h,this.previousVersion=m,this.rollbackEdits=new Array(m.length);for(let h=0;h<m.length;++h){let y=m[h];this.rollbackEdits[h]=v.MessageFactory.TextChange(y.newPosition,y.newLength,y.oldText)}}clone(){return new UnacknowledgedChange(this.message,this.previousVersion)}}m.UnacknowledgedChange=UnacknowledgedChange},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0});const v=y(15),C=y(75),T=y(63);class TransformManager{constructor(h){this.serverVersionHistory=new Array,this.host=h,this.serverVersionHistory.push(new ServerVersion(-1,null))}AddToServersionHistory(h,m,y){let v=new ServerVersion(h,m);y&&m.changeServerVersion!==y.changeServerVersion&&v.AddMessage(y),this.serverVersionHistory.push(v)}RemoveUnacknowledgedChangesFromServerVersionHistory(h){this.serverVersionHistory.splice(this.serverVersionHistory.length-h,h)}RollbackTo(h){for(let m=this.serverVersionHistory.length-1;m>=0;--m)if(this.serverVersionHistory[m].serverVersionNumber===h)return void this.serverVersionHistory.splice(m+1);T.assert(!1,"Failed to find version number to remove")}get CurrentServerVersionNumber(){return this.serverVersionHistory[this.serverVersionHistory.length-1].serverVersionNumber}get CurrentHistory(){return this.serverVersionHistory.map(h=>h.clone())}setInitialHistory(h){const m=h[h.length-1].serverVersionNumber;1===this.serverVersionHistory.length&&-1===this.serverVersionHistory[0].serverVersionNumber?(this.serverVersionHistory=h,this.host.trace.info(`Setting initial history for ${v.TraceFormat.formatPath(this.host.fileName)} (server version: ${m})`)):this.host.trace.warning(`Attempted to overwrite history for ${v.TraceFormat.formatPath(this.host.fileName)} with ${m} (current: ${this.CurrentServerVersionNumber})`)}TransformMessageToCurrent(h){return this.TransformMessageToVersionWithMessageIndex(h,this.CurrentServerVersionNumber,this.serverVersionHistory.length)}static TrackForwardAcrossChange(h,m){return TransformManager.TrackForwardAcrossChangeWithAdjustment(h,new PositionAdjustment,m)}static TrackForwardAcrossChangeWithAdjustment(h,m,y){let v=0;for(let C=0;C<y.length;++C){let T=y[C];if(void 0===T.start||void 0===T.length)continue;const w=T.newText||"";if(T.start+T.length>=h&&C>=m.nextChangeIndex){T.start<h&&(h=T.start+w.length);break}v+=w.length-T.length}return h+=v+m.offset}static TrackBackwardAcrossChange(h,m){return TransformManager.TrackBackwardAcrossChangeWithAdjustment(h,new PositionAdjustment,m)}static TrackBackwardAcrossChangeWithAdjustment(h,m,y){for(m.offset=0,m.nextChangeIndex=-1;++m.nextChangeIndex<y.length;){let v=y[m.nextChangeIndex];if(void 0===v.start||void 0===v.length)continue;const C=v.newText||"";if(v.start+C.length>=h){v.start<h&&(m.offset=h-v.start,h=v.start);break}h-=C.length-v.length}return h}TransformMessageIndexToVersion(h,m){let y=this.serverVersionHistory[m].GetBestMessage(h);if(y.changeServerVersion===h)return y;let v=this.TransformMessageToVersionWithMessageIndex(y,h,m);return this.serverVersionHistory[m].AddMessage(v),v}TransformMessageToVersionWithMessageIndex(h,m,y){if(T.assert(void 0!==h.changeServerVersion&&m>=h.changeServerVersion,`Can't translate messages to prior to their creation. Target: ${m}, Message: ${h.changeServerVersion}`),void 0!==h.changeServerVersion&&m<h.changeServerVersion)return h;let v=this.serverVersionHistory.length-1;for(let h=v;h>=0;--h){if(this.serverVersionHistory[h].serverVersionNumber===m){v=h;break}}let w=!1,A=v+1;for(let m=v;m>=0;--m){let y=this.serverVersionHistory[m];if(y.serverVersionNumber===h.changeServerVersion){A=m+1;break}w=w||y.Message&&y.Message.clientId!==h.clientId||!1}if(A>v)return h;if(!w)return C.MessageFactory.TextChangeMessage(h.clientId,h.fileName,h.fileVersion,m,h.changes);let P=[];for(let m of h.changes||[])P.push(C.MessageFactory.TextChange(m.start,m.length,m.newText));let k=null,R=y>v?y-1:v;for(let m=R;m>=A;--m){let y=this.serverVersionHistory[m];if(y.Message&&y.Message.clientId===h.clientId){if(null===k){k=[];for(let h=0;h<this.serverVersionHistory.length;++h){k.push([]);for(let m=0;m<P.length;++m)k[h][m]=new SpanAdjustment}}if(void 0===h.changeServerVersion)throw new Error("Message is missing change server version.");let y=this.TransformMessageIndexToVersion(h.changeServerVersion,m);if(y.changes)for(let h=0;h<P.length;++h){let v=P[h];if(void 0===v.start||void 0===v.length){T.assert(!1,"Text change has undefined start or length.");continue}let C=TransformManager.TrackBackwardAcrossChangeWithAdjustment(v.start,k[m][h].start,y.changes||[]),w=TransformManager.TrackBackwardAcrossChangeWithAdjustment(v.start+v.length,k[m][h].end,y.changes||[]);T.assert(C>=0,"start must be positive"),T.assert(w>=C,"end must not come before start"),v.start=C,v.length=w-C}}}let M=h.changeServerVersion;for(let m=A;m<=R;++m){let y=this.serverVersionHistory[m];if(void 0!==M&&(m<=v||y.Message&&y.Message.clientId===h.clientId)){let h=this.TransformMessageIndexToVersion(M,m);if(!h.changes)continue;for(let y=0;y<P.length;++y){let v=P[y];if(void 0===v.start||void 0===v.length){T.assert(!1,"Text change has undefined start or length.");continue}let C=v.start,w=v.start+v.length;null===k?(C=TransformManager.TrackForwardAcrossChange(C,h.changes),w=TransformManager.TrackForwardAcrossChange(w,h.changes)):(C=TransformManager.TrackForwardAcrossChangeWithAdjustment(C,k[m][y].start,h.changes),w=TransformManager.TrackForwardAcrossChangeWithAdjustment(w,k[m][y].end,h.changes)),T.assert(C>=0,"start must be positive"),T.assert(w>=C,"end must not come before start"),v.start=C,v.length=w-C}m<=v&&(M=y.serverVersionNumber)}}return C.MessageFactory.TextChangeMessage(h.clientId,h.fileName,void 0,M,P)}}m.TransformManager=TransformManager;class SpanAdjustment{constructor(){this.start=new PositionAdjustment,this.end=new PositionAdjustment}}class PositionAdjustment{constructor(){this.offset=0,this.nextChangeIndex=0}}class ServerVersion{constructor(h,m){this.serverVersionNumber=h,Array.isArray(m)?this.messages=m:this.messages=[m]}get Message(){return this.messages[0]}clone(){const h=this.messages.map(h=>h?C.MessageFactory.CoauthoringMessage(h):h);return new ServerVersion(this.serverVersionNumber,h)}GetBestMessage(h){for(let m=this.messages.length-1;m>=0;--m){let y=this.messages[m];if(y&&void 0!==y.changeServerVersion&&y.changeServerVersion<=h)return y}throw new Error("Invalid message server version.")}AddMessage(h){for(let m=this.messages.length-1;m>=0;--m){let y=this.messages[m];if(y&&void 0!==h.changeServerVersion&&void 0!==y.changeServerVersion&&h.changeServerVersion>=y.changeServerVersion)return T.assert(h.changeServerVersion!==y.changeServerVersion,"Should never try to insert a message we have"),T.assert(h.clientId===y.clientId,"Client IDs should never change"),void this.messages.splice(m+1,0,h)}T.assert(!1,"Never should try to insert a new version before index 0")}}m.ServerVersion=ServerVersion},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0});m.SyncManager=class SyncManager{constructor(){this.snapshots=new Map,this.snapshotsQueue=[],this.pendingSyncChecks=new Map}recordSnapshot(h){if(this.pendingSyncChecks.has(h.serverVersionNumber)){const m=this.pendingSyncChecks.get(h.serverVersionNumber);m.resolve(!!h.hasUnacknowledgedChanges||h.hashCode===m.hashCode),this.pendingSyncChecks.delete(h.serverVersionNumber)}this.snapshots.set(h.serverVersionNumber,h.hasUnacknowledgedChanges?void 0:h.hashCode),this.snapshotsQueue.push(h.serverVersionNumber),this.trimBlessedStates()}trimBlessedStates(){if(!(this.snapshotsQueue.length<2e4)){for(let h=0;h<1e4;h++)this.snapshots.delete(this.snapshotsQueue[h]);this.snapshotsQueue.splice(0,1e4)}}isFileSyncedForVersion(h,m){if(this.snapshots.has(h)){const y=this.snapshots.get(h);return Promise.resolve(void 0===y||y===m)}if(this.pendingSyncChecks.has(h))return this.pendingSyncChecks.get(h).result;let y;const v=new Promise((h,m)=>{y=h});return this.pendingSyncChecks.set(h,{hashCode:m,resolve:y,result:v}),v}}},function(h,m,y){var v=y(976),C=y(977),T={};for(var w in v)v.hasOwnProperty(w)&&(T[v[w]]=w);var A=h.exports={to:{},get:{}};function clamp(h,m,y){return Math.min(Math.max(m,h),y)}function hexDouble(h){var m=h.toString(16).toUpperCase();return m.length<2?"0"+m:m}A.get=function(h){var m,y;switch(h.substring(0,3).toLowerCase()){case"hsl":m=A.get.hsl(h),y="hsl";break;case"hwb":m=A.get.hwb(h),y="hwb";break;default:m=A.get.rgb(h),y="rgb"}return m?{model:y,value:m}:null},A.get.rgb=function(h){if(!h)return null;var m,y,C,T=[0,0,0,1];if(m=h.match(/^#([a-f0-9]{6})([a-f0-9]{2})?$/i)){for(C=m[2],m=m[1],y=0;y<3;y++){var w=2*y;T[y]=parseInt(m.slice(w,w+2),16)}C&&(T[3]=Math.round(parseInt(C,16)/255*100)/100)}else if(m=h.match(/^#([a-f0-9]{3,4})$/i)){for(C=(m=m[1])[3],y=0;y<3;y++)T[y]=parseInt(m[y]+m[y],16);C&&(T[3]=Math.round(parseInt(C+C,16)/255*100)/100)}else if(m=h.match(/^rgba?\(\s*([+-]?\d+)\s*,\s*([+-]?\d+)\s*,\s*([+-]?\d+)\s*(?:,\s*([+-]?[\d\.]+)\s*)?\)$/)){for(y=0;y<3;y++)T[y]=parseInt(m[y+1],0);m[4]&&(T[3]=parseFloat(m[4]))}else{if(!(m=h.match(/^rgba?\(\s*([+-]?[\d\.]+)\%\s*,\s*([+-]?[\d\.]+)\%\s*,\s*([+-]?[\d\.]+)\%\s*(?:,\s*([+-]?[\d\.]+)\s*)?\)$/)))return(m=h.match(/(\D+)/))?"transparent"===m[1]?[0,0,0,0]:(T=v[m[1]])?(T[3]=1,T):null:null;for(y=0;y<3;y++)T[y]=Math.round(2.55*parseFloat(m[y+1]));m[4]&&(T[3]=parseFloat(m[4]))}for(y=0;y<3;y++)T[y]=clamp(T[y],0,255);return T[3]=clamp(T[3],0,1),T},A.get.hsl=function(h){if(!h)return null;var m=h.match(/^hsla?\(\s*([+-]?(?:\d*\.)?\d+)(?:deg)?\s*,\s*([+-]?[\d\.]+)%\s*,\s*([+-]?[\d\.]+)%\s*(?:,\s*([+-]?[\d\.]+)\s*)?\)$/);if(m){var y=parseFloat(m[4]);return[(parseFloat(m[1])+360)%360,clamp(parseFloat(m[2]),0,100),clamp(parseFloat(m[3]),0,100),clamp(isNaN(y)?1:y,0,1)]}return null},A.get.hwb=function(h){if(!h)return null;var m=h.match(/^hwb\(\s*([+-]?\d*[\.]?\d+)(?:deg)?\s*,\s*([+-]?[\d\.]+)%\s*,\s*([+-]?[\d\.]+)%\s*(?:,\s*([+-]?[\d\.]+)\s*)?\)$/);if(m){var y=parseFloat(m[4]);return[(parseFloat(m[1])%360+360)%360,clamp(parseFloat(m[2]),0,100),clamp(parseFloat(m[3]),0,100),clamp(isNaN(y)?1:y,0,1)]}return null},A.to.hex=function(){var h=C(arguments);return"#"+hexDouble(h[0])+hexDouble(h[1])+hexDouble(h[2])+(h[3]<1?hexDouble(Math.round(255*h[3])):"")},A.to.rgb=function(){var h=C(arguments);return h.length<4||1===h[3]?"rgb("+Math.round(h[0])+", "+Math.round(h[1])+", "+Math.round(h[2])+")":"rgba("+Math.round(h[0])+", "+Math.round(h[1])+", "+Math.round(h[2])+", "+h[3]+")"},A.to.rgb.percent=function(){var h=C(arguments),m=Math.round(h[0]/255*100),y=Math.round(h[1]/255*100),v=Math.round(h[2]/255*100);return h.length<4||1===h[3]?"rgb("+m+"%, "+y+"%, "+v+"%)":"rgba("+m+"%, "+y+"%, "+v+"%, "+h[3]+")"},A.to.hsl=function(){var h=C(arguments);return h.length<4||1===h[3]?"hsl("+h[0]+", "+h[1]+"%, "+h[2]+"%)":"hsla("+h[0]+", "+h[1]+"%, "+h[2]+"%, "+h[3]+")"},A.to.hwb=function(){var h=C(arguments),m="";return h.length>=4&&1!==h[3]&&(m=", "+h[3]),"hwb("+h[0]+", "+h[1]+"%, "+h[2]+"%"+m+")"},A.to.keyword=function(h){return T[h.slice(0,3)]}},function(h,m,y){"use strict";var v=this&&this.__awaiter||function(h,m,y,v){return new(y||(y=Promise))((function(C,T){function fulfilled(h){try{step(v.next(h))}catch(h){T(h)}}function rejected(h){try{step(v.throw(h))}catch(h){T(h)}}function step(h){h.done?C(h.value):new y((function(m){m(h.value)})).then(fulfilled,rejected)}step((v=v.apply(h,m||[])).next())}))},C=this&&this.__generator||function(h,m){var y,v,C,T={label:0,sent:function(){if(1&C[0])throw C[1];return C[1]},trys:[],ops:[]};return{next:verb(0),throw:verb(1),return:verb(2)};function verb(w){return function(A){return function step(w){if(y)throw new TypeError("Generator is already executing.");for(;T;)try{if(y=1,v&&(C=v[2&w[0]?"return":w[0]?"throw":"next"])&&!(C=C.call(v,w[1])).done)return C;switch(v=0,C&&(w=[0,C.value]),w[0]){case 0:case 1:C=w;break;case 4:return T.label++,{value:w[1],done:!1};case 5:T.label++,v=w[1],w=[0];continue;case 7:w=T.ops.pop(),T.trys.pop();continue;default:if(!(C=T.trys,(C=C.length>0&&C[C.length-1])||6!==w[0]&&2!==w[0])){T=0;continue}if(3===w[0]&&(!C||w[1]>C[0]&&w[1]<C[3])){T.label=w[1];break}if(6===w[0]&&T.label<C[1]){T.label=C[1],C=w;break}if(C&&T.label<C[2]){T.label=C[2],T.ops.push(w);break}C[2]&&T.ops.pop(),T.trys.pop();continue}w=m.call(h,T)}catch(h){w=[6,h],v=0}finally{y=C=0}if(5&w[0])throw w[1];return{value:w[0]?w[1]:void 0,done:!0}}([w,A])}}};m.__esModule=!0;var T=function(){function Semaphore(h){this.promiseResolverQueue=[],this.permits=h}return Semaphore.prototype.getPermits=function(){return this.permits},Semaphore.prototype.wait=function(){return v(this,void 0,void 0,(function(){var h=this;return C(this,(function(m){return this.permits>0?(this.permits-=1,[2,Promise.resolve(!0)]):[2,new Promise((function(m){return h.promiseResolverQueue.push(m)}))]}))}))},Semaphore.prototype.acquire=function(){return v(this,void 0,void 0,(function(){return C(this,(function(h){return[2,this.wait()]}))}))},Semaphore.prototype.waitFor=function(h){return v(this,void 0,void 0,(function(){var m,y,v=this;return C(this,(function(C){return this.permits>0?(this.permits-=1,[2,Promise.resolve(!0)]):(m=function(h){},y=new Promise((function(h){m=h})),this.promiseResolverQueue.push(m),setTimeout((function(){var h=v.promiseResolverQueue.indexOf(m);-1!==h&&v.promiseResolverQueue.splice(h,1),m(!1)}),h),[2,y])}))}))},Semaphore.prototype.tryAcquire=function(){return this.permits>0&&(this.permits-=1,!0)},Semaphore.prototype.drainPermits=function(){if(this.permits>0){var h=this.permits;return this.permits=0,h}return 0},Semaphore.prototype.signal=function(){if(this.permits+=1,this.permits>1&&this.promiseResolverQueue.length>0)throw new Error("this.permits should never be > 0 when there is someone waiting.");if(1===this.permits&&this.promiseResolverQueue.length>0){this.permits-=1;var h=this.promiseResolverQueue.shift();h&&h(!0)}},Semaphore.prototype.release=function(){this.signal()},Semaphore.prototype.execute=function(h){return v(this,void 0,void 0,(function(){return C(this,(function(m){switch(m.label){case 0:return[4,this.wait()];case 1:m.sent(),m.label=2;case 2:return m.trys.push([2,,4,5]),[4,h()];case 3:return[2,m.sent()];case 4:return this.signal(),[7];case 5:return[2]}}))}))},Semaphore}();m.default=T},function(h,m,y){"use strict";var v=y(7),C=y(992),T=new(y(417))({max:50,maxAge:3e4});h.exports=function resolveCommand(h,m){var y;if(m=!!m,y=T.get(h+"!"+m),T.has(h))return T.get(h);try{y=m?C.sync(h,{pathExt:v.delimiter+(process.env.PATHEXT||"")}):C.sync(h)}catch(h){}return T.set(h+"!"+m,y),y}},function(h,m,y){"use strict";h.exports=LRUCache;var v,C=y(996),T=y(10),w=y(998),A=(v="function"==typeof Symbol&&"1"!==process.env._nodeLRUCacheForceNoSymbol?function(h){return Symbol(h)}:function(h){return"_"+h})("max"),P=v("length"),k=v("lengthCalculator"),R=v("allowStale"),M=v("maxAge"),N=v("dispose"),D=v("noDisposeOnSet"),I=v("lruList"),x=v("cache");function naiveLength(){return 1}function LRUCache(h){if(!(this instanceof LRUCache))return new LRUCache(h);"number"==typeof h&&(h={max:h}),h||(h={});var m=this[A]=h.max;(!m||"number"!=typeof m||m<=0)&&(this[A]=1/0);var y=h.length||naiveLength;"function"!=typeof y&&(y=naiveLength),this[k]=y,this[R]=h.stale||!1,this[M]=h.maxAge||0,this[N]=h.dispose,this[D]=h.noDisposeOnSet||!1,this.reset()}function forEachStep(h,m,y,v){var C=y.value;isStale(h,C)&&(del(h,y),h[R]||(C=void 0)),C&&m.call(v,C.value,C.key,h)}function get(h,m,y){var v=h[x].get(m);if(v){var C=v.value;isStale(h,C)?(del(h,v),h[R]||(C=void 0)):y&&h[I].unshiftNode(v),C&&(C=C.value)}return C}function isStale(h,m){if(!m||!m.maxAge&&!h[M])return!1;var y=Date.now()-m.now;return m.maxAge?y>m.maxAge:h[M]&&y>h[M]}function trim(h){if(h[P]>h[A])for(var m=h[I].tail;h[P]>h[A]&&null!==m;){var y=m.prev;del(h,m),m=y}}function del(h,m){if(m){var y=m.value;h[N]&&h[N](y.key,y.value),h[P]-=y.length,h[x].delete(y.key),h[I].removeNode(m)}}function Entry(h,m,y,v,C){this.key=h,this.value=m,this.length=y,this.now=v,this.maxAge=C||0}Object.defineProperty(LRUCache.prototype,"max",{set:function(h){(!h||"number"!=typeof h||h<=0)&&(h=1/0),this[A]=h,trim(this)},get:function(){return this[A]},enumerable:!0}),Object.defineProperty(LRUCache.prototype,"allowStale",{set:function(h){this[R]=!!h},get:function(){return this[R]},enumerable:!0}),Object.defineProperty(LRUCache.prototype,"maxAge",{set:function(h){(!h||"number"!=typeof h||h<0)&&(h=0),this[M]=h,trim(this)},get:function(){return this[M]},enumerable:!0}),Object.defineProperty(LRUCache.prototype,"lengthCalculator",{set:function(h){"function"!=typeof h&&(h=naiveLength),h!==this[k]&&(this[k]=h,this[P]=0,this[I].forEach((function(h){h.length=this[k](h.value,h.key),this[P]+=h.length}),this)),trim(this)},get:function(){return this[k]},enumerable:!0}),Object.defineProperty(LRUCache.prototype,"length",{get:function(){return this[P]},enumerable:!0}),Object.defineProperty(LRUCache.prototype,"itemCount",{get:function(){return this[I].length},enumerable:!0}),LRUCache.prototype.rforEach=function(h,m){m=m||this;for(var y=this[I].tail;null!==y;){var v=y.prev;forEachStep(this,h,y,m),y=v}},LRUCache.prototype.forEach=function(h,m){m=m||this;for(var y=this[I].head;null!==y;){var v=y.next;forEachStep(this,h,y,m),y=v}},LRUCache.prototype.keys=function(){return this[I].toArray().map((function(h){return h.key}),this)},LRUCache.prototype.values=function(){return this[I].toArray().map((function(h){return h.value}),this)},LRUCache.prototype.reset=function(){this[N]&&this[I]&&this[I].length&&this[I].forEach((function(h){this[N](h.key,h.value)}),this),this[x]=new C,this[I]=new w,this[P]=0},LRUCache.prototype.dump=function(){return this[I].map((function(h){if(!isStale(this,h))return{k:h.key,v:h.value,e:h.now+(h.maxAge||0)}}),this).toArray().filter((function(h){return h}))},LRUCache.prototype.dumpLru=function(){return this[I]},LRUCache.prototype.inspect=function(h,m){var y="LRUCache {",v=!1;this[R]&&(y+="\n  allowStale: true",v=!0);var C=this[A];C&&C!==1/0&&(v&&(y+=","),y+="\n  max: "+T.inspect(C,m),v=!0);var w=this[M];w&&(v&&(y+=","),y+="\n  maxAge: "+T.inspect(w,m),v=!0);var N=this[k];N&&N!==naiveLength&&(v&&(y+=","),y+="\n  length: "+T.inspect(this[P],m),v=!0);var D=!1;return this[I].forEach((function(h){D?y+=",\n  ":(v&&(y+=",\n"),D=!0,y+="\n  ");var C=T.inspect(h.key).split("\n").join("\n  "),A={value:h.value};h.maxAge!==w&&(A.maxAge=h.maxAge),N!==naiveLength&&(A.length=h.length),isStale(this,h)&&(A.stale=!0),A=T.inspect(A,m).split("\n").join("\n  "),y+=C+" => "+A})),(D||v)&&(y+="\n"),y+="}"},LRUCache.prototype.set=function(h,m,y){var v=(y=y||this[M])?Date.now():0,C=this[k](m,h);if(this[x].has(h)){if(C>this[A])return del(this,this[x].get(h)),!1;var T=this[x].get(h).value;return this[N]&&(this[D]||this[N](h,T.value)),T.now=v,T.maxAge=y,T.value=m,this[P]+=C-T.length,T.length=C,this.get(h),trim(this),!0}var w=new Entry(h,m,C,v,y);return w.length>this[A]?(this[N]&&this[N](h,m),!1):(this[P]+=w.length,this[I].unshift(w),this[x].set(h,this[I].head),trim(this),!0)},LRUCache.prototype.has=function(h){return!!this[x].has(h)&&!isStale(this,this[x].get(h).value)},LRUCache.prototype.get=function(h){return get(this,h,!0)},LRUCache.prototype.peek=function(h){return get(this,h,!1)},LRUCache.prototype.pop=function(){var h=this[I].tail;return h?(del(this,h),h.value):null},LRUCache.prototype.del=function(h){del(this,this[x].get(h))},LRUCache.prototype.load=function(h){this.reset();for(var m=Date.now(),y=h.length-1;y>=0;y--){var v=h[y],C=v.e||0;if(0===C)this.set(v.k,v.v);else{var T=C-m;T>0&&this.set(v.k,v.v,T)}}},LRUCache.prototype.prune=function(){var h=this;this[x].forEach((function(m,y){get(h,y,!1)}))}},function(h,m,y){"use strict";h.exports=function escapeArgument(h,m){return h=""+h,h=m?'"'+(h=(h=h.replace(/(\\*)"/g,'$1$1\\"')).replace(/(\\*)$/,"$1$1"))+'"':h.replace(/([()%!^<>&|;,"'\s])/g,"^$1")}},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0});class CancellationError extends Error{constructor(h,m){super(...arguments),this.code=m}}m.CancellationError=CancellationError},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0});const v=y(1032);m.defaultStrategy=new v.AADv2Strategy,m.registeredStrategies=[m.defaultStrategy]},function(h,m,y){"use strict";var v=this&&this.__awaiter||function(h,m,y,v){return new(y||(y=Promise))((function(C,T){function fulfilled(h){try{step(v.next(h))}catch(h){T(h)}}function rejected(h){try{step(v.throw(h))}catch(h){T(h)}}function step(h){h.done?C(h.value):function adopt(h){return h instanceof y?h:new y((function(m){m(h)}))}(h.value).then(fulfilled,rejected)}step((v=v.apply(h,m||[])).next())}))},C=this&&this.__importDefault||function(h){return h&&h.__esModule?h:{default:h}};Object.defineProperty(m,"__esModule",{value:!0});const T=C(y(163));m.fetchPost=(h,m,y)=>v(void 0,void 0,void 0,(function*(){let v={"Content-Type":"application/x-www-form-urlencoded"};if(y&&(v=Object.assign(Object.assign({},v),y)),"undefined"!=typeof fetch){const y=yield fetch(h,{method:"POST",headers:v,body:m});return yield y.json()}return(yield T.default(h,{method:"POST",headers:v,data:m,proxy:!1})).data}))},function(h,m,y){"use strict";var v=this&&this.__awaiter||function(h,m,y,v){return new(y||(y=Promise))((function(C,T){function fulfilled(h){try{step(v.next(h))}catch(h){T(h)}}function rejected(h){try{step(v.throw(h))}catch(h){T(h)}}function step(h){h.done?C(h.value):function adopt(h){return h instanceof y?h:new y((function(m){m(h)}))}(h.value).then(fulfilled,rejected)}step((v=v.apply(h,m||[])).next())}))};Object.defineProperty(m,"__esModule",{value:!0});const C=y(0),T=y(1041);m.getRedirectUri=function getRedirectUri(h){return v(this,void 0,void 0,(function*(){if(T.isFunction(C.env.createAppUri)){return(yield C.env.createAppUri()).with({path:"/signin"})}if(!C.env.uriScheme)throw new Error("No `vscode.env.uriScheme` set.");const m=C.Uri.parse(`${C.env.uriScheme}://${h}/signin`);if(T.isFunction(C.env.asExternalUri)){return(yield C.env.asExternalUri(m)).with({fragment:""})}return m}))}},function(h,m,y){"use strict";var v=this&&this.__awaiter||function(h,m,y,v){return new(y||(y=Promise))((function(C,T){function fulfilled(h){try{step(v.next(h))}catch(h){T(h)}}function rejected(h){try{step(v.throw(h))}catch(h){T(h)}}function step(h){h.done?C(h.value):function adopt(h){return h instanceof y?h:new y((function(m){m(h)}))}(h.value).then(fulfilled,rejected)}step((v=v.apply(h,m||[])).next())}))};Object.defineProperty(m,"__esModule",{value:!0});const C=y(1042),T=C.getKeytar();m.keytarService=new class Keytar{constructor(){this.createAccessTokenKey=h=>`${h}.accessToken`,this.getAccessTokenFromKeytar=h=>v(this,void 0,void 0,(function*(){try{return yield this.keytarModule.getPassword("VS Code Account",this.createAccessTokenKey(h.name))}catch(h){}})),this.storeAccessTokenToKeytar=(h,m)=>v(this,void 0,void 0,(function*(){try{yield this.deleteAccessTokenFromKeytar(h),yield this.keytarModule.setPassword("VS Code Account",this.createAccessTokenKey(h.name),m)}catch(h){console.log(h)}})),this.deleteAccessTokenFromKeytar=h=>v(this,void 0,void 0,(function*(){try{yield this.keytarModule.deletePassword("VS Code Account",this.createAccessTokenKey(h.name))}catch(h){console.log(h)}}))}get keytarModule(){if(!this.keytarInternal)throw new Error("Please call `init` method first to pass the keytar module.");return this.keytarInternal}init(h){this.keytarInternal=h||T}getRefreshTokenFromkeytar(h){return v(this,void 0,void 0,(function*(){if(this.keytarModule)try{return yield this.keytarModule.getPassword("VS Code Account",h.name)}catch(h){}}))}storeRefreshTokenToKeytar(h,m){return v(this,void 0,void 0,(function*(){if(this.keytarModule)try{yield this.deleteRefreshTokenFromKeytar(h),yield this.keytarModule.setPassword("VS Code Account",h.name,m)}catch(h){}}))}deleteRefreshTokenFromKeytar(h){return v(this,void 0,void 0,(function*(){if(this.keytarModule)try{yield this.keytarModule.deletePassword("VS Code Account",h.name)}catch(h){}}))}}},function(h,m,y){"use strict";var v=this&&this.__awaiter||function(h,m,y,v){return new(y||(y=Promise))((function(C,T){function fulfilled(h){try{step(v.next(h))}catch(h){T(h)}}function rejected(h){try{step(v.throw(h))}catch(h){T(h)}}function step(h){h.done?C(h.value):function adopt(h){return h instanceof y?h:new y((function(m){m(h)}))}(h.value).then(fulfilled,rejected)}step((v=v.apply(h,m||[])).next())}))};Object.defineProperty(m,"__esModule",{value:!0});const C=y(11),T=y(0),w=y(173),A=y(20),P=y(12),k=y(14),R=y(62),M=y(96),N=y(2);m.LiveShareStrategyBase=class LiveShareStrategyBase{constructor(){this.name="LiveShare",this.publicName="Github",this.endpointUrl=()=>{const h=P.Settings.getUri(k.SettingKeys.serviceUri);return A.format(h)},this.authRequestIdToStrategyInfoMap=new Map,this.minExpiration=7200,this.onTokenUpdateEmitter=new T.EventEmitter,this.onTokenUpdated=this.onTokenUpdateEmitter.event,this.getAccessToken=()=>v(this,void 0,void 0,(function*(){const h=C.randomBytes(16).toString("base64").replace(/[^\w\s]/gi,""),m=yield this.getRedirectUri(),y=new URLSearchParams(m.query).get("state")||h,v=this.getSignInUrl(),w=T.Uri.parse(v),A=decodeURIComponent(m.toString()),P=new URLSearchParams([["redirect",A],["state",y],["extensionId",y],["nonce",h]]),k=new N.Signal,R={strategy:this,redirect_uri:A,signal:k};this.authRequestIdToStrategyInfoMap.set(y,R);const M=`${w}?${P.toString()}`;return yield T.env.openExternal(T.Uri.parse(M)),yield k.promise})),this.exchangeAuthorizationCode=h=>v(this,void 0,void 0,(function*(){const m=yield M.auth.API.fetchPost(`${this.endpointUrl()}auth/token/`,JSON.stringify({grant_type:"urn:ietf:params:oauth:grant-type:user_code",user_code:h}),{"Content-Type":"application/json"});if(m.error_description)throw new Error(m.error_description);return this.parseTokenPayloadFromAccessToken(m.access_token)})),this.parseTokenPayloadFromAccessToken=h=>{const m=1e3*w(h).exp;return new Date(m).getTime()-Date.now()<1e3*this.minExpiration?null:{accessToken:h,expiresOn:m,tokenType:"vsls",strategy:this}}}signalNewToken(h){this.onTokenUpdateEmitter.fire(h)}getRedirectUri(){return M.auth.API.getRedirectUri(R.LIVESHARE_EXTENSION_ID)}getSignInUrl(){return`${this.endpointUrl()}auth/identity/github/`}receiveProtocolHandlerCallback(h){return v(this,void 0,void 0,(function*(){const m=new URLSearchParams(h.query),y=m.get("extensionId");if(!y)return!1;const v=decodeURIComponent(y),C=this.authRequestIdToStrategyInfoMap.get(v);if(!C)return!1;if(m.get("error"))return C.signal.resolve(null),!0;const T=m.get("userCode");if(!T)return C.signal.reject(new Error("No code query param found.")),!0;const w=yield this.exchangeAuthorizationCode(T);return C.signal.resolve(w),!0}))}refreshToken(h){return v(this,void 0,void 0,(function*(){return this.parseTokenPayloadFromAccessToken(h)}))}}},function(h,m,y){"use strict";var v=this&&this.__awaiter||function(h,m,y,v){return new(y||(y=Promise))((function(C,T){function fulfilled(h){try{step(v.next(h))}catch(h){T(h)}}function rejected(h){try{step(v.throw(h))}catch(h){T(h)}}function step(h){h.done?C(h.value):function adopt(h){return h instanceof y?h:new y((function(m){m(h)}))}(h.value).then(fulfilled,rejected)}step((v=v.apply(h,m||[])).next())}))};Object.defineProperty(m,"__esModule",{value:!0});const C=y(0),T=y(34),w=y(1051),A=y(1052);m.methodDecoratorsFactory=h=>({errorNotificationMethodDecorator:function errorNotificationMethodDecorator(m,y,v){return function(C,T,A){return BindingHelper.bindCommandDecorator(C=>w.errorNotificationCommandDecoratorFactory(C,h,y,m,!1,v),C,T,A)}},telemetryMethodDecorator:function telemetryMethodDecorator(m,y,v,C,T){return function(w,P,k){return BindingHelper.bindCommandDecorator(w=>A.telemetryCommandDecoratorFactory(w,h,m,y,v,C,T),w,P,k)}},controllerDecorator:function controllerDecorator(m){return function ControllerMixin(m){return class extends m{constructor(){super(...arguments),this.commandContextBuilder=h.commandContextBuilder(),this.bindingContext=m.bindingContext,this.commandRegistrations=[]}registerCommands(){this.bindingContext.commandBindings.forEach(h=>{const y=this.bindingContext.commandAdaptors.get(h.methodName),v=C.commands.registerCommand(h.commandName,(...v)=>{const C=new y(this),T=this.commandContextBuilder.build(C,h.commandName,m.name);return C.invoke(v,T)},this);this.commandRegistrations.push(v)})}unregisterCommands(){this.commandRegistrations.splice(0).forEach(h=>h.dispose())}}}(m)}}),m.commandBindingDecorator=function commandBindingDecorator(h){return function(m,y,v){BindingHelper.bindCommand(h,m,y,v)}};class BindingContext{constructor(){this.commandAdaptors=new Map,this.commandBindings=[]}}class BindingHelper{static getBindingContext(h){return h.constructor.bindingContext||(h.constructor.bindingContext=new BindingContext),h.constructor.bindingContext}static bindCommand(h,m,y,v){const C=BindingHelper.getBindingContext(m);C.commandBindings.push({commandName:h,methodName:y,descriptor:v}),BindingHelper.getOrCreateCommandAdapter(C,y,v)}static getOrCreateCommandAdapter(h,m,y){let C=h.commandAdaptors.get(m);if(!C){if("function"==typeof y.value)C=class CommandMethodAdapter{constructor(h){this.controller=h}invoke(h,m){return v(this,void 0,void 0,(function*(){yield y.value.apply(this.controller,h)}))}};else{if("function"!=typeof y.get)throw new Error("Unsupported command binding.");C=class CommandMethodAdapter{constructor(h){this.controller=h}invoke(h,m){return v(this,void 0,void 0,(function*(){yield y.get.apply(this.controller,h)}))}}}h.commandAdaptors.set(m,C)}return C}static bindCommandDecorator(h,m,y,v){const C=BindingHelper.getBindingContext(m),w=BindingHelper.getOrCreateCommandAdapter(C,y,v),A=T.DecoratorHelper.setupDecorator(h)(w);return C.commandAdaptors.set(y,A),v}}m.ControllerHelper=class ControllerHelper{static register(h,m){if(!h.registerCommands||!h.unregisterCommands)throw new Error(h.constructor.name+" is not a command controller.");h.registerCommands();const y=new C.Disposable(()=>{h.unregisterCommands()});return m&&m.push(y),y}}},function(h,m,y){"use strict";var v=this&&this.__awaiter||function(h,m,y,v){return new(y||(y=Promise))((function(C,T){function fulfilled(h){try{step(v.next(h))}catch(h){T(h)}}function rejected(h){try{step(v.throw(h))}catch(h){T(h)}}function step(h){h.done?C(h.value):function adopt(h){return h instanceof y?h:new y((function(m){m(h)}))}(h.value).then(fulfilled,rejected)}step((v=v.apply(h,m||[])).next())}))};Object.defineProperty(m,"__esModule",{value:!0});const C=y(5),T=y(240),w=y(16),A=y(2),P=y(241),k=y(24),R=y(8);m.ErrorNotificationCommandDecorator=class ErrorNotificationCommandDecorator{constructor(h,m,y,v,C,T,w,A){this.command=h,this.next=m,this.telemetry=y,this.telemetryFaultEventName=v,this.title=C,this.isModalError=T,this.onError=w,this.onNoErrorMessage=A}invoke(h,m){return v(this,void 0,void 0,(function*(){const{cancellationTokenSource:y}=m;let v;m.commandName=this.title;try{v=yield this.next.invoke(h,m)}catch(v){try{let R;v.code&&(R=k.ExtensionUtil.getErrorString(v.code)),this.onNoErrorMessage&&(R=yield this.onNoErrorMessage(v,m,h)),R||(R=v.message);const M=`${m.commandName}: ${R}`;v instanceof A.CancellationError&&y&&!y.token.isCancellationRequested&&y.cancel();const N=v instanceof T.UserError||v instanceof A.CancellationError;v.isSuppressUserNotification||v instanceof A.CancellationError&&!v.message||v instanceof w.RpcConnectionShutdownError||(N?C.NotificationUtil.showInformationMessage(M,!1):v instanceof A.ByDesignError?yield C.NotificationUtil.showErrorMessage(M,{modal:this.isModalError}):v instanceof P.NonBlockingError||(yield C.NotificationUtil.showErrorMessage(M,{modal:this.isModalError})))}catch(h){v=h}if(v&&!v.hasRecorded){const h=`${m.commandName}: [unhandled exception (decorator)] ${v.message}`;m.trace.error(h),this.telemetry.sendFault(this.telemetryFaultEventName,R.FaultType.Error,h,v)}v&&this.onError&&(yield this.onError(v,m,h))}return v}))}}},function(h,m,y){"use strict";var v=this&&this.__awaiter||function(h,m,y,v){return new(y||(y=Promise))((function(C,T){function fulfilled(h){try{step(v.next(h))}catch(h){T(h)}}function rejected(h){try{step(v.throw(h))}catch(h){T(h)}}function step(h){h.done?C(h.value):function adopt(h){return h instanceof y?h:new y((function(m){m(h)}))}(h.value).then(fulfilled,rejected)}step((v=v.apply(h,m||[])).next())}))};Object.defineProperty(m,"__esModule",{value:!0});const C=y(4),T=y(242),w=y(17),A=y(8);m.TelemetryCommandDecorator=class TelemetryCommandDecorator{constructor(h,m,y,v,C,T,w,A,P){this.command=h,this.next=m,this.workspaceService=y,this.telemetry=v,this.telemetryEventName=C,this.telemetryFaultEventName=T,this.telemetryTitle=w,this.telemetryEventVersion=A,this.onError=P}invoke(h,m){return v(this,void 0,void 0,(function*(){let y=void 0,v=void 0,C=this.telemetry.startTimedEvent(this.telemetryEventName),P=A.TelemetryResult.Success,k=void 0;m.telemetryEvent=C,this.telemetry.setCorrelationEvent(C),C.addProperty(w.TelemetryPropertyNames.COMMAND_TEXT,m.commandText),C.addMeasure(w.TelemetryPropertyNames.TELEMETRY_EVENT_VERSION,this.telemetryEventVersion),this.addInvocationTelemetryProperties(C,h.telemetryProperties),this.workspaceService.onProgressUpdated(h=>this.onWorkspaceProgressUpdated(h,C));try{y=yield this.next.invoke(h,m),C.addProperty(w.TelemetryPropertyNames.EVENT_RESULT,A.TelemetryResult.Success)}catch(y){P=T.TelemetryUtil.DeriveTelemetryResult(y);const A=/\S*(key|token|sig|password|passwd|pwd)[="':\s]+\S*/g;let R=y.message;if(A.test(R.toLowerCase())){let h=A.exec(R);R=R.replaceAll(h,"")}throw k=T.TelemetryUtil.BuildTelemetryMessage(this.telemetryTitle,P,R),C.addProperty(w.TelemetryPropertyNames.EVENT_RESULT,P),this.onError&&this.onError(y,m,h),this.telemetry.sendFault(this.telemetryFaultEventName,T.TelemetryUtil.MapTelemetryResultToFaultType(P),k,y),v=y,y}finally{k=k||T.TelemetryUtil.BuildTelemetryMessage(this.telemetryTitle,A.TelemetryResult.Success);const h=C.end(P,k);m.trace.traceEvent(T.TelemetryUtil.MapTelemetryResultToTraceEventType(P),0,`Command [${m.commandName}]: ${k} (${h}ms)`),v&&(v.stack&&m.trace.error(A.cleanSensitiveInformation(v.stack)),v.hasRecorded=!0)}return y}))}addInvocationTelemetryProperties(h,m={}){for(let y of Object.keys(m))h.addProperty(y,m[y])}onWorkspaceProgressUpdated(h,m){switch(h.progress){case C.vsls.WorkspaceProgress.WaitingForHost:m.markTime(w.TelemetryPropertyNames.START_WAITING_FOR_HOST);break;case C.vsls.WorkspaceProgress.DoneWaitingForHost:m.markTime(w.TelemetryPropertyNames.DONE_WAITING_FOR_HOST);break;case C.vsls.WorkspaceProgress.ReconnectingToHost:m.markTime(w.TelemetryPropertyNames.RECONNECTING_TO_HOST);break;case C.vsls.WorkspaceProgress.ReconnectedToHost:m.markTime(w.TelemetryPropertyNames.RECONNECTED_TO_HOST)}}}},function(h,m,y){"use strict";var v=this&&this.__awaiter||function(h,m,y,v){return new(y||(y=Promise))((function(C,T){function fulfilled(h){try{step(v.next(h))}catch(h){T(h)}}function rejected(h){try{step(v.throw(h))}catch(h){T(h)}}function step(h){h.done?C(h.value):function adopt(h){return h instanceof y?h:new y((function(m){m(h)}))}(h.value).then(fulfilled,rejected)}step((v=v.apply(h,m||[])).next())}))};Object.defineProperty(m,"__esModule",{value:!0});const C=y(0),T=y(4),w=y(243),A=y(22),P=y(23),k=y(32),R=y(26),M=y(5);class AccessControlManager extends w.ClientAccessCheck{constructor(h,m,y,v,T){super(h,T),this.accessControlService=m,this.sessionContext=y,this.fileSystemManager=v,this.accessControl={},this.operationRejected=new C.EventEmitter,this.operationAccessChanged=new C.EventEmitter,this.disposables=[]}get isReadOnly(){return!!this.accessControl.isReadOnly}get onDidRejectOperation(){return this.operationRejected.event}get onDidChangeOperationAccess(){return this.operationAccessChanged.event}init(){const h=Object.create(null,{init:{get:()=>super.init}});return v(this,void 0,void 0,(function*(){yield h.init.call(this),this.accessControl=(yield this.accessControlService.getAccessControlAsync())||{},this.disposables.push(this.accessControlService.onAccessControlChanged(this.accessControlChanged,this)),R.workspaceSessionInfoTracker.isReadOnly=this.isReadOnly,this.fileSystemManager.registerFileSystemProvider(this.isReadOnly),this.disposables.push(this.workspaceAccessControlService.onOperationRejected(this.workspaceAccessControlService_operationRejected,this)),this.disposables.push(this.workspaceAccessControlService.onOperationAccessChanged(this.workspaceAccessControlService_operationAccessChanged,this))}))}dispose(){const h=Object.create(null,{dispose:{get:()=>super.dispose}});return v(this,void 0,void 0,(function*(){yield h.dispose.call(this),this.fileSystemManager.dispose(),yield Promise.all(this.disposables.map(h=>h.dispose()))}))}requestOperationAccess(h){return v(this,void 0,void 0,(function*(){yield this.workspaceAccessControlService.requestOperationAccessAsync(h)}))}logRejectedOperation(h,m){return Promise.resolve()}accessControlChanged(h){return v(this,void 0,void 0,(function*(){const m=this.isReadOnly;this.accessControl=h.accessControl||{};const y=this.isReadOnly;if(m!==y&&(R.workspaceSessionInfoTracker.isReadOnly=y,this.fileSystemManager.registerFileSystemProvider(y),P.sessionStateTracker.State===A.SessionState.Joined)){if(P.sessionStateTracker.State!==A.SessionState.Joined)return;const h=R.workspaceSessionInfoTracker.isReadOnly?"read-only":"read/write";M.NotificationUtil.showInformationMessage(`The host has given you ${h} access.`,!1)}}))}workspaceAccessControlService_operationRejected(h){return v(this,void 0,void 0,(function*(){const m=this.sessionContext.coeditingClient.clientID===h.operation.sessionId,y=P.sessionStateTracker.State===A.SessionState.Joined,v=h.access===T.vsls.RestrictedOperationAccess.DisabledByHostConfiguration,C=k.userAuthStateTracker.isCurrentUserAnonymous();if(!h.operation||!v&&!C||!m||!y)return;const w=yield this.isReadOnlySession();this.operationRejected.fire({operation:h.operation,isCurrentUserAnonymous:C,isReadOnlySession:w})}))}workspaceAccessControlService_operationAccessChanged(h){h.operation&&P.sessionStateTracker.State===A.SessionState.Joined&&this.operationAccessChanged.fire({operation:h.operation,access:h.access})}}m.AccessControlManager=AccessControlManager},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0}),function(h){h.Edit="Edit",h.FileAccess="FileAccess",h.CodeAction="CodeAction",h.RunTask="RunTask",h.TerminateTask="TerminateTask",h.LaunchDebug="LaunchDebug",h.DebugContinue="DebugContinue",h.DebugSetVariable="DebugSetVariable",h.DebugEvaluate="DebugEvaluate",h.WriteToSharedTerminal="WriteToSharedTerminal",h.CleanSourceControlResource="CleanSourceControlResource",h.ExecuteNotebookCell="ExecuteNotebookCell"}(m.WellKnownRestrictedOperations||(m.WellKnownRestrictedOperations={})),function(h){h.RejectedInReadOnlySession="RejectedInReadOnlySession",h.RejectedForNotOwner="RejectedForNotOwner",h.DisabledByHost="DisabledByHost"}(m.RestrictedOperationRejectionReason||(m.RestrictedOperationRejectionReason={}))},function(h,m,y){"use strict";var v=this&&this.__awaiter||function(h,m,y,v){return new(y||(y=Promise))((function(C,T){function fulfilled(h){try{step(v.next(h))}catch(h){T(h)}}function rejected(h){try{step(v.throw(h))}catch(h){T(h)}}function step(h){h.done?C(h.value):function adopt(h){return h instanceof y?h:new y((function(m){m(h)}))}(h.value).then(fulfilled,rejected)}step((v=v.apply(h,m||[])).next())}))};Object.defineProperty(m,"__esModule",{value:!0});const C=y(0),T=y(4),w=y(238),A=y(12),P=y(14),k=y(24),R=y(94),M=y(22),N=y(243),D=y(5),I=y(23),x=y(26),O=y(25),L=y(37);var U;!function(h){h.readOnly="readOnly",h.readWrite="readWrite"}(U=m.AnonymousAccessLevel||(m.AnonymousAccessLevel={}));class WorkspaceAccessControlManager extends N.ClientAccessCheck{constructor(h,m){super(h.workspaceAccessControlService(),m),this.guestNameSemaphore=new w.default(1),this.guestNameCounts=new Map,this.workspaceUserService=h.workspaceUserService()}get isReadOnly(){return!1}endCollaboration(){this.guestNameCounts.clear(),super.endCollaboration(),x.workspaceSessionInfoTracker.clearAnonymousAccessMap()}setReadOnly(h){return v(this,void 0,void 0,(function*(){let m=(yield this.workspaceAccessControlService.getAccessControlAsync())||{};if(m.defaultAccessControl=m.defaultAccessControl||{},!!m.defaultAccessControl.isReadOnly!==h){if(R.SessionContext.hasCollaborators)return void(yield C.window.showErrorMessage("Cannot change read-only status of the collaboration session when there are participants joined.",{modal:k.ExtensionUtil.enableModalNotifications}));m.defaultAccessControl.isReadOnly=h,x.workspaceSessionInfoTracker.isReadOnly=h,yield this.workspaceAccessControlService.setAccessControlAsync(m)}}))}getUserAccessControlBySessionId(h){return v(this,void 0,void 0,(function*(){return yield this.ensureWorkspaceAccessControl(),this.workspaceAccessControl.userAccessControl[h]}))}setUserReadOnly(h,m){return v(this,void 0,void 0,(function*(){const y=(yield this.workspaceAccessControlService.getAccessControlAsync())||{};y.defaultAccessControl=y.defaultAccessControl||{};const v=y.userAccessControl,C=v[m];(C&&C.isReadOnly)!==h&&(v[m]=Object.assign(Object.assign({},C),{isReadOnly:h}),yield this.workspaceAccessControlService.setAccessControlAsync(y))}))}setOperationAccess(h,m){return v(this,void 0,void 0,(function*(){yield this.workspaceAccessControlService.setOperationAccessAsync(h,m)}))}setUserAccessControl(h,m){return v(this,void 0,void 0,(function*(){const y="accept"===(A.Settings.get(P.SettingKeys.anonymousGuestApproval)||"").toLowerCase(),v=x.workspaceSessionInfoTracker.getAnonymousAccess(m.id)===U.readOnly;m.isAnonymous?(!this.isReadWriteAnonymousEnabled()||this.isReadWriteAnonymousEnabled()&&(v||y))&&(yield this.setUserReadOnly(!0,h),y&&this.isReadWriteAnonymousEnabled()&&(yield x.workspaceSessionInfoTracker.setAnonymousAccess(m.id,O.localize("notification.AlwaysAcceptAnonymous")))):yield this.copyPreviousAccessControl(m,h)}))}copyAccessControl(h,m){return v(this,void 0,void 0,(function*(){const y=this.workspaceAccessControl,v=y.userAccessControl,C=v[h],T=v[m];C&&(v[m]=Object.assign(Object.assign(Object.assign({},T),C),{isReadOnly:!!C.isReadOnly}),yield this.workspaceAccessControlService.setAccessControlAsync(y))}))}copyPreviousAccessControl(h,m){return v(this,void 0,void 0,(function*(){const y=R.SessionContext.getLatestPreviousSessionId(h.id);if(y){(yield this.getUserAccessControlBySessionId(y))&&(yield this.copyAccessControl(y,m))}}))}logRejectedOperation(h,m){return v(this,void 0,void 0,(function*(){yield this.workspaceAccessControlService.rejectOperationAsync(h,m)}))}onWorkspaceSessionChanged(h){return v(this,void 0,void 0,(function*(){if(h.changeType===T.vsls.WorkspaceSessionChangeType.Requested&&I.sessionStateTracker.State===M.SessionState.Shared){const{sessionNumber:m,userProfile:y}=h,v=yield this.approveGuest(m,h);"boolean"==typeof v?(v&&(yield this.setUserAccessControl(m,y)),yield this.workspaceUserService.acceptOrRejectGuestAsync(m,{accept:v})):yield this.workspaceUserService.acceptOrRejectGuestAsync(m,{accept:!1,errorCode:v.errorCode||T.vsls.ErrorCodes.CollaborationSessionGuestRejectedWithSpecificReason,message:v.errorMessage})}h.changeType===T.vsls.WorkspaceSessionChangeType.Unjoined&&I.sessionStateTracker.State===M.SessionState.Shared&&(yield this.showGuestLeftNotification(h))}))}approveGuest(h,m){var y;return v(this,void 0,void 0,(function*(){const{userProfile:v}=m,C=v.clientCapabilities||{},w=!C.extensionReadOnlySupport||!C.clientReadOnlySupport,k=v.isAnonymous;if((x.workspaceSessionInfoTracker.isReadOnly||k)&&w){if(!C.extensionReadOnlySupport&&!C.clientReadOnlySupport)return{errorMessage:"Your VS Live Share extension does not support read-only collaboration session. Please update the extension."};if(!C.clientReadOnlySupport){const h="VisualStudio"===m.applicationName?"Visual Studio":void 0,y="VSCode"===m.applicationName?"VS Code":void 0,v=h||y;return{errorMessage:`Your ${v||"client"} does not support read-only collaboration session. Please update ${v||"the client"}.`}}return{errorMessage:"Read-only support is disabled. To join a read-only collaboration session, please enable the read-only support feature."}}const R=(A.Settings.get(P.SettingKeys.anonymousGuestApproval)||"").toLowerCase();if("reject"===R&&k)return{errorCode:T.vsls.ErrorCodes.ForbiddenHttpStatusCode,errorMessage:O.localize("The host does not allow anonymous guests. Please sign in.")};const M=A.Settings.get(P.SettingKeys.allowedDomains)||[];if(M&&0!==M.length){let h=null===(y=null==v?void 0:v.email)||void 0===y?void 0:y.split("@")[1];if(!M.includes(h))return{errorCode:T.vsls.ErrorCodes.ForbiddenHttpStatusCode,errorMessage:"The host has restricted you from joining the collaboration session."}}const N=this.buildGuestName(yield this.getGuestDisplayName(v),k,v,!0),D="prompt"===R&&k,I=A.Settings.get(P.SettingKeys.guestApprovalRequired),L=this.isReadWriteAnonymousEnabled()&&!k;if(I||D){if(!this.isReadWriteAnonymousEnabled()||x.workspaceSessionInfoTracker.isReadOnly||L)return yield this.waitForHostToAcceptGuest(h,N,k,v);if(this.isReadWriteAnonymousEnabled()&&k)return yield this.waitForHostToAcceptGuestForReadWriteAnonymousExperiment(h,N,k,v)}return this.showJoinNotification(N),!0}))}buildGuestName(h,m,y,v){const C=x.workspaceSessionInfoTracker.isReadOnly,T=x.workspaceSessionInfoTracker.getAnonymousAccess(y.id)===U.readWrite;return C&&!m?h+=O.localize("guestNameToast.ReadOnlyLabel"):m&&(this.isReadWriteAnonymousEnabled()&&v?h+=O.localize("guestNameToast.AnonymousLabel"):this.isReadWriteAnonymousEnabled()&&T?h+=O.localize("guestNameToast.AnonymousReadWriteLabel"):h+=O.localize("guestNameToast.ReadOnlyAndAnonymousLabel")),h}waitForHostToAcceptGuest(h,m,y,w){return v(this,void 0,void 0,(function*(){const v="accept"===(A.Settings.get(P.SettingKeys.anonymousGuestApproval)||"").toLowerCase();yield this.workspaceUserService.fireProgressUpdatedToGuestAsync(T.vsls.WorkspaceProgress.WaitingForHost,h);const k=`${m}`+O.localize("notification.AcceptRejectGuest"),R=O.localize("notification.Accept"),M=O.localize("notification.Reject"),N=O.localize("notification.AlwaysAcceptAnonymous"),D=[R,M];y&&!v&&D.push(N);const I=yield C.window.showInformationMessage(k,...D);return this.isReadWriteAnonymousEnabled()&&y&&(yield x.workspaceSessionInfoTracker.setAnonymousAccess(w.id,I)),I===N&&(yield A.Settings.save(P.SettingKeys.anonymousGuestApproval,"accept")),yield this.workspaceUserService.fireProgressUpdatedToGuestAsync(T.vsls.WorkspaceProgress.DoneWaitingForHost,h),I===R||I===N}))}waitForHostToAcceptGuestForReadWriteAnonymousExperiment(h,m,y,w){return v(this,void 0,void 0,(function*(){yield this.workspaceUserService.fireProgressUpdatedToGuestAsync(T.vsls.WorkspaceProgress.WaitingForHost,h);const y=`${m} `+O.localize("notification.AcceptRejectGuest"),v=O.localize("notification.AcceptReadOnly"),A=O.localize("notification.AcceptReadWrite"),P=[v,A,O.localize("notification.Reject")],k=yield C.window.showInformationMessage(y,...P);return yield this.workspaceUserService.fireProgressUpdatedToGuestAsync(T.vsls.WorkspaceProgress.DoneWaitingForHost,h),yield x.workspaceSessionInfoTracker.setAnonymousAccess(w.id,k),k===v||k===A}))}isReadWriteAnonymousEnabled(){var h;return null===(h=L.getExpService())||void 0===h?void 0:h.getTreatmentVariable("vscode","readWriteAnonymous")}showJoinNotification(h){return v(this,void 0,void 0,(function*(){let m=`${h}`+O.localize("notification.InformGuestJoined");const y=!!A.Settings.get(P.SettingKeys.showVerboseNotifications);yield D.NotificationUtil.showInformationMessage(m,!y)}))}showGuestLeftNotification(h){return v(this,void 0,void 0,(function*(){let m=this.getNameAndUsername(h.userProfile);switch(m=this.buildGuestName(m,h.userProfile.isAnonymous,h.userProfile,!1),h.disconnectedReason){case T.vsls.WorkspaceDisconnectedReason.NetworkDisconnected:{let h=`${m}`+O.localize("notification.GuestDisconnected");yield C.window.showInformationMessage(h);break}case T.vsls.WorkspaceDisconnectedReason.Requested:{let h=`${m}`+O.localize("notification.GuestLeft");const y=!!A.Settings.get(P.SettingKeys.showVerboseNotifications);yield D.NotificationUtil.showInformationMessage(h,!y);break}case T.vsls.WorkspaceDisconnectedReason.UserRemoved:case T.vsls.WorkspaceDisconnectedReason.UserBlocked:}}))}getGuestDisplayName(h){return v(this,void 0,void 0,(function*(){let m=this.getNameAndUsername(h);yield this.guestNameSemaphore.acquire();try{if(this.guestNameCounts.has(m)){return`${m} (${this.guestNameCounts.set(m,this.guestNameCounts.get(m)+1).get(m)})`}return this.guestNameCounts.set(m,0),m}finally{this.guestNameSemaphore.release()}}))}getNameAndUsername(h){let m=h.userName,y=h.name;if(!y)return m;if(h.isAnonymous)return y;if(y===m)return m;return`${y}${m?` (${m})`:""}`}onWorkspaceAccessControlChanged(h){super.onWorkspaceAccessControlChanged(h),x.workspaceSessionInfoTracker.isReadOnly=this.workspaceAccessControl.defaultAccessControl.isReadOnly,R.SessionContext.onWorkspaceAccessControlChanged(h)}initWorkspaceAccessControl(){const h=Object.create(null,{initWorkspaceAccessControl:{get:()=>super.initWorkspaceAccessControl}});return v(this,void 0,void 0,(function*(){yield h.initWorkspaceAccessControl.call(this)}))}}m.WorkspaceAccessControlManager=WorkspaceAccessControlManager},function(h,m,y){"use strict";var v=this&&this.__awaiter||function(h,m,y,v){return new(y||(y=Promise))((function(C,T){function fulfilled(h){try{step(v.next(h))}catch(h){T(h)}}function rejected(h){try{step(v.throw(h))}catch(h){T(h)}}function step(h){h.done?C(h.value):function adopt(h){return h instanceof y?h:new y((function(m){m(h)}))}(h.value).then(fulfilled,rejected)}step((v=v.apply(h,m||[])).next())}))};Object.defineProperty(m,"__esModule",{value:!0});const C=y(0),T=y(12),w=y(14),A=y(32),P=y(432),k=y(244),R=y(97),M=y(4),N=y(163),D=y(61);function getServiceUri(){return T.Settings.get(w.SettingKeys.serviceUri)}m.AuthenticationProviderService=class AuthenticationProviderService{constructor(h){this.trace=h,this.authenticationChanged=new C.EventEmitter,this.onAuthenticationChanged=this.authenticationChanged.event,A.userAuthStateTracker.onUserInfoChanged(()=>this.fireAuthenticationChanged()),this.tokenExchangeService=new k.TokenExchangeService(h)}getCurrentUserAsync(h){return Promise.resolve(this.userInfo)}getCurrentAuthenticatedUserAsync(h){const m=new M.vsls.AuthenticatedUserInfo;return m.accessToken=this.loginToken,m.userInfo=this.userInfo,Promise.resolve(m)}removeRecentCollaboratorAsync(h,m){return Promise.resolve()}removeAllRecentCollaboratorsAsync(h){return Promise.resolve()}fireAuthenticationChanged(){this.trace.verbose("fireAuthenticationChanged");const h=new M.vsls.AuthenticationChangedEventArgs;h.accessToken=this.loginToken,h.account=this.userInfo,this.authenticationChanged.fire(h)}loginAsync(h,m,y,C){return v(this,void 0,void 0,(function*(){if(this.trace.verbose("loginAsync"),!h.token)throw new Error("Empty token passed");return this.loginToken=h.token,this.userInfo=yield function getUserAuthInfo(h){return v(this,void 0,void 0,(function*(){const m={headers:{Authorization:`Bearer ${h}`,"Cache-Control":"no-cache","Content-Type":"application/json"},proxy:!1},y=(yield N.default.get(D.PathUtil.ensureFinalSlash(getServiceUri())+"api/v1.2/profile",m)).data,v=y;return{id:v.id,emailAddress:v.email,displayName:v.name,userName:v.userName,avatarUri:v.avatarUri,recentCollaborators:y.recentCollaborators,isAnonymous:y.isAnonymous,programs:y.programs,accountStatus:y.status}}))}(h.token),this.userInfo}))}loginWithExternalTokenAsync(h,m,y,C,T){return v(this,void 0,void 0,(function*(){if(this.trace.verbose("loginWithExternalTokenAsync"),!h.providerName)throw new Error("Empty provider name passed");if(!m.token)throw new Error("Empty native token passed");const v=P.EnumUtil.getEnumKeyByEnumValue(R.SupportedAuthProviders,h.providerName),w=R.SupportedAuthProviders[v];if(!w)throw new Error(`Provider with id ${h.providerName} is not supported`);let A=void 0;try{A=yield this.tokenExchangeService.exchange(w,m.token)}catch(h){this.trace.error(`External token exchange failed with ${h}. Attempting legacy exchange.`),A=yield this.performLegacyTokenExchange(w,m.token)}return yield this.loginAsync({token:A},y,C,T)}))}logoutAsync(h,m){return this.trace.verbose("logoutAsync"),this.loginToken=void 0,this.userInfo=void 0,Promise.resolve()}performLegacyTokenExchange(h,m){var y;return v(this,void 0,void 0,(function*(){const v=N.default.defaults.headers["Content-Type"];try{N.default.defaults.headers["Content-Type"]="application/json";const C={headers:{"Cache-Control":"no-cache"},proxy:!1},T=null===(y=getServiceUri())||void 0===y?void 0:y.replace("prod","insiders");return(yield N.default.post(T+"auth/exchange",{provider:h,token:m},C)).data.access_token}finally{N.default.defaults.headers["Content-Type"]=v}}))}}},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0});m.EnumUtil=class EnumUtil{static getEnumKeyByEnumValue(h,m){return Object.keys(h).find(y=>h[y]===m)}}},function(h,m,y){"use strict";var v=this&&this.__awaiter||function(h,m,y,v){return new(y||(y=Promise))((function(C,T){function fulfilled(h){try{step(v.next(h))}catch(h){T(h)}}function rejected(h){try{step(v.throw(h))}catch(h){T(h)}}function step(h){h.done?C(h.value):function adopt(h){return h instanceof y?h:new y((function(m){m(h)}))}(h.value).then(fulfilled,rejected)}step((v=v.apply(h,m||[])).next())}))};Object.defineProperty(m,"__esModule",{value:!0});const C=y(29),T=y(0),w=y(97),A=y(244),P=y(12),k=y(14),R=y(32),M=y(173),N=y(8),D=y(17);m.VsCodeNativeAuthTokenProvider=class VsCodeNativeAuthTokenProvider{constructor(h,m,y,v){this.providerId=h,this.scopes=m,this.logger=y,this.tokenExchangeService=v,this.onSignOutEmitter=new T.EventEmitter,this.hoursBufferCascade=2,this.onSignOut=this.onSignOutEmitter.event,this.scopes=this.scopes.sort(),this.tokenExchangeService=v||new A.TokenExchangeService(y),T.authentication.onDidChangeSessions(this.handleOnDidChangeSessions.bind(this))}handleOnDidChangeSessions(h){return v(this,void 0,void 0,(function*(){if(!h)return;if(!h.provider)return;if(h.provider.id!==this.providerId)return;const m=void 0!==this.session,y=yield this.tryLoadSession(!1);m&&!1===y&&(yield this.signOut()),m||!0!==y||this.signInIsInProgress||(yield T.commands.executeCommand(R.userAuthStateTracker.isCurrentUserAnonymous()?`${P.Settings.get(k.SettingKeys.commandPrefix)}.signInAndReload`:"liveshare.signin"))}))}tryLoadSession(h,m){return v(this,void 0,void 0,(function*(){let y,v;try{const C=P.Settings.get(k.SettingKeys.authenticationProvider),A=w.SupportedAuthProviders[C];if(A&&A!==this.providerId&&!h)return!1;this.logger.verbose(`Attempting to load session - login = ${h}`);const R=yield T.authentication.getSession(this.providerId,this.scopes,{createIfNone:h});if(R)return this.logger.verbose("Successfully loaded session"),this.session=R,v="Success",!0;this.logger.warning("Failed to load session")}catch(C){if(this.logger.warning(`Failed to load session: ${C.message}`),y=C,"User did not consent to login."!==y.message&&"Unauthorized"!==y.message&&"Cancelled"!==C&&"access_denied"!==C||!h)v="Failure";else if(yield this.cancelSignIn(),v="Cancel",m){const{cancellationTokenSource:h}=m;null==h||h.cancel()}}finally{if(h){const h=new N.TelemetryEvent(D.TelemetryEventNames.TRY_LOAD_SESSION);h.addProperty(D.TelemetryPropertyNames.EVENT_RESULT,v),y&&y.stack&&h.addProperty(D.TelemetryPropertyNames.VSCODE_ERROR_CALL_STACK,N.cleanSensitiveInformation(y.stack)),m&&m.telemetryEvent&&h.correlateWith(m.telemetryEvent),h.send()}}return!1}))}isSignedIn(){return void 0!==this.session}signIn(h){var m,y,T;return v(this,void 0,void 0,(function*(){this.signInIsInProgress=!0;try{if(this.isSignedIn())return this.logger.verbose("Already signed in"),!0;if(this.loginPromise)return yield this.loginPromise.promise;this.loginPromise=new C.PromiseCompletionSource;try{yield this.tryLoadSession(!0,h)}catch(h){this.logger.error(`Failed to sign in: ${h.message}`),null===(m=this.loginPromise)||void 0===m||m.reject(h)}return(yield this.getAccessToken())?(this.session?this.logger.info("Successfully signed in"):this.logger.info("Successfully signed in from a cached credential"),null===(y=this.loginPromise)||void 0===y||y.resolve(!0),!0):(this.logger.error("Failed to sign in: no token available"),null===(T=this.loginPromise)||void 0===T||T.resolve(!1),!1)}finally{this.loginPromise=void 0,this.signInIsInProgress=!1}}))}signOut(){var h;return null===(h=this.loginPromise)||void 0===h||h.reject(new Error("Logged Out")),this.loginPromise=void 0,this.resetCascadeToken(),this.session=void 0,this.onSignOutEmitter.fire(),this.logger.info("Successfully signed out"),Promise.resolve()}resetCascadeToken(){this.cascadeToken=void 0}cancelSignIn(){var h;return null===(h=this.loginPromise)||void 0===h||h.reject(new Error("Sign in cancelled")),this.loginPromise=void 0,Promise.resolve()}getAccessToken(){var h;return v(this,void 0,void 0,(function*(){if(this.cascadeTokenIsValid())return this.cascadeToken;this.isSignedIn()||(yield this.tryLoadSession(!1));const m=null===(h=this.session)||void 0===h?void 0:h.accessToken;return m?(this.cascadeToken=yield this.tokenExchangeService.exchange(this.providerId,m),this.cascadeToken):void 0}))}cascadeTokenIsValid(){if(!this.cascadeToken)return!1;try{const h=M(this.cascadeToken);if(!h)return this.logger.info("Can't decode Cascade token"),!1;const m=new Date;return m.setHours(m.getHours()+this.hoursBufferCascade),!(1e3*h.exp<m.getTime())||(this.logger.info("Cascade token will expire in less than two hours"),!1)}catch(h){return this.logger.error(`Failed to validate cascade token: ${h.message}`),!1}}}},function(h,m,y){var v=y(11);m.DiffieHellmanGroup=v.DiffieHellmanGroup,m.createDiffieHellmanGroup=v.createDiffieHellmanGroup,m.getDiffieHellman=v.getDiffieHellman,m.createDiffieHellman=v.createDiffieHellman,m.DiffieHellman=v.DiffieHellman},function(h){h.exports=JSON.parse('{"name":"@vs/vs-ssh","version":"3.4.17","description":"SSH library for Visual Studio tools","keywords":["SSH"],"dependencies":{"buffer":"^5.2.1","debug":"^4.1.1","diffie-hellman":"^5.0.3","vscode-jsonrpc":"^4.0.0"},"author":"Microsoft","main":"./index.js"}')},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0}),m.NodeECDiffieHellman=m.NodeDiffieHellman=void 0;const v=y(11),C=y(9),T=y(245),w=y(250),A=y(54);class NodeDiffieHellman extends T.KeyExchangeAlgorithm{constructor(h,m,y){super(h,m,y,w.NodeHmac.getHashDigestLength(y))}createKeyExchange(){return new NodeDiffieHellmanKex(this.keySizeInBits,w.NodeHmac.getNodeHashAlgorithmName(this.hashAlgorithmName),this.hashDigestLength)}}m.NodeDiffieHellman=NodeDiffieHellman;class NodeDiffieHellmanKex{constructor(h,m,y){switch(this.hashAlgorithmName=m,this.digestLength=y,h){case 1024:this.dh=v.getDiffieHellman("modp2");break;case 2048:this.dh=v.getDiffieHellman("modp14");break;case 4096:this.dh=v.getDiffieHellman("modp16");break;default:throw new Error("Invalid DH bit length.")}}startKeyExchange(){const h=this.dh.generateKeys(),m=A.BigInt.fromBytes(h,{unsigned:!0}).toBytes();return Promise.resolve(m)}decryptKeyExchange(h){const m=this.dh.computeSecret(h),y=A.BigInt.fromBytes(m,{unsigned:!0}).toBytes();return Promise.resolve(y)}async sign(h){const m=v.createHash(this.hashAlgorithmName);return m.update(h),C.Buffer.from(m.digest())}dispose(){}}class NodeECDiffieHellman extends T.KeyExchangeAlgorithm{constructor(h,m,y){super(h,m,y,w.NodeHmac.getHashDigestLength(y))}createKeyExchange(){return new NodeECDiffieHellmanKex(this.keySizeInBits,w.NodeHmac.getNodeHashAlgorithmName(this.hashAlgorithmName),this.hashDigestLength)}}m.NodeECDiffieHellman=NodeECDiffieHellman;class NodeECDiffieHellmanKex{constructor(h,m,y){switch(this.hashAlgorithmName=m,this.digestLength=y,h){case 256:this.ecdh=v.createECDH("prime256v1");break;case 384:this.ecdh=v.createECDH("secp384r1");break;case 521:this.ecdh=v.createECDH("secp521r1");break;default:throw new Error("Invalid ECDH bit length.")}}startKeyExchange(){const h=this.ecdh.generateKeys();return Promise.resolve(h)}decryptKeyExchange(h){const m=this.ecdh.computeSecret(h),y=A.BigInt.fromBytes(m,{unsigned:!0}).toBytes();return Promise.resolve(y)}async sign(h){const m=v.createHash(this.hashAlgorithmName);return m.update(h),C.Buffer.from(m.digest())}dispose(){}}},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0}),m.Sec1KeyFormatter=m.Pkcs1KeyFormatter=m.parsePem=m.formatPem=void 0;const v=y(54),C=y(251),T=y(175);m.formatPem=function formatPem(h,m){return`-----BEGIN ${m}-----\n`+h.toString("base64").match(/.{1,64}/g).join("\n")+"\n"+`-----END ${m}-----\n`},m.parsePem=function parsePem(h){const m=h.replace(/-+[^-\n]+KEY-+/g,"").replace(/\s/g,"");return Buffer.from(m,"base64")};m.Pkcs1KeyFormatter=class Pkcs1KeyFormatter{static formatRsaPublic(h){const m=new C.DerWriter(Buffer.alloc(1024));return m.writeInteger(h.modulus),m.writeInteger(h.exponent),m.toBuffer()}static formatRsaPrivate(h){if(!(h.d&&h.p&&h.q&&h.dp&&h.dq&&h.qi))throw new Error("Missing private key parameters.");const m=new C.DerWriter(Buffer.alloc(2048));return m.writeInteger(v.BigInt.fromInt32(0)),m.writeInteger(h.modulus),m.writeInteger(h.exponent),m.writeInteger(h.d),m.writeInteger(h.p),m.writeInteger(h.q),m.writeInteger(h.dp),m.writeInteger(h.dq),m.writeInteger(h.qi),m.toBuffer()}static parseRsaPublic(h){const m=new C.DerReader(h);return{modulus:m.readInteger(),exponent:m.readInteger()}}static parseRsaPrivate(h){const m=new C.DerReader(h);m.readInteger();return{modulus:m.readInteger(),exponent:m.readInteger(),d:m.readInteger(),p:m.readInteger(),q:m.readInteger(),dp:m.readInteger(),dq:m.readInteger(),qi:m.readInteger()}}};class Sec1KeyFormatter{static formatECPublic(h){const m=T.curves.find(m=>m.oid===h.curve.oid),y=Math.ceil(m.keySize/8),v=new C.DerWriter(Buffer.alloc(512)),w=new C.DerWriter(Buffer.alloc(100));w.writeObjectIdentifier(Sec1KeyFormatter.ecPublicKeyOid),w.writeObjectIdentifier(h.curve.oid),v.writeSequence(w);const A=h.x.toBytes({unsigned:!0,length:y}),P=h.y.toBytes({unsigned:!0,length:y}),k=Buffer.alloc(1+A.length+P.length);return k[0]=4,A.copy(k,1),P.copy(k,1+A.length),v.writeBitString(k),v.toBuffer()}static formatECPrivate(h){const m=T.curves.find(m=>m.oid===h.curve.oid),y=Math.ceil(m.keySize/8),w=new C.DerWriter(Buffer.alloc(512));w.writeInteger(v.BigInt.fromInt32(1)),w.writeOctetString(h.d.toBytes({unsigned:!0,length:y}));const A=new C.DerWriter(Buffer.alloc(100));A.writeObjectIdentifier(h.curve.oid),w.writeTagged(0,A);const P=h.x.toBytes({unsigned:!0,length:y}),k=h.y.toBytes({unsigned:!0,length:y}),R=Buffer.alloc(1+P.length+k.length);R[0]=4,P.copy(R,1),k.copy(R,1+P.length);const M=new C.DerWriter(Buffer.alloc(512));return M.writeBitString(R),w.writeTagged(1,M),w.toBuffer()}static parseECPublic(h){var m;const y=new C.DerReader(h),w=y.readSequence(),A=w.readObjectIdentifier();if(A!==Sec1KeyFormatter.ecPublicKeyOid)throw new Error(`Unexpected key type OID: ${A}`);const P=w.readObjectIdentifier(),k=null===(m=T.curves.find(h=>h.oid===P))||void 0===m?void 0:m.name,R=y.readBitString();if(R.length%2!=1)throw new Error(`Unexpected key data length: ${R.length}`);const M=v.BigInt.fromBytes(R.slice(1,1+(R.length-1)/2),{unsigned:!0}),N=v.BigInt.fromBytes(R.slice(1+(R.length-1)/2),{unsigned:!0});return{curve:{name:k,oid:P},x:M,y:N}}static parseECPrivate(h){var m;const y=new C.DerReader(h),w=y.readInteger().toInt32();if(1!==w)throw new Error(`Unsupported SEC1 format version: ${w}`);const A=v.BigInt.fromBytes(y.readOctetString(),{unsigned:!0}),P=y.tryReadTagged(0);if(!P)throw new Error("SEC1 curve info not found.");const k=P.readObjectIdentifier(),R=null===(m=T.curves.find(h=>h.oid===k))||void 0===m?void 0:m.name,M=y.tryReadTagged(1);if(!M)throw new Error("SEC1 public key data not found.");const N=M.readBitString();if(N.length%2!=1)throw new Error(`Unexpected key data length: ${N.length}`);const D=v.BigInt.fromBytes(N.slice(1,1+(N.length-1)/2),{unsigned:!0}),I=v.BigInt.fromBytes(N.slice(1+(N.length-1)/2),{unsigned:!0});return{curve:{name:R,oid:k},x:D,y:I,d:A}}}m.Sec1KeyFormatter=Sec1KeyFormatter,Sec1KeyFormatter.ecPublicKeyOid="1.2.840.10045.2.1"},function(h,m,y){
/*!
 * RSA library for Node.js
 *
 * Author: rzcoder
 * License MIT
 */
var v=y(68),C=y(1061),T=(y(11),y(252).Ber,y(43)._),w=y(43),A=y(99),P=y(1071);void 0===v.RSA_NO_PADDING&&(v.RSA_NO_PADDING=3),h.exports=function(){var h={node10:["md4","md5","ripemd160","sha1","sha224","sha256","sha384","sha512"],node:["md4","md5","ripemd160","sha1","sha224","sha256","sha384","sha512"],iojs:["md4","md5","ripemd160","sha1","sha224","sha256","sha384","sha512"],browser:["md5","ripemd160","sha1","sha256","sha512"]},m={private:"pkcs1-private-pem","private-der":"pkcs1-private-der",public:"pkcs8-public-pem","public-der":"pkcs8-public-der"};function NodeRSA(h,m,y){if(!(this instanceof NodeRSA))return new NodeRSA(h,m,y);T.isObject(m)&&(y=m,m=void 0),this.$options={signingScheme:"pkcs1",signingSchemeOptions:{hash:"sha256",saltLength:null},encryptionScheme:"pkcs1_oaep",encryptionSchemeOptions:{hash:"sha1",label:null},environment:w.detectEnvironment(),rsaUtils:this},this.keyPair=new C.Key,this.$cache={},Buffer.isBuffer(h)||T.isString(h)?this.importKey(h,m):T.isObject(h)&&this.generateKeyPair(h.b,h.e),this.setOptions(y)}return NodeRSA.prototype.setOptions=function(m){if((m=m||{}).environment&&(this.$options.environment=m.environment),m.signingScheme){if(T.isString(m.signingScheme)){var y=m.signingScheme.toLowerCase().split("-");1==y.length?h.node.indexOf(y[0])>-1?(this.$options.signingSchemeOptions={hash:y[0]},this.$options.signingScheme="pkcs1"):(this.$options.signingScheme=y[0],this.$options.signingSchemeOptions={hash:null}):(this.$options.signingSchemeOptions={hash:y[1]},this.$options.signingScheme=y[0])}else T.isObject(m.signingScheme)&&(this.$options.signingScheme=m.signingScheme.scheme||"pkcs1",this.$options.signingSchemeOptions=T.omit(m.signingScheme,"scheme"));if(!A.isSignature(this.$options.signingScheme))throw Error("Unsupported signing scheme");if(this.$options.signingSchemeOptions.hash&&-1===h[this.$options.environment].indexOf(this.$options.signingSchemeOptions.hash))throw Error("Unsupported hashing algorithm for "+this.$options.environment+" environment")}if(m.encryptionScheme){if(T.isString(m.encryptionScheme)?(this.$options.encryptionScheme=m.encryptionScheme.toLowerCase(),this.$options.encryptionSchemeOptions={}):T.isObject(m.encryptionScheme)&&(this.$options.encryptionScheme=m.encryptionScheme.scheme||"pkcs1_oaep",this.$options.encryptionSchemeOptions=T.omit(m.encryptionScheme,"scheme")),!A.isEncryption(this.$options.encryptionScheme))throw Error("Unsupported encryption scheme");if(this.$options.encryptionSchemeOptions.hash&&-1===h[this.$options.environment].indexOf(this.$options.encryptionSchemeOptions.hash))throw Error("Unsupported hashing algorithm for "+this.$options.environment+" environment")}this.keyPair.setOptions(this.$options)},NodeRSA.prototype.generateKeyPair=function(h,m){if(m=m||65537,(h=h||2048)%8!=0)throw Error("Key size must be a multiple of 8.");return this.keyPair.generate(h,m.toString(16)),this.$cache={},this},NodeRSA.prototype.importKey=function(h,y){if(!h)throw Error("Empty key given");if(y&&(y=m[y]||y),!P.detectAndImport(this.keyPair,h,y)&&void 0===y)throw Error("Key format must be specified");return this.$cache={},this},NodeRSA.prototype.exportKey=function(h){return h=m[h=h||"private"]||h,this.$cache[h]||(this.$cache[h]=P.detectAndExport(this.keyPair,h)),this.$cache[h]},NodeRSA.prototype.isPrivate=function(){return this.keyPair.isPrivate()},NodeRSA.prototype.isPublic=function(h){return this.keyPair.isPublic(h)},NodeRSA.prototype.isEmpty=function(h){return!(this.keyPair.n||this.keyPair.e||this.keyPair.d)},NodeRSA.prototype.encrypt=function(h,m,y){return this.$$encryptKey(!1,h,m,y)},NodeRSA.prototype.decrypt=function(h,m){return this.$$decryptKey(!1,h,m)},NodeRSA.prototype.encryptPrivate=function(h,m,y){return this.$$encryptKey(!0,h,m,y)},NodeRSA.prototype.decryptPublic=function(h,m){return this.$$decryptKey(!0,h,m)},NodeRSA.prototype.$$encryptKey=function(h,m,y,v){try{var C=this.keyPair.encrypt(this.$getDataForEncrypt(m,v),h);return"buffer"!=y&&y?C.toString(y):C}catch(h){throw Error("Error during encryption. Original error: "+h)}},NodeRSA.prototype.$$decryptKey=function(h,m,y){try{m=T.isString(m)?Buffer.from(m,"base64"):m;var v=this.keyPair.decrypt(m,h);if(null===v)throw Error("Key decrypt method returns null.");return this.$getDecryptedData(v,y)}catch(h){throw Error("Error during decryption (probably incorrect key). Original error: "+h)}},NodeRSA.prototype.sign=function(h,m,y){if(!this.isPrivate())throw Error("This is not private key");var v=this.keyPair.sign(this.$getDataForEncrypt(h,y));return m&&"buffer"!=m&&(v=v.toString(m)),v},NodeRSA.prototype.verify=function(h,m,y,v){if(!this.isPublic())throw Error("This is not public key");return v=v&&"buffer"!=v?v:null,this.keyPair.verify(this.$getDataForEncrypt(h,y),m,v)},NodeRSA.prototype.getKeySize=function(){return this.keyPair.keySize},NodeRSA.prototype.getMaxMessageSize=function(){return this.keyPair.maxMessageLength},NodeRSA.prototype.$getDataForEncrypt=function(h,m){if(T.isString(h)||T.isNumber(h))return Buffer.from(""+h,m||"utf8");if(Buffer.isBuffer(h))return h;if(T.isObject(h))return Buffer.from(JSON.stringify(h));throw Error("Unexpected data type")},NodeRSA.prototype.$getDecryptedData=function(h,m){return"buffer"==(m=m||"buffer")?h:"json"==m?JSON.parse(h.toString()):h.toString(m)},NodeRSA}()},function(h,m,y){var v=y(127),C=y(99);h.exports=function(h,m){var y=C.pkcs1.makeScheme(h,m);return{encrypt:function(m,C){var T,w;return C?(T=new v(y.encPad(m,{type:1})),w=h.$doPrivate(T)):(T=new v(h.encryptionScheme.encPad(m)),w=h.$doPublic(T)),w.toBuffer(h.encryptedDataLength)},decrypt:function(m,C){var T,w=new v(m);return C?(T=h.$doPublic(w),y.encUnPad(T.toBuffer(h.encryptedDataLength),{type:1})):(T=h.$doPrivate(w),h.encryptionScheme.encUnPad(T.toBuffer(h.encryptedDataLength)))}}}},function(h,m,y){"use strict";var v,C=y(9),T=C.Buffer,w={};for(v in C)C.hasOwnProperty(v)&&"SlowBuffer"!==v&&"Buffer"!==v&&(w[v]=C[v]);var A=w.Buffer={};for(v in T)T.hasOwnProperty(v)&&"allocUnsafe"!==v&&"allocUnsafeSlow"!==v&&(A[v]=T[v]);if(w.Buffer.prototype=T.prototype,A.from&&A.from!==Uint8Array.from||(A.from=function(h,m,y){if("number"==typeof h)throw new TypeError('The "value" argument must not be of type number. Received type '+typeof h);if(h&&void 0===h.length)throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof h);return T(h,m,y)}),A.alloc||(A.alloc=function(h,m,y){if("number"!=typeof h)throw new TypeError('The "size" argument must be of type number. Received type '+typeof h);if(h<0||h>=2*(1<<30))throw new RangeError('The value "'+h+'" is invalid for option "size"');var v=T(h);return m&&0!==m.length?"string"==typeof y?v.fill(m,y):v.fill(m):v.fill(0),v}),!w.kStringMaxLength)try{w.kStringMaxLength=process.binding("buffer").kStringMaxLength}catch(h){}w.constants||(w.constants={MAX_LENGTH:w.kMaxLength},w.kStringMaxLength&&(w.constants.MAX_STRING_LENGTH=w.kStringMaxLength)),h.exports=w},function(h,m,y){"use strict";var v,C=this&&this.__decorate||function(h,m,y,v){var C,T=arguments.length,w=T<3?m:null===v?v=Object.getOwnPropertyDescriptor(m,y):v;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)w=Reflect.decorate(h,m,y,v);else for(var A=h.length-1;A>=0;A--)(C=h[A])&&(w=(T<3?C(w):T>3?C(m,y,w):C(m,y))||w);return T>3&&w&&Object.defineProperty(m,y,w),w};Object.defineProperty(m,"__esModule",{value:!0}),m.KeyExchangeService=void 0;const T=y(48),w=y(9),A=y(128),P=y(177),k=y(54),R=y(257),M=y(98),N=y(38),D=y(49),I=y(55),x=y(1079),O=y(6),L=y(100);class ExchangeContext{}let U=v=class KeyExchangeService extends P.SshService{constructor(h,m){super(h),this.isClientSession=m,this.isInitialExchange=!1,this.exchangeContext=null}get exchanging(){return!!this.exchangeContext}async startKeyExchange(h){this.isInitialExchange=h,this.exchangeContext=new ExchangeContext;const m=this.createKeyExchangeInitMessage();let y=null;return this.isClientSession?(h&&this.session.config.enableKeyExchangeGuess&&(y=await this.createKeyExchangeGuessMessage(),m.firstKexPacketFollows=!!y),this.exchangeContext.clientKexInitPayload=m.toBuffer()):this.exchangeContext.serverKexInitPayload=m.toBuffer(),[m,y]}finishKeyExchange(){const h=this.exchangeContext.newAlgorithms;return this.exchangeContext=null,h}abortKeyExchange(){this.exchangeContext=null}createKeyExchangeInitMessage(){const h=this.isClientSession?"ext-info-c":"ext-info-s",m=this.session.config,y=new R.KeyExchangeInitMessage;return y.keyExchangeAlgorithms=(0,M.algorithmNames)(m.keyExchangeAlgorithms).concat(h),y.serverHostKeyAlgorithms=this.getPublicKeyAlgorithms(),y.encryptionAlgorithmsClientToServer=y.encryptionAlgorithmsServerToClient=(0,M.algorithmNames)(m.encryptionAlgorithms),y.macAlgorithmsClientToServer=y.macAlgorithmsServerToClient=(0,M.algorithmNames)(m.hmacAlgorithms),y.compressionAlgorithmsClientToServer=y.compressionAlgorithmsServerToClient=(0,M.algorithmNames)(m.compressionAlgorithms),y.languagesClientToServer=[""],y.languagesServerToClient=[""],y.firstKexPacketFollows=!1,y.reserved=0,y}getPublicKeyAlgorithms(){var h,m;let y=[...this.session.config.publicKeyAlgorithms];if(y.length>1&&!this.isClientSession){const v=null===(m=null===(h=this.session.credentials)||void 0===h?void 0:h.publicKeys)||void 0===m?void 0:m.map(h=>h.keyAlgorithmName);v&&(y=y.filter(h=>h&&v.includes(h.keyAlgorithmName)))}return(0,M.algorithmNames)(y)}async createKeyExchangeGuessMessage(){if(!this.exchangeContext)throw new Error("Key exchange was not started.");const h=this.session.config.keyExchangeAlgorithms[0];if(!h)return null;this.exchangeContext.keyExchange=h.name,this.exchangeContext.exchange=h.createKeyExchange(),this.exchangeContext.exchangeValue=await this.exchangeContext.exchange.startKeyExchange();const m=new R.KeyExchangeDhInitMessage;return m.e=this.exchangeContext.exchangeValue,m}handleMessage(h,m){if(h instanceof R.KeyExchangeInitMessage)return this.handleInitMessage(h,m);if(h instanceof R.KeyExchangeDhInitMessage)return this.handleDhInitMessage(h,m);if(h instanceof R.KeyExchangeDhReplyMessage)return this.handleDhReplyMessage(h,m);throw new Error(`Message not implemented: ${h}`)}async handleInitMessage(h,m){var y,v,C,w,A;if(!this.exchangeContext)throw new Error("Key exchange was not started.");const P=this.session.config;if(this.exchangeContext.keyExchange=this.chooseAlgorithm("KeyExchange",(0,M.algorithmNames)(P.keyExchangeAlgorithms),h.keyExchangeAlgorithms),"none"===this.exchangeContext.keyExchange)return(0,T.trace)("Client and server negotiated no security. Cancelling key-exchange."),this.exchangeContext.newAlgorithms=new x.SshSessionAlgorithms,void await this.session.handleNewKeysMessage(new R.NewKeysMessage,m);let k;if(this.exchangeContext.publicKey=this.chooseAlgorithm("PublicKey",this.getPublicKeyAlgorithms(),h.serverHostKeyAlgorithms),this.exchangeContext.clientEncryption=this.chooseAlgorithm("ClientEncryption",(0,M.algorithmNames)(P.encryptionAlgorithms),h.encryptionAlgorithmsClientToServer),this.exchangeContext.serverEncryption=this.chooseAlgorithm("ServerEncryption",(0,M.algorithmNames)(P.encryptionAlgorithms),h.encryptionAlgorithmsServerToClient),this.exchangeContext.clientHmac=this.chooseAlgorithm("ClientHmac",(0,M.algorithmNames)(P.hmacAlgorithms),h.macAlgorithmsClientToServer),this.exchangeContext.serverHmac=this.chooseAlgorithm("ServerHmac",(0,M.algorithmNames)(P.hmacAlgorithms),h.macAlgorithmsServerToClient),this.exchangeContext.clientCompression=this.chooseAlgorithm("ClientCompression",(0,M.algorithmNames)(P.compressionAlgorithms),h.compressionAlgorithmsClientToServer),this.exchangeContext.serverCompression=this.chooseAlgorithm("ServerCompression",(0,M.algorithmNames)(P.compressionAlgorithms),h.compressionAlgorithmsServerToClient),this.isClientSession){this.exchangeContext.serverKexInitPayload=h.toBuffer();const v=!!this.exchangeContext.exchangeValue,C=this.exchangeContext.keyExchange===(null===(y=P.keyExchangeAlgorithms[0])||void 0===y?void 0:y.name);if(!v||!C){const h=P.getKeyExchangeAlgorithm(this.exchangeContext.keyExchange);this.exchangeContext.exchange=h.createKeyExchange(),this.exchangeContext.exchangeValue=await this.exchangeContext.exchange.startKeyExchange();const y=new R.KeyExchangeDhInitMessage;y.e=this.exchangeContext.exchangeValue,await this.session.sendMessage(y,m)}k="ext-info-s"}else{if(h.firstKexPacketFollows){const m=this.exchangeContext.keyExchange===(null===(v=h.keyExchangeAlgorithms)||void 0===v?void 0:v[0]),y=m?"correct":"incorrect";if((0,T.trace)(`Client's KeyExchange guess was ${y}.`),this.exchangeContext.discardGuessedInit=!m,m&&this.session.remoteVersion.isVsSsh&&(null===(C=this.session.remoteVersion.version)||void 0===C?void 0:C.startsWith("2."))){(null===(w=h.keyExchangeAlgorithms)||void 0===w?void 0:w[0])===(null===(A=P.keyExchangeAlgorithms[0])||void 0===A?void 0:A.name)||((0,T.trace)("Ignoring correct guess for compatibility with older client."),this.exchangeContext.discardGuessedInit=!0)}}this.exchangeContext.clientKexInitPayload=h.toBuffer(),k="ext-info-c"}this.isInitialExchange&&h.keyExchangeAlgorithms.includes(k)&&await this.session.sendExtensionInfo(m)}async handleDhInitMessage(h,m){var y,v,C,T,A,P,k;if(this.isClientSession)return;const M=this.session;if(!this.exchangeContext||!this.exchangeContext.keyExchange||!this.exchangeContext.publicKey)throw new D.SshConnectionError("Key exchange not started.",I.SshDisconnectReason.protocolError);if(this.exchangeContext.discardGuessedInit)return void(this.exchangeContext.discardGuessedInit=!1);const N=this.session.config.getKeyExchangeAlgorithm(this.exchangeContext.keyExchange);if(!N)throw new D.SshConnectionError("Key exchange not supported for algorithm: "+this.exchangeContext.keyExchange,I.SshDisconnectReason.keyExchangeFailed);const L=this.session.config.getPublicKeyAlgorithm(this.exchangeContext.publicKey);if(!L)throw new D.SshConnectionError("Public key algorithm not supported: "+this.exchangeContext.publicKey,I.SshDisconnectReason.keyExchangeFailed);let U=null;if(null===(y=M.credentials)||void 0===y?void 0:y.publicKeys){const h=M.credentials.publicKeys.find(h=>h.keyAlgorithmName===L.keyAlgorithmName);if(U=null!=h?h:null,!1===(null==U?void 0:U.hasPrivateKey)){if(!M.credentials.privateKeyProvider)throw new Error("A private key provider is required.");U=await M.credentials.privateKeyProvider(h,null!=m?m:O.CancellationToken.None)}}if(null==U)throw new D.SshConnectionError("Private key not found for algorithm: "+this.exchangeContext.publicKey,I.SshDisconnectReason.keyExchangeFailed);const B=this.session.config.getEncryptionAlgorithm(this.exchangeContext.clientEncryption),W=this.session.config.getEncryptionAlgorithm(this.exchangeContext.serverEncryption),q=this.session.config.getHmacAlgorithm(this.exchangeContext.serverHmac),Y=this.session.config.getHmacAlgorithm(this.exchangeContext.clientHmac),V=N.createKeyExchange(),$=h.e||w.Buffer.alloc(0),z=await V.startKeyExchange(),G=await V.decryptKeyExchange($),J=await U.getPublicKeyBytes(L.name);if(!J)throw new D.SshConnectionError("Public key not set.",I.SshDisconnectReason.keyExchangeFailed);const X=await this.computeExchangeHash(V,J,$,z,G);this.session.sessionId||(this.session.sessionId=X);const[Z,ee,te,re,ie,se]=await this.computeKeys(V,G,X,B,W,Y,q),oe=null!==(v=await(null==W?void 0:W.createCipher(!0,re,ee)))&&void 0!==v?v:null,ae=null!==(C=await(null==B?void 0:B.createCipher(!1,te,Z)))&&void 0!==C?C:null,ce=null!==(T=await(null==q?void 0:q.createSigner(se)))&&void 0!==T?T:null,le=null!==(A=await(null==Y?void 0:Y.createVerifier(ie)))&&void 0!==A?A:null,ue=new x.SshSessionAlgorithms;ue.publicKeyAlgorithmName=this.exchangeContext.publicKey,ue.cipher=oe,ue.decipher=ae,ue.signer=ce,ue.verifier=le,ue.messageSigner=(null===(P=oe)||void 0===P?void 0:P.authenticatedEncryption)?oe:ce,ue.messageVerifier=(null===(k=ae)||void 0===k?void 0:k.authenticatedEncryption)?ae:le,ue.compressor=this.session.config.getCompressionAlgorithm(this.exchangeContext.serverCompression),ue.decompressor=this.session.config.getCompressionAlgorithm(this.exchangeContext.clientCompression),this.exchangeContext.newAlgorithms=ue,Z&&Z.fill(0),te&&te.fill(0),ie&&ie.fill(0),ee&&ee.fill(0),re&&re.fill(0),se&&se.fill(0);const de=L.createSigner(U);let he=await de.sign(X);he=L.createSignatureData(he);const pe=new R.KeyExchangeDhReplyMessage;pe.hostKey=J,pe.f=z,pe.signature=he,await this.session.sendMessage(pe,m),await this.session.sendMessage(new R.NewKeysMessage,m)}async handleDhReplyMessage(h,m){var y,v,C,w,A,P,k,M;if(!this.isClientSession)return;if(!this.exchangeContext)throw new D.SshConnectionError("Key exchange was not started.",I.SshDisconnectReason.protocolError);const N=this.session.config,O=this.exchangeContext.exchange,L=this.exchangeContext.publicKey,U=N.getPublicKeyAlgorithm(L),B=N.getEncryptionAlgorithm(this.exchangeContext.clientEncryption),W=N.getEncryptionAlgorithm(this.exchangeContext.serverEncryption),q=N.getHmacAlgorithm(this.exchangeContext.serverHmac),Y=N.getHmacAlgorithm(this.exchangeContext.clientHmac),V=this.exchangeContext.exchangeValue,$=h.f;if(!O||!V)throw new D.SshConnectionError("Failed to initialize crypto after key exchange.",I.SshDisconnectReason.keyExchangeFailed);this.hostKey=U.createKeyPair(),await this.hostKey.setPublicKeyBytes(h.hostKey);const z=await O.decryptKeyExchange($),G=h.hostKey,J=await this.computeExchangeHash(O,G,V,$,z),X=U.readSignatureData(h.signature),Z=U.createVerifier(this.hostKey);let ee;try{ee=await Z.verify(J,X)}catch(h){if(!(h instanceof Error))throw h;throw(0,T.trace)(`Server public key verification error: ${null!==(y=h.message)&&void 0!==y?y:h}`),new D.SshConnectionError("Server public key verification failed: "+(null!==(v=h.message)&&void 0!==v?v:h),I.SshDisconnectReason.hostKeyNotVerifiable)}if(!ee)throw(0,T.trace)("Server public key verification failed."),new D.SshConnectionError("Server public key verification failed.",I.SshDisconnectReason.hostKeyNotVerifiable);(0,T.trace)("Server public key verification succeeded."),null==this.session.sessionId&&(this.session.sessionId=J);const[te,re,ie,se,oe,ae]=await this.computeKeys(O,z,J,B,W,Y,q),ce=null!==(C=await(null==B?void 0:B.createCipher(!0,ie,te)))&&void 0!==C?C:null,le=null!==(w=await(null==W?void 0:W.createCipher(!1,se,re)))&&void 0!==w?w:null,ue=null!==(A=await(null==Y?void 0:Y.createSigner(oe)))&&void 0!==A?A:null,de=null!==(P=await(null==q?void 0:q.createVerifier(ae)))&&void 0!==P?P:null,he=new x.SshSessionAlgorithms;he.publicKeyAlgorithmName=L,he.cipher=ce,he.decipher=le,he.signer=ue,he.verifier=de,he.messageSigner=(null===(k=ce)||void 0===k?void 0:k.authenticatedEncryption)?ce:ue,he.messageVerifier=(null===(M=le)||void 0===M?void 0:M.authenticatedEncryption)?le:de,he.compressor=N.getCompressionAlgorithm(this.exchangeContext.clientCompression),he.decompressor=N.getCompressionAlgorithm(this.exchangeContext.serverCompression),this.exchangeContext.newAlgorithms=he,te&&te.fill(0),ie&&ie.fill(0),oe&&oe.fill(0),re&&re.fill(0),se&&se.fill(0),ae&&ae.fill(0),await this.session.sendMessage(new R.NewKeysMessage,m)}chooseAlgorithm(h,m,y){var v;let C,w;this.isClientSession?(C=y||[],w=m):(C=m,w=y||[]);const A=`${h} negotiation: `+`Server (${C.join(", ")}) `+`Client (${w.join(", ")})`;if(this.session.remoteVersion.isVsSsh&&(null===(v=this.session.remoteVersion.version)||void 0===v?void 0:v.startsWith("2."))){const h=C;C=w,w=h}for(let h of w)for(let m of C)if(m===h){const h=m;return(0,T.trace)(`${A} => ${h}`),h}throw new Error(`Failed ${A}`)}async computeExchangeHash(h,m,y,v,C){if(!this.session.remoteVersion)throw new Error("Key exchange not completed.");const T=new N.SshDataWriter(w.Buffer.alloc(2048));return this.isClientSession?(T.writeString(A.SshSession.localVersion.toString(),"ascii"),T.writeString(this.session.remoteVersion.toString(),"ascii")):(T.writeString(this.session.remoteVersion.toString(),"ascii"),T.writeString(A.SshSession.localVersion.toString(),"ascii")),T.writeBinary(this.exchangeContext.clientKexInitPayload),T.writeBinary(this.exchangeContext.serverKexInitPayload),T.writeBinary(m),T.writeBigInt(k.BigInt.fromBytes(y,{unsigned:!0})),T.writeBigInt(k.BigInt.fromBytes(v,{unsigned:!0})),T.writeBigInt(k.BigInt.fromBytes(C,{unsigned:!0})),await h.sign(T.toBuffer())}async computeKeys(h,m,y,v,C,T,A){var P,k;const R=new N.SshDataWriter(w.Buffer.alloc(4+m.length+y.length+Math.max(1+(null!==(k=null===(P=this.session.sessionId)||void 0===P?void 0:P.length)&&void 0!==k?k:0),h.digestLength)));R.writeBinary(m),R.write(y);const M=R.position;return[v&&await this.computeKey(h,R,M,v.blockLength,"A"),C&&await this.computeKey(h,R,M,C.blockLength,"B"),v&&await this.computeKey(h,R,M,v.keyLength,"C"),C&&await this.computeKey(h,R,M,C.keyLength,"D"),T&&await this.computeKey(h,R,M,T.keyLength,"E"),A&&await this.computeKey(h,R,M,A.keyLength,"F")]}async computeKey(h,m,y,v,C){const T=w.Buffer.alloc(v);let A=0,P=0,k=null;if(!this.session.sessionId)throw new Error("Session ID not set.");for(;A<v;)m.position=y,k?m.write(k):(m.writeByte(C.charCodeAt(0)),m.write(this.session.sessionId)),k=await h.sign(m.toBuffer()),P=Math.min(k.length,v-A),k.copy(T,A),A+=P;return k&&k.fill(0),T}};U.serviceName="ssh-keyexchange",U=v=C([(0,L.serviceActivation)({serviceRequest:v.serviceName})],U),m.KeyExchangeService=U},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0}),m.ChannelMetrics=void 0;m.ChannelMetrics=class ChannelMetrics{constructor(){this.bytesSentSum=0,this.bytesReceivedSum=0}get bytesSent(){return this.bytesSentSum}get bytesReceived(){return this.bytesReceivedSum}addBytesSent(h){this.bytesSentSum+=h}addBytesReceived(h){this.bytesReceivedSum+=h}toString(){return`Bytes S/R: ${this.bytesSent} / ${this.bytesReceived}; `}}},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0}),m.SshChannelClosedEventArgs=void 0;m.SshChannelClosedEventArgs=class SshChannelClosedEventArgs{constructor(h,m){"number"==typeof h?this.exitStatus=h:"string"==typeof h?(this.exitSignal=h,this.errorMessage=m):h instanceof Error&&(this.error=h)}}},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0}),m.SshVersionInfo=void 0;const v=y(435),C=v.name.replace(/^@\w+\//,""),T=v.version;class SshVersionInfo{constructor(h,m,y,v){this.versionString=h,this.protocolVersion=m,this.name=y,this.version=v}static tryParse(h){if(!h)throw new TypeError("Version string expected.");if(!h.startsWith("SSH-"))return null;const m=h.indexOf("-",4);if(m<=0)return null;const y=h.substring(4,m);if(!/^\d+\.\d+$/.test(y))return null;let v,C;const T=h.substring(m+1),w=T.indexOf(" "),A=T.lastIndexOf("_",w>=0?w:T.length-1);if(A>=0){v=T.substring(0,A).replace(/_/g," "),C=T.substring(A+1);for(let h=0;h<C.length;h++){const m=C[h];if(!(m>="0"&&m<="9")&&"."!==m){C=C.substring(0,h);break}}/^\d+(\.\d+)*$/.test(C)||(C=null)}else v=T,C=null;return new SshVersionInfo(h,y,v,C)}static getLocalVersion(){return new SshVersionInfo(`SSH-2.0-${C}_${T}`,"2.0",C,T)}toString(){return this.versionString}get isVsSsh(){return this.isVsSshCS||this.isVsSshTS}get isVsSshCS(){return"Microsoft.VisualStudio.Ssh"===this.name}get isVsSshTS(){return"vs-ssh"===this.name}}m.SshVersionInfo=SshVersionInfo},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0}),m.SshChannelOpeningEventArgs=void 0;const v=y(76);m.SshChannelOpeningEventArgs=class SshChannelOpeningEventArgs{constructor(h,m,y){if(this.request=h,this.channel=m,this.isRemoteRequest=y,this.failureReason=v.SshChannelOpenFailureReason.none,this.failureDescription=null,!h)throw new TypeError("A channel open message is required.");if(!m)throw new TypeError("A channel is required.")}toString(){return`${this.channel.toString()}${this.failureReason?" "+v.SshChannelOpenFailureReason[this.failureReason]:""}`}}},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0}),m.AuthenticationSuccessMessage=m.AuthenticationFailureMessage=m.PasswordRequestMessage=m.PublicKeyOKMessage=m.PublicKeyRequestMessage=m.AuthenticationRequestMessage=m.AuthenticationMessage=void 0;const v=y(101);class AuthenticationMessage extends v.SshMessage{}m.AuthenticationMessage=AuthenticationMessage;class AuthenticationRequestMessage extends AuthenticationMessage{get messageType(){return 50}onRead(h){this.username=h.readString("utf8"),this.serviceName=h.readString("ascii"),this.methodName=h.readString("ascii")}onWrite(h){h.writeString(this.username||"","utf8"),h.writeString(this.serviceName||"","ascii"),h.writeString(this.validateField(this.methodName,"method name"),"ascii")}}m.AuthenticationRequestMessage=AuthenticationRequestMessage;m.PublicKeyRequestMessage=class PublicKeyRequestMessage extends AuthenticationRequestMessage{constructor(){super(),this.methodName="publickey"}get hasSignature(){return!!(this.signature&&this.signature.length>0)}onRead(h){super.onRead(h);const m=h.readBoolean();this.keyAlgorithmName=h.readString("ascii"),this.publicKey=h.readBinary(),m?(this.signature=h.readBinary(),this.payloadWithoutSignature=this.rawBytes.slice(0,this.rawBytes.length-this.signature.length-4)):this.signature=void 0}onWrite(h){var m,y;if(super.onWrite(h),!this.keyAlgorithmName)throw new Error("Key algorithm name not set.");if("hostbased"===this.methodName){if(h.writeString(this.keyAlgorithmName,"ascii"),h.writeBinary(this.publicKey||Buffer.alloc(0)),h.writeString(null!==(m=this.clientHostname)&&void 0!==m?m:"","ascii"),h.writeString(null!==(y=this.clientUsername)&&void 0!==y?y:"","ascii"),!this.hasSignature)throw new Error("A signature is required for a host-based authentcation request.");h.writeBinary(this.signature)}else h.writeBoolean(this.hasSignature),h.writeString(this.keyAlgorithmName,"ascii"),h.writeBinary(this.publicKey||Buffer.alloc(0)),this.hasSignature&&h.writeBinary(this.signature)}};m.PublicKeyOKMessage=class PublicKeyOKMessage extends AuthenticationMessage{get messageType(){return 60}onRead(h){this.keyAlgorithmName=h.readString("ascii"),this.publicKey=h.readBinary()}onWrite(h){if(!this.keyAlgorithmName)throw new Error("Key algorithm name not set.");if(!this.publicKey)throw new Error("Public key not set.");h.writeString(this.keyAlgorithmName,"ascii"),h.writeBinary(this.publicKey)}};m.PasswordRequestMessage=class PasswordRequestMessage extends AuthenticationRequestMessage{constructor(){super(),this.methodName="password"}onRead(h){super.onRead(h),h.readBoolean(),this.password=h.readString("utf8")}onWrite(h){super.onWrite(h),h.writeBoolean(!1),h.writeString(this.password||"","utf8")}};class AuthenticationFailureMessage extends AuthenticationMessage{constructor(){super(...arguments),this.partialSuccess=!1}get messageType(){return 51}onRead(h){this.methodNames=h.readList("ascii"),this.partialSuccess=h.readBoolean()}onWrite(h){h.writeList(this.methodNames||[],"ascii"),h.writeBoolean(this.partialSuccess)}}m.AuthenticationFailureMessage=AuthenticationFailureMessage;class AuthenticationSuccessMessage extends AuthenticationMessage{get messageType(){return 52}onRead(h){}onWrite(h){}}m.AuthenticationSuccessMessage=AuthenticationSuccessMessage,v.SshMessage.index.set(50,AuthenticationRequestMessage),v.SshMessage.index.set(51,AuthenticationFailureMessage),v.SshMessage.index.set(52,AuthenticationSuccessMessage)},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0}),m.SessionMetrics=void 0;const v=y(6);m.SessionMetrics=class SessionMetrics{constructor(){this.startTime=0,this.messagesSentCount=0,this.messagesReceivedCount=0,this.bytesSentSum=0,this.bytesReceivedSum=0,this.reconnectionsCount=0,this.currentLatency=0,this.minLatency=0,this.maxLatency=0,this.latencySum=0,this.latencyCount=0,this.messageSentEmitter=new v.Emitter,this.onMessageSent=this.messageSentEmitter.event,this.messageReceivedEmitter=new v.Emitter,this.onMessageReceived=this.messageReceivedEmitter.event,this.latencyUpdatedEmitter=new v.Emitter,this.onLatencyUpdated=this.latencyUpdatedEmitter.event,this.sessionClosedEmitter=new v.Emitter,this.onSessionClosed=this.sessionClosedEmitter.event,"object"==typeof performance&&performance.now?Object.defineProperty(this,"time",{get:this.browserTime}):"object"==typeof process&&process.hrtime&&Object.defineProperty(this,"time",{get:this.nodejsTime}),this.startTime=this.time}get time(){return Date.now()-this.startTime}browserTime(){return performance.now()-this.startTime}nodejsTime(){const[h,m]=process.hrtime();return 1e3*h+m/1e6-this.startTime}get messagesSent(){return this.messagesSentCount}get messagesReceived(){return this.messagesReceivedCount}get bytesSent(){return this.bytesSentSum}get bytesReceived(){return this.bytesReceivedSum}get reconnections(){return this.reconnectionsCount}get latencyAverageMs(){return 0===this.latencyCount?0:this.latencySum/this.latencyCount}get latencyMinMs(){return this.minLatency}get latencyMaxMs(){return this.maxLatency}get latencyCurrentMs(){return this.currentLatency}addMessageSent(h){this.messagesSentCount++,this.bytesSentSum+=h,this.messageSentEmitter.fire({time:this.time,size:h})}addMessageReceived(h){this.messagesReceivedCount++,this.bytesReceivedSum+=h,this.messageReceivedEmitter.fire({time:this.time,size:h})}addReconnection(){this.reconnectionsCount++}updateLatency(h){if(h<0)throw new Error("Measured latency cannot be negative.");this.currentLatency=h,0!==h&&((0===this.minLatency||h<this.minLatency)&&(this.minLatency=h),(0===this.maxLatency||h>this.maxLatency)&&(this.maxLatency=h),this.latencySum+=h,this.latencyCount++,this.latencyUpdatedEmitter.fire({time:this.time,latency:h}))}close(){this.currentLatency=0,this.sessionClosedEmitter.fire()}toString(){let h=`Messages S/R: ${this.messagesSent} / ${this.messagesReceived}; `+`Bytes S/R: ${this.bytesSent} / ${this.bytesReceived}; `+`Reconnections: ${this.reconnections}; `;const m=this.minLatency>=10?1:this.minLatency>=1?10:100;if(this.maxLatency>0){h+=`Latency Min-Avg-Max: ${Math.round(this.minLatency*m)/m} - ${Math.round(this.latencySum/this.latencyCount*m)/m} - ${Math.round(this.maxLatency*m)/m} ms; `}if(this.currentLatency>0){h+=`Current Latency: ${Math.round(this.currentLatency*m)/m} ms; `}return h}}},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0}),m.SshSessionClosedEventArgs=void 0;const v=y(55);m.SshSessionClosedEventArgs=class SshSessionClosedEventArgs{constructor(h,m,y){if(this.reason=h,this.message=m,this.error=y,!m)throw new TypeError("A disconnect message is required.")}toString(){return`${v.SshDisconnectReason[this.reason]}: ${this.message}`}}},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0}),m.SshStream=void 0;const v=y(77),C=y(19);class SshStream extends C.Duplex{constructor(h){let m=null;super({async write(m,y,v){let C;try{let v;if("string"==typeof m)v=Buffer.from(m,y);else{if(!(m instanceof Buffer))throw new Error("Unsupported chunk type: "+typeof m);v=m}await h.send(v)}catch(h){if(!(h instanceof Error))throw h;C=h}v&&v(C)},async writev(m,y){let v;try{if(1===m.length)return this.write(m[0].chunk,m[0].encoding,y);{const y=m.reduce((function BufferReduce(h,m){if(m.chunk instanceof Buffer)return h+m.chunk.length;throw new Error("Unsupported chunk type: "+typeof m.chunk)}),0),v=Buffer.alloc(y);let C=0;for(let h=0;h<m.length;h++)m[h].chunk.copy(v,C),C+=m[h].chunk.length;await h.send(v)}}catch(h){if(!(h instanceof Error))throw h;v=h}y&&y(v)},async final(m){let y;try{await h.close()}catch(h){if(!(h instanceof Error))throw h;y=h}m&&m(y)},read(){m&&(m.resolve(),m=null)}});const y=this;h.onDataReceived(async C=>{const T=Buffer.alloc(C.length);C.copy(T),y.push(T)||(m||(m=new v.PromiseCompletionSource),await m.promise),h.adjustWindow(T.length)}),h.onClosed(()=>{y.push(null)}),this.channel=h}toString(){return`SshStream(Channel Type: ${this.channel.channelType}, Id: ${this.channel.channelId}, RemoteId: ${this.channel.remoteChannelId})`}}m.SshStream=SshStream},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0});const v=y(0),C=y(4);m.WorkspaceServices=class WorkspaceServices{constructor(h){this.onServiceAddedEmitter=new v.EventEmitter,this.onServiceRemovedEmitter=new v.EventEmitter,this.registeredServices=new Set,this.onServiceAdded=this.onServiceAddedEmitter.event,this.onServiceRemoved=this.onServiceRemovedEmitter.event,h.onServicesChanged(h=>{h.changeType===C.vsls.CollectionChangeType.Add?h.serviceNames.forEach(h=>{this.registeredServices.add(h),this.onServiceAddedEmitter.fire(h)}):h.changeType===C.vsls.CollectionChangeType.Remove&&h.serviceNames.forEach(h=>{this.registeredServices.delete(h),this.onServiceRemovedEmitter.fire(h)})})}}},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0}),m.defaultSettings={name:"Visual Studio Live Share",configName:"liveshare",serviceUri:"https://prod.liveshare.vsengsaas.visualstudio.com/",signalRServiceUri:"https://signlr-prod.core.vsengsaas.visualstudio.com/api/signalr/signalrhub",abbreviation:"VSLS",scheme:"vsls",authority:"vsls",canCollectPII:!1,activityTimeout:3e5,commandPrefix:"liveshare",featureSet:"stable",remoteSettingsUri:"https://az700632.vo.msecnd.net/pub/VSLiveShare/VSCode/",remoteSettingsUpdateMinutes:"60",textSearchResultsLimit:1e4,textSearchPreviewLimit:200}},function(h,m,y){"use strict";var v=this&&this.__awaiter||function(h,m,y,v){return new(y||(y=Promise))((function(C,T){function fulfilled(h){try{step(v.next(h))}catch(h){T(h)}}function rejected(h){try{step(v.throw(h))}catch(h){T(h)}}function step(h){h.done?C(h.value):function adopt(h){return h instanceof y?h:new y((function(m){m(h)}))}(h.value).then(fulfilled,rejected)}step((v=v.apply(h,m||[])).next())}))};Object.defineProperty(m,"__esModule",{value:!0});const C=y(0),T=y(26),w=y(178),A=y(95);m.showInvitationLink=function showInvitationLink(h,m,y,P){return v(this,void 0,void 0,(function*(){if(m&&m!==T.workspaceSessionInfoTracker.workspaceSessionInfo.joinUri)yield C.window.showErrorMessage("This invite link has expired. Share again to generate a new link.");else{const m=T.workspaceSessionInfoTracker.workspaceSessionInfo.joinUri;if(y)return void(yield C.window.showInputBox({prompt:"Copy Live Share invitation link",value:m,ignoreFocusOut:!0}));const v=yield(new A.ClipboardUtil).copyToClipboardAsync(m),k={id:1,title:"More info"},R={id:2,title:v?"Copy again":"Copy link"};let M=[k,R];const N={id:3,title:T.workspaceSessionInfoTracker.isReadOnly?"Make read/write":"Make read-only"};!1!==P&&M.splice(0,0,N);const D=yield C.window.showInformationMessage((v?"Invitation link copied to clipboard! Send it to anyone you trust ":'Session shared! Click "Copy link" to get an invitation link ')+'or click "More info" to learn about secure sharing.',!0,...M);D&&D.id===R.id?yield showInvitationLink(h,m,!v,P):D&&D.id===k.id?yield w.showWelcomePage(w.WelcomePageSource.Sharing):D&&D.id===N.id&&(yield h.setReadOnly(!T.workspaceSessionInfoTracker.isReadOnly))}}))}},function(h,m,y){"use strict";var v=this&&this.__awaiter||function(h,m,y,v){return new(y||(y=Promise))((function(C,T){function fulfilled(h){try{step(v.next(h))}catch(h){T(h)}}function rejected(h){try{step(v.throw(h))}catch(h){T(h)}}function step(h){h.done?C(h.value):function adopt(h){return h instanceof y?h:new y((function(m){m(h)}))}(h.value).then(fulfilled,rejected)}step((v=v.apply(h,m||[])).next())}))};Object.defineProperty(m,"__esModule",{value:!0});const C=y(0),T=new(y(2).Mutex);m.executeNextCommand=function executeNextCommand(h,...m){return v(this,void 0,void 0,(function*(){return yield T.dispatch(()=>v(this,void 0,void 0,(function*(){return yield C.commands.executeCommand(h,...m)})))}))}},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0}),m.sharedTerminalName="[Shared]",m.isTaskTerminal=function isTaskTerminal(h,m){const y=m.creationOptions;return-1!==h.findIndex(h=>{var m;return null===(m=y.name)||void 0===m?void 0:m.includes(h.name)})},m.isSharedTerminal=function isSharedTerminal(h){const y=h.creationOptions;return!!y.name&&y.name.endsWith(m.sharedTerminalName)}},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0});const v=y(14),C=y(456),T=y(457),w=y(458),A=y(459);class DefaultFactoryConfig{constructor(){this.boolStrategy=new A.BooleanStrategy,this.inversedBoolStrategy=new A.BooleanStrategy(!0),this.connectionModeStrategy=new T.ConnectionModeStrategy,this.anonymousGuestApprovalStrategy=new C.AnonymousGuestApprovalStrategy,this.allowedDomainsStrategy=new w.AllowedDomainsStrategy}}m.DefaultFactoryConfig=DefaultFactoryConfig;m.ResolutionStrategyFactory=class ResolutionStrategyFactory{constructor(h){this.config=h||new DefaultFactoryConfig}resolve(h,m,y){let v=this.getResolutionStrategy(h);if(v)return v.resolvePolicy([m,y])}getResolutionStrategy(h){switch(h){case v.SettingKeys.allowGuestDebugControl:case v.SettingKeys.allowGuestTaskControl:case v.SettingKeys.autoShareServers:return this.config.boolStrategy;case v.SettingKeys.allowReadWriteTerminals:return this.config.inversedBoolStrategy;case v.SettingKeys.connectionMode:return this.config.connectionModeStrategy;case v.SettingKeys.anonymousGuestApproval:return this.config.anonymousGuestApprovalStrategy;case v.SettingKeys.allowedDomains:return this.config.allowedDomainsStrategy;default:return}}}},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0});m.AnonymousGuestApprovalStrategy=class AnonymousGuestApprovalStrategy{constructor(){this.default="prompt"}resolvePolicy(h){return h&&0!==h.length?h.includes("reject")?"reject":h.includes("prompt")?"prompt":h.includes("accept")?"accept":this.default:this.default}}},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0});m.ConnectionModeStrategy=class ConnectionModeStrategy{constructor(){this.default="auto"}resolvePolicy(h){return h&&0!==h.length?h.includes("direct")?"direct":h.includes("relay")?"relay":this.default:this.default}}},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0});m.AllowedDomainsStrategy=class AllowedDomainsStrategy{constructor(){this.default=[]}resolvePolicy(h){if(!h||0===h.length)return this.default;let m=new Array;return h.forEach(h=>{m=m.concat(h)}),m}}},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0});m.BooleanStrategy=class BooleanStrategy{constructor(h=!1){this.inverted=h,this.default=h}resolvePolicy(h){if(!h||0===h.length)return this.default;let m=h.reduce((h,m)=>h&&m);return this.inverted?!m:m}}},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0});const v=y(92),C=y(74),T=y(8),w=y(162);class ExtensionTelemetry{static sendShareFault(h,m,y,v){T.Telemetry.sendFault(w.TelemetryEventNames.SHARE_FAULT,h,m,y,v)}static sendJoinFault(h,m,y,v){T.Telemetry.sendFault(w.TelemetryEventNames.JOIN_FAULT,h,m,y,v)}static sendSignInFault(h,m,y,v){T.Telemetry.sendFault(w.TelemetryEventNames.SIGN_IN_FAULT,h,m,y,v)}static sendActivateExtensionFault(h,m,y,v){T.Telemetry.sendFault(w.TelemetryEventNames.ACTIVATE_EXTENSION_FAULT,h,m,y,v)}static sendDeactivateExtensionFault(h,m,y,v){T.Telemetry.sendFault(w.TelemetryEventNames.DEACTIVATE_EXTENSION_FAULT,h,m,y,v)}static sendActivateAgentAsyncFault(h,m,y,v){T.Telemetry.sendFault(w.TelemetryEventNames.ACTIVATE_AGENTASYNC_FAULT,h,m,y,v)}static sendTransition(h,m,y){let v=(new Date).getTime(),C=v-this.lastTransitionTime;this.lastTransitionTime=v;let A=new T.TelemetryEvent(w.TelemetryEventNames.TRANSITION);A.addProperty(w.TelemetryPropertyNames.CURRENT_STATE,h),A.addProperty(w.TelemetryPropertyNames.NEXT_STATE,m),A.addProperty(w.TelemetryPropertyNames.TRANSITION_ACTION,y),A.addMeasure(w.TelemetryPropertyNames.TRANSITION_SEQUENCE,this.transitionSeq++),A.addMeasure(w.TelemetryPropertyNames.TIME_SINCE_LAST_TRANSITION,C),A.send()}static reportChangedSetting(){new T.TelemetryEvent(w.TelemetryEventNames.CHANGE_SETTING).send()}static versionCheckFail(h,m,y){let v=new T.Fault(w.TelemetryEventNames.VERSION_CHECK_FAIL,T.FaultType.User,"Version check failed.");v.addProperty(w.TelemetryPropertyNames.VERSION_PLATFORMNAME,h),v.addProperty(w.TelemetryPropertyNames.VERSION_PLATFORMVERSION,m),v.addProperty(w.TelemetryPropertyNames.VERSION_PLATFORMVERSION_SERVICEPACK,String(y)),v.send()}static ReportFailedAssertion(h){new T.Fault(w.TelemetryEventNames.ASSERT_FAULT,T.FaultType.Error,h,new Error("Assertion Failed")).send()}static async setUserInfo(h){h&&h.emailAddress&&(h.emailAddress!==v.Settings.get(C.SettingKeys.userEmail)&&await v.Settings.save(C.SettingKeys.userEmail,h.emailAddress),h.emailAddress.endsWith("microsoft.com")&&!v.Settings.get(C.SettingKeys.isInternal)&&(await v.Settings.save(C.SettingKeys.isInternal,!0),T.Telemetry.addContextProperty(w.TelemetryPropertyNames.IS_INTERNAL,"true")))}static setServiceEndpoint(h){T.Telemetry.addContextProperty(w.TelemetryPropertyNames.SERVICE_ENDPOINT,h)}static setSettingsContextProperties(){T.Telemetry.addContextProperty(w.TelemetryPropertyNames.IS_INTERNAL,v.Settings.get(C.SettingKeys.isInternal)?"true":"false"),T.Telemetry.addContextProperty(w.TelemetryPropertyNames.IS_CLOUD_ENVIRONMENT,v.Settings.get(C.SettingKeys.isCloudEnvironment)?"true":"false"),T.Telemetry.addContextProperty(w.TelemetryPropertyNames.USER_TEAM_STATUS,v.Settings.get(C.SettingKeys.teamStatus)),T.Telemetry.addContextProperty(w.TelemetryPropertyNames.CONNECTION_MODE,v.Settings.get(C.SettingKeys.connectionMode)),T.Telemetry.addContextProperty(w.TelemetryPropertyNames.FEATURE_FLAGS,JSON.stringify(v.featureFlags))}static genericOperation(h,m,y){const v=new T.TelemetryEvent(h);v.addProperty(w.TelemetryPropertyNames.EVENT_RESULT,this.capitalizeFirstChar(m)),this.setPayloadAndSend(v,y)}static sendFault(h,m,y,v){const C=new T.Fault(h,v||T.FaultType.Error,m);this.setPayloadAndSend(C,y)}static setPayloadAndSend(h,m){if(m)for(let y in m)if(m.hasOwnProperty(y)){const v=void 0===m[y]||null===m[y]?void 0:m[y].toString();h.addProperty(w.TelemetryPropertyNames.FEATURE_NAME+this.capitalizeFirstChar(y),v)}T.Telemetry.correlate(h),h.send()}static capitalizeFirstChar(h){return h.charAt(0).toUpperCase()+h.slice(1)}}m.ExtensionTelemetry=ExtensionTelemetry,ExtensionTelemetry.transitionSeq=0,ExtensionTelemetry.lastTransitionTime=(new Date).getTime()},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0});class NotebookConstants{}m.NotebookConstants=NotebookConstants,NotebookConstants.cellIdPropertyName="vsls_cell_id",NotebookConstants.mirrorNotebookTypePrefix="vsls-",NotebookConstants.notebookErrorMimeType="application/vnd.code.notebook.error",NotebookConstants.notebookStandardErrorMimeType="application/vnd.code.notebook.stderr"},function(h,m,y){"use strict";var v=this&&this.__awaiter||function(h,m,y,v){return new(y||(y=Promise))((function(C,T){function fulfilled(h){try{step(v.next(h))}catch(h){T(h)}}function rejected(h){try{step(v.throw(h))}catch(h){T(h)}}function step(h){h.done?C(h.value):function adopt(h){return h instanceof y?h:new y((function(m){m(h)}))}(h.value).then(fulfilled,rejected)}step((v=v.apply(h,m||[])).next())}))};Object.defineProperty(m,"__esModule",{value:!0});const C=y(0),T=y(12),w=y(14);var A;function resetAnonymousAuthReloadFlag(){return v(this,void 0,void 0,(function*(){yield T.Settings.save(w.SettingKeys.anonymousAuthReloadFlag,null)}))}!function(h){h[h.Anonymous=0]="Anonymous",h[h.CustomAccount=1]="CustomAccount"}(A=m.SignInReloadMode||(m.SignInReloadMode={})),m.setAuthReloadFlag=function setAuthReloadFlag(h,m){return v(this,void 0,void 0,(function*(){m===A.Anonymous?(h.time=Date.now(),yield function setAnonymousAuthReloadFlag(h){return v(this,void 0,void 0,(function*(){yield T.Settings.save(w.SettingKeys.anonymousAuthReloadFlag,h)}))}(h)):m===A.CustomAccount&&(yield function setCustomAccountAuthReloadFlag(h){return v(this,void 0,void 0,(function*(){yield T.Settings.save(w.SettingKeys.customAccountAuthReloadFlag,h)}))}(h))}))},m.resetAuthReloadFlag=function resetAuthReloadFlag(h){return v(this,void 0,void 0,(function*(){h===A.Anonymous?yield resetAnonymousAuthReloadFlag():h===A.CustomAccount&&(yield function resetCustomAccountAuthReloadFlag(){return v(this,void 0,void 0,(function*(){yield T.Settings.save(w.SettingKeys.customAccountAuthReloadFlag,null)}))}())}))},m.isAnonymousAuthReloadFlagValid=function isAnonymousAuthReloadFlagValid(){return v(this,void 0,void 0,(function*(){const h=C.workspace.getConfiguration().get("vsliveshare.join.reload.workspaceId"),m=T.Settings.get(w.SettingKeys.anonymousAuthReloadFlag);return!!(m&&m.time&&m.workspaceId&&h)&&(Date.now()-m.time>=6e4?(yield resetAnonymousAuthReloadFlag(),!1):m.workspaceId.toLowerCase()===h.toLowerCase())}))}},function(h,m,y){"use strict";var v=this&&this.__awaiter||function(h,m,y,v){return new(y||(y=Promise))((function(C,T){function fulfilled(h){try{step(v.next(h))}catch(h){T(h)}}function rejected(h){try{step(v.throw(h))}catch(h){T(h)}}function step(h){h.done?C(h.value):function adopt(h){return h instanceof y?h:new y((function(m){m(h)}))}(h.value).then(fulfilled,rejected)}step((v=v.apply(h,m||[])).next())}))};Object.defineProperty(m,"__esModule",{value:!0});const C=y(70),T=y(2),w=y(34);m.progressCommandDecorator=function progressCommandDecorator(){return w.DecoratorHelper.setupDecorator(h=>new ProgressCommandDecorator(w.DecoratorHelper.getCoreCommand(h),h,C.dependencies.progressNotifierUtil()))};class ProgressCommandDecorator{constructor(h,m,y){this.command=h,this.next=m,this.progressNotifierUtil=y}invoke(h,m){return v(this,void 0,void 0,(function*(){let y=void 0;const{cancellationTokenSource:C}=m,w=C&&C.token;return y=yield this.progressNotifierUtil.create({title:m.commandName},w,y=>v(this,void 0,void 0,(function*(){return new Promise((A,P)=>v(this,void 0,void 0,(function*(){const cancel=()=>v(this,void 0,void 0,(function*(){const y=this.command;y.onCancellationRequested&&(yield y.onCancellationRequested(h,m)),P(new T.CancellationError("The operation was cancelled."))}));y&&(y.isCancellationRequested?yield cancel():y.onCancellationRequested(()=>v(this,void 0,void 0,(function*(){yield cancel()})))),C&&w&&(w.isCancellationRequested?yield cancel():w.onCancellationRequested(()=>v(this,void 0,void 0,(function*(){yield cancel()}))));try{A(yield this.next.invoke(h,m))}catch(h){P(h)}})))}))),y}))}}m.ProgressCommandDecorator=ProgressCommandDecorator},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0});const v=y(1116),C=y(1117),T=y(1118),w=y(1119);m.registerCommands=h=>{h.register("liveshare.signin",v.builder),h.register("liveshare.signout",C.builder),h.register("signInAndReload",T.builder),h.register("liveshare.focusParticipants",w.builder),h.register("liveshare.focusParticipantsFromActivityBar",w.builder),h.register("liveshare.focusParticipantsFromFileTreeExplorer",w.builder)}},function(h,m,y){"use strict";var v=this&&this.__awaiter||function(h,m,y,v){return new(y||(y=Promise))((function(C,T){function fulfilled(h){try{step(v.next(h))}catch(h){T(h)}}function rejected(h){try{step(v.throw(h))}catch(h){T(h)}}function step(h){h.done?C(h.value):function adopt(h){return h instanceof y?h:new y((function(m){m(h)}))}(h.value).then(fulfilled,rejected)}step((v=v.apply(h,m||[])).next())}))};Object.defineProperty(m,"__esModule",{value:!0});const C=y(8),T=y(23);m.createInittableDisposable=function createInittableDisposable(h){const m={isInited:!1,init:()=>v(this,void 0,void 0,(function*(){yield h(),m.isInited=!0})),dispose:()=>Promise.resolve()};return m},m.lazyInittable=function lazyInittable(h){return{isInited:!1,init:()=>v(this,void 0,void 0,(function*(){const m=h();"function"==typeof m.init&&(yield m.init())})),dispose:()=>v(this,void 0,void 0,(function*(){return Promise.resolve()}))}},m.initDisposableManager=function initDisposableManager(h,m){return v(this,void 0,void 0,(function*(){yield Promise.all(h.map(({instance:h,children:y,status:w})=>v(this,void 0,void 0,(function*(){try{yield h.init()}catch(h){if(C.Telemetry.sendFault("init-manager-fault",C.FaultType.Error,"",h),void 0===m||m)throw h}y&&(yield initDisposableManager(y,m)),w&&T.sessionStateTracker.point(w)}))))}))}},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0});const v=y(0),C=y(53);m.getAllRootFileSystemPaths=function getAllRootFileSystemPaths(){if(null==v.workspace.workspaceFolders||0===v.workspace.workspaceFolders.length)return{foundUnsupportedSchemes:!1,isVirtualWorkspace:!0,paths:[null]};const h=v.workspace.workspaceFolders.filter(h=>h.uri.scheme.toLowerCase()===C.PathManager.fileScheme),m=h.length>0,y=h.length!==v.workspace.workspaceFolders.length;return m?{foundUnsupportedSchemes:y,isVirtualWorkspace:!1,paths:h.map(h=>h.uri.fsPath)}:{foundUnsupportedSchemes:!1,isVirtualWorkspace:!0,paths:v.workspace.workspaceFolders.map(h=>h.uri.path)}}},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0});const v=y(65);class ConnectionStateError extends v.ConnectionError{constructor(){super(...arguments),this.errorType="ConnectionStateError"}}m.ConnectionStateError=ConnectionStateError},function(h,m,y){"use strict";var v=this&&this.__awaiter||function(h,m,y,v){return new(y||(y=Promise))((function(C,T){function fulfilled(h){try{step(v.next(h))}catch(h){T(h)}}function rejected(h){try{step(v.throw(h))}catch(h){T(h)}}function step(h){h.done?C(h.value):function adopt(h){return h instanceof y?h:new y((function(m){m(h)}))}(h.value).then(fulfilled,rejected)}step((v=v.apply(h,m||[])).next())}))};Object.defineProperty(m,"__esModule",{value:!0});const C=y(2),T=10*C.TIME_SECOND_MS;m.failedtoCheckConnectionMessage="failed to check connection";m.checkConnectionWithTimeout=(h,m,y,w)=>v(void 0,void 0,void 0,(function*(){const v=Date.now(),totalTime=()=>(Date.now()-v).toFixed(1);try{return null==m||m.verbose("checkConnectionWithTimeout -> 'started'"),yield C.timeoutPromise(h.checkConnection(),null!=y?y:T,void 0,w),null==m||m.verbose(`checkConnectionWithTimeout -> 'succeeded' t:${totalTime()}`),!0}catch(h){return h instanceof C.CancellationError?(null==m||m.verbose(`checkConnectionWithTimeout -> 'cancelled' t:${totalTime()}`),!0):(null==m||m.error(`checkConnectionWithTimeout -> 'failed' t:${totalTime()}`,h),!1)}}))},function(h,m,y){"use strict";var v=this&&this.__awaiter||function(h,m,y,v){return new(y||(y=Promise))((function(C,T){function fulfilled(h){try{step(v.next(h))}catch(h){T(h)}}function rejected(h){try{step(v.throw(h))}catch(h){T(h)}}function step(h){h.done?C(h.value):function adopt(h){return h instanceof y?h:new y((function(m){m(h)}))}(h.value).then(fulfilled,rejected)}step((v=v.apply(h,m||[])).next())}))};Object.defineProperty(m,"__esModule",{value:!0});const C=y(2),T=y(468),w=y(6),A=5*C.TIME_SECOND_MS;let P=0;m.checkWorkspaceClient=function checkWorkspaceClient(h,m,y,C,k){let R;y=null!=y?y:A,(m=m.createChild(`${++P}`)).info(`Start checking connection timeout:${y}`);const setTimeoutMetrics=()=>{R=setTimeout(onWorkspaceMetricsTimeout,y)},clearTimeoutMetrics=()=>{clearTimeout(R)};let M=!1;const N=new w.CancellationTokenSource,isDisposed=()=>N.token.isCancellationRequested,onWorkspaceMetricsTimeout=()=>v(this,void 0,void 0,(function*(){isDisposed()||(M=!0,k&&!k()||(yield T.checkConnectionWithTimeout(h,m,C,N))?setTimeoutMetrics():(m.info(`Failed check -> isDisposed:${isDisposed()}`),null==D||D.dispose(),isDisposed()||h.dispose(T.failedtoCheckConnectionMessage)),M=!1)}));h.rpcClient.onDispose(()=>{clearTimeoutMetrics()});const D=h.onWorkspaceMetricsUpdated(h=>{clearTimeoutMetrics(),M||setTimeoutMetrics()});return setTimeoutMetrics(),{dispose:()=>{m.info("Stop checking connection"),N.cancel(),null==D||D.dispose()}}}},function(h,m,y){"use strict";var v=this&&this.__awaiter||function(h,m,y,v){return new(y||(y=Promise))((function(C,T){function fulfilled(h){try{step(v.next(h))}catch(h){T(h)}}function rejected(h){try{step(v.throw(h))}catch(h){T(h)}}function step(h){h.done?C(h.value):function adopt(h){return h instanceof y?h:new y((function(m){m(h)}))}(h.value).then(fulfilled,rejected)}step((v=v.apply(h,m||[])).next())}))},C=this&&this.__importStar||function(h){if(h&&h.__esModule)return h;var m={};if(null!=h)for(var y in h)Object.hasOwnProperty.call(h,y)&&(m[y]=h[y]);return m.default=h,m},T=this&&this.__importDefault||function(h){return h&&h.__esModule?h:{default:h}};Object.defineProperty(m,"__esModule",{value:!0});const w=C(y(29)),A=y(1144),P=y(15),k=y(39),R=T(y(1164));class SshHelpers{static getRelayUri(h,m){if(!h.relayLink)throw new Error("Workspace does not have a relay endpoint.");return h.relayLink.replace("sb:","wss:").replace(".net/",".net:443/$hc/")+`?sb-hc-action=${m}&sb-hc-token=`+encodeURIComponent(h.relaySas||"")}static openConnection(h,y){const v=SshHelpers.getRelayUri(h,"connect");return y.log(P.LogLevel.Debug,`connecting to relay link:${h.relayLink}`),m.isNode()?(y.log(P.LogLevel.Debug,"creating node SSH..."),SshHelpers.nodeSshStreamFactory(v,h)):(y.log(P.LogLevel.Debug,"creating web SSH..."),SshHelpers.webSshStreamFactory(new WebSocket(v)))}static createSshClientSession(){return SshHelpers.createSshSession(h=>new w.SshClientSession(h))}static createSshServerSession(h){return SshHelpers.createSshSession(m=>new w.SshServerSession(m,h))}static authenticate(h,m,y,C,T){return v(this,void 0,void 0,(function*(){const v={username:"",password:y.sessionToken};if(h.onAuthenticating(h=>{h.authenticationPromise=SshHelpers.authenticateServer(m,h.publicKey)}),yield h.connect(C),!(yield h.authenticateServer()))throw new Error("Live Share server authentication failed.");if(T)yield h.authenticateClient(v,(h,m)=>{h||m||(h=new Error("Live Share client authentication failed.")),h?T.reject(h):T.resolve(h)});else if(!(yield h.authenticateClient(v)))throw new Error("Live Share client authentication failed.");return h}))}static createWebSocketStreamAdapter(h){return new w.WebSocketStream(new WebsocketStreamAdapter(h))}static webSshStreamFactory(h){return h.binaryType="arraybuffer",new Promise((m,y)=>{h.onopen=()=>{m(new w.WebSocketStream(h))},h.onerror=h=>{y(new Error("Failed to connect to relay url"))}})}static createSshSession(h){const m=new w.SshSessionConfiguration;return m.keyExchangeAlgorithms.splice(0),m.keyExchangeAlgorithms.push(w.SshAlgorithms.keyExchange.ecdhNistp384Sha384),m.keyExchangeAlgorithms.push(w.SshAlgorithms.keyExchange.ecdhNistp256Sha256),m.keyExchangeAlgorithms.push(w.SshAlgorithms.keyExchange.dhGroup14Sha256),m.protocolExtensions.push(w.SshProtocolExtensionNames.sessionReconnect),m.protocolExtensions.push(w.SshProtocolExtensionNames.sessionLatency),h(m)}static nodeSshStreamFactory(h,m){const y=new A.client;return new Promise((v,C)=>{y.on("connect",h=>{v(new w.WebSocketStream(new WebsocketStreamAdapter(h)))}),y.on("connectFailed",h=>{h.message&&h.message.startsWith("Error: ")&&(h.message=h.message.substr(7));let y=k.RelayErrorType.ServerError;/status: 401/.test(h.message)?(h.message=R.default["error.relaySasInvalid"],y=k.RelayErrorType.SasInvalid):/status: 404 Endpoint does not exist/.test(h.message)?(h.message=R.default["error.relayEndpointNotFound"],y=k.RelayErrorType.EndpointNotFound):/status: 404 There are no listeners connected/.test(h.message)?(h.message=R.default["error.relayListenerOffline"],y=k.RelayErrorType.ListenerOffline):/status: 500/.test(h.message)?(h.message=R.default["error.relayServerError"],y=k.RelayErrorType.ServerError):h.message=R.default["error.relayConnectionError"]+" "+h.message,C(new k.RelayConnectionError(h.message,{errorType:y,workspaceConnectionInfo:m}))}),y.connect(h)})}static authenticateServer(h,m){return v(this,void 0,void 0,(function*(){const y=w.SshAlgorithms.publicKey.rsaWithSha512,v=yield m.getPublicKeyBytes();for(const m of h&&h.hostPublicKeys||[]){const h=y.createKeyPair();yield h.setPublicKeyBytes(Buffer.from(m,"base64"));const C=yield h.getPublicKeyBytes();if(v.equals(C)){return{}}}return null}))}}m.SshHelpers=SshHelpers;class WebsocketStreamAdapter{constructor(h){this.connection=h}set onmessage(h){h&&this.connection.on("message",m=>{h({data:m.binaryData})})}set onclose(h){h&&this.connection.on("close",(m,y)=>{h({code:m,reason:y,wasClean:!(m||y)})})}send(h){Buffer.isBuffer(h)?this.connection.sendBytes(h):this.connection.sendBytes(Buffer.from(h))}close(h,m){h||m?this.connection.drop(h,m):this.connection.close()}}m.isNode=()=>"undefined"!=typeof process&&void 0!==process.release&&"node"===process.release.name},function(h,m,y){"undefined"!=typeof process&&"renderer"===process.type?h.exports=y(1147):h.exports=y(1149)},function(h,m,y){var v;function createDebug(h){function debug(){if(debug.enabled){var h=debug,y=+new Date,C=y-(v||y);h.diff=C,h.prev=v,h.curr=y,v=y;for(var T=new Array(arguments.length),w=0;w<T.length;w++)T[w]=arguments[w];T[0]=m.coerce(T[0]),"string"!=typeof T[0]&&T.unshift("%O");var A=0;T[0]=T[0].replace(/%([a-zA-Z%])/g,(function(y,v){if("%%"===y)return y;A++;var C=m.formatters[v];if("function"==typeof C){var w=T[A];y=C.call(h,w),T.splice(A,1),A--}return y})),m.formatArgs.call(h,T);var P=debug.log||m.log||console.log.bind(console);P.apply(h,T)}}return debug.namespace=h,debug.enabled=m.enabled(h),debug.useColors=m.useColors(),debug.color=function selectColor(h){var y,v=0;for(y in h)v=(v<<5)-v+h.charCodeAt(y),v|=0;return m.colors[Math.abs(v)%m.colors.length]}(h),"function"==typeof m.init&&m.init(debug),debug}(m=h.exports=createDebug.debug=createDebug.default=createDebug).coerce=function coerce(h){return h instanceof Error?h.stack||h.message:h},m.disable=function disable(){m.enable("")},m.enable=function enable(h){m.save(h),m.names=[],m.skips=[];for(var y=("string"==typeof h?h:"").split(/[\s,]+/),v=y.length,C=0;C<v;C++)y[C]&&("-"===(h=y[C].replace(/\*/g,".*?"))[0]?m.skips.push(new RegExp("^"+h.substr(1)+"$")):m.names.push(new RegExp("^"+h+"$")))},m.enabled=function enabled(h){var y,v;for(y=0,v=m.skips.length;y<v;y++)if(m.skips[y].test(h))return!1;for(y=0,v=m.names.length;y<v;y++)if(m.names[y].test(h))return!0;return!1},m.humanize=y(1148),m.names=[],m.skips=[],m.formatters={}},function(h,m,y){for(var v=y(11),C=y(10),T=y(20),w=y(13).EventEmitter,A=y(268),P=/,\s*/,k=/;\s*/,R=/[\r\n]/g,M=/,\s*/,N=["(",")","<",">","@",",",";",":","\\",'"',"/","[","]","?","=","{","}"," ",String.fromCharCode(9)],D=[String.fromCharCode(127)],I=0;I<31;I++)D.push(String.fromCharCode(I));var x=/([\x00-\x20\x22\x28\x29\x2c\x2f\x3a-\x3f\x40\x5b-\x5e\x7b\x7d\x7f])/,O=/[^\x21\x23-\x2b\x2d-\x3a\x3c-\x5b\x5d-\x7e]/,L=/^"[^"]*"$/,U=/[\x00-\x20\x3b]/g,B=/[;,] */,W={100:"Continue",101:"Switching Protocols",200:"OK",201:"Created",203:"Non-Authoritative Information",204:"No Content",205:"Reset Content",206:"Partial Content",300:"Multiple Choices",301:"Moved Permanently",302:"Found",303:"See Other",304:"Not Modified",305:"Use Proxy",307:"Temporary Redirect",400:"Bad Request",401:"Unauthorized",402:"Payment Required",403:"Forbidden",404:"Not Found",406:"Not Acceptable",407:"Proxy Authorization Required",408:"Request Timeout",409:"Conflict",410:"Gone",411:"Length Required",412:"Precondition Failed",413:"Request Entity Too Long",414:"Request-URI Too Long",415:"Unsupported Media Type",416:"Requested Range Not Satisfiable",417:"Expectation Failed",426:"Upgrade Required",500:"Internal Server Error",501:"Not Implemented",502:"Bad Gateway",503:"Service Unavailable",504:"Gateway Timeout",505:"HTTP Version Not Supported"};function WebSocketRequest(h,m,y){w.call(this),this.socket=h,this.httpRequest=m,this.resource=m.url,this.remoteAddress=h.remoteAddress,this.remoteAddresses=[this.remoteAddress],this.serverConfig=y,this._socketIsClosing=!1,this._socketCloseHandler=this._handleSocketCloseBeforeAccept.bind(this),this.socket.on("end",this._socketCloseHandler),this.socket.on("close",this._socketCloseHandler),this._resolved=!1}function cleanupFailedConnection(h){process.nextTick((function(){h.drop(1006,"TCP connection lost before handshake completed.",!0)}))}C.inherits(WebSocketRequest,w),WebSocketRequest.prototype.readHandshake=function(){var h=this,m=this.httpRequest;if(this.resourceURL=T.parse(this.resource,!0),this.host=m.headers.host,!this.host)throw new Error("Client must provide a Host header.");if(this.key=m.headers["sec-websocket-key"],!this.key)throw new Error("Client must provide a value for Sec-WebSocket-Key.");if(this.webSocketVersion=parseInt(m.headers["sec-websocket-version"],10),!this.webSocketVersion||isNaN(this.webSocketVersion))throw new Error("Client must provide a value for Sec-WebSocket-Version.");switch(this.webSocketVersion){case 8:case 13:break;default:var y=new Error("Unsupported websocket client version: "+this.webSocketVersion+"Only versions 8 and 13 are supported.");throw y.httpCode=426,y.headers={"Sec-WebSocket-Version":"13"},y}13===this.webSocketVersion?this.origin=m.headers.origin:8===this.webSocketVersion&&(this.origin=m.headers["sec-websocket-origin"]);var v=m.headers["sec-websocket-protocol"];(this.protocolFullCaseMap={},this.requestedProtocols=[],v)&&v.split(P).forEach((function(m){var y=m.toLocaleLowerCase();h.requestedProtocols.push(y),h.protocolFullCaseMap[y]=m}));if(!this.serverConfig.ignoreXForwardedFor&&m.headers["x-forwarded-for"]){var C=this.remoteAddress;this.remoteAddresses=m.headers["x-forwarded-for"].split(M),this.remoteAddresses.push(C),this.remoteAddress=this.remoteAddresses[0]}if(this.serverConfig.parseExtensions){var w=m.headers["sec-websocket-extensions"];this.requestedExtensions=this.parseExtensions(w)}else this.requestedExtensions=[];if(this.serverConfig.parseCookies){var A=m.headers.cookie;this.cookies=this.parseCookies(A)}else this.cookies=[]},WebSocketRequest.prototype.parseExtensions=function(h){if(!h||0===h.length)return[];var m=h.toLocaleLowerCase().split(P);return m.forEach((function(h,m,y){var v=h.split(k),C=v[0],T=v.slice(1);T.forEach((function(h,m,y){var v=h.split("="),C={name:v[0],value:v[1]};y.splice(m,1,C)}));var w={name:C,params:T};y.splice(m,1,w)})),m},WebSocketRequest.prototype.parseCookies=function(h){if(!h||"string"!=typeof h)return[];var m=[];return h.split(B).forEach((function(h){var y=h.indexOf("=");if(-1!==y){var v=h.substr(0,y).trim(),C=h.substr(++y,h.length).trim();'"'===C[0]&&(C=C.slice(1,-1)),m.push({name:v,value:decodeURIComponent(C)})}else m.push({name:h,value:null})})),m},WebSocketRequest.prototype.accept=function(h,m,y){var C;this._verifyResolution(),h?void 0===(C=this.protocolFullCaseMap[h.toLocaleLowerCase()])&&(C=h):C=h,this.protocolFullCaseMap=null;var T=v.createHash("sha1");T.update(this.key+"258EAFA5-E914-47DA-95CA-C5AB0DC85B11");var w="HTTP/1.1 101 Switching Protocols\r\nUpgrade: websocket\r\nConnection: Upgrade\r\nSec-WebSocket-Accept: "+T.digest("base64")+"\r\n";if(C){for(var P=0;P<C.length;P++){var k=C.charCodeAt(P),M=C.charAt(P);if(k<33||k>126||-1!==N.indexOf(M))throw this.reject(500),new Error('Illegal character "'+String.fromCharCode(M)+'" in subprotocol.')}if(-1===this.requestedProtocols.indexOf(h))throw this.reject(500),new Error("Specified protocol was not requested by the client.");C=C.replace(R,""),w+="Sec-WebSocket-Protocol: "+C+"\r\n"}if(this.requestedProtocols=null,m&&(m=m.replace(R,""),13===this.webSocketVersion?w+="Origin: "+m+"\r\n":8===this.webSocketVersion&&(w+="Sec-WebSocket-Origin: "+m+"\r\n")),y){if(!Array.isArray(y))throw this.reject(500),new Error('Value supplied for "cookies" argument must be an array.');var D={};y.forEach(function(h){if(!h.name||!h.value)throw this.reject(500),new Error('Each cookie to set must at least provide a "name" and "value"');if(h.name=h.name.replace(U,""),h.value=h.value.replace(U,""),D[h.name])throw this.reject(500),new Error("You may not specify the same cookie name twice.");D[h.name]=!0;var m=h.name.match(x);if(m)throw this.reject(500),new Error("Illegal character "+m[0]+" in cookie name");if(m=h.value.match(L)?h.value.slice(1,-1).match(O):h.value.match(O))throw this.reject(500),new Error("Illegal character "+m[0]+" in cookie value");var y=[h.name+"="+h.value];if(h.path){if(m=h.path.match(U))throw this.reject(500),new Error("Illegal character "+m[0]+" in cookie path");y.push("Path="+h.path)}if(h.domain){if("string"!=typeof h.domain)throw this.reject(500),new Error("Domain must be specified and must be a string.");if(m=h.domain.match(U))throw this.reject(500),new Error("Illegal character "+m[0]+" in cookie domain");y.push("Domain="+h.domain.toLowerCase())}if(h.expires){if(!(h.expires instanceof Date))throw this.reject(500),new Error('Value supplied for cookie "expires" must be a vaild date object');y.push("Expires="+h.expires.toGMTString())}if(h.maxage){var v=h.maxage;if("string"==typeof v&&(v=parseInt(v,10)),isNaN(v)||v<=0)throw this.reject(500),new Error('Value supplied for cookie "maxage" must be a non-zero number');v=Math.round(v),y.push("Max-Age="+v.toString(10))}if(h.secure){if("boolean"!=typeof h.secure)throw this.reject(500),new Error('Value supplied for cookie "secure" must be of type boolean');y.push("Secure")}if(h.httponly){if("boolean"!=typeof h.httponly)throw this.reject(500),new Error('Value supplied for cookie "httponly" must be of type boolean');y.push("HttpOnly")}w+="Set-Cookie: "+y.join(";")+"\r\n"}.bind(this))}this._resolved=!0,this.emit("requestResolved",this),w+="\r\n";var I=new A(this.socket,[],h,!1,this.serverConfig);I.webSocketVersion=this.webSocketVersion,I.remoteAddress=this.remoteAddress,I.remoteAddresses=this.remoteAddresses;var B=this;return this._socketIsClosing?cleanupFailedConnection(I):this.socket.write(w,"ascii",(function(h){h?cleanupFailedConnection(I):(B._removeSocketCloseListeners(),I._addSocketEventListeners())})),this.emit("requestAccepted",I),I},WebSocketRequest.prototype.reject=function(h,m,y){this._verifyResolution(),this._resolved=!0,this.emit("requestResolved",this),"number"!=typeof h&&(h=403);var v="HTTP/1.1 "+h+" "+W[h]+"\r\nConnection: close\r\n";if(m&&(v+="X-WebSocket-Reject-Reason: "+(m=m.replace(R,""))+"\r\n"),y)for(var C in y){var T=y[C].toString().replace(R,"");v+=C.replace(R,"")+": "+T+"\r\n"}v+="\r\n",this.socket.end(v,"ascii"),this.emit("requestRejected",this)},WebSocketRequest.prototype._handleSocketCloseBeforeAccept=function(){this._socketIsClosing=!0,this._removeSocketCloseListeners()},WebSocketRequest.prototype._removeSocketCloseListeners=function(){this.socket.removeListener("end",this._socketCloseHandler),this.socket.removeListener("close",this._socketCloseHandler)},WebSocketRequest.prototype._verifyResolution=function(){if(this._resolved)throw new Error("WebSocketRequest may only be accepted or rejected one time.")},h.exports=WebSocketRequest},function(h,m,y){var v=y(1150),C=y(79).bufferAllocUnsafe;function WebSocketFrame(h,m,y){this.maskBytes=h,this.frameHeader=m,this.config=y,this.maxReceivedFrameSize=y.maxReceivedFrameSize,this.protocolError=!1,this.frameTooLarge=!1,this.invalidCloseFrameLength=!1,this.parseState=1,this.closeStatus=-1}WebSocketFrame.prototype.addData=function(h){if(1===this.parseState&&h.length>=2){h.joinInto(this.frameHeader,0,0,2),h.advance(2);var m=this.frameHeader[0],y=this.frameHeader[1];if(this.fin=Boolean(128&m),this.rsv1=Boolean(64&m),this.rsv2=Boolean(32&m),this.rsv3=Boolean(16&m),this.mask=Boolean(128&y),this.opcode=15&m,this.length=127&y,this.opcode>=8){if(this.length>125)return this.protocolError=!0,this.dropReason="Illegal control frame longer than 125 bytes.",!0;if(!this.fin)return this.protocolError=!0,this.dropReason="Control frames must not be fragmented.",!0}126===this.length?this.parseState=2:127===this.length?this.parseState=3:this.parseState=4}if(2===this.parseState)h.length>=2&&(h.joinInto(this.frameHeader,2,0,2),h.advance(2),this.length=this.frameHeader.readUInt16BE(2),this.parseState=4);else if(3===this.parseState&&h.length>=8){h.joinInto(this.frameHeader,2,0,8),h.advance(8);var T=[this.frameHeader.readUInt32BE(2),this.frameHeader.readUInt32BE(6)];if(0!==T[0])return this.protocolError=!0,this.dropReason="Unsupported 64-bit length frame received",!0;this.length=T[1],this.parseState=4}if(4===this.parseState&&(this.mask?h.length>=4&&(h.joinInto(this.maskBytes,0,0,4),h.advance(4),this.parseState=5):this.parseState=5),5===this.parseState){if(this.length>this.maxReceivedFrameSize)return this.frameTooLarge=!0,this.dropReason="Frame size of "+this.length.toString(10)+" bytes exceeds maximum accepted frame size",!0;if(0===this.length)return this.binaryPayload=C(0),this.parseState=6,!0;if(h.length>=this.length)return this.binaryPayload=h.take(this.length),h.advance(this.length),this.mask&&v.unmask(this.binaryPayload,this.maskBytes),8===this.opcode&&(1===this.length&&(this.binaryPayload=C(0),this.invalidCloseFrameLength=!0),this.length>=2&&(this.closeStatus=this.binaryPayload.readUInt16BE(0),this.binaryPayload=this.binaryPayload.slice(2))),this.parseState=6,!0}return!1},WebSocketFrame.prototype.throwAwayPayload=function(h){return h.length>=this.length&&(h.advance(this.length),this.parseState=6,!0)},WebSocketFrame.prototype.toBuffer=function(h){var m,y,T,w=2,A=0,P=0;this.fin&&(A|=128),this.rsv1&&(A|=64),this.rsv2&&(A|=32),this.rsv3&&(A|=16),this.mask&&(P|=128),A|=15&this.opcode,8===this.opcode?(this.length=2,this.binaryPayload&&(this.length+=this.binaryPayload.length),(y=C(this.length)).writeUInt16BE(this.closeStatus,0),this.length>2&&this.binaryPayload.copy(y,2)):this.binaryPayload?(y=this.binaryPayload,this.length=y.length):this.length=0,this.length<=125?P|=127&this.length:this.length>125&&this.length<=65535?(P|=126,w+=2):this.length>65535&&(P|=127,w+=8);var k=C(this.length+w+(this.mask?4:0));return k[0]=A,k[1]=P,T=2,this.length>125&&this.length<=65535?(k.writeUInt16BE(this.length,T),T+=2):this.length>65535&&(k.writeUInt32BE(0,T),k.writeUInt32BE(this.length,T+4),T+=8),this.mask?(m=h?0:4294967295*Math.random()>>>0,this.maskBytes.writeUInt32BE(m,0),this.maskBytes.copy(k,T),T+=4,y&&v.mask(y,this.maskBytes,k,T,this.length)):y&&y.copy(k,T),k},WebSocketFrame.prototype.toString=function(){return"Opcode: "+this.opcode+", fin: "+this.fin+", length: "+this.length+", hasPayload: "+Boolean(this.binaryPayload)+", masked: "+this.mask},h.exports=WebSocketFrame},function(h,m,y){var v=y(21),C=y(7),T=y(18),w=require,A=process.config&&process.config.variables||{},P=!!process.env.PREBUILDS_ONLY,k=process.versions.modules,R=function isElectron(){return!(!process.versions||!process.versions.electron)||(!!process.env.ELECTRON_RUN_AS_NODE||"undefined"!=typeof window&&window.process&&"renderer"===window.process.type)}()?"electron":"node",M=T.arch(),N=T.platform(),D=process.env.LIBC||(function isAlpine(h){return"linux"===h&&v.existsSync("/etc/alpine-release")}(N)?"musl":"glibc"),I=process.env.ARM_VERSION||("arm64"===M?"8":A.arm_version)||"",x=(process.versions.uv||"").split(".")[0];function load(h){return w(load.path(h))}function readdirSync(h){try{return v.readdirSync(h)}catch(h){return[]}}function getFirst(h,m){var y=readdirSync(h).filter(m);return y[0]&&C.join(h,y[0])}function matchBuild(h){return/\.node$/.test(h)}function parseTags(h){var m=h.split("."),y={file:h,specificity:0};if("node"===m.pop()){for(var v=0;v<m.length;v++){var C=m[v];if("node"===C||"electron"===C||"node-webkit"===C)y.runtime=C;else if("napi"===C)y.napi=!0;else if("abi"===C.slice(0,3))y.abi=C.slice(3);else if("uv"===C.slice(0,2))y.uv=C.slice(2);else if("armv"===C.slice(0,4))y.armv=C.slice(4);else{if("glibc"!==C&&"musl"!==C)continue;y.libc=C}y.specificity++}return y}}function matchTags(h,m){return function(y){return null!=y&&(!(y.runtime!==h&&!function runtimeAgnostic(h){return"node"===h.runtime&&h.napi}(y))&&(!(y.abi!==m&&!y.napi)&&((!y.uv||y.uv===x)&&((!y.armv||y.armv===I)&&(!y.libc||y.libc===D)))))}}function compareTags(h){return function(m,y){return m.runtime!==y.runtime?m.runtime===h?-1:1:m.abi!==y.abi?m.abi?-1:1:m.specificity!==y.specificity?m.specificity>y.specificity?-1:1:0}}h.exports=load,load.path=function(h){h=C.resolve(h||".");try{var m=w(C.join(h,"package.json")).name.toUpperCase().replace(/-/g,"_");process.env[m+"_PREBUILD"]&&(h=process.env[m+"_PREBUILD"])}catch(h){}if(!P){var y=getFirst(C.join(h,"build/Release"),matchBuild);if(y)return y;var v=getFirst(C.join(h,"build/Debug"),matchBuild);if(v)return v}var T=resolve(h);if(T)return T;var A=resolve(C.dirname(process.execPath));if(A)return A;var O=["platform="+N,"arch="+M,"runtime="+R,"abi="+k,"uv="+x,I?"armv="+I:"","libc="+D,"node="+process.versions.node,process.versions&&process.versions.electron?"electron="+process.versions.electron:"","webpack=true"].filter(Boolean).join(" ");throw new Error("No native build was found for "+O+"\n    loaded from: "+h+"\n");function resolve(h){var m=C.join(h,"prebuilds",N+"-"+M),y=readdirSync(m).map(parseTags).filter(matchTags(R,k)).sort(compareTags(R))[0];if(y)return C.join(m,y.file)}},load.parseTags=parseTags,load.matchTags=matchTags,load.compareTags=compareTags},function(h,m,y){var v=y(79),C=v.extend,T=y(10),w=y(13).EventEmitter,A=y(52),P=y(46),k=y(20),R=y(11),M=y(268),N=v.bufferAllocUnsafe,D=["(",")","<",">","@",",",";",":","\\",'"',"/","[","]","?","=","{","}"," ",String.fromCharCode(9)],I=["hostname","port","method","path","headers"];function WebSocketClient(h){var m;(w.call(this),this.config={maxReceivedFrameSize:1048576,maxReceivedMessageSize:8388608,fragmentOutgoingMessages:!0,fragmentationThreshold:16384,webSocketVersion:13,assembleFragments:!0,disableNagleAlgorithm:!0,closeTimeout:5e3,tlsOptions:{}},h)&&(h.tlsOptions?(m=h.tlsOptions,delete h.tlsOptions):m={},C(this.config,h),C(this.config.tlsOptions,m));switch(this._req=null,this.config.webSocketVersion){case 8:case 13:break;default:throw new Error("Requested webSocketVersion is not supported. Allowed values are 8 and 13.")}}T.inherits(WebSocketClient,w),WebSocketClient.prototype.connect=function(h,m,y,T,w){var R=this;if("string"==typeof m&&(m=m.length>0?[m]:[]),m instanceof Array||(m=[]),this.protocols=m,this.origin=y,this.url="string"==typeof h?k.parse(h):h,!this.url.protocol)throw new Error("You must specify a full WebSocket URL, including protocol.");if(!this.url.host)throw new Error("You must specify a full WebSocket URL, including hostname. Relative URLs are not supported.");this.secure="wss:"===this.url.protocol,this.protocols.forEach((function(h){for(var m=0;m<h.length;m++){var y=h.charCodeAt(m),v=h.charAt(m);if(y<33||y>126||-1!==D.indexOf(v))throw new Error('Protocol list contains invalid character "'+String.fromCharCode(y)+'"')}}));this.url.port||(this.url.port={"ws:":"80","wss:":"443"}[this.url.protocol]);for(var M=N(16),x=0;x<16;x++)M[x]=Math.round(255*Math.random());this.base64nonce=M.toString("base64");var O=this.url.hostname;("ws:"===this.url.protocol&&"80"!==this.url.port||"wss:"===this.url.protocol&&"443"!==this.url.port)&&(O+=":"+this.url.port);var L,U={};function handleRequestError(h){R._req=null,R.emit("connectFailed",h)}this.secure&&this.config.tlsOptions.hasOwnProperty("headers")&&C(U,this.config.tlsOptions.headers),T&&C(U,T),C(U,{Upgrade:"websocket",Connection:"Upgrade","Sec-WebSocket-Version":this.config.webSocketVersion.toString(10),"Sec-WebSocket-Key":this.base64nonce,Host:U.Host||O}),this.protocols.length>0&&(U["Sec-WebSocket-Protocol"]=this.protocols.join(", ")),this.origin&&(13===this.config.webSocketVersion?U.Origin=this.origin:8===this.config.webSocketVersion&&(U["Sec-WebSocket-Origin"]=this.origin)),L=this.url.pathname?this.url.path:this.url.path?"/"+this.url.path:"/";var B={agent:!1};if(w&&C(B,w),C(B,{hostname:this.url.hostname,port:this.url.port,method:"GET",path:L,headers:U}),this.secure){var W=this.config.tlsOptions;for(var q in W)W.hasOwnProperty(q)&&-1===I.indexOf(q)&&(B[q]=W[q])}var Y=this._req=(this.secure?P:A).request(B);Y.on("upgrade",(function handleRequestUpgrade(h,m,y){R._req=null,Y.removeListener("error",handleRequestError),R.socket=m,R.response=h,R.firstDataChunk=y,R.validateHandshake()})),Y.on("error",handleRequestError),Y.on("response",(function(h){if(R._req=null,v.eventEmitterListenerCount(R,"httpResponse")>0)R.emit("httpResponse",h,R),h.socket&&h.socket.end();else{var m=[];for(var y in h.headers)m.push(y+": "+h.headers[y]);R.failHandshake("Server responded with a non-101 status: "+h.statusCode+" "+h.statusMessage+"\nResponse Headers Follow:\n"+m.join("\n")+"\n")}})),Y.end()},WebSocketClient.prototype.validateHandshake=function(){var h=this.response.headers;if(this.protocols.length>0){if(this.protocol=h["sec-websocket-protocol"],!this.protocol)return void this.failHandshake("Expected a Sec-WebSocket-Protocol header.");if(-1===this.protocols.indexOf(this.protocol))return void this.failHandshake("Server did not respond with a requested protocol.")}if(h.connection&&"upgrade"===h.connection.toLocaleLowerCase())if(h.upgrade&&"websocket"===h.upgrade.toLocaleLowerCase()){var m=R.createHash("sha1");m.update(this.base64nonce+"258EAFA5-E914-47DA-95CA-C5AB0DC85B11");var y=m.digest("base64");h["sec-websocket-accept"]?h["sec-websocket-accept"]===y?this.succeedHandshake():this.failHandshake("Sec-WebSocket-Accept header from server didn't match expected value of "+y):this.failHandshake("Expected Sec-WebSocket-Accept header from server")}else this.failHandshake("Expected an Upgrade: websocket header from the server");else this.failHandshake("Expected a Connection: Upgrade header from the server")},WebSocketClient.prototype.failHandshake=function(h){this.socket&&this.socket.writable&&this.socket.end(),this.emit("connectFailed",new Error(h))},WebSocketClient.prototype.succeedHandshake=function(){var h=new M(this.socket,[],this.protocol,!0,this.config);h.webSocketVersion=this.config.webSocketVersion,h._addSocketEventListeners(),this.emit("connect",h),this.firstDataChunk.length>0&&h.handleSocketData(this.firstDataChunk),this.firstDataChunk=null},WebSocketClient.prototype.abort=function(){this._req&&this._req.abort()},h.exports=WebSocketClient},function(h,m,y){var v=y(1158).strict;h.exports=function typedarrayToBuffer(h){if(v(h)){var m=Buffer.from(h.buffer);return h.byteLength!==h.buffer.byteLength&&(m=m.slice(h.byteOffset,h.byteOffset+h.byteLength)),m}return Buffer.from(h)}},function(h,m,y){h.exports={EventTarget:y(1159),Event:y(1160)}},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0}),function(h){h.MainThread="MainThread",h.ServiceWorker="ServiceWorker",h.WorkspaceHub="WorkspaceHub"}(m.TConnectionTypes||(m.TConnectionTypes={}))},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0}),function(h){h.VSCodeServerStartup="VSCodeServerStartup"}(m.PerformanceGroupIds||(m.PerformanceGroupIds={}))},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0}),m.vscodeServerHostRPCService={name:"IVSCodeServerHostService",methods:["startRemoteServer","exportLogs","shutDownRemoteServer","getVMTerminalFilePath","getContainerTerminalFilePath","getStateFolderPath","getSharedFolderPath","getCodespaceStateFilePath","getDevcontainerStateFilePath","getSharedFile","getContainerPersistedFolderPath","isRecoveryContainer","terminateOryxTask","downloadVsCodeServerByCommitId","getPerformanceData","getCreationLogStatus"],events:["configurationFinished","devContainerConfigChanged","codespaceStopping","codespaceAvailable","creationLogUpdated"]}},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0});const v=y(270);m.getVSCodeServerSessionName=h=>h?`${v.VSCODE_SERVER_PORT_NAME}_${h}`:v.VSCODE_SERVER_PORT_NAME},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0});const v=y(270);m.isVSCodeServerSession=h=>h.startsWith(v.VSCODE_SERVER_PORT_NAME)},function(h,m,y){"use strict";var v=this&&this.__awaiter||function(h,m,y,v){return new(y||(y=Promise))((function(C,T){function fulfilled(h){try{step(v.next(h))}catch(h){T(h)}}function rejected(h){try{step(v.throw(h))}catch(h){T(h)}}function step(h){h.done?C(h.value):function adopt(h){return h instanceof y?h:new y((function(m){m(h)}))}(h.value).then(fulfilled,rejected)}step((v=v.apply(h,m||[])).next())}))};Object.defineProperty(m,"__esModule",{value:!0});const C=y(2),T=y(6),w=y(1172),A=y(266),P=y(1173),k=y(134),optionsWithDefaults=h=>Object.assign(Object.assign({},w.HUB_CONNECTION_DEFAULT_OPTIONS),h);class ConnectionHub extends C.DisposableClass{constructor(h,m,y,k=[]){super(h),this.performance=m,this.connectionClass=y,this.childConnectionHubs=k,this.onConnectionEmitter=new T.Emitter,this.onConnection=this.onConnectionEmitter.event,this.getConnectionId=h=>new this.connectionClass(this.trace,this.performance,h).getId(h),this.connectOnce=(h,m={})=>v(this,void 0,void 0,(function*(){const{trace:y=this.trace}=m;return y.info("requested to connect once",h,m),yield this.connect(h,Object.assign(Object.assign({},w.HUB_NO_RETRY_OPTIONS),m))})),this.connections={},this.retrySignals={},this.createConnectionWithTimeout=(h,m)=>v(this,void 0,void 0,(function*(){const{timeout:y}=m;return isFinite(y)?(this.trace.verbose(`creating connection with timeout of ${y}ms`),yield C.timeoutPromise(this.createConnection(h,m),y,new A.ConnectionTimeoutError(`Could not establish connection in ${y}ms.`))):(this.trace.verbose("creating connection without a timeout"),yield this.createConnection(h,m))})),this.createConnection=(h,m)=>v(this,void 0,void 0,(function*(){const{retries:y,retryDelay:v,performance:T=this.performance,trace:w=this.trace}=m,A=h,k=this.getConnectionId(A);try{this.trace.info("creating connection",m);const y=new this.connectionClass(w.createChild(`connection:${k}`),T.createGroup(`${w.name}:${C.hashString(k)}`),A,this.childConnectionHubs),v=new P.ConnectionHubRecord(this.trace.createChild("connection-record"),y,h,m,y.onConnectionChanged(this.onConnectionChanged.bind(this,k)));this.connections[k]=v;const R=yield y.connect();return this.addToDisposables(v),C.defer(()=>{this.onConnectionEmitter.fire(R)},0),R}catch(T){if(this.trace.warning(`disposing connection "${k}" due to an error`,T),this.disposeConnection(k),y<1)throw T;this.trace.info(`connection failed, retrying ${y}`);const w=new C.Signal;return this.retrySignals[k]=w,yield Promise.race([w.promise,C.wait(v)]),yield this.createConnection(h,Object.assign(Object.assign({},m),{retries:y-1}))}}))}get childHubs(){return[...this.childConnectionHubs]}getConnection(h){const m=this.getConnectionId(h),y=this.connections[m];if(y){const{connection:h}=y;return h}}connect(h,m={}){return v(this,void 0,void 0,(function*(){const{trace:y=this.trace}=m;y.info("requested to connect",h,m);try{const v=this.getConnectionId(h),C=this.connections[v],T=y.createChild(`${v}`);if(T.info(`connection record: ${!!C}`),!C)return T.info("creating new connection"),yield this.createConnectionWithTimeout(h,optionsWithDefaults(m));const{connection:w}=C;if(!w)return T.info("no connection on connection record, creating"),yield this.createConnectionWithTimeout(h,optionsWithDefaults(m));if("disconnected"===w.status)return T.info("disposed, creating"),this.disposeConnection(v),yield this.createConnectionWithTimeout(h,optionsWithDefaults(m));if("connected"===w.status)return T.info("return connected"),w;const{timeout:A=1/0}=m;return T.info(`connecting with timeout - ${A} ms`),yield w.connectWithTimeout(A)}catch(h){throw y.warning("error during connection",h),k.errorToConnectionError(h)}}))}disconnect(h,m){return v(this,void 0,void 0,(function*(){this.trace.info("requested disconnect",h);const y=this.getConnectionId(h),v=this.retrySignals[y];v&&(v.cancel(),this.retrySignals[y]=void 0);const C=this.connections[y];return!!C&&(yield C.disconnect(m),this.connections[y]=void 0,!0)}))}onConnectionChanged(h,m){return v(this,void 0,void 0,(function*(){const y=this.trace.createChild(`onConnectionChanged:${h}`),{status:v,previousStatus:C}=m;if(y.info(`${C} -> ${v}`),"disconnected"!==v)return;const T=this.connections[h];if(!T)return void y.info("no connection record found");if(y.info("disposing the connection"),this.disposeConnection(h),this.connections[h]=void 0,"connected"!==C)return;const{hubConnectionOptions:w,connectionOptions:A,connection:P}=T;if(w.shouldReconnect&&!P.isDisposing)return y.info("reconnecting.."),yield this.connect(A,w);y.info("not reconnecting")}))}disposeConnection(h){try{this.trace.info(`disposing ${h} connection`);const m=this.connections[h];if(!m)return;m.dispose("connection record disposed by ConnectionHub"),this.connections[h]=void 0}catch(m){this.trace.warning(`error while disposing ${h} connection`,m)}}}m.ConnectionHub=ConnectionHub},function(h,m,y){"use strict";var v=this&&this.__awaiter||function(h,m,y,v){return new(y||(y=Promise))((function(C,T){function fulfilled(h){try{step(v.next(h))}catch(h){T(h)}}function rejected(h){try{step(v.throw(h))}catch(h){T(h)}}function step(h){h.done?C(h.value):function adopt(h){return h instanceof y?h:new y((function(m){m(h)}))}(h.value).then(fulfilled,rejected)}step((v=v.apply(h,m||[])).next())}))};Object.defineProperty(m,"__esModule",{value:!0});const C=y(486),T=y(6),w=y(2),A=y(1180),P=y(1181);class Performance{constructor(h,m,y="start"){this.name=h,this.groupId=m,this.pathString=y,this.groups=[],this.onAnyEventEmitter=new T.Emitter,this.onAnyEvent=this.onAnyEventEmitter.event,this.createGroup=(h,m=Performance.groupCount++)=>{const y=`${this.pathString}.${h}.${this.groupId}`,v=new Performance(h,m,y);return v.setMainPerformance(this.main),v.onAnyEvent(h=>{this.onAnyEventEmitter.fire(h)}),this.groups.push(v),v},this.markBlock=h=>(this.blocks.markBlock(h),this),this.markBlockStart=(h,m=!1)=>{try{this.blocks.markBlockStart(h)}catch(h){if(!m)throw h}return this},this.markBlockEnd=(h,m=!1)=>{try{this.blocks.markBlockEnd(h)}catch(h){if(!m)throw h}return this},this.measure=(h,m)=>v(this,void 0,void 0,(function*(){return yield this.blocks.measure(h,m)})),this.measureSync=(h,m)=>this.blocks.measureSync(h,m),this.getWaterfall=()=>{C.performance.measure(this.pathString,this.pathString);const[h]=C.performance.getEntriesByName(this.pathString);return new A.WaterfallNode(this.groupId,this.name,this.pathString,h,this.blocks.measures(),this.groups)},this.getBlockMeasure=(h,m)=>{if((m=null!=m?m:this.main.getWaterfall()).id===h)return m;for(let y of m.groups){const m=this.getBlockMeasure(h,y);if(m)return m}return null},this.getBlock=h=>this.blocks.getBlock(h),this.getBlockStartTime=h=>{const m=this.main.getBlockMeasure(h);if(!m)return null;const{measure:y}=m;return y.startTime},this.getBlockEndTime=h=>{const m=this.main.getBlockMeasure(h);if(!m)return null;const{measure:y}=m;return y.startTime+y.duration},this.getBlockDurationTime=h=>{const m=this.main.getBlockMeasure(h);if(!m)return null;const{measure:y}=m;return y.duration},this.blocks=new P.PerformanceBlocks(y),C.performance.mark(y),this.mainPerformanceReference=this,this.blocks.onAnyEvent(h=>{this.onAnyEventEmitter.fire(h)})}setMainPerformance(h){this.mainPerformanceReference=h}get main(){if(!this.mainPerformanceReference)throw new Error("No main performance found.");return this.mainPerformanceReference}onEvent(h,m){return this.blocks.onEvent(h,h=>{const{id:y,type:v}=h;if("start"===v)return m(h),this;const C=this.getBlockMeasure(y);if(!C)throw new Error(`Cannot find "${y}" block.`);m(h,C)}),this}onMeasure(h,m){return this.blocks.onEvent(h,h=>{const{id:y,type:v}=h;if("start"===v)return m(h),this;const C=this.getBlockMeasure(y);if(!C)throw new Error(`Cannot find "${y}" block.`);m(h,C)}),this}}m.Performance=Performance,Performance.groupCount=0,m.initializePerformanceInstance=(h,m=Performance)=>{const y=new m("start",h);return y.setMainPerformance(y),y},m.getOrCreatePerformance=w.onlyOnce(h=>m.initializePerformanceInstance(h),"extension:start")},function(h,m,y){const{PerformanceObserver:v,performance:C}=y(373),T=[],w=new v(h=>{T.push(...h.getEntries())});C.getEntries=()=>[...T],C.getEntriesByName=(h,m)=>[...T.filter(y=>{const v=y.name===h,C=!m||y.type===m;return v&&C})],C.getEntriesByType=h=>[...T.filter(m=>m.type===h)],w.observe({entryTypes:["measure","mark"],buffered:!1}),h.exports={PerformanceObserver:v,performance:C}},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0});const v=y(135),C=y(2),T=y(15);m.PerformanceMock=v.mocks.PerformanceMock,m.getRandomConnectionMockOptions=()=>({id:C.randomString(),someProp:C.randomString(),numericProp:C.randomInt(100)}),m.testTrace=new T.TraceSource("test-trace");const w=new m.PerformanceMock("test-performance","test-start");m.getConnectionMockOptions=(h={})=>{const{trace:y=m.testTrace}=h;return[y,w,Object.assign({},m.getRandomConnectionMockOptions())]}},function(h,m,y){"use strict";function __export(h){for(var y in h)m.hasOwnProperty(y)||(m[y]=h[y])}Object.defineProperty(m,"__esModule",{value:!0}),__export(y(489)),__export(y(1233)),__export(y(524));const v=y(1234);m.createDirectConnectionProvider=v.createDirectConnectionProvider},function(h,m,y){"use strict";var v=this&&this.__awaiter||function(h,m,y,v){return new(y||(y=Promise))((function(C,T){function fulfilled(h){try{step(v.next(h))}catch(h){T(h)}}function rejected(h){try{step(v.throw(h))}catch(h){T(h)}}function step(h){h.done?C(h.value):function adopt(h){return h instanceof y?h:new y((function(m){m(h)}))}(h.value).then(fulfilled,rejected)}step((v=v.apply(h,m||[])).next())}))};Object.defineProperty(m,"__esModule",{value:!0});const C=y(4),T=y(39),w=y(2),A=y(182),P=y(80),k=y(508),R=y(1232),M=["usw2","use","euw","asse"];m.openWorkspaceConnection=function openWorkspaceConnection(h,m,y,A){return v(this,void 0,void 0,(function*(){let v=(null==y?void 0:y.connectionMode)||T.ConnectionMode.Auto;const P=("number"==typeof h.connectionMode?T.ConnectionMode[h.connectionMode]:"string"==typeof h.connectionMode?w.toCamelCase(h.connectionMode):void 0)||T.ConnectionMode.Auto;if(P!==v)if(v===T.ConnectionMode.Auto)v=P;else{if(v===T.ConnectionMode.Direct&&P===T.ConnectionMode.Relay)throw new w.ByDesignError('The host does not allow direct connections. Switch to "Auto" or "Relay" mode and retry.',C.vsls.ErrorCodes.DirectConnectionNotEnabled);if(v===T.ConnectionMode.Relay&&P===T.ConnectionMode.Direct)throw new w.ByDesignError('Unable to connect since the host does not allow relayed connections. Switch to "Auto" or "Direct" mode and retry.',C.vsls.ErrorCodes.RelayConnectionNotEnabled)}if(v===T.ConnectionMode.Local||v===T.ConnectionMode.SignalR&&!A)throw new Error(`Unsupported workspace connection mode '${v}'.`);const k=h.connectLinks&&h.connectLinks.length;if(v===T.ConnectionMode.Auto&&!h.relayLink&&!k&&!A)throw new Error("Workspace does not have relay or direct connection info.");if(v===T.ConnectionMode.Direct&&!k)throw new Error("Workspace does not have direct connection info.");const M=[];let N;v!==T.ConnectionMode.Auto&&v!==T.ConnectionMode.Relay||!h.relayLink||M.push(openAzureRelayStream(h,m)),v!==T.ConnectionMode.Auto&&v!==T.ConnectionMode.Relay&&v!==T.ConnectionMode.SignalR||!A||void 0!==(null==y?void 0:y.enableSignalRConnection)&&!0!==(null==y?void 0:y.enableSignalRConnection)||M.push(openHubSshStream(A,h,m,null==y?void 0:y.traceHubData,null==y?void 0:y.hubCrossRegionEnabled)),v!==T.ConnectionMode.Auto&&v!==T.ConnectionMode.Direct||!k||M.push(...h.connectLinks.map(h=>R.openDirectConnection(h,m))),w.assert(M.length>0,"Cannot connect to workspace. Workspace does not have sufficient connection info.");try{if(N=yield w.promiseAny(M),!N)throw new Error("Cannot connect to workspace. Workspace does not have sufficient connection info.");return m.info(`Successfully connected using connection mode: ${N[1]}`),N[0]}finally{M.forEach(h=>h.then(h=>{h&&h!==N&&h[0].dispose()},()=>{}))}}))};const openHubSshStream=(h,m,y,C,w)=>v(void 0,void 0,void 0,(function*(){const v=null!=w&&w?void 0:m.relayLink?function getStampFromUri(h){for(let m of M)if(-1!==h.indexOf(m))return m}(m.relayLink):void 0,A=yield h.getOrCreate(v);yield A.setEnabled(!0);const R=A.getOrCreateProxy(P.HubProxyType.RelayService);return!0===C&&(R.traceHubData=!0),[yield k.HubStreamUtils.createClientStream(R,m.id,void 0,void 0,y),T.ConnectionMode.SignalR]})),openAzureRelayStream=(h,m)=>v(void 0,void 0,void 0,(function*(){return[yield A.SshHelpers.openConnection(h,m),T.ConnectionMode.Relay]}))},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0}),function(h){h[h.ContactService=0]="ContactService",h[h.RelayService=1]="RelayService"}(m.HubProxyType||(m.HubProxyType={}))},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0}),m.rpcHubConnectionServiceInfo={name:"rpcHubConnectionService",methods:["getOrCreate","setHubEnabled","setHubAuthenticateInfo"],events:["connectionStateChanged","runningStateChanged","attemptConnection"]}},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0});const v=y(6),C=y(490),T=y(66),w=y(498);m.HubConnectionServiceBase=class HubConnectionServiceBase{constructor(h,m){this.hubAuthentication=h,this.traceSource=m,this.connectionStateChangedEmitter=new v.Emitter,this.attemptConnectionEmitter=new v.Emitter,this.runningStateChangedEmitter=new v.Emitter,this.onConnectionStateChanged=this.connectionStateChangedEmitter.event,this.onRunningStateChanged=this.runningStateChangedEmitter.event,this.onAttemptConnection=this.attemptConnectionEmitter.event,this.proxies=new Map,this.proxyFactories=new Map,this.hubAuthentication.onAuthenticationChanged(h=>{this.setCurrentUserInfo({accessToken:h.accessToken,userInfo:h.account})}),this.proxyFactories.set(C.HubProxyType.ContactService,()=>new T.ContactServiceProxy(this.hubProxy,w.createLoggerAdapter(m.withName("ContactServiceProxy")),!0)),this.proxyFactories.set(C.HubProxyType.RelayService,()=>new T.RelayServiceProxy(this.hubProxy,w.createLoggerAdapter(m.withName("RelayServiceProxy")),!0))}setEnabled(h){return this.enabled=h,Promise.resolve()}getOrCreateProxy(h){let m;if(this.proxies.has(h))m=this.proxies.get(h);else{if(!this.proxyFactories.has(h))throw new Error(`Type:${h} not supported`);m=this.proxyFactories.get(h)(),this.proxies.set(h,m)}return m}get enabled(){return this.enabledFlag}set enabled(h){this.enabledFlag!==h&&(this.enabledFlag=h,this.updateHubClientConnection())}get isConnectionEnabled(){return this.shouldConnect()}get userInfo(){var h;return null===(h=this.currentUserInfo)||void 0===h?void 0:h.userInfo}get currentUserInfo(){return this.currentUserInfoInstance}setCurrentUserInfo(h){var m;this.traceSource.verbose(`setCurrentUserInfo user id:${null===(m=null==h?void 0:h.userInfo)||void 0===m?void 0:m.id}`),this.currentUserInfoInstance=h,this.updateHubClientConnection()}shouldConnect(){return this.accessToken()&&void 0!==this.currentUserInfoInstance.userInfo}accessToken(){if(this.currentUserInfoInstance)return this.currentUserInfoInstance.accessToken}}},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0}),function(h){h[h.Send=0]="Send",h[h.Invoke=1]="Invoke"}(m.HubMethodOption||(m.HubMethodOption={}))},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0});const v=y(10);class HubProxyBase{constructor(h,m,y){this.hubProxy=h,this.logger=m,this.hubName=y}toHubMethodName(h){return this.hubName?`${this.hubName}.${h}`:h}invoke(h,...m){return this.hubName?this.hubProxy.invoke(HubProxyBase.invokeHubMethodAsync,this.toHubMethodName(h),m):this.hubProxy.invoke(h,...m)}send(h,...m){return this.hubName?this.hubProxy.send(HubProxyBase.invokeHubMethodAsync,this.toHubMethodName(h),m):this.hubProxy.send(h,...m)}async invokeKeysToCamel(h,...m){return keysToCamel(await this.invoke(h,...m))}}function toCamel(h){return h.substr(0,1).toLowerCase()+h.substr(1)}function toPascal(h){return h.substr(0,1).toUpperCase()+h.substr(1)}function keysToCamel(h){return convertKeys(h,toCamel)}function convertKeys(h,m){if(v.isArray(h))return h.map(h=>convertKeys(h,m));if(v.isObject(h)){const y={};return Object.keys(h).forEach(C=>{let T=h[C];v.isObject(T)&&(T=convertKeys(T,m)),y[m(C)]=T}),y}return h}m.HubProxyBase=HubProxyBase,HubProxyBase.invokeHubMethodAsync="InvokeHubMethodAsync",m.keysToCamel=keysToCamel,m.keysToPascal=function keysToPascal(h){return convertKeys(h,toPascal)}},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0}),function(h){h[h.None=0]="None",h[h.Added=1]="Added",h[h.Removed=2]="Removed",h[h.Updated=3]="Updated"}(m.ParticipantChangeType||(m.ParticipantChangeType={})),function(h){h[h.None=0]="None",h[h.ExcludeSelf=1]="ExcludeSelf"}(m.SendOption||(m.SendOption={}))},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0});const v=y(183);m.RelayDataHubProxy=class RelayDataHubProxy{constructor(h,m){this.receiveDataCallbacks=new v.CallbackContainer,this.eventDisposable=h.onReceiveData(h=>m(h)?this.processReceivedData(h):Promise.resolve())}dispose(){this.eventDisposable.dispose()}onReceiveData(h){return this.receiveDataCallbacks.add(h)}async fireReceivedData(h){for(const m of this.receiveDataCallbacks.items)await m(h)}processReceivedData(h){return this.fireReceivedData(h)}}},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0});class RelayHubMessageProperties{static createMessageSequence(h){return{sequenceId:h}}static getMessageSequence(h){if(h&&h.hasOwnProperty(RelayHubMessageProperties.propertySequenceId))return Number(h[RelayHubMessageProperties.propertySequenceId])}}m.RelayHubMessageProperties=RelayHubMessageProperties,RelayHubMessageProperties.propertySequenceId="sequenceId",RelayHubMessageProperties.propertyAuditPrefixId="audit-",RelayHubMessageProperties.propertyAuditPerfTypeId="perfType"},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0}),m.createLoggerAdapter=function createLoggerAdapter(h,m){return{log:(y,v)=>{(!m||y>=m)&&h.log(y+1,v)}}}},function(h,m,y){var v=y(19);"disable"===process.env.READABLE_STREAM&&v?(h.exports=v,(m=h.exports=v.Readable).Readable=v.Readable,m.Writable=v.Writable,m.Duplex=v.Duplex,m.Transform=v.Transform,m.PassThrough=v.PassThrough,m.Stream=v):((m=h.exports=y(500)).Stream=v||m,m.Readable=m,m.Writable=y(503),m.Duplex=y(106),m.Transform=y(505),m.PassThrough=y(1202))},function(h,m,y){"use strict";var v=y(185);h.exports=Readable;var C,T=y(186);Readable.ReadableState=ReadableState;y(13).EventEmitter;var EElistenerCount=function(h,m){return h.listeners(m).length},w=y(501),A=y(187).Buffer,P=global.Uint8Array||function(){};var k=Object.create(y(136));k.inherits=y(105);var R=y(10),M=void 0;M=R&&R.debuglog?R.debuglog("stream"):function(){};var N,D=y(1200),I=y(502);k.inherits(Readable,w);var x=["error","close","destroy","pause","resume"];function ReadableState(h,m){h=h||{};var v=m instanceof(C=C||y(106));this.objectMode=!!h.objectMode,v&&(this.objectMode=this.objectMode||!!h.readableObjectMode);var T=h.highWaterMark,w=h.readableHighWaterMark,A=this.objectMode?16:16384;this.highWaterMark=T||0===T?T:v&&(w||0===w)?w:A,this.highWaterMark=Math.floor(this.highWaterMark),this.buffer=new D,this.length=0,this.pipes=null,this.pipesCount=0,this.flowing=null,this.ended=!1,this.endEmitted=!1,this.reading=!1,this.sync=!0,this.needReadable=!1,this.emittedReadable=!1,this.readableListening=!1,this.resumeScheduled=!1,this.destroyed=!1,this.defaultEncoding=h.defaultEncoding||"utf8",this.awaitDrain=0,this.readingMore=!1,this.decoder=null,this.encoding=null,h.encoding&&(N||(N=y(504).StringDecoder),this.decoder=new N(h.encoding),this.encoding=h.encoding)}function Readable(h){if(C=C||y(106),!(this instanceof Readable))return new Readable(h);this._readableState=new ReadableState(h,this),this.readable=!0,h&&("function"==typeof h.read&&(this._read=h.read),"function"==typeof h.destroy&&(this._destroy=h.destroy)),w.call(this)}function readableAddChunk(h,m,y,v,C){var T,w=h._readableState;null===m?(w.reading=!1,function onEofChunk(h,m){if(m.ended)return;if(m.decoder){var y=m.decoder.end();y&&y.length&&(m.buffer.push(y),m.length+=m.objectMode?1:y.length)}m.ended=!0,emitReadable(h)}(h,w)):(C||(T=function chunkInvalid(h,m){var y;(function _isUint8Array(h){return A.isBuffer(h)||h instanceof P})(m)||"string"==typeof m||void 0===m||h.objectMode||(y=new TypeError("Invalid non-string/buffer chunk"));return y}(w,m)),T?h.emit("error",T):w.objectMode||m&&m.length>0?("string"==typeof m||w.objectMode||Object.getPrototypeOf(m)===A.prototype||(m=function _uint8ArrayToBuffer(h){return A.from(h)}(m)),v?w.endEmitted?h.emit("error",new Error("stream.unshift() after end event")):addChunk(h,w,m,!0):w.ended?h.emit("error",new Error("stream.push() after EOF")):(w.reading=!1,w.decoder&&!y?(m=w.decoder.write(m),w.objectMode||0!==m.length?addChunk(h,w,m,!1):maybeReadMore(h,w)):addChunk(h,w,m,!1))):v||(w.reading=!1));return function needMoreData(h){return!h.ended&&(h.needReadable||h.length<h.highWaterMark||0===h.length)}(w)}function addChunk(h,m,y,v){m.flowing&&0===m.length&&!m.sync?(h.emit("data",y),h.read(0)):(m.length+=m.objectMode?1:y.length,v?m.buffer.unshift(y):m.buffer.push(y),m.needReadable&&emitReadable(h)),maybeReadMore(h,m)}Object.defineProperty(Readable.prototype,"destroyed",{get:function(){return void 0!==this._readableState&&this._readableState.destroyed},set:function(h){this._readableState&&(this._readableState.destroyed=h)}}),Readable.prototype.destroy=I.destroy,Readable.prototype._undestroy=I.undestroy,Readable.prototype._destroy=function(h,m){this.push(null),m(h)},Readable.prototype.push=function(h,m){var y,v=this._readableState;return v.objectMode?y=!0:"string"==typeof h&&((m=m||v.defaultEncoding)!==v.encoding&&(h=A.from(h,m),m=""),y=!0),readableAddChunk(this,h,m,!1,y)},Readable.prototype.unshift=function(h){return readableAddChunk(this,h,null,!0,!1)},Readable.prototype.isPaused=function(){return!1===this._readableState.flowing},Readable.prototype.setEncoding=function(h){return N||(N=y(504).StringDecoder),this._readableState.decoder=new N(h),this._readableState.encoding=h,this};function howMuchToRead(h,m){return h<=0||0===m.length&&m.ended?0:m.objectMode?1:h!=h?m.flowing&&m.length?m.buffer.head.data.length:m.length:(h>m.highWaterMark&&(m.highWaterMark=function computeNewHighWaterMark(h){return h>=8388608?h=8388608:(h--,h|=h>>>1,h|=h>>>2,h|=h>>>4,h|=h>>>8,h|=h>>>16,h++),h}(h)),h<=m.length?h:m.ended?m.length:(m.needReadable=!0,0))}function emitReadable(h){var m=h._readableState;m.needReadable=!1,m.emittedReadable||(M("emitReadable",m.flowing),m.emittedReadable=!0,m.sync?v.nextTick(emitReadable_,h):emitReadable_(h))}function emitReadable_(h){M("emit readable"),h.emit("readable"),flow(h)}function maybeReadMore(h,m){m.readingMore||(m.readingMore=!0,v.nextTick(maybeReadMore_,h,m))}function maybeReadMore_(h,m){for(var y=m.length;!m.reading&&!m.flowing&&!m.ended&&m.length<m.highWaterMark&&(M("maybeReadMore read 0"),h.read(0),y!==m.length);)y=m.length;m.readingMore=!1}function nReadingNextTick(h){M("readable nexttick read 0"),h.read(0)}function resume_(h,m){m.reading||(M("resume read 0"),h.read(0)),m.resumeScheduled=!1,m.awaitDrain=0,h.emit("resume"),flow(h),m.flowing&&!m.reading&&h.read(0)}function flow(h){var m=h._readableState;for(M("flow",m.flowing);m.flowing&&null!==h.read(););}function fromList(h,m){return 0===m.length?null:(m.objectMode?y=m.buffer.shift():!h||h>=m.length?(y=m.decoder?m.buffer.join(""):1===m.buffer.length?m.buffer.head.data:m.buffer.concat(m.length),m.buffer.clear()):y=function fromListPartial(h,m,y){var v;h<m.head.data.length?(v=m.head.data.slice(0,h),m.head.data=m.head.data.slice(h)):v=h===m.head.data.length?m.shift():y?function copyFromBufferString(h,m){var y=m.head,v=1,C=y.data;h-=C.length;for(;y=y.next;){var T=y.data,w=h>T.length?T.length:h;if(w===T.length?C+=T:C+=T.slice(0,h),0===(h-=w)){w===T.length?(++v,y.next?m.head=y.next:m.head=m.tail=null):(m.head=y,y.data=T.slice(w));break}++v}return m.length-=v,C}(h,m):function copyFromBuffer(h,m){var y=A.allocUnsafe(h),v=m.head,C=1;v.data.copy(y),h-=v.data.length;for(;v=v.next;){var T=v.data,w=h>T.length?T.length:h;if(T.copy(y,y.length-h,0,w),0===(h-=w)){w===T.length?(++C,v.next?m.head=v.next:m.head=m.tail=null):(m.head=v,v.data=T.slice(w));break}++C}return m.length-=C,y}(h,m);return v}(h,m.buffer,m.decoder),y);var y}function endReadable(h){var m=h._readableState;if(m.length>0)throw new Error('"endReadable()" called on non-empty stream');m.endEmitted||(m.ended=!0,v.nextTick(endReadableNT,m,h))}function endReadableNT(h,m){h.endEmitted||0!==h.length||(h.endEmitted=!0,m.readable=!1,m.emit("end"))}function indexOf(h,m){for(var y=0,v=h.length;y<v;y++)if(h[y]===m)return y;return-1}Readable.prototype.read=function(h){M("read",h),h=parseInt(h,10);var m=this._readableState,y=h;if(0!==h&&(m.emittedReadable=!1),0===h&&m.needReadable&&(m.length>=m.highWaterMark||m.ended))return M("read: emitReadable",m.length,m.ended),0===m.length&&m.ended?endReadable(this):emitReadable(this),null;if(0===(h=howMuchToRead(h,m))&&m.ended)return 0===m.length&&endReadable(this),null;var v,C=m.needReadable;return M("need readable",C),(0===m.length||m.length-h<m.highWaterMark)&&M("length less than watermark",C=!0),m.ended||m.reading?M("reading or ended",C=!1):C&&(M("do read"),m.reading=!0,m.sync=!0,0===m.length&&(m.needReadable=!0),this._read(m.highWaterMark),m.sync=!1,m.reading||(h=howMuchToRead(y,m))),null===(v=h>0?fromList(h,m):null)?(m.needReadable=!0,h=0):m.length-=h,0===m.length&&(m.ended||(m.needReadable=!0),y!==h&&m.ended&&endReadable(this)),null!==v&&this.emit("data",v),v},Readable.prototype._read=function(h){this.emit("error",new Error("_read() is not implemented"))},Readable.prototype.pipe=function(h,m){var y=this,C=this._readableState;switch(C.pipesCount){case 0:C.pipes=h;break;case 1:C.pipes=[C.pipes,h];break;default:C.pipes.push(h)}C.pipesCount+=1,M("pipe count=%d opts=%j",C.pipesCount,m);var w=(!m||!1!==m.end)&&h!==process.stdout&&h!==process.stderr?onend:unpipe;function onunpipe(m,v){M("onunpipe"),m===y&&v&&!1===v.hasUnpiped&&(v.hasUnpiped=!0,function cleanup(){M("cleanup"),h.removeListener("close",onclose),h.removeListener("finish",onfinish),h.removeListener("drain",A),h.removeListener("error",onerror),h.removeListener("unpipe",onunpipe),y.removeListener("end",onend),y.removeListener("end",unpipe),y.removeListener("data",ondata),P=!0,!C.awaitDrain||h._writableState&&!h._writableState.needDrain||A()}())}function onend(){M("onend"),h.end()}C.endEmitted?v.nextTick(w):y.once("end",w),h.on("unpipe",onunpipe);var A=function pipeOnDrain(h){return function(){var m=h._readableState;M("pipeOnDrain",m.awaitDrain),m.awaitDrain&&m.awaitDrain--,0===m.awaitDrain&&EElistenerCount(h,"data")&&(m.flowing=!0,flow(h))}}(y);h.on("drain",A);var P=!1;var k=!1;function ondata(m){M("ondata"),k=!1,!1!==h.write(m)||k||((1===C.pipesCount&&C.pipes===h||C.pipesCount>1&&-1!==indexOf(C.pipes,h))&&!P&&(M("false write response, pause",y._readableState.awaitDrain),y._readableState.awaitDrain++,k=!0),y.pause())}function onerror(m){M("onerror",m),unpipe(),h.removeListener("error",onerror),0===EElistenerCount(h,"error")&&h.emit("error",m)}function onclose(){h.removeListener("finish",onfinish),unpipe()}function onfinish(){M("onfinish"),h.removeListener("close",onclose),unpipe()}function unpipe(){M("unpipe"),y.unpipe(h)}return y.on("data",ondata),function prependListener(h,m,y){if("function"==typeof h.prependListener)return h.prependListener(m,y);h._events&&h._events[m]?T(h._events[m])?h._events[m].unshift(y):h._events[m]=[y,h._events[m]]:h.on(m,y)}(h,"error",onerror),h.once("close",onclose),h.once("finish",onfinish),h.emit("pipe",y),C.flowing||(M("pipe resume"),y.resume()),h},Readable.prototype.unpipe=function(h){var m=this._readableState,y={hasUnpiped:!1};if(0===m.pipesCount)return this;if(1===m.pipesCount)return h&&h!==m.pipes||(h||(h=m.pipes),m.pipes=null,m.pipesCount=0,m.flowing=!1,h&&h.emit("unpipe",this,y)),this;if(!h){var v=m.pipes,C=m.pipesCount;m.pipes=null,m.pipesCount=0,m.flowing=!1;for(var T=0;T<C;T++)v[T].emit("unpipe",this,y);return this}var w=indexOf(m.pipes,h);return-1===w||(m.pipes.splice(w,1),m.pipesCount-=1,1===m.pipesCount&&(m.pipes=m.pipes[0]),h.emit("unpipe",this,y)),this},Readable.prototype.on=function(h,m){var y=w.prototype.on.call(this,h,m);if("data"===h)!1!==this._readableState.flowing&&this.resume();else if("readable"===h){var C=this._readableState;C.endEmitted||C.readableListening||(C.readableListening=C.needReadable=!0,C.emittedReadable=!1,C.reading?C.length&&emitReadable(this):v.nextTick(nReadingNextTick,this))}return y},Readable.prototype.addListener=Readable.prototype.on,Readable.prototype.resume=function(){var h=this._readableState;return h.flowing||(M("resume"),h.flowing=!0,function resume(h,m){m.resumeScheduled||(m.resumeScheduled=!0,v.nextTick(resume_,h,m))}(this,h)),this},Readable.prototype.pause=function(){return M("call pause flowing=%j",this._readableState.flowing),!1!==this._readableState.flowing&&(M("pause"),this._readableState.flowing=!1,this.emit("pause")),this},Readable.prototype.wrap=function(h){var m=this,y=this._readableState,v=!1;for(var C in h.on("end",(function(){if(M("wrapped end"),y.decoder&&!y.ended){var h=y.decoder.end();h&&h.length&&m.push(h)}m.push(null)})),h.on("data",(function(C){(M("wrapped data"),y.decoder&&(C=y.decoder.write(C)),y.objectMode&&null==C)||(y.objectMode||C&&C.length)&&(m.push(C)||(v=!0,h.pause()))})),h)void 0===this[C]&&"function"==typeof h[C]&&(this[C]=function(m){return function(){return h[m].apply(h,arguments)}}(C));for(var T=0;T<x.length;T++)h.on(x[T],this.emit.bind(this,x[T]));return this._read=function(m){M("wrapped _read",m),v&&(v=!1,h.resume())},this},Object.defineProperty(Readable.prototype,"readableHighWaterMark",{enumerable:!1,get:function(){return this._readableState.highWaterMark}}),Readable._fromList=fromList},function(h,m,y){h.exports=y(19)},function(h,m,y){"use strict";var v=y(185);function emitErrorNT(h,m){h.emit("error",m)}h.exports={destroy:function destroy(h,m){var y=this,C=this._readableState&&this._readableState.destroyed,T=this._writableState&&this._writableState.destroyed;return C||T?(m?m(h):!h||this._writableState&&this._writableState.errorEmitted||v.nextTick(emitErrorNT,this,h),this):(this._readableState&&(this._readableState.destroyed=!0),this._writableState&&(this._writableState.destroyed=!0),this._destroy(h||null,(function(h){!m&&h?(v.nextTick(emitErrorNT,y,h),y._writableState&&(y._writableState.errorEmitted=!0)):m&&m(h)})),this)},undestroy:function undestroy(){this._readableState&&(this._readableState.destroyed=!1,this._readableState.reading=!1,this._readableState.ended=!1,this._readableState.endEmitted=!1),this._writableState&&(this._writableState.destroyed=!1,this._writableState.ended=!1,this._writableState.ending=!1,this._writableState.finished=!1,this._writableState.errorEmitted=!1)}}},function(h,m,y){"use strict";var v=y(185);function CorkedRequest(h){var m=this;this.next=null,this.entry=null,this.finish=function(){!function onCorkedFinish(h,m,y){var v=h.entry;h.entry=null;for(;v;){var C=v.callback;m.pendingcb--,C(y),v=v.next}m.corkedRequestsFree?m.corkedRequestsFree.next=h:m.corkedRequestsFree=h}(m,h)}}h.exports=Writable;var C,T=!process.browser&&["v0.10","v0.9."].indexOf(process.version.slice(0,5))>-1?setImmediate:v.nextTick;Writable.WritableState=WritableState;var w=Object.create(y(136));w.inherits=y(105);var A={deprecate:y(1201)},P=y(501),k=y(187).Buffer,R=global.Uint8Array||function(){};var M,N=y(502);function nop(){}function WritableState(h,m){C=C||y(106),h=h||{};var w=m instanceof C;this.objectMode=!!h.objectMode,w&&(this.objectMode=this.objectMode||!!h.writableObjectMode);var A=h.highWaterMark,P=h.writableHighWaterMark,k=this.objectMode?16:16384;this.highWaterMark=A||0===A?A:w&&(P||0===P)?P:k,this.highWaterMark=Math.floor(this.highWaterMark),this.finalCalled=!1,this.needDrain=!1,this.ending=!1,this.ended=!1,this.finished=!1,this.destroyed=!1;var R=!1===h.decodeStrings;this.decodeStrings=!R,this.defaultEncoding=h.defaultEncoding||"utf8",this.length=0,this.writing=!1,this.corked=0,this.sync=!0,this.bufferProcessing=!1,this.onwrite=function(h){!function onwrite(h,m){var y=h._writableState,C=y.sync,w=y.writecb;if(function onwriteStateUpdate(h){h.writing=!1,h.writecb=null,h.length-=h.writelen,h.writelen=0}(y),m)!function onwriteError(h,m,y,C,T){--m.pendingcb,y?(v.nextTick(T,C),v.nextTick(finishMaybe,h,m),h._writableState.errorEmitted=!0,h.emit("error",C)):(T(C),h._writableState.errorEmitted=!0,h.emit("error",C),finishMaybe(h,m))}(h,y,C,m,w);else{var A=needFinish(y);A||y.corked||y.bufferProcessing||!y.bufferedRequest||clearBuffer(h,y),C?T(afterWrite,h,y,A,w):afterWrite(h,y,A,w)}}(m,h)},this.writecb=null,this.writelen=0,this.bufferedRequest=null,this.lastBufferedRequest=null,this.pendingcb=0,this.prefinished=!1,this.errorEmitted=!1,this.bufferedRequestCount=0,this.corkedRequestsFree=new CorkedRequest(this)}function Writable(h){if(C=C||y(106),!(M.call(Writable,this)||this instanceof C))return new Writable(h);this._writableState=new WritableState(h,this),this.writable=!0,h&&("function"==typeof h.write&&(this._write=h.write),"function"==typeof h.writev&&(this._writev=h.writev),"function"==typeof h.destroy&&(this._destroy=h.destroy),"function"==typeof h.final&&(this._final=h.final)),P.call(this)}function doWrite(h,m,y,v,C,T,w){m.writelen=v,m.writecb=w,m.writing=!0,m.sync=!0,y?h._writev(C,m.onwrite):h._write(C,T,m.onwrite),m.sync=!1}function afterWrite(h,m,y,v){y||function onwriteDrain(h,m){0===m.length&&m.needDrain&&(m.needDrain=!1,h.emit("drain"))}(h,m),m.pendingcb--,v(),finishMaybe(h,m)}function clearBuffer(h,m){m.bufferProcessing=!0;var y=m.bufferedRequest;if(h._writev&&y&&y.next){var v=m.bufferedRequestCount,C=new Array(v),T=m.corkedRequestsFree;T.entry=y;for(var w=0,A=!0;y;)C[w]=y,y.isBuf||(A=!1),y=y.next,w+=1;C.allBuffers=A,doWrite(h,m,!0,m.length,C,"",T.finish),m.pendingcb++,m.lastBufferedRequest=null,T.next?(m.corkedRequestsFree=T.next,T.next=null):m.corkedRequestsFree=new CorkedRequest(m),m.bufferedRequestCount=0}else{for(;y;){var P=y.chunk,k=y.encoding,R=y.callback;if(doWrite(h,m,!1,m.objectMode?1:P.length,P,k,R),y=y.next,m.bufferedRequestCount--,m.writing)break}null===y&&(m.lastBufferedRequest=null)}m.bufferedRequest=y,m.bufferProcessing=!1}function needFinish(h){return h.ending&&0===h.length&&null===h.bufferedRequest&&!h.finished&&!h.writing}function callFinal(h,m){h._final((function(y){m.pendingcb--,y&&h.emit("error",y),m.prefinished=!0,h.emit("prefinish"),finishMaybe(h,m)}))}function finishMaybe(h,m){var y=needFinish(m);return y&&(!function prefinish(h,m){m.prefinished||m.finalCalled||("function"==typeof h._final?(m.pendingcb++,m.finalCalled=!0,v.nextTick(callFinal,h,m)):(m.prefinished=!0,h.emit("prefinish")))}(h,m),0===m.pendingcb&&(m.finished=!0,h.emit("finish"))),y}w.inherits(Writable,P),WritableState.prototype.getBuffer=function getBuffer(){for(var h=this.bufferedRequest,m=[];h;)m.push(h),h=h.next;return m},function(){try{Object.defineProperty(WritableState.prototype,"buffer",{get:A.deprecate((function(){return this.getBuffer()}),"_writableState.buffer is deprecated. Use _writableState.getBuffer instead.","DEP0003")})}catch(h){}}(),"function"==typeof Symbol&&Symbol.hasInstance&&"function"==typeof Function.prototype[Symbol.hasInstance]?(M=Function.prototype[Symbol.hasInstance],Object.defineProperty(Writable,Symbol.hasInstance,{value:function(h){return!!M.call(this,h)||this===Writable&&(h&&h._writableState instanceof WritableState)}})):M=function(h){return h instanceof this},Writable.prototype.pipe=function(){this.emit("error",new Error("Cannot pipe, not readable"))},Writable.prototype.write=function(h,m,y){var C=this._writableState,T=!1,w=!C.objectMode&&function _isUint8Array(h){return k.isBuffer(h)||h instanceof R}(h);return w&&!k.isBuffer(h)&&(h=function _uint8ArrayToBuffer(h){return k.from(h)}(h)),"function"==typeof m&&(y=m,m=null),w?m="buffer":m||(m=C.defaultEncoding),"function"!=typeof y&&(y=nop),C.ended?function writeAfterEnd(h,m){var y=new Error("write after end");h.emit("error",y),v.nextTick(m,y)}(this,y):(w||function validChunk(h,m,y,C){var T=!0,w=!1;return null===y?w=new TypeError("May not write null values to stream"):"string"==typeof y||void 0===y||m.objectMode||(w=new TypeError("Invalid non-string/buffer chunk")),w&&(h.emit("error",w),v.nextTick(C,w),T=!1),T}(this,C,h,y))&&(C.pendingcb++,T=function writeOrBuffer(h,m,y,v,C,T){if(!y){var w=function decodeChunk(h,m,y){h.objectMode||!1===h.decodeStrings||"string"!=typeof m||(m=k.from(m,y));return m}(m,v,C);v!==w&&(y=!0,C="buffer",v=w)}var A=m.objectMode?1:v.length;m.length+=A;var P=m.length<m.highWaterMark;P||(m.needDrain=!0);if(m.writing||m.corked){var R=m.lastBufferedRequest;m.lastBufferedRequest={chunk:v,encoding:C,isBuf:y,callback:T,next:null},R?R.next=m.lastBufferedRequest:m.bufferedRequest=m.lastBufferedRequest,m.bufferedRequestCount+=1}else doWrite(h,m,!1,A,v,C,T);return P}(this,C,w,h,m,y)),T},Writable.prototype.cork=function(){this._writableState.corked++},Writable.prototype.uncork=function(){var h=this._writableState;h.corked&&(h.corked--,h.writing||h.corked||h.finished||h.bufferProcessing||!h.bufferedRequest||clearBuffer(this,h))},Writable.prototype.setDefaultEncoding=function setDefaultEncoding(h){if("string"==typeof h&&(h=h.toLowerCase()),!(["hex","utf8","utf-8","ascii","binary","base64","ucs2","ucs-2","utf16le","utf-16le","raw"].indexOf((h+"").toLowerCase())>-1))throw new TypeError("Unknown encoding: "+h);return this._writableState.defaultEncoding=h,this},Object.defineProperty(Writable.prototype,"writableHighWaterMark",{enumerable:!1,get:function(){return this._writableState.highWaterMark}}),Writable.prototype._write=function(h,m,y){y(new Error("_write() is not implemented"))},Writable.prototype._writev=null,Writable.prototype.end=function(h,m,y){var C=this._writableState;"function"==typeof h?(y=h,h=null,m=null):"function"==typeof m&&(y=m,m=null),null!=h&&this.write(h,m),C.corked&&(C.corked=1,this.uncork()),C.ending||C.finished||function endWritable(h,m,y){m.ending=!0,finishMaybe(h,m),y&&(m.finished?v.nextTick(y):h.once("finish",y));m.ended=!0,h.writable=!1}(this,C,y)},Object.defineProperty(Writable.prototype,"destroyed",{get:function(){return void 0!==this._writableState&&this._writableState.destroyed},set:function(h){this._writableState&&(this._writableState.destroyed=h)}}),Writable.prototype.destroy=N.destroy,Writable.prototype._undestroy=N.undestroy,Writable.prototype._destroy=function(h,m){this.end(),m(h)}},function(h,m,y){"use strict";var v=y(187).Buffer,C=v.isEncoding||function(h){switch((h=""+h)&&h.toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":case"raw":return!0;default:return!1}};function StringDecoder(h){var m;switch(this.encoding=function normalizeEncoding(h){var m=function _normalizeEncoding(h){if(!h)return"utf8";for(var m;;)switch(h){case"utf8":case"utf-8":return"utf8";case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return"utf16le";case"latin1":case"binary":return"latin1";case"base64":case"ascii":case"hex":return h;default:if(m)return;h=(""+h).toLowerCase(),m=!0}}(h);if("string"!=typeof m&&(v.isEncoding===C||!C(h)))throw new Error("Unknown encoding: "+h);return m||h}(h),this.encoding){case"utf16le":this.text=utf16Text,this.end=utf16End,m=4;break;case"utf8":this.fillLast=utf8FillLast,m=4;break;case"base64":this.text=base64Text,this.end=base64End,m=3;break;default:return this.write=simpleWrite,void(this.end=simpleEnd)}this.lastNeed=0,this.lastTotal=0,this.lastChar=v.allocUnsafe(m)}function utf8CheckByte(h){return h<=127?0:h>>5==6?2:h>>4==14?3:h>>3==30?4:h>>6==2?-1:-2}function utf8FillLast(h){var m=this.lastTotal-this.lastNeed,y=function utf8CheckExtraBytes(h,m,y){if(128!=(192&m[0]))return h.lastNeed=0,"";if(h.lastNeed>1&&m.length>1){if(128!=(192&m[1]))return h.lastNeed=1,"";if(h.lastNeed>2&&m.length>2&&128!=(192&m[2]))return h.lastNeed=2,""}}(this,h);return void 0!==y?y:this.lastNeed<=h.length?(h.copy(this.lastChar,m,0,this.lastNeed),this.lastChar.toString(this.encoding,0,this.lastTotal)):(h.copy(this.lastChar,m,0,h.length),void(this.lastNeed-=h.length))}function utf16Text(h,m){if((h.length-m)%2==0){var y=h.toString("utf16le",m);if(y){var v=y.charCodeAt(y.length-1);if(v>=55296&&v<=56319)return this.lastNeed=2,this.lastTotal=4,this.lastChar[0]=h[h.length-2],this.lastChar[1]=h[h.length-1],y.slice(0,-1)}return y}return this.lastNeed=1,this.lastTotal=2,this.lastChar[0]=h[h.length-1],h.toString("utf16le",m,h.length-1)}function utf16End(h){var m=h&&h.length?this.write(h):"";if(this.lastNeed){var y=this.lastTotal-this.lastNeed;return m+this.lastChar.toString("utf16le",0,y)}return m}function base64Text(h,m){var y=(h.length-m)%3;return 0===y?h.toString("base64",m):(this.lastNeed=3-y,this.lastTotal=3,1===y?this.lastChar[0]=h[h.length-1]:(this.lastChar[0]=h[h.length-2],this.lastChar[1]=h[h.length-1]),h.toString("base64",m,h.length-y))}function base64End(h){var m=h&&h.length?this.write(h):"";return this.lastNeed?m+this.lastChar.toString("base64",0,3-this.lastNeed):m}function simpleWrite(h){return h.toString(this.encoding)}function simpleEnd(h){return h&&h.length?this.write(h):""}m.StringDecoder=StringDecoder,StringDecoder.prototype.write=function(h){if(0===h.length)return"";var m,y;if(this.lastNeed){if(void 0===(m=this.fillLast(h)))return"";y=this.lastNeed,this.lastNeed=0}else y=0;return y<h.length?m?m+this.text(h,y):this.text(h,y):m||""},StringDecoder.prototype.end=function utf8End(h){var m=h&&h.length?this.write(h):"";return this.lastNeed?m+"":m},StringDecoder.prototype.text=function utf8Text(h,m){var y=function utf8CheckIncomplete(h,m,y){var v=m.length-1;if(v<y)return 0;var C=utf8CheckByte(m[v]);if(C>=0)return C>0&&(h.lastNeed=C-1),C;if(--v<y||-2===C)return 0;if((C=utf8CheckByte(m[v]))>=0)return C>0&&(h.lastNeed=C-2),C;if(--v<y||-2===C)return 0;if((C=utf8CheckByte(m[v]))>=0)return C>0&&(2===C?C=0:h.lastNeed=C-3),C;return 0}(this,h,m);if(!this.lastNeed)return h.toString("utf8",m);this.lastTotal=y;var v=h.length-(y-this.lastNeed);return h.copy(this.lastChar,0,v),h.toString("utf8",m,v)},StringDecoder.prototype.fillLast=function(h){if(this.lastNeed<=h.length)return h.copy(this.lastChar,this.lastTotal-this.lastNeed,0,this.lastNeed),this.lastChar.toString(this.encoding,0,this.lastTotal);h.copy(this.lastChar,this.lastTotal-this.lastNeed,0,h.length),this.lastNeed-=h.length}},function(h,m,y){"use strict";h.exports=Transform;var v=y(106),C=Object.create(y(136));function afterTransform(h,m){var y=this._transformState;y.transforming=!1;var v=y.writecb;if(!v)return this.emit("error",new Error("write callback called multiple times"));y.writechunk=null,y.writecb=null,null!=m&&this.push(m),v(h);var C=this._readableState;C.reading=!1,(C.needReadable||C.length<C.highWaterMark)&&this._read(C.highWaterMark)}function Transform(h){if(!(this instanceof Transform))return new Transform(h);v.call(this,h),this._transformState={afterTransform:afterTransform.bind(this),needTransform:!1,transforming:!1,writecb:null,writechunk:null,writeencoding:null},this._readableState.needReadable=!0,this._readableState.sync=!1,h&&("function"==typeof h.transform&&(this._transform=h.transform),"function"==typeof h.flush&&(this._flush=h.flush)),this.on("prefinish",prefinish)}function prefinish(){var h=this;"function"==typeof this._flush?this._flush((function(m,y){done(h,m,y)})):done(this,null,null)}function done(h,m,y){if(m)return h.emit("error",m);if(null!=y&&h.push(y),h._writableState.length)throw new Error("Calling transform done when ws.length != 0");if(h._transformState.transforming)throw new Error("Calling transform done when still transforming");return h.push(null)}C.inherits=y(105),C.inherits(Transform,v),Transform.prototype.push=function(h,m){return this._transformState.needTransform=!1,v.prototype.push.call(this,h,m)},Transform.prototype._transform=function(h,m,y){throw new Error("_transform() is not implemented")},Transform.prototype._write=function(h,m,y){var v=this._transformState;if(v.writecb=y,v.writechunk=h,v.writeencoding=m,!v.transforming){var C=this._readableState;(v.needTransform||C.needReadable||C.length<C.highWaterMark)&&this._read(C.highWaterMark)}},Transform.prototype._read=function(h){var m=this._transformState;null!==m.writechunk&&m.writecb&&!m.transforming?(m.transforming=!0,this._transform(m.writechunk,m.writeencoding,m.afterTransform)):m.needTransform=!0},Transform.prototype._destroy=function(h,m){var y=this;v.prototype._destroy.call(this,h,(function(h){m(h),y.emit("close")}))}},function(h,m,y){"use strict";var v=this&&this.__awaiter||function(h,m,y,v){return new(y||(y=Promise))((function(C,T){function fulfilled(h){try{step(v.next(h))}catch(h){T(h)}}function rejected(h){try{step(v.throw(h))}catch(h){T(h)}}function step(h){h.done?C(h.value):function adopt(h){return h instanceof y?h:new y((function(m){m(h)}))}(h.value).then(fulfilled,rejected)}step((v=v.apply(h,m||[])).next())}))};Object.defineProperty(m,"__esModule",{value:!0});const C=y(2),T=y(507);m.HubConnectionServiceFactoryBase=class HubConnectionServiceFactoryBase{constructor(h,m){this.signalRServiceUri=h,this.logger=m,this.serviceMap=new Map,this.defaultHubConnectionServiceFactory=C.once(()=>(this.logger.verbose(`Creating default hub connection using uri:${h}`),this.createHubConnectionService(h,null,m.createChild("default")))),this.defaultStampRequest=C.once(()=>this.requestDefaultStamp())}getOrCreate(h){return v(this,void 0,void 0,(function*(){if(!h||(yield this.getDefaultStamp())===h)return yield this.defaultHubConnectionServiceFactory();let m=this.serviceMap.get(h);if(!m){this.logger.verbose(`Creating hub connection for stamp:${h}`);const y=new URL(this.signalRServiceUri),v=`${y.protocol}//${h}-${y.host}${y.pathname}`;m=yield this.createHubConnectionService(v,h,this.logger.createChild(`${h}`)),this.serviceMap.set(h,m)}return m}))}requestDefaultStamp(){return T.getStampFromUri(this.signalRServiceUri,this.logger)}getDefaultStamp(){return this.defaultStampRequest()}}},function(h,m,y){"use strict";var v=this&&this.__awaiter||function(h,m,y,v){return new(y||(y=Promise))((function(C,T){function fulfilled(h){try{step(v.next(h))}catch(h){T(h)}}function rejected(h){try{step(v.throw(h))}catch(h){T(h)}}function step(h){h.done?C(h.value):function adopt(h){return h instanceof y?h:new y((function(m){m(h)}))}(h.value).then(fulfilled,rejected)}step((v=v.apply(h,m||[])).next())}))};Object.defineProperty(m,"__esModule",{value:!0});const C=y(200);m.getStampFromUri=function getStampFromUri(h,m){return v(this,void 0,void 0,(function*(){const y=new URL(h),v=`${y.protocol}//${y.host}${y.pathname.substring(0,y.pathname.lastIndexOf("/"))}/status`,T=(new Date).getTime(),w=(yield new C.HttpClient(m.createChild("HttpClient")).get(v).value()).AppSettings.Stamp;return m.verbose(`Request default stamp:${w} t:${(new Date).getTime()-T} ms`),w}))}},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0});var v=y(509);m.HubStreamUtils=v.HubStreamUtils;var C=y(1228);m.HubProxyUtils=C.HubProxyUtils;var T=y(523);m.RelayHubProxyServer=T.RelayHubProxyServer;var w=y(1229);m.createRelayHubEventNotifier=w.createRelayHubEventNotifier;var A=y(1230);m.createRelayHubProxyServerProvider=A.createRelayHubProxyServerProvider;var P=y(1231);m.RpcUtils=P.RpcUtils;const k=y(142);m.constants=k},function(h,m,y){"use strict";var v=this&&this.__awaiter||function(h,m,y,v){return new(y||(y=Promise))((function(C,T){function fulfilled(h){try{step(v.next(h))}catch(h){T(h)}}function rejected(h){try{step(v.throw(h))}catch(h){T(h)}}function step(h){h.done?C(h.value):function adopt(h){return h instanceof y?h:new y((function(m){m(h)}))}(h.value).then(fulfilled,rejected)}step((v=v.apply(h,m||[])).next())}))};Object.defineProperty(m,"__esModule",{value:!0});const C=y(66),T=y(275),w=y(142),A=y(2);class HubStreamUtils{static createClientStream(h,m,y,P,k){return v(this,void 0,void 0,(function*(){P=P||HubStreamUtils.getHostParticipant,yield h.hubProxy.connect();const R=yield h.joinHub(m,null,{}),M=P(R);null==k||k.verbose(`hub:${m} joined host:${M.id} self:${R.selfParticipant.id} participants:${JSON.stringify(R.participants)} on service:${R.serviceId} stamp:${R.stamp}`);const N=(new Date).getTime(),D=new A.Signal,I=y||w.DATA_TYPE_LIVESHARE_HUB;let x=I,O=I;const L=R.onReceiveData(h=>v(this,void 0,void 0,(function*(){if(h.type===w.DATA_TYPE_JOINED_READY_ACK&&h.fromParticipant.id===M.id){if(h.data){const m=JSON.parse(h.data.toString());x=m[1],O=m[0]}null==k||k.verbose(`Ack received after:${(new Date).getTime()-N} ms types:${x}|${O}`),D.resolve()}})));return yield R.sendData(C.SendOption.None,[M.id],w.DATA_TYPE_JOINED_READY,null,void 0,C.HubMethodOption.Invoke),M.properties.hasOwnProperty(w.PARTICIPANT_PROPERTY_HOST_FLAGS)&&M.properties[w.PARTICIPANT_PROPERTY_HOST_FLAGS]&w.HostFlags.JoinReadAck&&(null==k||k.verbose(`Host join ready completed after:${(new Date).getTime()-N} ms`),yield A.timeoutPromise(D.promise,3e4,new Error("Host acknowledge not received to initiate the hub stream"))),L.dispose(),new T.HubStream(R,x,O,M.id)}))}static getHostParticipant(h){return HubStreamUtils.getHostParticipantByProperty(h,w.PARTICIPANT_PROPERTY_IS_HOST)}static getHostParticipantByProperty(h,m){const y=h.participants.filter(h=>h.properties&&h.properties.hasOwnProperty(m));if(1!==y.length)throw new Error(y.length>1?"Multiple host participants":"No host participant found");return y[0]}}m.HubStreamUtils=HubStreamUtils},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0}),m.ObjectDisposedError=m.SshReconnectError=m.SshConnectionError=m.SshChannelError=m.BigInt=m.DerWriter=m.DerReader=m.formatBuffer=m.SshDataWriter=m.SshDataReader=m.ECDsa=m.Rsa=m.Encryption=m.HmacAlgorithm=m.EncryptionAlgorithm=m.PublicKeyAlgorithm=m.KeyExchangeAlgorithm=m.SshAlgorithms=m.CommandRequestMessage=m.ChannelRequestType=m.ChannelRequestMessage=m.ChannelOpenMessage=m.SshChannelOpenFailureReason=m.SshReconnectFailureReason=m.SshDisconnectReason=m.SessionRequestFailureMessage=m.SessionRequestSuccessMessage=m.DebugMessage=m.SessionRequestMessage=m.SshMessage=m.SshChannelClosedEventArgs=m.SshSessionClosedEventArgs=m.SshChannelOpeningEventArgs=m.SshRequestEventArgs=m.SshAuthenticatingEventArgs=m.SshAuthenticationType=m.serviceActivation=m.SshService=m.SshRpcMessageStream=m.WebSocketStream=m.NodeStream=m.BaseStream=m.SshStream=m.SshChannel=m.SshServerSession=m.SshClientSession=m.SshSession=m.SshVersionInfo=m.SshProtocolExtensionNames=m.SshSessionConfiguration=void 0,m.MultiChannelStream=m.SessionContour=m.ChannelMetrics=m.SessionMetrics=m.Queue=m.Semaphore=m.PromiseCompletionSource=m.CancellationError=m.CancellationTokenSource=m.CancellationToken=void 0;var v=y(137);Object.defineProperty(m,"SshSessionConfiguration",{enumerable:!0,get:function(){return v.SshSessionConfiguration}}),Object.defineProperty(m,"SshProtocolExtensionNames",{enumerable:!0,get:function(){return v.SshProtocolExtensionNames}});var C=y(517);Object.defineProperty(m,"SshVersionInfo",{enumerable:!0,get:function(){return C.SshVersionInfo}});var T=y(139);Object.defineProperty(m,"SshSession",{enumerable:!0,get:function(){return T.SshSession}});var w=y(1221);Object.defineProperty(m,"SshClientSession",{enumerable:!0,get:function(){return w.SshClientSession}});var A=y(1222);Object.defineProperty(m,"SshServerSession",{enumerable:!0,get:function(){return A.SshServerSession}});var P=y(283);Object.defineProperty(m,"SshChannel",{enumerable:!0,get:function(){return P.SshChannel}});var k=y(522);Object.defineProperty(m,"SshStream",{enumerable:!0,get:function(){return k.SshStream}});var R=y(1223);Object.defineProperty(m,"BaseStream",{enumerable:!0,get:function(){return R.BaseStream}}),Object.defineProperty(m,"NodeStream",{enumerable:!0,get:function(){return R.NodeStream}}),Object.defineProperty(m,"WebSocketStream",{enumerable:!0,get:function(){return R.WebSocketStream}});var M=y(1224);Object.defineProperty(m,"SshRpcMessageStream",{enumerable:!0,get:function(){return M.SshRpcMessageStream}});var N=y(190);Object.defineProperty(m,"SshService",{enumerable:!0,get:function(){return N.SshService}});var D=y(108);Object.defineProperty(m,"serviceActivation",{enumerable:!0,get:function(){return D.serviceActivation}});var I=y(287);Object.defineProperty(m,"SshAuthenticationType",{enumerable:!0,get:function(){return I.SshAuthenticationType}}),Object.defineProperty(m,"SshAuthenticatingEventArgs",{enumerable:!0,get:function(){return I.SshAuthenticatingEventArgs}});var x=y(284);Object.defineProperty(m,"SshRequestEventArgs",{enumerable:!0,get:function(){return x.SshRequestEventArgs}});var O=y(518);Object.defineProperty(m,"SshChannelOpeningEventArgs",{enumerable:!0,get:function(){return O.SshChannelOpeningEventArgs}});var L=y(521);Object.defineProperty(m,"SshSessionClosedEventArgs",{enumerable:!0,get:function(){return L.SshSessionClosedEventArgs}});var U=y(516);Object.defineProperty(m,"SshChannelClosedEventArgs",{enumerable:!0,get:function(){return U.SshChannelClosedEventArgs}});var B=y(109);Object.defineProperty(m,"SshMessage",{enumerable:!0,get:function(){return B.SshMessage}});var W=y(57);Object.defineProperty(m,"SessionRequestMessage",{enumerable:!0,get:function(){return W.SessionRequestMessage}}),Object.defineProperty(m,"DebugMessage",{enumerable:!0,get:function(){return W.DebugMessage}}),Object.defineProperty(m,"SessionRequestSuccessMessage",{enumerable:!0,get:function(){return W.SessionRequestSuccessMessage}}),Object.defineProperty(m,"SessionRequestFailureMessage",{enumerable:!0,get:function(){return W.SessionRequestFailureMessage}}),Object.defineProperty(m,"SshDisconnectReason",{enumerable:!0,get:function(){return W.SshDisconnectReason}}),Object.defineProperty(m,"SshReconnectFailureReason",{enumerable:!0,get:function(){return W.SshReconnectFailureReason}});var q=y(81);Object.defineProperty(m,"SshChannelOpenFailureReason",{enumerable:!0,get:function(){return q.SshChannelOpenFailureReason}}),Object.defineProperty(m,"ChannelOpenMessage",{enumerable:!0,get:function(){return q.ChannelOpenMessage}}),Object.defineProperty(m,"ChannelRequestMessage",{enumerable:!0,get:function(){return q.ChannelRequestMessage}}),Object.defineProperty(m,"ChannelRequestType",{enumerable:!0,get:function(){return q.ChannelRequestType}}),Object.defineProperty(m,"CommandRequestMessage",{enumerable:!0,get:function(){return q.CommandRequestMessage}});var Y=y(107);Object.defineProperty(m,"SshAlgorithms",{enumerable:!0,get:function(){return Y.SshAlgorithms}}),Object.defineProperty(m,"KeyExchangeAlgorithm",{enumerable:!0,get:function(){return Y.KeyExchangeAlgorithm}}),Object.defineProperty(m,"PublicKeyAlgorithm",{enumerable:!0,get:function(){return Y.PublicKeyAlgorithm}}),Object.defineProperty(m,"EncryptionAlgorithm",{enumerable:!0,get:function(){return Y.EncryptionAlgorithm}}),Object.defineProperty(m,"HmacAlgorithm",{enumerable:!0,get:function(){return Y.HmacAlgorithm}}),Object.defineProperty(m,"Encryption",{enumerable:!0,get:function(){return Y.Encryption}}),Object.defineProperty(m,"Rsa",{enumerable:!0,get:function(){return Y.Rsa}}),Object.defineProperty(m,"ECDsa",{enumerable:!0,get:function(){return Y.ECDsa}});var V=y(40);Object.defineProperty(m,"SshDataReader",{enumerable:!0,get:function(){return V.SshDataReader}}),Object.defineProperty(m,"SshDataWriter",{enumerable:!0,get:function(){return V.SshDataWriter}}),Object.defineProperty(m,"formatBuffer",{enumerable:!0,get:function(){return V.formatBuffer}});var $=y(282);Object.defineProperty(m,"DerReader",{enumerable:!0,get:function(){return $.DerReader}}),Object.defineProperty(m,"DerWriter",{enumerable:!0,get:function(){return $.DerWriter}});var z=y(56);Object.defineProperty(m,"BigInt",{enumerable:!0,get:function(){return z.BigInt}});var G=y(51);Object.defineProperty(m,"SshChannelError",{enumerable:!0,get:function(){return G.SshChannelError}}),Object.defineProperty(m,"SshConnectionError",{enumerable:!0,get:function(){return G.SshConnectionError}}),Object.defineProperty(m,"SshReconnectError",{enumerable:!0,get:function(){return G.SshReconnectError}}),Object.defineProperty(m,"ObjectDisposedError",{enumerable:!0,get:function(){return G.ObjectDisposedError}});var J=y(83);Object.defineProperty(m,"CancellationToken",{enumerable:!0,get:function(){return J.CancellationToken}}),Object.defineProperty(m,"CancellationTokenSource",{enumerable:!0,get:function(){return J.CancellationTokenSource}}),Object.defineProperty(m,"CancellationError",{enumerable:!0,get:function(){return J.CancellationError}});var X=y(82);Object.defineProperty(m,"PromiseCompletionSource",{enumerable:!0,get:function(){return X.PromiseCompletionSource}});var Z=y(140);Object.defineProperty(m,"Semaphore",{enumerable:!0,get:function(){return Z.Semaphore}});var ee=y(189);Object.defineProperty(m,"Queue",{enumerable:!0,get:function(){return ee.Queue}});var te=y(520);Object.defineProperty(m,"SessionMetrics",{enumerable:!0,get:function(){return te.SessionMetrics}});var re=y(515);Object.defineProperty(m,"ChannelMetrics",{enumerable:!0,get:function(){return re.ChannelMetrics}});var ie=y(1225);Object.defineProperty(m,"SessionContour",{enumerable:!0,get:function(){return ie.SessionContour}});var se=y(1226);Object.defineProperty(m,"MultiChannelStream",{enumerable:!0,get:function(){return se.MultiChannelStream}})},function(h){h.exports=JSON.parse('{"name":"@vs/vs-ssh","version":"3.4.14","description":"SSH library for Visual Studio tools","keywords":["SSH"],"dependencies":{"buffer":"^5.2.1","debug":"^4.1.1","diffie-hellman":"^5.0.3","vscode-jsonrpc":"^4.0.0"},"author":"Microsoft","main":"./index.js"}')},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0}),m.NodeECDiffieHellman=m.NodeDiffieHellman=void 0;const v=y(11),C=y(9),T=y(276),w=y(281),A=y(56);class NodeDiffieHellman extends T.KeyExchangeAlgorithm{constructor(h,m,y){super(h,m,y,w.NodeHmac.getHashDigestLength(y))}createKeyExchange(){return new NodeDiffieHellmanKex(this.keySizeInBits,w.NodeHmac.getNodeHashAlgorithmName(this.hashAlgorithmName),this.hashDigestLength)}}m.NodeDiffieHellman=NodeDiffieHellman;class NodeDiffieHellmanKex{constructor(h,m,y){switch(this.hashAlgorithmName=m,this.digestLength=y,h){case 1024:this.dh=v.getDiffieHellman("modp2");break;case 2048:this.dh=v.getDiffieHellman("modp14");break;case 4096:this.dh=v.getDiffieHellman("modp16");break;default:throw new Error("Invalid DH bit length.")}}startKeyExchange(){const h=this.dh.generateKeys(),m=A.BigInt.fromBytes(h,{unsigned:!0}).toBytes();return Promise.resolve(m)}decryptKeyExchange(h){const m=this.dh.computeSecret(h),y=A.BigInt.fromBytes(m,{unsigned:!0}).toBytes();return Promise.resolve(y)}async sign(h){const m=v.createHash(this.hashAlgorithmName);return m.update(h),C.Buffer.from(m.digest())}dispose(){}}class NodeECDiffieHellman extends T.KeyExchangeAlgorithm{constructor(h,m,y){super(h,m,y,w.NodeHmac.getHashDigestLength(y))}createKeyExchange(){return new NodeECDiffieHellmanKex(this.keySizeInBits,w.NodeHmac.getNodeHashAlgorithmName(this.hashAlgorithmName),this.hashDigestLength)}}m.NodeECDiffieHellman=NodeECDiffieHellman;class NodeECDiffieHellmanKex{constructor(h,m,y){switch(this.hashAlgorithmName=m,this.digestLength=y,h){case 256:this.ecdh=v.createECDH("prime256v1");break;case 384:this.ecdh=v.createECDH("secp384r1");break;case 521:this.ecdh=v.createECDH("secp521r1");break;default:throw new Error("Invalid ECDH bit length.")}}startKeyExchange(){const h=this.ecdh.generateKeys();return Promise.resolve(h)}decryptKeyExchange(h){const m=this.ecdh.computeSecret(h),y=A.BigInt.fromBytes(m,{unsigned:!0}).toBytes();return Promise.resolve(y)}async sign(h){const m=v.createHash(this.hashAlgorithmName);return m.update(h),C.Buffer.from(m.digest())}dispose(){}}},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0}),m.Sec1KeyFormatter=m.Pkcs1KeyFormatter=m.parsePem=m.formatPem=void 0;const v=y(56),C=y(282),T=y(188);m.formatPem=function formatPem(h,m){return`-----BEGIN ${m}-----\n`+h.toString("base64").match(/.{1,64}/g).join("\n")+"\n"+`-----END ${m}-----\n`},m.parsePem=function parsePem(h){const m=h.replace(/-+[^-\n]+KEY-+/g,"").replace(/\s/g,"");return Buffer.from(m,"base64")};m.Pkcs1KeyFormatter=class Pkcs1KeyFormatter{static formatRsaPublic(h){const m=new C.DerWriter(Buffer.alloc(1024));return m.writeInteger(h.modulus),m.writeInteger(h.exponent),m.toBuffer()}static formatRsaPrivate(h){if(!(h.d&&h.p&&h.q&&h.dp&&h.dq&&h.qi))throw new Error("Missing private key parameters.");const m=new C.DerWriter(Buffer.alloc(2048));return m.writeInteger(v.BigInt.fromInt32(0)),m.writeInteger(h.modulus),m.writeInteger(h.exponent),m.writeInteger(h.d),m.writeInteger(h.p),m.writeInteger(h.q),m.writeInteger(h.dp),m.writeInteger(h.dq),m.writeInteger(h.qi),m.toBuffer()}static parseRsaPublic(h){const m=new C.DerReader(h);return{modulus:m.readInteger(),exponent:m.readInteger()}}static parseRsaPrivate(h){const m=new C.DerReader(h);m.readInteger();return{modulus:m.readInteger(),exponent:m.readInteger(),d:m.readInteger(),p:m.readInteger(),q:m.readInteger(),dp:m.readInteger(),dq:m.readInteger(),qi:m.readInteger()}}};class Sec1KeyFormatter{static formatECPublic(h){const m=T.curves.find(m=>m.oid===h.curve.oid),y=Math.ceil(m.keySize/8),v=new C.DerWriter(Buffer.alloc(512)),w=new C.DerWriter(Buffer.alloc(100));w.writeObjectIdentifier(Sec1KeyFormatter.ecPublicKeyOid),w.writeObjectIdentifier(h.curve.oid),v.writeSequence(w);const A=h.x.toBytes({unsigned:!0,length:y}),P=h.y.toBytes({unsigned:!0,length:y}),k=Buffer.alloc(1+A.length+P.length);return k[0]=4,A.copy(k,1),P.copy(k,1+A.length),v.writeBitString(k),v.toBuffer()}static formatECPrivate(h){const m=T.curves.find(m=>m.oid===h.curve.oid),y=Math.ceil(m.keySize/8),w=new C.DerWriter(Buffer.alloc(512));w.writeInteger(v.BigInt.fromInt32(1)),w.writeOctetString(h.d.toBytes({unsigned:!0,length:y}));const A=new C.DerWriter(Buffer.alloc(100));A.writeObjectIdentifier(h.curve.oid),w.writeTagged(0,A);const P=h.x.toBytes({unsigned:!0,length:y}),k=h.y.toBytes({unsigned:!0,length:y}),R=Buffer.alloc(1+P.length+k.length);R[0]=4,P.copy(R,1),k.copy(R,1+P.length);const M=new C.DerWriter(Buffer.alloc(512));return M.writeBitString(R),w.writeTagged(1,M),w.toBuffer()}static parseECPublic(h){var m;const y=new C.DerReader(h),w=y.readSequence(),A=w.readObjectIdentifier();if(A!==Sec1KeyFormatter.ecPublicKeyOid)throw new Error(`Unexpected key type OID: ${A}`);const P=w.readObjectIdentifier(),k=null===(m=T.curves.find(h=>h.oid===P))||void 0===m?void 0:m.name,R=y.readBitString();if(R.length%2!=1)throw new Error(`Unexpected key data length: ${R.length}`);const M=v.BigInt.fromBytes(R.slice(1,1+(R.length-1)/2),{unsigned:!0}),N=v.BigInt.fromBytes(R.slice(1+(R.length-1)/2),{unsigned:!0});return{curve:{name:k,oid:P},x:M,y:N}}static parseECPrivate(h){var m;const y=new C.DerReader(h),w=y.readInteger().toInt32();if(1!==w)throw new Error(`Unsupported SEC1 format version: ${w}`);const A=v.BigInt.fromBytes(y.readOctetString(),{unsigned:!0}),P=y.tryReadTagged(0);if(!P)throw new Error("SEC1 curve info not found.");const k=P.readObjectIdentifier(),R=null===(m=T.curves.find(h=>h.oid===k))||void 0===m?void 0:m.name,M=y.tryReadTagged(1);if(!M)throw new Error("SEC1 public key data not found.");const N=M.readBitString();if(N.length%2!=1)throw new Error(`Unexpected key data length: ${N.length}`);const D=v.BigInt.fromBytes(N.slice(1,1+(N.length-1)/2),{unsigned:!0}),I=v.BigInt.fromBytes(N.slice(1+(N.length-1)/2),{unsigned:!0});return{curve:{name:R,oid:k},x:D,y:I,d:A}}}m.Sec1KeyFormatter=Sec1KeyFormatter,Sec1KeyFormatter.ecPublicKeyOid="1.2.840.10045.2.1"},function(h,m,y){"use strict";var v,C=this&&this.__decorate||function(h,m,y,v){var C,T=arguments.length,w=T<3?m:null===v?v=Object.getOwnPropertyDescriptor(m,y):v;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)w=Reflect.decorate(h,m,y,v);else for(var A=h.length-1;A>=0;A--)(C=h[A])&&(w=(T<3?C(w):T>3?C(m,y,w):C(m,y))||w);return T>3&&w&&Object.defineProperty(m,y,w),w};Object.defineProperty(m,"__esModule",{value:!0}),m.KeyExchangeService=void 0;const T=y(50),w=y(9),A=y(139),P=y(190),k=y(56),R=y(285),M=y(107),N=y(40),D=y(51),I=y(57),x=y(1220),O=y(6),L=y(108);class ExchangeContext{}let U=v=class KeyExchangeService extends P.SshService{constructor(h,m){super(h),this.isClientSession=m,this.isInitialExchange=!1,this.exchangeContext=null}get exchanging(){return!!this.exchangeContext}async startKeyExchange(h){this.isInitialExchange=h,this.exchangeContext=new ExchangeContext;const m=this.createKeyExchangeInitMessage();let y=null;return this.isClientSession?(h&&this.session.config.enableKeyExchangeGuess&&(y=await this.createKeyExchangeGuessMessage(),m.firstKexPacketFollows=!!y),this.exchangeContext.clientKexInitPayload=m.toBuffer()):this.exchangeContext.serverKexInitPayload=m.toBuffer(),[m,y]}finishKeyExchange(){const h=this.exchangeContext.newAlgorithms;return this.exchangeContext=null,h}abortKeyExchange(){this.exchangeContext=null}createKeyExchangeInitMessage(){const h=this.isClientSession?"ext-info-c":"ext-info-s",m=this.session.config,y=new R.KeyExchangeInitMessage;return y.keyExchangeAlgorithms=(0,M.algorithmNames)(m.keyExchangeAlgorithms).concat(h),y.serverHostKeyAlgorithms=this.getPublicKeyAlgorithms(),y.encryptionAlgorithmsClientToServer=y.encryptionAlgorithmsServerToClient=(0,M.algorithmNames)(m.encryptionAlgorithms),y.macAlgorithmsClientToServer=y.macAlgorithmsServerToClient=(0,M.algorithmNames)(m.hmacAlgorithms),y.compressionAlgorithmsClientToServer=y.compressionAlgorithmsServerToClient=(0,M.algorithmNames)(m.compressionAlgorithms),y.languagesClientToServer=[""],y.languagesServerToClient=[""],y.firstKexPacketFollows=!1,y.reserved=0,y}getPublicKeyAlgorithms(){var h,m;let y=[...this.session.config.publicKeyAlgorithms];if(y.length>1&&!this.isClientSession){const v=null===(m=null===(h=this.session.credentials)||void 0===h?void 0:h.publicKeys)||void 0===m?void 0:m.map(h=>h.keyAlgorithmName);v&&(y=y.filter(h=>h&&v.includes(h.keyAlgorithmName)))}return(0,M.algorithmNames)(y)}async createKeyExchangeGuessMessage(){if(!this.exchangeContext)throw new Error("Key exchange was not started.");const h=this.session.config.keyExchangeAlgorithms[0];if(!h)return null;this.exchangeContext.keyExchange=h.name,this.exchangeContext.exchange=h.createKeyExchange(),this.exchangeContext.exchangeValue=await this.exchangeContext.exchange.startKeyExchange();const m=new R.KeyExchangeDhInitMessage;return m.e=this.exchangeContext.exchangeValue,m}handleMessage(h,m){if(h instanceof R.KeyExchangeInitMessage)return this.handleInitMessage(h,m);if(h instanceof R.KeyExchangeDhInitMessage)return this.handleDhInitMessage(h,m);if(h instanceof R.KeyExchangeDhReplyMessage)return this.handleDhReplyMessage(h,m);throw new Error(`Message not implemented: ${h}`)}async handleInitMessage(h,m){var y,v,C,w,A;if(!this.exchangeContext)throw new Error("Key exchange was not started.");const P=this.session.config;if(this.exchangeContext.keyExchange=this.chooseAlgorithm("KeyExchange",(0,M.algorithmNames)(P.keyExchangeAlgorithms),h.keyExchangeAlgorithms),"none"===this.exchangeContext.keyExchange)return(0,T.trace)("Client and server negotiated no security. Cancelling key-exchange."),this.exchangeContext.newAlgorithms=new x.SshSessionAlgorithms,void await this.session.handleNewKeysMessage(new R.NewKeysMessage,m);let k;if(this.exchangeContext.publicKey=this.chooseAlgorithm("PublicKey",this.getPublicKeyAlgorithms(),h.serverHostKeyAlgorithms),this.exchangeContext.clientEncryption=this.chooseAlgorithm("ClientEncryption",(0,M.algorithmNames)(P.encryptionAlgorithms),h.encryptionAlgorithmsClientToServer),this.exchangeContext.serverEncryption=this.chooseAlgorithm("ServerEncryption",(0,M.algorithmNames)(P.encryptionAlgorithms),h.encryptionAlgorithmsServerToClient),this.exchangeContext.clientHmac=this.chooseAlgorithm("ClientHmac",(0,M.algorithmNames)(P.hmacAlgorithms),h.macAlgorithmsClientToServer),this.exchangeContext.serverHmac=this.chooseAlgorithm("ServerHmac",(0,M.algorithmNames)(P.hmacAlgorithms),h.macAlgorithmsServerToClient),this.exchangeContext.clientCompression=this.chooseAlgorithm("ClientCompression",(0,M.algorithmNames)(P.compressionAlgorithms),h.compressionAlgorithmsClientToServer),this.exchangeContext.serverCompression=this.chooseAlgorithm("ServerCompression",(0,M.algorithmNames)(P.compressionAlgorithms),h.compressionAlgorithmsServerToClient),this.isClientSession){this.exchangeContext.serverKexInitPayload=h.toBuffer();const v=!!this.exchangeContext.exchangeValue,C=this.exchangeContext.keyExchange===(null===(y=P.keyExchangeAlgorithms[0])||void 0===y?void 0:y.name);if(!v||!C){const h=P.getKeyExchangeAlgorithm(this.exchangeContext.keyExchange);this.exchangeContext.exchange=h.createKeyExchange(),this.exchangeContext.exchangeValue=await this.exchangeContext.exchange.startKeyExchange();const y=new R.KeyExchangeDhInitMessage;y.e=this.exchangeContext.exchangeValue,await this.session.sendMessage(y,m)}k="ext-info-s"}else{if(h.firstKexPacketFollows){const m=this.exchangeContext.keyExchange===(null===(v=h.keyExchangeAlgorithms)||void 0===v?void 0:v[0]),y=m?"correct":"incorrect";if((0,T.trace)(`Client's KeyExchange guess was ${y}.`),this.exchangeContext.discardGuessedInit=!m,m&&this.session.remoteVersion.isVsSsh&&(null===(C=this.session.remoteVersion.version)||void 0===C?void 0:C.startsWith("2."))){(null===(w=h.keyExchangeAlgorithms)||void 0===w?void 0:w[0])===(null===(A=P.keyExchangeAlgorithms[0])||void 0===A?void 0:A.name)||((0,T.trace)("Ignoring correct guess for compatibility with older client."),this.exchangeContext.discardGuessedInit=!0)}}this.exchangeContext.clientKexInitPayload=h.toBuffer(),k="ext-info-c"}this.isInitialExchange&&h.keyExchangeAlgorithms.includes(k)&&await this.session.sendExtensionInfo(m)}async handleDhInitMessage(h,m){var y,v,C,T,A,P,k;if(this.isClientSession)return;const M=this.session;if(!this.exchangeContext||!this.exchangeContext.keyExchange||!this.exchangeContext.publicKey)throw new D.SshConnectionError("Key exchange not started.",I.SshDisconnectReason.protocolError);if(this.exchangeContext.discardGuessedInit)return void(this.exchangeContext.discardGuessedInit=!1);const N=this.session.config.getKeyExchangeAlgorithm(this.exchangeContext.keyExchange);if(!N)throw new D.SshConnectionError("Key exchange not supported for algorithm: "+this.exchangeContext.keyExchange,I.SshDisconnectReason.keyExchangeFailed);const L=this.session.config.getPublicKeyAlgorithm(this.exchangeContext.publicKey);if(!L)throw new D.SshConnectionError("Public key algorithm not supported: "+this.exchangeContext.publicKey,I.SshDisconnectReason.keyExchangeFailed);let U=null;if(null===(y=M.credentials)||void 0===y?void 0:y.publicKeys){const h=M.credentials.publicKeys.find(h=>h.keyAlgorithmName===L.keyAlgorithmName);if(U=null!=h?h:null,!1===(null==U?void 0:U.hasPrivateKey)){if(!M.credentials.privateKeyProvider)throw new Error("A private key provider is required.");U=await M.credentials.privateKeyProvider(h,null!=m?m:O.CancellationToken.None)}}if(null==U)throw new D.SshConnectionError("Private key not found for algorithm: "+this.exchangeContext.publicKey,I.SshDisconnectReason.keyExchangeFailed);const B=this.session.config.getEncryptionAlgorithm(this.exchangeContext.clientEncryption),W=this.session.config.getEncryptionAlgorithm(this.exchangeContext.serverEncryption),q=this.session.config.getHmacAlgorithm(this.exchangeContext.serverHmac),Y=this.session.config.getHmacAlgorithm(this.exchangeContext.clientHmac),V=N.createKeyExchange(),$=h.e||w.Buffer.alloc(0),z=await V.startKeyExchange(),G=await V.decryptKeyExchange($),J=await U.getPublicKeyBytes(L.name);if(!J)throw new D.SshConnectionError("Public key not set.",I.SshDisconnectReason.keyExchangeFailed);const X=await this.computeExchangeHash(V,J,$,z,G);this.session.sessionId||(this.session.sessionId=X);const[Z,ee,te,re,ie,se]=await this.computeKeys(V,G,X,B,W,Y,q),oe=null!==(v=await(null==W?void 0:W.createCipher(!0,re,ee)))&&void 0!==v?v:null,ae=null!==(C=await(null==B?void 0:B.createCipher(!1,te,Z)))&&void 0!==C?C:null,ce=null!==(T=await(null==q?void 0:q.createSigner(se)))&&void 0!==T?T:null,le=null!==(A=await(null==Y?void 0:Y.createVerifier(ie)))&&void 0!==A?A:null,ue=new x.SshSessionAlgorithms;ue.publicKeyAlgorithmName=this.exchangeContext.publicKey,ue.cipher=oe,ue.decipher=ae,ue.signer=ce,ue.verifier=le,ue.messageSigner=(null===(P=oe)||void 0===P?void 0:P.authenticatedEncryption)?oe:ce,ue.messageVerifier=(null===(k=ae)||void 0===k?void 0:k.authenticatedEncryption)?ae:le,ue.compressor=this.session.config.getCompressionAlgorithm(this.exchangeContext.serverCompression),ue.decompressor=this.session.config.getCompressionAlgorithm(this.exchangeContext.clientCompression),this.exchangeContext.newAlgorithms=ue,Z&&Z.fill(0),te&&te.fill(0),ie&&ie.fill(0),ee&&ee.fill(0),re&&re.fill(0),se&&se.fill(0);const de=L.createSigner(U);let he=await de.sign(X);he=L.createSignatureData(he);const pe=new R.KeyExchangeDhReplyMessage;pe.hostKey=J,pe.f=z,pe.signature=he,await this.session.sendMessage(pe,m),await this.session.sendMessage(new R.NewKeysMessage,m)}async handleDhReplyMessage(h,m){var y,v,C,w,A,P,k,M;if(!this.isClientSession)return;if(!this.exchangeContext)throw new D.SshConnectionError("Key exchange was not started.",I.SshDisconnectReason.protocolError);const N=this.session.config,O=this.exchangeContext.exchange,L=this.exchangeContext.publicKey,U=N.getPublicKeyAlgorithm(L),B=N.getEncryptionAlgorithm(this.exchangeContext.clientEncryption),W=N.getEncryptionAlgorithm(this.exchangeContext.serverEncryption),q=N.getHmacAlgorithm(this.exchangeContext.serverHmac),Y=N.getHmacAlgorithm(this.exchangeContext.clientHmac),V=this.exchangeContext.exchangeValue,$=h.f;if(!O||!V)throw new D.SshConnectionError("Failed to initialize crypto after key exchange.",I.SshDisconnectReason.keyExchangeFailed);this.hostKey=U.createKeyPair(),await this.hostKey.setPublicKeyBytes(h.hostKey);const z=await O.decryptKeyExchange($),G=h.hostKey,J=await this.computeExchangeHash(O,G,V,$,z),X=U.readSignatureData(h.signature),Z=U.createVerifier(this.hostKey);let ee;try{ee=await Z.verify(J,X)}catch(h){if(!(h instanceof Error))throw h;throw(0,T.trace)(`Server public key verification error: ${null!==(y=h.message)&&void 0!==y?y:h}`),new D.SshConnectionError("Server public key verification failed: "+(null!==(v=h.message)&&void 0!==v?v:h),I.SshDisconnectReason.hostKeyNotVerifiable)}if(!ee)throw(0,T.trace)("Server public key verification failed."),new D.SshConnectionError("Server public key verification failed.",I.SshDisconnectReason.hostKeyNotVerifiable);(0,T.trace)("Server public key verification succeeded."),null==this.session.sessionId&&(this.session.sessionId=J);const[te,re,ie,se,oe,ae]=await this.computeKeys(O,z,J,B,W,Y,q),ce=null!==(C=await(null==B?void 0:B.createCipher(!0,ie,te)))&&void 0!==C?C:null,le=null!==(w=await(null==W?void 0:W.createCipher(!1,se,re)))&&void 0!==w?w:null,ue=null!==(A=await(null==Y?void 0:Y.createSigner(oe)))&&void 0!==A?A:null,de=null!==(P=await(null==q?void 0:q.createVerifier(ae)))&&void 0!==P?P:null,he=new x.SshSessionAlgorithms;he.publicKeyAlgorithmName=L,he.cipher=ce,he.decipher=le,he.signer=ue,he.verifier=de,he.messageSigner=(null===(k=ce)||void 0===k?void 0:k.authenticatedEncryption)?ce:ue,he.messageVerifier=(null===(M=le)||void 0===M?void 0:M.authenticatedEncryption)?le:de,he.compressor=N.getCompressionAlgorithm(this.exchangeContext.clientCompression),he.decompressor=N.getCompressionAlgorithm(this.exchangeContext.serverCompression),this.exchangeContext.newAlgorithms=he,te&&te.fill(0),ie&&ie.fill(0),oe&&oe.fill(0),re&&re.fill(0),se&&se.fill(0),ae&&ae.fill(0),await this.session.sendMessage(new R.NewKeysMessage,m)}chooseAlgorithm(h,m,y){var v;let C,w;this.isClientSession?(C=y||[],w=m):(C=m,w=y||[]);const A=`${h} negotiation: `+`Server (${C.join(", ")}) `+`Client (${w.join(", ")})`;if(this.session.remoteVersion.isVsSsh&&(null===(v=this.session.remoteVersion.version)||void 0===v?void 0:v.startsWith("2."))){const h=C;C=w,w=h}for(let h of w)for(let m of C)if(m===h){const h=m;return(0,T.trace)(`${A} => ${h}`),h}throw new Error(`Failed ${A}`)}async computeExchangeHash(h,m,y,v,C){if(!this.session.remoteVersion)throw new Error("Key exchange not completed.");const T=new N.SshDataWriter(w.Buffer.alloc(2048));return this.isClientSession?(T.writeString(A.SshSession.localVersion.toString(),"ascii"),T.writeString(this.session.remoteVersion.toString(),"ascii")):(T.writeString(this.session.remoteVersion.toString(),"ascii"),T.writeString(A.SshSession.localVersion.toString(),"ascii")),T.writeBinary(this.exchangeContext.clientKexInitPayload),T.writeBinary(this.exchangeContext.serverKexInitPayload),T.writeBinary(m),T.writeBigInt(k.BigInt.fromBytes(y,{unsigned:!0})),T.writeBigInt(k.BigInt.fromBytes(v,{unsigned:!0})),T.writeBigInt(k.BigInt.fromBytes(C,{unsigned:!0})),await h.sign(T.toBuffer())}async computeKeys(h,m,y,v,C,T,A){var P,k;const R=new N.SshDataWriter(w.Buffer.alloc(4+m.length+y.length+Math.max(1+(null!==(k=null===(P=this.session.sessionId)||void 0===P?void 0:P.length)&&void 0!==k?k:0),h.digestLength)));R.writeBinary(m),R.write(y);const M=R.position;return[v&&await this.computeKey(h,R,M,v.blockLength,"A"),C&&await this.computeKey(h,R,M,C.blockLength,"B"),v&&await this.computeKey(h,R,M,v.keyLength,"C"),C&&await this.computeKey(h,R,M,C.keyLength,"D"),T&&await this.computeKey(h,R,M,T.keyLength,"E"),A&&await this.computeKey(h,R,M,A.keyLength,"F")]}async computeKey(h,m,y,v,C){const T=w.Buffer.alloc(v);let A=0,P=0,k=null;if(!this.session.sessionId)throw new Error("Session ID not set.");for(;A<v;)m.position=y,k?m.write(k):(m.writeByte(C.charCodeAt(0)),m.write(this.session.sessionId)),k=await h.sign(m.toBuffer()),P=Math.min(k.length,v-A),k.copy(T,A),A+=P;return k&&k.fill(0),T}};U.serviceName="ssh-keyexchange",U=v=C([(0,L.serviceActivation)({serviceRequest:v.serviceName})],U),m.KeyExchangeService=U},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0}),m.ChannelMetrics=void 0;m.ChannelMetrics=class ChannelMetrics{constructor(){this.bytesSentSum=0,this.bytesReceivedSum=0}get bytesSent(){return this.bytesSentSum}get bytesReceived(){return this.bytesReceivedSum}addBytesSent(h){this.bytesSentSum+=h}addBytesReceived(h){this.bytesReceivedSum+=h}toString(){return`Bytes S/R: ${this.bytesSent} / ${this.bytesReceived}; `}}},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0}),m.SshChannelClosedEventArgs=void 0;m.SshChannelClosedEventArgs=class SshChannelClosedEventArgs{constructor(h,m){"number"==typeof h?this.exitStatus=h:"string"==typeof h?(this.exitSignal=h,this.errorMessage=m):h instanceof Error&&(this.error=h)}}},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0}),m.SshVersionInfo=void 0;const v=y(511),C=v.name.replace(/^@\w+\//,""),T=v.version;class SshVersionInfo{constructor(h,m,y,v){this.versionString=h,this.protocolVersion=m,this.name=y,this.version=v}static tryParse(h){if(!h)throw new TypeError("Version string expected.");if(!h.startsWith("SSH-"))return null;const m=h.indexOf("-",4);if(m<=0)return null;const y=h.substring(4,m);if(!/^\d+\.\d+$/.test(y))return null;let v,C;const T=h.substring(m+1),w=T.indexOf(" "),A=T.lastIndexOf("_",w>=0?w:T.length-1);if(A>=0){v=T.substring(0,A).replace(/_/g," "),C=T.substring(A+1);for(let h=0;h<C.length;h++){const m=C[h];if(!(m>="0"&&m<="9")&&"."!==m){C=C.substring(0,h);break}}/^\d+(\.\d+)*$/.test(C)||(C=null)}else v=T,C=null;return new SshVersionInfo(h,y,v,C)}static getLocalVersion(){return new SshVersionInfo(`SSH-2.0-${C}_${T}`,"2.0",C,T)}toString(){return this.versionString}get isVsSsh(){return this.isVsSshCS||this.isVsSshTS}get isVsSshCS(){return"Microsoft.VisualStudio.Ssh"===this.name}get isVsSshTS(){return"vs-ssh"===this.name}}m.SshVersionInfo=SshVersionInfo},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0}),m.SshChannelOpeningEventArgs=void 0;const v=y(81);m.SshChannelOpeningEventArgs=class SshChannelOpeningEventArgs{constructor(h,m,y){if(this.request=h,this.channel=m,this.isRemoteRequest=y,this.failureReason=v.SshChannelOpenFailureReason.none,this.failureDescription=null,!h)throw new TypeError("A channel open message is required.");if(!m)throw new TypeError("A channel is required.")}toString(){return`${this.channel.toString()}${this.failureReason?" "+v.SshChannelOpenFailureReason[this.failureReason]:""}`}}},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0}),m.AuthenticationSuccessMessage=m.AuthenticationFailureMessage=m.PasswordRequestMessage=m.PublicKeyOKMessage=m.PublicKeyRequestMessage=m.AuthenticationRequestMessage=m.AuthenticationMessage=void 0;const v=y(109);class AuthenticationMessage extends v.SshMessage{}m.AuthenticationMessage=AuthenticationMessage;class AuthenticationRequestMessage extends AuthenticationMessage{get messageType(){return 50}onRead(h){this.username=h.readString("utf8"),this.serviceName=h.readString("ascii"),this.methodName=h.readString("ascii")}onWrite(h){h.writeString(this.username||"","utf8"),h.writeString(this.serviceName||"","ascii"),h.writeString(this.validateField(this.methodName,"method name"),"ascii")}}m.AuthenticationRequestMessage=AuthenticationRequestMessage;m.PublicKeyRequestMessage=class PublicKeyRequestMessage extends AuthenticationRequestMessage{constructor(){super(),this.methodName="publickey"}get hasSignature(){return!!(this.signature&&this.signature.length>0)}onRead(h){super.onRead(h);const m=h.readBoolean();this.keyAlgorithmName=h.readString("ascii"),this.publicKey=h.readBinary(),m?(this.signature=h.readBinary(),this.payloadWithoutSignature=this.rawBytes.slice(0,this.rawBytes.length-this.signature.length-4)):this.signature=void 0}onWrite(h){var m,y;if(super.onWrite(h),!this.keyAlgorithmName)throw new Error("Key algorithm name not set.");if("hostbased"===this.methodName){if(h.writeString(this.keyAlgorithmName,"ascii"),h.writeBinary(this.publicKey||Buffer.alloc(0)),h.writeString(null!==(m=this.clientHostname)&&void 0!==m?m:"","ascii"),h.writeString(null!==(y=this.clientUsername)&&void 0!==y?y:"","ascii"),!this.hasSignature)throw new Error("A signature is required for a host-based authentcation request.");h.writeBinary(this.signature)}else h.writeBoolean(this.hasSignature),h.writeString(this.keyAlgorithmName,"ascii"),h.writeBinary(this.publicKey||Buffer.alloc(0)),this.hasSignature&&h.writeBinary(this.signature)}};m.PublicKeyOKMessage=class PublicKeyOKMessage extends AuthenticationMessage{get messageType(){return 60}onRead(h){this.keyAlgorithmName=h.readString("ascii"),this.publicKey=h.readBinary()}onWrite(h){if(!this.keyAlgorithmName)throw new Error("Key algorithm name not set.");if(!this.publicKey)throw new Error("Public key not set.");h.writeString(this.keyAlgorithmName,"ascii"),h.writeBinary(this.publicKey)}};m.PasswordRequestMessage=class PasswordRequestMessage extends AuthenticationRequestMessage{constructor(){super(),this.methodName="password"}onRead(h){super.onRead(h),h.readBoolean(),this.password=h.readString("utf8")}onWrite(h){super.onWrite(h),h.writeBoolean(!1),h.writeString(this.password||"","utf8")}};class AuthenticationFailureMessage extends AuthenticationMessage{constructor(){super(...arguments),this.partialSuccess=!1}get messageType(){return 51}onRead(h){this.methodNames=h.readList("ascii"),this.partialSuccess=h.readBoolean()}onWrite(h){h.writeList(this.methodNames||[],"ascii"),h.writeBoolean(this.partialSuccess)}}m.AuthenticationFailureMessage=AuthenticationFailureMessage;class AuthenticationSuccessMessage extends AuthenticationMessage{get messageType(){return 52}onRead(h){}onWrite(h){}}m.AuthenticationSuccessMessage=AuthenticationSuccessMessage,v.SshMessage.index.set(50,AuthenticationRequestMessage),v.SshMessage.index.set(51,AuthenticationFailureMessage),v.SshMessage.index.set(52,AuthenticationSuccessMessage)},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0}),m.SessionMetrics=void 0;const v=y(6);m.SessionMetrics=class SessionMetrics{constructor(){this.startTime=0,this.messagesSentCount=0,this.messagesReceivedCount=0,this.bytesSentSum=0,this.bytesReceivedSum=0,this.reconnectionsCount=0,this.currentLatency=0,this.minLatency=0,this.maxLatency=0,this.latencySum=0,this.latencyCount=0,this.messageSentEmitter=new v.Emitter,this.onMessageSent=this.messageSentEmitter.event,this.messageReceivedEmitter=new v.Emitter,this.onMessageReceived=this.messageReceivedEmitter.event,this.latencyUpdatedEmitter=new v.Emitter,this.onLatencyUpdated=this.latencyUpdatedEmitter.event,this.sessionClosedEmitter=new v.Emitter,this.onSessionClosed=this.sessionClosedEmitter.event,"object"==typeof performance&&performance.now?Object.defineProperty(this,"time",{get:this.browserTime}):"object"==typeof process&&process.hrtime&&Object.defineProperty(this,"time",{get:this.nodejsTime}),this.startTime=this.time}get time(){return Date.now()-this.startTime}browserTime(){return performance.now()-this.startTime}nodejsTime(){const[h,m]=process.hrtime();return 1e3*h+m/1e6-this.startTime}get messagesSent(){return this.messagesSentCount}get messagesReceived(){return this.messagesReceivedCount}get bytesSent(){return this.bytesSentSum}get bytesReceived(){return this.bytesReceivedSum}get reconnections(){return this.reconnectionsCount}get latencyAverageMs(){return 0===this.latencyCount?0:this.latencySum/this.latencyCount}get latencyMinMs(){return this.minLatency}get latencyMaxMs(){return this.maxLatency}get latencyCurrentMs(){return this.currentLatency}addMessageSent(h){this.messagesSentCount++,this.bytesSentSum+=h,this.messageSentEmitter.fire({time:this.time,size:h})}addMessageReceived(h){this.messagesReceivedCount++,this.bytesReceivedSum+=h,this.messageReceivedEmitter.fire({time:this.time,size:h})}addReconnection(){this.reconnectionsCount++}updateLatency(h){if(h<0)throw new Error("Measured latency cannot be negative.");this.currentLatency=h,0!==h&&((0===this.minLatency||h<this.minLatency)&&(this.minLatency=h),(0===this.maxLatency||h>this.maxLatency)&&(this.maxLatency=h),this.latencySum+=h,this.latencyCount++,this.latencyUpdatedEmitter.fire({time:this.time,latency:h}))}close(){this.currentLatency=0,this.sessionClosedEmitter.fire()}toString(){let h=`Messages S/R: ${this.messagesSent} / ${this.messagesReceived}; `+`Bytes S/R: ${this.bytesSent} / ${this.bytesReceived}; `+`Reconnections: ${this.reconnections}; `;const m=this.minLatency>=10?1:this.minLatency>=1?10:100;if(this.maxLatency>0){h+=`Latency Min-Avg-Max: ${Math.round(this.minLatency*m)/m} - ${Math.round(this.latencySum/this.latencyCount*m)/m} - ${Math.round(this.maxLatency*m)/m} ms; `}if(this.currentLatency>0){h+=`Current Latency: ${Math.round(this.currentLatency*m)/m} ms; `}return h}}},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0}),m.SshSessionClosedEventArgs=void 0;const v=y(57);m.SshSessionClosedEventArgs=class SshSessionClosedEventArgs{constructor(h,m,y){if(this.reason=h,this.message=m,this.error=y,!m)throw new TypeError("A disconnect message is required.")}toString(){return`${v.SshDisconnectReason[this.reason]}: ${this.message}`}}},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0}),m.SshStream=void 0;const v=y(82),C=y(19);class SshStream extends C.Duplex{constructor(h){let m=null;super({async write(m,y,v){let C;try{let v;if("string"==typeof m)v=Buffer.from(m,y);else{if(!(m instanceof Buffer))throw new Error("Unsupported chunk type: "+typeof m);v=m}await h.send(v)}catch(h){if(!(h instanceof Error))throw h;C=h}v&&v(C)},async writev(m,y){let v;try{if(1===m.length)return this.write(m[0].chunk,m[0].encoding,y);{const y=m.reduce((function BufferReduce(h,m){if(m.chunk instanceof Buffer)return h+m.chunk.length;throw new Error("Unsupported chunk type: "+typeof m.chunk)}),0),v=Buffer.alloc(y);let C=0;for(let h=0;h<m.length;h++)m[h].chunk.copy(v,C),C+=m[h].chunk.length;await h.send(v)}}catch(h){if(!(h instanceof Error))throw h;v=h}y&&y(v)},async final(m){let y;try{await h.close()}catch(h){if(!(h instanceof Error))throw h;y=h}m&&m(y)},read(){m&&(m.resolve(),m=null)}});const y=this;h.onDataReceived(async C=>{const T=Buffer.alloc(C.length);C.copy(T),y.push(T)||(m||(m=new v.PromiseCompletionSource),await m.promise),h.adjustWindow(T.length)}),h.onClosed(()=>{y.push(null)})}}m.SshStream=SshStream},function(h,m,y){"use strict";var v=this&&this.__awaiter||function(h,m,y,v){return new(y||(y=Promise))((function(C,T){function fulfilled(h){try{step(v.next(h))}catch(h){T(h)}}function rejected(h){try{step(v.throw(h))}catch(h){T(h)}}function step(h){h.done?C(h.value):function adopt(h){return h instanceof y?h:new y((function(m){m(h)}))}(h.value).then(fulfilled,rejected)}step((v=v.apply(h,m||[])).next())}))};Object.defineProperty(m,"__esModule",{value:!0});const C=y(66),T=y(6),w=y(142),A=y(275);m.RelayHubProxyServer=class RelayHubProxyServer{constructor(h,m,y,v,C){this.relayServiceProxy=h,this.hubId=m,this.logger=y,this.hubDataType=v,this.hostProperties=C,this.onHubJoinedEmitter=new T.Emitter,this.onStreamJoinedEmitter=new T.Emitter,this.onHubJoined=this.onHubJoinedEmitter.event,this.onStreamJoined=this.onStreamJoinedEmitter.event}acceptConnections(h){return v(this,void 0,void 0,(function*(){const m=this.relayServiceProxy.hubProxy,joinIfConnected=()=>v(this,void 0,void 0,(function*(){m.isConnected?yield this.joinHubAndAcceptConnections():this.onHubJoinedEmitter.fire(null)})),y=m.onConnectionStateChanged(()=>v(this,void 0,void 0,(function*(){try{yield joinIfConnected()}catch(h){this.logger.error(`Failed to join hub id:${this.hubId}`,h)}})));h&&h.onCancellationRequested(()=>y.dispose()),yield joinIfConnected()}))}joinHubAndAcceptConnections(){return v(this,void 0,void 0,(function*(){const h=this.hostProperties||{[w.PARTICIPANT_PROPERTY_IS_HOST]:!0,[w.PARTICIPANT_PROPERTY_HOST_FLAGS]:w.HostFlags.JoinReadAck},m=yield this.relayServiceProxy.joinHub(this.hubId,h,{createIfNotExists:!0});this.logger.verbose(`accept connections for hub:${this.hubId} host id:${m.selfParticipant.id} on service:${m.serviceId} stamp:${m.stamp}`),this.onHubJoinedEmitter.fire(m);let y=0;const T=this.hubDataType||w.DATA_TYPE_LIVESHARE_HUB,P=m.onReceiveData(h=>v(this,void 0,void 0,(function*(){if(h.type===w.DATA_TYPE_JOINED_READY){this.logger.verbose(`participant:${h.fromParticipant.id} joined for hub:${this.hubId}`);let v=T,P=T;m.selfParticipant.id===h.fromParticipant.id&&(v=`${T}-${++y}`,P=`${T}-${++y}`,this.logger.verbose(`support for self join types:${v}|${P}`));const k=new A.HubStream(m,v,P,h.fromParticipant.id);this.onStreamJoinedEmitter.fire(k),yield m.sendData(C.SendOption.None,[h.fromParticipant.id],w.DATA_TYPE_JOINED_READY_ACK,Buffer.from(JSON.stringify([v,P])))}}))),k=m.onDisconnected(()=>(P.dispose(),k.dispose(),Promise.resolve()));return k}))}}},function(h,m,y){"use strict";var v=this&&this.__awaiter||function(h,m,y,v){return new(y||(y=Promise))((function(C,T){function fulfilled(h){try{step(v.next(h))}catch(h){T(h)}}function rejected(h){try{step(v.throw(h))}catch(h){T(h)}}function step(h){h.done?C(h.value):function adopt(h){return h instanceof y?h:new y((function(m){m(h)}))}(h.value).then(fulfilled,rejected)}step((v=v.apply(h,m||[])).next())}))};Object.defineProperty(m,"__esModule",{value:!0});const C=y(80),T=y(182),w=y(489);m.createLocalWorkspaceClient=function createLocalWorkspaceClient(h,m){return new T.WorkspaceClient(h,(y,T)=>v(this,void 0,void 0,(function*(){return yield w.openWorkspaceConnection(y,h,m,C.dependencies.hubConnectionServiceFactory())})),{enabled:!0,retryTimeout:5e3,maxTimeReconnect:6e4})}},function(h,m,y){"use strict";var v=this&&this.__awaiter||function(h,m,y,v){return new(y||(y=Promise))((function(C,T){function fulfilled(h){try{step(v.next(h))}catch(h){T(h)}}function rejected(h){try{step(v.throw(h))}catch(h){T(h)}}function step(h){h.done?C(h.value):function adopt(h){return h instanceof y?h:new y((function(m){m(h)}))}(h.value).then(fulfilled,rejected)}step((v=v.apply(h,m||[])).next())}))},C=this&&this.__importStar||function(h){if(h&&h.__esModule)return h;var m={};if(null!=h)for(var y in h)Object.hasOwnProperty.call(h,y)&&(m[y]=h[y]);return m.default=h,m};Object.defineProperty(m,"__esModule",{value:!0});const T=C(y(29));m.createDuplexStreams=function createDuplexStreams(){return DuplexStream.createStreams()};class DuplexStream extends T.BaseStream{constructor(){super()}static createStreams(){const h=new DuplexStream,m=new DuplexStream;return h.other=m,m.other=h,[h,m]}write(h,m){return v(this,void 0,void 0,(function*(){if(!h)throw new TypeError("Data is required.");this.other.onData(Buffer.from(h))}))}close(h,m){return v(this,void 0,void 0,(function*(){h?(this.onError(h),this.dispose(),this.other.onError(h),this.other.dispose()):(this.dispose(),this.other.onEnd(),this.other.dispose())}))}dispose(){super.dispose(),this.other.isDisposed||(this.other.onError(new Error("Stream disposed.")),this.other.dispose())}}},function(h,m,y){"use strict";var v=this&&this.__awaiter||function(h,m,y,v){return new(y||(y=Promise))((function(C,T){function fulfilled(h){try{step(v.next(h))}catch(h){T(h)}}function rejected(h){try{step(v.throw(h))}catch(h){T(h)}}function step(h){h.done?C(h.value):function adopt(h){return h instanceof y?h:new y((function(m){m(h)}))}(h.value).then(fulfilled,rejected)}step((v=v.apply(h,m||[])).next())}))},C=this&&this.__importStar||function(h){if(h&&h.__esModule)return h;var m={};if(null!=h)for(var y in h)Object.hasOwnProperty.call(h,y)&&(m[y]=h[y]);return m.default=h,m};Object.defineProperty(m,"__esModule",{value:!0});const T=C(y(29)),w=y(16);m.createMultiChannelRpcClient=function createMultiChannelRpcClient(h,m,y=!0){return v(this,void 0,void 0,(function*(){const v=new T.MultiChannelStream(h),C=yield v.openChannel(),w=new MultiChannelRpcClient(v,C,m);return w.addToDisposables(v,{dispose:()=>h.close()}),y&&w.rpcConnection.listen(),w}))};class MultiChannelRpcClient extends w.RpcClient{constructor(h,m,y){super({},y),this.multiChannelStream=h;const v=new T.SshRpcMessageStream(m);this.setConnection(this.createRpcConnection(v,y))}get rpcConnection(){return this.connection}}},function(h,m,y){"use strict";var v=this&&this.__awaiter||function(h,m,y,v){return new(y||(y=Promise))((function(C,T){function fulfilled(h){try{step(v.next(h))}catch(h){T(h)}}function rejected(h){try{step(v.throw(h))}catch(h){T(h)}}function step(h){h.done?C(h.value):function adopt(h){return h instanceof y?h:new y((function(m){m(h)}))}(h.value).then(fulfilled,rejected)}step((v=v.apply(h,m||[])).next())}))};Object.defineProperty(m,"__esModule",{value:!0});const C=y(0),T=y(14),w=y(12);m.TextSearchService=class TextSearchService{constructor(h,m){this.pathManager=h,this.trace=m}getTextSearchResultsAsync(h,m){return v(this,void 0,void 0,(function*(){return[]}))}getTextSearchResultsWithProgressAsync(h,y,A){return v(this,void 0,void 0,(function*(){let v=m.toVscodeQuery(h),A=m.toVscodeOptions(h),P=0,k=0,R=new C.CancellationTokenSource,M=w.Settings.get(T.SettingKeys.textSearchResultsLimit)||1e4,N=w.Settings.get(T.SettingKeys.textSearchPreviewLimit)||200;if(C.workspace.findTextInFiles)try{yield C.workspace.findTextInFiles(v,A,h=>{if(P>M)return;let m=this.toVslsResults(h);for(let h=0;h<m.length;++h){let v=m[h];if(v.path){if(P++,P===M&&(v.hitResultsLimit=!0),v.text.length>N){let h=v.text;const m=100;h=v.column<m?v.text.substr(0,N):v.text.substr(v.column-m,v.column-m+N),v.text=h}y.report(v)}else k++}},R.token),this.trace.info(`Results returned: ${P}, results excluded: ${k}`)}catch(h){this.trace.error(`Problem obtaining search results on host side: ${h.message}`)}}))}toVslsResults(h){let y=this.pathManager.localPathToRelativePath(h.uri);return m.toVersionedVslsResults(h,y)}},m.toVscodeQuery=h=>({pattern:h.pattern||"",isRegExp:h.isRegex||!1,isCaseSensitive:h.isCaseSensitive||!1,isWordMatch:h.isWordMatch}),m.toVscodeOptions=h=>({include:h.fileIncludes&&h.fileIncludes.length>0?`{${h.fileIncludes.join(",")}}`:"",exclude:h.fileExcludes&&h.fileExcludes.length>0?`{${h.fileExcludes.join(",")}}`:"",encoding:h.encoding,useIgnoreFiles:h.includeHiddenFiles,maxResults:w.Settings.get(T.SettingKeys.textSearchResultsLimit)||1e4}),m.toVersionedVslsResults=(h,m)=>{if(h.range){let y=h;return[{path:m,text:y.preview.text,line:y.range.start.line,column:y.range.start.character,length:y.range.end.character-y.range.start.character}]}let y=h;if(Array.isArray(y.ranges)){let h=y.ranges,v=y.preview.matches,C=new Array,T=h.map(h=>({line:h.start.line,column:h.start.character,endLine:h.end.line,endColumn:h.end.character})),w=v.map(h=>({line:h.start.line,column:h.start.character,endLine:h.end.line,endColumn:h.end.character})),A={path:m,text:y.preview.text,line:h[0].start.line,column:h[0].start.character,length:h[0].end.character-h[0].start.character,ranges:T,previewRanges:w};C.push(A);for(let v=1;v<h.length;++v){let T=h[v];C.push({path:m,text:y.preview.text,line:T.start.line,column:T.start.character,length:T.end.character-T.start.character})}return C}{let h=y.ranges,v=y.preview.matches,C=[{line:h.start.line,column:h.start.character,endLine:h.end.line,endColumn:h.end.character}],T=[{line:v.start.line,column:v.start.character,endLine:v.end.line,endColumn:v.end.character}];return[{path:m,text:y.preview.text,line:h.start.line,column:h.start.character,length:h.end.character-h.start.character,ranges:C,previewRanges:T}]}}},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0}),function __export(h){for(var y in h)m.hasOwnProperty(y)||(m[y]=h[y])}(y(1255))},function(h,m,y){"use strict";var v=this&&this.__awaiter||function(h,m,y,v){return new(y||(y=Promise))((function(C,T){function fulfilled(h){try{step(v.next(h))}catch(h){T(h)}}function rejected(h){try{step(v.throw(h))}catch(h){T(h)}}function step(h){h.done?C(h.value):function adopt(h){return h instanceof y?h:new y((function(m){m(h)}))}(h.value).then(fulfilled,rejected)}step((v=v.apply(h,m||[])).next())}))};Object.defineProperty(m,"__esModule",{value:!0});const C=y(0),T=y(3),w=y(4);m.SessionStateStatusProvider=class SessionStateStatusProvider{constructor(){this.statusChangedEvent=new C.EventEmitter,this.lastStatus=this.status,T.sessionStateTracker.onStateChanged(h=>v(this,void 0,void 0,(function*(){this.status!==this.lastStatus&&(this.lastStatus=this.status,this.statusChangedEvent.fire(this.status))})))}get id(){return"liveshare-State"}get status(){return T.sessionStateTracker.State===T.SessionState.Joined||T.sessionStateTracker.State===T.SessionState.Shared?w.contactProtocol.PresenceStatus.DoNotDisturb:w.contactProtocol.PresenceStatus.Unknown}get priority(){return 50}get onStatusChanged(){return this.statusChangedEvent.event}reset(){}}},function(h,m){h.exports=require("querystring")},function(h,m,y){var v=y(1284),C=y(535);h.exports=function isArrayLike(h){return null!=h&&C(h.length)&&!v(h)}},function(h,m,y){var v=y(533),C="object"==typeof self&&self&&self.Object===Object&&self,T=v||C||Function("return this")();h.exports=T},function(h,m){var y="object"==typeof global&&global&&global.Object===Object&&global;h.exports=y},function(h,m){h.exports=function isObject(h){var m=typeof h;return null!=h&&("object"==m||"function"==m)}},function(h,m){h.exports=function isLength(h){return"number"==typeof h&&h>-1&&h%1==0&&h<=9007199254740991}},function(h,m,y){var v=y(1291),C=/^\s+/;h.exports=function baseTrim(h){return h?h.slice(0,v(h)+1).replace(C,""):h}},function(h,m,y){var v=y(145),C=y(146);h.exports=function isSymbol(h){return"symbol"==typeof h||C(h)&&"[object Symbol]"==v(h)}},function(h,m){h.exports=function arrayMap(h,m){for(var y=-1,v=null==h?0:h.length,C=Array(v);++y<v;)C[y]=m(h[y],y,h);return C}},function(h,m,y){var v=y(294),C=y(538),T=y(295),w=y(537),A=v?v.prototype:void 0,P=A?A.toString:void 0;h.exports=function baseToString(h){if("string"==typeof h)return h;if(T(h))return C(h,baseToString)+"";if(w(h))return P?P.call(h):"";var m=h+"";return"0"==m&&1/h==-1/0?"-0":m}},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0}),function(h){h[h.callStarted=0]="callStarted",h[h.callDisconnected=1]="callDisconnected",h[h.participantsListChanged=2]="participantsListChanged",h[h.participantChanged=3]="participantChanged"}(m.CallChangedType||(m.CallChangedType={}));m.CallChanged=class CallChanged{constructor(h,m){this.changeType=h,this.info=m}},function(h){h.startOrJoinCall="_liveshareweb.callingService.startOrJoinCall",h.getCallInfo="_liveshareweb.callingService.getCallInfoCommand",h.getDevices="_liveshareweb.callingService.getDevices",h.getSelectedDevices="_liveshareweb.callingService.getSelectedDevices",h.selectDevices="_liveshareweb.callingService.selectDevices",h.getParticipants="_liveshareweb.callingService.getParticipants",h.endCall="_liveshareweb.callingService.endCall",h.isMuted="_liveshareweb.callingService.isMuted",h.mute="_liveshareweb.callingService.mute",h.unmute="_liveshareweb.callingService.unmute",h.onCallChangedEvent="_liveshareweb.callingService.onCallChangedEvent"}(m.CallingServiceProxyCommands||(m.CallingServiceProxyCommands={}))},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0});const v=y(3);m.getCollaborators=function getCollaborators(){return v.SessionContext.collaboratorManager?Object.values(v.SessionContext.collaboratorManager.getCollaborators()):[]},m.formatUnreadLabel=function formatUnreadLabel(h,m){return`${h} ${m>0?v.localize("chat.unreadLabel").replace("$(unread)",m.toLocaleString()):""}`}},function(h,m,y){const{dirname:v}=y(7),mkdirpManual=(h,m,y)=>{m.recursive=!1;const C=v(h);return C===h?m.mkdirAsync(h,m).catch(h=>{if("EISDIR"!==h.code)throw h}):m.mkdirAsync(h,m).then(()=>y||h,v=>{if("ENOENT"===v.code)return mkdirpManual(C,m).then(y=>mkdirpManual(h,m,y));if("EEXIST"!==v.code&&"EROFS"!==v.code)throw v;return m.statAsync(h).then(h=>{if(h.isDirectory())return y;throw v},()=>{throw v})})},mkdirpManualSync=(h,m,y)=>{const C=v(h);if(m.recursive=!1,C===h)try{return m.mkdirSync(h,m)}catch(h){if("EISDIR"!==h.code)throw h;return}try{return m.mkdirSync(h,m),y||h}catch(v){if("ENOENT"===v.code)return mkdirpManualSync(h,m,mkdirpManualSync(C,m,y));if("EEXIST"!==v.code&&"EROFS"!==v.code)throw v;try{if(!m.statSync(h).isDirectory())throw v}catch(h){throw v}}};h.exports={mkdirpManual:mkdirpManual,mkdirpManualSync:mkdirpManualSync}},function(h,m,y){"use strict";var v=this&&this.__awaiter||function(h,m,y,v){return new(y||(y=Promise))((function(C,T){function fulfilled(h){try{step(v.next(h))}catch(h){T(h)}}function rejected(h){try{step(v.throw(h))}catch(h){T(h)}}function step(h){h.done?C(h.value):function adopt(h){return h instanceof y?h:new y((function(m){m(h)}))}(h.value).then(fulfilled,rejected)}step((v=v.apply(h,m||[])).next())}))};Object.defineProperty(m,"__esModule",{value:!0});const C=y(7),T=y(0),w=y(5),A=y(8),P=y(3),k=y(4),R=y(228),M={name:P.WellKnownRestrictedOperations.LaunchDebug,isEnabled:()=>P.Settings.get(P.SettingKeys.allowGuestDebugControl)||{errorCode:k.vsls.ErrorCodes.RemoteLaunchNotEnabled,errorMessage:"Remote launch not enabled."}};function getDebuggerHostServiceAndName(h){return k.vsls.DebuggerHostService.name+"."+h}function getLaunchConfigurationsContent(){return v(this,void 0,void 0,(function*(){if(!T.workspace.workspaceFolders)return;const h=yield Promise.all(T.workspace.workspaceFolders.map(h=>v(this,void 0,void 0,(function*(){const m=C.join(h.uri.fsPath,".vscode/launch.json");if(!(yield w.fileAccess.existsAsync(m)))return null;try{const y=w.fileAccess.readFileSync(m,"utf8");return{root:h.index.toString(),content:R.parse(y)}}catch(h){return null}}))));let m=null;if(h[0]&&h[0].content&&(m=h[0].content),h.shift(),!h.length)return m?JSON.stringify(m):null;let y=0;const A={};return h.forEach(h=>{h&&h.content&&(y+=1,A[h.root]=h.content)}),0===y?null:(m||(m={}),m.configurationsByRoot=A,JSON.stringify(m))}))}m.ShareDebugManagerBase=class ShareDebugManagerBase{constructor(h,m,y){this.rpcClient=h,this.fileService=m,this.clientAccessCheck=y,this.activeDebugSessions=[],this.isSharingChanged=new T.EventEmitter,this.trace=w.traceSource.withName(k.vsls.TraceSources.DebugRpcHost)}get onDidChangeIsSharing(){return this.isSharingChanged.event}setShareState(h){return v(this,void 0,void 0,(function*(){h?(this.fileService().onFilesChanged(this.onFilesChanged,this),yield this.registerDebuggerHostService(!0),this.rpcClient.addRequestMethod(getDebuggerHostServiceAndName("getCurrentDebugSessions"),(...h)=>this.activeDebugSessions),this.rpcClient.addRequestMethodWithContext(getDebuggerHostServiceAndName("launchDebugSession"),(h,m,y)=>v(this,void 0,void 0,(function*(){yield this.clientAccessCheck().verifyCanPerformOperation(m,M);const y=h.__workspaceIndex||0;let v=T.workspace.workspaceFolders?T.workspace.workspaceFolders[y]:void 0;if(this.trace.info(`Starting Debugging for ${h.name}, in workspace ${y}`),!(yield T.debug.startDebugging(v,h)))throw new Error(`Failed to launch debug configuration:${h.name}, in workpace ${v.name}`);A.Telemetry.sendTelemetryEvent(P.TelemetryEventNames.GUEST_INITIATED_DEBUGGING,null,{[P.TelemetryPropertyNames.DEBUGGING_STARTED_WORKSPACE_FOLDER]:y,[P.TelemetryPropertyNames.DEBUGGING_STARTED_WORKSPACE_FOLDER_COUNT]:T.workspace.workspaceFolders?T.workspace.workspaceFolders.length:0})}))),this.rpcClient.addRequestMethod(getDebuggerHostServiceAndName("getLaunchConfigurations"),h=>v(this,void 0,void 0,(function*(){return yield getLaunchConfigurationsContent()})))):(this.rpcClient.removeRequestMethod(getDebuggerHostServiceAndName("getCurrentDebugSessions")),this.rpcClient.removeRequestMethod(getDebuggerHostServiceAndName("launchDebugSession")),this.rpcClient.removeRequestMethod(getDebuggerHostServiceAndName("getLaunchConfigurations")),yield this.registerDebuggerHostService(!1)),this.isSharing=h,this.isSharingChanged.fire(h)}))}isActiveDebugSession(h){return this.activeDebugSessions.findIndex(m=>m.sessionId===h)>=0}addDebugSession(h,m){return v(this,void 0,void 0,(function*(){this.activeDebugSessions.push(h),m&&this.isSharing&&(yield this.notifySharedDebugSession(h,!0))}))}removeDebugSession(h){return v(this,void 0,void 0,(function*(){const m=this.activeDebugSessions.findIndex(m=>m.sessionId===h);if(m>=0){const h=this.activeDebugSessions[m];this.activeDebugSessions.splice(m,1),this.isSharing&&(yield this.notifySharedDebugSession(h,!1))}}))}registerDebuggerHostService(h){return v(this,void 0,void 0,(function*(){yield this.rpcClient.sendRequest(this.trace,"workspace.registerServices",null,null,[k.vsls.DebuggerHostService.name],h?"Add":"Remove")}))}notifySharedDebugSession(h,m){return v(this,void 0,void 0,(function*(){this.trace.info(`notifySharedDebugSession id:${h.sessionId} isAdded:${m}`);const y={changeType:m?k.vsls.DebugSessionChangeType.Add:k.vsls.DebugSessionChangeType.Remove,debugSession:h};yield this.rpcClient.sendNotification(this.trace,getDebuggerHostServiceAndName("debugSessionChanged"),y)}))}onFilesChanged(h){return v(this,void 0,void 0,(function*(){if("/.vscode/launch.json"===P.PathUtil.getRelativePathFromPrefixedPath(h.changes[0].fullPath)){const h=yield getLaunchConfigurationsContent();yield this.rpcClient.sendNotification(this.trace,getDebuggerHostServiceAndName("launchConfigurationsChanged"),{launchConfigurations:h})}}))}}},function(h,m,y){"use strict";var v=this&&this.__awaiter||function(h,m,y,v){return new(y||(y=Promise))((function(C,T){function fulfilled(h){try{step(v.next(h))}catch(h){T(h)}}function rejected(h){try{step(v.throw(h))}catch(h){T(h)}}function step(h){h.done?C(h.value):function adopt(h){return h instanceof y?h:new y((function(m){m(h)}))}(h.value).then(fulfilled,rejected)}step((v=v.apply(h,m||[])).next())}))};Object.defineProperty(m,"__esModule",{value:!0});const C=y(0),T=y(299),w=y(4),A=y(304),P=y(2),k=new Map([["continue","workbench.action.debug.continue"],["next","workbench.action.debug.stepOver"],["stepIn","workbench.action.debug.stepInto"],["stepOut","workbench.action.debug.stepOut"]]);m.DebugAdapterTrackerBase=class DebugAdapterTrackerBase{constructor(h,m,y){this.shareDebugManager=h,this.session=m,this.trace=y,this.lastStoppedEvent=null,this.trace.verbose(`DebugAdapterTracker created sessionId:${this.session.id}`),this.onDidChangeIsSharingEvt=h.onDidChangeIsSharing(h=>this.onSharingStateChanged(h))}onWillReceiveMessage(h){const m=h;switch(m.command){case"continue":this.fireEnterRunModeInternal(m,T.EventReason.Go);break;case"next":case"stepIn":case"stepOut":this.fireEnterRunModeInternal(m,T.EventReason.Step)}}onDidSendMessage(h){const createDebugSessionCallback=()=>{this.createDebugSession().catch(h=>{this.trace.error("Failed to create debug session",h)})},m=h;if("event"===m.type){const h=m;switch(h.event){case"stopped":this.lastStoppedEvent=h}this.isConnected?this.notifyDebugEvent(h):this.sessionQueueEvents&&this.sessionQueueEvents.push(h)}else if("response"===m.type){const h=m;switch(h.command){case"initialize":this.capabilities=h.body,this.trace.verbose(`initialize response with capabilities:${JSON.stringify(this.capabilities)}`),this.isExtensionHost||createDebugSessionCallback();break;case"attach":this.isExtensionHost&&createDebugSessionCallback()}}}onWillStopSession(){this.trace.verbose(`onWillStopSession sessionId:${this.session.id}`),this.stop().catch(h=>{this.trace.error("Failed to stop session",h)})}terminate(){return v(this,void 0,void 0,(function*(){this.trace.verbose("terminate"),yield this.session.customRequest("disconnect",{terminateDebuggee:!0})}))}requestAdapter(h,m){return v(this,void 0,void 0,(function*(){let y=k.get(h);if(y)return void(yield C.commands.executeCommand(y));return yield P.timeoutPromise((()=>v(this,void 0,void 0,(function*(){return yield this.session.customRequest(h,m)})))(),2e3)}))}flushSessionEvents(){this.sessionQueueEvents.forEach(h=>this.notifyDebugEvent(h))}fireEnterRunModeInternal(h,m){if(h&&h.arguments&&(this.lastStoppedEvent=null,this.isConnected)){const y=Number(h.arguments.threadId);this.fireEnterRunMode(m,y)}}get isExtensionHost(){return"extensionHost"===this.session.configuration.type}createDebugSession(){return v(this,void 0,void 0,(function*(){this.trace.verbose(`createDebugSession sessionId:${this.session.id}`),this.shareDebugManager.isSharing&&(yield this.startSessionInternal());const h=new w.vsls.DebugSession;A.copyDebugSession(h,this.session,this.capabilities,this.session.configuration),yield this.shareDebugManager.addDebugSession(h,!0)}))}stop(){return v(this,void 0,void 0,(function*(){this.onDidChangeIsSharingEvt.dispose(),yield this.shareDebugManager.removeDebugSession(this.session.id),this.shareDebugManager.isSharing&&(yield this.stopSession())}))}onSharingStateChanged(h){return v(this,void 0,void 0,(function*(){this.trace.verbose(`onSharingStateChanged isSharing:${h}`),h?yield this.startSessionInternal():yield this.stopSession()}))}startSessionInternal(){return v(this,void 0,void 0,(function*(){this.trace.verbose(`startSession sessionId:${this.session.id}`);try{this.sessionQueueEvents=[],yield this.startSession()}finally{this.sessionQueueEvents=void 0}}))}}},function(h,m,y){"use strict";var v=this&&this.__decorate||function(h,m,y,v){var C,T=arguments.length,w=T<3?m:null===v?v=Object.getOwnPropertyDescriptor(m,y):v;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)w=Reflect.decorate(h,m,y,v);else for(var A=h.length-1;A>=0;A--)(C=h[A])&&(w=(T<3?C(w):T>3?C(m,y,w):C(m,y))||w);return T>3&&w&&Object.defineProperty(m,y,w),w},C=this&&this.__metadata||function(h,m){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(h,m)},T=this&&this.__awaiter||function(h,m,y,v){return new(y||(y=Promise))((function(C,T){function fulfilled(h){try{step(v.next(h))}catch(h){T(h)}}function rejected(h){try{step(v.throw(h))}catch(h){T(h)}}function step(h){h.done?C(h.value):function adopt(h){return h instanceof y?h:new y((function(m){m(h)}))}(h.value).then(fulfilled,rejected)}step((v=v.apply(h,m||[])).next())}))};Object.defineProperty(m,"__esModule",{value:!0});const w=y(0),A=y(238),P=y(546),k=y(5),R=y(5),M=y(3);var N;!function(h){h[h.Ignore=0]="Ignore",h[h.Open=1]="Open"}(N||(N={})),m.guestServerControllerFactory=h=>{const{controllerDecorator:m,errorNotificationMethodDecorator:y,telemetryMethodDecorator:D}=h.methodDecorators();let I=class GuestServerController extends(k.Activatable(k.Disposable(Object))){constructor(h){super(),this.sessionSubscriptions=[],this.browseSourcePorts=new Set,this.browsePromptSemaphore=new A.default(1),this.sharingStarted=()=>this.checkForSharedServers(),this.sharingStopped=({server:{sourcePort:h}})=>{this.browseSourcePorts.delete(h),this.checkForSharedServers().catch(h=>{this.trace.error("Failed to check shared servers",h)})},this.checkForSharedServers=h=>T(this,void 0,void 0,(function*(){try{const m=yield this.portForwardingService.getSharedServersAsync();this.sessionContext.hasServersShared=m.length>0&&this.isActivated,h&&this.canBrowse&&m.forEach(this.startBrowser)}catch(h){k.traceSource.error("Checking for shared servers failed: "+h)}})),this.browseSharingStarted=h=>this.startBrowser(h&&h.server),this.startBrowser=({browseUrl:h,sourcePort:m,sessionName:y})=>T(this,void 0,void 0,(function*(){if(h&&this.canBrowse&&!this.browseSourcePorts.has(m)){this.browseSourcePorts.add(m),yield this.browsePromptSemaphore.acquire();try{if(!this.browseSourcePorts.has(m)||!this.canBrowse)return;if(this.browseBehavior===N.Open)return void M.ExtensionUtil.openBrowser(h);const v=M.localize("guestServerController-promtHostSharedServer").replace("$(sessionName)",y),C=M.localize("guestServerController-yes"),T=M.localize("guestServerController-no");switch(yield R.NotificationUtil.showInformationMessage(v,!1,C,T)){case T:this.browseBehavior=N.Ignore;break;case C:if(this.browseBehavior=N.Open,this.browseSourcePorts.has(m))this.isActivated&&M.ExtensionUtil.openBrowser(h);else{const h=M.localize("guestServerController-serverUnshared").replace("$(sessionName)",y);yield R.NotificationUtil.showWarningMessage(h)}}}catch(h){this.trace.error(`Error starting browser for ${y}: ${h.message}`)}finally{this.browsePromptSemaphore.release()}}})),this.sessionContext=h.sessionContext(),this.lazyPortForwardingService=h.portForwardingService,this.trace=h.trace().withName("GuestServerController")}get canBrowse(){return M.Settings.get(M.SettingKeys.openSharedServers)&&this.browseBehavior!==N.Ignore&&this.isActivated}get portForwardingService(){return this.lazyPortForwardingService()}dispose(){const h=Object.create(null,{dispose:{get:()=>super.dispose}});return T(this,void 0,void 0,(function*(){yield this.deactivate(),yield h.dispose.call(this)}))}activate(){const h=Object.create(null,{activate:{get:()=>super.activate}});return T(this,void 0,void 0,(function*(){return!!this.isActivated||(this.isActivated=!0,this.sessionSubscriptions.push(this.portForwardingService.onSharingStarted(this.sharingStarted),this.portForwardingService.onSharingStopped(this.sharingStopped),this.portForwardingService.onBrowseSharingStarted(this.browseSharingStarted)),M.ControllerHelper.register(this,this.sessionSubscriptions),this.checkForSharedServers(!0).catch(h=>{this.trace.error("Failed to check shared servers",h)}),yield h.activate.call(this))}))}deactivate(){return this.sessionSubscriptions.splice(0).forEach(h=>h.dispose()),super.deactivate()}getBrowseUrl(h){return T(this,void 0,void 0,(function*(){let m=h.browseUrl||`http://localhost:${h.destinationPort}`;return"function"==typeof w.env.asExternalUri&&(m=(yield w.env.asExternalUri(w.Uri.parse(m))).toString()),m}))}openServerInBrowser(h){return T(this,void 0,void 0,(function*(){if(!h||null==h.port)return;const m=(yield this.portForwardingService.getSharedServersAsync()).find(m=>m.destinationPort===h.port);if(m){const h=yield this.getBrowseUrl(m);M.ExtensionUtil.openBrowser(h)}}))}copyServerURL(h){return T(this,void 0,void 0,(function*(){if(!h||null==h.port)return;const m=(yield this.portForwardingService.getSharedServersAsync()).find(m=>m.destinationPort===h.port);if(m){const h=yield this.getBrowseUrl(m);(yield(new M.ClipboardUtil).copyToClipboardAsync(h))?yield R.NotificationUtil.showInformationMessage("The server URL was copied to the clipboard.",!1):yield R.NotificationUtil.showInputBox({value:h})}}))}listForwardedPorts(h){return T(this,void 0,void 0,(function*(){P.PortForwardingTelemetry.listSharedLocalServers(h);const m=yield this.portForwardingService.getSharedServersAsync();if(0===m.length)return void(yield R.NotificationUtil.showInformationMessage("No ports are currently shared.",!1,{modal:!1}));let y=-1;if(1===m.length)y=0;else{const h=m.map(h=>h.sessionName===`localhost:${h.destinationPort}`?h.sessionName:`${h.sessionName} mapped to localhost:${h.destinationPort}`),v=yield R.NotificationUtil.showQuickPick(h,{placeHolder:"Select the port to copy to the clipboard."});if(!v)return;y=h.indexOf(v)}if(y>=0){const h=m[y],v=yield this.getBrowseUrl(h),C=new M.ClipboardUtil;if(yield C.copyToClipboardAsync(v)){(yield R.NotificationUtil.showInformationMessage("The server URL was copied to the clipboard.",!1,{},{title:"Copy again"}))&&(yield C.copyToClipboardAsync(v))}else yield R.NotificationUtil.showInputBox({value:v})}}))}};return v([y("Opening Server in Browser",M.TelemetryEventNames.BROWSE_SERVER_FAULT),D(M.TelemetryEventNames.BROWSE_SERVER,M.TelemetryEventNames.BROWSE_SERVER_FAULT,"OpenServerInBrowser"),M.commandBindingDecorator("liveshare.fileTreeExplorer.openServerInBrowser"),M.commandBindingDecorator("liveshare.activityBar.openServerInBrowser"),C("design:type",Function),C("design:paramtypes",[Object]),C("design:returntype",Promise)],I.prototype,"openServerInBrowser",null),v([y("Copying Server URL",M.TelemetryEventNames.COPY_URL_SERVER_FAULT),D(M.TelemetryEventNames.COPY_URL_SERVER,M.TelemetryEventNames.COPY_URL_SERVER_FAULT,"CopyServerURL"),M.commandBindingDecorator("liveshare.fileTreeExplorer.copyServerURL"),M.commandBindingDecorator("liveshare.activityBar.copyServerURL"),C("design:type",Function),C("design:paramtypes",[Object]),C("design:returntype",Promise)],I.prototype,"copyServerURL",null),v([y("Listing Servers",M.TelemetryEventNames.LIST_SERVERS_FAULT),D(M.TelemetryEventNames.LIST_SERVERS,M.TelemetryEventNames.LIST_SERVERS_FAULT,"ListServers"),M.commandBindingDecorator("liveshare.listServers"),C("design:type",Function),C("design:paramtypes",[Number]),C("design:returntype",Promise)],I.prototype,"listForwardedPorts",null),I=v([m,C("design:paramtypes",[Object])],I),new I(h)}},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0});const v=y(8),C=y(3);class PortForwardingTelemetry{static listSharedLocalServers(h){PortForwardingTelemetry.sendEvent(Event.LIST_SHARED_LOCAL_SERVERS,h)}static shareServer(h,m){PortForwardingTelemetry.sendEvent(Event.SHARE_SERVER,m,h)}static unshareServer(h,m){PortForwardingTelemetry.sendEvent(Event.UNSHARE_SERVER,m,h)}static sendEvent(h,m,y){const C=new v.TelemetryEvent(h);y&&C.addProperty(Property.SOURCE_PORT,y.toString()),C.send()}static configure(){PortForwardingTelemetry.configured||(PortForwardingTelemetry.configured=!0,v.Telemetry.addFilter(new v.SendOnceFilter(Event.AUTO_DETECT_SERVER,[Property.SOURCE_PORT])))}static autoDetectServer(h,m){const y=new v.TelemetryEvent(Event.AUTO_DETECT_SERVER);y.addProperty(Property.SOURCE_PORT,h.toString()),y.send()}}m.PortForwardingTelemetry=PortForwardingTelemetry,PortForwardingTelemetry.FEATURE_PREFIX="portforwarding/",PortForwardingTelemetry.PROPERTY_PREFIX=C.TelemetryPropertyNames.FEATURE_NAME+"portforwarding.",PortForwardingTelemetry.configured=!1;class Event{}Event.LIST_SHARED_LOCAL_SERVERS=PortForwardingTelemetry.FEATURE_PREFIX+"list-shareLocalServers",Event.SHARE_SERVER=PortForwardingTelemetry.FEATURE_PREFIX+"share-server",Event.UNSHARE_SERVER=PortForwardingTelemetry.FEATURE_PREFIX+"unshare-server",Event.AUTO_DETECT_SERVER=PortForwardingTelemetry.FEATURE_PREFIX+"auto-detect-server";class Property{}Property.ORIGIN=PortForwardingTelemetry.PROPERTY_PREFIX+"Origin",Property.SOURCE_PORT=PortForwardingTelemetry.PROPERTY_PREFIX+"SourcePort",Property.SERVER_URL=PortForwardingTelemetry.PROPERTY_PREFIX+"ServerUrl"},function(h,m,y){"use strict";var v=this&&this.__decorate||function(h,m,y,v){var C,T=arguments.length,w=T<3?m:null===v?v=Object.getOwnPropertyDescriptor(m,y):v;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)w=Reflect.decorate(h,m,y,v);else for(var A=h.length-1;A>=0;A--)(C=h[A])&&(w=(T<3?C(w):T>3?C(m,y,w):C(m,y))||w);return T>3&&w&&Object.defineProperty(m,y,w),w},C=this&&this.__metadata||function(h,m){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(h,m)},T=this&&this.__awaiter||function(h,m,y,v){return new(y||(y=Promise))((function(C,T){function fulfilled(h){try{step(v.next(h))}catch(h){T(h)}}function rejected(h){try{step(v.throw(h))}catch(h){T(h)}}function step(h){h.done?C(h.value):function adopt(h){return h instanceof y?h:new y((function(m){m(h)}))}(h.value).then(fulfilled,rejected)}step((v=v.apply(h,m||[])).next())}))};Object.defineProperty(m,"__esModule",{value:!0});const w=y(0),A=y(20),P=y(546),k=y(5),R=y(548),M=y(3);function isPackageInfo(h){return void 0!==h&&void 0!==h.fullName}const N=/\b\w{2,20}:\/\/(?:localhost|127\.0\.0\.1|0\.0\.0\.0|:\d{2,5})[\w\-\.\~:\/\?\#[\]\@!\$&\(\)\*\+\,\;\=]*/gim;m.hostServerControllerFactory=h=>{var m;const{controllerDecorator:y,telemetryMethodDecorator:D,errorNotificationMethodDecorator:I}=h.methodDecorators();let x=m=class HostServerController extends(k.Activatable(k.Disposable(Object))){constructor(h){super(),this.registrations=[],this.sessionSubscriptions=[],this.serverModels=new Map,this.deferredWork=Promise.resolve(!0),this.trace=k.traceSource.withName("HostServerController"),this.sessionContext=h.sessionContext(),this.serverSharingService=h.serverSharingService(),m.shouldAutoShareServers&&this.deferWork(()=>this.launchDataScraper()),w.workspace.onDidChangeConfiguration(h=>{h.affectsConfiguration("liveshare.autoShareServers")&&(m.shouldAutoShareServers?this.dataScraper||this.deferWork(()=>this.launchDataScraper()):this.dataScraper&&(this.dataScraper.dispose(),this.dataScraper=void 0))},this.registrations),P.PortForwardingTelemetry.configure()}static get shouldAutoShareServers(){return M.Settings.get(M.SettingKeys.autoShareServers)}dispose(){const h=Object.create(null,{dispose:{get:()=>super.dispose}});return T(this,void 0,void 0,(function*(){yield this.deferredWork,yield this.deactivate(),this.registrations.splice(0).forEach(h=>h.dispose()),this.dataScraper&&this.dataScraper.dispose(),yield h.dispose.call(this)}))}activate(){const h=Object.create(null,{activate:{get:()=>super.activate}});return T(this,void 0,void 0,(function*(){if(this.isActivated)return!0;if(this.sessionSubscriptions.push(this.serverSharingService.onSharingStarted(h=>{const m=h.server;this.serverModels.set(m.sourcePort,{port:m.sourcePort,displayName:m.sessionName,browseUrl:m.browseUrl,isShared:!0}),this.deferWork(()=>this.checkForSharedServers())}),this.serverSharingService.onSharingStopped(h=>{const m=this.serverModels.get(h.server.sourcePort);m&&(m.isShared=!1),this.deferWork(()=>this.checkForSharedServers())})),M.ControllerHelper.register(this,this.sessionSubscriptions),m.shouldAutoShareServers){const h=[...this.serverModels.entries()].map(h=>{const[m,y]=h;return this.startSharingServer(m,y.displayName,y.browseUrl)});this.deferWork(()=>Promise.all(h))}return yield h.activate.call(this)}))}deactivate(){const h=Object.create(null,{deactivate:{get:()=>super.deactivate}});return T(this,void 0,void 0,(function*(){return yield this.deferredWork,this.sessionSubscriptions.splice(0).forEach(h=>h.dispose()),this.serverModels.clear(),h.deactivate.call(this)}))}deferWork(h){this.deferredWork=this.deferredWork.then(h).catch(h=>{this.trace.error(h.message)})}launchDataScraper(){return T(this,void 0,void 0,(function*(){if(!this.dataScraper)try{this.dataScraper=yield k.launchUrlScraper(h=>{const m=[3e3,8080,4200,80,5e3,8e3,5500,3001,8081,4e3,9e3,8888,443,5001,8082,9090,7071];this.serverModels.has(h.port)||m.includes(h.port)&&(this.serverModels.set(h.port,h),this.isActivated&&this.deferWork(()=>this.startSharingServer(h.port,h.displayName,h.browseUrl))),P.PortForwardingTelemetry.autoDetectServer(h.port,h.browseUrl)})}catch(h){this.trace.warning(h.message)}}))}checkForSharedServers(){return T(this,void 0,void 0,(function*(){try{const h=yield this.serverSharingService.getSharedServersAsync();this.sessionContext.hasServersShared=h.length>0}catch(h){k.traceSource.error("Checking for shared servers failed: "+h)}}))}shareServer(h,y){return T(this,void 0,void 0,(function*(){const v=yield this.serverSharingService.getSharedServersAsync(),C=v.map(h=>h.sourcePort);if(isPackageInfo(h)){const{port:v,displayName:T,browseUrl:w}=M.Requires.NotNullOrUndefined(y,"server");if(M.Requires.Argument(!isNaN(v)&&Number.isInteger(v)&&v>0&&v<=65535,"port","The port number must be an integer in range 1 - 65535"),C.includes(v))return;let A;if(m.shouldAutoShareServers&&R.hasPermissionForExtension(h,"autoShareServers"))A=!0;else{const m=h.displayName||h.name,y={id:1,title:"Allow"},C=yield k.NotificationUtil.showInformationMessage(`${m} would like to share port ${v}.`,!1,{},y);A=C&&C.id===y.id}A&&(yield this.serverSharingService.startSharingAsync(v,T,w))}else{const m=yield k.NotificationUtil.showInputBox({prompt:"Enter the TCP port or server URL to share with guests.",ignoreFocusOut:!0,validateInput:function validateUserInput(h){if(!h)return null;const m="number"==typeof h?h:parseFloat(h);if(!isNaN(m)&&Number.isInteger(m)){if(m<=0||m>65535)return"The port number must be an integer in range 1 - 65535";const h=v.find(h=>h.sourcePort===m);return h?`Port ${m} is already being shared${h.sessionName===`localhost:${h.sourcePort}`?"":` as '${h.sessionName}'`}.`:null}if("string"==typeof h){const m=h.match(N);if(m&&m[0]&&m[0]===h){if(A.parse(m[0]))return null}return"The specified value must be a valid TCP port or server URL."}return null}});if(!m)return;let y,C;const T=m.match(N);if(T&&T[0]){const h=A.parse(T[0]);y=parseInt(h.port,10)||80,C=A.format(h)}else y=parseFloat(m);const w=yield k.NotificationUtil.showInputBox({value:`localhost:${y}`,prompt:"[Optional] Provide a display name for the shared server.",ignoreFocusOut:!0});yield this.startSharingServer(y,w||`localhost:${y}`,C),P.PortForwardingTelemetry.shareServer(y,h)}}))}startSharingServer(h,m,y){return T(this,void 0,void 0,(function*(){const v=yield this.serverSharingService.startSharingAsync(h,m,y),C=v.sessionName===`localhost:${h}`?"":` as '${v.sessionName}'`;return yield k.NotificationUtil.showInformationMessage(`Shared port ${h}${C}.`,!0,{modal:!1}),v}))}unshareServer(h,m){return T(this,void 0,void 0,(function*(){const y=yield this.serverSharingService.getSharedServersAsync(),getServerName=h=>`localhost:${h.sourcePort}`+(h.sessionName===`localhost:${h.sourcePort}`?"":` shared as '${h.sessionName}'.`);let v;if(isPackageInfo(h))M.Requires.NotNullOrUndefined(m,"server"),v=y.find(h=>h.sourcePort===m.port);else{if(0===y.length)return void(yield k.NotificationUtil.showInformationMessage("No ports are currently shared.",!1,{modal:!1}));if(1===y.length)v=y[0];else{const h=y.map(getServerName);h.unshift("<All Shared Ports>");const m=yield k.NotificationUtil.showQuickPick(h,{placeHolder:"Pick the port to stop sharing."});if(!m)return;const C=h.indexOf(m);if(C<0)return;v=C>0?y[C-1]:null}}if(v)yield this.serverSharingService.stopSharingAsync(v.sourcePort),P.PortForwardingTelemetry.unshareServer(v.sourcePort,h),yield k.NotificationUtil.showInformationMessage(`Stopped sharing port ${v.sourcePort}.`,!0,{modal:!1});else if(void 0!==v){for(v of y)yield this.serverSharingService.stopSharingAsync(v.sourcePort),P.PortForwardingTelemetry.unshareServer(v.sourcePort,h);yield k.NotificationUtil.showInformationMessage("Stopped sharing all ports.",!1,{modal:!1})}}))}unshareServerBySourcePort(h){return T(this,void 0,void 0,(function*(){h&&null!=h.port&&(yield this.serverSharingService.stopSharingAsync(h.port),yield k.NotificationUtil.showInformationMessage(`Stopped sharing port ${h.port}.`,!0))}))}openSharedServerInBrowser(h){return T(this,void 0,void 0,(function*(){if(!h||null==h.port)return;const m=(yield this.serverSharingService.getSharedServersAsync()).find(m=>m.sourcePort===h.port);if(m){const h=m.browseUrl||`http://localhost:${m.sourcePort}`;M.ExtensionUtil.openBrowser(h)}}))}copySharedServerURL(h){return T(this,void 0,void 0,(function*(){if(!h||null==h.port)return;const m=(yield this.serverSharingService.getSharedServersAsync()).find(m=>m.sourcePort===h.port);if(m){const h=m.browseUrl||`http://localhost:${m.sourcePort}`;(yield(new M.ClipboardUtil).copyToClipboardAsync(h))?yield k.NotificationUtil.showInformationMessage("The server URL was copied to the clipboard.",!1):yield k.NotificationUtil.showInputBox({value:h})}}))}listSharedPorts(h){return T(this,void 0,void 0,(function*(){P.PortForwardingTelemetry.listSharedLocalServers(h);const m=yield this.serverSharingService.getSharedServersAsync();if(0===m.length)return void(yield k.NotificationUtil.showInformationMessage("No ports are currently shared.",!1,{modal:!1}));const y=m.map(h=>`Port ${h.sourcePort}`+(h.sessionName===`localhost:${h.sourcePort}`?"":` shared as '${h.sessionName}'`));yield k.NotificationUtil.showQuickPick(y,{placeHolder:"The following ports are shared."})}))}};return v([I("Sharing Server",M.TelemetryEventNames.SHARE_SERVER_FAULT),D(M.TelemetryEventNames.SHARE_SERVER,M.TelemetryEventNames.SHARE_SERVER_FAULT,"ShareServer"),M.commandBindingDecorator("liveshare.shareServer"),M.commandBindingDecorator("liveshare.fileTreeExplorer.shareServer"),M.commandBindingDecorator("liveshare.activityBar.shareServer"),C("design:type",Function),C("design:paramtypes",[Object,Object]),C("design:returntype",Promise)],x.prototype,"shareServer",null),v([I("Unsharing Server",M.TelemetryEventNames.UNSHARE_SERVER_FAULT),D(M.TelemetryEventNames.UNSHARE_SERVER,M.TelemetryEventNames.UNSHARE_SERVER_FAULT,"UnshareServer"),M.commandBindingDecorator("liveshare.unshareServer"),C("design:type",Function),C("design:paramtypes",[Object,Object]),C("design:returntype",Promise)],x.prototype,"unshareServer",null),v([I("Unsharing Server",M.TelemetryEventNames.UNSHARE_SERVER_FAULT),D(M.TelemetryEventNames.UNSHARE_SERVER,M.TelemetryEventNames.UNSHARE_SERVER_FAULT,"UnshareServer"),M.commandBindingDecorator("liveshare.fileTreeExplorer.unshareServer"),M.commandBindingDecorator("liveshare.activityBar.unshareServer"),C("design:type",Function),C("design:paramtypes",[Object]),C("design:returntype",Promise)],x.prototype,"unshareServerBySourcePort",null),v([I("Opening Server in Browser",M.TelemetryEventNames.BROWSE_SERVER_FAULT),D(M.TelemetryEventNames.BROWSE_SERVER,M.TelemetryEventNames.BROWSE_SERVER_FAULT,"OpenServerInBrowser"),M.commandBindingDecorator("liveshare.fileTreeExplorer.openServerInBrowser"),M.commandBindingDecorator("liveshare.activityBar.openServerInBrowser"),C("design:type",Function),C("design:paramtypes",[Object]),C("design:returntype",Promise)],x.prototype,"openSharedServerInBrowser",null),v([I("Copying Server URL",M.TelemetryEventNames.COPY_URL_SERVER_FAULT),D(M.TelemetryEventNames.COPY_URL_SERVER,M.TelemetryEventNames.COPY_URL_SERVER_FAULT,"CopyServerURL"),M.commandBindingDecorator("liveshare.fileTreeExplorer.copyServerURL"),M.commandBindingDecorator("liveshare.activityBar.copyServerURL"),C("design:type",Function),C("design:paramtypes",[Object]),C("design:returntype",Promise)],x.prototype,"copySharedServerURL",null),v([I("Listing Servers",M.TelemetryEventNames.LIST_SERVERS_FAULT),D(M.TelemetryEventNames.LIST_SERVERS,M.TelemetryEventNames.LIST_SERVERS_FAULT,"listServers"),M.commandBindingDecorator("liveshare.listServers"),C("design:type",Function),C("design:paramtypes",[Number]),C("design:returntype",Promise)],x.prototype,"listSharedPorts",null),x=m=v([y,C("design:paramtypes",[Object])],x),new x(h)}},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0});var v=y(549);m.hasPermissionForExtension=v.hasPermissionForExtension;var C=y(550);m.getPackageInfo=C.getPackageInfo;var T=y(306);m.ExtensionContributions=T.ExtensionContributions;var w=y(551);m.LiveShareExtensionApiBase=w.LiveShareExtensionApiBase,m.LiveShareApi=w.LiveShareApi;var A=y(552);m.SharedServiceApi=A.SharedServiceApi,m.SharedServiceResponseError=A.SharedServiceResponseError;const P=y(1390);m.LiveShareExtensionApi=P.LiveShareExtensionApi;var k=y(1392);m.StatusbarQuickPickItemsProvider=k.StatusbarQuickPickItemsProvider},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0});const v=y(0),C=y(64),T=y(3),w=new Set(["authStrategies"]);Object.defineProperty(w,"has",{configurable:!1,enumerable:!1,writable:!1,value:Set.prototype.has.bind(w)}),m.getPermissionsForExtension=h=>{const m=T.Settings.get(T.SettingKeys.extensionPermissions);return m?m[h.fullName]||m[`${h.publisher}.*`]:null};const isOnPermissionsList=(h,m=[])=>{null===m&&(m=[]);const y=w.has(h)?m.indexOf("**")>=0:m.indexOf("*")>=0||m.indexOf("**")>=0;return Array.isArray(m)&&(m.indexOf(h)>=0||y)};m.hasPermissionForExtension=(h,y)=>{const A=v.extensions.getExtension(C.extensionId).packageJSON.publisher;if(h.publisher===A)return!0;if(T.featureFlags.api)return!0;const P=m.getPermissionsForExtension(h);return"**"===P||(w.has(y)?isOnPermissionsList(y,P):"*"===P||isOnPermissionsList(y,P))}},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0}),m.getPackageInfo=function getPackageInfo(h){return Object.freeze({fullName:`${h.publisher||"unknown"}.${h.name}`,name:h.name,displayName:h.displayName,version:h.version,publisher:h.publisher,contributes:h.contributes})}},function(h,m,y){"use strict";var v=this&&this.__awaiter||function(h,m,y,v){return new(y||(y=Promise))((function(C,T){function fulfilled(h){try{step(v.next(h))}catch(h){T(h)}}function rejected(h){try{step(v.throw(h))}catch(h){T(h)}}function step(h){h.done?C(h.value):function adopt(h){return h instanceof y?h:new y((function(m){m(h)}))}(h.value).then(fulfilled,rejected)}step((v=v.apply(h,m||[])).next())}))};Object.defineProperty(m,"__esModule",{value:!0});const C=y(69),T=y(0),w=y(2),A=y(4),P=y(64),k=y(8),R=y(3),M=y(110),N=y(552),D=y(1361),I=y(553),x=y(306),O=y(5),L=y(15),U=y(549),B=y(1362),W=y(1363),q=y(169);let Y;class LiveShareExtensionApiBase{constructor(h){this.liveShareApis=[],this.supportedApiVersionRange=">=0.3.0 <1.1.0",Y=h,LiveShareExtensionApiBase.trace||(LiveShareExtensionApiBase.trace=O.traceSource.withName(A.vsls.TraceSources.API))}getApi(h,m){return v(this,void 0,void 0,(function*(){I.default(h,"requestedApiVersion","string");const y=B.default();Y.apiPromise&&(yield Y.apiPromise);const v=yield this.getCallingPackage(y,m);return v?yield this.getApiInternal(v,h):(LiveShareExtensionApiBase.trace.warning("Live Share API request failed because calling package could not be detected."),null)}))}getApiAsync(h){return this.getApi(h)}getApiInternal(h,m){return v(this,void 0,void 0,(function*(){const y=T.extensions.getExtension(P.extensionId).packageJSON.version;if(!m.endsWith("-placeholder")&&!C.satisfies(m.split("-")[0],this.supportedApiVersionRange)&&!C.eq(m,y))return LiveShareExtensionApiBase.trace.warning(`Package ${h.fullName}@${h.version} requested`+` Live Share API version ${m} that is not supported.`),null;if("-"===U.getPermissionsForExtension(h))return LiveShareExtensionApiBase.trace.warning(`Package ${h.fullName} is blocked.`),null;const v=this.createLiveShareApi(h,m,LiveShareExtensionApiBase.trace,Y.authStrategies);return this.liveShareApis.push(v),v}))}createLiveShareApi(h,m,y,v){return new LiveShareApi(h,m,y,v)}}m.LiveShareExtensionApiBase=LiveShareExtensionApiBase;class LiveShareApi{constructor(h,m,y,C){var A,k;this.callingPackage=h,this.apiVersion=m,this.trace=y,this.sessionChangeEmitter=new T.EventEmitter,this.currentPeers=[],this.peersChangeEmitter=new T.EventEmitter,this.presenceProviderRegisteredEmitter=new T.EventEmitter,this.activityEmitter=new T.EventEmitter,this.sharedServices={},this.serviceProxies={},I.default(h,"callingPackage","object"),I.default(m,"apiVersion","string"),Object.defineProperty(this,"callingPackage",{enumerable:!1,configurable:!1,writable:!1,value:this.callingPackage}),y.info(`Initializing Live Share API ${m} for `+`${h.fullName}@${h.version}`),this.sendActivatedTelemetryEvent();const N=R.workspaceSessionInfoTracker.workspaceSessionInfo;this.session={peerNumber:N?N.sessionNumber:0,user:null,role:LiveShareApi.getSessionRole(R.sessionStateTracker.State),access:LiveShareApi.getSessionAccess(R.sessionStateTracker.State),id:N?N.id:null,presentationMode:null!==(k=null===(A=null===R.workspaceSessionInfoTracker||void 0===R.workspaceSessionInfoTracker?void 0:R.workspaceSessionInfoTracker.workspaceSessionInfo)||void 0===A?void 0:A.isPresentation)&&void 0!==k&&k},this.onSignedIn(),R.sessionStateTracker.onStateChanged(h=>this.onSessionStateChanged(h.newState)),Y.workspaceService.onServicesChanged(h=>this.onServicesChanged(h)),Y.workspaceUserService.onWorkspaceSessionChanged(h=>this.onUserSessionChanged(h)),Object.defineProperty(this,"authStrategies",{enumerable:!1,configurable:!1,set:function(){},get:function(){if(this.hasPermission("authStrategies"))return C}}),M.ContactManager.addListener(R.ContactManagerEvents.ProviderAdded,h=>{this.presenceProviderRegisteredEmitter.fire({added:LiveShareApi.toPresenceProvider(h)})});const D=this;this.services={get guestChannelService(){if(D.session.role===P.Role.Guest)return Y.guestChannelService},getRemoteServiceBroker(){return v(this,void 0,void 0,(function*(){return D.session.role!==P.Role.Guest?null:(D.hostServiceBroker||(D.hostServiceBroker=w.lazyLoad(()=>W.getRemoteServiceBrokerFromHost(Y.client,Y.guestChannelService,y))),yield D.hostServiceBroker())}))}},q.activitySource.onActivity(h=>{const m=Object.assign({},h);m.data&&("number"==typeof m.data.peer?m.data.peer=this.getPeer(m.data.peer):Array.isArray(m.data.peers)&&"number"==typeof m.data.peers[0]&&(m.data.peers=m.data.peers.map(h=>this.getPeer(h)))),this.activityEmitter.fire(m)})}getPeerForTextDocumentChangeEvent(h){var m;return v(this,void 0,void 0,(function*(){const y=yield null===(m=R.SessionContext.coeditingClient)||void 0===m?void 0:m.getClientIdForTextDocumentChangeEvent(h);return void 0===y?this.session:this.getPeer(y)}))}getPeer(h){return h===this.session.peerNumber?this.session:this.peers.find(m=>m.peerNumber===h)||{peerNumber:h,user:void 0,role:void 0,access:void 0}}get onDidChangeSession(){return this.sessionChangeEmitter.event}get onActivity(){return this.activityEmitter.event}get peers(){return this.currentPeers.slice(0)}get presenceProviders(){return M.ContactManager.serviceProviders.map(h=>LiveShareApi.toPresenceProvider(h))}static toPresenceProvider(h){return{serviceId:h.serviceId,capabilites:h.capabilites,selfContact:h.selfUser?new D.ContactApi(Y.contactManager,h.selfUser):null,provider:h.contactServiceProvider}}get onDidChangePeers(){return this.peersChangeEmitter.event}get onPresenceProviderRegistered(){return this.presenceProviderRegisteredEmitter.event}share(h){return v(this,void 0,void 0,(function*(){if(this.session.role===P.Role.Guest)throw new Error("Cannot share while joined to another session.");if(this.session.role===P.Role.Host&&h&&h.access)throw new Error("Cannot change default access for an already shared session.");const m=h&&h.access===P.Access.ReadOnly?"liveshare.startReadOnly":"liveshare.start";return this.sendInvokeCommandTelemetryEvent(m,h),yield T.commands.executeCommand(m,h)}))}join(h,m){return v(this,void 0,void 0,(function*(){if(I.default(h,"link","uri"),this.session.role!==P.Role.None)throw new Error("A session is already active.");this.sendInvokeCommandTelemetryEvent("liveshare.join",m),yield T.commands.executeCommand("liveshare.join",Object.assign(Object.assign({},m),{link:h}))}))}end(){return v(this,void 0,void 0,(function*(){if(this.session.role===P.Role.Guest){const h="liveshare.leave";this.sendInvokeCommandTelemetryEvent(h),yield T.commands.executeCommand(h)}else if(this.session.role===P.Role.Host){const h="liveshare.end";this.sendInvokeCommandTelemetryEvent(h),yield T.commands.executeCommand(h)}}))}shareServer(h){return v(this,void 0,void 0,(function*(){if(I.default(h,"server","object"),this.session.role!==P.Role.Host)throw new Error("Host collaboration session doesn't exist.");return this.sendInvokeCommandTelemetryEvent("liveshare.shareServer",h),yield T.commands.executeCommand("liveshare.shareServer",this.callingPackage,h),new T.Disposable(()=>{this.sendInvokeCommandTelemetryEvent("liveshare.unshareServer",h),T.commands.executeCommand("liveshare.unshareServer",this.callingPackage,h)})}))}shareService(h){return v(this,void 0,void 0,(function*(){I.default(h,"name","string");const m=this.hasPermission("shareServices");if(this.sendShareServiceTelemetryEvent(h,m),!m)return this.trace.warning(`shareService(${h}) not permitted.`),null;h=this.callingPackage.fullName+"."+h,this.trace.verbose(`shareService(${h})`);let y=this.sharedServices[h];if(!y){const m=yield Y.client.ensureConnectionAsync();if(y=new N.SharedServiceApi(h,m,this.trace),this.sharedServices[h]=y,this.session.role===P.Role.Host){try{yield Y.workspaceService.registerServicesAsync([h],A.vsls.CollectionChangeType.Add)}catch(h){throw this.trace.error(h),h}y._isServiceAvailable=!0,y._fireIsAvailableChange()}}return y}))}unshareService(h){return v(this,void 0,void 0,(function*(){I.default(h,"name","string"),h=this.callingPackage.fullName+"."+h,this.trace.verbose(`unshareService(${h})`);const m=this.sharedServices[h];if(m&&m.isServiceAvailable){try{yield Y.workspaceService.registerServicesAsync([h],A.vsls.CollectionChangeType.Remove)}catch(h){throw this.trace.error(h),h}m._isServiceAvailable=!1,m._fireIsAvailableChange()}delete this.sharedServices[h]}))}getSharedService(h){return v(this,void 0,void 0,(function*(){I.default(h,"name","string"),h.indexOf(".")<0&&(h=this.callingPackage.fullName+"."+h),this.trace.verbose(`getSharedService(${h})`);let m=this.serviceProxies[h];if(!m){const y=yield Y.client.ensureConnectionAsync();m=new N.SharedServiceApi(h,y,this.trace),this.serviceProxies[h]=m,this.session.role===P.Role.Guest&&Y.workspaceServices.registeredServices.has(h)&&(m._isServiceAvailable=!0)}return m}))}convertLocalUriToShared(h){if(I.default(h,"localUri","uri"),this.session.role!==P.Role.Host)throw new Error("Only the host role can convert shared URIs.");const m=R.Settings.scheme;if(h.scheme===m)throw new Error(`URI is already a ${m} URI: ${h}`);const y=Y.pathManager.code2protocolWorkspaceFilesOnly(h);if(!y)throw new Error(`URI was not part of a workspace: ${h}`);return y}convertSharedUriToLocal(h){if(I.default(h,"sharedUri","uri"),this.session.role!==P.Role.Host)throw new Error("Only the host role can convert shared URIs.");const m=R.Settings.scheme;if(h.scheme!==m)throw new Error(`Not a ${R.Settings.get(R.SettingKeys.shortName)} shared URI: ${h}`);return Y.pathManager.protocolUri2CodeUriConverter(h)}registerCommand(h,m,y){return this.hasPermission("contributeCommands")?x.ExtensionContributions.getContributions(this.callingPackage,this.trace).registerCommand(h,m,y):(this.trace.warning(`registerCommand(${h}) not permitted.`),null)}registerTreeDataProvider(h,m){const y=Y.treeViews[h];return y?y.registerTreeDataProvider(m):null}registerContactServiceProvider(h,m){this.trace.info(`Register contact service provier with name: ${h}`);const y=Y.contactManager;return y?y.registerContactProvider(h,m):null}registerPolicyProvider(h,m){return v(this,void 0,void 0,(function*(){return yield R.EnterpriseConfig.registerPolicyProvider(h,m)}))}getContacts(h){return this.trace.info(`Request contacts for emails: ${h.map(L.TraceFormat.formatEmail).join()}`),D.ContactApi.getContacts(Y.contactManager,h)}postActivity(h){q.activitySource.fire(h)}static getSessionRole(h){return h===R.SessionState.Shared?P.Role.Host:h===R.SessionState.Joined?P.Role.Guest:P.Role.None}static getSessionAccess(h){return h===R.SessionState.Shared?P.Access.Owner:h===R.SessionState.Joined?P.Access.ReadWrite:P.Access.None}onSessionStateChanged(h){return v(this,void 0,void 0,(function*(){const m=LiveShareApi.getSessionRole(h);if(this.session.user||m===P.Role.None&&h!==R.SessionState.SignedIn?this.session.user&&h===R.SessionState.SignedOut&&this.onSignedOut():this.onSignedIn(),m===this.session.role)return;this.session.role=m;let y=null;const v=[];m===P.Role.Host?y=yield this.onShared(v):m===P.Role.Guest?y=yield this.onJoined(v):(y=yield this.onEnded(v),this.hostServiceBroker=void 0),this.trace.verbose(`^onDidChangeSession(${P.Role[m]})`),this.sessionChangeEmitter.fire({session:this.session}),y&&(this.trace.verbose(`^onDidChangePeers(${LiveShareApi.formatPeersChangeEvent(y)})`),this.peersChangeEmitter.fire(y));for(const h of v)h._fireIsAvailableChange()}))}onSignedIn(){this.hasPermission("readUserProfile")&&(this.session.user=R.userAuthStateTracker.userInfo&&{displayName:R.userAuthStateTracker.userInfo.displayName,emailAddress:R.userAuthStateTracker.userInfo.emailAddress,userName:R.userAuthStateTracker.userInfo.userName,id:R.userAuthStateTracker.userInfo.id})}onSignedOut(){this.session.user=null}onShared(h){var m;return v(this,void 0,void 0,(function*(){const y=Object.keys(this.sharedServices);if(y.length>0){try{yield Y.workspaceService.registerServicesAsync(y,A.vsls.CollectionChangeType.Add)}catch(h){this.trace.error(h)}for(let m of y)this.sharedServices[m]._isServiceAvailable=!0,h.push(this.sharedServices[m])}const v=R.workspaceSessionInfoTracker.workspaceSessionInfo,C=this.session;return C.peerNumber=v.sessionNumber,C.access=LiveShareApi.getSessionAccess(R.SessionState.Shared),C.id=v.id||null,this.activityEmitter.fire({timestamp:new Date,name:`${P.ActivityType.session}/share`,data:{peer:this.session,files:null===(m=T.workspace.workspaceFolders)||void 0===m?void 0:m.map(h=>h.uri)}}),null}))}onJoined(h){var m;return v(this,void 0,void 0,(function*(){for(let m of Object.keys(this.serviceProxies))if(Y.workspaceServices.registeredServices.has(m)){const y=this.serviceProxies[m];y._isServiceAvailable=!0,h.push(y)}const y=R.workspaceSessionInfoTracker.workspaceSessionInfo,v=this.session;v.peerNumber=y.sessionNumber,v.access=LiveShareApi.getSessionAccess(R.sessionStateTracker.State),v.id=y.id||null;const C=this.hasPermission("readUserProfile");if(y.sessions&&Object.keys(y.sessions).length>0){const h=[];for(let m of Object.keys(y.sessions)){const v=parseInt(m,10);if(v!==y.sessionNumber){const T=y.sessions[m],w=C?{displayName:T.name,emailAddress:T.email,userName:T.userName,id:T.id}:null;h.push({peerNumber:v,user:w,role:T.isHost?P.Role.Host:P.Role.Guest,access:T.isOwner?P.Access.Owner:P.Access.ReadWrite})}}if(this.activityEmitter.fire({timestamp:new Date,name:`${P.ActivityType.session}/join`,data:{peers:[this.session,...h],files:null===(m=T.workspace.workspaceFolders)||void 0===m?void 0:m.map(h=>h.uri)}}),h.length>0)return this.currentPeers.push(...h),{added:h,removed:[]}}return null}))}onEnded(h){return v(this,void 0,void 0,(function*(){for(let m of Object.keys(this.serviceProxies)){const y=this.serviceProxies[m];y.isServiceAvailable&&(y._isServiceAvailable=!1,h.push(y))}for(let m of Object.keys(this.sharedServices)){const y=this.sharedServices[m];y.isServiceAvailable&&(y._isServiceAvailable=!1,h.push(y))}const m=this.session;return m.peerNumber=0,m.access=LiveShareApi.getSessionAccess(R.sessionStateTracker.State),m.id=null,this.currentPeers.length>0?{added:[],removed:this.currentPeers.splice(0,this.currentPeers.length)}:null}))}onServicesChanged(h){const m=h.serviceNames.filter(h=>h.indexOf(".")>=0);if(h.changeType===A.vsls.CollectionChangeType.Add)for(let h of m){const m=this.serviceProxies[h];m&&!m.isServiceAvailable&&this.session.role===P.Role.Guest&&(m._isServiceAvailable=!0,m._fireIsAvailableChange())}else if(h.changeType===A.vsls.CollectionChangeType.Remove)for(let h of m){const m=this.serviceProxies[h];m&&m.isServiceAvailable&&(m._isServiceAvailable=!1,m._fireIsAvailableChange())}}onUserSessionChanged(h){if(h.sessionNumber!==this.session.peerNumber)if(h.changeType===A.vsls.WorkspaceSessionChangeType.Joined){const m=this.hasPermission("readUserProfile")?{displayName:h.userProfile.name,emailAddress:h.userProfile.email,userName:h.userProfile.userName,id:h.userProfile.id}:null,y={peerNumber:h.sessionNumber,user:m,role:P.Role.Guest,access:P.Access.ReadWrite};this.currentPeers.push(y);const v={added:[y],removed:[]};this.trace.verbose(`^onDidChangePeers(${LiveShareApi.formatPeersChangeEvent(v)}`),this.peersChangeEmitter.fire(v),this.activityEmitter.fire({timestamp:new Date,name:`${P.ActivityType.session}/guestJoin`,data:{peer:y}})}else if(h.changeType===A.vsls.WorkspaceSessionChangeType.Unjoined){const m=this.currentPeers.findIndex(m=>m.peerNumber===h.sessionNumber);if(m>=0){const h=this.currentPeers.splice(m,1)[0],y={added:[],removed:[h]};this.trace.verbose(`^onDidChangePeers(${LiveShareApi.formatPeersChangeEvent(y)}`),this.peersChangeEmitter.fire(y),this.activityEmitter.fire({timestamp:new Date,name:`${P.ActivityType.session}/guestLeave`,data:{peer:h}})}}}static formatPeersChangeEvent(h){let m="";return h.added.length>0&&(m+="added: "+h.added.map(LiveShareApi.formatPeer).join(", ")),h.removed.length>0&&(m+=(m?"; ":"")+"removed: "+h.removed.map(LiveShareApi.formatPeer).join(", ")),m}static formatPeer(h){const m=h.user&&h.user.emailAddress;return`#${h.peerNumber} ${P.Role[h.role]}`+(m?" "+L.TraceFormat.formatEmail(m):"")}hasPermission(h){return U.hasPermissionForExtension(this.callingPackage,h)}sendActivatedTelemetryEvent(){k.Telemetry.sendTelemetryEvent(R.TelemetryEventNames.ACTIVATE_EXTENSION_API,{[R.TelemetryPropertyNames.EXTENSION_NAME]:this.callingPackage.fullName,[R.TelemetryPropertyNames.EXTENSION_VERSION]:this.callingPackage.version,[R.TelemetryPropertyNames.EXTENSION_REQUESTED_API_VERSION]:this.apiVersion})}sendInvokeCommandTelemetryEvent(h,m){k.Telemetry.sendTelemetryEvent(R.TelemetryEventNames.INVOKE_EXTENSION_COMMAND,{[R.TelemetryPropertyNames.EXTENSION_NAME]:this.callingPackage.fullName,[R.TelemetryPropertyNames.EXTENSION_VERSION]:this.callingPackage.version,[R.TelemetryPropertyNames.EXTENSION_INVOKED_COMMAND]:h})}sendShareServiceTelemetryEvent(h,m){k.Telemetry.sendTelemetryEvent(R.TelemetryEventNames.SHARE_EXTENSION_SERVICE,{[R.TelemetryPropertyNames.EXTENSION_NAME]:this.callingPackage.fullName,[R.TelemetryPropertyNames.EXTENSION_VERSION]:this.callingPackage.version,[R.TelemetryPropertyNames.EXTENSION_SERVICE_NAME]:h,[R.TelemetryPropertyNames.EXTENSION_SERVICE_PERMITTED]:m.toString()})}}m.LiveShareApi=LiveShareApi},function(h,m,y){"use strict";var v=this&&this.__awaiter||function(h,m,y,v){return new(y||(y=Promise))((function(C,T){function fulfilled(h){try{step(v.next(h))}catch(h){T(h)}}function rejected(h){try{step(v.throw(h))}catch(h){T(h)}}function step(h){h.done?C(h.value):function adopt(h){return h instanceof y?h:new y((function(m){m(h)}))}(h.value).then(fulfilled,rejected)}step((v=v.apply(h,m||[])).next())}))};Object.defineProperty(m,"__esModule",{value:!0});const C=y(0),T=y(6),w=y(553),A={connection:null};class SharedServiceApi{constructor(h,m,y){this.name=h,this.trace=y,this.isAvailable=!1,this.isAvailableChange=new C.EventEmitter,w.default(m,"connection","object"),A.connection=m,Object.defineProperty(this,"name",{enumerable:!1,configurable:!1,writable:!1})}get isServiceAvailable(){return this.isAvailable}get onDidChangeIsServiceAvailable(){return this.isAvailableChange.event}set _isServiceAvailable(h){this.isAvailable=h}_fireIsAvailableChange(){this.trace.verbose(`^onDidChangeIsServiceAvailable(${this.name}, ${this.isAvailable})`),this.isAvailableChange.fire(this.isAvailable)}onRequest(h,m){w.default(h,"name","string"),w.default(m,"handler","function");const y=this.makeRpcName(h);this.trace.verbose(`onRequest(${y})`),A.connection.onRequest(y,(...h)=>{this.trace.verbose(`rpc.onRequest(${y})`),h.splice(0,1);const[v]=h.splice(h.length-1,1);try{return m(h,v)}catch(h){this.trace.warning(`Request handler (${y}) failed: `+h.message);let m=h.stack;return m&&(m=m.replace(new RegExp("\\s+at "+SharedServiceApi.name+"(.*\n?)+"),"")),new T.ResponseError(T.ErrorCodes.UnknownErrorCode,h.message,m)}})}onNotify(h,m){w.default(h,"name","string"),w.default(m,"handler","function");const y=this.makeRpcName(h);this.trace.verbose(`onNotify(${y})`),A.connection.onNotification(y,(...h)=>{const v=h[0];this.trace.verbose(`rpc.onNotify(${y})`);try{m(v)}catch(h){this.trace.warning(`Notification handler (${y}) failed: `+h.message)}})}request(h,m,y){return v(this,void 0,void 0,(function*(){w.default(h,"name","string"),w.default(m,"args","array");const v=this.makeRpcName(h);if(!this.isServiceAvailable)throw this.trace.warning(`request(${v}) - service not available`),new SharedServiceProxyError("Service '"+this.name+"' is not available.");let C,T;this.trace.verbose(`request(${v})`);try{C=y?A.connection.sendRequest(v,m,y):A.connection.sendRequest(v,m)}catch(h){throw this.trace.warning(`request(${v}) failed: `+h.message),new SharedServiceProxyError(h.message)}try{T=yield C}catch(h){throw this.trace.warning(`request(${v}) failed: `+h.message),new SharedServiceResponseError(h.message,h.data)}return this.trace.verbose(`request(${v}) succeeded`),T}))}notify(h,m){w.default(h,"name","string"),w.default(m,"args","object");const y=this.makeRpcName(h);if(this.isServiceAvailable){this.trace.verbose(`notify(${y})`);try{A.connection.sendNotification(y,[m])}catch(h){throw this.trace.warning(`notify(${y}) failed: `+h.message),new SharedServiceProxyError(h.message)}}else this.trace.verbose(`notify(${y}) - service not available`)}makeRpcName(h){return this.name+"."+h}}m.SharedServiceApi=SharedServiceApi;class SharedServiceProxyError extends Error{constructor(h){super(h),this.name=SharedServiceProxyError.name}}m.SharedServiceProxyError=SharedServiceProxyError;class SharedServiceResponseError extends Error{constructor(h,m){super(h),this.remoteStack=m,this.name=SharedServiceResponseError.name}}m.SharedServiceResponseError=SharedServiceResponseError},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0});const v=y(0);m.default=function checkArg(h,m,y){if(!h)throw new Error("Argument '"+m+"' is required.");if(y)if("array"===y){if(!Array.isArray(h))throw new Error("Argument '"+m+"' must be an array.")}else if("uri"===y){if(!(h instanceof v.Uri))throw new Error("Argument '"+m+"' must be a Uri object.")}else{if("object"===y&&Array.isArray(h))throw new Error("Argument '"+m+"' must be a a non-array object.");if(typeof h!==y)throw new Error("Argument '"+m+"' must be type '"+y+"'.")}}},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0}),m.FrameworkServices=void 0;const v=y(147),C=y(555),T=y(307);let w=(()=>{class FrameworkServices{}return FrameworkServices.remoteServiceBroker=Object.freeze(new C.ServiceJsonRpcDescriptor(T.ServiceMoniker.create("RemoteServiceBroker"),v.Formatters.Utf8,v.MessageDelimiters.HttpLikeHeaders)),FrameworkServices.authorization=Object.freeze(new C.ServiceJsonRpcDescriptor(T.ServiceMoniker.create("Microsoft.ServiceHub.Framework.AuthorizationService"),v.Formatters.Utf8,v.MessageDelimiters.HttpLikeHeaders)),FrameworkServices})();m.FrameworkServices=w},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0}),m.JsonRpcConnection=m.ServiceJsonRpcDescriptor=void 0;const v=y(6),C=y(147),T=y(307),w=y(556),A=y(557),P=y(1365),k=y(559);class ServiceJsonRpcDescriptor extends w.ServiceRpcDescriptor{constructor(h,m,y){let T,w;switch(super(h),this.formatter=m,this.messageDelimiter=y,this.protocol="json-rpc",m){case C.Formatters.Utf8:T=h=>Promise.resolve(Buffer.from(JSON.stringify(h))),w=h=>JSON.parse(h.toString());break;case C.Formatters.MessagePack:T=h=>Promise.resolve(k.encode(h)),w=h=>k.decode(h);break;default:throw new Error(`Unsupported formatter: ${m}.`)}if(y===C.MessageDelimiters.HttpLikeHeaders){if(m!==C.Formatters.Utf8)throw new Error("Utf8 is the only formatter supported while using HttpLikeHeaders.");this.connectionFactory=h=>v.createMessageConnection(h,h)}else{if(y!==C.MessageDelimiters.BigEndianInt32LengthHeader)throw new Error(`Unsupported message delimiter: ${y}.`);this.connectionFactory=h=>v.createMessageConnection(new P.BE32MessageReader(h,w),new P.BE32MessageWriter(h,T))}}constructRpcConnection(h){return new JsonRpcConnection(A.constructMessageConnection(h,this.connectionFactory))}equals(h){return!!(h&&h instanceof ServiceJsonRpcDescriptor)&&(!!T.ServiceMoniker.equals(h.moniker,this.moniker)&&(this.formatter===h.formatter&&this.messageDelimiter===h.messageDelimiter))}}m.ServiceJsonRpcDescriptor=ServiceJsonRpcDescriptor;const R={get:(h,m)=>{switch(m.toString()){case"dispose":return function(){h.dispose()};case"then":return;default:return function(){const y=m.toString();let C;if(arguments.length>0){if(v.CancellationToken.is(arguments[arguments.length-1])){C=arguments[arguments.length-1];const m=validateNoUndefinedElements(Array.prototype.slice.call(arguments,0,arguments.length-1));return h.sendRequest(y,m,C)}if(void 0===arguments[arguments.length-1]){const m=validateNoUndefinedElements(Array.prototype.slice.call(arguments,0,arguments.length-1));return h.sendRequest(y,m)}}const T=validateNoUndefinedElements(Array.prototype.slice.call(arguments));return h.sendRequest(y,T)}}}};function validateNoUndefinedElements(h){for(let m=0;m<h.length;m++)if(void 0===h[m])throw new Error(`Argument at 0-based index ${m} is set as undefined, which is not a valid JSON value.`);return h}class JsonRpcConnection extends w.RpcConnection{constructor(h){super(),this.messageConnection=h}addLocalRpcTarget(h){function registerRequestAndNotification(m,y,v){m.onRequest(y,(...m)=>v.apply(h,m)),m.onNotification(y,(...m)=>v.apply(h,m))}JsonRpcConnection.getInstanceMethodNames(h,Object.prototype).forEach(m=>{if("dispose"!==m){const y=h[m];registerRequestAndNotification(this.messageConnection,m,y);const v="Async",C=m.endsWith(v)?m.substring(0,m.length-v.length):`${m}${v}`;registerRequestAndNotification(this.messageConnection,C,y)}}),"function"==typeof h.dispose&&this.messageConnection.onDispose(()=>h.dispose())}constructRpcClient(){return new Proxy(this.messageConnection,R)}startListening(){var h;null===(h=this.messageConnection)||void 0===h||h.listen()}dispose(){}static isMethod(h,m){const y=Object.getOwnPropertyDescriptor(h,m);return!!y&&"function"==typeof y.value}static getInstanceMethodNames(h,m){const y=[];let v=Object.getPrototypeOf(h);for(;v&&v!==m;)Object.getOwnPropertyNames(v).forEach(h=>{"constructor"!==h&&JsonRpcConnection.isMethod(v,h)&&y.push(h)}),v=Object.getPrototypeOf(v);return y}}m.JsonRpcConnection=JsonRpcConnection},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0}),m.RpcConnection=m.ServiceRpcDescriptor=void 0;const v=y(28);m.ServiceRpcDescriptor=class ServiceRpcDescriptor{constructor(h){this.moniker=h,v(h)}constructRpc(h,m){let y;if(m?y=h:m=h,void 0===m)throw new Error("No pipe supplied.");const v=this.constructRpcConnection(m);void 0!==y&&v.addLocalRpcTarget(y);const C=v.constructRpcClient();return v.startListening(),C}};m.RpcConnection=class RpcConnection{}},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0}),m.IsReadWriteStream=m.constructMessageConnection=void 0;const v=y(28);function IsReadWriteStream(h){return"unshift"in h}m.constructMessageConnection=function constructMessageConnection(h,m){let y;return v(h),IsReadWriteStream(h)?(y=m(h),h.on("close",()=>{null==y||y.dispose()}),y.onDispose(()=>h.end()),y.onClose(()=>h.end())):(y=m(h.stream),h.completion.then(()=>{null==y||y.dispose()}),y.onDispose(()=>h.dispose()),y.onClose(()=>h.dispose())),y},m.IsReadWriteStream=IsReadWriteStream},function(h,m,y){"use strict";class Semaphore{constructor(h){this.tasks=[],this.count=h}sched(){if(this.count>0&&this.tasks.length>0){this.count--;let h=this.tasks.shift();if(void 0===h)throw"Unexpected undefined value in tasks list";h()}}acquire(){return new Promise((h,m)=>{this.tasks.push(()=>{var m=!1;h(()=>{m||(m=!0,this.count++,this.sched())})}),process&&process.nextTick?process.nextTick(this.sched.bind(this)):setImmediate(this.sched.bind(this))})}use(h){return this.acquire().then(m=>h().then(h=>(m(),h)).catch(h=>{throw m(),h}))}}m.Semaphore=Semaphore;m.Mutex=class Mutex extends Semaphore{constructor(){super(1)}}},function(h,m,y){m.encode=y(560).encode,m.decode=y(564).decode,m.Encoder=y(1377).Encoder,m.Decoder=y(1378).Decoder,m.createEncodeStream=y(1379).createEncodeStream,m.createDecodeStream=y(1380).createDecodeStream,m.createCodec=y(1381).createCodec,m.codec=y(1382).codec},function(h,m,y){m.encode=function encode(h,m){var y=new v(m);return y.write(h),y.read()};var v=y(308).EncodeBuffer},function(h,m){m.read=function(h,m,y,v,C){var T,w,A=8*C-v-1,P=(1<<A)-1,k=P>>1,R=-7,M=y?C-1:0,N=y?-1:1,D=h[m+M];for(M+=N,T=D&(1<<-R)-1,D>>=-R,R+=A;R>0;T=256*T+h[m+M],M+=N,R-=8);for(w=T&(1<<-R)-1,T>>=-R,R+=v;R>0;w=256*w+h[m+M],M+=N,R-=8);if(0===T)T=1-k;else{if(T===P)return w?NaN:1/0*(D?-1:1);w+=Math.pow(2,v),T-=k}return(D?-1:1)*w*Math.pow(2,T-v)},m.write=function(h,m,y,v,C,T){var w,A,P,k=8*T-C-1,R=(1<<k)-1,M=R>>1,N=23===C?Math.pow(2,-24)-Math.pow(2,-77):0,D=v?0:T-1,I=v?1:-1,x=m<0||0===m&&1/m<0?1:0;for(m=Math.abs(m),isNaN(m)||m===1/0?(A=isNaN(m)?1:0,w=R):(w=Math.floor(Math.log(m)/Math.LN2),m*(P=Math.pow(2,-w))<1&&(w--,P*=2),(m+=w+M>=1?N/P:N*Math.pow(2,1-M))*P>=2&&(w++,P/=2),w+M>=R?(A=0,w=R):w+M>=1?(A=(m*P-1)*Math.pow(2,C),w+=M):(A=m*Math.pow(2,M-1)*Math.pow(2,C),w=0));C>=8;h[y+D]=255&A,D+=I,A/=256,C-=8);for(w=w<<C|A,k+=C;k>0;h[y+D]=255&w,D+=I,w/=256,k-=8);h[y+D-I]|=128*x}},function(h,m){for(var y=m.uint8=new Array(256),v=0;v<=255;v++)y[v]=write0(v);function write0(h){return function(m){var y=m.reserve(1);m.buffer[y]=h}}},function(h,m,y){m.FlexDecoder=FlexDecoder,m.FlexEncoder=FlexEncoder;var v=y(44);function FlexDecoder(){if(!(this instanceof FlexDecoder))return new FlexDecoder}function FlexEncoder(){if(!(this instanceof FlexEncoder))return new FlexEncoder}function write(){throw new Error("method not implemented: write()")}function fetch(){throw new Error("method not implemented: fetch()")}function read(){return this.buffers&&this.buffers.length?(this.flush(),this.pull()):this.fetch()}function push(h){(this.buffers||(this.buffers=[])).push(h)}function pull(){return(this.buffers||(this.buffers=[])).shift()}function mixinFactory(h){return function mixin(m){for(var y in h)m[y]=h[y];return m}}FlexDecoder.mixin=mixinFactory(function getDecoderMethods(){return{bufferish:v,write:function write(h){var m=this.offset?v.prototype.slice.call(this.buffer,this.offset):this.buffer;this.buffer=m?h?this.bufferish.concat([m,h]):m:h,this.offset=0},fetch:fetch,flush:function flush(){for(;this.offset<this.buffer.length;){var h,m=this.offset;try{h=this.fetch()}catch(h){if(h&&"BUFFER_SHORTAGE"!=h.message)throw h;this.offset=m;break}this.push(h)}},push:push,pull:pull,read:read,reserve:function reserve(h){var m=this.offset,y=m+h;if(y>this.buffer.length)throw new Error("BUFFER_SHORTAGE");return this.offset=y,m},offset:0}}()),FlexDecoder.mixin(FlexDecoder.prototype),FlexEncoder.mixin=mixinFactory(function getEncoderMethods(){return{bufferish:v,write:write,fetch:function fetch(){var h=this.start;if(h<this.offset){var m=this.start=this.offset;return v.prototype.slice.call(this.buffer,h,m)}},flush:function flush(){for(;this.start<this.offset;){var h=this.fetch();h&&this.push(h)}},push:push,pull:function pull(){var h=this.buffers||(this.buffers=[]),m=h.length>1?this.bufferish.concat(h):h[0];return h.length=0,m},read:read,reserve:function reserve(h){var m=0|h;if(this.buffer){var y=this.buffer.length,v=0|this.offset,C=v+m;if(C<y)return this.offset=C,v;this.flush(),h=Math.max(h,Math.min(2*y,this.maxBufferSize))}return h=Math.max(h,this.minBufferSize),this.buffer=this.bufferish.alloc(h),this.start=0,this.offset=m,0},send:function send(h){var m=h.length;if(m>this.minBufferSize)this.flush(),this.push(h);else{var y=this.reserve(m);v.prototype.copy.call(h,this.buffer,y)}},maxBufferSize:65536,minBufferSize:2048,offset:0,start:0}}()),FlexEncoder.mixin(FlexEncoder.prototype)},function(h,m,y){m.decode=function decode(h,m){var y=new v(m);return y.write(h),y.read()};var v=y(313).DecodeBuffer},function(h,m,y){var v=y(561),C=y(312),T=C.Uint64BE,w=C.Int64BE;m.getReadFormat=function getReadFormat(h){var m=A.hasArrayBuffer&&h&&h.binarraybuffer,y=h&&h.int64;return{map:k&&h&&h.usemap?map_to_map:map_to_obj,array:array,str:str,bin:m?bin_arraybuffer:bin_buffer,ext:ext,uint8:uint8,uint16:uint16,uint32:uint32,uint64:read(8,y?readUInt64BE_int64:readUInt64BE),int8:int8,int16:int16,int32:int32,int64:read(8,y?readInt64BE_int64:readInt64BE),float32:read(4,readFloatBE),float64:read(8,readDoubleBE)}},m.readUint8=uint8;var A=y(44),P=y(311),k="undefined"!=typeof Map;function map_to_obj(h,m){var y,v={},C=new Array(m),T=new Array(m),w=h.codec.decode;for(y=0;y<m;y++)C[y]=w(h),T[y]=w(h);for(y=0;y<m;y++)v[C[y]]=T[y];return v}function map_to_map(h,m){var y,v=new Map,C=new Array(m),T=new Array(m),w=h.codec.decode;for(y=0;y<m;y++)C[y]=w(h),T[y]=w(h);for(y=0;y<m;y++)v.set(C[y],T[y]);return v}function array(h,m){for(var y=new Array(m),v=h.codec.decode,C=0;C<m;C++)y[C]=v(h);return y}function str(h,m){var y=h.reserve(m),v=y+m;return P.toString.call(h.buffer,"utf-8",y,v)}function bin_buffer(h,m){var y=h.reserve(m),v=y+m,C=P.slice.call(h.buffer,y,v);return A.from(C)}function bin_arraybuffer(h,m){var y=h.reserve(m),v=y+m,C=P.slice.call(h.buffer,y,v);return A.Uint8Array.from(C).buffer}function ext(h,m){var y=h.reserve(m+1),v=h.buffer[y++],C=y+m,T=h.codec.getExtUnpacker(v);if(!T)throw new Error("Invalid ext type: "+(v?"0x"+v.toString(16):v));return T(P.slice.call(h.buffer,y,C))}function uint8(h){var m=h.reserve(1);return h.buffer[m]}function int8(h){var m=h.reserve(1),y=h.buffer[m];return 128&y?y-256:y}function uint16(h){var m=h.reserve(2),y=h.buffer;return y[m++]<<8|y[m]}function int16(h){var m=h.reserve(2),y=h.buffer,v=y[m++]<<8|y[m];return 32768&v?v-65536:v}function uint32(h){var m=h.reserve(4),y=h.buffer;return 16777216*y[m++]+(y[m++]<<16)+(y[m++]<<8)+y[m]}function int32(h){var m=h.reserve(4),y=h.buffer;return y[m++]<<24|y[m++]<<16|y[m++]<<8|y[m]}function read(h,m){return function(y){var v=y.reserve(h);return m.call(y.buffer,v,!0)}}function readUInt64BE(h){return new T(this,h).toNumber()}function readInt64BE(h){return new w(this,h).toNumber()}function readUInt64BE_int64(h){return new T(this,h)}function readInt64BE_int64(h){return new w(this,h)}function readFloatBE(h){return v.read(this,h,!1,23,4)}function readDoubleBE(h){return v.read(this,h,!1,52,8)}},function(h,m,y){!function(m){h.exports=m;var y={on:function on(h,m){return getListeners(this,h).push(m),this},once:function once(h,m){var y=this;return wrap.originalListener=m,getListeners(y,h).push(wrap),y;function wrap(){off.call(y,h,wrap),m.apply(this,arguments)}},off:off,emit:function emit(h,m){var y=this,v=getListeners(y,h,!0);if(!v)return!1;var C=arguments.length;if(1===C)v.forEach(zeroarg);else if(2===C)v.forEach(onearg);else{var T=Array.prototype.slice.call(arguments,1);v.forEach(moreargs)}return!!v.length;function zeroarg(h){h.call(y)}function onearg(h){h.call(y,m)}function moreargs(h){h.apply(y,T)}}};function mixin(h){for(var m in y)h[m]=y[m];return h}function off(h,m){var y,v=this;if(arguments.length){if(m){if(y=getListeners(v,h,!0)){if(!(y=y.filter(ne)).length)return off.call(v,h);v.listeners[h]=y}}else if((y=v.listeners)&&(delete y[h],!Object.keys(y).length))return off.call(v)}else delete v.listeners;return v;function ne(h){return h!==m&&h.originalListener!==m}}function getListeners(h,m,y){if(!y||h.listeners){var v=h.listeners||(h.listeners={});return v[m]||(v[m]=[])}}mixin(m.prototype),m.mixin=mixin}((
/**
 * event-lite.js - Light-weight EventEmitter (less than 1KB when gzipped)
 *
 * @copyright Yusuke Kawasaki
 * @license MIT
 * @constructor
 * @see https://github.com/kawanet/event-lite
 * @see http://kawanet.github.io/event-lite/EventLite.html
 * @example
 * var EventLite = require("event-lite");
 *
 * function MyClass() {...}             // your class
 *
 * EventLite.mixin(MyClass.prototype);  // import event methods
 *
 * var obj = new MyClass();
 * obj.on("foo", function() {...});     // add event listener
 * obj.once("bar", function() {...});   // add one-time event listener
 * obj.emit("foo");                     // dispatch event
 * obj.emit("bar");                     // dispatch another event
 * obj.off("foo");                      // remove event listener
 */
function EventLite(){if(!(this instanceof EventLite))return new EventLite}))},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0}),m.AuthorizationServiceClient=void 0;const v=y(28),C=y(85);m.AuthorizationServiceClient=class AuthorizationServiceClient{constructor(h,m=!0){this.authService=h,this.ownsAuthService=m,this.isDisposed=!1,v(h),this.authService=h}async getCredentials(h=C.default.CONTINUE){if(this.isDisposed)throw new Error("Object is disposed");return await this.authService.getCredentials(h)}async checkAuthorization(h,m=C.default.CONTINUE){if(v(h),this.isDisposed)throw new Error("Object is disposed");return await this.authService.checkAuthorization(h,m)}dispose(){this.isDisposed=!0,this.ownsAuthService&&this.authService.dispose()}}},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0});const v=y(85),C=y(19),T=y(569),w=y(192),A=y(315),P=y(316);class Channel{constructor(h){this._isDisposed=!1,this.id=h}get isDisposed(){return this._isDisposed}dispose(){this._isDisposed=!0}}m.Channel=Channel;m.ChannelClass=class ChannelClass extends Channel{constructor(h,m,y,v){super(y),this._acceptance=new w.Deferred,this._completion=new w.Deferred,this.remoteWindowFilled=0;const k=this;this.name=v.name,m?this.localWindowSize=v.remoteWindowSize:this.remoteWindowSize=v.remoteWindowSize,this._multiplexingStream=h,this.remoteWindowHasCapacity=new w.Deferred,this._multiplexingStream.backpressureSupportEnabled&&!this.remoteWindowSize||this.remoteWindowHasCapacity.resolve(),this._duplex=new C.Duplex({async write(m,v,C){let w;try{let v=Buffer.from(m);for(;v.length>0;){let m=Math.min(v.length,P.MultiplexingStream.framePayloadMaxLength);if(k._multiplexingStream.backpressureSupportEnabled){if(await k.remoteWindowHasCapacity.promise,!k.remoteWindowSize)throw new Error("Remote window size unknown.");m=Math.min(k.remoteWindowSize-k.remoteWindowFilled,m)}k.onTransmittingBytes(m);const C=new A.FrameHeader(T.ControlCode.Content,y);await h.sendFrameAsync(C,v.slice(0,m)),v=v.slice(m)}}catch(h){w=h}C&&C(w)},async final(m){let y;try{await h.onChannelWritingCompleted(k)}catch(h){y=h}m&&m(y)},read(){}})}get stream(){return this._duplex}get acceptance(){return this._acceptance.promise}get isAccepted(){return this._acceptance.isResolved}get isRejectedOrCanceled(){return this._acceptance.isRejected}get completion(){return this._completion.promise}tryAcceptOffer(h){return!!this._acceptance.resolve()&&(this.localWindowSize=void 0!==(null==h?void 0:h.channelReceivingWindowSize)?Math.max(this._multiplexingStream.defaultChannelReceivingWindowSize,null==h?void 0:h.channelReceivingWindowSize):this._multiplexingStream.defaultChannelReceivingWindowSize,!0)}tryCancelOffer(h){const m=new v.default.CancellationError(h);this._acceptance.reject(m),this._completion.reject(m)}onAccepted(h){return this._multiplexingStream.backpressureSupportEnabled&&(this.remoteWindowSize=h.remoteWindowSize,this.remoteWindowHasCapacity.resolve()),this._acceptance.resolve()}onContent(h){this._duplex.push(h),this._multiplexingStream.backpressureSupportEnabled&&h&&this._multiplexingStream.localContentExamined(this,h.length)}onContentProcessed(h){if(h<0)throw new Error("A non-negative number is required.");if(h>this.remoteWindowFilled)throw new Error("More bytes processed than we thought were in the window.");if(void 0===this.remoteWindowSize)throw new Error("Unexpected content processed message given we don't know the remote window size.");this.remoteWindowFilled-=h,this.remoteWindowFilled<this.remoteWindowSize&&this.remoteWindowHasCapacity.resolve()}dispose(){this.isDisposed||(super.dispose(),this._acceptance.reject(new v.default.CancellationError("disposed")),this._duplex.end(),this._duplex.push(null),this._completion.resolve(),this._multiplexingStream.onChannelDisposed(this))}onTransmittingBytes(h){if(this._multiplexingStream.backpressureSupportEnabled){if(h<0)throw new Error("Negative byte count transmitted.");this.remoteWindowFilled+=h,this.remoteWindowFilled==this.remoteWindowSize&&(this.remoteWindowHasCapacity=new w.Deferred)}}}},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0}),function(h){h[h.Offer=0]="Offer",h[h.OfferAccepted=1]="OfferAccepted",h[h.Content=2]="Content",h[h.ContentWritingCompleted=3]="ContentWritingCompleted",h[h.ChannelTerminated=4]="ChannelTerminated",h[h.ContentProcessed=5]="ContentProcessed"}(m.ControlCode||(m.ControlCode={}))},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0}),m.RemoteServiceConnectionInfo=void 0,function(h){h.isEmpty=function isEmpty(h){return!h.multiplexingChannelId&&!h.requestId},h.isOneOf=function isOneOf(h,m){return!!h.multiplexingChannelId&&m.indexOf("multiplexing")>-1}}(m.RemoteServiceConnectionInfo||(m.RemoteServiceConnectionInfo={}))},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0});var v=y(572);m.SudoPortForwarderServiceClient=v.SudoPortForwarderServiceClient;var C=y(1396);m.initWorkspaceHubConnectionHub=C.initWorkspaceHubConnectionHub;var T=y(1400);m.SudoPortForwarderService=T.SudoPortForwarderService;var w=y(1402);m.SudoPortforwarderClient=w.SudoPortforwarderClient;var A=y(574);m.LocalPortForwarder=A.LocalPortForwarder;var P=y(1403);m.LOGS_DIRECTORY=P.LOGS_DIRECTORY},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0}),m.SudoPortForwarderServiceClient={name:"csSudoPortForwarderServiceClient",methods:["connect","startPortForwarding","stopPortForwarding","disconnect"],events:[]}},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0});var v=y(1398);m.WorkspaceHubClient=v.WorkspaceHubClient},function(h,m,y){"use strict";var v=this&&this.__awaiter||function(h,m,y,v){return new(y||(y=Promise))((function(C,T){function fulfilled(h){try{step(v.next(h))}catch(h){T(h)}}function rejected(h){try{step(v.throw(h))}catch(h){T(h)}}function step(h){h.done?C(h.value):function adopt(h){return h instanceof y?h:new y((function(m){m(h)}))}(h.value).then(fulfilled,rejected)}step((v=v.apply(h,m||[])).next())}))},C=this&&this.__importStar||function(h){if(h&&h.__esModule)return h;var m={};if(null!=h)for(var y in h)Object.hasOwnProperty.call(h,y)&&(m[y]=h[y]);return m.default=h,m},T=this&&this.__importDefault||function(h){return h&&h.__esModule?h:{default:h}};Object.defineProperty(m,"__esModule",{value:!0});const w=C(y(31)),A=T(y(1401)),P=y(2),k=y(39);var R;m.MessageWorkspaceClientClosed="Workspace client was closed.",m.DEFAULT_SERVER_ADDRESS="127.0.0.1",function(h){h.AlreadyInUse="EADDRINUSE",h.NoAccess="EACCES"}(R=m.ErrorCodes||(m.ErrorCodes={}));class LocalPortForwarder extends P.DisposableClass{constructor(h,y,v,C,T,M=w.Server,N=[R.AlreadyInUse,R.NoAccess],D=A.default){super(h.createChild(`local-port-forwarder[${y.sourcePort}]`)),this.sharedServer=y,this.workspaceConnection=v,this.streamManagerClient=C,this.localPortRef=T,this.rebindToRandomPortOnErrors=N,this.getFreePortNumber=D,this.connections=[],this.channels=[],this.forecastChannels=[],this.stoppingSignal=new P.Signal,this.isClosed=!1,this.trace.info("rebindToRandomPortOnErrors: ",JSON.stringify(N)),this.server=new M(this.onConnection.bind(this)),this.addToDisposables(v.onHostConnectionChanged(h=>{h.state===k.ConnectedState.Closed&&(this.trace.info(m.MessageWorkspaceClientClosed),this.isClosed=!0,this.dispose("workspace connection closed"))}),this.onDispose(()=>{this.stop().catch(h=>{this.trace.error("Failed to stop local server.",h)})}))}get localPort(){return this.localPortRef}start(h=0){return v(this,void 0,void 0,(function*(){try{this.trace.info(`start with "${h}" channels`),this.trace.info(`start: sourcePort=${this.sharedServer.sourcePort} localPort=${this.localPortRef} host=${this.sharedServer.sessionName}`),yield this.listen(),this.trace.info("server started")}catch(h){h instanceof Error&&(this.trace.info("error while starting: ",JSON.stringify(P.errorToObject(h))),P.assert(this.rebindToRandomPortOnErrors.includes(h.code),h)),this.trace.info("rebinding to a random port"),this.localPortRef=yield this.getFreePortNumber(),yield this.listen(),this.trace.info(`start (failed): sourcePort=${this.sharedServer.sourcePort} localPort=${this.localPortRef} host=${this.sharedServer.sessionName}`)}for(let m=0;m<h;m++)this.forecastChannels.push(this.openChannel())}))}stop(){var h;return v(this,void 0,void 0,(function*(){if(this.trace.info("stopping"),this.server.listening){for(const m of this.channels)null===(h=m.close())||void 0===h||h.catch(h=>this.trace.error("failed to close channel",h));this.trace.verbose(`stop: stopping local server port=${this.localPortRef} connections=${this.connections.length}`),this.server.close(h=>{if(h)return this.trace.error(`stop: failed to stop local server port=${this.localPortRef}`,h),this.stoppingSignal.reject(h);this.trace.verbose(`stop: stopped local server port=${this.localPortRef}`,h),this.stoppingSignal.resolve()});for(const h of this.connections)h.destroy();return yield this.stoppingSignal.promise}}))}listen(){return v(this,void 0,void 0,(function*(){return yield new Promise((h,y)=>{this.server.once("listening",()=>{this.trace.info(`listening on local port=${this.localPortRef}`),h()}),this.server.once("error",h=>{this.trace.error(`failed to listen on local port=${this.localPortRef}`,h),y(h)}),this.trace.info(`start listen to port: "${m.DEFAULT_SERVER_ADDRESS}:${this.localPortRef}"`),this.server.listen(this.localPortRef,m.DEFAULT_SERVER_ADDRESS)})}))}onConnection(h){var m,y;return v(this,void 0,void 0,(function*(){this.connections.push(h);try{const v=yield null!==(m=this.forecastChannels.shift())&&void 0!==m?m:this.openChannel();this.addToDisposables(P.createDisposable(()=>{v.close(),h.end()}),v),this.channels.push(v);const C=null!==(y=v.channelId)&&void 0!==y?y:"?";this.trace.info(`Forwarding connection on channel #${C}.`),h.on("data",m=>{h.pause(),v.send(m).then(()=>{h.resume()},h=>{this.trace.error("Error sending channel data: "+h.message,h)})}),v.onDataReceived(m=>{m=Buffer.from(m),h.write(m,()=>{v.adjustWindow(m.length)})}),h.on("close",()=>{var m;const y=this.connections.indexOf(h);y>=0&&this.connections.splice(y,1),null===(m=v.close())||void 0===m||m.catch(h=>this.trace.error("Channel close failed with error",h))}),h.on("error",m=>{var y;const C=this.connections.indexOf(h);C>=0&&this.connections.splice(C,1),null===(y=v.close(m))||void 0===y||y.catch(h=>this.trace.error("Channel close failed with error",h))}),v.onClosed(m=>{if(m.error||m.errorMessage){const h=`Port-forward channel #${C} closed with error: ${m.error&&m.error.message?m.error.message:m.errorMessage}`;this.trace.error(h)}else this.trace.info(`Port-forward channel #${C} closed.`);h.end()})}catch(m){m instanceof Error&&this.trace.error("Failed to forward incoming connection to remote server: "+m.message,m),h.end()}}))}openChannel(){return v(this,void 0,void 0,(function*(){P.assert(!this.isClosed,m.MessageWorkspaceClientClosed);const h=yield this.streamManagerClient.getStreamAsync(this.sharedServer.streamName,this.sharedServer.streamCondition);return yield this.workspaceConnection.openStreamingChannel(h)}))}}m.LocalPortForwarder=LocalPortForwarder},function(h,m,y){"use strict";function __export(h){for(var y in h)m.hasOwnProperty(y)||(m[y]=h[y])}Object.defineProperty(m,"__esModule",{value:!0}),__export(y(576)),__export(y(1404)),__export(y(318)),__export(y(1405))},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0}),m.hubWorkspaceAppFile="hub-workspace.js",m.hubPortForwardingAppFile="port-forwarder-hub.js",m.liveshareHubAppFile="liveshare-hub.js"},function(h,m){h.exports=require("process")},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0}),m.DEFAULT_PLANNED_SESSION_LABEL="Planned Session"},function(h,m,y){"use strict";var v=this&&this.__awaiter||function(h,m,y,v){return new(y||(y=Promise))((function(C,T){function fulfilled(h){try{step(v.next(h))}catch(h){T(h)}}function rejected(h){try{step(v.throw(h))}catch(h){T(h)}}function step(h){h.done?C(h.value):function adopt(h){return h instanceof y?h:new y((function(m){m(h)}))}(h.value).then(fulfilled,rejected)}step((v=v.apply(h,m||[])).next())}))};Object.defineProperty(m,"__esModule",{value:!0});const C=y(3),T=y(4),w=y(0),A=y(320),P=y(6),k=y(194);class ThreadInfo{constructor(h){if(this.thread=h,this.commentId=0,!h.comments||!h.comments.length)throw new A.ResponseError(P.ErrorCodes.InvalidParams,"No comments on the comment thread parameter");if(h.comments.length>1)throw new A.ResponseError(P.ErrorCodes.InvalidParams,"Too many comments on the comment thread parameter. Only one is required.");const m=h.comments[0];if(!m)throw new A.ResponseError(P.ErrorCodes.InvalidParams,"The comment is undefined or missing on the comment thread parameter");m.parentId=-1,this.addComment(m,!0)}get isEmpty(){return 0===this.thread.comments.length}get lastCommentId(){return this.thread.comments[this.thread.comments.length-1].commentId}addComment(h,m){if(!h)throw new A.ResponseError(P.ErrorCodes.InvalidParams,"No comment parameter");if(!h.text)throw new A.ResponseError(P.ErrorCodes.InvalidParams,"No comment text.");if(!h.participantId)throw new A.ResponseError(P.ErrorCodes.InvalidParams,"No participant ID.");if(!m){const m=h.parentId;let y;if(-1===m)h.parentId=this.lastCommentId,y=this.thread.comments.length;else{if(y=this.thread.comments.findIndex(h=>h.parentId===m),y>=0)for(;y<this.thread.comments.length&&this.thread.comments[y].parentId===m;)y++;else if(y=this.thread.comments.findIndex(h=>h.commentId===m)+1,0===y)throw new A.ResponseError(P.ErrorCodes.InvalidParams,"Unknown parent comment ID");this.thread.comments.splice(y,0,h)}}const y=new Date;h.threadId=this.thread.threadId,h.commentId=this.commentId++,h.publishedDate=y,this.thread.lastUpdatedDate=y,this.thread.lastUpdatedSessionId=h.lastUpdatedSessionId,this.thread.publishedDate||(this.thread.publishedDate=y)}updateCommentText(h,m,y){if(!y)throw new A.ResponseError(P.ErrorCodes.InvalidParams,"Missing or empty newText parameter.");const{comment:v}=this.getComment(h);return v.text=y,this.updateLastUpdated(v,m),v}deleteComment(h,m){const{comment:y,index:v}=this.getComment(h);return this.thread.comments.splice(v,1),y.isDeleted=!0,this.updateLastUpdated(y,m),y}updateLastUpdated(h,m){const y=new Date;h.lastUpdatedSessionId=m,h.lastUpdatedDate=y,this.thread.lastUpdatedDate=y,this.thread.lastUpdatedSessionId=m}getComment(h){const m=this.thread.comments.findIndex(m=>m.commentId===h);if(-1===m)throw new A.ResponseError(P.ErrorCodes.InvalidParams,"Unknown comment ID parameter.");return{comment:this.thread.comments[m],index:m}}}m.HostCommentService=class HostCommentService{constructor(h){this.dependencies=h,this.commentThreadChanged=new w.EventEmitter,this.threadId=1,this.threads=new Map,this.disposables=[]}init(){return v(this,void 0,void 0,(function*(){k.commentsSupported()&&(yield C.RpcServiceHelper.registerHostRpcService(this,T.vsls.CommentService,this.dependencies,this.disposables))}))}dispose(){return v(this,void 0,void 0,(function*(){for(const h of this.disposables)h.dispose();this.threads.clear(),this.threadId=1,this.disposables=[]}))}updateThreadPosition(h,m,y){const{thread:v}=this.threads.get(h);if(!v)return;const{threadContext:C}=v;C.rightFileStart&&(C.rightFileStart=m,C.rightFileEnd=y)}createCommentThreadAsync(h){return v(this,void 0,void 0,(function*(){if(!h)throw new A.ResponseError(P.ErrorCodes.InvalidParams,"No comment thread parameter");if(!h.threadContext)throw new A.ResponseError(P.ErrorCodes.InvalidParams,"Thread context is missing on the comment thread parameter");if(!h.threadContext.filePath)throw new A.ResponseError(P.ErrorCodes.InvalidParams,"File path is missing on the thread context of the comment thread parameter");h.threadId=this.threadId++,h.publishedDate=new Date,h.lastUpdatedDate=h.publishedDate;const m=new ThreadInfo(h);return this.threads.set(h.threadId,m),this.commentThreadChanged.fire({newThread:h}),h}))}createCommentAsync(h){return v(this,void 0,void 0,(function*(){if(!h)throw new A.ResponseError(P.ErrorCodes.InvalidParams,"No comment parameter");return this.getThread(h.threadId).addComment(h),this.commentThreadChanged.fire({changedComment:h}),h}))}updateCommentAsync(h,m,y,C){return v(this,void 0,void 0,(function*(){const v=this.getThread(h).updateCommentText(m,y,C);return this.commentThreadChanged.fire({changedComment:v}),v}))}deleteCommentAsync(h,m,y){return v(this,void 0,void 0,(function*(){const v=this.getThread(h),C=v.deleteComment(m,y);return v.isEmpty&&this.threads.delete(h),this.commentThreadChanged.fire({changedComment:C}),C}))}getAllCommentThreadsAsync(){const h=[];for(const m of this.threads.values())h.push(m.thread);return Promise.resolve(h)}getCommentThreadPositionsAsync(h){let m=[];for(let y of h){let h=this.threads.get(y);if(!h)continue;let v=new T.vsls.CommentThreadLocation;v.threadId=h.thread.threadId,v.threadContext=h.thread.threadContext,m.push(v)}return Promise.resolve(m)}updateLikeAsync(h,m,y,v,C){return Promise.resolve()}get onCommentThreadChanged(){return this.commentThreadChanged.event}getThread(h){if(!h)throw new A.ResponseError(P.ErrorCodes.InvalidParams,"Comment thread ID is not defined.");const m=this.threads.get(h);if(!m)throw new A.ResponseError(P.ErrorCodes.InvalidParams,"Unknown comment thread.");return m}}},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0});const v=y(0),C=y(30),T=y(72),w=y(581),A=y(582),P=y(583);m.createConverter=function createConverter(h){const m=h||(h=>h.toString());function asUri(h){return m(h)}function asTextDocumentIdentifier(h){return{uri:m(h.uri)}}function asVersionedTextDocumentIdentifier(h){return{uri:m(h.uri),version:h.version}}function asTextDocumentSaveReason(h){switch(h){case v.TextDocumentSaveReason.Manual:return C.TextDocumentSaveReason.Manual;case v.TextDocumentSaveReason.AfterDelay:return C.TextDocumentSaveReason.AfterDelay;case v.TextDocumentSaveReason.FocusOut:return C.TextDocumentSaveReason.FocusOut}return C.TextDocumentSaveReason.Manual}function asTriggerKind(h){switch(h){case v.CompletionTriggerKind.TriggerCharacter:return C.CompletionTriggerKind.TriggerCharacter;case v.CompletionTriggerKind.TriggerForIncompleteCompletions:return C.CompletionTriggerKind.TriggerForIncompleteCompletions;default:return C.CompletionTriggerKind.Invoked}}function asWorkerPosition(h){return{line:h.line,character:h.character}}function asPosition(h){if(void 0!==h)return null===h?null:{line:h.line,character:h.character}}function asRange(h){return null==h?h:{start:asPosition(h.start),end:asPosition(h.end)}}function asDiagnosticSeverity(h){switch(h){case v.DiagnosticSeverity.Error:return C.DiagnosticSeverity.Error;case v.DiagnosticSeverity.Warning:return C.DiagnosticSeverity.Warning;case v.DiagnosticSeverity.Information:return C.DiagnosticSeverity.Information;case v.DiagnosticSeverity.Hint:return C.DiagnosticSeverity.Hint}}function asDiagnostic(h){let m=C.Diagnostic.create(asRange(h.range),h.message);return T.number(h.severity)&&(m.severity=asDiagnosticSeverity(h.severity)),(T.number(h.code)||T.string(h.code))&&(m.code=h.code),h.source&&(m.source=h.source),m}function asDiagnostics(h){return null==h?h:h.map(asDiagnostic)}function asTextEdit(h){return{range:asRange(h.range),newText:h.newText}}function asCommand(h){let m=C.Command.create(h.title,h.command);return h.arguments&&(m.arguments=h.arguments),m}return{asUri:asUri,asTextDocumentIdentifier:asTextDocumentIdentifier,asOpenTextDocumentParams:function asOpenTextDocumentParams(h){return{textDocument:{uri:m(h.uri),languageId:h.languageId,version:h.version,text:h.getText()}}},asChangeTextDocumentParams:function asChangeTextDocumentParams(h){if(function isTextDocument(h){let m=h;return!!m.uri&&!!m.version}(h)){return{textDocument:{uri:m(h.uri),version:h.version},contentChanges:[{text:h.getText()}]}}if(function isTextDocumentChangeEvent(h){let m=h;return!!m.document&&!!m.contentChanges}(h)){let y=h.document;return{textDocument:{uri:m(y.uri),version:y.version},contentChanges:h.contentChanges.map(h=>{let m=h.range;return{range:{start:{line:m.start.line,character:m.start.character},end:{line:m.end.line,character:m.end.character}},rangeLength:h.rangeLength,text:h.text}})}}throw Error("Unsupported text document change parameter")},asCloseTextDocumentParams:function asCloseTextDocumentParams(h){return{textDocument:asTextDocumentIdentifier(h)}},asSaveTextDocumentParams:function asSaveTextDocumentParams(h,m=!1){let y={textDocument:asVersionedTextDocumentIdentifier(h)};return m&&(y.text=h.getText()),y},asWillSaveTextDocumentParams:function asWillSaveTextDocumentParams(h){return{textDocument:asTextDocumentIdentifier(h.document),reason:asTextDocumentSaveReason(h.reason)}},asTextDocumentPositionParams:function asTextDocumentPositionParams(h,m){return{textDocument:asTextDocumentIdentifier(h),position:asWorkerPosition(m)}},asCompletionParams:function asCompletionParams(h,m,y){return{textDocument:asTextDocumentIdentifier(h),position:asWorkerPosition(m),context:{triggerKind:asTriggerKind(y.triggerKind),triggerCharacter:y.triggerCharacter}}},asWorkerPosition:asWorkerPosition,asRange:asRange,asPosition:asPosition,asDiagnosticSeverity:asDiagnosticSeverity,asDiagnostic:asDiagnostic,asDiagnostics:asDiagnostics,asCompletionItem:function asCompletionItem(h){let m={label:h.label},y=h instanceof w.default?h:void 0;return h.detail&&(m.detail=h.detail),h.documentation&&(y&&"$string"!==y.documentationFormat?m.documentation=function asDocumentation(h,m){switch(h){case"$string":return m;case C.MarkupKind.PlainText:return{kind:h,value:m};case C.MarkupKind.Markdown:return{kind:h,value:m.value};default:return`Unsupported Markup content received. Kind is: ${h}`}}(y.documentationFormat,h.documentation):m.documentation=h.documentation),h.filterText&&(m.filterText=h.filterText),function fillPrimaryInsertText(h,m){let y,T=C.InsertTextFormat.PlainText,w=void 0;m.textEdit?(y=m.textEdit.newText,w=asRange(m.textEdit.range)):m.insertText instanceof v.SnippetString?(T=C.InsertTextFormat.Snippet,y=m.insertText.value):y=m.insertText;m.range&&(w=asRange(m.range));h.insertTextFormat=T,m.fromEdit&&y&&w?h.textEdit={newText:y,range:w}:h.insertText=y}(m,h),T.number(h.kind)&&(m.kind=function asCompletionItemKind(h,m){return void 0!==m?m:h+1}(h.kind,y&&y.originalItemKind)),h.sortText&&(m.sortText=h.sortText),h.additionalTextEdits&&(m.additionalTextEdits=function asTextEdits(h){if(null==h)return h;return h.map(asTextEdit)}(h.additionalTextEdits)),h.commitCharacters&&(m.commitCharacters=h.commitCharacters.slice()),h.command&&(m.command=asCommand(h.command)),!0!==h.preselect&&!1!==h.preselect||(m.preselect=h.preselect),y&&(void 0!==y.data&&(m.data=y.data),!0!==y.deprecated&&!1!==y.deprecated||(m.deprecated=y.deprecated)),m},asTextEdit:asTextEdit,asReferenceParams:function asReferenceParams(h,m,y){return{textDocument:asTextDocumentIdentifier(h),position:asWorkerPosition(m),context:{includeDeclaration:y.includeDeclaration}}},asCodeActionContext:function asCodeActionContext(h){return null==h?h:C.CodeActionContext.create(asDiagnostics(h.diagnostics),T.string(h.only)?[h.only]:void 0)},asCommand:asCommand,asCodeLens:function asCodeLens(h){let m=C.CodeLens.create(asRange(h.range));return h.command&&(m.command=asCommand(h.command)),h instanceof A.default&&h.data&&(m.data=h.data),m},asFormattingOptions:function asFormattingOptions(h){return{tabSize:h.tabSize,insertSpaces:h.insertSpaces}},asDocumentSymbolParams:function asDocumentSymbolParams(h){return{textDocument:asTextDocumentIdentifier(h)}},asCodeLensParams:function asCodeLensParams(h){return{textDocument:asTextDocumentIdentifier(h)}},asDocumentLink:function asDocumentLink(h){let m=C.DocumentLink.create(asRange(h.range));h.target&&(m.target=asUri(h.target));let y=h instanceof P.default?h:void 0;return y&&y.data&&(m.data=y.data),m},asDocumentLinkParams:function asDocumentLinkParams(h){return{textDocument:asTextDocumentIdentifier(h)}}}}},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0});const v=y(0);class ProtocolCompletionItem extends v.CompletionItem{constructor(h){super(h)}}m.default=ProtocolCompletionItem},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0});const v=y(0);class ProtocolCodeLens extends v.CodeLens{constructor(h){super(h)}}m.default=ProtocolCodeLens},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0});const v=y(0);class ProtocolDocumentLink extends v.DocumentLink{constructor(h,m){super(h,m)}}m.default=ProtocolDocumentLink},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0});var v=y(1452);m.WorkspaceTaskClient=v.default;var C=y(585);m.registerTaskProvider=C.register;var T=y(1454);m.WorkspaceTaskService=T.WorkspaceTaskService;var w=y(1457);m.TaskOutputService=w.TaskOutputService},function(h,m,y){"use strict";var v=this&&this.__awaiter||function(h,m,y,v){return new(y||(y=Promise))((function(C,T){function fulfilled(h){try{step(v.next(h))}catch(h){T(h)}}function rejected(h){try{step(v.throw(h))}catch(h){T(h)}}function step(h){h.done?C(h.value):function adopt(h){return h instanceof y?h:new y((function(m){m(h)}))}(h.value).then(fulfilled,rejected)}step((v=v.apply(h,m||[])).next())}))};Object.defineProperty(m,"__esModule",{value:!0});const C=y(0),T=y(3),w=y(4);let A;function buildWorkspaceTask(h,y){const v=T.Settings.get(T.SettingKeys.diagnosticLogging);let A;switch(h.scope){case w.vsls.TaskScope.WorkspaceFolder:const m=parseInt(h.owningWorkspace,10);A=C.workspace.workspaceFolders[m];break;case w.vsls.TaskScope.Workspace:A=C.TaskScope.Workspace;break;case w.vsls.TaskScope.Global:A=C.TaskScope.Global;break;default:A=C.workspace.workspaceFolders[0]}const P={type:m.liveShareTaskType,taskUid:h.uniqueId};y&&(P.executionId=y.id);const k={onDidWrite:(new C.EventEmitter).event,open:()=>{},close:()=>{}},R=new C.CustomExecution(()=>Promise.resolve(k)),M=new C.Task(P,A,h.source&&"Workspace"!==h.source?`${h.source}:${h.name}`:h.name,"Shared",R);switch(h.kind){case"build":M.group=C.TaskGroup.Build;break;case"clean":M.group=C.TaskGroup.Clean;break;case"rebuild":M.group=C.TaskGroup.Rebuild;break;case"test":M.group=C.TaskGroup.Test}return M.presentationOptions={reveal:C.TaskRevealKind.Never,echo:v,focus:!1,panel:C.TaskPanelKind.Dedicated},M.isBackground=!0,M.problemMatchers=["$vsls"],M}m.liveShareTaskType="vsls",m.register=function register(){return C.tasks.registerTaskProvider(m.liveShareTaskType,{provideTasks:()=>function getWorkspaceTasks(){return v(this,void 0,void 0,(function*(){const h=[];if(!A)return h;const m=A.fetchTaskExecutions();if(m&&m.length)for(const[y,v]of m){const m=buildWorkspaceTask(y,v);h.push(m)}else{const m=yield A.fetchTasks();for(const y of m){const m=buildWorkspaceTask(y);h.push(m)}}return h}))}(),resolveTask:()=>{}})},m.configure=function configure(h,m){return A={fetchTasks:h,fetchTaskExecutions:m,dispose:()=>{A=void 0}},A}},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0});var v=y(1458);m.lspClientActivator=v.lspClientActivator;const C=y(587);m.lspClient=C;const T=y(589);m.lspServer=T;const w=y(324);m.commandHandler=w;var A=y(590);m.UniversalLanguageServerProvider=A.UniversalLanguageServerProvider;var P=y(196);m.LanguageServiceTelemetryEventNames=P.LanguageServiceTelemetryEventNames,m.LanuageServiceTelemetryPropertyNames=P.LanuageServiceTelemetryPropertyNames;var k=y(588);m.LSPClientStreamProvider=k.LSPClientStreamProvider},function(h,m,y){"use strict";var v=this&&this.__awaiter||function(h,m,y,v){return new(y||(y=Promise))((function(C,T){function fulfilled(h){try{step(v.next(h))}catch(h){T(h)}}function rejected(h){try{step(v.throw(h))}catch(h){T(h)}}function step(h){h.done?C(h.value):function adopt(h){return h instanceof y?h:new y((function(m){m(h)}))}(h.value).then(fulfilled,rejected)}step((v=v.apply(h,m||[])).next())}))};Object.defineProperty(m,"__esModule",{value:!0});const C=y(0),T=y(6),w=y(320),A=y(323),P=y(30),k=y(3),R=y(4),M=y(5),N=y(8),D=y(196),I=y(324),x=y(588),O=y(589),L=y(16);let U;function activateLspClient(h,m,y,B){return v(this,void 0,void 0,(function*(){const W=[],addDisposable=m=>{h.subscriptions.push(m),W.push(m)},q={name:"languageServerProvider-"+y,methods:R.vsls.LanguageServerProvider.methods,events:R.vsls.LanguageServerProvider.events};let Y=L.RpcProxy.create(q,m,M.traceSource.withName(R.vsls.TraceSources.ClientLSP)),V=new x.LSPClientStreamProvider(Y,U);if("any"===y){const h=yield Y.requestAsync({method:P.InitializeRequest.type.method,params:{}},null);U=h.capabilities}const $=yield Y.getMetadataAsync(),z=k.Settings.scheme;let G=[];$.documentFilters?G=$.documentFilters.map(h=>({schemes:z,language:h.language?h.language:void 0,pattern:h.pattern?h.pattern:void 0})):G.push({scheme:z}),(void 0===B||B)&&G.forEach(h=>h.exclusive=!0);let J={documentSelector:G,revealOutputChannelOn:w.RevealOutputChannelOn.Never,initializationFailedHandler:h=>(X.error("Server initialization failed.",h),N.Telemetry.sendFault(D.LanguageServiceTelemetryEventNames.LSPSERVER_INIT_FAULT,N.FaultType.Unknown,`Server ${y} initialization failed - ${h}`),!1),middleware:{}},X=new w.LanguageClient("LiveShareGuest-"+y,"Guest-"+y,()=>Promise.resolve({reader:new T.StreamMessageReader(V.ReadStream),writer:new T.StreamMessageWriter(V.WriteStream)}),J),Z=O.REMOTE_COMMAND_NAME,ee=A.createConverter();if("any"===y)addDisposable(X.start()),C.workspace.onDidOpenTextDocument(h=>v(this,void 0,void 0,(function*(){yield populateDiagnostics(X,h,ee)})),void 0,h.subscriptions);else{Z=Z.concat(".",y);let m=!1;W.push(C.workspace.onDidOpenTextDocument(h=>v(this,void 0,void 0,(function*(){return(h.languageId===y||G.some(m=>m.language===h.languageId))&&(m||(m=!0,addDisposable(X.start())),yield populateDiagnostics(X,h,ee)),!0})),void 0,h.subscriptions))}let te=k.ExtensionUtil.registerCommand(Z,h=>v(this,void 0,void 0,(function*(){yield I.handleLiveShareRemoteCommand(h,X,ee)})));return addDisposable(te),C.Disposable.from(...W)}))}function populateDiagnostics(h,m,y){return v(this,void 0,void 0,(function*(){if(m.uri.scheme!==k.Settings.scheme)return;yield h.onReady();let v=yield h.sendRequest("liveshare/diagnosticsDocument",{textDocument:{uri:m.uri.toString()}});v&&h.diagnostics&&h.diagnostics.set(m.uri,y.asDiagnostics(v))}))}m.activateAsync=function activateAsync(h,m,y,T){return v(this,void 0,void 0,(function*(){const v=y.filter(h=>h.startsWith("languageServerProvider-")).map(h=>h.substring("languageServerProvider-".length)),w=[],A=v.indexOf("any");A>=0&&(w.push(yield activateLspClient(h,m,"any",T)),v.splice(A,1));for(const y of v)w.push(yield activateLspClient(h,m,y,T));return C.Disposable.from(...w)}))}},function(h,m,y){"use strict";var v=this&&this.__awaiter||function(h,m,y,v){return new(y||(y=Promise))((function(C,T){function fulfilled(h){try{step(v.next(h))}catch(h){T(h)}}function rejected(h){try{step(v.throw(h))}catch(h){T(h)}}function step(h){h.done?C(h.value):function adopt(h){return h instanceof y?h:new y((function(m){m(h)}))}(h.value).then(fulfilled,rejected)}step((v=v.apply(h,m||[])).next())}))};Object.defineProperty(m,"__esModule",{value:!0});const C=y(19),T=y(30),w=y(6),A=y(16),P=y(3),k=y(4),R=y(5);class LSPClientStreamProvider{constructor(h,m=null){this.languageServerProviderClient=h,this.trace=R.traceSource.withName(k.vsls.TraceSources.ClientLSP),this.readStream=new C.Readable({read:()=>{}}),this.readStreamWriter=new C.Writable({write:(h,m,y)=>{this.readStream.push(h,m),y()}}),this.writeStreamReader=new C.Readable({read:()=>{}}),this.writeStream=new C.Writable({write:(h,m,y)=>{this.writeStreamReader.push(h,m),y()}});let y={info:this.trace.info,warn:this.trace.warning,error:this.trace.error,log:this.trace.verbose},M=w.createMessageConnection(new w.StreamMessageReader(this.writeStreamReader),new w.StreamMessageWriter(this.readStreamWriter),y);M.onRequest((y,C,w)=>v(this,void 0,void 0,(function*(){let v,k={highestLocalTextChange:P.SessionContext.coeditingClient.currentHighestLocalTextChange,serverVersion:P.SessionContext.coeditingClient.currentServerVersion,clientId:P.SessionContext.coeditingClient.clientID};LSPClientStreamProvider.modifyRequestParams(y,C);try{v=yield h.requestAsync({method:y,params:C},k,w)}catch(h){throw h.code,A.RpcErrorCodes.RequestCancelled,h}switch(y){case T.InitializeRequest.type.method:const h=v;m&&h.capabilities&&LSPClientStreamProvider.modifyServerCapabilities(h,m)}return v}))),M.onNotification((m,y,v)=>A.RpcProxy.notifyAsync(h,"notify",{method:m,params:y})),h.onNotified(h=>{const m=h.body;M.sendNotification(m.method,m.params)}),M.listen()}static modifyRequestParams(h,m){if(h===T.InitializeRequest.type.method){const h=m;if(h.capabilities&&h.capabilities.textDocument&&h.capabilities.textDocument.codeAction&&h.capabilities.textDocument.codeAction.codeActionLiteralSupport&&h.capabilities.textDocument.codeAction.codeActionLiteralSupport.codeActionKind&&h.capabilities.textDocument.codeAction.codeActionLiteralSupport.codeActionKind.valueSet){const m=h.capabilities.textDocument.codeAction.codeActionLiteralSupport.codeActionKind.valueSet,y=m.indexOf("");y>=0&&m.splice(y,1)}}}static modifyServerCapabilities(h,m){h.capabilities.codeActionProvider=!m.codeActionProvider&&h.capabilities.codeActionProvider,h.capabilities.colorProvider=!m.colorProvider&&h.capabilities.colorProvider,h.capabilities.declarationProvider=!m.declarationProvider&&h.capabilities.declarationProvider,h.capabilities.definitionProvider=!m.definitionProvider&&h.capabilities.definitionProvider,h.capabilities.documentFormattingProvider=!m.documentFormattingProvider&&h.capabilities.documentFormattingProvider,h.capabilities.documentHighlightProvider=!m.documentHighlightProvider&&h.capabilities.documentHighlightProvider,h.capabilities.documentRangeFormattingProvider=!m.documentRangeFormattingProvider&&h.capabilities.documentRangeFormattingProvider,h.capabilities.documentSymbolProvider=!m.documentSymbolProvider&&h.capabilities.documentSymbolProvider,h.capabilities.foldingRangeProvider=!m.foldingRangeProvider&&h.capabilities.foldingRangeProvider,h.capabilities.hoverProvider=!m.hoverProvider&&h.capabilities.hoverProvider,h.capabilities.implementationProvider=!m.implementationProvider&&h.capabilities.implementationProvider,h.capabilities.referencesProvider=!m.referencesProvider&&h.capabilities.referencesProvider,h.capabilities.renameProvider=!m.renameProvider&&h.capabilities.renameProvider,h.capabilities.typeDefinitionProvider=!m.typeDefinitionProvider&&h.capabilities.typeDefinitionProvider,h.capabilities.workspaceSymbolProvider=!m.workspaceSymbolProvider&&h.capabilities.workspaceSymbolProvider}get ReadStream(){return this.readStream}get WriteStream(){return this.writeStream}}m.LSPClientStreamProvider=LSPClientStreamProvider},function(h,m,y){"use strict";var v=this&&this.__awaiter||function(h,m,y,v){return new(y||(y=Promise))((function(C,T){function fulfilled(h){try{step(v.next(h))}catch(h){T(h)}}function rejected(h){try{step(v.throw(h))}catch(h){T(h)}}function step(h){h.done?C(h.value):function adopt(h){return h instanceof y?h:new y((function(m){m(h)}))}(h.value).then(fulfilled,rejected)}step((v=v.apply(h,m||[])).next())}))};Object.defineProperty(m,"__esModule",{value:!0});const C=y(0),T=y(324),w=y(580),A=y(323),P=y(30),k=y(3),R=y(8),M=y(1461),N=y(590),D=y(196);let I;m.REMOTE_COMMAND_NAME="_liveshare.remotecommand",m.CODE_ACTION_ITEM_RESOLVE_COUNT=Number.MAX_VALUE;const x=new R.SendOnceFilter(D.LanguageServiceTelemetryEventNames.GET_DIAGNOSTICS_FAULT);function tryRunCommand(h,m){return v(this,void 0,void 0,(function*(){return k.Settings.get(k.SettingKeys.allowGuestCommandControl)||T.isSafeCommand(h.command)?(yield C.commands.executeCommand(h.command,...m),!0):"_typescript.applyCodeActionCommand"===h.command}))}m.activateAsync=function activateAsync(h,m,y,C,T){return v(this,void 0,void 0,(function*(){R.Telemetry.addFilter(x),I=new N.UniversalLanguageServerProvider(h,C,m,T),yield I.initAsync(),setupHandlers(I,m,y)}))},m.dispose=function dispose(){return v(this,void 0,void 0,(function*(){x.reset(),I&&(yield I.dispose())}))};const O={name:k.WellKnownRestrictedOperations.CodeAction};function setupHandlers(h,y,k){let N=h.createProtocolConnection(),I=A.createConverter(h=>y.protocol2CodeUriConverter(h)),x=w.createConverter(h=>y.code2ProtocolUriConverter(h)),L=M.createConverterExtension(x),U=!1;try{C.languages.onDidChangeDiagnostics(h=>{for(let m of h.uris)try{let h=C.languages.getDiagnostics(m),y={uri:x.asUri(m),diagnostics:x.asDiagnostics(h)};N.sendNotification(P.PublishDiagnosticsNotification.type.method,y)}catch(h){R.Telemetry.sendFault(D.LanguageServiceTelemetryEventNames.GET_DIAGNOSTICS_FAULT,R.FaultType.NonBlockingFault,"Unable to get diagnostics",h)}})}catch(h){}function asDefinitionResult(h){return Array.isArray(h)&&h.length>0&&void 0!==h[0].targetUri?U?L.asDefinitionLinkResult(h):L.asDefinitionResultAlternate(h):L.asDefinitionResult(h)}N.onRequest(P.InitializeRequest.type,h=>(h.capabilities&&h.capabilities.textDocument.definition.linkSupport&&(U=!0),{capabilities:{hoverProvider:!0,definitionProvider:!0,typeDefinitionProvider:!0,referencesProvider:!0,implementationProvider:!0,completionProvider:{triggerCharacters:["."]},signatureHelpProvider:{triggerCharacters:["(",","]},documentSymbolProvider:!0,workspaceSymbolProvider:!0,codeActionProvider:!0,documentFormattingProvider:!0,documentRangeFormattingProvider:!0,documentOnTypeFormattingProvider:{firstTriggerCharacter:"}",moreTriggerCharacter:[";","\n"]},renameProvider:!0,documentLinkProvider:{resolveProvider:!1},colorProvider:!0,executeCommandProvider:{commands:[]},codeLensProvider:{resolveProvider:!0}}})),N.onCustomRequest("liveshare/externalDocument",(h,m)=>v(this,void 0,void 0,(function*(){const m=h.textDocument.uri;return yield function getExternalDocumentAsync(h,m,y){return v(this,void 0,void 0,(function*(){let y=h.protocol2CodeUriConverter(m);return(yield C.workspace.openTextDocument(y)).getText()}))}(y,m)}))),N.onCustomRequest("liveshare/load",h=>v(this,void 0,void 0,(function*(){return null}))),N.onCustomRequest("liveshare/diagnosticsDocument",h=>v(this,void 0,void 0,(function*(){let m=h.textDocument.uri;return x.asDiagnostics(C.languages.getDiagnostics(I.asUri(m)))}))),N.onRequest(P.HoverRequest.type,h=>v(this,void 0,void 0,(function*(){let m=I.asUri(h.textDocument.uri),y=I.asPosition(h.position),v=yield C.commands.executeCommand("vscode.executeHoverProvider",m,y);if(!v||0===v.length)return null;let T=v.map(h=>h.contents).reduce((h,m,y,v)=>h.concat(m)),w=new C.Hover(T,v[0].range);return L.asHover(w)}))),N.onRequest(P.DefinitionRequest.type,h=>v(this,void 0,void 0,(function*(){let m=I.asUri(h.textDocument.uri),y=I.asPosition(h.position);return asDefinitionResult(yield C.commands.executeCommand("vscode.executeDefinitionProvider",m,y))}))),N.onRequest(P.TypeDefinitionRequest.type,h=>v(this,void 0,void 0,(function*(){let m,y=I.asUri(h.textDocument.uri),v=I.asPosition(h.position);try{m=yield C.commands.executeCommand("vscode.executeTypeDefinitionProvider",y,v)}catch(h){}return m?m.map(h=>L.asLocation(h)):null}))),N.onRequest(P.ReferencesRequest.type,h=>v(this,void 0,void 0,(function*(){let m=I.asUri(h.textDocument.uri),y=I.asPosition(h.position),v=yield C.commands.executeCommand("vscode.executeReferenceProvider",m,y);return L.asReferences(v)}))),N.onRequest(P.ImplementationRequest.type,h=>v(this,void 0,void 0,(function*(){let m=I.asUri(h.textDocument.uri),y=I.asPosition(h.position);return asDefinitionResult(yield C.commands.executeCommand("vscode.executeImplementationProvider",m,y))}))),N.onRequest(P.DocumentHighlightRequest.type,h=>v(this,void 0,void 0,(function*(){let m=I.asUri(h.textDocument.uri),y=I.asPosition(h.position),v=yield C.commands.executeCommand("vscode.executeDocumentHighlights",m,y);return L.asDocumentHighlights(v)}))),N.onRequest(P.CompletionRequest.type,h=>v(this,void 0,void 0,(function*(){let m=I.asUri(h.textDocument.uri),y=I.asPosition(h.position),v=yield C.commands.executeCommand("vscode.executeCompletionItemProvider",m,y,h.context?h.context.triggerCharacter:void 0);if(v)return v.items.map(h=>(h.fromEdit=!0,h.range&&h.range.replacing&&(h.range=h.range.replacing),x.asCompletionItem(h)))}))),N.onRequest(P.SignatureHelpRequest.type,h=>v(this,void 0,void 0,(function*(){let m=I.asUri(h.textDocument.uri),y=I.asPosition(h.position),v=yield C.commands.executeCommand("vscode.executeSignatureHelpProvider",m,y);return L.asSignatureHelp(v)}))),N.onRequest(P.DocumentSymbolRequest.type,h=>v(this,void 0,void 0,(function*(){let m=I.asUri(h.textDocument.uri),y=yield C.commands.executeCommand("vscode.executeDocumentSymbolProvider",m);return L.asSymbolInformations(y,m)}))),N.onRequest(P.WorkspaceSymbolRequest.type,h=>v(this,void 0,void 0,(function*(){let m=yield C.commands.executeCommand("vscode.executeWorkspaceSymbolProvider",h.query);return L.asSymbolInformations(m,void 0)}))),N.onRequest(P.CodeActionRequest.type,h=>v(this,void 0,void 0,(function*(){if(k&&!(yield k().canPerformOperation(h,O)))return;let y=I.asUri(h.textDocument.uri),v=I.asRange(h.range),w=yield C.commands.executeCommand("vscode.executeCodeActionProvider",y,v,void 0,m.CODE_ACTION_ITEM_RESOLVE_COUNT);return w?w.map(h=>{if("string"==typeof h.command)return T.wrapCodeActionCommand(h,y,v,x,L);{const m=h;return m.command=m.command?T.wrapCodeActionCommand(m.command,y,v,x,L):m.command,L.asCodeAction(m)}}):void 0}))),N.onRequest(P.ExecuteCommandRequest.type,h=>v(this,void 0,void 0,(function*(){if(k&&!(yield k().canPerformOperation(h,O)))return;let y,w=h.arguments||[];return h.command.startsWith(m.REMOTE_COMMAND_NAME)?(y=w[0],w=y.arguments):y=h,w.length>0&&w[0]===T.REMOTE_CODE_ACTION_NAME?yield function runCodeActionCommand(h,y,w){return v(this,void 0,void 0,(function*(){let v=yield C.commands.executeCommand("vscode.executeCodeActionProvider",h,y,void 0,m.CODE_ACTION_ITEM_RESOLVE_COUNT);if(v)for(let h of v){const m="string"==typeof h.command?h:h.command;if(m&&T.hashCommand(m)===w)return yield tryRunCommand(m,m.arguments)}}))}(I.asUri(w[2]),I.asRange(w[3]),w[1]):w.length>0&&w[0]===T.REMOTE_CODE_LENS_NAME?yield function runCodeLensCommand(h,m){return v(this,void 0,void 0,(function*(){try{let y=yield C.commands.executeCommand("vscode.executeCodeLensProvider",h,Number.MAX_VALUE);if(y)for(let h of y)if(h.command&&T.hashCommand(h.command)===m)return yield tryRunCommand(h.command,h.command.arguments)}catch(h){}}))}(I.asUri(w[2]),w[1]):yield tryRunCommand(y,w)}))),N.onRequest(P.DocumentFormattingRequest.type,h=>v(this,void 0,void 0,(function*(){let m=I.asUri(h.textDocument.uri),y=yield C.commands.executeCommand("vscode.executeFormatDocumentProvider",m,h.options);if(y)return y.map(h=>x.asTextEdit(h))}))),N.onRequest(P.DocumentRangeFormattingRequest.type,h=>v(this,void 0,void 0,(function*(){let m=I.asUri(h.textDocument.uri),y=I.asRange(h.range),v=yield C.commands.executeCommand("vscode.executeFormatRangeProvider",m,y,h.options);if(v)return v.map(h=>x.asTextEdit(h))}))),N.onRequest(P.DocumentOnTypeFormattingRequest.type,h=>v(this,void 0,void 0,(function*(){let m=I.asUri(h.textDocument.uri),y=I.asPosition(h.position),v=yield C.commands.executeCommand("vscode.executeFormatOnTypeProvider",m,y,h.ch,h.options);if(v)return v.map(h=>x.asTextEdit(h))}))),N.onRequest(P.RenameRequest.type,h=>v(this,void 0,void 0,(function*(){let m=I.asUri(h.textDocument.uri),y=I.asPosition(h.position),v=yield C.commands.executeCommand("vscode.executeDocumentRenameProvider",m,y,h.newName);return L.asWorkspaceEdit(v)}))),N.onRequest(P.DocumentLinkRequest.type,h=>v(this,void 0,void 0,(function*(){let m=I.asUri(h.textDocument.uri),y=yield C.commands.executeCommand("vscode.executeLinkProvider",m);if(y)return y.map(h=>x.asDocumentLink(h))}))),N.onRequest(P.DocumentColorRequest.type,h=>v(this,void 0,void 0,(function*(){let m,y=I.asUri(h.textDocument.uri);try{m=yield C.commands.executeCommand("vscode.executeDocumentColorProvider",y)}catch(h){}return m?m.map(h=>L.asColorInformation(h)):m}))),N.onRequest(P.ColorPresentationRequest.type,h=>v(this,void 0,void 0,(function*(){let m,y={uri:I.asUri(h.textDocument.uri),range:I.asRange(h.range)},v=new C.Color(h.color.red,h.color.green,h.color.blue,h.color.alpha);try{m=yield C.commands.executeCommand("vscode.executeColorPresentationProvider",v,y)}catch(h){}return m?m.map(h=>L.asColorPresentation(h)):m}))),N.onRequest(P.CodeLensRequest.type,h=>v(this,void 0,void 0,(function*(){let m,y=I.asUri(h.textDocument.uri);try{m=yield C.commands.executeCommand("vscode.executeCodeLensProvider",y,Number.MAX_VALUE)}catch(h){}return m?m.map(h=>(h.command&&(h.command=T.wrapCodeLensCommand(h.command,y,x,L)),x.asCodeLens(h))):m})))}m.setupHandlers=setupHandlers},function(h,m,y){"use strict";var v=this&&this.__awaiter||function(h,m,y,v){return new(y||(y=Promise))((function(C,T){function fulfilled(h){try{step(v.next(h))}catch(h){T(h)}}function rejected(h){try{step(v.throw(h))}catch(h){T(h)}}function step(h){h.done?C(h.value):function adopt(h){return h instanceof y?h:new y((function(m){m(h)}))}(h.value).then(fulfilled,rejected)}step((v=v.apply(h,m||[])).next())}))};Object.defineProperty(m,"__esModule",{value:!0});const C=y(30),T=y(196),w=y(4),A=y(5);class UniversalLanguageServerProvider{constructor(h,m,y,v){this.workspaceService=h,this.sessionContext=m,this.pathManager=y,this.rpcServiceHandler=v,this.requestHandlers=new Map,this.notificationHandlers=new Map,this.servicedRequests=0,this.rejectedRequests=0,this.unacknowledgedHostChangesRejects=0,this.rejectedRequestsDetails={},this.requestsThatDontNeedValidation=[C.InitializeRequest.type.method,C.ShutdownRequest.type.method,"liveshare/externalDocument","liveshare/load","liveshare/diagnosticsDocument"],this.trace=A.traceSource.withName(w.vsls.TraceSources.ClientLSP)}initAsync(){return v(this,void 0,void 0,(function*(){yield this.workspaceService.registerServicesAsync([UniversalLanguageServerProvider.SERVICE_NAME],w.vsls.CollectionChangeType.Add),this.rpcServiceHandler.addRequestMethod(UniversalLanguageServerProvider.SERVICE_NAME+".getMetadata",h=>({isLanguageClientProvider:!0,contentTypes:["any"]})),this.rpcServiceHandler.addRequestMethodWithContext(UniversalLanguageServerProvider.SERVICE_NAME+".request",(h,m,y,C)=>v(this,void 0,void 0,(function*(){return yield this.requestAsync(h,m,y,C)}))),this.notifyCookie=this.rpcServiceHandler.addNotificationHandler(UniversalLanguageServerProvider.SERVICE_NAME+".notify",(h,m)=>v(this,void 0,void 0,(function*(){yield this.notifyAsync(h,m)}))),this.rpcServiceHandler.addRequestMethod(UniversalLanguageServerProvider.SERVICE_NAME+".load",h=>Promise.resolve())}))}dispose(){return v(this,void 0,void 0,(function*(){T.summarizeLsRequests(this.servicedRequests,this.rejectedRequests,this.unacknowledgedHostChangesRejects,this.rejectedRequestsDetails),yield this.workspaceService.registerServicesAsync([UniversalLanguageServerProvider.SERVICE_NAME],w.vsls.CollectionChangeType.Remove),this.rpcServiceHandler.removeRequestMethod(UniversalLanguageServerProvider.SERVICE_NAME+".request"),this.rpcServiceHandler.removeNotificationHandler(UniversalLanguageServerProvider.SERVICE_NAME+".notify",this.notifyCookie),this.rpcServiceHandler.removeRequestMethod(UniversalLanguageServerProvider.SERVICE_NAME+".load"),this.pathManager.dispose()}))}createProtocolConnection(){return{onRequest:(h,m)=>{this.requestHandlers.set(h.method,m)},onCustomRequest:(h,m)=>{this.requestHandlers.set(h,m)},onNotification:(h,m)=>{this.notificationHandlers.set(h.method,m)},sendNotification:(h,m)=>{const y={method:h,params:m};this.rpcServiceHandler.sendNotification(this.trace,UniversalLanguageServerProvider.SERVICE_NAME+".notified",{body:y})}}}requestAsync(h,m,y,C){return v(this,void 0,void 0,(function*(){const v=h.method,T="textDocument/documentSymbol"===v?[]:null;if(m&&this.requestsThatDontNeedValidation.indexOf(v)<0){if(!this.canServiceRequest(m))return this.trace.info(`Rejected ${h.method} request`),this.rejectedRequests++,this.rejectedRequestsDetails[v]=this.rejectedRequestsDetails[v]?this.rejectedRequestsDetails[v]+1:1,T;this.servicedRequests++}let w=h.params;return this.requestHandlers.has(v)?(y&&(null==w?w={context:y}:"object"==typeof w&&(w.context=y)),yield this.requestHandlers.get(v)(w,C)):T}))}canServiceRequest(h){if(this.sessionContext.coeditingClient.hasUnacknowledgedTextChanges)return this.unacknowledgedHostChangesRejects++,!1;let m=this.sessionContext.coeditingClient.textChangeHistory,y=m.length-1;if(y<0)return!0;if(-1===h.serverVersion)return!0;for(;y>=0&&m[y].changeServerVersion!==h.serverVersion;y--);if(y<0)return!1;for(y++;y<m.length;y++)if(m[y].clientId!==h.clientId)return!1;return!0}notifyAsync(h,m){return v(this,void 0,void 0,(function*(){this.notificationHandlers.has(h.method)&&(yield this.notificationHandlers.get(h.method)(h.params))}))}}m.UniversalLanguageServerProvider=UniversalLanguageServerProvider,UniversalLanguageServerProvider.SERVICE_NAME="languageServerProvider-any"},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0});m.isPromiseCanceledError=function isPromiseCanceledError(h){return h instanceof Error&&"Canceled"===h.name&&"Canceled"===h.message},m.canceled=function canceled(){let h=new Error("Canceled");return h.name=h.message,h}},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0});const v=y(0),C=y(319),T=y(292),w=y(110),A=y(3),P=y(5);m.default=async function default_1(h){const m=await T.CommunicationsManager.isChatEnabled(),y=await T.CommunicationsManager.isAudioEnabled(),registerProviders=(k,R)=>{const M=[],addIfDisposable=h=>{h&&M.push(h)},N=new A.ParticipantsTreeDataProvider(A.SessionContext,h.accessControlManager,w.ContactManager,R);if(M.push(N.registerCoEditing(A.SessionContext.coeditingClient)),addIfDisposable(k.registerTreeDataProvider(N)),A.sessionStateTracker.State===A.SessionState.Joined||A.ExtensionUtil.isNode()){const m=new A.TerminalsTreeDataProvider(h.sessionContext(),R,P.traceSource.withName("TerminalsTreeDataProvider"));M.push(m.registerTerminalService(h.terminalService())),addIfDisposable(k.registerTreeDataProvider(m))}if(A.ExtensionUtil.isNode()){const m=new A.ServerSharingTreeDataProvider(A.SessionContext,R,P.traceSource);M.push(m.registerServices(h.serverSharingService(),h.portForwardingService())),M.push(k.registerTreeDataProvider(m))}const D=new C.CommentsTreeDataProvider;if(M.push(D.registerService(C.reviewsDependencies.commentManager())),addIfDisposable(k.registerTreeDataProvider(D)),m){const h=new T.ChatTreeDataProvider;addIfDisposable(k.registerTreeDataProvider(h))}if(y){const m=new T.AudioTreeDataProvider(h.authService(),h.accessControlManager);addIfDisposable(k.registerTreeDataProvider(m))}return v.Disposable.from(...M)};return v.Disposable.from(registerProviders(h.activityBarProvider,!1),registerProviders(h.fileTreeExplorerProvider,!0))}},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0});const v=y(3),C=y(5),T=y(2),w=y(575),A=T.once(()=>w.getAppFilePath(w.liveshareHubAppFile,v.constants.LIVESHARE_EXTENSION_ID));m.hubRpcClient=T.once(async()=>await w.launchOrGetAgentRpcClient(A(),v.Settings.get("hubPipe")||w.getAgentPipeName(A(),"lh"),v.constants.LIVESHARE_EXTENSION_ID,"LiveshareHub_logs",C.traceSource,["--traceFilters","*:ssh=Off"]))},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0});const v=y(0),C=y(3),T=y(5),w=y(39),A=y(200),P=y(1470);function createLiveshareConnectionOptionsWithInfo(h,m){return{workspaceId:h,liveShareEndpoint:"",token:"",connectionInfo:m,clientVersionInfo:{extensionVersion:P.version,extensionName:P.name,applicationName:"VSCode",applicationVersion:v.version},workspaceJoinInfo:{anonymousUserName:C.Settings.get(C.SettingKeys.anonymousUserName)},clientCapabilities:{extensionReadOnlySupport:!0,clientReadOnlySupport:!0,isNonInteractive:!1}}}m.createLiveshareConnectionOptions=async function createLiveshareConnectionOptions(h,m,y){const v=C.Settings.get(C.SettingKeys.serviceUri),P=(await m.authService().getCurrentAuthenticatedUserAsync()).accessToken,k=new w.WorkspaceApi(v,()=>P,T.traceSource.withName("WorkspaceApi")),R=await(async()=>{let v;try{v=await k.getWorkspaceAccess(h)}catch(h){if(h instanceof A.HttpClientAuthenticationError){const m=await h.response.text();let y=` ${m} failed with status: ${h.response.status}`;if(403===h.response.status&&m.includes("Anonymous")){const h=T.CommandErrorCode.FORBIDDEN_ANONYMOUS,m=new T.CommandError({message:y,code:h});throw m.isSuppressUserNotification=!0,m}}throw h}if(!1===v.isHostConnected&&(T.traceSource.verbose("Waiting for host..."),!await C.JoinCommandUtilities.showWaitingForHostProgressBar(m,async()=>(v=await k.getWorkspaceAccess(h),v),15,y)))throw new Error("time out waiting for host");return v})();return createLiveshareConnectionOptionsWithInfo(h,R)},m.createLiveshareConnectionOptionsWithInfo=createLiveshareConnectionOptionsWithInfo},function(h,m,y){"use strict";function __export(h){for(var y in h)m.hasOwnProperty(y)||(m[y]=h[y])}Object.defineProperty(m,"__esModule",{value:!0}),__export(y(596));var v=y(327);m.TerminalControllerBase=v.TerminalControllerBase;var C=y(597);m.GuestTerminalHandler=C.GuestTerminalHandler;var T=y(1471);m.registerGuestTerminalHandler=T.registerGuestTerminalHandler,__export(y(1473)),__export(y(1474));const w=y(198);m.tt=w},function(h,m,y){"use strict";var v=this&&this.__decorate||function(h,m,y,v){var C,T=arguments.length,w=T<3?m:null===v?v=Object.getOwnPropertyDescriptor(m,y):v;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)w=Reflect.decorate(h,m,y,v);else for(var A=h.length-1;A>=0;A--)(C=h[A])&&(w=(T<3?C(w):T>3?C(m,y,w):C(m,y))||w);return T>3&&w&&Object.defineProperty(m,y,w),w},C=this&&this.__metadata||function(h,m){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(h,m)},T=this&&this.__awaiter||function(h,m,y,v){return new(y||(y=Promise))((function(C,T){function fulfilled(h){try{step(v.next(h))}catch(h){T(h)}}function rejected(h){try{step(v.throw(h))}catch(h){T(h)}}function step(h){h.done?C(h.value):function adopt(h){return h instanceof y?h:new y((function(m){m(h)}))}(h.value).then(fulfilled,rejected)}step((v=v.apply(h,m||[])).next())}))};Object.defineProperty(m,"__esModule",{value:!0});const w=y(0),A=y(4),P=(y(198),y(5)),k=y(327),R=y(3),M=y(8);m.guestTerminalControllerFactory=h=>{const{controllerDecorator:m,telemetryMethodDecorator:y,errorNotificationMethodDecorator:N}=h.methodDecorators();let D=class GuestTerminalController extends k.TerminalControllerBase{constructor(h){super(h.terminalService,P.traceSource.withName("GuestTerminalController")),this.dependencies=h,this.terminalsAwaitingWriteAccess=new Set,this.terminalsWithRejectedWriteAccess=new Set,this.isUserAskedToSignIn=!1}get accessControlManager(){return this.dependencies.accessControlManager}activate(){const h=Object.create(null,{activate:{get:()=>super.activate}});return T(this,void 0,void 0,(function*(){if(this.isActivated)return!0;yield h.activate.call(this),R.ControllerHelper.register(this,this.sessionSubscriptions),this.sessionSubscriptions.push(this.terminalService.onTerminalStarted(this.onHostTerminalStarted,this),this.terminalService.onTerminalStopped(this.onHostTerminalStopped,this),this.accessControlManager().onDidRejectOperation(h=>T(this,void 0,void 0,(function*(){if(h.operation.name===R.WellKnownRestrictedOperations.WriteToSharedTerminal){const m=h.operation;if(h.isReadOnlySession)return;h.isCurrentUserAnonymous?yield this.terminalWriteAccessRejectedAnonymous(m.terminalId,m.isEscapeSequence):yield this.terminalWriteAccessRejected(m.terminalId,m.isEscapeSequence)}}))),this.accessControlManager().onDidChangeOperationAccess(h=>T(this,void 0,void 0,(function*(){if(h.operation.name===R.WellKnownRestrictedOperations.WriteToSharedTerminal){const m=h.operation;yield this.terminalWriteAccessChanged(m.terminalId,h.access)}})))),this.deferredWork=this.deferredWork.then(()=>this.openSharedTerminalsOnJoin()).catch(h=>{this.trace.error(h.message)})}))}terminalWriteAccessRejectedAnonymous(h,m){return T(this,void 0,void 0,(function*(){(yield this.terminalService.getRunningTerminalsAsync()).find(m=>m.id===h)&&!this.isUserAskedToSignIn&&(this.isUserAskedToSignIn=!0,yield R.askToSignInAndReload(R.localize("notification.CannotEditTheTerminal")),this.isUserAskedToSignIn=!1)}))}terminalWriteAccessRejected(h,m){return T(this,void 0,void 0,(function*(){if(R.sessionStateTracker.State!==R.SessionState.Joined||this.terminalsAwaitingWriteAccess.has(h)||m)return;if(this.terminalsAwaitingWriteAccess.add(h),!(yield this.terminalService.getRunningTerminalsAsync()).find(m=>m.id===h))return void this.terminalsAwaitingWriteAccess.delete(h);this.terminalsWithRejectedWriteAccess.delete(h);const y=yield w.window.showInformationMessage("Cannot edit a read-only terminal.",{modal:!1},"Request read/write access");R.sessionStateTracker.State===R.SessionState.Joined?"Request read/write access"===y&&(yield this.accessControlManager().requestOperationAccess({name:R.WellKnownRestrictedOperations.WriteToSharedTerminal,sessionId:R.SessionContext.coeditingClient.clientID,terminalId:h})):this.terminalsAwaitingWriteAccess.delete(h)}))}terminalWriteAccessChanged(h,m){return T(this,void 0,void 0,(function*(){if(!this.terminalsAwaitingWriteAccess.has(h))return;if(R.sessionStateTracker.State!==R.SessionState.Joined)return void this.terminalsAwaitingWriteAccess.delete(h);const y=m===A.vsls.RestrictedOperationAccess.Allowed;if(!y&&this.terminalsWithRejectedWriteAccess.has(h))return;const v=(yield this.terminalService.getRunningTerminalsAsync()).find(m=>m.id===h);if(!v||R.sessionStateTracker.State!==R.SessionState.Joined)return this.terminalsAwaitingWriteAccess.delete(h),void this.terminalsWithRejectedWriteAccess.delete(h);y?(this.terminalsAwaitingWriteAccess.delete(h),this.terminalsWithRejectedWriteAccess.delete(h)):this.terminalsWithRejectedWriteAccess.add(h);const C=y?["Focus terminal"]:[];"Focus terminal"===(yield w.window.showInformationMessage(`The host ${y?"allowed":"didn't allow"} read/write access to '${v.options.name}' terminal.`,{modal:!1},...C))&&R.sessionStateTracker.State===R.SessionState.Joined&&(yield this.openTerminal({terminalId:h}))}))}openSharedTerminalsOnJoin(){return T(this,void 0,void 0,(function*(){try{const h=yield this.updateSessionContext();yield Promise.all(h.map(h=>this.createJoinedTerminal(h)))}catch(h){this.trace.error("Failed to open shared terminals on join",h),R.SessionContext.hasSharedTerminals=!1}}))}listTerminals(){return T(this,void 0,void 0,(function*(){const h=yield this.getRunningTerminalsAsync();if(0===h.length)return void(yield w.window.showInformationMessage("No terminals are currently shared in the collaboration session.",{modal:!1}));let m=-1;if(1===h.length)m=0;else{const y=h.map((h,m)=>`${m+1}: ${h.options.name}`),v=yield P.NotificationUtil.showQuickPick(y,{placeHolder:"Select shared terminal to open"});if(!v)return;m=y.indexOf(v)}return m>=0&&(yield this.createJoinedTerminal(h[m])),!0}))}openTerminal(h){return T(this,void 0,void 0,(function*(){if(!h)return!1;const m=yield this.terminalService.getRunningTerminalsAsync();for(const y of m.filter(m=>m.id===h.terminalId)){yield this.createJoinedTerminal(y);break}return!0}))}onHostTerminalStarted(h){return T(this,void 0,void 0,(function*(){yield this.updateSessionContext(),yield this.createJoinedTerminal(h.terminal)}))}onHostTerminalStopped(){return T(this,void 0,void 0,(function*(){yield this.updateSessionContext()}))}updateSessionContext(){return T(this,void 0,void 0,(function*(){try{const h=yield this.getRunningTerminalsAsync();return R.SessionContext.hasSharedTerminals=h.length>0,h}catch(h){this.trace.error("Checking for shared terminals failed: "+h)}}))}getRunningTerminalsAsync(){return T(this,void 0,void 0,(function*(){try{return yield this.terminalService.getRunningTerminalsAsync()}catch(h){if(-32601===h.code)return[];throw h}}))}createJoinedTerminal(h,m){return T(this,void 0,void 0,(function*(){let y=this.showTerminal(h);if(y)return y;const v=h.options.name;m||(m=P.createTerminalRenderer(v));const C=[];let A=null;m.onDidChangeMaximumDimensions(m=>{A&&clearTimeout(A),A=setTimeout(()=>T(this,void 0,void 0,(function*(){clearTimeout(A),A=null;try{yield this.terminalService.resizeTerminalAsync(h.id,m.columns,m.rows)}catch(h){this.trace.error(`Error resizing terminal ${h}`)}})),100)},void 0,C),this.terminalService.onTerminalResized(y=>{y.terminal.id===h.id&&(m.dimensions={columns:y.terminal.options.cols,rows:y.terminal.options.rows})},void 0,C);try{y=m.terminal,function pipeTerminalStdio(h,m,y){return T(this,void 0,void 0,(function*(){let v=[];const C=new w.CancellationTokenSource;try{let y=Promise.resolve();for(m.onDidAcceptInput(m=>y=y.then(()=>function writeToEndpoint(m){if(!C.token.isCancellationRequested)return h.writeData(m,C.token)}(m)),void 0,v),w.window.onDidCloseTerminal(h=>{h===m.terminal&&C.cancel()},void 0,v);!C.token.isCancellationRequested;){const y=yield h.readData(C.token);if(null===y)break;m.write(y)}C.cancel(),yield y}catch(v){C.token.isCancellationRequested||h.isDisposed()||(y.error(`Error running shared terminal renderer ${v}`),m.write(`\r\n[31mError running shared terminal ${v}[0m`),M.Telemetry.sendFault(R.TelemetryEventNames.RUN_SHARED_TERMINAL_FAULT,M.FaultType.Error,null,v))}finally{v.forEach(h=>h.dispose())}}))}(yield this.dependencies.terminalEndpointBufferFactory(h),m,this.trace).catch(h=>{this.trace.error("Failed to pipe terminal",h)}),y.show();const disposeTerminalWorker=()=>T(this,void 0,void 0,(function*(){if(C.forEach(h=>h.dispose()),R.sessionStateTracker.State===R.SessionState.Shared)yield this.terminalService.stopTerminalAsync(h.id);else if(m)try{yield this.terminalService.resizeTerminalAsync(h.id,0,0)}catch(h){}}));return this.terminalCache.register(y,h.id,!0,{dispose:disposeTerminalWorker}),this.terminalService.onTerminalStopped(m=>{m.terminal.id===h.id&&y.dispose()},null,C),y}catch(m){this.trace.error(`Failed to create joined terminal with info:${JSON.stringify(h)}`,m)}}))}};return v([N("Listing Terminals",R.TelemetryEventNames.LIST_TERMINALS_FAULT),y(R.TelemetryEventNames.LIST_TERMINALS,R.TelemetryEventNames.LIST_TERMINALS_FAULT,"ListTerminals"),R.commandBindingDecorator("liveshare.listTerminals"),C("design:type",Function),C("design:paramtypes",[]),C("design:returntype",Promise)],D.prototype,"listTerminals",null),v([N("Opening Terminal",R.TelemetryEventNames.OPEN_TERMINAL_FAULT),y(R.TelemetryEventNames.OPEN_TERMINAL,R.TelemetryEventNames.OPEN_TERMINAL_FAULT,"OpenTerminal"),R.commandBindingDecorator("liveshare.fileTreeExplorer.openTerminal"),R.commandBindingDecorator("liveshare.activityBar.openTerminal"),C("design:type",Function),C("design:paramtypes",[Object]),C("design:returntype",Promise)],D.prototype,"openTerminal",null),D=v([m,C("design:paramtypes",[Object])],D),new D(h)}},function(h,m,y){"use strict";var v=this&&this.__awaiter||function(h,m,y,v){return new(y||(y=Promise))((function(C,T){function fulfilled(h){try{step(v.next(h))}catch(h){T(h)}}function rejected(h){try{step(v.throw(h))}catch(h){T(h)}}function step(h){h.done?C(h.value):function adopt(h){return h instanceof y?h:new y((function(m){m(h)}))}(h.value).then(fulfilled,rejected)}step((v=v.apply(h,m||[])).next())}))};Object.defineProperty(m,"__esModule",{value:!0});const C=y(3),T=y(596);m.GuestTerminalHandler=class GuestTerminalHandler{constructor(h){this.dependencies=h,C.sessionStateTracker.State===C.SessionState.JoiningInProgress&&this.createGuestController()}handleSessionStateChanged(h,m){return v(this,void 0,void 0,(function*(){switch(h){case C.SessionState.JoiningInProgress:this.createGuestController();break;case C.SessionState.Joined:yield this.guestController.activate();break;default:this.guestController&&m===C.SessionState.Joined&&(yield this.guestController.deactivate())}}))}dispose(){return v(this,void 0,void 0,(function*(){this.guestController&&(yield this.guestController.dispose())}))}createGuestController(){this.guestController=T.guestTerminalControllerFactory(this.dependencies)}}},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0});var v=y(1475);m.NotebooksService=v.NotebooksService;var C=y(1476);m.HostNotebooksService=C.HostNotebooksService;var T=y(1477);m.GuestNotebooksService=T.GuestNotebooksService;var w=y(603);m.NotebookContentProvider=w.NotebookContentProvider;var A=y(599);m.HostCellManager=A.HostCellManager;var P=y(602);m.GuestCellManager=P.GuestCellManager},function(h,m,y){"use strict";var v=this&&this.__awaiter||function(h,m,y,v){return new(y||(y=Promise))((function(C,T){function fulfilled(h){try{step(v.next(h))}catch(h){T(h)}}function rejected(h){try{step(v.throw(h))}catch(h){T(h)}}function step(h){h.done?C(h.value):function adopt(h){return h instanceof y?h:new y((function(m){m(h)}))}(h.value).then(fulfilled,rejected)}step((v=v.apply(h,m||[])).next())}))};Object.defineProperty(m,"__esModule",{value:!0});const C=y(0),T=y(3),w=y(600);class HostCellManager extends w.CellManager{constructor(h,m,y,v){super(h),this.pathManager=m,this.fileService=y,this.coediting=v,this.neighborOnDelete=new Map,this.changeQueue=Promise.resolve([]),this.init()}init(){return v(this,void 0,void 0,(function*(){return this.initPromise||(this.initPromise=new Promise((h,m)=>v(this,void 0,void 0,(function*(){T.Settings.get(T.SettingKeys.shareExternalFiles)&&!C.workspace.getWorkspaceFolder(this.notebookDocument.uri)&&(yield this.fileService().registerExternalFilesAsync([this.notebookDocument.uri.toString()]));for(let h of this.notebookDocument.getCells()){yield this.addIdToCell(h);const m=this.pathManager.localPathToRelativePath(h.document.uri);this.coediting.createSharedFileClient(m,h.document.getText(),!1,void 0,void 0,void 0,!0)}h()})))),this.initPromise}))}onDidChangeNotebookCells(h){return v(this,void 0,void 0,(function*(){return this.changeQueue=this.changeQueue.then(()=>v(this,void 0,void 0,(function*(){const m=[];for(let y of h.changes){const h=y.start-1,v=T.getCellId(this.notebookDocument.getCells().find(m=>m.index===h)),C=y.deletedItems.map(h=>{const m=T.getCellId(h);return this.neighborOnDelete.set(m,v),m}),w=[];for(let h of y.items){this.isRemoteChange(h)||(yield this.addIdToCell(h));const m=this.pathManager.localPathToRelativePath(h.document.uri);this.coediting.createSharedFileClient(m,h.document.getText(),!1),w.push(T.getNotebookCellData(h))}const A=w.length>0?{idx:y.start,cells:w}:void 0;m.push({deletes:C,adds:A})}return m}))),this.changeQueue}))}applyChanges(h){return v(this,void 0,void 0,(function*(){for(let m of h){for(let h of m.deletes){const m=this.notebookDocument.getCells().find(m=>T.getCellId(m)===h);yield this.deleteCell(m)}if(m.adds){let h=m.adds.insertAbove;for(;h&&this.neighborOnDelete.has(h);)h=this.neighborOnDelete.get(h);const y=h?this.notebookDocument.getCells().find(m=>T.getCellId(m)===h).index+1:0;yield this.addCells(y,m.adds.cells)}}}))}}m.HostCellManager=HostCellManager},function(h,m,y){"use strict";var v=this&&this.__awaiter||function(h,m,y,v){return new(y||(y=Promise))((function(C,T){function fulfilled(h){try{step(v.next(h))}catch(h){T(h)}}function rejected(h){try{step(v.throw(h))}catch(h){T(h)}}function step(h){h.done?C(h.value):function adopt(h){return h instanceof y?h:new y((function(m){m(h)}))}(h.value).then(fulfilled,rejected)}step((v=v.apply(h,m||[])).next())}))};Object.defineProperty(m,"__esModule",{value:!0});const C=y(0),T=y(35),w=y(3);m.CellManager=class CellManager{constructor(h){this.notebookDocument=h,this.remoteChanges=new Set}isRemoteChange(h){const m=w.getCellId(h);return!!m&&this.remoteChanges.has(m)}addIdToCell(h){return v(this,void 0,void 0,(function*(){const m=w.getCellId(h);let y=m;if(m){this.notebookDocument.getCells().find(y=>y!==h&&w.getCellId(y)===m)&&(y=T())}else y=T();const v=new C.WorkspaceEdit,A=Object.assign({},h.metadata);A[w.NotebookConstants.cellIdPropertyName]=y,v.replaceNotebookCellMetadata(this.notebookDocument.uri,h.index,A),yield C.workspace.applyEdit(v)}))}deleteCell(h){return v(this,void 0,void 0,(function*(){const m=w.getCellId(h),y=new C.WorkspaceEdit,v=new C.NotebookRange(h.index,h.index+1);y.replaceNotebookCells(this.notebookDocument.uri,v,[]),this.remoteChanges.add(m),yield C.workspace.applyEdit(y),this.remoteChanges.delete(m)}))}addCells(h,m){return v(this,void 0,void 0,(function*(){const y=new C.WorkspaceEdit;m.forEach(h=>this.remoteChanges.add(w.getCellId(h)));const v=new C.NotebookRange(h,h);y.replaceNotebookCells(this.notebookDocument.uri,v,m),yield C.workspace.applyEdit(y),m.forEach(h=>this.remoteChanges.delete(w.getCellId(h)))}))}moveCell(h,m){return v(this,void 0,void 0,(function*(){const y=w.getNotebookCellData(h),v=w.getCellId(h),T=new C.WorkspaceEdit,A=new C.NotebookRange(m,m),P=new C.NotebookRange(h.index,h.index+1);T.replaceNotebookCells(this.notebookDocument.uri,A,[y]),T.replaceNotebookCells(this.notebookDocument.uri,P,[]),this.remoteChanges.add(v),yield C.workspace.applyEdit(T),this.remoteChanges.delete(v)}))}}},function(h,m,y){"use strict";var v=this&&this.__awaiter||function(h,m,y,v){return new(y||(y=Promise))((function(C,T){function fulfilled(h){try{step(v.next(h))}catch(h){T(h)}}function rejected(h){try{step(v.throw(h))}catch(h){T(h)}}function step(h){h.done?C(h.value):function adopt(h){return h instanceof y?h:new y((function(m){m(h)}))}(h.value).then(fulfilled,rejected)}step((v=v.apply(h,m||[])).next())}))};Object.defineProperty(m,"__esModule",{value:!0});const C=y(0),T=y(3);m.notebooksServiceBase=class notebooksServiceBase{constructor(){this.cellLanguageMap={},this.disposables=[]}dispose(){return v(this,void 0,void 0,(function*(){this.disposables.forEach(h=>h.dispose()),this.disposables=[]}))}init(){this.disposables.push(C.workspace.onDidCloseTextDocument(h=>this._onDidCloseTextDocument(h))),this.disposables.push(C.workspace.onDidOpenTextDocument(h=>this._onDidOpenTextDocument(h)))}_onDidCloseTextDocument(h){h.uri.scheme==T.PathManager.notebookCellScheme&&(this.cellLanguageMap[h.uri.toString()]=h.languageId)}_onDidOpenTextDocument(h){let m;const y=this.cellLanguageMap[h.uri.toString()];if(h.uri.scheme===T.PathManager.notebookCellScheme&&void 0!==y&&y!==h.languageId){const y=h.notebook.getCells().find(m=>m.document.uri.toString()===h.uri.toString());y&&(m=T.getCellId(y))}void 0!==m&&this.handleLanguageChange(h.notebook.uri,h.languageId,m)}}},function(h,m,y){"use strict";var v=this&&this.__awaiter||function(h,m,y,v){return new(y||(y=Promise))((function(C,T){function fulfilled(h){try{step(v.next(h))}catch(h){T(h)}}function rejected(h){try{step(v.throw(h))}catch(h){T(h)}}function step(h){h.done?C(h.value):function adopt(h){return h instanceof y?h:new y((function(m){m(h)}))}(h.value).then(fulfilled,rejected)}step((v=v.apply(h,m||[])).next())}))};Object.defineProperty(m,"__esModule",{value:!0});const C=y(3),T=y(600);class GuestCellManager extends T.CellManager{constructor(h,m,y){super(h),this.pathManager=m,this.coediting=y,this.hostNotebook=[],this.unacknowledgedChanges={deletes:[],adds:[]},this.hostNotebook=h.getCells().map(h=>Object.assign(Object.assign({},C.getNotebookCellData(h)),{index:h.index})),C.sortCells(this.hostNotebook),h.getCells().forEach(h=>this.createFileClient(h))}createFileClient(h){const m=this.pathManager.localPathToRelativePath(h.document.uri);this.coediting.createSharedFileClient(m,h.document.getText(),!1)}onDidChangeNotebookCells(h){return v(this,void 0,void 0,(function*(){const m=[];for(let y of h.changes){const v=y.deletedItems.filter(h=>!this.isRemoteChange(h)).map(h=>C.getCellId(h));this.unacknowledgedChanges.deletes.push(...v);const T=[];for(let h of y.items)this.isRemoteChange(h)||(yield this.addIdToCell(h),T.push(C.getNotebookCellData(h)),this.unacknowledgedChanges.adds.push(C.getCellId(h))),this.createFileClient(h);0===v.length&&0===T.length||m.push({deletes:v,adds:0===T.length?void 0:{insertAbove:0===y.start?void 0:C.getCellId(h.document.getCells().find(h=>h.index===y.start-1)),cells:T}})}return m}))}deleteHostCell(h){const m=this.hostNotebook.findIndex(m=>C.getCellId(m)===h);this.hostNotebook.splice(m,1);for(let h=m;h<this.hostNotebook.length;h++)this.hostNotebook[h].index--;const y=this.unacknowledgedChanges.deletes.findIndex(m=>m===h);y>=0&&this.unacknowledgedChanges.deletes.splice(y,1)}addHostCell(h,m){this.hostNotebook.splice(h,0,Object.assign(Object.assign({},m),{index:h}));for(let m=h+1;m<this.hostNotebook.length;m++)this.hostNotebook[m].index++;const y=C.getCellId(m),v=this.unacknowledgedChanges.adds.findIndex(h=>h===y);v>=0&&this.unacknowledgedChanges.adds.splice(v,1)}onHostDidChangeNotebookCells(h){return v(this,void 0,void 0,(function*(){for(let m of h.changes){for(let h of m.deletes)this.deleteHostCell(h);if(m.adds)for(let h=0;h<m.adds.cells.length;h++)this.addHostCell(m.adds.idx+h,m.adds.cells[h])}const m=C.getNotebookHash(this.hostNotebook);C.assert(m===h.contentHash,"Guest representation of host notebook should match host notebook"),0===this.unacknowledgedChanges.deletes.length&&0===this.unacknowledgedChanges.adds.length&&(yield this.sync())}))}sync(){return v(this,void 0,void 0,(function*(){const h=[];for(let m of this.notebookDocument.getCells()){const y=C.getCellId(m);this.hostNotebook.find(h=>C.getCellId(h)===y)?h.push(m):yield this.deleteCell(m)}C.sortCells(h);for(let m=0,y=0;y<this.hostNotebook.length;m++,y++){const v=m<h.length?h[m]:void 0,T=this.hostNotebook[y];if(v){if(C.getCellId(v)!==C.getCellId(T)){const y=h.find(h=>C.getCellId(h)===C.getCellId(T));y?(yield this.moveCell(y,T.index),h.splice(h.indexOf(y),1),m--):(yield this.addCells(T.index,[T]),m--)}}else yield this.addCells(T.index,[T])}this.checkSync()}))}checkSync(){const h=[...this.notebookDocument.getCells()];C.sortCells(h);const m=C.getNotebookHash(h),y=C.getNotebookHash(this.hostNotebook);C.assert(m===y,"Guest notebook should match host notebook after sync")}}m.GuestCellManager=GuestCellManager},function(h,m,y){"use strict";var v=this&&this.__awaiter||function(h,m,y,v){return new(y||(y=Promise))((function(C,T){function fulfilled(h){try{step(v.next(h))}catch(h){T(h)}}function rejected(h){try{step(v.throw(h))}catch(h){T(h)}}function step(h){h.done?C(h.value):function adopt(h){return h instanceof y?h:new y((function(m){m(h)}))}(h.value).then(fulfilled,rejected)}step((v=v.apply(h,m||[])).next())}))};Object.defineProperty(m,"__esModule",{value:!0});const C=y(3);m.NotebookContentProvider=class NotebookContentProvider{constructor(h,m){this.notebookType=h,this.notebooksService=m}openNotebook(h){return v(this,void 0,void 0,(function*(){const m=yield this.notebooksService.openNotebookAsync(h.path,this.notebookType);if(m.usedNotebookType)throw new Error(`${C.localize("notebooks.openWithDifferentNotebookTypeOnHost1")} ${m.usedNotebookType}. ${C.localize("notebooks.openWithDifferentNotebookTypeOnHost2")}`);return m}))}saveNotebook(){return v(this,void 0,void 0,(function*(){}))}saveNotebookAs(){return v(this,void 0,void 0,(function*(){}))}backupNotebook(){return v(this,void 0,void 0,(function*(){return{id:"",delete:()=>{}}}))}}},function(h,m,y){!function(h){"use strict";
//! moment.js locale configuration
h.defineLocale("af",{months:"Januarie_Februarie_Maart_April_Mei_Junie_Julie_Augustus_September_Oktober_November_Desember".split("_"),monthsShort:"Jan_Feb_Mrt_Apr_Mei_Jun_Jul_Aug_Sep_Okt_Nov_Des".split("_"),weekdays:"Sondag_Maandag_Dinsdag_Woensdag_Donderdag_Vrydag_Saterdag".split("_"),weekdaysShort:"Son_Maa_Din_Woe_Don_Vry_Sat".split("_"),weekdaysMin:"So_Ma_Di_Wo_Do_Vr_Sa".split("_"),meridiemParse:/vm|nm/i,isPM:function(h){return/^nm$/i.test(h)},meridiem:function(h,m,y){return h<12?y?"vm":"VM":y?"nm":"NM"},longDateFormat:{LT:"HH:mm",LTS:"HH:mm:ss",L:"DD/MM/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY HH:mm",LLLL:"dddd, D MMMM YYYY HH:mm"},calendar:{sameDay:"[Vandag om] LT",nextDay:"[Mre om] LT",nextWeek:"dddd [om] LT",lastDay:"[Gister om] LT",lastWeek:"[Laas] dddd [om] LT",sameElse:"L"},relativeTime:{future:"oor %s",past:"%s gelede",s:"'n paar sekondes",ss:"%d sekondes",m:"'n minuut",mm:"%d minute",h:"'n uur",hh:"%d ure",d:"'n dag",dd:"%d dae",M:"'n maand",MM:"%d maande",y:"'n jaar",yy:"%d jaar"},dayOfMonthOrdinalParse:/\d{1,2}(ste|de)/,ordinal:function(h){return h+(1===h||8===h||h>=20?"ste":"de")},week:{dow:1,doy:4}})}(y(1))},function(h,m,y){!function(h){"use strict";
//! moment.js locale configuration
var m={1:"",2:"",3:"",4:"",5:"",6:"",7:"",8:"",9:"",0:""},y={"":"1","":"2","":"3","":"4","":"5","":"6","":"7","":"8","":"9","":"0"},pluralForm=function(h){return 0===h?0:1===h?1:2===h?2:h%100>=3&&h%100<=10?3:h%100>=11?4:5},v={s:["  "," ",["",""],"%d ","%d ","%d "],m:["  "," ",["",""],"%d ","%d ","%d "],h:["  "," ",["",""],"%d ","%d ","%d "],d:["  "," ",["",""],"%d ","%d ","%d "],M:["  "," ",["",""],"%d ","%d ","%d "],y:["  "," ",["",""],"%d ","%d ","%d "]},pluralize=function(h){return function(m,y,C,T){var w=pluralForm(m),A=v[h][pluralForm(m)];return 2===w&&(A=A[y?0:1]),A.replace(/%d/i,m)}},C=["","","","","","","","","","","",""];h.defineLocale("ar",{months:C,monthsShort:C,weekdays:"______".split("_"),weekdaysShort:"______".split("_"),weekdaysMin:"______".split("_"),weekdaysParseExact:!0,longDateFormat:{LT:"HH:mm",LTS:"HH:mm:ss",L:"D/M/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY HH:mm",LLLL:"dddd D MMMM YYYY HH:mm"},meridiemParse:/|/,isPM:function(h){return""===h},meridiem:function(h,m,y){return h<12?"":""},calendar:{sameDay:"[  ] LT",nextDay:"[  ] LT",nextWeek:"dddd [ ] LT",lastDay:"[  ] LT",lastWeek:"dddd [ ] LT",sameElse:"L"},relativeTime:{future:" %s",past:" %s",s:pluralize("s"),ss:pluralize("s"),m:pluralize("m"),mm:pluralize("m"),h:pluralize("h"),hh:pluralize("h"),d:pluralize("d"),dd:pluralize("d"),M:pluralize("M"),MM:pluralize("M"),y:pluralize("y"),yy:pluralize("y")},preparse:function(h){return h.replace(/[]/g,(function(h){return y[h]})).replace(//g,",")},postformat:function(h){return h.replace(/\d/g,(function(h){return m[h]})).replace(/,/g,"")},week:{dow:6,doy:12}})}(y(1))},function(h,m,y){!function(h){"use strict";
//! moment.js locale configuration
var pluralForm=function(h){return 0===h?0:1===h?1:2===h?2:h%100>=3&&h%100<=10?3:h%100>=11?4:5},m={s:["  "," ",["",""],"%d ","%d ","%d "],m:["  "," ",["",""],"%d ","%d ","%d "],h:["  "," ",["",""],"%d ","%d ","%d "],d:["  "," ",["",""],"%d ","%d ","%d "],M:["  "," ",["",""],"%d ","%d ","%d "],y:["  "," ",["",""],"%d ","%d ","%d "]},pluralize=function(h){return function(y,v,C,T){var w=pluralForm(y),A=m[h][pluralForm(y)];return 2===w&&(A=A[v?0:1]),A.replace(/%d/i,y)}},y=["","","","","","","","","","","",""];h.defineLocale("ar-dz",{months:y,monthsShort:y,weekdays:"______".split("_"),weekdaysShort:"______".split("_"),weekdaysMin:"______".split("_"),weekdaysParseExact:!0,longDateFormat:{LT:"HH:mm",LTS:"HH:mm:ss",L:"D/M/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY HH:mm",LLLL:"dddd D MMMM YYYY HH:mm"},meridiemParse:/|/,isPM:function(h){return""===h},meridiem:function(h,m,y){return h<12?"":""},calendar:{sameDay:"[  ] LT",nextDay:"[  ] LT",nextWeek:"dddd [ ] LT",lastDay:"[  ] LT",lastWeek:"dddd [ ] LT",sameElse:"L"},relativeTime:{future:" %s",past:" %s",s:pluralize("s"),ss:pluralize("s"),m:pluralize("m"),mm:pluralize("m"),h:pluralize("h"),hh:pluralize("h"),d:pluralize("d"),dd:pluralize("d"),M:pluralize("M"),MM:pluralize("M"),y:pluralize("y"),yy:pluralize("y")},postformat:function(h){return h.replace(/,/g,"")},week:{dow:0,doy:4}})}(y(1))},function(h,m,y){!function(h){"use strict";
//! moment.js locale configuration
h.defineLocale("ar-kw",{months:"___________".split("_"),monthsShort:"___________".split("_"),weekdays:"______".split("_"),weekdaysShort:"______".split("_"),weekdaysMin:"______".split("_"),weekdaysParseExact:!0,longDateFormat:{LT:"HH:mm",LTS:"HH:mm:ss",L:"DD/MM/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY HH:mm",LLLL:"dddd D MMMM YYYY HH:mm"},calendar:{sameDay:"[  ] LT",nextDay:"[  ] LT",nextWeek:"dddd [ ] LT",lastDay:"[  ] LT",lastWeek:"dddd [ ] LT",sameElse:"L"},relativeTime:{future:" %s",past:" %s",s:"",ss:"%d ",m:"",mm:"%d ",h:"",hh:"%d ",d:"",dd:"%d ",M:"",MM:"%d ",y:"",yy:"%d "},week:{dow:0,doy:12}})}(y(1))},function(h,m,y){!function(h){"use strict";
//! moment.js locale configuration
var m={1:"1",2:"2",3:"3",4:"4",5:"5",6:"6",7:"7",8:"8",9:"9",0:"0"},pluralForm=function(h){return 0===h?0:1===h?1:2===h?2:h%100>=3&&h%100<=10?3:h%100>=11?4:5},y={s:["  "," ",["",""],"%d ","%d ","%d "],m:["  "," ",["",""],"%d ","%d ","%d "],h:["  "," ",["",""],"%d ","%d ","%d "],d:["  "," ",["",""],"%d ","%d ","%d "],M:["  "," ",["",""],"%d ","%d ","%d "],y:["  "," ",["",""],"%d ","%d ","%d "]},pluralize=function(h){return function(m,v,C,T){var w=pluralForm(m),A=y[h][pluralForm(m)];return 2===w&&(A=A[v?0:1]),A.replace(/%d/i,m)}},v=["","","","","","","","","","","",""];h.defineLocale("ar-ly",{months:v,monthsShort:v,weekdays:"______".split("_"),weekdaysShort:"______".split("_"),weekdaysMin:"______".split("_"),weekdaysParseExact:!0,longDateFormat:{LT:"HH:mm",LTS:"HH:mm:ss",L:"D/M/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY HH:mm",LLLL:"dddd D MMMM YYYY HH:mm"},meridiemParse:/|/,isPM:function(h){return""===h},meridiem:function(h,m,y){return h<12?"":""},calendar:{sameDay:"[  ] LT",nextDay:"[  ] LT",nextWeek:"dddd [ ] LT",lastDay:"[  ] LT",lastWeek:"dddd [ ] LT",sameElse:"L"},relativeTime:{future:" %s",past:" %s",s:pluralize("s"),ss:pluralize("s"),m:pluralize("m"),mm:pluralize("m"),h:pluralize("h"),hh:pluralize("h"),d:pluralize("d"),dd:pluralize("d"),M:pluralize("M"),MM:pluralize("M"),y:pluralize("y"),yy:pluralize("y")},preparse:function(h){return h.replace(//g,",")},postformat:function(h){return h.replace(/\d/g,(function(h){return m[h]})).replace(/,/g,"")},week:{dow:6,doy:12}})}(y(1))},function(h,m,y){!function(h){"use strict";
//! moment.js locale configuration
h.defineLocale("ar-ma",{months:"___________".split("_"),monthsShort:"___________".split("_"),weekdays:"______".split("_"),weekdaysShort:"______".split("_"),weekdaysMin:"______".split("_"),weekdaysParseExact:!0,longDateFormat:{LT:"HH:mm",LTS:"HH:mm:ss",L:"DD/MM/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY HH:mm",LLLL:"dddd D MMMM YYYY HH:mm"},calendar:{sameDay:"[  ] LT",nextDay:"[  ] LT",nextWeek:"dddd [ ] LT",lastDay:"[  ] LT",lastWeek:"dddd [ ] LT",sameElse:"L"},relativeTime:{future:" %s",past:" %s",s:"",ss:"%d ",m:"",mm:"%d ",h:"",hh:"%d ",d:"",dd:"%d ",M:"",MM:"%d ",y:"",yy:"%d "},week:{dow:6,doy:12}})}(y(1))},function(h,m,y){!function(h){"use strict";
//! moment.js locale configuration
var m={1:"",2:"",3:"",4:"",5:"",6:"",7:"",8:"",9:"",0:""},y={"":"1","":"2","":"3","":"4","":"5","":"6","":"7","":"8","":"9","":"0"};h.defineLocale("ar-sa",{months:"___________".split("_"),monthsShort:"___________".split("_"),weekdays:"______".split("_"),weekdaysShort:"______".split("_"),weekdaysMin:"______".split("_"),weekdaysParseExact:!0,longDateFormat:{LT:"HH:mm",LTS:"HH:mm:ss",L:"DD/MM/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY HH:mm",LLLL:"dddd D MMMM YYYY HH:mm"},meridiemParse:/|/,isPM:function(h){return""===h},meridiem:function(h,m,y){return h<12?"":""},calendar:{sameDay:"[  ] LT",nextDay:"[  ] LT",nextWeek:"dddd [ ] LT",lastDay:"[  ] LT",lastWeek:"dddd [ ] LT",sameElse:"L"},relativeTime:{future:" %s",past:" %s",s:"",ss:"%d ",m:"",mm:"%d ",h:"",hh:"%d ",d:"",dd:"%d ",M:"",MM:"%d ",y:"",yy:"%d "},preparse:function(h){return h.replace(/[]/g,(function(h){return y[h]})).replace(//g,",")},postformat:function(h){return h.replace(/\d/g,(function(h){return m[h]})).replace(/,/g,"")},week:{dow:0,doy:6}})}(y(1))},function(h,m,y){!function(h){"use strict";
//! moment.js locale configuration
h.defineLocale("ar-tn",{months:"___________".split("_"),monthsShort:"___________".split("_"),weekdays:"______".split("_"),weekdaysShort:"______".split("_"),weekdaysMin:"______".split("_"),weekdaysParseExact:!0,longDateFormat:{LT:"HH:mm",LTS:"HH:mm:ss",L:"DD/MM/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY HH:mm",LLLL:"dddd D MMMM YYYY HH:mm"},calendar:{sameDay:"[  ] LT",nextDay:"[  ] LT",nextWeek:"dddd [ ] LT",lastDay:"[  ] LT",lastWeek:"dddd [ ] LT",sameElse:"L"},relativeTime:{future:" %s",past:" %s",s:"",ss:"%d ",m:"",mm:"%d ",h:"",hh:"%d ",d:"",dd:"%d ",M:"",MM:"%d ",y:"",yy:"%d "},week:{dow:1,doy:4}})}(y(1))},function(h,m,y){!function(h){"use strict";
//! moment.js locale configuration
var m={1:"-inci",5:"-inci",8:"-inci",70:"-inci",80:"-inci",2:"-nci",7:"-nci",20:"-nci",50:"-nci",3:"-nc",4:"-nc",100:"-nc",6:"-nc",9:"-uncu",10:"-uncu",30:"-uncu",60:"-nc",90:"-nc"};h.defineLocale("az",{months:"yanvar_fevral_mart_aprel_may_iyun_iyul_avqust_sentyabr_oktyabr_noyabr_dekabr".split("_"),monthsShort:"yan_fev_mar_apr_may_iyn_iyl_avq_sen_okt_noy_dek".split("_"),weekdays:"Bazar_Bazar ertsi_rnb axam_rnb_Cm axam_Cm_nb".split("_"),weekdaysShort:"Baz_BzE_Ax_r_CAx_Cm_n".split("_"),weekdaysMin:"Bz_BE_A__CA_C_".split("_"),weekdaysParseExact:!0,longDateFormat:{LT:"HH:mm",LTS:"HH:mm:ss",L:"DD.MM.YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY HH:mm",LLLL:"dddd, D MMMM YYYY HH:mm"},calendar:{sameDay:"[bugn saat] LT",nextDay:"[sabah saat] LT",nextWeek:"[gln hft] dddd [saat] LT",lastDay:"[dnn] LT",lastWeek:"[ken hft] dddd [saat] LT",sameElse:"L"},relativeTime:{future:"%s sonra",past:"%s vvl",s:"birne saniy",ss:"%d saniy",m:"bir dqiq",mm:"%d dqiq",h:"bir saat",hh:"%d saat",d:"bir gn",dd:"%d gn",M:"bir ay",MM:"%d ay",y:"bir il",yy:"%d il"},meridiemParse:/gec|shr|gndz|axam/,isPM:function(h){return/^(gndz|axam)$/.test(h)},meridiem:function(h,m,y){return h<4?"gec":h<12?"shr":h<17?"gndz":"axam"},dayOfMonthOrdinalParse:/\d{1,2}-(nc|inci|nci|nc|nc|uncu)/,ordinal:function(h){if(0===h)return h+"-nc";var y=h%10;return h+(m[y]||m[h%100-y]||m[h>=100?100:null])},week:{dow:1,doy:7}})}(y(1))},function(h,m,y){!function(h){"use strict";
//! moment.js locale configuration
function relativeTimeWithPlural(h,m,y){return"m"===y?m?"":"":"h"===y?m?"":"":h+" "+function plural(h,m){var y=h.split("_");return m%10==1&&m%100!=11?y[0]:m%10>=2&&m%10<=4&&(m%100<10||m%100>=20)?y[1]:y[2]}({ss:m?"__":"__",mm:m?"__":"__",hh:m?"__":"__",dd:"__",MM:"__",yy:"__"}[y],+h)}h.defineLocale("be",{months:{format:"___________".split("_"),standalone:"___________".split("_")},monthsShort:"___________".split("_"),weekdays:{format:"______".split("_"),standalone:"______".split("_"),isFormat:/\[ ?[] ?(?:|)? ?\] ?dddd/},weekdaysShort:"______".split("_"),weekdaysMin:"______".split("_"),longDateFormat:{LT:"HH:mm",LTS:"HH:mm:ss",L:"DD.MM.YYYY",LL:"D MMMM YYYY .",LLL:"D MMMM YYYY ., HH:mm",LLLL:"dddd, D MMMM YYYY ., HH:mm"},calendar:{sameDay:"[ ] LT",nextDay:"[ ] LT",lastDay:"[ ] LT",nextWeek:function(){return"[] dddd [] LT"},lastWeek:function(){switch(this.day()){case 0:case 3:case 5:case 6:return"[ ] dddd [] LT";case 1:case 2:case 4:return"[ ] dddd [] LT"}},sameElse:"L"},relativeTime:{future:" %s",past:"%s ",s:" ",m:relativeTimeWithPlural,mm:relativeTimeWithPlural,h:relativeTimeWithPlural,hh:relativeTimeWithPlural,d:"",dd:relativeTimeWithPlural,M:"",MM:relativeTimeWithPlural,y:"",yy:relativeTimeWithPlural},meridiemParse:/|||/,isPM:function(h){return/^(|)$/.test(h)},meridiem:function(h,m,y){return h<4?"":h<12?"":h<17?"":""},dayOfMonthOrdinalParse:/\d{1,2}-(||)/,ordinal:function(h,m){switch(m){case"M":case"d":case"DDD":case"w":case"W":return h%10!=2&&h%10!=3||h%100==12||h%100==13?h+"-":h+"-";case"D":return h+"-";default:return h}},week:{dow:1,doy:7}})}(y(1))},function(h,m,y){!function(h){"use strict";
//! moment.js locale configuration
h.defineLocale("bg",{months:"___________".split("_"),monthsShort:"___________".split("_"),weekdays:"______".split("_"),weekdaysShort:"______".split("_"),weekdaysMin:"______".split("_"),longDateFormat:{LT:"H:mm",LTS:"H:mm:ss",L:"D.MM.YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY H:mm",LLLL:"dddd, D MMMM YYYY H:mm"},calendar:{sameDay:"[ ] LT",nextDay:"[ ] LT",nextWeek:"dddd [] LT",lastDay:"[ ] LT",lastWeek:function(){switch(this.day()){case 0:case 3:case 6:return"[] dddd [] LT";case 1:case 2:case 4:case 5:return"[] dddd [] LT"}},sameElse:"L"},relativeTime:{future:" %s",past:" %s",s:" ",ss:"%d ",m:"",mm:"%d ",h:"",hh:"%d ",d:"",dd:"%d ",M:"",MM:"%d ",y:"",yy:"%d "},dayOfMonthOrdinalParse:/\d{1,2}-(|||||)/,ordinal:function(h){var m=h%10,y=h%100;return 0===h?h+"-":0===y?h+"-":y>10&&y<20?h+"-":1===m?h+"-":2===m?h+"-":7===m||8===m?h+"-":h+"-"},week:{dow:1,doy:7}})}(y(1))},function(h,m,y){!function(h){"use strict";
//! moment.js locale configuration
h.defineLocale("bm",{months:"Zanwuyekalo_Fewuruyekalo_Marisikalo_Awirilikalo_Mkalo_Zuwnkalo_Zuluyekalo_Utikalo_Stanburukalo_kutburukalo_Nowanburukalo_Desanburukalo".split("_"),monthsShort:"Zan_Few_Mar_Awi_M_Zuw_Zul_Uti_St_ku_Now_Des".split("_"),weekdays:"Kari_Ntnn_Tarata_Araba_Alamisa_Juma_Sibiri".split("_"),weekdaysShort:"Kar_Nt_Tar_Ara_Ala_Jum_Sib".split("_"),weekdaysMin:"Ka_Nt_Ta_Ar_Al_Ju_Si".split("_"),longDateFormat:{LT:"HH:mm",LTS:"HH:mm:ss",L:"DD/MM/YYYY",LL:"MMMM [tile] D [san] YYYY",LLL:"MMMM [tile] D [san] YYYY [lr] HH:mm",LLLL:"dddd MMMM [tile] D [san] YYYY [lr] HH:mm"},calendar:{sameDay:"[Bi lr] LT",nextDay:"[Sini lr] LT",nextWeek:"dddd [don lr] LT",lastDay:"[Kunu lr] LT",lastWeek:"dddd [tmnen lr] LT",sameElse:"L"},relativeTime:{future:"%s kn",past:"a b %s b",s:"sanga dama dama",ss:"sekondi %d",m:"miniti kelen",mm:"miniti %d",h:"lr kelen",hh:"lr %d",d:"tile kelen",dd:"tile %d",M:"kalo kelen",MM:"kalo %d",y:"san kelen",yy:"san %d"},week:{dow:1,doy:4}})}(y(1))},function(h,m,y){!function(h){"use strict";
//! moment.js locale configuration
var m={1:"",2:"",3:"",4:"",5:"",6:"",7:"",8:"",9:"",0:""},y={"":"1","":"2","":"3","":"4","":"5","":"6","":"7","":"8","":"9","":"0"};h.defineLocale("bn",{months:"___________".split("_"),monthsShort:"___________".split("_"),weekdays:"______".split("_"),weekdaysShort:"______".split("_"),weekdaysMin:"______".split("_"),longDateFormat:{LT:"A h:mm ",LTS:"A h:mm:ss ",L:"DD/MM/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY, A h:mm ",LLLL:"dddd, D MMMM YYYY, A h:mm "},calendar:{sameDay:"[] LT",nextDay:"[] LT",nextWeek:"dddd, LT",lastDay:"[] LT",lastWeek:"[] dddd, LT",sameElse:"L"},relativeTime:{future:"%s ",past:"%s ",s:" ",ss:"%d ",m:" ",mm:"%d ",h:" ",hh:"%d ",d:" ",dd:"%d ",M:" ",MM:"%d ",y:" ",yy:"%d "},preparse:function(h){return h.replace(/[]/g,(function(h){return y[h]}))},postformat:function(h){return h.replace(/\d/g,(function(h){return m[h]}))},meridiemParse:/||||/,meridiemHour:function(h,m){return 12===h&&(h=0),""===m&&h>=4||""===m&&h<5||""===m?h+12:h},meridiem:function(h,m,y){return h<4?"":h<10?"":h<17?"":h<20?"":""},week:{dow:0,doy:6}})}(y(1))},function(h,m,y){!function(h){"use strict";
//! moment.js locale configuration
var m={1:"",2:"",3:"",4:"",5:"",6:"",7:"",8:"",9:"",0:""},y={"":"1","":"2","":"3","":"4","":"5","":"6","":"7","":"8","":"9","":"0"};h.defineLocale("bo",{months:"___________".split("_"),monthsShort:"1_2_3_4_5_6_7_8_9_10_11_12".split("_"),monthsShortRegex:/^(\d{1,2})/,monthsParseExact:!0,weekdays:"______".split("_"),weekdaysShort:"______".split("_"),weekdaysMin:"______".split("_"),longDateFormat:{LT:"A h:mm",LTS:"A h:mm:ss",L:"DD/MM/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY, A h:mm",LLLL:"dddd, D MMMM YYYY, A h:mm"},calendar:{sameDay:"[] LT",nextDay:"[] LT",nextWeek:"[], LT",lastDay:"[] LT",lastWeek:"[] dddd, LT",sameElse:"L"},relativeTime:{future:"%s ",past:"%s ",s:"",ss:"%d ",m:"",mm:"%d ",h:"",hh:"%d ",d:"",dd:"%d ",M:"",MM:"%d ",y:"",yy:"%d "},preparse:function(h){return h.replace(/[]/g,(function(h){return y[h]}))},postformat:function(h){return h.replace(/\d/g,(function(h){return m[h]}))},meridiemParse:/||||/,meridiemHour:function(h,m){return 12===h&&(h=0),""===m&&h>=4||""===m&&h<5||""===m?h+12:h},meridiem:function(h,m,y){return h<4?"":h<10?"":h<17?"":h<20?"":""},week:{dow:0,doy:6}})}(y(1))},function(h,m,y){!function(h){"use strict";
//! moment.js locale configuration
function relativeTimeWithMutation(h,m,y){return h+" "+function mutation(h,m){return 2===m?function softMutation(h){var m={m:"v",b:"v",d:"z"};return void 0===m[h.charAt(0)]?h:m[h.charAt(0)]+h.substring(1)}(h):h}({mm:"munutenn",MM:"miz",dd:"devezh"}[y],h)}var m=[/^gen/i,/^c[\']hwe/i,/^meu/i,/^ebr/i,/^mae/i,/^(mez|eve)/i,/^gou/i,/^eos/i,/^gwe/i,/^her/i,/^du/i,/^ker/i],y=/^(genver|c[\']hwevrer|meurzh|ebrel|mae|mezheven|gouere|eost|gwengolo|here|du|kerzu|gen|c[\']hwe|meu|ebr|mae|eve|gou|eos|gwe|her|du|ker)/i,v=[/^Su/i,/^Lu/i,/^Me([^r]|$)/i,/^Mer/i,/^Ya/i,/^Gw/i,/^Sa/i];h.defineLocale("br",{months:"Genver_Chwevrer_Meurzh_Ebrel_Mae_Mezheven_Gouere_Eost_Gwengolo_Here_Du_Kerzu".split("_"),monthsShort:"Gen_Chwe_Meu_Ebr_Mae_Eve_Gou_Eos_Gwe_Her_Du_Ker".split("_"),weekdays:"Sul_Lun_Meurzh_Mercher_Yaou_Gwener_Sadorn".split("_"),weekdaysShort:"Sul_Lun_Meu_Mer_Yao_Gwe_Sad".split("_"),weekdaysMin:"Su_Lu_Me_Mer_Ya_Gw_Sa".split("_"),weekdaysParse:v,fullWeekdaysParse:[/^sul/i,/^lun/i,/^meurzh/i,/^merc[\']her/i,/^yaou/i,/^gwener/i,/^sadorn/i],shortWeekdaysParse:[/^Sul/i,/^Lun/i,/^Meu/i,/^Mer/i,/^Yao/i,/^Gwe/i,/^Sad/i],minWeekdaysParse:v,monthsRegex:y,monthsShortRegex:y,monthsStrictRegex:/^(genver|c[\']hwevrer|meurzh|ebrel|mae|mezheven|gouere|eost|gwengolo|here|du|kerzu)/i,monthsShortStrictRegex:/^(gen|c[\']hwe|meu|ebr|mae|eve|gou|eos|gwe|her|du|ker)/i,monthsParse:m,longMonthsParse:m,shortMonthsParse:m,longDateFormat:{LT:"HH:mm",LTS:"HH:mm:ss",L:"DD/MM/YYYY",LL:"D [a viz] MMMM YYYY",LLL:"D [a viz] MMMM YYYY HH:mm",LLLL:"dddd, D [a viz] MMMM YYYY HH:mm"},calendar:{sameDay:"[Hiziv da] LT",nextDay:"[Warchoazh da] LT",nextWeek:"dddd [da] LT",lastDay:"[Dech da] LT",lastWeek:"dddd [paset da] LT",sameElse:"L"},relativeTime:{future:"a-benn %s",past:"%s zo",s:"un nebeud segondenno",ss:"%d eilenn",m:"ur vunutenn",mm:relativeTimeWithMutation,h:"un eur",hh:"%d eur",d:"un devezh",dd:relativeTimeWithMutation,M:"ur miz",MM:relativeTimeWithMutation,y:"ur bloaz",yy:function specialMutationForYears(h){switch(function lastNumber(h){return h>9?lastNumber(h%10):h}(h)){case 1:case 3:case 4:case 5:case 9:return h+" bloaz";default:return h+" vloaz"}}},dayOfMonthOrdinalParse:/\d{1,2}(a|vet)/,ordinal:function(h){return h+(1===h?"a":"vet")},week:{dow:1,doy:4},meridiemParse:/a.m.|g.m./,isPM:function(h){return"g.m."===h},meridiem:function(h,m,y){return h<12?"a.m.":"g.m."}})}(y(1))},function(h,m,y){!function(h){"use strict";
//! moment.js locale configuration
function translate(h,m,y){var v=h+" ";switch(y){case"ss":return v+=1===h?"sekunda":2===h||3===h||4===h?"sekunde":"sekundi";case"m":return m?"jedna minuta":"jedne minute";case"mm":return v+=1===h?"minuta":2===h||3===h||4===h?"minute":"minuta";case"h":return m?"jedan sat":"jednog sata";case"hh":return v+=1===h?"sat":2===h||3===h||4===h?"sata":"sati";case"dd":return v+=1===h?"dan":"dana";case"MM":return v+=1===h?"mjesec":2===h||3===h||4===h?"mjeseca":"mjeseci";case"yy":return v+=1===h?"godina":2===h||3===h||4===h?"godine":"godina"}}h.defineLocale("bs",{months:"januar_februar_mart_april_maj_juni_juli_august_septembar_oktobar_novembar_decembar".split("_"),monthsShort:"jan._feb._mar._apr._maj._jun._jul._aug._sep._okt._nov._dec.".split("_"),monthsParseExact:!0,weekdays:"nedjelja_ponedjeljak_utorak_srijeda_etvrtak_petak_subota".split("_"),weekdaysShort:"ned._pon._uto._sri._et._pet._sub.".split("_"),weekdaysMin:"ne_po_ut_sr_e_pe_su".split("_"),weekdaysParseExact:!0,longDateFormat:{LT:"H:mm",LTS:"H:mm:ss",L:"DD.MM.YYYY",LL:"D. MMMM YYYY",LLL:"D. MMMM YYYY H:mm",LLLL:"dddd, D. MMMM YYYY H:mm"},calendar:{sameDay:"[danas u] LT",nextDay:"[sutra u] LT",nextWeek:function(){switch(this.day()){case 0:return"[u] [nedjelju] [u] LT";case 3:return"[u] [srijedu] [u] LT";case 6:return"[u] [subotu] [u] LT";case 1:case 2:case 4:case 5:return"[u] dddd [u] LT"}},lastDay:"[juer u] LT",lastWeek:function(){switch(this.day()){case 0:case 3:return"[prolu] dddd [u] LT";case 6:return"[prole] [subote] [u] LT";case 1:case 2:case 4:case 5:return"[proli] dddd [u] LT"}},sameElse:"L"},relativeTime:{future:"za %s",past:"prije %s",s:"par sekundi",ss:translate,m:translate,mm:translate,h:translate,hh:translate,d:"dan",dd:translate,M:"mjesec",MM:translate,y:"godinu",yy:translate},dayOfMonthOrdinalParse:/\d{1,2}\./,ordinal:"%d.",week:{dow:1,doy:7}})}(y(1))},function(h,m,y){!function(h){"use strict";
//! moment.js locale configuration
h.defineLocale("ca",{months:{standalone:"gener_febrer_mar_abril_maig_juny_juliol_agost_setembre_octubre_novembre_desembre".split("_"),format:"de gener_de febrer_de mar_d'abril_de maig_de juny_de juliol_d'agost_de setembre_d'octubre_de novembre_de desembre".split("_"),isFormat:/D[oD]?(\s)+MMMM/},monthsShort:"gen._febr._mar_abr._maig_juny_jul._ag._set._oct._nov._des.".split("_"),monthsParseExact:!0,weekdays:"diumenge_dilluns_dimarts_dimecres_dijous_divendres_dissabte".split("_"),weekdaysShort:"dg._dl._dt._dc._dj._dv._ds.".split("_"),weekdaysMin:"dg_dl_dt_dc_dj_dv_ds".split("_"),weekdaysParseExact:!0,longDateFormat:{LT:"H:mm",LTS:"H:mm:ss",L:"DD/MM/YYYY",LL:"D MMMM [de] YYYY",ll:"D MMM YYYY",LLL:"D MMMM [de] YYYY [a les] H:mm",lll:"D MMM YYYY, H:mm",LLLL:"dddd D MMMM [de] YYYY [a les] H:mm",llll:"ddd D MMM YYYY, H:mm"},calendar:{sameDay:function(){return"[avui a "+(1!==this.hours()?"les":"la")+"] LT"},nextDay:function(){return"[dem a "+(1!==this.hours()?"les":"la")+"] LT"},nextWeek:function(){return"dddd [a "+(1!==this.hours()?"les":"la")+"] LT"},lastDay:function(){return"[ahir a "+(1!==this.hours()?"les":"la")+"] LT"},lastWeek:function(){return"[el] dddd [passat a "+(1!==this.hours()?"les":"la")+"] LT"},sameElse:"L"},relativeTime:{future:"d'aqu %s",past:"fa %s",s:"uns segons",ss:"%d segons",m:"un minut",mm:"%d minuts",h:"una hora",hh:"%d hores",d:"un dia",dd:"%d dies",M:"un mes",MM:"%d mesos",y:"un any",yy:"%d anys"},dayOfMonthOrdinalParse:/\d{1,2}(r|n|t||a)/,ordinal:function(h,m){var y=1===h?"r":2===h?"n":3===h?"r":4===h?"t":"";return"w"!==m&&"W"!==m||(y="a"),h+y},week:{dow:1,doy:4}})}(y(1))},function(h,m,y){!function(h){"use strict";
//! moment.js locale configuration
var m="leden_nor_bezen_duben_kvten_erven_ervenec_srpen_z_jen_listopad_prosinec".split("_"),y="led_no_be_dub_kv_vn_vc_srp_z_j_lis_pro".split("_"),v=[/^led/i,/^no/i,/^be/i,/^dub/i,/^kv/i,/^(vn|erven$|ervna)/i,/^(vc|ervenec|ervence)/i,/^srp/i,/^z/i,/^j/i,/^lis/i,/^pro/i],C=/^(leden|nor|bezen|duben|kvten|ervenec|ervence|erven|ervna|srpen|z|jen|listopad|prosinec|led|no|be|dub|kv|vn|vc|srp|z|j|lis|pro)/i;function plural(h){return h>1&&h<5&&1!=~~(h/10)}function translate(h,m,y,v){var C=h+" ";switch(y){case"s":return m||v?"pr sekund":"pr sekundami";case"ss":return m||v?C+(plural(h)?"sekundy":"sekund"):C+"sekundami";case"m":return m?"minuta":v?"minutu":"minutou";case"mm":return m||v?C+(plural(h)?"minuty":"minut"):C+"minutami";case"h":return m?"hodina":v?"hodinu":"hodinou";case"hh":return m||v?C+(plural(h)?"hodiny":"hodin"):C+"hodinami";case"d":return m||v?"den":"dnem";case"dd":return m||v?C+(plural(h)?"dny":"dn"):C+"dny";case"M":return m||v?"msc":"mscem";case"MM":return m||v?C+(plural(h)?"msce":"msc"):C+"msci";case"y":return m||v?"rok":"rokem";case"yy":return m||v?C+(plural(h)?"roky":"let"):C+"lety"}}h.defineLocale("cs",{months:m,monthsShort:y,monthsRegex:C,monthsShortRegex:C,monthsStrictRegex:/^(leden|ledna|nora|nor|bezen|bezna|duben|dubna|kvten|kvtna|ervenec|ervence|erven|ervna|srpen|srpna|z|jen|jna|listopadu|listopad|prosinec|prosince)/i,monthsShortStrictRegex:/^(led|no|be|dub|kv|vn|vc|srp|z|j|lis|pro)/i,monthsParse:v,longMonthsParse:v,shortMonthsParse:v,weekdays:"nedle_pondl_ter_steda_tvrtek_ptek_sobota".split("_"),weekdaysShort:"ne_po_t_st_t_p_so".split("_"),weekdaysMin:"ne_po_t_st_t_p_so".split("_"),longDateFormat:{LT:"H:mm",LTS:"H:mm:ss",L:"DD.MM.YYYY",LL:"D. MMMM YYYY",LLL:"D. MMMM YYYY H:mm",LLLL:"dddd D. MMMM YYYY H:mm",l:"D. M. YYYY"},calendar:{sameDay:"[dnes v] LT",nextDay:"[ztra v] LT",nextWeek:function(){switch(this.day()){case 0:return"[v nedli v] LT";case 1:case 2:return"[v] dddd [v] LT";case 3:return"[ve stedu v] LT";case 4:return"[ve tvrtek v] LT";case 5:return"[v ptek v] LT";case 6:return"[v sobotu v] LT"}},lastDay:"[vera v] LT",lastWeek:function(){switch(this.day()){case 0:return"[minulou nedli v] LT";case 1:case 2:return"[minul] dddd [v] LT";case 3:return"[minulou stedu v] LT";case 4:case 5:return"[minul] dddd [v] LT";case 6:return"[minulou sobotu v] LT"}},sameElse:"L"},relativeTime:{future:"za %s",past:"ped %s",s:translate,ss:translate,m:translate,mm:translate,h:translate,hh:translate,d:translate,dd:translate,M:translate,MM:translate,y:translate,yy:translate},dayOfMonthOrdinalParse:/\d{1,2}\./,ordinal:"%d.",week:{dow:1,doy:4}})}(y(1))},function(h,m,y){!function(h){"use strict";
//! moment.js locale configuration
h.defineLocale("cv",{months:"___________".split("_"),monthsShort:"___________".split("_"),weekdays:"______".split("_"),weekdaysShort:"______".split("_"),weekdaysMin:"______".split("_"),longDateFormat:{LT:"HH:mm",LTS:"HH:mm:ss",L:"DD-MM-YYYY",LL:"YYYY [] MMMM [] D[-]",LLL:"YYYY [] MMMM [] D[-], HH:mm",LLLL:"dddd, YYYY [] MMMM [] D[-], HH:mm"},calendar:{sameDay:"[] LT []",nextDay:"[] LT []",lastDay:"[] LT []",nextWeek:"[] dddd LT []",lastWeek:"[] dddd LT []",sameElse:"L"},relativeTime:{future:function(h){return h+(/$/i.exec(h)?"":/$/i.exec(h)?"":"")},past:"%s ",s:"- ",ss:"%d ",m:" ",mm:"%d ",h:" ",hh:"%d ",d:" ",dd:"%d ",M:" ",MM:"%d ",y:" ",yy:"%d "},dayOfMonthOrdinalParse:/\d{1,2}-/,ordinal:"%d-",week:{dow:1,doy:7}})}(y(1))},function(h,m,y){!function(h){"use strict";
//! moment.js locale configuration
h.defineLocale("cy",{months:"Ionawr_Chwefror_Mawrth_Ebrill_Mai_Mehefin_Gorffennaf_Awst_Medi_Hydref_Tachwedd_Rhagfyr".split("_"),monthsShort:"Ion_Chwe_Maw_Ebr_Mai_Meh_Gor_Aws_Med_Hyd_Tach_Rhag".split("_"),weekdays:"Dydd Sul_Dydd Llun_Dydd Mawrth_Dydd Mercher_Dydd Iau_Dydd Gwener_Dydd Sadwrn".split("_"),weekdaysShort:"Sul_Llun_Maw_Mer_Iau_Gwe_Sad".split("_"),weekdaysMin:"Su_Ll_Ma_Me_Ia_Gw_Sa".split("_"),weekdaysParseExact:!0,longDateFormat:{LT:"HH:mm",LTS:"HH:mm:ss",L:"DD/MM/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY HH:mm",LLLL:"dddd, D MMMM YYYY HH:mm"},calendar:{sameDay:"[Heddiw am] LT",nextDay:"[Yfory am] LT",nextWeek:"dddd [am] LT",lastDay:"[Ddoe am] LT",lastWeek:"dddd [diwethaf am] LT",sameElse:"L"},relativeTime:{future:"mewn %s",past:"%s yn l",s:"ychydig eiliadau",ss:"%d eiliad",m:"munud",mm:"%d munud",h:"awr",hh:"%d awr",d:"diwrnod",dd:"%d diwrnod",M:"mis",MM:"%d mis",y:"blwyddyn",yy:"%d flynedd"},dayOfMonthOrdinalParse:/\d{1,2}(fed|ain|af|il|ydd|ed|eg)/,ordinal:function(h){var m="";return h>20?m=40===h||50===h||60===h||80===h||100===h?"fed":"ain":h>0&&(m=["","af","il","ydd","ydd","ed","ed","ed","fed","fed","fed","eg","fed","eg","eg","fed","eg","eg","fed","eg","fed"][h]),h+m},week:{dow:1,doy:4}})}(y(1))},function(h,m,y){!function(h){"use strict";
//! moment.js locale configuration
h.defineLocale("da",{months:"januar_februar_marts_april_maj_juni_juli_august_september_oktober_november_december".split("_"),monthsShort:"jan_feb_mar_apr_maj_jun_jul_aug_sep_okt_nov_dec".split("_"),weekdays:"sndag_mandag_tirsdag_onsdag_torsdag_fredag_lrdag".split("_"),weekdaysShort:"sn_man_tir_ons_tor_fre_lr".split("_"),weekdaysMin:"s_ma_ti_on_to_fr_l".split("_"),longDateFormat:{LT:"HH:mm",LTS:"HH:mm:ss",L:"DD.MM.YYYY",LL:"D. MMMM YYYY",LLL:"D. MMMM YYYY HH:mm",LLLL:"dddd [d.] D. MMMM YYYY [kl.] HH:mm"},calendar:{sameDay:"[i dag kl.] LT",nextDay:"[i morgen kl.] LT",nextWeek:"p dddd [kl.] LT",lastDay:"[i gr kl.] LT",lastWeek:"[i] dddd[s kl.] LT",sameElse:"L"},relativeTime:{future:"om %s",past:"%s siden",s:"f sekunder",ss:"%d sekunder",m:"et minut",mm:"%d minutter",h:"en time",hh:"%d timer",d:"en dag",dd:"%d dage",M:"en mned",MM:"%d mneder",y:"et r",yy:"%d r"},dayOfMonthOrdinalParse:/\d{1,2}\./,ordinal:"%d.",week:{dow:1,doy:4}})}(y(1))},function(h,m,y){!function(h){"use strict";
//! moment.js locale configuration
function processRelativeTime(h,m,y,v){var C={m:["eine Minute","einer Minute"],h:["eine Stunde","einer Stunde"],d:["ein Tag","einem Tag"],dd:[h+" Tage",h+" Tagen"],w:["eine Woche","einer Woche"],M:["ein Monat","einem Monat"],MM:[h+" Monate",h+" Monaten"],y:["ein Jahr","einem Jahr"],yy:[h+" Jahre",h+" Jahren"]};return m?C[y][0]:C[y][1]}h.defineLocale("de",{months:"Januar_Februar_Mrz_April_Mai_Juni_Juli_August_September_Oktober_November_Dezember".split("_"),monthsShort:"Jan._Feb._Mrz_Apr._Mai_Juni_Juli_Aug._Sep._Okt._Nov._Dez.".split("_"),monthsParseExact:!0,weekdays:"Sonntag_Montag_Dienstag_Mittwoch_Donnerstag_Freitag_Samstag".split("_"),weekdaysShort:"So._Mo._Di._Mi._Do._Fr._Sa.".split("_"),weekdaysMin:"So_Mo_Di_Mi_Do_Fr_Sa".split("_"),weekdaysParseExact:!0,longDateFormat:{LT:"HH:mm",LTS:"HH:mm:ss",L:"DD.MM.YYYY",LL:"D. MMMM YYYY",LLL:"D. MMMM YYYY HH:mm",LLLL:"dddd, D. MMMM YYYY HH:mm"},calendar:{sameDay:"[heute um] LT [Uhr]",sameElse:"L",nextDay:"[morgen um] LT [Uhr]",nextWeek:"dddd [um] LT [Uhr]",lastDay:"[gestern um] LT [Uhr]",lastWeek:"[letzten] dddd [um] LT [Uhr]"},relativeTime:{future:"in %s",past:"vor %s",s:"ein paar Sekunden",ss:"%d Sekunden",m:processRelativeTime,mm:"%d Minuten",h:processRelativeTime,hh:"%d Stunden",d:processRelativeTime,dd:processRelativeTime,w:processRelativeTime,ww:"%d Wochen",M:processRelativeTime,MM:processRelativeTime,y:processRelativeTime,yy:processRelativeTime},dayOfMonthOrdinalParse:/\d{1,2}\./,ordinal:"%d.",week:{dow:1,doy:4}})}(y(1))},function(h,m,y){!function(h){"use strict";
//! moment.js locale configuration
function processRelativeTime(h,m,y,v){var C={m:["eine Minute","einer Minute"],h:["eine Stunde","einer Stunde"],d:["ein Tag","einem Tag"],dd:[h+" Tage",h+" Tagen"],w:["eine Woche","einer Woche"],M:["ein Monat","einem Monat"],MM:[h+" Monate",h+" Monaten"],y:["ein Jahr","einem Jahr"],yy:[h+" Jahre",h+" Jahren"]};return m?C[y][0]:C[y][1]}h.defineLocale("de-at",{months:"Jnner_Februar_Mrz_April_Mai_Juni_Juli_August_September_Oktober_November_Dezember".split("_"),monthsShort:"Jn._Feb._Mrz_Apr._Mai_Juni_Juli_Aug._Sep._Okt._Nov._Dez.".split("_"),monthsParseExact:!0,weekdays:"Sonntag_Montag_Dienstag_Mittwoch_Donnerstag_Freitag_Samstag".split("_"),weekdaysShort:"So._Mo._Di._Mi._Do._Fr._Sa.".split("_"),weekdaysMin:"So_Mo_Di_Mi_Do_Fr_Sa".split("_"),weekdaysParseExact:!0,longDateFormat:{LT:"HH:mm",LTS:"HH:mm:ss",L:"DD.MM.YYYY",LL:"D. MMMM YYYY",LLL:"D. MMMM YYYY HH:mm",LLLL:"dddd, D. MMMM YYYY HH:mm"},calendar:{sameDay:"[heute um] LT [Uhr]",sameElse:"L",nextDay:"[morgen um] LT [Uhr]",nextWeek:"dddd [um] LT [Uhr]",lastDay:"[gestern um] LT [Uhr]",lastWeek:"[letzten] dddd [um] LT [Uhr]"},relativeTime:{future:"in %s",past:"vor %s",s:"ein paar Sekunden",ss:"%d Sekunden",m:processRelativeTime,mm:"%d Minuten",h:processRelativeTime,hh:"%d Stunden",d:processRelativeTime,dd:processRelativeTime,w:processRelativeTime,ww:"%d Wochen",M:processRelativeTime,MM:processRelativeTime,y:processRelativeTime,yy:processRelativeTime},dayOfMonthOrdinalParse:/\d{1,2}\./,ordinal:"%d.",week:{dow:1,doy:4}})}(y(1))},function(h,m,y){!function(h){"use strict";
//! moment.js locale configuration
function processRelativeTime(h,m,y,v){var C={m:["eine Minute","einer Minute"],h:["eine Stunde","einer Stunde"],d:["ein Tag","einem Tag"],dd:[h+" Tage",h+" Tagen"],w:["eine Woche","einer Woche"],M:["ein Monat","einem Monat"],MM:[h+" Monate",h+" Monaten"],y:["ein Jahr","einem Jahr"],yy:[h+" Jahre",h+" Jahren"]};return m?C[y][0]:C[y][1]}h.defineLocale("de-ch",{months:"Januar_Februar_Mrz_April_Mai_Juni_Juli_August_September_Oktober_November_Dezember".split("_"),monthsShort:"Jan._Feb._Mrz_Apr._Mai_Juni_Juli_Aug._Sep._Okt._Nov._Dez.".split("_"),monthsParseExact:!0,weekdays:"Sonntag_Montag_Dienstag_Mittwoch_Donnerstag_Freitag_Samstag".split("_"),weekdaysShort:"So_Mo_Di_Mi_Do_Fr_Sa".split("_"),weekdaysMin:"So_Mo_Di_Mi_Do_Fr_Sa".split("_"),weekdaysParseExact:!0,longDateFormat:{LT:"HH:mm",LTS:"HH:mm:ss",L:"DD.MM.YYYY",LL:"D. MMMM YYYY",LLL:"D. MMMM YYYY HH:mm",LLLL:"dddd, D. MMMM YYYY HH:mm"},calendar:{sameDay:"[heute um] LT [Uhr]",sameElse:"L",nextDay:"[morgen um] LT [Uhr]",nextWeek:"dddd [um] LT [Uhr]",lastDay:"[gestern um] LT [Uhr]",lastWeek:"[letzten] dddd [um] LT [Uhr]"},relativeTime:{future:"in %s",past:"vor %s",s:"ein paar Sekunden",ss:"%d Sekunden",m:processRelativeTime,mm:"%d Minuten",h:processRelativeTime,hh:"%d Stunden",d:processRelativeTime,dd:processRelativeTime,w:processRelativeTime,ww:"%d Wochen",M:processRelativeTime,MM:processRelativeTime,y:processRelativeTime,yy:processRelativeTime},dayOfMonthOrdinalParse:/\d{1,2}\./,ordinal:"%d.",week:{dow:1,doy:4}})}(y(1))},function(h,m,y){!function(h){"use strict";
//! moment.js locale configuration
var m=["","","","","","","","","","","",""],y=["","","","","","",""];h.defineLocale("dv",{months:m,monthsShort:m,weekdays:y,weekdaysShort:y,weekdaysMin:"______".split("_"),longDateFormat:{LT:"HH:mm",LTS:"HH:mm:ss",L:"D/M/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY HH:mm",LLLL:"dddd D MMMM YYYY HH:mm"},meridiemParse:/|/,isPM:function(h){return""===h},meridiem:function(h,m,y){return h<12?"":""},calendar:{sameDay:"[] LT",nextDay:"[] LT",nextWeek:"dddd LT",lastDay:"[] LT",lastWeek:"[] dddd LT",sameElse:"L"},relativeTime:{future:" %s",past:" %s",s:"",ss:"d% ",m:"",mm:" %d",h:"",hh:" %d",d:"",dd:" %d",M:"",MM:" %d",y:"",yy:" %d"},preparse:function(h){return h.replace(//g,",")},postformat:function(h){return h.replace(/,/g,"")},week:{dow:7,doy:12}})}(y(1))},function(h,m,y){!function(h){"use strict";
//! moment.js locale configuration
h.defineLocale("el",{monthsNominativeEl:"___________".split("_"),monthsGenitiveEl:"___________".split("_"),months:function(h,m){return h?"string"==typeof m&&/D/.test(m.substring(0,m.indexOf("MMMM")))?this._monthsGenitiveEl[h.month()]:this._monthsNominativeEl[h.month()]:this._monthsNominativeEl},monthsShort:"___________".split("_"),weekdays:"______".split("_"),weekdaysShort:"______".split("_"),weekdaysMin:"______".split("_"),meridiem:function(h,m,y){return h>11?y?"":"":y?"":""},isPM:function(h){return""===(h+"").toLowerCase()[0]},meridiemParse:/[]\.??\.?/i,longDateFormat:{LT:"h:mm A",LTS:"h:mm:ss A",L:"DD/MM/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY h:mm A",LLLL:"dddd, D MMMM YYYY h:mm A"},calendarEl:{sameDay:"[ {}] LT",nextDay:"[ {}] LT",nextWeek:"dddd [{}] LT",lastDay:"[ {}] LT",lastWeek:function(){switch(this.day()){case 6:return"[ ] dddd [{}] LT";default:return"[ ] dddd [{}] LT"}},sameElse:"L"},calendar:function(h,m){var y=this._calendarEl[h],v=m&&m.hours();return function isFunction(h){return"undefined"!=typeof Function&&h instanceof Function||"[object Function]"===Object.prototype.toString.call(h)}(y)&&(y=y.apply(m)),y.replace("{}",v%12==1?"":"")},relativeTime:{future:" %s",past:"%s ",s:" ",ss:"%d ",m:" ",mm:"%d ",h:" ",hh:"%d ",d:" ",dd:"%d ",M:" ",MM:"%d ",y:" ",yy:"%d "},dayOfMonthOrdinalParse:/\d{1,2}/,ordinal:"%d",week:{dow:1,doy:4}})}(y(1))},function(h,m,y){!function(h){"use strict";
//! moment.js locale configuration
h.defineLocale("en-au",{months:"January_February_March_April_May_June_July_August_September_October_November_December".split("_"),monthsShort:"Jan_Feb_Mar_Apr_May_Jun_Jul_Aug_Sep_Oct_Nov_Dec".split("_"),weekdays:"Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_"),weekdaysShort:"Sun_Mon_Tue_Wed_Thu_Fri_Sat".split("_"),weekdaysMin:"Su_Mo_Tu_We_Th_Fr_Sa".split("_"),longDateFormat:{LT:"h:mm A",LTS:"h:mm:ss A",L:"DD/MM/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY h:mm A",LLLL:"dddd, D MMMM YYYY h:mm A"},calendar:{sameDay:"[Today at] LT",nextDay:"[Tomorrow at] LT",nextWeek:"dddd [at] LT",lastDay:"[Yesterday at] LT",lastWeek:"[Last] dddd [at] LT",sameElse:"L"},relativeTime:{future:"in %s",past:"%s ago",s:"a few seconds",ss:"%d seconds",m:"a minute",mm:"%d minutes",h:"an hour",hh:"%d hours",d:"a day",dd:"%d days",M:"a month",MM:"%d months",y:"a year",yy:"%d years"},dayOfMonthOrdinalParse:/\d{1,2}(st|nd|rd|th)/,ordinal:function(h){var m=h%10;return h+(1==~~(h%100/10)?"th":1===m?"st":2===m?"nd":3===m?"rd":"th")},week:{dow:0,doy:4}})}(y(1))},function(h,m,y){!function(h){"use strict";
//! moment.js locale configuration
h.defineLocale("en-ca",{months:"January_February_March_April_May_June_July_August_September_October_November_December".split("_"),monthsShort:"Jan_Feb_Mar_Apr_May_Jun_Jul_Aug_Sep_Oct_Nov_Dec".split("_"),weekdays:"Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_"),weekdaysShort:"Sun_Mon_Tue_Wed_Thu_Fri_Sat".split("_"),weekdaysMin:"Su_Mo_Tu_We_Th_Fr_Sa".split("_"),longDateFormat:{LT:"h:mm A",LTS:"h:mm:ss A",L:"YYYY-MM-DD",LL:"MMMM D, YYYY",LLL:"MMMM D, YYYY h:mm A",LLLL:"dddd, MMMM D, YYYY h:mm A"},calendar:{sameDay:"[Today at] LT",nextDay:"[Tomorrow at] LT",nextWeek:"dddd [at] LT",lastDay:"[Yesterday at] LT",lastWeek:"[Last] dddd [at] LT",sameElse:"L"},relativeTime:{future:"in %s",past:"%s ago",s:"a few seconds",ss:"%d seconds",m:"a minute",mm:"%d minutes",h:"an hour",hh:"%d hours",d:"a day",dd:"%d days",M:"a month",MM:"%d months",y:"a year",yy:"%d years"},dayOfMonthOrdinalParse:/\d{1,2}(st|nd|rd|th)/,ordinal:function(h){var m=h%10;return h+(1==~~(h%100/10)?"th":1===m?"st":2===m?"nd":3===m?"rd":"th")}})}(y(1))},function(h,m,y){!function(h){"use strict";
//! moment.js locale configuration
h.defineLocale("en-gb",{months:"January_February_March_April_May_June_July_August_September_October_November_December".split("_"),monthsShort:"Jan_Feb_Mar_Apr_May_Jun_Jul_Aug_Sep_Oct_Nov_Dec".split("_"),weekdays:"Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_"),weekdaysShort:"Sun_Mon_Tue_Wed_Thu_Fri_Sat".split("_"),weekdaysMin:"Su_Mo_Tu_We_Th_Fr_Sa".split("_"),longDateFormat:{LT:"HH:mm",LTS:"HH:mm:ss",L:"DD/MM/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY HH:mm",LLLL:"dddd, D MMMM YYYY HH:mm"},calendar:{sameDay:"[Today at] LT",nextDay:"[Tomorrow at] LT",nextWeek:"dddd [at] LT",lastDay:"[Yesterday at] LT",lastWeek:"[Last] dddd [at] LT",sameElse:"L"},relativeTime:{future:"in %s",past:"%s ago",s:"a few seconds",ss:"%d seconds",m:"a minute",mm:"%d minutes",h:"an hour",hh:"%d hours",d:"a day",dd:"%d days",M:"a month",MM:"%d months",y:"a year",yy:"%d years"},dayOfMonthOrdinalParse:/\d{1,2}(st|nd|rd|th)/,ordinal:function(h){var m=h%10;return h+(1==~~(h%100/10)?"th":1===m?"st":2===m?"nd":3===m?"rd":"th")},week:{dow:1,doy:4}})}(y(1))},function(h,m,y){!function(h){"use strict";
//! moment.js locale configuration
h.defineLocale("en-ie",{months:"January_February_March_April_May_June_July_August_September_October_November_December".split("_"),monthsShort:"Jan_Feb_Mar_Apr_May_Jun_Jul_Aug_Sep_Oct_Nov_Dec".split("_"),weekdays:"Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_"),weekdaysShort:"Sun_Mon_Tue_Wed_Thu_Fri_Sat".split("_"),weekdaysMin:"Su_Mo_Tu_We_Th_Fr_Sa".split("_"),longDateFormat:{LT:"HH:mm",LTS:"HH:mm:ss",L:"DD/MM/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY HH:mm",LLLL:"dddd D MMMM YYYY HH:mm"},calendar:{sameDay:"[Today at] LT",nextDay:"[Tomorrow at] LT",nextWeek:"dddd [at] LT",lastDay:"[Yesterday at] LT",lastWeek:"[Last] dddd [at] LT",sameElse:"L"},relativeTime:{future:"in %s",past:"%s ago",s:"a few seconds",ss:"%d seconds",m:"a minute",mm:"%d minutes",h:"an hour",hh:"%d hours",d:"a day",dd:"%d days",M:"a month",MM:"%d months",y:"a year",yy:"%d years"},dayOfMonthOrdinalParse:/\d{1,2}(st|nd|rd|th)/,ordinal:function(h){var m=h%10;return h+(1==~~(h%100/10)?"th":1===m?"st":2===m?"nd":3===m?"rd":"th")},week:{dow:1,doy:4}})}(y(1))},function(h,m,y){!function(h){"use strict";
//! moment.js locale configuration
h.defineLocale("en-il",{months:"January_February_March_April_May_June_July_August_September_October_November_December".split("_"),monthsShort:"Jan_Feb_Mar_Apr_May_Jun_Jul_Aug_Sep_Oct_Nov_Dec".split("_"),weekdays:"Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_"),weekdaysShort:"Sun_Mon_Tue_Wed_Thu_Fri_Sat".split("_"),weekdaysMin:"Su_Mo_Tu_We_Th_Fr_Sa".split("_"),longDateFormat:{LT:"HH:mm",LTS:"HH:mm:ss",L:"DD/MM/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY HH:mm",LLLL:"dddd, D MMMM YYYY HH:mm"},calendar:{sameDay:"[Today at] LT",nextDay:"[Tomorrow at] LT",nextWeek:"dddd [at] LT",lastDay:"[Yesterday at] LT",lastWeek:"[Last] dddd [at] LT",sameElse:"L"},relativeTime:{future:"in %s",past:"%s ago",s:"a few seconds",ss:"%d seconds",m:"a minute",mm:"%d minutes",h:"an hour",hh:"%d hours",d:"a day",dd:"%d days",M:"a month",MM:"%d months",y:"a year",yy:"%d years"},dayOfMonthOrdinalParse:/\d{1,2}(st|nd|rd|th)/,ordinal:function(h){var m=h%10;return h+(1==~~(h%100/10)?"th":1===m?"st":2===m?"nd":3===m?"rd":"th")}})}(y(1))},function(h,m,y){!function(h){"use strict";
//! moment.js locale configuration
h.defineLocale("en-in",{months:"January_February_March_April_May_June_July_August_September_October_November_December".split("_"),monthsShort:"Jan_Feb_Mar_Apr_May_Jun_Jul_Aug_Sep_Oct_Nov_Dec".split("_"),weekdays:"Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_"),weekdaysShort:"Sun_Mon_Tue_Wed_Thu_Fri_Sat".split("_"),weekdaysMin:"Su_Mo_Tu_We_Th_Fr_Sa".split("_"),longDateFormat:{LT:"h:mm A",LTS:"h:mm:ss A",L:"DD/MM/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY h:mm A",LLLL:"dddd, D MMMM YYYY h:mm A"},calendar:{sameDay:"[Today at] LT",nextDay:"[Tomorrow at] LT",nextWeek:"dddd [at] LT",lastDay:"[Yesterday at] LT",lastWeek:"[Last] dddd [at] LT",sameElse:"L"},relativeTime:{future:"in %s",past:"%s ago",s:"a few seconds",ss:"%d seconds",m:"a minute",mm:"%d minutes",h:"an hour",hh:"%d hours",d:"a day",dd:"%d days",M:"a month",MM:"%d months",y:"a year",yy:"%d years"},dayOfMonthOrdinalParse:/\d{1,2}(st|nd|rd|th)/,ordinal:function(h){var m=h%10;return h+(1==~~(h%100/10)?"th":1===m?"st":2===m?"nd":3===m?"rd":"th")},week:{dow:0,doy:6}})}(y(1))},function(h,m,y){!function(h){"use strict";
//! moment.js locale configuration
h.defineLocale("en-nz",{months:"January_February_March_April_May_June_July_August_September_October_November_December".split("_"),monthsShort:"Jan_Feb_Mar_Apr_May_Jun_Jul_Aug_Sep_Oct_Nov_Dec".split("_"),weekdays:"Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_"),weekdaysShort:"Sun_Mon_Tue_Wed_Thu_Fri_Sat".split("_"),weekdaysMin:"Su_Mo_Tu_We_Th_Fr_Sa".split("_"),longDateFormat:{LT:"h:mm A",LTS:"h:mm:ss A",L:"DD/MM/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY h:mm A",LLLL:"dddd, D MMMM YYYY h:mm A"},calendar:{sameDay:"[Today at] LT",nextDay:"[Tomorrow at] LT",nextWeek:"dddd [at] LT",lastDay:"[Yesterday at] LT",lastWeek:"[Last] dddd [at] LT",sameElse:"L"},relativeTime:{future:"in %s",past:"%s ago",s:"a few seconds",ss:"%d seconds",m:"a minute",mm:"%d minutes",h:"an hour",hh:"%d hours",d:"a day",dd:"%d days",M:"a month",MM:"%d months",y:"a year",yy:"%d years"},dayOfMonthOrdinalParse:/\d{1,2}(st|nd|rd|th)/,ordinal:function(h){var m=h%10;return h+(1==~~(h%100/10)?"th":1===m?"st":2===m?"nd":3===m?"rd":"th")},week:{dow:1,doy:4}})}(y(1))},function(h,m,y){!function(h){"use strict";
//! moment.js locale configuration
h.defineLocale("en-sg",{months:"January_February_March_April_May_June_July_August_September_October_November_December".split("_"),monthsShort:"Jan_Feb_Mar_Apr_May_Jun_Jul_Aug_Sep_Oct_Nov_Dec".split("_"),weekdays:"Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_"),weekdaysShort:"Sun_Mon_Tue_Wed_Thu_Fri_Sat".split("_"),weekdaysMin:"Su_Mo_Tu_We_Th_Fr_Sa".split("_"),longDateFormat:{LT:"HH:mm",LTS:"HH:mm:ss",L:"DD/MM/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY HH:mm",LLLL:"dddd, D MMMM YYYY HH:mm"},calendar:{sameDay:"[Today at] LT",nextDay:"[Tomorrow at] LT",nextWeek:"dddd [at] LT",lastDay:"[Yesterday at] LT",lastWeek:"[Last] dddd [at] LT",sameElse:"L"},relativeTime:{future:"in %s",past:"%s ago",s:"a few seconds",ss:"%d seconds",m:"a minute",mm:"%d minutes",h:"an hour",hh:"%d hours",d:"a day",dd:"%d days",M:"a month",MM:"%d months",y:"a year",yy:"%d years"},dayOfMonthOrdinalParse:/\d{1,2}(st|nd|rd|th)/,ordinal:function(h){var m=h%10;return h+(1==~~(h%100/10)?"th":1===m?"st":2===m?"nd":3===m?"rd":"th")},week:{dow:1,doy:4}})}(y(1))},function(h,m,y){!function(h){"use strict";
//! moment.js locale configuration
h.defineLocale("eo",{months:"januaro_februaro_marto_aprilo_majo_junio_julio_agusto_septembro_oktobro_novembro_decembro".split("_"),monthsShort:"jan_feb_mart_apr_maj_jun_jul_ag_sept_okt_nov_dec".split("_"),weekdays:"dimano_lundo_mardo_merkredo_ado_vendredo_sabato".split("_"),weekdaysShort:"dim_lun_mard_merk_a_ven_sab".split("_"),weekdaysMin:"di_lu_ma_me_a_ve_sa".split("_"),longDateFormat:{LT:"HH:mm",LTS:"HH:mm:ss",L:"YYYY-MM-DD",LL:"[la] D[-an de] MMMM, YYYY",LLL:"[la] D[-an de] MMMM, YYYY HH:mm",LLLL:"dddd[n], [la] D[-an de] MMMM, YYYY HH:mm",llll:"ddd, [la] D[-an de] MMM, YYYY HH:mm"},meridiemParse:/[ap]\.t\.m/i,isPM:function(h){return"p"===h.charAt(0).toLowerCase()},meridiem:function(h,m,y){return h>11?y?"p.t.m.":"P.T.M.":y?"a.t.m.":"A.T.M."},calendar:{sameDay:"[Hodia je] LT",nextDay:"[Morga je] LT",nextWeek:"dddd[n je] LT",lastDay:"[Hiera je] LT",lastWeek:"[pasintan] dddd[n je] LT",sameElse:"L"},relativeTime:{future:"post %s",past:"anta %s",s:"kelkaj sekundoj",ss:"%d sekundoj",m:"unu minuto",mm:"%d minutoj",h:"unu horo",hh:"%d horoj",d:"unu tago",dd:"%d tagoj",M:"unu monato",MM:"%d monatoj",y:"unu jaro",yy:"%d jaroj"},dayOfMonthOrdinalParse:/\d{1,2}a/,ordinal:"%da",week:{dow:1,doy:7}})}(y(1))},function(h,m,y){!function(h){"use strict";
//! moment.js locale configuration
var m="ene._feb._mar._abr._may._jun._jul._ago._sep._oct._nov._dic.".split("_"),y="ene_feb_mar_abr_may_jun_jul_ago_sep_oct_nov_dic".split("_"),v=[/^ene/i,/^feb/i,/^mar/i,/^abr/i,/^may/i,/^jun/i,/^jul/i,/^ago/i,/^sep/i,/^oct/i,/^nov/i,/^dic/i],C=/^(enero|febrero|marzo|abril|mayo|junio|julio|agosto|septiembre|octubre|noviembre|diciembre|ene\.?|feb\.?|mar\.?|abr\.?|may\.?|jun\.?|jul\.?|ago\.?|sep\.?|oct\.?|nov\.?|dic\.?)/i;h.defineLocale("es",{months:"enero_febrero_marzo_abril_mayo_junio_julio_agosto_septiembre_octubre_noviembre_diciembre".split("_"),monthsShort:function(h,v){return h?/-MMM-/.test(v)?y[h.month()]:m[h.month()]:m},monthsRegex:C,monthsShortRegex:C,monthsStrictRegex:/^(enero|febrero|marzo|abril|mayo|junio|julio|agosto|septiembre|octubre|noviembre|diciembre)/i,monthsShortStrictRegex:/^(ene\.?|feb\.?|mar\.?|abr\.?|may\.?|jun\.?|jul\.?|ago\.?|sep\.?|oct\.?|nov\.?|dic\.?)/i,monthsParse:v,longMonthsParse:v,shortMonthsParse:v,weekdays:"domingo_lunes_martes_mircoles_jueves_viernes_sbado".split("_"),weekdaysShort:"dom._lun._mar._mi._jue._vie._sb.".split("_"),weekdaysMin:"do_lu_ma_mi_ju_vi_s".split("_"),weekdaysParseExact:!0,longDateFormat:{LT:"H:mm",LTS:"H:mm:ss",L:"DD/MM/YYYY",LL:"D [de] MMMM [de] YYYY",LLL:"D [de] MMMM [de] YYYY H:mm",LLLL:"dddd, D [de] MMMM [de] YYYY H:mm"},calendar:{sameDay:function(){return"[hoy a la"+(1!==this.hours()?"s":"")+"] LT"},nextDay:function(){return"[maana a la"+(1!==this.hours()?"s":"")+"] LT"},nextWeek:function(){return"dddd [a la"+(1!==this.hours()?"s":"")+"] LT"},lastDay:function(){return"[ayer a la"+(1!==this.hours()?"s":"")+"] LT"},lastWeek:function(){return"[el] dddd [pasado a la"+(1!==this.hours()?"s":"")+"] LT"},sameElse:"L"},relativeTime:{future:"en %s",past:"hace %s",s:"unos segundos",ss:"%d segundos",m:"un minuto",mm:"%d minutos",h:"una hora",hh:"%d horas",d:"un da",dd:"%d das",M:"un mes",MM:"%d meses",y:"un ao",yy:"%d aos"},dayOfMonthOrdinalParse:/\d{1,2}/,ordinal:"%d",week:{dow:1,doy:4},invalidDate:"Fecha invalida"})}(y(1))},function(h,m,y){!function(h){"use strict";
//! moment.js locale configuration
var m="ene._feb._mar._abr._may._jun._jul._ago._sep._oct._nov._dic.".split("_"),y="ene_feb_mar_abr_may_jun_jul_ago_sep_oct_nov_dic".split("_"),v=[/^ene/i,/^feb/i,/^mar/i,/^abr/i,/^may/i,/^jun/i,/^jul/i,/^ago/i,/^sep/i,/^oct/i,/^nov/i,/^dic/i],C=/^(enero|febrero|marzo|abril|mayo|junio|julio|agosto|septiembre|octubre|noviembre|diciembre|ene\.?|feb\.?|mar\.?|abr\.?|may\.?|jun\.?|jul\.?|ago\.?|sep\.?|oct\.?|nov\.?|dic\.?)/i;h.defineLocale("es-do",{months:"enero_febrero_marzo_abril_mayo_junio_julio_agosto_septiembre_octubre_noviembre_diciembre".split("_"),monthsShort:function(h,v){return h?/-MMM-/.test(v)?y[h.month()]:m[h.month()]:m},monthsRegex:C,monthsShortRegex:C,monthsStrictRegex:/^(enero|febrero|marzo|abril|mayo|junio|julio|agosto|septiembre|octubre|noviembre|diciembre)/i,monthsShortStrictRegex:/^(ene\.?|feb\.?|mar\.?|abr\.?|may\.?|jun\.?|jul\.?|ago\.?|sep\.?|oct\.?|nov\.?|dic\.?)/i,monthsParse:v,longMonthsParse:v,shortMonthsParse:v,weekdays:"domingo_lunes_martes_mircoles_jueves_viernes_sbado".split("_"),weekdaysShort:"dom._lun._mar._mi._jue._vie._sb.".split("_"),weekdaysMin:"do_lu_ma_mi_ju_vi_s".split("_"),weekdaysParseExact:!0,longDateFormat:{LT:"h:mm A",LTS:"h:mm:ss A",L:"DD/MM/YYYY",LL:"D [de] MMMM [de] YYYY",LLL:"D [de] MMMM [de] YYYY h:mm A",LLLL:"dddd, D [de] MMMM [de] YYYY h:mm A"},calendar:{sameDay:function(){return"[hoy a la"+(1!==this.hours()?"s":"")+"] LT"},nextDay:function(){return"[maana a la"+(1!==this.hours()?"s":"")+"] LT"},nextWeek:function(){return"dddd [a la"+(1!==this.hours()?"s":"")+"] LT"},lastDay:function(){return"[ayer a la"+(1!==this.hours()?"s":"")+"] LT"},lastWeek:function(){return"[el] dddd [pasado a la"+(1!==this.hours()?"s":"")+"] LT"},sameElse:"L"},relativeTime:{future:"en %s",past:"hace %s",s:"unos segundos",ss:"%d segundos",m:"un minuto",mm:"%d minutos",h:"una hora",hh:"%d horas",d:"un da",dd:"%d das",M:"un mes",MM:"%d meses",y:"un ao",yy:"%d aos"},dayOfMonthOrdinalParse:/\d{1,2}/,ordinal:"%d",week:{dow:1,doy:4}})}(y(1))},function(h,m,y){!function(h){"use strict";
//! moment.js locale configuration
var m="ene._feb._mar._abr._may._jun._jul._ago._sep._oct._nov._dic.".split("_"),y="ene_feb_mar_abr_may_jun_jul_ago_sep_oct_nov_dic".split("_"),v=[/^ene/i,/^feb/i,/^mar/i,/^abr/i,/^may/i,/^jun/i,/^jul/i,/^ago/i,/^sep/i,/^oct/i,/^nov/i,/^dic/i],C=/^(enero|febrero|marzo|abril|mayo|junio|julio|agosto|septiembre|octubre|noviembre|diciembre|ene\.?|feb\.?|mar\.?|abr\.?|may\.?|jun\.?|jul\.?|ago\.?|sep\.?|oct\.?|nov\.?|dic\.?)/i;h.defineLocale("es-us",{months:"enero_febrero_marzo_abril_mayo_junio_julio_agosto_septiembre_octubre_noviembre_diciembre".split("_"),monthsShort:function(h,v){return h?/-MMM-/.test(v)?y[h.month()]:m[h.month()]:m},monthsRegex:C,monthsShortRegex:C,monthsStrictRegex:/^(enero|febrero|marzo|abril|mayo|junio|julio|agosto|septiembre|octubre|noviembre|diciembre)/i,monthsShortStrictRegex:/^(ene\.?|feb\.?|mar\.?|abr\.?|may\.?|jun\.?|jul\.?|ago\.?|sep\.?|oct\.?|nov\.?|dic\.?)/i,monthsParse:v,longMonthsParse:v,shortMonthsParse:v,weekdays:"domingo_lunes_martes_mircoles_jueves_viernes_sbado".split("_"),weekdaysShort:"dom._lun._mar._mi._jue._vie._sb.".split("_"),weekdaysMin:"do_lu_ma_mi_ju_vi_s".split("_"),weekdaysParseExact:!0,longDateFormat:{LT:"h:mm A",LTS:"h:mm:ss A",L:"MM/DD/YYYY",LL:"D [de] MMMM [de] YYYY",LLL:"D [de] MMMM [de] YYYY h:mm A",LLLL:"dddd, D [de] MMMM [de] YYYY h:mm A"},calendar:{sameDay:function(){return"[hoy a la"+(1!==this.hours()?"s":"")+"] LT"},nextDay:function(){return"[maana a la"+(1!==this.hours()?"s":"")+"] LT"},nextWeek:function(){return"dddd [a la"+(1!==this.hours()?"s":"")+"] LT"},lastDay:function(){return"[ayer a la"+(1!==this.hours()?"s":"")+"] LT"},lastWeek:function(){return"[el] dddd [pasado a la"+(1!==this.hours()?"s":"")+"] LT"},sameElse:"L"},relativeTime:{future:"en %s",past:"hace %s",s:"unos segundos",ss:"%d segundos",m:"un minuto",mm:"%d minutos",h:"una hora",hh:"%d horas",d:"un da",dd:"%d das",M:"un mes",MM:"%d meses",y:"un ao",yy:"%d aos"},dayOfMonthOrdinalParse:/\d{1,2}/,ordinal:"%d",week:{dow:0,doy:6}})}(y(1))},function(h,m,y){!function(h){"use strict";
//! moment.js locale configuration
function processRelativeTime(h,m,y,v){var C={s:["mne sekundi","mni sekund","paar sekundit"],ss:[h+"sekundi",h+"sekundit"],m:["he minuti","ks minut"],mm:[h+" minuti",h+" minutit"],h:["he tunni","tund aega","ks tund"],hh:[h+" tunni",h+" tundi"],d:["he peva","ks pev"],M:["kuu aja","kuu aega","ks kuu"],MM:[h+" kuu",h+" kuud"],y:["he aasta","aasta","ks aasta"],yy:[h+" aasta",h+" aastat"]};return m?C[y][2]?C[y][2]:C[y][1]:v?C[y][0]:C[y][1]}h.defineLocale("et",{months:"jaanuar_veebruar_mrts_aprill_mai_juuni_juuli_august_september_oktoober_november_detsember".split("_"),monthsShort:"jaan_veebr_mrts_apr_mai_juuni_juuli_aug_sept_okt_nov_dets".split("_"),weekdays:"phapev_esmaspev_teisipev_kolmapev_neljapev_reede_laupev".split("_"),weekdaysShort:"P_E_T_K_N_R_L".split("_"),weekdaysMin:"P_E_T_K_N_R_L".split("_"),longDateFormat:{LT:"H:mm",LTS:"H:mm:ss",L:"DD.MM.YYYY",LL:"D. MMMM YYYY",LLL:"D. MMMM YYYY H:mm",LLLL:"dddd, D. MMMM YYYY H:mm"},calendar:{sameDay:"[Tna,] LT",nextDay:"[Homme,] LT",nextWeek:"[Jrgmine] dddd LT",lastDay:"[Eile,] LT",lastWeek:"[Eelmine] dddd LT",sameElse:"L"},relativeTime:{future:"%s prast",past:"%s tagasi",s:processRelativeTime,ss:processRelativeTime,m:processRelativeTime,mm:processRelativeTime,h:processRelativeTime,hh:processRelativeTime,d:processRelativeTime,dd:"%d peva",M:processRelativeTime,MM:processRelativeTime,y:processRelativeTime,yy:processRelativeTime},dayOfMonthOrdinalParse:/\d{1,2}\./,ordinal:"%d.",week:{dow:1,doy:4}})}(y(1))},function(h,m,y){!function(h){"use strict";
//! moment.js locale configuration
h.defineLocale("eu",{months:"urtarrila_otsaila_martxoa_apirila_maiatza_ekaina_uztaila_abuztua_iraila_urria_azaroa_abendua".split("_"),monthsShort:"urt._ots._mar._api._mai._eka._uzt._abu._ira._urr._aza._abe.".split("_"),monthsParseExact:!0,weekdays:"igandea_astelehena_asteartea_asteazkena_osteguna_ostirala_larunbata".split("_"),weekdaysShort:"ig._al._ar._az._og._ol._lr.".split("_"),weekdaysMin:"ig_al_ar_az_og_ol_lr".split("_"),weekdaysParseExact:!0,longDateFormat:{LT:"HH:mm",LTS:"HH:mm:ss",L:"YYYY-MM-DD",LL:"YYYY[ko] MMMM[ren] D[a]",LLL:"YYYY[ko] MMMM[ren] D[a] HH:mm",LLLL:"dddd, YYYY[ko] MMMM[ren] D[a] HH:mm",l:"YYYY-M-D",ll:"YYYY[ko] MMM D[a]",lll:"YYYY[ko] MMM D[a] HH:mm",llll:"ddd, YYYY[ko] MMM D[a] HH:mm"},calendar:{sameDay:"[gaur] LT[etan]",nextDay:"[bihar] LT[etan]",nextWeek:"dddd LT[etan]",lastDay:"[atzo] LT[etan]",lastWeek:"[aurreko] dddd LT[etan]",sameElse:"L"},relativeTime:{future:"%s barru",past:"duela %s",s:"segundo batzuk",ss:"%d segundo",m:"minutu bat",mm:"%d minutu",h:"ordu bat",hh:"%d ordu",d:"egun bat",dd:"%d egun",M:"hilabete bat",MM:"%d hilabete",y:"urte bat",yy:"%d urte"},dayOfMonthOrdinalParse:/\d{1,2}\./,ordinal:"%d.",week:{dow:1,doy:7}})}(y(1))},function(h,m,y){!function(h){"use strict";
//! moment.js locale configuration
var m={1:"",2:"",3:"",4:"",5:"",6:"",7:"",8:"",9:"",0:""},y={"":"1","":"2","":"3","":"4","":"5","":"6","":"7","":"8","":"9","":"0"};h.defineLocale("fa",{months:"___________".split("_"),monthsShort:"___________".split("_"),weekdays:"______".split("_"),weekdaysShort:"______".split("_"),weekdaysMin:"______".split("_"),weekdaysParseExact:!0,longDateFormat:{LT:"HH:mm",LTS:"HH:mm:ss",L:"DD/MM/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY HH:mm",LLLL:"dddd, D MMMM YYYY HH:mm"},meridiemParse:/  |  /,isPM:function(h){return/  /.test(h)},meridiem:function(h,m,y){return h<12?"  ":"  "},calendar:{sameDay:"[ ] LT",nextDay:"[ ] LT",nextWeek:"dddd [] LT",lastDay:"[ ] LT",lastWeek:"dddd [] [] LT",sameElse:"L"},relativeTime:{future:" %s",past:"%s ",s:" ",ss:"%d ",m:" ",mm:"%d ",h:" ",hh:"%d ",d:" ",dd:"%d ",M:" ",MM:"%d ",y:" ",yy:"%d "},preparse:function(h){return h.replace(/[-]/g,(function(h){return y[h]})).replace(//g,",")},postformat:function(h){return h.replace(/\d/g,(function(h){return m[h]})).replace(/,/g,"")},dayOfMonthOrdinalParse:/\d{1,2}/,ordinal:"%d",week:{dow:6,doy:12}})}(y(1))},function(h,m,y){!function(h){"use strict";
//! moment.js locale configuration
var m="nolla yksi kaksi kolme nelj viisi kuusi seitsemn kahdeksan yhdeksn".split(" "),y=["nolla","yhden","kahden","kolmen","neljn","viiden","kuuden",m[7],m[8],m[9]];function translate(h,v,C,T){var w="";switch(C){case"s":return T?"muutaman sekunnin":"muutama sekunti";case"ss":w=T?"sekunnin":"sekuntia";break;case"m":return T?"minuutin":"minuutti";case"mm":w=T?"minuutin":"minuuttia";break;case"h":return T?"tunnin":"tunti";case"hh":w=T?"tunnin":"tuntia";break;case"d":return T?"pivn":"piv";case"dd":w=T?"pivn":"piv";break;case"M":return T?"kuukauden":"kuukausi";case"MM":w=T?"kuukauden":"kuukautta";break;case"y":return T?"vuoden":"vuosi";case"yy":w=T?"vuoden":"vuotta"}return w=function verbalNumber(h,v){return h<10?v?y[h]:m[h]:h}(h,T)+" "+w}h.defineLocale("fi",{months:"tammikuu_helmikuu_maaliskuu_huhtikuu_toukokuu_keskuu_heinkuu_elokuu_syyskuu_lokakuu_marraskuu_joulukuu".split("_"),monthsShort:"tammi_helmi_maalis_huhti_touko_kes_hein_elo_syys_loka_marras_joulu".split("_"),weekdays:"sunnuntai_maanantai_tiistai_keskiviikko_torstai_perjantai_lauantai".split("_"),weekdaysShort:"su_ma_ti_ke_to_pe_la".split("_"),weekdaysMin:"su_ma_ti_ke_to_pe_la".split("_"),longDateFormat:{LT:"HH.mm",LTS:"HH.mm.ss",L:"DD.MM.YYYY",LL:"Do MMMM[ta] YYYY",LLL:"Do MMMM[ta] YYYY, [klo] HH.mm",LLLL:"dddd, Do MMMM[ta] YYYY, [klo] HH.mm",l:"D.M.YYYY",ll:"Do MMM YYYY",lll:"Do MMM YYYY, [klo] HH.mm",llll:"ddd, Do MMM YYYY, [klo] HH.mm"},calendar:{sameDay:"[tnn] [klo] LT",nextDay:"[huomenna] [klo] LT",nextWeek:"dddd [klo] LT",lastDay:"[eilen] [klo] LT",lastWeek:"[viime] dddd[na] [klo] LT",sameElse:"L"},relativeTime:{future:"%s pst",past:"%s sitten",s:translate,ss:translate,m:translate,mm:translate,h:translate,hh:translate,d:translate,dd:translate,M:translate,MM:translate,y:translate,yy:translate},dayOfMonthOrdinalParse:/\d{1,2}\./,ordinal:"%d.",week:{dow:1,doy:4}})}(y(1))},function(h,m,y){!function(h){"use strict";
//! moment.js locale configuration
h.defineLocale("fil",{months:"Enero_Pebrero_Marso_Abril_Mayo_Hunyo_Hulyo_Agosto_Setyembre_Oktubre_Nobyembre_Disyembre".split("_"),monthsShort:"Ene_Peb_Mar_Abr_May_Hun_Hul_Ago_Set_Okt_Nob_Dis".split("_"),weekdays:"Linggo_Lunes_Martes_Miyerkules_Huwebes_Biyernes_Sabado".split("_"),weekdaysShort:"Lin_Lun_Mar_Miy_Huw_Biy_Sab".split("_"),weekdaysMin:"Li_Lu_Ma_Mi_Hu_Bi_Sab".split("_"),longDateFormat:{LT:"HH:mm",LTS:"HH:mm:ss",L:"MM/D/YYYY",LL:"MMMM D, YYYY",LLL:"MMMM D, YYYY HH:mm",LLLL:"dddd, MMMM DD, YYYY HH:mm"},calendar:{sameDay:"LT [ngayong araw]",nextDay:"[Bukas ng] LT",nextWeek:"LT [sa susunod na] dddd",lastDay:"LT [kahapon]",lastWeek:"LT [noong nakaraang] dddd",sameElse:"L"},relativeTime:{future:"sa loob ng %s",past:"%s ang nakalipas",s:"ilang segundo",ss:"%d segundo",m:"isang minuto",mm:"%d minuto",h:"isang oras",hh:"%d oras",d:"isang araw",dd:"%d araw",M:"isang buwan",MM:"%d buwan",y:"isang taon",yy:"%d taon"},dayOfMonthOrdinalParse:/\d{1,2}/,ordinal:function(h){return h},week:{dow:1,doy:4}})}(y(1))},function(h,m,y){!function(h){"use strict";
//! moment.js locale configuration
h.defineLocale("fo",{months:"januar_februar_mars_aprl_mai_juni_juli_august_september_oktober_november_desember".split("_"),monthsShort:"jan_feb_mar_apr_mai_jun_jul_aug_sep_okt_nov_des".split("_"),weekdays:"sunnudagur_mnadagur_tsdagur_mikudagur_hsdagur_frggjadagur_leygardagur".split("_"),weekdaysShort:"sun_mn_ts_mik_hs_fr_ley".split("_"),weekdaysMin:"su_m_t_mi_h_fr_le".split("_"),longDateFormat:{LT:"HH:mm",LTS:"HH:mm:ss",L:"DD/MM/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY HH:mm",LLLL:"dddd D. MMMM, YYYY HH:mm"},calendar:{sameDay:"[ dag kl.] LT",nextDay:"[ morgin kl.] LT",nextWeek:"dddd [kl.] LT",lastDay:"[ gjr kl.] LT",lastWeek:"[sstu] dddd [kl] LT",sameElse:"L"},relativeTime:{future:"um %s",past:"%s sani",s:"f sekund",ss:"%d sekundir",m:"ein minuttur",mm:"%d minuttir",h:"ein tmi",hh:"%d tmar",d:"ein dagur",dd:"%d dagar",M:"ein mnaur",MM:"%d mnair",y:"eitt r",yy:"%d r"},dayOfMonthOrdinalParse:/\d{1,2}\./,ordinal:"%d.",week:{dow:1,doy:4}})}(y(1))},function(h,m,y){!function(h){"use strict";
//! moment.js locale configuration
var m=/(janv\.?|fvr\.?|mars|avr\.?|mai|juin|juil\.?|aot|sept\.?|oct\.?|nov\.?|dc\.?|janvier|fvrier|mars|avril|mai|juin|juillet|aot|septembre|octobre|novembre|dcembre)/i,y=[/^janv/i,/^fvr/i,/^mars/i,/^avr/i,/^mai/i,/^juin/i,/^juil/i,/^aot/i,/^sept/i,/^oct/i,/^nov/i,/^dc/i];h.defineLocale("fr",{months:"janvier_fvrier_mars_avril_mai_juin_juillet_aot_septembre_octobre_novembre_dcembre".split("_"),monthsShort:"janv._fvr._mars_avr._mai_juin_juil._aot_sept._oct._nov._dc.".split("_"),monthsRegex:m,monthsShortRegex:m,monthsStrictRegex:/^(janvier|fvrier|mars|avril|mai|juin|juillet|aot|septembre|octobre|novembre|dcembre)/i,monthsShortStrictRegex:/(janv\.?|fvr\.?|mars|avr\.?|mai|juin|juil\.?|aot|sept\.?|oct\.?|nov\.?|dc\.?)/i,monthsParse:y,longMonthsParse:y,shortMonthsParse:y,weekdays:"dimanche_lundi_mardi_mercredi_jeudi_vendredi_samedi".split("_"),weekdaysShort:"dim._lun._mar._mer._jeu._ven._sam.".split("_"),weekdaysMin:"di_lu_ma_me_je_ve_sa".split("_"),weekdaysParseExact:!0,longDateFormat:{LT:"HH:mm",LTS:"HH:mm:ss",L:"DD/MM/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY HH:mm",LLLL:"dddd D MMMM YYYY HH:mm"},calendar:{sameDay:"[Aujourdhui ] LT",nextDay:"[Demain ] LT",nextWeek:"dddd [] LT",lastDay:"[Hier ] LT",lastWeek:"dddd [dernier ] LT",sameElse:"L"},relativeTime:{future:"dans %s",past:"il y a %s",s:"quelques secondes",ss:"%d secondes",m:"une minute",mm:"%d minutes",h:"une heure",hh:"%d heures",d:"un jour",dd:"%d jours",M:"un mois",MM:"%d mois",y:"un an",yy:"%d ans"},dayOfMonthOrdinalParse:/\d{1,2}(er|)/,ordinal:function(h,m){switch(m){case"D":return h+(1===h?"er":"");default:case"M":case"Q":case"DDD":case"d":return h+(1===h?"er":"e");case"w":case"W":return h+(1===h?"re":"e")}},week:{dow:1,doy:4}})}(y(1))},function(h,m,y){!function(h){"use strict";
//! moment.js locale configuration
h.defineLocale("fr-ca",{months:"janvier_fvrier_mars_avril_mai_juin_juillet_aot_septembre_octobre_novembre_dcembre".split("_"),monthsShort:"janv._fvr._mars_avr._mai_juin_juil._aot_sept._oct._nov._dc.".split("_"),monthsParseExact:!0,weekdays:"dimanche_lundi_mardi_mercredi_jeudi_vendredi_samedi".split("_"),weekdaysShort:"dim._lun._mar._mer._jeu._ven._sam.".split("_"),weekdaysMin:"di_lu_ma_me_je_ve_sa".split("_"),weekdaysParseExact:!0,longDateFormat:{LT:"HH:mm",LTS:"HH:mm:ss",L:"YYYY-MM-DD",LL:"D MMMM YYYY",LLL:"D MMMM YYYY HH:mm",LLLL:"dddd D MMMM YYYY HH:mm"},calendar:{sameDay:"[Aujourdhui ] LT",nextDay:"[Demain ] LT",nextWeek:"dddd [] LT",lastDay:"[Hier ] LT",lastWeek:"dddd [dernier ] LT",sameElse:"L"},relativeTime:{future:"dans %s",past:"il y a %s",s:"quelques secondes",ss:"%d secondes",m:"une minute",mm:"%d minutes",h:"une heure",hh:"%d heures",d:"un jour",dd:"%d jours",M:"un mois",MM:"%d mois",y:"un an",yy:"%d ans"},dayOfMonthOrdinalParse:/\d{1,2}(er|e)/,ordinal:function(h,m){switch(m){default:case"M":case"Q":case"D":case"DDD":case"d":return h+(1===h?"er":"e");case"w":case"W":return h+(1===h?"re":"e")}}})}(y(1))},function(h,m,y){!function(h){"use strict";
//! moment.js locale configuration
h.defineLocale("fr-ch",{months:"janvier_fvrier_mars_avril_mai_juin_juillet_aot_septembre_octobre_novembre_dcembre".split("_"),monthsShort:"janv._fvr._mars_avr._mai_juin_juil._aot_sept._oct._nov._dc.".split("_"),monthsParseExact:!0,weekdays:"dimanche_lundi_mardi_mercredi_jeudi_vendredi_samedi".split("_"),weekdaysShort:"dim._lun._mar._mer._jeu._ven._sam.".split("_"),weekdaysMin:"di_lu_ma_me_je_ve_sa".split("_"),weekdaysParseExact:!0,longDateFormat:{LT:"HH:mm",LTS:"HH:mm:ss",L:"DD.MM.YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY HH:mm",LLLL:"dddd D MMMM YYYY HH:mm"},calendar:{sameDay:"[Aujourdhui ] LT",nextDay:"[Demain ] LT",nextWeek:"dddd [] LT",lastDay:"[Hier ] LT",lastWeek:"dddd [dernier ] LT",sameElse:"L"},relativeTime:{future:"dans %s",past:"il y a %s",s:"quelques secondes",ss:"%d secondes",m:"une minute",mm:"%d minutes",h:"une heure",hh:"%d heures",d:"un jour",dd:"%d jours",M:"un mois",MM:"%d mois",y:"un an",yy:"%d ans"},dayOfMonthOrdinalParse:/\d{1,2}(er|e)/,ordinal:function(h,m){switch(m){default:case"M":case"Q":case"D":case"DDD":case"d":return h+(1===h?"er":"e");case"w":case"W":return h+(1===h?"re":"e")}},week:{dow:1,doy:4}})}(y(1))},function(h,m,y){!function(h){"use strict";
//! moment.js locale configuration
var m="jan._feb._mrt._apr._mai_jun._jul._aug._sep._okt._nov._des.".split("_"),y="jan_feb_mrt_apr_mai_jun_jul_aug_sep_okt_nov_des".split("_");h.defineLocale("fy",{months:"jannewaris_febrewaris_maart_april_maaie_juny_july_augustus_septimber_oktober_novimber_desimber".split("_"),monthsShort:function(h,v){return h?/-MMM-/.test(v)?y[h.month()]:m[h.month()]:m},monthsParseExact:!0,weekdays:"snein_moandei_tiisdei_woansdei_tongersdei_freed_sneon".split("_"),weekdaysShort:"si._mo._ti._wo._to._fr._so.".split("_"),weekdaysMin:"Si_Mo_Ti_Wo_To_Fr_So".split("_"),weekdaysParseExact:!0,longDateFormat:{LT:"HH:mm",LTS:"HH:mm:ss",L:"DD-MM-YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY HH:mm",LLLL:"dddd D MMMM YYYY HH:mm"},calendar:{sameDay:"[hjoed om] LT",nextDay:"[moarn om] LT",nextWeek:"dddd [om] LT",lastDay:"[juster om] LT",lastWeek:"[frne] dddd [om] LT",sameElse:"L"},relativeTime:{future:"oer %s",past:"%s lyn",s:"in pear sekonden",ss:"%d sekonden",m:"ien mint",mm:"%d minuten",h:"ien oere",hh:"%d oeren",d:"ien dei",dd:"%d dagen",M:"ien moanne",MM:"%d moannen",y:"ien jier",yy:"%d jierren"},dayOfMonthOrdinalParse:/\d{1,2}(ste|de)/,ordinal:function(h){return h+(1===h||8===h||h>=20?"ste":"de")},week:{dow:1,doy:4}})}(y(1))},function(h,m,y){!function(h){"use strict";
//! moment.js locale configuration
h.defineLocale("ga",{months:["Eanir","Feabhra","Mrta","Aibren","Bealtaine","Meitheamh","Iil","Lnasa","Men Fmhair","Deireadh Fmhair","Samhain","Nollaig"],monthsShort:["Ean","Feabh","Mrt","Aib","Beal","Meith","Iil","Ln","M.F.","D.F.","Samh","Noll"],monthsParseExact:!0,weekdays:["D Domhnaigh","D Luain","D Mirt","D Cadaoin","Dardaoin","D hAoine","D Sathairn"],weekdaysShort:["Domh","Luan","Mirt","Cad","Dar","Aoine","Sath"],weekdaysMin:["Do","Lu","M","C","D","A","Sa"],longDateFormat:{LT:"HH:mm",LTS:"HH:mm:ss",L:"DD/MM/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY HH:mm",LLLL:"dddd, D MMMM YYYY HH:mm"},calendar:{sameDay:"[Inniu ag] LT",nextDay:"[Amrach ag] LT",nextWeek:"dddd [ag] LT",lastDay:"[Inn ag] LT",lastWeek:"dddd [seo caite] [ag] LT",sameElse:"L"},relativeTime:{future:"i %s",past:"%s  shin",s:"cpla soicind",ss:"%d soicind",m:"nimad",mm:"%d nimad",h:"uair an chloig",hh:"%d uair an chloig",d:"l",dd:"%d l",M:"m",MM:"%d monna",y:"bliain",yy:"%d bliain"},dayOfMonthOrdinalParse:/\d{1,2}(d|na|mh)/,ordinal:function(h){return h+(1===h?"d":h%10==2?"na":"mh")},week:{dow:1,doy:4}})}(y(1))},function(h,m,y){!function(h){"use strict";
//! moment.js locale configuration
h.defineLocale("gd",{months:["Am Faoilleach","An Gearran","Am Mrt","An Giblean","An Citean","An t-gmhios","An t-Iuchar","An Lnastal","An t-Sultain","An Dmhair","An t-Samhain","An Dbhlachd"],monthsShort:["Faoi","Gear","Mrt","Gibl","Cit","gmh","Iuch","Ln","Sult","Dmh","Samh","Dbh"],monthsParseExact:!0,weekdays:["Didmhnaich","Diluain","Dimirt","Diciadain","Diardaoin","Dihaoine","Disathairne"],weekdaysShort:["Did","Dil","Dim","Dic","Dia","Dih","Dis"],weekdaysMin:["D","Lu","M","Ci","Ar","Ha","Sa"],longDateFormat:{LT:"HH:mm",LTS:"HH:mm:ss",L:"DD/MM/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY HH:mm",LLLL:"dddd, D MMMM YYYY HH:mm"},calendar:{sameDay:"[An-diugh aig] LT",nextDay:"[A-mireach aig] LT",nextWeek:"dddd [aig] LT",lastDay:"[An-d aig] LT",lastWeek:"dddd [seo chaidh] [aig] LT",sameElse:"L"},relativeTime:{future:"ann an %s",past:"bho chionn %s",s:"beagan diogan",ss:"%d diogan",m:"mionaid",mm:"%d mionaidean",h:"uair",hh:"%d uairean",d:"latha",dd:"%d latha",M:"mos",MM:"%d mosan",y:"bliadhna",yy:"%d bliadhna"},dayOfMonthOrdinalParse:/\d{1,2}(d|na|mh)/,ordinal:function(h){return h+(1===h?"d":h%10==2?"na":"mh")},week:{dow:1,doy:4}})}(y(1))},function(h,m,y){!function(h){"use strict";
//! moment.js locale configuration
h.defineLocale("gl",{months:"xaneiro_febreiro_marzo_abril_maio_xuo_xullo_agosto_setembro_outubro_novembro_decembro".split("_"),monthsShort:"xan._feb._mar._abr._mai._xu._xul._ago._set._out._nov._dec.".split("_"),monthsParseExact:!0,weekdays:"domingo_luns_martes_mrcores_xoves_venres_sbado".split("_"),weekdaysShort:"dom._lun._mar._mr._xov._ven._sb.".split("_"),weekdaysMin:"do_lu_ma_m_xo_ve_s".split("_"),weekdaysParseExact:!0,longDateFormat:{LT:"H:mm",LTS:"H:mm:ss",L:"DD/MM/YYYY",LL:"D [de] MMMM [de] YYYY",LLL:"D [de] MMMM [de] YYYY H:mm",LLLL:"dddd, D [de] MMMM [de] YYYY H:mm"},calendar:{sameDay:function(){return"[hoxe "+(1!==this.hours()?"s":"")+"] LT"},nextDay:function(){return"[ma "+(1!==this.hours()?"s":"")+"] LT"},nextWeek:function(){return"dddd ["+(1!==this.hours()?"s":"a")+"] LT"},lastDay:function(){return"[onte "+(1!==this.hours()?"":"a")+"] LT"},lastWeek:function(){return"[o] dddd [pasado "+(1!==this.hours()?"s":"a")+"] LT"},sameElse:"L"},relativeTime:{future:function(h){return 0===h.indexOf("un")?"n"+h:"en "+h},past:"hai %s",s:"uns segundos",ss:"%d segundos",m:"un minuto",mm:"%d minutos",h:"unha hora",hh:"%d horas",d:"un da",dd:"%d das",M:"un mes",MM:"%d meses",y:"un ano",yy:"%d anos"},dayOfMonthOrdinalParse:/\d{1,2}/,ordinal:"%d",week:{dow:1,doy:4}})}(y(1))},function(h,m,y){!function(h){"use strict";
//! moment.js locale configuration
function processRelativeTime(h,m,y,v){var C={s:[" "," "],ss:[h+" ",h+" "],m:[" "," "],mm:[h+" ",h+" "],h:[" "," "],hh:[h+" ",h+" "],d:[" "," "],dd:[h+" ",h+" "],M:[" "," "],MM:[h+" ",h+" "],y:[" "," "],yy:[h+" ",h+" "]};return v?C[y][0]:C[y][1]}h.defineLocale("gom-deva",{months:{standalone:"___________".split("_"),format:"___________".split("_"),isFormat:/MMMM(\s)+D[oD]?/},monthsShort:"._.__.___._._._._._.".split("_"),monthsParseExact:!0,weekdays:"______".split("_"),weekdaysShort:"._._._._._._.".split("_"),weekdaysMin:"______".split("_"),weekdaysParseExact:!0,longDateFormat:{LT:"A h:mm []",LTS:"A h:mm:ss []",L:"DD-MM-YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY A h:mm []",LLLL:"dddd, MMMM Do, YYYY, A h:mm []",llll:"ddd, D MMM YYYY, A h:mm []"},calendar:{sameDay:"[] LT",nextDay:"[] LT",nextWeek:"[] dddd[,] LT",lastDay:"[] LT",lastWeek:"[] dddd[,] LT",sameElse:"L"},relativeTime:{future:"%s",past:"%s ",s:processRelativeTime,ss:processRelativeTime,m:processRelativeTime,mm:processRelativeTime,h:processRelativeTime,hh:processRelativeTime,d:processRelativeTime,dd:processRelativeTime,M:processRelativeTime,MM:processRelativeTime,y:processRelativeTime,yy:processRelativeTime},dayOfMonthOrdinalParse:/\d{1,2}()/,ordinal:function(h,m){switch(m){case"D":return h+"";default:case"M":case"Q":case"DDD":case"d":case"w":case"W":return h}},week:{dow:1,doy:4},meridiemParse:/|||/,meridiemHour:function(h,m){return 12===h&&(h=0),""===m?h<4?h:h+12:""===m?h:""===m?h>12?h:h+12:""===m?h+12:void 0},meridiem:function(h,m,y){return h<4?"":h<12?"":h<16?"":h<20?"":""}})}(y(1))},function(h,m,y){!function(h){"use strict";
//! moment.js locale configuration
function processRelativeTime(h,m,y,v){var C={s:["thoddea sekondamni","thodde sekond"],ss:[h+" sekondamni",h+" sekond"],m:["eka mintan","ek minut"],mm:[h+" mintamni",h+" mintam"],h:["eka voran","ek vor"],hh:[h+" voramni",h+" voram"],d:["eka disan","ek dis"],dd:[h+" disamni",h+" dis"],M:["eka mhoinean","ek mhoino"],MM:[h+" mhoineamni",h+" mhoine"],y:["eka vorsan","ek voros"],yy:[h+" vorsamni",h+" vorsam"]};return v?C[y][0]:C[y][1]}h.defineLocale("gom-latn",{months:{standalone:"Janer_Febrer_Mars_Abril_Mai_Jun_Julai_Agost_Setembr_Otubr_Novembr_Dezembr".split("_"),format:"Janerachea_Febrerachea_Marsachea_Abrilachea_Maiachea_Junachea_Julaiachea_Agostachea_Setembrachea_Otubrachea_Novembrachea_Dezembrachea".split("_"),isFormat:/MMMM(\s)+D[oD]?/},monthsShort:"Jan._Feb._Mars_Abr._Mai_Jun_Jul._Ago._Set._Otu._Nov._Dez.".split("_"),monthsParseExact:!0,weekdays:"Aitar_Somar_Mongllar_Budhvar_Birestar_Sukrar_Son'var".split("_"),weekdaysShort:"Ait._Som._Mon._Bud._Bre._Suk._Son.".split("_"),weekdaysMin:"Ai_Sm_Mo_Bu_Br_Su_Sn".split("_"),weekdaysParseExact:!0,longDateFormat:{LT:"A h:mm [vazta]",LTS:"A h:mm:ss [vazta]",L:"DD-MM-YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY A h:mm [vazta]",LLLL:"dddd, MMMM Do, YYYY, A h:mm [vazta]",llll:"ddd, D MMM YYYY, A h:mm [vazta]"},calendar:{sameDay:"[Aiz] LT",nextDay:"[Faleam] LT",nextWeek:"[Fuddlo] dddd[,] LT",lastDay:"[Kal] LT",lastWeek:"[Fattlo] dddd[,] LT",sameElse:"L"},relativeTime:{future:"%s",past:"%s adim",s:processRelativeTime,ss:processRelativeTime,m:processRelativeTime,mm:processRelativeTime,h:processRelativeTime,hh:processRelativeTime,d:processRelativeTime,dd:processRelativeTime,M:processRelativeTime,MM:processRelativeTime,y:processRelativeTime,yy:processRelativeTime},dayOfMonthOrdinalParse:/\d{1,2}(er)/,ordinal:function(h,m){switch(m){case"D":return h+"er";default:case"M":case"Q":case"DDD":case"d":case"w":case"W":return h}},week:{dow:1,doy:4},meridiemParse:/rati|sokallim|donparam|sanje/,meridiemHour:function(h,m){return 12===h&&(h=0),"rati"===m?h<4?h:h+12:"sokallim"===m?h:"donparam"===m?h>12?h:h+12:"sanje"===m?h+12:void 0},meridiem:function(h,m,y){return h<4?"rati":h<12?"sokallim":h<16?"donparam":h<20?"sanje":"rati"}})}(y(1))},function(h,m,y){!function(h){"use strict";
//! moment.js locale configuration
var m={1:"",2:"",3:"",4:"",5:"",6:"",7:"",8:"",9:"",0:""},y={"":"1","":"2","":"3","":"4","":"5","":"6","":"7","":"8","":"9","":"0"};h.defineLocale("gu",{months:"___________".split("_"),monthsShort:"._.__.___._._._._._.".split("_"),monthsParseExact:!0,weekdays:"______".split("_"),weekdaysShort:"______".split("_"),weekdaysMin:"______".split("_"),longDateFormat:{LT:"A h:mm ",LTS:"A h:mm:ss ",L:"DD/MM/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY, A h:mm ",LLLL:"dddd, D MMMM YYYY, A h:mm "},calendar:{sameDay:"[] LT",nextDay:"[] LT",nextWeek:"dddd, LT",lastDay:"[] LT",lastWeek:"[] dddd, LT",sameElse:"L"},relativeTime:{future:"%s ",past:"%s ",s:" ",ss:"%d ",m:" ",mm:"%d ",h:" ",hh:"%d ",d:" ",dd:"%d ",M:" ",MM:"%d ",y:" ",yy:"%d "},preparse:function(h){return h.replace(/[]/g,(function(h){return y[h]}))},postformat:function(h){return h.replace(/\d/g,(function(h){return m[h]}))},meridiemParse:/|||/,meridiemHour:function(h,m){return 12===h&&(h=0),""===m?h<4?h:h+12:""===m?h:""===m?h>=10?h:h+12:""===m?h+12:void 0},meridiem:function(h,m,y){return h<4?"":h<10?"":h<17?"":h<20?"":""},week:{dow:0,doy:6}})}(y(1))},function(h,m,y){!function(h){"use strict";
//! moment.js locale configuration
h.defineLocale("he",{months:"___________".split("_"),monthsShort:"___________".split("_"),weekdays:"______".split("_"),weekdaysShort:"______".split("_"),weekdaysMin:"______".split("_"),longDateFormat:{LT:"HH:mm",LTS:"HH:mm:ss",L:"DD/MM/YYYY",LL:"D []MMMM YYYY",LLL:"D []MMMM YYYY HH:mm",LLLL:"dddd, D []MMMM YYYY HH:mm",l:"D/M/YYYY",ll:"D MMM YYYY",lll:"D MMM YYYY HH:mm",llll:"ddd, D MMM YYYY HH:mm"},calendar:{sameDay:"[ ]LT",nextDay:"[ ]LT",nextWeek:"dddd [] LT",lastDay:"[ ]LT",lastWeek:"[] dddd [ ] LT",sameElse:"L"},relativeTime:{future:" %s",past:" %s",s:" ",ss:"%d ",m:"",mm:"%d ",h:"",hh:function(h){return 2===h?"":h+" "},d:"",dd:function(h){return 2===h?"":h+" "},M:"",MM:function(h){return 2===h?"":h+" "},y:"",yy:function(h){return 2===h?"":h%10==0&&10!==h?h+" ":h+" "}},meridiemParse:/"|"| | | ||/i,isPM:function(h){return/^("| |)$/.test(h)},meridiem:function(h,m,y){return h<5?" ":h<10?"":h<12?y?'"':" ":h<18?y?'"':" ":""}})}(y(1))},function(h,m,y){!function(h){"use strict";
//! moment.js locale configuration
var m={1:"",2:"",3:"",4:"",5:"",6:"",7:"",8:"",9:"",0:""},y={"":"1","":"2","":"3","":"4","":"5","":"6","":"7","":"8","":"9","":"0"};h.defineLocale("hi",{months:"___________".split("_"),monthsShort:"._.__.___._._._._._.".split("_"),monthsParseExact:!0,weekdays:"______".split("_"),weekdaysShort:"______".split("_"),weekdaysMin:"______".split("_"),longDateFormat:{LT:"A h:mm ",LTS:"A h:mm:ss ",L:"DD/MM/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY, A h:mm ",LLLL:"dddd, D MMMM YYYY, A h:mm "},calendar:{sameDay:"[] LT",nextDay:"[] LT",nextWeek:"dddd, LT",lastDay:"[] LT",lastWeek:"[] dddd, LT",sameElse:"L"},relativeTime:{future:"%s ",past:"%s ",s:"  ",ss:"%d ",m:" ",mm:"%d ",h:" ",hh:"%d ",d:" ",dd:"%d ",M:" ",MM:"%d ",y:" ",yy:"%d "},preparse:function(h){return h.replace(/[]/g,(function(h){return y[h]}))},postformat:function(h){return h.replace(/\d/g,(function(h){return m[h]}))},meridiemParse:/|||/,meridiemHour:function(h,m){return 12===h&&(h=0),""===m?h<4?h:h+12:""===m?h:""===m?h>=10?h:h+12:""===m?h+12:void 0},meridiem:function(h,m,y){return h<4?"":h<10?"":h<17?"":h<20?"":""},week:{dow:0,doy:6}})}(y(1))},function(h,m,y){!function(h){"use strict";
//! moment.js locale configuration
function translate(h,m,y){var v=h+" ";switch(y){case"ss":return v+=1===h?"sekunda":2===h||3===h||4===h?"sekunde":"sekundi";case"m":return m?"jedna minuta":"jedne minute";case"mm":return v+=1===h?"minuta":2===h||3===h||4===h?"minute":"minuta";case"h":return m?"jedan sat":"jednog sata";case"hh":return v+=1===h?"sat":2===h||3===h||4===h?"sata":"sati";case"dd":return v+=1===h?"dan":"dana";case"MM":return v+=1===h?"mjesec":2===h||3===h||4===h?"mjeseca":"mjeseci";case"yy":return v+=1===h?"godina":2===h||3===h||4===h?"godine":"godina"}}h.defineLocale("hr",{months:{format:"sijenja_veljae_oujka_travnja_svibnja_lipnja_srpnja_kolovoza_rujna_listopada_studenoga_prosinca".split("_"),standalone:"sijeanj_veljaa_oujak_travanj_svibanj_lipanj_srpanj_kolovoz_rujan_listopad_studeni_prosinac".split("_")},monthsShort:"sij._velj._ou._tra._svi._lip._srp._kol._ruj._lis._stu._pro.".split("_"),monthsParseExact:!0,weekdays:"nedjelja_ponedjeljak_utorak_srijeda_etvrtak_petak_subota".split("_"),weekdaysShort:"ned._pon._uto._sri._et._pet._sub.".split("_"),weekdaysMin:"ne_po_ut_sr_e_pe_su".split("_"),weekdaysParseExact:!0,longDateFormat:{LT:"H:mm",LTS:"H:mm:ss",L:"DD.MM.YYYY",LL:"Do MMMM YYYY",LLL:"Do MMMM YYYY H:mm",LLLL:"dddd, Do MMMM YYYY H:mm"},calendar:{sameDay:"[danas u] LT",nextDay:"[sutra u] LT",nextWeek:function(){switch(this.day()){case 0:return"[u] [nedjelju] [u] LT";case 3:return"[u] [srijedu] [u] LT";case 6:return"[u] [subotu] [u] LT";case 1:case 2:case 4:case 5:return"[u] dddd [u] LT"}},lastDay:"[juer u] LT",lastWeek:function(){switch(this.day()){case 0:return"[prolu] [nedjelju] [u] LT";case 3:return"[prolu] [srijedu] [u] LT";case 6:return"[prole] [subote] [u] LT";case 1:case 2:case 4:case 5:return"[proli] dddd [u] LT"}},sameElse:"L"},relativeTime:{future:"za %s",past:"prije %s",s:"par sekundi",ss:translate,m:translate,mm:translate,h:translate,hh:translate,d:"dan",dd:translate,M:"mjesec",MM:translate,y:"godinu",yy:translate},dayOfMonthOrdinalParse:/\d{1,2}\./,ordinal:"%d.",week:{dow:1,doy:7}})}(y(1))},function(h,m,y){!function(h){"use strict";
//! moment.js locale configuration
var m="vasrnap htfn kedden szerdn cstrtkn pnteken szombaton".split(" ");function translate(h,m,y,v){var C=h;switch(y){case"s":return v||m?"nhny msodperc":"nhny msodperce";case"ss":return C+(v||m)?" msodperc":" msodperce";case"m":return"egy"+(v||m?" perc":" perce");case"mm":return C+(v||m?" perc":" perce");case"h":return"egy"+(v||m?" ra":" rja");case"hh":return C+(v||m?" ra":" rja");case"d":return"egy"+(v||m?" nap":" napja");case"dd":return C+(v||m?" nap":" napja");case"M":return"egy"+(v||m?" hnap":" hnapja");case"MM":return C+(v||m?" hnap":" hnapja");case"y":return"egy"+(v||m?" v":" ve");case"yy":return C+(v||m?" v":" ve")}return""}function week(h){return(h?"":"[mlt] ")+"["+m[this.day()]+"] LT[-kor]"}h.defineLocale("hu",{months:"janur_februr_mrcius_prilis_mjus_jnius_jlius_augusztus_szeptember_oktber_november_december".split("_"),monthsShort:"jan_feb_mrc_pr_mj_jn_jl_aug_szept_okt_nov_dec".split("_"),weekdays:"vasrnap_htf_kedd_szerda_cstrtk_pntek_szombat".split("_"),weekdaysShort:"vas_ht_kedd_sze_cst_pn_szo".split("_"),weekdaysMin:"v_h_k_sze_cs_p_szo".split("_"),longDateFormat:{LT:"H:mm",LTS:"H:mm:ss",L:"YYYY.MM.DD.",LL:"YYYY. MMMM D.",LLL:"YYYY. MMMM D. H:mm",LLLL:"YYYY. MMMM D., dddd H:mm"},meridiemParse:/de|du/i,isPM:function(h){return"u"===h.charAt(1).toLowerCase()},meridiem:function(h,m,y){return h<12?!0===y?"de":"DE":!0===y?"du":"DU"},calendar:{sameDay:"[ma] LT[-kor]",nextDay:"[holnap] LT[-kor]",nextWeek:function(){return week.call(this,!0)},lastDay:"[tegnap] LT[-kor]",lastWeek:function(){return week.call(this,!1)},sameElse:"L"},relativeTime:{future:"%s mlva",past:"%s",s:translate,ss:translate,m:translate,mm:translate,h:translate,hh:translate,d:translate,dd:translate,M:translate,MM:translate,y:translate,yy:translate},dayOfMonthOrdinalParse:/\d{1,2}\./,ordinal:"%d.",week:{dow:1,doy:4}})}(y(1))},function(h,m,y){!function(h){"use strict";
//! moment.js locale configuration
h.defineLocale("hy-am",{months:{format:"___________".split("_"),standalone:"___________".split("_")},monthsShort:"___________".split("_"),weekdays:"______".split("_"),weekdaysShort:"______".split("_"),weekdaysMin:"______".split("_"),longDateFormat:{LT:"HH:mm",LTS:"HH:mm:ss",L:"DD.MM.YYYY",LL:"D MMMM YYYY .",LLL:"D MMMM YYYY ., HH:mm",LLLL:"dddd, D MMMM YYYY ., HH:mm"},calendar:{sameDay:"[] LT",nextDay:"[] LT",lastDay:"[] LT",nextWeek:function(){return"dddd [ ] LT"},lastWeek:function(){return"[] dddd [ ] LT"},sameElse:"L"},relativeTime:{future:"%s ",past:"%s ",s:"  ",ss:"%d ",m:"",mm:"%d ",h:"",hh:"%d ",d:"",dd:"%d ",M:"",MM:"%d ",y:"",yy:"%d "},meridiemParse:/|||/,isPM:function(h){return/^(|)$/.test(h)},meridiem:function(h){return h<4?"":h<12?"":h<17?"":""},dayOfMonthOrdinalParse:/\d{1,2}|\d{1,2}-(|)/,ordinal:function(h,m){switch(m){case"DDD":case"w":case"W":case"DDDo":return 1===h?h+"-":h+"-";default:return h}},week:{dow:1,doy:7}})}(y(1))},function(h,m,y){!function(h){"use strict";
//! moment.js locale configuration
h.defineLocale("id",{months:"Januari_Februari_Maret_April_Mei_Juni_Juli_Agustus_September_Oktober_November_Desember".split("_"),monthsShort:"Jan_Feb_Mar_Apr_Mei_Jun_Jul_Agt_Sep_Okt_Nov_Des".split("_"),weekdays:"Minggu_Senin_Selasa_Rabu_Kamis_Jumat_Sabtu".split("_"),weekdaysShort:"Min_Sen_Sel_Rab_Kam_Jum_Sab".split("_"),weekdaysMin:"Mg_Sn_Sl_Rb_Km_Jm_Sb".split("_"),longDateFormat:{LT:"HH.mm",LTS:"HH.mm.ss",L:"DD/MM/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY [pukul] HH.mm",LLLL:"dddd, D MMMM YYYY [pukul] HH.mm"},meridiemParse:/pagi|siang|sore|malam/,meridiemHour:function(h,m){return 12===h&&(h=0),"pagi"===m?h:"siang"===m?h>=11?h:h+12:"sore"===m||"malam"===m?h+12:void 0},meridiem:function(h,m,y){return h<11?"pagi":h<15?"siang":h<19?"sore":"malam"},calendar:{sameDay:"[Hari ini pukul] LT",nextDay:"[Besok pukul] LT",nextWeek:"dddd [pukul] LT",lastDay:"[Kemarin pukul] LT",lastWeek:"dddd [lalu pukul] LT",sameElse:"L"},relativeTime:{future:"dalam %s",past:"%s yang lalu",s:"beberapa detik",ss:"%d detik",m:"semenit",mm:"%d menit",h:"sejam",hh:"%d jam",d:"sehari",dd:"%d hari",M:"sebulan",MM:"%d bulan",y:"setahun",yy:"%d tahun"},week:{dow:0,doy:6}})}(y(1))},function(h,m,y){!function(h){"use strict";
//! moment.js locale configuration
function plural(h){return h%100==11||h%10!=1}function translate(h,m,y,v){var C=h+" ";switch(y){case"s":return m||v?"nokkrar sekndur":"nokkrum sekndum";case"ss":return plural(h)?C+(m||v?"sekndur":"sekndum"):C+"seknda";case"m":return m?"mnta":"mntu";case"mm":return plural(h)?C+(m||v?"mntur":"mntum"):m?C+"mnta":C+"mntu";case"hh":return plural(h)?C+(m||v?"klukkustundir":"klukkustundum"):C+"klukkustund";case"d":return m?"dagur":v?"dag":"degi";case"dd":return plural(h)?m?C+"dagar":C+(v?"daga":"dgum"):m?C+"dagur":C+(v?"dag":"degi");case"M":return m?"mnuur":v?"mnu":"mnui";case"MM":return plural(h)?m?C+"mnuir":C+(v?"mnui":"mnuum"):m?C+"mnuur":C+(v?"mnu":"mnui");case"y":return m||v?"r":"ri";case"yy":return plural(h)?C+(m||v?"r":"rum"):C+(m||v?"r":"ri")}}h.defineLocale("is",{months:"janar_febrar_mars_aprl_ma_jn_jl_gst_september_oktber_nvember_desember".split("_"),monthsShort:"jan_feb_mar_apr_ma_jn_jl_g_sep_okt_nv_des".split("_"),weekdays:"sunnudagur_mnudagur_rijudagur_mivikudagur_fimmtudagur_fstudagur_laugardagur".split("_"),weekdaysShort:"sun_mn_ri_mi_fim_fs_lau".split("_"),weekdaysMin:"Su_M_r_Mi_Fi_F_La".split("_"),longDateFormat:{LT:"H:mm",LTS:"H:mm:ss",L:"DD.MM.YYYY",LL:"D. MMMM YYYY",LLL:"D. MMMM YYYY [kl.] H:mm",LLLL:"dddd, D. MMMM YYYY [kl.] H:mm"},calendar:{sameDay:"[ dag kl.] LT",nextDay:"[ morgun kl.] LT",nextWeek:"dddd [kl.] LT",lastDay:"[ gr kl.] LT",lastWeek:"[sasta] dddd [kl.] LT",sameElse:"L"},relativeTime:{future:"eftir %s",past:"fyrir %s san",s:translate,ss:translate,m:translate,mm:translate,h:"klukkustund",hh:translate,d:translate,dd:translate,M:translate,MM:translate,y:translate,yy:translate},dayOfMonthOrdinalParse:/\d{1,2}\./,ordinal:"%d.",week:{dow:1,doy:4}})}(y(1))},function(h,m,y){!function(h){"use strict";
//! moment.js locale configuration
h.defineLocale("it",{months:"gennaio_febbraio_marzo_aprile_maggio_giugno_luglio_agosto_settembre_ottobre_novembre_dicembre".split("_"),monthsShort:"gen_feb_mar_apr_mag_giu_lug_ago_set_ott_nov_dic".split("_"),weekdays:"domenica_luned_marted_mercoled_gioved_venerd_sabato".split("_"),weekdaysShort:"dom_lun_mar_mer_gio_ven_sab".split("_"),weekdaysMin:"do_lu_ma_me_gi_ve_sa".split("_"),longDateFormat:{LT:"HH:mm",LTS:"HH:mm:ss",L:"DD/MM/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY HH:mm",LLLL:"dddd D MMMM YYYY HH:mm"},calendar:{sameDay:function(){return"[Oggi a"+(this.hours()>1?"lle ":0===this.hours()?" ":"ll'")+"]LT"},nextDay:function(){return"[Domani a"+(this.hours()>1?"lle ":0===this.hours()?" ":"ll'")+"]LT"},nextWeek:function(){return"dddd [a"+(this.hours()>1?"lle ":0===this.hours()?" ":"ll'")+"]LT"},lastDay:function(){return"[Ieri a"+(this.hours()>1?"lle ":0===this.hours()?" ":"ll'")+"]LT"},lastWeek:function(){switch(this.day()){case 0:return"[La scorsa] dddd [a"+(this.hours()>1?"lle ":0===this.hours()?" ":"ll'")+"]LT";default:return"[Lo scorso] dddd [a"+(this.hours()>1?"lle ":0===this.hours()?" ":"ll'")+"]LT"}},sameElse:"L"},relativeTime:{future:"tra %s",past:"%s fa",s:"alcuni secondi",ss:"%d secondi",m:"un minuto",mm:"%d minuti",h:"un'ora",hh:"%d ore",d:"un giorno",dd:"%d giorni",M:"un mese",MM:"%d mesi",y:"un anno",yy:"%d anni"},dayOfMonthOrdinalParse:/\d{1,2}/,ordinal:"%d",week:{dow:1,doy:4}})}(y(1))},function(h,m,y){!function(h){"use strict";
//! moment.js locale configuration
h.defineLocale("it-ch",{months:"gennaio_febbraio_marzo_aprile_maggio_giugno_luglio_agosto_settembre_ottobre_novembre_dicembre".split("_"),monthsShort:"gen_feb_mar_apr_mag_giu_lug_ago_set_ott_nov_dic".split("_"),weekdays:"domenica_luned_marted_mercoled_gioved_venerd_sabato".split("_"),weekdaysShort:"dom_lun_mar_mer_gio_ven_sab".split("_"),weekdaysMin:"do_lu_ma_me_gi_ve_sa".split("_"),longDateFormat:{LT:"HH:mm",LTS:"HH:mm:ss",L:"DD.MM.YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY HH:mm",LLLL:"dddd D MMMM YYYY HH:mm"},calendar:{sameDay:"[Oggi alle] LT",nextDay:"[Domani alle] LT",nextWeek:"dddd [alle] LT",lastDay:"[Ieri alle] LT",lastWeek:function(){switch(this.day()){case 0:return"[la scorsa] dddd [alle] LT";default:return"[lo scorso] dddd [alle] LT"}},sameElse:"L"},relativeTime:{future:function(h){return(/^[0-9].+$/.test(h)?"tra":"in")+" "+h},past:"%s fa",s:"alcuni secondi",ss:"%d secondi",m:"un minuto",mm:"%d minuti",h:"un'ora",hh:"%d ore",d:"un giorno",dd:"%d giorni",M:"un mese",MM:"%d mesi",y:"un anno",yy:"%d anni"},dayOfMonthOrdinalParse:/\d{1,2}/,ordinal:"%d",week:{dow:1,doy:4}})}(y(1))},function(h,m,y){!function(h){"use strict";
//! moment.js locale configuration
h.defineLocale("ja",{eras:[{since:"2019-05-01",offset:1,name:"",narrow:"",abbr:"R"},{since:"1989-01-08",until:"2019-04-30",offset:1,name:"",narrow:"",abbr:"H"},{since:"1926-12-25",until:"1989-01-07",offset:1,name:"",narrow:"",abbr:"S"},{since:"1912-07-30",until:"1926-12-24",offset:1,name:"",narrow:"",abbr:"T"},{since:"1873-01-01",until:"1912-07-29",offset:6,name:"",narrow:"",abbr:"M"},{since:"0001-01-01",until:"1873-12-31",offset:1,name:"",narrow:"AD",abbr:"AD"},{since:"0000-12-31",until:-1/0,offset:1,name:"",narrow:"BC",abbr:"BC"}],eraYearOrdinalRegex:/(|\d+)/,eraYearOrdinalParse:function(h,m){return""===m[1]?1:parseInt(m[1]||h,10)},months:"1_2_3_4_5_6_7_8_9_10_11_12".split("_"),monthsShort:"1_2_3_4_5_6_7_8_9_10_11_12".split("_"),weekdays:"______".split("_"),weekdaysShort:"______".split("_"),weekdaysMin:"______".split("_"),longDateFormat:{LT:"HH:mm",LTS:"HH:mm:ss",L:"YYYY/MM/DD",LL:"YYYYMD",LLL:"YYYYMD HH:mm",LLLL:"YYYYMD dddd HH:mm",l:"YYYY/MM/DD",ll:"YYYYMD",lll:"YYYYMD HH:mm",llll:"YYYYMD(ddd) HH:mm"},meridiemParse:/|/i,isPM:function(h){return""===h},meridiem:function(h,m,y){return h<12?"":""},calendar:{sameDay:"[] LT",nextDay:"[] LT",nextWeek:function(h){return h.week()!==this.week()?"[]dddd LT":"dddd LT"},lastDay:"[] LT",lastWeek:function(h){return this.week()!==h.week()?"[]dddd LT":"dddd LT"},sameElse:"L"},dayOfMonthOrdinalParse:/\d{1,2}/,ordinal:function(h,m){switch(m){case"y":return 1===h?"":h+"";case"d":case"D":case"DDD":return h+"";default:return h}},relativeTime:{future:"%s",past:"%s",s:"",ss:"%d",m:"1",mm:"%d",h:"1",hh:"%d",d:"1",dd:"%d",M:"1",MM:"%d",y:"1",yy:"%d"}})}(y(1))},function(h,m,y){!function(h){"use strict";
//! moment.js locale configuration
h.defineLocale("jv",{months:"Januari_Februari_Maret_April_Mei_Juni_Juli_Agustus_September_Oktober_Nopember_Desember".split("_"),monthsShort:"Jan_Feb_Mar_Apr_Mei_Jun_Jul_Ags_Sep_Okt_Nop_Des".split("_"),weekdays:"Minggu_Senen_Seloso_Rebu_Kemis_Jemuwah_Septu".split("_"),weekdaysShort:"Min_Sen_Sel_Reb_Kem_Jem_Sep".split("_"),weekdaysMin:"Mg_Sn_Sl_Rb_Km_Jm_Sp".split("_"),longDateFormat:{LT:"HH.mm",LTS:"HH.mm.ss",L:"DD/MM/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY [pukul] HH.mm",LLLL:"dddd, D MMMM YYYY [pukul] HH.mm"},meridiemParse:/enjing|siyang|sonten|ndalu/,meridiemHour:function(h,m){return 12===h&&(h=0),"enjing"===m?h:"siyang"===m?h>=11?h:h+12:"sonten"===m||"ndalu"===m?h+12:void 0},meridiem:function(h,m,y){return h<11?"enjing":h<15?"siyang":h<19?"sonten":"ndalu"},calendar:{sameDay:"[Dinten puniko pukul] LT",nextDay:"[Mbenjang pukul] LT",nextWeek:"dddd [pukul] LT",lastDay:"[Kala wingi pukul] LT",lastWeek:"dddd [kepengker pukul] LT",sameElse:"L"},relativeTime:{future:"wonten ing %s",past:"%s ingkang kepengker",s:"sawetawis detik",ss:"%d detik",m:"setunggal menit",mm:"%d menit",h:"setunggal jam",hh:"%d jam",d:"sedinten",dd:"%d dinten",M:"sewulan",MM:"%d wulan",y:"setaun",yy:"%d taun"},week:{dow:1,doy:7}})}(y(1))},function(h,m,y){!function(h){"use strict";
//! moment.js locale configuration
h.defineLocale("ka",{months:"___________".split("_"),monthsShort:"___________".split("_"),weekdays:{standalone:"______".split("_"),format:"______".split("_"),isFormat:/(|)/},weekdaysShort:"______".split("_"),weekdaysMin:"______".split("_"),longDateFormat:{LT:"HH:mm",LTS:"HH:mm:ss",L:"DD/MM/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY HH:mm",LLLL:"dddd, D MMMM YYYY HH:mm"},calendar:{sameDay:"[] LT[-]",nextDay:"[] LT[-]",lastDay:"[] LT[-]",nextWeek:"[] dddd LT[-]",lastWeek:"[] dddd LT-",sameElse:"L"},relativeTime:{future:function(h){return h.replace(/(|||||)(|)/,(function(h,m,y){return""===y?m+"":m+y+""}))},past:function(h){return/(||||)/.test(h)?h.replace(/(|)$/," ")://.test(h)?h.replace(/$/," "):h},s:" ",ss:"%d ",m:"",mm:"%d ",h:"",hh:"%d ",d:"",dd:"%d ",M:"",MM:"%d ",y:"",yy:"%d "},dayOfMonthOrdinalParse:/0|1-|-\d{1,2}|\d{1,2}-/,ordinal:function(h){return 0===h?h:1===h?h+"-":h<20||h<=100&&h%20==0||h%100==0?"-"+h:h+"-"},week:{dow:1,doy:7}})}(y(1))},function(h,m,y){!function(h){"use strict";
//! moment.js locale configuration
var m={0:"-",1:"-",2:"-",3:"-",4:"-",5:"-",6:"-",7:"-",8:"-",9:"-",10:"-",20:"-",30:"-",40:"-",50:"-",60:"-",70:"-",80:"-",90:"-",100:"-"};h.defineLocale("kk",{months:"___________".split("_"),monthsShort:"___________".split("_"),weekdays:"______".split("_"),weekdaysShort:"______".split("_"),weekdaysMin:"______".split("_"),longDateFormat:{LT:"HH:mm",LTS:"HH:mm:ss",L:"DD.MM.YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY HH:mm",LLLL:"dddd, D MMMM YYYY HH:mm"},calendar:{sameDay:"[ ] LT",nextDay:"[ ] LT",nextWeek:"dddd [] LT",lastDay:"[ ] LT",lastWeek:"[ ] dddd [] LT",sameElse:"L"},relativeTime:{future:"%s ",past:"%s ",s:" ",ss:"%d ",m:" ",mm:"%d ",h:" ",hh:"%d ",d:" ",dd:"%d ",M:" ",MM:"%d ",y:" ",yy:"%d "},dayOfMonthOrdinalParse:/\d{1,2}-(|)/,ordinal:function(h){return h+(m[h]||m[h%10]||m[h>=100?100:null])},week:{dow:1,doy:7}})}(y(1))},function(h,m,y){!function(h){"use strict";
//! moment.js locale configuration
var m={1:"",2:"",3:"",4:"",5:"",6:"",7:"",8:"",9:"",0:""},y={"":"1","":"2","":"3","":"4","":"5","":"6","":"7","":"8","":"9","":"0"};h.defineLocale("km",{months:"___________".split("_"),monthsShort:"___________".split("_"),weekdays:"______".split("_"),weekdaysShort:"______".split("_"),weekdaysMin:"______".split("_"),weekdaysParseExact:!0,longDateFormat:{LT:"HH:mm",LTS:"HH:mm:ss",L:"DD/MM/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY HH:mm",LLLL:"dddd, D MMMM YYYY HH:mm"},meridiemParse:/|/,isPM:function(h){return""===h},meridiem:function(h,m,y){return h<12?"":""},calendar:{sameDay:"[ ] LT",nextDay:"[ ] LT",nextWeek:"dddd [] LT",lastDay:"[ ] LT",lastWeek:"dddd [] [] LT",sameElse:"L"},relativeTime:{future:"%s",past:"%s",s:"",ss:"%d ",m:"",mm:"%d ",h:"",hh:"%d ",d:"",dd:"%d ",M:"",MM:"%d ",y:"",yy:"%d "},dayOfMonthOrdinalParse:/\d{1,2}/,ordinal:"%d",preparse:function(h){return h.replace(/[]/g,(function(h){return y[h]}))},postformat:function(h){return h.replace(/\d/g,(function(h){return m[h]}))},week:{dow:1,doy:4}})}(y(1))},function(h,m,y){!function(h){"use strict";
//! moment.js locale configuration
var m={1:"",2:"",3:"",4:"",5:"",6:"",7:"",8:"",9:"",0:""},y={"":"1","":"2","":"3","":"4","":"5","":"6","":"7","":"8","":"9","":"0"};h.defineLocale("kn",{months:"___________".split("_"),monthsShort:"___________".split("_"),monthsParseExact:!0,weekdays:"______".split("_"),weekdaysShort:"______".split("_"),weekdaysMin:"______".split("_"),longDateFormat:{LT:"A h:mm",LTS:"A h:mm:ss",L:"DD/MM/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY, A h:mm",LLLL:"dddd, D MMMM YYYY, A h:mm"},calendar:{sameDay:"[] LT",nextDay:"[] LT",nextWeek:"dddd, LT",lastDay:"[] LT",lastWeek:"[] dddd, LT",sameElse:"L"},relativeTime:{future:"%s ",past:"%s ",s:" ",ss:"%d ",m:" ",mm:"%d ",h:" ",hh:"%d ",d:" ",dd:"%d ",M:" ",MM:"%d ",y:" ",yy:"%d "},preparse:function(h){return h.replace(/[]/g,(function(h){return y[h]}))},postformat:function(h){return h.replace(/\d/g,(function(h){return m[h]}))},meridiemParse:/|||/,meridiemHour:function(h,m){return 12===h&&(h=0),""===m?h<4?h:h+12:""===m?h:""===m?h>=10?h:h+12:""===m?h+12:void 0},meridiem:function(h,m,y){return h<4?"":h<10?"":h<17?"":h<20?"":""},dayOfMonthOrdinalParse:/\d{1,2}()/,ordinal:function(h){return h+""},week:{dow:0,doy:6}})}(y(1))},function(h,m,y){!function(h){"use strict";
//! moment.js locale configuration
h.defineLocale("ko",{months:"1_2_3_4_5_6_7_8_9_10_11_12".split("_"),monthsShort:"1_2_3_4_5_6_7_8_9_10_11_12".split("_"),weekdays:"______".split("_"),weekdaysShort:"______".split("_"),weekdaysMin:"______".split("_"),longDateFormat:{LT:"A h:mm",LTS:"A h:mm:ss",L:"YYYY.MM.DD.",LL:"YYYY MMMM D",LLL:"YYYY MMMM D A h:mm",LLLL:"YYYY MMMM D dddd A h:mm",l:"YYYY.MM.DD.",ll:"YYYY MMMM D",lll:"YYYY MMMM D A h:mm",llll:"YYYY MMMM D dddd A h:mm"},calendar:{sameDay:" LT",nextDay:" LT",nextWeek:"dddd LT",lastDay:" LT",lastWeek:" dddd LT",sameElse:"L"},relativeTime:{future:"%s ",past:"%s ",s:" ",ss:"%d",m:"1",mm:"%d",h:" ",hh:"%d",d:"",dd:"%d",M:" ",MM:"%d",y:" ",yy:"%d"},dayOfMonthOrdinalParse:/\d{1,2}(||)/,ordinal:function(h,m){switch(m){case"d":case"D":case"DDD":return h+"";case"M":return h+"";case"w":case"W":return h+"";default:return h}},meridiemParse:/|/,isPM:function(h){return""===h},meridiem:function(h,m,y){return h<12?"":""}})}(y(1))},function(h,m,y){!function(h){"use strict";
//! moment.js locale configuration
var m={1:"",2:"",3:"",4:"",5:"",6:"",7:"",8:"",9:"",0:""},y={"":"1","":"2","":"3","":"4","":"5","":"6","":"7","":"8","":"9","":"0"},v=[" ","","","","","","","",""," "," "," "];h.defineLocale("ku",{months:v,monthsShort:v,weekdays:"______".split("_"),weekdaysShort:"______".split("_"),weekdaysMin:"______".split("_"),weekdaysParseExact:!0,longDateFormat:{LT:"HH:mm",LTS:"HH:mm:ss",L:"DD/MM/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY HH:mm",LLLL:"dddd, D MMMM YYYY HH:mm"},meridiemParse:/|/,isPM:function(h){return//.test(h)},meridiem:function(h,m,y){return h<12?"":""},calendar:{sameDay:"[ ] LT",nextDay:"[ ] LT",nextWeek:"dddd [] LT",lastDay:"[ ] LT",lastWeek:"dddd [] LT",sameElse:"L"},relativeTime:{future:" %s",past:"%s",s:" ",ss:" %d",m:" ",mm:"%d ",h:" ",hh:"%d ",d:" ",dd:"%d ",M:" ",MM:"%d ",y:" ",yy:"%d "},preparse:function(h){return h.replace(/[]/g,(function(h){return y[h]})).replace(//g,",")},postformat:function(h){return h.replace(/\d/g,(function(h){return m[h]})).replace(/,/g,"")},week:{dow:6,doy:12}})}(y(1))},function(h,m,y){!function(h){"use strict";
//! moment.js locale configuration
var m={0:"-",1:"-",2:"-",3:"-",4:"-",5:"-",6:"-",7:"-",8:"-",9:"-",10:"-",20:"-",30:"-",40:"-",50:"-",60:"-",70:"-",80:"-",90:"-",100:"-"};h.defineLocale("ky",{months:"___________".split("_"),monthsShort:"___________".split("_"),weekdays:"______".split("_"),weekdaysShort:"______".split("_"),weekdaysMin:"______".split("_"),longDateFormat:{LT:"HH:mm",LTS:"HH:mm:ss",L:"DD.MM.YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY HH:mm",LLLL:"dddd, D MMMM YYYY HH:mm"},calendar:{sameDay:"[ ] LT",nextDay:"[ ] LT",nextWeek:"dddd [] LT",lastDay:"[ ] LT",lastWeek:"[ ] dddd [] [] LT",sameElse:"L"},relativeTime:{future:"%s ",past:"%s ",s:" ",ss:"%d ",m:" ",mm:"%d ",h:" ",hh:"%d ",d:" ",dd:"%d ",M:" ",MM:"%d ",y:" ",yy:"%d "},dayOfMonthOrdinalParse:/\d{1,2}-(|||)/,ordinal:function(h){return h+(m[h]||m[h%10]||m[h>=100?100:null])},week:{dow:1,doy:7}})}(y(1))},function(h,m,y){!function(h){"use strict";
//! moment.js locale configuration
function processRelativeTime(h,m,y,v){var C={m:["eng Minutt","enger Minutt"],h:["eng Stonn","enger Stonn"],d:["een Dag","engem Dag"],M:["ee Mount","engem Mount"],y:["ee Joer","engem Joer"]};return m?C[y][0]:C[y][1]}function eifelerRegelAppliesToNumber(h){if(h=parseInt(h,10),isNaN(h))return!1;if(h<0)return!0;if(h<10)return 4<=h&&h<=7;if(h<100){var m=h%10;return eifelerRegelAppliesToNumber(0===m?h/10:m)}if(h<1e4){for(;h>=10;)h/=10;return eifelerRegelAppliesToNumber(h)}return eifelerRegelAppliesToNumber(h/=1e3)}h.defineLocale("lb",{months:"Januar_Februar_Merz_Abrll_Mee_Juni_Juli_August_September_Oktober_November_Dezember".split("_"),monthsShort:"Jan._Febr._Mrz._Abr._Mee_Jun._Jul._Aug._Sept._Okt._Nov._Dez.".split("_"),monthsParseExact:!0,weekdays:"Sonndeg_Mindeg_Dnschdeg_Mttwoch_Donneschdeg_Freideg_Samschdeg".split("_"),weekdaysShort:"So._M._D._M._Do._Fr._Sa.".split("_"),weekdaysMin:"So_M_D_M_Do_Fr_Sa".split("_"),weekdaysParseExact:!0,longDateFormat:{LT:"H:mm [Auer]",LTS:"H:mm:ss [Auer]",L:"DD.MM.YYYY",LL:"D. MMMM YYYY",LLL:"D. MMMM YYYY H:mm [Auer]",LLLL:"dddd, D. MMMM YYYY H:mm [Auer]"},calendar:{sameDay:"[Haut um] LT",sameElse:"L",nextDay:"[Muer um] LT",nextWeek:"dddd [um] LT",lastDay:"[Gschter um] LT",lastWeek:function(){switch(this.day()){case 2:case 4:return"[Leschten] dddd [um] LT";default:return"[Leschte] dddd [um] LT"}}},relativeTime:{future:function processFutureTime(h){return eifelerRegelAppliesToNumber(h.substr(0,h.indexOf(" ")))?"a "+h:"an "+h},past:function processPastTime(h){return eifelerRegelAppliesToNumber(h.substr(0,h.indexOf(" ")))?"viru "+h:"virun "+h},s:"e puer Sekonnen",ss:"%d Sekonnen",m:processRelativeTime,mm:"%d Minutten",h:processRelativeTime,hh:"%d Stonnen",d:processRelativeTime,dd:"%d Deeg",M:processRelativeTime,MM:"%d Mint",y:processRelativeTime,yy:"%d Joer"},dayOfMonthOrdinalParse:/\d{1,2}\./,ordinal:"%d.",week:{dow:1,doy:4}})}(y(1))},function(h,m,y){!function(h){"use strict";
//! moment.js locale configuration
h.defineLocale("lo",{months:"___________".split("_"),monthsShort:"___________".split("_"),weekdays:"______".split("_"),weekdaysShort:"______".split("_"),weekdaysMin:"______".split("_"),weekdaysParseExact:!0,longDateFormat:{LT:"HH:mm",LTS:"HH:mm:ss",L:"DD/MM/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY HH:mm",LLLL:"dddd D MMMM YYYY HH:mm"},meridiemParse:/|/,isPM:function(h){return""===h},meridiem:function(h,m,y){return h<12?"":""},calendar:{sameDay:"[] LT",nextDay:"[] LT",nextWeek:"[]dddd[] LT",lastDay:"[] LT",lastWeek:"[]dddd[] LT",sameElse:"L"},relativeTime:{future:" %s",past:"%s",s:"",ss:"%d ",m:"1 ",mm:"%d ",h:"1 ",hh:"%d ",d:"1 ",dd:"%d ",M:"1 ",MM:"%d ",y:"1 ",yy:"%d "},dayOfMonthOrdinalParse:/()\d{1,2}/,ordinal:function(h){return""+h}})}(y(1))},function(h,m,y){!function(h){"use strict";
//! moment.js locale configuration
var m={ss:"sekund_sekundi_sekundes",m:"minut_minuts_minut",mm:"minuts_minui_minutes",h:"valanda_valandos_valand",hh:"valandos_valand_valandas",d:"diena_dienos_dien",dd:"dienos_dien_dienas",M:"mnuo_mnesio_mnes",MM:"mnesiai_mnesi_mnesius",y:"metai_met_metus",yy:"metai_met_metus"};function translateSingular(h,m,y,v){return m?forms(y)[0]:v?forms(y)[1]:forms(y)[2]}function special(h){return h%10==0||h>10&&h<20}function forms(h){return m[h].split("_")}function translate(h,m,y,v){var C=h+" ";return 1===h?C+translateSingular(0,m,y[0],v):m?C+(special(h)?forms(y)[1]:forms(y)[0]):v?C+forms(y)[1]:C+(special(h)?forms(y)[1]:forms(y)[2])}h.defineLocale("lt",{months:{format:"sausio_vasario_kovo_balandio_gegus_birelio_liepos_rugpjio_rugsjo_spalio_lapkriio_gruodio".split("_"),standalone:"sausis_vasaris_kovas_balandis_gegu_birelis_liepa_rugpjtis_rugsjis_spalis_lapkritis_gruodis".split("_"),isFormat:/D[oD]?(\[[^\[\]]*\]|\s)+MMMM?|MMMM?(\[[^\[\]]*\]|\s)+D[oD]?/},monthsShort:"sau_vas_kov_bal_geg_bir_lie_rgp_rgs_spa_lap_grd".split("_"),weekdays:{format:"sekmadien_pirmadien_antradien_treiadien_ketvirtadien_penktadien_etadien".split("_"),standalone:"sekmadienis_pirmadienis_antradienis_treiadienis_ketvirtadienis_penktadienis_etadienis".split("_"),isFormat:/dddd HH:mm/},weekdaysShort:"Sek_Pir_Ant_Tre_Ket_Pen_e".split("_"),weekdaysMin:"S_P_A_T_K_Pn_".split("_"),weekdaysParseExact:!0,longDateFormat:{LT:"HH:mm",LTS:"HH:mm:ss",L:"YYYY-MM-DD",LL:"YYYY [m.] MMMM D [d.]",LLL:"YYYY [m.] MMMM D [d.], HH:mm [val.]",LLLL:"YYYY [m.] MMMM D [d.], dddd, HH:mm [val.]",l:"YYYY-MM-DD",ll:"YYYY [m.] MMMM D [d.]",lll:"YYYY [m.] MMMM D [d.], HH:mm [val.]",llll:"YYYY [m.] MMMM D [d.], ddd, HH:mm [val.]"},calendar:{sameDay:"[iandien] LT",nextDay:"[Rytoj] LT",nextWeek:"dddd LT",lastDay:"[Vakar] LT",lastWeek:"[Prajus] dddd LT",sameElse:"L"},relativeTime:{future:"po %s",past:"prie %s",s:function translateSeconds(h,m,y,v){return m?"kelios sekunds":v?"keli sekundi":"kelias sekundes"},ss:translate,m:translateSingular,mm:translate,h:translateSingular,hh:translate,d:translateSingular,dd:translate,M:translateSingular,MM:translate,y:translateSingular,yy:translate},dayOfMonthOrdinalParse:/\d{1,2}-oji/,ordinal:function(h){return h+"-oji"},week:{dow:1,doy:4}})}(y(1))},function(h,m,y){!function(h){"use strict";
//! moment.js locale configuration
var m={ss:"sekundes_sekundm_sekunde_sekundes".split("_"),m:"mintes_mintm_minte_mintes".split("_"),mm:"mintes_mintm_minte_mintes".split("_"),h:"stundas_stundm_stunda_stundas".split("_"),hh:"stundas_stundm_stunda_stundas".split("_"),d:"dienas_dienm_diena_dienas".split("_"),dd:"dienas_dienm_diena_dienas".split("_"),M:"mnea_mneiem_mnesis_mnei".split("_"),MM:"mnea_mneiem_mnesis_mnei".split("_"),y:"gada_gadiem_gads_gadi".split("_"),yy:"gada_gadiem_gads_gadi".split("_")};function format(h,m,y){return y?m%10==1&&m%100!=11?h[2]:h[3]:m%10==1&&m%100!=11?h[0]:h[1]}function relativeTimeWithPlural(h,y,v){return h+" "+format(m[v],h,y)}function relativeTimeWithSingular(h,y,v){return format(m[v],h,y)}h.defineLocale("lv",{months:"janvris_februris_marts_aprlis_maijs_jnijs_jlijs_augusts_septembris_oktobris_novembris_decembris".split("_"),monthsShort:"jan_feb_mar_apr_mai_jn_jl_aug_sep_okt_nov_dec".split("_"),weekdays:"svtdiena_pirmdiena_otrdiena_trediena_ceturtdiena_piektdiena_sestdiena".split("_"),weekdaysShort:"Sv_P_O_T_C_Pk_S".split("_"),weekdaysMin:"Sv_P_O_T_C_Pk_S".split("_"),weekdaysParseExact:!0,longDateFormat:{LT:"HH:mm",LTS:"HH:mm:ss",L:"DD.MM.YYYY.",LL:"YYYY. [gada] D. MMMM",LLL:"YYYY. [gada] D. MMMM, HH:mm",LLLL:"YYYY. [gada] D. MMMM, dddd, HH:mm"},calendar:{sameDay:"[odien pulksten] LT",nextDay:"[Rt pulksten] LT",nextWeek:"dddd [pulksten] LT",lastDay:"[Vakar pulksten] LT",lastWeek:"[Pagju] dddd [pulksten] LT",sameElse:"L"},relativeTime:{future:"pc %s",past:"pirms %s",s:function relativeSeconds(h,m){return m?"daas sekundes":"dam sekundm"},ss:relativeTimeWithPlural,m:relativeTimeWithSingular,mm:relativeTimeWithPlural,h:relativeTimeWithSingular,hh:relativeTimeWithPlural,d:relativeTimeWithSingular,dd:relativeTimeWithPlural,M:relativeTimeWithSingular,MM:relativeTimeWithPlural,y:relativeTimeWithSingular,yy:relativeTimeWithPlural},dayOfMonthOrdinalParse:/\d{1,2}\./,ordinal:"%d.",week:{dow:1,doy:4}})}(y(1))},function(h,m,y){!function(h){"use strict";
//! moment.js locale configuration
var m={words:{ss:["sekund","sekunda","sekundi"],m:["jedan minut","jednog minuta"],mm:["minut","minuta","minuta"],h:["jedan sat","jednog sata"],hh:["sat","sata","sati"],dd:["dan","dana","dana"],MM:["mjesec","mjeseca","mjeseci"],yy:["godina","godine","godina"]},correctGrammaticalCase:function(h,m){return 1===h?m[0]:h>=2&&h<=4?m[1]:m[2]},translate:function(h,y,v){var C=m.words[v];return 1===v.length?y?C[0]:C[1]:h+" "+m.correctGrammaticalCase(h,C)}};h.defineLocale("me",{months:"januar_februar_mart_april_maj_jun_jul_avgust_septembar_oktobar_novembar_decembar".split("_"),monthsShort:"jan._feb._mar._apr._maj_jun_jul_avg._sep._okt._nov._dec.".split("_"),monthsParseExact:!0,weekdays:"nedjelja_ponedjeljak_utorak_srijeda_etvrtak_petak_subota".split("_"),weekdaysShort:"ned._pon._uto._sri._et._pet._sub.".split("_"),weekdaysMin:"ne_po_ut_sr_e_pe_su".split("_"),weekdaysParseExact:!0,longDateFormat:{LT:"H:mm",LTS:"H:mm:ss",L:"DD.MM.YYYY",LL:"D. MMMM YYYY",LLL:"D. MMMM YYYY H:mm",LLLL:"dddd, D. MMMM YYYY H:mm"},calendar:{sameDay:"[danas u] LT",nextDay:"[sjutra u] LT",nextWeek:function(){switch(this.day()){case 0:return"[u] [nedjelju] [u] LT";case 3:return"[u] [srijedu] [u] LT";case 6:return"[u] [subotu] [u] LT";case 1:case 2:case 4:case 5:return"[u] dddd [u] LT"}},lastDay:"[jue u] LT",lastWeek:function(){return["[prole] [nedjelje] [u] LT","[prolog] [ponedjeljka] [u] LT","[prolog] [utorka] [u] LT","[prole] [srijede] [u] LT","[prolog] [etvrtka] [u] LT","[prolog] [petka] [u] LT","[prole] [subote] [u] LT"][this.day()]},sameElse:"L"},relativeTime:{future:"za %s",past:"prije %s",s:"nekoliko sekundi",ss:m.translate,m:m.translate,mm:m.translate,h:m.translate,hh:m.translate,d:"dan",dd:m.translate,M:"mjesec",MM:m.translate,y:"godinu",yy:m.translate},dayOfMonthOrdinalParse:/\d{1,2}\./,ordinal:"%d.",week:{dow:1,doy:7}})}(y(1))},function(h,m,y){!function(h){"use strict";
//! moment.js locale configuration
h.defineLocale("mi",{months:"Kohi-tte_Hui-tanguru_Pout-te-rangi_Paenga-whwh_Haratua_Pipiri_Hngoingoi_Here-turi-kk_Mahuru_Whiringa--nuku_Whiringa--rangi_Hakihea".split("_"),monthsShort:"Kohi_Hui_Pou_Pae_Hara_Pipi_Hngoi_Here_Mahu_Whi-nu_Whi-ra_Haki".split("_"),monthsRegex:/(?:['a-z\u0101\u014D\u016B]+\-?){1,3}/i,monthsStrictRegex:/(?:['a-z\u0101\u014D\u016B]+\-?){1,3}/i,monthsShortRegex:/(?:['a-z\u0101\u014D\u016B]+\-?){1,3}/i,monthsShortStrictRegex:/(?:['a-z\u0101\u014D\u016B]+\-?){1,2}/i,weekdays:"Rtapu_Mane_Trei_Wenerei_Tite_Paraire_Htarei".split("_"),weekdaysShort:"Ta_Ma_T_We_Ti_Pa_H".split("_"),weekdaysMin:"Ta_Ma_T_We_Ti_Pa_H".split("_"),longDateFormat:{LT:"HH:mm",LTS:"HH:mm:ss",L:"DD/MM/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY [i] HH:mm",LLLL:"dddd, D MMMM YYYY [i] HH:mm"},calendar:{sameDay:"[i teie mahana, i] LT",nextDay:"[apopo i] LT",nextWeek:"dddd [i] LT",lastDay:"[inanahi i] LT",lastWeek:"dddd [whakamutunga i] LT",sameElse:"L"},relativeTime:{future:"i roto i %s",past:"%s i mua",s:"te hkona ruarua",ss:"%d hkona",m:"he meneti",mm:"%d meneti",h:"te haora",hh:"%d haora",d:"he ra",dd:"%d ra",M:"he marama",MM:"%d marama",y:"he tau",yy:"%d tau"},dayOfMonthOrdinalParse:/\d{1,2}/,ordinal:"%d",week:{dow:1,doy:4}})}(y(1))},function(h,m,y){!function(h){"use strict";
//! moment.js locale configuration
h.defineLocale("mk",{months:"___________".split("_"),monthsShort:"___________".split("_"),weekdays:"______".split("_"),weekdaysShort:"______".split("_"),weekdaysMin:"e_o_____a".split("_"),longDateFormat:{LT:"H:mm",LTS:"H:mm:ss",L:"D.MM.YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY H:mm",LLLL:"dddd, D MMMM YYYY H:mm"},calendar:{sameDay:"[ ] LT",nextDay:"[ ] LT",nextWeek:"[] dddd [] LT",lastDay:"[ ] LT",lastWeek:function(){switch(this.day()){case 0:case 3:case 6:return"[] dddd [] LT";case 1:case 2:case 4:case 5:return"[] dddd [] LT"}},sameElse:"L"},relativeTime:{future:" %s",past:" %s",s:" ",ss:"%d ",m:" ",mm:"%d ",h:" ",hh:"%d ",d:" ",dd:"%d ",M:" ",MM:"%d ",y:" ",yy:"%d "},dayOfMonthOrdinalParse:/\d{1,2}-(|||||)/,ordinal:function(h){var m=h%10,y=h%100;return 0===h?h+"-":0===y?h+"-":y>10&&y<20?h+"-":1===m?h+"-":2===m?h+"-":7===m||8===m?h+"-":h+"-"},week:{dow:1,doy:7}})}(y(1))},function(h,m,y){!function(h){"use strict";
//! moment.js locale configuration
h.defineLocale("ml",{months:"___________".split("_"),monthsShort:"._._._.___._._._._._.".split("_"),monthsParseExact:!0,weekdays:"______".split("_"),weekdaysShort:"______".split("_"),weekdaysMin:"______".split("_"),longDateFormat:{LT:"A h:mm -",LTS:"A h:mm:ss -",L:"DD/MM/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY, A h:mm -",LLLL:"dddd, D MMMM YYYY, A h:mm -"},calendar:{sameDay:"[] LT",nextDay:"[] LT",nextWeek:"dddd, LT",lastDay:"[] LT",lastWeek:"[] dddd, LT",sameElse:"L"},relativeTime:{future:"%s ",past:"%s ",s:" ",ss:"%d ",m:" ",mm:"%d ",h:" ",hh:"%d ",d:" ",dd:"%d ",M:" ",MM:"%d ",y:" ",yy:"%d "},meridiemParse:/|| ||/i,meridiemHour:function(h,m){return 12===h&&(h=0),""===m&&h>=4||" "===m||""===m?h+12:h},meridiem:function(h,m,y){return h<4?"":h<12?"":h<17?" ":h<20?"":""}})}(y(1))},function(h,m,y){!function(h){"use strict";
//! moment.js locale configuration
function translate(h,m,y,v){switch(y){case"s":return m?" ":" ";case"ss":return h+(m?" ":" ");case"m":case"mm":return h+(m?" ":" ");case"h":case"hh":return h+(m?" ":" ");case"d":case"dd":return h+(m?" ":" ");case"M":case"MM":return h+(m?" ":" ");case"y":case"yy":return h+(m?" ":" ");default:return h}}h.defineLocale("mn",{months:" _ _ _ _ _ _ _ _ _ _  _  ".split("_"),monthsShort:"1 _2 _3 _4 _5 _6 _7 _8 _9 _10 _11 _12 ".split("_"),monthsParseExact:!0,weekdays:"______".split("_"),weekdaysShort:"______".split("_"),weekdaysMin:"______".split("_"),weekdaysParseExact:!0,longDateFormat:{LT:"HH:mm",LTS:"HH:mm:ss",L:"YYYY-MM-DD",LL:"YYYY  MMMM D",LLL:"YYYY  MMMM D HH:mm",LLLL:"dddd, YYYY  MMMM D HH:mm"},meridiemParse:/|/i,isPM:function(h){return""===h},meridiem:function(h,m,y){return h<12?"":""},calendar:{sameDay:"[] LT",nextDay:"[] LT",nextWeek:"[] dddd LT",lastDay:"[] LT",lastWeek:"[] dddd LT",sameElse:"L"},relativeTime:{future:"%s ",past:"%s ",s:translate,ss:translate,m:translate,mm:translate,h:translate,hh:translate,d:translate,dd:translate,M:translate,MM:translate,y:translate,yy:translate},dayOfMonthOrdinalParse:/\d{1,2} /,ordinal:function(h,m){switch(m){case"d":case"D":case"DDD":return h+" ";default:return h}}})}(y(1))},function(h,m,y){!function(h){"use strict";
//! moment.js locale configuration
var m={1:"",2:"",3:"",4:"",5:"",6:"",7:"",8:"",9:"",0:""},y={"":"1","":"2","":"3","":"4","":"5","":"6","":"7","":"8","":"9","":"0"};function relativeTimeMr(h,m,y,v){var C="";if(m)switch(y){case"s":C=" ";break;case"ss":C="%d ";break;case"m":C=" ";break;case"mm":C="%d ";break;case"h":C=" ";break;case"hh":C="%d ";break;case"d":C=" ";break;case"dd":C="%d ";break;case"M":C=" ";break;case"MM":C="%d ";break;case"y":C=" ";break;case"yy":C="%d "}else switch(y){case"s":C=" ";break;case"ss":C="%d ";break;case"m":C=" ";break;case"mm":C="%d ";break;case"h":C=" ";break;case"hh":C="%d ";break;case"d":C=" ";break;case"dd":C="%d ";break;case"M":C=" ";break;case"MM":C="%d ";break;case"y":C=" ";break;case"yy":C="%d "}return C.replace(/%d/i,h)}h.defineLocale("mr",{months:"___________".split("_"),monthsShort:"._._._._._._._._._._._.".split("_"),monthsParseExact:!0,weekdays:"______".split("_"),weekdaysShort:"______".split("_"),weekdaysMin:"______".split("_"),longDateFormat:{LT:"A h:mm ",LTS:"A h:mm:ss ",L:"DD/MM/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY, A h:mm ",LLLL:"dddd, D MMMM YYYY, A h:mm "},calendar:{sameDay:"[] LT",nextDay:"[] LT",nextWeek:"dddd, LT",lastDay:"[] LT",lastWeek:"[] dddd, LT",sameElse:"L"},relativeTime:{future:"%s",past:"%s",s:relativeTimeMr,ss:relativeTimeMr,m:relativeTimeMr,mm:relativeTimeMr,h:relativeTimeMr,hh:relativeTimeMr,d:relativeTimeMr,dd:relativeTimeMr,M:relativeTimeMr,MM:relativeTimeMr,y:relativeTimeMr,yy:relativeTimeMr},preparse:function(h){return h.replace(/[]/g,(function(h){return y[h]}))},postformat:function(h){return h.replace(/\d/g,(function(h){return m[h]}))},meridiemParse:/||||/,meridiemHour:function(h,m){return 12===h&&(h=0),""===m||""===m?h:""===m||""===m||""===m?h>=12?h:h+12:void 0},meridiem:function(h,m,y){return h>=0&&h<6?"":h<12?"":h<17?"":h<20?"":""},week:{dow:0,doy:6}})}(y(1))},function(h,m,y){!function(h){"use strict";
//! moment.js locale configuration
h.defineLocale("ms",{months:"Januari_Februari_Mac_April_Mei_Jun_Julai_Ogos_September_Oktober_November_Disember".split("_"),monthsShort:"Jan_Feb_Mac_Apr_Mei_Jun_Jul_Ogs_Sep_Okt_Nov_Dis".split("_"),weekdays:"Ahad_Isnin_Selasa_Rabu_Khamis_Jumaat_Sabtu".split("_"),weekdaysShort:"Ahd_Isn_Sel_Rab_Kha_Jum_Sab".split("_"),weekdaysMin:"Ah_Is_Sl_Rb_Km_Jm_Sb".split("_"),longDateFormat:{LT:"HH.mm",LTS:"HH.mm.ss",L:"DD/MM/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY [pukul] HH.mm",LLLL:"dddd, D MMMM YYYY [pukul] HH.mm"},meridiemParse:/pagi|tengahari|petang|malam/,meridiemHour:function(h,m){return 12===h&&(h=0),"pagi"===m?h:"tengahari"===m?h>=11?h:h+12:"petang"===m||"malam"===m?h+12:void 0},meridiem:function(h,m,y){return h<11?"pagi":h<15?"tengahari":h<19?"petang":"malam"},calendar:{sameDay:"[Hari ini pukul] LT",nextDay:"[Esok pukul] LT",nextWeek:"dddd [pukul] LT",lastDay:"[Kelmarin pukul] LT",lastWeek:"dddd [lepas pukul] LT",sameElse:"L"},relativeTime:{future:"dalam %s",past:"%s yang lepas",s:"beberapa saat",ss:"%d saat",m:"seminit",mm:"%d minit",h:"sejam",hh:"%d jam",d:"sehari",dd:"%d hari",M:"sebulan",MM:"%d bulan",y:"setahun",yy:"%d tahun"},week:{dow:1,doy:7}})}(y(1))},function(h,m,y){!function(h){"use strict";
//! moment.js locale configuration
h.defineLocale("ms-my",{months:"Januari_Februari_Mac_April_Mei_Jun_Julai_Ogos_September_Oktober_November_Disember".split("_"),monthsShort:"Jan_Feb_Mac_Apr_Mei_Jun_Jul_Ogs_Sep_Okt_Nov_Dis".split("_"),weekdays:"Ahad_Isnin_Selasa_Rabu_Khamis_Jumaat_Sabtu".split("_"),weekdaysShort:"Ahd_Isn_Sel_Rab_Kha_Jum_Sab".split("_"),weekdaysMin:"Ah_Is_Sl_Rb_Km_Jm_Sb".split("_"),longDateFormat:{LT:"HH.mm",LTS:"HH.mm.ss",L:"DD/MM/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY [pukul] HH.mm",LLLL:"dddd, D MMMM YYYY [pukul] HH.mm"},meridiemParse:/pagi|tengahari|petang|malam/,meridiemHour:function(h,m){return 12===h&&(h=0),"pagi"===m?h:"tengahari"===m?h>=11?h:h+12:"petang"===m||"malam"===m?h+12:void 0},meridiem:function(h,m,y){return h<11?"pagi":h<15?"tengahari":h<19?"petang":"malam"},calendar:{sameDay:"[Hari ini pukul] LT",nextDay:"[Esok pukul] LT",nextWeek:"dddd [pukul] LT",lastDay:"[Kelmarin pukul] LT",lastWeek:"dddd [lepas pukul] LT",sameElse:"L"},relativeTime:{future:"dalam %s",past:"%s yang lepas",s:"beberapa saat",ss:"%d saat",m:"seminit",mm:"%d minit",h:"sejam",hh:"%d jam",d:"sehari",dd:"%d hari",M:"sebulan",MM:"%d bulan",y:"setahun",yy:"%d tahun"},week:{dow:1,doy:7}})}(y(1))},function(h,m,y){!function(h){"use strict";
//! moment.js locale configuration
h.defineLocale("mt",{months:"Jannar_Frar_Marzu_April_Mejju_unju_Lulju_Awwissu_Settembru_Ottubru_Novembru_Diembru".split("_"),monthsShort:"Jan_Fra_Mar_Apr_Mej_un_Lul_Aww_Set_Ott_Nov_Di".split("_"),weekdays:"Il-add_It-Tnejn_It-Tlieta_L-Erbga_Il-amis_Il-imga_Is-Sibt".split("_"),weekdaysShort:"ad_Tne_Tli_Erb_am_im_Sib".split("_"),weekdaysMin:"a_Tn_Tl_Er_a_i_Si".split("_"),longDateFormat:{LT:"HH:mm",LTS:"HH:mm:ss",L:"DD/MM/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY HH:mm",LLLL:"dddd, D MMMM YYYY HH:mm"},calendar:{sameDay:"[Illum fil-]LT",nextDay:"[Gada fil-]LT",nextWeek:"dddd [fil-]LT",lastDay:"[Il-biera fil-]LT",lastWeek:"dddd [li gadda] [fil-]LT",sameElse:"L"},relativeTime:{future:"f %s",past:"%s ilu",s:"ftit sekondi",ss:"%d sekondi",m:"minuta",mm:"%d minuti",h:"siega",hh:"%d siegat",d:"urnata",dd:"%d ranet",M:"xahar",MM:"%d xhur",y:"sena",yy:"%d sni"},dayOfMonthOrdinalParse:/\d{1,2}/,ordinal:"%d",week:{dow:1,doy:4}})}(y(1))},function(h,m,y){!function(h){"use strict";
//! moment.js locale configuration
var m={1:"",2:"",3:"",4:"",5:"",6:"",7:"",8:"",9:"",0:""},y={"":"1","":"2","":"3","":"4","":"5","":"6","":"7","":"8","":"9","":"0"};h.defineLocale("my",{months:"___________".split("_"),monthsShort:"___________".split("_"),weekdays:"______".split("_"),weekdaysShort:"______".split("_"),weekdaysMin:"______".split("_"),longDateFormat:{LT:"HH:mm",LTS:"HH:mm:ss",L:"DD/MM/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY HH:mm",LLLL:"dddd D MMMM YYYY HH:mm"},calendar:{sameDay:"[.] LT []",nextDay:"[] LT []",nextWeek:"dddd LT []",lastDay:"[.] LT []",lastWeek:"[] dddd LT []",sameElse:"L"},relativeTime:{future:" %s ",past:" %s ",s:".",ss:"%d ",m:"",mm:"%d ",h:"",hh:"%d ",d:"",dd:"%d ",M:"",MM:"%d ",y:"",yy:"%d "},preparse:function(h){return h.replace(/[]/g,(function(h){return y[h]}))},postformat:function(h){return h.replace(/\d/g,(function(h){return m[h]}))},week:{dow:1,doy:4}})}(y(1))},function(h,m,y){!function(h){"use strict";
//! moment.js locale configuration
h.defineLocale("nb",{months:"januar_februar_mars_april_mai_juni_juli_august_september_oktober_november_desember".split("_"),monthsShort:"jan._feb._mars_apr._mai_juni_juli_aug._sep._okt._nov._des.".split("_"),monthsParseExact:!0,weekdays:"sndag_mandag_tirsdag_onsdag_torsdag_fredag_lrdag".split("_"),weekdaysShort:"s._ma._ti._on._to._fr._l.".split("_"),weekdaysMin:"s_ma_ti_on_to_fr_l".split("_"),weekdaysParseExact:!0,longDateFormat:{LT:"HH:mm",LTS:"HH:mm:ss",L:"DD.MM.YYYY",LL:"D. MMMM YYYY",LLL:"D. MMMM YYYY [kl.] HH:mm",LLLL:"dddd D. MMMM YYYY [kl.] HH:mm"},calendar:{sameDay:"[i dag kl.] LT",nextDay:"[i morgen kl.] LT",nextWeek:"dddd [kl.] LT",lastDay:"[i gr kl.] LT",lastWeek:"[forrige] dddd [kl.] LT",sameElse:"L"},relativeTime:{future:"om %s",past:"%s siden",s:"noen sekunder",ss:"%d sekunder",m:"ett minutt",mm:"%d minutter",h:"en time",hh:"%d timer",d:"en dag",dd:"%d dager",M:"en mned",MM:"%d mneder",y:"ett r",yy:"%d r"},dayOfMonthOrdinalParse:/\d{1,2}\./,ordinal:"%d.",week:{dow:1,doy:4}})}(y(1))},function(h,m,y){!function(h){"use strict";
//! moment.js locale configuration
var m={1:"",2:"",3:"",4:"",5:"",6:"",7:"",8:"",9:"",0:""},y={"":"1","":"2","":"3","":"4","":"5","":"6","":"7","":"8","":"9","":"0"};h.defineLocale("ne",{months:"___________".split("_"),monthsShort:"._.__.___._._._._._.".split("_"),monthsParseExact:!0,weekdays:"______".split("_"),weekdaysShort:"._._._._._._.".split("_"),weekdaysMin:"._._._._._._.".split("_"),weekdaysParseExact:!0,longDateFormat:{LT:"A h:mm ",LTS:"A h:mm:ss ",L:"DD/MM/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY, A h:mm ",LLLL:"dddd, D MMMM YYYY, A h:mm "},preparse:function(h){return h.replace(/[]/g,(function(h){return y[h]}))},postformat:function(h){return h.replace(/\d/g,(function(h){return m[h]}))},meridiemParse:/|||/,meridiemHour:function(h,m){return 12===h&&(h=0),""===m?h<4?h:h+12:""===m?h:""===m?h>=10?h:h+12:""===m?h+12:void 0},meridiem:function(h,m,y){return h<3?"":h<12?"":h<16?"":h<20?"":""},calendar:{sameDay:"[] LT",nextDay:"[] LT",nextWeek:"[] dddd[,] LT",lastDay:"[] LT",lastWeek:"[] dddd[,] LT",sameElse:"L"},relativeTime:{future:"%s",past:"%s ",s:" ",ss:"%d ",m:" ",mm:"%d ",h:" ",hh:"%d ",d:" ",dd:"%d ",M:" ",MM:"%d ",y:" ",yy:"%d "},week:{dow:0,doy:6}})}(y(1))},function(h,m,y){!function(h){"use strict";
//! moment.js locale configuration
var m="jan._feb._mrt._apr._mei_jun._jul._aug._sep._okt._nov._dec.".split("_"),y="jan_feb_mrt_apr_mei_jun_jul_aug_sep_okt_nov_dec".split("_"),v=[/^jan/i,/^feb/i,/^maart|mrt.?$/i,/^apr/i,/^mei$/i,/^jun[i.]?$/i,/^jul[i.]?$/i,/^aug/i,/^sep/i,/^okt/i,/^nov/i,/^dec/i],C=/^(januari|februari|maart|april|mei|ju[nl]i|augustus|september|oktober|november|december|jan\.?|feb\.?|mrt\.?|apr\.?|ju[nl]\.?|aug\.?|sep\.?|okt\.?|nov\.?|dec\.?)/i;h.defineLocale("nl",{months:"januari_februari_maart_april_mei_juni_juli_augustus_september_oktober_november_december".split("_"),monthsShort:function(h,v){return h?/-MMM-/.test(v)?y[h.month()]:m[h.month()]:m},monthsRegex:C,monthsShortRegex:C,monthsStrictRegex:/^(januari|februari|maart|april|mei|ju[nl]i|augustus|september|oktober|november|december)/i,monthsShortStrictRegex:/^(jan\.?|feb\.?|mrt\.?|apr\.?|mei|ju[nl]\.?|aug\.?|sep\.?|okt\.?|nov\.?|dec\.?)/i,monthsParse:v,longMonthsParse:v,shortMonthsParse:v,weekdays:"zondag_maandag_dinsdag_woensdag_donderdag_vrijdag_zaterdag".split("_"),weekdaysShort:"zo._ma._di._wo._do._vr._za.".split("_"),weekdaysMin:"zo_ma_di_wo_do_vr_za".split("_"),weekdaysParseExact:!0,longDateFormat:{LT:"HH:mm",LTS:"HH:mm:ss",L:"DD-MM-YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY HH:mm",LLLL:"dddd D MMMM YYYY HH:mm"},calendar:{sameDay:"[vandaag om] LT",nextDay:"[morgen om] LT",nextWeek:"dddd [om] LT",lastDay:"[gisteren om] LT",lastWeek:"[afgelopen] dddd [om] LT",sameElse:"L"},relativeTime:{future:"over %s",past:"%s geleden",s:"een paar seconden",ss:"%d seconden",m:"n minuut",mm:"%d minuten",h:"n uur",hh:"%d uur",d:"n dag",dd:"%d dagen",M:"n maand",MM:"%d maanden",y:"n jaar",yy:"%d jaar"},dayOfMonthOrdinalParse:/\d{1,2}(ste|de)/,ordinal:function(h){return h+(1===h||8===h||h>=20?"ste":"de")},week:{dow:1,doy:4}})}(y(1))},function(h,m,y){!function(h){"use strict";
//! moment.js locale configuration
var m="jan._feb._mrt._apr._mei_jun._jul._aug._sep._okt._nov._dec.".split("_"),y="jan_feb_mrt_apr_mei_jun_jul_aug_sep_okt_nov_dec".split("_"),v=[/^jan/i,/^feb/i,/^maart|mrt.?$/i,/^apr/i,/^mei$/i,/^jun[i.]?$/i,/^jul[i.]?$/i,/^aug/i,/^sep/i,/^okt/i,/^nov/i,/^dec/i],C=/^(januari|februari|maart|april|mei|ju[nl]i|augustus|september|oktober|november|december|jan\.?|feb\.?|mrt\.?|apr\.?|ju[nl]\.?|aug\.?|sep\.?|okt\.?|nov\.?|dec\.?)/i;h.defineLocale("nl-be",{months:"januari_februari_maart_april_mei_juni_juli_augustus_september_oktober_november_december".split("_"),monthsShort:function(h,v){return h?/-MMM-/.test(v)?y[h.month()]:m[h.month()]:m},monthsRegex:C,monthsShortRegex:C,monthsStrictRegex:/^(januari|februari|maart|april|mei|ju[nl]i|augustus|september|oktober|november|december)/i,monthsShortStrictRegex:/^(jan\.?|feb\.?|mrt\.?|apr\.?|mei|ju[nl]\.?|aug\.?|sep\.?|okt\.?|nov\.?|dec\.?)/i,monthsParse:v,longMonthsParse:v,shortMonthsParse:v,weekdays:"zondag_maandag_dinsdag_woensdag_donderdag_vrijdag_zaterdag".split("_"),weekdaysShort:"zo._ma._di._wo._do._vr._za.".split("_"),weekdaysMin:"zo_ma_di_wo_do_vr_za".split("_"),weekdaysParseExact:!0,longDateFormat:{LT:"HH:mm",LTS:"HH:mm:ss",L:"DD/MM/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY HH:mm",LLLL:"dddd D MMMM YYYY HH:mm"},calendar:{sameDay:"[vandaag om] LT",nextDay:"[morgen om] LT",nextWeek:"dddd [om] LT",lastDay:"[gisteren om] LT",lastWeek:"[afgelopen] dddd [om] LT",sameElse:"L"},relativeTime:{future:"over %s",past:"%s geleden",s:"een paar seconden",ss:"%d seconden",m:"n minuut",mm:"%d minuten",h:"n uur",hh:"%d uur",d:"n dag",dd:"%d dagen",M:"n maand",MM:"%d maanden",y:"n jaar",yy:"%d jaar"},dayOfMonthOrdinalParse:/\d{1,2}(ste|de)/,ordinal:function(h){return h+(1===h||8===h||h>=20?"ste":"de")},week:{dow:1,doy:4}})}(y(1))},function(h,m,y){!function(h){"use strict";
//! moment.js locale configuration
h.defineLocale("nn",{months:"januar_februar_mars_april_mai_juni_juli_august_september_oktober_november_desember".split("_"),monthsShort:"jan._feb._mars_apr._mai_juni_juli_aug._sep._okt._nov._des.".split("_"),monthsParseExact:!0,weekdays:"sundag_mndag_tysdag_onsdag_torsdag_fredag_laurdag".split("_"),weekdaysShort:"su._m._ty._on._to._fr._lau.".split("_"),weekdaysMin:"su_m_ty_on_to_fr_la".split("_"),weekdaysParseExact:!0,longDateFormat:{LT:"HH:mm",LTS:"HH:mm:ss",L:"DD.MM.YYYY",LL:"D. MMMM YYYY",LLL:"D. MMMM YYYY [kl.] H:mm",LLLL:"dddd D. MMMM YYYY [kl.] HH:mm"},calendar:{sameDay:"[I dag klokka] LT",nextDay:"[I morgon klokka] LT",nextWeek:"dddd [klokka] LT",lastDay:"[I gr klokka] LT",lastWeek:"[Fregande] dddd [klokka] LT",sameElse:"L"},relativeTime:{future:"om %s",past:"%s sidan",s:"nokre sekund",ss:"%d sekund",m:"eit minutt",mm:"%d minutt",h:"ein time",hh:"%d timar",d:"ein dag",dd:"%d dagar",M:"ein mnad",MM:"%d mnader",y:"eit r",yy:"%d r"},dayOfMonthOrdinalParse:/\d{1,2}\./,ordinal:"%d.",week:{dow:1,doy:4}})}(y(1))},function(h,m,y){!function(h){"use strict";
//! moment.js locale configuration
h.defineLocale("oc-lnc",{months:{standalone:"genir_febrir_mar_abril_mai_junh_julhet_agost_setembre_octbre_novembre_decembre".split("_"),format:"de genir_de febrir_de mar_d'abril_de mai_de junh_de julhet_d'agost_de setembre_d'octbre_de novembre_de decembre".split("_"),isFormat:/D[oD]?(\s)+MMMM/},monthsShort:"gen._febr._mar_abr._mai_junh_julh._ago._set._oct._nov._dec.".split("_"),monthsParseExact:!0,weekdays:"dimenge_diluns_dimars_dimcres_dijus_divendres_dissabte".split("_"),weekdaysShort:"dg._dl._dm._dc._dj._dv._ds.".split("_"),weekdaysMin:"dg_dl_dm_dc_dj_dv_ds".split("_"),weekdaysParseExact:!0,longDateFormat:{LT:"H:mm",LTS:"H:mm:ss",L:"DD/MM/YYYY",LL:"D MMMM [de] YYYY",ll:"D MMM YYYY",LLL:"D MMMM [de] YYYY [a] H:mm",lll:"D MMM YYYY, H:mm",LLLL:"dddd D MMMM [de] YYYY [a] H:mm",llll:"ddd D MMM YYYY, H:mm"},calendar:{sameDay:"[ui a] LT",nextDay:"[deman a] LT",nextWeek:"dddd [a] LT",lastDay:"[ir a] LT",lastWeek:"dddd [passat a] LT",sameElse:"L"},relativeTime:{future:"d'aqu %s",past:"fa %s",s:"unas segondas",ss:"%d segondas",m:"una minuta",mm:"%d minutas",h:"una ora",hh:"%d oras",d:"un jorn",dd:"%d jorns",M:"un mes",MM:"%d meses",y:"un an",yy:"%d ans"},dayOfMonthOrdinalParse:/\d{1,2}(r|n|t||a)/,ordinal:function(h,m){var y=1===h?"r":2===h?"n":3===h?"r":4===h?"t":"";return"w"!==m&&"W"!==m||(y="a"),h+y},week:{dow:1,doy:4}})}(y(1))},function(h,m,y){!function(h){"use strict";
//! moment.js locale configuration
var m={1:"",2:"",3:"",4:"",5:"",6:"",7:"",8:"",9:"",0:""},y={"":"1","":"2","":"3","":"4","":"5","":"6","":"7","":"8","":"9","":"0"};h.defineLocale("pa-in",{months:"___________".split("_"),monthsShort:"___________".split("_"),weekdays:"______".split("_"),weekdaysShort:"______".split("_"),weekdaysMin:"______".split("_"),longDateFormat:{LT:"A h:mm ",LTS:"A h:mm:ss ",L:"DD/MM/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY, A h:mm ",LLLL:"dddd, D MMMM YYYY, A h:mm "},calendar:{sameDay:"[] LT",nextDay:"[] LT",nextWeek:"[] dddd, LT",lastDay:"[] LT",lastWeek:"[] dddd, LT",sameElse:"L"},relativeTime:{future:"%s ",past:"%s ",s:" ",ss:"%d ",m:" ",mm:"%d ",h:" ",hh:"%d ",d:" ",dd:"%d ",M:" ",MM:"%d ",y:" ",yy:"%d "},preparse:function(h){return h.replace(/[]/g,(function(h){return y[h]}))},postformat:function(h){return h.replace(/\d/g,(function(h){return m[h]}))},meridiemParse:/|||/,meridiemHour:function(h,m){return 12===h&&(h=0),""===m?h<4?h:h+12:""===m?h:""===m?h>=10?h:h+12:""===m?h+12:void 0},meridiem:function(h,m,y){return h<4?"":h<10?"":h<17?"":h<20?"":""},week:{dow:0,doy:6}})}(y(1))},function(h,m,y){!function(h){"use strict";
//! moment.js locale configuration
var m="stycze_luty_marzec_kwiecie_maj_czerwiec_lipiec_sierpie_wrzesie_padziernik_listopad_grudzie".split("_"),y="stycznia_lutego_marca_kwietnia_maja_czerwca_lipca_sierpnia_wrzenia_padziernika_listopada_grudnia".split("_");function plural(h){return h%10<5&&h%10>1&&~~(h/10)%10!=1}function translate(h,m,y){var v=h+" ";switch(y){case"ss":return v+(plural(h)?"sekundy":"sekund");case"m":return m?"minuta":"minut";case"mm":return v+(plural(h)?"minuty":"minut");case"h":return m?"godzina":"godzin";case"hh":return v+(plural(h)?"godziny":"godzin");case"MM":return v+(plural(h)?"miesice":"miesicy");case"yy":return v+(plural(h)?"lata":"lat")}}h.defineLocale("pl",{months:function(h,v){return h?""===v?"("+y[h.month()]+"|"+m[h.month()]+")":/D MMMM/.test(v)?y[h.month()]:m[h.month()]:m},monthsShort:"sty_lut_mar_kwi_maj_cze_lip_sie_wrz_pa_lis_gru".split("_"),weekdays:"niedziela_poniedziaek_wtorek_roda_czwartek_pitek_sobota".split("_"),weekdaysShort:"ndz_pon_wt_r_czw_pt_sob".split("_"),weekdaysMin:"Nd_Pn_Wt_r_Cz_Pt_So".split("_"),longDateFormat:{LT:"HH:mm",LTS:"HH:mm:ss",L:"DD.MM.YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY HH:mm",LLLL:"dddd, D MMMM YYYY HH:mm"},calendar:{sameDay:"[Dzi o] LT",nextDay:"[Jutro o] LT",nextWeek:function(){switch(this.day()){case 0:return"[W niedziel o] LT";case 2:return"[We wtorek o] LT";case 3:return"[W rod o] LT";case 6:return"[W sobot o] LT";default:return"[W] dddd [o] LT"}},lastDay:"[Wczoraj o] LT",lastWeek:function(){switch(this.day()){case 0:return"[W zesz niedziel o] LT";case 3:return"[W zesz rod o] LT";case 6:return"[W zesz sobot o] LT";default:return"[W zeszy] dddd [o] LT"}},sameElse:"L"},relativeTime:{future:"za %s",past:"%s temu",s:"kilka sekund",ss:translate,m:translate,mm:translate,h:translate,hh:translate,d:"1 dzie",dd:"%d dni",M:"miesic",MM:translate,y:"rok",yy:translate},dayOfMonthOrdinalParse:/\d{1,2}\./,ordinal:"%d.",week:{dow:1,doy:4}})}(y(1))},function(h,m,y){!function(h){"use strict";
//! moment.js locale configuration
h.defineLocale("pt",{months:"janeiro_fevereiro_maro_abril_maio_junho_julho_agosto_setembro_outubro_novembro_dezembro".split("_"),monthsShort:"jan_fev_mar_abr_mai_jun_jul_ago_set_out_nov_dez".split("_"),weekdays:"Domingo_Segunda-feira_Tera-feira_Quarta-feira_Quinta-feira_Sexta-feira_Sbado".split("_"),weekdaysShort:"Dom_Seg_Ter_Qua_Qui_Sex_Sb".split("_"),weekdaysMin:"Do_2_3_4_5_6_S".split("_"),weekdaysParseExact:!0,longDateFormat:{LT:"HH:mm",LTS:"HH:mm:ss",L:"DD/MM/YYYY",LL:"D [de] MMMM [de] YYYY",LLL:"D [de] MMMM [de] YYYY HH:mm",LLLL:"dddd, D [de] MMMM [de] YYYY HH:mm"},calendar:{sameDay:"[Hoje s] LT",nextDay:"[Amanh s] LT",nextWeek:"dddd [s] LT",lastDay:"[Ontem s] LT",lastWeek:function(){return 0===this.day()||6===this.day()?"[ltimo] dddd [s] LT":"[ltima] dddd [s] LT"},sameElse:"L"},relativeTime:{future:"em %s",past:"h %s",s:"segundos",ss:"%d segundos",m:"um minuto",mm:"%d minutos",h:"uma hora",hh:"%d horas",d:"um dia",dd:"%d dias",M:"um ms",MM:"%d meses",y:"um ano",yy:"%d anos"},dayOfMonthOrdinalParse:/\d{1,2}/,ordinal:"%d",week:{dow:1,doy:4}})}(y(1))},function(h,m,y){!function(h){"use strict";
//! moment.js locale configuration
h.defineLocale("pt-br",{months:"janeiro_fevereiro_maro_abril_maio_junho_julho_agosto_setembro_outubro_novembro_dezembro".split("_"),monthsShort:"jan_fev_mar_abr_mai_jun_jul_ago_set_out_nov_dez".split("_"),weekdays:"domingo_segunda-feira_tera-feira_quarta-feira_quinta-feira_sexta-feira_sbado".split("_"),weekdaysShort:"dom_seg_ter_qua_qui_sex_sb".split("_"),weekdaysMin:"do_2_3_4_5_6_s".split("_"),weekdaysParseExact:!0,longDateFormat:{LT:"HH:mm",LTS:"HH:mm:ss",L:"DD/MM/YYYY",LL:"D [de] MMMM [de] YYYY",LLL:"D [de] MMMM [de] YYYY [s] HH:mm",LLLL:"dddd, D [de] MMMM [de] YYYY [s] HH:mm"},calendar:{sameDay:"[Hoje s] LT",nextDay:"[Amanh s] LT",nextWeek:"dddd [s] LT",lastDay:"[Ontem s] LT",lastWeek:function(){return 0===this.day()||6===this.day()?"[ltimo] dddd [s] LT":"[ltima] dddd [s] LT"},sameElse:"L"},relativeTime:{future:"em %s",past:"h %s",s:"poucos segundos",ss:"%d segundos",m:"um minuto",mm:"%d minutos",h:"uma hora",hh:"%d horas",d:"um dia",dd:"%d dias",M:"um ms",MM:"%d meses",y:"um ano",yy:"%d anos"},dayOfMonthOrdinalParse:/\d{1,2}/,ordinal:"%d"})}(y(1))},function(h,m,y){!function(h){"use strict";
//! moment.js locale configuration
function relativeTimeWithPlural(h,m,y){var v=" ";return(h%100>=20||h>=100&&h%100==0)&&(v=" de "),h+v+{ss:"secunde",mm:"minute",hh:"ore",dd:"zile",MM:"luni",yy:"ani"}[y]}h.defineLocale("ro",{months:"ianuarie_februarie_martie_aprilie_mai_iunie_iulie_august_septembrie_octombrie_noiembrie_decembrie".split("_"),monthsShort:"ian._feb._mart._apr._mai_iun._iul._aug._sept._oct._nov._dec.".split("_"),monthsParseExact:!0,weekdays:"duminic_luni_mari_miercuri_joi_vineri_smbt".split("_"),weekdaysShort:"Dum_Lun_Mar_Mie_Joi_Vin_Sm".split("_"),weekdaysMin:"Du_Lu_Ma_Mi_Jo_Vi_S".split("_"),longDateFormat:{LT:"H:mm",LTS:"H:mm:ss",L:"DD.MM.YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY H:mm",LLLL:"dddd, D MMMM YYYY H:mm"},calendar:{sameDay:"[azi la] LT",nextDay:"[mine la] LT",nextWeek:"dddd [la] LT",lastDay:"[ieri la] LT",lastWeek:"[fosta] dddd [la] LT",sameElse:"L"},relativeTime:{future:"peste %s",past:"%s n urm",s:"cteva secunde",ss:relativeTimeWithPlural,m:"un minut",mm:relativeTimeWithPlural,h:"o or",hh:relativeTimeWithPlural,d:"o zi",dd:relativeTimeWithPlural,M:"o lun",MM:relativeTimeWithPlural,y:"un an",yy:relativeTimeWithPlural},week:{dow:1,doy:7}})}(y(1))},function(h,m,y){!function(h){"use strict";
//! moment.js locale configuration
function relativeTimeWithPlural(h,m,y){return"m"===y?m?"":"":h+" "+function plural(h,m){var y=h.split("_");return m%10==1&&m%100!=11?y[0]:m%10>=2&&m%10<=4&&(m%100<10||m%100>=20)?y[1]:y[2]}({ss:m?"__":"__",mm:m?"__":"__",hh:"__",dd:"__",MM:"__",yy:"__"}[y],+h)}var m=[/^/i,/^/i,/^/i,/^/i,/^[]/i,/^/i,/^/i,/^/i,/^/i,/^/i,/^/i,/^/i];h.defineLocale("ru",{months:{format:"___________".split("_"),standalone:"___________".split("_")},monthsShort:{format:"._._._.____._._._._.".split("_"),standalone:"._.__.____._._._._.".split("_")},weekdays:{standalone:"______".split("_"),format:"______".split("_"),isFormat:/\[ ?[] ?(?:||)? ?] ?dddd/},weekdaysShort:"______".split("_"),weekdaysMin:"______".split("_"),monthsParse:m,longMonthsParse:m,shortMonthsParse:m,monthsRegex:/^([]|\.?|[]|?\.?|?|\.?|[]|\.?|[]|[]|\.?|[]|\.?|?|\.?|[]|?\.?|[]|\.?|[]|?\.?|[]|\.?)/i,monthsShortRegex:/^([]|\.?|[]|?\.?|?|\.?|[]|\.?|[]|[]|\.?|[]|\.?|?|\.?|[]|?\.?|[]|\.?|[]|?\.?|[]|\.?)/i,monthsStrictRegex:/^([]|[]|?|[]|[]|[]|[]|?|[]|[]|[]|[])/i,monthsShortStrictRegex:/^(\.|?\.|[.]|\.|[]|[.]|[.]|\.|?\.|\.|?\.|\.)/i,longDateFormat:{LT:"H:mm",LTS:"H:mm:ss",L:"DD.MM.YYYY",LL:"D MMMM YYYY .",LLL:"D MMMM YYYY ., H:mm",LLLL:"dddd, D MMMM YYYY ., H:mm"},calendar:{sameDay:"[, ] LT",nextDay:"[, ] LT",lastDay:"[, ] LT",nextWeek:function(h){if(h.week()===this.week())return 2===this.day()?"[] dddd, [] LT":"[] dddd, [] LT";switch(this.day()){case 0:return"[ ] dddd, [] LT";case 1:case 2:case 4:return"[ ] dddd, [] LT";case 3:case 5:case 6:return"[ ] dddd, [] LT"}},lastWeek:function(h){if(h.week()===this.week())return 2===this.day()?"[] dddd, [] LT":"[] dddd, [] LT";switch(this.day()){case 0:return"[ ] dddd, [] LT";case 1:case 2:case 4:return"[ ] dddd, [] LT";case 3:case 5:case 6:return"[ ] dddd, [] LT"}},sameElse:"L"},relativeTime:{future:" %s",past:"%s ",s:" ",ss:relativeTimeWithPlural,m:relativeTimeWithPlural,mm:relativeTimeWithPlural,h:"",hh:relativeTimeWithPlural,d:"",dd:relativeTimeWithPlural,M:"",MM:relativeTimeWithPlural,y:"",yy:relativeTimeWithPlural},meridiemParse:/|||/i,isPM:function(h){return/^(|)$/.test(h)},meridiem:function(h,m,y){return h<4?"":h<12?"":h<17?"":""},dayOfMonthOrdinalParse:/\d{1,2}-(||)/,ordinal:function(h,m){switch(m){case"M":case"d":case"DDD":return h+"-";case"D":return h+"-";case"w":case"W":return h+"-";default:return h}},week:{dow:1,doy:4}})}(y(1))},function(h,m,y){!function(h){"use strict";
//! moment.js locale configuration
var m=["","","","","","","","","","","",""],y=["","","","","","",""];h.defineLocale("sd",{months:m,monthsShort:m,weekdays:y,weekdaysShort:y,weekdaysMin:y,longDateFormat:{LT:"HH:mm",LTS:"HH:mm:ss",L:"DD/MM/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY HH:mm",LLLL:"dddd D MMMM YYYY HH:mm"},meridiemParse:/|/,isPM:function(h){return""===h},meridiem:function(h,m,y){return h<12?"":""},calendar:{sameDay:"[] LT",nextDay:"[] LT",nextWeek:"dddd [  ] LT",lastDay:"[] LT",lastWeek:"[ ] dddd [] LT",sameElse:"L"},relativeTime:{future:"%s ",past:"%s ",s:" ",ss:"%d ",m:" ",mm:"%d ",h:" ",hh:"%d ",d:" ",dd:"%d ",M:" ",MM:"%d ",y:" ",yy:"%d "},preparse:function(h){return h.replace(//g,",")},postformat:function(h){return h.replace(/,/g,"")},week:{dow:1,doy:4}})}(y(1))},function(h,m,y){!function(h){"use strict";
//! moment.js locale configuration
h.defineLocale("se",{months:"oajagemnnu_guovvamnnu_njukamnnu_cuoomnnu_miessemnnu_geassemnnu_suoidnemnnu_borgemnnu_akamnnu_golggotmnnu_skbmamnnu_juovlamnnu".split("_"),monthsShort:"oj_guov_njuk_cuo_mies_geas_suoi_borg_ak_golg_skb_juov".split("_"),weekdays:"sotnabeaivi_vuossrga_maebrga_gaskavahkku_duorastat_bearjadat_lvvardat".split("_"),weekdaysShort:"sotn_vuos_ma_gask_duor_bear_lv".split("_"),weekdaysMin:"s_v_m_g_d_b_L".split("_"),longDateFormat:{LT:"HH:mm",LTS:"HH:mm:ss",L:"DD.MM.YYYY",LL:"MMMM D. [b.] YYYY",LLL:"MMMM D. [b.] YYYY [ti.] HH:mm",LLLL:"dddd, MMMM D. [b.] YYYY [ti.] HH:mm"},calendar:{sameDay:"[otne ti] LT",nextDay:"[ihttin ti] LT",nextWeek:"dddd [ti] LT",lastDay:"[ikte ti] LT",lastWeek:"[ovddit] dddd [ti] LT",sameElse:"L"},relativeTime:{future:"%s geaes",past:"mait %s",s:"moadde sekunddat",ss:"%d sekunddat",m:"okta minuhta",mm:"%d minuhtat",h:"okta diimmu",hh:"%d diimmut",d:"okta beaivi",dd:"%d beaivvit",M:"okta mnnu",MM:"%d mnut",y:"okta jahki",yy:"%d jagit"},dayOfMonthOrdinalParse:/\d{1,2}\./,ordinal:"%d.",week:{dow:1,doy:4}})}(y(1))},function(h,m,y){!function(h){"use strict";
//! moment.js locale configuration
h.defineLocale("si",{months:"___________".split("_"),monthsShort:"___________".split("_"),weekdays:"______".split("_"),weekdaysShort:"______".split("_"),weekdaysMin:"______".split("_"),weekdaysParseExact:!0,longDateFormat:{LT:"a h:mm",LTS:"a h:mm:ss",L:"YYYY/MM/DD",LL:"YYYY MMMM D",LLL:"YYYY MMMM D, a h:mm",LLLL:"YYYY MMMM D [] dddd, a h:mm:ss"},calendar:{sameDay:"[] LT[]",nextDay:"[] LT[]",nextWeek:"dddd LT[]",lastDay:"[] LT[]",lastWeek:"[] dddd LT[]",sameElse:"L"},relativeTime:{future:"%s",past:"%s ",s:" ",ss:" %d",m:"",mm:" %d",h:"",hh:" %d",d:"",dd:" %d",M:"",MM:" %d",y:"",yy:" %d"},dayOfMonthOrdinalParse:/\d{1,2} /,ordinal:function(h){return h+" "},meridiemParse:/ | |.|../,isPM:function(h){return".."===h||" "===h},meridiem:function(h,m,y){return h>11?y?"..":" ":y?"..":" "}})}(y(1))},function(h,m,y){!function(h){"use strict";
//! moment.js locale configuration
var m="janur_februr_marec_aprl_mj_jn_jl_august_september_oktber_november_december".split("_"),y="jan_feb_mar_apr_mj_jn_jl_aug_sep_okt_nov_dec".split("_");function plural(h){return h>1&&h<5}function translate(h,m,y,v){var C=h+" ";switch(y){case"s":return m||v?"pr seknd":"pr sekundami";case"ss":return m||v?C+(plural(h)?"sekundy":"seknd"):C+"sekundami";case"m":return m?"minta":v?"mintu":"mintou";case"mm":return m||v?C+(plural(h)?"minty":"mint"):C+"mintami";case"h":return m?"hodina":v?"hodinu":"hodinou";case"hh":return m||v?C+(plural(h)?"hodiny":"hodn"):C+"hodinami";case"d":return m||v?"de":"dom";case"dd":return m||v?C+(plural(h)?"dni":"dn"):C+"dami";case"M":return m||v?"mesiac":"mesiacom";case"MM":return m||v?C+(plural(h)?"mesiace":"mesiacov"):C+"mesiacmi";case"y":return m||v?"rok":"rokom";case"yy":return m||v?C+(plural(h)?"roky":"rokov"):C+"rokmi"}}h.defineLocale("sk",{months:m,monthsShort:y,weekdays:"nedea_pondelok_utorok_streda_tvrtok_piatok_sobota".split("_"),weekdaysShort:"ne_po_ut_st_t_pi_so".split("_"),weekdaysMin:"ne_po_ut_st_t_pi_so".split("_"),longDateFormat:{LT:"H:mm",LTS:"H:mm:ss",L:"DD.MM.YYYY",LL:"D. MMMM YYYY",LLL:"D. MMMM YYYY H:mm",LLLL:"dddd D. MMMM YYYY H:mm"},calendar:{sameDay:"[dnes o] LT",nextDay:"[zajtra o] LT",nextWeek:function(){switch(this.day()){case 0:return"[v nedeu o] LT";case 1:case 2:return"[v] dddd [o] LT";case 3:return"[v stredu o] LT";case 4:return"[vo tvrtok o] LT";case 5:return"[v piatok o] LT";case 6:return"[v sobotu o] LT"}},lastDay:"[vera o] LT",lastWeek:function(){switch(this.day()){case 0:return"[minul nedeu o] LT";case 1:case 2:return"[minul] dddd [o] LT";case 3:return"[minul stredu o] LT";case 4:case 5:return"[minul] dddd [o] LT";case 6:return"[minul sobotu o] LT"}},sameElse:"L"},relativeTime:{future:"za %s",past:"pred %s",s:translate,ss:translate,m:translate,mm:translate,h:translate,hh:translate,d:translate,dd:translate,M:translate,MM:translate,y:translate,yy:translate},dayOfMonthOrdinalParse:/\d{1,2}\./,ordinal:"%d.",week:{dow:1,doy:4}})}(y(1))},function(h,m,y){!function(h){"use strict";
//! moment.js locale configuration
function processRelativeTime(h,m,y,v){var C=h+" ";switch(y){case"s":return m||v?"nekaj sekund":"nekaj sekundami";case"ss":return C+=1===h?m?"sekundo":"sekundi":2===h?m||v?"sekundi":"sekundah":h<5?m||v?"sekunde":"sekundah":"sekund";case"m":return m?"ena minuta":"eno minuto";case"mm":return C+=1===h?m?"minuta":"minuto":2===h?m||v?"minuti":"minutama":h<5?m||v?"minute":"minutami":m||v?"minut":"minutami";case"h":return m?"ena ura":"eno uro";case"hh":return C+=1===h?m?"ura":"uro":2===h?m||v?"uri":"urama":h<5?m||v?"ure":"urami":m||v?"ur":"urami";case"d":return m||v?"en dan":"enim dnem";case"dd":return C+=1===h?m||v?"dan":"dnem":2===h?m||v?"dni":"dnevoma":m||v?"dni":"dnevi";case"M":return m||v?"en mesec":"enim mesecem";case"MM":return C+=1===h?m||v?"mesec":"mesecem":2===h?m||v?"meseca":"mesecema":h<5?m||v?"mesece":"meseci":m||v?"mesecev":"meseci";case"y":return m||v?"eno leto":"enim letom";case"yy":return C+=1===h?m||v?"leto":"letom":2===h?m||v?"leti":"letoma":h<5?m||v?"leta":"leti":m||v?"let":"leti"}}h.defineLocale("sl",{months:"januar_februar_marec_april_maj_junij_julij_avgust_september_oktober_november_december".split("_"),monthsShort:"jan._feb._mar._apr._maj._jun._jul._avg._sep._okt._nov._dec.".split("_"),monthsParseExact:!0,weekdays:"nedelja_ponedeljek_torek_sreda_etrtek_petek_sobota".split("_"),weekdaysShort:"ned._pon._tor._sre._et._pet._sob.".split("_"),weekdaysMin:"ne_po_to_sr_e_pe_so".split("_"),weekdaysParseExact:!0,longDateFormat:{LT:"H:mm",LTS:"H:mm:ss",L:"DD. MM. YYYY",LL:"D. MMMM YYYY",LLL:"D. MMMM YYYY H:mm",LLLL:"dddd, D. MMMM YYYY H:mm"},calendar:{sameDay:"[danes ob] LT",nextDay:"[jutri ob] LT",nextWeek:function(){switch(this.day()){case 0:return"[v] [nedeljo] [ob] LT";case 3:return"[v] [sredo] [ob] LT";case 6:return"[v] [soboto] [ob] LT";case 1:case 2:case 4:case 5:return"[v] dddd [ob] LT"}},lastDay:"[veraj ob] LT",lastWeek:function(){switch(this.day()){case 0:return"[prejnjo] [nedeljo] [ob] LT";case 3:return"[prejnjo] [sredo] [ob] LT";case 6:return"[prejnjo] [soboto] [ob] LT";case 1:case 2:case 4:case 5:return"[prejnji] dddd [ob] LT"}},sameElse:"L"},relativeTime:{future:"ez %s",past:"pred %s",s:processRelativeTime,ss:processRelativeTime,m:processRelativeTime,mm:processRelativeTime,h:processRelativeTime,hh:processRelativeTime,d:processRelativeTime,dd:processRelativeTime,M:processRelativeTime,MM:processRelativeTime,y:processRelativeTime,yy:processRelativeTime},dayOfMonthOrdinalParse:/\d{1,2}\./,ordinal:"%d.",week:{dow:1,doy:7}})}(y(1))},function(h,m,y){!function(h){"use strict";
//! moment.js locale configuration
h.defineLocale("sq",{months:"Janar_Shkurt_Mars_Prill_Maj_Qershor_Korrik_Gusht_Shtator_Tetor_Nntor_Dhjetor".split("_"),monthsShort:"Jan_Shk_Mar_Pri_Maj_Qer_Kor_Gus_Sht_Tet_Nn_Dhj".split("_"),weekdays:"E Diel_E Hn_E Mart_E Mrkur_E Enjte_E Premte_E Shtun".split("_"),weekdaysShort:"Die_Hn_Mar_Mr_Enj_Pre_Sht".split("_"),weekdaysMin:"D_H_Ma_M_E_P_Sh".split("_"),weekdaysParseExact:!0,meridiemParse:/PD|MD/,isPM:function(h){return"M"===h.charAt(0)},meridiem:function(h,m,y){return h<12?"PD":"MD"},longDateFormat:{LT:"HH:mm",LTS:"HH:mm:ss",L:"DD/MM/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY HH:mm",LLLL:"dddd, D MMMM YYYY HH:mm"},calendar:{sameDay:"[Sot n] LT",nextDay:"[Nesr n] LT",nextWeek:"dddd [n] LT",lastDay:"[Dje n] LT",lastWeek:"dddd [e kaluar n] LT",sameElse:"L"},relativeTime:{future:"n %s",past:"%s m par",s:"disa sekonda",ss:"%d sekonda",m:"nj minut",mm:"%d minuta",h:"nj or",hh:"%d or",d:"nj dit",dd:"%d dit",M:"nj muaj",MM:"%d muaj",y:"nj vit",yy:"%d vite"},dayOfMonthOrdinalParse:/\d{1,2}\./,ordinal:"%d.",week:{dow:1,doy:4}})}(y(1))},function(h,m,y){!function(h){"use strict";
//! moment.js locale configuration
var m={words:{ss:["sekunda","sekunde","sekundi"],m:["jedan minut","jedne minute"],mm:["minut","minute","minuta"],h:["jedan sat","jednog sata"],hh:["sat","sata","sati"],dd:["dan","dana","dana"],MM:["mesec","meseca","meseci"],yy:["godina","godine","godina"]},correctGrammaticalCase:function(h,m){return 1===h?m[0]:h>=2&&h<=4?m[1]:m[2]},translate:function(h,y,v){var C=m.words[v];return 1===v.length?y?C[0]:C[1]:h+" "+m.correctGrammaticalCase(h,C)}};h.defineLocale("sr",{months:"januar_februar_mart_april_maj_jun_jul_avgust_septembar_oktobar_novembar_decembar".split("_"),monthsShort:"jan._feb._mar._apr._maj_jun_jul_avg._sep._okt._nov._dec.".split("_"),monthsParseExact:!0,weekdays:"nedelja_ponedeljak_utorak_sreda_etvrtak_petak_subota".split("_"),weekdaysShort:"ned._pon._uto._sre._et._pet._sub.".split("_"),weekdaysMin:"ne_po_ut_sr_e_pe_su".split("_"),weekdaysParseExact:!0,longDateFormat:{LT:"H:mm",LTS:"H:mm:ss",L:"DD.MM.YYYY",LL:"D. MMMM YYYY",LLL:"D. MMMM YYYY H:mm",LLLL:"dddd, D. MMMM YYYY H:mm"},calendar:{sameDay:"[danas u] LT",nextDay:"[sutra u] LT",nextWeek:function(){switch(this.day()){case 0:return"[u] [nedelju] [u] LT";case 3:return"[u] [sredu] [u] LT";case 6:return"[u] [subotu] [u] LT";case 1:case 2:case 4:case 5:return"[u] dddd [u] LT"}},lastDay:"[jue u] LT",lastWeek:function(){return["[prole] [nedelje] [u] LT","[prolog] [ponedeljka] [u] LT","[prolog] [utorka] [u] LT","[prole] [srede] [u] LT","[prolog] [etvrtka] [u] LT","[prolog] [petka] [u] LT","[prole] [subote] [u] LT"][this.day()]},sameElse:"L"},relativeTime:{future:"za %s",past:"pre %s",s:"nekoliko sekundi",ss:m.translate,m:m.translate,mm:m.translate,h:m.translate,hh:m.translate,d:"dan",dd:m.translate,M:"mesec",MM:m.translate,y:"godinu",yy:m.translate},dayOfMonthOrdinalParse:/\d{1,2}\./,ordinal:"%d.",week:{dow:1,doy:7}})}(y(1))},function(h,m,y){!function(h){"use strict";
//! moment.js locale configuration
var m={words:{ss:["","",""],m:[" "," "],mm:["","",""],h:[" "," "],hh:["","",""],dd:["","",""],MM:["","",""],yy:["","",""]},correctGrammaticalCase:function(h,m){return 1===h?m[0]:h>=2&&h<=4?m[1]:m[2]},translate:function(h,y,v){var C=m.words[v];return 1===v.length?y?C[0]:C[1]:h+" "+m.correctGrammaticalCase(h,C)}};h.defineLocale("sr-cyrl",{months:"___________".split("_"),monthsShort:"._._._.____._._._._.".split("_"),monthsParseExact:!0,weekdays:"______".split("_"),weekdaysShort:"._._._._._._.".split("_"),weekdaysMin:"______".split("_"),weekdaysParseExact:!0,longDateFormat:{LT:"H:mm",LTS:"H:mm:ss",L:"DD.MM.YYYY",LL:"D. MMMM YYYY",LLL:"D. MMMM YYYY H:mm",LLLL:"dddd, D. MMMM YYYY H:mm"},calendar:{sameDay:"[ ] LT",nextDay:"[ ] LT",nextWeek:function(){switch(this.day()){case 0:return"[] [] [] LT";case 3:return"[] [] [] LT";case 6:return"[] [] [] LT";case 1:case 2:case 4:case 5:return"[] dddd [] LT"}},lastDay:"[ ] LT",lastWeek:function(){return["[] [] [] LT","[] [] [] LT","[] [] [] LT","[] [] [] LT","[] [] [] LT","[] [] [] LT","[] [] [] LT"][this.day()]},sameElse:"L"},relativeTime:{future:" %s",past:" %s",s:" ",ss:m.translate,m:m.translate,mm:m.translate,h:m.translate,hh:m.translate,d:"",dd:m.translate,M:"",MM:m.translate,y:"",yy:m.translate},dayOfMonthOrdinalParse:/\d{1,2}\./,ordinal:"%d.",week:{dow:1,doy:7}})}(y(1))},function(h,m,y){!function(h){"use strict";
//! moment.js locale configuration
h.defineLocale("ss",{months:"Bhimbidvwane_Indlovana_Indlov'lenkhulu_Mabasa_Inkhwekhweti_Inhlaba_Kholwane_Ingci_Inyoni_Imphala_Lweti_Ingongoni".split("_"),monthsShort:"Bhi_Ina_Inu_Mab_Ink_Inh_Kho_Igc_Iny_Imp_Lwe_Igo".split("_"),weekdays:"Lisontfo_Umsombuluko_Lesibili_Lesitsatfu_Lesine_Lesihlanu_Umgcibelo".split("_"),weekdaysShort:"Lis_Umb_Lsb_Les_Lsi_Lsh_Umg".split("_"),weekdaysMin:"Li_Us_Lb_Lt_Ls_Lh_Ug".split("_"),weekdaysParseExact:!0,longDateFormat:{LT:"h:mm A",LTS:"h:mm:ss A",L:"DD/MM/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY h:mm A",LLLL:"dddd, D MMMM YYYY h:mm A"},calendar:{sameDay:"[Namuhla nga] LT",nextDay:"[Kusasa nga] LT",nextWeek:"dddd [nga] LT",lastDay:"[Itolo nga] LT",lastWeek:"dddd [leliphelile] [nga] LT",sameElse:"L"},relativeTime:{future:"nga %s",past:"wenteka nga %s",s:"emizuzwana lomcane",ss:"%d mzuzwana",m:"umzuzu",mm:"%d emizuzu",h:"lihora",hh:"%d emahora",d:"lilanga",dd:"%d emalanga",M:"inyanga",MM:"%d tinyanga",y:"umnyaka",yy:"%d iminyaka"},meridiemParse:/ekuseni|emini|entsambama|ebusuku/,meridiem:function(h,m,y){return h<11?"ekuseni":h<15?"emini":h<19?"entsambama":"ebusuku"},meridiemHour:function(h,m){return 12===h&&(h=0),"ekuseni"===m?h:"emini"===m?h>=11?h:h+12:"entsambama"===m||"ebusuku"===m?0===h?0:h+12:void 0},dayOfMonthOrdinalParse:/\d{1,2}/,ordinal:"%d",week:{dow:1,doy:4}})}(y(1))},function(h,m,y){!function(h){"use strict";
//! moment.js locale configuration
h.defineLocale("sv",{months:"januari_februari_mars_april_maj_juni_juli_augusti_september_oktober_november_december".split("_"),monthsShort:"jan_feb_mar_apr_maj_jun_jul_aug_sep_okt_nov_dec".split("_"),weekdays:"sndag_mndag_tisdag_onsdag_torsdag_fredag_lrdag".split("_"),weekdaysShort:"sn_mn_tis_ons_tor_fre_lr".split("_"),weekdaysMin:"s_m_ti_on_to_fr_l".split("_"),longDateFormat:{LT:"HH:mm",LTS:"HH:mm:ss",L:"YYYY-MM-DD",LL:"D MMMM YYYY",LLL:"D MMMM YYYY [kl.] HH:mm",LLLL:"dddd D MMMM YYYY [kl.] HH:mm",lll:"D MMM YYYY HH:mm",llll:"ddd D MMM YYYY HH:mm"},calendar:{sameDay:"[Idag] LT",nextDay:"[Imorgon] LT",lastDay:"[Igr] LT",nextWeek:"[P] dddd LT",lastWeek:"[I] dddd[s] LT",sameElse:"L"},relativeTime:{future:"om %s",past:"fr %s sedan",s:"ngra sekunder",ss:"%d sekunder",m:"en minut",mm:"%d minuter",h:"en timme",hh:"%d timmar",d:"en dag",dd:"%d dagar",M:"en mnad",MM:"%d mnader",y:"ett r",yy:"%d r"},dayOfMonthOrdinalParse:/\d{1,2}(\:e|\:a)/,ordinal:function(h){var m=h%10;return h+(1==~~(h%100/10)?":e":1===m||2===m?":a":":e")},week:{dow:1,doy:4}})}(y(1))},function(h,m,y){!function(h){"use strict";
//! moment.js locale configuration
h.defineLocale("sw",{months:"Januari_Februari_Machi_Aprili_Mei_Juni_Julai_Agosti_Septemba_Oktoba_Novemba_Desemba".split("_"),monthsShort:"Jan_Feb_Mac_Apr_Mei_Jun_Jul_Ago_Sep_Okt_Nov_Des".split("_"),weekdays:"Jumapili_Jumatatu_Jumanne_Jumatano_Alhamisi_Ijumaa_Jumamosi".split("_"),weekdaysShort:"Jpl_Jtat_Jnne_Jtan_Alh_Ijm_Jmos".split("_"),weekdaysMin:"J2_J3_J4_J5_Al_Ij_J1".split("_"),weekdaysParseExact:!0,longDateFormat:{LT:"hh:mm A",LTS:"HH:mm:ss",L:"DD.MM.YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY HH:mm",LLLL:"dddd, D MMMM YYYY HH:mm"},calendar:{sameDay:"[leo saa] LT",nextDay:"[kesho saa] LT",nextWeek:"[wiki ijayo] dddd [saat] LT",lastDay:"[jana] LT",lastWeek:"[wiki iliyopita] dddd [saat] LT",sameElse:"L"},relativeTime:{future:"%s baadaye",past:"tokea %s",s:"hivi punde",ss:"sekunde %d",m:"dakika moja",mm:"dakika %d",h:"saa limoja",hh:"masaa %d",d:"siku moja",dd:"siku %d",M:"mwezi mmoja",MM:"miezi %d",y:"mwaka mmoja",yy:"miaka %d"},week:{dow:1,doy:7}})}(y(1))},function(h,m,y){!function(h){"use strict";
//! moment.js locale configuration
var m={1:"",2:"",3:"",4:"",5:"",6:"",7:"",8:"",9:"",0:""},y={"":"1","":"2","":"3","":"4","":"5","":"6","":"7","":"8","":"9","":"0"};h.defineLocale("ta",{months:"___________".split("_"),monthsShort:"___________".split("_"),weekdays:"______".split("_"),weekdaysShort:"______".split("_"),weekdaysMin:"______".split("_"),longDateFormat:{LT:"HH:mm",LTS:"HH:mm:ss",L:"DD/MM/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY, HH:mm",LLLL:"dddd, D MMMM YYYY, HH:mm"},calendar:{sameDay:"[] LT",nextDay:"[] LT",nextWeek:"dddd, LT",lastDay:"[] LT",lastWeek:"[ ] dddd, LT",sameElse:"L"},relativeTime:{future:"%s ",past:"%s ",s:"  ",ss:"%d ",m:" ",mm:"%d ",h:"  ",hh:"%d  ",d:" ",dd:"%d ",M:" ",MM:"%d ",y:" ",yy:"%d "},dayOfMonthOrdinalParse:/\d{1,2}/,ordinal:function(h){return h+""},preparse:function(h){return h.replace(/[]/g,(function(h){return y[h]}))},postformat:function(h){return h.replace(/\d/g,(function(h){return m[h]}))},meridiemParse:/|||||/,meridiem:function(h,m,y){return h<2?" ":h<6?" ":h<10?" ":h<14?" ":h<18?" ":h<22?" ":" "},meridiemHour:function(h,m){return 12===h&&(h=0),""===m?h<2?h:h+12:""===m||""===m||""===m&&h>=10?h:h+12},week:{dow:0,doy:6}})}(y(1))},function(h,m,y){!function(h){"use strict";
//! moment.js locale configuration
h.defineLocale("te",{months:"___________".split("_"),monthsShort:"._.__.____._._._._.".split("_"),monthsParseExact:!0,weekdays:"______".split("_"),weekdaysShort:"______".split("_"),weekdaysMin:"______".split("_"),longDateFormat:{LT:"A h:mm",LTS:"A h:mm:ss",L:"DD/MM/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY, A h:mm",LLLL:"dddd, D MMMM YYYY, A h:mm"},calendar:{sameDay:"[] LT",nextDay:"[] LT",nextWeek:"dddd, LT",lastDay:"[] LT",lastWeek:"[] dddd, LT",sameElse:"L"},relativeTime:{future:"%s ",past:"%s ",s:" ",ss:"%d ",m:" ",mm:"%d ",h:" ",hh:"%d ",d:" ",dd:"%d ",M:" ",MM:"%d ",y:" ",yy:"%d "},dayOfMonthOrdinalParse:/\d{1,2}/,ordinal:"%d",meridiemParse:/|||/,meridiemHour:function(h,m){return 12===h&&(h=0),""===m?h<4?h:h+12:""===m?h:""===m?h>=10?h:h+12:""===m?h+12:void 0},meridiem:function(h,m,y){return h<4?"":h<10?"":h<17?"":h<20?"":""},week:{dow:0,doy:6}})}(y(1))},function(h,m,y){!function(h){"use strict";
//! moment.js locale configuration
h.defineLocale("tet",{months:"Janeiru_Fevereiru_Marsu_Abril_Maiu_Juu_Jullu_Agustu_Setembru_Outubru_Novembru_Dezembru".split("_"),monthsShort:"Jan_Fev_Mar_Abr_Mai_Jun_Jul_Ago_Set_Out_Nov_Dez".split("_"),weekdays:"Domingu_Segunda_Tersa_Kuarta_Kinta_Sesta_Sabadu".split("_"),weekdaysShort:"Dom_Seg_Ters_Kua_Kint_Sest_Sab".split("_"),weekdaysMin:"Do_Seg_Te_Ku_Ki_Ses_Sa".split("_"),longDateFormat:{LT:"HH:mm",LTS:"HH:mm:ss",L:"DD/MM/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY HH:mm",LLLL:"dddd, D MMMM YYYY HH:mm"},calendar:{sameDay:"[Ohin iha] LT",nextDay:"[Aban iha] LT",nextWeek:"dddd [iha] LT",lastDay:"[Horiseik iha] LT",lastWeek:"dddd [semana kotuk] [iha] LT",sameElse:"L"},relativeTime:{future:"iha %s",past:"%s liuba",s:"segundu balun",ss:"segundu %d",m:"minutu ida",mm:"minutu %d",h:"oras ida",hh:"oras %d",d:"loron ida",dd:"loron %d",M:"fulan ida",MM:"fulan %d",y:"tinan ida",yy:"tinan %d"},dayOfMonthOrdinalParse:/\d{1,2}(st|nd|rd|th)/,ordinal:function(h){var m=h%10;return h+(1==~~(h%100/10)?"th":1===m?"st":2===m?"nd":3===m?"rd":"th")},week:{dow:1,doy:4}})}(y(1))},function(h,m,y){!function(h){"use strict";
//! moment.js locale configuration
var m={0:"-",1:"-",2:"-",3:"-",4:"-",5:"-",6:"-",7:"-",8:"-",9:"-",10:"-",12:"-",13:"-",20:"-",30:"-",40:"-",50:"-",60:"-",70:"-",80:"-",90:"-",100:"-"};h.defineLocale("tg",{months:"___________".split("_"),monthsShort:"___________".split("_"),weekdays:"______".split("_"),weekdaysShort:"______".split("_"),weekdaysMin:"______".split("_"),longDateFormat:{LT:"HH:mm",LTS:"HH:mm:ss",L:"DD/MM/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY HH:mm",LLLL:"dddd, D MMMM YYYY HH:mm"},calendar:{sameDay:"[ ] LT",nextDay:"[ ] LT",lastDay:"[ ] LT",nextWeek:"dddd[] [  ] LT",lastWeek:"dddd[] [  ] LT",sameElse:"L"},relativeTime:{future:" %s",past:"%s ",s:" ",m:" ",mm:"%d ",h:" ",hh:"%d ",d:" ",dd:"%d ",M:" ",MM:"%d ",y:" ",yy:"%d "},meridiemParse:/|||/,meridiemHour:function(h,m){return 12===h&&(h=0),""===m?h<4?h:h+12:""===m?h:""===m?h>=11?h:h+12:""===m?h+12:void 0},meridiem:function(h,m,y){return h<4?"":h<11?"":h<16?"":h<19?"":""},dayOfMonthOrdinalParse:/\d{1,2}-(|)/,ordinal:function(h){return h+(m[h]||m[h%10]||m[h>=100?100:null])},week:{dow:1,doy:7}})}(y(1))},function(h,m,y){!function(h){"use strict";
//! moment.js locale configuration
h.defineLocale("th",{months:"___________".split("_"),monthsShort:".._.._.._.._.._.._.._.._.._.._.._..".split("_"),monthsParseExact:!0,weekdays:"______".split("_"),weekdaysShort:"______".split("_"),weekdaysMin:"._._._._._._.".split("_"),weekdaysParseExact:!0,longDateFormat:{LT:"H:mm",LTS:"H:mm:ss",L:"DD/MM/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY  H:mm",LLLL:"dddd D MMMM YYYY  H:mm"},meridiemParse:/|/,isPM:function(h){return""===h},meridiem:function(h,m,y){return h<12?"":""},calendar:{sameDay:"[ ] LT",nextDay:"[ ] LT",nextWeek:"dddd[ ] LT",lastDay:"[ ] LT",lastWeek:"[]dddd[ ] LT",sameElse:"L"},relativeTime:{future:" %s",past:"%s",s:"",ss:"%d ",m:"1 ",mm:"%d ",h:"1 ",hh:"%d ",d:"1 ",dd:"%d ",M:"1 ",MM:"%d ",y:"1 ",yy:"%d "}})}(y(1))},function(h,m,y){!function(h){"use strict";
//! moment.js locale configuration
var m={1:"'inji",5:"'inji",8:"'inji",70:"'inji",80:"'inji",2:"'nji",7:"'nji",20:"'nji",50:"'nji",3:"'nji",4:"'nji",100:"'nji",6:"'njy",9:"'unjy",10:"'unjy",30:"'unjy",60:"'ynjy",90:"'ynjy"};h.defineLocale("tk",{months:"anwar_Fewral_Mart_Aprel_Ma_Iun_Iul_Awgust_Sentabr_Oktabr_Noabr_Dekabr".split("_"),monthsShort:"an_Few_Mar_Apr_Ma_In_Il_Awg_Sen_Okt_No_Dek".split("_"),weekdays:"ekenbe_Duenbe_Sienbe_arenbe_Penenbe_Anna_enbe".split("_"),weekdaysShort:"ek_Du_Si_ar_Pen_Ann_en".split("_"),weekdaysMin:"k_D_S_r_Pn_An_n".split("_"),longDateFormat:{LT:"HH:mm",LTS:"HH:mm:ss",L:"DD.MM.YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY HH:mm",LLLL:"dddd, D MMMM YYYY HH:mm"},calendar:{sameDay:"[bugn sagat] LT",nextDay:"[ertir sagat] LT",nextWeek:"[indiki] dddd [sagat] LT",lastDay:"[dn] LT",lastWeek:"[geen] dddd [sagat] LT",sameElse:"L"},relativeTime:{future:"%s so",past:"%s ",s:"birne sekunt",m:"bir minut",mm:"%d minut",h:"bir sagat",hh:"%d sagat",d:"bir gn",dd:"%d gn",M:"bir a",MM:"%d a",y:"bir yl",yy:"%d yl"},ordinal:function(h,y){switch(y){case"d":case"D":case"Do":case"DD":return h;default:if(0===h)return h+"'unjy";var v=h%10;return h+(m[v]||m[h%100-v]||m[h>=100?100:null])}},week:{dow:1,doy:7}})}(y(1))},function(h,m,y){!function(h){"use strict";
//! moment.js locale configuration
h.defineLocale("tl-ph",{months:"Enero_Pebrero_Marso_Abril_Mayo_Hunyo_Hulyo_Agosto_Setyembre_Oktubre_Nobyembre_Disyembre".split("_"),monthsShort:"Ene_Peb_Mar_Abr_May_Hun_Hul_Ago_Set_Okt_Nob_Dis".split("_"),weekdays:"Linggo_Lunes_Martes_Miyerkules_Huwebes_Biyernes_Sabado".split("_"),weekdaysShort:"Lin_Lun_Mar_Miy_Huw_Biy_Sab".split("_"),weekdaysMin:"Li_Lu_Ma_Mi_Hu_Bi_Sab".split("_"),longDateFormat:{LT:"HH:mm",LTS:"HH:mm:ss",L:"MM/D/YYYY",LL:"MMMM D, YYYY",LLL:"MMMM D, YYYY HH:mm",LLLL:"dddd, MMMM DD, YYYY HH:mm"},calendar:{sameDay:"LT [ngayong araw]",nextDay:"[Bukas ng] LT",nextWeek:"LT [sa susunod na] dddd",lastDay:"LT [kahapon]",lastWeek:"LT [noong nakaraang] dddd",sameElse:"L"},relativeTime:{future:"sa loob ng %s",past:"%s ang nakalipas",s:"ilang segundo",ss:"%d segundo",m:"isang minuto",mm:"%d minuto",h:"isang oras",hh:"%d oras",d:"isang araw",dd:"%d araw",M:"isang buwan",MM:"%d buwan",y:"isang taon",yy:"%d taon"},dayOfMonthOrdinalParse:/\d{1,2}/,ordinal:function(h){return h},week:{dow:1,doy:4}})}(y(1))},function(h,m,y){!function(h){"use strict";
//! moment.js locale configuration
var m="pagh_wa_cha_wej_loS_vagh_jav_Soch_chorgh_Hut".split("_");function translate(h,y,v,C){var T=function numberAsNoun(h){var y=Math.floor(h%1e3/100),v=Math.floor(h%100/10),C=h%10,T="";return y>0&&(T+=m[y]+"vatlh"),v>0&&(T+=(""!==T?" ":"")+m[v]+"maH"),C>0&&(T+=(""!==T?" ":"")+m[C]),""===T?"pagh":T}(h);switch(v){case"ss":return T+" lup";case"mm":return T+" tup";case"hh":return T+" rep";case"dd":return T+" jaj";case"MM":return T+" jar";case"yy":return T+" DIS"}}h.defineLocale("tlh",{months:"tera jar wa_tera jar cha_tera jar wej_tera jar loS_tera jar vagh_tera jar jav_tera jar Soch_tera jar chorgh_tera jar Hut_tera jar wamaH_tera jar wamaH wa_tera jar wamaH cha".split("_"),monthsShort:"jar wa_jar cha_jar wej_jar loS_jar vagh_jar jav_jar Soch_jar chorgh_jar Hut_jar wamaH_jar wamaH wa_jar wamaH cha".split("_"),monthsParseExact:!0,weekdays:"lojmItjaj_DaSjaj_povjaj_ghItlhjaj_loghjaj_buqjaj_ghInjaj".split("_"),weekdaysShort:"lojmItjaj_DaSjaj_povjaj_ghItlhjaj_loghjaj_buqjaj_ghInjaj".split("_"),weekdaysMin:"lojmItjaj_DaSjaj_povjaj_ghItlhjaj_loghjaj_buqjaj_ghInjaj".split("_"),longDateFormat:{LT:"HH:mm",LTS:"HH:mm:ss",L:"DD.MM.YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY HH:mm",LLLL:"dddd, D MMMM YYYY HH:mm"},calendar:{sameDay:"[DaHjaj] LT",nextDay:"[waleS] LT",nextWeek:"LLL",lastDay:"[waHu] LT",lastWeek:"LLL",sameElse:"L"},relativeTime:{future:function translateFuture(h){var m=h;return m=-1!==h.indexOf("jaj")?m.slice(0,-3)+"leS":-1!==h.indexOf("jar")?m.slice(0,-3)+"waQ":-1!==h.indexOf("DIS")?m.slice(0,-3)+"nem":m+" pIq"},past:function translatePast(h){var m=h;return m=-1!==h.indexOf("jaj")?m.slice(0,-3)+"Hu":-1!==h.indexOf("jar")?m.slice(0,-3)+"wen":-1!==h.indexOf("DIS")?m.slice(0,-3)+"ben":m+" ret"},s:"puS lup",ss:translate,m:"wa tup",mm:translate,h:"wa rep",hh:translate,d:"wa jaj",dd:translate,M:"wa jar",MM:translate,y:"wa DIS",yy:translate},dayOfMonthOrdinalParse:/\d{1,2}\./,ordinal:"%d.",week:{dow:1,doy:4}})}(y(1))},function(h,m,y){!function(h){"use strict";
//! moment.js locale configuration
var m={1:"'inci",5:"'inci",8:"'inci",70:"'inci",80:"'inci",2:"'nci",7:"'nci",20:"'nci",50:"'nci",3:"'nc",4:"'nc",100:"'nc",6:"'nc",9:"'uncu",10:"'uncu",30:"'uncu",60:"'nc",90:"'nc"};h.defineLocale("tr",{months:"Ocak_ubat_Mart_Nisan_Mays_Haziran_Temmuz_Austos_Eyll_Ekim_Kasm_Aralk".split("_"),monthsShort:"Oca_ub_Mar_Nis_May_Haz_Tem_Au_Eyl_Eki_Kas_Ara".split("_"),weekdays:"Pazar_Pazartesi_Sal_aramba_Perembe_Cuma_Cumartesi".split("_"),weekdaysShort:"Paz_Pts_Sal_ar_Per_Cum_Cts".split("_"),weekdaysMin:"Pz_Pt_Sa_a_Pe_Cu_Ct".split("_"),meridiem:function(h,m,y){return h<12?y?"":"":y?"s":"S"},meridiemParse:/||s|S/,isPM:function(h){return"s"===h||"S"===h},longDateFormat:{LT:"HH:mm",LTS:"HH:mm:ss",L:"DD.MM.YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY HH:mm",LLLL:"dddd, D MMMM YYYY HH:mm"},calendar:{sameDay:"[bugn saat] LT",nextDay:"[yarn saat] LT",nextWeek:"[gelecek] dddd [saat] LT",lastDay:"[dn] LT",lastWeek:"[geen] dddd [saat] LT",sameElse:"L"},relativeTime:{future:"%s sonra",past:"%s nce",s:"birka saniye",ss:"%d saniye",m:"bir dakika",mm:"%d dakika",h:"bir saat",hh:"%d saat",d:"bir gn",dd:"%d gn",M:"bir ay",MM:"%d ay",y:"bir yl",yy:"%d yl"},ordinal:function(h,y){switch(y){case"d":case"D":case"Do":case"DD":return h;default:if(0===h)return h+"'nc";var v=h%10;return h+(m[v]||m[h%100-v]||m[h>=100?100:null])}},week:{dow:1,doy:7}})}(y(1))},function(h,m,y){!function(h){"use strict";
//! moment.js locale configuration
function processRelativeTime(h,m,y,v){var C={s:["viensas secunds","'iensas secunds"],ss:[h+" secunds",h+" secunds"],m:["'n mut","'iens mut"],mm:[h+" muts",h+" muts"],h:["'n ora","'iensa ora"],hh:[h+" oras",h+" oras"],d:["'n ziua","'iensa ziua"],dd:[h+" ziuas",h+" ziuas"],M:["'n mes","'iens mes"],MM:[h+" mesen",h+" mesen"],y:["'n ar","'iens ar"],yy:[h+" ars",h+" ars"]};return v||m?C[y][0]:C[y][1]}h.defineLocale("tzl",{months:"Januar_Fevraglh_Mar_Avru_Mai_Gn_Julia_Guscht_Setemvar_Listopts_Noemvar_Zecemvar".split("_"),monthsShort:"Jan_Fev_Mar_Avr_Mai_Gn_Jul_Gus_Set_Lis_Noe_Zec".split("_"),weekdays:"Sladi_Lnei_Maitzi_Mrcuri_Xhadi_Vineri_Sturi".split("_"),weekdaysShort:"Sl_Ln_Mai_Mr_Xh_Vi_St".split("_"),weekdaysMin:"S_L_Ma_M_Xh_Vi_S".split("_"),longDateFormat:{LT:"HH.mm",LTS:"HH.mm.ss",L:"DD.MM.YYYY",LL:"D. MMMM [dallas] YYYY",LLL:"D. MMMM [dallas] YYYY HH.mm",LLLL:"dddd, [li] D. MMMM [dallas] YYYY HH.mm"},meridiemParse:/d\'o|d\'a/i,isPM:function(h){return"d'o"===h.toLowerCase()},meridiem:function(h,m,y){return h>11?y?"d'o":"D'O":y?"d'a":"D'A"},calendar:{sameDay:"[oxhi ] LT",nextDay:"[dem ] LT",nextWeek:"dddd [] LT",lastDay:"[ieiri ] LT",lastWeek:"[sr el] dddd [lasteu ] LT",sameElse:"L"},relativeTime:{future:"osprei %s",past:"ja%s",s:processRelativeTime,ss:processRelativeTime,m:processRelativeTime,mm:processRelativeTime,h:processRelativeTime,hh:processRelativeTime,d:processRelativeTime,dd:processRelativeTime,M:processRelativeTime,MM:processRelativeTime,y:processRelativeTime,yy:processRelativeTime},dayOfMonthOrdinalParse:/\d{1,2}\./,ordinal:"%d.",week:{dow:1,doy:4}})}(y(1))},function(h,m,y){!function(h){"use strict";
//! moment.js locale configuration
h.defineLocale("tzm",{months:"___________".split("_"),monthsShort:"___________".split("_"),weekdays:"______".split("_"),weekdaysShort:"______".split("_"),weekdaysMin:"______".split("_"),longDateFormat:{LT:"HH:mm",LTS:"HH:mm:ss",L:"DD/MM/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY HH:mm",LLLL:"dddd D MMMM YYYY HH:mm"},calendar:{sameDay:"[ ] LT",nextDay:"[ ] LT",nextWeek:"dddd [] LT",lastDay:"[ ] LT",lastWeek:"dddd [] LT",sameElse:"L"},relativeTime:{future:"   %s",past:" %s",s:"",ss:"%d ",m:"",mm:"%d ",h:"",hh:"%d ",d:"",dd:"%d o",M:"o",MM:"%d ",y:"",yy:"%d "},week:{dow:6,doy:12}})}(y(1))},function(h,m,y){!function(h){"use strict";
//! moment.js locale configuration
h.defineLocale("tzm-latn",{months:"innayr_brayr_mars_ibrir_mayyw_ywnyw_ywlywz_wt_wtanbir_ktwbr_nwwanbir_dwjnbir".split("_"),monthsShort:"innayr_brayr_mars_ibrir_mayyw_ywnyw_ywlywz_wt_wtanbir_ktwbr_nwwanbir_dwjnbir".split("_"),weekdays:"asamas_aynas_asinas_akras_akwas_asimwas_asiyas".split("_"),weekdaysShort:"asamas_aynas_asinas_akras_akwas_asimwas_asiyas".split("_"),weekdaysMin:"asamas_aynas_asinas_akras_akwas_asimwas_asiyas".split("_"),longDateFormat:{LT:"HH:mm",LTS:"HH:mm:ss",L:"DD/MM/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY HH:mm",LLLL:"dddd D MMMM YYYY HH:mm"},calendar:{sameDay:"[asdkh g] LT",nextDay:"[aska g] LT",nextWeek:"dddd [g] LT",lastDay:"[assant g] LT",lastWeek:"dddd [g] LT",sameElse:"L"},relativeTime:{future:"dadkh s yan %s",past:"yan %s",s:"imik",ss:"%d imik",m:"minu",mm:"%d minu",h:"saa",hh:"%d tassain",d:"ass",dd:"%d ossan",M:"ayowr",MM:"%d iyyirn",y:"asgas",yy:"%d isgasn"},week:{dow:6,doy:12}})}(y(1))},function(h,m,y){!function(h){"use strict";
//! moment.js language configuration
h.defineLocale("ug-cn",{months:"___________".split("_"),monthsShort:"___________".split("_"),weekdays:"______".split("_"),weekdaysShort:"______".split("_"),weekdaysMin:"______".split("_"),longDateFormat:{LT:"HH:mm",LTS:"HH:mm:ss",L:"YYYY-MM-DD",LL:"YYYY-M-D-",LLL:"YYYY-M-D- HH:mm",LLLL:"dddd YYYY-M-D- HH:mm"},meridiemParse:/ || || |/,meridiemHour:function(h,m){return 12===h&&(h=0)," "===m||""===m||" "===m?h:" "===m||""===m?h+12:h>=11?h:h+12},meridiem:function(h,m,y){var v=100*h+m;return v<600?" ":v<900?"":v<1130?" ":v<1230?"":v<1800?" ":""},calendar:{sameDay:"[ ] LT",nextDay:"[ ] LT",nextWeek:"[] dddd [] LT",lastDay:"[] LT",lastWeek:"[] dddd [] LT",sameElse:"L"},relativeTime:{future:"%s ",past:"%s ",s:" ",ss:"%d ",m:" ",mm:"%d ",h:" ",hh:"%d ",d:" ",dd:"%d ",M:" ",MM:"%d ",y:" ",yy:"%d "},dayOfMonthOrdinalParse:/\d{1,2}(-|-|-)/,ordinal:function(h,m){switch(m){case"d":case"D":case"DDD":return h+"-";case"w":case"W":return h+"-";default:return h}},preparse:function(h){return h.replace(//g,",")},postformat:function(h){return h.replace(/,/g,"")},week:{dow:1,doy:7}})}(y(1))},function(h,m,y){!function(h){"use strict";
//! moment.js locale configuration
function relativeTimeWithPlural(h,m,y){return"m"===y?m?"":"":"h"===y?m?"":"":h+" "+function plural(h,m){var y=h.split("_");return m%10==1&&m%100!=11?y[0]:m%10>=2&&m%10<=4&&(m%100<10||m%100>=20)?y[1]:y[2]}({ss:m?"__":"__",mm:m?"__":"__",hh:m?"__":"__",dd:"__",MM:"__",yy:"__"}[y],+h)}function processHoursFunction(h){return function(){return h+""+(11===this.hours()?"":"")+"] LT"}}h.defineLocale("uk",{months:{format:"___________".split("_"),standalone:"___________".split("_")},monthsShort:"___________".split("_"),weekdays:function weekdaysCaseReplace(h,m){var y={nominative:"______".split("_"),accusative:"______".split("_"),genitive:"______".split("_")};return!0===h?y.nominative.slice(1,7).concat(y.nominative.slice(0,1)):h?y[/(\[[]\]) ?dddd/.test(m)?"accusative":/\[?(?:|)? ?\] ?dddd/.test(m)?"genitive":"nominative"][h.day()]:y.nominative},weekdaysShort:"______".split("_"),weekdaysMin:"______".split("_"),longDateFormat:{LT:"HH:mm",LTS:"HH:mm:ss",L:"DD.MM.YYYY",LL:"D MMMM YYYY .",LLL:"D MMMM YYYY ., HH:mm",LLLL:"dddd, D MMMM YYYY ., HH:mm"},calendar:{sameDay:processHoursFunction("[ "),nextDay:processHoursFunction("[ "),lastDay:processHoursFunction("[ "),nextWeek:processHoursFunction("[] dddd ["),lastWeek:function(){switch(this.day()){case 0:case 3:case 5:case 6:return processHoursFunction("[] dddd [").call(this);case 1:case 2:case 4:return processHoursFunction("[] dddd [").call(this)}},sameElse:"L"},relativeTime:{future:" %s",past:"%s ",s:" ",ss:relativeTimeWithPlural,m:relativeTimeWithPlural,mm:relativeTimeWithPlural,h:"",hh:relativeTimeWithPlural,d:"",dd:relativeTimeWithPlural,M:"",MM:relativeTimeWithPlural,y:"",yy:relativeTimeWithPlural},meridiemParse:/|||/,isPM:function(h){return/^(|)$/.test(h)},meridiem:function(h,m,y){return h<4?"":h<12?"":h<17?"":""},dayOfMonthOrdinalParse:/\d{1,2}-(|)/,ordinal:function(h,m){switch(m){case"M":case"d":case"DDD":case"w":case"W":return h+"-";case"D":return h+"-";default:return h}},week:{dow:1,doy:7}})}(y(1))},function(h,m,y){!function(h){"use strict";
//! moment.js locale configuration
var m=["","","","","","","","","","","",""],y=["","","","","","",""];h.defineLocale("ur",{months:m,monthsShort:m,weekdays:y,weekdaysShort:y,weekdaysMin:y,longDateFormat:{LT:"HH:mm",LTS:"HH:mm:ss",L:"DD/MM/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY HH:mm",LLLL:"dddd D MMMM YYYY HH:mm"},meridiemParse:/|/,isPM:function(h){return""===h},meridiem:function(h,m,y){return h<12?"":""},calendar:{sameDay:"[ ] LT",nextDay:"[ ] LT",nextWeek:"dddd [] LT",lastDay:"[  ] LT",lastWeek:"[] dddd [] LT",sameElse:"L"},relativeTime:{future:"%s ",past:"%s ",s:" ",ss:"%d ",m:" ",mm:"%d ",h:" ",hh:"%d ",d:" ",dd:"%d ",M:" ",MM:"%d ",y:" ",yy:"%d "},preparse:function(h){return h.replace(//g,",")},postformat:function(h){return h.replace(/,/g,"")},week:{dow:1,doy:4}})}(y(1))},function(h,m,y){!function(h){"use strict";
//! moment.js locale configuration
h.defineLocale("uz",{months:"___________".split("_"),monthsShort:"___________".split("_"),weekdays:"______".split("_"),weekdaysShort:"______".split("_"),weekdaysMin:"______".split("_"),longDateFormat:{LT:"HH:mm",LTS:"HH:mm:ss",L:"DD/MM/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY HH:mm",LLLL:"D MMMM YYYY, dddd HH:mm"},calendar:{sameDay:"[ ] LT []",nextDay:"[] LT []",nextWeek:"dddd [ ] LT []",lastDay:"[ ] LT []",lastWeek:"[] dddd [ ] LT []",sameElse:"L"},relativeTime:{future:" %s ",past:"  %s ",s:"",ss:"%d ",m:" ",mm:"%d ",h:" ",hh:"%d ",d:" ",dd:"%d ",M:" ",MM:"%d ",y:" ",yy:"%d "},week:{dow:1,doy:7}})}(y(1))},function(h,m,y){!function(h){"use strict";
//! moment.js locale configuration
h.defineLocale("uz-latn",{months:"Yanvar_Fevral_Mart_Aprel_May_Iyun_Iyul_Avgust_Sentabr_Oktabr_Noyabr_Dekabr".split("_"),monthsShort:"Yan_Fev_Mar_Apr_May_Iyun_Iyul_Avg_Sen_Okt_Noy_Dek".split("_"),weekdays:"Yakshanba_Dushanba_Seshanba_Chorshanba_Payshanba_Juma_Shanba".split("_"),weekdaysShort:"Yak_Dush_Sesh_Chor_Pay_Jum_Shan".split("_"),weekdaysMin:"Ya_Du_Se_Cho_Pa_Ju_Sha".split("_"),longDateFormat:{LT:"HH:mm",LTS:"HH:mm:ss",L:"DD/MM/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY HH:mm",LLLL:"D MMMM YYYY, dddd HH:mm"},calendar:{sameDay:"[Bugun soat] LT [da]",nextDay:"[Ertaga] LT [da]",nextWeek:"dddd [kuni soat] LT [da]",lastDay:"[Kecha soat] LT [da]",lastWeek:"[O'tgan] dddd [kuni soat] LT [da]",sameElse:"L"},relativeTime:{future:"Yaqin %s ichida",past:"Bir necha %s oldin",s:"soniya",ss:"%d soniya",m:"bir daqiqa",mm:"%d daqiqa",h:"bir soat",hh:"%d soat",d:"bir kun",dd:"%d kun",M:"bir oy",MM:"%d oy",y:"bir yil",yy:"%d yil"},week:{dow:1,doy:7}})}(y(1))},function(h,m,y){!function(h){"use strict";
//! moment.js locale configuration
h.defineLocale("vi",{months:"thng 1_thng 2_thng 3_thng 4_thng 5_thng 6_thng 7_thng 8_thng 9_thng 10_thng 11_thng 12".split("_"),monthsShort:"Thg 01_Thg 02_Thg 03_Thg 04_Thg 05_Thg 06_Thg 07_Thg 08_Thg 09_Thg 10_Thg 11_Thg 12".split("_"),monthsParseExact:!0,weekdays:"ch nht_th hai_th ba_th t_th nm_th su_th by".split("_"),weekdaysShort:"CN_T2_T3_T4_T5_T6_T7".split("_"),weekdaysMin:"CN_T2_T3_T4_T5_T6_T7".split("_"),weekdaysParseExact:!0,meridiemParse:/sa|ch/i,isPM:function(h){return/^ch$/i.test(h)},meridiem:function(h,m,y){return h<12?y?"sa":"SA":y?"ch":"CH"},longDateFormat:{LT:"HH:mm",LTS:"HH:mm:ss",L:"DD/MM/YYYY",LL:"D MMMM [nm] YYYY",LLL:"D MMMM [nm] YYYY HH:mm",LLLL:"dddd, D MMMM [nm] YYYY HH:mm",l:"DD/M/YYYY",ll:"D MMM YYYY",lll:"D MMM YYYY HH:mm",llll:"ddd, D MMM YYYY HH:mm"},calendar:{sameDay:"[Hm nay lc] LT",nextDay:"[Ngy mai lc] LT",nextWeek:"dddd [tun ti lc] LT",lastDay:"[Hm qua lc] LT",lastWeek:"dddd [tun trc lc] LT",sameElse:"L"},relativeTime:{future:"%s ti",past:"%s trc",s:"vi giy",ss:"%d giy",m:"mt pht",mm:"%d pht",h:"mt gi",hh:"%d gi",d:"mt ngy",dd:"%d ngy",M:"mt thng",MM:"%d thng",y:"mt nm",yy:"%d nm"},dayOfMonthOrdinalParse:/\d{1,2}/,ordinal:function(h){return h},week:{dow:1,doy:4}})}(y(1))},function(h,m,y){!function(h){"use strict";
//! moment.js locale configuration
h.defineLocale("x-pseudo",{months:"J~~r_F~br~r_~Mrc~h_p~rl_~M_~J~_Jl~_~gst~_Sp~tmb~r_~ctb~r_~vm~br_~Dc~mbr".split("_"),monthsShort:"J~_~Fb_~Mr_~pr_~M_~J_~Jl_~g_~Sp_~ct_~v_~Dc".split("_"),monthsParseExact:!0,weekdays:"S~d~_M~d~_T~sd~_Wd~sd~_T~hrs~d_~Frd~_S~tr~d".split("_"),weekdaysShort:"S~_~M_~T_~Wd_~Th_~Fr_~St".split("_"),weekdaysMin:"S~_M~_T_~W_T~h_Fr~_S".split("_"),weekdaysParseExact:!0,longDateFormat:{LT:"HH:mm",L:"DD/MM/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY HH:mm",LLLL:"dddd, D MMMM YYYY HH:mm"},calendar:{sameDay:"[T~d~ t] LT",nextDay:"[T~m~rr~w t] LT",nextWeek:"dddd [t] LT",lastDay:"[~st~rd~ t] LT",lastWeek:"[L~st] dddd [t] LT",sameElse:"L"},relativeTime:{future:"~ %s",past:"%s ~g",s:" ~fw ~sc~ds",ss:"%d s~c~ds",m:" ~m~t",mm:"%d m~~ts",h:"~ h~r",hh:"%d h~rs",d:" ~d",dd:"%d d~s",M:" ~m~th",MM:"%d m~t~hs",y:" ~r",yy:"%d ~rs"},dayOfMonthOrdinalParse:/\d{1,2}(th|st|nd|rd)/,ordinal:function(h){var m=h%10;return h+(1==~~(h%100/10)?"th":1===m?"st":2===m?"nd":3===m?"rd":"th")},week:{dow:1,doy:4}})}(y(1))},function(h,m,y){!function(h){"use strict";
//! moment.js locale configuration
h.defineLocale("yo",{months:"Sr_Erele_rna_Igbe_Ebibi_Okudu_Agmo_Ogun_Owewe_wara_Belu_p".split("_"),monthsShort:"Sr_Erl_rn_Igb_Ebi_Oku_Ag_Ogu_Owe_wa_Bel_p".split("_"),weekdays:"Aiku_Aje_Isgun_jru_jb_ti_Abamta".split("_"),weekdaysShort:"Aik_Aje_Is_jr_jb_ti_Aba".split("_"),weekdaysMin:"Ai_Aj_Is_r_b_t_Ab".split("_"),longDateFormat:{LT:"h:mm A",LTS:"h:mm:ss A",L:"DD/MM/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY h:mm A",LLLL:"dddd, D MMMM YYYY h:mm A"},calendar:{sameDay:"[Oni ni] LT",nextDay:"[la ni] LT",nextWeek:"dddd [s ton'b] [ni] LT",lastDay:"[Ana ni] LT",lastWeek:"dddd [s tol] [ni] LT",sameElse:"L"},relativeTime:{future:"ni %s",past:"%s kja",s:"isju aaya die",ss:"aaya %d",m:"isju kan",mm:"isju %d",h:"wakati kan",hh:"wakati %d",d:"j kan",dd:"j %d",M:"osu kan",MM:"osu %d",y:"dun kan",yy:"dun %d"},dayOfMonthOrdinalParse:/j\s\d{1,2}/,ordinal:"j %d",week:{dow:1,doy:4}})}(y(1))},function(h,m,y){!function(h){"use strict";
//! moment.js locale configuration
h.defineLocale("zh-cn",{months:"___________".split("_"),monthsShort:"1_2_3_4_5_6_7_8_9_10_11_12".split("_"),weekdays:"______".split("_"),weekdaysShort:"______".split("_"),weekdaysMin:"______".split("_"),longDateFormat:{LT:"HH:mm",LTS:"HH:mm:ss",L:"YYYY/MM/DD",LL:"YYYYMD",LLL:"YYYYMDAhmm",LLLL:"YYYYMDddddAhmm",l:"YYYY/M/D",ll:"YYYYMD",lll:"YYYYMD HH:mm",llll:"YYYYMDdddd HH:mm"},meridiemParse:/|||||/,meridiemHour:function(h,m){return 12===h&&(h=0),""===m||""===m||""===m?h:""===m||""===m?h+12:h>=11?h:h+12},meridiem:function(h,m,y){var v=100*h+m;return v<600?"":v<900?"":v<1130?"":v<1230?"":v<1800?"":""},calendar:{sameDay:"[]LT",nextDay:"[]LT",nextWeek:function(h){return h.week()!==this.week()?"[]dddLT":"[]dddLT"},lastDay:"[]LT",lastWeek:function(h){return this.week()!==h.week()?"[]dddLT":"[]dddLT"},sameElse:"L"},dayOfMonthOrdinalParse:/\d{1,2}(||)/,ordinal:function(h,m){switch(m){case"d":case"D":case"DDD":return h+"";case"M":return h+"";case"w":case"W":return h+"";default:return h}},relativeTime:{future:"%s",past:"%s",s:"",ss:"%d ",m:"1 ",mm:"%d ",h:"1 ",hh:"%d ",d:"1 ",dd:"%d ",M:"1 ",MM:"%d ",y:"1 ",yy:"%d "},week:{dow:1,doy:4}})}(y(1))},function(h,m,y){!function(h){"use strict";
//! moment.js locale configuration
h.defineLocale("zh-hk",{months:"___________".split("_"),monthsShort:"1_2_3_4_5_6_7_8_9_10_11_12".split("_"),weekdays:"______".split("_"),weekdaysShort:"______".split("_"),weekdaysMin:"______".split("_"),longDateFormat:{LT:"HH:mm",LTS:"HH:mm:ss",L:"YYYY/MM/DD",LL:"YYYYMD",LLL:"YYYYMD HH:mm",LLLL:"YYYYMDdddd HH:mm",l:"YYYY/M/D",ll:"YYYYMD",lll:"YYYYMD HH:mm",llll:"YYYYMDdddd HH:mm"},meridiemParse:/|||||/,meridiemHour:function(h,m){return 12===h&&(h=0),""===m||""===m||""===m?h:""===m?h>=11?h:h+12:""===m||""===m?h+12:void 0},meridiem:function(h,m,y){var v=100*h+m;return v<600?"":v<900?"":v<1200?"":1200===v?"":v<1800?"":""},calendar:{sameDay:"[]LT",nextDay:"[]LT",nextWeek:"[]ddddLT",lastDay:"[]LT",lastWeek:"[]ddddLT",sameElse:"L"},dayOfMonthOrdinalParse:/\d{1,2}(||)/,ordinal:function(h,m){switch(m){case"d":case"D":case"DDD":return h+"";case"M":return h+"";case"w":case"W":return h+"";default:return h}},relativeTime:{future:"%s",past:"%s",s:"",ss:"%d ",m:"1 ",mm:"%d ",h:"1 ",hh:"%d ",d:"1 ",dd:"%d ",M:"1 ",MM:"%d ",y:"1 ",yy:"%d "}})}(y(1))},function(h,m,y){!function(h){"use strict";
//! moment.js locale configuration
h.defineLocale("zh-mo",{months:"___________".split("_"),monthsShort:"1_2_3_4_5_6_7_8_9_10_11_12".split("_"),weekdays:"______".split("_"),weekdaysShort:"______".split("_"),weekdaysMin:"______".split("_"),longDateFormat:{LT:"HH:mm",LTS:"HH:mm:ss",L:"DD/MM/YYYY",LL:"YYYYMD",LLL:"YYYYMD HH:mm",LLLL:"YYYYMDdddd HH:mm",l:"D/M/YYYY",ll:"YYYYMD",lll:"YYYYMD HH:mm",llll:"YYYYMDdddd HH:mm"},meridiemParse:/|||||/,meridiemHour:function(h,m){return 12===h&&(h=0),""===m||""===m||""===m?h:""===m?h>=11?h:h+12:""===m||""===m?h+12:void 0},meridiem:function(h,m,y){var v=100*h+m;return v<600?"":v<900?"":v<1130?"":v<1230?"":v<1800?"":""},calendar:{sameDay:"[] LT",nextDay:"[] LT",nextWeek:"[]dddd LT",lastDay:"[] LT",lastWeek:"[]dddd LT",sameElse:"L"},dayOfMonthOrdinalParse:/\d{1,2}(||)/,ordinal:function(h,m){switch(m){case"d":case"D":case"DDD":return h+"";case"M":return h+"";case"w":case"W":return h+"";default:return h}},relativeTime:{future:"%s",past:"%s",s:"",ss:"%d ",m:"1 ",mm:"%d ",h:"1 ",hh:"%d ",d:"1 ",dd:"%d ",M:"1 ",MM:"%d ",y:"1 ",yy:"%d "}})}(y(1))},function(h,m,y){!function(h){"use strict";
//! moment.js locale configuration
h.defineLocale("zh-tw",{months:"___________".split("_"),monthsShort:"1_2_3_4_5_6_7_8_9_10_11_12".split("_"),weekdays:"______".split("_"),weekdaysShort:"______".split("_"),weekdaysMin:"______".split("_"),longDateFormat:{LT:"HH:mm",LTS:"HH:mm:ss",L:"YYYY/MM/DD",LL:"YYYYMD",LLL:"YYYYMD HH:mm",LLLL:"YYYYMDdddd HH:mm",l:"YYYY/M/D",ll:"YYYYMD",lll:"YYYYMD HH:mm",llll:"YYYYMDdddd HH:mm"},meridiemParse:/|||||/,meridiemHour:function(h,m){return 12===h&&(h=0),""===m||""===m||""===m?h:""===m?h>=11?h:h+12:""===m||""===m?h+12:void 0},meridiem:function(h,m,y){var v=100*h+m;return v<600?"":v<900?"":v<1130?"":v<1230?"":v<1800?"":""},calendar:{sameDay:"[] LT",nextDay:"[] LT",nextWeek:"[]dddd LT",lastDay:"[] LT",lastWeek:"[]dddd LT",sameElse:"L"},dayOfMonthOrdinalParse:/\d{1,2}(||)/,ordinal:function(h,m){switch(m){case"d":case"D":case"DDD":return h+"";case"M":return h+"";case"w":case"W":return h+"";default:return h}},relativeTime:{future:"%s",past:"%s",s:"",ss:"%d ",m:"1 ",mm:"%d ",h:"1 ",hh:"%d ",d:"1 ",dd:"%d ",M:"1 ",MM:"%d ",y:"1 ",yy:"%d "}})}(y(1))},function(h,m,y){var v;function createDebug(h){function debug(){if(debug.enabled){var h=debug,y=+new Date,C=y-(v||y);h.diff=C,h.prev=v,h.curr=y,v=y;for(var T=new Array(arguments.length),w=0;w<T.length;w++)T[w]=arguments[w];T[0]=m.coerce(T[0]),"string"!=typeof T[0]&&T.unshift("%O");var A=0;T[0]=T[0].replace(/%([a-zA-Z%])/g,(function(y,v){if("%%"===y)return y;A++;var C=m.formatters[v];if("function"==typeof C){var w=T[A];y=C.call(h,w),T.splice(A,1),A--}return y})),m.formatArgs.call(h,T);var P=debug.log||m.log||console.log.bind(console);P.apply(h,T)}}return debug.namespace=h,debug.enabled=m.enabled(h),debug.useColors=m.useColors(),debug.color=function selectColor(h){var y,v=0;for(y in h)v=(v<<5)-v+h.charCodeAt(y),v|=0;return m.colors[Math.abs(v)%m.colors.length]}(h),"function"==typeof m.init&&m.init(debug),debug}(m=h.exports=createDebug.debug=createDebug.default=createDebug).coerce=function coerce(h){return h instanceof Error?h.stack||h.message:h},m.disable=function disable(){m.enable("")},m.enable=function enable(h){m.save(h),m.names=[],m.skips=[];for(var y=("string"==typeof h?h:"").split(/[\s,]+/),v=y.length,C=0;C<v;C++)y[C]&&("-"===(h=y[C].replace(/\*/g,".*?"))[0]?m.skips.push(new RegExp("^"+h.substr(1)+"$")):m.names.push(new RegExp("^"+h+"$")))},m.enabled=function enabled(h){var y,v;for(y=0,v=m.skips.length;y<v;y++)if(m.skips[y].test(h))return!1;for(y=0,v=m.names.length;y<v;y++)if(m.names[y].test(h))return!0;return!1},m.humanize=y(1490),m.names=[],m.skips=[],m.formatters={}},function(h,m,y){for(var v=y(11),C=y(10),T=y(20),w=y(13).EventEmitter,A=y(329),P=/,\s*/,k=/;\s*/,R=/[\r\n]/g,M=/,\s*/,N=["(",")","<",">","@",",",";",":","\\",'"',"/","[","]","?","=","{","}"," ",String.fromCharCode(9)],D=[String.fromCharCode(127)],I=0;I<31;I++)D.push(String.fromCharCode(I));var x=/([\x00-\x20\x22\x28\x29\x2c\x2f\x3a-\x3f\x40\x5b-\x5e\x7b\x7d\x7f])/,O=/[^\x21\x23-\x2b\x2d-\x3a\x3c-\x5b\x5d-\x7e]/,L=/^"[^"]*"$/,U=/[\x00-\x20\x3b]/g,B=/[;,] */,W={100:"Continue",101:"Switching Protocols",200:"OK",201:"Created",203:"Non-Authoritative Information",204:"No Content",205:"Reset Content",206:"Partial Content",300:"Multiple Choices",301:"Moved Permanently",302:"Found",303:"See Other",304:"Not Modified",305:"Use Proxy",307:"Temporary Redirect",400:"Bad Request",401:"Unauthorized",402:"Payment Required",403:"Forbidden",404:"Not Found",406:"Not Acceptable",407:"Proxy Authorization Required",408:"Request Timeout",409:"Conflict",410:"Gone",411:"Length Required",412:"Precondition Failed",413:"Request Entity Too Long",414:"Request-URI Too Long",415:"Unsupported Media Type",416:"Requested Range Not Satisfiable",417:"Expectation Failed",426:"Upgrade Required",500:"Internal Server Error",501:"Not Implemented",502:"Bad Gateway",503:"Service Unavailable",504:"Gateway Timeout",505:"HTTP Version Not Supported"};function WebSocketRequest(h,m,y){w.call(this),this.socket=h,this.httpRequest=m,this.resource=m.url,this.remoteAddress=h.remoteAddress,this.remoteAddresses=[this.remoteAddress],this.serverConfig=y,this._socketIsClosing=!1,this._socketCloseHandler=this._handleSocketCloseBeforeAccept.bind(this),this.socket.on("end",this._socketCloseHandler),this.socket.on("close",this._socketCloseHandler),this._resolved=!1}function cleanupFailedConnection(h){process.nextTick((function(){h.drop(1006,"TCP connection lost before handshake completed.",!0)}))}C.inherits(WebSocketRequest,w),WebSocketRequest.prototype.readHandshake=function(){var h=this,m=this.httpRequest;if(this.resourceURL=T.parse(this.resource,!0),this.host=m.headers.host,!this.host)throw new Error("Client must provide a Host header.");if(this.key=m.headers["sec-websocket-key"],!this.key)throw new Error("Client must provide a value for Sec-WebSocket-Key.");if(this.webSocketVersion=parseInt(m.headers["sec-websocket-version"],10),!this.webSocketVersion||isNaN(this.webSocketVersion))throw new Error("Client must provide a value for Sec-WebSocket-Version.");switch(this.webSocketVersion){case 8:case 13:break;default:var y=new Error("Unsupported websocket client version: "+this.webSocketVersion+"Only versions 8 and 13 are supported.");throw y.httpCode=426,y.headers={"Sec-WebSocket-Version":"13"},y}13===this.webSocketVersion?this.origin=m.headers.origin:8===this.webSocketVersion&&(this.origin=m.headers["sec-websocket-origin"]);var v=m.headers["sec-websocket-protocol"];(this.protocolFullCaseMap={},this.requestedProtocols=[],v)&&v.split(P).forEach((function(m){var y=m.toLocaleLowerCase();h.requestedProtocols.push(y),h.protocolFullCaseMap[y]=m}));if(!this.serverConfig.ignoreXForwardedFor&&m.headers["x-forwarded-for"]){var C=this.remoteAddress;this.remoteAddresses=m.headers["x-forwarded-for"].split(M),this.remoteAddresses.push(C),this.remoteAddress=this.remoteAddresses[0]}var w=m.headers["sec-websocket-extensions"];this.requestedExtensions=this.parseExtensions(w);var A=m.headers.cookie;this.cookies=this.parseCookies(A)},WebSocketRequest.prototype.parseExtensions=function(h){if(!h||0===h.length)return[];var m=h.toLocaleLowerCase().split(P);return m.forEach((function(h,m,y){var v=h.split(k),C=v[0],T=v.slice(1);T.forEach((function(h,m,y){var v=h.split("="),C={name:v[0],value:v[1]};y.splice(m,1,C)}));var w={name:C,params:T};y.splice(m,1,w)})),m},WebSocketRequest.prototype.parseCookies=function(h){if(!h||"string"!=typeof h)return[];var m=[];return h.split(B).forEach((function(h){var y=h.indexOf("=");if(-1!==y){var v=h.substr(0,y).trim(),C=h.substr(++y,h.length).trim();'"'===C[0]&&(C=C.slice(1,-1)),m.push({name:v,value:decodeURIComponent(C)})}else m.push({name:h,value:null})})),m},WebSocketRequest.prototype.accept=function(h,m,y){var C;this._verifyResolution(),h?void 0===(C=this.protocolFullCaseMap[h.toLocaleLowerCase()])&&(C=h):C=h,this.protocolFullCaseMap=null;var T=v.createHash("sha1");T.update(this.key+"258EAFA5-E914-47DA-95CA-C5AB0DC85B11");var w="HTTP/1.1 101 Switching Protocols\r\nUpgrade: websocket\r\nConnection: Upgrade\r\nSec-WebSocket-Accept: "+T.digest("base64")+"\r\n";if(C){for(var P=0;P<C.length;P++){var k=C.charCodeAt(P),M=C.charAt(P);if(k<33||k>126||-1!==N.indexOf(M))throw this.reject(500),new Error('Illegal character "'+String.fromCharCode(M)+'" in subprotocol.')}if(-1===this.requestedProtocols.indexOf(h))throw this.reject(500),new Error("Specified protocol was not requested by the client.");C=C.replace(R,""),w+="Sec-WebSocket-Protocol: "+C+"\r\n"}if(this.requestedProtocols=null,m&&(m=m.replace(R,""),13===this.webSocketVersion?w+="Origin: "+m+"\r\n":8===this.webSocketVersion&&(w+="Sec-WebSocket-Origin: "+m+"\r\n")),y){if(!Array.isArray(y))throw this.reject(500),new Error('Value supplied for "cookies" argument must be an array.');var D={};y.forEach(function(h){if(!h.name||!h.value)throw this.reject(500),new Error('Each cookie to set must at least provide a "name" and "value"');if(h.name=h.name.replace(U,""),h.value=h.value.replace(U,""),D[h.name])throw this.reject(500),new Error("You may not specify the same cookie name twice.");D[h.name]=!0;var m=h.name.match(x);if(m)throw this.reject(500),new Error("Illegal character "+m[0]+" in cookie name");if(m=h.value.match(L)?h.value.slice(1,-1).match(O):h.value.match(O))throw this.reject(500),new Error("Illegal character "+m[0]+" in cookie value");var y=[h.name+"="+h.value];if(h.path){if(m=h.path.match(U))throw this.reject(500),new Error("Illegal character "+m[0]+" in cookie path");y.push("Path="+h.path)}if(h.domain){if("string"!=typeof h.domain)throw this.reject(500),new Error("Domain must be specified and must be a string.");if(m=h.domain.match(U))throw this.reject(500),new Error("Illegal character "+m[0]+" in cookie domain");y.push("Domain="+h.domain.toLowerCase())}if(h.expires){if(!(h.expires instanceof Date))throw this.reject(500),new Error('Value supplied for cookie "expires" must be a vaild date object');y.push("Expires="+h.expires.toGMTString())}if(h.maxage){var v=h.maxage;if("string"==typeof v&&(v=parseInt(v,10)),isNaN(v)||v<=0)throw this.reject(500),new Error('Value supplied for cookie "maxage" must be a non-zero number');v=Math.round(v),y.push("Max-Age="+v.toString(10))}if(h.secure){if("boolean"!=typeof h.secure)throw this.reject(500),new Error('Value supplied for cookie "secure" must be of type boolean');y.push("Secure")}if(h.httponly){if("boolean"!=typeof h.httponly)throw this.reject(500),new Error('Value supplied for cookie "httponly" must be of type boolean');y.push("HttpOnly")}w+="Set-Cookie: "+y.join(";")+"\r\n"}.bind(this))}this._resolved=!0,this.emit("requestResolved",this),w+="\r\n";var I=new A(this.socket,[],h,!1,this.serverConfig);I.webSocketVersion=this.webSocketVersion,I.remoteAddress=this.remoteAddress,I.remoteAddresses=this.remoteAddresses;var B=this;return this._socketIsClosing?cleanupFailedConnection(I):this.socket.write(w,"ascii",(function(h){h?cleanupFailedConnection(I):(B._removeSocketCloseListeners(),I._addSocketEventListeners())})),this.emit("requestAccepted",I),I},WebSocketRequest.prototype.reject=function(h,m,y){this._verifyResolution(),this._resolved=!0,this.emit("requestResolved",this),"number"!=typeof h&&(h=403);var v="HTTP/1.1 "+h+" "+W[h]+"\r\nConnection: close\r\n";if(m&&(v+="X-WebSocket-Reject-Reason: "+(m=m.replace(R,""))+"\r\n"),y)for(var C in y){var T=y[C].toString().replace(R,"");v+=C.replace(R,"")+": "+T+"\r\n"}v+="\r\n",this.socket.end(v,"ascii"),this.emit("requestRejected",this)},WebSocketRequest.prototype._handleSocketCloseBeforeAccept=function(){this._socketIsClosing=!0,this._removeSocketCloseListeners()},WebSocketRequest.prototype._removeSocketCloseListeners=function(){this.socket.removeListener("end",this._socketCloseHandler),this.socket.removeListener("close",this._socketCloseHandler)},WebSocketRequest.prototype._verifyResolution=function(){if(this._resolved)throw new Error("WebSocketRequest may only be accepted or rejected one time.")},h.exports=WebSocketRequest},function(h,m,y){var v=y(1492).BufferUtil,C=y(86).bufferAllocUnsafe;function WebSocketFrame(h,m,y){this.maskBytes=h,this.frameHeader=m,this.config=y,this.maxReceivedFrameSize=y.maxReceivedFrameSize,this.protocolError=!1,this.frameTooLarge=!1,this.invalidCloseFrameLength=!1,this.parseState=1,this.closeStatus=-1}WebSocketFrame.prototype.addData=function(h){if(1===this.parseState&&h.length>=2){h.joinInto(this.frameHeader,0,0,2),h.advance(2);var m=this.frameHeader[0],y=this.frameHeader[1];if(this.fin=Boolean(128&m),this.rsv1=Boolean(64&m),this.rsv2=Boolean(32&m),this.rsv3=Boolean(16&m),this.mask=Boolean(128&y),this.opcode=15&m,this.length=127&y,this.opcode>=8){if(this.length>125)return this.protocolError=!0,this.dropReason="Illegal control frame longer than 125 bytes.",!0;if(!this.fin)return this.protocolError=!0,this.dropReason="Control frames must not be fragmented.",!0}126===this.length?this.parseState=2:127===this.length?this.parseState=3:this.parseState=4}if(2===this.parseState)h.length>=2&&(h.joinInto(this.frameHeader,2,0,2),h.advance(2),this.length=this.frameHeader.readUInt16BE(2),this.parseState=4);else if(3===this.parseState&&h.length>=8){h.joinInto(this.frameHeader,2,0,8),h.advance(8);var T=[this.frameHeader.readUInt32BE(2),this.frameHeader.readUInt32BE(6)];if(0!==T[0])return this.protocolError=!0,this.dropReason="Unsupported 64-bit length frame received",!0;this.length=T[1],this.parseState=4}if(4===this.parseState&&(this.mask?h.length>=4&&(h.joinInto(this.maskBytes,0,0,4),h.advance(4),this.parseState=5):this.parseState=5),5===this.parseState){if(this.length>this.maxReceivedFrameSize)return this.frameTooLarge=!0,this.dropReason="Frame size of "+this.length.toString(10)+" bytes exceeds maximum accepted frame size",!0;if(0===this.length)return this.binaryPayload=C(0),this.parseState=6,!0;if(h.length>=this.length)return this.binaryPayload=h.take(this.length),h.advance(this.length),this.mask&&v.unmask(this.binaryPayload,this.maskBytes),8===this.opcode&&(1===this.length&&(this.binaryPayload=C(0),this.invalidCloseFrameLength=!0),this.length>=2&&(this.closeStatus=this.binaryPayload.readUInt16BE(0),this.binaryPayload=this.binaryPayload.slice(2))),this.parseState=6,!0}return!1},WebSocketFrame.prototype.throwAwayPayload=function(h){return h.length>=this.length&&(h.advance(this.length),this.parseState=6,!0)},WebSocketFrame.prototype.toBuffer=function(h){var m,y,T,w=2,A=0,P=0;this.fin&&(A|=128),this.rsv1&&(A|=64),this.rsv2&&(A|=32),this.rsv3&&(A|=16),this.mask&&(P|=128),A|=15&this.opcode,8===this.opcode?(this.length=2,this.binaryPayload&&(this.length+=this.binaryPayload.length),(y=C(this.length)).writeUInt16BE(this.closeStatus,0),this.length>2&&this.binaryPayload.copy(y,2)):this.binaryPayload?(y=this.binaryPayload,this.length=y.length):this.length=0,this.length<=125?P|=127&this.length:this.length>125&&this.length<=65535?(P|=126,w+=2):this.length>65535&&(P|=127,w+=8);var k=C(this.length+w+(this.mask?4:0));return k[0]=A,k[1]=P,T=2,this.length>125&&this.length<=65535?(k.writeUInt16BE(this.length,T),T+=2):this.length>65535&&(k.writeUInt32BE(0,T),k.writeUInt32BE(this.length,T+4),T+=8),this.mask?(m=h?0:4294967295*Math.random()>>>0,this.maskBytes.writeUInt32BE(m,0),this.maskBytes.copy(k,T),T+=4,y&&v.mask(y,this.maskBytes,k,T,this.length)):y&&y.copy(k,T),k},WebSocketFrame.prototype.toString=function(){return"Opcode: "+this.opcode+", fin: "+this.fin+", length: "+this.length+", hasPayload: "+Boolean(this.binaryPayload)+", masked: "+this.mask},h.exports=WebSocketFrame},function(h,m,y){var v=y(86),C=v.extend,T=y(10),w=y(13).EventEmitter,A=y(52),P=y(46),k=y(20),R=y(11),M=y(329),N=v.bufferAllocUnsafe,D=["(",")","<",">","@",",",";",":","\\",'"',"/","[","]","?","=","{","}"," ",String.fromCharCode(9)],I=["hostname","port","method","path","headers"];function WebSocketClient(h){var m;(w.call(this),this.config={maxReceivedFrameSize:1048576,maxReceivedMessageSize:8388608,fragmentOutgoingMessages:!0,fragmentationThreshold:16384,webSocketVersion:13,assembleFragments:!0,disableNagleAlgorithm:!0,closeTimeout:5e3,tlsOptions:{}},h)&&(h.tlsOptions?(m=h.tlsOptions,delete h.tlsOptions):m={},C(this.config,h),C(this.config.tlsOptions,m));switch(this._req=null,this.config.webSocketVersion){case 8:case 13:break;default:throw new Error("Requested webSocketVersion is not supported. Allowed values are 8 and 13.")}}T.inherits(WebSocketClient,w),WebSocketClient.prototype.connect=function(h,m,y,T,w){var R=this;if("string"==typeof m&&(m=m.length>0?[m]:[]),m instanceof Array||(m=[]),this.protocols=m,this.origin=y,this.url="string"==typeof h?k.parse(h):h,!this.url.protocol)throw new Error("You must specify a full WebSocket URL, including protocol.");if(!this.url.host)throw new Error("You must specify a full WebSocket URL, including hostname. Relative URLs are not supported.");this.secure="wss:"===this.url.protocol,this.protocols.forEach((function(h){for(var m=0;m<h.length;m++){var y=h.charCodeAt(m),v=h.charAt(m);if(y<33||y>126||-1!==D.indexOf(v))throw new Error('Protocol list contains invalid character "'+String.fromCharCode(y)+'"')}}));this.url.port||(this.url.port={"ws:":"80","wss:":"443"}[this.url.protocol]);for(var M=N(16),x=0;x<16;x++)M[x]=Math.round(255*Math.random());this.base64nonce=M.toString("base64");var O=this.url.hostname;("ws:"===this.url.protocol&&"80"!==this.url.port||"wss:"===this.url.protocol&&"443"!==this.url.port)&&(O+=":"+this.url.port);var L,U={};function handleRequestError(h){R._req=null,R.emit("connectFailed",h)}this.secure&&this.config.tlsOptions.hasOwnProperty("headers")&&C(U,this.config.tlsOptions.headers),T&&C(U,T),C(U,{Upgrade:"websocket",Connection:"Upgrade","Sec-WebSocket-Version":this.config.webSocketVersion.toString(10),"Sec-WebSocket-Key":this.base64nonce,Host:U.Host||O}),this.protocols.length>0&&(U["Sec-WebSocket-Protocol"]=this.protocols.join(", ")),this.origin&&(13===this.config.webSocketVersion?U.Origin=this.origin:8===this.config.webSocketVersion&&(U["Sec-WebSocket-Origin"]=this.origin)),L=this.url.pathname?this.url.path:this.url.path?"/"+this.url.path:"/";var B={agent:!1};if(w&&C(B,w),C(B,{hostname:this.url.hostname,port:this.url.port,method:"GET",path:L,headers:U}),this.secure){var W=this.config.tlsOptions;for(var q in W)W.hasOwnProperty(q)&&-1===I.indexOf(q)&&(B[q]=W[q])}var Y=this._req=(this.secure?P:A).request(B);Y.on("upgrade",(function handleRequestUpgrade(h,m,y){R._req=null,Y.removeListener("error",handleRequestError),R.socket=m,R.response=h,R.firstDataChunk=y,R.validateHandshake()})),Y.on("error",handleRequestError),Y.on("response",(function(h){if(R._req=null,v.eventEmitterListenerCount(R,"httpResponse")>0)R.emit("httpResponse",h,R),h.socket&&h.socket.end();else{var m=[];for(var y in h.headers)m.push(y+": "+h.headers[y]);R.failHandshake("Server responded with a non-101 status: "+h.statusCode+" "+h.statusMessage+"\nResponse Headers Follow:\n"+m.join("\n")+"\n")}})),Y.end()},WebSocketClient.prototype.validateHandshake=function(){var h=this.response.headers;if(this.protocols.length>0){if(this.protocol=h["sec-websocket-protocol"],!this.protocol)return void this.failHandshake("Expected a Sec-WebSocket-Protocol header.");if(-1===this.protocols.indexOf(this.protocol))return void this.failHandshake("Server did not respond with a requested protocol.")}if(h.connection&&"upgrade"===h.connection.toLocaleLowerCase())if(h.upgrade&&"websocket"===h.upgrade.toLocaleLowerCase()){var m=R.createHash("sha1");m.update(this.base64nonce+"258EAFA5-E914-47DA-95CA-C5AB0DC85B11");var y=m.digest("base64");h["sec-websocket-accept"]?h["sec-websocket-accept"]===y?this.succeedHandshake():this.failHandshake("Sec-WebSocket-Accept header from server didn't match expected value of "+y):this.failHandshake("Expected Sec-WebSocket-Accept header from server")}else this.failHandshake("Expected an Upgrade: websocket header from the server");else this.failHandshake("Expected a Connection: Upgrade header from the server")},WebSocketClient.prototype.failHandshake=function(h){this.socket&&this.socket.writable&&this.socket.end(),this.emit("connectFailed",new Error(h))},WebSocketClient.prototype.succeedHandshake=function(){var h=new M(this.socket,[],this.protocol,!0,this.config);h.webSocketVersion=this.config.webSocketVersion,h._addSocketEventListeners(),this.emit("connect",h),this.firstDataChunk.length>0&&h.handleSocketData(this.firstDataChunk),this.firstDataChunk=null},WebSocketClient.prototype.abort=function(){this._req&&this._req.abort()},h.exports=WebSocketClient},function(h,m,y){var v=m.noop=function(){};function BufferingLogger(h,m,y){this.logFunction=y,this.identifier=h,this.uniqueID=m,this.buffer=[]}m.extend=function extend(h,m){for(var y in m)h[y]=m[y]},m.eventEmitterListenerCount=y(13).EventEmitter.listenerCount||function(h,m){return h.listeners(m).length},m.BufferingLogger=function createBufferingLogger(h,m){var C=y(328)(h);if(C.enabled){var T=new BufferingLogger(h,m,C),w=T.log.bind(T);return w.printOutput=T.printOutput.bind(T),w.enabled=C.enabled,w}return C.printOutput=v,C},BufferingLogger.prototype.log=function(){return this.buffer.push([new Date,Array.prototype.slice.call(arguments)]),this},BufferingLogger.prototype.clear=function(){return this.buffer=[],this},BufferingLogger.prototype.printOutput=function(h){h||(h=this.logFunction);var m=this.uniqueID;this.buffer.forEach((function(y){var v=y[0].toLocaleString(),C=y[1].slice(),T=C[0];null!=T&&(T="%s - %s - "+T.toString(),C.splice(0,1,T,v,m),h.apply(global,C))}))}},function(h,m,y){y(11);var v=y(10),C=y(20),T=y(13).EventEmitter,w=y(199).client,A=(y(199).connection,/,\s*/),P=/;\s*/,k=/[\r\n]/g,R=/,\s*/,M=["(",")","<",">","@",",",";",":","\\",'"',"/","[","]","?","=","{","}"," ",String.fromCharCode(9)],N=/[;,] */;function HybridConnectionsWebSocketRequest(h,m,y,v){T.call(this),this.resource=h,this.address=h,this.id=m,this.httpRequest={headers:{}};for(var C=Object.keys(y),w=C.length;w;--w)this.httpRequest.headers[C[w-1].toLowerCase()]=y[C[w-1]];this.serverConfig=v,this._resolved=!1}v.inherits(HybridConnectionsWebSocketRequest,T),HybridConnectionsWebSocketRequest.prototype.readHandshake=function(){var h=this,m=this.httpRequest;if(this.resourceURL=C.parse(this.resource,!0),this.host=m.headers.host,!this.host)throw new Error("Client must provide a Host header.");if(this.key=m.headers["sec-websocket-key"],!this.key)throw new Error("Client must provide a value for Sec-WebSocket-Key.");if(this.webSocketVersion=parseInt(m.headers["sec-websocket-version"],10),!this.webSocketVersion||isNaN(this.webSocketVersion))throw new Error("Client must provide a value for Sec-WebSocket-Version.");var y=m.headers["sec-websocket-protocol"];(this.protocolFullCaseMap={},this.requestedProtocols=[],y)&&y.split(A).forEach((function(m){var y=m.toLocaleLowerCase();h.requestedProtocols.push(y),h.protocolFullCaseMap[y]=m}));if(!this.serverConfig.ignoreXForwardedFor&&m.headers["x-forwarded-for"]){var v=this.remoteAddress;this.remoteAddresses=m.headers["x-forwarded-for"].split(R),this.remoteAddresses.push(v),this.remoteAddress=this.remoteAddresses[0]}var T=m.headers["sec-websocket-extensions"];this.requestedExtensions=this.parseExtensions(T);var w=m.headers.cookie;this.cookies=this.parseCookies(w)},HybridConnectionsWebSocketRequest.prototype.parseExtensions=function(h){if(!h||0===h.length)return[];var m=h.toLocaleLowerCase().split(A);return m.forEach((function(h,m,y){var v=h.split(P),C=v[0],T=v.slice(1);T.forEach((function(h,m,y){var v=h.split("="),C={name:v[0],value:v[1]};y.splice(m,1,C)}));var w={name:C,params:T};y.splice(m,1,w)})),m},HybridConnectionsWebSocketRequest.prototype.parseCookies=function(h){if(!h||"string"!=typeof h)return[];var m=[];return h.split(N).forEach((function(h){var y=h.indexOf("=");if(-1!==y){var v=h.substr(0,y).trim(),C=h.substr(++y,h.length).trim();'"'===C[0]&&(C=C.slice(1,-1)),m.push({name:v,value:decodeURIComponent(C)})}else m.push({name:h,value:null})})),m},HybridConnectionsWebSocketRequest.prototype.accept=function(h,m,y,v){var C=this,T=null;if(h?void 0===(T=this.protocolFullCaseMap[h.toLocaleLowerCase()])&&(T=h):T=h,this.protocolFullCaseMap=null,T){for(var A=0;A<T.length;A++){var P=T.charCodeAt(A),R=T.charAt(A);if(P<33||P>126||-1!==M.indexOf(R))throw this.reject(500),new Error('Illegal character "'+String.fromCharCode(R)+'" in subprotocol.')}if(-1===this.requestedProtocols.indexOf(h))throw this.reject(500),new Error("Specified protocol was not requested by the client.");T=T.replace(k,"")}this.requestedProtocols=null,this._resolved=!0,this.emit("requestResolved",this);var N=new w;N.connect(this.address,T),N.on("connect",(function(h){C.emit("requestAccepted",h),v&&v(h)})),N.on("error",(function(h){C.emit("requestRejected",h),v&&v(h)}))},HybridConnectionsWebSocketRequest.prototype.reject=function(h,m,y,v){var C=new w,T=this.address+"&statusCode="+h+"&statusDescription="+encodeURIComponent(m);C.connect(T,null,null,y),C.on("error",(function(h){this.emit("requestRejected",h),v(h)}))},HybridConnectionsWebSocketRequest.prototype._handleSocketCloseBeforeAccept=function(){this._socketIsClosing=!0,this._removeSocketCloseListeners()},HybridConnectionsWebSocketRequest.prototype._removeSocketCloseListeners=function(){this.socket.removeListener("end",this._socketCloseHandler),this.socket.removeListener("close",this._socketCloseHandler)},HybridConnectionsWebSocketRequest.prototype._verifyResolution=function(){if(this._resolved)throw new Error("HybridConnectionsWebSocketRequest may only be accepted or rejected one time.")},h.exports=HybridConnectionsWebSocketRequest},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0});var v=y(1136);class AbortSignal extends v.EventTarget{constructor(){throw super(),new TypeError("AbortSignal cannot be constructed directly")}get aborted(){const h=C.get(this);if("boolean"!=typeof h)throw new TypeError(`Expected 'this' to be an 'AbortSignal' object, but got ${null===this?"null":typeof this}`);return h}}v.defineEventAttribute(AbortSignal.prototype,"abort");const C=new WeakMap;Object.defineProperties(AbortSignal.prototype,{aborted:{enumerable:!0}}),"function"==typeof Symbol&&"symbol"==typeof Symbol.toStringTag&&Object.defineProperty(AbortSignal.prototype,Symbol.toStringTag,{configurable:!0,value:"AbortSignal"});class AbortController{constructor(){T.set(this,function createAbortSignal(){const h=Object.create(AbortSignal.prototype);return v.EventTarget.call(h),C.set(h,!1),h}())}get signal(){return getSignal(this)}abort(){!function abortSignal(h){!1===C.get(h)&&(C.set(h,!0),h.dispatchEvent({type:"abort"}))}(getSignal(this))}}const T=new WeakMap;function getSignal(h){const m=T.get(h);if(null==m)throw new TypeError(`Expected 'this' to be an 'AbortController' object, but got ${null===h?"null":typeof h}`);return m}Object.defineProperties(AbortController.prototype,{signal:{enumerable:!0},abort:{enumerable:!0}}),"function"==typeof Symbol&&"symbol"==typeof Symbol.toStringTag&&Object.defineProperty(AbortController.prototype,Symbol.toStringTag,{configurable:!0,value:"AbortController"}),m.AbortController=AbortController,m.AbortSignal=AbortSignal,m.default=AbortController,h.exports=AbortController,h.exports.AbortController=h.exports.default=AbortController,h.exports.AbortSignal=AbortSignal},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0});const v=y(0);y(745)({base:__dirname+"/.."});const C=y(15),T=y(2),w=y(3),A=y(4),P=y(110),k=y(292),R=y(1337),M=y(80),N=y(5),D=y(8),I=y(298),x=y(305),O=y(1408),L=y(143),U=y(16),B=y(1416),W=y(1479),q=y(1480),Y=y(64),V=y(548),$=y(1508),z=y(1509),G=y(326);w.TimeTracker.initialize();const J=y(593),X=y(325),Z=y(1510),ee=y(1512),te=y(1513),re={ppe:["https://ppe.liveshare.vsengsaas.visualstudio.com/","https://signlr-ppe.core.vsengsaas.visualstudio.com/api/signalr/signalrhub"],dev:["https://ci.dev.liveshare.vsengsaas.visualstudio.com/","https://signlr.dev.core.vsengsaas.visualstudio.com/api/signalr/signalrhub"],"insiders-stg":["https://insiders-stg.liveshare.vsengsaas.visualstudio.com/",void 0]},ie=new N.OptOutTelemetryFilter,se=/([0-9a-z]{36})/im;async function leaveCollaboration(){await v.commands.executeCommand("liveshare.leave")}m.activate=async function activate(h){var m;w.TimeTracker.start("extension:activate"),await w.ExtensionUtil.setCommandContext("liveshare:isWeb",!0),await w.Settings.settingsProvider.init(h,void 0);const B=null===(m=w.Settings.get(w.SettingKeys.performanceRun))||void 0===m?void 0:m.trim();B&&D.Telemetry.addContextProperty(w.TelemetryPropertyNames.PERFORMANCE_RUN,B),D.Telemetry.addFilter(ie);let W=w.ExtensionUtil.getPackageExtension(w.constants.LIVESHARE_EXTENSION_ID);if(!W)throw new Error(`Failed to get package for extensionId:${w.constants.LIVESHARE_EXTENSION_ID}`);w.Settings.get(w.SettingKeys.firstActivationTime)||w.Settings.save(w.SettingKeys.firstActivationTime,(new Date).getTime());const q=$.queryParameter("env");if(q&&re.hasOwnProperty(q)){const h=re[q];w.Settings.save(w.SettingKeys.serviceUri,h[0]),h[1]&&w.Settings.save(w.SettingKeys.signalRServiceUri,h[1])}const oe=w.Settings.get(w.SettingKeys.canCollectPII)||$.optionQuery("canCollectPII"),ae=w.Settings.get(w.SettingKeys.diagnosticLogging)||$.optionQuery("enableLogging"),ce=w.ExtensionUtil.isNode(),logFilePath=()=>{if(ce){const h=y(7),m=y(18);return h.join(m.tmpdir(),"VSLiveshareLogs")}};if(await w.ExtensionUtil.setCommandContext("liveshare:isNode",ce),await w.TimeTracker.timeIt("intialize commands",async()=>await N.vslsCommands.initialize({extensionPackage:W,extensionContext:h,telemetry:{featureName:"liveshare.",canSendSensistiveInformation:oe},logging:{logFileEnabled:ce,logFilePath:logFilePath(),logLevel:w.Settings.get(w.SettingKeys.diagnosticLoggingLevel),outputChannelName:w.Settings.get(w.SettingKeys.name),outputChannelTimestamp:w.Settings.get("outputChannelTimestamp"),filters:w.Settings.get("traceFilters"),diagnosticsLogging:{enable:ae,focus:$.optionQuery("focusLogging")}}})),ce)w.Settings.get(w.SettingKeys.logTelemetry)&&await ee.addTelemetryLogFilter(),D.Telemetry.addContextProperty(w.TelemetryPropertyNames.IS_AGENTLESS,!0);else{const h=z.detect();D.Telemetry.addContextProperty(w.TelemetryPropertyNames.BROWSER_VERSION,h&&h.version||"<unknown>"),D.Telemetry.addContextProperty(w.TelemetryPropertyNames.BROWSER_NAME,h&&h.name||"<unknown>")}w.ExtensionTelemetry.setSettingsContextProperties();let le=function getDefaultWorkspaceId(h){if(h&&v.workspace.workspaceFolders&&v.workspace.workspaceFolders.length>0){const h=v.workspace.workspaceFolders[0].uri;if("vsls"===h.scheme)return h.query}if($.queries.length>0){const h=$.queryParameter("sessionId"),m=null==h?void 0:h.match(se);return h&&!m&&(N.traceSource.error("Activation: Invalid collaboration session URL"),v.window.showErrorMessage(w.localize("Joining collaboration session: Invalid collaboration session URL"),{modal:!0})),m?m[0]:""}}(ce);if(await G.openInOtherClient(le))return;await w.TimeTracker.timeIt("initExpServiceAsync",async()=>await w.initExpServiceAsync(h,!ce)),C.LoggerSettings.disableObfuscation=oe,N.traceSource.info(`Liveshare activated name:${W.name} version:${W.version}`),w.ExtensionUtil.init(h,{extensionName:w.Settings.get(w.SettingKeys.abbreviation),extensionVersion:W.version,applicationName:"VSCode",applicationVersion:v.version},w.constants.LIVESHARE_EXTENSION_ID);const ue=D.Telemetry.startTimedEvent(w.TelemetryEventNames.ACTIVATE_EXTENSION),de=w.dependencies;de.enableCommands={},w.Settings.save(w.SettingKeys.runsInVSCodeDev,!0),w.Settings.save(w.SettingKeys.nativeAuthFlow,!0),de.authenticationProvider.value=new w.AuthenticationProviderBase(de.authService(),w.Settings.get(w.SettingKeys.nativeAuthFlow));const he=[w.liveshareGithubStrategy,w.liveshareAnonymousStrategy];await w.auth.init(h,w.constants.LIVESHARE_EXTENSION_ID,he,te),w.registerProtocolHandler(ue);const pe=w.Settings.get(w.SettingKeys.signalRServiceUri);X.isLiveshareHubEnabled()?M.dependencies.hubConnectionServiceFactory.value=new R.RpcHubConnectionServiceFactory(await J.hubRpcClient(),de.authService(),pe,N.traceSource.withName("RpcHubConnectionServiceFactory")):M.dependencies.hubConnectionServiceFactory.value=new R.HubConnectionServiceFactory(de.authService(),pe,P.ContactManager,N.traceSource.withName("HubConnectionServiceFactory"));const me=await M.dependencies.hubConnectionServiceFactory().getOrCreate();de.agentRpcServer=new L.MultiChannelRpcServer(N.traceSource);const fe=de.rpcClient.value=await L.createDuplexMultiChannelRpcClient(de.agentRpcServer,N.traceSource),ye=new U.RpcProxyCache(fe,N.traceSource.withName("RpcProxyCache")),ve=new w.RpcServices(h=>ye.getOrCreate(h),T.lazyLoad(()=>fe));w.Dependencies.rpcServices=ve,de.fileSystemManager().registerFileSystemProvider(),de.trackDebugManager=T.lazyLoad(()=>new I.TrackDebugManager(fe,de.fileService,de.accessControlManager)),de.plannedSessionsService=T.lazyLoad(()=>new Z.PlannedSessionsService(w.createWorkspaceApi(de),N.traceSource.withName("PlannedSessionsService"))),le||(le=w.Settings.get(w.SettingKeys.joinWorkspaceId)),le&&de.fileSystemManager().workspaceProvider.createorUpdateWorkspaceFile(le,"");const Se=ye.getOrCreate(A.vsls.WorkspaceService);Se.onConnectionStatusChanged(h=>async function onWorkspaceConnectionStatusChanged(h){if(h.connectionStatus!==A.vsls.WorkspaceConnectionStatus.Disconnected&&h.connectionStatus!==A.vsls.WorkspaceConnectionStatus.Unavailable)return;if(h.disconnectedReason===A.vsls.WorkspaceDisconnectedReason.Requested)return;if(w.sessionStateTracker.State===w.SessionState.Joined||w.sessionStateTracker.State===w.SessionState.JoiningInProgress){let m,y=!1;switch(h.disconnectedReason){case A.vsls.WorkspaceDisconnectedReason.SessionEnded:m=w.localize("The host has ended the current collaboration session. Open folders and editors will now close.");break;case A.vsls.WorkspaceDisconnectedReason.SessionExpired:m=w.localize("The collaboration session expired. Please sign in and try again."),y=!0;break;case A.vsls.WorkspaceDisconnectedReason.UserRemoved:new D.TelemetryEvent(w.TelemetryEventNames.REMOVE_USER).send(),m=w.localize("You have been removed from the collaboration session.");break;case A.vsls.WorkspaceDisconnectedReason.UserBlocked:new D.TelemetryEvent(w.TelemetryEventNames.BLOCK_USER).send(),m=w.localize("You have been blocked from the collaboration session.");break;case A.vsls.WorkspaceDisconnectedReason.ConnectionLost:m=w.localize("You were disconnected from the collaboration session due to a connectivity problem or the host going offline."),y=!0;break;case A.vsls.WorkspaceDisconnectedReason.InternalError:default:m=w.localize("The collaboration session has ended due to an internal error."),y=!0}y?await v.window.showErrorMessage(m,{modal:!0}):await v.window.showInformationMessage(m,{modal:!0}),await leaveCollaboration()}}(h)),Se.onUserRemoved(async()=>{await v.window.showInformationMessage(w.localize("You have been removed from the collaboration session."),{modal:!0}),await leaveCollaboration()}),Se.onUserBlocked(async()=>{await v.window.showInformationMessage(w.localize("You have been blocked from the collaboration session."),{modal:!0}),await leaveCollaboration()}),h.subscriptions.push(v.debug.registerDebugAdapterDescriptorFactory("vslsJoin",new I.JoinDebugAdapterDescriptorFactory(de.workspaceServices(),ve.rpcFactory,N.traceSource.withName("JoinDebugAdapterDescriptorFactory"))));const Ee=new ExtensionSetup(ce,de.commandRegistryProvider(),de);await Ee.init(),w.TimeTracker.markTime("Initialize Commands"),new w.Commands(de).initialize(),w.ExtensionUtil.setCommandContext("liveshare:showExplorer",!0),w.ExtensionUtil.setCommandContext("liveshare:showHelpViewlet",!0);const Ce=await k.CommunicationsManager.isAudioEnabled();w.ExtensionUtil.setCommandContext("liveshare:isAudioEnabled",Ce);const _e=await k.CommunicationsManager.isChatEnabled();if(w.ExtensionUtil.setCommandContext("liveshare:isChatEnabled",_e),ce){const m=new w.StatusBarController(h=>{const m=de.enableCommands[h];return!!m&&m()},new V.StatusbarQuickPickItemsProvider);h.subscriptions.push(m),de.statusBarController.value=m}else de.statusBarController.value=null,w.createSimpleStatusBar();if(h.subscriptions.push(new x.ServerManager(de)),P.ContactManager.once(w.ContactManagerEvents.Ready,async()=>{w.TimeTracker.start("Contact Manager Ready");const h=new R.PresenceServiceProvider(me,N.traceSource.withName("PresenceServiceProvider"));await P.ContactManager.registerAndInitializeServiceProvider(w.constants.LIVESHARE_PRESENCE_PROVIDER_ID,h);const m=new P.ContactsProviderViewlet(w.SessionContext);v.window.registerTreeDataProvider("liveshare.contacts",m),P.isLivesharePresenceEnabled()&&await P.ContactManager.getServiceManager(w.constants.LIVESHARE_PRESENCE_PROVIDER_ID).signIn(),w.TimeTracker.stop("Contact Manager Ready")}),w.TimeTracker.markTime("Initialize Contact Manager"),P.ContactManager.initialize(de),w.initInviteLinkSupport(P.ContactManager),w.TimeTracker.markTime("Initialize Communications Manager"),await k.CommunicationsManager.initialize(de),le){w.userAuthStateTracker.completeDefaultAuthAttempt();const h={isActivate:!0,link:`${w.Settings.get(w.SettingKeys.serviceUri)}join?${le}`,isAllowAnonymous:!0};v.commands.executeCommand("liveshare.join",h)}else(async h=>{await v.commands.executeCommand("liveshare.signin",{isDefaultSignIn:h})})(!0);const createSessionExplorer=(h,m)=>{const y=new w.SessionExplorerProvider(w.SessionContext);return m&&y.registerTreeDataProvider(new w.CollabActionTreeDataProvider(h)),y};w.TimeTracker.markTime("Create session explorers");const Te=createSessionExplorer(!1,!1),be=createSessionExplorer(!0,!0),we={};if(we[Y.View.ExplorerSession]=be,we[Y.View.Session]=Te,v.window.registerTreeDataProvider(Y.View.ExplorerSession,be),v.window.registerTreeDataProvider(Y.View.Session,Te),v.window.registerTreeDataProvider(Y.View.Help,new w.HelpViewletProvider),ce){const h=new O.PlannedSessionsProvider;v.window.registerTreeDataProvider(Y.View.PlannedSessions,h)}await w.ExtensionUtil.setCommandContext("liveshare:showPlannedSessionsViewlet",ce),await w.ExtensionUtil.setCommandContext("liveshare:showCreatePlannedSessionCommand",ce),de.activityBarProvider=Te,de.fileTreeExplorerProvider=be;const Ae=new V.LiveShareExtensionApi({client:fe,workspaceService:de.workspaceService(),workspaceUserService:de.workspaceUserService(),workspaceServices:de.workspaceServices(),pathManager:de.pathManager(),contactManager:P.ContactManager,treeViews:we,authStrategies:[],apiPromise:w.Settings.settingsProvider.ready});return w.TimeTracker.stop("extension:activate"),ue.end(D.TelemetryResult.Success,"Extension activation success.",!0),Ae},m.deactivate=function deactivate(){ie.dispose()};class ExtensionSetup extends w.ExtensionSetupBase{constructor(h,m,y){super(m,y),this.isNode=h}get shareCommandBuilder(){return q.shareCommandBuilder}get joinCommandBuilder(){return B.joinCommandBuilder}registerCommands(){super.registerCommands(),P.registerContactCommands(this),k.registerCommunicationsCommands(this),this.register("liveshare.end",q.endCommandBuilder),this.register("liveshare.endFromFileTreeExplorer",q.endCommandBuilder),this.register("liveshare.endFromActivityBar",q.endCommandBuilder),this.register("liveshare.leave",B.leaveCommandBuilder),this.register("liveshare.leaveFromActivityBar",B.leaveCommandBuilder),this.register("liveshare.leaveFromFileTreeExplorer",B.leaveCommandBuilder),this.register("liveshare.workbench.dispose",B.leaveCommandBuilder),this.register("liveshare.signin.token",W.builder),this.isNode&&(this.register("listPlannedSessions",O.ListPlannedSessionsCommandBuilder),this.register("createPlannedSession",O.CreatePlannedSessionCommandBuilder),this.register("createPlannedSessionFromActivityBar",O.CreatePlannedSessionCommandBuilder),this.register("createPlannedSessionFromFileTreeExplorer",O.CreatePlannedSessionCommandBuilder),this.register("deletePlannedSession",O.DeletePlannedSessionCommandBuilder),this.register("deletePlannedSessionFromFileTreeExplorer",O.DeletePlannedSessionCommandBuilder),this.register("renamePlannedSession",O.RenamePlannedSessionCommandBuilder),this.register("copyPlannedSessionLink",O.CopyPlannedSessionLinkCommandBuilder),this.register("joinPlannedSession",O.JoinPlannedSessionCommandBuilder))}}},function(h,m,y){"use strict";h.exports=function init(h){}},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0});var v=y(747);m.BrowserConsoleTraceListener=v.BrowserConsoleTraceListener;var C=y(333);m.ConsoleTraceListener=C.ConsoleTraceListener;var T=y(768);m.OutputTraceListener=T.OutputTraceListener;var w=y(769);m.MemoryTraceListener=w.MemoryTraceListener},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0});const v=y(117),C=y(331),T=y(333);class BrowserConsoleTraceListener extends T.ConsoleTraceListener{constructor(h=new C.DebugConsoleLogger){super(h)}writeEvent(h,m,y,C,...T){switch(m){case v.LogLevel.Critical:case v.LogLevel.Error:return this.consoleReference.error(h,C,...T);case v.LogLevel.Warning:return this.consoleReference.warn(h,C,...T);case v.LogLevel.Debug:return this.consoleReference.debug?this.consoleReference.debug(h,C,...T):this.consoleReference.info(h,C,...T);default:return this.consoleReference.info(h,C,...T)}}}m.BrowserConsoleTraceListener=BrowserConsoleTraceListener},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0});const v=y(749);class DebugConsoleLogger{constructor(h=globalThis.console){this.console=h,this.tracesCache={},this.createTrace=(h,m,y)=>{const C=`${h}:${m}`,T=this.tracesCache[C];if(T)return T;const w=v.default(C);return w.log=y,this.tracesCache[C]=w,w},this.log=(h,m,...y)=>this.info(h,m,...y),this.info=(h,m,...y)=>{this.createTrace(h,"info",this.console.info)(m,...y)},this.debug=(h,m,...y)=>{const v=this.console.debug?this.console.debug:this.console.log;this.createTrace(h,"trace",v)(m,...y)},this.warn=(h,m,...y)=>{this.createTrace(h,"warn",this.console.warn)(h,m,...y)},this.error=(h,m,...y)=>{this.createTrace(h,"error",this.console.error)(h,m,...y)}}}m.DebugConsoleLogger=DebugConsoleLogger,DebugConsoleLogger.enable=h=>{v.default.enable(h)}},function(h,m,y){"undefined"==typeof process||"renderer"===process.type||!0===process.browser||process.__nwjs?h.exports=y(750):h.exports=y(752)},function(h,m,y){m.formatArgs=function formatArgs(m){if(m[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+m[0]+(this.useColors?"%c ":" ")+"+"+h.exports.humanize(this.diff),!this.useColors)return;const y="color: "+this.color;m.splice(1,0,y,"color: inherit");let v=0,C=0;m[0].replace(/%[a-zA-Z%]/g,h=>{"%%"!==h&&(v++,"%c"===h&&(C=v))}),m.splice(C,0,y)},m.save=function save(h){try{h?m.storage.setItem("debug",h):m.storage.removeItem("debug")}catch(h){}},m.load=function load(){let h;try{h=m.storage.getItem("debug")}catch(h){}!h&&"undefined"!=typeof process&&"env"in process&&(h=process.env.DEBUG);return h},m.useColors=function useColors(){if("undefined"!=typeof window&&window.process&&("renderer"===window.process.type||window.process.__nwjs))return!0;if("undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/))return!1;return"undefined"!=typeof document&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||"undefined"!=typeof window&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)},m.storage=function localstorage(){try{return localStorage}catch(h){}}(),m.destroy=(()=>{let h=!1;return()=>{h||(h=!0,console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`."))}})(),m.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"],m.log=console.debug||console.log||(()=>{}),h.exports=y(332)(m);const{formatters:v}=h.exports;v.j=function(h){try{return JSON.stringify(h)}catch(h){return"[UnexpectedJSONParseError]: "+h.message}}},function(h,m){var y=1e3,v=6e4,C=60*v,T=24*C;function plural(h,m,y,v){var C=m>=1.5*y;return Math.round(h/y)+" "+v+(C?"s":"")}h.exports=function(h,m){m=m||{};var w=typeof h;if("string"===w&&h.length>0)return function parse(h){if((h=String(h)).length>100)return;var m=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(h);if(!m)return;var w=parseFloat(m[1]);switch((m[2]||"ms").toLowerCase()){case"years":case"year":case"yrs":case"yr":case"y":return 315576e5*w;case"weeks":case"week":case"w":return 6048e5*w;case"days":case"day":case"d":return w*T;case"hours":case"hour":case"hrs":case"hr":case"h":return w*C;case"minutes":case"minute":case"mins":case"min":case"m":return w*v;case"seconds":case"second":case"secs":case"sec":case"s":return w*y;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return w;default:return}}(h);if("number"===w&&isFinite(h))return m.long?function fmtLong(h){var m=Math.abs(h);if(m>=T)return plural(h,m,T,"day");if(m>=C)return plural(h,m,C,"hour");if(m>=v)return plural(h,m,v,"minute");if(m>=y)return plural(h,m,y,"second");return h+" ms"}(h):function fmtShort(h){var m=Math.abs(h);if(m>=T)return Math.round(h/T)+"d";if(m>=C)return Math.round(h/C)+"h";if(m>=v)return Math.round(h/v)+"m";if(m>=y)return Math.round(h/y)+"s";return h+"ms"}(h);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(h))}},function(h,m,y){const v=y(88),C=y(10);m.init=function init(h){h.inspectOpts={};const y=Object.keys(m.inspectOpts);for(let v=0;v<y.length;v++)h.inspectOpts[y[v]]=m.inspectOpts[y[v]]},m.log=function log(...h){return process.stderr.write(C.format(...h)+"\n")},m.formatArgs=function formatArgs(y){const{namespace:v,useColors:C}=this;if(C){const m=this.color,C="[3"+(m<8?m:"8;5;"+m),T=`  ${C};1m${v} [0m`;y[0]=T+y[0].split("\n").join("\n"+T),y.push(C+"m+"+h.exports.humanize(this.diff)+"[0m")}else y[0]=function getDate(){if(m.inspectOpts.hideDate)return"";return(new Date).toISOString()+" "}()+v+" "+y[0]},m.save=function save(h){h?process.env.DEBUG=h:delete process.env.DEBUG},m.load=function load(){return process.env.DEBUG},m.useColors=function useColors(){return"colors"in m.inspectOpts?Boolean(m.inspectOpts.colors):v.isatty(process.stderr.fd)},m.destroy=C.deprecate(()=>{},"Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`."),m.colors=[6,2,3,4,5,1];try{const h=y(753);h&&(h.stderr||h).level>=2&&(m.colors=[20,21,26,27,32,33,38,39,40,41,42,43,44,45,56,57,62,63,68,69,74,75,76,77,78,79,80,81,92,93,98,99,112,113,128,129,134,135,148,149,160,161,162,163,164,165,166,167,168,169,170,171,172,173,178,179,184,185,196,197,198,199,200,201,202,203,204,205,206,207,208,209,214,215,220,221])}catch(h){}m.inspectOpts=Object.keys(process.env).filter(h=>/^debug_/i.test(h)).reduce((h,m)=>{const y=m.substring(6).toLowerCase().replace(/_([a-z])/g,(h,m)=>m.toUpperCase());let v=process.env[m];return v=!!/^(yes|on|true|enabled)$/i.test(v)||!/^(no|off|false|disabled)$/i.test(v)&&("null"===v?null:Number(v)),h[y]=v,h},{}),h.exports=y(332)(m);const{formatters:T}=h.exports;T.o=function(h){return this.inspectOpts.colors=this.useColors,C.inspect(h,this.inspectOpts).split("\n").map(h=>h.trim()).join(" ")},T.O=function(h){return this.inspectOpts.colors=this.useColors,C.inspect(h,this.inspectOpts)}},function(h,m,y){"use strict";const v=y(18),C=y(88),T=y(754),{env:w}=process;let A;function translateLevel(h){return 0!==h&&{level:h,hasBasic:!0,has256:h>=2,has16m:h>=3}}function supportsColor(h,m){if(0===A)return 0;if(T("color=16m")||T("color=full")||T("color=truecolor"))return 3;if(T("color=256"))return 2;if(h&&!m&&void 0===A)return 0;const y=A||0;if("dumb"===w.TERM)return y;if("win32"===process.platform){const h=v.release().split(".");return Number(h[0])>=10&&Number(h[2])>=10586?Number(h[2])>=14931?3:2:1}if("CI"in w)return["TRAVIS","CIRCLECI","APPVEYOR","GITLAB_CI"].some(h=>h in w)||"codeship"===w.CI_NAME?1:y;if("TEAMCITY_VERSION"in w)return/^(9\.(0*[1-9]\d*)\.|\d{2,}\.)/.test(w.TEAMCITY_VERSION)?1:0;if("GITHUB_ACTIONS"in w)return 1;if("truecolor"===w.COLORTERM)return 3;if("TERM_PROGRAM"in w){const h=parseInt((w.TERM_PROGRAM_VERSION||"").split(".")[0],10);switch(w.TERM_PROGRAM){case"iTerm.app":return h>=3?3:2;case"Apple_Terminal":return 2}}return/-256(color)?$/i.test(w.TERM)?2:/^screen|^xterm|^vt100|^vt220|^rxvt|color|ansi|cygwin|linux/i.test(w.TERM)||"COLORTERM"in w?1:y}T("no-color")||T("no-colors")||T("color=false")||T("color=never")?A=0:(T("color")||T("colors")||T("color=true")||T("color=always"))&&(A=1),"FORCE_COLOR"in w&&(A="true"===w.FORCE_COLOR?1:"false"===w.FORCE_COLOR?0:0===w.FORCE_COLOR.length?1:Math.min(parseInt(w.FORCE_COLOR,10),3)),h.exports={supportsColor:function getSupportLevel(h){return translateLevel(supportsColor(h,h&&h.isTTY))},stdout:translateLevel(supportsColor(!0,C.isatty(1))),stderr:translateLevel(supportsColor(!0,C.isatty(2)))}},function(h,m,y){"use strict";h.exports=(h,m=process.argv)=>{const y=h.startsWith("-")?"":1===h.length?"-":"--",v=m.indexOf(y+h),C=m.indexOf("--");return-1!==v&&(-1===C||v<C)}},function(h,m,y){var v;!function(C){"use strict";var T,w,A,P=(T=/d{1,4}|m{1,4}|yy(?:yy)?|([HhMsTt])\1?|[LloSZWN]|"[^"]*"|'[^']*'/g,w=/\b(?:[PMCEA][SDP]T|(?:Pacific|Mountain|Central|Eastern|Atlantic) (?:Standard|Daylight|Prevailing) Time|(?:GMT|UTC)(?:[-+]\d{4})?)\b/g,A=/[^-+\dA-Z]/g,function(h,m,y,v){if(1!==arguments.length||"string"!==kindOf(h)||/\d/.test(h)||(m=h,h=void 0),(h=h||new Date)instanceof Date||(h=new Date(h)),isNaN(h))throw TypeError("Invalid date");var C=(m=String(P.masks[m]||m||P.masks.default)).slice(0,4);"UTC:"!==C&&"GMT:"!==C||(m=m.slice(4),y=!0,"GMT:"===C&&(v=!0));var k=y?"getUTC":"get",R=h[k+"Date"](),M=h[k+"Day"](),N=h[k+"Month"](),D=h[k+"FullYear"](),I=h[k+"Hours"](),x=h[k+"Minutes"](),O=h[k+"Seconds"](),L=h[k+"Milliseconds"](),U=y?0:h.getTimezoneOffset(),B=getWeek(h),W=getDayOfWeek(h),q={d:R,dd:pad(R),ddd:P.i18n.dayNames[M],dddd:P.i18n.dayNames[M+7],m:N+1,mm:pad(N+1),mmm:P.i18n.monthNames[N],mmmm:P.i18n.monthNames[N+12],yy:String(D).slice(2),yyyy:D,h:I%12||12,hh:pad(I%12||12),H:I,HH:pad(I),M:x,MM:pad(x),s:O,ss:pad(O),l:pad(L,3),L:pad(Math.round(L/10)),t:I<12?P.i18n.timeNames[0]:P.i18n.timeNames[1],tt:I<12?P.i18n.timeNames[2]:P.i18n.timeNames[3],T:I<12?P.i18n.timeNames[4]:P.i18n.timeNames[5],TT:I<12?P.i18n.timeNames[6]:P.i18n.timeNames[7],Z:v?"GMT":y?"UTC":(String(h).match(w)||[""]).pop().replace(A,""),o:(U>0?"-":"+")+pad(100*Math.floor(Math.abs(U)/60)+Math.abs(U)%60,4),S:["th","st","nd","rd"][R%10>3?0:(R%100-R%10!=10)*R%10],W:B,N:W};return m.replace(T,(function(h){return h in q?q[h]:h.slice(1,h.length-1)}))});function pad(h,m){for(h=String(h),m=m||2;h.length<m;)h="0"+h;return h}function getWeek(h){var m=new Date(h.getFullYear(),h.getMonth(),h.getDate());m.setDate(m.getDate()-(m.getDay()+6)%7+3);var y=new Date(m.getFullYear(),0,4);y.setDate(y.getDate()-(y.getDay()+6)%7+3);var v=m.getTimezoneOffset()-y.getTimezoneOffset();m.setHours(m.getHours()-v);var C=(m-y)/6048e5;return 1+Math.floor(C)}function getDayOfWeek(h){var m=h.getDay();return 0===m&&(m=7),m}function kindOf(h){return null===h?"null":void 0===h?"undefined":"object"!=typeof h?typeof h:Array.isArray(h)?"array":{}.toString.call(h).slice(8,-1).toLowerCase()}P.masks={default:"ddd mmm dd yyyy HH:MM:ss",shortDate:"m/d/yy",mediumDate:"mmm d, yyyy",longDate:"mmmm d, yyyy",fullDate:"dddd, mmmm d, yyyy",shortTime:"h:MM TT",mediumTime:"h:MM:ss TT",longTime:"h:MM:ss TT Z",isoDate:"yyyy-mm-dd",isoTime:"HH:MM:ss",isoDateTime:"yyyy-mm-dd'T'HH:MM:sso",isoUtcDateTime:"UTC:yyyy-mm-dd'T'HH:MM:ss'Z'",expiresHeaderFormat:"ddd, dd mmm yyyy HH:MM:ss Z"},P.i18n={dayNames:["Sun","Mon","Tue","Wed","Thu","Fri","Sat","Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],monthNames:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec","January","February","March","April","May","June","July","August","September","October","November","December"],timeNames:["a","p","am","pm","A","P","AM","PM"]},void 0===(v=function(){return P}.call(m,y,m,h))||(h.exports=v)}()},function(module,exports,__webpack_require__){var __WEBPACK_AMD_DEFINE_RESULT__;
/**
 * [js-sha256]{@link https://github.com/emn178/js-sha256}
 *
 * @version 0.9.0
 * @author Chen, Yi-Cyuan [emn178@gmail.com]
 * @copyright Chen, Yi-Cyuan 2014-2017
 * @license MIT
 */!function(){"use strict";var ERROR="input is invalid type",WINDOW="object"==typeof window,root=WINDOW?window:{};root.JS_SHA256_NO_WINDOW&&(WINDOW=!1);var WEB_WORKER=!WINDOW&&"object"==typeof self,NODE_JS=!root.JS_SHA256_NO_NODE_JS&&"object"==typeof process&&process.versions&&process.versions.node;NODE_JS?root=global:WEB_WORKER&&(root=self);var COMMON_JS=!root.JS_SHA256_NO_COMMON_JS&&"object"==typeof module&&module.exports,AMD=__webpack_require__(757),ARRAY_BUFFER=!root.JS_SHA256_NO_ARRAY_BUFFER&&"undefined"!=typeof ArrayBuffer,HEX_CHARS="0123456789abcdef".split(""),EXTRA=[-2147483648,8388608,32768,128],SHIFT=[24,16,8,0],K=[1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298],OUTPUT_TYPES=["hex","array","digest","arrayBuffer"],blocks=[];!root.JS_SHA256_NO_NODE_JS&&Array.isArray||(Array.isArray=function(h){return"[object Array]"===Object.prototype.toString.call(h)}),!ARRAY_BUFFER||!root.JS_SHA256_NO_ARRAY_BUFFER_IS_VIEW&&ArrayBuffer.isView||(ArrayBuffer.isView=function(h){return"object"==typeof h&&h.buffer&&h.buffer.constructor===ArrayBuffer});var createOutputMethod=function(h,m){return function(y){return new Sha256(m,!0).update(y)[h]()}},createMethod=function(h){var m=createOutputMethod("hex",h);NODE_JS&&(m=nodeWrap(m,h)),m.create=function(){return new Sha256(h)},m.update=function(h){return m.create().update(h)};for(var y=0;y<OUTPUT_TYPES.length;++y){var v=OUTPUT_TYPES[y];m[v]=createOutputMethod(v,h)}return m},nodeWrap=function(method,is224){var crypto=eval("require('crypto')"),Buffer=eval("require('buffer').Buffer"),algorithm=is224?"sha224":"sha256",nodeMethod=function(h){if("string"==typeof h)return crypto.createHash(algorithm).update(h,"utf8").digest("hex");if(null==h)throw new Error(ERROR);return h.constructor===ArrayBuffer&&(h=new Uint8Array(h)),Array.isArray(h)||ArrayBuffer.isView(h)||h.constructor===Buffer?crypto.createHash(algorithm).update(new Buffer(h)).digest("hex"):method(h)};return nodeMethod},createHmacOutputMethod=function(h,m){return function(y,v){return new HmacSha256(y,m,!0).update(v)[h]()}},createHmacMethod=function(h){var m=createHmacOutputMethod("hex",h);m.create=function(m){return new HmacSha256(m,h)},m.update=function(h,y){return m.create(h).update(y)};for(var y=0;y<OUTPUT_TYPES.length;++y){var v=OUTPUT_TYPES[y];m[v]=createHmacOutputMethod(v,h)}return m};function Sha256(h,m){m?(blocks[0]=blocks[16]=blocks[1]=blocks[2]=blocks[3]=blocks[4]=blocks[5]=blocks[6]=blocks[7]=blocks[8]=blocks[9]=blocks[10]=blocks[11]=blocks[12]=blocks[13]=blocks[14]=blocks[15]=0,this.blocks=blocks):this.blocks=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],h?(this.h0=3238371032,this.h1=914150663,this.h2=812702999,this.h3=4144912697,this.h4=4290775857,this.h5=1750603025,this.h6=1694076839,this.h7=3204075428):(this.h0=1779033703,this.h1=3144134277,this.h2=1013904242,this.h3=2773480762,this.h4=1359893119,this.h5=2600822924,this.h6=528734635,this.h7=1541459225),this.block=this.start=this.bytes=this.hBytes=0,this.finalized=this.hashed=!1,this.first=!0,this.is224=h}function HmacSha256(h,m,y){var v,C=typeof h;if("string"===C){var T,w=[],A=h.length,P=0;for(v=0;v<A;++v)(T=h.charCodeAt(v))<128?w[P++]=T:T<2048?(w[P++]=192|T>>6,w[P++]=128|63&T):T<55296||T>=57344?(w[P++]=224|T>>12,w[P++]=128|T>>6&63,w[P++]=128|63&T):(T=65536+((1023&T)<<10|1023&h.charCodeAt(++v)),w[P++]=240|T>>18,w[P++]=128|T>>12&63,w[P++]=128|T>>6&63,w[P++]=128|63&T);h=w}else{if("object"!==C)throw new Error(ERROR);if(null===h)throw new Error(ERROR);if(ARRAY_BUFFER&&h.constructor===ArrayBuffer)h=new Uint8Array(h);else if(!(Array.isArray(h)||ARRAY_BUFFER&&ArrayBuffer.isView(h)))throw new Error(ERROR)}h.length>64&&(h=new Sha256(m,!0).update(h).array());var k=[],R=[];for(v=0;v<64;++v){var M=h[v]||0;k[v]=92^M,R[v]=54^M}Sha256.call(this,m,y),this.update(R),this.oKeyPad=k,this.inner=!0,this.sharedMemory=y}Sha256.prototype.update=function(h){if(!this.finalized){var m,y=typeof h;if("string"!==y){if("object"!==y)throw new Error(ERROR);if(null===h)throw new Error(ERROR);if(ARRAY_BUFFER&&h.constructor===ArrayBuffer)h=new Uint8Array(h);else if(!(Array.isArray(h)||ARRAY_BUFFER&&ArrayBuffer.isView(h)))throw new Error(ERROR);m=!0}for(var v,C,T=0,w=h.length,A=this.blocks;T<w;){if(this.hashed&&(this.hashed=!1,A[0]=this.block,A[16]=A[1]=A[2]=A[3]=A[4]=A[5]=A[6]=A[7]=A[8]=A[9]=A[10]=A[11]=A[12]=A[13]=A[14]=A[15]=0),m)for(C=this.start;T<w&&C<64;++T)A[C>>2]|=h[T]<<SHIFT[3&C++];else for(C=this.start;T<w&&C<64;++T)(v=h.charCodeAt(T))<128?A[C>>2]|=v<<SHIFT[3&C++]:v<2048?(A[C>>2]|=(192|v>>6)<<SHIFT[3&C++],A[C>>2]|=(128|63&v)<<SHIFT[3&C++]):v<55296||v>=57344?(A[C>>2]|=(224|v>>12)<<SHIFT[3&C++],A[C>>2]|=(128|v>>6&63)<<SHIFT[3&C++],A[C>>2]|=(128|63&v)<<SHIFT[3&C++]):(v=65536+((1023&v)<<10|1023&h.charCodeAt(++T)),A[C>>2]|=(240|v>>18)<<SHIFT[3&C++],A[C>>2]|=(128|v>>12&63)<<SHIFT[3&C++],A[C>>2]|=(128|v>>6&63)<<SHIFT[3&C++],A[C>>2]|=(128|63&v)<<SHIFT[3&C++]);this.lastByteIndex=C,this.bytes+=C-this.start,C>=64?(this.block=A[16],this.start=C-64,this.hash(),this.hashed=!0):this.start=C}return this.bytes>4294967295&&(this.hBytes+=this.bytes/4294967296<<0,this.bytes=this.bytes%4294967296),this}},Sha256.prototype.finalize=function(){if(!this.finalized){this.finalized=!0;var h=this.blocks,m=this.lastByteIndex;h[16]=this.block,h[m>>2]|=EXTRA[3&m],this.block=h[16],m>=56&&(this.hashed||this.hash(),h[0]=this.block,h[16]=h[1]=h[2]=h[3]=h[4]=h[5]=h[6]=h[7]=h[8]=h[9]=h[10]=h[11]=h[12]=h[13]=h[14]=h[15]=0),h[14]=this.hBytes<<3|this.bytes>>>29,h[15]=this.bytes<<3,this.hash()}},Sha256.prototype.hash=function(){var h,m,y,v,C,T,w,A,P,k=this.h0,R=this.h1,M=this.h2,N=this.h3,D=this.h4,I=this.h5,x=this.h6,O=this.h7,L=this.blocks;for(h=16;h<64;++h)m=((C=L[h-15])>>>7|C<<25)^(C>>>18|C<<14)^C>>>3,y=((C=L[h-2])>>>17|C<<15)^(C>>>19|C<<13)^C>>>10,L[h]=L[h-16]+m+L[h-7]+y<<0;for(P=R&M,h=0;h<64;h+=4)this.first?(this.is224?(T=300032,O=(C=L[0]-1413257819)-150054599<<0,N=C+24177077<<0):(T=704751109,O=(C=L[0]-210244248)-1521486534<<0,N=C+143694565<<0),this.first=!1):(m=(k>>>2|k<<30)^(k>>>13|k<<19)^(k>>>22|k<<10),v=(T=k&R)^k&M^P,O=N+(C=O+(y=(D>>>6|D<<26)^(D>>>11|D<<21)^(D>>>25|D<<7))+(D&I^~D&x)+K[h]+L[h])<<0,N=C+(m+v)<<0),m=(N>>>2|N<<30)^(N>>>13|N<<19)^(N>>>22|N<<10),v=(w=N&k)^N&R^T,x=M+(C=x+(y=(O>>>6|O<<26)^(O>>>11|O<<21)^(O>>>25|O<<7))+(O&D^~O&I)+K[h+1]+L[h+1])<<0,m=((M=C+(m+v)<<0)>>>2|M<<30)^(M>>>13|M<<19)^(M>>>22|M<<10),v=(A=M&N)^M&k^w,I=R+(C=I+(y=(x>>>6|x<<26)^(x>>>11|x<<21)^(x>>>25|x<<7))+(x&O^~x&D)+K[h+2]+L[h+2])<<0,m=((R=C+(m+v)<<0)>>>2|R<<30)^(R>>>13|R<<19)^(R>>>22|R<<10),v=(P=R&M)^R&N^A,D=k+(C=D+(y=(I>>>6|I<<26)^(I>>>11|I<<21)^(I>>>25|I<<7))+(I&x^~I&O)+K[h+3]+L[h+3])<<0,k=C+(m+v)<<0;this.h0=this.h0+k<<0,this.h1=this.h1+R<<0,this.h2=this.h2+M<<0,this.h3=this.h3+N<<0,this.h4=this.h4+D<<0,this.h5=this.h5+I<<0,this.h6=this.h6+x<<0,this.h7=this.h7+O<<0},Sha256.prototype.hex=function(){this.finalize();var h=this.h0,m=this.h1,y=this.h2,v=this.h3,C=this.h4,T=this.h5,w=this.h6,A=this.h7,P=HEX_CHARS[h>>28&15]+HEX_CHARS[h>>24&15]+HEX_CHARS[h>>20&15]+HEX_CHARS[h>>16&15]+HEX_CHARS[h>>12&15]+HEX_CHARS[h>>8&15]+HEX_CHARS[h>>4&15]+HEX_CHARS[15&h]+HEX_CHARS[m>>28&15]+HEX_CHARS[m>>24&15]+HEX_CHARS[m>>20&15]+HEX_CHARS[m>>16&15]+HEX_CHARS[m>>12&15]+HEX_CHARS[m>>8&15]+HEX_CHARS[m>>4&15]+HEX_CHARS[15&m]+HEX_CHARS[y>>28&15]+HEX_CHARS[y>>24&15]+HEX_CHARS[y>>20&15]+HEX_CHARS[y>>16&15]+HEX_CHARS[y>>12&15]+HEX_CHARS[y>>8&15]+HEX_CHARS[y>>4&15]+HEX_CHARS[15&y]+HEX_CHARS[v>>28&15]+HEX_CHARS[v>>24&15]+HEX_CHARS[v>>20&15]+HEX_CHARS[v>>16&15]+HEX_CHARS[v>>12&15]+HEX_CHARS[v>>8&15]+HEX_CHARS[v>>4&15]+HEX_CHARS[15&v]+HEX_CHARS[C>>28&15]+HEX_CHARS[C>>24&15]+HEX_CHARS[C>>20&15]+HEX_CHARS[C>>16&15]+HEX_CHARS[C>>12&15]+HEX_CHARS[C>>8&15]+HEX_CHARS[C>>4&15]+HEX_CHARS[15&C]+HEX_CHARS[T>>28&15]+HEX_CHARS[T>>24&15]+HEX_CHARS[T>>20&15]+HEX_CHARS[T>>16&15]+HEX_CHARS[T>>12&15]+HEX_CHARS[T>>8&15]+HEX_CHARS[T>>4&15]+HEX_CHARS[15&T]+HEX_CHARS[w>>28&15]+HEX_CHARS[w>>24&15]+HEX_CHARS[w>>20&15]+HEX_CHARS[w>>16&15]+HEX_CHARS[w>>12&15]+HEX_CHARS[w>>8&15]+HEX_CHARS[w>>4&15]+HEX_CHARS[15&w];return this.is224||(P+=HEX_CHARS[A>>28&15]+HEX_CHARS[A>>24&15]+HEX_CHARS[A>>20&15]+HEX_CHARS[A>>16&15]+HEX_CHARS[A>>12&15]+HEX_CHARS[A>>8&15]+HEX_CHARS[A>>4&15]+HEX_CHARS[15&A]),P},Sha256.prototype.toString=Sha256.prototype.hex,Sha256.prototype.digest=function(){this.finalize();var h=this.h0,m=this.h1,y=this.h2,v=this.h3,C=this.h4,T=this.h5,w=this.h6,A=this.h7,P=[h>>24&255,h>>16&255,h>>8&255,255&h,m>>24&255,m>>16&255,m>>8&255,255&m,y>>24&255,y>>16&255,y>>8&255,255&y,v>>24&255,v>>16&255,v>>8&255,255&v,C>>24&255,C>>16&255,C>>8&255,255&C,T>>24&255,T>>16&255,T>>8&255,255&T,w>>24&255,w>>16&255,w>>8&255,255&w];return this.is224||P.push(A>>24&255,A>>16&255,A>>8&255,255&A),P},Sha256.prototype.array=Sha256.prototype.digest,Sha256.prototype.arrayBuffer=function(){this.finalize();var h=new ArrayBuffer(this.is224?28:32),m=new DataView(h);return m.setUint32(0,this.h0),m.setUint32(4,this.h1),m.setUint32(8,this.h2),m.setUint32(12,this.h3),m.setUint32(16,this.h4),m.setUint32(20,this.h5),m.setUint32(24,this.h6),this.is224||m.setUint32(28,this.h7),h},HmacSha256.prototype=new Sha256,HmacSha256.prototype.finalize=function(){if(Sha256.prototype.finalize.call(this),this.inner){this.inner=!1;var h=this.array();Sha256.call(this,this.is224,this.sharedMemory),this.update(this.oKeyPad),this.update(h),Sha256.prototype.finalize.call(this)}};var exports=createMethod();exports.sha256=exports,exports.sha224=createMethod(!0),exports.sha256.hmac=createHmacMethod(),exports.sha224.hmac=createHmacMethod(!0),COMMON_JS?module.exports=exports:(root.sha256=exports.sha256,root.sha224=exports.sha224,AMD&&(__WEBPACK_AMD_DEFINE_RESULT__=function(){return exports}.call(exports,__webpack_require__,exports,module),void 0===__WEBPACK_AMD_DEFINE_RESULT__||(module.exports=__WEBPACK_AMD_DEFINE_RESULT__)))}()},function(h,m){(function(m){h.exports=m}).call(this,{})},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0});const v=y(759);m.errorToString=function errorToString(h){if(!h)return null;let m=h.message||"Unknown error";const y=h.code;y&&(m+=" code:"+y);let C=null;if(h.vslsStack)try{C=h.vslsStack.map(h=>"  at "+v.wrapCallSite(h)).join("\n")}catch(h){}return C||(C=h.stack||null),C&&(m+="\n"+C),m}},function(h,m,y){var v,C=y(760).SourceMapConsumer,T=y(7);try{(v=y(21)).existsSync&&v.readFileSync||(v=null)}catch(h){}var w=y(767),A=!1,P=!1,k=!1,R="auto",M={},N={},D=/^data:application\/json[^,]+base64,/,I=[],x=[];function isInBrowser(){return"browser"===R||"node"!==R&&("undefined"!=typeof window&&"function"==typeof XMLHttpRequest&&!(window.require&&window.module&&window.process&&"renderer"===window.process.type))}function handlerExec(h){return function(m){for(var y=0;y<h.length;y++){var v=h[y](m);if(v)return v}return null}}var O=handlerExec(I);function supportRelativeURL(h,m){if(!h)return m;var y=T.dirname(h),v=/^\w+:\/\/[^\/]*/.exec(y),C=v?v[0]:"",w=y.slice(C.length);return C&&/^\/\w\:/.test(w)?(C+="/")+T.resolve(y.slice(C.length),m).replace(/\\/g,"/"):C+T.resolve(y.slice(C.length),m)}I.push((function(h){if(h=h.trim(),/^file:/.test(h)&&(h=h.replace(/file:\/\/\/(\w:)?/,(function(h,m){return m?"":"/"}))),h in M)return M[h];var m="";try{if(v)v.existsSync(h)&&(m=v.readFileSync(h,"utf8"));else{var y=new XMLHttpRequest;y.open("GET",h,!1),y.send(null),4===y.readyState&&200===y.status&&(m=y.responseText)}}catch(h){}return M[h]=m}));var L=handlerExec(x);function mapSourcePosition(h){var m=N[h.source];if(!m){var y=L(h.source);y?(m=N[h.source]={url:y.url,map:new C(y.map)}).map.sourcesContent&&m.map.sources.forEach((function(h,y){var v=m.map.sourcesContent[y];if(v){var C=supportRelativeURL(m.url,h);M[C]=v}})):m=N[h.source]={url:null,map:null}}if(m&&m.map&&"function"==typeof m.map.originalPositionFor){var v=m.map.originalPositionFor(h);if(null!==v.source)return v.source=supportRelativeURL(m.url,v.source),v}return h}function CallSiteToString(){var h,m="";if(this.isNative())m="native";else{!(h=this.getScriptNameOrSourceURL())&&this.isEval()&&(m=this.getEvalOrigin(),m+=", "),m+=h||"<anonymous>";var y=this.getLineNumber();if(null!=y){m+=":"+y;var v=this.getColumnNumber();v&&(m+=":"+v)}}var C="",T=this.getFunctionName(),w=!0,A=this.isConstructor();if(!(this.isToplevel()||A)){var P=this.getTypeName();"[object Object]"===P&&(P="null");var k=this.getMethodName();T?(P&&0!=T.indexOf(P)&&(C+=P+"."),C+=T,k&&T.indexOf("."+k)!=T.length-k.length-1&&(C+=" [as "+k+"]")):C+=P+"."+(k||"<anonymous>")}else A?C+="new "+(T||"<anonymous>"):T?C+=T:(C+=m,w=!1);return w&&(C+=" ("+m+")"),C}function cloneCallSite(h){var m={};return Object.getOwnPropertyNames(Object.getPrototypeOf(h)).forEach((function(y){m[y]=/^(?:is|get)/.test(y)?function(){return h[y].call(h)}:h[y]})),m.toString=CallSiteToString,m}function wrapCallSite(h,m){if(void 0===m&&(m={nextPosition:null,curPosition:null}),h.isNative())return m.curPosition=null,h;var y=h.getFileName()||h.getScriptNameOrSourceURL();if(y){var v=h.getLineNumber(),C=h.getColumnNumber()-1,T=/^v(10\.1[6-9]|10\.[2-9][0-9]|10\.[0-9]{3,}|1[2-9]\d*|[2-9]\d|\d{3,}|11\.11)/.test(process.version)?0:62;1===v&&C>T&&!isInBrowser()&&!h.isEval()&&(C-=T);var w=mapSourcePosition({source:y,line:v,column:C});m.curPosition=w;var A=(h=cloneCallSite(h)).getFunctionName;return h.getFunctionName=function(){return null==m.nextPosition?A():m.nextPosition.name||A()},h.getFileName=function(){return w.source},h.getLineNumber=function(){return w.line},h.getColumnNumber=function(){return w.column+1},h.getScriptNameOrSourceURL=function(){return w.source},h}var P=h.isEval()&&h.getEvalOrigin();return P?(P=function mapEvalOrigin(h){var m=/^eval at ([^(]+) \((.+):(\d+):(\d+)\)$/.exec(h);if(m){var y=mapSourcePosition({source:m[2],line:+m[3],column:m[4]-1});return"eval at "+m[1]+" ("+y.source+":"+y.line+":"+(y.column+1)+")"}return(m=/^eval at ([^(]+) \((.+)\)$/.exec(h))?"eval at "+m[1]+" ("+mapEvalOrigin(m[2])+")":h}(P),(h=cloneCallSite(h)).getEvalOrigin=function(){return P},h):h}function prepareStackTrace(h,m){k&&(M={},N={});for(var y=(h.name||"Error")+": "+(h.message||""),v={nextPosition:null,curPosition:null},C=[],T=m.length-1;T>=0;T--)C.push("\n    at "+wrapCallSite(m[T],v)),v.nextPosition=v.curPosition;return v.curPosition=v.nextPosition=null,y+C.reverse().join("")}function getErrorSource(h){var m=/\n    at [^(]+ \((.*):(\d+):(\d+)\)/.exec(h.stack);if(m){var y=m[1],C=+m[2],T=+m[3],w=M[y];if(!w&&v&&v.existsSync(y))try{w=v.readFileSync(y,"utf8")}catch(h){w=""}if(w){var A=w.split(/(?:\r\n|\r|\n)/)[C-1];if(A)return y+":"+C+"\n"+A+"\n"+new Array(T).join(" ")+"^"}}return null}function printErrorAndExit(h){var m=getErrorSource(h);process.stderr._handle&&process.stderr._handle.setBlocking&&process.stderr._handle.setBlocking(!0),m&&(console.error(),console.error(m)),console.error(h.stack),process.exit(1)}x.push((function(h){var m,y=function retrieveSourceMapURL(h){var m;if(isInBrowser())try{var y=new XMLHttpRequest;y.open("GET",h,!1),y.send(null),m=4===y.readyState?y.responseText:null;var v=y.getResponseHeader("SourceMap")||y.getResponseHeader("X-SourceMap");if(v)return v}catch(h){}m=O(h);for(var C,T,w=/(?:\/\/[@#][\s]*sourceMappingURL=([^\s'"]+)[\s]*$)|(?:\/\*[@#][\s]*sourceMappingURL=([^\s*'"]+)[\s]*(?:\*\/)[\s]*$)/gm;T=w.exec(m);)C=T;return C?C[1]:null}(h);if(!y)return null;if(D.test(y)){var v=y.slice(y.indexOf(",")+1);m=w(v,"base64").toString(),y=h}else y=supportRelativeURL(h,y),m=O(y);return m?{url:y,map:m}:null}));var U=I.slice(0),B=x.slice(0);m.wrapCallSite=wrapCallSite,m.getErrorSource=getErrorSource,m.mapSourcePosition=mapSourcePosition,m.retrieveSourceMap=L,m.install=function(h){if((h=h||{}).environment&&(R=h.environment,-1===["node","browser","auto"].indexOf(R)))throw new Error("environment "+R+" was unknown. Available options are {auto, browser, node}");if(h.retrieveFile&&(h.overrideRetrieveFile&&(I.length=0),I.unshift(h.retrieveFile)),h.retrieveSourceMap&&(h.overrideRetrieveSourceMap&&(x.length=0),x.unshift(h.retrieveSourceMap)),h.hookRequire&&!isInBrowser()){var m;try{m=y(203)}catch(h){}var v=m.prototype._compile;v.__sourceMapSupport||(m.prototype._compile=function(h,m){return M[m]=h,N[m]=void 0,v.call(this,h,m)},m.prototype._compile.__sourceMapSupport=!0)}(k||(k="emptyCacheBetweenOperations"in h&&h.emptyCacheBetweenOperations),A||(A=!0,Error.prepareStackTrace=prepareStackTrace),P)||(!("handleUncaughtExceptions"in h)||h.handleUncaughtExceptions)&&function hasGlobalProcessEventEmitter(){return"object"==typeof process&&null!==process&&"function"==typeof process.on}()&&(P=!0,function shimEmitUncaughtException(){var h=process.emit;process.emit=function(m){if("uncaughtException"===m){var y=arguments[1]&&arguments[1].stack,v=this.listeners(m).length>0;if(y&&!v)return printErrorAndExit(arguments[1])}return h.apply(this,arguments)}}())},m.resetRetrieveHandlers=function(){I.length=0,x.length=0,I=U.slice(0),x=B.slice(0),L=handlerExec(x),O=handlerExec(I)}},function(h,m,y){m.SourceMapGenerator=y(337).SourceMapGenerator,m.SourceMapConsumer=y(763).SourceMapConsumer,m.SourceNode=y(766).SourceNode},function(h,m){var y="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".split("");m.encode=function(h){if(0<=h&&h<y.length)return y[h];throw new TypeError("Must be between 0 and 63: "+h)},m.decode=function(h){return 65<=h&&h<=90?h-65:97<=h&&h<=122?h-97+26:48<=h&&h<=57?h-48+52:43==h?62:47==h?63:-1}},function(h,m,y){var v=y(119);function MappingList(){this._array=[],this._sorted=!0,this._last={generatedLine:-1,generatedColumn:0}}MappingList.prototype.unsortedForEach=function MappingList_forEach(h,m){this._array.forEach(h,m)},MappingList.prototype.add=function MappingList_add(h){!function generatedPositionAfter(h,m){var y=h.generatedLine,C=m.generatedLine,T=h.generatedColumn,w=m.generatedColumn;return C>y||C==y&&w>=T||v.compareByGeneratedPositionsInflated(h,m)<=0}(this._last,h)?(this._sorted=!1,this._array.push(h)):(this._last=h,this._array.push(h))},MappingList.prototype.toArray=function MappingList_toArray(){return this._sorted||(this._array.sort(v.compareByGeneratedPositionsInflated),this._sorted=!0),this._array},m.MappingList=MappingList},function(h,m,y){var v=y(119),C=y(764),T=y(339).ArraySet,w=y(338),A=y(765).quickSort;function SourceMapConsumer(h,m){var y=h;return"string"==typeof h&&(y=v.parseSourceMapInput(h)),null!=y.sections?new IndexedSourceMapConsumer(y,m):new BasicSourceMapConsumer(y,m)}function BasicSourceMapConsumer(h,m){var y=h;"string"==typeof h&&(y=v.parseSourceMapInput(h));var C=v.getArg(y,"version"),w=v.getArg(y,"sources"),A=v.getArg(y,"names",[]),P=v.getArg(y,"sourceRoot",null),k=v.getArg(y,"sourcesContent",null),R=v.getArg(y,"mappings"),M=v.getArg(y,"file",null);if(C!=this._version)throw new Error("Unsupported version: "+C);P&&(P=v.normalize(P)),w=w.map(String).map(v.normalize).map((function(h){return P&&v.isAbsolute(P)&&v.isAbsolute(h)?v.relative(P,h):h})),this._names=T.fromArray(A.map(String),!0),this._sources=T.fromArray(w,!0),this._absoluteSources=this._sources.toArray().map((function(h){return v.computeSourceURL(P,h,m)})),this.sourceRoot=P,this.sourcesContent=k,this._mappings=R,this._sourceMapURL=m,this.file=M}function Mapping(){this.generatedLine=0,this.generatedColumn=0,this.source=null,this.originalLine=null,this.originalColumn=null,this.name=null}function IndexedSourceMapConsumer(h,m){var y=h;"string"==typeof h&&(y=v.parseSourceMapInput(h));var C=v.getArg(y,"version"),w=v.getArg(y,"sections");if(C!=this._version)throw new Error("Unsupported version: "+C);this._sources=new T,this._names=new T;var A={line:-1,column:0};this._sections=w.map((function(h){if(h.url)throw new Error("Support for url field in sections not implemented.");var y=v.getArg(h,"offset"),C=v.getArg(y,"line"),T=v.getArg(y,"column");if(C<A.line||C===A.line&&T<A.column)throw new Error("Section offsets must be ordered and non-overlapping.");return A=y,{generatedOffset:{generatedLine:C+1,generatedColumn:T+1},consumer:new SourceMapConsumer(v.getArg(h,"map"),m)}}))}SourceMapConsumer.fromSourceMap=function(h,m){return BasicSourceMapConsumer.fromSourceMap(h,m)},SourceMapConsumer.prototype._version=3,SourceMapConsumer.prototype.__generatedMappings=null,Object.defineProperty(SourceMapConsumer.prototype,"_generatedMappings",{configurable:!0,enumerable:!0,get:function(){return this.__generatedMappings||this._parseMappings(this._mappings,this.sourceRoot),this.__generatedMappings}}),SourceMapConsumer.prototype.__originalMappings=null,Object.defineProperty(SourceMapConsumer.prototype,"_originalMappings",{configurable:!0,enumerable:!0,get:function(){return this.__originalMappings||this._parseMappings(this._mappings,this.sourceRoot),this.__originalMappings}}),SourceMapConsumer.prototype._charIsMappingSeparator=function SourceMapConsumer_charIsMappingSeparator(h,m){var y=h.charAt(m);return";"===y||","===y},SourceMapConsumer.prototype._parseMappings=function SourceMapConsumer_parseMappings(h,m){throw new Error("Subclasses must implement _parseMappings")},SourceMapConsumer.GENERATED_ORDER=1,SourceMapConsumer.ORIGINAL_ORDER=2,SourceMapConsumer.GREATEST_LOWER_BOUND=1,SourceMapConsumer.LEAST_UPPER_BOUND=2,SourceMapConsumer.prototype.eachMapping=function SourceMapConsumer_eachMapping(h,m,y){var C,T=m||null;switch(y||SourceMapConsumer.GENERATED_ORDER){case SourceMapConsumer.GENERATED_ORDER:C=this._generatedMappings;break;case SourceMapConsumer.ORIGINAL_ORDER:C=this._originalMappings;break;default:throw new Error("Unknown order of iteration.")}var w=this.sourceRoot;C.map((function(h){var m=null===h.source?null:this._sources.at(h.source);return{source:m=v.computeSourceURL(w,m,this._sourceMapURL),generatedLine:h.generatedLine,generatedColumn:h.generatedColumn,originalLine:h.originalLine,originalColumn:h.originalColumn,name:null===h.name?null:this._names.at(h.name)}}),this).forEach(h,T)},SourceMapConsumer.prototype.allGeneratedPositionsFor=function SourceMapConsumer_allGeneratedPositionsFor(h){var m=v.getArg(h,"line"),y={source:v.getArg(h,"source"),originalLine:m,originalColumn:v.getArg(h,"column",0)};if(y.source=this._findSourceIndex(y.source),y.source<0)return[];var T=[],w=this._findMapping(y,this._originalMappings,"originalLine","originalColumn",v.compareByOriginalPositions,C.LEAST_UPPER_BOUND);if(w>=0){var A=this._originalMappings[w];if(void 0===h.column)for(var P=A.originalLine;A&&A.originalLine===P;)T.push({line:v.getArg(A,"generatedLine",null),column:v.getArg(A,"generatedColumn",null),lastColumn:v.getArg(A,"lastGeneratedColumn",null)}),A=this._originalMappings[++w];else for(var k=A.originalColumn;A&&A.originalLine===m&&A.originalColumn==k;)T.push({line:v.getArg(A,"generatedLine",null),column:v.getArg(A,"generatedColumn",null),lastColumn:v.getArg(A,"lastGeneratedColumn",null)}),A=this._originalMappings[++w]}return T},m.SourceMapConsumer=SourceMapConsumer,BasicSourceMapConsumer.prototype=Object.create(SourceMapConsumer.prototype),BasicSourceMapConsumer.prototype.consumer=SourceMapConsumer,BasicSourceMapConsumer.prototype._findSourceIndex=function(h){var m,y=h;if(null!=this.sourceRoot&&(y=v.relative(this.sourceRoot,y)),this._sources.has(y))return this._sources.indexOf(y);for(m=0;m<this._absoluteSources.length;++m)if(this._absoluteSources[m]==h)return m;return-1},BasicSourceMapConsumer.fromSourceMap=function SourceMapConsumer_fromSourceMap(h,m){var y=Object.create(BasicSourceMapConsumer.prototype),C=y._names=T.fromArray(h._names.toArray(),!0),w=y._sources=T.fromArray(h._sources.toArray(),!0);y.sourceRoot=h._sourceRoot,y.sourcesContent=h._generateSourcesContent(y._sources.toArray(),y.sourceRoot),y.file=h._file,y._sourceMapURL=m,y._absoluteSources=y._sources.toArray().map((function(h){return v.computeSourceURL(y.sourceRoot,h,m)}));for(var P=h._mappings.toArray().slice(),k=y.__generatedMappings=[],R=y.__originalMappings=[],M=0,N=P.length;M<N;M++){var D=P[M],I=new Mapping;I.generatedLine=D.generatedLine,I.generatedColumn=D.generatedColumn,D.source&&(I.source=w.indexOf(D.source),I.originalLine=D.originalLine,I.originalColumn=D.originalColumn,D.name&&(I.name=C.indexOf(D.name)),R.push(I)),k.push(I)}return A(y.__originalMappings,v.compareByOriginalPositions),y},BasicSourceMapConsumer.prototype._version=3,Object.defineProperty(BasicSourceMapConsumer.prototype,"sources",{get:function(){return this._absoluteSources.slice()}}),BasicSourceMapConsumer.prototype._parseMappings=function SourceMapConsumer_parseMappings(h,m){for(var y,C,T,P,k,R=1,M=0,N=0,D=0,I=0,x=0,O=h.length,L=0,U={},B={},W=[],q=[];L<O;)if(";"===h.charAt(L))R++,L++,M=0;else if(","===h.charAt(L))L++;else{for((y=new Mapping).generatedLine=R,P=L;P<O&&!this._charIsMappingSeparator(h,P);P++);if(T=U[C=h.slice(L,P)])L+=C.length;else{for(T=[];L<P;)w.decode(h,L,B),k=B.value,L=B.rest,T.push(k);if(2===T.length)throw new Error("Found a source, but no line and column");if(3===T.length)throw new Error("Found a source and line, but no column");U[C]=T}y.generatedColumn=M+T[0],M=y.generatedColumn,T.length>1&&(y.source=I+T[1],I+=T[1],y.originalLine=N+T[2],N=y.originalLine,y.originalLine+=1,y.originalColumn=D+T[3],D=y.originalColumn,T.length>4&&(y.name=x+T[4],x+=T[4])),q.push(y),"number"==typeof y.originalLine&&W.push(y)}A(q,v.compareByGeneratedPositionsDeflated),this.__generatedMappings=q,A(W,v.compareByOriginalPositions),this.__originalMappings=W},BasicSourceMapConsumer.prototype._findMapping=function SourceMapConsumer_findMapping(h,m,y,v,T,w){if(h[y]<=0)throw new TypeError("Line must be greater than or equal to 1, got "+h[y]);if(h[v]<0)throw new TypeError("Column must be greater than or equal to 0, got "+h[v]);return C.search(h,m,T,w)},BasicSourceMapConsumer.prototype.computeColumnSpans=function SourceMapConsumer_computeColumnSpans(){for(var h=0;h<this._generatedMappings.length;++h){var m=this._generatedMappings[h];if(h+1<this._generatedMappings.length){var y=this._generatedMappings[h+1];if(m.generatedLine===y.generatedLine){m.lastGeneratedColumn=y.generatedColumn-1;continue}}m.lastGeneratedColumn=1/0}},BasicSourceMapConsumer.prototype.originalPositionFor=function SourceMapConsumer_originalPositionFor(h){var m={generatedLine:v.getArg(h,"line"),generatedColumn:v.getArg(h,"column")},y=this._findMapping(m,this._generatedMappings,"generatedLine","generatedColumn",v.compareByGeneratedPositionsDeflated,v.getArg(h,"bias",SourceMapConsumer.GREATEST_LOWER_BOUND));if(y>=0){var C=this._generatedMappings[y];if(C.generatedLine===m.generatedLine){var T=v.getArg(C,"source",null);null!==T&&(T=this._sources.at(T),T=v.computeSourceURL(this.sourceRoot,T,this._sourceMapURL));var w=v.getArg(C,"name",null);return null!==w&&(w=this._names.at(w)),{source:T,line:v.getArg(C,"originalLine",null),column:v.getArg(C,"originalColumn",null),name:w}}}return{source:null,line:null,column:null,name:null}},BasicSourceMapConsumer.prototype.hasContentsOfAllSources=function BasicSourceMapConsumer_hasContentsOfAllSources(){return!!this.sourcesContent&&(this.sourcesContent.length>=this._sources.size()&&!this.sourcesContent.some((function(h){return null==h})))},BasicSourceMapConsumer.prototype.sourceContentFor=function SourceMapConsumer_sourceContentFor(h,m){if(!this.sourcesContent)return null;var y=this._findSourceIndex(h);if(y>=0)return this.sourcesContent[y];var C,T=h;if(null!=this.sourceRoot&&(T=v.relative(this.sourceRoot,T)),null!=this.sourceRoot&&(C=v.urlParse(this.sourceRoot))){var w=T.replace(/^file:\/\//,"");if("file"==C.scheme&&this._sources.has(w))return this.sourcesContent[this._sources.indexOf(w)];if((!C.path||"/"==C.path)&&this._sources.has("/"+T))return this.sourcesContent[this._sources.indexOf("/"+T)]}if(m)return null;throw new Error('"'+T+'" is not in the SourceMap.')},BasicSourceMapConsumer.prototype.generatedPositionFor=function SourceMapConsumer_generatedPositionFor(h){var m=v.getArg(h,"source");if((m=this._findSourceIndex(m))<0)return{line:null,column:null,lastColumn:null};var y={source:m,originalLine:v.getArg(h,"line"),originalColumn:v.getArg(h,"column")},C=this._findMapping(y,this._originalMappings,"originalLine","originalColumn",v.compareByOriginalPositions,v.getArg(h,"bias",SourceMapConsumer.GREATEST_LOWER_BOUND));if(C>=0){var T=this._originalMappings[C];if(T.source===y.source)return{line:v.getArg(T,"generatedLine",null),column:v.getArg(T,"generatedColumn",null),lastColumn:v.getArg(T,"lastGeneratedColumn",null)}}return{line:null,column:null,lastColumn:null}},m.BasicSourceMapConsumer=BasicSourceMapConsumer,IndexedSourceMapConsumer.prototype=Object.create(SourceMapConsumer.prototype),IndexedSourceMapConsumer.prototype.constructor=SourceMapConsumer,IndexedSourceMapConsumer.prototype._version=3,Object.defineProperty(IndexedSourceMapConsumer.prototype,"sources",{get:function(){for(var h=[],m=0;m<this._sections.length;m++)for(var y=0;y<this._sections[m].consumer.sources.length;y++)h.push(this._sections[m].consumer.sources[y]);return h}}),IndexedSourceMapConsumer.prototype.originalPositionFor=function IndexedSourceMapConsumer_originalPositionFor(h){var m={generatedLine:v.getArg(h,"line"),generatedColumn:v.getArg(h,"column")},y=C.search(m,this._sections,(function(h,m){var y=h.generatedLine-m.generatedOffset.generatedLine;return y||h.generatedColumn-m.generatedOffset.generatedColumn})),T=this._sections[y];return T?T.consumer.originalPositionFor({line:m.generatedLine-(T.generatedOffset.generatedLine-1),column:m.generatedColumn-(T.generatedOffset.generatedLine===m.generatedLine?T.generatedOffset.generatedColumn-1:0),bias:h.bias}):{source:null,line:null,column:null,name:null}},IndexedSourceMapConsumer.prototype.hasContentsOfAllSources=function IndexedSourceMapConsumer_hasContentsOfAllSources(){return this._sections.every((function(h){return h.consumer.hasContentsOfAllSources()}))},IndexedSourceMapConsumer.prototype.sourceContentFor=function IndexedSourceMapConsumer_sourceContentFor(h,m){for(var y=0;y<this._sections.length;y++){var v=this._sections[y].consumer.sourceContentFor(h,!0);if(v)return v}if(m)return null;throw new Error('"'+h+'" is not in the SourceMap.')},IndexedSourceMapConsumer.prototype.generatedPositionFor=function IndexedSourceMapConsumer_generatedPositionFor(h){for(var m=0;m<this._sections.length;m++){var y=this._sections[m];if(-1!==y.consumer._findSourceIndex(v.getArg(h,"source"))){var C=y.consumer.generatedPositionFor(h);if(C)return{line:C.line+(y.generatedOffset.generatedLine-1),column:C.column+(y.generatedOffset.generatedLine===C.line?y.generatedOffset.generatedColumn-1:0)}}}return{line:null,column:null}},IndexedSourceMapConsumer.prototype._parseMappings=function IndexedSourceMapConsumer_parseMappings(h,m){this.__generatedMappings=[],this.__originalMappings=[];for(var y=0;y<this._sections.length;y++)for(var C=this._sections[y],T=C.consumer._generatedMappings,w=0;w<T.length;w++){var P=T[w],k=C.consumer._sources.at(P.source);k=v.computeSourceURL(C.consumer.sourceRoot,k,this._sourceMapURL),this._sources.add(k),k=this._sources.indexOf(k);var R=null;P.name&&(R=C.consumer._names.at(P.name),this._names.add(R),R=this._names.indexOf(R));var M={source:k,generatedLine:P.generatedLine+(C.generatedOffset.generatedLine-1),generatedColumn:P.generatedColumn+(C.generatedOffset.generatedLine===P.generatedLine?C.generatedOffset.generatedColumn-1:0),originalLine:P.originalLine,originalColumn:P.originalColumn,name:R};this.__generatedMappings.push(M),"number"==typeof M.originalLine&&this.__originalMappings.push(M)}A(this.__generatedMappings,v.compareByGeneratedPositionsDeflated),A(this.__originalMappings,v.compareByOriginalPositions)},m.IndexedSourceMapConsumer=IndexedSourceMapConsumer},function(h,m){m.GREATEST_LOWER_BOUND=1,m.LEAST_UPPER_BOUND=2,m.search=function search(h,y,v,C){if(0===y.length)return-1;var T=function recursiveSearch(h,y,v,C,T,w){var A=Math.floor((y-h)/2)+h,P=T(v,C[A],!0);return 0===P?A:P>0?y-A>1?recursiveSearch(A,y,v,C,T,w):w==m.LEAST_UPPER_BOUND?y<C.length?y:-1:A:A-h>1?recursiveSearch(h,A,v,C,T,w):w==m.LEAST_UPPER_BOUND?A:h<0?-1:h}(-1,y.length,h,y,v,C||m.GREATEST_LOWER_BOUND);if(T<0)return-1;for(;T-1>=0&&0===v(y[T],y[T-1],!0);)--T;return T}},function(h,m){function swap(h,m,y){var v=h[m];h[m]=h[y],h[y]=v}function doQuickSort(h,m,y,v){if(y<v){var C=y-1;swap(h,function randomIntInRange(h,m){return Math.round(h+Math.random()*(m-h))}(y,v),v);for(var T=h[v],w=y;w<v;w++)m(h[w],T)<=0&&swap(h,C+=1,w);swap(h,C+1,w);var A=C+1;doQuickSort(h,m,y,A-1),doQuickSort(h,m,A+1,v)}}m.quickSort=function(h,m){doQuickSort(h,m,0,h.length-1)}},function(h,m,y){var v=y(337).SourceMapGenerator,C=y(119),T=/(\r?\n)/,w="$$$isSourceNode$$$";function SourceNode(h,m,y,v,C){this.children=[],this.sourceContents={},this.line=null==h?null:h,this.column=null==m?null:m,this.source=null==y?null:y,this.name=null==C?null:C,this[w]=!0,null!=v&&this.add(v)}SourceNode.fromStringWithSourceMap=function SourceNode_fromStringWithSourceMap(h,m,y){var v=new SourceNode,w=h.split(T),A=0,shiftNextLine=function(){return getNextLine()+(getNextLine()||"");function getNextLine(){return A<w.length?w[A++]:void 0}},P=1,k=0,R=null;return m.eachMapping((function(h){if(null!==R){if(!(P<h.generatedLine)){var m=(y=w[A]||"").substr(0,h.generatedColumn-k);return w[A]=y.substr(h.generatedColumn-k),k=h.generatedColumn,addMappingWithCode(R,m),void(R=h)}addMappingWithCode(R,shiftNextLine()),P++,k=0}for(;P<h.generatedLine;)v.add(shiftNextLine()),P++;if(k<h.generatedColumn){var y=w[A]||"";v.add(y.substr(0,h.generatedColumn)),w[A]=y.substr(h.generatedColumn),k=h.generatedColumn}R=h}),this),A<w.length&&(R&&addMappingWithCode(R,shiftNextLine()),v.add(w.splice(A).join(""))),m.sources.forEach((function(h){var T=m.sourceContentFor(h);null!=T&&(null!=y&&(h=C.join(y,h)),v.setSourceContent(h,T))})),v;function addMappingWithCode(h,m){if(null===h||void 0===h.source)v.add(m);else{var T=y?C.join(y,h.source):h.source;v.add(new SourceNode(h.originalLine,h.originalColumn,T,m,h.name))}}},SourceNode.prototype.add=function SourceNode_add(h){if(Array.isArray(h))h.forEach((function(h){this.add(h)}),this);else{if(!h[w]&&"string"!=typeof h)throw new TypeError("Expected a SourceNode, string, or an array of SourceNodes and strings. Got "+h);h&&this.children.push(h)}return this},SourceNode.prototype.prepend=function SourceNode_prepend(h){if(Array.isArray(h))for(var m=h.length-1;m>=0;m--)this.prepend(h[m]);else{if(!h[w]&&"string"!=typeof h)throw new TypeError("Expected a SourceNode, string, or an array of SourceNodes and strings. Got "+h);this.children.unshift(h)}return this},SourceNode.prototype.walk=function SourceNode_walk(h){for(var m,y=0,v=this.children.length;y<v;y++)(m=this.children[y])[w]?m.walk(h):""!==m&&h(m,{source:this.source,line:this.line,column:this.column,name:this.name})},SourceNode.prototype.join=function SourceNode_join(h){var m,y,v=this.children.length;if(v>0){for(m=[],y=0;y<v-1;y++)m.push(this.children[y]),m.push(h);m.push(this.children[y]),this.children=m}return this},SourceNode.prototype.replaceRight=function SourceNode_replaceRight(h,m){var y=this.children[this.children.length-1];return y[w]?y.replaceRight(h,m):"string"==typeof y?this.children[this.children.length-1]=y.replace(h,m):this.children.push("".replace(h,m)),this},SourceNode.prototype.setSourceContent=function SourceNode_setSourceContent(h,m){this.sourceContents[C.toSetString(h)]=m},SourceNode.prototype.walkSourceContents=function SourceNode_walkSourceContents(h){for(var m=0,y=this.children.length;m<y;m++)this.children[m][w]&&this.children[m].walkSourceContents(h);var v=Object.keys(this.sourceContents);for(m=0,y=v.length;m<y;m++)h(C.fromSetString(v[m]),this.sourceContents[v[m]])},SourceNode.prototype.toString=function SourceNode_toString(){var h="";return this.walk((function(m){h+=m})),h},SourceNode.prototype.toStringWithSourceMap=function SourceNode_toStringWithSourceMap(h){var m={code:"",line:1,column:0},y=new v(h),C=!1,T=null,w=null,A=null,P=null;return this.walk((function(h,v){m.code+=h,null!==v.source&&null!==v.line&&null!==v.column?(T===v.source&&w===v.line&&A===v.column&&P===v.name||y.addMapping({source:v.source,original:{line:v.line,column:v.column},generated:{line:m.line,column:m.column},name:v.name}),T=v.source,w=v.line,A=v.column,P=v.name,C=!0):C&&(y.addMapping({generated:{line:m.line,column:m.column}}),T=null,C=!1);for(var k=0,R=h.length;k<R;k++)10===h.charCodeAt(k)?(m.line++,m.column=0,k+1===R?(T=null,C=!1):C&&y.addMapping({source:v.source,original:{line:v.line,column:v.column},generated:{line:m.line,column:m.column},name:v.name})):m.column++})),this.walkSourceContents((function(h,m){y.setSourceContent(h,m)})),{code:m.code,map:y}},m.SourceNode=SourceNode},function(h,m){var y=Object.prototype.toString,v="function"==typeof Buffer.alloc&&"function"==typeof Buffer.allocUnsafe&&"function"==typeof Buffer.from;h.exports=function bufferFrom(h,m,C){if("number"==typeof h)throw new TypeError('"value" argument must not be a number');return function isArrayBuffer(h){return"ArrayBuffer"===y.call(h).slice(8,-1)}(h)?function fromArrayBuffer(h,m,y){m>>>=0;var C=h.byteLength-m;if(C<0)throw new RangeError("'offset' is out of bounds");if(void 0===y)y=C;else if((y>>>=0)>C)throw new RangeError("'length' is out of bounds");return v?Buffer.from(h.slice(m,m+y)):new Buffer(new Uint8Array(h.slice(m,m+y)))}(h,m,C):"string"==typeof h?function fromString(h,m){if("string"==typeof m&&""!==m||(m="utf8"),!Buffer.isEncoding(m))throw new TypeError('"encoding" must be a valid string encoding');return v?Buffer.from(h,m):new Buffer(h,m)}(h,m):v?Buffer.from(h):new Buffer(h)}},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0});const v=y(118),C=y(150);class OutputTraceListener extends C.TraceListener{constructor(h,m){super(),this.includeTimestamp=m,this.channel=null,this.channelName=h}writeTo(h){null!=this.channel&&this.channel.appendLine(h)}writeEvent(h,m,y,C,...T){const w=v.TraceFormat.formatEvent(this.includeTimestamp?new Date:null,h,m,y,C,...T);this.writeTo(w)}addOutputChannel(h){if(null!=this.channel)return;const m=y(0);this.channel=m.window.createOutputChannel(this.channelName),h&&this.channel.show(!0)}removeOutputChannel(){null!=this.channel&&(this.channel.clear(),this.channel.dispose(),this.channel=null)}}m.OutputTraceListener=OutputTraceListener},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0});const v=y(118),C=y(150);class MemoryTraceListener extends C.TraceListener{constructor(h){super(),this.allLogs=[],this.logsByLevel=new Map,this.maxLogSize=h||128}getLogs(h){if(h){const m=this.logsByLevel.get(h);return m?m.map(h=>h):[]}return this.allLogs.map(h=>h)}writeTo(h){this.addLine(h)}addLine(h,m){if(this.allLogs.push(h),this.allLogs.length>this.maxLogSize&&this.allLogs.splice(0,1),m){const y=this.logsByLevel.get(m);y?(y.push(h),y.length>this.maxLogSize&&y.splice(0,1)):this.logsByLevel.set(m,[h])}}writeEvent(h,m,y,C,...T){const w=v.TraceFormat.formatEvent(new Date,h,m,y,C,...T);this.addLine(w,m)}}m.MemoryTraceListener=MemoryTraceListener},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0});var v=y(771);m.ConsoleLoggerMock=v.ConsoleLoggerMock},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0});const v={info:()=>{},log:()=>{},debug:()=>{},warn:()=>{},error:()=>{}};m.ConsoleLoggerMock=class ConsoleLoggerMock{constructor(h={}){this.log=(...h)=>{throw new Error("The `log` method is not implemented")},this.info=(...h)=>{throw new Error("The `info` method is not implemented")},this.debug=(...h)=>{throw new Error("The `debug` method is not implemented")},this.warn=(...h)=>{throw new Error("The `warn` method is not implemented")},this.error=(...h)=>{throw new Error("The `error` method is not implemented")},this.optionsWithDefaults=Object.assign(Object.assign({},v),h),this.log=this.optionsWithDefaults.log,this.info=this.optionsWithDefaults.info,this.warn=this.optionsWithDefaults.warn,this.debug=this.optionsWithDefaults.debug,this.error=this.optionsWithDefaults.error}}},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0});const v=y(773),C=y(201);if(m.GlobPatternTraceFilter=class GlobPatternTraceFilter{constructor(h){this.globToVerbosity=h,this.traceSourceVerbosityCache=new Map}getTraceVerbosity(h){let m=this.traceSourceVerbosityCache.get(h);if(void 0===m){if(m=0,this.globToVerbosity)for(let y in this.globToVerbosity)v(h,y)&&(m=C.LogLevel[this.globToVerbosity[y]]);this.traceSourceVerbosityCache.set(h,m)}return m}shouldTrace(h,m,y){return this.getTraceVerbosity(h)<=m}},"function"==typeof Error.prepareStackTrace){const h=Error.prepareStackTrace;Error.prepareStackTrace=function prepareVslsStack(m,y){return m.vslsStack=y,h(m,y)}}},function(h,m,y){h.exports=minimatch,minimatch.Minimatch=Minimatch;var v={sep:"/"};try{v=y(7)}catch(h){}var C=minimatch.GLOBSTAR=Minimatch.GLOBSTAR={},T=y(774),w={"!":{open:"(?:(?!(?:",close:"))[^/]*?)"},"?":{open:"(?:",close:")?"},"+":{open:"(?:",close:")+"},"*":{open:"(?:",close:")*"},"@":{open:"(?:",close:")"}},A=function charSet(h){return h.split("").reduce((function(h,m){return h[m]=!0,h}),{})}("().*{}+?[]^$\\!");var P=/\/+/;function ext(h,m){h=h||{},m=m||{};var y={};return Object.keys(m).forEach((function(h){y[h]=m[h]})),Object.keys(h).forEach((function(m){y[m]=h[m]})),y}function minimatch(h,m,y){if("string"!=typeof m)throw new TypeError("glob pattern string required");return y||(y={}),!(!y.nocomment&&"#"===m.charAt(0))&&(""===m.trim()?""===h:new Minimatch(m,y).match(h))}function Minimatch(h,m){if(!(this instanceof Minimatch))return new Minimatch(h,m);if("string"!=typeof h)throw new TypeError("glob pattern string required");m||(m={}),h=h.trim(),"/"!==v.sep&&(h=h.split(v.sep).join("/")),this.options=m,this.set=[],this.pattern=h,this.regexp=null,this.negate=!1,this.comment=!1,this.empty=!1,this.make()}function braceExpand(h,m){if(m||(m=this instanceof Minimatch?this.options:{}),void 0===(h=void 0===h?this.pattern:h))throw new TypeError("undefined pattern");return m.nobrace||!h.match(/\{.*\}/)?[h]:T(h)}minimatch.filter=function filter(h,m){return m=m||{},function(y,v,C){return minimatch(y,h,m)}},minimatch.defaults=function(h){if(!h||!Object.keys(h).length)return minimatch;var m=minimatch,y=function minimatch(y,v,C){return m.minimatch(y,v,ext(h,C))};return y.Minimatch=function Minimatch(y,v){return new m.Minimatch(y,ext(h,v))},y},Minimatch.defaults=function(h){return h&&Object.keys(h).length?minimatch.defaults(h).Minimatch:Minimatch},Minimatch.prototype.debug=function(){},Minimatch.prototype.make=function make(){if(this._made)return;var h=this.pattern,m=this.options;if(!m.nocomment&&"#"===h.charAt(0))return void(this.comment=!0);if(!h)return void(this.empty=!0);this.parseNegate();var y=this.globSet=this.braceExpand();m.debug&&(this.debug=console.error);this.debug(this.pattern,y),y=this.globParts=y.map((function(h){return h.split(P)})),this.debug(this.pattern,y),y=y.map((function(h,m,y){return h.map(this.parse,this)}),this),this.debug(this.pattern,y),y=y.filter((function(h){return-1===h.indexOf(!1)})),this.debug(this.pattern,y),this.set=y},Minimatch.prototype.parseNegate=function parseNegate(){var h=this.pattern,m=!1,y=this.options,v=0;if(y.nonegate)return;for(var C=0,T=h.length;C<T&&"!"===h.charAt(C);C++)m=!m,v++;v&&(this.pattern=h.substr(v));this.negate=m},minimatch.braceExpand=function(h,m){return braceExpand(h,m)},Minimatch.prototype.braceExpand=braceExpand,Minimatch.prototype.parse=function parse(h,m){if(h.length>65536)throw new TypeError("pattern is too long");var y=this.options;if(!y.noglobstar&&"**"===h)return C;if(""===h)return"";var v,T="",P=!!y.nocase,R=!1,M=[],N=[],D=!1,I=-1,x=-1,O="."===h.charAt(0)?"":y.dot?"(?!(?:^|\\/)\\.{1,2}(?:$|\\/))":"(?!\\.)",L=this;function clearStateChar(){if(v){switch(v){case"*":T+="[^/]*?",P=!0;break;case"?":T+="[^/]",P=!0;break;default:T+="\\"+v}L.debug("clearStateChar %j %j",v,T),v=!1}}for(var U,B=0,W=h.length;B<W&&(U=h.charAt(B));B++)if(this.debug("%s\t%s %s %j",h,B,T,U),R&&A[U])T+="\\"+U,R=!1;else switch(U){case"/":return!1;case"\\":clearStateChar(),R=!0;continue;case"?":case"*":case"+":case"@":case"!":if(this.debug("%s\t%s %s %j <-- stateChar",h,B,T,U),D){this.debug("  in class"),"!"===U&&B===x+1&&(U="^"),T+=U;continue}L.debug("call clearStateChar %j",v),clearStateChar(),v=U,y.noext&&clearStateChar();continue;case"(":if(D){T+="(";continue}if(!v){T+="\\(";continue}M.push({type:v,start:B-1,reStart:T.length,open:w[v].open,close:w[v].close}),T+="!"===v?"(?:(?!(?:":"(?:",this.debug("plType %j %j",v,T),v=!1;continue;case")":if(D||!M.length){T+="\\)";continue}clearStateChar(),P=!0;var q=M.pop();T+=q.close,"!"===q.type&&N.push(q),q.reEnd=T.length;continue;case"|":if(D||!M.length||R){T+="\\|",R=!1;continue}clearStateChar(),T+="|";continue;case"[":if(clearStateChar(),D){T+="\\"+U;continue}D=!0,x=B,I=T.length,T+=U;continue;case"]":if(B===x+1||!D){T+="\\"+U,R=!1;continue}if(D){var Y=h.substring(x+1,B);try{RegExp("["+Y+"]")}catch(h){var V=this.parse(Y,k);T=T.substr(0,I)+"\\["+V[0]+"\\]",P=P||V[1],D=!1;continue}}P=!0,D=!1,T+=U;continue;default:clearStateChar(),R?R=!1:!A[U]||"^"===U&&D||(T+="\\"),T+=U}D&&(Y=h.substr(x+1),V=this.parse(Y,k),T=T.substr(0,I)+"\\["+V[0],P=P||V[1]);for(q=M.pop();q;q=M.pop()){var $=T.slice(q.reStart+q.open.length);this.debug("setting tail",T,q),$=$.replace(/((?:\\{2}){0,64})(\\?)\|/g,(function(h,m,y){return y||(y="\\"),m+m+y+"|"})),this.debug("tail=%j\n   %s",$,$,q,T);var z="*"===q.type?"[^/]*?":"?"===q.type?"[^/]":"\\"+q.type;P=!0,T=T.slice(0,q.reStart)+z+"\\("+$}clearStateChar(),R&&(T+="\\\\");var G=!1;switch(T.charAt(0)){case".":case"[":case"(":G=!0}for(var J=N.length-1;J>-1;J--){var X=N[J],Z=T.slice(0,X.reStart),ee=T.slice(X.reStart,X.reEnd-8),te=T.slice(X.reEnd-8,X.reEnd),re=T.slice(X.reEnd);te+=re;var ie=Z.split("(").length-1,se=re;for(B=0;B<ie;B++)se=se.replace(/\)[+*?]?/,"");var oe="";""===(re=se)&&m!==k&&(oe="$"),T=Z+ee+re+oe+te}""!==T&&P&&(T="(?=.)"+T);G&&(T=O+T);if(m===k)return[T,P];if(!P)return function globUnescape(h){return h.replace(/\\(.)/g,"$1")}(h);var ae=y.nocase?"i":"";try{var ce=new RegExp("^"+T+"$",ae)}catch(h){return new RegExp("$.")}return ce._glob=h,ce._src=T,ce};var k={};minimatch.makeRe=function(h,m){return new Minimatch(h,m||{}).makeRe()},Minimatch.prototype.makeRe=function makeRe(){if(this.regexp||!1===this.regexp)return this.regexp;var h=this.set;if(!h.length)return this.regexp=!1,this.regexp;var m=this.options,y=m.noglobstar?"[^/]*?":m.dot?"(?:(?!(?:\\/|^)(?:\\.{1,2})($|\\/)).)*?":"(?:(?!(?:\\/|^)\\.).)*?",v=m.nocase?"i":"",T=h.map((function(h){return h.map((function(h){return h===C?y:"string"==typeof h?function regExpEscape(h){return h.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&")}(h):h._src})).join("\\/")})).join("|");T="^(?:"+T+")$",this.negate&&(T="^(?!"+T+").*$");try{this.regexp=new RegExp(T,v)}catch(h){this.regexp=!1}return this.regexp},minimatch.match=function(h,m,y){var v=new Minimatch(m,y=y||{});return h=h.filter((function(h){return v.match(h)})),v.options.nonull&&!h.length&&h.push(m),h},Minimatch.prototype.match=function match(h,m){if(this.debug("match",h,this.pattern),this.comment)return!1;if(this.empty)return""===h;if("/"===h&&m)return!0;var y=this.options;"/"!==v.sep&&(h=h.split(v.sep).join("/"));h=h.split(P),this.debug(this.pattern,"split",h);var C,T,w=this.set;for(this.debug(this.pattern,"set",w),T=h.length-1;T>=0&&!(C=h[T]);T--);for(T=0;T<w.length;T++){var A=w[T],k=h;if(y.matchBase&&1===A.length&&(k=[C]),this.matchOne(k,A,m))return!!y.flipNegate||!this.negate}return!y.flipNegate&&this.negate},Minimatch.prototype.matchOne=function(h,m,y){var v=this.options;this.debug("matchOne",{this:this,file:h,pattern:m}),this.debug("matchOne",h.length,m.length);for(var T=0,w=0,A=h.length,P=m.length;T<A&&w<P;T++,w++){this.debug("matchOne loop");var k,R=m[w],M=h[T];if(this.debug(m,R,M),!1===R)return!1;if(R===C){this.debug("GLOBSTAR",[m,R,M]);var N=T,D=w+1;if(D===P){for(this.debug("** at the end");T<A;T++)if("."===h[T]||".."===h[T]||!v.dot&&"."===h[T].charAt(0))return!1;return!0}for(;N<A;){var I=h[N];if(this.debug("\nglobstar while",h,N,m,D,I),this.matchOne(h.slice(N),m.slice(D),y))return this.debug("globstar found match!",N,A,I),!0;if("."===I||".."===I||!v.dot&&"."===I.charAt(0)){this.debug("dot detected!",h,N,m,D);break}this.debug("globstar swallow a segment, and continue"),N++}return!(!y||(this.debug("\n>>> no match, partial?",h,N,m,D),N!==A))}if("string"==typeof R?(k=v.nocase?M.toLowerCase()===R.toLowerCase():M===R,this.debug("string match",R,M,k)):(k=M.match(R),this.debug("pattern match",R,M,k)),!k)return!1}if(T===A&&w===P)return!0;if(T===A)return y;if(w===P)return T===A-1&&""===h[T];throw new Error("wtf?")}},function(h,m,y){var v=y(775),C=y(776);h.exports=function expandTop(h){if(!h)return[];"{}"===h.substr(0,2)&&(h="\\{\\}"+h.substr(2));return function expand(h,m){var y=[],T=C("{","}",h);if(!T||/\$$/.test(T.pre))return[h];var w,P=/^-?\d+\.\.-?\d+(?:\.\.-?\d+)?$/.test(T.body),k=/^[a-zA-Z]\.\.[a-zA-Z](?:\.\.-?\d+)?$/.test(T.body),R=P||k,M=T.body.indexOf(",")>=0;if(!R&&!M)return T.post.match(/,.*\}/)?(h=T.pre+"{"+T.body+A+T.post,expand(h)):[h];if(R)w=T.body.split(/\.\./);else{if(1===(w=function parseCommaParts(h){if(!h)return[""];var m=[],y=C("{","}",h);if(!y)return h.split(",");var v=y.pre,T=y.body,w=y.post,A=v.split(",");A[A.length-1]+="{"+T+"}";var P=parseCommaParts(w);w.length&&(A[A.length-1]+=P.shift(),A.push.apply(A,P));return m.push.apply(m,A),m}(T.body)).length)if(1===(w=expand(w[0],!1).map(embrace)).length)return(I=T.post.length?expand(T.post,!1):[""]).map((function(h){return T.pre+w[0]+h}))}var N,D=T.pre,I=T.post.length?expand(T.post,!1):[""];if(R){var x=numeric(w[0]),O=numeric(w[1]),L=Math.max(w[0].length,w[1].length),U=3==w.length?Math.abs(numeric(w[2])):1,B=lte;O<x&&(U*=-1,B=gte);var W=w.some(isPadded);N=[];for(var q=x;B(q,O);q+=U){var Y;if(k)"\\"===(Y=String.fromCharCode(q))&&(Y="");else if(Y=String(q),W){var V=L-Y.length;if(V>0){var $=new Array(V+1).join("0");Y=q<0?"-"+$+Y.slice(1):$+Y}}N.push(Y)}}else N=v(w,(function(h){return expand(h,!1)}));for(var z=0;z<N.length;z++)for(var G=0;G<I.length;G++){var J=D+N[z]+I[G];(!m||R||J)&&y.push(J)}return y}(function escapeBraces(h){return h.split("\\\\").join(T).split("\\{").join(w).split("\\}").join(A).split("\\,").join(P).split("\\.").join(k)}(h),!0).map(unescapeBraces)};var T="\0SLASH"+Math.random()+"\0",w="\0OPEN"+Math.random()+"\0",A="\0CLOSE"+Math.random()+"\0",P="\0COMMA"+Math.random()+"\0",k="\0PERIOD"+Math.random()+"\0";function numeric(h){return parseInt(h,10)==h?parseInt(h,10):h.charCodeAt(0)}function unescapeBraces(h){return h.split(T).join("\\").split(w).join("{").split(A).join("}").split(P).join(",").split(k).join(".")}function embrace(h){return"{"+h+"}"}function isPadded(h){return/^-?0\d/.test(h)}function lte(h,m){return h<=m}function gte(h,m){return h>=m}},function(h,m){h.exports=function(h,m){for(var v=[],C=0;C<h.length;C++){var T=m(h[C],C);y(T)?v.push.apply(v,T):v.push(T)}return v};var y=Array.isArray||function(h){return"[object Array]"===Object.prototype.toString.call(h)}},function(h,m,y){"use strict";function balanced(h,m,y){h instanceof RegExp&&(h=maybeMatch(h,y)),m instanceof RegExp&&(m=maybeMatch(m,y));var v=range(h,m,y);return v&&{start:v[0],end:v[1],pre:y.slice(0,v[0]),body:y.slice(v[0]+h.length,v[1]),post:y.slice(v[1]+m.length)}}function maybeMatch(h,m){var y=m.match(h);return y?y[0]:null}function range(h,m,y){var v,C,T,w,A,P=y.indexOf(h),k=y.indexOf(m,P+1),R=P;if(P>=0&&k>0){for(v=[],T=y.length;R>=0&&!A;)R==P?(v.push(R),P=y.indexOf(h,R+1)):1==v.length?A=[v.pop(),k]:((C=v.pop())<T&&(T=C,w=k),k=y.indexOf(m,R+1)),R=P<k&&P>=0?P:k;v.length&&(A=[T,w])}return A}h.exports=balanced,balanced.range=range},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0});m.VerbosityTraceFilter=class VerbosityTraceFilter{constructor(h){this.verbosity=h}shouldTrace(h,m,y){return void 0===this.verbosity||this.verbosity<=m}}},function(h,m,y){"use strict";var v=this&&this.__awaiter||function(h,m,y,v){return new(y||(y=Promise))((function(C,T){function fulfilled(h){try{step(v.next(h))}catch(h){T(h)}}function rejected(h){try{step(v.throw(h))}catch(h){T(h)}}function step(h){h.done?C(h.value):function adopt(h){return h instanceof y?h:new y((function(m){m(h)}))}(h.value).then(fulfilled,rejected)}step((v=v.apply(h,m||[])).next())}))};Object.defineProperty(m,"__esModule",{value:!0});const C=y(13),T=y(201);class TraceSource extends C.EventEmitter{constructor(h){super(),this.name=h}withName(h){const m=new TraceSource(h);return this.eventNames().forEach(h=>{this.listeners(h).forEach(y=>{m.on(h,y)})}),m}createChild(h){return this.withName(`${this.name}:${h}`)}addTraceListener(h){this.on(TraceSource.eventEventName,h.traceEvent.bind(h)),this.on(TraceSource.lineEventName,h.writeLine.bind(h)),h.flushEvents&&this.on(TraceSource.flushEventName,h.flushEvents.bind(h))}flushEvents(){return v(this,void 0,void 0,(function*(){yield Promise.all(this.listeners(TraceSource.flushEventName).map(h=>Promise.resolve(h())))}))}writeLine(h){this.emit(TraceSource.lineEventName,this.name,h)}log(h,m,...y){return this.traceEvent(h,0,m,...y),this}traceEvent(h,m,y,...v){this.emit(TraceSource.eventEventName,this.name,h,m,y,...v)}errorEvent(h,m,...y){this.traceEvent(T.LogLevel.Error,h,m,...y)}warningEvent(h,m,...y){this.traceEvent(T.LogLevel.Warning,h,m,...y)}infoEvent(h,m,...y){this.traceEvent(T.LogLevel.Info,h,m,...y)}error(h,...m){return this.traceEvent(T.LogLevel.Error,0,h,...m),this}warning(h,...m){return this.traceEvent(T.LogLevel.Warning,0,h,...m),this}info(h,...m){return this.traceEvent(T.LogLevel.Info,0,h,...m),this}verbose(h,...m){return this.traceEvent(T.LogLevel.Debug,0,h,...m),this}}m.TraceSource=TraceSource,TraceSource.lineEventName="line",TraceSource.eventEventName="event",TraceSource.flushEventName="flush"},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0});m.TraceFilters=class TraceFilters{constructor(h=[]){this.filters=h}shouldTrace(h,m,y){return this.filters.every(v=>v.shouldTrace(h,m,y))}}},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0});const v=y(117);class LoggerBase{constructor(h){this.name=h}error(h,...m){return this.log(v.LogLevel.Error,h,...m),this}warning(h,...m){return this.log(v.LogLevel.Warning,h,...m),this}info(h,...m){return this.log(v.LogLevel.Info,h,...m),this}verbose(h,...m){return this.log(v.LogLevel.Debug,h,...m),this}createChild(h){return this.withName(this.name+":"+h)}}m.LoggerBase=LoggerBase;class Logger extends LoggerBase{constructor(h,m){super(h),this.logCallback=m}log(h,m,...y){return this.logCallback(h,m,...y),this}withName(h){return new Logger(h,this.logCallback)}}m.Logger=Logger},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0});var v=y(782);m.withRetriesDecorator=v.withRetriesDecorator;var C=y(788);m.withHelperDecorator=C.withHelperDecorator},function(h,m,y){"use strict";var v=this&&this.__awaiter||function(h,m,y,v){return new(y||(y=Promise))((function(C,T){function fulfilled(h){try{step(v.next(h))}catch(h){T(h)}}function rejected(h){try{step(v.throw(h))}catch(h){T(h)}}function step(h){h.done?C(h.value):function adopt(h){return h instanceof y?h:new y((function(m){m(h)}))}(h.value).then(fulfilled,rejected)}step((v=v.apply(h,m||[])).next())}))};Object.defineProperty(m,"__esModule",{value:!0});const C=y(152),T=y(341),w=y(73);m.withRetriesDecorator=(h={})=>(m,y,A)=>{const{value:P}=A;w.assert(P instanceof Function,"This decorator works only on methods"),C.assertDefined(P,`The method "${y}" is not defined.`);return A.value=function(...m){return v(this,void 0,void 0,(function*(){return yield T.withRetries(h=>v(this,void 0,void 0,(function*(){return yield P.call(this,...m,h)})),h)}))},A}},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0});class ByDesignError extends Error{constructor(h,m,y){super(h),this.code=m,this.isSuppressUserNotification=y}}m.ByDesignError=ByDesignError},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0});const v=y(90);class AggregateError extends v.BaseError{constructor(){super(...arguments),this.errorType="AggregateError",this.errorsReference=[]}get errors(){return[...this.errorsReference]}addErrors(...h){return this.errorsReference.push(...h),this}cloneWithErrors(...h){const m=new AggregateError;return m.addErrors(...this.errors,...h),m}get lastError(){const h=this.errorsReference.length-1;return this.errorsReference[h]}}m.AggregateError=AggregateError},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0});const v=y(89);class NotImplementedError extends v.BaseError{constructor(){super(...arguments),this.errorType="NotImplementedError"}}m.NotImplementedError=NotImplementedError},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0});const v=y(89);class AuthenticationError extends v.BaseError{constructor(){super(...arguments),this.errorType="AuthenticationError"}}m.AuthenticationError=AuthenticationError},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0});const v=y(204);class TimeoutCancellationError extends v.CancellationError{constructor(){super(...arguments),this.errorType="TimeoutCancellationError"}}m.TimeoutCancellationError=TimeoutCancellationError},function(h,m,y){"use strict";var v=this&&this.__awaiter||function(h,m,y,v){return new(y||(y=Promise))((function(C,T){function fulfilled(h){try{step(v.next(h))}catch(h){T(h)}}function rejected(h){try{step(v.throw(h))}catch(h){T(h)}}function step(h){h.done?C(h.value):function adopt(h){return h instanceof y?h:new y((function(m){m(h)}))}(h.value).then(fulfilled,rejected)}step((v=v.apply(h,m||[])).next())}))};Object.defineProperty(m,"__esModule",{value:!0});const C=y(152),T=y(73),w=new Map;m.withHelperDecorator=function withHelperDecorator(h,m){return function(y,A,P){const{value:k}=P;return T.assert(k instanceof Function,"This decorator works only on methods"),C.assertDefined(k,`The method "${A}" is not defined.`),P.value=function(...y){return v(this,void 0,void 0,(function*(){const v=((h,m,y,v)=>{const T=w.get(v);if(T){const m=T.get(h);if(m)return m}else w.set(v,new Map);const A=m(h.bind(v),y),P=w.get(v);return C.assertDefined(P,"No helpers found."),P.set(h,A),A})(k,h,m,this);return yield v.call(this,...y)}))},P}}},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0});const v=y(73);m.assertInstance=(h,m,y)=>v.assert(h instanceof m,y)},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0});const v=y(90);m.assertNever=(h,m)=>{throw"string"==typeof m?new v.AssertionError(m):m}},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0}),m.once=(h,m)=>{const y=Symbol();let v;return function onceFunction(...C){return h[y]||(h[y]=!0,v=h.call(null!=m?m:this,...C)),v}}},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0}),m.onlyOnce=function onlyOnce(h,...m){const y=Symbol();let v,C,T=0;return function(...w){if(0===w.length&&(w=m),h[y]){if(!function parametersEqual(h,m){if(!Array.isArray(h)||!Array.isArray(m))return!1;if(h===m)return!0;const y=Math.min(h.length,m.length);for(var v=0;v<y;v++)if(h[v]!==m[v])return!1;const C=h.length>y?h:m;for(v=y;v<C.length;v++)if(void 0!==C[v])return!1;return!0}(v,w))throw new Error(`Parameters must be the same as in the first call of ${onlyOnce.name}(${h.name}).`)}else{let m;T++;try{if(m=h(...w),T>1)return m}finally{T--}h[y]=!0,v=w,C=m}return C}}},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0});const v=y(153),C=y(342);m.raceAsync=h=>{const m=new v.Signal,y=[];let T=h.length;return h.forEach(h=>{h.then(h=>{m.resolve(h)}).catch(h=>{T--,y.push(h),0===T&&m.reject(new C.PromiseRaceError(y,h))})}),m.promise}},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0});const v=y(6),C=y(345),T=y(151);m.DisposableClass=class DisposableClass{constructor(h){this.traceReference=h,this.disposablesReference=[],this.isDisposedReference=!1,this.onDisposeEmitter=new v.Emitter,this.onDisposeEvent=this.onDisposeEmitter.event,this.disposeObject=(h,m)=>{try{h.dispose(m)}catch(y){this.trace.verbose("Error from disposable",h,m,y)}finally{this.removeFromDisposables(h)}},this.removeFromDisposables=h=>{const m=this.disposablesReference.indexOf(h);return m<0||this.disposablesReference.splice(m,1),this},this.dispose=this.dispose.bind(this),this.onDispose=this.onDispose.bind(this)}get disposables(){return[...this.disposablesReference]}get trace(){return this.traceReference}get isDisposed(){return this.isDisposedReference}dispose(h){if(this.isDisposed)return;this.isDisposedReference=!0;const reasonToLog=()=>{var m;return h?"function"==typeof h?`${null===(m=h.constructor)||void 0===m?void 0:m.name}-${JSON.stringify(h)}`:String(h):"n/a"};try{const h=reasonToLog();this.trace.verbose(`disposing reason: '${h}', disposing ${this.disposables.length} objects`),this.disposables.forEach((m,y)=>{if(m){if(!m.isDisposed)return this.disposeObject(m,`${h} $${y}`)}else this.trace.warning("disposable is not set in the disposables object")}),this.disposablesReference.length=0}catch(h){this.trace.warning("error while disposing an object",h)}this.onDisposeEmitter.fire(this),this.onDisposeEmitter.dispose()}addToDisposables(...h){for(const m of h){if(T.assertDefined(m,"Disposable must be defined."),"onDispose"in m){const h=m.onDispose(()=>{this.disposeObject(h),this.removeFromDisposables(m)})}"dispose"in m&&this.disposablesReference.push(m)}return this}onDispose(h,m){if(this.isDisposed)return this.trace.verbose("already disposed, calling callback immediately"),h.call(m,this),{dispose:()=>{}};this.trace.verbose("subscribing to onDispose event");const y=this.onDisposeEvent(h.bind(null!=m?m:this,this));return C.createDisposable(h=>{T.defer(()=>{try{y.dispose(h)}catch(h){}},1)},this.trace.createChild("delayed-disposable"))}}},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0});const v=y(154),C=y(120);var T;!function(h){h.None=Object.freeze({isCancellationRequested:!1,onCancellationRequested:v.Event.None}),h.Cancelled=Object.freeze({isCancellationRequested:!0,onCancellationRequested:v.Event.None}),h.is=function is(m){let y=m;return y&&(y===h.None||y===h.Cancelled||C.boolean(y.isCancellationRequested)&&!!y.onCancellationRequested)}}(T=m.CancellationToken||(m.CancellationToken={}));const w=Object.freeze((function(h,m){let y=setTimeout(h.bind(m),0);return{dispose(){clearTimeout(y)}}}));class MutableToken{constructor(){this._isCancelled=!1}cancel(){this._isCancelled||(this._isCancelled=!0,this._emitter&&(this._emitter.fire(void 0),this._emitter=void 0))}get isCancellationRequested(){return this._isCancelled}get onCancellationRequested(){return this._isCancelled?w:(this._emitter||(this._emitter=new v.Emitter),this._emitter.event)}}m.CancellationTokenSource=class CancellationTokenSource{get token(){return this._token||(this._token=new MutableToken),this._token}cancel(){this._token?this._token.cancel():this._token=T.Cancelled}dispose(){this.cancel()}}},function(h,m,y){"use strict";var v;Object.defineProperty(m,"__esModule",{value:!0}),function(h){h.None=0,h.First=1,h.Last=2}(v=m.Touch||(m.Touch={}));m.LinkedMap=class LinkedMap{constructor(){this._map=new Map,this._head=void 0,this._tail=void 0,this._size=0}clear(){this._map.clear(),this._head=void 0,this._tail=void 0,this._size=0}isEmpty(){return!this._head&&!this._tail}get size(){return this._size}has(h){return this._map.has(h)}get(h){const m=this._map.get(h);if(m)return m.value}set(h,m,y=v.None){let C=this._map.get(h);if(C)C.value=m,y!==v.None&&this.touch(C,y);else{switch(C={key:h,value:m,next:void 0,previous:void 0},y){case v.None:this.addItemLast(C);break;case v.First:this.addItemFirst(C);break;case v.Last:default:this.addItemLast(C)}this._map.set(h,C),this._size++}}delete(h){const m=this._map.get(h);return!!m&&(this._map.delete(h),this.removeItem(m),this._size--,!0)}shift(){if(!this._head&&!this._tail)return;if(!this._head||!this._tail)throw new Error("Invalid list");const h=this._head;return this._map.delete(h.key),this.removeItem(h),this._size--,h.value}forEach(h,m){let y=this._head;for(;y;)m?h.bind(m)(y.value,y.key,this):h(y.value,y.key,this),y=y.next}forEachReverse(h,m){let y=this._tail;for(;y;)m?h.bind(m)(y.value,y.key,this):h(y.value,y.key,this),y=y.previous}values(){let h=[],m=this._head;for(;m;)h.push(m.value),m=m.next;return h}keys(){let h=[],m=this._head;for(;m;)h.push(m.key),m=m.next;return h}addItemFirst(h){if(this._head||this._tail){if(!this._head)throw new Error("Invalid list");h.next=this._head,this._head.previous=h}else this._tail=h;this._head=h}addItemLast(h){if(this._head||this._tail){if(!this._tail)throw new Error("Invalid list");h.previous=this._tail,this._tail.next=h}else this._head=h;this._tail=h}removeItem(h){if(h===this._head&&h===this._tail)this._head=void 0,this._tail=void 0;else if(h===this._head)this._head=h.next;else if(h===this._tail)this._tail=h.previous;else{const m=h.next,y=h.previous;if(!m||!y)throw new Error("Invalid list");m.previous=y,y.next=m}}touch(h,m){if(!this._head||!this._tail)throw new Error("Invalid list");if(m===v.First||m===v.Last)if(m===v.First){if(h===this._head)return;const m=h.next,y=h.previous;h===this._tail?(y.next=void 0,this._tail=y):(m.previous=y,y.next=m),h.previous=void 0,h.next=this._head,this._head.previous=h,this._head=h}else if(m===v.Last){if(h===this._tail)return;const m=h.next,y=h.previous;h===this._head?(m.previous=void 0,this._head=m):(m.previous=y,y.next=m),h.next=void 0,h.previous=this._tail,this._tail.next=h,this._tail=h}}}},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0});const v=y(7),C=y(18),T=y(11),w=y(31),A=y(206),P=y(207);m.generateRandomPipeName=function generateRandomPipeName(){const h=T.randomBytes(21).toString("hex");return"win32"===process.platform?`\\\\.\\pipe\\vscode-jsonrpc-${h}-sock`:v.join(C.tmpdir(),`vscode-${h}.sock`)},m.createClientPipeTransport=function createClientPipeTransport(h,m="utf-8"){let y,v=new Promise((h,m)=>{y=h});return new Promise((C,T)=>{let k=w.createServer(h=>{k.close(),y([new A.SocketMessageReader(h,m),new P.SocketMessageWriter(h,m)])});k.on("error",T),k.listen(h,()=>{k.removeListener("error",T),C({onConnected:()=>v})})})},m.createServerPipeTransport=function createServerPipeTransport(h,m="utf-8"){const y=w.createConnection(h);return[new A.SocketMessageReader(y,m),new P.SocketMessageWriter(y,m)]}},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0});const v=y(31),C=y(206),T=y(207);m.createClientSocketTransport=function createClientSocketTransport(h,m="utf-8"){let y,w=new Promise((h,m)=>{y=h});return new Promise((A,P)=>{let k=v.createServer(h=>{k.close(),y([new C.SocketMessageReader(h,m),new T.SocketMessageWriter(h,m)])});k.on("error",P),k.listen(h,"127.0.0.1",()=>{k.removeListener("error",P),A({onConnected:()=>w})})})},m.createServerSocketTransport=function createServerSocketTransport(h,m="utf-8"){const y=v.createConnection(h,"127.0.0.1");return[new C.SocketMessageReader(y,m),new T.SocketMessageWriter(y,m)]}},function(h,m,y){"use strict";var v=this&&this.__awaiter||function(h,m,y,v){return new(y||(y=Promise))((function(C,T){function fulfilled(h){try{step(v.next(h))}catch(h){T(h)}}function rejected(h){try{step(v.throw(h))}catch(h){T(h)}}function step(h){h.done?C(h.value):function adopt(h){return h instanceof y?h:new y((function(m){m(h)}))}(h.value).then(fulfilled,rejected)}step((v=v.apply(h,m||[])).next())}))};Object.defineProperty(m,"__esModule",{value:!0});m.Mutex=class Mutex{constructor(){this.mutex=Promise.resolve()}dispatch(h){return v(this,void 0,void 0,(function*(){const m=yield this.lock();try{return yield Promise.resolve(h())}finally{m()}}))}lock(){let begin=h=>{};return this.mutex=this.mutex.then(()=>new Promise(begin)),new Promise(h=>{begin=h})}}},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0});m.CallbackContainer=class CallbackContainer{constructor(){this.callbacks=[]}clear(){this.callbacks.length=0}get items(){return this.callbacks}add(h){return h&&this.callbacks.push(h),{dispose:()=>{if(!h)return;const m=this.callbacks.indexOf(h);-1!==m&&this.callbacks.splice(m,1)}}}}},function(h,m,y){"use strict";function lazyLoadMutable(h){const result=()=>{if(void 0===result.value&&result.loader&&(result.value=result.loader()),void 0===result.value)throw new Error("No loader o value was supplied.");return result.value};return result.loader=h,result}Object.defineProperty(m,"__esModule",{value:!0}),m.lazyLoad=function lazyLoad(h){let m;return(y=!0)=>void 0!==m?m:y?m=h():void 0},m.lazyLoadMutable=lazyLoadMutable,m.lazyLoadNotImplemented=function lazyLoadNotImplemented(){throw new Error("Dependencies: Instance not provided.")},m.delayedLoadMutable=function delayedLoadMutable(h){return lazyLoadMutable(()=>{throw Error(`Dependencies: ${h} is not yet initialized`)})},m.setLazyLoadMutable=function setLazyLoadMutable(h,m){return"function"==typeof m&&(h.loader=m),h}},function(h,m,y){"use strict";var v=this&&this.__awaiter||function(h,m,y,v){return new(y||(y=Promise))((function(C,T){function fulfilled(h){try{step(v.next(h))}catch(h){T(h)}}function rejected(h){try{step(v.throw(h))}catch(h){T(h)}}function step(h){h.done?C(h.value):function adopt(h){return h instanceof y?h:new y((function(m){m(h)}))}(h.value).then(fulfilled,rejected)}step((v=v.apply(h,m||[])).next())}))};Object.defineProperty(m,"__esModule",{value:!0});const C=y(152),T=y(208),w=y(209);m.withCache=h=>{let m;return(...y)=>v(void 0,void 0,void 0,(function*(){return m&&!m.isFulfilled||(m=new T.Signal,w.defer(()=>v(void 0,void 0,void 0,(function*(){C.assertDefined(m,"No running signal is defined.");try{const v=yield h(...y);m.resolve(v)}catch(h){m.reject(h)}})),1)),yield m.promise}))}},function(h,m,y){"use strict";var v=this&&this.__awaiter||function(h,m,y,v){return new(y||(y=Promise))((function(C,T){function fulfilled(h){try{step(v.next(h))}catch(h){T(h)}}function rejected(h){try{step(v.throw(h))}catch(h){T(h)}}function step(h){h.done?C(h.value):function adopt(h){return h instanceof y?h:new y((function(m){m(h)}))}(h.value).then(fulfilled,rejected)}step((v=v.apply(h,m||[])).next())}))};Object.defineProperty(m,"__esModule",{value:!0});const C=y(346),T=y(153),w=y(343),A=y(151);m.continueWhen=(h,m=1/0,y)=>v(void 0,void 0,void 0,(function*(){const P=new T.Signal;try{const T=h(h=>v(void 0,void 0,void 0,(function*(){try{T.dispose()}catch(h){}yield A.wait(1),P.resolve(h)})));return w.assert(!Number.isNaN(m),"Timeout is NaN."),w.assert(m>0,`Timeout must be greater than zero, but "${m}" passed.`),Number.isFinite(m)?yield C.timeoutPromise(P.promise,m,y):yield P.promise}catch(h){throw h}}))},function(h,m,y){"use strict";var v=this&&this.__awaiter||function(h,m,y,v){return new(y||(y=Promise))((function(C,T){function fulfilled(h){try{step(v.next(h))}catch(h){T(h)}}function rejected(h){try{step(v.throw(h))}catch(h){T(h)}}function step(h){h.done?C(h.value):function adopt(h){return h instanceof y?h:new y((function(m){m(h)}))}(h.value).then(fulfilled,rejected)}step((v=v.apply(h,m||[])).next())}))};Object.defineProperty(m,"__esModule",{value:!0});const C=y(153),T=y(205);m.getPromiseState=h=>v(void 0,void 0,void 0,(function*(){const m=new C.Signal;return h.then(h=>(m.resolve({isPending:!1,error:null,data:h}),h),h=>{m.resolve({isPending:!1,error:h})}),yield T.wait(1),m.resolve({isPending:!0,error:null}),yield m.promise}))},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0}),m.idFunction=(...h)=>h},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0});const v=y(347);m.connectEvents=(h,...m)=>{const y=m.map(m=>m(h.fire.bind(h)));return v.createDisposable(()=>{for(const h of y)null==h||h.dispose()})}},function(h,m,y){"use strict";var v=this&&this.__awaiter||function(h,m,y,v){return new(y||(y=Promise))((function(C,T){function fulfilled(h){try{step(v.next(h))}catch(h){T(h)}}function rejected(h){try{step(v.throw(h))}catch(h){T(h)}}function step(h){h.done?C(h.value):function adopt(h){return h instanceof y?h:new y((function(m){m(h)}))}(h.value).then(fulfilled,rejected)}step((v=v.apply(h,m||[])).next())}))};Object.defineProperty(m,"__esModule",{value:!0});const C=y(208),T=y(348),w=y(209),serializeArgs=(...h)=>h.map(h=>T.hashString(`${h}`)).join("::"),A={serializeArguments:serializeArgs};m.withMutexByArguments=(h,m=A)=>{const y=new Map;return(...T)=>v(void 0,void 0,void 0,(function*(){const{serializeArguments:A=serializeArgs}=m,P=A(...T),k=y.get(P);if(k&&!k.isFulfilled)return yield k.promise;const R=new C.Signal;return y.set(P,R),w.defer(()=>v(void 0,void 0,void 0,(function*(){try{const m=yield h(...T);R.resolve(m)}catch(h){R.reject(h)}finally{y.delete(P)}})),1),yield R.promise}))}},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0});const v=y(210);m.randomItem=h=>{const m=h.length;return h[v.randomInt(m-1)]}},function(h,m,y){h.exports=y(11).randomBytes},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0});const v=y(350);m.randomString=(h=16,m="hex")=>v.randomBytes(h).toString(m)},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0});const v=y(210);m.randomBoolean=()=>1===v.randomInt(1)},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0}),m.debounce=(h,m)=>{let y;const debounced=(...v)=>{clearInterval(y),y=setInterval(()=>{h(...v)},m)};return debounced.stop=()=>{clearInterval(y)},debounced}},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0}),m.throttle=function throttle(h,m){let y;return function throttledFunction(...v){if(y)return;const{interval:C}=m;return y=setTimeout(()=>{y&&(clearInterval(y),y=void 0)},C),h.call(this,...v)}}},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0}),m.arrayUnique=h=>[...new Set(h)]},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0}),m.isThenable=h=>null!=h&&"function"==typeof h.then},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0});const v=y(351);m.errorToString=(h,m=!1)=>JSON.stringify(v.errorToObject(h,m),null,2)},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0}),m.notImplemented=function notImplemented(){throw new Error("Method not implemented.")}},function(h,m,y){"use strict";var v=this&&this.__awaiter||function(h,m,y,v){return new(y||(y=Promise))((function(C,T){function fulfilled(h){try{step(v.next(h))}catch(h){T(h)}}function rejected(h){try{step(v.throw(h))}catch(h){T(h)}}function step(h){h.done?C(h.value):function adopt(h){return h instanceof y?h:new y((function(m){m(h)}))}(h.value).then(fulfilled,rejected)}step((v=v.apply(h,m||[])).next())}))};Object.defineProperty(m,"__esModule",{value:!0}),m.promiseAny=h=>v(void 0,void 0,void 0,(function*(){return Promise.all([...h].map(h=>new Promise((m,y)=>Promise.resolve(h).then(y,m)))).then(h=>Promise.reject(h),h=>Promise.resolve(h))}))},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0}),m.toCamelCase=function toCamelCase(h){return h&&h.length>0?h.substring(0,1).toLowerCase()+h.substring(1):h}},function(h,m,y){"use strict";let v;Object.defineProperty(m,"__esModule",{value:!0}),m.crc32=function crc32(h){v||(v=function makeCrcTable(){let h;const m=[];for(let y=0;y<256;y++){h=y;for(let m=0;m<8;m++)h=1&h?3988292384^h>>>1:h>>>1;m[y]=h}return m}());let m=-1;for(let y=0;y<h.length;y++)m=m>>>8^v[255&(m^h[y])];return(((-1^m)>>>0)+4294967296).toString(16).substr(-8).toUpperCase()}},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0});const v=y(15);!function __export(h){for(var y in h)m.hasOwnProperty(y)||(m[y]=h[y])}(y(822)),m.globalTrace=new v.TraceSource("vscs")},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0}),m.TIME_SECOND_MS=1e3,m.TIME_MINUTE_MS=60*m.TIME_SECOND_MS,m.TIME_HOUR_MS=60*m.TIME_MINUTE_MS,m.TIME_DAY_MS=24*m.TIME_HOUR_MS},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0});var v=y(824);m.DisposableClassMock=v.DisposableClassMock},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0});const v=y(15);m.DisposableClassMock=class DisposableClassMock{constructor(){this.trace=new v.TraceSource("test-logger"),this.addToDisposables=h=>this,this.isDisposed=!1,this.onDispose=(h,m)=>({dispose:()=>{}}),this.dispose=()=>this}}},function(h,m,y){"use strict";var v=this&&this.__awaiter||function(h,m,y,v){return new(y||(y=Promise))((function(C,T){function fulfilled(h){try{step(v.next(h))}catch(h){T(h)}}function rejected(h){try{step(v.throw(h))}catch(h){T(h)}}function step(h){h.done?C(h.value):function adopt(h){return h instanceof y?h:new y((function(m){m(h)}))}(h.value).then(fulfilled,rejected)}step((v=v.apply(h,m||[])).next())}))};Object.defineProperty(m,"__esModule",{value:!0});const C=y(355),T=y(211),w=y(212),A=y(2);class RpcClientProxy extends T.RpcClientProxyBase{constructor(h,m){super(m),this.rpcClient=h}ensureConnectionAsync(){return this.rpcClient.ensureConnectionAsync()}}class RpcClient extends w.RpcServiceHandler{constructor(h,m){super(m),this.connectionFactory=h,this.connection=null,this.connectionFactoryMutex=new A.Mutex,this.rpcClientProxy=new RpcClientProxy(this,m),h.dispose&&this.addToDisposables(h)}static fromRpcMessageStream(h,m,y){return new RpcClient({create:y=>v(this,void 0,void 0,(function*(){const v=yield h(),C=y.createRpcConnection(v,m);return C.listen(),C})),dispose:()=>{y&&y()}},m)}sendRequest(h,m,y,v,...C){return this.rpcClientProxy.sendRequest(h,m,y,v,...C)}sendNotification(h,m,y){return this.rpcClientProxy.sendNotification(h,m,y)}onConnect(h){return v(this,void 0,void 0,(function*(){yield this.ensureConnectionAsync(),h()}))}onClose(h){return v(this,void 0,void 0,(function*(){yield this.ensureConnectionAsync(),this.connection.onClose(h)}))}ensureConnectionInternal(){return v(this,void 0,void 0,(function*(){this.connection||(yield this.connectionFactoryMutex.dispatch(()=>v(this,void 0,void 0,(function*(){this.connection||this.setConnection(yield this.connectionFactory.create(this))}))))}))}ensureConnectionAsync(){return v(this,void 0,void 0,(function*(){return yield this.ensureConnectionInternal(),this.connection}))}setConnection(h){this.connection=h,h&&(this.attachConnection(h),this.addToDisposables(h))}attachConnection(h){h.onClose(()=>{this.trace.info(`RPC connection closed. disposed: "${this.isDisposed}"`),this.isDisposed||this.dispose(new C.RpcConnectionClosedError)}),h.onRequest((m,...y)=>this.onRequest(null,h,m,...y)),h.onNotification((m,...y)=>{this.onNotification(h,m,...y)})}}m.RpcClient=RpcClient},function(h,m,y){"use strict";var v=this&&this.__awaiter||function(h,m,y,v){return new(y||(y=Promise))((function(C,T){function fulfilled(h){try{step(v.next(h))}catch(h){T(h)}}function rejected(h){try{step(v.throw(h))}catch(h){T(h)}}function step(h){h.done?C(h.value):function adopt(h){return h instanceof y?h:new y((function(m){m(h)}))}(h.value).then(fulfilled,rejected)}step((v=v.apply(h,m||[])).next())}))};Object.defineProperty(m,"__esModule",{value:!0});const C=y(15),T=y(212),w=y(357),A=y(121);class RpcServer extends T.RpcServiceHandler{constructor(h,m){super(h),this.rpcSessionNumber=0,this.rpcConnections=[];this.notifyEventProvider=m||((m,y)=>{A.notifyConnections(this.rpcConnections,m,y,h)})}registerRemoteRpcService(h,m){this.trace.info(`adding remote rpc service:${h}`);const y=h+".";m.onNotification((h,...m)=>{h.startsWith(y)&&this.notifyEventProvider(h,m)});const C=this.onHandleNoneRequest((h,C,...T)=>v(this,void 0,void 0,(function*(){if(C.startsWith(y))return yield w.sendRpcRequest(m,C,T,this.trace)})));return m.onClose(()=>C.dispose()),m.onDispose(()=>C.dispose()),C}sendNotification(h,m,y){return this.notifyEventProvider(m,y),Promise.resolve()}acceptRpcMessageStream(h){const m=this.createRpcConnection(h,this.trace);return[m,this.attachConnection(m)]}attachConnection(h){this.rpcConnections.push(h);const m=++this.rpcSessionNumber;this.trace.verbose(`Rpc #${m} created`),h.onRequest((y,...T)=>this.onRequest((T,...w)=>v(this,void 0,void 0,(function*(){const v={connection:h,session:m};w.push(v);const A=yield Promise.resolve(T(...w)),P=C.LoggerSettings.disableObfuscation?` => ${JSON.stringify(A)}`:"";return this.trace.verbose(`> #${m} ${y}()${P}`),A})),h,y,...T)),h.onNotification((m,...y)=>{this.onNotification(h,m,...y)});const removeRpc=y=>{const v=this.rpcConnections.indexOf(h);-1!==v&&(this.trace.verbose(`Rpc #${m} removed event:${y}`),this.rpcConnections.splice(v,1))};return h.onClose(h=>{removeRpc("closed")}),h.onDispose(h=>{removeRpc("disposed")}),m}}m.RpcServer=RpcServer},function(h,m,y){"use strict";var v=this&&this.__importStar||function(h){if(h&&h.__esModule)return h;var m={};if(null!=h)for(var y in h)Object.hasOwnProperty.call(h,y)&&(m[y]=h[y]);return m.default=h,m};Object.defineProperty(m,"__esModule",{value:!0});const C=v(y(6));m.RpcMessageWriter=class RpcMessageWriter{constructor(){this.onErrorEmitter=new C.Emitter,this.onCloseEmitter=new C.Emitter,this.onError=this.onErrorEmitter.event,this.onClose=this.onCloseEmitter.event}write(h){const m=JSON.stringify(h),y=Buffer.from(m),v=Buffer.from("Content-Length: "+y.length+"\r\n\r\n"),C=Buffer.alloc(v.length+y.length);v.copy(C,0),y.copy(C,v.length),this.onSendCallback&&this.onSendCallback(C).catch(h=>{this.onErrorEmitter.fire([h,void 0,void 0])})}dispose(){}}},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0}),function(h){h[h.Default="default"]="Default",h[h.Email="email"]="Email",h[h.Token="token"]="Token",h[h.Path="path"]="Path",h[h.Text="text"]="Text",h[h.Uri="uri"]="Uri",h[h.Omit="omit"]="Omit",h[h.OmitDefault="omitDefault"]="OmitDefault",h[h.Hide="hide"]="Hide",h[h.SingleMember="singleMember"]="SingleMember"}(m.DataFormat||(m.DataFormat={})),m.dataFormat=function dataFormat(...h){return(m,y)=>{m.constructor.dataFormat||(m.constructor.dataFormat={}),m.constructor.dataFormat[y]=h}}},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0});const v=y(353);m.RpcProxyCache=class RpcProxyCache{constructor(h,m){this.clientProxy=h,this.logger=m,this.proxyMap=new Map}getOrCreate(h,m){let y=this.proxyMap.get(h.name);return y||(this.logger.info(`Creating proxy for ${h.name} service`),y=v.RpcProxy.create(h,this.clientProxy,m?this.logger.withName(m):this.logger),this.proxyMap.set(h.name,y)),y}}},function(h,m,y){"use strict";var v=this&&this.__importStar||function(h){if(h&&h.__esModule)return h;var m={};if(null!=h)for(var y in h)Object.hasOwnProperty.call(h,y)&&(m[y]=h[y]);return m.default=h,m};Object.defineProperty(m,"__esModule",{value:!0});const C=v(y(6));m.Channel=class Channel{constructor(h,m,y,v){this.send=h,this.onDataReceivedEmitter=new C.Emitter,this.onClosedEmitter=new C.Emitter,this.onDataReceived=this.onDataReceivedEmitter.event,this.onClosed=this.onClosedEmitter.event;this.close=null!=m?m:(h,m)=>Promise.resolve();this.adjustWindow=null!=y?y:h=>{};this.dispose=null!=v?v:()=>{}}fireDataReceived(h){this.onDataReceivedEmitter.fire(h)}fireClosed(h){this.onClosedEmitter.fire(h)}}},function(h,m,y){"use strict";var v=this&&this.__importStar||function(h){if(h&&h.__esModule)return h;var m={};if(null!=h)for(var y in h)Object.hasOwnProperty.call(h,y)&&(m[y]=h[y]);return m.default=h,m};Object.defineProperty(m,"__esModule",{value:!0});const C=v(y(6)),T=y(13);m.createDuplexRpcMessageStreams=function createDuplexRpcMessageStreams(){const h=new DuplexReadableStream,m=new DuplexWritableStream(h),y=new DuplexReadableStream,v=new DuplexWritableStream(y),T=new C.StreamMessageReader(h),w=new C.StreamMessageWriter(m),A=new C.StreamMessageReader(y);return[{reader:T,writer:new C.StreamMessageWriter(v)},{reader:A,writer:w}]};class DuplexReadableStream extends T.EventEmitter{}class DuplexWritableStream extends T.EventEmitter{constructor(h){super(),this.readableStream=h}write(h,m,y){return this.readableStream.emit("data",h),!0}}},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0});const v=y(2);m.rpcContextExpectedMessage="Rpc Request context expected",m.rpcContextNoSessionMessage="No session being defined",m.assertRpcRequestContext=function assertRpcRequestContext(h){v.assertDefined(h,m.rpcContextExpectedMessage),v.assertDefined(h.session,m.rpcContextNoSessionMessage)}},function(h,m,y){"use strict";var v=this&&this.__awaiter||function(h,m,y,v){return new(y||(y=Promise))((function(C,T){function fulfilled(h){try{step(v.next(h))}catch(h){T(h)}}function rejected(h){try{step(v.throw(h))}catch(h){T(h)}}function step(h){h.done?C(h.value):function adopt(h){return h instanceof y?h:new y((function(m){m(h)}))}(h.value).then(fulfilled,rejected)}step((v=v.apply(h,m||[])).next())}))};Object.defineProperty(m,"__esModule",{value:!0});const C=y(18),T=y(155),w=y(122),A=y(834),P=y(840),k=y(844),R=y(845),M=y(885),N=y(213),D=y(886),I=y(8),x=y(887),O=y(362);class VSLSCommandsAPI{constructor(h){w.setExtensionContext(h.extensionContext),h.telemetry&&I.Telemetry.init(x.telemetryReporterFactory.create(h.extensionPackage),h.telemetry.featureName||"vscode-vsls-command.",h.telemetry.canSendSensistiveInformation,h.telemetry.faultSendCallbackParam)}initLogging(h,m){return v(this,void 0,void 0,(function*(){m.logFileEnabled&&O.setLogLocation(m.logFilePath||T.join(C.tmpdir(),`${h.name}_logs`)),this.loggingUtil=new P.LoggingUtil(h.displayName,m),yield this.loggingUtil.initLogging()}))}registerCommand(h,m,y={}){return A.commandRegistry.register(h,m,y),this}get clientLogsLocation(){return O.getLogLocation()}getLastClientLogs(h){return v(this,void 0,void 0,(function*(){if(null!=O.getLogLocation()){const m=O.getLogLocation();return yield D.getLastFiles(m,h)}return[]}))}getLogs(h){return this.loggingUtil.getLogs(h)}setDiagnosticLogging(h,m){this.loggingUtil.setDiagnosticLogging(h,m)}}let L;m.vslsCommands={isFirstActivation:R.isFirstActivation,isExtensionBeingUpdated:R.isExtensionBeingUpdated,get API(){return N.throwNotInitialized(L)},get abTester(){return N.throwNotInitialized(m.abTester)},get packageJSON(){return M.getPackageJSON()},initialize(h){return v(this,void 0,void 0,(function*(){if(L)return L;L=new VSLSCommandsAPI(h),h.logging&&(yield L.initLogging(h.extensionPackage,h.logging)),m.abTester=new k.ABTester(h.extensionContext.globalState,(yield R.isFirstActivation(h.extensionPackage))&&!(yield R.isExtensionBeingUpdated()))}))}}},function(h,m,y){"use strict";var v=this&&this.__awaiter||function(h,m,y,v){return new(y||(y=Promise))((function(C,T){function fulfilled(h){try{step(v.next(h))}catch(h){T(h)}}function rejected(h){try{step(v.throw(h))}catch(h){T(h)}}function step(h){h.done?C(h.value):function adopt(h){return h instanceof y?h:new y((function(m){m(h)}))}(h.value).then(fulfilled,rejected)}step((v=v.apply(h,m||[])).next())}))};Object.defineProperty(m,"__esModule",{value:!0});const C=y(123),T=y(835),w=y(156),A=y(8);class CommandRegistryProvider{constructor(){this.disposables={},this.trace=C.traceSource.withName("CommandRegistry")}register(h,m,C={}){const P=new m,k=y(0).commands.registerCommand;this.disposables[h]=k(h,(m={})=>v(this,void 0,void 0,(function*(){try{const y=T.CommandContextBuilder.build(P,h),v=Object.assign(Object.assign({},C),m);return yield P.invoke(v,y)}catch(h){if(h&&!h.hasRecorded){const m=`Unhandled exception (command): ${h.message}`;this.trace.error(m),A.Telemetry.sendFault(w.TelemetryEventNames.UNHANDLED_COMMAND_ERROR_FAULT,A.FaultType.Error,m,h)}}})))}dispose(h){const m=this.disposables[h];m&&m.dispose&&m.dispose()}disposeAll(){for(const h in this.disposables)h&&this.dispose(h)}}m.CommandRegistryProvider=CommandRegistryProvider,m.commandRegistry=new CommandRegistryProvider},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0});const v=y(123);class CommandContextBuilderClass{constructor(){}build(h,m){return{trace:v.traceSource.withName(this.buildTrace(h)),commandText:m,commandName:""}}buildTrace(h){let m="";return h&&h.constructor&&h.constructor.name&&(m=h.constructor.name,m=m.replace("CommandDecorator","")),`Command:${m}`}}m.CommandContextBuilderClass=CommandContextBuilderClass,m.CommandContextBuilder=new CommandContextBuilderClass},function(h,m,y){"use strict";var v=this&&this.__awaiter||function(h,m,y,v){return new(y||(y=Promise))((function(C,T){function fulfilled(h){try{step(v.next(h))}catch(h){T(h)}}function rejected(h){try{step(v.throw(h))}catch(h){T(h)}}function step(h){h.done?C(h.value):function adopt(h){return h instanceof y?h:new y((function(m){m(h)}))}(h.value).then(fulfilled,rejected)}step((v=v.apply(h,m||[])).next())}))};Object.defineProperty(m,"__esModule",{value:!0});const C=y(35),T=y(15),w=y(360),A=y(214),P=y(6),k=y(361);let R=0;class TelemetryClass{constructor(){this.telemetryEvents={},this.filters=[],this.canSendSensitiveFlag=!1}get reporter(){return this.telemetryReporter}get canSendSensitiveInformation(){return this.canSendSensitiveFlag}init(h,m,y,v){this.telemetryReporter=h,this.canSendSensitiveFlag=y,A.TelemetryPropertyNames.FEATURE_NAME=m||"",v&&(N=v),this.contextProperties={},this.addContextProperty(A.TelemetryPropertyNames.SESSION_ID,C())}addFilter(h){this.filters.push(h)}removeFilter(h){const m=this.filters.indexOf(h);m>=0&&this.filters.splice(m,1)}addContextProperties(h,m=!1){for(const[y,v]of Object.entries(h))this.addContextProperty(y,v,m);return this}addContextProperty(h,m,y=!1){if(void 0===m)return this;const v=String(m);return y&&!this.canSendSensitiveInformation?this.contextProperties[h]=T.Privacy.getShortHash(v):this.contextProperties[h]=v,this}removeContextProperty(h){delete this.contextProperties[h]}getContextProperty(h){return this.contextProperties[h]}addContextPropertiesToObject(h){return Object.assign({},this.contextProperties,h)}filterAndSendTelemetryEvent(h,m,y,v){if(!this.reporter)return;const C=Object.assign({},v),T=this.addContextPropertiesToObject(y);for(const m of this.filters)if(!m.shouldSend(h,T,C))return;C[A.TelemetryPropertyNames.SEQUENCE_NUMBER]=function setSequence(){return R+=1,R}(),m(T,C)}sendTelemetryEvent(h,m,y){this.filterAndSendTelemetryEvent(h,(m,y)=>this.reporter.sendTelemetryEvent(h,m,y),m,y)}sendTelemetryErrorEvent(h,m,y,v){this.filterAndSendTelemetryEvent(h,(m,y)=>this.reporter.sendTelemetryErrorEvent(h,m,y,v),m,y)}sendFault(h,m,y,v,C){new Fault(h,m,y,v,C).send()}startTimedEvent(h,m=!1){const y=new TimedEvent(h,m);return this.telemetryEvents[y.id]=y,y}setCorrelationEvent(h){this.correlationEvent=h}removeCorrelationEvent(h){this.correlationEvent===h&&(this.correlationEvent=void 0)}correlate(h){this.correlationEvent&&h.correlateWith(this.correlationEvent)}endAllPendingEvents(){return v(this,void 0,void 0,(function*(){for(let h of Object.keys(this.telemetryEvents)){const m=this.telemetryEvents[h];yield m.endIfNotSent(),delete this.telemetryEvents[h]}}))}dispose(){return v(this,void 0,void 0,(function*(){yield this.reporter.dispose()}))}}m.TelemetryClass=TelemetryClass;const M=new TelemetryClass;let N;m.Telemetry=M;class TelemetryEvent{constructor(h,m=!1){this.isSent=!1,this.id=C(),this.eventName=h,this.properties={},this.measures={},this.correlationId=C(),m&&M.correlate(this)}static create(h,m){const y=!!m&&!!m.correlate,v=new TelemetryEvent(h,y);return m.properties&&Object.keys(m.properties).forEach(h=>v.addProperty(A.TelemetryPropertyNames.FEATURE_NAME+h,m.properties[h])),m.measures&&Object.keys(m.measures).forEach(h=>v.addMeasure(A.TelemetryPropertyNames.FEATURE_NAME+h,m.measures[h])),v}addProperty(h,m,y=!1,v=!1){if(void 0===m)return this;const C=String(m);return y&&!M.canSendSensitiveInformation?this.properties[h]=T.Privacy.getHash(C,v):this.properties[h]=C,this}addProperties(h,m=!0){for(let[y,v]of Object.entries(h))this.addProperty(y,v,m);return this}addPropertyIfNotExists(h,m,y=!1,v=!1){return this.propertyExists(h)||this.addProperty(h,m,y,v),this}propertyExists(h){return h in this.properties}addMeasure(h,m){this.measures[h]=m}addMeasureIfNotExists(h,m){void 0===this.measures[h]&&this.addMeasure(h,m)}getCorrelationId(){return this.correlationId}correlateWith(h){return this.correlationId=h.getCorrelationId(),this}correlateWithId(h){return this.correlationId=h,this}addCommonProperties(){this.addProperty(A.TelemetryPropertyNames.EVENT_ID,this.id),this.addProperty(A.TelemetryPropertyNames.CORRELATION_ID,this.correlationId)}send(){this.addCommonProperties(),M.sendTelemetryEvent(this.eventName,this.properties,this.measures),this.isSent=!0}sendAsError(h){this.addCommonProperties(),M.sendTelemetryErrorEvent(this.eventName,this.properties,this.measures,h),this.isSent=!0}}m.TelemetryEvent=TelemetryEvent;class Fault extends TelemetryEvent{constructor(h,m,y,v,C){super(h),this.exception=v,this.addProperty(A.TelemetryPropertyNames.FAULT_TYPE,w.FaultType[m]),y&&this.addProperty(A.TelemetryPropertyNames.EVENT_MESSAGE,cleanSensitiveInformation(y));let k="";v&&v instanceof P.ResponseError&&(v.code&&"number"==typeof v.code&&this.addMeasure(A.TelemetryPropertyNames.EVENT_EXCEPTION_CODE,v.code),v.data&&"string"==typeof v.data&&(k+=cleanSensitiveInformation(v.data)+"\n   --- End of remote exception stack trace ---\n")),v&&v.stack&&"string"==typeof v.stack&&(k+=cleanSensitiveInformation(T.errorToString(v))),k||(k="No Stack"),this.addProperty(A.TelemetryPropertyNames.EVENT_EXCEPTION_STACK,k),C&&this.correlateWith(C)}send(){const h=Object.create(null,{sendAsError:{get:()=>super.sendAsError}});return v(this,void 0,void 0,(function*(){let m=[];return N&&(m=yield N(this)),h.sendAsError.call(this,[...m,A.TelemetryPropertyNames.EVENT_MESSAGE,A.TelemetryPropertyNames.EVENT_EXCEPTION_STACK])}))}}m.Fault=Fault;class TimedEvent extends TelemetryEvent{constructor(h,m=!1,y=!1){if(super(h,m),this.startTime=(new Date).getTime(),this.lastMarkTime=this.startTime,TimedEvent.scopeStack.push(this),this.addProperty(A.TelemetryPropertyNames.EVENT_CREATION_TIME,(new Date).toISOString()),this.addProperty(A.TelemetryPropertyNames.EVENT_TYPE,A.TelemetryPropertyValues.END),y){const m=new TelemetryEvent(h);m.correlateWith(this),m.addProperty(A.TelemetryPropertyNames.EVENT_TYPE,A.TelemetryPropertyValues.START),m.send()}}markTime(h,m=!1){let y=(new Date).getTime(),v=m?y-this.startTime:y-this.lastMarkTime;return this.lastMarkTime=y,this.addMeasure(h,v),v}end(h,m,y=!0){this.addProperty(A.TelemetryPropertyNames.EVENT_RESULT,k.Result[h]),m&&this.addProperty(A.TelemetryPropertyNames.EVENT_MESSAGE,cleanSensitiveInformation(m));const v=this.markTime(A.TelemetryPropertyNames.EVENT_DURATION,!0);M.removeCorrelationEvent(this),y&&this.send();for(let h=TimedEvent.scopeStack.length-1;h>=0;h--)TimedEvent.scopeStack[h]===this&&TimedEvent.scopeStack.splice(h,1);return v}endIfNotSent(){return v(this,void 0,void 0,(function*(){this.isSent||(yield this.end(k.Result.Cancel,"Completing pending telemetry events."))}))}}function cleanSensitiveInformation(h){return h?function removeEmailAddresses(h){return h.replace(/[\S]+@[\S]+/gi,"[EMAIL]")}(function removePath(h,m=""){return h.replace(/([A-Za-z]:)?(\S*[\\\/])+\S*/gi,(h,y,v,C,T)=>{if(/^\d{1,4}\/\d{1,2}\/\d{1,4}$/.test(h))return h;{const C=(y?y.length:0)+v.length,T=h.substr(C);return m+T}})}(h,"[PATH]/")):h}m.TimedEvent=TimedEvent,TimedEvent.scopeStack=[],m.cleanSensitiveInformation=cleanSensitiveInformation,m.propagateOffsetMarkTime=(h,m)=>{for(let y=0;y<TimedEvent.scopeStack.length;y++){const v=TimedEvent.scopeStack[y];v!==m&&v.markTime(h)}}},function(h,m,y){var v,C,T=y(358),w=y(359),A=0,P=0;h.exports=function v1(h,m,y){var k=m&&y||0,R=m||[],M=(h=h||{}).node||v,N=void 0!==h.clockseq?h.clockseq:C;if(null==M||null==N){var D=T();null==M&&(M=v=[1|D[0],D[1],D[2],D[3],D[4],D[5]]),null==N&&(N=C=16383&(D[6]<<8|D[7]))}var I=void 0!==h.msecs?h.msecs:(new Date).getTime(),x=void 0!==h.nsecs?h.nsecs:P+1,O=I-A+(x-P)/1e4;if(O<0&&void 0===h.clockseq&&(N=N+1&16383),(O<0||I>A)&&void 0===h.nsecs&&(x=0),x>=1e4)throw new Error("uuid.v1(): Can't create more than 10M uuids/sec");A=I,P=x,C=N;var L=(1e4*(268435455&(I+=122192928e5))+x)%4294967296;R[k++]=L>>>24&255,R[k++]=L>>>16&255,R[k++]=L>>>8&255,R[k++]=255&L;var U=I/4294967296*1e4&268435455;R[k++]=U>>>8&255,R[k++]=255&U,R[k++]=U>>>24&15|16,R[k++]=U>>>16&255,R[k++]=N>>>8|128,R[k++]=255&N;for(var B=0;B<6;++B)R[k+B]=M[B];return m||w(R)}},function(h,m,y){var v=y(358),C=y(359);h.exports=function v4(h,m,y){var T=m&&y||0;"string"==typeof h&&(m="binary"===h?new Array(16):null,h=null);var w=(h=h||{}).random||(h.rng||v)();if(w[6]=15&w[6]|64,w[8]=63&w[8]|128,m)for(var A=0;A<16;++A)m[T+A]=w[A];return m||C(w)}},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0});const v=y(214);m.SendOnceFilter=class SendOnceFilter{constructor(h,m=[]){this.eventName=h,this.distinctProperties=m,this.sentEventsProperties=[]}shouldSend(h,m,y){if(h===this.eventName){for(const h of this.sentEventsProperties)if(this.propertySubsetsEqual(m,h))return!1;this.sentEventsProperties.push(this.createPropertySubset(m))}return!0}reset(){this.sentEventsProperties=[]}createPropertySubset(h){const m={};for(const y of this.distinctProperties)m[y]=h[y];return m}propertySubsetsEqual(h,m){for(const y of this.distinctProperties)if(h[y]!==m[y])return!1;return!0}};m.SamplingFilter=class SamplingFilter{constructor(h){this.samplingConfig=h}shouldSend(h,m,y){if(!h)return!0;const C=this.samplingConfig[h];if("number"==typeof C&&!isNaN(C)){if(0===C||Math.random()*C>1)return!1;y[v.TelemetryPropertyNames.SAMPLE_RATE]=C}return!0}}},function(h,m,y){"use strict";var v=this&&this.__awaiter||function(h,m,y,v){return new(y||(y=Promise))((function(C,T){function fulfilled(h){try{step(v.next(h))}catch(h){T(h)}}function rejected(h){try{step(v.throw(h))}catch(h){T(h)}}function step(h){h.done?C(h.value):function adopt(h){return h instanceof y?h:new y((function(m){m(h)}))}(h.value).then(fulfilled,rejected)}step((v=v.apply(h,m||[])).next())}))};Object.defineProperty(m,"__esModule",{value:!0});const C=y(15),T=y(123),w=y(362);m.LoggingUtil=class LoggingUtil{constructor(h,m={}){this.displayName=h,this.loggingOptions=m;const y=this.loggingOptions.outputChannelName||this.displayName;this.outputTraceListener=new C.OutputTraceListener(y,this.loggingOptions.outputChannelTimestamp),this.memoryTraceListener=new C.MemoryTraceListener(m.logMaxSize)}getLogs(h){return this.memoryTraceListener.getLogs(h)}initLogging(){return v(this,void 0,void 0,(function*(){T.traceSource.addTraceListener(this.memoryTraceListener),T.traceSource.addTraceListener(this.outputTraceListener),this.loggingOptions.diagnosticsLogging&&this.setDiagnosticLogging(this.loggingOptions.diagnosticsLogging.enable,this.loggingOptions.diagnosticsLogging.focus),this.loggingOptions.logFileEnabled&&(this.logFileTraceListener=yield w.createLogFileListener(),this.logFileTraceListener&&T.traceSource.addTraceListener(this.logFileTraceListener)),this.setLoggingFilters(this.loggingOptions.logLevel,this.loggingOptions.filters,this.loggingOptions.traceFilter),this.loggingOptions.obfuscateProperties&&Object.entries(this.loggingOptions.obfuscateProperties).forEach(h=>{C.LoggerSettings.obfuscateProperties[h[0]]=h[1]})}))}setLoggingFilters(h,m={},y){const v=new C.TraceFilters([new C.VerbosityTraceFilter(h?C.LogLevel[h]:void 0),new C.GlobPatternTraceFilter(m)]);y&&v.filters.push(y),this.outputTraceListener.filter=v,this.logFileTraceListener&&(this.logFileTraceListener.filter=v)}setDiagnosticLogging(h=!0,m=!1){return v(this,void 0,void 0,(function*(){h?this.outputTraceListener.addOutputChannel(m):this.outputTraceListener.removeOutputChannel()}))}}},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0});class TelemetryEventNames{}m.TelemetryEventNames=TelemetryEventNames,TelemetryEventNames.FAULT_PREFIX="Fault/",TelemetryEventNames.NAME_LOGS_FILE_FAILED=TelemetryEventNames.FAULT_PREFIX+"name-logfile-failed",TelemetryEventNames.OPEN_LOGS_FAILED=TelemetryEventNames.FAULT_PREFIX+"open-logs-failed",TelemetryEventNames.WRITE_LOGS_FAILED=TelemetryEventNames.FAULT_PREFIX+"write-logs-failed"},function(h,m,y){"use strict";var v=this&&this.__awaiter||function(h,m,y,v){return new(y||(y=Promise))((function(C,T){function fulfilled(h){try{step(v.next(h))}catch(h){T(h)}}function rejected(h){try{step(v.throw(h))}catch(h){T(h)}}function step(h){h.done?C(h.value):function adopt(h){return h instanceof y?h:new y((function(m){m(h)}))}(h.value).then(fulfilled,rejected)}step((v=v.apply(h,m||[])).next())}))};Object.defineProperty(m,"__esModule",{value:!0});const C=y(15),T=y(363);m.LogFilter=class LogFilter{constructor(){this.trace=new C.TraceSource("Telemetry")}init(){return v(this,void 0,void 0,(function*(){const h=new T.LogFileTraceListener("VSCodeTelemetry");yield h.openAsync(),this.trace.addTraceListener(h)}))}shouldSend(h,m,y){const v={eventName:h,properties:m,measures:y};return this.trace.info(JSON.stringify(v,null,2)),!0}}},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0});const v=y(15);m.traceSource=new v.TraceSource("Client")},function(h,m,y){"use strict";var v=this&&this.__awaiter||function(h,m,y,v){return new(y||(y=Promise))((function(C,T){function fulfilled(h){try{step(v.next(h))}catch(h){T(h)}}function rejected(h){try{step(v.throw(h))}catch(h){T(h)}}function step(h){h.done?C(h.value):function adopt(h){return h instanceof y?h:new y((function(m){m(h)}))}(h.value).then(fulfilled,rejected)}step((v=v.apply(h,m||[])).next())}))};Object.defineProperty(m,"__esModule",{value:!0});const C=y(8),T=y(156),w={shouldAllowConcurrentExperiments:!1},A="vscode-vsls-commands-ab-tests";m.ABTester=class ABTester{constructor(h,m){this.settingsStorage=h,this.isFirstInitialization=m}initialize(h){return v(this,void 0,void 0,(function*(){this.options=h;const{settingsStorage:m,abTests:y,isFirstInitialization:v}=h;if(this.settingsStorage=m||this.settingsStorage,this.isFirstInitialization=null!=v?v:this.isFirstInitialization,!this.settingsStorage.get(A)){const h={currentTests:{},evaluatedTests:{}};yield this.settingsStorage.update(A,h)}for(let h=0;h<y.length;h++)y[h]=Object.assign(Object.assign({},w),y[h]);yield this.initializeTests(),yield this.addTelemetry()}))}addTelemetry(){return v(this,void 0,void 0,(function*(){const h=yield this.isPartOfAnyExperiment();C.Telemetry.addContextProperty(T.TelemetryPropertyNames.CURRENT_AB_EXPERIMENT,h),C.Telemetry.addContextProperty(T.TelemetryPropertyNames.COUNT_OF_CONCURRENT_AB_EXPERIMENTS,yield this.getCountOfCurrentExperiments()),C.Telemetry.addContextProperty(T.TelemetryPropertyNames.CURRENT_AB_EXPERIMENT_GROUP,yield this.isPartOfExperiment(h))}))}initializeTests(){return v(this,void 0,void 0,(function*(){for(let h of this.options.abTests)(yield this.isPartOfAnyExperiment())&&!h.shouldAllowConcurrentExperiments||(yield this.initializeTest(h))}))}cleanUpOldTest(h){const m=this.settingsStorage.get(A);m.evaluatedTests[h.name]&&delete m.evaluatedTests[h.name],m.currentTests[h.name]&&delete m.currentTests[h.name],this.settingsStorage.update(A,m)}initializeTest(h){return v(this,void 0,void 0,(function*(){const{enabledTests:m}=this.options,y=m[h.name];if(y||this.cleanUpOldTest(h),h.shouldStartOnFirstRunOnly&&!this.isFirstInitialization)return;const v=this.settingsStorage.get(A),C=!(yield this.isPartOfAnyExperiment()),T=!v.evaluatedTests[h.name];if(C&&T&&y){const m=this.initializeGroupForTest(h,v);m&&(v.currentTests[h.name]={currentGroup:m}),this.settingsStorage.update(A,v)}}))}initializeGroupForTest(h,m){const y=Math.random();let v=0;for(let m of h.groups){let h=v+m.probability;if(y>v&&y<=h)return;v=h}m.evaluatedTests[h.name]=!0}isPartOfExperiment(h){return v(this,void 0,void 0,(function*(){if(!h)return null;const m=this.settingsStorage.get(A).currentTests[h];return m?m.currentGroup:null}))}isPartOfAnyExperiment(){return v(this,void 0,void 0,(function*(){const h=this.settingsStorage.get(A);return Object.keys(h.currentTests)[0]||null}))}getCountOfCurrentExperiments(){return v(this,void 0,void 0,(function*(){const h=this.settingsStorage.get(A);return Object.keys(h.currentTests).length}))}}},function(h,m,y){"use strict";var v=this&&this.__awaiter||function(h,m,y,v){return new(y||(y=Promise))((function(C,T){function fulfilled(h){try{step(v.next(h))}catch(h){T(h)}}function rejected(h){try{step(v.throw(h))}catch(h){T(h)}}function step(h){h.done?C(h.value):function adopt(h){return h instanceof y?h:new y((function(m){m(h)}))}(h.value).then(fulfilled,rejected)}step((v=v.apply(h,m||[])).next())}))};Object.defineProperty(m,"__esModule",{value:!0});const C=y(155),T=y(124),w=y(218),A=y(156),P=y(122),k=y(213),R=y(8),isCurrentExtensionDirectory=(h,m)=>{const{source:y,name:v}=m,A=C.join(y,v),P=w.loadJSON(C.resolve(h,"./package.json"));return!!T.fileAccess.lstatSync(A).isDirectory()&&new RegExp(`^${P.publisher}\\.${P.name}-[0-9]`).test(v)},getCurrentExtensionDirectories=()=>v(void 0,void 0,void 0,(function*(){k.throwNotInitialized(P.extensionContext);const h=P.extensionContext.extensionPath;return(yield T.fileAccess.readdirAsync(h)).map(m=>({source:h,name:m})).filter(isCurrentExtensionDirectory.bind(null,h))}));m.isExtensionBeingUpdated=()=>v(void 0,void 0,void 0,(function*(){try{return(yield getCurrentExtensionDirectories()).length>1}catch(h){return!1}})),m.isFirstActivation=h=>v(void 0,void 0,void 0,(function*(){k.throwNotInitialized(P.extensionContext);const{globalState:m}=P.extensionContext,y=`${h.name}-first-activation-flag`;let v=!1;return m.get(y)||(yield m.update(y,h.version),v=!0),R.Telemetry.addContextProperty(A.TelemetryPropertyNames.IS_FIRST_ACTIVATION,v),v}))},function(h,m,y){"use strict";var v=this&&this.__awaiter||function(h,m,y,v){return new(y||(y=Promise))((function(C,T){function fulfilled(h){try{step(v.next(h))}catch(h){T(h)}}function rejected(h){try{step(v.throw(h))}catch(h){T(h)}}function step(h){h.done?C(h.value):function adopt(h){return h instanceof y?h:new y((function(m){m(h)}))}(h.value).then(fulfilled,rejected)}step((v=v.apply(h,m||[])).next())}))};Object.defineProperty(m,"__esModule",{value:!0});const C=y(847),T=y(15);m.lockAgent=function lockAgent(h,m,y){return v(this,void 0,void 0,(function*(){const v={stale:6e4,retries:60,retryWait:1e3},w=h+".lock",A=yield new Promise(h=>{C.check(w,v,(m,y)=>h(!!y))});A&&y.verbose("Agent is being started by another vscode instance. Waiting for completion..."),y.verbose(`Agent lock on:${T.TraceFormat.formatPath(w)}`),yield new Promise((h,m)=>C.lock(w,v,v=>{v?(y.error("Failed to lock the agent"),m(v)):h(!0)}));try{A||(yield m(),y.verbose("Finished agent startup..."))}finally{C.unlock(w,()=>{y.verbose("Agent unlocked")})}}))}},function(h,m,y){var v=y(21),C="wx";if(process.version.match(/^v0\.[0-6]/)){var T=y(68);C=T.O_TRUNC|T.O_CREAT|T.O_WRONLY|T.O_EXCL}var w,A=y(18);m.filetime="ctime","win32"==A.platform()&&(m.filetime="mtime");var P=y(10);w=P.debuglog?P.debuglog("LOCKFILE"):/\blockfile\b/i.test(process.env.NODE_DEBUG)?function(){var h=P.format.apply(P,arguments);console.error("LOCKFILE %d %s",process.pid,h)}:function(){};var k={};y(366)((function(){w("exit listener"),Object.keys(k).forEach(m.unlockSync)})),/^v0\.[0-8]\./.test(process.version)&&(w("uncaughtException, version = %s",process.version),process.on("uncaughtException",(function H(h){if(w("uncaughtException"),!process.listeners("uncaughtException").filter((function(h){return h!==H})).length){try{Object.keys(k).forEach(m.unlockSync)}catch(h){}throw process.removeListener("uncaughtException",H),h}}))),m.unlock=function(h,m){w("unlock",h),delete k[h],v.unlink(h,(function(h){m&&m()}))},m.unlockSync=function(h){w("unlockSync",h);try{v.unlinkSync(h)}catch(h){}delete k[h]},m.check=function(h,y,C){"function"==typeof y&&(C=y,y={}),w("check",h,y),v.open(h,"r",(function(h,T){return h?"ENOENT"!==h.code?C(h):C(null,!1):y.stale?void v.fstat(T,(function(h,w){if(h)return v.close(T,(function(m){return C(h)}));v.close(T,(function(h){var v=Date.now()-w[m.filetime].getTime();return C(h,v<=y.stale)}))})):v.close(T,(function(h){return C(h,!0)}))}))},m.checkSync=function(h,y){if(w("checkSync",h,y=y||{}),y.wait)throw new Error("opts.wait not supported sync for obvious reasons");try{var C=v.openSync(h,"r")}catch(h){if("ENOENT"!==h.code)throw h;return!1}if(!y.stale){try{v.closeSync(C)}catch(h){}return!0}if(y.stale){try{var T=v.fstatSync(C)}finally{v.closeSync(C)}return Date.now()-T[m.filetime].getTime()<=y.stale}};var R=1;function notStale(h,y,v,C){if(w("notStale",y,v),"number"!=typeof v.wait||v.wait<=0)return w("notStale, wait is not a number"),C(h);var T=Date.now(),A=v.start||T,P=A+v.wait;if(P<=T)return C(h);w("now=%d, wait until %d (delta=%d)",A,P,P-A);var k=Math.min(P-A,v.pollPeriod||100);setTimeout((function poll(){w("notStale, polling",y,v),m.lock(y,v,C)}),k)}function retryThrow(h,y,v){if("number"==typeof y.retries&&y.retries>0){var C=y.retries-1;return w("retryThrow",h,y,C),y.retries=C,m.lockSync(h,y)}throw v}m.lock=function(h,y,T){if("function"==typeof y&&(T=y,y={}),y.req=y.req||R++,w("lock",h,y),y.start=y.start||Date.now(),"number"==typeof y.retries&&y.retries>0){w("has retries",y.retries);var A=y.retries;y.retries=0,P=T,T=function cb(v,C){if(w("retry-mutated callback"),A-=1,!v||A<0)return P(v,C);function retry(){y.start=Date.now(),w("retrying",y.start),m.lock(h,y,cb)}w("lock retry",h,y),y.retryWait?setTimeout(retry,y.retryWait):retry()}}var P;v.open(h,C,(function(C,A){return C?(w("failed to acquire lock",C),"EEXIST"!==C.code?(w("not EEXIST error",C),T(C)):y.stale?function maybeStale(h,y,C,T,A){v.stat(y,(function(P,k){return P?"ENOENT"===P.code?(C.stale=!1,w("lock stale enoent retry",y,C),void m.lock(y,C,A)):A(P):Date.now()-k[m.filetime].getTime()<=C.stale?notStale(h,y,C,A):(w("lock stale",y,C),void(T?m.unlock(y,(function(h){if(h)return A(h);w("lock stale retry",y,C),v.link(y+".STALE",y,(function(h){v.unlink(y+".STALE",(function(){A(h)}))}))})):(w("acquire .STALE file lock",C),m.lock(y+".STALE",C,(function(m){if(m)return A(m);maybeStale(h,y,C,!0,A)})))))}))}(C,h,y,!1,T):notStale(C,h,y,T)):(w("locked",h,A),k[h]=A,v.close(A,(function(){return T()})))})),w("lock return")},m.lockSync=function(h,y){if((y=y||{}).req=y.req||R++,w("lockSync",h,y),y.wait||y.retryWait)throw new Error("opts.wait not supported sync for obvious reasons");try{var T=v.openSync(h,C);k[h]=T;try{v.closeSync(T)}catch(h){}return void w("locked sync!",h,T)}catch(C){if("EEXIST"!==C.code)return retryThrow(h,y,C);if(y.stale){var A=v.statSync(h)[m.filetime].getTime();!(A%1e3)&&y.stale%1e3&&(y.stale=1e3*Math.ceil(y.stale/1e3));var P=Date.now()-A;if(P>y.stale)return w("lockSync stale",h,y,P),m.unlockSync(h),m.lockSync(h,y)}return w("failed to lock",h,y,C),retryThrow(h,y,C)}}},function(h,m){h.exports=["SIGABRT","SIGALRM","SIGHUP","SIGINT","SIGTERM"],"win32"!==process.platform&&h.exports.push("SIGVTALRM","SIGXCPU","SIGXFSZ","SIGUSR2","SIGTRAP","SIGSYS","SIGQUIT","SIGIOT"),"linux"===process.platform&&h.exports.push("SIGIO","SIGPOLL","SIGPWR","SIGSTKFLT","SIGUNUSED")},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0});const v=y(18),C=y(7),T=y(21),w=y(41),A=y(850),P=y(216);function execAgentInternal(h,m,y,k,R){const M=Object.assign({},process.env);if(y&&Object.keys(y).forEach(h=>M[h]=y[h]),y&&"1"===y.ELECTRON_RUN_AS_NODE&&m.push("--ms-enable-electron-run-as-node"),v.platform()===P.OSPlatform.WINDOWS){const v=C.join(process.env.SystemRoot||"C:\\WINDOWS","system32","cmd.exe");let P;try{T.statSync(v),P=v}catch(h){P=process.env.ComSpec||"cmd.exe"}const N=`start /B "" "${h}" ${m.join(" ")}`;return k?void A.exec(N,{name:k,env:y},R):w.exec(N,{env:M,shell:P,windowsHide:!0})}{const v=`/bin/sh -c '"${h}" ${m.join(" ")}' &`;return k?void A.exec(`ELECTRON_RUN_AS_NODE=1 /bin/sh -c '"${h}" ${m.join(" ")}' &`,{name:k,env:y},R):w.exec(v,{env:M,windowsHide:!0})}}m.sudoExecAgent=function sudoExecAgent(h,m,y,v){return new Promise((C,T)=>{execAgentInternal(h,m,y,v,(h,m,y)=>{h?T(`sudo exec failed - message: ${h.message} - stack: ${h.stack}`):y&&T(`sudo exec failed - stderr: ${y}`),C(void 0)})})},m.execAgent=function execAgent(h,m,y){return execAgentInternal(h,m,y)}},function(h,m,y){var v={child:y(41),crypto:y(11),fs:y(21),os:y(18),path:y(7),process:process,util:y(10)};function Attempt(h,m){var y=v.process.platform;return"darwin"===y?function Mac(h,m){var y=v.os.tmpdir();if(!y)return m(new Error("os.tmpdir() not defined."));if(!v.process.env.USER)return m(new Error("env['USER'] not defined."));UUID(h,(function(w,A){if(w)return m(w);function end(y,C,T){Remove(v.path.dirname(h.path),(function(h){return y?m(y):h?m(h):void m(void 0,C,T)}))}h.uuid=A,h.path=v.path.join(y,h.uuid,h.options.name+".app"),function MacApplet(h,m){var y=v.path.dirname(h.path);v.fs.mkdir(y,(function(T){if(T)return m(T);var w=v.path.join(y,"sudo-prompt-applet.zip");v.fs.writeFile(w,C,"base64",(function(y){if(y)return m(y);var C=[];C.push("/usr/bin/unzip"),C.push("-o"),C.push('"'+EscapeDoubleQuotes(w)+'"'),C.push('-d "'+EscapeDoubleQuotes(h.path)+'"'),C=C.join(" "),v.child.exec(C,{encoding:"utf-8"},m)}))}))}(h,(function(m,y,C){if(m)return end(m,y,C);!function MacIcon(h,m){if(!h.options.icns)return m();v.fs.readFile(h.options.icns,(function(y,C){if(y)return m(y);var T=v.path.join(h.path,"Contents","Resources","applet.icns");v.fs.writeFile(T,C,m)}))}(h,(function(m){if(m)return end(m);!function MacPropertyList(h,m){var y=EscapeDoubleQuotes(v.path.join(h.path,"Contents","Info.plist")),C=EscapeDoubleQuotes("CFBundleName"),T=h.options.name+" Password Prompt";if(/'/.test(T))return m(new Error("Value should not contain single quotes."));var w=[];w.push("/usr/bin/defaults"),w.push("write"),w.push('"'+y+'"'),w.push('"'+C+'"'),w.push("'"+T+"'"),w=w.join(" "),v.child.exec(w,{encoding:"utf-8"},m)}(h,(function(m,y,C){if(m)return end(m,y,C);!function MacCommand(h,m){var y=v.path.join(h.path,"Contents","MacOS","sudo-prompt-command"),C=[];for(var T in C.push('cd "'+EscapeDoubleQuotes(v.process.cwd())+'"'),h.options.env){var w=h.options.env[T];C.push("export "+T+'="'+EscapeDoubleQuotes(w)+'"')}C.push(h.command),C=C.join("\n"),v.fs.writeFile(y,C,"utf-8",m)}(h,(function(m){if(m)return end(m);!function MacOpen(h,m){var y=v.path.join(h.path,"Contents","MacOS","applet"),C={cwd:v.path.dirname(y),encoding:"utf-8"};v.child.exec("./"+v.path.basename(y),C,m)}(h,(function(m,y,C){if(m)return end(m,y,C);!function MacResult(h,m){var y=v.path.join(h.path,"Contents","MacOS");v.fs.readFile(v.path.join(y,"code"),"utf-8",(function(C,w){if(C){if("ENOENT"===C.code)return m(new Error(T));m(C)}else v.fs.readFile(v.path.join(y,"stdout"),"utf-8",(function(C,T){if(C)return m(C);v.fs.readFile(v.path.join(y,"stderr"),"utf-8",(function(y,v){if(y)return m(y);0===(w=parseInt(w.trim(),10))?m(void 0,T,v):((y=new Error("Command failed: "+h.command+"\n"+v)).code=w,m(y,T,v))}))}))}))}(h,end)}))}))}))}))}))}))}(h,m):"linux"===y?function Linux(h,m){!function LinuxBinary(h,m){var y=0,C=["/usr/bin/kdesudo","/usr/bin/pkexec"];!function test(){if(y===C.length)return m(new Error("Unable to find pkexec or kdesudo."));var h=C[y++];v.fs.stat(h,(function(y){if(y){if("ENOTDIR"===y.code)return test();if("ENOENT"===y.code)return test();m(y)}else m(void 0,h)}))}()}(0,(function(y,C){if(y)return m(y);var P=[];for(var k in P.push('cd "'+EscapeDoubleQuotes(v.process.cwd())+'";'),h.options.env){var R=h.options.env[k];P.push("export "+k+'="'+EscapeDoubleQuotes(R)+'";')}P.push('"'+EscapeDoubleQuotes(C)+'"'),/kdesudo/i.test(C)?(P.push("--comment",'"'+h.options.name+' wants to make changes. Enter your password to allow this."'),P.push("-d"),P.push("--")):/pkexec/i.test(C)&&P.push("--disable-internal-agent");var M="SUDOPROMPT\n";P.push('/bin/bash -c "echo '+EscapeDoubleQuotes(M.trim())+"; "+EscapeDoubleQuotes(h.command)+'"'),P=P.join(" "),v.child.exec(P,{encoding:"utf-8",maxBuffer:A},(function(h,y,v){var C=y&&y.slice(0,M.length)===M;C&&(y=y.slice(M.length)),h&&!C&&(/No authentication agent found/.test(v)?h.message=w:h.message=T),m(h,y,v)}))}))}(h,m):"win32"===y?function Windows(h,m){var y=v.os.tmpdir();if(!y)return m(new Error("os.tmpdir() not defined."));UUID(h,(function(C,w){return C?m(C):(h.uuid=w,h.path=v.path.join(y,h.uuid),/"/.test(h.path)?m(new Error("instance.path cannot contain double-quotes.")):(h.pathElevate=v.path.join(h.path,"elevate.vbs"),h.pathExecute=v.path.join(h.path,"execute.bat"),h.pathCommand=v.path.join(h.path,"command.bat"),h.pathStdout=v.path.join(h.path,"stdout"),h.pathStderr=v.path.join(h.path,"stderr"),h.pathStatus=v.path.join(h.path,"status"),void v.fs.mkdir(h.path,(function(y){if(y)return m(y);function end(y,v,C){Remove(h.path,(function(h){return y?m(y):h?m(h):void m(void 0,v,C)}))}!function WindowsWriteExecuteScript(h,m){var y=[];y.push("@echo off"),y.push('call "'+h.pathCommand+'" > "'+h.pathStdout+'" 2> "'+h.pathStderr+'"'),y.push('(echo %ERRORLEVEL%) > "'+h.pathStatus+'"'),y=y.join("\r\n"),v.fs.writeFile(h.pathExecute,y,"utf-8",m)}(h,(function(m){if(m)return end(m);!function WindowsWriteCommandScript(h,m){var y=v.process.cwd();if(/"/.test(y))return m(new Error("process.cwd() cannot contain double-quotes."));var C=[];for(var T in C.push("@echo off"),C.push("chcp 65001>nul"),C.push('cd /d "'+y+'"'),h.options.env){var w=h.options.env[T];C.push("set "+T+"="+w.replace(/([<>\\|&^])/g,"^$1"))}C.push(h.command),C=C.join("\r\n"),v.fs.writeFile(h.pathCommand,C,"utf-8",m)}(h,(function(m){if(m)return end(m);!function WindowsElevate(h,m){var y=[];y.push("powershell.exe"),y.push("Start-Process"),y.push("-FilePath"),y.push("\"'"+h.pathExecute.replace(/'/g,"`'")+"'\""),y.push("-WindowStyle hidden"),y.push("-Verb runAs"),y=y.join(" "),v.child.exec(y,{encoding:"utf-8"},(function(h,y,v){if(h)return m(new Error(T),y,v);m()})).stdin.end()}(h,(function(m,y,C){if(m)return end(m,y,C);!function WindowsWaitForStatus(h,m){v.fs.stat(h.pathStatus,(function(y,C){y&&"ENOENT"===y.code||C.size<2?setTimeout((function(){v.fs.stat(h.pathStdout,(function(y){if(y)return m(new Error(T));WindowsWaitForStatus(h,m)}))}),1e3):y?m(y):m()}))}(h,(function(m){if(m)return end(m);!function WindowsResult(h,m){v.fs.readFile(h.pathStatus,"utf-8",(function(y,C){if(y)return m(y);v.fs.readFile(h.pathStdout,"utf-8",(function(y,T){if(y)return m(y);v.fs.readFile(h.pathStderr,"utf-8",(function(y,v){if(y)return m(y);0===(C=parseInt(C.trim(),10))?m(void 0,T,v):((y=new Error("Command failed: "+h.command+"\r\n"+v)).code=C,m(y,T,v))}))}))}))}(h,end)}))}))}))}))}))))}))}(h,m):void m(new Error("Platform not yet supported."))}function EscapeDoubleQuotes(h){if("string"!=typeof h)throw new Error("Expected a string.");return h.replace(/"/g,'\\"')}function Remove(h,m){if("string"!=typeof h||!h.trim())return m(new Error("Argument path not defined."));var y=[];if("win32"===v.process.platform){if(/"/.test(h))return m(new Error("Argument path cannot contain double-quotes."));y.push('rmdir /s /q "'+h+'"')}else y.push("/bin/rm"),y.push("-rf"),y.push('"'+EscapeDoubleQuotes(v.path.normalize(h))+'"');y=y.join(" "),v.child.exec(y,{encoding:"utf-8"},m)}function UUID(h,m){v.crypto.randomBytes(256,(function(y,C){y&&(C=Date.now()+""+Math.random());var T=v.crypto.createHash("SHA256");T.update("sudo-prompt-3"),T.update(h.options.name),T.update(h.command),T.update(C);var w=T.digest("hex").slice(-32);if(!w||"string"!=typeof w||32!==w.length)return m(new Error("Expected a valid UUID."));m(void 0,w)}))}function ValidName(h){return!!/^[a-z0-9 ]+$/i.test(h)&&(0!==h.trim().length&&!(h.length>70))}h.exports.exec=function Exec(){if(arguments.length<1||arguments.length>3)throw new Error("Wrong number of arguments.");var h=arguments[0],m={},end=function(){};if("string"!=typeof h)throw new Error("Command should be a string.");if(2===arguments.length)if(v.util.isObject(arguments[1]))m=arguments[1];else{if(!v.util.isFunction(arguments[1]))throw new Error("Expected options or callback.");end=arguments[1]}else if(3===arguments.length){if(!v.util.isObject(arguments[1]))throw new Error("Expected options to be an object.");if(m=arguments[1],!v.util.isFunction(arguments[2]))throw new Error("Expected callback to be a function.");end=arguments[2]}if(/^sudo/i.test(h))return end(new Error('Command should not be prefixed with "sudo".'));if(void 0===m.name){var y=v.process.title;if(!ValidName(y))return end(new Error("process.title cannot be used as a valid name."));m.name=y}else if(!ValidName(m.name)){var C="";return C+="options.name must be alphanumeric only ",C+="(spaces are allowed) and <= 70 characters.",end(new Error(C))}if(void 0!==m.icns){if("string"!=typeof m.icns)return end(new Error("options.icns must be a string if provided."));if(0===m.icns.trim().length)return end(new Error("options.icns must not be empty if provided."))}if(void 0!==m.env){if("object"!=typeof m.env)return end(new Error("options.env must be an object if provided."));if(0===Object.keys(m.env).length)return end(new Error("options.env must not be empty if provided."));for(var T in m.env){var w=m.env[T];if("string"!=typeof T||"string"!=typeof w)return end(new Error("options.env environment variables must be strings."));if(!/^[a-zA-Z_][a-zA-Z0-9_]*$/.test(T))return end(new Error("options.env has an invalid environment variable name: "+JSON.stringify(T)));if(/[\r\n]/.test(w))return end(new Error("options.env has an invalid environment variable value: "+JSON.stringify(w)))}}var A=v.process.platform;if("darwin"!==A&&"linux"!==A&&"win32"!==A)return end(new Error("Platform not yet supported."));var P={command:h,options:m,uuid:void 0,path:void 0};Attempt(P,end)};var C="UEsDBAoAAAAAAO1YcEcAAAAAAAAAAAAAAAAJABwAQ29udGVudHMvVVQJAAPNnElWLZEQV3V4CwABBPUBAAAEFAAAAFBLAwQUAAAACACgeXBHlHaGqKEBAAC+AwAAEwAcAENvbnRlbnRzL0luZm8ucGxpc3RVVAkAA1zWSVYtkRBXdXgLAAEE9QEAAAQUAAAAfZNRb5swFIWfl1/BeA9OpSmqJkqVBCJFop1VyKQ9Ta59S6wa27NNCfv1M0naJWTsEXO+c8+9vo7v97UI3sBYruRdeBPNwgAkVYzL6i7cluvpbXifTOLP6bdV+QNngRbcugBvl/lmFYRThBZaC0AoLdMA55uiDLwHQtljGIQ75/RXhNq2jUiviqiqe6FF2CgNxnW5N5t6IGKOhb7M0f0ijj9lnLpk8il+hS5ZrZeNZAIWQqj2ge+B5YoSwX8T5xEbo17ktc40gIZQCm8glK5BuieovP5Dbp3xHSeZrHyCXYxO3wM+2wNtHHkWMAQP/bkxbkOVXPMxKuK0Dz6CMh+Wv3AwQ9gPM7INU1NtVK3Ha8sXlfoB+m6J6b4fRzv0mkezMf6R1Fe5MbG2VYYF+L+lMaGvpIKy01cOC4zzMazYKeNOQYuDYkjfjMcteCWJa8w/Zi2ugubFA5e8buqisw7qU81ltzB0xx3QC5/TFh7J/e385/zL+7+/wWbR/LwIOl/dvHiCXw03YFfEPJ9dwsWu5sV2kwnod3QoeLeL0eGdJJM/UEsDBAoAAAAAAHSBjkgAAAAAAAAAAAAAAAAPABwAQ29udGVudHMvTWFjT1MvVVQJAAMbpQ9XLZEQV3V4CwABBPUBAAAEFAAAAFBLAwQUAAAACABVHBdH7Dk4KTIIAADIYQAAFQAcAENvbnRlbnRzL01hY09TL2FwcGxldFVUCQADMiPZVVOlD1d1eAsAAQT1AQAABBQAAADtnG9sHEcVwGfti7M1/rONLNVtXHqpzsipis+pHOSWFOzEm25at3XrJI2ozbK+W/suuds79vaSuCKSpaOIxRy1+NSPRPAhlWj7AVRaQCWpTRz+CEo+RSKCCho4K67kVhUyAeV4b3fWt17fXZqKFgHvp8zO3/dmdmfPmtl5L7+8/uPXGWMNELZCaGRMgmjHIlxaBCibdcoGsewCljGCIAiCIAiCIAiCIP7r+M21d67zjb/zEaAdwr1bGHuWMQH2/2wAgqqODj0kf0F+8nGfoFRbJ8p9U0C5g/KRgwEZqZLGfrfwwJx+LP2kVWkelD9zJ2NfBr1nWt2xrhNisxWZ3Ex6MpNSc1Z+soqOO+5i7JMYt7vj9BC5jiZXBwirCT2V1c0qOgZAxwMYt9cbRyxnmUljusa9mKBjGON2tgG/PlXNGyeSRlxNGlOZKjpeBR0KxsFx+MB7VJy5GB46OOSrCLPKfEjrH3/gFry+4zOpuH8sm+VF5srW6ltVjZQ3HVnL3KRDDLsflMSADpyDyjuR0urp6AAdHRgHdOD9iOs6Ypl0OmPUupeecOW19OsQAmn3tzBy4LFH5OED3jz0MbYouM8D460BOdTXCaEF6tsgLkF8GeJPQBj16Rb4PTf5xl2NH4J8a5Vy1N3F3OcZzefMaCo5GeVTuJ2P4cUf/aH5qbbP73/utpfeevdbLzwfYfy+Q80woGan/1E+ljo/703g77IaOJY479t5rqFLDag9OjaTs/R0dCQ5aWrmTHS/qaX1ExnzWC66L2PqY7p5PBnTc71TXnn0sG7mkhkjFx3a0IL30e/rQxB+EXL68J4BBLe73r298DySk5tlGPtJY1BmOhZTc727PBH2Ke+ZhF35nTyP80oQBEEQBPFRcJTZVwpvrxZWpLmJkN0VKT4q2iORUGFBOPfnBuFX9nhELOG67f1D9pWxpw4XVrrmTklz+ZY5Wfwurm/t3ffi9cE+uM41vYbbj2fP5kNXt9sXiopwVRj6xhPlr160mttfuVi4Fs2vXv2rfc5u7UeZfxQ+y4pPh/JrpyUUBjmrofzmadGXKf0eui7KK/ZwJLQUiuRAe+mLUFQ+tFKUV3npd7AU9ytz8iqIiXYoUnoBsqdxDbXk3CXcRov9lYhoW5EQjBxb4NoSY9iQsvn5+QSuusrduAybL3eHIIIbLqyIS9CHlY3loB8rldVKuLfyOsE1+a6zhUVxYsFp3Amqz8tr7Lz8dza1JF8TmC3/syivYVtcfxcWOycWQDvuLcrdnc61y7mGnWsErgmsXDbK5TKkscnypJvGhsuH3TQ2X37YTaPQ8ucw7W6t1LR2TFfjekqb0SGTiedTOmz0klZSSyWf0U01pqVSufXGmThsjs20OpU3Yrjuxbnu4u+GP8b1LO6PcX2L4Q6+v8Q07u9aQFLy71Ckt54TIfjfNdzfDkMYhTAOIXHXh39vCYIgCIIgCIIgCIL4z3Nm+84/Ci1Nn8b0ryHsgbBX1rbgOXD7LZJzNtrC0/gFqYOn8csQ/GONguQchPXzcvy+9CBzvk84HxkO+tJH3bRz5Fb0pb/nS3/fl/6BL/2aL43faLzz3Wbmju8W5p6pttaoR9THjgyZ0zEeH2eqqmbNzLShpXVIpxOqflKP5S1dTehaXDeZqhvHk2bGYOo+LZXal0lnM4ZuWMPJXFazYgmmPp7VjWF9SsunrPVa1HpMn0lPm2r8hGZO3aea+nQyZ+mmmtNjFp5i4oG0lTChE+eDj2pm8lbSgDFoln4yCRp00zQyEDmZtBZLbGxnanHzgWh092d29e/uv+/f+DIQBEEQBEEQBEEQ/7P81rX/FxoZm/Xs/5UmtP8PO/W3M9fGvKoPAEfYXLQJ1HOpmk+AJx80OOb5m/URGG9z9c378rVs9F15tPXP1dS3wvVtC+Q9/H4DFX21fQcY9zvo9eXrj6++D0Af1zfqy9eyx3f16QnVMayufr+zXN+sL99YRx/O69er+RdIgXkNxJv9DfBTDIxLPa6Zudr6enz5euO6ke9Bj7TRzr0noK+JbczfyA9hgOvr9OX98t57XNFX3ydhlOsL+2T8+oK/ucrvNOCfEHbbXhAqeebLB/0V7oYp7+Pt8PsZWnl1+urRpAn7SUCcYBX/hkth95kd2cFYllX3bxB4+xCrzcCO6v4PbXzo1fwbEM/H4ds/f/nCgZH+8k+j0vNPv7Jlz7qPQ1PFx+FVPoZ76ozj42K87YP9/cT7xuf9UfpSeP0MsJvzp0A8/4g3w+78ef4R+F4QBEEQBPH/w1Gm2FeUwturytwpUSnmJfta4Q3h3J8aFeE9xf7d1ZBSOCcqhftZ/m+YKuG6wV4qaQzdGED0Z2jJ/zpa9ZcegjIF7fkVaIBrt11nJxYOOepXpPPyKjsvvytOLcnvCWxJfh87V+xTa0rx1Kpj0a8UFqWJhXL3fgHt9xXn+rCz7Bop3rkTEkNj5e7bIZ7HNRZb/ku5XE6g58HyZUzdj6mLjh1/Pbt7XMt5dvfvtLl1Fbv7BtbhrtyEPW6V038H1yE88yQTTkqC1LJVnIeaCNe7dr3sEPEe6lCb9LWGfa3efvNG8pe5fF8NeW8g3n7jCI+/xOOEVH19KvF9oudHH2n/YOtYgiAIgiAIgiAIgiA+fm69mx3aO8bYtkHn/xlwDq8nkwaavz9h9swzc+DWwRrm71A5CJVVjeChTtk26Fqwu0fxQjUL+9vqHVV/KC53OUd+bJxVfBkw7/gzCO5pr3dOK/g+WUQDeZlV/A2QRwJ5THjn1/xcd9BfhlT1KbgpVwLn+W2amGr2//8CUEsDBBQAAAAIAAVHj0ga7FYjfQEAAKoCAAAhABwAQ29udGVudHMvTWFjT1Mvc3Vkby1wcm9tcHQtc2NyaXB0VVQJAAOJkBBXipAQV3V4CwABBPUBAAAEFAAAAI1SO08cMRDu91cMHIKGxUB5xSGEUqTlFKWMvPYca+EXnjGXy6/PeNcg0qVay+PvObs5U5OLatI0DxvYIwNVm4BdQGIdMhxSkauJ8K1i7FOjvSdwB2A+/WJnXpEJdEGwjvTk0W6HhTW8WldgzKDedVF2Ug2tLn7svz3DDpTFdxWr93C/u7wbVKWyoDhVM/8XZAOPOXvcm+IyXxGcizeaUca0XJ1D0CfQnlEysE2VwbuII0br4gvdCMF37m9IoC39+oxTO2EpS8oZJdtRS0aIKY5/sCQoyLVEMMki6Ghl0BGN9SeuICkPIctXDHDDSB9oGEQi1yZWUAda8EZnIcR/eIOOVao+9TrbkpYFjLmkkHk0KYSGvdt12/e71cP6Hs2c4OJBemtsYusplVX+GLHQ7DKkQ098/ZF38dLEpRCeNUMlMW90BIseeQkWtuu2qKmIyDHCuqFuo1N11Ud/1Cf6CHb7Sfxld2ATklQoUGEDActfZ5326WU74G/HcDv8BVBLAwQKAAAAAADtWHBHqiAGewgAAAAIAAAAEAAcAENvbnRlbnRzL1BrZ0luZm9VVAkAA82cSVYqkRBXdXgLAAEE9QEAAAQUAAAAQVBQTGFwbHRQSwMECgAAAAAAm3lwRwAAAAAAAAAAAAAAABMAHABDb250ZW50cy9SZXNvdXJjZXMvVVQJAANW1klWLZEQV3V4CwABBPUBAAAEFAAAAFBLAwQUAAAACACAeXBHfrnysfYGAAAf3AAAHgAcAENvbnRlbnRzL1Jlc291cmNlcy9hcHBsZXQuaWNuc1VUCQADH9ZJVnGlD1d1eAsAAQT1AQAABBQAAADt3Xk81Hkcx/Hvb5yVo5bGsVlKbcpRRqFlGZGS5JikRBIdI0OZttMZloqiYwrVjD1UqJaUokTRubG72bZVjqR1VZNjp2XEGo9H+9gt+9h/9tHx8H7N4/fw5MHjYeaPz+P7+P7x/bL9griEPNBm+001J0S+ZbvL/NmKwzWHE0IUHebYuRFCEckjL9v/xSvk2EpCpBXZtrYuDra2Oi4hwSvZgSsIMU9MdPdePcZd1aqQu0p3fDkrcFrs+mPWihMU9y6clp5XEFFdbRrEczCtGtfkL3pWfvBGublJ4ct051kuocYtaaqll/IjdfR+V75vlTdl//AJVZU6elZ5f0S7NO3MaE2xMElhF+TUrHgW2nFYeGTrs/OrhDJN5zMX8ZJVKXrqSUM1Rj03bnf85/pJMXECNdl0D1ctfe/j82imziM2nllSa3t5q8+vP1f38k/k22uN1lmnvfz0b8dGxO+mnh91v7WB2tKdrG3d4vmJaHlTvjGzdMqWcw/9frnCtQpPZK9sMKi/Ey/jzgqIPzBy9/dlf9griI2/u+sjcApozWx6/NXytC+qBTlrhb69fE7J6tgOzpWjFSl8qxihr5dYf/qExoeupY6Ze/j2PfL1azhhZ8fU3eelJY+ylk16UJN6KmOU0M4r+75cZhH/mxNndowNb4wx7TCoN4yvMGu8ySq5l5W5t+xQyYbS/Ome7e0W0sXbC5aktl0LEXNYR9obH7dMT721dbNdT/eFzXNEYSH8GU+bQ5s6YniGcj3fHtgXPbo0Oj4i3d5G1Fjfm/Ng7kgpjQDNxw4RRnu+Vloy5ZE3J6OpwlFBzaxS25He2h3lJuizO70zJPLUYtks14RE5yrD8y2tXa5l5Wqh/NBY06yoiCLF08Nk9A5Ojbs43GmR1Ch/PaZsLf3e6uPRSrIM1ROqGjt80leqfdxYbNn+WV7K7ZKiy/t6r1/3ie46V5432T/Oahs9V7NnVzb9zoq2rFgvPxXrcAMzmvWnGjof/RpdsZThIEpex6DGbd5h6STaOyZXxV/YfW9u4KyllmZ3X15IMHHLSJtVPSOvULCsz2TyPC/WL9kGSme/1L01SSzjfbHnqk+OV7OBmevZeo3DBR7lXT5drT0MkX5PwDd1EQ0ebfkh1zy/L8ydd+VJ4CLuRndNjuwj+vMfU8q2l2l1rGtr8FC2D+fdSGk81eltuTjYSMk++4BMd0DXQo35iXbZndGdcXkGFyeG6b28evF22M2w22HlYSXetGSLW4cfFT00WqvN9bkqCujQ9KzdSt+snr+qmbcme+5Y3cDRn9BDLps+dPVltE9UkPeb6XovineiVUznTznyuZaSn/ZvR8VeRUYLqe3iHFqnU6+7+4LmtfsmaS0MdjIvslFJGG/rn7DPdMGLcx4d6eP2Oz92Y49kWbBUjudU2ijHnc7YIODQxD1aPx8PynVr+cmvJoy2+M5nQa2Kt0dvdPxp73LNU6aTeaktTfHH1L+8Pm/XalZcFcfzYxlhTefuzjRGobLKEqPZh8QKxUXWbU/ERvW78ghvTGTUNd0g9YqbcjUy5h0xVbn3S7SS54SOqKt88UR0qZuxKfxlZfODUm52o2HkGTOLw5dqhevvWjH7ssiqxAhKwA91d1nWG9w/GJIc7GwWbKKe/mAsGRqXBb87P10jH8/0LY6kpGQV1KcuAwAAeCt4LiVFWRJKs4DJ6p9GxGHWfLuTM5dt61/pzCCE7vLmSodGJM/ASqdzU2U3VjpY6WClg5XOICudUaI3VjocuWCsdAAAAAAAAAAAAAAAAD5o1Gmr054TSoqWxPvnfrLxVEIc29/cT5YmkmdgPzlCSz8a+8nYT8Z+MvaTB9lPZpJX+8lRktFyRdDF0m6IdcF2MgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAC8ddD8G5oJkUuQnAXwnvxLAAAAADDkEFURRckVE6rIv+Tb1078MiZEetubJ34RHckzcOIXd8uWTpz4hRO/cOIXTvwa5MQvoidZ5S8a9h8nfl1QVhipQ6jyyWeuvTaBGP3D5fwgE4gpeQYmUCZ7XQ0mECYQJhAm0GATyOfVmYOU4sAdNi+cOUpm/9cdNv2Di8kkFN3mYOtrg8sE14xicGFwYXDhmlEAAD5w/Os1o8bTcM0oVjpY6WClg2tGAQAAAAAAAAAAAAAAgL/wb9eMBpow+r817yN/fwnJf33P5g78nWofEZNXD3u95GdSkh3o135/aL2i3vl/gHf/7t59oDlnDSHS8gQhNGQL8uWs6P+iwPYLDuIOzARqyM+E9QOfA3PIfw4IIYQQQgghhBBCCCGEEEIIIYQQQgghhBBCCCGEEEIIIYQQQgghhND70J9QSwMEFAAAAAgA7VhwR/dYplZAAAAAagEAAB4AHABDb250ZW50cy9SZXNvdXJjZXMvYXBwbGV0LnJzcmNVVAkAA82cSVZTpQ9XdXgLAAEE9QEAAAQUAAAAY2BgZGBgYFQBEiDsxjDygJQDPlkmEIEaRpJAQg8kLAMML8bi5OIqIFuouKA4A0jLMTD8/w+S5AdrB7PlBIAEAFBLAwQKAAAAAADtWHBHAAAAAAAAAAAAAAAAJAAcAENvbnRlbnRzL1Jlc291cmNlcy9kZXNjcmlwdGlvbi5ydGZkL1VUCQADzZxJVi2REFd1eAsAAQT1AQAABBQAAABQSwMEFAAAAAgA7VhwRzPLNU9TAAAAZgAAACsAHABDb250ZW50cy9SZXNvdXJjZXMvZGVzY3JpcHRpb24ucnRmZC9UWFQucnRmVVQJAAPNnElWU6UPV3V4CwABBPUBAAAEFAAAACWJOw6AIBAFe08DCBVX2QbWhZgQ1vCpCHcXtHkzkzegtCDB5Xp/g0+UyihARnb70kL/UbvffYpjQODcmk9zKXListxCoUsZA7EQ5S0+dVq085gvUEsDBAoAAAAAAIeBjkgAAAAAAAAAAAAAAAAbABwAQ29udGVudHMvUmVzb3VyY2VzL1NjcmlwdHMvVVQJAAM9pQ9XLZEQV3V4CwABBPUBAAAEFAAAAFBLAwQUAAAACAAJgI5ICl5liTUBAADMAQAAJAAcAENvbnRlbnRzL1Jlc291cmNlcy9TY3JpcHRzL21haW4uc2NwdFVUCQADcaIPV1OlD1d1eAsAAQT1AQAABBQAAAB9UMtOAkEQrNldd9dhH3Dz6NGYiPIJHjTxLCZeF9iDcXEJC0RvfoI/4sEfIvoHPEQEhbIHvOok01U16emu7vOkaF2dXu7XqrUTcyMATkxCwYKthCAUbmciAQ8O11yFcGBfbF/4jR24WmCvWjwUeXqfNutn13XyEeYYHkqKam+kghdJGfUCvwIfB6jiGAX6aCHHETroCrYFe6IKNEXfGOXChc0v7HKpBRzdSFrtELvbumKVC80F/FIjzwe9bj91uZRuXJuwAiLjNi7DlsxPaJSUAMrCFOeac3GfpINennQ6d/0sA4z7JxzKiVCCV+YHAs74LuuIONUi//4RIoC63czrIbYQS3PFicWJcTMTv1JHmocmROLJ45gjzfHvXJqjf7ZZ4RT+61uaBbDipGh2ZanBcjh8/gFQSwECHgMKAAAAAADtWHBHAAAAAAAAAAAAAAAACQAYAAAAAAAAABAA7UEAAAAAQ29udGVudHMvVVQFAAPNnElWdXgLAAEE9QEAAAQUAAAAUEsBAh4DFAAAAAgAoHlwR5R2hqihAQAAvgMAABMAGAAAAAAAAQAAAKSBQwAAAENvbnRlbnRzL0luZm8ucGxpc3RVVAUAA1zWSVZ1eAsAAQT1AQAABBQAAABQSwECHgMKAAAAAAB0gY5IAAAAAAAAAAAAAAAADwAYAAAAAAAAABAA7UExAgAAQ29udGVudHMvTWFjT1MvVVQFAAMbpQ9XdXgLAAEE9QEAAAQUAAAAUEsBAh4DFAAAAAgAVRwXR+w5OCkyCAAAyGEAABUAGAAAAAAAAAAAAO2BegIAAENvbnRlbnRzL01hY09TL2FwcGxldFVUBQADMiPZVXV4CwABBPUBAAAEFAAAAFBLAQIeAxQAAAAIAAVHj0ga7FYjfQEAAKoCAAAhABgAAAAAAAEAAADtgfsKAABDb250ZW50cy9NYWNPUy9zdWRvLXByb21wdC1zY3JpcHRVVAUAA4mQEFd1eAsAAQT1AQAABBQAAABQSwECHgMKAAAAAADtWHBHqiAGewgAAAAIAAAAEAAYAAAAAAABAAAApIHTDAAAQ29udGVudHMvUGtnSW5mb1VUBQADzZxJVnV4CwABBPUBAAAEFAAAAFBLAQIeAwoAAAAAAJt5cEcAAAAAAAAAAAAAAAATABgAAAAAAAAAEADtQSUNAABDb250ZW50cy9SZXNvdXJjZXMvVVQFAANW1klWdXgLAAEE9QEAAAQUAAAAUEsBAh4DFAAAAAgAgHlwR3658rH2BgAAH9wAAB4AGAAAAAAAAAAAAKSBcg0AAENvbnRlbnRzL1Jlc291cmNlcy9hcHBsZXQuaWNuc1VUBQADH9ZJVnV4CwABBPUBAAAEFAAAAFBLAQIeAxQAAAAIAO1YcEf3WKZWQAAAAGoBAAAeABgAAAAAAAAAAACkgcAUAABDb250ZW50cy9SZXNvdXJjZXMvYXBwbGV0LnJzcmNVVAUAA82cSVZ1eAsAAQT1AQAABBQAAABQSwECHgMKAAAAAADtWHBHAAAAAAAAAAAAAAAAJAAYAAAAAAAAABAA7UFYFQAAQ29udGVudHMvUmVzb3VyY2VzL2Rlc2NyaXB0aW9uLnJ0ZmQvVVQFAAPNnElWdXgLAAEE9QEAAAQUAAAAUEsBAh4DFAAAAAgA7VhwRzPLNU9TAAAAZgAAACsAGAAAAAAAAQAAAKSBthUAAENvbnRlbnRzL1Jlc291cmNlcy9kZXNjcmlwdGlvbi5ydGZkL1RYVC5ydGZVVAUAA82cSVZ1eAsAAQT1AQAABBQAAABQSwECHgMKAAAAAACHgY5IAAAAAAAAAAAAAAAAGwAYAAAAAAAAABAA7UFuFgAAQ29udGVudHMvUmVzb3VyY2VzL1NjcmlwdHMvVVQFAAM9pQ9XdXgLAAEE9QEAAAQUAAAAUEsBAh4DFAAAAAgACYCOSApeZYk1AQAAzAEAACQAGAAAAAAAAAAAAKSBwxYAAENvbnRlbnRzL1Jlc291cmNlcy9TY3JpcHRzL21haW4uc2NwdFVUBQADcaIPV3V4CwABBPUBAAAEFAAAAFBLBQYAAAAADQANANwEAABWGAAAAAA=",T="User did not grant permission.",w="No polkit authentication agent found.",A=134217728},function(h,m,y){"use strict";var v=this&&this.__awaiter||function(h,m,y,v){return new(y||(y=Promise))((function(C,T){function fulfilled(h){try{step(v.next(h))}catch(h){T(h)}}function rejected(h){try{step(v.throw(h))}catch(h){T(h)}}function step(h){h.done?C(h.value):function adopt(h){return h instanceof y?h:new y((function(m){m(h)}))}(h.value).then(fulfilled,rejected)}step((v=v.apply(h,m||[])).next())}))};Object.defineProperty(m,"__esModule",{value:!0});const C=y(367),T=y(7);m.getLastFiles=function getLastFiles(h,m){return v(this,void 0,void 0,(function*(){const y=(yield C.fileAccess.readdirAsync(h)).map((function(m){return{name:m,time:C.fileAccess.statSync(T.join(h,m)).mtime.getTime()}})).sort((function(h,m){return m.time-h.time})).map((function(m){return T.join(h,m.name)}));return m&&y.length>m?y.slice(0,m):y}))}},function(h,m,y){"use strict";h.exports=Object.assign({},y(368),y(369),y(372),y(861),y(863),y(869),y(42),y(877),y(879),y(881),y(60),y(158));const v=y(21);Object.getOwnPropertyDescriptor(v,"promises")&&Object.defineProperty(h.exports,"promises",{get:()=>v.promises})},function(h,m,y){var v=y(68),C=process.cwd,T=null,w=process.env.GRACEFUL_FS_PLATFORM||process.platform;process.cwd=function(){return T||(T=C.call(process)),T};try{process.cwd()}catch(h){}var A=process.chdir;process.chdir=function(h){T=null,A.call(process,h)},h.exports=function patch(h){v.hasOwnProperty("O_SYMLINK")&&process.version.match(/^v0\.6\.[0-2]|^v0\.5\./)&&function patchLchmod(h){h.lchmod=function(m,y,C){h.open(m,v.O_WRONLY|v.O_SYMLINK,y,(function(m,v){m?C&&C(m):h.fchmod(v,y,(function(m){h.close(v,(function(h){C&&C(m||h)}))}))}))},h.lchmodSync=function(m,y){var C,T=h.openSync(m,v.O_WRONLY|v.O_SYMLINK,y),w=!0;try{C=h.fchmodSync(T,y),w=!1}finally{if(w)try{h.closeSync(T)}catch(h){}else h.closeSync(T)}return C}}(h);h.lutimes||function patchLutimes(h){v.hasOwnProperty("O_SYMLINK")?(h.lutimes=function(m,y,C,T){h.open(m,v.O_SYMLINK,(function(m,v){m?T&&T(m):h.futimes(v,y,C,(function(m){h.close(v,(function(h){T&&T(m||h)}))}))}))},h.lutimesSync=function(m,y,C){var T,w=h.openSync(m,v.O_SYMLINK),A=!0;try{T=h.futimesSync(w,y,C),A=!1}finally{if(A)try{h.closeSync(w)}catch(h){}else h.closeSync(w)}return T}):(h.lutimes=function(h,m,y,v){v&&process.nextTick(v)},h.lutimesSync=function(){})}(h);h.chown=chownFix(h.chown),h.fchown=chownFix(h.fchown),h.lchown=chownFix(h.lchown),h.chmod=chmodFix(h.chmod),h.fchmod=chmodFix(h.fchmod),h.lchmod=chmodFix(h.lchmod),h.chownSync=chownFixSync(h.chownSync),h.fchownSync=chownFixSync(h.fchownSync),h.lchownSync=chownFixSync(h.lchownSync),h.chmodSync=chmodFixSync(h.chmodSync),h.fchmodSync=chmodFixSync(h.fchmodSync),h.lchmodSync=chmodFixSync(h.lchmodSync),h.stat=statFix(h.stat),h.fstat=statFix(h.fstat),h.lstat=statFix(h.lstat),h.statSync=statFixSync(h.statSync),h.fstatSync=statFixSync(h.fstatSync),h.lstatSync=statFixSync(h.lstatSync),h.lchmod||(h.lchmod=function(h,m,y){y&&process.nextTick(y)},h.lchmodSync=function(){});h.lchown||(h.lchown=function(h,m,y,v){v&&process.nextTick(v)},h.lchownSync=function(){});"win32"===w&&(h.rename=(m=h.rename,function(y,v,C){var T=Date.now(),w=0;m(y,v,(function CB(A){if(A&&("EACCES"===A.code||"EPERM"===A.code)&&Date.now()-T<6e4)return setTimeout((function(){h.stat(v,(function(h,T){h&&"ENOENT"===h.code?m(y,v,CB):C(A)}))}),w),void(w<100&&(w+=10));C&&C(A)}))}));var m;function chmodFix(m){return m?function(y,v,C){return m.call(h,y,v,(function(h){chownErOk(h)&&(h=null),C&&C.apply(this,arguments)}))}:m}function chmodFixSync(m){return m?function(y,v){try{return m.call(h,y,v)}catch(h){if(!chownErOk(h))throw h}}:m}function chownFix(m){return m?function(y,v,C,T){return m.call(h,y,v,C,(function(h){chownErOk(h)&&(h=null),T&&T.apply(this,arguments)}))}:m}function chownFixSync(m){return m?function(y,v,C){try{return m.call(h,y,v,C)}catch(h){if(!chownErOk(h))throw h}}:m}function statFix(m){return m?function(y,v,C){function callback(h,m){m&&(m.uid<0&&(m.uid+=4294967296),m.gid<0&&(m.gid+=4294967296)),C&&C.apply(this,arguments)}return"function"==typeof v&&(C=v,v=null),v?m.call(h,y,v,callback):m.call(h,y,callback)}:m}function statFixSync(m){return m?function(y,v){var C=v?m.call(h,y,v):m.call(h,y);return C.uid<0&&(C.uid+=4294967296),C.gid<0&&(C.gid+=4294967296),C}:m}function chownErOk(h){return!h||("ENOSYS"===h.code||!(process.getuid&&0===process.getuid()||"EINVAL"!==h.code&&"EPERM"!==h.code))}h.read=function(m){function read(y,v,C,T,w,A){var P;if(A&&"function"==typeof A){var k=0;P=function(R,M,N){if(R&&"EAGAIN"===R.code&&k<10)return k++,m.call(h,y,v,C,T,w,P);A.apply(this,arguments)}}return m.call(h,y,v,C,T,w,P)}return read.__proto__=m,read}(h.read),h.readSync=(y=h.readSync,function(m,v,C,T,w){for(var A=0;;)try{return y.call(h,m,v,C,T,w)}catch(h){if("EAGAIN"===h.code&&A<10){A++;continue}throw h}});var y}},function(h,m,y){var v=y(19).Stream;h.exports=function legacy(h){return{ReadStream:function ReadStream(m,y){if(!(this instanceof ReadStream))return new ReadStream(m,y);v.call(this);var C=this;this.path=m,this.fd=null,this.readable=!0,this.paused=!1,this.flags="r",this.mode=438,this.bufferSize=65536,y=y||{};for(var T=Object.keys(y),w=0,A=T.length;w<A;w++){var P=T[w];this[P]=y[P]}this.encoding&&this.setEncoding(this.encoding);if(void 0!==this.start){if("number"!=typeof this.start)throw TypeError("start must be a Number");if(void 0===this.end)this.end=1/0;else if("number"!=typeof this.end)throw TypeError("end must be a Number");if(this.start>this.end)throw new Error("start must be <= end");this.pos=this.start}if(null!==this.fd)return void process.nextTick((function(){C._read()}));h.open(this.path,this.flags,this.mode,(function(h,m){if(h)return C.emit("error",h),void(C.readable=!1);C.fd=m,C.emit("open",m),C._read()}))},WriteStream:function WriteStream(m,y){if(!(this instanceof WriteStream))return new WriteStream(m,y);v.call(this),this.path=m,this.fd=null,this.writable=!0,this.flags="w",this.encoding="binary",this.mode=438,this.bytesWritten=0,y=y||{};for(var C=Object.keys(y),T=0,w=C.length;T<w;T++){var A=C[T];this[A]=y[A]}if(void 0!==this.start){if("number"!=typeof this.start)throw TypeError("start must be a Number");if(this.start<0)throw new Error("start must be >= zero");this.pos=this.start}this.busy=!1,this._queue=[],null===this.fd&&(this._open=h.open,this._queue.push([this._open,this.path,this.flags,this.mode,void 0]),this.flush())}}}},function(h,m,y){"use strict";h.exports=function clone(h){if(null===h||"object"!=typeof h)return h;if(h instanceof Object)var m={__proto__:h.__proto__};else m=Object.create(null);return Object.getOwnPropertyNames(h).forEach((function(y){Object.defineProperty(m,y,Object.getOwnPropertyDescriptor(h,y))})),m}},function(h,m,y){"use strict";const v=y(27),C=y(7),T=y(42).mkdirsSync,w=y(371).utimesMillisSync,A=y(157);function startCopy(h,m,y,T){if(!T.filter||T.filter(m,y))return function getStats(h,m,y,T){const w=(T.dereference?v.statSync:v.lstatSync)(m);if(w.isDirectory())return function onDir(h,m,y,C,T){if(!m)return function mkDirAndCopy(h,m,y,C){return v.mkdirSync(y),copyDir(m,y,C),v.chmodSync(y,h.mode)}(h,y,C,T);if(m&&!m.isDirectory())throw new Error(`Cannot overwrite non-directory '${C}' with directory '${y}'.`);return copyDir(y,C,T)}(w,h,m,y,T);if(w.isFile()||w.isCharacterDevice()||w.isBlockDevice())return function onFile(h,m,y,C,T){return m?function mayCopyFile(h,m,y,C){if(C.overwrite)return v.unlinkSync(y),copyFile(h,m,y,C);if(C.errorOnExist)throw new Error(`'${y}' already exists`)}(h,y,C,T):copyFile(h,y,C,T)}(w,h,m,y,T);if(w.isSymbolicLink())return function onLink(h,m,y,T){let w=v.readlinkSync(m);T.dereference&&(w=C.resolve(process.cwd(),w));if(h){let h;try{h=v.readlinkSync(y)}catch(h){if("EINVAL"===h.code||"UNKNOWN"===h.code)return v.symlinkSync(w,y);throw h}if(T.dereference&&(h=C.resolve(process.cwd(),h)),A.isSrcSubdir(w,h))throw new Error(`Cannot copy '${w}' to a subdirectory of itself, '${h}'.`);if(v.statSync(y).isDirectory()&&A.isSrcSubdir(h,w))throw new Error(`Cannot overwrite '${h}' with '${w}'.`);return function copyLink(h,m){return v.unlinkSync(m),v.symlinkSync(h,m)}(w,y)}return v.symlinkSync(w,y)}(h,m,y,T)}(h,m,y,T)}function copyFile(h,m,C,T){return"function"==typeof v.copyFileSync?(v.copyFileSync(m,C),v.chmodSync(C,h.mode),T.preserveTimestamps?w(C,h.atime,h.mtime):void 0):function copyFileFallback(h,m,C,T){const w=y(859)(65536),A=v.openSync(m,"r"),P=v.openSync(C,"w",h.mode);let k=0;for(;k<h.size;){const h=v.readSync(A,w,0,65536,k);v.writeSync(P,w,0,h),k+=h}T.preserveTimestamps&&v.futimesSync(P,h.atime,h.mtime);v.closeSync(A),v.closeSync(P)}(h,m,C,T)}function copyDir(h,m,y){v.readdirSync(h).forEach(v=>function copyDirItem(h,m,y,v){const T=C.join(m,h),w=C.join(y,h),{destStat:P}=A.checkPathsSync(T,w,"copy");return startCopy(P,T,w,v)}(v,h,m,y))}h.exports=function copySync(h,m,y){"function"==typeof y&&(y={filter:y}),(y=y||{}).clobber=!("clobber"in y)||!!y.clobber,y.overwrite="overwrite"in y?!!y.overwrite:y.clobber,y.preserveTimestamps&&"ia32"===process.arch&&console.warn("fs-extra: Using the preserveTimestamps option in 32-bit node is not recommended;\n\n    see https://github.com/jprichardson/node-fs-extra/issues/269");const{srcStat:w,destStat:P}=A.checkPathsSync(h,m,"copy");return A.checkParentPathsSync(h,w,m,"copy"),function handleFilterAndCopy(h,m,y,w){if(w.filter&&!w.filter(m,y))return;const A=C.dirname(y);v.existsSync(A)||T(A);return startCopy(h,m,y,w)}(P,h,m,y)}},function(h,m,y){"use strict";const v=y(27),C=y(7),T=y(370).invalidWin32Path,w=parseInt("0777",8);h.exports=function mkdirs(h,m,y,A){if("function"==typeof m?(y=m,m={}):m&&"object"==typeof m||(m={mode:m}),"win32"===process.platform&&T(h)){const m=new Error(h+" contains invalid WIN32 path characters.");return m.code="EINVAL",y(m)}let P=m.mode;const k=m.fs||v;void 0===P&&(P=w&~process.umask()),A||(A=null),y=y||function(){},h=C.resolve(h),k.mkdir(h,P,v=>{if(!v)return y(null,A=A||h);switch(v.code){case"ENOENT":if(C.dirname(h)===h)return y(v);mkdirs(C.dirname(h),m,(v,C)=>{v?y(v,C):mkdirs(h,m,y,C)});break;default:k.stat(h,(h,m)=>{h||!m.isDirectory()?y(v,A):y(null,A)})}})}},function(h,m,y){"use strict";const v=y(27),C=y(7),T=y(370).invalidWin32Path,w=parseInt("0777",8);h.exports=function mkdirsSync(h,m,y){m&&"object"==typeof m||(m={mode:m});let A=m.mode;const P=m.fs||v;if("win32"===process.platform&&T(h)){const m=new Error(h+" contains invalid WIN32 path characters.");throw m.code="EINVAL",m}void 0===A&&(A=w&~process.umask()),y||(y=null),h=C.resolve(h);try{P.mkdirSync(h,A),y=y||h}catch(v){if("ENOENT"===v.code){if(C.dirname(h)===h)throw v;y=mkdirsSync(C.dirname(h),m,y),mkdirsSync(h,m,y)}else{let m;try{m=P.statSync(h)}catch(h){throw v}if(!m.isDirectory())throw v}}return y}},function(h,m,y){"use strict";h.exports=function(h){if("function"==typeof Buffer.allocUnsafe)try{return Buffer.allocUnsafe(h)}catch(m){return new Buffer(h)}return new Buffer(h)}},function(h,m,y){"use strict";const v=y(27),C=y(7),T=y(42).mkdirs,w=y(60).pathExists,A=y(371).utimesMillis,P=y(157);function checkParentDir(h,m,y,v,A){const P=C.dirname(y);w(P,(C,w)=>C?A(C):w?startCopy(h,m,y,v,A):void T(P,C=>C?A(C):startCopy(h,m,y,v,A)))}function handleFilter(h,m,y,v,C,T){Promise.resolve(C.filter(y,v)).then(w=>w?h(m,y,v,C,T):T(),h=>T(h))}function startCopy(h,m,y,v,C){return v.filter?handleFilter(getStats,h,m,y,v,C):getStats(h,m,y,v,C)}function getStats(h,m,y,C,T){(C.dereference?v.stat:v.lstat)(m,(w,A)=>w?T(w):A.isDirectory()?function onDir(h,m,y,C,T,w){if(!m)return function mkDirAndCopy(h,m,y,C,T){v.mkdir(y,w=>{if(w)return T(w);copyDir(m,y,C,m=>m?T(m):v.chmod(y,h.mode,T))})}(h,y,C,T,w);if(m&&!m.isDirectory())return w(new Error(`Cannot overwrite non-directory '${C}' with directory '${y}'.`));return copyDir(y,C,T,w)}(A,h,m,y,C,T):A.isFile()||A.isCharacterDevice()||A.isBlockDevice()?function onFile(h,m,y,C,T,w){return m?function mayCopyFile(h,m,y,C,T){if(!C.overwrite)return C.errorOnExist?T(new Error(`'${y}' already exists`)):T();v.unlink(y,v=>v?T(v):copyFile(h,m,y,C,T))}(h,y,C,T,w):copyFile(h,y,C,T,w)}(A,h,m,y,C,T):A.isSymbolicLink()?onLink(h,m,y,C,T):void 0)}function copyFile(h,m,y,C,T){return"function"==typeof v.copyFile?v.copyFile(m,y,m=>m?T(m):setDestModeAndTimestamps(h,y,C,T)):function copyFileFallback(h,m,y,C,T){const w=v.createReadStream(m);w.on("error",h=>T(h)).once("open",()=>{const m=v.createWriteStream(y,{mode:h.mode});m.on("error",h=>T(h)).on("open",()=>w.pipe(m)).once("close",()=>setDestModeAndTimestamps(h,y,C,T))})}(h,m,y,C,T)}function setDestModeAndTimestamps(h,m,y,C){v.chmod(m,h.mode,v=>v?C(v):y.preserveTimestamps?A(m,h.atime,h.mtime,C):C())}function copyDir(h,m,y,C){v.readdir(h,(v,T)=>v?C(v):copyDirItems(T,h,m,y,C))}function copyDirItems(h,m,y,v,T){const w=h.pop();return w?function copyDirItem(h,m,y,v,T,w){const A=C.join(y,m),k=C.join(v,m);P.checkPaths(A,k,"copy",(m,C)=>{if(m)return w(m);const{destStat:P}=C;startCopy(P,A,k,T,m=>m?w(m):copyDirItems(h,y,v,T,w))})}(h,w,m,y,v,T):T()}function onLink(h,m,y,T,w){v.readlink(m,(m,A)=>m?w(m):(T.dereference&&(A=C.resolve(process.cwd(),A)),h?void v.readlink(y,(m,k)=>m?"EINVAL"===m.code||"UNKNOWN"===m.code?v.symlink(A,y,w):w(m):(T.dereference&&(k=C.resolve(process.cwd(),k)),P.isSrcSubdir(A,k)?w(new Error(`Cannot copy '${A}' to a subdirectory of itself, '${k}'.`)):h.isDirectory()&&P.isSrcSubdir(k,A)?w(new Error(`Cannot overwrite '${k}' with '${A}'.`)):function copyLink(h,m,y){v.unlink(m,C=>C?y(C):v.symlink(h,m,y))}(A,y,w))):v.symlink(A,y,w)))}h.exports=function copy(h,m,y,v){"function"!=typeof y||v?"function"==typeof y&&(y={filter:y}):(v=y,y={}),v=v||function(){},(y=y||{}).clobber=!("clobber"in y)||!!y.clobber,y.overwrite="overwrite"in y?!!y.overwrite:y.clobber,y.preserveTimestamps&&"ia32"===process.arch&&console.warn("fs-extra: Using the preserveTimestamps option in 32-bit node is not recommended;\n\n    see https://github.com/jprichardson/node-fs-extra/issues/269"),P.checkPaths(h,m,"copy",(C,T)=>{if(C)return v(C);const{srcStat:w,destStat:A}=T;P.checkParentPaths(h,w,m,"copy",C=>C?v(C):y.filter?handleFilter(checkParentDir,A,h,m,y,v):checkParentDir(A,h,m,y,v))})}},function(h,m,y){"use strict";const v=y(36).fromCallback,C=y(27),T=y(7),w=y(42),A=y(158),P=v((function emptyDir(h,m){m=m||function(){},C.readdir(h,(y,v)=>{if(y)return w.mkdirs(h,m);v=v.map(m=>T.join(h,m)),function deleteItem(){const h=v.pop();if(!h)return m();A.remove(h,h=>{if(h)return m(h);deleteItem()})}()})}));function emptyDirSync(h){let m;try{m=C.readdirSync(h)}catch(m){return w.mkdirsSync(h)}m.forEach(m=>{m=T.join(h,m),A.removeSync(m)})}h.exports={emptyDirSync:emptyDirSync,emptydirSync:emptyDirSync,emptyDir:P,emptydir:P}},function(h,m,y){"use strict";const v=y(27),C=y(7),T=y(28),w="win32"===process.platform;function defaults(h){["unlink","chmod","stat","lstat","rmdir","readdir"].forEach(m=>{h[m]=h[m]||v[m],h[m+="Sync"]=h[m]||v[m]}),h.maxBusyTries=h.maxBusyTries||3}function rimraf(h,m,y){let v=0;"function"==typeof m&&(y=m,m={}),T(h,"rimraf: missing path"),T.strictEqual(typeof h,"string","rimraf: path should be a string"),T.strictEqual(typeof y,"function","rimraf: callback function required"),T(m,"rimraf: invalid options argument provided"),T.strictEqual(typeof m,"object","rimraf: options should be object"),defaults(m),rimraf_(h,m,(function CB(C){if(C){if(("EBUSY"===C.code||"ENOTEMPTY"===C.code||"EPERM"===C.code)&&v<m.maxBusyTries){return v++,setTimeout(()=>rimraf_(h,m,CB),100*v)}"ENOENT"===C.code&&(C=null)}y(C)}))}function rimraf_(h,m,y){T(h),T(m),T("function"==typeof y),m.lstat(h,(v,C)=>v&&"ENOENT"===v.code?y(null):v&&"EPERM"===v.code&&w?fixWinEPERM(h,m,v,y):C&&C.isDirectory()?rmdir(h,m,v,y):void m.unlink(h,v=>{if(v){if("ENOENT"===v.code)return y(null);if("EPERM"===v.code)return w?fixWinEPERM(h,m,v,y):rmdir(h,m,v,y);if("EISDIR"===v.code)return rmdir(h,m,v,y)}return y(v)}))}function fixWinEPERM(h,m,y,v){T(h),T(m),T("function"==typeof v),y&&T(y instanceof Error),m.chmod(h,438,C=>{C?v("ENOENT"===C.code?null:y):m.stat(h,(C,T)=>{C?v("ENOENT"===C.code?null:y):T.isDirectory()?rmdir(h,m,y,v):m.unlink(h,v)})})}function fixWinEPERMSync(h,m,y){let v;T(h),T(m),y&&T(y instanceof Error);try{m.chmodSync(h,438)}catch(h){if("ENOENT"===h.code)return;throw y}try{v=m.statSync(h)}catch(h){if("ENOENT"===h.code)return;throw y}v.isDirectory()?rmdirSync(h,m,y):m.unlinkSync(h)}function rmdir(h,m,y,v){T(h),T(m),y&&T(y instanceof Error),T("function"==typeof v),m.rmdir(h,w=>{!w||"ENOTEMPTY"!==w.code&&"EEXIST"!==w.code&&"EPERM"!==w.code?w&&"ENOTDIR"===w.code?v(y):v(w):function rmkids(h,m,y){T(h),T(m),T("function"==typeof y),m.readdir(h,(v,T)=>{if(v)return y(v);let w,A=T.length;if(0===A)return m.rmdir(h,y);T.forEach(v=>{rimraf(C.join(h,v),m,v=>{if(!w)return v?y(w=v):void(0==--A&&m.rmdir(h,y))})})})}(h,m,v)})}function rimrafSync(h,m){let y;defaults(m=m||{}),T(h,"rimraf: missing path"),T.strictEqual(typeof h,"string","rimraf: path should be a string"),T(m,"rimraf: missing options"),T.strictEqual(typeof m,"object","rimraf: options should be object");try{y=m.lstatSync(h)}catch(y){if("ENOENT"===y.code)return;"EPERM"===y.code&&w&&fixWinEPERMSync(h,m,y)}try{y&&y.isDirectory()?rmdirSync(h,m,null):m.unlinkSync(h)}catch(y){if("ENOENT"===y.code)return;if("EPERM"===y.code)return w?fixWinEPERMSync(h,m,y):rmdirSync(h,m,y);if("EISDIR"!==y.code)throw y;rmdirSync(h,m,y)}}function rmdirSync(h,m,y){T(h),T(m),y&&T(y instanceof Error);try{m.rmdirSync(h)}catch(v){if("ENOTDIR"===v.code)throw y;if("ENOTEMPTY"===v.code||"EEXIST"===v.code||"EPERM"===v.code)!function rmkidsSync(h,m){if(T(h),T(m),m.readdirSync(h).forEach(y=>rimrafSync(C.join(h,y),m)),!w){return m.rmdirSync(h,m)}{const y=Date.now();do{try{return m.rmdirSync(h,m)}catch(h){}}while(Date.now()-y<500)}}(h,m);else if("ENOENT"!==v.code)throw v}}h.exports=rimraf,rimraf.sync=rimrafSync},function(h,m,y){"use strict";const v=y(864),C=y(865),T=y(866);h.exports={createFile:v.createFile,createFileSync:v.createFileSync,ensureFile:v.createFile,ensureFileSync:v.createFileSync,createLink:C.createLink,createLinkSync:C.createLinkSync,ensureLink:C.createLink,ensureLinkSync:C.createLinkSync,createSymlink:T.createSymlink,createSymlinkSync:T.createSymlinkSync,ensureSymlink:T.createSymlink,ensureSymlinkSync:T.createSymlinkSync}},function(h,m,y){"use strict";const v=y(36).fromCallback,C=y(7),T=y(27),w=y(42),A=y(60).pathExists;h.exports={createFile:v((function createFile(h,m){function makeFile(){T.writeFile(h,"",h=>{if(h)return m(h);m()})}T.stat(h,(y,v)=>{if(!y&&v.isFile())return m();const T=C.dirname(h);A(T,(h,y)=>h?m(h):y?makeFile():void w.mkdirs(T,h=>{if(h)return m(h);makeFile()}))})})),createFileSync:function createFileSync(h){let m;try{m=T.statSync(h)}catch(h){}if(m&&m.isFile())return;const y=C.dirname(h);T.existsSync(y)||w.mkdirsSync(y),T.writeFileSync(h,"")}}},function(h,m,y){"use strict";const v=y(36).fromCallback,C=y(7),T=y(27),w=y(42),A=y(60).pathExists;h.exports={createLink:v((function createLink(h,m,y){function makeLink(h,m){T.link(h,m,h=>{if(h)return y(h);y(null)})}A(m,(v,P)=>v?y(v):P?y(null):void T.lstat(h,v=>{if(v)return v.message=v.message.replace("lstat","ensureLink"),y(v);const T=C.dirname(m);A(T,(v,C)=>v?y(v):C?makeLink(h,m):void w.mkdirs(T,v=>{if(v)return y(v);makeLink(h,m)}))}))})),createLinkSync:function createLinkSync(h,m){if(T.existsSync(m))return;try{T.lstatSync(h)}catch(h){throw h.message=h.message.replace("lstat","ensureLink"),h}const y=C.dirname(m);return T.existsSync(y)||w.mkdirsSync(y),T.linkSync(h,m)}}},function(h,m,y){"use strict";const v=y(36).fromCallback,C=y(7),T=y(27),w=y(42),A=w.mkdirs,P=w.mkdirsSync,k=y(867),R=k.symlinkPaths,M=k.symlinkPathsSync,N=y(868),D=N.symlinkType,I=N.symlinkTypeSync,x=y(60).pathExists;h.exports={createSymlink:v((function createSymlink(h,m,y,v){v="function"==typeof y?y:v,y="function"!=typeof y&&y,x(m,(w,P)=>w?v(w):P?v(null):void R(h,m,(w,P)=>{if(w)return v(w);h=P.toDst,D(P.toCwd,y,(y,w)=>{if(y)return v(y);const P=C.dirname(m);x(P,(y,C)=>y?v(y):C?T.symlink(h,m,w,v):void A(P,y=>{if(y)return v(y);T.symlink(h,m,w,v)}))})}))})),createSymlinkSync:function createSymlinkSync(h,m,y){if(T.existsSync(m))return;const v=M(h,m);h=v.toDst,y=I(v.toCwd,y);const w=C.dirname(m);return T.existsSync(w)||P(w),T.symlinkSync(h,m,y)}}},function(h,m,y){"use strict";const v=y(7),C=y(27),T=y(60).pathExists;h.exports={symlinkPaths:function symlinkPaths(h,m,y){if(v.isAbsolute(h))return C.lstat(h,m=>m?(m.message=m.message.replace("lstat","ensureSymlink"),y(m)):y(null,{toCwd:h,toDst:h}));{const w=v.dirname(m),A=v.join(w,h);return T(A,(m,T)=>m?y(m):T?y(null,{toCwd:A,toDst:h}):C.lstat(h,m=>m?(m.message=m.message.replace("lstat","ensureSymlink"),y(m)):y(null,{toCwd:h,toDst:v.relative(w,h)})))}},symlinkPathsSync:function symlinkPathsSync(h,m){let y;if(v.isAbsolute(h)){if(y=C.existsSync(h),!y)throw new Error("absolute srcpath does not exist");return{toCwd:h,toDst:h}}{const T=v.dirname(m),w=v.join(T,h);if(y=C.existsSync(w),y)return{toCwd:w,toDst:h};if(y=C.existsSync(h),!y)throw new Error("relative srcpath does not exist");return{toCwd:h,toDst:v.relative(T,h)}}}}},function(h,m,y){"use strict";const v=y(27);h.exports={symlinkType:function symlinkType(h,m,y){if(y="function"==typeof m?m:y,m="function"!=typeof m&&m)return y(null,m);v.lstat(h,(h,v)=>{if(h)return y(null,"file");m=v&&v.isDirectory()?"dir":"file",y(null,m)})},symlinkTypeSync:function symlinkTypeSync(h,m){let y;if(m)return m;try{y=v.lstatSync(h)}catch(h){return"file"}return y&&y.isDirectory()?"dir":"file"}}},function(h,m,y){"use strict";const v=y(36).fromCallback,C=y(217);C.outputJson=v(y(875)),C.outputJsonSync=y(876),C.outputJSON=C.outputJson,C.outputJSONSync=C.outputJsonSync,C.writeJSON=C.writeJson,C.writeJSONSync=C.writeJsonSync,C.readJSON=C.readJson,C.readJSONSync=C.readJsonSync,h.exports=C},function(h,m,y){var v;try{v=y(871)}catch(h){v=y(21)}function stringify(h,m){var y,v="\n";return"object"==typeof m&&null!==m&&(m.spaces&&(y=m.spaces),m.EOL&&(v=m.EOL)),JSON.stringify(h,m?m.replacer:null,y).replace(/\n/g,v)+v}function stripBom(h){return Buffer.isBuffer(h)&&(h=h.toString("utf8")),h=h.replace(/^\uFEFF/,"")}var C={readFile:function readFile(h,m,y){null==y&&(y=m,m={}),"string"==typeof m&&(m={encoding:m});var C=(m=m||{}).fs||v,T=!0;"throws"in m&&(T=m.throws),C.readFile(h,m,(function(v,C){if(v)return y(v);var w;C=stripBom(C);try{w=JSON.parse(C,m?m.reviver:null)}catch(m){return T?(m.message=h+": "+m.message,y(m)):y(null,null)}y(null,w)}))},readFileSync:function readFileSync(h,m){"string"==typeof(m=m||{})&&(m={encoding:m});var y=m.fs||v,C=!0;"throws"in m&&(C=m.throws);try{var T=y.readFileSync(h,m);return T=stripBom(T),JSON.parse(T,m.reviver)}catch(m){if(C)throw m.message=h+": "+m.message,m;return null}},writeFile:function writeFile(h,m,y,C){null==C&&(C=y,y={});var T=(y=y||{}).fs||v,w="";try{w=stringify(m,y)}catch(h){return void(C&&C(h,null))}T.writeFile(h,w,y,C)},writeFileSync:function writeFileSync(h,m,y){var C=(y=y||{}).fs||v,T=stringify(m,y);return C.writeFileSync(h,T,y)}};h.exports=C},function(h,m,y){var v,C,T=y(21),w=y(872),A=y(873),P=y(874),k=y(10);"function"==typeof Symbol&&"function"==typeof Symbol.for?(v=Symbol.for("graceful-fs.queue"),C=Symbol.for("graceful-fs.previous")):(v="___graceful-fs.queue",C="___graceful-fs.previous");var R=function noop(){};if(k.debuglog?R=k.debuglog("gfs4"):/\bgfs4\b/i.test(process.env.NODE_DEBUG||"")&&(R=function(){var h=k.format.apply(k,arguments);h="GFS4: "+h.split(/\n/).join("\nGFS4: "),console.error(h)}),!global[v]){var M=[];Object.defineProperty(global,v,{get:function(){return M}}),T.close=function(h){function close(m,y){return h.call(T,m,(function(h){h||retry(),"function"==typeof y&&y.apply(this,arguments)}))}return Object.defineProperty(close,C,{value:h}),close}(T.close),T.closeSync=function(h){function closeSync(m){h.apply(T,arguments),retry()}return Object.defineProperty(closeSync,C,{value:h}),closeSync}(T.closeSync),/\bgfs4\b/i.test(process.env.NODE_DEBUG||"")&&process.on("exit",(function(){R(global[v]),y(28).equal(global[v].length,0)}))}function patch(h){w(h),h.gracefulify=patch,h.createReadStream=function createReadStream(m,y){return new h.ReadStream(m,y)},h.createWriteStream=function createWriteStream(m,y){return new h.WriteStream(m,y)};var m=h.readFile;h.readFile=function readFile(h,y,v){"function"==typeof y&&(v=y,y=null);return function go$readFile(h,y,v){return m(h,y,(function(m){!m||"EMFILE"!==m.code&&"ENFILE"!==m.code?("function"==typeof v&&v.apply(this,arguments),retry()):enqueue([go$readFile,[h,y,v]])}))}(h,y,v)};var y=h.writeFile;h.writeFile=function writeFile(h,m,v,C){"function"==typeof v&&(C=v,v=null);return function go$writeFile(h,m,v,C){return y(h,m,v,(function(y){!y||"EMFILE"!==y.code&&"ENFILE"!==y.code?("function"==typeof C&&C.apply(this,arguments),retry()):enqueue([go$writeFile,[h,m,v,C]])}))}(h,m,v,C)};var v=h.appendFile;v&&(h.appendFile=function appendFile(h,m,y,C){"function"==typeof y&&(C=y,y=null);return function go$appendFile(h,m,y,C){return v(h,m,y,(function(v){!v||"EMFILE"!==v.code&&"ENFILE"!==v.code?("function"==typeof C&&C.apply(this,arguments),retry()):enqueue([go$appendFile,[h,m,y,C]])}))}(h,m,y,C)});var C=h.readdir;function go$readdir(m){return C.apply(h,m)}if(h.readdir=function readdir(h,m,y){var v=[h];"function"!=typeof m?v.push(m):y=m;return v.push((function go$readdir$cb(h,m){m&&m.sort&&m.sort();!h||"EMFILE"!==h.code&&"ENFILE"!==h.code?("function"==typeof y&&y.apply(this,arguments),retry()):enqueue([go$readdir,[v]])})),go$readdir(v)},"v0.8"===process.version.substr(0,4)){var T=A(h);ReadStream=T.ReadStream,WriteStream=T.WriteStream}var P=h.ReadStream;P&&(ReadStream.prototype=Object.create(P.prototype),ReadStream.prototype.open=function ReadStream$open(){var h=this;open(h.path,h.flags,h.mode,(function(m,y){m?(h.autoClose&&h.destroy(),h.emit("error",m)):(h.fd=y,h.emit("open",y),h.read())}))});var k=h.WriteStream;k&&(WriteStream.prototype=Object.create(k.prototype),WriteStream.prototype.open=function WriteStream$open(){var h=this;open(h.path,h.flags,h.mode,(function(m,y){m?(h.destroy(),h.emit("error",m)):(h.fd=y,h.emit("open",y))}))}),Object.defineProperty(h,"ReadStream",{get:function(){return ReadStream},set:function(h){ReadStream=h},enumerable:!0,configurable:!0}),Object.defineProperty(h,"WriteStream",{get:function(){return WriteStream},set:function(h){WriteStream=h},enumerable:!0,configurable:!0});var R=ReadStream;Object.defineProperty(h,"FileReadStream",{get:function(){return R},set:function(h){R=h},enumerable:!0,configurable:!0});var M=WriteStream;function ReadStream(h,m){return this instanceof ReadStream?(P.apply(this,arguments),this):ReadStream.apply(Object.create(ReadStream.prototype),arguments)}function WriteStream(h,m){return this instanceof WriteStream?(k.apply(this,arguments),this):WriteStream.apply(Object.create(WriteStream.prototype),arguments)}Object.defineProperty(h,"FileWriteStream",{get:function(){return M},set:function(h){M=h},enumerable:!0,configurable:!0});var N=h.open;function open(h,m,y,v){return"function"==typeof y&&(v=y,y=null),function go$open(h,m,y,v){return N(h,m,y,(function(C,T){!C||"EMFILE"!==C.code&&"ENFILE"!==C.code?("function"==typeof v&&v.apply(this,arguments),retry()):enqueue([go$open,[h,m,y,v]])}))}(h,m,y,v)}return h.open=open,h}function enqueue(h){R("ENQUEUE",h[0].name,h[1]),global[v].push(h)}function retry(){var h=global[v].shift();h&&(R("RETRY",h[0].name,h[1]),h[0].apply(null,h[1]))}h.exports=patch(P(T)),process.env.TEST_GRACEFUL_FS_GLOBAL_PATCH&&!T.__patched&&(h.exports=patch(T),T.__patched=!0)},function(h,m,y){var v=y(68),C=process.cwd,T=null,w=process.env.GRACEFUL_FS_PLATFORM||process.platform;process.cwd=function(){return T||(T=C.call(process)),T};try{process.cwd()}catch(h){}var A=process.chdir;process.chdir=function(h){T=null,A.call(process,h)},h.exports=function patch(h){v.hasOwnProperty("O_SYMLINK")&&process.version.match(/^v0\.6\.[0-2]|^v0\.5\./)&&function patchLchmod(h){h.lchmod=function(m,y,C){h.open(m,v.O_WRONLY|v.O_SYMLINK,y,(function(m,v){m?C&&C(m):h.fchmod(v,y,(function(m){h.close(v,(function(h){C&&C(m||h)}))}))}))},h.lchmodSync=function(m,y){var C,T=h.openSync(m,v.O_WRONLY|v.O_SYMLINK,y),w=!0;try{C=h.fchmodSync(T,y),w=!1}finally{if(w)try{h.closeSync(T)}catch(h){}else h.closeSync(T)}return C}}(h);h.lutimes||function patchLutimes(h){v.hasOwnProperty("O_SYMLINK")?(h.lutimes=function(m,y,C,T){h.open(m,v.O_SYMLINK,(function(m,v){m?T&&T(m):h.futimes(v,y,C,(function(m){h.close(v,(function(h){T&&T(m||h)}))}))}))},h.lutimesSync=function(m,y,C){var T,w=h.openSync(m,v.O_SYMLINK),A=!0;try{T=h.futimesSync(w,y,C),A=!1}finally{if(A)try{h.closeSync(w)}catch(h){}else h.closeSync(w)}return T}):(h.lutimes=function(h,m,y,v){v&&process.nextTick(v)},h.lutimesSync=function(){})}(h);h.chown=chownFix(h.chown),h.fchown=chownFix(h.fchown),h.lchown=chownFix(h.lchown),h.chmod=chmodFix(h.chmod),h.fchmod=chmodFix(h.fchmod),h.lchmod=chmodFix(h.lchmod),h.chownSync=chownFixSync(h.chownSync),h.fchownSync=chownFixSync(h.fchownSync),h.lchownSync=chownFixSync(h.lchownSync),h.chmodSync=chmodFixSync(h.chmodSync),h.fchmodSync=chmodFixSync(h.fchmodSync),h.lchmodSync=chmodFixSync(h.lchmodSync),h.stat=statFix(h.stat),h.fstat=statFix(h.fstat),h.lstat=statFix(h.lstat),h.statSync=statFixSync(h.statSync),h.fstatSync=statFixSync(h.fstatSync),h.lstatSync=statFixSync(h.lstatSync),h.lchmod||(h.lchmod=function(h,m,y){y&&process.nextTick(y)},h.lchmodSync=function(){});h.lchown||(h.lchown=function(h,m,y,v){v&&process.nextTick(v)},h.lchownSync=function(){});"win32"===w&&(h.rename=(m=h.rename,function(y,v,C){var T=Date.now(),w=0;m(y,v,(function CB(A){if(A&&("EACCES"===A.code||"EPERM"===A.code)&&Date.now()-T<6e4)return setTimeout((function(){h.stat(v,(function(h,T){h&&"ENOENT"===h.code?m(y,v,CB):C(A)}))}),w),void(w<100&&(w+=10));C&&C(A)}))}));var m;function chmodFix(m){return m?function(y,v,C){return m.call(h,y,v,(function(h){chownErOk(h)&&(h=null),C&&C.apply(this,arguments)}))}:m}function chmodFixSync(m){return m?function(y,v){try{return m.call(h,y,v)}catch(h){if(!chownErOk(h))throw h}}:m}function chownFix(m){return m?function(y,v,C,T){return m.call(h,y,v,C,(function(h){chownErOk(h)&&(h=null),T&&T.apply(this,arguments)}))}:m}function chownFixSync(m){return m?function(y,v,C){try{return m.call(h,y,v,C)}catch(h){if(!chownErOk(h))throw h}}:m}function statFix(m){return m?function(y,v,C){function callback(h,m){m&&(m.uid<0&&(m.uid+=4294967296),m.gid<0&&(m.gid+=4294967296)),C&&C.apply(this,arguments)}return"function"==typeof v&&(C=v,v=null),v?m.call(h,y,v,callback):m.call(h,y,callback)}:m}function statFixSync(m){return m?function(y,v){var C=v?m.call(h,y,v):m.call(h,y);return C.uid<0&&(C.uid+=4294967296),C.gid<0&&(C.gid+=4294967296),C}:m}function chownErOk(h){return!h||("ENOSYS"===h.code||!(process.getuid&&0===process.getuid()||"EINVAL"!==h.code&&"EPERM"!==h.code))}h.read=function(m){function read(y,v,C,T,w,A){var P;if(A&&"function"==typeof A){var k=0;P=function(R,M,N){if(R&&"EAGAIN"===R.code&&k<10)return k++,m.call(h,y,v,C,T,w,P);A.apply(this,arguments)}}return m.call(h,y,v,C,T,w,P)}return read.__proto__=m,read}(h.read),h.readSync=(y=h.readSync,function(m,v,C,T,w){for(var A=0;;)try{return y.call(h,m,v,C,T,w)}catch(h){if("EAGAIN"===h.code&&A<10){A++;continue}throw h}});var y}},function(h,m,y){var v=y(19).Stream;h.exports=function legacy(h){return{ReadStream:function ReadStream(m,y){if(!(this instanceof ReadStream))return new ReadStream(m,y);v.call(this);var C=this;this.path=m,this.fd=null,this.readable=!0,this.paused=!1,this.flags="r",this.mode=438,this.bufferSize=65536,y=y||{};for(var T=Object.keys(y),w=0,A=T.length;w<A;w++){var P=T[w];this[P]=y[P]}this.encoding&&this.setEncoding(this.encoding);if(void 0!==this.start){if("number"!=typeof this.start)throw TypeError("start must be a Number");if(void 0===this.end)this.end=1/0;else if("number"!=typeof this.end)throw TypeError("end must be a Number");if(this.start>this.end)throw new Error("start must be <= end");this.pos=this.start}if(null!==this.fd)return void process.nextTick((function(){C._read()}));h.open(this.path,this.flags,this.mode,(function(h,m){if(h)return C.emit("error",h),void(C.readable=!1);C.fd=m,C.emit("open",m),C._read()}))},WriteStream:function WriteStream(m,y){if(!(this instanceof WriteStream))return new WriteStream(m,y);v.call(this),this.path=m,this.fd=null,this.writable=!0,this.flags="w",this.encoding="binary",this.mode=438,this.bytesWritten=0,y=y||{};for(var C=Object.keys(y),T=0,w=C.length;T<w;T++){var A=C[T];this[A]=y[A]}if(void 0!==this.start){if("number"!=typeof this.start)throw TypeError("start must be a Number");if(this.start<0)throw new Error("start must be >= zero");this.pos=this.start}this.busy=!1,this._queue=[],null===this.fd&&(this._open=h.open,this._queue.push([this._open,this.path,this.flags,this.mode,void 0]),this.flush())}}}},function(h,m,y){"use strict";h.exports=function clone(h){if(null===h||"object"!=typeof h)return h;if(h instanceof Object)var m={__proto__:h.__proto__};else m=Object.create(null);return Object.getOwnPropertyNames(h).forEach((function(y){Object.defineProperty(m,y,Object.getOwnPropertyDescriptor(h,y))})),m}},function(h,m,y){"use strict";const v=y(7),C=y(42),T=y(60).pathExists,w=y(217);h.exports=function outputJson(h,m,y,A){"function"==typeof y&&(A=y,y={});const P=v.dirname(h);T(P,(v,T)=>v?A(v):T?w.writeJson(h,m,y,A):void C.mkdirs(P,v=>{if(v)return A(v);w.writeJson(h,m,y,A)}))}},function(h,m,y){"use strict";const v=y(27),C=y(7),T=y(42),w=y(217);h.exports=function outputJsonSync(h,m,y){const A=C.dirname(h);v.existsSync(A)||T.mkdirsSync(A),w.writeJsonSync(h,m,y)}},function(h,m,y){"use strict";h.exports={moveSync:y(878)}},function(h,m,y){"use strict";const v=y(27),C=y(7),T=y(369).copySync,w=y(158).removeSync,A=y(42).mkdirpSync,P=y(157);function rename(h,m,y){try{v.renameSync(h,m)}catch(v){if("EXDEV"!==v.code)throw v;return function moveAcrossDevice(h,m,y){return T(h,m,{overwrite:y,errorOnExist:true}),w(h)}(h,m,y)}}h.exports=function moveSync(h,m,y){const T=(y=y||{}).overwrite||y.clobber||!1,{srcStat:k}=P.checkPathsSync(h,m,"move");return P.checkParentPathsSync(h,k,m,"move"),A(C.dirname(m)),function doRename(h,m,y){if(y)return w(m),rename(h,m,y);if(v.existsSync(m))throw new Error("dest already exists.");return rename(h,m,y)}(h,m,T)}},function(h,m,y){"use strict";const v=y(36).fromCallback;h.exports={move:v(y(880))}},function(h,m,y){"use strict";const v=y(27),C=y(7),T=y(372).copy,w=y(158).remove,A=y(42).mkdirp,P=y(60).pathExists,k=y(157);function rename(h,m,y,C){v.rename(h,m,v=>v?"EXDEV"!==v.code?C(v):function moveAcrossDevice(h,m,y,v){T(h,m,{overwrite:y,errorOnExist:!0},m=>m?v(m):w(h,v))}(h,m,y,C):C())}h.exports=function move(h,m,y,v){"function"==typeof y&&(v=y,y={});const T=y.overwrite||y.clobber||!1;k.checkPaths(h,m,"move",(y,R)=>{if(y)return v(y);const{srcStat:M}=R;k.checkParentPaths(h,M,m,"move",y=>{if(y)return v(y);A(C.dirname(m),y=>y?v(y):function doRename(h,m,y,v){if(y)return w(m,C=>C?v(C):rename(h,m,y,v));P(m,(C,T)=>C?v(C):T?v(new Error("dest already exists.")):rename(h,m,y,v))}(h,m,T,v))})})}},function(h,m,y){"use strict";const v=y(36).fromCallback,C=y(27),T=y(7),w=y(42),A=y(60).pathExists;h.exports={outputFile:v((function outputFile(h,m,y,v){"function"==typeof y&&(v=y,y="utf8");const P=T.dirname(h);A(P,(T,A)=>T?v(T):A?C.writeFile(h,m,y,v):void w.mkdirs(P,T=>{if(T)return v(T);C.writeFile(h,m,y,v)}))})),outputFileSync:function outputFileSync(h,...m){const y=T.dirname(h);if(C.existsSync(y))return C.writeFileSync(h,...m);w.mkdirsSync(y),C.writeFileSync(h,...m)}}},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0});const v=y(18),C=y(216);m.getPlatformProperty=function getPlatformProperty(){switch(v.platform()){case C.OSPlatform.WINDOWS:return"windows";case C.OSPlatform.MACOS:return"osx";case C.OSPlatform.LINUX:default:return"linux"}}},function(h,m,y){"use strict";var v=this&&this.__awaiter||function(h,m,y,v){return new(y||(y=Promise))((function(C,T){function fulfilled(h){try{step(v.next(h))}catch(h){T(h)}}function rejected(h){try{step(v.throw(h))}catch(h){T(h)}}function step(h){h.done?C(h.value):function adopt(h){return h instanceof y?h:new y((function(m){m(h)}))}(h.value).then(fulfilled,rejected)}step((v=v.apply(h,m||[])).next())}))};Object.defineProperty(m,"__esModule",{value:!0});const C=y(31),T=y(365);function startSocketSession(h){return v(this,void 0,void 0,(function*(){let m;const y=new Promise((y,v)=>{let C=!1;m=h(()=>{y(),C=!0}),m.on("close",()=>{C||v(new Error("connection closed"))}),m.on("error",h=>{C||v(h)})});return yield y,m}))}m.startSocketSession=startSocketSession,m.startSocketSessionOnPort=function startSocketSessionOnPort(h){return startSocketSession(m=>C.createConnection(h,"127.0.0.1",m))},m.startSocketSessionOnPipe=function startSocketSessionOnPipe(h,m){return startSocketSession(y=>C.createConnection(m?h:T.getPipePath(h),y))}},function(h,m,y){"use strict";const v=Symbol("singleComment"),C=Symbol("multiComment"),stripWithoutWhitespace=()=>"",stripWithWhitespace=(h,m,y)=>h.slice(m,y).replace(/\S/g," "),isEscaped=(h,m)=>{let y=m-1,v=0;for(;"\\"===h[y];)y-=1,v+=1;return Boolean(v%2)};h.exports=(h,m={})=>{const y=!1===m.whitespace?stripWithoutWhitespace:stripWithWhitespace;let T=!1,w=!1,A=0,P="";for(let m=0;m<h.length;m++){const k=h[m],R=h[m+1];if(!w&&'"'===k){isEscaped(h,m)||(T=!T)}if(!T)if(w||k+R!=="//"){if(w===v&&k+R==="\r\n"){m++,w=!1,P+=y(h,A,m),A=m;continue}if(w===v&&"\n"===k)w=!1,P+=y(h,A,m),A=m;else{if(!w&&k+R==="/*"){P+=h.slice(A,m),A=m,w=C,m++;continue}if(w===C&&k+R==="*/"){m++,w=!1,P+=y(h,A,m+1),A=m+1;continue}}}else P+=h.slice(A,m),A=m,w=v,m++}return P+(w?y(h.slice(A)):h.slice(A))}},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0});const v=y(155),C=y(218),T=y(122);let w;m.getPackageJSON=()=>{if(w)return w;const h=v.join(T.extensionContext.extensionPath,"./package.json");return w=C.loadJSON(h),w}},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0});const v=y(67);m.getLastFiles=v.getLastFiles},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0});const v=y(888);m.telemetryReporterFactory=v.sharedTelemetryFactory},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0}),m.sharedTelemetryFactory={create:h=>{const m=y(889).default,v=h,{name:C,version:T,aiKey:w}=v;if(!w)throw new Error("The `aiKey` property needs to be set in the `package.json`.");const A=new m(C,T,w);return{sendTelemetryEvent:(h,m,y)=>{A.sendTelemetryEvent(h,m,y)},sendTelemetryErrorEvent:(h,m,y,v)=>{A.sendTelemetryErrorEvent(h,m,y,v)},dispose:()=>A.dispose()}}}},function(h,m,y){var v=Object.create,C=Object.defineProperty,T=Object.getOwnPropertyDescriptor,w=Object.getOwnPropertyNames,A=Object.getOwnPropertySymbols,P=Object.getPrototypeOf,k=Object.prototype.hasOwnProperty,R=Object.prototype.propertyIsEnumerable,vl=(h,m,y)=>m in h?C(h,m,{enumerable:!0,configurable:!0,writable:!0,value:y}):h[m]=y,Vt=(h,m)=>{for(var y in m||(m={}))k.call(m,y)&&vl(h,y,m[y]);if(A)for(var y of A(m))R.call(m,y)&&vl(h,y,m[y]);return h},ml=h=>C(h,"__esModule",{value:!0}),l=(h,m)=>()=>(m||h((m={exports:{}}).exports,m),m.exports),Gi=h=>((h,m,y)=>{if(m&&"object"==typeof m||"function"==typeof m)for(let v of w(m))!k.call(h,v)&&"default"!==v&&C(h,v,{get:()=>m[v],enumerable:!(y=T(m,v))||y.enumerable});return h})(ml(C(null!=h?v(P(h)):{},"default",h&&h.__esModule&&"default"in h?{get:()=>h.default,enumerable:!0}:{value:h,enumerable:!0})),h),M=l((h,m)=>{"use strict";var y=function(){function e(){}return e.info=function(h){for(var m=[],y=1;y<arguments.length;y++)m[y-1]=arguments[y];e.enableDebug&&console.info(e.TAG+h,m)},e.warn=function(h){for(var m=[],y=1;y<arguments.length;y++)m[y-1]=arguments[y];e.disableWarnings||console.warn(e.TAG+h,m)},e.enableDebug=!1,e.disableWarnings=!1,e.disableErrors=!1,e.TAG="ApplicationInsights:",e}();m.exports=y}),N=l(h=>{"use strict";var m=h&&h.__assign||function(){return(m=Object.assign||function(h){for(var m,y=1,v=arguments.length;y<v;y++)for(var C in m=arguments[y])Object.prototype.hasOwnProperty.call(m,C)&&(h[C]=m[C]);return h}).apply(this,arguments)};Object.defineProperty(h,"__esModule",{value:!0}),h.AsyncScopeManager=h.OpenTelemetryScopeManagerWrapper=void 0;var v=Xr(),C=y(13),T=function(){function e(){}return e.prototype.active=function(){var h=this,y=v.CorrelationContextManager.getCurrentContext();return m(m({},y),{getValue:function(m){return h._activeSymbol?m===h._activeSymbol&&y:(h._activeSymbol=m,y)},setValue:function(){}})},e.prototype.with=function(h,m){var y=h.parentSpanId,C=h.name,T=e._spanToContext(h,y,C);return v.CorrelationContextManager.runWithContext(T,m)()},e.prototype.bind=function(h){return"function"==typeof h?v.CorrelationContextManager.wrapCallback(h):(h instanceof C.EventEmitter&&v.CorrelationContextManager.wrapEmitter(h),h)},e.prototype.enable=function(){return v.CorrelationContextManager.enable(),this},e.prototype.disable=function(){return v.CorrelationContextManager.disable(),this},e._spanToContext=function(h,y,C){var T=y?"|"+h.spanContext().traceId+"."+y+".":h.spanContext().traceId,w=m(m({},h.spanContext()),{traceFlags:h.spanContext().traceFlags});return v.CorrelationContextManager.spanToContextObject(w,T,C)},e}();h.OpenTelemetryScopeManagerWrapper=T,h.AsyncScopeManager=new T}),D=l((h,m)=>{var y;h=m.exports=b,y="object"==typeof process&&process.env&&process.env.NODE_DEBUG&&/\bsemver\b/i.test(process.env.NODE_DEBUG)?function(){var h=Array.prototype.slice.call(arguments,0);h.unshift("SEMVER"),console.log.apply(console,h)}:function(){},h.SEMVER_SPEC_VERSION="2.0.0";var v=Number.MAX_SAFE_INTEGER||9007199254740991,C=h.re=[],T=h.src=[],w=0,A=w++;T[A]="0|[1-9]\\d*";var P=w++;T[P]="[0-9]+";var k=w++;T[k]="\\d*[a-zA-Z-][a-zA-Z0-9-]*";var R=w++;T[R]="("+T[A]+")\\.("+T[A]+")\\.("+T[A]+")";var M=w++;T[M]="("+T[P]+")\\.("+T[P]+")\\.("+T[P]+")";var N=w++;T[N]="(?:"+T[A]+"|"+T[k]+")";var D=w++;T[D]="(?:"+T[P]+"|"+T[k]+")";var I=w++;T[I]="(?:-("+T[N]+"(?:\\."+T[N]+")*))";var x=w++;T[x]="(?:-?("+T[D]+"(?:\\."+T[D]+")*))";var O=w++;T[O]="[0-9A-Za-z-]+";var L=w++;T[L]="(?:\\+("+T[O]+"(?:\\."+T[O]+")*))";var U=w++,B="v?"+T[R]+T[I]+"?"+T[L]+"?";T[U]="^"+B+"$";var W="[v=\\s]*"+T[M]+T[x]+"?"+T[L]+"?",q=w++;T[q]="^"+W+"$";var Y=w++;T[Y]="((?:<|>)?=?)";var V=w++;T[V]=T[P]+"|x|X|\\*";var $=w++;T[$]=T[A]+"|x|X|\\*";var z=w++;T[z]="[v=\\s]*("+T[$]+")(?:\\.("+T[$]+")(?:\\.("+T[$]+")(?:"+T[I]+")?"+T[L]+"?)?)?";var G=w++;T[G]="[v=\\s]*("+T[V]+")(?:\\.("+T[V]+")(?:\\.("+T[V]+")(?:"+T[x]+")?"+T[L]+"?)?)?";var J=w++;T[J]="^"+T[Y]+"\\s*"+T[z]+"$";var X=w++;T[X]="^"+T[Y]+"\\s*"+T[G]+"$";var Z=w++;T[Z]="(?:^|[^\\d])(\\d{1,16})(?:\\.(\\d{1,16}))?(?:\\.(\\d{1,16}))?(?:$|[^\\d])";var ee=w++;T[ee]="(?:~>?)";var te=w++;T[te]="(\\s*)"+T[ee]+"\\s+",C[te]=new RegExp(T[te],"g");var re=w++;T[re]="^"+T[ee]+T[z]+"$";var ie=w++;T[ie]="^"+T[ee]+T[G]+"$";var se=w++;T[se]="(?:\\^)";var oe=w++;T[oe]="(\\s*)"+T[se]+"\\s+",C[oe]=new RegExp(T[oe],"g");var ae=w++;T[ae]="^"+T[se]+T[z]+"$";var ce=w++;T[ce]="^"+T[se]+T[G]+"$";var le=w++;T[le]="^"+T[Y]+"\\s*("+W+")$|^$";var ue=w++;T[ue]="^"+T[Y]+"\\s*("+B+")$|^$";var de=w++;T[de]="(\\s*)"+T[Y]+"\\s*("+W+"|"+T[z]+")",C[de]=new RegExp(T[de],"g");var he=w++;T[he]="^\\s*("+T[z]+")\\s+-\\s+("+T[z]+")\\s*$";var pe=w++;T[pe]="^\\s*("+T[G]+")\\s+-\\s+("+T[G]+")\\s*$";var me=w++;T[me]="(<|>)?=?\\s*\\*";for(var fe=0;fe<35;fe++)y(fe,T[fe]),C[fe]||(C[fe]=new RegExp(T[fe]));function Xt(h,m){if((!m||"object"!=typeof m)&&(m={loose:!!m,includePrerelease:!1}),h instanceof b)return h;if("string"!=typeof h||h.length>256)return null;if(!(m.loose?C[q]:C[U]).test(h))return null;try{return new b(h,m)}catch(h){return null}}function b(h,m){if((!m||"object"!=typeof m)&&(m={loose:!!m,includePrerelease:!1}),h instanceof b){if(h.loose===m.loose)return h;h=h.version}else if("string"!=typeof h)throw new TypeError("Invalid Version: "+h);if(h.length>256)throw new TypeError("version is longer than 256 characters");if(!(this instanceof b))return new b(h,m);y("SemVer",h,m),this.options=m,this.loose=!!m.loose;var T=h.trim().match(m.loose?C[q]:C[U]);if(!T)throw new TypeError("Invalid Version: "+h);if(this.raw=h,this.major=+T[1],this.minor=+T[2],this.patch=+T[3],this.major>v||this.major<0)throw new TypeError("Invalid major version");if(this.minor>v||this.minor<0)throw new TypeError("Invalid minor version");if(this.patch>v||this.patch<0)throw new TypeError("Invalid patch version");T[4]?this.prerelease=T[4].split(".").map((function(h){if(/^[0-9]+$/.test(h)){var m=+h;if(m>=0&&m<v)return m}return h})):this.prerelease=[],this.build=T[5]?T[5].split("."):[],this.format()}h.parse=Xt,h.valid=function VE(h,m){var y=Xt(h,m);return y?y.version:null},h.clean=function $E(h,m){var y=Xt(h.trim().replace(/^[=v]+/,""),m);return y?y.version:null},h.SemVer=b,b.prototype.format=function(){return this.version=this.major+"."+this.minor+"."+this.patch,this.prerelease.length&&(this.version+="-"+this.prerelease.join(".")),this.version},b.prototype.toString=function(){return this.version},b.prototype.compare=function(h){return y("SemVer.compare",this.version,this.options,h),h instanceof b||(h=new b(h,this.options)),this.compareMain(h)||this.comparePre(h)},b.prototype.compareMain=function(h){return h instanceof b||(h=new b(h,this.options)),Lr(this.major,h.major)||Lr(this.minor,h.minor)||Lr(this.patch,h.patch)},b.prototype.comparePre=function(h){if(h instanceof b||(h=new b(h,this.options)),this.prerelease.length&&!h.prerelease.length)return-1;if(!this.prerelease.length&&h.prerelease.length)return 1;if(!this.prerelease.length&&!h.prerelease.length)return 0;var m=0;do{var v=this.prerelease[m],C=h.prerelease[m];if(y("prerelease compare",m,v,C),void 0===v&&void 0===C)return 0;if(void 0===C)return 1;if(void 0===v)return-1;if(v!==C)return Lr(v,C)}while(++m)},b.prototype.inc=function(h,m){switch(h){case"premajor":this.prerelease.length=0,this.patch=0,this.minor=0,this.major++,this.inc("pre",m);break;case"preminor":this.prerelease.length=0,this.patch=0,this.minor++,this.inc("pre",m);break;case"prepatch":this.prerelease.length=0,this.inc("patch",m),this.inc("pre",m);break;case"prerelease":0===this.prerelease.length&&this.inc("patch",m),this.inc("pre",m);break;case"major":(0!==this.minor||0!==this.patch||0===this.prerelease.length)&&this.major++,this.minor=0,this.patch=0,this.prerelease=[];break;case"minor":(0!==this.patch||0===this.prerelease.length)&&this.minor++,this.patch=0,this.prerelease=[];break;case"patch":0===this.prerelease.length&&this.patch++,this.prerelease=[];break;case"pre":if(0===this.prerelease.length)this.prerelease=[0];else{for(var y=this.prerelease.length;--y>=0;)"number"==typeof this.prerelease[y]&&(this.prerelease[y]++,y=-2);-1===y&&this.prerelease.push(0)}m&&(this.prerelease[0]===m?isNaN(this.prerelease[1])&&(this.prerelease=[m,0]):this.prerelease=[m,0]);break;default:throw new Error("invalid increment argument: "+h)}return this.format(),this.raw=this.version,this},h.inc=function zE(h,m,y,v){"string"==typeof y&&(v=y,y=void 0);try{return new b(h,y).inc(m,v).version}catch(h){return null}},h.diff=function KE(h,m){if(yo(h,m))return null;var y=Xt(h),v=Xt(m),C="";if(y.prerelease.length||v.prerelease.length){C="pre";var T="prerelease"}for(var w in y)if(("major"===w||"minor"===w||"patch"===w)&&y[w]!==v[w])return C+w;return T},h.compareIdentifiers=Lr;var ye=/^[0-9]+$/;function Lr(h,m){var y=ye.test(h),v=ye.test(m);return y&&v&&(h=+h,m=+m),h===m?0:y&&!v?-1:v&&!y?1:h<m?-1:1}function it(h,m,y){return new b(h,y).compare(new b(m,y))}function Hn(h,m,y){return it(h,m,y)>0}function Qi(h,m,y){return it(h,m,y)<0}function yo(h,m,y){return 0===it(h,m,y)}function Ll(h,m,y){return 0!==it(h,m,y)}function To(h,m,y){return it(h,m,y)>=0}function So(h,m,y){return it(h,m,y)<=0}function Wi(h,m,y,v){switch(m){case"===":return"object"==typeof h&&(h=h.version),"object"==typeof y&&(y=y.version),h===y;case"!==":return"object"==typeof h&&(h=h.version),"object"==typeof y&&(y=y.version),h!==y;case"":case"=":case"==":return yo(h,y,v);case"!=":return Ll(h,y,v);case">":return Hn(h,y,v);case">=":return To(h,y,v);case"<":return Qi(h,y,v);case"<=":return So(h,y,v);default:throw new TypeError("Invalid operator: "+m)}}function Re(h,m){if((!m||"object"!=typeof m)&&(m={loose:!!m,includePrerelease:!1}),h instanceof Re){if(h.loose===!!m.loose)return h;h=h.value}if(!(this instanceof Re))return new Re(h,m);y("comparator",h,m),this.options=m,this.loose=!!m.loose,this.parse(h),this.semver===ve?this.value="":this.value=this.operator+this.semver.version,y("comp",this)}h.rcompareIdentifiers=function YE(h,m){return Lr(m,h)},h.major=function XE(h,m){return new b(h,m).major},h.minor=function QE(h,m){return new b(h,m).minor},h.patch=function WE(h,m){return new b(h,m).patch},h.compare=it,h.compareLoose=function ZE(h,m){return it(h,m,!0)},h.rcompare=function JE(h,m,y){return it(m,h,y)},h.sort=function ey(m,y){return m.sort((function(m,v){return h.compare(m,v,y)}))},h.rsort=function ty(m,y){return m.sort((function(m,v){return h.rcompare(m,v,y)}))},h.gt=Hn,h.lt=Qi,h.eq=yo,h.neq=Ll,h.gte=To,h.lte=So,h.cmp=Wi,h.Comparator=Re;var ve={};function H(h,m){if((!m||"object"!=typeof m)&&(m={loose:!!m,includePrerelease:!1}),h instanceof H)return h.loose===!!m.loose&&h.includePrerelease===!!m.includePrerelease?h:new H(h.raw,m);if(h instanceof Re)return new H(h.value,m);if(!(this instanceof H))return new H(h,m);if(this.options=m,this.loose=!!m.loose,this.includePrerelease=!!m.includePrerelease,this.raw=h,this.set=h.split(/\s*\|\|\s*/).map((function(h){return this.parseRange(h.trim())}),this).filter((function(h){return h.length})),!this.set.length)throw new TypeError("Invalid SemVer Range: "+h);this.format()}function ge(h){return!h||"x"===h.toLowerCase()||"*"===h}function py(h,m,y,v,C,T,w,A,P,k,R,M,N){return((m=ge(y)?"":ge(v)?">="+y+".0.0":ge(C)?">="+y+"."+v+".0":">="+m)+" "+(A=ge(P)?"":ge(k)?"<"+(+P+1)+".0.0":ge(R)?"<"+P+"."+(+k+1)+".0":M?"<="+P+"."+k+"."+R+"-"+M:"<="+A)).trim()}function dy(h,m,v){for(var C=0;C<h.length;C++)if(!h[C].test(m))return!1;if(m.prerelease.length&&!v.includePrerelease){for(C=0;C<h.length;C++)if(y(h[C].semver),h[C].semver!==ve&&h[C].semver.prerelease.length>0){var T=h[C].semver;if(T.major===m.major&&T.minor===m.minor&&T.patch===m.patch)return!0}return!1}return!0}function Zi(h,m,y){try{m=new H(m,y)}catch(h){return!1}return m.test(h)}function Ao(h,m,y,v){var C,T,w,A,P;switch(h=new b(h,v),m=new H(m,v),y){case">":C=Hn,T=So,w=Qi,A=">",P=">=";break;case"<":C=Qi,T=To,w=Hn,A="<",P="<=";break;default:throw new TypeError('Must provide a hilo val of "<" or ">"')}if(Zi(h,m,v))return!1;for(var k=0;k<m.set.length;++k){var R=m.set[k],M=null,N=null;if(R.forEach((function(h){h.semver===ve&&(h=new Re(">=0.0.0")),M=M||h,N=N||h,C(h.semver,M.semver,v)?M=h:w(h.semver,N.semver,v)&&(N=h)})),M.operator===A||M.operator===P||(!N.operator||N.operator===A)&&T(h,N.semver))return!1;if(N.operator===P&&w(h,N.semver))return!1}return!0}Re.prototype.parse=function(h){var m=this.options.loose?C[le]:C[ue],y=h.match(m);if(!y)throw new TypeError("Invalid comparator: "+h);this.operator=y[1],"="===this.operator&&(this.operator=""),y[2]?this.semver=new b(y[2],this.options.loose):this.semver=ve},Re.prototype.toString=function(){return this.value},Re.prototype.test=function(h){return y("Comparator.test",h,this.options.loose),this.semver===ve||("string"==typeof h&&(h=new b(h,this.options)),Wi(h,this.operator,this.semver,this.options))},Re.prototype.intersects=function(h,m){if(!(h instanceof Re))throw new TypeError("a Comparator is required");var y;if((!m||"object"!=typeof m)&&(m={loose:!!m,includePrerelease:!1}),""===this.operator)return y=new H(h.value,m),Zi(this.value,y,m);if(""===h.operator)return y=new H(this.value,m),Zi(h.semver,y,m);var v=!(">="!==this.operator&&">"!==this.operator||">="!==h.operator&&">"!==h.operator),C=!("<="!==this.operator&&"<"!==this.operator||"<="!==h.operator&&"<"!==h.operator),T=this.semver.version===h.semver.version,w=!(">="!==this.operator&&"<="!==this.operator||">="!==h.operator&&"<="!==h.operator),A=Wi(this.semver,"<",h.semver,m)&&(">="===this.operator||">"===this.operator)&&("<="===h.operator||"<"===h.operator),P=Wi(this.semver,">",h.semver,m)&&("<="===this.operator||"<"===this.operator)&&(">="===h.operator||">"===h.operator);return v||C||T&&w||A||P},h.Range=H,H.prototype.format=function(){return this.range=this.set.map((function(h){return h.join(" ").trim()})).join("||").trim(),this.range},H.prototype.toString=function(){return this.range},H.prototype.parseRange=function(h){var m=this.options.loose;h=h.trim();var v=m?C[pe]:C[he];h=h.replace(v,py),y("hyphen replace",h),h=h.replace(C[de],"$1$2$3"),y("comparator trim",h,C[de]),h=(h=(h=h.replace(C[te],"$1~")).replace(C[oe],"$1^")).split(/\s+/).join(" ");var T=m?C[le]:C[ue],w=h.split(" ").map((function(h){return function ny(h,m){return y("comp",h,m),h=function sy(h,m){return h.trim().split(/\s+/).map((function(h){return function oy(h,m){y("caret",h,m);var v=m.loose?C[ce]:C[ae];return h.replace(v,(function(m,v,C,T,w){var A;return y("caret",h,m,v,C,T,w),ge(v)?A="":ge(C)?A=">="+v+".0.0 <"+(+v+1)+".0.0":ge(T)?A="0"===v?">="+v+"."+C+".0 <"+v+"."+(+C+1)+".0":">="+v+"."+C+".0 <"+(+v+1)+".0.0":w?(y("replaceCaret pr",w),A="0"===v?"0"===C?">="+v+"."+C+"."+T+"-"+w+" <"+v+"."+C+"."+(+T+1):">="+v+"."+C+"."+T+"-"+w+" <"+v+"."+(+C+1)+".0":">="+v+"."+C+"."+T+"-"+w+" <"+(+v+1)+".0.0"):(y("no pr"),A="0"===v?"0"===C?">="+v+"."+C+"."+T+" <"+v+"."+C+"."+(+T+1):">="+v+"."+C+"."+T+" <"+v+"."+(+C+1)+".0":">="+v+"."+C+"."+T+" <"+(+v+1)+".0.0"),y("caret return",A),A}))}(h,m)})).join(" ")}(h,m),y("caret",h),h=function iy(h,m){return h.trim().split(/\s+/).map((function(h){return function ay(h,m){var v=m.loose?C[ie]:C[re];return h.replace(v,(function(m,v,C,T,w){var A;return y("tilde",h,m,v,C,T,w),ge(v)?A="":ge(C)?A=">="+v+".0.0 <"+(+v+1)+".0.0":ge(T)?A=">="+v+"."+C+".0 <"+v+"."+(+C+1)+".0":w?(y("replaceTilde pr",w),A=">="+v+"."+C+"."+T+"-"+w+" <"+v+"."+(+C+1)+".0"):A=">="+v+"."+C+"."+T+" <"+v+"."+(+C+1)+".0",y("tilde return",A),A}))}(h,m)})).join(" ")}(h,m),y("tildes",h),h=function cy(h,m){return y("replaceXRanges",h,m),h.split(/\s+/).map((function(h){return function uy(h,m){h=h.trim();var v=m.loose?C[X]:C[J];return h.replace(v,(function(m,v,C,T,w,A){y("xRange",h,m,v,C,T,w,A);var P=ge(C),k=P||ge(T),R=k||ge(w);return"="===v&&R&&(v=""),P?m=">"===v||"<"===v?"<0.0.0":"*":v&&R?(k&&(T=0),w=0,">"===v?(v=">=",k?(C=+C+1,T=0,w=0):(T=+T+1,w=0)):"<="===v&&(v="<",k?C=+C+1:T=+T+1),m=v+C+"."+T+"."+w):k?m=">="+C+".0.0 <"+(+C+1)+".0.0":R&&(m=">="+C+"."+T+".0 <"+C+"."+(+T+1)+".0"),y("xRange return",m),m}))}(h,m)})).join(" ")}(h,m),y("xrange",h),h=function ly(h,m){return y("replaceStars",h,m),h.trim().replace(C[me],"")}(h,m),y("stars",h),h}(h,this.options)}),this).join(" ").split(/\s+/);return this.options.loose&&(w=w.filter((function(h){return!!h.match(T)}))),w=w.map((function(h){return new Re(h,this.options)}),this)},H.prototype.intersects=function(h,m){if(!(h instanceof H))throw new TypeError("a Range is required");return this.set.some((function(y){return y.every((function(y){return h.set.some((function(h){return h.every((function(h){return y.intersects(h,m)}))}))}))}))},h.toComparators=function ry(h,m){return new H(h,m).set.map((function(h){return h.map((function(h){return h.value})).join(" ").trim().split(" ")}))},H.prototype.test=function(h){if(!h)return!1;"string"==typeof h&&(h=new b(h,this.options));for(var m=0;m<this.set.length;m++)if(dy(this.set[m],h,this.options))return!0;return!1},h.satisfies=Zi,h.maxSatisfying=function fy(h,m,y){var v=null,C=null;try{var T=new H(m,y)}catch(h){return null}return h.forEach((function(h){T.test(h)&&(!v||-1===C.compare(h))&&(C=new b(v=h,y))})),v},h.minSatisfying=function hy(h,m,y){var v=null,C=null;try{var T=new H(m,y)}catch(h){return null}return h.forEach((function(h){T.test(h)&&(!v||1===C.compare(h))&&(C=new b(v=h,y))})),v},h.minVersion=function _y(h,m){h=new H(h,m);var y=new b("0.0.0");if(h.test(y)||(y=new b("0.0.0-0"),h.test(y)))return y;y=null;for(var v=0;v<h.set.length;++v){h.set[v].forEach((function(h){var m=new b(h.semver.version);switch(h.operator){case">":0===m.prerelease.length?m.patch++:m.prerelease.push(0),m.raw=m.format();case"":case">=":(!y||Hn(y,m))&&(y=m);break;case"<":case"<=":break;default:throw new Error("Unexpected operation: "+h.operator)}}))}return y&&h.test(y)?y:null},h.validRange=function gy(h,m){try{return new H(h,m).range||"*"}catch(h){return null}},h.ltr=function vy(h,m,y){return Ao(h,m,"<",y)},h.gtr=function my(h,m,y){return Ao(h,m,">",y)},h.outside=Ao,h.prerelease=function Ey(h,m){var y=Xt(h,m);return y&&y.prerelease.length?y.prerelease:null},h.intersects=function yy(h,m,y){return h=new H(h,y),m=new H(m,y),h.intersects(m)},h.coerce=function Ty(h){if(h instanceof b)return h;if("string"!=typeof h)return null;var m=h.match(C[Z]);return null==m?null:Xt(m[1]+"."+(m[2]||"0")+"."+(m[3]||"0"))}}),I=l(h=>{"use strict";Object.defineProperty(h,"__esModule",{value:!0}),h.makePatchingRequire=void 0;var m=y(7),v=D(),C=y(203),T=Object.keys(process.binding("natives")),w=C.prototype.require;h.makePatchingRequire=function Iy(h){var y={};return function(A){var P=w.apply(this,arguments);if(h[A]){var k=C._resolveFilename(A,this);if(y.hasOwnProperty(k))return y[k];var R=void 0;if(T.indexOf(A)<0)try{R=w.call(this,m.join(A,"package.json")).version}catch(h){return P}else R=process.version.substring(1);var M=R.indexOf("-");M>=0&&(R=R.substring(0,M));for(var N=P,D=0,I=h[A];D<I.length;D++){var x=I[D];v.satisfies(R,x.versionSpecifier)&&(N=x.patch(N,k))}return y[k]=N}return P}}}),x=l((h,m)=>{m.exports={_args:[["diagnostic-channel@1.0.0","/home/runner/work/vscode-extension-telemetry/vscode-extension-telemetry"]],_development:!0,_from:"diagnostic-channel@1.0.0",_id:"diagnostic-channel@1.0.0",_inBundle:!1,_integrity:"sha512-v7Clmg5HG9XwIhqgbBRfwFzwZhxjvESZ33uu1cgcCLkdb9ZxgtY78eAgQMEQ39UecQ//4K5W75iq6LFBtAQD8w==",_location:"/diagnostic-channel",_phantomChildren:{},_requested:{type:"version",registry:!0,raw:"diagnostic-channel@1.0.0",name:"diagnostic-channel",escapedName:"diagnostic-channel",rawSpec:"1.0.0",saveSpec:null,fetchSpec:"1.0.0"},_requiredBy:["/applicationinsights"],_resolved:"https://registry.npmjs.org/diagnostic-channel/-/diagnostic-channel-1.0.0.tgz",_spec:"1.0.0",_where:"/home/runner/work/vscode-extension-telemetry/vscode-extension-telemetry",bugs:{url:"https://github.com/Microsoft/node-diagnostic-channel/issues"},dependencies:{semver:"^5.3.0"},description:"Provides a context-saving pub/sub channel to connect diagnostic event publishers and subscribers",devDependencies:{"@types/mocha":"^2.2.40","@types/node":"~8.0.0",mocha:"^3.2.0",rimraf:"^2.6.1",tslint:"^5.0.0",typescript:"4.1.2"},files:["dist/src/**/*.d.ts","dist/src/**/*.js","LICENSE","README.md","package.json"],homepage:"https://github.com/Microsoft/node-diagnostic-channel",license:"MIT",main:"./dist/src/channel.js",name:"diagnostic-channel",repository:{type:"git",url:"git+https://github.com/Microsoft/node-diagnostic-channel.git"},scripts:{build:"tsc",clean:"rimraf ./dist",lint:"tslint -c tslint.json -p tsconfig.json",test:"mocha ./dist/tests/**/*.js"},types:"./dist/src/channel.d.ts",version:"1.0.0"}}),O=l(h=>{"use strict";Object.defineProperty(h,"__esModule",{value:!0}),h.channel=h.makePatchingRequire=void 0;var m=I(),v=I();Object.defineProperty(h,"makePatchingRequire",{enumerable:!0,get:function(){return v.makePatchingRequire}});var Ul=function(h){return!0},C=function(){function e(){this.version=x().version,this.subscribers={},this.contextPreservationFunction=function(h){return h},this.knownPatches={},this.currentlyPublishing=!1}return e.prototype.shouldPublish=function(h){var m=this.subscribers[h];return!!m&&m.some((function(h){var m=h.filter;return!m||m(!1)}))},e.prototype.publish=function(h,m){if(!this.currentlyPublishing){var y=this.subscribers[h];if(y){var v={timestamp:Date.now(),data:m};this.currentlyPublishing=!0,y.forEach((function(h){var m=h.listener,y=h.filter;try{y&&y(!0)&&m(v)}catch(h){}})),this.currentlyPublishing=!1}}},e.prototype.subscribe=function(h,m,y){void 0===y&&(y=Ul),this.subscribers[h]||(this.subscribers[h]=[]),this.subscribers[h].push({listener:m,filter:y})},e.prototype.unsubscribe=function(h,m,y){void 0===y&&(y=Ul);var v=this.subscribers[h];if(v)for(var C=0;C<v.length;++C)if(v[C].listener===m&&v[C].filter===y)return v.splice(C,1),!0;return!1},e.prototype.reset=function(){var h=this;this.subscribers={},this.contextPreservationFunction=function(h){return h},Object.getOwnPropertyNames(this.knownPatches).forEach((function(m){return delete h.knownPatches[m]}))},e.prototype.bindToContext=function(h){return this.contextPreservationFunction(h)},e.prototype.addContextPreservation=function(h){var m=this.contextPreservationFunction;this.contextPreservationFunction=function(y){return h(m(y))}},e.prototype.registerMonkeyPatch=function(h,m){this.knownPatches[h]||(this.knownPatches[h]=[]),this.knownPatches[h].push(m)},e.prototype.getPatchesObject=function(){return this.knownPatches},e}();global.diagnosticsSource||(global.diagnosticsSource=new C,y(203).prototype.require=m.makePatchingRequire(global.diagnosticsSource.getPatchesObject())),h.channel=global.diagnosticsSource}),L=l(h=>{"use strict";Object.defineProperty(h,"__esModule",{value:!0})}),U=l(h=>{"use strict";Object.defineProperty(h,"__esModule",{value:!0}),h.BaggageImpl=void 0;var m=function(){function e(h){this._entries=h?new Map(h):new Map}return e.prototype.getEntry=function(h){var m=this._entries.get(h);if(m)return Object.assign({},m)},e.prototype.getAllEntries=function(){return Array.from(this._entries.entries()).map((function(h){return[h[0],h[1]]}))},e.prototype.setEntry=function(h,m){var y=new e(this._entries);return y._entries.set(h,m),y},e.prototype.removeEntry=function(h){var m=new e(this._entries);return m._entries.delete(h),m},e.prototype.removeEntries=function(){for(var h=[],m=0;m<arguments.length;m++)h[m]=arguments[m];for(var y=new e(this._entries),v=0,C=h;v<C.length;v++){var T=C[v];y._entries.delete(T)}return y},e.prototype.clear=function(){return new e},e}();h.BaggageImpl=m}),B=l(h=>{"use strict";Object.defineProperty(h,"__esModule",{value:!0}),h.baggageEntryMetadataSymbol=void 0,h.baggageEntryMetadataSymbol=Symbol("BaggageEntryMetadata")}),W=l(h=>{"use strict";Object.defineProperty(h,"__esModule",{value:!0}),h.baggageEntryMetadataFromString=h.createBaggage=void 0;var m=Be(),y=U(),v=B();h.createBaggage=function xy(h){return void 0===h&&(h={}),new y.BaggageImpl(new Map(Object.entries(h)))},h.baggageEntryMetadataFromString=function Ly(h){return"string"!=typeof h&&(m.diag.error("Cannot create baggage metadata from unknown type: "+typeof h),h=""),{__TYPE__:v.baggageEntryMetadataSymbol,toString:function(){return h}}}}),q=l(h=>{"use strict";Object.defineProperty(h,"__esModule",{value:!0})}),Y=l(h=>{"use strict";Object.defineProperty(h,"__esModule",{value:!0})}),V=l(h=>{"use strict";Object.defineProperty(h,"__esModule",{value:!0}),h.DiagConsoleLogger=void 0;var m=[{n:"error",c:"error"},{n:"warn",c:"warn"},{n:"info",c:"info"},{n:"debug",c:"debug"},{n:"verbose",c:"trace"}],y=function e(){function t(h){return function(){var m=arguments;if(console){var y=console[h];if("function"!=typeof y&&(y=console.log),"function"==typeof y)return y.apply(console,m)}}}for(var h=0;h<m.length;h++)this[m[h].n]=t(m[h].c)};h.DiagConsoleLogger=y}),$=l(h=>{"use strict";var m;Object.defineProperty(h,"__esModule",{value:!0}),h.DiagLogLevel=void 0,(m=h.DiagLogLevel||(h.DiagLogLevel={}))[m.NONE=0]="NONE",m[m.ERROR=30]="ERROR",m[m.WARN=50]="WARN",m[m.INFO=60]="INFO",m[m.DEBUG=70]="DEBUG",m[m.VERBOSE=80]="VERBOSE",m[m.ALL=9999]="ALL"}),z=l(h=>{"use strict";var m=h&&h.__createBinding||(Object.create?function(h,m,y,v){void 0===v&&(v=y),Object.defineProperty(h,v,{enumerable:!0,get:function(){return m[y]}})}:function(h,m,y,v){void 0===v&&(v=y),h[v]=m[y]}),y=h&&h.__exportStar||function(h,y){for(var v in h)"default"!==v&&!Object.prototype.hasOwnProperty.call(y,v)&&m(y,h,v)};Object.defineProperty(h,"__esModule",{value:!0}),y(V(),h),y($(),h)}),G=l(h=>{"use strict";Object.defineProperty(h,"__esModule",{value:!0}),h.defaultTextMapSetter=h.defaultTextMapGetter=void 0,h.defaultTextMapGetter={get:function(h,m){if(null!=h)return h[m]},keys:function(h){return null==h?[]:Object.keys(h)}},h.defaultTextMapSetter={set:function(h,m,y){null!=h&&(h[m]=y)}}}),J=l(h=>{"use strict";Object.defineProperty(h,"__esModule",{value:!0})}),X=l(h=>{"use strict";Object.defineProperty(h,"__esModule",{value:!0})}),Z=l(h=>{"use strict";Object.defineProperty(h,"__esModule",{value:!0}),h.ROOT_CONTEXT=h.createContextKey=void 0,h.createContextKey=function Hy(h){return Symbol.for(h)};var m=function e(h){var m=this;m._currentContext=h?new Map(h):new Map,m.getValue=function(h){return m._currentContext.get(h)},m.setValue=function(h,y){var v=new e(m._currentContext);return v._currentContext.set(h,y),v},m.deleteValue=function(h){var y=new e(m._currentContext);return y._currentContext.delete(h),y}};h.ROOT_CONTEXT=new m}),ee=l(h=>{"use strict";var m;Object.defineProperty(h,"__esModule",{value:!0}),h.TraceFlags=void 0,(m=h.TraceFlags||(h.TraceFlags={}))[m.NONE=0]="NONE",m[m.SAMPLED=1]="SAMPLED"}),te=l(h=>{"use strict";Object.defineProperty(h,"__esModule",{value:!0}),h.wrapSpanContext=h.isSpanContextValid=h.isValidSpanId=h.isValidTraceId=h.INVALID_SPAN_CONTEXT=h.INVALID_TRACEID=h.INVALID_SPANID=void 0;var m=re(),y=ee(),v=/^([0-9a-f]{32})$/i,C=/^[0-9a-f]{16}$/i;function np(m){return v.test(m)&&m!==h.INVALID_TRACEID}function ip(m){return C.test(m)&&m!==h.INVALID_SPANID}h.INVALID_SPANID="0000000000000000",h.INVALID_TRACEID="00000000000000000000000000000000",h.INVALID_SPAN_CONTEXT={traceId:h.INVALID_TRACEID,spanId:h.INVALID_SPANID,traceFlags:y.TraceFlags.NONE},h.isValidTraceId=np,h.isValidSpanId=ip,h.isSpanContextValid=function zy(h){return np(h.traceId)&&ip(h.spanId)},h.wrapSpanContext=function Ky(h){return new m.NonRecordingSpan(h)}}),re=l(h=>{"use strict";Object.defineProperty(h,"__esModule",{value:!0}),h.NonRecordingSpan=void 0;var m=te(),y=function(){function e(h){void 0===h&&(h=m.INVALID_SPAN_CONTEXT),this._spanContext=h}return e.prototype.spanContext=function(){return this._spanContext},e.prototype.setAttribute=function(h,m){return this},e.prototype.setAttributes=function(h){return this},e.prototype.addEvent=function(h,m){return this},e.prototype.setStatus=function(h){return this},e.prototype.updateName=function(h){return this},e.prototype.end=function(h){},e.prototype.isRecording=function(){return!1},e.prototype.recordException=function(h,m){},e}();h.NonRecordingSpan=y}),ie=l(h=>{"use strict";Object.defineProperty(h,"__esModule",{value:!0}),h.getSpanContext=h.setSpanContext=h.deleteSpan=h.setSpan=h.getSpan=void 0;var m=Z(),y=re(),v=m.createContextKey("OpenTelemetry Context Key SPAN");function ap(h){return h.getValue(v)||void 0}function sp(h,m){return h.setValue(v,m)}h.getSpan=ap,h.setSpan=sp,h.deleteSpan=function Zy(h){return h.deleteValue(v)},h.setSpanContext=function Jy(h,m){return sp(h,new y.NonRecordingSpan(m))},h.getSpanContext=function eT(h){var m;return null===(m=ap(h))||void 0===m?void 0:m.spanContext()}}),se=l(h=>{"use strict";Object.defineProperty(h,"__esModule",{value:!0}),h.NoopTracer=void 0;var m=Be(),y=ie(),v=re(),C=te(),T=function(){function e(){}return e.prototype.startSpan=function(h,m,T){if(Boolean(null==m?void 0:m.root))return new v.NonRecordingSpan;var w=T&&y.getSpanContext(T);return function nT(h){return"object"==typeof h&&"string"==typeof h.spanId&&"string"==typeof h.traceId&&"number"==typeof h.traceFlags}(w)&&C.isSpanContextValid(w)?new v.NonRecordingSpan(w):new v.NonRecordingSpan},e.prototype.startActiveSpan=function(h,v,C,T){var w,A,P;if(!(arguments.length<2)){2===arguments.length?P=v:3===arguments.length?(w=v,P=C):(w=v,A=C,P=T);var k=null!=A?A:m.context.active(),R=this.startSpan(h,w,k),M=y.setSpan(k,R);return m.context.with(M,P,void 0,R)}},e}();h.NoopTracer=T}),oe=l(h=>{"use strict";Object.defineProperty(h,"__esModule",{value:!0}),h.ProxyTracer=void 0;var m=se(),y=function(){function e(h,m,y){this._provider=h,this.name=m,this.version=y}return e.prototype.startSpan=function(h,m,y){return this._getTracer().startSpan(h,m,y)},e.prototype.startActiveSpan=function(h,m,y,v){var C=this._getTracer();return Reflect.apply(C.startActiveSpan,C,arguments)},e.prototype._getTracer=function(){if(this._delegate)return this._delegate;var h=this._provider.getDelegateTracer(this.name,this.version);return h?(this._delegate=h,this._delegate):new m.NoopTracer},e}();h.ProxyTracer=y}),ae=l(h=>{"use strict";Object.defineProperty(h,"__esModule",{value:!0}),h.NoopTracerProvider=void 0;var m=se(),y=function(){function e(){}return e.prototype.getTracer=function(h,y){return new m.NoopTracer},e}();h.NoopTracerProvider=y}),ce=l(h=>{"use strict";Object.defineProperty(h,"__esModule",{value:!0}),h.ProxyTracerProvider=void 0;var m=oe(),y=new(ae().NoopTracerProvider),v=function(){function e(){}return e.prototype.getTracer=function(h,y){var v;return null!==(v=this.getDelegateTracer(h,y))&&void 0!==v?v:new m.ProxyTracer(this,h,y)},e.prototype.getDelegate=function(){var h;return null!==(h=this._delegate)&&void 0!==h?h:y},e.prototype.setDelegate=function(h){this._delegate=h},e.prototype.getDelegateTracer=function(h,m){var y;return null===(y=this._delegate)||void 0===y?void 0:y.getTracer(h,m)},e}();h.ProxyTracerProvider=v}),le=l(h=>{"use strict";Object.defineProperty(h,"__esModule",{value:!0})}),ue=l(h=>{"use strict";var m;Object.defineProperty(h,"__esModule",{value:!0}),h.SamplingDecision=void 0,(m=h.SamplingDecision||(h.SamplingDecision={}))[m.NOT_RECORD=0]="NOT_RECORD",m[m.RECORD=1]="RECORD",m[m.RECORD_AND_SAMPLED=2]="RECORD_AND_SAMPLED"}),de=l(h=>{"use strict";Object.defineProperty(h,"__esModule",{value:!0})}),he=l(h=>{"use strict";var m;Object.defineProperty(h,"__esModule",{value:!0}),h.SpanKind=void 0,(m=h.SpanKind||(h.SpanKind={}))[m.INTERNAL=0]="INTERNAL",m[m.SERVER=1]="SERVER",m[m.CLIENT=2]="CLIENT",m[m.PRODUCER=3]="PRODUCER",m[m.CONSUMER=4]="CONSUMER"}),pe=l(h=>{"use strict";Object.defineProperty(h,"__esModule",{value:!0})}),me=l(h=>{"use strict";Object.defineProperty(h,"__esModule",{value:!0})}),fe=l(h=>{"use strict";var m;Object.defineProperty(h,"__esModule",{value:!0}),h.SpanStatusCode=void 0,(m=h.SpanStatusCode||(h.SpanStatusCode={}))[m.UNSET=0]="UNSET",m[m.OK=1]="OK",m[m.ERROR=2]="ERROR"}),ye=l(h=>{"use strict";Object.defineProperty(h,"__esModule",{value:!0})}),ve=l(h=>{"use strict";Object.defineProperty(h,"__esModule",{value:!0})}),Se=l(h=>{"use strict";Object.defineProperty(h,"__esModule",{value:!0})}),Ee=l(h=>{"use strict";Object.defineProperty(h,"__esModule",{value:!0})}),Ce=l(h=>{"use strict";var m=h&&h.__spreadArray||function(h,m){for(var y=0,v=m.length,C=h.length;y<v;y++,C++)h[C]=m[y];return h};Object.defineProperty(h,"__esModule",{value:!0}),h.NoopContextManager=void 0;var y=Z(),v=function(){function e(){}return e.prototype.active=function(){return y.ROOT_CONTEXT},e.prototype.with=function(h,y,v){for(var C=[],T=3;T<arguments.length;T++)C[T-3]=arguments[T];return y.call.apply(y,m([v],C))},e.prototype.bind=function(h,m){return m},e.prototype.enable=function(){return this},e.prototype.disable=function(){return this},e}();h.NoopContextManager=v}),_e=l(h=>{"use strict";Object.defineProperty(h,"__esModule",{value:!0}),h._globalThis=void 0,h._globalThis="object"==typeof globalThis?globalThis:global}),Te=l(h=>{"use strict";var m=h&&h.__createBinding||(Object.create?function(h,m,y,v){void 0===v&&(v=y),Object.defineProperty(h,v,{enumerable:!0,get:function(){return m[y]}})}:function(h,m,y,v){void 0===v&&(v=y),h[v]=m[y]}),y=h&&h.__exportStar||function(h,y){for(var v in h)"default"!==v&&!Object.prototype.hasOwnProperty.call(y,v)&&m(y,h,v)};Object.defineProperty(h,"__esModule",{value:!0}),y(_e(),h)}),be=l(h=>{"use strict";var m=h&&h.__createBinding||(Object.create?function(h,m,y,v){void 0===v&&(v=y),Object.defineProperty(h,v,{enumerable:!0,get:function(){return m[y]}})}:function(h,m,y,v){void 0===v&&(v=y),h[v]=m[y]}),y=h&&h.__exportStar||function(h,y){for(var v in h)"default"!==v&&!Object.prototype.hasOwnProperty.call(y,v)&&m(y,h,v)};Object.defineProperty(h,"__esModule",{value:!0}),y(Te(),h)}),we=l(h=>{"use strict";Object.defineProperty(h,"__esModule",{value:!0}),h.VERSION=void 0,h.VERSION="1.0.1"}),Ae=l(h=>{"use strict";Object.defineProperty(h,"__esModule",{value:!0}),h.isCompatible=h._makeCompatibilityCheck=void 0;var m=we(),y=/^(\d+)\.(\d+)\.(\d+)(?:-(.*))?$/;function xp(h){var m=new Set([h]),v=new Set,C=h.match(y);if(!C)return function(){return!1};var T=+C[1],w=+C[2],A=+C[3];function a(h){return v.add(h),!1}function s(h){return m.add(h),!0}return function(h){if(m.has(h))return!0;if(v.has(h))return!1;var C=h.match(y);if(!C)return a(h);var P=+C[1],k=+C[2],R=+C[3];return T!==P?a(h):0===T?w===k&&A<=R?s(h):a(h):w<=k?s(h):a(h)}}h._makeCompatibilityCheck=xp,h.isCompatible=xp(m.VERSION)}),Pe=l(h=>{"use strict";Object.defineProperty(h,"__esModule",{value:!0}),h.unregisterGlobal=h.getGlobal=h.registerGlobal=void 0;var m=be(),y=we(),v=Ae(),C=y.VERSION.split(".")[0],T=Symbol.for("opentelemetry.js.api."+C),w=m._globalThis;h.registerGlobal=function CT(h,m,v,C){var A;void 0===C&&(C=!1);var P=w[T]=null!==(A=w[T])&&void 0!==A?A:{version:y.VERSION};if(!C&&P[h]){var k=new Error("@opentelemetry/api: Attempted duplicate registration of API: "+h);return v.error(k.stack||k.message),!1}if(P.version!==y.VERSION){k=new Error("@opentelemetry/api: All API registration versions must match");return v.error(k.stack||k.message),!1}return P[h]=m,v.debug("@opentelemetry/api: Registered a global for "+h+" v"+y.VERSION+"."),!0},h.getGlobal=function PT(h){var m,y,C=null===(m=w[T])||void 0===m?void 0:m.version;if(C&&v.isCompatible(C))return null===(y=w[T])||void 0===y?void 0:y[h]},h.unregisterGlobal=function OT(h,m){m.debug("@opentelemetry/api: Unregistering a global for "+h+" v"+y.VERSION+".");var v=w[T];v&&delete v[h]}}),ke=l(h=>{"use strict";Object.defineProperty(h,"__esModule",{value:!0}),h.DiagComponentLogger=void 0;var m=Pe(),y=function(){function e(h){this._namespace=h.namespace||"DiagComponentLogger"}return e.prototype.debug=function(){for(var h=[],m=0;m<arguments.length;m++)h[m]=arguments[m];return Wn("debug",this._namespace,h)},e.prototype.error=function(){for(var h=[],m=0;m<arguments.length;m++)h[m]=arguments[m];return Wn("error",this._namespace,h)},e.prototype.info=function(){for(var h=[],m=0;m<arguments.length;m++)h[m]=arguments[m];return Wn("info",this._namespace,h)},e.prototype.warn=function(){for(var h=[],m=0;m<arguments.length;m++)h[m]=arguments[m];return Wn("warn",this._namespace,h)},e.prototype.verbose=function(){for(var h=[],m=0;m<arguments.length;m++)h[m]=arguments[m];return Wn("verbose",this._namespace,h)},e}();function Wn(h,y,v){var C=m.getGlobal("diag");if(C)return v.unshift(y),C[h].apply(C,v)}h.DiagComponentLogger=y}),Ne=l(h=>{"use strict";Object.defineProperty(h,"__esModule",{value:!0}),h.createLogLevelDiagLogger=void 0;var m=$();h.createLogLevelDiagLogger=function DT(h,y){function r(m,v){var C=y[m];return"function"==typeof C&&h>=v?C.bind(y):function(){}}return h<m.DiagLogLevel.NONE?h=m.DiagLogLevel.NONE:h>m.DiagLogLevel.ALL&&(h=m.DiagLogLevel.ALL),y=y||{},{error:r("error",m.DiagLogLevel.ERROR),warn:r("warn",m.DiagLogLevel.WARN),info:r("info",m.DiagLogLevel.INFO),debug:r("debug",m.DiagLogLevel.DEBUG),verbose:r("verbose",m.DiagLogLevel.VERBOSE)}}}),De=l(h=>{"use strict";Object.defineProperty(h,"__esModule",{value:!0}),h.DiagAPI=void 0;var m=ke(),y=Ne(),v=$(),C=Pe(),T=function(){function e(){function t(h){return function(){var m=C.getGlobal("diag");if(m)return m[h].apply(m,arguments)}}var h=this;h.setLogger=function(m,T){var w,A;if(void 0===T&&(T=v.DiagLogLevel.INFO),m===h){var P=new Error("Cannot use diag as the logger for itself. Please use a DiagLogger implementation like ConsoleDiagLogger or a custom implementation");return h.error(null!==(w=P.stack)&&void 0!==w?w:P.message),!1}var k=C.getGlobal("diag"),R=y.createLogLevelDiagLogger(T,m);if(k){var M=null!==(A=(new Error).stack)&&void 0!==A?A:"<failed to generate stacktrace>";k.warn("Current logger will be overwritten from "+M),R.warn("Current logger will overwrite one already registered from "+M)}return C.registerGlobal("diag",R,h,!0)},h.disable=function(){C.unregisterGlobal("diag",h)},h.createComponentLogger=function(h){return new m.DiagComponentLogger(h)},h.verbose=t("verbose"),h.debug=t("debug"),h.info=t("info"),h.warn=t("warn"),h.error=t("error")}return e.instance=function(){return this._instance||(this._instance=new e),this._instance},e}();h.DiagAPI=T}),Ie=l(h=>{"use strict";var m=h&&h.__spreadArray||function(h,m){for(var y=0,v=m.length,C=h.length;y<v;y++,C++)h[C]=m[y];return h};Object.defineProperty(h,"__esModule",{value:!0}),h.ContextAPI=void 0;var y=Ce(),v=Pe(),C=De(),T="context",w=new y.NoopContextManager,A=function(){function e(){}return e.getInstance=function(){return this._instance||(this._instance=new e),this._instance},e.prototype.setGlobalContextManager=function(h){return v.registerGlobal(T,h,C.DiagAPI.instance())},e.prototype.active=function(){return this._getContextManager().active()},e.prototype.with=function(h,y,v){for(var C,T=[],w=3;w<arguments.length;w++)T[w-3]=arguments[w];return(C=this._getContextManager()).with.apply(C,m([h,y,v],T))},e.prototype.bind=function(h,m){return this._getContextManager().bind(h,m)},e.prototype._getContextManager=function(){return v.getGlobal(T)||w},e.prototype.disable=function(){this._getContextManager().disable(),v.unregisterGlobal(T,C.DiagAPI.instance())},e}();h.ContextAPI=A}),Oe=l(h=>{"use strict";Object.defineProperty(h,"__esModule",{value:!0}),h.TraceAPI=void 0;var m=Pe(),y=ce(),v=te(),C=ie(),T=De(),w="trace",A=function(){function e(){this._proxyTracerProvider=new y.ProxyTracerProvider,this.wrapSpanContext=v.wrapSpanContext,this.isSpanContextValid=v.isSpanContextValid,this.deleteSpan=C.deleteSpan,this.getSpan=C.getSpan,this.getSpanContext=C.getSpanContext,this.setSpan=C.setSpan,this.setSpanContext=C.setSpanContext}return e.getInstance=function(){return this._instance||(this._instance=new e),this._instance},e.prototype.setGlobalTracerProvider=function(h){return this._proxyTracerProvider.setDelegate(h),m.registerGlobal(w,this._proxyTracerProvider,T.DiagAPI.instance())},e.prototype.getTracerProvider=function(){return m.getGlobal(w)||this._proxyTracerProvider},e.prototype.getTracer=function(h,m){return this.getTracerProvider().getTracer(h,m)},e.prototype.disable=function(){m.unregisterGlobal(w,T.DiagAPI.instance()),this._proxyTracerProvider=new y.ProxyTracerProvider},e}();h.TraceAPI=A}),Le=l(h=>{"use strict";Object.defineProperty(h,"__esModule",{value:!0}),h.NoopTextMapPropagator=void 0;var m=function(){function e(){}return e.prototype.inject=function(h,m){},e.prototype.extract=function(h,m){return h},e.prototype.fields=function(){return[]},e}();h.NoopTextMapPropagator=m}),Ue=l(h=>{"use strict";Object.defineProperty(h,"__esModule",{value:!0}),h.deleteBaggage=h.setBaggage=h.getBaggage=void 0;var m=Z().createContextKey("OpenTelemetry Baggage Key");h.getBaggage=function VT(h){return h.getValue(m)||void 0},h.setBaggage=function $T(h,y){return h.setValue(m,y)},h.deleteBaggage=function zT(h){return h.deleteValue(m)}}),je=l(h=>{"use strict";Object.defineProperty(h,"__esModule",{value:!0}),h.PropagationAPI=void 0;var m=Pe(),y=Le(),v=G(),C=Ue(),T=W(),w=De(),A="propagation",P=new y.NoopTextMapPropagator,k=function(){function e(){this.createBaggage=T.createBaggage,this.getBaggage=C.getBaggage,this.setBaggage=C.setBaggage,this.deleteBaggage=C.deleteBaggage}return e.getInstance=function(){return this._instance||(this._instance=new e),this._instance},e.prototype.setGlobalPropagator=function(h){return m.registerGlobal(A,h,w.DiagAPI.instance())},e.prototype.inject=function(h,m,y){return void 0===y&&(y=v.defaultTextMapSetter),this._getGlobalPropagator().inject(h,m,y)},e.prototype.extract=function(h,m,y){return void 0===y&&(y=v.defaultTextMapGetter),this._getGlobalPropagator().extract(h,m,y)},e.prototype.fields=function(){return this._getGlobalPropagator().fields()},e.prototype.disable=function(){m.unregisterGlobal(A,w.DiagAPI.instance())},e.prototype._getGlobalPropagator=function(){return m.getGlobal(A)||P},e}();h.PropagationAPI=k}),Be=l(h=>{"use strict";var m=h&&h.__createBinding||(Object.create?function(h,m,y,v){void 0===v&&(v=y),Object.defineProperty(h,v,{enumerable:!0,get:function(){return m[y]}})}:function(h,m,y,v){void 0===v&&(v=y),h[v]=m[y]}),y=h&&h.__exportStar||function(h,y){for(var v in h)"default"!==v&&!Object.prototype.hasOwnProperty.call(y,v)&&m(y,h,v)};Object.defineProperty(h,"__esModule",{value:!0}),h.diag=h.propagation=h.trace=h.context=h.isValidSpanId=h.isValidTraceId=h.isSpanContextValid=h.INVALID_SPAN_CONTEXT=h.INVALID_TRACEID=h.INVALID_SPANID=h.baggageEntryMetadataFromString=void 0,y(L(),h);var v=W();Object.defineProperty(h,"baggageEntryMetadataFromString",{enumerable:!0,get:function(){return v.baggageEntryMetadataFromString}}),y(q(),h),y(Y(),h),y(z(),h),y(G(),h),y(J(),h),y(X(),h),y(oe(),h),y(ce(),h),y(le(),h),y(ue(),h),y(de(),h),y(he(),h),y(pe(),h),y(me(),h),y(fe(),h),y(ee(),h),y(ye(),h),y(ve(),h),y(Se(),h);var C=te();Object.defineProperty(h,"INVALID_SPANID",{enumerable:!0,get:function(){return C.INVALID_SPANID}}),Object.defineProperty(h,"INVALID_TRACEID",{enumerable:!0,get:function(){return C.INVALID_TRACEID}}),Object.defineProperty(h,"INVALID_SPAN_CONTEXT",{enumerable:!0,get:function(){return C.INVALID_SPAN_CONTEXT}}),Object.defineProperty(h,"isSpanContextValid",{enumerable:!0,get:function(){return C.isSpanContextValid}}),Object.defineProperty(h,"isValidTraceId",{enumerable:!0,get:function(){return C.isValidTraceId}}),Object.defineProperty(h,"isValidSpanId",{enumerable:!0,get:function(){return C.isValidSpanId}}),y(Z(),h),y(Ee(),h);var T=Ie();h.context=T.ContextAPI.getInstance();var w=Oe();h.trace=w.TraceAPI.getInstance();var A=je();h.propagation=A.PropagationAPI.getInstance();var P=De();h.diag=P.DiagAPI.instance(),h.default={trace:h.trace,context:h.context,propagation:h.propagation,diag:h.diag}}),He=l(h=>{"use strict";Object.defineProperty(h,"__esModule",{value:!0}),h.isTracingSuppressed=h.unsuppressTracing=h.suppressTracing=void 0;var m=Be().createContextKey("OpenTelemetry SDK Context Key SUPPRESS_TRACING");h.suppressTracing=function iS(h){return h.setValue(m,!0)},h.unsuppressTracing=function aS(h){return h.deleteValue(m)},h.isTracingSuppressed=function sS(h){return!0===h.getValue(m)}}),qe=l(h=>{"use strict";Object.defineProperty(h,"__esModule",{value:!0}),h.BAGGAGE_MAX_TOTAL_LENGTH=h.BAGGAGE_MAX_PER_NAME_VALUE_PAIRS=h.BAGGAGE_MAX_NAME_VALUE_PAIRS=h.BAGGAGE_HEADER=h.BAGGAGE_ITEMS_SEPARATOR=h.BAGGAGE_PROPERTIES_SEPARATOR=h.BAGGAGE_KEY_PAIR_SEPARATOR=void 0,h.BAGGAGE_KEY_PAIR_SEPARATOR="=",h.BAGGAGE_PROPERTIES_SEPARATOR=";",h.BAGGAGE_ITEMS_SEPARATOR=",",h.BAGGAGE_HEADER="baggage",h.BAGGAGE_MAX_NAME_VALUE_PAIRS=180,h.BAGGAGE_MAX_PER_NAME_VALUE_PAIRS=4096,h.BAGGAGE_MAX_TOTAL_LENGTH=8192}),Ye=l(h=>{"use strict";Object.defineProperty(h,"__esModule",{value:!0}),h.parseKeyPairsIntoRecord=h.parsePairKeyValue=h.getKeyPairs=h.serializeKeyPairs=void 0;var m=Be(),y=qe();h.serializeKeyPairs=h=>h.reduce((h,m)=>{let v=`${h}${""!==h?y.BAGGAGE_ITEMS_SEPARATOR:""}${m}`;return v.length>y.BAGGAGE_MAX_TOTAL_LENGTH?h:v},"");h.getKeyPairs=h=>h.getAllEntries().map(([h,m])=>`${encodeURIComponent(h)}=${encodeURIComponent(m.value)}`);h.parsePairKeyValue=h=>{let v=h.split(y.BAGGAGE_PROPERTIES_SEPARATOR);if(v.length<=0)return;let C=v.shift();if(!C)return;let T=C.split(y.BAGGAGE_KEY_PAIR_SEPARATOR);if(2!==T.length)return;let w,A=decodeURIComponent(T[0].trim()),P=decodeURIComponent(T[1].trim());return v.length>0&&(w=m.baggageEntryMetadataFromString(v.join(y.BAGGAGE_PROPERTIES_SEPARATOR))),{key:A,value:P,metadata:w}};h.parseKeyPairsIntoRecord=m=>"string"!=typeof m||0===m.length?{}:m.split(y.BAGGAGE_ITEMS_SEPARATOR).map(m=>h.parsePairKeyValue(m)).filter(h=>void 0!==h&&h.value.length>0).reduce((h,m)=>(h[m.key]=m.value,h),{})}),Ve=l(h=>{"use strict";Object.defineProperty(h,"__esModule",{value:!0}),h.HttpBaggagePropagator=void 0;var m=Be(),y=He(),v=qe(),C=Ye();h.HttpBaggagePropagator=class{inject(h,T,w){let A=m.propagation.getBaggage(h);if(!A||y.isTracingSuppressed(h))return;let P=C.getKeyPairs(A).filter(h=>h.length<=v.BAGGAGE_MAX_PER_NAME_VALUE_PAIRS).slice(0,v.BAGGAGE_MAX_NAME_VALUE_PAIRS),k=C.serializeKeyPairs(P);k.length>0&&w.set(T,v.BAGGAGE_HEADER,k)}extract(h,y,T){let w=T.get(y,v.BAGGAGE_HEADER);if(!w)return h;let A={};return 0===w.length||(w.split(v.BAGGAGE_ITEMS_SEPARATOR).forEach(h=>{let m=C.parsePairKeyValue(h);if(m){let h={value:m.value};m.metadata&&(h.metadata=m.metadata),A[m.key]=h}}),0===Object.entries(A).length)?h:m.propagation.setBaggage(h,m.propagation.createBaggage(A))}fields(){return[v.BAGGAGE_HEADER]}}}),$e=l(h=>{"use strict";function Wp(h){return null==h||(Array.isArray(h)?function hS(h){let m;for(let y of h)if(null!=y){if(!m){if(Zp(y)){m=typeof y;continue}return!1}if(typeof y!==m)return!1}return!0}(h):Zp(h))}function Zp(h){switch(typeof h){case"number":case"boolean":case"string":return!0}return!1}Object.defineProperty(h,"__esModule",{value:!0}),h.isAttributeValue=h.sanitizeAttributes=void 0,h.sanitizeAttributes=function fS(h){let m={};if(null==h||"object"!=typeof h)return m;for(let[y,v]of Object.entries(h))Wp(v)&&(Array.isArray(v)?m[y]=v.slice():m[y]=v);return m},h.isAttributeValue=Wp}),Ke=l(h=>{"use strict";Object.defineProperty(h,"__esModule",{value:!0}),h.loggingErrorHandler=void 0;var m=Be();h.loggingErrorHandler=function gS(){return h=>{m.diag.error(function vS(h){return"string"==typeof h?h:JSON.stringify(function mS(h){let m={},y=h;for(;null!==y;)Object.getOwnPropertyNames(y).forEach(h=>{if(m[h])return;let v=y[h];v&&(m[h]=String(v))}),y=Object.getPrototypeOf(y);return m}(h))}(h))}}}),ze=l(h=>{"use strict";Object.defineProperty(h,"__esModule",{value:!0}),h.globalErrorHandler=h.setGlobalErrorHandler=void 0;var m=Ke().loggingErrorHandler();h.setGlobalErrorHandler=function yS(h){m=h};h.globalErrorHandler=h=>{try{m(h)}catch(h){}}}),Ge=l(h=>{"use strict";var m;Object.defineProperty(h,"__esModule",{value:!0}),h.TracesSamplerValues=void 0,(m=h.TracesSamplerValues||(h.TracesSamplerValues={})).AlwaysOff="always_off",m.AlwaysOn="always_on",m.ParentBasedAlwaysOff="parentbased_always_off",m.ParentBasedAlwaysOn="parentbased_always_on",m.ParentBasedTraceIdRatio="parentbased_traceidratio",m.TraceIdRatio="traceidratio"}),Xe=l(h=>{"use strict";Object.defineProperty(h,"__esModule",{value:!0}),h.parseEnvironment=h.DEFAULT_ENVIRONMENT=void 0;var m=Be(),y=Ge(),v=["OTEL_BSP_EXPORT_TIMEOUT","OTEL_BSP_MAX_EXPORT_BATCH_SIZE","OTEL_BSP_MAX_QUEUE_SIZE","OTEL_BSP_SCHEDULE_DELAY","OTEL_SPAN_ATTRIBUTE_COUNT_LIMIT","OTEL_SPAN_EVENT_COUNT_LIMIT","OTEL_SPAN_LINK_COUNT_LIMIT"];function CS(h){return v.indexOf(h)>-1}var C=["OTEL_NO_PATCH_MODULES","OTEL_PROPAGATORS"];function OS(h){return C.indexOf(h)>-1}function RS(h,m,y,v=-1/0,C=1/0){if(void 0!==y[h]){let T=Number(y[h]);isNaN(T)||(m[h]=T<v?v:T>C?C:T)}}function NS(h,m,y,v=","){let C=y[h];"string"==typeof C&&(m[h]=C.split(v).map(h=>h.trim()))}h.DEFAULT_ENVIRONMENT={CONTAINER_NAME:"",ECS_CONTAINER_METADATA_URI_V4:"",ECS_CONTAINER_METADATA_URI:"",HOSTNAME:"",KUBERNETES_SERVICE_HOST:"",NAMESPACE:"",OTEL_BSP_EXPORT_TIMEOUT:3e4,OTEL_BSP_MAX_EXPORT_BATCH_SIZE:512,OTEL_BSP_MAX_QUEUE_SIZE:2048,OTEL_BSP_SCHEDULE_DELAY:5e3,OTEL_EXPORTER_JAEGER_AGENT_HOST:"",OTEL_EXPORTER_JAEGER_ENDPOINT:"",OTEL_EXPORTER_JAEGER_PASSWORD:"",OTEL_EXPORTER_JAEGER_USER:"",OTEL_EXPORTER_OTLP_ENDPOINT:"",OTEL_EXPORTER_OTLP_TRACES_ENDPOINT:"",OTEL_EXPORTER_OTLP_METRICS_ENDPOINT:"",OTEL_EXPORTER_OTLP_HEADERS:"",OTEL_EXPORTER_OTLP_TRACES_HEADERS:"",OTEL_EXPORTER_OTLP_METRICS_HEADERS:"",OTEL_EXPORTER_ZIPKIN_ENDPOINT:"http://localhost:9411/api/v2/spans",OTEL_LOG_LEVEL:m.DiagLogLevel.INFO,OTEL_NO_PATCH_MODULES:[],OTEL_PROPAGATORS:["tracecontext","baggage"],OTEL_RESOURCE_ATTRIBUTES:"",OTEL_SERVICE_NAME:"",OTEL_SPAN_ATTRIBUTE_COUNT_LIMIT:128,OTEL_SPAN_EVENT_COUNT_LIMIT:128,OTEL_SPAN_LINK_COUNT_LIMIT:128,OTEL_TRACES_EXPORTER:"none",OTEL_TRACES_SAMPLER:y.TracesSamplerValues.ParentBasedAlwaysOn,OTEL_TRACES_SAMPLER_ARG:""};var T={ALL:m.DiagLogLevel.ALL,VERBOSE:m.DiagLogLevel.VERBOSE,DEBUG:m.DiagLogLevel.DEBUG,INFO:m.DiagLogLevel.INFO,WARN:m.DiagLogLevel.WARN,ERROR:m.DiagLogLevel.ERROR,NONE:m.DiagLogLevel.NONE};function wS(h,m,y){let v=y[h];if("string"==typeof v){let y=T[v.toUpperCase()];null!=y&&(m[h]=y)}}h.parseEnvironment=function MS(m){let y={};for(let v in h.DEFAULT_ENVIRONMENT){let h=v;switch(h){case"OTEL_LOG_LEVEL":wS(h,y,m);break;default:if(CS(h))RS(h,y,m);else if(OS(h))NS(h,y,m);else{let v=m[h];null!=v&&(y[h]=String(v))}}}return y}}),Qe=l(h=>{"use strict";Object.defineProperty(h,"__esModule",{value:!0}),h.getEnv=void 0;var m=y(18),v=Xe();h.getEnv=function LS(){let h=v.parseEnvironment(process.env);return Object.assign({HOSTNAME:m.hostname()},v.DEFAULT_ENVIRONMENT,h)}}),Ze=l(h=>{"use strict";Object.defineProperty(h,"__esModule",{value:!0}),h.hexToBase64=void 0,h.hexToBase64=function qS(h){let m=h.length,y="";for(let v=0;v<m;v+=2){let m=h.substring(v,v+2),C=parseInt(m,16);y+=String.fromCharCode(C)}return Buffer.from(y,"ascii").toString("base64")}}),et=l(h=>{"use strict";Object.defineProperty(h,"__esModule",{value:!0}),h.RandomIdGenerator=void 0;h.RandomIdGenerator=class{constructor(){this.generateTraceId=sd(16),this.generateSpanId=sd(8)}};var m=Buffer.allocUnsafe(16);function sd(h){return function(){for(let y=0;y<h/4;y++)m.writeUInt32BE(Math.random()*2**32>>>0,4*y);for(let y=0;y<h&&!(m[y]>0);y++)y===h-1&&(m[h-1]=1);return m.toString("hex",0,h)}}}),tt=l(h=>{"use strict";Object.defineProperty(h,"__esModule",{value:!0}),h.otperformance=void 0;var m=y(373);h.otperformance=m.performance}),nt=l(h=>{"use strict";Object.defineProperty(h,"__esModule",{value:!0}),h.VERSION=void 0,h.VERSION="0.23.0"}),rt=l(h=>{"use strict";var m;Object.defineProperty(h,"__esModule",{value:!0}),h.RpcGrpcStatusCodeValues=h.MessagingOperationValues=h.MessagingDestinationKindValues=h.HttpFlavorValues=h.NetTransportValues=h.FaasInvokedProviderValues=h.FaasDocumentOperationValues=h.FaasTriggerValues=h.DbCassandraConsistencyLevelValues=h.DbSystemValues=h.SemanticAttributes=void 0,h.SemanticAttributes={DB_SYSTEM:"db.system",DB_CONNECTION_STRING:"db.connection_string",DB_USER:"db.user",DB_JDBC_DRIVER_CLASSNAME:"db.jdbc.driver_classname",DB_NAME:"db.name",DB_STATEMENT:"db.statement",DB_OPERATION:"db.operation",DB_MSSQL_INSTANCE_NAME:"db.mssql.instance_name",DB_CASSANDRA_KEYSPACE:"db.cassandra.keyspace",DB_CASSANDRA_PAGE_SIZE:"db.cassandra.page_size",DB_CASSANDRA_CONSISTENCY_LEVEL:"db.cassandra.consistency_level",DB_CASSANDRA_TABLE:"db.cassandra.table",DB_CASSANDRA_IDEMPOTENCE:"db.cassandra.idempotence",DB_CASSANDRA_SPECULATIVE_EXECUTION_COUNT:"db.cassandra.speculative_execution_count",DB_CASSANDRA_COORDINATOR_ID:"db.cassandra.coordinator.id",DB_CASSANDRA_COORDINATOR_DC:"db.cassandra.coordinator.dc",DB_HBASE_NAMESPACE:"db.hbase.namespace",DB_REDIS_DATABASE_INDEX:"db.redis.database_index",DB_MONGODB_COLLECTION:"db.mongodb.collection",DB_SQL_TABLE:"db.sql.table",EXCEPTION_TYPE:"exception.type",EXCEPTION_MESSAGE:"exception.message",EXCEPTION_STACKTRACE:"exception.stacktrace",EXCEPTION_ESCAPED:"exception.escaped",FAAS_TRIGGER:"faas.trigger",FAAS_EXECUTION:"faas.execution",FAAS_DOCUMENT_COLLECTION:"faas.document.collection",FAAS_DOCUMENT_OPERATION:"faas.document.operation",FAAS_DOCUMENT_TIME:"faas.document.time",FAAS_DOCUMENT_NAME:"faas.document.name",FAAS_TIME:"faas.time",FAAS_CRON:"faas.cron",FAAS_COLDSTART:"faas.coldstart",FAAS_INVOKED_NAME:"faas.invoked_name",FAAS_INVOKED_PROVIDER:"faas.invoked_provider",FAAS_INVOKED_REGION:"faas.invoked_region",NET_TRANSPORT:"net.transport",NET_PEER_IP:"net.peer.ip",NET_PEER_PORT:"net.peer.port",NET_PEER_NAME:"net.peer.name",NET_HOST_IP:"net.host.ip",NET_HOST_PORT:"net.host.port",NET_HOST_NAME:"net.host.name",PEER_SERVICE:"peer.service",ENDUSER_ID:"enduser.id",ENDUSER_ROLE:"enduser.role",ENDUSER_SCOPE:"enduser.scope",THREAD_ID:"thread.id",THREAD_NAME:"thread.name",CODE_FUNCTION:"code.function",CODE_NAMESPACE:"code.namespace",CODE_FILEPATH:"code.filepath",CODE_LINENO:"code.lineno",HTTP_METHOD:"http.method",HTTP_URL:"http.url",HTTP_TARGET:"http.target",HTTP_HOST:"http.host",HTTP_SCHEME:"http.scheme",HTTP_STATUS_CODE:"http.status_code",HTTP_FLAVOR:"http.flavor",HTTP_USER_AGENT:"http.user_agent",HTTP_REQUEST_CONTENT_LENGTH:"http.request_content_length",HTTP_REQUEST_CONTENT_LENGTH_UNCOMPRESSED:"http.request_content_length_uncompressed",HTTP_RESPONSE_CONTENT_LENGTH:"http.response_content_length",HTTP_RESPONSE_CONTENT_LENGTH_UNCOMPRESSED:"http.response_content_length_uncompressed",HTTP_SERVER_NAME:"http.server_name",HTTP_ROUTE:"http.route",HTTP_CLIENT_IP:"http.client_ip",AWS_DYNAMODB_TABLE_NAMES:"aws.dynamodb.table_names",AWS_DYNAMODB_CONSUMED_CAPACITY:"aws.dynamodb.consumed_capacity",AWS_DYNAMODB_ITEM_COLLECTION_METRICS:"aws.dynamodb.item_collection_metrics",AWS_DYNAMODB_PROVISIONED_READ_CAPACITY:"aws.dynamodb.provisioned_read_capacity",AWS_DYNAMODB_PROVISIONED_WRITE_CAPACITY:"aws.dynamodb.provisioned_write_capacity",AWS_DYNAMODB_CONSISTENT_READ:"aws.dynamodb.consistent_read",AWS_DYNAMODB_PROJECTION:"aws.dynamodb.projection",AWS_DYNAMODB_LIMIT:"aws.dynamodb.limit",AWS_DYNAMODB_ATTRIBUTES_TO_GET:"aws.dynamodb.attributes_to_get",AWS_DYNAMODB_INDEX_NAME:"aws.dynamodb.index_name",AWS_DYNAMODB_SELECT:"aws.dynamodb.select",AWS_DYNAMODB_GLOBAL_SECONDARY_INDEXES:"aws.dynamodb.global_secondary_indexes",AWS_DYNAMODB_LOCAL_SECONDARY_INDEXES:"aws.dynamodb.local_secondary_indexes",AWS_DYNAMODB_EXCLUSIVE_START_TABLE:"aws.dynamodb.exclusive_start_table",AWS_DYNAMODB_TABLE_COUNT:"aws.dynamodb.table_count",AWS_DYNAMODB_SCAN_FORWARD:"aws.dynamodb.scan_forward",AWS_DYNAMODB_SEGMENT:"aws.dynamodb.segment",AWS_DYNAMODB_TOTAL_SEGMENTS:"aws.dynamodb.total_segments",AWS_DYNAMODB_COUNT:"aws.dynamodb.count",AWS_DYNAMODB_SCANNED_COUNT:"aws.dynamodb.scanned_count",AWS_DYNAMODB_ATTRIBUTE_DEFINITIONS:"aws.dynamodb.attribute_definitions",AWS_DYNAMODB_GLOBAL_SECONDARY_INDEX_UPDATES:"aws.dynamodb.global_secondary_index_updates",MESSAGING_SYSTEM:"messaging.system",MESSAGING_DESTINATION:"messaging.destination",MESSAGING_DESTINATION_KIND:"messaging.destination_kind",MESSAGING_TEMP_DESTINATION:"messaging.temp_destination",MESSAGING_PROTOCOL:"messaging.protocol",MESSAGING_PROTOCOL_VERSION:"messaging.protocol_version",MESSAGING_URL:"messaging.url",MESSAGING_MESSAGE_ID:"messaging.message_id",MESSAGING_CONVERSATION_ID:"messaging.conversation_id",MESSAGING_MESSAGE_PAYLOAD_SIZE_BYTES:"messaging.message_payload_size_bytes",MESSAGING_MESSAGE_PAYLOAD_COMPRESSED_SIZE_BYTES:"messaging.message_payload_compressed_size_bytes",MESSAGING_OPERATION:"messaging.operation",MESSAGING_RABBITMQ_ROUTING_KEY:"messaging.rabbitmq.routing_key",MESSAGING_KAFKA_MESSAGE_KEY:"messaging.kafka.message_key",MESSAGING_KAFKA_CONSUMER_GROUP:"messaging.kafka.consumer_group",MESSAGING_KAFKA_CLIENT_ID:"messaging.kafka.client_id",MESSAGING_KAFKA_PARTITION:"messaging.kafka.partition",MESSAGING_KAFKA_TOMBSTONE:"messaging.kafka.tombstone",RPC_SYSTEM:"rpc.system",RPC_SERVICE:"rpc.service",RPC_METHOD:"rpc.method",RPC_GRPC_STATUS_CODE:"rpc.grpc.status_code",RPC_JSONRPC_VERSION:"rpc.jsonrpc.version",RPC_JSONRPC_METHOD:"rpc.jsonrpc.method",RPC_JSONRPC_REQUEST_ID:"rpc.jsonrpc.request_id",RPC_JSONRPC_ERROR_CODE:"rpc.jsonrpc.error_code",RPC_JSONRPC_ERROR_MESSAGE:"rpc.jsonrpc.error_message"},(m=h.DbSystemValues||(h.DbSystemValues={})).OTHER_SQL="other_sql",m.MSSQL="mssql",m.MYSQL="mysql",m.ORACLE="oracle",m.DB2="db2",m.POSTGRESQL="postgresql",m.REDSHIFT="redshift",m.HIVE="hive",m.CLOUDSCAPE="cloudscape",m.HSQLDB="hsqldb",m.PROGRESS="progress",m.MAXDB="maxdb",m.HANADB="hanadb",m.INGRES="ingres",m.FIRSTSQL="firstsql",m.EDB="edb",m.CACHE="cache",m.ADABAS="adabas",m.FIREBIRD="firebird",m.DERBY="derby",m.FILEMAKER="filemaker",m.INFORMIX="informix",m.INSTANTDB="instantdb",m.INTERBASE="interbase",m.MARIADB="mariadb",m.NETEZZA="netezza",m.PERVASIVE="pervasive",m.POINTBASE="pointbase",m.SQLITE="sqlite",m.SYBASE="sybase",m.TERADATA="teradata",m.VERTICA="vertica",m.H2="h2",m.COLDFUSION="coldfusion",m.CASSANDRA="cassandra",m.HBASE="hbase",m.MONGODB="mongodb",m.REDIS="redis",m.COUCHBASE="couchbase",m.COUCHDB="couchdb",m.COSMOSDB="cosmosdb",m.DYNAMODB="dynamodb",m.NEO4J="neo4j",m.GEODE="geode",m.ELASTICSEARCH="elasticsearch",m.MEMCACHED="memcached",m.COCKROACHDB="cockroachdb",function(h){h.ALL="all",h.EACH_QUORUM="each_quorum",h.QUORUM="quorum",h.LOCAL_QUORUM="local_quorum",h.ONE="one",h.TWO="two",h.THREE="three",h.LOCAL_ONE="local_one",h.ANY="any",h.SERIAL="serial",h.LOCAL_SERIAL="local_serial"}(h.DbCassandraConsistencyLevelValues||(h.DbCassandraConsistencyLevelValues={})),function(h){h.DATASOURCE="datasource",h.HTTP="http",h.PUBSUB="pubsub",h.TIMER="timer",h.OTHER="other"}(h.FaasTriggerValues||(h.FaasTriggerValues={})),function(h){h.INSERT="insert",h.EDIT="edit",h.DELETE="delete"}(h.FaasDocumentOperationValues||(h.FaasDocumentOperationValues={})),function(h){h.AWS="aws",h.AZURE="azure",h.GCP="gcp"}(h.FaasInvokedProviderValues||(h.FaasInvokedProviderValues={})),function(h){h.IP_TCP="ip_tcp",h.IP_UDP="ip_udp",h.IP="ip",h.UNIX="unix",h.PIPE="pipe",h.INPROC="inproc",h.OTHER="other"}(h.NetTransportValues||(h.NetTransportValues={})),function(h){h.HTTP_1_0="1.0",h.HTTP_1_1="1.1",h.HTTP_2_0="2.0",h.SPDY="SPDY",h.QUIC="QUIC"}(h.HttpFlavorValues||(h.HttpFlavorValues={})),function(h){h.QUEUE="queue",h.TOPIC="topic"}(h.MessagingDestinationKindValues||(h.MessagingDestinationKindValues={})),function(h){h.RECEIVE="receive",h.PROCESS="process"}(h.MessagingOperationValues||(h.MessagingOperationValues={})),function(h){h[h.OK=0]="OK",h[h.CANCELLED=1]="CANCELLED",h[h.UNKNOWN=2]="UNKNOWN",h[h.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",h[h.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",h[h.NOT_FOUND=5]="NOT_FOUND",h[h.ALREADY_EXISTS=6]="ALREADY_EXISTS",h[h.PERMISSION_DENIED=7]="PERMISSION_DENIED",h[h.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",h[h.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",h[h.ABORTED=10]="ABORTED",h[h.OUT_OF_RANGE=11]="OUT_OF_RANGE",h[h.UNIMPLEMENTED=12]="UNIMPLEMENTED",h[h.INTERNAL=13]="INTERNAL",h[h.UNAVAILABLE=14]="UNAVAILABLE",h[h.DATA_LOSS=15]="DATA_LOSS",h[h.UNAUTHENTICATED=16]="UNAUTHENTICATED"}(h.RpcGrpcStatusCodeValues||(h.RpcGrpcStatusCodeValues={}))}),st=l(h=>{"use strict";var m=h&&h.__createBinding||(Object.create?function(h,m,y,v){void 0===v&&(v=y),Object.defineProperty(h,v,{enumerable:!0,get:function(){return m[y]}})}:function(h,m,y,v){void 0===v&&(v=y),h[v]=m[y]}),y=h&&h.__exportStar||function(h,y){for(var v in h)"default"!==v&&!Object.prototype.hasOwnProperty.call(y,v)&&m(y,h,v)};Object.defineProperty(h,"__esModule",{value:!0}),y(rt(),h)}),ot=l(h=>{"use strict";var m;Object.defineProperty(h,"__esModule",{value:!0}),h.TelemetrySdkLanguageValues=h.OsTypeValues=h.HostArchValues=h.AwsEcsLaunchtypeValues=h.CloudPlatformValues=h.CloudProviderValues=h.ResourceAttributes=void 0,h.ResourceAttributes={CLOUD_PROVIDER:"cloud.provider",CLOUD_ACCOUNT_ID:"cloud.account.id",CLOUD_REGION:"cloud.region",CLOUD_AVAILABILITY_ZONE:"cloud.availability_zone",CLOUD_PLATFORM:"cloud.platform",AWS_ECS_CONTAINER_ARN:"aws.ecs.container.arn",AWS_ECS_CLUSTER_ARN:"aws.ecs.cluster.arn",AWS_ECS_LAUNCHTYPE:"aws.ecs.launchtype",AWS_ECS_TASK_ARN:"aws.ecs.task.arn",AWS_ECS_TASK_FAMILY:"aws.ecs.task.family",AWS_ECS_TASK_REVISION:"aws.ecs.task.revision",AWS_EKS_CLUSTER_ARN:"aws.eks.cluster.arn",AWS_LOG_GROUP_NAMES:"aws.log.group.names",AWS_LOG_GROUP_ARNS:"aws.log.group.arns",AWS_LOG_STREAM_NAMES:"aws.log.stream.names",AWS_LOG_STREAM_ARNS:"aws.log.stream.arns",CONTAINER_NAME:"container.name",CONTAINER_ID:"container.id",CONTAINER_RUNTIME:"container.runtime",CONTAINER_IMAGE_NAME:"container.image.name",CONTAINER_IMAGE_TAG:"container.image.tag",DEPLOYMENT_ENVIRONMENT:"deployment.environment",DEVICE_ID:"device.id",DEVICE_MODEL_IDENTIFIER:"device.model.identifier",DEVICE_MODEL_NAME:"device.model.name",FAAS_NAME:"faas.name",FAAS_ID:"faas.id",FAAS_VERSION:"faas.version",FAAS_INSTANCE:"faas.instance",FAAS_MAX_MEMORY:"faas.max_memory",HOST_ID:"host.id",HOST_NAME:"host.name",HOST_TYPE:"host.type",HOST_ARCH:"host.arch",HOST_IMAGE_NAME:"host.image.name",HOST_IMAGE_ID:"host.image.id",HOST_IMAGE_VERSION:"host.image.version",K8S_CLUSTER_NAME:"k8s.cluster.name",K8S_NODE_NAME:"k8s.node.name",K8S_NODE_UID:"k8s.node.uid",K8S_NAMESPACE_NAME:"k8s.namespace.name",K8S_POD_UID:"k8s.pod.uid",K8S_POD_NAME:"k8s.pod.name",K8S_CONTAINER_NAME:"k8s.container.name",K8S_REPLICASET_UID:"k8s.replicaset.uid",K8S_REPLICASET_NAME:"k8s.replicaset.name",K8S_DEPLOYMENT_UID:"k8s.deployment.uid",K8S_DEPLOYMENT_NAME:"k8s.deployment.name",K8S_STATEFULSET_UID:"k8s.statefulset.uid",K8S_STATEFULSET_NAME:"k8s.statefulset.name",K8S_DAEMONSET_UID:"k8s.daemonset.uid",K8S_DAEMONSET_NAME:"k8s.daemonset.name",K8S_JOB_UID:"k8s.job.uid",K8S_JOB_NAME:"k8s.job.name",K8S_CRONJOB_UID:"k8s.cronjob.uid",K8S_CRONJOB_NAME:"k8s.cronjob.name",OS_TYPE:"os.type",OS_DESCRIPTION:"os.description",OS_NAME:"os.name",OS_VERSION:"os.version",PROCESS_PID:"process.pid",PROCESS_EXECUTABLE_NAME:"process.executable.name",PROCESS_EXECUTABLE_PATH:"process.executable.path",PROCESS_COMMAND:"process.command",PROCESS_COMMAND_LINE:"process.command_line",PROCESS_COMMAND_ARGS:"process.command_args",PROCESS_OWNER:"process.owner",PROCESS_RUNTIME_NAME:"process.runtime.name",PROCESS_RUNTIME_VERSION:"process.runtime.version",PROCESS_RUNTIME_DESCRIPTION:"process.runtime.description",SERVICE_NAME:"service.name",SERVICE_NAMESPACE:"service.namespace",SERVICE_INSTANCE_ID:"service.instance.id",SERVICE_VERSION:"service.version",TELEMETRY_SDK_NAME:"telemetry.sdk.name",TELEMETRY_SDK_LANGUAGE:"telemetry.sdk.language",TELEMETRY_SDK_VERSION:"telemetry.sdk.version",TELEMETRY_AUTO_VERSION:"telemetry.auto.version",WEBENGINE_NAME:"webengine.name",WEBENGINE_VERSION:"webengine.version",WEBENGINE_DESCRIPTION:"webengine.description"},(m=h.CloudProviderValues||(h.CloudProviderValues={})).AWS="aws",m.AZURE="azure",m.GCP="gcp",function(h){h.AWS_EC2="aws_ec2",h.AWS_ECS="aws_ecs",h.AWS_EKS="aws_eks",h.AWS_LAMBDA="aws_lambda",h.AWS_ELASTIC_BEANSTALK="aws_elastic_beanstalk",h.AZURE_VM="azure_vm",h.AZURE_CONTAINER_INSTANCES="azure_container_instances",h.AZURE_AKS="azure_aks",h.AZURE_FUNCTIONS="azure_functions",h.AZURE_APP_SERVICE="azure_app_service",h.GCP_COMPUTE_ENGINE="gcp_compute_engine",h.GCP_CLOUD_RUN="gcp_cloud_run",h.GCP_KUBERNETES_ENGINE="gcp_kubernetes_engine",h.GCP_CLOUD_FUNCTIONS="gcp_cloud_functions",h.GCP_APP_ENGINE="gcp_app_engine"}(h.CloudPlatformValues||(h.CloudPlatformValues={})),function(h){h.EC2="ec2",h.FARGATE="fargate"}(h.AwsEcsLaunchtypeValues||(h.AwsEcsLaunchtypeValues={})),function(h){h.AMD64="amd64",h.ARM32="arm32",h.ARM64="arm64",h.IA64="ia64",h.PPC32="ppc32",h.PPC64="ppc64",h.X86="x86"}(h.HostArchValues||(h.HostArchValues={})),function(h){h.WINDOWS="windows",h.LINUX="linux",h.DARWIN="darwin",h.FREEBSD="freebsd",h.NETBSD="netbsd",h.OPENBSD="openbsd",h.DRAGONFLYBSD="dragonflybsd",h.HPUX="hpux",h.AIX="aix",h.SOLARIS="solaris",h.Z_OS="z_os"}(h.OsTypeValues||(h.OsTypeValues={})),function(h){h.CPP="cpp",h.DOTNET="dotnet",h.ERLANG="erlang",h.GO="go",h.JAVA="java",h.NODEJS="nodejs",h.PHP="php",h.PYTHON="python",h.RUBY="ruby",h.WEBJS="webjs"}(h.TelemetrySdkLanguageValues||(h.TelemetrySdkLanguageValues={}))}),at=l(h=>{"use strict";var m=h&&h.__createBinding||(Object.create?function(h,m,y,v){void 0===v&&(v=y),Object.defineProperty(h,v,{enumerable:!0,get:function(){return m[y]}})}:function(h,m,y,v){void 0===v&&(v=y),h[v]=m[y]}),y=h&&h.__exportStar||function(h,y){for(var v in h)"default"!==v&&!Object.prototype.hasOwnProperty.call(y,v)&&m(y,h,v)};Object.defineProperty(h,"__esModule",{value:!0}),y(ot(),h)}),ut=l(h=>{"use strict";var m=h&&h.__createBinding||(Object.create?function(h,m,y,v){void 0===v&&(v=y),Object.defineProperty(h,v,{enumerable:!0,get:function(){return m[y]}})}:function(h,m,y,v){void 0===v&&(v=y),h[v]=m[y]}),y=h&&h.__exportStar||function(h,y){for(var v in h)"default"!==v&&!Object.prototype.hasOwnProperty.call(y,v)&&m(y,h,v)};Object.defineProperty(h,"__esModule",{value:!0}),y(st(),h),y(at(),h)}),dt=l(h=>{"use strict";Object.defineProperty(h,"__esModule",{value:!0}),h.SDK_INFO=void 0;var m=nt(),y=ut();h.SDK_INFO={[y.ResourceAttributes.TELEMETRY_SDK_NAME]:"opentelemetry",[y.ResourceAttributes.PROCESS_RUNTIME_NAME]:"node",[y.ResourceAttributes.TELEMETRY_SDK_LANGUAGE]:y.TelemetrySdkLanguageValues.NODEJS,[y.ResourceAttributes.TELEMETRY_SDK_VERSION]:m.VERSION}}),ht=l(h=>{"use strict";Object.defineProperty(h,"__esModule",{value:!0}),h.unrefTimer=void 0,h.unrefTimer=function oA(h){h.unref()}}),pt=l(h=>{"use strict";var m=h&&h.__createBinding||(Object.create?function(h,m,y,v){void 0===v&&(v=y),Object.defineProperty(h,v,{enumerable:!0,get:function(){return m[y]}})}:function(h,m,y,v){void 0===v&&(v=y),h[v]=m[y]}),y=h&&h.__exportStar||function(h,y){for(var v in h)"default"!==v&&!Object.prototype.hasOwnProperty.call(y,v)&&m(y,h,v)};Object.defineProperty(h,"__esModule",{value:!0}),y(Qe(),h),y(Ze(),h),y(et(),h),y(tt(),h),y(dt(),h),y(ht(),h)}),mt=l(h=>{"use strict";var m=h&&h.__createBinding||(Object.create?function(h,m,y,v){void 0===v&&(v=y),Object.defineProperty(h,v,{enumerable:!0,get:function(){return m[y]}})}:function(h,m,y,v){void 0===v&&(v=y),h[v]=m[y]}),y=h&&h.__exportStar||function(h,y){for(var v in h)"default"!==v&&!Object.prototype.hasOwnProperty.call(y,v)&&m(y,h,v)};Object.defineProperty(h,"__esModule",{value:!0}),y(pt(),h)}),ft=l(h=>{"use strict";Object.defineProperty(h,"__esModule",{value:!0}),h.isTimeInput=h.isTimeInputHrTime=h.hrTimeToMicroseconds=h.hrTimeToMilliseconds=h.hrTimeToNanoseconds=h.hrTimeToTimeStamp=h.hrTimeDuration=h.timeInputToHrTime=h.hrTime=void 0;var m=mt(),y=Math.pow(10,9);function wa(h){let m=h/1e3,v=Math.trunc(m);return[v,Number((m-v).toFixed(9))*y]}function vd(){let h=m.otperformance.timeOrigin;if("number"!=typeof h){let y=m.otperformance;h=y.timing&&y.timing.fetchStart}return h}function md(h){let v=wa(vd()),C=wa("number"==typeof h?h:m.otperformance.now()),T=v[0]+C[0],w=v[1]+C[1];return w>y&&(w-=y,T+=1),[T,w]}function rc(h){return Array.isArray(h)&&2===h.length&&"number"==typeof h[0]&&"number"==typeof h[1]}h.hrTime=md,h.timeInputToHrTime=function pA(h){if(rc(h))return h;if("number"==typeof h)return h<vd()?md(h):wa(h);if(h instanceof Date)return wa(h.getTime());throw TypeError("Invalid input type")},h.hrTimeDuration=function dA(h,m){let v=m[0]-h[0],C=m[1]-h[1];return C<0&&(v-=1,C+=y),[v,C]},h.hrTimeToTimeStamp=function fA(h){let m=`${"0".repeat(9)}${h[1]}Z`,y=m.substr(m.length-9-1);return new Date(1e3*h[0]).toISOString().replace("000Z",y)},h.hrTimeToNanoseconds=function hA(h){return h[0]*y+h[1]},h.hrTimeToMilliseconds=function _A(h){return Math.round(1e3*h[0]+h[1]/1e6)},h.hrTimeToMicroseconds=function gA(h){return Math.round(1e6*h[0]+h[1]/1e3)},h.isTimeInputHrTime=rc,h.isTimeInput=function vA(h){return rc(h)||"number"==typeof h||h instanceof Date}}),yt=l(h=>{"use strict";Object.defineProperty(h,"__esModule",{value:!0})}),vt=l(h=>{"use strict";var m;Object.defineProperty(h,"__esModule",{value:!0}),h.ExportResultCode=void 0,(m=h.ExportResultCode||(h.ExportResultCode={}))[m.SUCCESS=0]="SUCCESS",m[m.FAILED=1]="FAILED"}),St=l(h=>{"use strict";Object.defineProperty(h,"__esModule",{value:!0}),h.CompositePropagator=void 0;var m=Be();h.CompositePropagator=class{constructor(h={}){var m;this._propagators=null!==(m=h.propagators)&&void 0!==m?m:[],this._fields=Array.from(new Set(this._propagators.map(h=>"function"==typeof h.fields?h.fields():[]).reduce((h,m)=>h.concat(m),[])))}inject(h,y,v){for(let C of this._propagators)try{C.inject(h,y,v)}catch(h){m.diag.warn(`Failed to inject with ${C.constructor.name}. Err: ${h.message}`)}}extract(h,y,v){return this._propagators.reduce((h,C)=>{try{return C.extract(h,y,v)}catch(h){m.diag.warn(`Failed to inject with ${C.constructor.name}. Err: ${h.message}`)}return h},h)}fields(){return this._fields.slice()}}}),Et=l(h=>{"use strict";Object.defineProperty(h,"__esModule",{value:!0}),h.validateValue=h.validateKey=void 0;var m="[_0-9a-z-*/]",y=new RegExp(`^(?:${`[a-z]${m}{0,255}`}|${`[a-z0-9]${m}{0,240}@[a-z]${m}{0,13}`})$`),v=/^[ -~]{0,255}[!-~]$/,C=/,|=/;h.validateKey=function bA(h){return y.test(h)},h.validateValue=function IA(h){return v.test(h)&&!C.test(h)}}),Ct=l(h=>{"use strict";Object.defineProperty(h,"__esModule",{value:!0}),h.TraceState=void 0;var m=Et(),y=class{constructor(h){this._internalState=new Map,h&&this._parse(h)}set(h,m){let y=this._clone();return y._internalState.has(h)&&y._internalState.delete(h),y._internalState.set(h,m),y}unset(h){let m=this._clone();return m._internalState.delete(h),m}get(h){return this._internalState.get(h)}serialize(){return this._keys().reduce((h,m)=>(h.push(m+"="+this.get(m)),h),[]).join(",")}_parse(h){h.length>512||(this._internalState=h.split(",").reverse().reduce((h,y)=>{let v=y.trim(),C=v.indexOf("=");if(-1!==C){let T=v.slice(0,C),w=v.slice(C+1,y.length);m.validateKey(T)&&m.validateValue(w)&&h.set(T,w)}return h},new Map),this._internalState.size>32&&(this._internalState=new Map(Array.from(this._internalState.entries()).reverse().slice(0,32))))}_keys(){return Array.from(this._internalState.keys()).reverse()}_clone(){let h=new y;return h._internalState=new Map(this._internalState),h}};h.TraceState=y}),_t=l(h=>{"use strict";Object.defineProperty(h,"__esModule",{value:!0}),h.HttpTraceContextPropagator=h.parseTraceParent=h.TRACE_STATE_HEADER=h.TRACE_PARENT_HEADER=void 0;var m=Be(),y=He(),v=Ct();h.TRACE_PARENT_HEADER="traceparent",h.TRACE_STATE_HEADER="tracestate";var C=new RegExp("^\\s?((?!ff)[\\da-f]{2})-((?![0]{32})[\\da-f]{32})-((?![0]{16})[\\da-f]{16})-([\\da-f]{2})(-.*)?\\s?$");function Dd(h){let m=C.exec(h);return!m||"00"===m[1]&&m[5]?null:{traceId:m[2],spanId:m[3],traceFlags:parseInt(m[4],16)}}h.parseTraceParent=Dd;h.HttpTraceContextPropagator=class{inject(v,C,T){let w=m.trace.getSpanContext(v);if(!w||y.isTracingSuppressed(v)||!m.isSpanContextValid(w))return;let A=`00-${w.traceId}-${w.spanId}-0${Number(w.traceFlags||m.TraceFlags.NONE).toString(16)}`;T.set(C,h.TRACE_PARENT_HEADER,A),w.traceState&&T.set(C,h.TRACE_STATE_HEADER,w.traceState.serialize())}extract(y,C,T){let w=T.get(C,h.TRACE_PARENT_HEADER);if(!w)return y;let A=Array.isArray(w)?w[0]:w;if("string"!=typeof A)return y;let P=Dd(A);if(!P)return y;P.isRemote=!0;let k=T.get(C,h.TRACE_STATE_HEADER);if(k){let h=Array.isArray(k)?k.join(","):k;P.traceState=new v.TraceState("string"==typeof h?h:void 0)}return m.trace.setSpanContext(y,P)}fields(){return[h.TRACE_PARENT_HEADER,h.TRACE_STATE_HEADER]}}}),Tt=l(h=>{"use strict";Object.defineProperty(h,"__esModule",{value:!0})}),bt=l(h=>{"use strict";Object.defineProperty(h,"__esModule",{value:!0}),h.getRPCMetadata=h.deleteRPCMetadata=h.setRPCMetadata=h.RPCType=void 0;var m=Be().createContextKey("OpenTelemetry SDK Context Key RPC_METADATA");(h.RPCType||(h.RPCType={})).HTTP="http",h.setRPCMetadata=function kA(h,y){return h.setValue(m,y)},h.deleteRPCMetadata=function jA(h){return h.deleteValue(m)},h.getRPCMetadata=function HA(h){return h.getValue(m)}}),wt=l(h=>{"use strict";Object.defineProperty(h,"__esModule",{value:!0}),h.AlwaysOffSampler=void 0;var m=Be();h.AlwaysOffSampler=class{shouldSample(){return{decision:m.SamplingDecision.NOT_RECORD}}toString(){return"AlwaysOffSampler"}}}),At=l(h=>{"use strict";Object.defineProperty(h,"__esModule",{value:!0}),h.AlwaysOnSampler=void 0;var m=Be();h.AlwaysOnSampler=class{shouldSample(){return{decision:m.SamplingDecision.RECORD_AND_SAMPLED}}toString(){return"AlwaysOnSampler"}}}),Pt=l(h=>{"use strict";Object.defineProperty(h,"__esModule",{value:!0}),h.ParentBasedSampler=void 0;var m=Be(),y=ze(),v=wt(),C=At();h.ParentBasedSampler=class{constructor(h){var m,T,w,A;this._root=h.root,this._root||(y.globalErrorHandler(new Error("ParentBasedSampler must have a root sampler configured")),this._root=new C.AlwaysOnSampler),this._remoteParentSampled=null!==(m=h.remoteParentSampled)&&void 0!==m?m:new C.AlwaysOnSampler,this._remoteParentNotSampled=null!==(T=h.remoteParentNotSampled)&&void 0!==T?T:new v.AlwaysOffSampler,this._localParentSampled=null!==(w=h.localParentSampled)&&void 0!==w?w:new C.AlwaysOnSampler,this._localParentNotSampled=null!==(A=h.localParentNotSampled)&&void 0!==A?A:new v.AlwaysOffSampler}shouldSample(h,y,v,C,T,w){let A=m.trace.getSpanContext(h);return A&&m.isSpanContextValid(A)?A.isRemote?A.traceFlags&m.TraceFlags.SAMPLED?this._remoteParentSampled.shouldSample(h,y,v,C,T,w):this._remoteParentNotSampled.shouldSample(h,y,v,C,T,w):A.traceFlags&m.TraceFlags.SAMPLED?this._localParentSampled.shouldSample(h,y,v,C,T,w):this._localParentNotSampled.shouldSample(h,y,v,C,T,w):this._root.shouldSample(h,y,v,C,T,w)}toString(){return`ParentBased{root=${this._root.toString()}, remoteParentSampled=${this._remoteParentSampled.toString()}, remoteParentNotSampled=${this._remoteParentNotSampled.toString()}, localParentSampled=${this._localParentSampled.toString()}, localParentNotSampled=${this._localParentNotSampled.toString()}}`}}}),kt=l(h=>{"use strict";Object.defineProperty(h,"__esModule",{value:!0}),h.TraceIdRatioBasedSampler=void 0;var m=Be();h.TraceIdRatioBasedSampler=class{constructor(h=0){this._ratio=h,this._ratio=this._normalize(h),this._upperBound=Math.floor(4294967295*this._ratio)}shouldSample(h,y){return{decision:m.isValidTraceId(y)&&this._accumulate(y)<this._upperBound?m.SamplingDecision.RECORD_AND_SAMPLED:m.SamplingDecision.NOT_RECORD}}toString(){return`TraceIdRatioBased{${this._ratio}}`}_normalize(h){return"number"!=typeof h||isNaN(h)?0:h>=1?1:h<=0?0:h}_accumulate(h){let m=0;for(let y=0;y<h.length/8;y++){let v=8*y;m=(m^parseInt(h.slice(v,v+8),16))>>>0}return m}}}),Rt=l(h=>{"use strict";function Vd(h,m){return"string"==typeof m?h===m:m.test(h)}Object.defineProperty(h,"__esModule",{value:!0}),h.isUrlIgnored=h.urlMatches=void 0,h.urlMatches=Vd,h.isUrlIgnored=function FA(h,m){if(!m)return!1;for(let y of m)if(Vd(h,y))return!0;return!1}}),Mt=l(h=>{"use strict";Object.defineProperty(h,"__esModule",{value:!0}),h.isWrapped=void 0,h.isWrapped=function VA(h){return"function"==typeof h&&"function"==typeof h.__original&&"function"==typeof h.__unwrap&&!0===h.__wrapped}}),Nt=l(h=>{"use strict";var m=h&&h.__createBinding||(Object.create?function(h,m,y,v){void 0===v&&(v=y),Object.defineProperty(h,v,{enumerable:!0,get:function(){return m[y]}})}:function(h,m,y,v){void 0===v&&(v=y),h[v]=m[y]}),y=h&&h.__exportStar||function(h,y){for(var v in h)"default"!==v&&!Object.prototype.hasOwnProperty.call(y,v)&&m(y,h,v)};Object.defineProperty(h,"__esModule",{value:!0}),h.baggageUtils=void 0,y(Ve(),h),y($e(),h),y(ze(),h),y(Ke(),h),y(ft(),h),y(yt(),h),y(vt(),h),y(nt(),h),h.baggageUtils=Ye(),y(mt(),h),y(St(),h),y(_t(),h),y(Tt(),h),y(bt(),h),y(wt(),h),y(At(),h),y(Pt(),h),y(kt(),h),y(He(),h),y(Ct(),h),y(Xe(),h),y(Ge(),h),y(Rt(),h),y(Mt(),h),y(nt(),h)}),Dt=l(h=>{"use strict";Object.defineProperty(h,"__esModule",{value:!0}),h.ExceptionEventName=void 0,h.ExceptionEventName="exception"}),It=l(h=>{"use strict";Object.defineProperty(h,"__esModule",{value:!0}),h.Span=void 0;var m=Be(),y=Nt(),v=ut(),C=Dt();h.Span=class{constructor(h,v,C,T,w,A,P=[],k=y.hrTime()){this.attributes={},this.links=[],this.events=[],this.status={code:m.SpanStatusCode.UNSET},this.endTime=[0,0],this._ended=!1,this._duration=[-1,-1],this.name=C,this._spanContext=T,this.parentSpanId=A,this.kind=w,this.links=P,this.startTime=y.timeInputToHrTime(k),this.resource=h.resource,this.instrumentationLibrary=h.instrumentationLibrary,this._spanLimits=h.getSpanLimits(),this._spanProcessor=h.getActiveSpanProcessor(),this._spanProcessor.onStart(this,v)}spanContext(){return this._spanContext}setAttribute(h,v){return null==v||this._isSpanEnded()?this:0===h.length?(m.diag.warn(`Invalid attribute key: ${h}`),this):y.isAttributeValue(v)?(Object.keys(this.attributes).length>=this._spanLimits.attributeCountLimit&&!Object.prototype.hasOwnProperty.call(this.attributes,h)||(this.attributes[h]=v),this):(m.diag.warn(`Invalid attribute value set for key: ${h}`),this)}setAttributes(h){for(let[m,y]of Object.entries(h))this.setAttribute(m,y);return this}addEvent(h,v,C){return this._isSpanEnded()||(this.events.length>=this._spanLimits.eventCountLimit&&(m.diag.warn("Dropping extra events."),this.events.shift()),y.isTimeInput(v)&&(void 0===C&&(C=v),v=void 0),void 0===C&&(C=y.hrTime()),this.events.push({name:h,attributes:v,time:y.timeInputToHrTime(C)})),this}setStatus(h){return this._isSpanEnded()||(this.status=h),this}updateName(h){return this._isSpanEnded()||(this.name=h),this}end(h=y.hrTime()){this._isSpanEnded()?m.diag.error("You can only call end() on a span once."):(this._ended=!0,this.endTime=y.timeInputToHrTime(h),this._duration=y.hrTimeDuration(this.startTime,this.endTime),this._duration[0]<0&&m.diag.warn("Inconsistent start and end time, startTime > endTime",this.startTime,this.endTime),this._spanProcessor.onEnd(this))}isRecording(){return!1===this._ended}recordException(h,T=y.hrTime()){let w={};"string"==typeof h?w[v.SemanticAttributes.EXCEPTION_MESSAGE]=h:h&&(h.code?w[v.SemanticAttributes.EXCEPTION_TYPE]=h.code.toString():h.name&&(w[v.SemanticAttributes.EXCEPTION_TYPE]=h.name),h.message&&(w[v.SemanticAttributes.EXCEPTION_MESSAGE]=h.message),h.stack&&(w[v.SemanticAttributes.EXCEPTION_STACKTRACE]=h.stack)),w[v.SemanticAttributes.EXCEPTION_TYPE]||w[v.SemanticAttributes.EXCEPTION_MESSAGE]?this.addEvent(C.ExceptionEventName,w,T):m.diag.warn(`Failed to record an exception ${h}`)}get duration(){return this._duration}get ended(){return this._ended}_isSpanEnded(){return this._ended&&m.diag.warn("Can not execute the operation on ended Span {traceId: %s, spanId: %s}",this._spanContext.traceId,this._spanContext.spanId),this._ended}}}),xt=l(h=>{"use strict";Object.defineProperty(h,"__esModule",{value:!0}),h.buildSamplerFromEnv=h.DEFAULT_CONFIG=void 0;var m=Be(),y=Nt(),v=y.getEnv(),C=y.TracesSamplerValues.AlwaysOn;function Xd(h=y.getEnv()){switch(h.OTEL_TRACES_SAMPLER){case y.TracesSamplerValues.AlwaysOn:return new y.AlwaysOnSampler;case y.TracesSamplerValues.AlwaysOff:return new y.AlwaysOffSampler;case y.TracesSamplerValues.ParentBasedAlwaysOn:return new y.ParentBasedSampler({root:new y.AlwaysOnSampler});case y.TracesSamplerValues.ParentBasedAlwaysOff:return new y.ParentBasedSampler({root:new y.AlwaysOffSampler});case y.TracesSamplerValues.TraceIdRatio:return new y.TraceIdRatioBasedSampler(Qd(h));case y.TracesSamplerValues.ParentBasedTraceIdRatio:return new y.ParentBasedSampler({root:new y.TraceIdRatioBasedSampler(Qd(h))});default:return m.diag.error(`OTEL_TRACES_SAMPLER value "${h.OTEL_TRACES_SAMPLER} invalid, defaulting to ${C}".`),new y.AlwaysOnSampler}}h.DEFAULT_CONFIG={sampler:Xd(v),forceFlushTimeoutMillis:3e4,spanLimits:{attributeCountLimit:y.getEnv().OTEL_SPAN_ATTRIBUTE_COUNT_LIMIT,linkCountLimit:y.getEnv().OTEL_SPAN_LINK_COUNT_LIMIT,eventCountLimit:y.getEnv().OTEL_SPAN_EVENT_COUNT_LIMIT}},h.buildSamplerFromEnv=Xd;function Qd(h){if(void 0===h.OTEL_TRACES_SAMPLER_ARG||""===h.OTEL_TRACES_SAMPLER_ARG)return m.diag.error("OTEL_TRACES_SAMPLER_ARG is blank, defaulting to 1."),1;let y=Number(h.OTEL_TRACES_SAMPLER_ARG);return isNaN(y)?(m.diag.error(`OTEL_TRACES_SAMPLER_ARG=${h.OTEL_TRACES_SAMPLER_ARG} was given, but it is invalid, defaulting to 1.`),1):y<0||y>1?(m.diag.error(`OTEL_TRACES_SAMPLER_ARG=${h.OTEL_TRACES_SAMPLER_ARG} was given, but it is out of range ([0..1]), defaulting to 1.`),1):y}}),Ot=l(h=>{"use strict";Object.defineProperty(h,"__esModule",{value:!0}),h.mergeConfig=void 0;var m=xt();h.mergeConfig=function XA(h){let y={sampler:m.buildSamplerFromEnv()},v=Object.assign({},m.DEFAULT_CONFIG,y,h);return v.spanLimits=Object.assign({},m.DEFAULT_CONFIG.spanLimits,h.spanLimits||{}),v}}),Lt=l(h=>{"use strict";Object.defineProperty(h,"__esModule",{value:!0}),h.Tracer=void 0;var m=Be(),y=Nt(),v=It(),C=Ot();h.Tracer=class{constructor(h,m,v){this._tracerProvider=v;let T=C.mergeConfig(m);this._sampler=T.sampler,this._spanLimits=T.spanLimits,this._idGenerator=m.idGenerator||new y.RandomIdGenerator,this.resource=v.resource,this.instrumentationLibrary=h}startSpan(h,C={},T=m.context.active()){var w,A;if(y.isTracingSuppressed(T))return m.diag.debug("Instrumentation suppressed, returning Noop Span"),m.trace.wrapSpanContext(m.INVALID_SPAN_CONTEXT);let P,k,R,M=function ZA(h,y){if(!h.root)return m.trace.getSpanContext(y)}(C,T),N=this._idGenerator.generateSpanId();M&&m.trace.isSpanContextValid(M)?(P=M.traceId,k=M.traceState,R=M.spanId):P=this._idGenerator.generateTraceId();let D=null!==(w=C.kind)&&void 0!==w?w:m.SpanKind.INTERNAL,I=null!==(A=C.links)&&void 0!==A?A:[],x=y.sanitizeAttributes(C.attributes),O=this._sampler.shouldSample(C.root?m.trace.setSpanContext(T,m.INVALID_SPAN_CONTEXT):T,P,h,D,x,I),L={traceId:P,spanId:N,traceFlags:O.decision===m.SamplingDecision.RECORD_AND_SAMPLED?m.TraceFlags.SAMPLED:m.TraceFlags.NONE,traceState:k};if(O.decision===m.SamplingDecision.NOT_RECORD)return m.diag.debug("Recording is off, propagating context in a non-recording span"),m.trace.wrapSpanContext(L);let U=new v.Span(this,T,h,L,D,R,I,C.startTime);return U.setAttributes(Object.assign(x,O.attributes)),U}startActiveSpan(h,y,v,C){let T,w,A;if(arguments.length<2)return;2===arguments.length?A=y:3===arguments.length?(T=y,A=v):(T=y,w=v,A=C);let P=null!=w?w:m.context.active(),k=this.startSpan(h,T,P),R=m.trace.setSpan(P,k);return m.context.with(R,A,void 0,k)}getSpanLimits(){return this._spanLimits}getActiveSpanProcessor(){return this._tracerProvider.getActiveSpanProcessor()}}}),Ft=l(h=>{"use strict";Object.defineProperty(h,"__esModule",{value:!0}),h.defaultServiceName=void 0,h.defaultServiceName=function JA(){return`unknown_service:${process.argv0}`}}),Ut=l(h=>{"use strict";Object.defineProperty(h,"__esModule",{value:!0}),h.detectResources=void 0;var m=Yt(),v=Be(),C=y(10);h.detectResources=async(h={})=>{let y=Object.assign(h),C=await Promise.all((y.detectors||[]).map(async h=>{try{let m=await h.detect(y);return v.diag.debug(`${h.constructor.name} found resource.`,m),m}catch(y){return v.diag.debug(`${h.constructor.name} failed: ${y.message}`),m.Resource.empty()}}));return rb(C),C.reduce((h,m)=>h.merge(m),m.Resource.empty())};var rb=h=>{h.forEach(h=>{if(Object.keys(h.attributes).length>0){let m=C.inspect(h.attributes,{depth:2,breakLength:1/0,sorted:!0,compact:!1});v.diag.verbose(m)}})}}),jt=l(h=>{"use strict";Object.defineProperty(h,"__esModule",{value:!0}),h.envDetector=void 0;var m=Be(),y=Nt(),v=ut(),C=zt();h.envDetector=new class{constructor(){this._MAX_LENGTH=255,this._COMMA_SEPARATOR=",",this._LABEL_KEY_VALUE_SPLITTER="=",this._ERROR_MESSAGE_INVALID_CHARS="should be a ASCII string with a length greater than 0 and not exceed "+this._MAX_LENGTH+" characters.",this._ERROR_MESSAGE_INVALID_VALUE="should be a ASCII string with a length not exceed "+this._MAX_LENGTH+" characters."}async detect(h){let T={},w=y.getEnv(),A=w.OTEL_RESOURCE_ATTRIBUTES,P=w.OTEL_SERVICE_NAME;if(A)try{let h=this._parseResourceAttributes(A);Object.assign(T,h)}catch(h){m.diag.debug(`EnvDetector failed: ${h.message}`)}return P&&(T[v.ResourceAttributes.SERVICE_NAME]=P),new C.Resource(T)}_parseResourceAttributes(h){if(!h)return{};let m={},y=h.split(this._COMMA_SEPARATOR,-1);for(let h of y){let y=h.split(this._LABEL_KEY_VALUE_SPLITTER,-1);if(2!==y.length)continue;let[v,C]=y;if(v=v.trim(),C=C.trim().split('^"|"$').join(""),!this._isValidAndNotEmpty(v))throw new Error(`Attribute key ${this._ERROR_MESSAGE_INVALID_CHARS}`);if(!this._isValid(C))throw new Error(`Attribute value ${this._ERROR_MESSAGE_INVALID_VALUE}`);m[v]=C}return m}_isValid(h){return h.length<=this._MAX_LENGTH&&this._isPrintableString(h)}_isPrintableString(h){for(let m=0;m<h.length;m++){let y=h.charAt(m);if(y<=" "||y>="~")return!1}return!0}_isValidAndNotEmpty(h){return h.length>0&&this._isValid(h)}}}),Bt=l(h=>{"use strict";Object.defineProperty(h,"__esModule",{value:!0}),h.processDetector=void 0;var m=Be(),y=ut(),v=zt();h.processDetector=new class{async detect(h){let m={[y.ResourceAttributes.PROCESS_PID]:process.pid,[y.ResourceAttributes.PROCESS_EXECUTABLE_NAME]:process.title||"",[y.ResourceAttributes.PROCESS_COMMAND]:process.argv[1]||"",[y.ResourceAttributes.PROCESS_COMMAND_LINE]:process.argv.join(" ")||""};return this._getResourceAttributes(m,h)}_getResourceAttributes(h,C){return""===h[y.ResourceAttributes.PROCESS_EXECUTABLE_NAME]||""===h[y.ResourceAttributes.PROCESS_EXECUTABLE_PATH]||""===h[y.ResourceAttributes.PROCESS_COMMAND]||""===h[y.ResourceAttributes.PROCESS_COMMAND_LINE]?(m.diag.debug("ProcessDetector failed: Unable to find required process resources. "),v.Resource.empty()):new v.Resource(Object.assign({},h))}}}),Ht=l(h=>{"use strict";var m=h&&h.__createBinding||(Object.create?function(h,m,y,v){void 0===v&&(v=y),Object.defineProperty(h,v,{enumerable:!0,get:function(){return m[y]}})}:function(h,m,y,v){void 0===v&&(v=y),h[v]=m[y]}),y=h&&h.__exportStar||function(h,y){for(var v in h)"default"!==v&&!Object.prototype.hasOwnProperty.call(y,v)&&m(y,h,v)};Object.defineProperty(h,"__esModule",{value:!0}),y(jt(),h),y(Bt(),h)}),Wt=l(h=>{"use strict";var m=h&&h.__createBinding||(Object.create?function(h,m,y,v){void 0===v&&(v=y),Object.defineProperty(h,v,{enumerable:!0,get:function(){return m[y]}})}:function(h,m,y,v){void 0===v&&(v=y),h[v]=m[y]}),y=h&&h.__exportStar||function(h,y){for(var v in h)"default"!==v&&!Object.prototype.hasOwnProperty.call(y,v)&&m(y,h,v)};Object.defineProperty(h,"__esModule",{value:!0}),y(Ft(),h),y(Ut(),h),y(Ht(),h)}),qt=l(h=>{"use strict";var m=h&&h.__createBinding||(Object.create?function(h,m,y,v){void 0===v&&(v=y),Object.defineProperty(h,v,{enumerable:!0,get:function(){return m[y]}})}:function(h,m,y,v){void 0===v&&(v=y),h[v]=m[y]}),y=h&&h.__exportStar||function(h,y){for(var v in h)"default"!==v&&!Object.prototype.hasOwnProperty.call(y,v)&&m(y,h,v)};Object.defineProperty(h,"__esModule",{value:!0}),y(Wt(),h)}),Yt=l(h=>{"use strict";Object.defineProperty(h,"__esModule",{value:!0}),h.Resource=void 0;var m=ut(),y=Nt(),v=qt(),C=class{constructor(h){this.attributes=h}static empty(){return C.EMPTY}static default(){return new C({[m.ResourceAttributes.SERVICE_NAME]:v.defaultServiceName(),[m.ResourceAttributes.TELEMETRY_SDK_LANGUAGE]:y.SDK_INFO[m.ResourceAttributes.TELEMETRY_SDK_LANGUAGE],[m.ResourceAttributes.TELEMETRY_SDK_NAME]:y.SDK_INFO[m.ResourceAttributes.TELEMETRY_SDK_NAME],[m.ResourceAttributes.TELEMETRY_SDK_VERSION]:y.SDK_INFO[m.ResourceAttributes.TELEMETRY_SDK_VERSION]})}merge(h){if(!h||!Object.keys(h.attributes).length)return this;let m=Object.assign({},this.attributes,h.attributes);return new C(m)}};h.Resource=C,C.EMPTY=new C({})}),$t=l(h=>{"use strict";Object.defineProperty(h,"__esModule",{value:!0})}),Kt=l(h=>{"use strict";Object.defineProperty(h,"__esModule",{value:!0})}),zt=l(h=>{"use strict";var m=h&&h.__createBinding||(Object.create?function(h,m,y,v){void 0===v&&(v=y),Object.defineProperty(h,v,{enumerable:!0,get:function(){return m[y]}})}:function(h,m,y,v){void 0===v&&(v=y),h[v]=m[y]}),y=h&&h.__exportStar||function(h,y){for(var v in h)"default"!==v&&!Object.prototype.hasOwnProperty.call(y,v)&&m(y,h,v)};Object.defineProperty(h,"__esModule",{value:!0}),y(Yt(),h),y(qt(),h),y($t(),h),y(Kt(),h)}),Gt=l(h=>{"use strict";Object.defineProperty(h,"__esModule",{value:!0}),h.MultiSpanProcessor=void 0;var m=Nt();h.MultiSpanProcessor=class{constructor(h){this._spanProcessors=h}forceFlush(){let h=[];for(let m of this._spanProcessors)h.push(m.forceFlush());return new Promise(y=>{Promise.all(h).then(()=>{y()}).catch(h=>{m.globalErrorHandler(h||new Error("MultiSpanProcessor: forceFlush failed")),y()})})}onStart(h,m){for(let y of this._spanProcessors)y.onStart(h,m)}onEnd(h){for(let m of this._spanProcessors)m.onEnd(h)}shutdown(){let h=[];for(let m of this._spanProcessors)h.push(m.shutdown());return new Promise((m,y)=>{Promise.all(h).then(()=>{m()},y)})}}}),Jt=l(h=>{"use strict";Object.defineProperty(h,"__esModule",{value:!0}),h.NoopSpanProcessor=void 0;h.NoopSpanProcessor=class{onStart(h,m){}onEnd(h){}shutdown(){return Promise.resolve()}forceFlush(){return Promise.resolve()}}}),Qt=l((h,m)=>{var y="__lodash_hash_undefined__",v=9007199254740991,C="[object Arguments]",T="[object Function]",w="[object Object]",A=/^\[object .+?Constructor\]$/,P=/^(?:0|[1-9]\d*)$/,k={};k["[object Float32Array]"]=k["[object Float64Array]"]=k["[object Int8Array]"]=k["[object Int16Array]"]=k["[object Int32Array]"]=k["[object Uint8Array]"]=k["[object Uint8ClampedArray]"]=k["[object Uint16Array]"]=k["[object Uint32Array]"]=!0,k[C]=k["[object Array]"]=k["[object ArrayBuffer]"]=k["[object Boolean]"]=k["[object DataView]"]=k["[object Date]"]=k["[object Error]"]=k[T]=k["[object Map]"]=k["[object Number]"]=k[w]=k["[object RegExp]"]=k["[object Set]"]=k["[object String]"]=k["[object WeakMap]"]=!1;var R="object"==typeof global&&global&&global.Object===Object&&global,M="object"==typeof self&&self&&self.Object===Object&&self,N=R||M||Function("return this")(),D="object"==typeof h&&h&&!h.nodeType&&h,I=D&&"object"==typeof m&&m&&!m.nodeType&&m,x=I&&I.exports===D,O=x&&R.process,L=function(){try{return I&&I.require&&I.require("util").types||O&&O.binding&&O.binding("util")}catch(h){}}(),U=L&&L.isTypedArray;function Yb(h,m,y){switch(y.length){case 0:return h.call(m);case 1:return h.call(m,y[0]);case 2:return h.call(m,y[0],y[1]);case 3:return h.call(m,y[0],y[1],y[2])}return h.apply(m,y)}var B,W=Array.prototype,q=Function.prototype,Y=Object.prototype,V=N["__core-js_shared__"],$=q.toString,z=Y.hasOwnProperty,G=(B=/[^.]+$/.exec(V&&V.keys&&V.keys.IE_PROTO||""))?"Symbol(src)_1."+B:"",J=Y.toString,X=$.call(Object),Z=RegExp("^"+$.call(z).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),ee=x?N.Buffer:void 0,te=N.Symbol,re=N.Uint8Array,ie=ee?ee.allocUnsafe:void 0,se=function Zb(h,m){return function(y){return h(m(y))}}(Object.getPrototypeOf,Object),oe=Object.create,ae=Y.propertyIsEnumerable,ce=W.splice,le=te?te.toStringTag:void 0,ue=function(){try{var h=bc(Object,"defineProperty");return h({},"",{}),h}catch(h){}}(),de=ee?ee.isBuffer:void 0,he=Math.max,pe=Date.now,me=bc(N,"Map"),fe=bc(Object,"create"),ye=function(){function e(){}return function(h){if(!or(h))return{};if(oe)return oe(h);e.prototype=h;var m=new e;return e.prototype=void 0,m}}();function sr(h){var m=-1,y=null==h?0:h.length;for(this.clear();++m<y;){var v=h[m];this.set(v[0],v[1])}}function ct(h){var m=-1,y=null==h?0:h.length;for(this.clear();++m<y;){var v=h[m];this.set(v[0],v[1])}}function tn(h){var m=-1,y=null==h?0:h.length;for(this.clear();++m<y;){var v=h[m];this.set(v[0],v[1])}}function rn(h){var m=this.__data__=new ct(h);this.size=m.size}function OI(h,m){var y=Ce(h),v=!y&&Ee(h),C=!y&&!v&&_e(h),T=!y&&!v&&!C&&Te(h),w=y||v||C||T,A=w?function Xb(h,m){for(var y=-1,v=Array(h);++y<h;)v[y]=m(y);return v}(h.length,String):[],P=A.length;for(var k in h)(m||z.call(h,k))&&(!w||!("length"==k||C&&("offset"==k||"parent"==k)||T&&("buffer"==k||"byteLength"==k||"byteOffset"==k)||Uf(k,P)))&&A.push(k);return A}function Sc(h,m,y){(void 0!==y&&!ls(h[m],y)||void 0===y&&!(m in h))&&Ac(h,m,y)}function RI(h,m,y){var v=h[m];(!z.call(h,m)||!ls(v,y)||void 0===y&&!(m in h))&&Ac(h,m,y)}function os(h,m){for(var y=h.length;y--;)if(ls(h[y][0],m))return y;return-1}function Ac(h,m,y){"__proto__"==m&&ue?ue(h,m,{configurable:!0,enumerable:!0,value:y,writable:!0}):h[m]=y}sr.prototype.clear=function cI(){this.__data__=fe?fe(null):{},this.size=0},sr.prototype.delete=function uI(h){var m=this.has(h)&&delete this.__data__[h];return this.size-=m?1:0,m},sr.prototype.get=function lI(h){var m=this.__data__;if(fe){var v=m[h];return v===y?void 0:v}return z.call(m,h)?m[h]:void 0},sr.prototype.has=function pI(h){var m=this.__data__;return fe?void 0!==m[h]:z.call(m,h)},sr.prototype.set=function dI(h,m){var v=this.__data__;return this.size+=this.has(h)?0:1,v[h]=fe&&void 0===m?y:m,this},ct.prototype.clear=function fI(){this.__data__=[],this.size=0},ct.prototype.delete=function hI(h){var m=this.__data__,y=os(m,h);return!(y<0)&&(y==m.length-1?m.pop():ce.call(m,y,1),--this.size,!0)},ct.prototype.get=function _I(h){var m=this.__data__,y=os(m,h);return y<0?void 0:m[y][1]},ct.prototype.has=function gI(h){return os(this.__data__,h)>-1},ct.prototype.set=function vI(h,m){var y=this.__data__,v=os(y,h);return v<0?(++this.size,y.push([h,m])):y[v][1]=m,this},tn.prototype.clear=function mI(){this.size=0,this.__data__={hash:new sr,map:new(me||ct),string:new sr}},tn.prototype.delete=function EI(h){var m=us(this,h).delete(h);return this.size-=m?1:0,m},tn.prototype.get=function yI(h){return us(this,h).get(h)},tn.prototype.has=function TI(h){return us(this,h).has(h)},tn.prototype.set=function SI(h,m){var y=us(this,h),v=y.size;return y.set(h,m),this.size+=y.size==v?0:1,this},rn.prototype.clear=function AI(){this.__data__=new ct,this.size=0},rn.prototype.delete=function bI(h){var m=this.__data__,y=m.delete(h);return this.size=m.size,y},rn.prototype.get=function II(h){return this.__data__.get(h)},rn.prototype.has=function CI(h){return this.__data__.has(h)},rn.prototype.set=function PI(h,m){var y=this.__data__;if(y instanceof ct){var v=y.__data__;if(!me||v.length<199)return v.push([h,m]),this.size=++y.size,this;y=this.__data__=new tn(v)}return y.set(h,m),this.size=y.size,this};var ve=function FI(h){return function(m,y,v){for(var C=-1,T=Object(m),w=v(m),A=w.length;A--;){var P=w[h?A:++C];if(!1===y(T[P],P,T))break}return m}}();function cs(h){return null==h?void 0===h?"[object Undefined]":"[object Null]":le&&le in Object(h)?function VI(h){var m=z.call(h,le),y=h[le];try{h[le]=void 0;var v=!0}catch(h){}var C=J.call(h);return v&&(m?h[le]=y:delete h[le]),C}(h):function QI(h){return J.call(h)}(h)}function jf(h){return oi(h)&&cs(h)==C}function DI(h){return!(!or(h)||function YI(h){return!!G&&G in h}(h))&&(Rc(h)?Z:A).test(function eC(h){if(null!=h){try{return $.call(h)}catch(h){}try{return h+""}catch(h){}}return""}(h))}function MI(h){if(!or(h))return function XI(h){var m=[];if(null!=h)for(var y in Object(h))m.push(y);return m}(h);var m=Bf(h),y=[];for(var v in h)"constructor"==v&&(m||!z.call(h,v))||y.push(v);return y}function Hf(h,m,y,v,C){h!==m&&ve(m,(function(T,A){if(C||(C=new rn),or(T))!function xI(h,m,y,v,C,T,A){var P=Ic(h,y),k=Ic(m,y),R=A.get(k);if(R)return void Sc(h,y,R);var M=T?T(P,k,y+"",h,m,A):void 0,N=void 0===M;if(N){var D=Ce(k),I=!D&&_e(k),x=!D&&!I&&Te(k);M=k,D||I||x?Ce(P)?M=P:function tC(h){return oi(h)&&Oc(h)}(P)?M=function UI(h,m){var y=-1,v=h.length;for(m||(m=Array(v));++y<v;)m[y]=h[y];return m}(P):I?(N=!1,M=function kI(h,m){if(m)return h.slice();var y=h.length,v=ie?ie(y):new h.constructor(y);return h.copy(v),v}(k,!0)):x?(N=!1,M=function HI(h,m){var y=m?function jI(h){var m=new h.constructor(h.byteLength);return new re(m).set(new re(h)),m}(h.buffer):h.buffer;return new h.constructor(y,h.byteOffset,h.length)}(k,!0)):M=[]:function rC(h){if(!oi(h)||cs(h)!=w)return!1;var m=se(h);if(null===m)return!0;var y=z.call(m,"constructor")&&m.constructor;return"function"==typeof y&&y instanceof y&&$.call(y)==X}(k)||Ee(k)?(M=P,Ee(P)?M=function nC(h){return function BI(h,m,y,v){var C=!y;y||(y={});for(var T=-1,w=m.length;++T<w;){var A=m[T],P=v?v(y[A],h[A],A,y,h):void 0;void 0===P&&(P=h[A]),C?Ac(y,A,P):RI(y,A,P)}return y}(h,$f(h))}(P):(!or(P)||Rc(P))&&(M=function $I(h){return"function"!=typeof h.constructor||Bf(h)?{}:ye(se(h))}(k))):N=!1}N&&(A.set(k,M),C(M,k,v,T,A),A.delete(k)),Sc(h,y,M)}(h,m,A,y,Hf,v,C);else{var P=v?v(Ic(h,A),T,A+"",h,m,C):void 0;void 0===P&&(P=T),Sc(h,A,P)}}),$f)}function LI(h,m){return Se(function WI(h,m,y){return m=he(void 0===m?h.length-1:m,0),function(){for(var v=arguments,C=-1,T=he(v.length-m,0),w=Array(T);++C<T;)w[C]=v[m+C];C=-1;for(var A=Array(m+1);++C<m;)A[C]=v[C];return A[m]=y(w),Yb(h,this,A)}}(h,m,zf),h+"")}function us(h,m){var y=h.__data__;return function KI(h){var m=typeof h;return"string"==m||"number"==m||"symbol"==m||"boolean"==m?"__proto__"!==h:null===h}(m)?y["string"==typeof m?"string":"hash"]:y.map}function bc(h,m){var y=function Wb(h,m){return null==h?void 0:h[m]}(h,m);return DI(y)?y:void 0}function Uf(h,m){var y=typeof h;return!!(m=null==m?v:m)&&("number"==y||"symbol"!=y&&P.test(h))&&h>-1&&h%1==0&&h<m}function Bf(h){var m=h&&h.constructor;return h===("function"==typeof m&&m.prototype||Y)}function Ic(h,m){if(("constructor"!==m||"function"!=typeof h[m])&&"__proto__"!=m)return h[m]}var Se=function JI(h){var m=0,y=0;return function(){var v=pe(),C=16-(v-y);if(y=v,C>0){if(++m>=800)return arguments[0]}else m=0;return h.apply(void 0,arguments)}}(ue?function(h,m){return ue(h,"toString",{configurable:!0,enumerable:!1,value:aC(m),writable:!0})}:zf);function ls(h,m){return h===m||h!=h&&m!=m}var Ee=jf(function(){return arguments}())?jf:function(h){return oi(h)&&z.call(h,"callee")&&!ae.call(h,"callee")},Ce=Array.isArray;function Oc(h){return null!=h&&Ff(h.length)&&!Rc(h)}var _e=de||function sC(){return!1};function Rc(h){if(!or(h))return!1;var m=cs(h);return m==T||"[object GeneratorFunction]"==m||"[object AsyncFunction]"==m||"[object Proxy]"==m}function Ff(h){return"number"==typeof h&&h>-1&&h%1==0&&h<=v}function or(h){var m=typeof h;return null!=h&&("object"==m||"function"==m)}function oi(h){return null!=h&&"object"==typeof h}var Te=U?function Qb(h){return function(m){return h(m)}}(U):function wI(h){return oi(h)&&Ff(h.length)&&!!k[cs(h)]};function $f(h){return Oc(h)?OI(h,!0):MI(h)}var be=function GI(h){return LI((function(m,y){var v=-1,C=y.length,T=C>1?y[C-1]:void 0,w=C>2?y[2]:void 0;for(T=h.length>3&&"function"==typeof T?(C--,T):void 0,w&&function zI(h,m,y){if(!or(y))return!1;var v=typeof m;return!!("number"==v?Oc(y)&&Uf(m,y.length):"string"==v&&m in y)&&ls(y[m],h)}(y[0],y[1],w)&&(T=C<3?void 0:T,C=1),m=Object(m);++v<C;){var A=y[v];A&&h(m,A,v,T)}return m}))}((function(h,m,y){Hf(h,m,y)}));function aC(h){return function(){return h}}function zf(h){return h}m.exports=be}),Zt=l(h=>{"use strict";Object.defineProperty(h,"__esModule",{value:!0}),h.BatchSpanProcessorBase=void 0;var m=Be(),y=Nt();h.BatchSpanProcessorBase=class{constructor(h,m){this._exporter=h,this._finishedSpans=[],this._isShutdown=!1,this._shuttingDownPromise=Promise.resolve();let v=y.getEnv();this._maxExportBatchSize="number"==typeof(null==m?void 0:m.maxExportBatchSize)?m.maxExportBatchSize:v.OTEL_BSP_MAX_EXPORT_BATCH_SIZE,this._maxQueueSize="number"==typeof(null==m?void 0:m.maxQueueSize)?m.maxQueueSize:v.OTEL_BSP_MAX_QUEUE_SIZE,this._scheduledDelayMillis="number"==typeof(null==m?void 0:m.scheduledDelayMillis)?m.scheduledDelayMillis:v.OTEL_BSP_SCHEDULE_DELAY,this._exportTimeoutMillis="number"==typeof(null==m?void 0:m.exportTimeoutMillis)?m.exportTimeoutMillis:v.OTEL_BSP_EXPORT_TIMEOUT}forceFlush(){return this._isShutdown?this._shuttingDownPromise:this._flushAll()}onStart(h){}onEnd(h){this._isShutdown||this._addToBuffer(h)}shutdown(){return this._isShutdown||(this._isShutdown=!0,this._shuttingDownPromise=new Promise((h,m)=>{Promise.resolve().then(()=>this.onShutdown()).then(()=>this._flushAll()).then(()=>this._exporter.shutdown()).then(h).catch(h=>{m(h)})})),this._shuttingDownPromise}_addToBuffer(h){this._finishedSpans.length>=this._maxQueueSize||(this._finishedSpans.push(h),this._maybeStartTimer())}_flushAll(){return new Promise((h,m)=>{let y=[];for(let h=0,m=Math.ceil(this._finishedSpans.length/this._maxExportBatchSize);h<m;h++)y.push(this._flushOneBatch());Promise.all(y).then(()=>{h()}).catch(m)})}_flushOneBatch(){return this._clearTimer(),0===this._finishedSpans.length?Promise.resolve():new Promise((h,v)=>{let C=setTimeout(()=>{v(new Error("Timeout"))},this._exportTimeoutMillis);m.context.with(y.suppressTracing(m.context.active()),()=>{this._exporter.export(this._finishedSpans.splice(0,this._maxExportBatchSize),m=>{var T;clearTimeout(C),m.code===y.ExportResultCode.SUCCESS?h():v(null!==(T=m.error)&&void 0!==T?T:new Error("BatchSpanProcessor: span export failed"))})})})}_maybeStartTimer(){void 0===this._timer&&(this._timer=setTimeout(()=>{this._flushOneBatch().then(()=>{this._finishedSpans.length>0&&(this._clearTimer(),this._maybeStartTimer())}).catch(h=>{y.globalErrorHandler(h)})},this._scheduledDelayMillis),y.unrefTimer(this._timer))}_clearTimer(){void 0!==this._timer&&(clearTimeout(this._timer),this._timer=void 0)}}}),en=l(h=>{"use strict";Object.defineProperty(h,"__esModule",{value:!0}),h.BatchSpanProcessor=void 0;var m=Zt(),y=class extends m.BatchSpanProcessorBase{onShutdown(){}};h.BatchSpanProcessor=y}),nn=l(h=>{"use strict";var m=h&&h.__createBinding||(Object.create?function(h,m,y,v){void 0===v&&(v=y),Object.defineProperty(h,v,{enumerable:!0,get:function(){return m[y]}})}:function(h,m,y,v){void 0===v&&(v=y),h[v]=m[y]}),y=h&&h.__exportStar||function(h,y){for(var v in h)"default"!==v&&!Object.prototype.hasOwnProperty.call(y,v)&&m(y,h,v)};Object.defineProperty(h,"__esModule",{value:!0}),y(en(),h)}),sn=l(h=>{"use strict";var m=h&&h.__createBinding||(Object.create?function(h,m,y,v){void 0===v&&(v=y),Object.defineProperty(h,v,{enumerable:!0,get:function(){return m[y]}})}:function(h,m,y,v){void 0===v&&(v=y),h[v]=m[y]}),y=h&&h.__exportStar||function(h,y){for(var v in h)"default"!==v&&!Object.prototype.hasOwnProperty.call(y,v)&&m(y,h,v)};Object.defineProperty(h,"__esModule",{value:!0}),y(nn(),h)}),an=l(h=>{"use strict";Object.defineProperty(h,"__esModule",{value:!0}),h.BasicTracerProvider=h.ForceFlushState=void 0;var m,y,v=Be(),C=Nt(),T=zt(),w=gn(),A=xt(),P=Gt(),k=Jt(),R=Qt(),M=sn();(y=m=h.ForceFlushState||(h.ForceFlushState={}))[y.resolved=0]="resolved",y[y.timeout=1]="timeout",y[y.error=2]="error",y[y.unresolved=3]="unresolved";var N=class{constructor(h={}){var m;this._registeredSpanProcessors=[],this._tracers=new Map;let y=R({},A.DEFAULT_CONFIG,h);this.resource=null!==(m=y.resource)&&void 0!==m?m:T.Resource.empty(),this.resource=T.Resource.default().merge(this.resource),this._config=Object.assign({},y,{resource:this.resource});let v=this._buildExporterFromEnv();if(void 0!==v){let h=new M.BatchSpanProcessor(v);this.activeSpanProcessor=h}else this.activeSpanProcessor=new k.NoopSpanProcessor}getTracer(h,m){let y=`${h}@${m||""}`;return this._tracers.has(y)||this._tracers.set(y,new w.Tracer({name:h,version:m},this._config,this)),this._tracers.get(y)}addSpanProcessor(h){0===this._registeredSpanProcessors.length&&this.activeSpanProcessor.shutdown().catch(h=>v.diag.error("Error while trying to shutdown current span processor",h)),this._registeredSpanProcessors.push(h),this.activeSpanProcessor=new P.MultiSpanProcessor(this._registeredSpanProcessors)}getActiveSpanProcessor(){return this.activeSpanProcessor}register(h={}){v.trace.setGlobalTracerProvider(this),void 0===h.propagator&&(h.propagator=this._buildPropagatorFromEnv()),h.contextManager&&v.context.setGlobalContextManager(h.contextManager),h.propagator&&v.propagation.setGlobalPropagator(h.propagator)}forceFlush(){let h=this._config.forceFlushTimeoutMillis,y=this._registeredSpanProcessors.map(y=>new Promise(v=>{let C,T=setTimeout(()=>{v(new Error(`Span processor did not completed within timeout period of ${h} ms`)),C=m.timeout},h);y.forceFlush().then(()=>{clearTimeout(T),C!==m.timeout&&(C=m.resolved,v(C))}).catch(h=>{clearTimeout(T),C=m.error,v(h)})}));return new Promise((h,v)=>{Promise.all(y).then(y=>{let C=y.filter(h=>h!==m.resolved);C.length>0?v(C):h()}).catch(h=>v([h]))})}shutdown(){return this.activeSpanProcessor.shutdown()}_getPropagator(h){var m;return null===(m=N._registeredPropagators.get(h))||void 0===m?void 0:m()}_getSpanExporter(h){var m;return null===(m=N._registeredExporters.get(h))||void 0===m?void 0:m()}_buildPropagatorFromEnv(){let h=Array.from(new Set(C.getEnv().OTEL_PROPAGATORS)),m=h.map(h=>{let m=this._getPropagator(h);return m||v.diag.warn(`Propagator "${h}" requested through environment variable is unavailable.`),m}).reduce((h,m)=>(m&&h.push(m),h),[]);if(0!==m.length)return 1===h.length?m[0]:new C.CompositePropagator({propagators:m})}_buildExporterFromEnv(){let h=C.getEnv().OTEL_TRACES_EXPORTER;if("none"===h)return;let m=this._getSpanExporter(h);return m||v.diag.error(`Exporter "${h}" requested through environment variable is unavailable.`),m}};h.BasicTracerProvider=N,N._registeredPropagators=new Map([["tracecontext",()=>new C.HttpTraceContextPropagator],["baggage",()=>new C.HttpBaggagePropagator]]),N._registeredExporters=new Map}),cn=l(h=>{"use strict";Object.defineProperty(h,"__esModule",{value:!0}),h.ConsoleSpanExporter=void 0;var m=Nt();h.ConsoleSpanExporter=class{export(h,m){return this._sendSpans(h,m)}shutdown(){return this._sendSpans([]),Promise.resolve()}_exportInfo(h){return{traceId:h.spanContext().traceId,parentId:h.parentSpanId,name:h.name,id:h.spanContext().spanId,kind:h.kind,timestamp:m.hrTimeToMicroseconds(h.startTime),duration:m.hrTimeToMicroseconds(h.duration),attributes:h.attributes,status:h.status,events:h.events}}_sendSpans(h,y){for(let m of h)console.log(this._exportInfo(m));if(y)return y({code:m.ExportResultCode.SUCCESS})}}}),ln=l(h=>{"use strict";Object.defineProperty(h,"__esModule",{value:!0}),h.InMemorySpanExporter=void 0;var m=Nt();h.InMemorySpanExporter=class{constructor(){this._finishedSpans=[],this._stopped=!1}export(h,y){if(this._stopped)return y({code:m.ExportResultCode.FAILED,error:new Error("Exporter has been stopped")});this._finishedSpans.push(...h),setTimeout(()=>y({code:m.ExportResultCode.SUCCESS}),0)}shutdown(){return this._stopped=!0,this._finishedSpans=[],Promise.resolve()}reset(){this._finishedSpans=[]}getFinishedSpans(){return this._finishedSpans}}}),un=l(h=>{"use strict";Object.defineProperty(h,"__esModule",{value:!0})}),dn=l(h=>{"use strict";Object.defineProperty(h,"__esModule",{value:!0}),h.SimpleSpanProcessor=void 0;var m=Be(),y=Nt();h.SimpleSpanProcessor=class{constructor(h){this._exporter=h,this._isShutdown=!1,this._shuttingDownPromise=Promise.resolve()}forceFlush(){return Promise.resolve()}onStart(h){}onEnd(h){this._isShutdown||m.context.with(y.suppressTracing(m.context.active()),()=>{this._exporter.export([h],h=>{var m;h.code!==y.ExportResultCode.SUCCESS&&y.globalErrorHandler(null!==(m=h.error)&&void 0!==m?m:new Error(`SimpleSpanProcessor: span export failed (status ${h})`))})})}shutdown(){return this._isShutdown||(this._isShutdown=!0,this._shuttingDownPromise=new Promise((h,m)=>{Promise.resolve().then(()=>this._exporter.shutdown()).then(h).catch(h=>{m(h)})})),this._shuttingDownPromise}}}),hn=l(h=>{"use strict";Object.defineProperty(h,"__esModule",{value:!0})}),pn=l(h=>{"use strict";Object.defineProperty(h,"__esModule",{value:!0})}),mn=l(h=>{"use strict";Object.defineProperty(h,"__esModule",{value:!0})}),fn=l(h=>{"use strict";Object.defineProperty(h,"__esModule",{value:!0})}),gn=l(h=>{"use strict";var m=h&&h.__createBinding||(Object.create?function(h,m,y,v){void 0===v&&(v=y),Object.defineProperty(h,v,{enumerable:!0,get:function(){return m[y]}})}:function(h,m,y,v){void 0===v&&(v=y),h[v]=m[y]}),y=h&&h.__exportStar||function(h,y){for(var v in h)"default"!==v&&!Object.prototype.hasOwnProperty.call(y,v)&&m(y,h,v)};Object.defineProperty(h,"__esModule",{value:!0}),y(Lt(),h),y(an(),h),y(sn(),h),y(cn(),h),y(ln(),h),y(un(),h),y(dn(),h),y(hn(),h),y(Jt(),h),y(It(),h),y(pn(),h),y(mn(),h),y(fn(),h)}),yn=l(h=>{"use strict";Object.defineProperty(h,"__esModule",{value:!0}),h.enable=h.azureCoreTracing=h.AzureMonitorSymbol=void 0;var m=O();h.AzureMonitorSymbol="Azure_Monitor_Tracer";var y=!1;h.azureCoreTracing={versionSpecifier:">= 1.0.0 < 2.0.0",patch:function(v){if(y)return v;try{var C=gn(),T=Be(),w=(new C.BasicTracerProvider).getTracer("applicationinsights tracer"),A=v.setTracer;v.setTracer=function(y){var v=y.startSpan;y.startSpan=function(h,y,C){var T=v.call(this,h,y,C),w=T.end;return T.end=function(){var h=w.apply(this,arguments);return m.channel.publish("azure-coretracing",T),h},T},y[h.AzureMonitorSymbol]=!0,A.call(this,y)},T.trace.getSpan(T.context.active()),v.setTracer(w),y=!0}catch(h){}return v}},h.enable=function yC(){m.channel.registerMonkeyPatch("@azure/core-tracing",h.azureCoreTracing)}}),vn=l(h=>{"use strict";Object.defineProperty(h,"__esModule",{value:!0}),h.enable=h.bunyan=void 0;var m=O();h.bunyan={versionSpecifier:">= 1.0.0 < 2.0.0",patch:function(h){var y=h.prototype._emit;return h.prototype._emit=function(h,v){var C=y.apply(this,arguments);if(!v){var T=C;T||(T=y.call(this,h,!0)),m.channel.publish("bunyan",{level:h.level,result:T})}return C},h}},h.enable=function SC(){m.channel.registerMonkeyPatch("bunyan",h.bunyan)}}),Sn=l(h=>{"use strict";Object.defineProperty(h,"__esModule",{value:!0}),h.enable=h.console=void 0;var m=O(),v=y(19);h.console={versionSpecifier:">= 4.0.0",patch:function(h){var y=new v.Writable,C=new v.Writable;y.write=function(h){if(!h)return!0;var y=h.toString();return m.channel.publish("console",{message:y}),!0},C.write=function(h){if(!h)return!0;var y=h.toString();return m.channel.publish("console",{message:y,stderr:!0}),!0};for(var T=new h.Console(y,C),a=function(m){var y=h[m];y&&(h[m]=function(){if(T[m])try{T[m].apply(T,arguments)}catch(h){}return y.apply(h,arguments)})},w=0,A=["log","info","warn","error","dir","time","timeEnd","trace","assert"];w<A.length;w++){a(A[w])}return h}},h.enable=function bC(){m.channel.registerMonkeyPatch("console",h.console),y(890)}}),En=l(h=>{"use strict";Object.defineProperty(h,"__esModule",{value:!0}),h.enable=h.mongoCore=void 0;var m=O();h.mongoCore={versionSpecifier:">= 2.0.0 < 4.0.0",patch:function(h){var y=h.Server.prototype.connect;return h.Server.prototype.connect=function(){var h=y.apply(this,arguments),v=this.s.pool.write;this.s.pool.write=function(){var h="function"==typeof arguments[1]?1:2;return"function"==typeof arguments[h]&&(arguments[h]=m.channel.bindToContext(arguments[h])),v.apply(this,arguments)};var C=this.s.pool.logout;return this.s.pool.logout=function(){return"function"==typeof arguments[1]&&(arguments[1]=m.channel.bindToContext(arguments[1])),C.apply(this,arguments)},h},h}},h.enable=function CC(){m.channel.registerMonkeyPatch("mongodb-core",h.mongoCore)}}),Cn=l(h=>{"use strict";var m=h&&h.__assign||function(){return(m=Object.assign||function(h){for(var m,y=1,v=arguments.length;y<v;y++)for(var C in m=arguments[y])Object.prototype.hasOwnProperty.call(m,C)&&(h[C]=m[C]);return h}).apply(this,arguments)};Object.defineProperty(h,"__esModule",{value:!0}),h.enable=h.mongo330=h.mongo3=h.mongo2=void 0;var y=O();h.mongo2={versionSpecifier:">= 2.0.0 <= 3.0.5",patch:function(h){var v=h.instrument({operationIdGenerator:{next:function(){return y.channel.bindToContext((function(h){return h()}))}}}),C={};return v.on("started",(function(h){C[h.requestId]||(C[h.requestId]=m(m({},h),{time:new Date}))})),v.on("succeeded",(function(h){var m=C[h.requestId];m&&delete C[h.requestId],"function"==typeof h.operationId?h.operationId((function(){return y.channel.publish("mongodb",{startedData:m,event:h,succeeded:!0})})):y.channel.publish("mongodb",{startedData:m,event:h,succeeded:!0})})),v.on("failed",(function(h){var m=C[h.requestId];m&&delete C[h.requestId],"function"==typeof h.operationId?h.operationId((function(){return y.channel.publish("mongodb",{startedData:m,event:h,succeeded:!1})})):y.channel.publish("mongodb",{startedData:m,event:h,succeeded:!1})})),h}},h.mongo3={versionSpecifier:"> 3.0.5 < 3.3.0",patch:function(h){var v=h.instrument(),C={},T={};return v.on("started",(function(h){C[h.requestId]||(T[h.requestId]=y.channel.bindToContext((function(h){return h()})),C[h.requestId]=m(m({},h),{time:new Date}))})),v.on("succeeded",(function(h){var m=C[h.requestId];m&&delete C[h.requestId],"object"==typeof h&&"function"==typeof T[h.requestId]&&(T[h.requestId]((function(){return y.channel.publish("mongodb",{startedData:m,event:h,succeeded:!0})})),delete T[h.requestId])})),v.on("failed",(function(h){var m=C[h.requestId];m&&delete C[h.requestId],"object"==typeof h&&"function"==typeof T[h.requestId]&&(T[h.requestId]((function(){return y.channel.publish("mongodb",{startedData:m,event:h,succeeded:!1})})),delete T[h.requestId])})),h}},h.mongo330={versionSpecifier:">= 3.3.0 < 4.0.0",patch:function(h){!function(h){var m=h.Server.prototype.connect;h.Server.prototype.connect=function(){var h=m.apply(this,arguments),v=this.s.coreTopology.s.pool.write;this.s.coreTopology.s.pool.write=function(){var h="function"==typeof arguments[1]?1:2;return"function"==typeof arguments[h]&&(arguments[h]=y.channel.bindToContext(arguments[h])),v.apply(this,arguments)};var C=this.s.coreTopology.s.pool.logout;return this.s.coreTopology.s.pool.logout=function(){return"function"==typeof arguments[1]&&(arguments[1]=y.channel.bindToContext(arguments[1])),C.apply(this,arguments)},h}}(h);var m=h.instrument(),v={},C={};return m.on("started",(function(h){v[h.requestId]||(C[h.requestId]=y.channel.bindToContext((function(h){return h()})),v[h.requestId]=h)})),m.on("succeeded",(function(h){var m=v[h.requestId];m&&delete v[h.requestId],"object"==typeof h&&"function"==typeof C[h.requestId]&&(C[h.requestId]((function(){return y.channel.publish("mongodb",{startedData:m,event:h,succeeded:!0})})),delete C[h.requestId])})),m.on("failed",(function(h){var m=v[h.requestId];m&&delete v[h.requestId],"object"==typeof h&&"function"==typeof C[h.requestId]&&(C[h.requestId]((function(){return y.channel.publish("mongodb",{startedData:m,event:h,succeeded:!1})})),delete C[h.requestId])})),h}},h.enable=function DC(){y.channel.registerMonkeyPatch("mongodb",h.mongo2),y.channel.registerMonkeyPatch("mongodb",h.mongo3),y.channel.registerMonkeyPatch("mongodb",h.mongo330)}}),_n=l(h=>{"use strict";Object.defineProperty(h,"__esModule",{value:!0}),h.enable=h.mysql=void 0;var m=O(),v=y(7);h.mysql={versionSpecifier:">= 2.0.0 < 3.0.0",patch:function(h,C){var r=function(h,y){return function(y,v){var C=h[y];C&&(h[y]=function(){for(var h=arguments.length-1,y=arguments.length-1;y>=0;--y){if("function"==typeof arguments[y]){h=y;break}if(void 0!==arguments[y])break}var T=arguments[h],w={result:null,startTime:null,startDate:null};"function"==typeof T&&(v?(w.startTime=process.hrtime(),w.startDate=new Date,arguments[h]=m.channel.bindToContext(v(w,T))):arguments[h]=m.channel.bindToContext(T));var A=C.apply(this,arguments);return w.result=A,A})}},n=function(h,m){return r(h.prototype)},T=y(891)(v.dirname(C)+"/lib/Connection");["connect","changeUser","ping","statistics","end"].forEach((function(h){return n(T)(h)})),r(T)("createQuery",(function(h,y){return function(v){var C=process.hrtime(h.startTime),T=1e3*C[0]+C[1]/1e6|0;m.channel.publish("mysql",{query:h.result,callbackArgs:arguments,err:v,duration:T,time:h.startDate}),y.apply(this,arguments)}}));var w=y(892)(v.dirname(C)+"/lib/Pool");return["_enqueueCallback"].forEach((function(h){return n(w)(h)})),h}},h.enable=function MC(){m.channel.registerMonkeyPatch("mysql",h.mysql)}}),Tn=l(h=>{"use strict";Object.defineProperty(h,"__esModule",{value:!0}),h.enable=h.postgresPool1=void 0;var m=O();h.postgresPool1={versionSpecifier:">= 1.0.0 < 3.0.0",patch:function xC(h){var y=h.prototype.connect;return h.prototype.connect=function(h){return h&&(arguments[0]=m.channel.bindToContext(h)),y.apply(this,arguments)},h}},h.enable=function LC(){m.channel.registerMonkeyPatch("pg-pool",h.postgresPool1)}}),bn=l(h=>{"use strict";Object.defineProperty(h,"__esModule",{value:!0}),h.enable=h.postgres7=h.postgres6=void 0;var m=O(),v=y(13);h.postgres6={versionSpecifier:"6.*",patch:function qC(h,y){var C=h.Client.prototype.query,T="__diagnosticOriginalFunc";return h.Client.prototype.query=function(h,y,w){var A,P={query:{},database:{host:this.connectionParameters.host,port:this.connectionParameters.port},result:null,error:null,duration:0,time:new Date},k=process.hrtime();function d(h){h&&h[T]&&(h=h[T]);var y=m.channel.bindToContext((function(y,C){var T=process.hrtime(k);if(P.result=C&&{rowCount:C.rowCount,command:C.command},P.error=y,P.duration=Math.ceil(1e3*T[0]+T[1]/1e6),m.channel.publish("postgres",P),y){if(h)return h.apply(this,arguments);A&&A instanceof v.EventEmitter&&A.emit("error",y)}else h&&h.apply(this,arguments)}));try{return Object.defineProperty(y,T,{value:h}),y}catch(m){return h}}try{"string"==typeof h?y instanceof Array?(P.query.preparable={text:h,args:y},w=d(w)):(P.query.text=h,w?w=d(w):y=d(y)):("string"==typeof h.name?P.query.plan=h.name:h.values instanceof Array?P.query.preparable={text:h.text,args:h.values}:P.query.text=h.text,w?w=d(w):y?y=d(y):h.callback=d(h.callback))}catch(h){return C.apply(this,arguments)}return arguments[0]=h,arguments[1]=y,arguments[2]=w,arguments.length=arguments.length>3?arguments.length:3,A=C.apply(this,arguments)},h}},h.postgres7={versionSpecifier:">=7.* <=8.*",patch:function kC(h,y){var C=h.Client.prototype.query,T="__diagnosticOriginalFunc";return h.Client.prototype.query=function(h,y,w){var A,P=this,k=!!w,R={query:{},database:{host:this.connectionParameters.host,port:this.connectionParameters.port},result:null,error:null,duration:0,time:new Date},M=process.hrtime();function _(h){h&&h[T]&&(h=h[T]);var y=m.channel.bindToContext((function(y,C){var T=process.hrtime(M);if(R.result=C&&{rowCount:C.rowCount,command:C.command},R.error=y,R.duration=Math.ceil(1e3*T[0]+T[1]/1e6),m.channel.publish("postgres",R),y){if(h)return h.apply(this,arguments);A&&A instanceof v.EventEmitter&&A.emit("error",y)}else h&&h.apply(this,arguments)}));try{return Object.defineProperty(y,T,{value:h}),y}catch(m){return h}}try{"string"==typeof h?y instanceof Array?(R.query.preparable={text:h,args:y},w=(k="function"==typeof w)?_(w):w):(R.query.text=h,w?w=(k="function"==typeof w)?_(w):w:y=(k="function"==typeof y)?_(y):y):("string"==typeof h.name?R.query.plan=h.name:h.values instanceof Array?R.query.preparable={text:h.text,args:h.values}:R.query.text=h.text,w?(k="function"==typeof w,w=_(w)):y?y=(k="function"==typeof y)?_(y):y:(k="function"==typeof h.callback,h.callback=k?_(h.callback):h.callback))}catch(h){return C.apply(this,arguments)}return arguments[0]=h,arguments[1]=y,arguments[2]=w,arguments.length=arguments.length>3?arguments.length:3,A=C.apply(this,arguments),k?A:A.then((function(h){return _()(void 0,h),new P._Promise((function(m,y){m(h)}))})).catch((function(h){return _()(h,void 0),new P._Promise((function(m,y){y(h)}))}))},h}},h.enable=function jC(){m.channel.registerMonkeyPatch("pg",h.postgres6),m.channel.registerMonkeyPatch("pg",h.postgres7)}}),wn=l(h=>{"use strict";Object.defineProperty(h,"__esModule",{value:!0}),h.enable=h.redis=void 0;var m=O();h.redis={versionSpecifier:">= 2.0.0 < 4.0.0",patch:function(h){var y=h.RedisClient.prototype.internal_send_command;return h.RedisClient.prototype.internal_send_command=function(h){if(h){var v=h.callback;if(!v||!v.pubsubBound){var C=this.address,T=process.hrtime(),w=new Date;h.callback=m.channel.bindToContext((function(y,A){var P=process.hrtime(T),k=1e3*P[0]+P[1]/1e6|0;m.channel.publish("redis",{duration:k,address:C,commandObj:h,err:y,result:A,time:w}),"function"==typeof v&&v.apply(this,arguments)})),h.callback.pubsubBound=!0}}return y.call(this,h)},h}},h.enable=function UC(){m.channel.registerMonkeyPatch("redis",h.redis)}}),An=l(h=>{"use strict";var m=h&&h.__assign||function(){return(m=Object.assign||function(h){for(var m,y=1,v=arguments.length;y<v;y++)for(var C in m=arguments[y])Object.prototype.hasOwnProperty.call(m,C)&&(h[C]=m[C]);return h}).apply(this,arguments)};Object.defineProperty(h,"__esModule",{value:!0}),h.enable=h.tedious=void 0;var y=O();h.tedious={versionSpecifier:">= 6.0.0 < 9.0.0",patch:function(h){var v=h.Connection.prototype.makeRequest;return h.Connection.prototype.makeRequest=function(){function n(h){var v=process.hrtime(),C={query:{},database:{host:null,port:null},result:null,error:null,duration:0};return y.channel.bindToContext((function(T,w,A){var P=process.hrtime(v);C=m(m({},C),{database:{host:this.connection.config.server,port:this.connection.config.options.port},result:!T&&{rowCount:w,rows:A},query:{text:this.parametersByName.statement.value},error:T,duration:Math.ceil(1e3*P[0]+P[1]/1e6)}),y.channel.publish("tedious",C),h.call(this,T,w,A)}))}var h=arguments[0];arguments[0].callback=n(h.callback),v.apply(this,arguments)},h}},h.enable=function GC(){y.channel.registerMonkeyPatch("tedious",h.tedious)}}),Pn=l(h=>{"use strict";var m,y=h&&h.__extends||(m=function(h,y){return(m=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(h,m){h.__proto__=m}||function(h,m){for(var y in m)Object.prototype.hasOwnProperty.call(m,y)&&(h[y]=m[y])})(h,y)},function(h,y){function n(){this.constructor=h}m(h,y),h.prototype=null===y?Object.create(y):(n.prototype=y.prototype,new n)}),v=h&&h.__rest||function(h,m){var y={};for(var v in h)Object.prototype.hasOwnProperty.call(h,v)&&m.indexOf(v)<0&&(y[v]=h[v]);if(null!=h&&"function"==typeof Object.getOwnPropertySymbols){var C=0;for(v=Object.getOwnPropertySymbols(h);C<v.length;C++)m.indexOf(v[C])<0&&Object.prototype.propertyIsEnumerable.call(h,v[C])&&(y[v[C]]=h[v[C]])}return y};Object.defineProperty(h,"__esModule",{value:!0}),h.enable=h.winston2=h.winston3=void 0;var C=O();h.winston3={versionSpecifier:"3.x",patch:function(h){var m=function(h){function o(m,y){var v=h.call(this,y)||this;return v.winston=m,v}return y(o,h),o.prototype.log=function(h,m){var y=h.message,T=h.level,w=h.meta,A=v(h,["message","level","meta"]);T="function"==typeof Symbol.for?h[Symbol.for("level")]:T,y=h instanceof Error?h:y;var P=function(h,m){return null!=h.config.npm.levels[m]?"npm":null!=h.config.syslog.levels[m]?"syslog":"unknown"}(this.winston,T);for(var k in w=w||{},A)A.hasOwnProperty(k)&&(w[k]=A[k]);C.channel.publish("winston",{message:y,level:T,levelKind:P,meta:w}),m()},o}(h.Transport);function n(){var y,v=arguments[0].levels||h.config.npm.levels;for(var C in v)v.hasOwnProperty(C)&&(y=void 0===y||v[C]>v[y]?C:y);this.add(new m(h,{level:y}))}var T=h.createLogger;h.createLogger=function(){var y,v=arguments[0].levels||h.config.npm.levels;for(var C in v)v.hasOwnProperty(C)&&(y=void 0===y||v[C]>v[y]?C:y);var w=T.apply(this,arguments);w.add(new m(h,{level:y}));var A=w.configure;return w.configure=function(){A.apply(this,arguments),n.apply(this,arguments)},w};var w=h.configure;return h.configure=function(){w.apply(this,arguments),n.apply(this,arguments)},h.add(new m(h)),h}},h.winston2={versionSpecifier:"2.x",patch:function(h){var m,y=h.Logger.prototype.log,n=function(y,v,T){var w;return w=m===h.config.npm.levels?"npm":m===h.config.syslog.levels?"syslog":"unknown",C.channel.publish("winston",{level:y,message:v,meta:T,levelKind:w}),v};return h.Logger.prototype.log=function(){return m=this.levels,this.filters&&0!==this.filters.length?this.filters[this.filters.length-1]!==n&&(this.filters=this.filters.filter((function(h){return h!==n})),this.filters.push(n)):this.filters=[n],y.apply(this,arguments)},h}},h.enable=function KC(){C.channel.registerMonkeyPatch("winston",h.winston2),C.channel.registerMonkeyPatch("winston",h.winston3)}}),kn=l(h=>{"use strict";Object.defineProperty(h,"__esModule",{value:!0}),h.enable=h.tedious=h.pgPool=h.pg=h.winston=h.redis=h.mysql=h.mongodb=h.mongodbCore=h.console=h.bunyan=h.azuresdk=void 0;var m=yn();h.azuresdk=m;var y=vn();h.bunyan=y;var v=Sn();h.console=v;var C=En();h.mongodbCore=C;var T=Cn();h.mongodb=T;var w=_n();h.mysql=w;var A=Tn();h.pgPool=A;var P=bn();h.pg=P;var k=wn();h.redis=k;var R=An();h.tedious=R;var M=Pn();h.winston=M,h.enable=function YC(){y.enable(),v.enable(),C.enable(),T.enable(),w.enable(),P.enable(),A.enable(),k.enable(),M.enable(),m.enable(),R.enable()}}),Rn=l(h=>{"use strict";Object.defineProperty(h,"__esModule",{value:!0}),h.registerContextPreservation=h.IsInitialized=void 0;var m=N(),y=M();h.IsInitialized=!process.env.APPLICATION_INSIGHTS_NO_DIAGNOSTIC_CHANNEL;var v,C,T,w,A="DiagnosticChannel";if(h.IsInitialized){for(w in v=kn(),C=(process.env.APPLICATION_INSIGHTS_NO_PATCH_MODULES||"").split(","),T={bunyan:v.bunyan,console:v.console,mongodb:v.mongodb,mongodbCore:v.mongodbCore,mysql:v.mysql,redis:v.redis,pg:v.pg,pgPool:v.pgPool,winston:v.winston,azuresdk:v.azuresdk})-1===C.indexOf(w)&&(T[w].enable(),y.info(A,"Subscribed to "+w+" events"));C.length>0&&y.info(A,"Some modules will not be patched",C)}else y.info(A,"Not subscribing to dependency autocollection because APPLICATION_INSIGHTS_NO_DIAGNOSTIC_CHANNEL was set");h.registerContextPreservation=function QC(y){if(h.IsInitialized){var v=O();v.channel.addContextPreservation(y),v.channel.spanContextPropagator=m.AsyncScopeManager}}}),Mn=l((h,m)=>{"use strict";m.exports={requestContextHeader:"request-context",requestContextSourceKey:"appId",requestContextTargetKey:"appId",requestIdHeader:"request-id",parentIdHeader:"x-ms-request-id",rootIdHeader:"x-ms-request-root-id",correlationContextHeader:"correlation-context",traceparentHeader:"traceparent",traceStateHeader:"tracestate"}}),Nn=l((h,m)=>{"use strict";var v=h&&h.__assign||function(){return(v=Object.assign||function(h){for(var m,y=1,v=arguments.length;y<v;y++)for(var C in m=arguments[y])Object.prototype.hasOwnProperty.call(m,C)&&(h[C]=m[C]);return h}).apply(this,arguments)},C=y(52),T=y(46),w=y(20),A=y(68),P=M(),k=Mn(),R=function(){function e(){}return e.getCookie=function(h,m){var y="";if(h&&h.length&&"string"==typeof m)for(var v=h+"=",C=m.split(";"),T=0;T<C.length;T++){m=C[T];if((m=e.trim(m))&&0===m.indexOf(v)){y=m.substring(v.length,C[T].length);break}}return y},e.trim=function(h){return"string"==typeof h?h.replace(/^\s+|\s+$/g,""):""},e.int32ArrayToBase64=function(h){var r=function(h,m){return String.fromCharCode(h>>m&255)},m=h.map((function(h){return r(h,24)+r(h,16)+r(h,8)+r(h,0)})).join(""),y=(Buffer.from?Buffer.from(m,"binary"):new Buffer(m,"binary")).toString("base64");return y.substr(0,y.indexOf("="))},e.random32=function(){return 4294967296*Math.random()|0},e.randomu32=function(){return e.random32()+2147483648},e.w3cTraceId=function(){for(var h,m=["0","1","2","3","4","5","6","7","8","9","a","b","c","d","e","f"],y="",v=0;v<4;v++)y+=m[15&(h=e.random32())]+m[h>>4&15]+m[h>>8&15]+m[h>>12&15]+m[h>>16&15]+m[h>>20&15]+m[h>>24&15]+m[h>>28&15];var C=m[8+4*Math.random()|0];return y.substr(0,8)+y.substr(9,4)+"4"+y.substr(13,3)+C+y.substr(16,3)+y.substr(19,12)},e.w3cSpanId=function(){return e.w3cTraceId().substring(16)},e.isValidW3CId=function(h){return 32===h.length&&"00000000000000000000000000000000"!==h},e.isArray=function(h){return"[object Array]"===Object.prototype.toString.call(h)},e.isError=function(h){return h instanceof Error},e.isPrimitive=function(h){var m=typeof h;return"string"===m||"number"===m||"boolean"===m},e.isDate=function(h){return"[object Date]"===Object.prototype.toString.call(h)},e.msToTimeSpan=function(h){(isNaN(h)||h<0)&&(h=0);var m=(h/1e3%60).toFixed(7).replace(/0{0,4}$/,""),y=""+Math.floor(h/6e4)%60,v=""+Math.floor(h/36e5)%24,C=Math.floor(h/864e5);return m=m.indexOf(".")<2?"0"+m:m,y=y.length<2?"0"+y:y,(C>0?C+".":"")+(v=v.length<2?"0"+v:v)+":"+y+":"+m},e.extractError=function(h){var m=h;return{message:h.message,code:m.code||m.id||""}},e.extractObject=function(h){return h instanceof Error?e.extractError(h):"function"==typeof h.toJSON?h.toJSON():h},e.validateStringMap=function(h){if("object"==typeof h){var m={};for(var y in h){var v="",C=h[y],T=typeof C;if(e.isPrimitive(C))v=C.toString();else if(null===C||"undefined"===T)v="";else{if("function"===T){P.info("key: "+y+" was function; will not serialize");continue}var w=e.isArray(C)?C:e.extractObject(C);try{v=e.isPrimitive(w)?w:JSON.stringify(w)}catch(h){v=C.constructor.name.toString()+" (Error: "+h.message+")",P.info("key: "+y+", could not be serialized")}}m[y]=v.substring(0,e.MAX_PROPERTY_LENGTH)}return m}P.info("Invalid properties dropped from payload")},e.canIncludeCorrelationHeader=function(h,m){var y=h&&h.config&&h.config.correlationHeaderExcludedDomains;if(!y||0==y.length||!m)return!0;for(var v=0;v<y.length;v++){if(new RegExp(y[v].replace(/\./g,".").replace(/\*/g,".*")).test(w.parse(m).hostname))return!1}return!0},e.getCorrelationContextTarget=function(h,m){var y=h.headers&&h.headers[k.requestContextHeader];if(y)for(var v=y.split(","),C=0;C<v.length;++C){var T=v[C].split("=");if(2==T.length&&T[0]==m)return T[1]}},e.makeRequest=function(h,m,y,A){m&&0===m.indexOf("//")&&(m="https:"+m);var k=w.parse(m),R=v(v({},y),{host:k.hostname,port:k.port,path:k.pathname}),M=void 0;if("https:"===k.protocol&&(M=h.proxyHttpsUrl||void 0),"http:"===k.protocol&&(M=h.proxyHttpUrl||void 0),M){0===M.indexOf("//")&&(M="http:"+M);var N=w.parse(M);"https:"===N.protocol?(P.info("Proxies that use HTTPS are not supported"),M=void 0):R=v(v({},R),{host:N.hostname,port:N.port||"80",path:m,headers:v(v({},R.headers),{Host:k.hostname})})}var D="https:"===k.protocol&&!M;return D&&void 0!==h.httpsAgent?R.agent=h.httpsAgent:D||void 0===h.httpAgent?D&&(R.agent=e.tlsRestrictedAgent):R.agent=h.httpAgent,D?T.request(R,A):C.request(R,A)},e.safeIncludeCorrelationHeader=function(h,m,y){var v;if("string"==typeof y)v=y;else if(y instanceof Array)v=y.join(",");else if(y&&"function"==typeof y.toString)try{v=y.toString()}catch(h){P.warn("Outgoing request-context header could not be read. Correlation of requests may be lost.",h,y)}v?e.addCorrelationIdHeaderFromString(h,m,v):m.setHeader(k.requestContextHeader,k.requestContextSourceKey+"="+h.config.correlationId)},e.dumpObj=function(h){var m=Object.prototype.toString.call(h);return m+("[object Error]"===m?"{ stack: '"+h.stack+"', message: '"+h.message+"', name: '"+h.name+"'":JSON.stringify(h))},e.addCorrelationIdHeaderFromString=function(h,m,y){var v=y.split(","),C=k.requestContextSourceKey+"=";v.some((function(h){return h.substring(0,C.length)===C}))||m.setHeader(k.requestContextHeader,y+","+k.requestContextSourceKey+"="+h.config.correlationId)},e.MAX_PROPERTY_LENGTH=8192,e.tlsRestrictedAgent=new T.Agent({keepAlive:!0,maxSockets:25,secureOptions:A.SSL_OP_NO_SSLv2|A.SSL_OP_NO_SSLv3|A.SSL_OP_NO_TLSv1|A.SSL_OP_NO_TLSv1_1}),e}();m.exports=R}),Dn=l((h,m)=>{"use strict";var y=Nn(),v=M(),C=function(){function e(){}return e.queryCorrelationId=function(h,m){var C=h.profileQueryEndpoint+"/api/profiles/"+h.instrumentationKey+"/appId";if(e.completedLookups.hasOwnProperty(C))m(e.completedLookups[C]);else if(e.pendingLookups[C])e.pendingLookups[C].push(m);else{e.pendingLookups[C]=[m];var i=function(){if(e.pendingLookups[C]){var m={method:"GET",disableAppInsightsAutoCollection:!0};v.info(e.TAG,m);var T=y.makeRequest(h,C,m,(function(m){if(200===m.statusCode){var y="";m.setEncoding("utf-8"),m.on("data",(function(h){y+=h})),m.on("end",(function(){v.info(e.TAG,y);var h=e.correlationIdPrefix+y;e.completedLookups[C]=h,e.pendingLookups[C]&&e.pendingLookups[C].forEach((function(m){return m(h)})),delete e.pendingLookups[C]}))}else m.statusCode>=400&&m.statusCode<500?(e.completedLookups[C]=void 0,delete e.pendingLookups[C]):setTimeout(i,h.correlationIdRetryIntervalMs)}));T&&(T.on("error",(function(h){v.warn(e.TAG,h)})),T.end())}};setTimeout(i,0)}},e.cancelCorrelationIdQuery=function(h,m){var y=h.profileQueryEndpoint+"/api/profiles/"+h.instrumentationKey+"/appId",v=e.pendingLookups[y];v&&(e.pendingLookups[y]=v.filter((function(h){return h!=m})),0==e.pendingLookups[y].length&&delete e.pendingLookups[y])},e.generateRequestId=function(h){if(h){"."!==(h="|"==h[0]?h:"|"+h)[h.length-1]&&(h+=".");var m=(e.currentRootId++).toString(16);return e.appendSuffix(h,m,"_")}return e.generateRootId()},e.getRootId=function(h){var m=h.indexOf(".");m<0&&(m=h.length);var y="|"===h[0]?1:0;return h.substring(y,m)},e.generateRootId=function(){return"|"+y.w3cTraceId()+"."},e.appendSuffix=function(h,m,v){if(h.length+m.length<e.requestIdMaxLength)return h+m+v;var C=e.requestIdMaxLength-9;if(h.length>C)for(;C>1;--C){var T=h[C-1];if("."===T||"_"===T)break}if(C<=1)return e.generateRootId();for(m=y.randomu32().toString(16);m.length<8;)m="0"+m;return h.substring(0,C)+m+"#"},e.TAG="CorrelationIdManager",e.correlationIdPrefix="cid-v1:",e.w3cEnabled=!0,e.pendingLookups={},e.completedLookups={},e.requestIdMaxLength=1024,e.currentRootId=y.randomu32(),e}();m.exports=C}),In=l((h,m)=>{"use strict";var y=Nn(),v=Dn(),C=function(){function e(h,m){if(this.traceFlag=e.DEFAULT_TRACE_FLAG,this.version=e.DEFAULT_VERSION,h&&"string"==typeof h)if(h.split(",").length>1)this.traceId=y.w3cTraceId(),this.spanId=y.w3cTraceId().substr(0,16);else{var C=h.trim().split("-"),T=C.length;T>=4?(this.version=C[0],this.traceId=C[1],this.spanId=C[2],this.traceFlag=C[3]):(this.traceId=y.w3cTraceId(),this.spanId=y.w3cTraceId().substr(0,16)),this.version.match(/^[0-9a-f]{2}$/g)||(this.version=e.DEFAULT_VERSION,this.traceId=y.w3cTraceId()),"00"===this.version&&4!==T&&(this.traceId=y.w3cTraceId(),this.spanId=y.w3cTraceId().substr(0,16)),"ff"===this.version&&(this.version=e.DEFAULT_VERSION,this.traceId=y.w3cTraceId(),this.spanId=y.w3cTraceId().substr(0,16)),this.version.match(/^0[0-9a-f]$/g)||(this.version=e.DEFAULT_VERSION),this.traceFlag.match(/^[0-9a-f]{2}$/g)||(this.traceFlag=e.DEFAULT_TRACE_FLAG,this.traceId=y.w3cTraceId()),e.isValidTraceId(this.traceId)||(this.traceId=y.w3cTraceId()),e.isValidSpanId(this.spanId)||(this.spanId=y.w3cTraceId().substr(0,16),this.traceId=y.w3cTraceId()),this.parentId=this.getBackCompatRequestId()}else if(m){this.parentId=m.slice();var w=v.getRootId(m);e.isValidTraceId(w)||(this.legacyRootId=w,w=y.w3cTraceId()),-1!==m.indexOf("|")&&(m=m.substring(1+m.substring(0,m.length-1).lastIndexOf("."),m.length-1)),this.traceId=w,this.spanId=m}else this.traceId=y.w3cTraceId(),this.spanId=y.w3cTraceId().substr(0,16)}return e.isValidTraceId=function(h){return h.match(/^[0-9a-f]{32}$/)&&"00000000000000000000000000000000"!==h},e.isValidSpanId=function(h){return h.match(/^[0-9a-f]{16}$/)&&"0000000000000000"!==h},e.formatOpenTelemetryTraceFlags=function(h){var m="0"+h.toString(16);return m.substring(m.length-2)},e.prototype.getBackCompatRequestId=function(){return"|"+this.traceId+"."+this.spanId+"."},e.prototype.toString=function(){return this.version+"-"+this.traceId+"-"+this.spanId+"-"+this.traceFlag},e.prototype.updateSpanId=function(){this.spanId=y.w3cTraceId().substr(0,16)},e.DEFAULT_TRACE_FLAG="01",e.DEFAULT_VERSION="00",e}();m.exports=C}),xn=l((h,m)=>{"use strict";var y=function(){function e(h){this.fieldmap=[],h&&(this.fieldmap=this.parseHeader(h))}return e.prototype.toString=function(){var h=this.fieldmap;return h&&0!=h.length?h.join(", "):null},e.validateKeyChars=function(h){var m=h.split("@");if(2==m.length){var y=m[0].trim(),v=m[1].trim(),C=Boolean(y.match(/^[\ ]?[a-z0-9\*\-\_/]{1,241}$/)),T=Boolean(v.match(/^[\ ]?[a-z0-9\*\-\_/]{1,14}$/));return C&&T}return 1==m.length&&Boolean(h.match(/^[\ ]?[a-z0-9\*\-\_/]{1,256}$/))},e.prototype.parseHeader=function(h){var m=[],y={},v=h.split(",");if(v.length>32)return null;for(var C=0,T=v;C<T.length;C++){var w=T[C].trim();if(0!==w.length){var A=w.split("=");if(2!==A.length||!e.validateKeyChars(A[0])||y[A[0]])return null;y[A[0]]=!0,m.push(w)}}return m},e.strict=!0,e}();m.exports=y}),On=l((h,m)=>{"use strict";var y=function e(){};m.exports=y}),Ln=l((h,m)=>{"use strict";var y,v=h&&h.__extends||(y=function(h,m){return(y=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(h,m){h.__proto__=m}||function(h,m){for(var y in m)Object.prototype.hasOwnProperty.call(m,y)&&(h[y]=m[y])})(h,m)},function(h,m){function n(){this.constructor=h}y(h,m),h.prototype=null===m?Object.create(m):(n.prototype=m.prototype,new n)}),C=function(h){function t(){var m=h.call(this)||this;return m.ver=2,m.properties={},m.measurements={},m}return v(t,h),t}(On());m.exports=C}),Fn=l((h,m)=>{"use strict";var y=function e(){};m.exports=y}),Un=l((h,m)=>{"use strict";var y=function e(){this.applicationVersion="ai.application.ver",this.deviceId="ai.device.id",this.deviceLocale="ai.device.locale",this.deviceModel="ai.device.model",this.deviceOEMName="ai.device.oemName",this.deviceOSVersion="ai.device.osVersion",this.deviceType="ai.device.type",this.locationIp="ai.location.ip",this.operationId="ai.operation.id",this.operationName="ai.operation.name",this.operationParentId="ai.operation.parentId",this.operationSyntheticSource="ai.operation.syntheticSource",this.operationCorrelationVector="ai.operation.correlationVector",this.sessionId="ai.session.id",this.sessionIsFirst="ai.session.isFirst",this.userAccountId="ai.user.accountId",this.userId="ai.user.id",this.userAuthUserId="ai.user.authUserId",this.cloudRole="ai.cloud.role",this.cloudRoleInstance="ai.cloud.roleInstance",this.internalSdkVersion="ai.internal.sdkVersion",this.internalAgentVersion="ai.internal.agentVersion",this.internalNodeName="ai.internal.nodeName"};m.exports=y}),jn=l((h,m)=>{"use strict";var y,v=h&&h.__extends||(y=function(h,m){return(y=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(h,m){h.__proto__=m}||function(h,m){for(var y in m)Object.prototype.hasOwnProperty.call(m,y)&&(h[y]=m[y])})(h,m)},function(h,m){function n(){this.constructor=h}y(h,m),h.prototype=null===m?Object.create(m):(n.prototype=m.prototype,new n)}),C=function(h){function t(){return h.call(this)||this}return v(t,h),t}(Fn());m.exports=C}),Bn=l((h,m)=>{"use strict";var y,v;(v=y||(y={}))[v.Measurement=0]="Measurement",v[v.Aggregation=1]="Aggregation",m.exports=y}),qn=l((h,m)=>{"use strict";var y=Bn(),v=function e(){this.kind=y.Measurement};m.exports=v}),Yn=l((h,m)=>{"use strict";var y=function e(){this.ver=1,this.sampleRate=100,this.tags={}};m.exports=y}),Vn=l((h,m)=>{"use strict";var y,v=h&&h.__extends||(y=function(h,m){return(y=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(h,m){h.__proto__=m}||function(h,m){for(var y in m)Object.prototype.hasOwnProperty.call(m,y)&&(h[y]=m[y])})(h,m)},function(h,m){function n(){this.constructor=h}y(h,m),h.prototype=null===m?Object.create(m):(n.prototype=m.prototype,new n)}),C=function(h){function t(){var m=h.call(this)||this;return m.ver=2,m.properties={},m.measurements={},m}return v(t,h),t}(On());m.exports=C}),$n=l((h,m)=>{"use strict";var y,v=h&&h.__extends||(y=function(h,m){return(y=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(h,m){h.__proto__=m}||function(h,m){for(var y in m)Object.prototype.hasOwnProperty.call(m,y)&&(h[y]=m[y])})(h,m)},function(h,m){function n(){this.constructor=h}y(h,m),h.prototype=null===m?Object.create(m):(n.prototype=m.prototype,new n)}),C=function(h){function t(){var m=h.call(this)||this;return m.ver=2,m.exceptions=[],m.properties={},m.measurements={},m}return v(t,h),t}(On());m.exports=C}),Kn=l((h,m)=>{"use strict";var y=function e(){this.hasFullStack=!0,this.parsedStack=[]};m.exports=y}),zn=l((h,m)=>{"use strict";var y,v=h&&h.__extends||(y=function(h,m){return(y=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(h,m){h.__proto__=m}||function(h,m){for(var y in m)Object.prototype.hasOwnProperty.call(m,y)&&(h[y]=m[y])})(h,m)},function(h,m){function n(){this.constructor=h}y(h,m),h.prototype=null===m?Object.create(m):(n.prototype=m.prototype,new n)}),C=function(h){function t(){var m=h.call(this)||this;return m.ver=2,m.properties={},m}return v(t,h),t}(On());m.exports=C}),Gn=l((h,m)=>{"use strict";var y,v=h&&h.__extends||(y=function(h,m){return(y=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(h,m){h.__proto__=m}||function(h,m){for(var y in m)Object.prototype.hasOwnProperty.call(m,y)&&(h[y]=m[y])})(h,m)},function(h,m){function n(){this.constructor=h}y(h,m),h.prototype=null===m?Object.create(m):(n.prototype=m.prototype,new n)}),C=function(h){function t(){var m=h.call(this)||this;return m.ver=2,m.metrics=[],m.properties={},m}return v(t,h),t}(On());m.exports=C}),Jn=l((h,m)=>{"use strict";var y,v=h&&h.__extends||(y=function(h,m){return(y=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(h,m){h.__proto__=m}||function(h,m){for(var y in m)Object.prototype.hasOwnProperty.call(m,y)&&(h[y]=m[y])})(h,m)},function(h,m){function n(){this.constructor=h}y(h,m),h.prototype=null===m?Object.create(m):(n.prototype=m.prototype,new n)}),C=function(h){function t(){var m=h.call(this)||this;return m.ver=2,m.properties={},m.measurements={},m}return v(t,h),t}(Vn());m.exports=C}),Xn=l((h,m)=>{"use strict";var y,v=h&&h.__extends||(y=function(h,m){return(y=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(h,m){h.__proto__=m}||function(h,m){for(var y in m)Object.prototype.hasOwnProperty.call(m,y)&&(h[y]=m[y])})(h,m)},function(h,m){function n(){this.constructor=h}y(h,m),h.prototype=null===m?Object.create(m):(n.prototype=m.prototype,new n)}),C=function(h){function t(){var m=h.call(this)||this;return m.ver=2,m.success=!0,m.properties={},m.measurements={},m}return v(t,h),t}(On());m.exports=C}),Qn=l((h,m)=>{"use strict";var y,v=h&&h.__extends||(y=function(h,m){return(y=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(h,m){h.__proto__=m}||function(h,m){for(var y in m)Object.prototype.hasOwnProperty.call(m,y)&&(h[y]=m[y])})(h,m)},function(h,m){function n(){this.constructor=h}y(h,m),h.prototype=null===m?Object.create(m):(n.prototype=m.prototype,new n)}),C=function(h){function t(){var m=h.call(this)||this;return m.ver=2,m.properties={},m.measurements={},m}return v(t,h),t}(On());m.exports=C}),Zn=l((h,m)=>{"use strict";var y,v;(v=y||(y={}))[v.Verbose=0]="Verbose",v[v.Information=1]="Information",v[v.Warning=2]="Warning",v[v.Error=3]="Error",v[v.Critical=4]="Critical",m.exports=y}),er=l((h,m)=>{"use strict";var y=function e(){};m.exports=y}),tr=l(h=>{"use strict";Object.defineProperty(h,"__esModule",{value:!0}),h.AvailabilityData=Ln(),h.Base=Fn(),h.ContextTagKeys=Un(),h.Data=jn(),h.DataPoint=qn(),h.DataPointType=Bn(),h.Domain=On(),h.Envelope=Yn(),h.EventData=Vn(),h.ExceptionData=$n(),h.ExceptionDetails=Kn(),h.MessageData=zn(),h.MetricData=Gn(),h.PageViewData=Jn(),h.RemoteDependencyData=Xn(),h.RequestData=Qn(),h.SeverityLevel=Zn(),h.StackFrame=er()}),nr=l(h=>{"use strict";Object.defineProperty(h,"__esModule",{value:!0}),h.domainSupportsProperties=h.RemoteDependencyDataConstants=void 0;var m=tr(),y=function(){function e(){}return e.TYPE_HTTP="Http",e.TYPE_AI="Http (tracked component)",e}();h.RemoteDependencyDataConstants=y,h.domainSupportsProperties=function HP(h){return"properties"in h||h instanceof m.EventData||h instanceof m.ExceptionData||h instanceof m.MessageData||h instanceof m.MetricData||h instanceof m.PageViewData||h instanceof m.RemoteDependencyData||h instanceof m.RequestData}}),rr=l(h=>{"use strict";Object.defineProperty(h,"__esModule",{value:!0})}),ir=l(h=>{"use strict";Object.defineProperty(h,"__esModule",{value:!0})}),ar=l(h=>{"use strict";Object.defineProperty(h,"__esModule",{value:!0})}),cr=l(h=>{"use strict";Object.defineProperty(h,"__esModule",{value:!0})}),lr=l(h=>{"use strict";Object.defineProperty(h,"__esModule",{value:!0})}),ur=l(h=>{"use strict";Object.defineProperty(h,"__esModule",{value:!0})}),dr=l(h=>{"use strict";Object.defineProperty(h,"__esModule",{value:!0})}),hr=l(h=>{"use strict";Object.defineProperty(h,"__esModule",{value:!0})}),pr=l(h=>{"use strict";Object.defineProperty(h,"__esModule",{value:!0})}),mr=l(h=>{"use strict";Object.defineProperty(h,"__esModule",{value:!0})}),fr=l(h=>{"use strict";Object.defineProperty(h,"__esModule",{value:!0})}),gr=l(h=>{"use strict";Object.defineProperty(h,"__esModule",{value:!0})}),yr=l(h=>{"use strict";var m,y;Object.defineProperty(h,"__esModule",{value:!0}),h.TelemetryType=h.TelemetryTypeString=h.baseTypeToTelemetryType=h.telemetryTypeToBaseType=void 0,h.telemetryTypeToBaseType=function UP(h){switch(h){case m.Event:return"EventData";case m.Exception:return"ExceptionData";case m.Trace:return"MessageData";case m.Metric:return"MetricData";case m.Request:return"RequestData";case m.Dependency:return"RemoteDependencyData";case m.Availability:return"AvailabilityData";case m.PageView:return"PageViewData"}},h.baseTypeToTelemetryType=function BP(h){switch(h){case"EventData":return m.Event;case"ExceptionData":return m.Exception;case"MessageData":return m.Trace;case"MetricData":return m.Metric;case"RequestData":return m.Request;case"RemoteDependencyData":return m.Dependency;case"AvailabilityData":return m.Availability;case"PageViewData":return m.PageView}},h.TelemetryTypeString={Event:"EventData",Exception:"ExceptionData",Trace:"MessageData",Metric:"MetricData",Request:"RequestData",Dependency:"RemoteDependencyData",Availability:"AvailabilityData",PageView:"PageViewData"},(y=m=h.TelemetryType||(h.TelemetryType={}))[y.Event=0]="Event",y[y.Exception=1]="Exception",y[y.Trace=2]="Trace",y[y.Metric=3]="Metric",y[y.Request=4]="Request",y[y.Dependency=5]="Dependency",y[y.Availability=6]="Availability",y[y.PageView=7]="PageView"}),vr=l(h=>{"use strict";var m=h&&h.__createBinding||(Object.create?function(h,m,y,v){void 0===v&&(v=y),Object.defineProperty(h,v,{enumerable:!0,get:function(){return m[y]}})}:function(h,m,y,v){void 0===v&&(v=y),h[v]=m[y]}),y=h&&h.__exportStar||function(h,y){for(var v in h)"default"!==v&&!Object.prototype.hasOwnProperty.call(y,v)&&m(y,h,v)};Object.defineProperty(h,"__esModule",{value:!0}),y(rr(),h),y(ir(),h),y(ar(),h),y(cr(),h),y(lr(),h),y(ur(),h),y(dr(),h),y(hr(),h),y(pr(),h),y(mr(),h),y(fr(),h),y(gr(),h),y(yr(),h)}),Sr=l(h=>{"use strict";Object.defineProperty(h,"__esModule",{value:!0})}),Er=l(h=>{"use strict";Object.defineProperty(h,"__esModule",{value:!0})}),Cr=l(h=>{"use strict";Object.defineProperty(h,"__esModule",{value:!0})}),_r=l(h=>{"use strict";Object.defineProperty(h,"__esModule",{value:!0})}),Tr=l(h=>{"use strict";Object.defineProperty(h,"__esModule",{value:!0})}),br=l(h=>{"use strict";Object.defineProperty(h,"__esModule",{value:!0})}),wr=l(h=>{"use strict";Object.defineProperty(h,"__esModule",{value:!0})}),Ar=l(h=>{"use strict";Object.defineProperty(h,"__esModule",{value:!0})}),Pr=l(h=>{"use strict";var m=h&&h.__createBinding||(Object.create?function(h,m,y,v){void 0===v&&(v=y),Object.defineProperty(h,v,{enumerable:!0,get:function(){return m[y]}})}:function(h,m,y,v){void 0===v&&(v=y),h[v]=m[y]}),y=h&&h.__exportStar||function(h,y){for(var v in h)"default"!==v&&!Object.prototype.hasOwnProperty.call(y,v)&&m(y,h,v)};Object.defineProperty(h,"__esModule",{value:!0}),y(Sr(),h),y(Er(),h),y(Cr(),h),y(_r(),h),y(Tr(),h),y(br(),h),y(wr(),h),y(Ar(),h)}),kr=l(h=>{"use strict";var m=h&&h.__createBinding||(Object.create?function(h,m,y,v){void 0===v&&(v=y),Object.defineProperty(h,v,{enumerable:!0,get:function(){return m[y]}})}:function(h,m,y,v){void 0===v&&(v=y),h[v]=m[y]}),y=h&&h.__exportStar||function(h,y){for(var v in h)"default"!==v&&!Object.prototype.hasOwnProperty.call(y,v)&&m(y,h,v)};Object.defineProperty(h,"__esModule",{value:!0}),y(nr(),h),y(tr(),h),y(vr(),h),y(Pr(),h)}),Rr=l((h,m)=>{"use strict";var y=function(){function e(){}return e.prototype.getUrl=function(){return this.url},e.prototype.RequestParser=function(){this.startTime=+new Date},e.prototype._setStatus=function(h,m){var y=+new Date;this.duration=y-this.startTime,this.statusCode=h;var v=this.properties||{};if(m)if("string"==typeof m)v.error=m;else if(m instanceof Error)v.error=m.message;else if("object"==typeof m)for(var C in m)v[C]=m[C]&&m[C].toString&&m[C].toString();this.properties=v},e.prototype._isSuccess=function(){return 0<this.statusCode&&this.statusCode<400},e}();m.exports=y}),Mr=l((h,m)=>{"use strict";var v,C=h&&h.__extends||(v=function(h,m){return(v=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(h,m){h.__proto__=m}||function(h,m){for(var y in m)Object.prototype.hasOwnProperty.call(m,y)&&(h[y]=m[y])})(h,m)},function(h,m){function n(){this.constructor=h}v(h,m),h.prototype=null===m?Object.create(m):(n.prototype=m.prototype,new n)}),T=y(20),w=kr(),A=Nn(),P=Mn(),k=Rr(),R=Dn(),M=xn(),N=In(),D=function(h){function t(m,y){var v=h.call(this)||this;return m&&(v.method=m.method,v.url=v._getAbsoluteUrl(m),v.startTime=+new Date,v.socketRemoteAddress=m.socket&&m.socket.remoteAddress,v.parseHeaders(m,y),m.connection&&(v.connectionRemoteAddress=m.connection.remoteAddress,v.legacySocketRemoteAddress=m.connection.socket&&m.connection.socket.remoteAddress)),v}return C(t,h),t.prototype.onError=function(h,m){this._setStatus(void 0,h),m&&(this.duration=m)},t.prototype.onResponse=function(h,m){this._setStatus(h.statusCode,void 0),m&&(this.duration=m)},t.prototype.getRequestTelemetry=function(h){var m={id:this.requestId,name:this.method+" "+T.parse(this.url).pathname,url:this.url,source:this.sourceCorrelationId,duration:this.duration,resultCode:this.statusCode?this.statusCode.toString():null,success:this._isSuccess(),properties:this.properties};if(h&&h.time?m.time=h.time:this.startTime&&(m.time=new Date(this.startTime)),h){for(var y in h)m[y]||(m[y]=h[y]);if(h.properties)for(var y in h.properties)m.properties[y]=h.properties[y]}return m},t.prototype.getRequestTags=function(h){var m={};for(var y in h)m[y]=h[y];return m[t.keys.locationIp]=h[t.keys.locationIp]||this._getIp(),m[t.keys.sessionId]=h[t.keys.sessionId]||this._getId("ai_session"),m[t.keys.userId]=h[t.keys.userId]||this._getId("ai_user"),m[t.keys.userAuthUserId]=h[t.keys.userAuthUserId]||this._getId("ai_authUser"),m[t.keys.operationName]=this.getOperationName(h),m[t.keys.operationParentId]=this.getOperationParentId(h),m[t.keys.operationId]=this.getOperationId(h),m},t.prototype.getOperationId=function(h){return h[t.keys.operationId]||this.operationId},t.prototype.getOperationParentId=function(h){return h[t.keys.operationParentId]||this.parentId||this.getOperationId(h)},t.prototype.getOperationName=function(h){return h[t.keys.operationName]||this.method+" "+T.parse(this.url).pathname},t.prototype.getRequestId=function(){return this.requestId},t.prototype.getCorrelationContextHeader=function(){return this.correlationContextHeader},t.prototype.getTraceparent=function(){return this.traceparent},t.prototype.getTracestate=function(){return this.tracestate},t.prototype.getLegacyRootId=function(){return this.legacyRootId},t.prototype._getAbsoluteUrl=function(h){if(!h.headers)return h.url;var m=h.connection?h.connection.encrypted:null,y=T.parse(h.url),v=y.pathname,C=y.search,w=m||"https"==h.headers["x-forwarded-proto"]?"https":"http";return T.format({protocol:w,host:h.headers.host,pathname:v,search:C})},t.prototype._getIp=function(){var h=/[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}/,n=function(m){var y=h.exec(m);if(y)return y[0]},m=n(this.rawHeaders["x-forwarded-for"])||n(this.rawHeaders["x-client-ip"])||n(this.rawHeaders["x-real-ip"])||n(this.connectionRemoteAddress)||n(this.socketRemoteAddress)||n(this.legacySocketRemoteAddress);return!m&&this.connectionRemoteAddress&&this.connectionRemoteAddress.substr&&"::"===this.connectionRemoteAddress.substr(0,2)&&(m="127.0.0.1"),m},t.prototype._getId=function(h){var m=this.rawHeaders&&this.rawHeaders.cookie&&"string"==typeof this.rawHeaders.cookie&&this.rawHeaders.cookie||"";return t.parseId(A.getCookie(h,m))},t.prototype.setBackCompatFromThisTraceContext=function(){this.operationId=this.traceparent.traceId,this.traceparent.legacyRootId&&(this.legacyRootId=this.traceparent.legacyRootId),this.parentId=this.traceparent.parentId,this.traceparent.updateSpanId(),this.requestId=this.traceparent.getBackCompatRequestId()},t.prototype.parseHeaders=function(h,m){if(this.rawHeaders=h.headers||h.rawHeaders,this.userAgent=h.headers&&h.headers["user-agent"],this.sourceCorrelationId=A.getCorrelationContextTarget(h,P.requestContextSourceKey),h.headers){var y=h.headers[P.traceStateHeader]?h.headers[P.traceStateHeader].toString():null,v=h.headers[P.traceparentHeader]?h.headers[P.traceparentHeader].toString():null,C=h.headers[P.requestIdHeader]?h.headers[P.requestIdHeader].toString():null,T=h.headers[P.parentIdHeader]?h.headers[P.parentIdHeader].toString():null,w=h.headers[P.rootIdHeader]?h.headers[P.rootIdHeader].toString():null;this.correlationContextHeader=h.headers[P.correlationContextHeader]?h.headers[P.correlationContextHeader].toString():null,R.w3cEnabled&&(v||y)?(this.traceparent=new N(v?v.toString():null),this.tracestate=v&&y&&new M(y?y.toString():null),this.setBackCompatFromThisTraceContext()):C?R.w3cEnabled?(this.traceparent=new N(null,C),this.setBackCompatFromThisTraceContext()):(this.parentId=C,this.requestId=R.generateRequestId(this.parentId),this.operationId=R.getRootId(this.requestId)):R.w3cEnabled?(this.traceparent=new N,this.traceparent.parentId=T,this.traceparent.legacyRootId=w||T,this.setBackCompatFromThisTraceContext()):(this.parentId=T,this.requestId=R.generateRequestId(w||this.parentId),this.correlationContextHeader=null,this.operationId=R.getRootId(this.requestId)),m&&(this.requestId=m,this.operationId=R.getRootId(this.requestId))}},t.parseId=function(h){var m=h.split("|");return m.length>0?m[0]:""},t.keys=new w.ContextTagKeys,t}(k);m.exports=D}),Nr=l((h,m)=>{"use strict";function lu(h){return"function"==typeof h}var y=console.error.bind(console);function fi(h,m,y){var v=!!h[m]&&h.propertyIsEnumerable(m);Object.defineProperty(h,m,{configurable:!0,enumerable:v,writable:!0,value:y})}function hi(h){h&&h.logger&&(lu(h.logger)?y=h.logger:y("new logger isn't a function, not replacing"))}function Og(h,m,v){if(h&&h[m]){if(!v)return y("no wrapper function"),void y((new Error).stack);if(lu(h[m])&&lu(v)){var C=h[m],T=v(C,m);return fi(T,"__original",C),fi(T,"__unwrap",(function(){h[m]===T&&fi(h,m,C)})),fi(T,"__wrapped",!0),fi(h,m,T),T}y("original object and wrapper must be functions")}else y("no original function "+m+" to wrap")}function Rg(h,m){return h&&h[m]?h[m].__unwrap?h[m].__unwrap():void y("no original to unwrap to -- has "+m+" already been unwrapped?"):(y("no function to unwrap."),void y((new Error).stack))}hi.wrap=Og,hi.massWrap=function WP(h,m,v){if(!h)return y("must provide one or more modules to patch"),void y((new Error).stack);Array.isArray(h)||(h=[h]),m&&Array.isArray(m)?h.forEach((function(h){m.forEach((function(m){Og(h,m,v)}))})):y("must provide one or more functions to wrap on modules")},hi.unwrap=Rg,hi.massUnwrap=function ZP(h,m){if(!h)return y("must provide one or more modules to patch"),void y((new Error).stack);Array.isArray(h)||(h=[h]),m&&Array.isArray(m)?h.forEach((function(h){m.forEach((function(m){Rg(h,m)}))})):y("must provide one or more functions to unwrap on modules")},m.exports=hi}),Dr=l((h,m)=>{"use strict";var y=Nr(),v=y.wrap,C=y.unwrap,T="wrap@before";function Os(h,m,y){var v=!!h[m]&&h.propertyIsEnumerable(m);Object.defineProperty(h,m,{configurable:!0,enumerable:v,writable:!0,value:y})}function wg(h,m){var y;return y=h._events&&h._events[m],Array.isArray(y)||(y=y?[y]:[]),y}function eO(h,m,y){var v=wg(h,m).filter((function(h){return-1===y.indexOf(h)}));v.length>0&&function JP(h,m){for(var y=m.length,v=0;v<y;v++){var C=m[v],w=h[T];if("function"==typeof w)w(C);else if(Array.isArray(w))for(var A=w.length,P=0;P<A;P++)w[P](C)}}(h,v)}function Mg(h,m){if(h){var y=h;if("function"==typeof h)y=m(h);else if(Array.isArray(h)){y=[];for(var v=0;v<h.length;v++)y[v]=m(h[v])}return y}}m.exports=function(h,m,y){if(!(h&&h.on&&h.addListener&&h.removeListener&&h.emit))throw new Error("can only wrap real EEs");if(!m)throw new Error("must have function to run on listener addition");if(!y)throw new Error("must have function to wrap listeners when emitting");function i(h){return function(m,y){var C=wg(this,m).slice();try{var T=h.call(this,m,y);return eO(this,m,C),T}finally{this.on.__wrapped||v(this,"on",i),this.addListener.__wrapped||v(this,"addListener",i)}}}h[T]?"function"==typeof h[T]?Os(h,T,[h[T],m]):Array.isArray(h[T])&&h[T].push(m):Os(h,T,m),h.__wrapped||(v(h,"addListener",i),v(h,"on",i),v(h,"emit",(function a(h){return function(m){if(!this._events||!this._events[m])return h.apply(this,arguments);var T=this._events[m];function p(h){return function(){this._events[m]=T;try{return h.apply(this,arguments)}finally{T=this._events[m],this._events[m]=Mg(T,y)}}}v(this,"removeListener",p);try{return this._events[m]=Mg(T,y),h.apply(this,arguments)}finally{C(this,"removeListener"),this._events[m]=T}}})),Os(h,"__unwrap",(function(){C(h,"addListener"),C(h,"on"),C(h,"emit"),delete h[T],delete h.__wrapped})),Os(h,"__wrapped",!0))}}),Ir=l((h,m)=>{"use strict";var v=y(10),C=y(28),T=Dr(),w=y(893),A="cls@contexts",P="error@context",k=process.env.DEBUG_CLS_HOOKED,R=-1;function Me(h){this.name=h,this.active=null,this._set=[],this.id=null,this._contexts=new Map,this._indent=0}function Lg(h){return process.namespaces[h]}function qg(h){let m=Lg(h);C.ok(m,"can't delete nonexistent namespace! \""+h+'"'),C.ok(m.id,"don't assign to process.namespaces directly! "+v.inspect(m)),process.namespaces[h]=null}function j(...h){k&&process._rawDebug(`${v.format(...h)}`)}m.exports={getNamespace:Lg,createNamespace:function rO(h){C.ok(h,"namespace must be given a name."),k&&j(`NS-CREATING NAMESPACE (${h})`);let m=new Me(h);return m.id=R,w.createHook({init(y,C,T,A){if(R=w.executionAsyncId(),m.active){if(m._contexts.set(y,m.active),k){j(`${" ".repeat(m._indent<0?0:m._indent)}INIT [${C}] (${h}) asyncId:${y} currentUid:${R} triggerId:${T} active:${v.inspect(m.active,{showHidden:!0,depth:2,colors:!0})} resource:${A}`)}}else if(0===R){let T=w.triggerAsyncId(),P=m._contexts.get(T);if(P){if(m._contexts.set(y,P),k){j(`${" ".repeat(m._indent<0?0:m._indent)}INIT USING CONTEXT FROM TRIGGERID [${C}] (${h}) asyncId:${y} currentUid:${R} triggerId:${T} active:${v.inspect(m.active,{showHidden:!0,depth:2,colors:!0})} resource:${A}`)}}else if(k){j(`${" ".repeat(m._indent<0?0:m._indent)}INIT MISSING CONTEXT [${C}] (${h}) asyncId:${y} currentUid:${R} triggerId:${T} active:${v.inspect(m.active,{showHidden:!0,depth:2,colors:!0})} resource:${A}`)}}if(k&&"PROMISE"===C){j(v.inspect(A,{showHidden:!0}));let w=A.parentId;j(`${" ".repeat(m._indent<0?0:m._indent)}INIT RESOURCE-PROMISE [${C}] (${h}) parentId:${w} asyncId:${y} currentUid:${R} triggerId:${T} active:${v.inspect(m.active,{showHidden:!0,depth:2,colors:!0})} resource:${A}`)}},before(y){let C;if(R=w.executionAsyncId(),C=m._contexts.get(y)||m._contexts.get(R),C){if(k){let T=w.triggerAsyncId();j(`${" ".repeat(m._indent<0?0:m._indent)}BEFORE (${h}) asyncId:${y} currentUid:${R} triggerId:${T} active:${v.inspect(m.active,{showHidden:!0,depth:2,colors:!0})} context:${v.inspect(C)}`),m._indent+=2}m.enter(C)}else if(k){let C=w.triggerAsyncId();j(`${" ".repeat(m._indent<0?0:m._indent)}BEFORE MISSING CONTEXT (${h}) asyncId:${y} currentUid:${R} triggerId:${C} active:${v.inspect(m.active,{showHidden:!0,depth:2,colors:!0})} namespace._contexts:${v.inspect(m._contexts,{showHidden:!0,depth:2,colors:!0})}`),m._indent+=2}},after(y){let C;if(R=w.executionAsyncId(),C=m._contexts.get(y)||m._contexts.get(R),C){if(k){let T=w.triggerAsyncId();m._indent-=2,j(`${" ".repeat(m._indent<0?0:m._indent)}AFTER (${h}) asyncId:${y} currentUid:${R} triggerId:${T} active:${v.inspect(m.active,{showHidden:!0,depth:2,colors:!0})} context:${v.inspect(C)}`)}m.exit(C)}else if(k){let T=w.triggerAsyncId();m._indent-=2,j(`${" ".repeat(m._indent<0?0:m._indent)}AFTER MISSING CONTEXT (${h}) asyncId:${y} currentUid:${R} triggerId:${T} active:${v.inspect(m.active,{showHidden:!0,depth:2,colors:!0})} context:${v.inspect(C)}`)}},destroy(y){if(R=w.executionAsyncId(),k){let C=w.triggerAsyncId();j(`${" ".repeat(m._indent<0?0:m._indent)}DESTROY (${h}) currentUid:${R} asyncId:${y} triggerId:${C} active:${v.inspect(m.active,{showHidden:!0,depth:2,colors:!0})} context:${v.inspect(m._contexts.get(R))}`)}m._contexts.delete(y)}}).enable(),process.namespaces[h]=m,m},destroyNamespace:qg,reset:function nO(){process.namespaces&&Object.keys(process.namespaces).forEach((function(h){qg(h)})),process.namespaces=Object.create(null)},ERROR_SYMBOL:P},Me.prototype.set=function(h,m){if(!this.active)throw new Error("No context available. ns.run() or ns.bind() must be called first.");if(this.active[h]=m,k){j(" ".repeat(this._indent<0?0:this._indent)+"CONTEXT-SET KEY:"+h+"="+m+" in ns:"+this.name+" currentUid:"+R+" active:"+v.inspect(this.active,{showHidden:!0,depth:2,colors:!0}))}return m},Me.prototype.get=function(h){if(this.active){if(k){let m=w.executionAsyncId(),y=w.triggerAsyncId(),C=" ".repeat(this._indent<0?0:this._indent);j(C+"CONTEXT-GETTING KEY:"+h+"="+this.active[h]+" ("+this.name+") currentUid:"+R+" active:"+v.inspect(this.active,{showHidden:!0,depth:2,colors:!0})),j(`${C}CONTEXT-GETTING KEY: (${this.name}) ${h}=${this.active[h]} currentUid:${R} asyncHooksCurrentId:${m} triggerId:${y} len:${this._set.length} active:${v.inspect(this.active)}`)}return this.active[h]}if(k){let m=w.currentId(),y=w.triggerAsyncId();j(`${" ".repeat(this._indent<0?0:this._indent)}CONTEXT-GETTING KEY NO ACTIVE NS: (${this.name}) ${h}=undefined currentUid:${R} asyncHooksCurrentId:${m} triggerId:${y} len:${this._set.length}`)}},Me.prototype.createContext=function(){let h=Object.create(this.active?this.active:Object.prototype);if(h._ns_name=this.name,h.id=R,k){let m=w.executionAsyncId(),y=w.triggerAsyncId();j(`${" ".repeat(this._indent<0?0:this._indent)}CONTEXT-CREATED Context: (${this.name}) currentUid:${R} asyncHooksCurrentId:${m} triggerId:${y} len:${this._set.length} context:${v.inspect(h,{showHidden:!0,depth:2,colors:!0})}`)}return h},Me.prototype.run=function(h){let m=this.createContext();this.enter(m);try{if(k){let h=w.triggerAsyncId(),y=w.executionAsyncId();j(`${" ".repeat(this._indent<0?0:this._indent)}CONTEXT-RUN BEGIN: (${this.name}) currentUid:${R} triggerId:${h} asyncHooksCurrentId:${y} len:${this._set.length} context:${v.inspect(m)}`)}return h(m),m}catch(h){throw h&&(h[P]=m),h}finally{if(k){let h=w.triggerAsyncId(),y=w.executionAsyncId();j(`${" ".repeat(this._indent<0?0:this._indent)}CONTEXT-RUN END: (${this.name}) currentUid:${R} triggerId:${h} asyncHooksCurrentId:${y} len:${this._set.length} ${v.inspect(m)}`)}this.exit(m)}},Me.prototype.runAndReturn=function(h){let m;return this.run((function(y){m=h(y)})),m},Me.prototype.runPromise=function(h){let m=this.createContext();this.enter(m);let y=h(m);if(!y||!y.then||!y.catch)throw new Error("fn must return a promise.");return k&&j("CONTEXT-runPromise BEFORE: ("+this.name+") currentUid:"+R+" len:"+this._set.length+" "+v.inspect(m)),y.then(h=>(k&&j("CONTEXT-runPromise AFTER then: ("+this.name+") currentUid:"+R+" len:"+this._set.length+" "+v.inspect(m)),this.exit(m),h)).catch(h=>{throw h[P]=m,k&&j("CONTEXT-runPromise AFTER catch: ("+this.name+") currentUid:"+R+" len:"+this._set.length+" "+v.inspect(m)),this.exit(m),h})},Me.prototype.bind=function(h,m){m||(m=this.active?this.active:this.createContext());let y=this;return function(){y.enter(m);try{return h.apply(this,arguments)}catch(h){throw h&&(h[P]=m),h}finally{y.exit(m)}}},Me.prototype.enter=function(h){if(C.ok(h,"context must be provided for entering"),k){let m=w.executionAsyncId(),y=w.triggerAsyncId();j(`${" ".repeat(this._indent<0?0:this._indent)}CONTEXT-ENTER: (${this.name}) currentUid:${R} triggerId:${y} asyncHooksCurrentId:${m} len:${this._set.length} ${v.inspect(h)}`)}this._set.push(this.active),this.active=h},Me.prototype.exit=function(h){if(C.ok(h,"context must be provided for exiting"),k){let m=w.executionAsyncId(),y=w.triggerAsyncId();j(`${" ".repeat(this._indent<0?0:this._indent)}CONTEXT-EXIT: (${this.name}) currentUid:${R} triggerId:${y} asyncHooksCurrentId:${m} len:${this._set.length} ${v.inspect(h)}`)}if(this.active===h)return C.ok(this._set.length,"can't remove top context"),void(this.active=this._set.pop());let m=this._set.lastIndexOf(h);m<0?(k&&j("??ERROR?? context exiting but not entered - ignoring: "+v.inspect(h)),C.ok(m>=0,"context not currently entered; can't exit. \n"+v.inspect(this)+"\n"+v.inspect(h))):(C.ok(m,"can't remove top context"),this._set.splice(m,1))},Me.prototype.bindEmitter=function(h){C.ok(h.on&&h.addListener&&h.emit,"can only bind real EEs");let m=this,y="context@"+this.name;T(h,(function i(h){!h||(h[A]||(h[A]=Object.create(null)),h[A][y]={namespace:m,context:m.active})}),(function a(h){if(!h||!h[A])return h;let m=h,y=h[A];return Object.keys(y).forEach((function(h){let v=y[h];m=v.namespace.bind(m,v.context)})),m}))},Me.prototype.fromException=function(h){return h[P]},process.namespaces={}}),xr=l((h,m)=>{"use strict";function iO(){}m.exports=function(){let h=this._hooks,m=this._state,y=process.nextTick;process.nextTick=function(){if(!m.enabled)return y.apply(process,arguments);let v=new Array(arguments.length);for(let h=0;h<arguments.length;h++)v[h]=arguments[h];let C=v[0];if("function"!=typeof C)throw new TypeError("callback is not a function");let T=new iO,w=--m.counter;return h.init.call(T,w,0,null,null),v[0]=function(){h.pre.call(T,w);let m=!0;try{C.apply(this,arguments),m=!1}finally{m&&process.listenerCount("uncaughtException")>0&&process.once("uncaughtException",(function(){h.post.call(T,w,!0),h.destroy.call(null,w)}))}h.post.call(T,w,!1),h.destroy.call(null,w)},y.apply(process,v)}}}),Or=l((h,m)=>{"use strict";function aO(){}m.exports=function(){let h=this._hooks,m=this._state,y=global.Promise,v=y.prototype.then;function a(m,y,v,C){return"function"!=typeof m?C?function s(m){return function(y){return h.destroy.call(null,m),y}}(v):function o(m){return function(y){throw h.destroy.call(null,m),y}}(v):function(){h.pre.call(y,v);try{return m.apply(this,arguments)}finally{h.post.call(y,v,!1),h.destroy.call(null,v)}}}y.prototype.then=function c(y,C){if(!m.enabled)return v.call(this,y,C);let T=new aO,w=--m.counter;return h.init.call(T,w,0,null,null),v.call(this,a(y,T,w,!0),a(C,T,w,!1))}}}),Fr=l((h,m)=>{"use strict";var v=y(159);function sO(){}function oO(){}function cO(){}var C=new Map,T=new Map,w=new Map,A=null,P=!1;function fu(h,m,y,C,T,w,k){let R=v[y],M=v[C];v[y]=function(){if(!m.enabled)return R.apply(v,arguments);let y=new Array(arguments.length);for(let h=0;h<arguments.length;h++)y[h]=arguments[h];let C=y[0];if("function"!=typeof C)throw new TypeError('"callback" argument must be a function');let M,N=new T,D=--m.counter;return h.init.call(N,D,0,null,null),y[0]=function(){A=M,h.pre.call(N,D);let m=!0;try{C.apply(this,arguments),m=!1}finally{m&&process.listenerCount("uncaughtException")>0&&process.once("uncaughtException",(function(){h.post.call(N,D,!0),w.delete(M),h.destroy.call(null,D)}))}h.post.call(N,D,!1),A=null,(k||P)&&(P=!1,w.delete(M),h.destroy.call(null,D))},M=R.apply(v,y),w.set(M,D),M},v[C]=function(m){if(A===m&&null!==m)P=!0;else if(w.has(m)){let y=w.get(m);w.delete(m),h.destroy.call(null,y)}M.apply(v,arguments)}}m.exports=function(){fu(this._hooks,this._state,"setTimeout","clearTimeout",sO,C,!0),fu(this._hooks,this._state,"setInterval","clearInterval",oO,T,!1),fu(this._hooks,this._state,"setImmediate","clearImmediate",cO,w,!0),global.setTimeout=v.setTimeout,global.setInterval=v.setInterval,global.setImmediate=v.setImmediate,global.clearTimeout=v.clearTimeout,global.clearInterval=v.clearInterval,global.clearImmediate=v.clearImmediate}}),Ur=l((h,m)=>{m.exports={_args:[["async-hook-jl@1.7.6","/home/runner/work/vscode-extension-telemetry/vscode-extension-telemetry"]],_development:!0,_from:"async-hook-jl@1.7.6",_id:"async-hook-jl@1.7.6",_inBundle:!1,_integrity:"sha512-gFaHkFfSxTjvoxDMYqDuGHlcRyUuamF8s+ZTtJdDzqjws4mCt7v0vuV79/E2Wr2/riMQgtG4/yUtXWs1gZ7JMg==",_location:"/async-hook-jl",_phantomChildren:{},_requested:{type:"version",registry:!0,raw:"async-hook-jl@1.7.6",name:"async-hook-jl",escapedName:"async-hook-jl",rawSpec:"1.7.6",saveSpec:null,fetchSpec:"1.7.6"},_requiredBy:["/cls-hooked"],_resolved:"https://registry.npmjs.org/async-hook-jl/-/async-hook-jl-1.7.6.tgz",_spec:"1.7.6",_where:"/home/runner/work/vscode-extension-telemetry/vscode-extension-telemetry",author:{name:"Andreas Madsen",email:"amwebdk@gmail.com"},bugs:{url:"https://github.com/jeff-lewis/async-hook-jl/issues"},dependencies:{"stack-chain":"^1.3.7"},description:"Inspect the life of handle objects in node",devDependencies:{async:"1.5.x","cli-color":"1.1.x",endpoint:"0.4.x",eslint:"^3.4.0"},engines:{node:"^4.7 || >=6.9 || >=7.3"},homepage:"https://github.com/jeff-lewis/async-hook-jl#readme",keywords:["async","async hooks","inspect","async wrap"],license:"MIT",main:"./index.js",name:"async-hook-jl",repository:{type:"git",url:"git://github.com/jeff-lewis/async-hook-jl.git"},scripts:{test:"node ./test/runner.js && eslint ."},version:"1.7.6"}}),jr=l((h,m)=>{"use strict";var y=process.binding("async_wrap"),v=y.Providers.TIMERWRAP,C={nextTick:xr(),promise:Or(),timers:Fr()},T=new Set;function hO(){this.enabled=!1,this.counter=0}function _u(){let h=this.initFns=[],m=this.preFns=[],y=this.postFns=[],C=this.destroyFns=[];this.init=function(m,y,C,w){if(y!==v)for(let v of h)v(m,this,y,C,w);else T.add(m)},this.pre=function(h){if(!T.has(h))for(let y of m)y(h,this)},this.post=function(h,m){if(!T.has(h))for(let v of y)v(h,this,m)},this.destroy=function(h){if(T.has(h))T.delete(h);else for(let m of C)m(h)}}function Ns(h,m){let y=h.indexOf(m);-1!==y&&h.splice(y,1)}function Ei(){this._state=new hO,this._hooks=new _u,this.version=Ur().version,this.providers=y.Providers;for(let h of Object.keys(C))C[h].call(this);process.env.hasOwnProperty("NODE_ASYNC_HOOK_WARNING")&&console.warn("warning: you are using async-hook-jl which is unstable."),y.setupHooks({init:this._hooks.init,pre:this._hooks.pre,post:this._hooks.post,destroy:this._hooks.destroy})}_u.prototype.add=function(h){h.init&&this.initFns.push(h.init),h.pre&&this.preFns.push(h.pre),h.post&&this.postFns.push(h.post),h.destroy&&this.destroyFns.push(h.destroy)},_u.prototype.remove=function(h){h.init&&Ns(this.initFns,h.init),h.pre&&Ns(this.preFns,h.pre),h.post&&Ns(this.postFns,h.post),h.destroy&&Ns(this.destroyFns,h.destroy)},m.exports=Ei,Ei.prototype.addHooks=function(h){this._hooks.add(h)},Ei.prototype.removeHooks=function(h){this._hooks.remove(h)},Ei.prototype.enable=function(){this._state.enabled=!0,y.enable()},Ei.prototype.disable=function(){this._state.enabled=!1,y.disable()}}),Br=l((h,m)=>{m.exports={_args:[["stack-chain@1.3.7","/home/runner/work/vscode-extension-telemetry/vscode-extension-telemetry"]],_development:!0,_from:"stack-chain@1.3.7",_id:"stack-chain@1.3.7",_inBundle:!1,_integrity:"sha1-0ZLJ/06moiyUxN1FkXHj8AzqEoU=",_location:"/stack-chain",_phantomChildren:{},_requested:{type:"version",registry:!0,raw:"stack-chain@1.3.7",name:"stack-chain",escapedName:"stack-chain",rawSpec:"1.3.7",saveSpec:null,fetchSpec:"1.3.7"},_requiredBy:["/async-hook-jl"],_resolved:"https://registry.npmjs.org/stack-chain/-/stack-chain-1.3.7.tgz",_spec:"1.3.7",_where:"/home/runner/work/vscode-extension-telemetry/vscode-extension-telemetry",author:{name:"Andreas Madsen",email:"amwebdk@gmail.com"},bugs:{url:"https://github.com/AndreasMadsen/stack-chain/issues"},description:"API for combining call site modifiers",devDependencies:{tap:"2.x.x","uglify-js":"2.5.x"},homepage:"https://github.com/AndreasMadsen/stack-chain#readme",keywords:["stack","chain","trace","call site","concat","format"],license:"MIT",name:"stack-chain",repository:{type:"git",url:"git://github.com/AndreasMadsen/stack-chain.git"},scripts:{test:"tap ./test/simple"},version:"1.3.7"}}),Hr=l((h,m)=>{m.exports=function(h,m){var y=[];y.push(function gO(h){try{return Error.prototype.toString.call(h)}catch(h){try{return"<error: "+h+">"}catch(h){return"<error>"}}}(h));for(var v=0;v<m.length;v++){var C,T=m[v];try{C=T.toString()}catch(h){try{C="<error: "+h+">"}catch(h){C="<error>"}}y.push("    at "+C)}return y.join("\n")}}),Wr=l((h,m)=>{var y=Hr();function Qg(){this.extend=new yi,this.filter=new yi,this.format=new Ti,this.version=Br().version}var v=!1;Qg.prototype.callSite=function e(h){h||(h={}),v=!0;var m={};Error.captureStackTrace(m,e);var y=m.stack;return v=!1,y=y.slice(h.slice||0),h.extend&&(y=this.extend._modify(m,y)),h.filter&&(y=this.filter._modify(m,y)),y};var C=new Qg;function yi(){this._modifiers=[]}function Ti(){this._formater=y,this._previous=void 0}yi.prototype._modify=function(h,m){for(var y=0,v=this._modifiers.length;y<v;y++)m=this._modifiers[y](h,m);return m},yi.prototype.attach=function(h){this._modifiers.push(h)},yi.prototype.deattach=function(h){var m=this._modifiers.indexOf(h);return-1!==m&&(this._modifiers.splice(m,1),!0)},Ti.prototype.replace=function(h){h?this._formater=h:this.restore()},Ti.prototype.restore=function(){this._formater=y,this._previous=void 0},Ti.prototype._backup=function(){this._previous=this._formater},Ti.prototype._roolback=function(){this._previous===y?this.replace(void 0):this.replace(this._previous),this._previous=void 0},Error.prepareStackTrace&&C.format.replace(Error.prepareStackTrace);var T=!1;function Wg(h,m){if(v)return m;if(T)return y(h,m);var w=m.concat();w=C.extend._modify(h,w),w=(w=C.filter._modify(h,w)).slice(0,Error.stackTraceLimit),Object.isExtensible(h)&&void 0===Object.getOwnPropertyDescriptor(h,"callSite")&&(h.callSite={original:m,mutated:w}),T=!0;var A=C.format._formater(h,w);return T=!1,A}Object.defineProperty(Error,"prepareStackTrace",{get:function(){return Wg},set:function(h){h===Wg?C.format._roolback():(C.format._backup(),C.format.replace(h))}}),Object.defineProperty(Error.prototype,"callSite",{get:function vO(){return this.stack,this.callSite},set:function(h){Object.defineProperty(this,"callSite",{value:h,writable:!0,configurable:!0})},configurable:!0}),m.exports=C}),qr=l((h,m)=>{if(global._stackChain){if(global._stackChain.version!==Br().version)throw new Error("Conflicting version of stack-chain found");m.exports=global._stackChain}else m.exports=global._stackChain=Wr()}),Yr=l((h,m)=>{"use strict";var y=jr();if(global._asyncHook){if(global._asyncHook.version!==Ur().version)throw new Error("Conflicting version of async-hook-jl found");m.exports=global._asyncHook}else qr().filter.attach((function(h,m){return m.filter((function(h){let m=h.getFileName();return!(m&&m.slice(0,__dirname.length)===__dirname)}))})),m.exports=global._asyncHook=new y}),Vr=l((h,m)=>{"use strict";var v=y(10),C=y(28),T=Dr(),w=Yr(),A="cls@contexts",P="error@context",k=[];for(let h in w.providers)k[w.providers[h]]=h;var R,M,N=process.env.DEBUG_CLS_HOOKED,D=-1;function xe(h){this.name=h,this.active=null,this._set=[],this.id=null,this._contexts=new Map}function rv(h){return process.namespaces[h]}function nv(h){let m=rv(h);C.ok(m,"can't delete nonexistent namespace! \""+h+'"'),C.ok(m.id,"don't assign to process.namespaces directly! "+v.inspect(m)),process.namespaces[h]=null}function Q(h){process.env.DEBUG&&process._rawDebug(h)}function ws(h){return h?"function"==typeof h?h.name?h.name:(h.toString().trim().match(/^function\s*([^\s(]+)/)||[])[1]:h.constructor&&h.constructor.name?h.constructor.name:void 0:h}if(m.exports={getNamespace:rv,createNamespace:function yO(h){C.ok(h,"namespace must be given a name."),N&&Q("CREATING NAMESPACE "+h);let m=new xe(h);return m.id=D,w.addHooks({init(y,C,T,w,A){D=y,w?(m._contexts.set(y,m._contexts.get(w)),N&&Q("PARENTID: "+h+" uid:"+y+" parent:"+w+" provider:"+T)):m._contexts.set(D,m.active),N&&Q("INIT "+h+" uid:"+y+" parent:"+w+" provider:"+k[T]+" active:"+v.inspect(m.active,!0))},pre(y,C){D=y;let T=m._contexts.get(y);T?(N&&Q(" PRE "+h+" uid:"+y+" handle:"+ws(C)+" context:"+v.inspect(T)),m.enter(T)):N&&Q(" PRE MISSING CONTEXT "+h+" uid:"+y+" handle:"+ws(C))},post(y,C){D=y;let T=m._contexts.get(y);T?(N&&Q(" POST "+h+" uid:"+y+" handle:"+ws(C)+" context:"+v.inspect(T)),m.exit(T)):N&&Q(" POST MISSING CONTEXT "+h+" uid:"+y+" handle:"+ws(C))},destroy(y){D=y,N&&Q("DESTROY "+h+" uid:"+y+" context:"+v.inspect(m._contexts.get(D))+" active:"+v.inspect(m.active,!0)),m._contexts.delete(y)}}),process.namespaces[h]=m,m},destroyNamespace:nv,reset:function TO(){process.namespaces&&Object.keys(process.namespaces).forEach((function(h){nv(h)})),process.namespaces=Object.create(null)},ERROR_SYMBOL:P},xe.prototype.set=function(h,m){if(!this.active)throw new Error("No context available. ns.run() or ns.bind() must be called first.");return N&&Q("    SETTING KEY:"+h+"="+m+" in ns:"+this.name+" uid:"+D+" active:"+v.inspect(this.active,!0)),this.active[h]=m,m},xe.prototype.get=function(h){if(this.active)return N&&Q("    GETTING KEY:"+h+"="+this.active[h]+" "+this.name+" uid:"+D+" active:"+v.inspect(this.active,!0)),this.active[h];N&&Q("    GETTING KEY:"+h+"=undefined "+this.name+" uid:"+D+" active:"+v.inspect(this.active,!0))},xe.prototype.createContext=function(){N&&Q("   CREATING Context: "+this.name+" uid:"+D+" len:"+this._set.length+"  active:"+v.inspect(this.active,!0,2,!0));let h=Object.create(this.active?this.active:Object.prototype);return h._ns_name=this.name,h.id=D,N&&Q("   CREATED Context: "+this.name+" uid:"+D+" len:"+this._set.length+"  context:"+v.inspect(h,!0,2,!0)),h},xe.prototype.run=function(h){let m=this.createContext();this.enter(m);try{return N&&Q(" BEFORE RUN: "+this.name+" uid:"+D+" len:"+this._set.length+" "+v.inspect(m)),h(m),m}catch(h){throw h&&(h[P]=m),h}finally{N&&Q(" AFTER RUN: "+this.name+" uid:"+D+" len:"+this._set.length+" "+v.inspect(m)),this.exit(m)}},xe.prototype.runAndReturn=function(h){var m;return this.run((function(y){m=h(y)})),m},xe.prototype.runPromise=function(h){let m=this.createContext();this.enter(m);let y=h(m);if(!y||!y.then||!y.catch)throw new Error("fn must return a promise.");return N&&Q(" BEFORE runPromise: "+this.name+" uid:"+D+" len:"+this._set.length+" "+v.inspect(m)),y.then(h=>(N&&Q(" AFTER runPromise: "+this.name+" uid:"+D+" len:"+this._set.length+" "+v.inspect(m)),this.exit(m),h)).catch(h=>{throw h[P]=m,N&&Q(" AFTER runPromise: "+this.name+" uid:"+D+" len:"+this._set.length+" "+v.inspect(m)),this.exit(m),h})},xe.prototype.bind=function(h,m){m||(m=this.active?this.active:this.createContext());let y=this;return function(){y.enter(m);try{return h.apply(this,arguments)}catch(h){throw h&&(h[P]=m),h}finally{y.exit(m)}}},xe.prototype.enter=function(h){C.ok(h,"context must be provided for entering"),N&&Q("  ENTER "+this.name+" uid:"+D+" len:"+this._set.length+" context: "+v.inspect(h)),this._set.push(this.active),this.active=h},xe.prototype.exit=function(h){if(C.ok(h,"context must be provided for exiting"),N&&Q("  EXIT "+this.name+" uid:"+D+" len:"+this._set.length+" context: "+v.inspect(h)),this.active===h)return C.ok(this._set.length,"can't remove top context"),void(this.active=this._set.pop());let m=this._set.lastIndexOf(h);m<0?(N&&Q("??ERROR?? context exiting but not entered - ignoring: "+v.inspect(h)),C.ok(m>=0,"context not currently entered; can't exit. \n"+v.inspect(this)+"\n"+v.inspect(h))):(C.ok(m,"can't remove top context"),this._set.splice(m,1))},xe.prototype.bindEmitter=function(h){C.ok(h.on&&h.addListener&&h.emit,"can only bind real EEs");let m=this,y="context@"+this.name;T(h,(function i(h){!h||(h[A]||(h[A]=Object.create(null)),h[A][y]={namespace:m,context:m.active})}),(function a(h){if(!h||!h[A])return h;let m=h,y=h[A];return Object.keys(y).forEach((function(h){let v=y[h];m=v.namespace.bind(m,v.context)})),m}))},xe.prototype.fromException=function(h){return h[P]},process.namespaces={},w._state&&!w._state.enabled&&w.enable(),N)for(M in(R=qr()).filter._modifiers)R.filter.deattach(M)}),$r=l((h,m)=>{"use strict";var y=D();process&&y.gte(process.versions.node,"8.0.0")?m.exports=Ir():m.exports=Vr()}),Kr=l((h,m)=>{var y,v,C,T,w,A=Nr().wrap,P=[],k=0,R=!1,M=[];function Ou(h,m){var y=h.length,v=m.length,C=[];if(0===y&&0===v)return C;for(var T=0;T<y;T++)C[T]=h[T];if(0===v)return C;for(var w=0;w<v;w++){var A=!0;for(T=0;T<y;T++)if(h[T].uid===m[w].uid){A=!1;break}A&&C.push(m[w])}return C}function We(h,m){"function"==typeof h.create&&(this.create=h.create,this.flags|=1),"function"==typeof h.before&&(this.before=h.before,this.flags|=2),"function"==typeof h.after&&(this.after=h.after,this.flags|=4),"function"==typeof h.error&&(this.error=h.error,this.flags|=8),this.uid=++k,this.data=void 0===m?null:m}function cv(h,m){if("object"!=typeof h||!h)throw new TypeError("callbacks argument must be an object");return h instanceof We?h:new We(h,m)}process._fatalException?(C=!1,y=function(h){var m=P.length;if(C||0===m)return!1;var y=!1;C=!0;for(var v=0;v<m;++v){var w=P[v];if(0!=(8&w.flags)){var A=T&&T[w.uid];y=w.error(A,h)||y}}return C=!1,M.length>0&&(P=M.pop()),T=void 0,y&&!R},v=function(h,m,y){var v=[];R=!0;for(var C=0;C<y;++C){var w=m[C];if(v[w.uid]=w.data,0!=(1&w.flags)){var A=w.create(w.data);void 0!==A&&(v[w.uid]=A)}}return R=!1,function(){T=v,M.push(P),P=Ou(m,P),R=!0;for(var C=0;C<y;++C)(2&m[C].flags)>0&&m[C].before(this,v[m[C].uid]);R=!1;var w=h.apply(this,arguments);for(R=!0,C=0;C<y;++C)(4&m[C].flags)>0&&m[C].after(this,v[m[C].uid]);return R=!1,P=M.pop(),T=void 0,w}},A(process,"_fatalException",(function(h){return function(m){return y(m)||h(m)}}))):(w=!1,y=function(h){if(w)throw h;for(var m=!1,y=P.length,v=0;v<y;++v){var C=P[v];0!=(8&C.flags)&&(m=C.error(null,h)||m)}if(!m&&R)throw h},v=function(h,m,v){var C=[];R=!0;for(var T=0;T<v;++T){var A=m[T];if(C[A.uid]=A.data,0!=(1&A.flags)){var k=A.create(A.data);void 0!==k&&(C[A.uid]=k)}}return R=!1,function(){var T,A=!1,k=!1;M.push(P),P=Ou(m,P),R=!0;for(var N=0;N<v;++N)(2&m[N].flags)>0&&m[N].before(this,C[m[N].uid]);R=!1;try{T=h.apply(this,arguments)}catch(h){A=!0;for(N=0;N<v;++N)if(0!=(8&P[N].flags))try{k=P[N].error(C[m[N].uid],h)||k}catch(h){throw w=!0,h}if(!k)throw process.removeListener("uncaughtException",y),process._originalNextTick((function(){process.addListener("uncaughtException",y)})),h}finally{if(!A||k){for(R=!0,N=0;N<v;++N)(4&m[N].flags)>0&&m[N].after(this,C[m[N].uid]);R=!1}P=M.pop()}return T}},process.addListener("uncaughtException",y)),We.prototype.create=void 0,We.prototype.before=void 0,We.prototype.after=void 0,We.prototype.error=void 0,We.prototype.data=void 0,We.prototype.uid=0,We.prototype.flags=0,process.createAsyncListener=cv,process.addAsyncListener=function PO(h,m){var y;y=h instanceof We?h:cv(h,m);for(var v=!1,C=0;C<P.length;C++)if(y===P[C]){v=!0;break}return v||P.push(y),y},process.removeAsyncListener=function OO(h){for(var m=0;m<P.length;m++)if(h===P[m]){P.splice(m,1);break}},m.exports=function CO(h){var m=P.length;if(0===m)return h;for(var y=P.slice(),C=0;C<m;++C)if(y[C].flags>0)return v(h,y,m);return function IO(h,m,y){R=!0;for(var v=0;v<y;++v){var C=m[v];C.create&&C.create(C.data)}return R=!1,function(){M.push(P),P=Ou(m,P);var y=h.apply(this,arguments);return P=M.pop(),y}}(h,y,m)}}),zr=l((h,m)=>{"use strict";m.exports=(h,m)=>class extends h{constructor(h){var y,v;super((function o(h,T){y=this,v=[function p(y){return m(C,!1),h(y)},function d(h){return m(C,!1),T(h)}]}));var C=this;try{h.apply(y,v)}catch(h){v[1](h)}return C}}}),Gr=l(()=>{"use strict";if(process.addAsyncListener)throw new Error("Don't require polyfill unless needed");var h=Nr(),m=D(),v=h.wrap,C=h.massWrap,T=Kr(),w=y(10),A=m.gte(process.version,"6.0.0"),P=m.gte(process.version,"7.0.0"),k=m.gte(process.version,"8.0.0"),R=m.gte(process.version,"11.0.0"),M=y(31);function hv(h){return function(){this.on("connection",(function(h){h._handle&&(h._handle.onread=T(h._handle.onread))}));try{return h.apply(this,arguments)}finally{this._handle&&this._handle.onconnection&&(this._handle.onconnection=T(this._handle.onconnection))}}}function _v(h){if(h&&h._handle){var m=h._handle;m._originalOnread||(m._originalOnread=m.onread),m.onread=T(m._originalOnread)}}P&&!M._normalizeArgs?M._normalizeArgs=function(h){if(0===h.length)return[{},null];var m=h[0],y={};"object"==typeof m&&null!==m?y=m:function kO(h){return"string"==typeof h&&!1===function qO(h){return(h=Number(h))>=0&&h}(h)}(m)?y.path=m:(y.port=m,h.length>1&&"string"==typeof h[1]&&(y.host=h[1]));var v=h[h.length-1];return"function"!=typeof v?[y,null]:[y,v]}:!P&&!M._normalizeConnectArgs&&(M._normalizeConnectArgs=function(h){var m={};"object"==typeof h[0]&&null!==h[0]?m=h[0]:"string"==typeof h[0]&&!1===function r(h){return(h=Number(h))>=0&&h}(h[0])?m.path=h[0]:(m.port=h[0],"string"==typeof h[1]&&(m.host=h[1]));var y=h[h.length-1];return"function"==typeof y?[m,y]:[m]}),"_setUpListenHandle"in M.Server.prototype?v(M.Server.prototype,"_setUpListenHandle",hv):v(M.Server.prototype,"_listen2",hv),v(M.Socket.prototype,"connect",(function(h){return function(){var m;(m=k&&Array.isArray(arguments[0])&&Object.getOwnPropertySymbols(arguments[0]).length>0?arguments[0]:P?M._normalizeArgs(arguments):M._normalizeConnectArgs(arguments))[1]&&(m[1]=T(m[1]));var y=h.apply(this,m);return _v(this),y}}));var N=y(52);v(N.Agent.prototype,"addRequest",(function(h){return function(m){var y=m.onSocket;return m.onSocket=T((function(h){return _v(h),y.apply(this,arguments)})),h.apply(this,arguments)}}));var I=y(41);function gv(h){Array.isArray(h.stdio)&&h.stdio.forEach((function(h){h&&h._handle&&(h._handle.onread=T(h._handle.onread),v(h._handle,"close",ks))})),h._handle&&(h._handle.onexit=T(h._handle.onexit))}I.ChildProcess?v(I.ChildProcess.prototype,"spawn",(function(h){return function(){var m=h.apply(this,arguments);return gv(this),m}})):C(I,["execFile","fork","spawn"],(function(h){return function(){var m=h.apply(this,arguments);return gv(m),m}})),process._fatalException||(process._originalNextTick=process.nextTick);var x=[];process._nextDomainTick&&x.push("_nextDomainTick"),process._tickDomainCallback&&x.push("_tickDomainCallback"),C(process,x,Je),v(process,"nextTick",ks);var O=["setTimeout","setInterval"];global.setImmediate&&O.push("setImmediate");var L=y(159),U=global.setTimeout===L.setTimeout;C(L,O,ks),U&&C(global,O,ks);var B=y(894);C(B,["lookup","resolve","resolve4","resolve6","resolveCname","resolveMx","resolveNs","resolveTxt","resolveSrv","reverse"],Je),B.resolveNaptr&&v(B,"resolveNaptr",Je);var W,q,Y,V=y(21);C(V,["watch","rename","truncate","chown","fchown","chmod","fchmod","stat","lstat","fstat","link","symlink","readlink","realpath","unlink","rmdir","mkdir","readdir","close","open","utimes","futimes","fsync","write","read","readFile","writeFile","appendFile","watchFile","unwatchFile","exists"],Je),V.lchown&&v(V,"lchown",Je),V.lchmod&&v(V,"lchmod",Je),V.ftruncate&&v(V,"ftruncate",Je);try{W=y(47)}catch(h){}W&&W.Deflate&&W.Deflate.prototype&&((q=Object.getPrototypeOf(W.Deflate.prototype))._transform?v(q,"_transform",Je):q.write&&q.flush&&q.end&&C(q,["write","flush","end"],Je));try{Y=y(11)}catch(h){}Y&&($=["pbkdf2","randomBytes"],R||$.push("pseudoRandomBytes"),C(Y,$,Je));var $,z,G=!!global.Promise&&"function Promise() { [native code] }"===Promise.toString()&&"function toString() { [native code] }"===Promise.toString.toString();function Je(h){var t=function(){var m,y=arguments.length-1;if("function"==typeof arguments[y]){m=Array(arguments.length);for(var v=0;v<arguments.length-1;v++)m[v]=arguments[v];m[y]=T(arguments[y])}return h.apply(this,m||arguments)};switch(h.length){case 1:return function(m){return 1!==arguments.length?t.apply(this,arguments):("function"==typeof m&&(m=T(m)),h.call(this,m))};case 2:return function(m,y){return 2!==arguments.length?t.apply(this,arguments):("function"==typeof y&&(y=T(y)),h.call(this,m,y))};case 3:return function(m,y,v){return 3!==arguments.length?t.apply(this,arguments):("function"==typeof v&&(v=T(v)),h.call(this,m,y,v))};case 4:return function(m,y,v,C){return 4!==arguments.length?t.apply(this,arguments):("function"==typeof C&&(C=T(C)),h.call(this,m,y,v,C))};case 5:return function(m,y,v,C,w){return 5!==arguments.length?t.apply(this,arguments):("function"==typeof w&&(w=T(w)),h.call(this,m,y,v,C,w))};case 6:return function(m,y,v,C,w,A){return 6!==arguments.length?t.apply(this,arguments):("function"==typeof A&&(A=T(A)),h.call(this,m,y,v,C,w,A))};default:return t}}function ks(h){var t=function(){var m;if("function"==typeof arguments[0]){(m=Array(arguments.length))[0]=T(arguments[0]);for(var y=1;y<arguments.length;y++)m[y]=arguments[y]}return h.apply(this,m||arguments)};switch(h.length){case 1:return function(m){return 1!==arguments.length?t.apply(this,arguments):("function"==typeof m&&(m=T(m)),h.call(this,m))};case 2:return function(m,y){return 2!==arguments.length?t.apply(this,arguments):("function"==typeof m&&(m=T(m)),h.call(this,m,y))};case 3:return function(m,y,v){return 3!==arguments.length?t.apply(this,arguments):("function"==typeof m&&(m=T(m)),h.call(this,m,y,v))};case 4:return function(m,y,v,C){return 4!==arguments.length?t.apply(this,arguments):("function"==typeof m&&(m=T(m)),h.call(this,m,y,v,C))};case 5:return function(m,y,v,C,w){return 5!==arguments.length?t.apply(this,arguments):("function"==typeof m&&(m=T(m)),h.call(this,m,y,v,C,w))};case 6:return function(m,y,v,C,w,A){return 6!==arguments.length?t.apply(this,arguments):("function"==typeof m&&(m=T(m)),h.call(this,m,y,v,C,w,A))};default:return t}}G&&(z=process.addAsyncListener({create:function(){G=!1}}),global.Promise.resolve(!0).then((function(){G=!1})),process.removeAsyncListener(z)),G&&function LO(){var h=global.Promise;function t(m){if(!(this instanceof t))return h(m);if("function"!=typeof m)return new h(m);var y,v,C=new h((function p(h,m){y=this,v=[function _(m){return n(C,!1),h(m)},function g(h){return n(C,!1),m(h)}]}));C.__proto__=t.prototype;try{m.apply(y,v)}catch(h){v[1](h)}return C}if(w.inherits(t,h),v(h.prototype,"then",a),h.prototype.chain&&v(h.prototype,"chain",a),A)global.Promise=zr()(h,n);else{["all","race","reject","resolve","accept","defer"].forEach((function(m){"function"==typeof h[m]&&(t[m]=h[m])})),global.Promise=t}function n(h,m){(!h.__asl_wrapper||m)&&(h.__asl_wrapper=T(i))}function i(m,y,v,C){var T;try{return{returnVal:T=y.call(m,v),error:!1}}catch(h){return{errorVal:h,error:!0}}finally{T instanceof h?C.__asl_wrapper=function(){var h=T.__asl_wrapper||i;return h.apply(this,arguments)}:n(C,!0)}}function a(h){return function(){var m=this,y=h.apply(m,Array.prototype.map.call(arguments,p));return y.__asl_wrapper=function(h,v,C,T){return m.__asl_wrapper?(m.__asl_wrapper(h,(function(){}),null,y),y.__asl_wrapper(h,v,C,T)):i(h,v,C,T)},y;function p(h){return"function"!=typeof h?h:T((function(v){var C=(m.__asl_wrapper||i)(this,h,v,y);if(C.error)throw C.errorVal;return C.returnVal}))}}}}()}),Jr=l((h,m)=>{"use strict";var v=y(28),C=Dr(),T="cls@contexts",w="error@context";function Fe(h){this.name=h,this.active=null,this._set=[],this.id=null}function yv(h){return process.namespaces[h]}function Tv(h){var m=yv(h);v.ok(m,"can't delete nonexistent namespace!"),v.ok(m.id,"don't assign to process.namespaces directly!"),process.removeAsyncListener(m.id),process.namespaces[h]=null}function Sv(){process.namespaces&&Object.keys(process.namespaces).forEach((function(h){Tv(h)})),process.namespaces=Object.create(null)}process.addAsyncListener||Gr(),Fe.prototype.set=function(h,m){if(!this.active)throw new Error("No context available. ns.run() or ns.bind() must be called first.");return this.active[h]=m,m},Fe.prototype.get=function(h){if(this.active)return this.active[h]},Fe.prototype.createContext=function(){return Object.create(this.active)},Fe.prototype.run=function(h){var m=this.createContext();this.enter(m);try{return h(m),m}catch(h){throw h&&(h[w]=m),h}finally{this.exit(m)}},Fe.prototype.runAndReturn=function(h){var m;return this.run((function(y){m=h(y)})),m},Fe.prototype.bind=function(h,m){m||(m=this.active?this.active:this.createContext());var y=this;return function(){y.enter(m);try{return h.apply(this,arguments)}catch(h){throw h&&(h[w]=m),h}finally{y.exit(m)}}},Fe.prototype.enter=function(h){v.ok(h,"context must be provided for entering"),this._set.push(this.active),this.active=h},Fe.prototype.exit=function(h){if(v.ok(h,"context must be provided for exiting"),this.active===h)return v.ok(this._set.length,"can't remove top context"),void(this.active=this._set.pop());var m=this._set.lastIndexOf(h);v.ok(m>=0,"context not currently entered; can't exit"),v.ok(m,"can't remove top context"),this._set.splice(m,1)},Fe.prototype.bindEmitter=function(h){v.ok(h.on&&h.addListener&&h.emit,"can only bind real EEs");var m=this,y="context@"+this.name;C(h,(function n(h){!h||(h[T]||(h[T]=Object.create(null)),h[T][y]={namespace:m,context:m.active})}),(function i(h){if(!h||!h[T])return h;var m=h,y=h[T];return Object.keys(y).forEach((function(h){var v=y[h];m=v.namespace.bind(m,v.context)})),m}))},Fe.prototype.fromException=function(h){return h[w]},process.namespaces||Sv(),m.exports={getNamespace:yv,createNamespace:function HO(h){v.ok(h,"namespace must be given a name!");var m=new Fe(h);return m.id=process.addAsyncListener({create:function(){return m.active},before:function(h,y){y&&m.enter(y)},after:function(h,y){y&&m.exit(y)},error:function(h){h&&m.exit(h)}}),process.namespaces[h]=m,m},destroyNamespace:Tv,reset:Sv}}),Xr=l(h=>{"use strict";Object.defineProperty(h,"__esModule",{value:!0}),h.CorrelationContextManager=void 0;var m=M(),y=Rn(),v=In(),C=xn(),T=Mr(),w=function(){function e(){}return e.getCurrentContext=function(){if(!e.enabled)return null;var h=e.session.get(e.CONTEXT_NAME);return void 0===h?null:h},e.generateContextObject=function(h,m,y,v,C,T){return m=m||h,this.enabled?{operation:{name:y,id:h,parentId:m,traceparent:C,tracestate:T},customProperties:new A(v)}:null},e.spanToContextObject=function(h,m,y){var C=new v;return C.traceId=h.traceId,C.spanId=h.spanId,C.traceFlag=v.formatOpenTelemetryTraceFlags(h.traceFlags)||v.DEFAULT_TRACE_FLAG,C.parentId=m,e.generateContextObject(C.traceId,C.parentId,y,null,C)},e.runWithContext=function(h,m){var y;return e.enabled?e.session.bind(m,((y={})[e.CONTEXT_NAME]=h,y))():m()},e.wrapEmitter=function(h){e.enabled&&e.session.bindEmitter(h)},e.wrapCallback=function(h,m){var y;return e.enabled?e.session.bind(h,m?((y={})[e.CONTEXT_NAME]=m,y):void 0):h},e.enable=function(h){if(!this.enabled){if(!this.isNodeVersionCompatible())return void(this.enabled=!1);e.hasEverEnabled||(this.forceClsHooked=h,this.hasEverEnabled=!0,void 0===this.cls&&(!0===e.forceClsHooked||void 0===e.forceClsHooked&&e.shouldUseClsHooked()?this.cls=$r():this.cls=Jr()),e.session=this.cls.createNamespace("AI-CLS-Session"),y.registerContextPreservation((function(h){return e.session.bind(h)}))),this.enabled=!0}},e.startOperation=function(h,y){var w=h&&h.traceContext||null,A=h&&h.traceId?h:null,P=h&&h.headers;if(A){var k=new v("00-"+A.traceId+"-"+A.spanId+"-01"),R=new C(A.traceState?A.traceState.serialize():null);return e.generateContextObject(A.traceId,"|"+A.traceId+"."+A.spanId+".","string"==typeof y?y:"",void 0,k,R)}if(w){k=new v(w.traceparent),R=new C(w.tracestate);var M="object"==typeof y?new T(y):null;return e.generateContextObject(k.traceId,k.parentId,"string"==typeof y?y:M.getOperationName({}),M&&M.getCorrelationContextHeader()||void 0,k,R)}if(P){k=new v(P.traceparent?P.traceparent.toString():null),R=new C(P.tracestate?P.tracestate.toString():null),M=new T(h);return e.generateContextObject(k.traceId,k.parentId,M.getOperationName({}),M.getCorrelationContextHeader(),k,R)}return m.warn("startOperation was called with invalid arguments",arguments),null},e.disable=function(){this.enabled=!1},e.reset=function(){e.hasEverEnabled&&(e.session=null,e.session=this.cls.createNamespace("AI-CLS-Session"))},e.isNodeVersionCompatible=function(){var h=process.versions.node.split(".");return parseInt(h[0])>3||parseInt(h[0])>2&&parseInt(h[1])>2},e.shouldUseClsHooked=function(){var h=process.versions.node.split(".");return parseInt(h[0])>8||parseInt(h[0])>=8&&parseInt(h[1])>=2},e.canUseClsHooked=function(){var h=process.versions.node.split("."),m=parseInt(h[0])>8||parseInt(h[0])>=8&&parseInt(h[1])>=0,y=parseInt(h[0])<8||parseInt(h[0])<=8&&parseInt(h[1])<2,v=parseInt(h[0])>4||parseInt(h[0])>=4&&parseInt(h[1])>=7;return!(m&&y)&&v},e.enabled=!1,e.hasEverEnabled=!1,e.forceClsHooked=void 0,e.CONTEXT_NAME="ApplicationInsights-Context",e}();h.CorrelationContextManager=w;var A=function(){function e(h){this.props=[],this.addHeaderData(h)}return e.prototype.addHeaderData=function(h){var m=h?h.split(", "):[];this.props=m.map((function(h){var m=h.split("=");return{key:m[0],value:m[1]}})).concat(this.props)},e.prototype.serializeToHeader=function(){return this.props.map((function(h){return h.key+"="+h.value})).join(", ")},e.prototype.getProperty=function(h){for(var m=0;m<this.props.length;++m){var y=this.props[m];if(y.key===h)return y.value}},e.prototype.setProperty=function(h,y){if(e.bannedCharacters.test(h)||e.bannedCharacters.test(y))m.warn("Correlation context property keys and values must not contain ',' or '='. setProperty was called with key: "+h+" and value: "+y);else{for(var v=0;v<this.props.length;++v){var C=this.props[v];if(C.key===h)return void(C.value=y)}this.props.push({key:h,value:y})}},e.bannedCharacters=/[,=]/,e}()}),Qr=l(h=>{"use strict";Object.defineProperty(h,"__esModule",{value:!0}),h.dispose=h.enable=void 0;var m=kr(),y=O(),v=[],Uu=function(h){var y=h.data.message;v.forEach((function(v){y instanceof Error?v.trackException({exception:y}):(y.lastIndexOf("\n")==y.length-1&&(y=y.substring(0,y.length-1)),v.trackTrace({message:y,severity:h.data.stderr?m.SeverityLevel.Warning:m.SeverityLevel.Information}))}))};h.enable=function FO(h,m){h?(0===v.length&&y.channel.subscribe("console",Uu),v.push(m)):0===(v=v.filter((function(h){return h!=m}))).length&&y.channel.unsubscribe("console",Uu)},h.dispose=function VO(){y.channel.unsubscribe("console",Uu),v=[]}}),Zr=l(h=>{"use strict";Object.defineProperty(h,"__esModule",{value:!0}),h.dispose=h.enable=void 0;var m=kr(),y=O(),v=[],C={10:m.SeverityLevel.Verbose,20:m.SeverityLevel.Verbose,30:m.SeverityLevel.Information,40:m.SeverityLevel.Warning,50:m.SeverityLevel.Error,60:m.SeverityLevel.Critical},Gu=function(h){var m=h.data.result;v.forEach((function(y){var v=C[h.data.level];m instanceof Error?y.trackException({exception:m}):y.trackTrace({message:m,severity:v})}))};h.enable=function zO(h,m){h?(0===v.length&&y.channel.subscribe("bunyan",Gu),v.push(m)):0===(v=v.filter((function(h){return h!=m}))).length&&y.channel.unsubscribe("bunyan",Gu)},h.dispose=function KO(){y.channel.unsubscribe("bunyan",Gu),v=[]}}),ei=l(h=>{"use strict";Object.defineProperty(h,"__esModule",{value:!0}),h.dispose=h.enable=void 0;var m=kr(),y=O(),v=[],C={syslog:function(h){var y={emerg:m.SeverityLevel.Critical,alert:m.SeverityLevel.Critical,crit:m.SeverityLevel.Critical,error:m.SeverityLevel.Error,warning:m.SeverityLevel.Warning,notice:m.SeverityLevel.Information,info:m.SeverityLevel.Information,debug:m.SeverityLevel.Verbose};return void 0===y[h]?m.SeverityLevel.Information:y[h]},npm:function(h){var y={error:m.SeverityLevel.Error,warn:m.SeverityLevel.Warning,info:m.SeverityLevel.Information,verbose:m.SeverityLevel.Verbose,debug:m.SeverityLevel.Verbose,silly:m.SeverityLevel.Verbose};return void 0===y[h]?m.SeverityLevel.Information:y[h]},unknown:function(h){return m.SeverityLevel.Information}},Vu=function(h){var m=h.data.message;v.forEach((function(y){if(m instanceof Error)y.trackException({exception:m,properties:h.data.meta});else{var v=C[h.data.levelKind](h.data.level);y.trackTrace({message:m,severity:v,properties:h.data.meta})}}))};h.enable=function XO(h,m){h?(0===v.length&&y.channel.subscribe("winston",Vu),v.push(m)):0===(v=v.filter((function(h){return h!=m}))).length&&y.channel.unsubscribe("winston",Vu)},h.dispose=function QO(){y.channel.unsubscribe("winston",Vu),v=[]}}),ti=l((h,m)=>{"use strict";var y=Rn(),v=function(){function e(h){if(e.INSTANCE)throw new Error("Console logging adapter tracking should be configured from the applicationInsights object");this._client=h,e.INSTANCE=this}return e.prototype.enable=function(h,m){y.IsInitialized&&(Qr().enable(h&&m,this._client),Zr().enable(h,this._client),ei().enable(h,this._client))},e.prototype.isInitialized=function(){return this._isInitialized},e.prototype.dispose=function(){e.INSTANCE=null,this.enable(!1,!1)},e._methodNames=["debug","info","log","warn","error"],e}();m.exports=v}),ni=l((h,m)=>{"use strict";var y=function(){function e(h){if(e.INSTANCE)throw new Error("Exception tracking should be configured from the applicationInsights object");e.INSTANCE=this,this._client=h;var m=process.versions.node.split(".");e._canUseUncaughtExceptionMonitor=parseInt(m[0])>13||13===parseInt(m[0])&&parseInt(m[1])>=7}return e.prototype.isInitialized=function(){return this._isInitialized},e.prototype.enable=function(h){var m=this;if(h){this._isInitialized=!0;if(!this._exceptionListenerHandle){var i=function(h,y,v){void 0===v&&(v=new Error(e._FALLBACK_ERROR_MESSAGE)),m._client.trackException({exception:v}),m._client.flush({isAppCrashing:!0}),h&&y&&1===process.listeners(y).length&&(console.error(v),process.exit(1))};e._canUseUncaughtExceptionMonitor?(this._exceptionListenerHandle=i.bind(this,!1,void 0),process.on(e.UNCAUGHT_EXCEPTION_MONITOR_HANDLER_NAME,this._exceptionListenerHandle)):(this._exceptionListenerHandle=i.bind(this,!0,e.UNCAUGHT_EXCEPTION_HANDLER_NAME),this._rejectionListenerHandle=i.bind(this,!1,void 0),process.on(e.UNCAUGHT_EXCEPTION_HANDLER_NAME,this._exceptionListenerHandle),process.on(e.UNHANDLED_REJECTION_HANDLER_NAME,this._rejectionListenerHandle))}}else this._exceptionListenerHandle&&(e._canUseUncaughtExceptionMonitor?process.removeListener(e.UNCAUGHT_EXCEPTION_MONITOR_HANDLER_NAME,this._exceptionListenerHandle):(process.removeListener(e.UNCAUGHT_EXCEPTION_HANDLER_NAME,this._exceptionListenerHandle),process.removeListener(e.UNHANDLED_REJECTION_HANDLER_NAME,this._rejectionListenerHandle)),this._exceptionListenerHandle=void 0,this._rejectionListenerHandle=void 0,delete this._exceptionListenerHandle,delete this._rejectionListenerHandle)},e.prototype.dispose=function(){e.INSTANCE=null,this.enable(!1),this._isInitialized=!1},e.INSTANCE=null,e.UNCAUGHT_EXCEPTION_MONITOR_HANDLER_NAME="uncaughtExceptionMonitor",e.UNCAUGHT_EXCEPTION_HANDLER_NAME="uncaughtException",e.UNHANDLED_REJECTION_HANDLER_NAME="unhandledRejection",e._RETHROW_EXIT_MESSAGE="Application Insights Rethrow Exception Handler",e._FALLBACK_ERROR_MESSAGE="A promise was rejected without providing an error. Application Insights generated this error stack for you.",e._canUseUncaughtExceptionMonitor=!1,e}();m.exports=y}),ri=l(h=>{"use strict";var m,y,v,C;Object.defineProperty(h,"__esModule",{value:!0}),h.HeartBeatMetricName=h.DependencyTypeName=h.SpanAttribute=h.TelemetryTypeStringToQuickPulseDocumentType=h.TelemetryTypeStringToQuickPulseType=h.QuickPulseType=h.QuickPulseDocumentType=h.PerformanceToQuickPulseCounter=h.MetricId=h.PerformanceCounter=h.QuickPulseCounter=h.DEFAULT_LIVEMETRICS_HOST=h.DEFAULT_LIVEMETRICS_ENDPOINT=h.DEFAULT_BREEZE_ENDPOINT=void 0,h.DEFAULT_BREEZE_ENDPOINT="https://dc.services.visualstudio.com",h.DEFAULT_LIVEMETRICS_ENDPOINT="https://rt.services.visualstudio.com",h.DEFAULT_LIVEMETRICS_HOST="rt.services.visualstudio.com",(v=y=h.QuickPulseCounter||(h.QuickPulseCounter={})).COMMITTED_BYTES="\\Memory\\Committed Bytes",v.PROCESSOR_TIME="\\Processor(_Total)\\% Processor Time",v.REQUEST_RATE="\\ApplicationInsights\\Requests/Sec",v.REQUEST_FAILURE_RATE="\\ApplicationInsights\\Requests Failed/Sec",v.REQUEST_DURATION="\\ApplicationInsights\\Request Duration",v.DEPENDENCY_RATE="\\ApplicationInsights\\Dependency Calls/Sec",v.DEPENDENCY_FAILURE_RATE="\\ApplicationInsights\\Dependency Calls Failed/Sec",v.DEPENDENCY_DURATION="\\ApplicationInsights\\Dependency Call Duration",v.EXCEPTION_RATE="\\ApplicationInsights\\Exceptions/Sec",function(h){h.PRIVATE_BYTES="\\Process(??APP_WIN32_PROC??)\\Private Bytes",h.AVAILABLE_BYTES="\\Memory\\Available Bytes",h.PROCESSOR_TIME="\\Processor(_Total)\\% Processor Time",h.PROCESS_TIME="\\Process(??APP_WIN32_PROC??)\\% Processor Time",h.REQUEST_RATE="\\ASP.NET Applications(??APP_W3SVC_PROC??)\\Requests/Sec",h.REQUEST_DURATION="\\ASP.NET Applications(??APP_W3SVC_PROC??)\\Request Execution Time"}(C=h.PerformanceCounter||(h.PerformanceCounter={})),function(h){h.REQUESTS_DURATION="requests/duration",h.DEPENDENCIES_DURATION="dependencies/duration",h.EXCEPTIONS_COUNT="exceptions/count",h.TRACES_COUNT="traces/count"}(h.MetricId||(h.MetricId={})),h.PerformanceToQuickPulseCounter=((m={})[C.PROCESSOR_TIME]=y.PROCESSOR_TIME,m[C.REQUEST_RATE]=y.REQUEST_RATE,m[C.REQUEST_DURATION]=y.REQUEST_DURATION,m[y.COMMITTED_BYTES]=y.COMMITTED_BYTES,m[y.REQUEST_FAILURE_RATE]=y.REQUEST_FAILURE_RATE,m[y.DEPENDENCY_RATE]=y.DEPENDENCY_RATE,m[y.DEPENDENCY_FAILURE_RATE]=y.DEPENDENCY_FAILURE_RATE,m[y.DEPENDENCY_DURATION]=y.DEPENDENCY_DURATION,m[y.EXCEPTION_RATE]=y.EXCEPTION_RATE,m),h.QuickPulseDocumentType={Event:"Event",Exception:"Exception",Trace:"Trace",Metric:"Metric",Request:"Request",Dependency:"RemoteDependency",Availability:"Availability",PageView:"PageView"},h.QuickPulseType={Event:"EventTelemetryDocument",Exception:"ExceptionTelemetryDocument",Trace:"TraceTelemetryDocument",Metric:"MetricTelemetryDocument",Request:"RequestTelemetryDocument",Dependency:"DependencyTelemetryDocument",Availability:"AvailabilityTelemetryDocument",PageView:"PageViewTelemetryDocument"},h.TelemetryTypeStringToQuickPulseType={EventData:h.QuickPulseType.Event,ExceptionData:h.QuickPulseType.Exception,MessageData:h.QuickPulseType.Trace,MetricData:h.QuickPulseType.Metric,RequestData:h.QuickPulseType.Request,RemoteDependencyData:h.QuickPulseType.Dependency,AvailabilityData:h.QuickPulseType.Availability,PageViewData:h.QuickPulseType.PageView},h.TelemetryTypeStringToQuickPulseDocumentType={EventData:h.QuickPulseDocumentType.Event,ExceptionData:h.QuickPulseDocumentType.Exception,MessageData:h.QuickPulseDocumentType.Trace,MetricData:h.QuickPulseDocumentType.Metric,RequestData:h.QuickPulseDocumentType.Request,RemoteDependencyData:h.QuickPulseDocumentType.Dependency,AvailabilityData:h.QuickPulseDocumentType.Availability,PageViewData:h.QuickPulseDocumentType.PageView},h.SpanAttribute={HttpHost:"http.host",HttpMethod:"http.method",HttpPort:"http.port",HttpStatusCode:"http.status_code",HttpUrl:"http.url",HttpUserAgent:"http.user_agent",GrpcMethod:"grpc.method",GrpcService:"rpc.service"},h.DependencyTypeName={Grpc:"GRPC",Http:"HTTP",InProc:"InProc"},h.HeartBeatMetricName="HeartBeat"}),ii=l((h,m)=>{"use strict";var v=y(18),C=ri(),T=function(){function e(h,m,y){void 0===m&&(m=6e4),void 0===y&&(y=!1),this._lastIntervalRequestExecutionTime=0,this._lastIntervalDependencyExecutionTime=0,e.INSTANCE||(e.INSTANCE=this),this._isInitialized=!1,this._client=h,this._collectionInterval=m,this._enableLiveMetricsCounters=y}return e.prototype.enable=function(h,m){var y=this;this._isEnabled=h,this._isEnabled&&!this._isInitialized&&(this._isInitialized=!0),h?this._handle||(this._lastCpus=v.cpus(),this._lastRequests={totalRequestCount:e._totalRequestCount,totalFailedRequestCount:e._totalFailedRequestCount,time:+new Date},this._lastDependencies={totalDependencyCount:e._totalDependencyCount,totalFailedDependencyCount:e._totalFailedDependencyCount,time:+new Date},this._lastExceptions={totalExceptionCount:e._totalExceptionCount,time:+new Date},"function"==typeof process.cpuUsage&&(this._lastAppCpuUsage=process.cpuUsage()),this._lastHrtime=process.hrtime(),this._collectionInterval=m||this._collectionInterval,this._handle=setInterval((function(){return y.trackPerformance()}),this._collectionInterval),this._handle.unref()):this._handle&&(clearInterval(this._handle),this._handle=void 0)},e.countRequest=function(h,m){var y;if(e.isEnabled()){if("string"==typeof h)y=+new Date("1970-01-01T"+h+"Z");else{if("number"!=typeof h)return;y=h}e._intervalRequestExecutionTime+=y,!1===m&&e._totalFailedRequestCount++,e._totalRequestCount++}},e.countException=function(){e._totalExceptionCount++},e.countDependency=function(h,m){var y;if(e.isEnabled()){if("string"==typeof h)y=+new Date("1970-01-01T"+h+"Z");else{if("number"!=typeof h)return;y=h}e._intervalDependencyExecutionTime+=y,!1===m&&e._totalFailedDependencyCount++,e._totalDependencyCount++}},e.prototype.isInitialized=function(){return this._isInitialized},e.isEnabled=function(){return e.INSTANCE&&e.INSTANCE._isEnabled},e.prototype.trackPerformance=function(){this._trackCpu(),this._trackMemory(),this._trackNetwork(),this._trackDependencyRate(),this._trackExceptionRate()},e.prototype._trackCpu=function(){var h=v.cpus();if(h&&h.length&&this._lastCpus&&h.length===this._lastCpus.length){for(var m=0,y=0,T=0,w=0,A=0,P=0;h&&P<h.length;P++){var k=h[P],R=this._lastCpus[P],M=(k.model,k.speed,k.times),N=R.times;m+=M.user-N.user||0,y+=M.sys-N.sys||0,T+=M.nice-N.nice||0,w+=M.idle-N.idle||0,A+=M.irq-N.irq||0}var D=void 0;if("function"==typeof process.cpuUsage){var I=process.cpuUsage(),x=process.hrtime(),O=I.user-this._lastAppCpuUsage.user+(I.system-this._lastAppCpuUsage.system)||0;if(void 0!==this._lastHrtime&&2===this._lastHrtime.length)D=100*O/((1e6*(x[0]-this._lastHrtime[0])+(x[1]-this._lastHrtime[1])/1e3||0)*h.length);this._lastAppCpuUsage=I,this._lastHrtime=x}var L=m+y+T+w+A||1;this._client.trackMetric({name:C.PerformanceCounter.PROCESSOR_TIME,value:(L-w)/L*100}),this._client.trackMetric({name:C.PerformanceCounter.PROCESS_TIME,value:D||m/L*100})}this._lastCpus=h},e.prototype._trackMemory=function(){var h=v.freemem(),m=process.memoryUsage().rss,y=v.totalmem()-h;this._client.trackMetric({name:C.PerformanceCounter.PRIVATE_BYTES,value:m}),this._client.trackMetric({name:C.PerformanceCounter.AVAILABLE_BYTES,value:h}),this._enableLiveMetricsCounters&&this._client.trackMetric({name:C.QuickPulseCounter.COMMITTED_BYTES,value:y})},e.prototype._trackNetwork=function(){var h=this._lastRequests,m={totalRequestCount:e._totalRequestCount,totalFailedRequestCount:e._totalFailedRequestCount,time:+new Date},y=m.totalRequestCount-h.totalRequestCount||0,v=m.totalFailedRequestCount-h.totalFailedRequestCount||0,T=m.time-h.time,w=T/1e3,A=(e._intervalRequestExecutionTime-this._lastIntervalRequestExecutionTime)/y||0;if(this._lastIntervalRequestExecutionTime=e._intervalRequestExecutionTime,T>0){var P=y/w,k=v/w;this._client.trackMetric({name:C.PerformanceCounter.REQUEST_RATE,value:P}),(!this._enableLiveMetricsCounters||y>0)&&this._client.trackMetric({name:C.PerformanceCounter.REQUEST_DURATION,value:A}),this._enableLiveMetricsCounters&&this._client.trackMetric({name:C.QuickPulseCounter.REQUEST_FAILURE_RATE,value:k})}this._lastRequests=m},e.prototype._trackDependencyRate=function(){if(this._enableLiveMetricsCounters){var h=this._lastDependencies,m={totalDependencyCount:e._totalDependencyCount,totalFailedDependencyCount:e._totalFailedDependencyCount,time:+new Date},y=m.totalDependencyCount-h.totalDependencyCount||0,v=m.totalFailedDependencyCount-h.totalFailedDependencyCount||0,T=m.time-h.time,w=T/1e3,A=(e._intervalDependencyExecutionTime-this._lastIntervalDependencyExecutionTime)/y||0;if(this._lastIntervalDependencyExecutionTime=e._intervalDependencyExecutionTime,T>0){var P=y/w,k=v/w;this._client.trackMetric({name:C.QuickPulseCounter.DEPENDENCY_RATE,value:P}),this._client.trackMetric({name:C.QuickPulseCounter.DEPENDENCY_FAILURE_RATE,value:k}),(!this._enableLiveMetricsCounters||y>0)&&this._client.trackMetric({name:C.QuickPulseCounter.DEPENDENCY_DURATION,value:A})}this._lastDependencies=m}},e.prototype._trackExceptionRate=function(){if(this._enableLiveMetricsCounters){var h=this._lastExceptions,m={totalExceptionCount:e._totalExceptionCount,time:+new Date},y=m.totalExceptionCount-h.totalExceptionCount||0,v=m.time-h.time;if(v>0){var T=y/(v/1e3);this._client.trackMetric({name:C.QuickPulseCounter.EXCEPTION_RATE,value:T})}this._lastExceptions=m}},e.prototype.dispose=function(){e.INSTANCE=null,this.enable(!1),this._isInitialized=!1},e._totalRequestCount=0,e._totalFailedRequestCount=0,e._totalDependencyCount=0,e._totalFailedDependencyCount=0,e._totalExceptionCount=0,e._intervalDependencyExecutionTime=0,e._intervalRequestExecutionTime=0,e}();m.exports=T}),si=l(h=>{"use strict";Object.defineProperty(h,"__esModule",{value:!0}),h.AggregatedMetricCounter=void 0;var m=function e(h){this.dimensions=h,this.totalCount=0,this.lastTotalCount=0,this.intervalExecutionTime=0,this.lastTime=+new Date,this.lastIntervalExecutionTime=0};h.AggregatedMetricCounter=m}),ai=l(h=>{"use strict";Object.defineProperty(h,"__esModule",{value:!0}),h.PreaggregatedMetricPropertyNames=void 0,h.PreaggregatedMetricPropertyNames={cloudRoleInstance:"cloud/roleInstance",cloudRoleName:"cloud/roleName",operationSynthetic:"operation/synthetic",requestSuccess:"Request.Success",requestResultCode:"request/resultCode",dependencyType:"Dependency.Type",dependencyTarget:"dependency/target",dependencySuccess:"Dependency.Success",dependencyResultCode:"dependency/resultCode",traceSeverityLevel:"trace/severityLevel"}}),ci=l((h,m)=>{"use strict";var y=h&&h.__assign||function(){return(y=Object.assign||function(h){for(var m,y=1,v=arguments.length;y<v;y++)for(var C in m=arguments[y])Object.prototype.hasOwnProperty.call(m,C)&&(h[C]=m[C]);return h}).apply(this,arguments)},v=ri(),C=si(),T=ai(),w=function(){function e(h,m){void 0===m&&(m=6e4),e.INSTANCE||(e.INSTANCE=this),this._isInitialized=!1,e._dependencyCountersCollection=[],e._requestCountersCollection=[],e._exceptionCountersCollection=[],e._traceCountersCollection=[],this._client=h,this._collectionInterval=m}return e.prototype.enable=function(h,m){var y=this;this._isEnabled=h,this._isEnabled&&!this._isInitialized&&(this._isInitialized=!0),h?this._handle||(this._collectionInterval=m||this._collectionInterval,this._handle=setInterval((function(){return y.trackPreAggregatedMetrics()}),this._collectionInterval),this._handle.unref()):this._handle&&(clearInterval(this._handle),this._handle=void 0)},e.countException=function(h){e.isEnabled()&&e._getAggregatedCounter(h,this._exceptionCountersCollection).totalCount++},e.countTrace=function(h){e.isEnabled()&&e._getAggregatedCounter(h,this._traceCountersCollection).totalCount++},e.countRequest=function(h,m){if(e.isEnabled()){var y,v=e._getAggregatedCounter(m,this._requestCountersCollection);if("string"==typeof h)y=+new Date("1970-01-01T"+h+"Z");else{if("number"!=typeof h)return;y=h}v.intervalExecutionTime+=y,v.totalCount++}},e.countDependency=function(h,m){if(e.isEnabled()){var y,v=e._getAggregatedCounter(m,this._dependencyCountersCollection);if("string"==typeof h)y=+new Date("1970-01-01T"+h+"Z");else{if("number"!=typeof h)return;y=h}v.intervalExecutionTime+=y,v.totalCount++}},e.prototype.isInitialized=function(){return this._isInitialized},e.isEnabled=function(){return e.INSTANCE&&e.INSTANCE._isEnabled},e.prototype.trackPreAggregatedMetrics=function(){this._trackRequestMetrics(),this._trackDependencyMetrics(),this._trackExceptionMetrics(),this._trackTraceMetrics()},e._getAggregatedCounter=function(h,m){for(var y=!1,v=0;v<m.length;v++){if(h===m[v].dimensions)return m[v];if(Object.keys(h).length===Object.keys(m[v].dimensions).length){for(var T in h)if(h[T]!=m[v].dimensions[T]){y=!0;break}if(!y)return m[v];y=!1}}var w=new C.AggregatedMetricCounter(h);return m.push(w),w},e.prototype._trackRequestMetrics=function(){for(var h=0;h<e._requestCountersCollection.length;h++){var m=e._requestCountersCollection[h];m.time=+new Date;var y=m.totalCount-m.lastTotalCount||0,C=m.time-m.lastTime,T=(m.intervalExecutionTime-m.lastIntervalExecutionTime)/y||0;m.lastIntervalExecutionTime=m.intervalExecutionTime,C>0&&y>0&&this._trackPreAggregatedMetric({name:"Server response time",dimensions:m.dimensions,value:T,count:y,aggregationInterval:C,metricType:v.MetricId.REQUESTS_DURATION}),m.lastTotalCount=m.totalCount,m.lastTime=m.time}},e.prototype._trackDependencyMetrics=function(){for(var h=0;h<e._dependencyCountersCollection.length;h++){var m=e._dependencyCountersCollection[h];m.time=+new Date;var y=m.totalCount-m.lastTotalCount||0,C=m.time-m.lastTime,T=(m.intervalExecutionTime-m.lastIntervalExecutionTime)/y||0;m.lastIntervalExecutionTime=m.intervalExecutionTime,C>0&&y>0&&this._trackPreAggregatedMetric({name:"Dependency duration",dimensions:m.dimensions,value:T,count:y,aggregationInterval:C,metricType:v.MetricId.DEPENDENCIES_DURATION}),m.lastTotalCount=m.totalCount,m.lastTime=m.time}},e.prototype._trackExceptionMetrics=function(){for(var h=0;h<e._exceptionCountersCollection.length;h++){var m=e._exceptionCountersCollection[h],y=m.totalCount-m.lastTotalCount||0,C=m.time-m.lastTime;this._trackPreAggregatedMetric({name:"Exceptions",dimensions:m.dimensions,value:y,count:y,aggregationInterval:C,metricType:v.MetricId.EXCEPTIONS_COUNT}),m.lastTotalCount=m.totalCount,m.lastTime=m.time}},e.prototype._trackTraceMetrics=function(){for(var h=0;h<e._traceCountersCollection.length;h++){var m=e._traceCountersCollection[h],y=m.totalCount-m.lastTotalCount||0,C=m.time-m.lastTime;this._trackPreAggregatedMetric({name:"Traces",dimensions:m.dimensions,value:y,count:y,aggregationInterval:C,metricType:v.MetricId.TRACES_COUNT}),m.lastTotalCount=m.totalCount,m.lastTime=m.time}},e.prototype._trackPreAggregatedMetric=function(h){var m={};for(var v in h.dimensions)m[T.PreaggregatedMetricPropertyNames[v]]=h.dimensions[v];m=y(y({},m),{"_MS.MetricId":h.metricType,"_MS.AggregationIntervalMs":String(h.aggregationInterval),"_MS.IsAutocollected":"True"});var C={name:h.name,value:h.value,count:h.count,properties:m,kind:"Aggregation"};this._client.trackMetric(C)},e.prototype.dispose=function(){e.INSTANCE=null,this.enable(!1),this._isInitialized=!1},e}();m.exports=w}),li=l((h,m)=>{"use strict";var v=y(18),C=y(21),T=y(7),w=kr(),A=M(),P=function(){function e(h){this.keys=new w.ContextTagKeys,this.tags={},this._loadApplicationContext(h),this._loadDeviceContext(),this._loadInternalContext()}return e.prototype._loadApplicationContext=function(h){if(h=h||T.resolve(__dirname,"../../../../package.json"),!e.appVersion[h]){e.appVersion[h]="unknown";try{var m=JSON.parse(C.readFileSync(h,"utf8"));m&&"string"==typeof m.version&&(e.appVersion[h]=m.version)}catch(h){A.info("unable to read app version: ",h)}}this.tags[this.keys.applicationVersion]=e.appVersion[h]},e.prototype._loadDeviceContext=function(){this.tags[this.keys.deviceId]="",this.tags[this.keys.cloudRoleInstance]=v&&v.hostname(),this.tags[this.keys.deviceOSVersion]=v&&v.type()+" "+v.release(),this.tags[this.keys.cloudRole]=e.DefaultRoleName,this.tags["ai.device.osArchitecture"]=v&&v.arch(),this.tags["ai.device.osPlatform"]=v&&v.platform()},e.prototype._loadInternalContext=function(){var h=T.resolve(__dirname,"../../package.json");if(!e.sdkVersion){e.sdkVersion="unknown";try{var m=JSON.parse(C.readFileSync(h,"utf8"));m&&"string"==typeof m.version&&(e.sdkVersion=m.version)}catch(h){A.info("unable to read app version: ",h)}}this.tags[this.keys.internalSdkVersion]="node:"+e.sdkVersion},e.DefaultRoleName="Web",e.appVersion={},e.sdkVersion=null,e}();m.exports=P}),ui=l((h,m)=>{"use strict";var v,C=h&&h.__extends||(v=function(h,m){return(v=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(h,m){h.__proto__=m}||function(h,m){for(var y in m)Object.prototype.hasOwnProperty.call(m,y)&&(h[y]=m[y])})(h,m)},function(h,m){function n(){this.constructor=h}v(h,m),h.prototype=null===m?Object.create(m):(n.prototype=m.prototype,new n)}),T=y(20),w=kr(),A=Nn(),P=Mn(),k=Rr(),R=Dn(),M=function(h){function t(m,y){var v=h.call(this)||this;return y&&y.method&&m&&(v.method=y.method,v.url=t._getUrlFromRequestOptions(m,y),v.startTime=+new Date),v}return C(t,h),t.prototype.onError=function(h){this._setStatus(void 0,h)},t.prototype.onResponse=function(h){this._setStatus(h.statusCode,void 0),this.correlationId=A.getCorrelationContextTarget(h,P.requestContextTargetKey)},t.prototype.getDependencyTelemetry=function(h,m){var y=T.parse(this.url);y.search=void 0,y.hash=void 0;var v=this.method.toUpperCase()+" "+y.pathname,C=w.RemoteDependencyDataConstants.TYPE_HTTP,A=y.hostname;y.port&&(A+=":"+y.port),this.correlationId?(C=w.RemoteDependencyDataConstants.TYPE_AI,this.correlationId!==R.correlationIdPrefix&&(A+=" | "+this.correlationId)):C=w.RemoteDependencyDataConstants.TYPE_HTTP;var P={id:m,name:v,data:this.url,duration:this.duration,success:this._isSuccess(),resultCode:this.statusCode?this.statusCode.toString():null,properties:this.properties||{},dependencyTypeName:C,target:A};if(h&&h.time?P.time=h.time:this.startTime&&(P.time=new Date(this.startTime)),h){for(var k in h)P[k]||(P[k]=h[k]);if(h.properties)for(var k in h.properties)P.properties[k]=h.properties[k]}return P},t._getUrlFromRequestOptions=function(h,m){if("string"==typeof h)if(0===h.indexOf("http://")||0===h.indexOf("https://"))h=T.parse(h);else{var y=T.parse(h);h="443"===y.host?T.parse("https://"+h):T.parse("http://"+h)}else{if(h&&"function"==typeof T.URL&&h instanceof T.URL)return T.format(h);var v=h;h={},v&&Object.keys(v).forEach((function(m){h[m]=v[m]}))}if(h.path){var C=T.parse(h.path);h.pathname=C.pathname,h.search=C.search}h.host&&h.port&&(!T.parse("http://"+h.host).port&&h.port&&(h.hostname=h.host,delete h.host));return h.protocol=h.protocol||m.agent&&m.agent.protocol||m.protocol||void 0,h.hostname=h.hostname||"localhost",T.format(h)},t}(k);m.exports=M}),di=l(h=>{"use strict";var m=h&&h.__assign||function(){return(m=Object.assign||function(h){for(var m,y=1,v=arguments.length;y<v;y++)for(var C in m=arguments[y])Object.prototype.hasOwnProperty.call(m,C)&&(h[C]=m[C]);return h}).apply(this,arguments)};Object.defineProperty(h,"__esModule",{value:!0}),h.spanToTelemetryContract=void 0;var y=Be(),v=ri();function Xu(h){var y=m({},h);return Object.keys(v.SpanAttribute).forEach((function(h){delete y[h]})),y}h.spanToTelemetryContract=function _R(h){var C="|"+h.spanContext().traceId+"."+h.spanContext().spanId+".",T=Math.round(1e3*h._duration[0]+h._duration[1]/1e6),w=h.attributes["peer.address"]?h.attributes["peer.address"].toString():"",A=h.attributes.component?h.attributes.component.toString():"",P=A.toUpperCase()===v.DependencyTypeName.Http||!!h.attributes[v.SpanAttribute.HttpUrl],k=A.toLowerCase()===v.DependencyTypeName.Grpc;if(P){var R=h.attributes[v.SpanAttribute.HttpMethod]||"GET",M=new URL(h.attributes[v.SpanAttribute.HttpUrl].toString()),N=h.attributes[v.SpanAttribute.HttpHost]||M.host,D=h.attributes[v.SpanAttribute.HttpPort]||M.port||null,I=R+" "+(M.pathname||"/"),x=v.DependencyTypeName.Http,O=D?(N+":"+D).toString():N.toString(),L=M.toString(),U=h.attributes[v.SpanAttribute.HttpStatusCode]||h.status.code||0;return{id:C,name:I,dependencyTypeName:x,target:O,data:L,success:U<400,duration:T,url:L,resultCode:String(U),properties:Xu(h.attributes)}}if(k){R=h.attributes[v.SpanAttribute.GrpcMethod]||"rpc";var B=h.attributes[v.SpanAttribute.GrpcService],W=B?R+" "+B:h.name;return{id:C,duration:T,name:W,target:B.toString(),data:B.toString()||W,url:B.toString()||W,dependencyTypeName:v.DependencyTypeName.Grpc,resultCode:String(h.status.code||0),success:0===h.status.code,properties:Xu(h.attributes)}}var q=h.name,Y=h.links&&h.links.map((function(h){return{operation_Id:h.context.traceId,id:h.context.spanId}}));return{id:C,duration:T,name:q,target:w,data:w||q,url:w||q,dependencyTypeName:h.kind===y.SpanKind.INTERNAL?v.DependencyTypeName.InProc:A||h.name,resultCode:String(h.status.code||0),success:0===h.status.code,properties:m(m({},Xu(h.attributes)),{"_MS.links":Y||void 0})}}}),pi=l(h=>{"use strict";Object.defineProperty(h,"__esModule",{value:!0}),h.enable=h.subscriber=void 0;var m=Be(),y=O(),v=In(),C=di(),T=N(),w=[];h.subscriber=function(h){var y=h.data,A=C.spanToTelemetryContract(y),P=y.spanContext(),k=new v;k.traceId=P.traceId,k.spanId=P.spanId,k.traceFlag=v.formatOpenTelemetryTraceFlags(P.traceFlags),k.parentId=y.parentSpanId?"|"+P.traceId+"."+y.parentSpanId+".":null,T.AsyncScopeManager.with(y,(function(){w.forEach((function(h){y.kind===m.SpanKind.SERVER?h.trackRequest(A):(y.kind===m.SpanKind.CLIENT||y.kind===m.SpanKind.INTERNAL)&&h.trackDependency(A)}))}))},h.enable=function ER(m,v){m?(0===w.length&&y.channel.subscribe("azure-coretracing",h.subscriber),w.push(v)):0===(w=w.filter((function(h){return h!=v}))).length&&y.channel.unsubscribe("azure-coretracing",h.subscriber)}}),mi=l(h=>{"use strict";Object.defineProperty(h,"__esModule",{value:!0}),h.enable=h.subscriber=void 0;var m=O(),y=[];h.subscriber=function(h){"ismaster"!==h.data.event.commandName&&y.forEach((function(m){var y=h.data.startedData&&h.data.startedData.databaseName||"Unknown database";m.trackDependency({target:y,data:h.data.event.commandName,name:h.data.event.commandName,duration:h.data.event.duration,success:h.data.succeeded,resultCode:h.data.succeeded?"0":"1",time:h.data.startedData.time,dependencyTypeName:"mongodb"})}))},h.enable=function TR(v,C){v?(0===y.length&&m.channel.subscribe("mongodb",h.subscriber),y.push(C)):0===(y=y.filter((function(h){return h!=C}))).length&&m.channel.unsubscribe("mongodb",h.subscriber)}}),gi=l(h=>{"use strict";Object.defineProperty(h,"__esModule",{value:!0}),h.enable=h.subscriber=void 0;var m=O(),y=[];h.subscriber=function(h){y.forEach((function(m){var y=h.data.query||{},v=y.sql||"Unknown query",C=!h.data.err,T=(y._connection||{}).config||{},w=T.socketPath?T.socketPath:(T.host||"localhost")+":"+T.port;m.trackDependency({target:w,data:v,name:v,duration:h.data.duration,success:C,resultCode:C?"0":"1",time:h.data.time,dependencyTypeName:"mysql"})}))},h.enable=function AR(v,C){v?(0===y.length&&m.channel.subscribe("mysql",h.subscriber),y.push(C)):0===(y=y.filter((function(h){return h!=C}))).length&&m.channel.unsubscribe("mysql",h.subscriber)}}),vi=l(h=>{"use strict";Object.defineProperty(h,"__esModule",{value:!0}),h.enable=h.subscriber=void 0;var m=O(),y=[];h.subscriber=function(h){y.forEach((function(m){"info"!==h.data.commandObj.command&&m.trackDependency({target:h.data.address,name:h.data.commandObj.command,data:h.data.commandObj.command,duration:h.data.duration,success:!h.data.err,resultCode:h.data.err?"1":"0",time:h.data.time,dependencyTypeName:"redis"})}))},h.enable=function IR(v,C){v?(0===y.length&&m.channel.subscribe("redis",h.subscriber),y.push(C)):0===(y=y.filter((function(h){return h!=C}))).length&&m.channel.unsubscribe("redis",h.subscriber)}}),Si=l(h=>{"use strict";Object.defineProperty(h,"__esModule",{value:!0}),h.enable=h.subscriber=void 0;var m=O(),y=[];h.subscriber=function(h){y.forEach((function(m){var y=h.data.query,v=y.preparable&&y.preparable.text||y.plan||y.text||"unknown query",C=!h.data.error,T=h.data.database.host+":"+h.data.database.port;m.trackDependency({target:T,data:v,name:v,duration:h.data.duration,success:C,resultCode:C?"0":"1",time:h.data.time,dependencyTypeName:"postgres"})}))},h.enable=function PR(v,C){v?(0===y.length&&m.channel.subscribe("postgres",h.subscriber),y.push(C)):0===(y=y.filter((function(h){return h!=C}))).length&&m.channel.unsubscribe("postgres",h.subscriber)}}),Ci=l((h,m)=>{"use strict";var v=h&&h.__spreadArrays||function(){for(var h=0,m=0,y=arguments.length;m<y;m++)h+=arguments[m].length;var v=Array(h),C=0;for(m=0;m<y;m++)for(var T=arguments[m],w=0,A=T.length;w<A;w++,C++)v[C]=T[w];return v},C=y(52),T=y(46),w=M(),A=Nn(),P=Mn(),k=ui(),R=Xr(),N=Dn(),D=In(),I=Rn(),x=function(){function e(h){if(e.INSTANCE)throw new Error("Client request tracking should be configured from the applicationInsights object");e.INSTANCE=this,this._client=h}return e.prototype.enable=function(h){this._isEnabled=h,this._isEnabled&&!this._isInitialized&&this._initialize(),I.IsInitialized&&(pi().enable(!0,this._client),mi().enable(h,this._client),gi().enable(h,this._client),vi().enable(h,this._client),Si().enable(h,this._client))},e.prototype.isInitialized=function(){return this._isInitialized},e.prototype._initialize=function(){var h=this;this._isInitialized=!0;var m=C.request,y=T.request,i=function(m,y){var v=!y[e.disableCollectionRequestOption]&&!m[e.alreadyAutoCollectedFlag];y.headers&&y.headers["user-agent"]&&-1!==y.headers["user-agent"].toString().indexOf("azsdk-js")&&(v=!1),m[e.alreadyAutoCollectedFlag]=!0,m&&y&&v&&(R.CorrelationContextManager.wrapEmitter(m),e.trackRequest(h._client,{options:y,request:m}))};C.request=function(h){for(var y=[],T=1;T<arguments.length;T++)y[T-1]=arguments[T];var w=m.call.apply(m,v([C,h],y));return i(w,h),w},T.request=function(h){for(var m=[],C=1;C<arguments.length;C++)m[C-1]=arguments[C];var w=y.call.apply(y,v([T,h],m));return i(w,h),w},C.get=function(h){for(var m,y=[],T=1;T<arguments.length;T++)y[T-1]=arguments[T];var w=(m=C.request).call.apply(m,v([C,h],y));return w.end(),w},T.get=function(h){for(var m,y=[],C=1;C<arguments.length;C++)y[C-1]=arguments[C];var w=(m=T.request).call.apply(m,v([T,h],y));return w.end(),w}},e.trackRequest=function(h,m){if(m.options&&m.request&&h){var y,v,C=new k(m.options,m.request),T=R.CorrelationContextManager.getCurrentContext();if(T&&T.operation&&T.operation.traceparent&&D.isValidTraceId(T.operation.traceparent.traceId))T.operation.traceparent.updateSpanId(),y=T.operation.traceparent.getBackCompatRequestId();else if(N.w3cEnabled){v=(I=new D).toString(),y=I.getBackCompatRequestId()}else y=T&&T.operation&&T.operation.parentId+e.requestNumber+++".";if(A.canIncludeCorrelationHeader(h,C.getUrl())&&m.request.getHeader&&m.request.setHeader&&h.config&&h.config.correlationId){var M=m.request.getHeader(P.requestContextHeader);try{A.safeIncludeCorrelationHeader(h,m.request,M)}catch(h){w.warn("Request-Context header could not be set. Correlation of requests may be lost",h)}if(T&&T.operation)try{if(m.request.setHeader(P.requestIdHeader,y),h.config.ignoreLegacyHeaders||(m.request.setHeader(P.parentIdHeader,T.operation.id),m.request.setHeader(P.rootIdHeader,y)),v||T.operation.traceparent)m.request.setHeader(P.traceparentHeader,v||T.operation.traceparent.toString());else if(N.w3cEnabled){var I=(new D).toString();m.request.setHeader(P.traceparentHeader,I)}if(T.operation.tracestate){var x=T.operation.tracestate.toString();x&&m.request.setHeader(P.traceStateHeader,x)}var O=T.customProperties.serializeToHeader();O&&m.request.setHeader(P.correlationContextHeader,O)}catch(h){w.warn("Correlation headers could not be set. Correlation of requests may be lost.",h)}}m.request.on&&(m.request.on("response",(function(v){C.onResponse(v);var T=C.getDependencyTelemetry(m,y);T.contextObjects=T.contextObjects||{},T.contextObjects["http.RequestOptions"]=m.options,T.contextObjects["http.ClientRequest"]=m.request,T.contextObjects["http.ClientResponse"]=v,h.trackDependency(T)})),m.request.on("error",(function(v){C.onError(v);var T=C.getDependencyTelemetry(m,y);T.contextObjects=T.contextObjects||{},T.contextObjects["http.RequestOptions"]=m.options,T.contextObjects["http.ClientRequest"]=m.request,T.contextObjects.Error=v,h.trackDependency(T)})),m.request.on("abort",(function(){C.onError(new Error);var v=C.getDependencyTelemetry(m,y);v.contextObjects=v.contextObjects||{},v.contextObjects["http.RequestOptions"]=m.options,v.contextObjects["http.ClientRequest"]=m.request,h.trackDependency(v)})))}else w.info("AutoCollectHttpDependencies.trackRequest was called with invalid parameters: ",!m.options,!m.request,!h)},e.prototype.dispose=function(){e.INSTANCE=null,this.enable(!1),this._isInitialized=!1},e.disableCollectionRequestOption="disableAppInsightsAutoCollection",e.requestNumber=1,e.alreadyAutoCollectedFlag="_appInsightsAutoCollected",e}();m.exports=x}),_i=l((h,m)=>{"use strict";var v=y(18),C=ri(),T=Nn(),w=li(),A=Ci(),P=function(){function e(h){this._collectionInterval=9e5,this._vmData={},this._azInst_vmId="",this._azInst_subscriptionId="",this._azInst_osType="",e.INSTANCE||(e.INSTANCE=this),this._isInitialized=!1,this._client=h}return e.prototype.enable=function(h,m){var y=this;this._isEnabled=h,this._isEnabled&&!this._isInitialized&&(this._isInitialized=!0),h?this._handle||(this._handle=setInterval((function(){return y.trackHeartBeat(m,(function(){}))}),this._collectionInterval),this._handle.unref()):this._handle&&(clearInterval(this._handle),this._handle=null)},e.prototype.isInitialized=function(){return this._isInitialized},e.isEnabled=function(){return e.INSTANCE&&e.INSTANCE._isEnabled},e.prototype.trackHeartBeat=function(h,m){var y=this,T=!1,A={},P=w.sdkVersion;A.sdk=P,A.osType=v.type(),process.env.WEBSITE_SITE_NAME?(A.appSrv_SiteName=process.env.WEBSITE_SITE_NAME||"",A.appSrv_wsStamp=process.env.WEBSITE_HOME_STAMPNAME||"",A.appSrv_wsHost=process.env.WEBSITE_HOSTNAME||""):process.env.FUNCTIONS_WORKER_RUNTIME?A.azfunction_appId=process.env.WEBSITE_HOSTNAME:h&&(void 0===this._isVM?(T=!0,this._getAzureComputeMetadata(h,(function(){y._isVM&&Object.keys(y._vmData).length>0&&(A.azInst_vmId=y._vmData.vmId||"",A.azInst_subscriptionId=y._vmData.subscriptionId||"",A.azInst_osType=y._vmData.osType||"",y._azInst_vmId=y._vmData.vmId||"",y._azInst_subscriptionId=y._vmData.subscriptionId||"",y._azInst_osType=y._vmData.osType||""),y._client.trackMetric({name:C.HeartBeatMetricName,value:0,properties:A}),m()}))):this._isVM&&(A.azInst_vmId=this._azInst_vmId,A.azInst_subscriptionId=this._azInst_subscriptionId,A.azInst_osType=this._azInst_osType)),T||(this._client.trackMetric({name:C.HeartBeatMetricName,value:0,properties:A}),m())},e.prototype.dispose=function(){e.INSTANCE=null,this.enable(!1),this._isInitialized=!1},e.prototype._getAzureComputeMetadata=function(h,m){var y,v=this,C=((y={method:"GET"})[A.disableCollectionRequestOption]=!0,y.headers={Metadata:"True"},y),w=T.makeRequest(h,"http://169.254.169.254/metadata/instance/compute?api-version=2017-12-01&format=json",C,(function(h){if(200===h.statusCode){v._isVM=!0;var y="";h.on("data",(function(h){y+=h})),h.on("end",(function(){v._vmData=v._isJSON(y)?JSON.parse(y):{},m()}))}else m()}));w&&(w.on("error",(function(h){h&&h.message&&h.message.indexOf("ENETUNREACH")>-1&&(v._isVM=!1),m()})),w.end())},e.prototype._isJSON=function(h){try{return JSON.parse(h)&&!!h}catch(h){return!1}},e}();m.exports=P}),bi=l((h,m)=>{"use strict";var v=y(52),C=y(46),T=M(),w=Nn(),A=Mn(),P=Mr(),k=Xr(),R=ii(),N=function(){function e(h){if(e.INSTANCE)throw new Error("Server request tracking should be configured from the applicationInsights object");e.INSTANCE=this,this._client=h}return e.prototype.enable=function(h){this._isEnabled=h,(this._isAutoCorrelating||this._isEnabled||R.isEnabled())&&!this._isInitialized&&(this.useAutoCorrelation(this._isAutoCorrelating),this._initialize())},e.prototype.useAutoCorrelation=function(h,m){h&&!this._isAutoCorrelating?k.CorrelationContextManager.enable(m):!h&&this._isAutoCorrelating&&k.CorrelationContextManager.disable(),this._isAutoCorrelating=h},e.prototype.isInitialized=function(){return this._isInitialized},e.prototype.isAutoCorrelating=function(){return this._isAutoCorrelating},e.prototype._generateCorrelationContext=function(h){if(this._isAutoCorrelating)return k.CorrelationContextManager.generateContextObject(h.getOperationId(this._client.context.tags),h.getRequestId(),h.getOperationName(this._client.context.tags),h.getCorrelationContextHeader(),h.getTraceparent(),h.getTracestate())},e.prototype._initialize=function(){var h=this;this._isInitialized=!0;var r=function(m){if(m){if("function"!=typeof m)throw new Error("onRequest handler must be a function");return function(y,v){k.CorrelationContextManager.wrapEmitter(y),k.CorrelationContextManager.wrapEmitter(v);var C=y&&!y[e.alreadyAutoCollectedFlag];if(y&&C){var T=new P(y),w=h._generateCorrelationContext(T);k.CorrelationContextManager.runWithContext(w,(function(){h._isEnabled&&(y[e.alreadyAutoCollectedFlag]=!0,e.trackRequest(h._client,{request:y,response:v},T)),"function"==typeof m&&m(y,v)}))}else"function"==typeof m&&m(y,v)}}},n=function(h){var m=h.addListener.bind(h);h.addListener=function(h,y){switch(h){case"request":case"checkContinue":return m(h,r(y));default:return m(h,y)}},h.on=h.addListener},m=v.createServer;v.createServer=function(h,y){if(y&&"function"==typeof y){var v=m(h,r(y));return n(v),v}v=m(r(h));return n(v),v};var y=C.createServer;C.createServer=function(h,m){var v=y(h,r(m));return n(v),v}},e.trackRequestSync=function(h,m){if(m.request&&m.response&&h){e.addResponseCorrelationIdHeader(h,m.response);var y=k.CorrelationContextManager.getCurrentContext(),v=new P(m.request,y&&y.operation.parentId);y&&(y.operation.id=v.getOperationId(h.context.tags)||y.operation.id,y.operation.name=v.getOperationName(h.context.tags)||y.operation.name,y.operation.parentId=v.getRequestId()||y.operation.parentId,y.customProperties.addHeaderData(v.getCorrelationContextHeader())),e.endRequest(h,v,m,m.duration,m.error)}else T.info("AutoCollectHttpRequests.trackRequestSync was called with invalid parameters: ",!m.request,!m.response,!h)},e.trackRequest=function(h,m,y){if(m.request&&m.response&&h){var v=k.CorrelationContextManager.getCurrentContext(),C=y||new P(m.request,v&&v.operation.parentId);w.canIncludeCorrelationHeader(h,C.getUrl())&&e.addResponseCorrelationIdHeader(h,m.response),v&&!y&&(v.operation.id=C.getOperationId(h.context.tags)||v.operation.id,v.operation.name=C.getOperationName(h.context.tags)||v.operation.name,v.operation.parentId=C.getOperationParentId(h.context.tags)||v.operation.parentId,v.customProperties.addHeaderData(C.getCorrelationContextHeader())),m.response.once&&m.response.once("finish",(function(){e.endRequest(h,C,m,null,null)})),m.request.on&&m.request.on("error",(function(y){e.endRequest(h,C,m,null,y)})),m.request.on&&m.request.on("aborted",(function(){e.endRequest(h,C,m,null,"The request has been aborted and the network socket has closed.")}))}else T.info("AutoCollectHttpRequests.trackRequest was called with invalid parameters: ",!m.request,!m.response,!h)},e.addResponseCorrelationIdHeader=function(h,m){if(h.config&&h.config.correlationId&&m.getHeader&&m.setHeader&&!m.headersSent){var y=m.getHeader(A.requestContextHeader);w.safeIncludeCorrelationHeader(h,m,y)}},e.endRequest=function(h,m,y,v,C){C?m.onError(C,v):m.onResponse(y.response,v);var T=m.getRequestTelemetry(y);if(T.tagOverrides=m.getRequestTags(h.context.tags),y.tagOverrides)for(var w in y.tagOverrides)T.tagOverrides[w]=y.tagOverrides[w];var A=m.getLegacyRootId();A&&(T.properties.ai_legacyRootId=A),T.contextObjects=T.contextObjects||{},T.contextObjects["http.ServerRequest"]=y.request,T.contextObjects["http.ServerResponse"]=y.response,h.trackRequest(T)},e.prototype.dispose=function(){e.INSTANCE=null,this.enable(!1),this._isInitialized=!1,k.CorrelationContextManager.disable(),this._isAutoCorrelating=!1},e.alreadyAutoCollectedFlag="_appInsightsAutoCollected",e}();m.exports=N}),wi=l((h,m)=>{"use strict";var v=h&&h.__assign||function(){return(v=Object.assign||function(h){for(var m,y=1,v=arguments.length;y<v;y++)for(var C in m=arguments[y])Object.prototype.hasOwnProperty.call(m,C)&&(h[C]=m[C]);return h}).apply(this,arguments)},C=y(18),T=kr(),w=ri(),A=Nn(),P=M(),k=A.w3cTraceId(),R=function(){function e(){}return e.createQuickPulseEnvelope=function(h,m,y,v){var T=C&&"function"==typeof C.hostname&&C.hostname()||"Unknown",w=v.tags&&v.keys&&v.keys.cloudRoleInstance&&v.tags[v.keys.cloudRoleInstance]||T,A=v.tags&&v.keys&&v.keys.cloudRole&&v.tags[v.keys.cloudRole]||null;return{Documents:m.length>0?m:null,InstrumentationKey:y.instrumentationKey||"",Metrics:h.length>0?h:null,InvariantVersion:1,Timestamp:"/Date("+Date.now()+")/",Version:v.tags[v.keys.internalSdkVersion],StreamId:k,MachineName:T,Instance:w,RoleName:A}},e.createQuickPulseMetric=function(h){return{Name:h.name,Value:h.value,Weight:h.count||1}},e.telemetryEnvelopeToQuickPulseDocument=function(h){switch(h.data.baseType){case T.TelemetryTypeString.Event:return e.createQuickPulseEventDocument(h);case T.TelemetryTypeString.Exception:return e.createQuickPulseExceptionDocument(h);case T.TelemetryTypeString.Trace:return e.createQuickPulseTraceDocument(h);case T.TelemetryTypeString.Dependency:return e.createQuickPulseDependencyDocument(h);case T.TelemetryTypeString.Request:return e.createQuickPulseRequestDocument(h)}return null},e.createQuickPulseEventDocument=function(h){var m=e.createQuickPulseDocument(h),y=h.data.baseData.name;return v(v({},m),{Name:y})},e.createQuickPulseTraceDocument=function(h){var m=e.createQuickPulseDocument(h),y=h.data.baseData.severityLevel||0;return v(v({},m),{Message:h.data.baseData.message,SeverityLevel:T.SeverityLevel[y]})},e.createQuickPulseExceptionDocument=function(h){var m=e.createQuickPulseDocument(h),y=h.data.baseData.exceptions,C="",T="",w="";return y&&y.length>0&&(y[0].parsedStack&&y[0].parsedStack.length>0?y[0].parsedStack.forEach((function(h){C+=h.assembly+"\n"})):y[0].stack&&y[0].stack.length>0&&(C=y[0].stack),T=y[0].message,w=y[0].typeName),v(v({},m),{Exception:C,ExceptionMessage:T,ExceptionType:w})},e.createQuickPulseRequestDocument=function(h){var m=e.createQuickPulseDocument(h),y=h.data.baseData;return v(v({},m),{Name:y.name,Success:y.success,Duration:y.duration,ResponseCode:y.responseCode,OperationName:y.name})},e.createQuickPulseDependencyDocument=function(h){var m=e.createQuickPulseDocument(h),y=h.data.baseData;return v(v({},m),{Name:y.name,Target:y.target,Success:y.success,Duration:y.duration,ResultCode:y.resultCode,CommandName:y.data,OperationName:m.OperationId,DependencyTypeName:y.type})},e.createQuickPulseDocument=function(h){var m,y;return h.data.baseType?(y=w.TelemetryTypeStringToQuickPulseType[h.data.baseType],m=w.TelemetryTypeStringToQuickPulseDocumentType[h.data.baseType]):P.warn("Document type invalid; not sending live metric document",h.data.baseType),{DocumentType:m,__type:y,OperationId:h.tags[e.keys.operationId],Version:"1.0",Properties:e.aggregateProperties(h)}},e.aggregateProperties=function(h){var m=[],y=h.data.baseData.measurements||{};for(var v in y)if(y.hasOwnProperty(v)){var C={key:v,value:y[v]};m.push(C)}var T=h.data.baseData.properties||{};for(var v in T)if(T.hasOwnProperty(v)){C={key:v,value:T[v]};m.push(C)}return m},e.keys=new T.ContextTagKeys,e}();m.exports=R}),Ai=l((h,m)=>{"use strict";m.exports={getTransmissionTime:function(){return 1e4*(Date.now()+621355968e5)}}}),Pi=l((h,m)=>{"use strict";var v=h&&h.__awaiter||function(h,m,y,v){return new(y||(y=Promise))((function(C,T){function o(h){try{u(v.next(h))}catch(h){T(h)}}function c(h){try{u(v.throw(h))}catch(h){T(h)}}function u(h){h.done?C(h.value):function i(h){return h instanceof y?h:new y((function(m){m(h)}))}(h.value).then(o,c)}u((v=v.apply(h,m||[])).next())}))},C=h&&h.__generator||function(h,m){var y,v,C,T,w={label:0,sent:function(){if(1&C[0])throw C[1];return C[1]},trys:[],ops:[]};return T={next:o(0),throw:o(1),return:o(2)},"function"==typeof Symbol&&(T[Symbol.iterator]=function(){return this}),T;function o(T){return function(A){return function c(T){if(y)throw new TypeError("Generator is already executing.");for(;w;)try{if(y=1,v&&(C=2&T[0]?v.return:T[0]?v.throw||((C=v.return)&&C.call(v),0):v.next)&&!(C=C.call(v,T[1])).done)return C;switch(v=0,C&&(T=[2&T[0],C.value]),T[0]){case 0:case 1:C=T;break;case 4:return w.label++,{value:T[1],done:!1};case 5:w.label++,v=T[1],T=[0];continue;case 7:T=w.ops.pop(),w.trys.pop();continue;default:if(!(C=(C=w.trys).length>0&&C[C.length-1])&&(6===T[0]||2===T[0])){w=0;continue}if(3===T[0]&&(!C||T[1]>C[0]&&T[1]<C[3])){w.label=T[1];break}if(6===T[0]&&w.label<C[1]){w.label=C[1],C=T;break}if(C&&w.label<C[2]){w.label=C[2],w.ops.push(T);break}C[2]&&w.ops.pop(),w.trys.pop();continue}T=m.call(h,w)}catch(h){T=[6,h],v=0}finally{y=C=0}if(5&T[0])throw T[1];return{value:T[0]?T[1]:void 0,done:!0}}([T,A])}}},T=y(46),w=Ci(),A=M(),P=Ai(),k=Nn(),R="POST",N="x-ms-qps-transmission-time",D="x-ms-qps-service-polling-interval-hint",I="x-ms-qps-service-endpoint-redirect",x="x-ms-qps-instance-name",O="x-ms-qps-stream-id",L="x-ms-qps-machine-name",U="x-ms-qps-role-name",B="x-ms-qps-invariant-version",W="x-ms-qps-subscribed",q=function(){function e(h){this._config=h,this._consecutiveErrors=0}return e.prototype.ping=function(h,m,y){var v=[{name:O,value:h.StreamId},{name:L,value:h.MachineName},{name:U,value:h.RoleName},{name:x,value:h.Instance},{name:B,value:h.InvariantVersion.toString()}];this._submitData(h,m,y,"ping",v)},e.prototype.post=function(h,m,y){return v(this,void 0,void 0,(function(){return C(this,(function(v){switch(v.label){case 0:return[4,this._submitData([h],m,y,"post")];case 1:return v.sent(),[2]}}))}))},e.prototype._submitData=function(h,m,y,A,M){return v(this,void 0,void 0,(function(){var v,x,O,L,U,B=this;return C(this,(function(C){return v=JSON.stringify(h),(L={})[w.disableCollectionRequestOption]=!0,L.host=m&&m.length>0?m:this._config.quickPulseHost,L.method=R,L.path="/QuickPulseService.svc/"+A+"?ikey="+this._config.instrumentationKey,L.headers=((U={Expect:"100-continue"})[N]=P.getTransmissionTime(),U["Content-Type"]="application/json",U["Content-Length"]=Buffer.byteLength(v),U),x=L,M&&M.length>0&&M.forEach((function(h){return x.headers[h.name]=h.value})),this._config.httpsAgent?x.agent=this._config.httpsAgent:x.agent=k.tlsRestrictedAgent,(O=T.request(x,(function(h){if(200==h.statusCode){var m="true"===h.headers[W],v=h.headers[I]?h.headers[I].toString():null,C=h.headers[D]?parseInt(h.headers[D].toString()):null;B._consecutiveErrors=0,y(m,h,v,C)}else B._onError("StatusCode:"+h.statusCode+" StatusMessage:"+h.statusMessage),y()}))).on("error",(function(h){B._onError(h),y()})),O.write(v),O.end(),[2]}))}))},e.prototype._onError=function(h){this._consecutiveErrors++;var m="Transient error connecting to the Live Metrics endpoint. This packet will not appear in your Live Metrics Stream. Error:";this._consecutiveErrors%e.MAX_QPS_FAILURES_BEFORE_WARN==0?(m="Live Metrics endpoint could not be reached "+this._consecutiveErrors+" consecutive times. Most recent error:",A.warn(e.TAG,m,h)):A.info(e.TAG,m,h)},e.TAG="QuickPulseSender",e.MAX_QPS_FAILURES_BEFORE_WARN=25,e}();m.exports=q}),ki=l((h,m)=>{"use strict";var y=h&&h.__awaiter||function(h,m,y,v){return new(y||(y=Promise))((function(C,T){function o(h){try{u(v.next(h))}catch(h){T(h)}}function c(h){try{u(v.throw(h))}catch(h){T(h)}}function u(h){h.done?C(h.value):function i(h){return h instanceof y?h:new y((function(m){m(h)}))}(h.value).then(o,c)}u((v=v.apply(h,m||[])).next())}))},v=h&&h.__generator||function(h,m){var y,v,C,T,w={label:0,sent:function(){if(1&C[0])throw C[1];return C[1]},trys:[],ops:[]};return T={next:o(0),throw:o(1),return:o(2)},"function"==typeof Symbol&&(T[Symbol.iterator]=function(){return this}),T;function o(T){return function(A){return function c(T){if(y)throw new TypeError("Generator is already executing.");for(;w;)try{if(y=1,v&&(C=2&T[0]?v.return:T[0]?v.throw||((C=v.return)&&C.call(v),0):v.next)&&!(C=C.call(v,T[1])).done)return C;switch(v=0,C&&(T=[2&T[0],C.value]),T[0]){case 0:case 1:C=T;break;case 4:return w.label++,{value:T[1],done:!1};case 5:w.label++,v=T[1],T=[0];continue;case 7:T=w.ops.pop(),w.trys.pop();continue;default:if(!(C=(C=w.trys).length>0&&C[C.length-1])&&(6===T[0]||2===T[0])){w=0;continue}if(3===T[0]&&(!C||T[1]>C[0]&&T[1]<C[3])){w.label=T[1];break}if(6===T[0]&&w.label<C[1]){w.label=C[1],C=T;break}if(C&&w.label<C[2]){w.label=C[2],w.ops.push(T);break}C[2]&&w.ops.pop(),w.trys.pop();continue}T=m.call(h,w)}catch(h){T=[6,h],v=0}finally{y=C=0}if(5&T[0])throw T[1];return{value:T[0]?T[1]:void 0,done:!0}}([T,A])}}},C=M(),T=wi(),w=Pi(),A=ri(),P=li(),k=function(){function e(h,m){this._isCollectingData=!1,this._lastSuccessTime=Date.now(),this._lastSendSucceeded=!0,this._metrics={},this._documents=[],this._collectors=[],this._redirectedHost=null,this._pollingIntervalHint=-1,this.config=h,this.context=m||new P,this._sender=new w(this.config),this._isEnabled=!1}return e.prototype.addCollector=function(h){this._collectors.push(h)},e.prototype.trackMetric=function(h){this._addMetric(h)},e.prototype.addDocument=function(h){var m=T.telemetryEnvelopeToQuickPulseDocument(h);m&&this._documents.push(m)},e.prototype.enable=function(h){h&&!this._isEnabled?(this._isEnabled=!0,this._goQuickPulse()):!h&&this._isEnabled&&(this._isEnabled=!1,clearTimeout(this._handle),this._handle=void 0)},e.prototype.enableCollectors=function(h){this._collectors.forEach((function(m){m.enable(h)}))},e.prototype._addMetric=function(h){var m=h.value,y=h.count||1,v=A.PerformanceToQuickPulseCounter[h.name];v&&(this._metrics[v]?(this._metrics[v].Value=(this._metrics[v].Value*this._metrics[v].Weight+m*y)/(this._metrics[v].Weight+y),this._metrics[v].Weight+=y):(this._metrics[v]=T.createQuickPulseMetric(h),this._metrics[v].Name=v,this._metrics[v].Weight=1))},e.prototype._resetQuickPulseBuffer=function(){delete this._metrics,this._metrics={},this._documents.length=0},e.prototype._goQuickPulse=function(){return y(this,void 0,void 0,(function(){var h,m,y,C,w=this;return v(this,(function(v){switch(v.label){case 0:return h=Object.keys(this._metrics).map((function(h){return w._metrics[h]})),m=T.createQuickPulseEnvelope(h,this._documents.slice(),this.config,this.context),this._resetQuickPulseBuffer(),this._isCollectingData?[4,this._post(m)]:[3,2];case 1:return v.sent(),[3,3];case 2:this._ping(m),v.label=3;case 3:return y=this._pollingIntervalHint>0?this._pollingIntervalHint:e.PING_INTERVAL,C=this._isCollectingData?e.POST_INTERVAL:y,this._isCollectingData&&Date.now()-this._lastSuccessTime>=e.MAX_POST_WAIT_TIME&&!this._lastSendSucceeded?(this._isCollectingData=!1,C=e.FALLBACK_INTERVAL):!this._isCollectingData&&Date.now()-this._lastSuccessTime>=e.MAX_PING_WAIT_TIME&&!this._lastSendSucceeded&&(C=e.FALLBACK_INTERVAL),this._lastSendSucceeded=null,this._handle=setTimeout(this._goQuickPulse.bind(this),C),this._handle.unref(),[2]}}))}))},e.prototype._ping=function(h){this._sender.ping(h,this._redirectedHost,this._quickPulseDone.bind(this))},e.prototype._post=function(h){return y(this,void 0,void 0,(function(){return v(this,(function(m){switch(m.label){case 0:return[4,this._sender.post(h,this._redirectedHost,this._quickPulseDone.bind(this))];case 1:return m.sent(),[2]}}))}))},e.prototype._quickPulseDone=function(h,m,y,v){null!=h?(this._isCollectingData!==h&&(C.info("Live Metrics sending data",h),this.enableCollectors(h)),this._isCollectingData=h,y&&y.length>0&&(this._redirectedHost=y,C.info("Redirecting endpoint to: ",y)),v&&v>0&&(this._pollingIntervalHint=v),m&&m.statusCode<300&&m.statusCode>=200?(this._lastSuccessTime=Date.now(),this._lastSendSucceeded=!0):this._lastSendSucceeded=!1):this._lastSendSucceeded=!1},e.MAX_POST_WAIT_TIME=2e4,e.MAX_PING_WAIT_TIME=6e4,e.FALLBACK_INTERVAL=6e4,e.PING_INTERVAL=5e3,e.POST_INTERVAL=1e3,e}();m.exports=k}),Ri=l((h,m)=>{"use strict";var y=ri(),v=function(){function e(){}return e.parse=function(h){if(!h)return{};var m=h.split(e._FIELDS_SEPARATOR).reduce((function(h,m){var y=m.split(e._FIELD_KEY_VALUE_SEPARATOR);if(2===y.length){var v=y[0].toLowerCase(),C=y[1];h[v]=C}return h}),{});if(Object.keys(m).length>0){if(m.endpointsuffix){var v=m.location?m.location+".":"";m.ingestionendpoint=m.ingestionendpoint||"https://"+v+"dc."+m.endpointsuffix,m.liveendpoint=m.liveendpoint||"https://"+v+"live."+m.endpointsuffix}m.ingestionendpoint=m.ingestionendpoint||y.DEFAULT_BREEZE_ENDPOINT,m.liveendpoint=m.liveendpoint||y.DEFAULT_LIVEMETRICS_ENDPOINT}return m},e._FIELDS_SEPARATOR=";",e._FIELD_KEY_VALUE_SEPARATOR="=",e}();m.exports=v}),Mi=l((h,m)=>{"use strict";var v=Dn(),C=Ri(),T=(M(),ri()),w=y(20),A=function(){function e(h){var m=this;this.endpointBase=T.DEFAULT_BREEZE_ENDPOINT;var y=process.env[e.ENV_connectionString],v=C.parse(h),A=C.parse(y),P=!v.instrumentationkey&&Object.keys(v).length>0?null:h;this.instrumentationKey=v.instrumentationkey||P||A.instrumentationkey||e._getInstrumentationKey(),e._validateInstrumentationKey(this.instrumentationKey),this.endpointUrl=(v.ingestionendpoint||A.ingestionendpoint||this.endpointBase)+"/v2.1/track",this.maxBatchSize=250,this.maxBatchIntervalMs=15e3,this.disableAppInsights=!1,this.samplingPercentage=100,this.correlationIdRetryIntervalMs=3e4,this.correlationHeaderExcludedDomains=["*.core.windows.net","*.core.chinacloudapi.cn","*.core.cloudapi.de","*.core.usgovcloudapi.net","*.core.microsoft.scloud","*.core.eaglex.ic.gov"],this.setCorrelationId=function(h){return m.correlationId=h},this.proxyHttpUrl=process.env[e.ENV_http_proxy]||void 0,this.proxyHttpsUrl=process.env[e.ENV_https_proxy]||void 0,this.httpAgent=void 0,this.httpsAgent=void 0,this.profileQueryEndpoint=v.ingestionendpoint||A.ingestionendpoint||process.env[e.ENV_profileQueryEndpoint]||this.endpointBase,this._quickPulseHost=v.liveendpoint||A.liveendpoint||process.env[e.ENV_quickPulseHost]||T.DEFAULT_LIVEMETRICS_HOST,this._quickPulseHost.match(/^https?:\/\//)&&(this._quickPulseHost=w.parse(this._quickPulseHost).host)}return Object.defineProperty(e.prototype,"profileQueryEndpoint",{get:function(){return this._profileQueryEndpoint},set:function(h){v.cancelCorrelationIdQuery(this,this.setCorrelationId),this._profileQueryEndpoint=h,this.correlationId=v.correlationIdPrefix,v.queryCorrelationId(this,this.setCorrelationId)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"quickPulseHost",{get:function(){return this._quickPulseHost},set:function(h){this._quickPulseHost=h},enumerable:!1,configurable:!0}),e._getInstrumentationKey=function(){var h=process.env[e.ENV_iKey]||process.env[e.ENV_azurePrefix+e.ENV_iKey]||process.env[e.legacy_ENV_iKey]||process.env[e.ENV_azurePrefix+e.legacy_ENV_iKey];if(!h||""==h)throw new Error("Instrumentation key not found, pass the key in the config to this method or set the key in the environment variable APPINSIGHTS_INSTRUMENTATIONKEY before starting the server");return h},e._validateInstrumentationKey=function(h){return new RegExp("^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$").test(h)},e.ENV_azurePrefix="APPSETTING_",e.ENV_iKey="APPINSIGHTS_INSTRUMENTATIONKEY",e.legacy_ENV_iKey="APPINSIGHTS_INSTRUMENTATION_KEY",e.ENV_profileQueryEndpoint="APPINSIGHTS_PROFILE_QUERY_ENDPOINT",e.ENV_quickPulseHost="APPINSIGHTS_QUICKPULSE_HOST",e.ENV_connectionString="APPLICATIONINSIGHTS_CONNECTION_STRING",e.ENV_nativeMetricsDisablers="APPLICATION_INSIGHTS_DISABLE_EXTENDED_METRIC",e.ENV_nativeMetricsDisableAll="APPLICATION_INSIGHTS_DISABLE_ALL_EXTENDED_METRICS",e.ENV_http_proxy="http_proxy",e.ENV_https_proxy="https_proxy",e}();m.exports=A}),Ni=l(h=>{"use strict";var m=h&&h.__assign||function(){return(m=Object.assign||function(h){for(var m,y=1,v=arguments.length;y<v;y++)for(var C in m=arguments[y])Object.prototype.hasOwnProperty.call(m,C)&&(h[C]=m[C]);return h}).apply(this,arguments)};Object.defineProperty(h,"__esModule",{value:!0}),h.AutoCollectNativePerformance=void 0;var v=Mi(),C=li(),T=M(),w=function(){function e(h){this._disabledMetrics={},e.INSTANCE&&e.INSTANCE.dispose(),e.INSTANCE=this,this._client=h}return e.isNodeVersionCompatible=function(){var h=process.versions.node.split(".");return parseInt(h[0])>=6},e.prototype.enable=function(h,m,v){var C=this;if(void 0===m&&(m={}),void 0===v&&(v=6e4),e.isNodeVersionCompatible()){if(null==e._metricsAvailable&&h&&!this._isInitialized)try{var w=y(!function webpackMissingModule(){var h=new Error("Cannot find module 'applicationinsights-native-metrics'");throw h.code="MODULE_NOT_FOUND",h}());e._emitter=new w,e._metricsAvailable=!0,T.info("Native metrics module successfully loaded!")}catch(h){return void(e._metricsAvailable=!1)}this._isEnabled=h,this._disabledMetrics=m,this._isEnabled&&!this._isInitialized&&(this._isInitialized=!0),this._isEnabled&&e._emitter?(e._emitter.enable(!0,v),this._handle||(this._handle=setInterval((function(){return C._trackNativeMetrics()}),v),this._handle.unref())):e._emitter&&(e._emitter.enable(!1),this._handle&&(clearInterval(this._handle),this._handle=void 0))}},e.prototype.dispose=function(){this.enable(!1)},e.parseEnabled=function(h){var y=process.env[v.ENV_nativeMetricsDisableAll],C=process.env[v.ENV_nativeMetricsDisablers];if(y)return{isEnabled:!1,disabledMetrics:{}};if(C){var T=C.split(","),w={};if(T.length>0)for(var A=0,P=T;A<P.length;A++){w[P[A]]=!0}return"object"==typeof h?{isEnabled:!0,disabledMetrics:m(m({},h),w)}:{isEnabled:h,disabledMetrics:w}}return"boolean"==typeof h?{isEnabled:h,disabledMetrics:{}}:{isEnabled:!0,disabledMetrics:h}},e.prototype._trackNativeMetrics=function(){var h=!0;"object"!=typeof this._isEnabled&&(h=this._isEnabled),h&&(this._trackGarbageCollection(),this._trackEventLoop(),this._trackHeapUsage())},e.prototype._trackGarbageCollection=function(){var h;if(!this._disabledMetrics.gc){var m=e._emitter.getGCData();for(var y in m){var v=m[y].metrics,T=y+" Garbage Collection Duration",w=Math.sqrt(v.sumSquares/v.count-Math.pow(v.total/v.count,2))||0;this._client.trackMetric({name:T,value:v.total,count:v.count,max:v.max,min:v.min,stdDev:w,tagOverrides:(h={},h[this._client.context.keys.internalSdkVersion]="node-nativeperf:"+C.sdkVersion,h)})}}},e.prototype._trackEventLoop=function(){var h;if(!this._disabledMetrics.loop){var m=e._emitter.getLoopData().loopUsage;if(0!=m.count){var y=Math.sqrt(m.sumSquares/m.count-Math.pow(m.total/m.count,2))||0;this._client.trackMetric({name:"Event Loop CPU Time",value:m.total,count:m.count,min:m.min,max:m.max,stdDev:y,tagOverrides:(h={},h[this._client.context.keys.internalSdkVersion]="node-nativeperf:"+C.sdkVersion,h)})}}},e.prototype._trackHeapUsage=function(){var h,m,y;if(!this._disabledMetrics.heap){var v=process.memoryUsage(),T=v.heapUsed,w=v.heapTotal,A=v.rss;this._client.trackMetric({name:"Memory Usage (Heap)",value:T,count:1,tagOverrides:(h={},h[this._client.context.keys.internalSdkVersion]="node-nativeperf:"+C.sdkVersion,h)}),this._client.trackMetric({name:"Memory Total (Heap)",value:w,count:1,tagOverrides:(m={},m[this._client.context.keys.internalSdkVersion]="node-nativeperf:"+C.sdkVersion,m)}),this._client.trackMetric({name:"Memory Usage (Non-Heap)",value:A-w,count:1,tagOverrides:(y={},y[this._client.context.keys.internalSdkVersion]="node-nativeperf:"+C.sdkVersion,y)})}},e}();h.AutoCollectNativePerformance=w}),Di=l((h,m)=>{"use strict";var y=M(),v=function(){function e(h,m,y,v){this._buffer=[],this._lastSend=0,this._isDisabled=h,this._getBatchSize=m,this._getBatchIntervalMs=y,this._sender=v}return e.prototype.setUseDiskRetryCaching=function(h,m,y){this._sender.setDiskRetryMode(h,m,y)},e.prototype.send=function(h){var m=this;if(!this._isDisabled()){if(!h)return void y.warn("Cannot send null/undefined telemetry");if(this._buffer.push(h),this._buffer.length>=this._getBatchSize())return void this.triggerSend(!1);!this._timeoutHandle&&this._buffer.length>0&&(this._timeoutHandle=setTimeout((function(){m._timeoutHandle=null,m.triggerSend(!1)}),this._getBatchIntervalMs()))}},e.prototype.triggerSend=function(h,m){var y=this._buffer.length<1;y||(h?(this._sender.saveOnCrash(this._buffer),"function"==typeof m&&m("data saved on crash")):this._sender.send(this._buffer,m)),this._lastSend=+new Date,this._buffer=[],clearTimeout(this._timeoutHandle),this._timeoutHandle=null,y&&"function"==typeof m&&m("no data to send")},e}();m.exports=v}),Ii=l(h=>{"use strict";Object.defineProperty(h,"__esModule",{value:!0}),h.azureRoleEnvironmentTelemetryProcessor=void 0,h.azureRoleEnvironmentTelemetryProcessor=function l0(h,m){process.env.WEBSITE_SITE_NAME&&(h.tags[m.keys.cloudRole]=process.env.WEBSITE_SITE_NAME)}}),xi=l(h=>{"use strict";Object.defineProperty(h,"__esModule",{value:!0}),h.getSamplingHashCode=h.samplingTelemetryProcessor=void 0;var m=kr();function Gm(h){var m=2147483647,y=5381;if(!h)return 0;for(;h.length<8;)h+=h;for(var v=0;v<h.length;v++)y=((y<<5)+y|0)+h.charCodeAt(v)|0;return(y=y<=-2147483648?m:Math.abs(y))/m*100}h.samplingTelemetryProcessor=function p0(h,y){var v=h.sampleRate;return!!(null==v||v>=100||h.data&&m.TelemetryType.Metric===m.baseTypeToTelemetryType(h.data.baseType))||(y.correlationContext&&y.correlationContext.operation?Gm(y.correlationContext.operation.id)<v:100*Math.random()<v)},h.getSamplingHashCode=Gm}),Oi=l(h=>{"use strict";Object.defineProperty(h,"__esModule",{value:!0}),h.performanceMetricsTelemetryProcessor=void 0;var m=ii(),y=kr();h.performanceMetricsTelemetryProcessor=function d0(h,v){switch(v&&v.addDocument(h),h.data.baseType){case y.TelemetryTypeString.Exception:m.countException();break;case y.TelemetryTypeString.Request:var C=h.data.baseData;m.countRequest(C.duration,C.success);break;case y.TelemetryTypeString.Dependency:var T=h.data.baseData;m.countDependency(T.duration,T.success)}return!0}}),Li=l(h=>{"use strict";var m=h&&h.__assign||function(){return(m=Object.assign||function(h){for(var m,y=1,v=arguments.length;y<v;y++)for(var C in m=arguments[y])Object.prototype.hasOwnProperty.call(m,C)&&(h[C]=m[C]);return h}).apply(this,arguments)};Object.defineProperty(h,"__esModule",{value:!0}),h.preAggregatedMetricsTelemetryProcessor=void 0;var y=kr(),v=ci(),C=kr();h.preAggregatedMetricsTelemetryProcessor=function h0(h,T){if(v.isEnabled())switch(h.data.baseType){case C.TelemetryTypeString.Exception:var w=h.data.baseData;w.properties=m(m({},w.properties),{"_MS.ProcessedByMetricExtractors":"(Name:'Exceptions', Ver:'1.1')"});var A={cloudRoleInstance:h.tags[T.keys.cloudRoleInstance],cloudRoleName:h.tags[T.keys.cloudRole]};v.countException(A);break;case C.TelemetryTypeString.Trace:var P=h.data.baseData;P.properties=m(m({},P.properties),{"_MS.ProcessedByMetricExtractors":"(Name:'Traces', Ver:'1.1')"});var k={cloudRoleInstance:h.tags[T.keys.cloudRoleInstance],cloudRoleName:h.tags[T.keys.cloudRole],traceSeverityLevel:y.SeverityLevel[P.severity]};v.countTrace(k);break;case C.TelemetryTypeString.Request:var R=h.data.baseData;R.properties=m(m({},R.properties),{"_MS.ProcessedByMetricExtractors":"(Name:'Requests', Ver:'1.1')"});var M={cloudRoleInstance:h.tags[T.keys.cloudRoleInstance],cloudRoleName:h.tags[T.keys.cloudRole],operationSynthetic:h.tags[T.keys.operationSyntheticSource],requestSuccess:R.success,requestResultCode:R.responseCode};v.countRequest(R.duration,M);break;case C.TelemetryTypeString.Dependency:var N=h.data.baseData;N.properties=m(m({},N.properties),{"_MS.ProcessedByMetricExtractors":"(Name:'Dependencies', Ver:'1.1')"});var D={cloudRoleInstance:h.tags[T.keys.cloudRoleInstance],cloudRoleName:h.tags[T.keys.cloudRole],operationSynthetic:h.tags[T.keys.operationSyntheticSource],dependencySuccess:N.success,dependencyType:N.type,dependencyTarget:N.target,dependencyResultCode:N.resultCode};v.countDependency(N.duration,D)}return!0}}),Fi=l(h=>{"use strict";var m=h&&h.__createBinding||(Object.create?function(h,m,y,v){void 0===v&&(v=y),Object.defineProperty(h,v,{enumerable:!0,get:function(){return m[y]}})}:function(h,m,y,v){void 0===v&&(v=y),h[v]=m[y]}),y=h&&h.__exportStar||function(h,y){for(var v in h)"default"!==v&&!Object.prototype.hasOwnProperty.call(y,v)&&m(y,h,v)};Object.defineProperty(h,"__esModule",{value:!0}),y(Ii(),h),y(xi(),h),y(Oi(),h),y(Li(),h)}),Ui=l((h,m)=>{"use strict";var v=h&&h.__awaiter||function(h,m,y,v){return new(y||(y=Promise))((function(C,T){function o(h){try{u(v.next(h))}catch(h){T(h)}}function c(h){try{u(v.throw(h))}catch(h){T(h)}}function u(h){h.done?C(h.value):function i(h){return h instanceof y?h:new y((function(m){m(h)}))}(h.value).then(o,c)}u((v=v.apply(h,m||[])).next())}))},C=h&&h.__generator||function(h,m){var y,v,C,T,w={label:0,sent:function(){if(1&C[0])throw C[1];return C[1]},trys:[],ops:[]};return T={next:o(0),throw:o(1),return:o(2)},"function"==typeof Symbol&&(T[Symbol.iterator]=function(){return this}),T;function o(T){return function(A){return function c(T){if(y)throw new TypeError("Generator is already executing.");for(;w;)try{if(y=1,v&&(C=2&T[0]?v.return:T[0]?v.throw||((C=v.return)&&C.call(v),0):v.next)&&!(C=C.call(v,T[1])).done)return C;switch(v=0,C&&(T=[2&T[0],C.value]),T[0]){case 0:case 1:C=T;break;case 4:return w.label++,{value:T[1],done:!1};case 5:w.label++,v=T[1],T=[0];continue;case 7:T=w.ops.pop(),w.trys.pop();continue;default:if(!(C=(C=w.trys).length>0&&C[C.length-1])&&(6===T[0]||2===T[0])){w=0;continue}if(3===T[0]&&(!C||T[1]>C[0]&&T[1]<C[3])){w.label=T[1];break}if(6===T[0]&&w.label<C[1]){w.label=C[1],C=T;break}if(C&&w.label<C[2]){w.label=C[2],w.ops.push(T);break}C[2]&&w.ops.pop(),w.trys.pop();continue}T=m.call(h,w)}catch(h){T=[6,h],v=0}finally{y=C=0}if(5&T[0])throw T[1];return{value:T[0]?T[1]:void 0,done:!0}}([T,A])}}},T=y(21),w=y(18),A=y(7),P=y(47),k=y(41),R=M(),N=Ci(),D=Nn(),I=function(){function e(h,m,y){if(this._redirectedHost=null,this._config=h,this._onSuccess=m,this._onError=y,this._enableDiskRetryMode=!1,this._resendInterval=e.WAIT_BETWEEN_RESEND,this._maxBytesOnDisk=e.MAX_BYTES_ON_DISK,this._numConsecutiveFailures=0,this._numConsecutiveRedirects=0,this._resendTimer=null,this._fileCleanupTimer=null,this._tempDir=A.join(w.tmpdir(),e.TEMPDIR_PREFIX+this._config.instrumentationKey),!e.OS_PROVIDES_FILE_PROTECTION)if(e.USE_ICACLS){try{e.OS_PROVIDES_FILE_PROTECTION=T.existsSync(e.ICACLS_PATH)}catch(h){}e.OS_PROVIDES_FILE_PROTECTION||R.warn(e.TAG,"Could not find ICACLS in expected location! This is necessary to use disk retry mode on Windows.")}else e.OS_PROVIDES_FILE_PROTECTION=!0}return e.prototype.setDiskRetryMode=function(h,m,y){var v=this;this._enableDiskRetryMode=e.OS_PROVIDES_FILE_PROTECTION&&h,"number"==typeof m&&m>=0&&(this._resendInterval=Math.floor(m)),"number"==typeof y&&y>=0&&(this._maxBytesOnDisk=Math.floor(y)),h&&!e.OS_PROVIDES_FILE_PROTECTION&&(this._enableDiskRetryMode=!1,R.warn(e.TAG,"Ignoring request to enable disk retry mode. Sufficient file protection capabilities were not detected.")),this._enableDiskRetryMode?this._fileCleanupTimer||(this._fileCleanupTimer=setTimeout((function(){v._fileCleanupTask()}),e.CLEANUP_TIMEOUT),this._fileCleanupTimer.unref()):this._fileCleanupTimer&&clearTimeout(this._fileCleanupTimer)},e.prototype.send=function(h,m){return v(this,void 0,void 0,(function(){var y,v,T,w,A=this;return C(this,(function(C){return h&&(y=this._redirectedHost||this._config.endpointUrl,v={method:"POST",withCredentials:!1,headers:{"Content-Type":"application/x-json-stream"}},T="",h.forEach((function(h){var m=A._stringify(h);"string"==typeof m&&(T+=m+"\n")})),T.length>0&&(T=T.substring(0,T.length-1)),w=Buffer.from?Buffer.from(T):new Buffer(T),P.gzip(w,(function(C,T){var P=T;C?(R.warn(C),P=w,v.headers["Content-Length"]=w.length.toString()):(v.headers["Content-Encoding"]="gzip",v.headers["Content-Length"]=T.length.toString()),R.info(e.TAG,v),v[N.disableCollectionRequestOption]=!0;var k=D.makeRequest(A._config,y,v,(function(y){y.setEncoding("utf-8");var v="";y.on("data",(function(h){v+=h})),y.on("end",(function(){if(A._numConsecutiveFailures=0,A._enableDiskRetryMode)if(200===y.statusCode)A._resendTimer||(A._resendTimer=setTimeout((function(){A._resendTimer=null,A._sendFirstFileOnDisk()}),A._resendInterval),A._resendTimer.unref());else if(A._isRetriable(y.statusCode))try{var C=JSON.parse(v),T=[];C.errors.forEach((function(m){A._isRetriable(m.statusCode)&&T.push(h[m.index])})),T.length>0&&A._storeToDisk(T)}catch(m){A._storeToDisk(h)}if(307===y.statusCode||308===y.statusCode)if(A._numConsecutiveRedirects++,A._numConsecutiveRedirects<10){var w=y.headers.location?y.headers.location.toString():null;w&&(A._redirectedHost=w,A.send(h,m))}else"function"==typeof m&&m("Error sending telemetry because of circular redirects.");else A._numConsecutiveRedirects=0,"function"==typeof m&&m(v),R.info(e.TAG,v),"function"==typeof A._onSuccess&&A._onSuccess(v)}))}));k.on("error",(function(y){if(A._numConsecutiveFailures++,!A._enableDiskRetryMode||A._numConsecutiveFailures>0&&A._numConsecutiveFailures%e.MAX_CONNECTION_FAILURES_BEFORE_WARN==0){var v="Ingestion endpoint could not be reached. This batch of telemetry items has been lost. Use Disk Retry Caching to enable resending of failed telemetry. Error:";A._enableDiskRetryMode&&(v="Ingestion endpoint could not be reached "+A._numConsecutiveFailures+" consecutive times. There may be resulting telemetry loss. Most recent error:"),R.warn(e.TAG,v,D.dumpObj(y))}else{v="Transient failure to reach ingestion endpoint. This batch of telemetry items will be retried. Error:";R.info(e.TAG,v,D.dumpObj(y))}A._onErrorHelper(y),"function"==typeof m&&(y&&m(D.dumpObj(y)),m("Error sending telemetry")),A._enableDiskRetryMode&&A._storeToDisk(h)})),k.write(P),k.end()}))),[2]}))}))},e.prototype.saveOnCrash=function(h){this._enableDiskRetryMode&&this._storeToDiskSync(this._stringify(h))},e.prototype._isRetriable=function(h){return 206===h||408===h||429===h||439===h||500===h||503===h},e.prototype._runICACLS=function(h,m){var y=k.spawn(e.ICACLS_PATH,h,{windowsHide:!0});y.on("error",(function(h){return m(h)})),y.on("close",(function(h,y){return m(0===h?null:new Error("Setting ACL restrictions did not succeed (ICACLS returned code "+h+")"))}))},e.prototype._runICACLSSync=function(h){if(!k.spawnSync)throw new Error("Could not synchronously call ICACLS under current version of Node.js");var m=k.spawnSync(e.ICACLS_PATH,h,{windowsHide:!0});if(m.error)throw m.error;if(0!==m.status)throw new Error("Setting ACL restrictions did not succeed (ICACLS returned code "+m.status+")")},e.prototype._getACLIdentity=function(h){if(e.ACL_IDENTITY)return h(null,e.ACL_IDENTITY);var m=k.spawn(e.POWERSHELL_PATH,["-Command","[System.Security.Principal.WindowsIdentity]::GetCurrent().Name"],{windowsHide:!0,stdio:["ignore","pipe","pipe"]}),y="";m.stdout.on("data",(function(h){return y+=h})),m.on("error",(function(m){return h(m,null)})),m.on("close",(function(m,v){return e.ACL_IDENTITY=y&&y.trim(),h(0===m?null:new Error("Getting ACL identity did not succeed (PS returned code "+m+")"),e.ACL_IDENTITY)}))},e.prototype._getACLIdentitySync=function(){if(e.ACL_IDENTITY)return e.ACL_IDENTITY;if(k.spawnSync){var h=k.spawnSync(e.POWERSHELL_PATH,["-Command","[System.Security.Principal.WindowsIdentity]::GetCurrent().Name"],{windowsHide:!0,stdio:["ignore","pipe","pipe"]});if(h.error)throw h.error;if(0!==h.status)throw new Error("Getting ACL identity did not succeed (PS returned code "+h.status+")");return e.ACL_IDENTITY=h.stdout&&h.stdout.toString().trim(),e.ACL_IDENTITY}throw new Error("Could not synchronously get ACL identity under current version of Node.js")},e.prototype._getACLArguments=function(h,m){return[h,"/grant","*S-1-5-32-544:(OI)(CI)F","/grant",m+":(OI)(CI)F","/inheritance:r"]},e.prototype._applyACLRules=function(h,m){var y=this;return e.USE_ICACLS?void 0!==e.ACLED_DIRECTORIES[h]?m(e.ACLED_DIRECTORIES[h]?null:new Error("Setting ACL restrictions did not succeed (cached result)")):(e.ACLED_DIRECTORIES[h]=!1,void this._getACLIdentity((function(v,C){if(v)return e.ACLED_DIRECTORIES[h]=!1,m(v);y._runICACLS(y._getACLArguments(h,C),(function(y){return e.ACLED_DIRECTORIES[h]=!y,m(y)}))}))):m(null)},e.prototype._applyACLRulesSync=function(h){if(e.USE_ICACLS){if(void 0===e.ACLED_DIRECTORIES[h])return this._runICACLSSync(this._getACLArguments(h,this._getACLIdentitySync())),void(e.ACLED_DIRECTORIES[h]=!0);if(!e.ACLED_DIRECTORIES[h])throw new Error("Setting ACL restrictions did not succeed (cached result)")}},e.prototype._confirmDirExists=function(h,m){var y=this;T.lstat(h,(function(v,C){v&&"ENOENT"===v.code?T.mkdir(h,(function(v){v&&"EEXIST"!==v.code?m(v):y._applyACLRules(h,m)})):!v&&C.isDirectory()?y._applyACLRules(h,m):m(v||new Error("Path existed but was not a directory"))}))},e.prototype._getShallowDirectorySize=function(h,m){T.readdir(h,(function(y,v){if(y)return m(y,-1);var C=null,w=0,P=0;if(0!==v.length)for(var k=0;k<v.length;k++)T.stat(A.join(h,v[k]),(function(h,y){P++,h?C=h:y.isFile()&&(w+=y.size),P===v.length&&m(C,C?-1:w)}));else m(null,0)}))},e.prototype._getShallowDirectorySizeSync=function(h){for(var m=T.readdirSync(h),y=0,v=0;v<m.length;v++)y+=T.statSync(A.join(h,m[v])).size;return y},e.prototype._storeToDisk=function(h){var m=this;R.info(e.TAG,"Checking existence of data storage directory: "+this._tempDir),this._confirmDirExists(this._tempDir,(function(y){if(y)return R.warn(e.TAG,"Error while checking/creating directory: "+(y&&y.message)),void m._onErrorHelper(y);m._getShallowDirectorySize(m._tempDir,(function(y,v){if(y||v<0)return R.warn(e.TAG,"Error while checking directory size: "+(y&&y.message)),void m._onErrorHelper(y);if(v>m._maxBytesOnDisk)R.warn(e.TAG,"Not saving data due to max size limit being met. Directory size in bytes is: "+v);else{var C=(new Date).getTime()+".ai.json",w=A.join(m._tempDir,C);R.info(e.TAG,"saving data to disk at: "+w),T.writeFile(w,m._stringify(h),{mode:384},(function(h){return m._onErrorHelper(h)}))}}))}))},e.prototype._storeToDiskSync=function(h){try{R.info(e.TAG,"Checking existence of data storage directory: "+this._tempDir),T.existsSync(this._tempDir)||T.mkdirSync(this._tempDir),this._applyACLRulesSync(this._tempDir);var m=this._getShallowDirectorySizeSync(this._tempDir);if(m>this._maxBytesOnDisk)return void R.info(e.TAG,"Not saving data due to max size limit being met. Directory size in bytes is: "+m);var y=(new Date).getTime()+".ai.json",v=A.join(this._tempDir,y);R.info(e.TAG,"saving data before crash to disk at: "+v),T.writeFileSync(v,h,{mode:384})}catch(h){R.warn(e.TAG,"Error while saving data to disk: "+(h&&h.message)),this._onErrorHelper(h)}},e.prototype._sendFirstFileOnDisk=function(){var h=this;T.exists(this._tempDir,(function(m){m&&T.readdir(h._tempDir,(function(m,y){if(m)h._onErrorHelper(m);else if((y=y.filter((function(h){return A.basename(h).indexOf(".ai.json")>-1}))).length>0){var v=y[0],C=A.join(h._tempDir,v);T.readFile(C,(function(m,y){m?h._onErrorHelper(m):T.unlink(C,(function(m){if(m)h._onErrorHelper(m);else try{var v=JSON.parse(y.toString());h.send(v)}catch(h){R.warn("Failed to read persisted file",h)}}))}))}}))}))},e.prototype._onErrorHelper=function(h){"function"==typeof this._onError&&this._onError(h)},e.prototype._stringify=function(h){try{return JSON.stringify(h)}catch(m){R.warn("Failed to serialize payload",m,h)}},e.prototype._fileCleanupTask=function(){var h=this;T.exists(this._tempDir,(function(m){m&&T.readdir(h._tempDir,(function(m,y){m?h._onErrorHelper(m):(y=y.filter((function(h){return A.basename(h).indexOf(".ai.json")>-1}))).length>0&&y.forEach((function(m){var y=new Date(parseInt(m.split(".ai.json")[0]));if(new Date(+new Date-e.FILE_RETEMPTION_PERIOD)>y){var v=A.join(h._tempDir,m);T.unlink(v,(function(m){m&&h._onErrorHelper(m)}))}}))}))}))},e.TAG="Sender",e.ICACLS_PATH=process.env.systemdrive+"/windows/system32/icacls.exe",e.POWERSHELL_PATH=process.env.systemdrive+"/windows/system32/windowspowershell/v1.0/powershell.exe",e.ACLED_DIRECTORIES={},e.ACL_IDENTITY=null,e.WAIT_BETWEEN_RESEND=6e4,e.MAX_BYTES_ON_DISK=52428800,e.MAX_CONNECTION_FAILURES_BEFORE_WARN=5,e.CLEANUP_TIMEOUT=36e5,e.FILE_RETEMPTION_PERIOD=6048e5,e.TEMPDIR_PREFIX="appInsights-node",e.OS_PROVIDES_FILE_PROTECTION=!1,e.USE_ICACLS="Windows_NT"===w.type(),e}();m.exports=I}),ji=l((h,m)=>{"use strict";var y=kr(),v=Nn(),C=Xr(),T=function(){function e(){}return e.createEnvelope=function(h,m,C,T,w){var A=null;switch(m){case y.TelemetryType.Trace:A=e.createTraceData(h);break;case y.TelemetryType.Dependency:A=e.createDependencyData(h);break;case y.TelemetryType.Event:A=e.createEventData(h);break;case y.TelemetryType.Exception:A=e.createExceptionData(h);break;case y.TelemetryType.Request:A=e.createRequestData(h);break;case y.TelemetryType.Metric:A=e.createMetricData(h);break;case y.TelemetryType.Availability:A=e.createAvailabilityData(h);break;case y.TelemetryType.PageView:A=e.createPageViewData(h)}if(C&&y.domainSupportsProperties(A.baseData)){if(A&&A.baseData)if(A.baseData.properties)for(var P in C)A.baseData.properties[P]||(A.baseData.properties[P]=C[P]);else A.baseData.properties=C;A.baseData.properties=v.validateStringMap(A.baseData.properties)}var k=w&&w.instrumentationKey||"",R=new y.Envelope;return R.data=A,R.iKey=k,R.name="Microsoft.ApplicationInsights."+k.replace(/-/g,"")+"."+A.baseType.substr(0,A.baseType.length-4),R.tags=this.getTags(T,h.tagOverrides),R.time=(new Date).toISOString(),R.ver=1,R.sampleRate=w?w.samplingPercentage:100,m===y.TelemetryType.Metric&&(R.sampleRate=100),R},e.createTraceData=function(h){var m=new y.MessageData;m.message=h.message,m.properties=h.properties,isNaN(h.severity)?m.severityLevel=y.SeverityLevel.Information:m.severityLevel=h.severity;var v=new y.Data;return v.baseType=y.telemetryTypeToBaseType(y.TelemetryType.Trace),v.baseData=m,v},e.createDependencyData=function(h){var m=new y.RemoteDependencyData;"string"==typeof h.name&&(m.name=h.name.length>1024?h.name.slice(0,1021)+"...":h.name),m.data=h.data,m.target=h.target,m.duration=v.msToTimeSpan(h.duration),m.success=h.success,m.type=h.dependencyTypeName,m.properties=h.properties,m.resultCode=h.resultCode?h.resultCode+"":"",h.id?m.id=h.id:m.id=v.w3cTraceId();var C=new y.Data;return C.baseType=y.telemetryTypeToBaseType(y.TelemetryType.Dependency),C.baseData=m,C},e.createEventData=function(h){var m=new y.EventData;m.name=h.name,m.properties=h.properties,m.measurements=h.measurements;var v=new y.Data;return v.baseType=y.telemetryTypeToBaseType(y.TelemetryType.Event),v.baseData=m,v},e.createExceptionData=function(h){var m=new y.ExceptionData;m.properties=h.properties,isNaN(h.severity)?m.severityLevel=y.SeverityLevel.Error:m.severityLevel=h.severity,m.measurements=h.measurements,m.exceptions=[];var C=h.exception.stack,T=new y.ExceptionDetails;T.message=h.exception.message,T.typeName=h.exception.name,T.parsedStack=this.parseStack(C),T.hasFullStack=v.isArray(T.parsedStack)&&T.parsedStack.length>0,m.exceptions.push(T);var w=new y.Data;return w.baseType=y.telemetryTypeToBaseType(y.TelemetryType.Exception),w.baseData=m,w},e.createRequestData=function(h){var m=new y.RequestData;h.id?m.id=h.id:m.id=v.w3cTraceId(),m.name=h.name,m.url=h.url,m.source=h.source,m.duration=v.msToTimeSpan(h.duration),m.responseCode=h.resultCode?h.resultCode+"":"",m.success=h.success,m.properties=h.properties;var C=new y.Data;return C.baseType=y.telemetryTypeToBaseType(y.TelemetryType.Request),C.baseData=m,C},e.createMetricData=function(h){var m=new y.MetricData;m.metrics=[];var v=new y.DataPoint;v.count=isNaN(h.count)?1:h.count,v.kind=y.DataPointType.Aggregation,v.max=isNaN(h.max)?h.value:h.max,v.min=isNaN(h.min)?h.value:h.min,v.name=h.name,v.stdDev=isNaN(h.stdDev)?0:h.stdDev,v.value=h.value,m.metrics.push(v),m.properties=h.properties;var C=new y.Data;return C.baseType=y.telemetryTypeToBaseType(y.TelemetryType.Metric),C.baseData=m,C},e.createAvailabilityData=function(h){var m=new y.AvailabilityData;h.id?m.id=h.id:m.id=v.w3cTraceId(),m.name=h.name,m.duration=v.msToTimeSpan(h.duration),m.success=h.success,m.runLocation=h.runLocation,m.message=h.message,m.measurements=h.measurements,m.properties=h.properties;var C=new y.Data;return C.baseType=y.telemetryTypeToBaseType(y.TelemetryType.Availability),C.baseData=m,C},e.createPageViewData=function(h){var m=new y.PageViewData;m.name=h.name,m.duration=v.msToTimeSpan(h.duration),m.url=h.url,m.measurements=h.measurements,m.properties=h.properties;var C=new y.Data;return C.baseType=y.telemetryTypeToBaseType(y.TelemetryType.PageView),C.baseData=m,C},e.getTags=function(h,m){var y=C.CorrelationContextManager.getCurrentContext(),v={};if(h&&h.tags)for(var T in h.tags)v[T]=h.tags[T];if(m)for(var T in m)v[T]=m[T];return y&&(v[h.keys.operationId]=v[h.keys.operationId]||y.operation.id,v[h.keys.operationName]=v[h.keys.operationName]||y.operation.name,v[h.keys.operationParentId]=v[h.keys.operationParentId]||y.operation.parentId),v},e.parseStack=function(h){var m=void 0;if("string"==typeof h){var y=h.split("\n");m=[];for(var v=0,C=0,T=0;T<=y.length;T++){var A=y[T];if(w.regex.test(A)){var P=new w(y[T],v++);C+=P.sizeInBytes,m.push(P)}}if(C>32768)for(var k=0,R=m.length-1,M=0,N=k,D=R;k<R;){if((M+=m[k].sizeInBytes+m[R].sizeInBytes)>32768){var I=D-N+1;m.splice(N,I);break}N=k,D=R,k++,R--}}return m},e}(),w=function(){function e(h,m){this.sizeInBytes=0,this.level=m,this.method="<no_method>",this.assembly=v.trim(h);var y=h.match(e.regex);y&&y.length>=5&&(this.method=v.trim(y[2])||this.method,this.fileName=v.trim(y[4])||"<no_filename>",this.line=parseInt(y[5])||0),this.sizeInBytes+=this.method.length,this.sizeInBytes+=this.fileName.length,this.sizeInBytes+=this.assembly.length,this.sizeInBytes+=e.baseSize,this.sizeInBytes+=this.level.toString().length,this.sizeInBytes+=this.line.toString().length}return e.regex=/^(\s+at)?(.*?)(\@|\s\(|\s)([^\(\n]+):(\d+):(\d+)(\)?)$/,e.baseSize=58,e}();m.exports=T}),Bi=l((h,m)=>{"use strict";var v=y(20),C=Mi(),T=li(),w=kr(),A=Di(),P=Fi(),k=Xr(),R=Ui(),N=Nn(),D=M(),I=ji(),x=function(){function e(h){this._telemetryProcessors=[],this._enableAzureProperties=!1;var m=new C(h);this.config=m,this.context=new T,this.commonProperties={};var y=new R(this.config);this.channel=new A((function(){return m.disableAppInsights}),(function(){return m.maxBatchSize}),(function(){return m.maxBatchIntervalMs}),y)}return e.prototype.trackAvailability=function(h){this.track(h,w.TelemetryType.Availability)},e.prototype.trackPageView=function(h){this.track(h,w.TelemetryType.PageView)},e.prototype.trackTrace=function(h){this.track(h,w.TelemetryType.Trace)},e.prototype.trackMetric=function(h){this.track(h,w.TelemetryType.Metric)},e.prototype.trackException=function(h){h&&h.exception&&!N.isError(h.exception)&&(h.exception=new Error(h.exception.toString())),this.track(h,w.TelemetryType.Exception)},e.prototype.trackEvent=function(h){this.track(h,w.TelemetryType.Event)},e.prototype.trackRequest=function(h){this.track(h,w.TelemetryType.Request)},e.prototype.trackDependency=function(h){h&&!h.target&&h.data&&(h.target=v.parse(h.data).host),this.track(h,w.TelemetryType.Dependency)},e.prototype.flush=function(h){this.channel.triggerSend(!!h&&!!h.isAppCrashing,h?h.callback:void 0)},e.prototype.track=function(h,m){if(h&&w.telemetryTypeToBaseType(m)){var y=I.createEnvelope(h,m,this.commonProperties,this.context,this.config);h.time&&(y.time=h.time.toISOString()),this._enableAzureProperties&&P.azureRoleEnvironmentTelemetryProcessor(y,this.context);var v=this.runTelemetryProcessors(y,h.contextObjects);v=v&&P.samplingTelemetryProcessor(y,{correlationContext:k.CorrelationContextManager.getCurrentContext()}),P.preAggregatedMetricsTelemetryProcessor(y,this.context),v&&(P.performanceMetricsTelemetryProcessor(y,this.quickPulseClient),this.channel.send(y))}else D.warn("track() requires telemetry object and telemetryType to be specified.")},e.prototype.setAutoPopulateAzureProperties=function(h){this._enableAzureProperties=h},e.prototype.addTelemetryProcessor=function(h){this._telemetryProcessors.push(h)},e.prototype.clearTelemetryProcessors=function(){this._telemetryProcessors=[]},e.prototype.runTelemetryProcessors=function(h,m){var y=!0,v=this._telemetryProcessors.length;if(0===v)return y;(m=m||{}).correlationContext=k.CorrelationContextManager.getCurrentContext();for(var C=0;C<v;++C)try{var T=this._telemetryProcessors[C];if(T&&!1===T.apply(null,[h,m])){y=!1;break}}catch(m){y=!0,D.warn("One of telemetry processors failed, telemetry item will be sent.",m,h)}return y&&(h&&h.tags&&(h.tags=N.validateStringMap(h.tags)),h&&h.data&&h.data.baseData&&h.data.baseData.properties&&(h.data.baseData.properties=N.validateStringMap(h.data.baseData.properties))),y},e}();m.exports=x}),Hi=l((h,m)=>{"use strict";var y,v=h&&h.__extends||(y=function(h,m){return(y=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(h,m){h.__proto__=m}||function(h,m){for(var y in m)Object.prototype.hasOwnProperty.call(m,y)&&(h[y]=m[y])})(h,m)},function(h,m){function n(){this.constructor=h}y(h,m),h.prototype=null===m?Object.create(m):(n.prototype=m.prototype,new n)}),C=Bi(),T=bi(),w=Ci(),A=M(),P=function(h){function t(){return null!==h&&h.apply(this,arguments)||this}return v(t,h),t.prototype.trackNodeHttpRequestSync=function(h){h&&h.request&&h.response&&h.duration?T.trackRequestSync(this,h):A.warn("trackNodeHttpRequestSync requires NodeHttpRequestTelemetry object with request, response and duration specified.")},t.prototype.trackNodeHttpRequest=function(h){(h.duration||h.error)&&A.warn("trackNodeHttpRequest will ignore supplied duration and error parameters. These values are collected from the request and response objects."),h&&h.request&&h.response?T.trackRequest(this,h):A.warn("trackNodeHttpRequest requires NodeHttpRequestTelemetry object with request and response specified.")},t.prototype.trackNodeHttpDependency=function(h){h&&h.request?w.trackRequest(this,h):A.warn("trackNodeHttpDependency requires NodeHttpDependencyTelemetry object with request specified.")},t}(C);m.exports=P}),qi=l(h=>{"use strict";Object.defineProperty(h,"__esModule",{value:!0})}),Yi=l(h=>{"use strict";Object.defineProperty(h,"__esModule",{value:!0}),h.dispose=h.Configuration=h.wrapWithCorrelationContext=h.startOperation=h.getCorrelationContext=h.start=h.setup=h.liveMetricsClient=h.defaultClient=h.DistributedTracingModes=void 0;var m,y,v=Xr(),C=ti(),T=ni(),w=ii(),A=ci(),P=_i(),k=Ci(),R=bi(),N=Dn(),D=M(),I=ki(),x=Ni();h.TelemetryClient=Hi(),h.Contracts=kr(),h.azureFunctionsTypes=qi(),(y=m=h.DistributedTracingModes||(h.DistributedTracingModes={}))[y.AI=0]="AI",y[y.AI_AND_W3C=1]="AI_AND_W3C";var O,L,U,B,W,q,Y,V,$,z,G,J=!0,X=!1,Z=!0,ee=!0,te=!0,re=!1,ie=!0,se=!0,oe=!0,ae=!0,ce=!1,le=!0,ue=void 0,de=void 0,he=!1;function PE(){return h.defaultClient?(he=!0,U.enable(J,X),B.enable(Z),W.enable(ee),q.enable(te),Y.enable(re,h.defaultClient.config),V.enable(le,L),$.useAutoCorrelation(ae,O),$.enable(ie),z.enable(se),h.liveMetricsClient&&ce&&h.liveMetricsClient.enable(ce)):D.warn("Start cannot be called before setup"),pe}h.setup=function B0(m){return h.defaultClient?D.info("The default client is already setup"):(h.defaultClient=new h.TelemetryClient(m),U=new C(h.defaultClient),B=new T(h.defaultClient),W=new w(h.defaultClient),q=new A(h.defaultClient),Y=new P(h.defaultClient),$=new R(h.defaultClient),z=new k(h.defaultClient),V||(V=new x.AutoCollectNativePerformance(h.defaultClient))),h.defaultClient&&h.defaultClient.channel&&h.defaultClient.channel.setUseDiskRetryCaching(oe,ue,de),pe},h.start=PE,h.getCorrelationContext=function G0(){return ae?v.CorrelationContextManager.getCurrentContext():null},h.startOperation=function F0(h,m){return v.CorrelationContextManager.startOperation(h,m)},h.wrapWithCorrelationContext=function V0(h,m){return v.CorrelationContextManager.wrapCallback(h,m)};var pe=function(){function e(){}return e.setDistributedTracingMode=function(h){return N.w3cEnabled=h===m.AI_AND_W3C,e},e.setAutoCollectConsole=function(h,m){return void 0===m&&(m=!1),J=h,X=m,he&&U.enable(h,m),e},e.setAutoCollectExceptions=function(h){return Z=h,he&&B.enable(h),e},e.setAutoCollectPerformance=function(h,m){void 0===m&&(m=!0),ee=h;var y=x.AutoCollectNativePerformance.parseEnabled(m);return le=y.isEnabled,L=y.disabledMetrics,he&&(W.enable(h),V.enable(y.isEnabled,y.disabledMetrics)),e},e.setAutoCollectPreAggregatedMetrics=function(h){return te=h,he&&q.enable(h),e},e.setAutoCollectHeartbeat=function(m){return re=m,he&&Y.enable(m,h.defaultClient.config),e},e.setAutoCollectRequests=function(h){return ie=h,he&&$.enable(h),e},e.setAutoCollectDependencies=function(h){return se=h,he&&z.enable(h),e},e.setAutoDependencyCorrelation=function(h,m){return ae=h,O=m,he&&$.useAutoCorrelation(h,m),e},e.setUseDiskRetryCaching=function(m,y,v){return oe=m,ue=y,de=v,h.defaultClient&&h.defaultClient.channel&&h.defaultClient.channel.setUseDiskRetryCaching(m,y,v),e},e.setInternalLogging=function(h,m){return void 0===h&&(h=!1),void 0===m&&(m=!0),D.enableDebug=h,D.disableWarnings=!m,e},e.setSendLiveMetrics=function(m){return void 0===m&&(m=!1),h.defaultClient?(!h.liveMetricsClient&&m?(h.liveMetricsClient=new I(h.defaultClient.config,null),G=new w(h.liveMetricsClient,1e3,!0),h.liveMetricsClient.addCollector(G),h.defaultClient.quickPulseClient=h.liveMetricsClient):h.liveMetricsClient&&h.liveMetricsClient.enable(m),ce=m,e):(D.warn("Live metrics client cannot be setup without the default client"),e)},e.start=PE,e}();h.Configuration=pe,h.dispose=function $0(){N.w3cEnabled=!0,h.defaultClient=null,he=!1,U&&U.dispose(),B&&B.dispose(),W&&W.dispose(),q&&q.dispose(),Y&&Y.dispose(),V&&V.dispose(),$&&$.dispose(),z&&z.dispose(),h.liveMetricsClient&&(h.liveMetricsClient.enable(!1),ce=!1,h.liveMetricsClient=void 0)}});((h,m)=>{for(var y in ml(h),m)C(h,y,{get:m[y],enumerable:!0})})(m,{default:()=>es});var Vi=Gi(y(18)),$i=Gi(y(0)),Ki=Gi(Yi()),zi=Gi(y(0)),Ji=class{constructor(h,m,y,v,C){this.extensionId=h,this.extensionVersion=m,this.telemetryAppender=y,this.osShim=v,this.firstParty=!1,this.userOptIn=!1,this.firstParty=!!C,this.updateUserOptStatus(),void 0!==zi.env.onDidChangeTelemetryEnabled?this.optOutListener=zi.env.onDidChangeTelemetryEnabled(()=>this.updateUserOptStatus()):this.optOutListener=zi.workspace.onDidChangeConfiguration(()=>this.updateUserOptStatus())}updateUserOptStatus(){let h=zi.workspace.getConfiguration(Ji.TELEMETRY_CONFIG_ID),m=void 0===zi.env.isTelemetryEnabled?h.get(Ji.TELEMETRY_CONFIG_ENABLED_ID,!0):zi.env.isTelemetryEnabled;this.userOptIn!==m&&(this.userOptIn=m)}cleanRemoteName(h){if(!h)return"none";let m="other";return["ssh-remote","dev-container","attached-container","wsl"].forEach(y=>{0===h.indexOf(`${y}+`)&&(m=y)}),m}get extension(){return void 0===this._extension&&(this._extension=zi.extensions.getExtension(this.extensionId)),this._extension}cloneAndChange(h,m){if(null===h||"object"!=typeof h||"function"!=typeof m)return h;let y={};for(let v in h)y[v]=m(v,h[v]);return y}shouldSendErrorTelemetry(){return!this.firstParty||("other"!==this.cleanRemoteName(zi.env.remoteName)||!(void 0===this.extension||this.extension.extensionKind===zi.ExtensionKind.Workspace||zi.env.uiKind===zi.UIKind.Web))}getCommonProperties(){let h=Object.create(null);if(h["common.os"]=this.osShim.platform,h["common.platformversion"]=(this.osShim.release||"").replace(/^(\d+)(\.\d+)?(\.\d+)?(.*)/,"$1$2$3"),h["common.extname"]=this.extensionId,h["common.extversion"]=this.extensionVersion,zi&&zi.env){switch(h["common.vscodemachineid"]=zi.env.machineId,h["common.vscodesessionid"]=zi.env.sessionId,h["common.vscodeversion"]=zi.version,h["common.isnewappinstall"]=zi.env.isNewAppInstall.toString(),zi.env.uiKind){case zi.UIKind.Web:h["common.uikind"]="web";break;case zi.UIKind.Desktop:h["common.uikind"]="desktop";break;default:h["common.uikind"]="unknown"}h["common.remotename"]=this.cleanRemoteName(zi.env.remoteName)}return h}anonymizeFilePaths(h,m){let y;if(null==h)return"";let v=[];""!==zi.env.appRoot&&v.push(new RegExp(zi.env.appRoot.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),"gi")),this.extension&&v.push(new RegExp(this.extension.extensionPath.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),"gi"));let C=h;if(m){let m=[];for(let C of v)for(;(y=C.exec(h))&&y;)m.push([y.index,C.lastIndex]);let T=/^[\\/]?(node_modules|node_modules\.asar)[\\/]/,w=/(file:\/\/)?([a-zA-Z]:(\\\\|\\|\/)|(\\\\|\\|\/))?([\w-._]+(\\\\|\\|\/))+[\w-._]*/g,A=0;for(C="";(y=w.exec(h))&&y;)y[0]&&!T.test(y[0])&&m.every(([h,m])=>y.index<h||y.index>=m)&&(C+=h.substring(A,y.index)+"<REDACTED: user-file-path>",A=w.lastIndex);A<h.length&&(C+=h.substr(A))}for(let h of v)C=C.replace(h,"");return C}removePropertiesWithPossibleUserInfo(h){if("object"!=typeof h)return;let m=Object.create(null);for(let y of Object.keys(h)){let v=h[y];if(!v)continue;let C=/@[a-zA-Z0-9-.]+/;/\S*(key|token|sig|password|passwd|pwd)[="':\s]+\S*/.test(v.toLowerCase())?m[y]="<REDACTED: secret>":C.test(v)?m[y]="<REDACTED: email>":m[y]=v}return m}sendTelemetryEvent(h,m,y){if(this.userOptIn&&""!==h){m=Vt(Vt({},m),this.getCommonProperties());let v=this.cloneAndChange(m,(h,m)=>this.anonymizeFilePaths(m,this.firstParty));this.telemetryAppender.logEvent(`${this.extensionId}/${h}`,{properties:this.removePropertiesWithPossibleUserInfo(v),measurements:y})}}sendTelemetryErrorEvent(h,m,y,v){if(this.userOptIn&&""!==h){m=Vt(Vt({},m),this.getCommonProperties());let C=this.cloneAndChange(m,(h,m)=>this.shouldSendErrorTelemetry()?this.anonymizeFilePaths(m,this.firstParty):void 0===v||-1!==v.indexOf(h)?"REDACTED":this.anonymizeFilePaths(m,this.firstParty));this.telemetryAppender.logEvent(`${this.extensionId}/${h}`,{properties:this.removePropertiesWithPossibleUserInfo(C),measurements:y})}}sendTelemetryException(h,m,y){if(this.shouldSendErrorTelemetry()&&this.userOptIn&&h){m=Vt(Vt({},m),this.getCommonProperties());let v=this.cloneAndChange(m,(h,m)=>this.anonymizeFilePaths(m,this.firstParty));h.stack&&(h.stack=this.anonymizeFilePaths(h.stack,this.firstParty)),this.telemetryAppender.logException(h,{properties:this.removePropertiesWithPossibleUserInfo(v),measurements:y})}}dispose(){return this.telemetryAppender.flush(),this.optOutListener.dispose()}},Xi=Ji;Xi.TELEMETRY_CONFIG_ID="telemetry",Xi.TELEMETRY_CONFIG_ENABLED_ID="enableTelemetry";var es=class extends Xi{constructor(h,m,y,v){let C=new class{constructor(h){Ki.defaultClient?(this._appInsightsClient=new Ki.TelemetryClient(h),this._appInsightsClient.channel.setUseDiskRetryCaching(!0)):(Ki.setup(h).setAutoCollectRequests(!1).setAutoCollectPerformance(!1).setAutoCollectExceptions(!1).setAutoCollectDependencies(!1).setAutoDependencyCorrelation(!1).setAutoCollectConsole(!1).setUseDiskRetryCaching(!0).start(),this._appInsightsClient=Ki.defaultClient),$i&&$i.env&&(this._appInsightsClient.context.tags[this._appInsightsClient.context.keys.userId]=$i.env.machineId,this._appInsightsClient.context.tags[this._appInsightsClient.context.keys.sessionId]=$i.env.sessionId,this._appInsightsClient.context.tags[this._appInsightsClient.context.keys.cloudRole]=$i.env.appName),h&&0===h.indexOf("AIF-")&&(this._appInsightsClient.config.endpointUrl="https://vortex.data.microsoft.com/collect/v1")}logEvent(h,m){!this._appInsightsClient||this._appInsightsClient.trackEvent({name:h,properties:null==m?void 0:m.properties,measurements:null==m?void 0:m.measurements})}logException(h,m){!this._appInsightsClient||this._appInsightsClient.trackException({exception:h,properties:null==m?void 0:m.properties,measurements:null==m?void 0:m.measurements})}flush(){return this._appInsightsClient&&(this._appInsightsClient.flush(),this._appInsightsClient=void 0),Promise.resolve(void 0)}}(y);y&&0===y.indexOf("AIF-")&&(v=!0),super(h,m,C,{release:Vi.release(),platform:Vi.platform()},v)}}},function(h,m){h.exports=require("console")},function(h,m){function webpackEmptyContext(h){var m=new Error("Cannot find module '"+h+"'");throw m.code="MODULE_NOT_FOUND",m}webpackEmptyContext.keys=function(){return[]},webpackEmptyContext.resolve=webpackEmptyContext,h.exports=webpackEmptyContext,webpackEmptyContext.id=891},function(h,m){function webpackEmptyContext(h){var m=new Error("Cannot find module '"+h+"'");throw m.code="MODULE_NOT_FOUND",m}webpackEmptyContext.keys=function(){return[]},webpackEmptyContext.resolve=webpackEmptyContext,h.exports=webpackEmptyContext,webpackEmptyContext.id=892},function(h,m){h.exports=require("async_hooks")},function(h,m){h.exports=require("dns")},function(h,m,y){"use strict";var v=this&&this.__awaiter||function(h,m,y,v){return new(y||(y=Promise))((function(C,T){function fulfilled(h){try{step(v.next(h))}catch(h){T(h)}}function rejected(h){try{step(v.throw(h))}catch(h){T(h)}}function step(h){h.done?C(h.value):function adopt(h){return h instanceof y?h:new y((function(m){m(h)}))}(h.value).then(fulfilled,rejected)}step((v=v.apply(h,m||[])).next())}))};Object.defineProperty(m,"__esModule",{value:!0});const C=y(8),T=y(896),w=y(156),A=y(374);m.telemetryCommandDecorator=function telemetryCommandDecorator(h,m,y,v=1,T){return new TelemetryCommandDecorator(C.Telemetry,h,m,y,v,T).setup()};class TelemetryCommandDecorator extends A.CommandDecoratorBase{constructor(h,m,y,v,C,T){super(),this.telemetry=h,this.telemetryEventName=m,this.telemetryFaultEventName=y,this.commandTitle=v,this.telemetryEventVersion=C,this.onError=T}invoke(h,m,y){return v(this,void 0,void 0,(function*(){let v,A=void 0,P=this.telemetry.startTimedEvent(this.telemetryEventName),k=C.TelemetryResult.Success,R="";y.telemetryEvent=P,this.telemetry.setCorrelationEvent(P),P.addProperty(w.TelemetryPropertyNames.COMMAND_TEXT,y.commandText),P.addMeasure(w.TelemetryPropertyNames.TELEMETRY_EVENT_VERSION,this.telemetryEventVersion),this.addInvocationTelemetryProperties(P,m.telemetryProperties);try{v=yield h(m,y),P.addProperty(C.TelemetryPropertyNames.EVENT_RESULT,C.TelemetryResult.Success)}catch(h){throw k=T.TelemetryUtil.DeriveTelemetryResult(h),R=T.TelemetryUtil.BuildTelemetryMessage(this.commandTitle,k,h.message),P.addProperty(C.TelemetryPropertyNames.EVENT_RESULT,k),this.onError&&this.onError(h,y,m),this.telemetry.sendFault(this.telemetryFaultEventName,T.TelemetryUtil.MapTelemetryResultToFaultType(k),R,h),A=h,h}finally{R=R||T.TelemetryUtil.BuildTelemetryMessage(this.commandTitle,C.TelemetryResult.Success);const h=P.end(k,R);y.trace.traceEvent(T.TelemetryUtil.MapTelemetryResultToTraceEventType(k),0,`Command [${y.commandName}]: ${R} (${h}ms)`),A&&(A.hasRecorded=!0)}return v}))}addInvocationTelemetryProperties(h,m={}){for(let y of Object.keys(m))h.addProperty(y,m[y])}}m.TelemetryCommandDecorator=TelemetryCommandDecorator},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0});const v=y(15),C=y(91),T=y(8);m.TelemetryUtil=class TelemetryUtil{static DeriveTelemetryResult(h){return h instanceof C.CommandError?h.telemetryResult:T.TelemetryResult.Failure}static DeriveTelemetryTitle(h,m){let y="Success";return m===T.TelemetryResult.UserFailure?y="User Failure":m===T.TelemetryResult.Cancel?y="Cancelled":m===T.TelemetryResult.IndeterminateFailure?y="Indeterminate Failure":m===T.TelemetryResult.Failure?y="Failure":m===T.TelemetryResult.NonBlockingFailure?y="Non Blocking Failure":m===T.TelemetryResult.ByDesignFailure&&(y="By Design Failure"),`${h} ${y}`}static BuildTelemetryMessage(h,m,y){let v="";return void 0!==y&&(v=`: ${y}`),`${this.DeriveTelemetryTitle(h,m)}${v}`}static MapTelemetryResultToFaultType(h){switch(h){case T.TelemetryResult.UserFailure:return T.FaultType.User;case T.TelemetryResult.Cancel:return T.FaultType.UserCancelled;case T.TelemetryResult.Failure:return T.FaultType.Error;case T.TelemetryResult.NonBlockingFailure:return T.FaultType.NonBlockingFault;case T.TelemetryResult.ByDesignFailure:return T.FaultType.ByDesign;case T.TelemetryResult.IndeterminateFailure:default:return T.FaultType.Unknown}}static MapTelemetryResultToTraceEventType(h){return h===T.TelemetryResult.Success?v.LogLevel.Info:v.LogLevel.Error}}},function(h,m,y){"use strict";var v=this&&this.__awaiter||function(h,m,y,v){return new(y||(y=Promise))((function(C,T){function fulfilled(h){try{step(v.next(h))}catch(h){T(h)}}function rejected(h){try{step(v.throw(h))}catch(h){T(h)}}function step(h){h.done?C(h.value):function adopt(h){return h instanceof y?h:new y((function(m){m(h)}))}(h.value).then(fulfilled,rejected)}step((v=v.apply(h,m||[])).next())}))};Object.defineProperty(m,"__esModule",{value:!0});const C=y(374),T=y(375),w=y(376),A=y(377),P=y(378),k=y(379),R=y(8);m.errorNotificationCommandDecorator=function errorNotificationCommandDecorator(h,m,y=!1,v){return new ErrorNotificationCommandDecorator(T.NotificationUtil,R.Telemetry,m,h,y,v).setup()};class ErrorNotificationCommandDecorator extends C.CommandDecoratorBase{constructor(h,m,y,v,C,T){super(),this.notificationUtil=h,this.telemetry=m,this.telemetryFaultEventName=y,this.title=v,this.isModalError=C,this.onError=T}invoke(h,m,y){return v(this,void 0,void 0,(function*(){const{cancellationTokenSource:v}=y;let C;y.commandName=this.title;try{C=yield h(m,y)}catch(h){try{const m=h.userMessage||h.message,y=m?`${this.title}: ${m}`:this.title;h instanceof P.CancellationError&&v&&!v.token.isCancellationRequested&&v.cancel();const C=h instanceof A.UserError||h instanceof P.CancellationError;h.isSuppressUserNotification||h instanceof P.CancellationError&&!m||(C?this.notificationUtil.showInformationMessage(y,!1):h instanceof w.ByDesignError?yield this.notificationUtil.showErrorMessage(y,{modal:this.isModalError}):h instanceof k.NonBlockingError||(yield this.notificationUtil.showErrorMessage(y,{modal:this.isModalError})))}catch(m){h=m}if(h&&!h.hasRecorded){const m=`${this.title}: [unhandled exception (decorator)] ${h.message}`;y.trace.error(m),this.telemetry.sendFault(this.telemetryFaultEventName,R.FaultType.Error,m,h)}h&&this.onError&&(yield this.onError(h,y,m))}return C}))}}m.ErrorNotificationCommandDecorator=ErrorNotificationCommandDecorator},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0});m.CommandBase=class CommandBase{}},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0}),function(h){h.LOCAL_DEPENDENCY="ERR_LOCAL_DEPENDENCY",h.NOT_SUPPORTED="ERR_NOT_SUPPORTED",h.REMOTE_DEPENDENCY="ERR_REMOTE_DEPENDENCY",h.UNAUTHORIZED="ERR_UNAUTHORIZED",h.FORBIDDEN_ANONYMOUS="ERR_FORBIDDEN_ANONYMOUS",h.NETWORK_ERROR="ERR_NETWORK",h.BAD_REQUEST="ERR_BAD_REQUEST"}(m.CommandErrorCode||(m.CommandErrorCode={}))},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0});class OptOutTelemetryFilter{constructor(){this.enableTelemetry=!0,this.updateUserOptIn(),this.configListener=OptOutTelemetryFilter.vscode.workspace.onDidChangeConfiguration(()=>this.updateUserOptIn())}shouldSend(h,m,y){return this.enableTelemetry}updateUserOptIn(){const h=OptOutTelemetryFilter.vscode.workspace.getConfiguration("telemetry");this.enableTelemetry=h.get("enableTelemetry",!0)}dispose(){return this.configListener.dispose()}static get vscode(){return y(0)}}m.OptOutTelemetryFilter=OptOutTelemetryFilter},function(h,m,y){"use strict";var v=this&&this.__awaiter||function(h,m,y,v){return new(y||(y=Promise))((function(C,T){function fulfilled(h){try{step(v.next(h))}catch(h){T(h)}}function rejected(h){try{step(v.throw(h))}catch(h){T(h)}}function step(h){h.done?C(h.value):function adopt(h){return h instanceof y?h:new y((function(m){m(h)}))}(h.value).then(fulfilled,rejected)}step((v=v.apply(h,m||[])).next())}))};Object.defineProperty(m,"__esModule",{value:!0});const C=y(7),T=y(124),w=y(902),A=y(903),P=[".log",".blog"];m.LogZipExporter=class LogZipExporter{static createLogZipFileAsync(h,m){return v(this,void 0,void 0,(function*(){const y=(yield w.findFilesAsync(m,m,h=>P.indexOf(C.extname(h))>=0)).sort(),v=new A.ZipFile;v.outputStream.pipe(T.fileAccess.createWriteStream(h)),y.forEach(h=>{v.addFile(C.join(m,h),h)}),v.end()}))}}},function(h,m,y){"use strict";var v=this&&this.__awaiter||function(h,m,y,v){return new(y||(y=Promise))((function(C,T){function fulfilled(h){try{step(v.next(h))}catch(h){T(h)}}function rejected(h){try{step(v.throw(h))}catch(h){T(h)}}function step(h){h.done?C(h.value):function adopt(h){return h instanceof y?h:new y((function(m){m(h)}))}(h.value).then(fulfilled,rejected)}step((v=v.apply(h,m||[])).next())}))};Object.defineProperty(m,"__esModule",{value:!0});const C=y(7),T=y(124);m.readdirAsync=h=>new Promise((m,y)=>{T.fileAccess.readdir(h,(h,v)=>h?y(h):m(v))}),m.statAsync=h=>new Promise((m,y)=>{T.fileAccess.stat(h,(h,v)=>h?y(h):m(v))}),m.findFilesAsync=(h,y,T)=>v(void 0,void 0,void 0,(function*(){let v=[],w=[];try{w=yield m.readdirAsync(y)}catch(h){}for(let A of w){const w=C.join(y,A);let P;try{P=yield m.statAsync(w)}catch(h){continue}if(P.isDirectory()){const y=yield m.findFilesAsync(h,w,T);v=v.concat(y)}else{const m=C.relative(h,w);T&&!T(m)||v.push(m)}}return v}))},function(h,m,y){var v=y(21),C=y(19).Transform,T=y(19).PassThrough,w=y(47),A=y(10),P=y(13).EventEmitter,k=y(904);function ZipFile(){this.outputStream=new T,this.entries=[],this.outputStreamCursor=0,this.ended=!1,this.allDone=!1,this.forceZip64Eocd=!1}m.ZipFile=ZipFile,m.dateToDosDateTime=dateToDosDateTime,A.inherits(ZipFile,P),ZipFile.prototype.addFile=function(h,m,y){var C=this;m=validateMetadataPath(m,!1),null==y&&(y={});var T=new Entry(m,!1,y);C.entries.push(T),v.stat(h,(function(m,w){return m?C.emit("error",m):w.isFile()?(T.uncompressedSize=w.size,null==y.mtime&&T.setLastModDate(w.mtime),null==y.mode&&T.setFileAttributesMode(w.mode),T.setFileDataPumpFunction((function(){var m=v.createReadStream(h);T.state=Entry.FILE_DATA_IN_PROGRESS,m.on("error",(function(h){C.emit("error",h)})),pumpFileDataReadStream(C,T,m)})),void pumpEntries(C)):C.emit("error",new Error("not a file: "+h))}))},ZipFile.prototype.addReadStream=function(h,m,y){var v=this;null==y&&(y={});var C=new Entry(m=validateMetadataPath(m,!1),!1,y);v.entries.push(C),C.setFileDataPumpFunction((function(){C.state=Entry.FILE_DATA_IN_PROGRESS,pumpFileDataReadStream(v,C,h)})),pumpEntries(v)},ZipFile.prototype.addBuffer=function(h,m,y){var v=this;if(m=validateMetadataPath(m,!1),h.length>1073741823)throw new Error("buffer too large: "+h.length+" > 1073741823");if(null==y&&(y={}),null!=y.size)throw new Error("options.size not allowed");var C=new Entry(m,!1,y);function setCompressedBuffer(h){C.compressedSize=h.length,C.setFileDataPumpFunction((function(){writeToOutputStream(v,h),writeToOutputStream(v,C.getDataDescriptor()),C.state=Entry.FILE_DATA_DONE,setImmediate((function(){pumpEntries(v)}))})),pumpEntries(v)}C.uncompressedSize=h.length,C.crc32=k.unsigned(h),C.crcAndFileSizeKnown=!0,v.entries.push(C),C.compress?w.deflateRaw(h,(function(h,m){setCompressedBuffer(m)})):setCompressedBuffer(h)},ZipFile.prototype.addEmptyDirectory=function(h,m){var y=this;if(h=validateMetadataPath(h,!0),null==m&&(m={}),null!=m.size)throw new Error("options.size not allowed");if(null!=m.compress)throw new Error("options.compress not allowed");var v=new Entry(h,!0,m);y.entries.push(v),v.setFileDataPumpFunction((function(){writeToOutputStream(y,v.getDataDescriptor()),v.state=Entry.FILE_DATA_DONE,pumpEntries(y)})),pumpEntries(y)};var R=bufferFrom([80,75,5,6]);function writeToOutputStream(h,m){h.outputStream.write(m),h.outputStreamCursor+=m.length}function pumpFileDataReadStream(h,m,y){var v=new Crc32Watcher,C=new ByteCounter,A=m.compress?new w.DeflateRaw:new T,P=new ByteCounter;y.pipe(v).pipe(C).pipe(A).pipe(P).pipe(h.outputStream,{end:!1}),P.on("end",(function(){if(m.crc32=v.crc32,null==m.uncompressedSize)m.uncompressedSize=C.byteCount;else if(m.uncompressedSize!==C.byteCount)return h.emit("error",new Error("file data stream has unexpected number of bytes"));m.compressedSize=P.byteCount,h.outputStreamCursor+=m.compressedSize,writeToOutputStream(h,m.getDataDescriptor()),m.state=Entry.FILE_DATA_DONE,pumpEntries(h)}))}function pumpEntries(h){if(!h.allDone){if(h.ended&&null!=h.finalSizeCallback){var m=function calculateFinalSize(h){for(var m=0,y=0,v=0;v<h.entries.length;v++){var C=h.entries[v];if(C.compress)return-1;if(C.state>=Entry.READY_TO_PUMP_FILE_DATA){if(null==C.uncompressedSize)return-1}else if(null==C.uncompressedSize)return null;C.relativeOffsetOfLocalHeader=m;var T=C.useZip64Format();m+=x+C.utf8FileName.length,m+=C.uncompressedSize,C.crcAndFileSizeKnown||(m+=T?B:U),y+=W+C.utf8FileName.length+C.fileComment.length,T&&(y+=q)}var w=0;(h.forceZip64Eocd||h.entries.length>=65535||y>=65535||m>=4294967295)&&(w+=M+N);return w+=D+h.comment.length,m+y+w}(h);null!=m&&(h.finalSizeCallback(m),h.finalSizeCallback=null)}var y=function getFirstNotDoneEntry(){for(var m=0;m<h.entries.length;m++){var y=h.entries[m];if(y.state<Entry.FILE_DATA_DONE)return y}return null}();if(null!=y){if(y.state<Entry.READY_TO_PUMP_FILE_DATA)return;if(y.state===Entry.FILE_DATA_IN_PROGRESS)return;y.relativeOffsetOfLocalHeader=h.outputStreamCursor;var v=y.getLocalFileHeader();writeToOutputStream(h,v),y.doFileDataPump()}else h.ended&&(h.offsetOfStartOfCentralDirectory=h.outputStreamCursor,h.entries.forEach((function(m){var y=m.getCentralDirectoryRecord();writeToOutputStream(h,y)})),writeToOutputStream(h,function getEndOfCentralDirectoryRecord(h,m){var y=!1,v=h.entries.length;(h.forceZip64Eocd||h.entries.length>=65535)&&(v=65535,y=!0);var C=h.outputStreamCursor-h.offsetOfStartOfCentralDirectory,T=C;(h.forceZip64Eocd||C>=4294967295)&&(T=4294967295,y=!0);var w=h.offsetOfStartOfCentralDirectory;(h.forceZip64Eocd||h.offsetOfStartOfCentralDirectory>=4294967295)&&(w=4294967295,y=!0);if(m)return y?M+N+D:D;var A=bufferAlloc(D+h.comment.length);if(A.writeUInt32LE(101010256,0),A.writeUInt16LE(0,4),A.writeUInt16LE(0,6),A.writeUInt16LE(v,8),A.writeUInt16LE(v,10),A.writeUInt32LE(T,12),A.writeUInt32LE(w,16),A.writeUInt16LE(h.comment.length,20),h.comment.copy(A,22),!y)return A;var P=bufferAlloc(M);P.writeUInt32LE(101075792,0),writeUInt64LE(P,M-12,4),P.writeUInt16LE(L,12),P.writeUInt16LE(O,14),P.writeUInt32LE(0,16),P.writeUInt32LE(0,20),writeUInt64LE(P,h.entries.length,24),writeUInt64LE(P,h.entries.length,32),writeUInt64LE(P,C,40),writeUInt64LE(P,h.offsetOfStartOfCentralDirectory,48);var k=bufferAlloc(N);return k.writeUInt32LE(117853008,0),k.writeUInt32LE(0,4),writeUInt64LE(k,h.outputStreamCursor,8),k.writeUInt32LE(1,16),Buffer.concat([P,k,A])}(h)),h.outputStream.end(),h.allDone=!0)}}ZipFile.prototype.end=function(h,m){if("function"==typeof h&&(m=h,h=null),null==h&&(h={}),!this.ended){if(this.ended=!0,this.finalSizeCallback=m,this.forceZip64Eocd=!!h.forceZip64Format,h.comment){if("string"==typeof h.comment?this.comment=function encodeCp437(h){if(/^[\x20-\x7e]*$/.test(h))return bufferFrom(h,"utf-8");if(null==V){V={};for(var m=0;m<Y.length;m++)V[Y[m]]=m}var y=bufferAlloc(h.length);for(m=0;m<h.length;m++){var v=V[h[m]];if(null==v)throw new Error("character not encodable in CP437: "+JSON.stringify(h[m]));y[m]=v}return y}(h.comment):this.comment=h.comment,this.comment.length>65535)throw new Error("comment is too large");if(bufferIncludes(this.comment,R))throw new Error("comment contains end of central directory record signature")}else this.comment=I;pumpEntries(this)}};var M=56,N=20,D=22;function validateMetadataPath(h,m){if(""===h)throw new Error("empty metadataPath");if(h=h.replace(/\\/g,"/"),/^[a-zA-Z]:/.test(h)||/^\//.test(h))throw new Error("absolute path: "+h);if(-1!==h.split("/").indexOf(".."))throw new Error("invalid relative path: "+h);var y=/\/$/.test(h);if(m)y||(h+="/");else if(y)throw new Error("file path cannot end with '/': "+h);return h}var I=bufferAlloc(0);function Entry(h,m,y){if(this.utf8FileName=bufferFrom(h),this.utf8FileName.length>65535)throw new Error("utf8 file name too long. "+utf8FileName.length+" > 65535");if(this.isDirectory=m,this.state=Entry.WAITING_FOR_METADATA,this.setLastModDate(null!=y.mtime?y.mtime:new Date),null!=y.mode?this.setFileAttributesMode(y.mode):this.setFileAttributesMode(m?16893:33204),m?(this.crcAndFileSizeKnown=!0,this.crc32=0,this.uncompressedSize=0,this.compressedSize=0):(this.crcAndFileSizeKnown=!1,this.crc32=null,this.uncompressedSize=null,this.compressedSize=null,null!=y.size&&(this.uncompressedSize=y.size)),m?this.compress=!1:(this.compress=!0,null!=y.compress&&(this.compress=!!y.compress)),this.forceZip64Format=!!y.forceZip64Format,y.fileComment){if("string"==typeof y.fileComment?this.fileComment=bufferFrom(y.fileComment,"utf-8"):this.fileComment=y.fileComment,this.fileComment.length>65535)throw new Error("fileComment is too large")}else this.fileComment=I}Entry.WAITING_FOR_METADATA=0,Entry.READY_TO_PUMP_FILE_DATA=1,Entry.FILE_DATA_IN_PROGRESS=2,Entry.FILE_DATA_DONE=3,Entry.prototype.setLastModDate=function(h){var m=dateToDosDateTime(h);this.lastModFileTime=m.time,this.lastModFileDate=m.date},Entry.prototype.setFileAttributesMode=function(h){if((65535&h)!==h)throw new Error("invalid mode. expected: 0 <= "+h+" <= 65535");this.externalFileAttributes=h<<16>>>0},Entry.prototype.setFileDataPumpFunction=function(h){this.doFileDataPump=h,this.state=Entry.READY_TO_PUMP_FILE_DATA},Entry.prototype.useZip64Format=function(){return this.forceZip64Format||null!=this.uncompressedSize&&this.uncompressedSize>4294967294||null!=this.compressedSize&&this.compressedSize>4294967294||null!=this.relativeOffsetOfLocalHeader&&this.relativeOffsetOfLocalHeader>4294967294};var x=30,O=45,L=831;Entry.prototype.getLocalFileHeader=function(){var h=0,m=0,y=0;this.crcAndFileSizeKnown&&(h=this.crc32,m=this.compressedSize,y=this.uncompressedSize);var v=bufferAlloc(x),C=2048;return this.crcAndFileSizeKnown||(C|=8),v.writeUInt32LE(67324752,0),v.writeUInt16LE(20,4),v.writeUInt16LE(C,6),v.writeUInt16LE(this.getCompressionMethod(),8),v.writeUInt16LE(this.lastModFileTime,10),v.writeUInt16LE(this.lastModFileDate,12),v.writeUInt32LE(h,14),v.writeUInt32LE(m,18),v.writeUInt32LE(y,22),v.writeUInt16LE(this.utf8FileName.length,26),v.writeUInt16LE(0,28),Buffer.concat([v,this.utf8FileName])};var U=16,B=24;Entry.prototype.getDataDescriptor=function(){return this.crcAndFileSizeKnown?I:this.useZip64Format()?((h=bufferAlloc(B)).writeUInt32LE(134695760,0),h.writeUInt32LE(this.crc32,4),writeUInt64LE(h,this.compressedSize,8),writeUInt64LE(h,this.uncompressedSize,16),h):((h=bufferAlloc(U)).writeUInt32LE(134695760,0),h.writeUInt32LE(this.crc32,4),h.writeUInt32LE(this.compressedSize,8),h.writeUInt32LE(this.uncompressedSize,12),h);var h};var W=46,q=28;function dateToDosDateTime(h){var m=0;m|=31&h.getDate(),m|=(h.getMonth()+1&15)<<5,m|=(h.getFullYear()-1980&127)<<9;var y=0;return y|=Math.floor(h.getSeconds()/2),y|=(63&h.getMinutes())<<5,{date:m,time:y|=(31&h.getHours())<<11}}function writeUInt64LE(h,m,y){var v=Math.floor(m/4294967296),C=m%4294967296;h.writeUInt32LE(C,y),h.writeUInt32LE(v,y+4)}function ByteCounter(h){C.call(this,h),this.byteCount=0}function Crc32Watcher(h){C.call(this,h),this.crc32=0}Entry.prototype.getCentralDirectoryRecord=function(){var h=bufferAlloc(W),m=2048;this.crcAndFileSizeKnown||(m|=8);var y,v,C=this.compressedSize,T=this.uncompressedSize,w=this.relativeOffsetOfLocalHeader;return this.useZip64Format()?(C=4294967295,T=4294967295,w=4294967295,y=O,(v=bufferAlloc(q)).writeUInt16LE(1,0),v.writeUInt16LE(q-4,2),writeUInt64LE(v,this.uncompressedSize,4),writeUInt64LE(v,this.compressedSize,12),writeUInt64LE(v,this.relativeOffsetOfLocalHeader,20)):(y=20,v=I),h.writeUInt32LE(33639248,0),h.writeUInt16LE(L,4),h.writeUInt16LE(y,6),h.writeUInt16LE(m,8),h.writeUInt16LE(this.getCompressionMethod(),10),h.writeUInt16LE(this.lastModFileTime,12),h.writeUInt16LE(this.lastModFileDate,14),h.writeUInt32LE(this.crc32,16),h.writeUInt32LE(C,20),h.writeUInt32LE(T,24),h.writeUInt16LE(this.utf8FileName.length,28),h.writeUInt16LE(v.length,30),h.writeUInt16LE(this.fileComment.length,32),h.writeUInt16LE(0,34),h.writeUInt16LE(0,36),h.writeUInt32LE(this.externalFileAttributes,38),h.writeUInt32LE(w,42),Buffer.concat([h,this.utf8FileName,v,this.fileComment])},Entry.prototype.getCompressionMethod=function(){return this.compress?8:0},A.inherits(ByteCounter,C),ByteCounter.prototype._transform=function(h,m,y){this.byteCount+=h.length,y(null,h)},A.inherits(Crc32Watcher,C),Crc32Watcher.prototype._transform=function(h,m,y){this.crc32=k.unsigned(h,this.crc32),y(null,h)};var Y="\0 !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_`abcdefghijklmnopqrstuvwxyz{|}~";if(256!==Y.length)throw new Error("assertion failure");var V=null;function bufferAlloc(h){bufferAlloc=function modern(h){return Buffer.allocUnsafe(h)};try{return bufferAlloc(h)}catch(m){return(bufferAlloc=function legacy(h){return new Buffer(h)})(h)}}function bufferFrom(h,m){bufferFrom=function modern(h,m){return Buffer.from(h,m)};try{return bufferFrom(h,m)}catch(y){return(bufferFrom=function legacy(h,m){return new Buffer(h,m)})(h,m)}}function bufferIncludes(h,m){bufferIncludes=function modern(h,m){return h.includes(m)};try{return bufferIncludes(h,m)}catch(y){return(bufferIncludes=function legacy(h,m){for(var y=0;y<=h.length-m.length;y++)for(var v=0;;v++){if(v===m.length)return!0;if(h[y+v]!==m[v])break}return!1})(h,m)}}},function(h,m,y){var v=y(9).Buffer,C=[0,1996959894,3993919788,2567524794,124634137,1886057615,3915621685,2657392035,249268274,2044508324,3772115230,2547177864,162941995,2125561021,3887607047,2428444049,498536548,1789927666,4089016648,2227061214,450548861,1843258603,4107580753,2211677639,325883990,1684777152,4251122042,2321926636,335633487,1661365465,4195302755,2366115317,997073096,1281953886,3579855332,2724688242,1006888145,1258607687,3524101629,2768942443,901097722,1119000684,3686517206,2898065728,853044451,1172266101,3705015759,2882616665,651767980,1373503546,3369554304,3218104598,565507253,1454621731,3485111705,3099436303,671266974,1594198024,3322730930,2970347812,795835527,1483230225,3244367275,3060149565,1994146192,31158534,2563907772,4023717930,1907459465,112637215,2680153253,3904427059,2013776290,251722036,2517215374,3775830040,2137656763,141376813,2439277719,3865271297,1802195444,476864866,2238001368,4066508878,1812370925,453092731,2181625025,4111451223,1706088902,314042704,2344532202,4240017532,1658658271,366619977,2362670323,4224994405,1303535960,984961486,2747007092,3569037538,1256170817,1037604311,2765210733,3554079995,1131014506,879679996,2909243462,3663771856,1141124467,855842277,2852801631,3708648649,1342533948,654459306,3188396048,3373015174,1466479909,544179635,3110523913,3462522015,1591671054,702138776,2966460450,3352799412,1504918807,783551873,3082640443,3233442989,3988292384,2596254646,62317068,1957810842,3939845945,2647816111,81470997,1943803523,3814918930,2489596804,225274430,2053790376,3826175755,2466906013,167816743,2097651377,4027552580,2265490386,503444072,1762050814,4150417245,2154129355,426522225,1852507879,4275313526,2312317920,282753626,1742555852,4189708143,2394877945,397917763,1622183637,3604390888,2714866558,953729732,1340076626,3518719985,2797360999,1068828381,1219638859,3624741850,2936675148,906185462,1090812512,3747672003,2825379669,829329135,1181335161,3412177804,3160834842,628085408,1382605366,3423369109,3138078467,570562233,1426400815,3317316542,2998733608,733239954,1555261956,3268935591,3050360625,752459403,1541320221,2607071920,3965973030,1969922972,40735498,2617837225,3943577151,1913087877,83908371,2512341634,3803740692,2075208622,213261112,2463272603,3855990285,2094854071,198958881,2262029012,4057260610,1759359992,534414190,2176718541,4139329115,1873836001,414664567,2282248934,4279200368,1711684554,285281116,2405801727,4167216745,1634467795,376229701,2685067896,3608007406,1308918612,956543938,2808555105,3495958263,1231636301,1047427035,2932959818,3654703836,1088359270,936918e3,2847714899,3736837829,1202900863,817233897,3183342108,3401237130,1404277552,615818150,3134207493,3453421203,1423857449,601450431,3009837614,3294710456,1567103746,711928724,3020668471,3272380065,1510334235,755167117];function ensureBuffer(h){if(v.isBuffer(h))return h;var m="function"==typeof v.alloc&&"function"==typeof v.from;if("number"==typeof h)return m?v.alloc(h):new v(h);if("string"==typeof h)return m?v.from(h):new v(h);throw new Error("input must be buffer, number, or string, received "+typeof h)}function bufferizeInt(h){var m=ensureBuffer(4);return m.writeInt32BE(h,0),m}function _crc32(h,m){h=ensureBuffer(h),v.isBuffer(m)&&(m=m.readUInt32BE(0));for(var y=-1^~~m,T=0;T<h.length;T++)y=C[255&(y^h[T])]^y>>>8;return-1^y}function crc32(){return bufferizeInt(_crc32.apply(null,arguments))}"undefined"!=typeof Int32Array&&(C=new Int32Array(C)),crc32.signed=function(){return _crc32.apply(null,arguments)},crc32.unsigned=function(){return _crc32.apply(null,arguments)>>>0},h.exports=crc32},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0});const v=y(122);m.getExtensionUri=function getExtensionUri(h,m){const C=y(0);return m=m||v.getExtensionContext(),C.Uri.joinPath(m.extensionUri,h)}},function(h,m,y){"use strict";var v=this&&this.__awaiter||function(h,m,y,v){return new(y||(y=Promise))((function(C,T){function fulfilled(h){try{step(v.next(h))}catch(h){T(h)}}function rejected(h){try{step(v.throw(h))}catch(h){T(h)}}function step(h){h.done?C(h.value):function adopt(h){return h instanceof y?h:new y((function(m){m(h)}))}(h.value).then(fulfilled,rejected)}step((v=v.apply(h,m||[])).next())}))};Object.defineProperty(m,"__esModule",{value:!0});const C=y(20),T=y(219),w=y(220),A=/\b\w{2,20}:\/\/(?:localhost|127\.0\.0\.1|0\.0\.0\.0|:\d{2,5})[\w\-\.\~:\/\?\#[\]\@!\$&\(\)\*\+\,\;\=]*/gim;class UrlScraper extends(T.Inittable(T.Disposable(Object))){constructor(){super(...arguments),this.eventEmitter=new(y(0).EventEmitter)}get onDidMatchLocalUrl(){return this.eventEmitter.event}processData(h){((h=h.replace(UrlScraper.terminalCodesRegex,"")).match(A)||[]).forEach(h=>{const m=C.parse(h);if(m){const h=parseFloat(m.port);!isNaN(h)&&Number.isInteger(h)&&h>0&&h<=65535&&(m.hostname="localhost",m.host=`${m.hostname}:${h}`,this.eventEmitter.fire({port:h,serverUrl:m}))}})}}UrlScraper.terminalCodesRegex=/(?:\u001B|\u009B)[\[\]()#;?]*(?:(?:(?:[a-zA-Z0-9]*(?:;[a-zA-Z0-9]*)*)?\u0007)|(?:(?:\d{1,4}(?:;\d{0,4})*)?[0-9A-PR-TZcf-ntqry=><~]))/g,m.launchUrlScraper=function launchUrlScraper(h){return v(this,void 0,void 0,(function*(){return yield w.DataScrapingManager.Instance.registerDataScraper("local-url-scraper",()=>{const m=new UrlScraper;return m.onDidMatchLocalUrl(m=>{const{port:y,serverUrl:v}=m,T={port:y,browseUrl:C.format(v),displayName:v.host};h(T)}),m})}))}},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0}),m.createTerminalRenderer=function createTerminalRenderer(h){return new TerminalVirtualProcessAdaptor(h)};class TerminalVirtualProcessAdaptor{constructor(h){this.name=h;const m=y(0);this.acceptInputEmitter=new m.EventEmitter,this.changeMaximumDimensionsEmitter=new m.EventEmitter,this.writeEmitter=new m.EventEmitter,this.overrideDimensionsEmitter=new m.EventEmitter,this.terminal=m.window.createTerminal({name:h,pty:{onDidWrite:this.writeEmitter.event,onDidOverrideDimensions:this.overrideDimensionsEmitter.event,handleInput:h=>this.acceptInputEmitter.fire(h),setDimensions:h=>this.setPtyDimensions(h),open:h=>this.openPty(h),close:()=>{}}})}show(){this.terminal.show()}sendText(h,m){this.terminal.sendText(h,m)}hide(){this.terminal.hide()}dispose(){this.terminal.dispose()}get dimensions(){return this.terminalDimensions}set dimensions(h){h&&(this.terminalDimensions&&this.terminalDimensions.columns===h.columns&&this.terminalDimensions.rows===h.rows||(this.terminalDimensions=h,this.isStarted&&(this.isOverrideDimensionsFired=!0,this.overrideDimensionsEmitter.fire(h))))}get maximumDimensions(){return this.terminalMaximumDimensions}write(h){this.isStarted?this.writeEmitter.fire(h):this.writeBuffer=(this.writeBuffer||"")+h}get onDidAcceptInput(){return this.acceptInputEmitter.event}get onDidChangeMaximumDimensions(){return this.changeMaximumDimensionsEmitter.event}setPtyDimensions(h){h&&(this.terminalDimensions?this.terminalDimensions={columns:Math.min(this.terminalDimensions.columns,h.columns),rows:Math.min(this.terminalDimensions.rows,h.rows)}:this.terminalDimensions=h,this.terminalMaximumDimensions=h,this.changeMaximumDimensionsEmitter.fire(h),this.terminalDimensions.columns===h.columns&&this.terminalDimensions.rows===h.rows||this.isOverrideDimensionsFired||(this.isOverrideDimensionsFired=!0,this.overrideDimensionsEmitter.fire(this.terminalDimensions)))}openPty(h){this.isStarted=!0,this.setPtyDimensions(h),this.writeBuffer&&(this.writeEmitter.fire(this.writeBuffer),this.writeBuffer=void 0)}}},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0});const v=y(124);m.fileAccessInstance=v.fileAccess},function(h,m,y){"use strict";var v=this&&this.__awaiter||function(h,m,y,v){return new(y||(y=Promise))((function(C,T){function fulfilled(h){try{step(v.next(h))}catch(h){T(h)}}function rejected(h){try{step(v.throw(h))}catch(h){T(h)}}function step(h){h.done?C(h.value):function adopt(h){return h instanceof y?h:new y((function(m){m(h)}))}(h.value).then(fulfilled,rejected)}step((v=v.apply(h,m||[])).next())}))};Object.defineProperty(m,"__esModule",{value:!0});const C=y(6),T=y(380),w=y(382);class VscodeSessionStatusProvider extends T.VscodeActivityProvider{constructor(h,m){super(h.createChild("session-status-provider")),this.activityTimeout=m,this.statusChangedEvent=new C.Emitter,this.currentActivityStatus=!1,this.resetStatusTimerId=null,this.onActivity()}get sessionStatus(){return this.currentActivityStatus?w.VscodeSessionStatus.Active:w.VscodeSessionStatus.Idle}get onSessionStatusChanged(){return this.statusChangedEvent.event}reset(){this.currentActivityStatus||(this.currentActivityStatus=!0,this.statusChangedEvent.fire(w.VscodeSessionStatus.Active)),this.resetStatusTimerId&&(clearTimeout(this.resetStatusTimerId),this.resetStatusTimerId=null),this.resetStatusTimerId=setTimeout(()=>{this.currentActivityStatus=!1,this.statusChangedEvent.fire(w.VscodeSessionStatus.Idle)},this.activityTimeout)}onActivity(){return v(this,void 0,void 0,(function*(){this.statusChangedEvent&&this.reset()}))}}m.VscodeSessionStatusProvider=VscodeSessionStatusProvider},function(h,m,y){"use strict";var v=this&&this.__decorate||function(h,m,y,v){var C,T=arguments.length,w=T<3?m:null===v?v=Object.getOwnPropertyDescriptor(m,y):v;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)w=Reflect.decorate(h,m,y,v);else for(var A=h.length-1;A>=0;A--)(C=h[A])&&(w=(T<3?C(w):T>3?C(m,y,w):C(m,y))||w);return T>3&&w&&Object.defineProperty(m,y,w),w},C=this&&this.__metadata||function(h,m){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(h,m)};Object.defineProperty(m,"__esModule",{value:!0});const T=y(16);class EventArgs{}m.EventArgs=EventArgs;m.NotifyContactServiceEventArgs=class NotifyContactServiceEventArgs extends EventArgs{},function(h){h[h.Unknown="unknown"]="Unknown",h[h.Available="available"]="Available",h[h.Busy="busy"]="Busy",h[h.DoNotDisturb="doNotDisturb"]="DoNotDisturb",h[h.Away="away"]="Away",h[h.Invisible="invisible"]="Invisible",h[h.Offline="offline"]="Offline"}(m.PresenceStatus||(m.PresenceStatus={})),function(h){h[h.DisplayName="displayName"]="DisplayName",h[h.Email="email"]="Email",h[h.AvatarUri="avatarUri"]="AvatarUri",h[h.Status="status"]="Status"}(m.ContactProperty||(m.ContactProperty={}));class Contact{}m.Contact=Contact;m.EmptyRequest=class EmptyRequest{};m.EmptyResponse=class EmptyResponse{};class PublishPresenceRequest{}m.PublishPresenceRequest=PublishPresenceRequest;class InitializeRequest{}v([T.dataFormat(PublishPresenceRequest),C("design:type",PublishPresenceRequest)],InitializeRequest.prototype,"publishPresence",void 0),m.InitializeRequest=InitializeRequest;m.WorkspaceFolder=class WorkspaceFolder{};m.WorkspaceUri=class WorkspaceUri{};class Capabilities{}m.Capabilities=Capabilities;class InitializeResponse{}v([T.dataFormat(Capabilities),C("design:type",Capabilities)],InitializeResponse.prototype,"capabilities",void 0),v([T.dataFormat(Contact),C("design:type",Contact)],InitializeResponse.prototype,"selfContact",void 0),m.InitializeResponse=InitializeResponse,function(h){h[h.None="none"]="None",h[h.SignedOut="signedOut"]="SignedOut",h[h.SigningIn="signingIn"]="SigningIn",h[h.SignedIn="signedIn"]="SignedIn"}(m.SignedStatus||(m.SignedStatus={}));class ContactPresenceUpdate{}m.ContactPresenceUpdate=ContactPresenceUpdate;class PresenceChangedNotification{}v([T.dataFormat(ContactPresenceUpdate),C("design:type",Array)],PresenceChangedNotification.prototype,"changes",void 0),m.PresenceChangedNotification=PresenceChangedNotification;m.ContactPropertyValueChanged=class ContactPropertyValueChanged{};m.ContactChangedNotification=class ContactChangedNotification{};m.ContactPropertiesChangedNotification=class ContactPropertiesChangedNotification{};m.InviteRequest=class InviteRequest{};class InviteReceivedNotification{}v([T.dataFormat(Contact),C("design:type",Contact)],InviteReceivedNotification.prototype,"fromContact",void 0),m.InviteReceivedNotification=InviteReceivedNotification;class SelfContactNotification{}v([T.dataFormat(Contact),C("design:type",Contact)],SelfContactNotification.prototype,"contact",void 0),m.SelfContactNotification=SelfContactNotification;class ContactsNotification{}v([T.dataFormat(Contact),C("design:type",Array)],ContactsNotification.prototype,"contacts",void 0),m.ContactsNotification=ContactsNotification;m.SuggestedContactsNotification=class SuggestedContactsNotification extends ContactsNotification{};class ContactPresenceRequest{}v([T.dataFormat(Contact),C("design:type",Array)],ContactPresenceRequest.prototype,"contacts",void 0),m.ContactPresenceRequest=ContactPresenceRequest;class ContactResponse{}v([T.dataFormat(Contact),C("design:type",Contact)],ContactResponse.prototype,"contact",void 0),m.ContactResponse=ContactResponse;class ContactPresenceResponse{}v([T.dataFormat(ContactResponse),C("design:type",Array)],ContactPresenceResponse.prototype,"contacts",void 0),m.ContactPresenceResponse=ContactPresenceResponse;m.ContactPresenceDisposeRequest=class ContactPresenceDisposeRequest{};class SearchContactProperty{}m.SearchContactProperty=SearchContactProperty;class SearchContactsRequest{}v([T.dataFormat(SearchContactProperty),C("design:type",Array)],SearchContactsRequest.prototype,"queryOptions",void 0),m.SearchContactsRequest=SearchContactsRequest;class SearchContactsResponse{}v([T.dataFormat(Contact),C("design:type",Array)],SearchContactsResponse.prototype,"results",void 0),m.SearchContactsResponse=SearchContactsResponse;class MessagePayload{}m.MessagePayload=MessagePayload;m.SendMessageRequest=class SendMessageRequest extends MessagePayload{};m.MessageReceivedNotification=class MessageReceivedNotification extends MessagePayload{};m.SignInRequest=class SignInRequest{};m.SignedStateChangedNotification=class SignedStateChangedNotification{};m.AuthenticationRequiredNotification=class AuthenticationRequiredNotification{},function(h){h.RequestInitializeName="initialize",h.RequestDisposeName="dispose",h.RequestInviteName="inviteLink",h.RequestPublishPresenceName="publishPresence",h.RequestContactPresenceName="contactPresenceRequest",h.RequestContactPresenceDisposeName="contactPresenceDispose",h.RequestSearchContactsName="searchContacts",h.RequestSendMessageName="sendMessageRequest",h.RequestSignInName="signIn",h.RequestSignOutName="signOut",h.NotifyPresenceChangedName="presenceChanged",h.NotifySelfContactName="selfContact",h.NotifyAvailableUsersName="availableUsers",h.NotifyAvailableUsersAddedName="availableUsersAdded",h.NotifyAvailableUsersRemovedName="availableUsersRemoved",h.NotifyInviteReceivedName="inviteLinkReceived",h.NotifyContactChangedName="contactChanged",h.NotifyContactPropertiesChangedName="contactPropertiesChanged",h.NotifySuggestedUsersName="suggestedUsers",h.NotifyCapabilitiesUpdateName="capabilitiesUpdate",h.NotifyMessageReceivedName="messageReceived",h.NotifySignedStateChangedName="signedStateChanged",h.NotifyAuthenticationRequiredName="authenticationRequired"}(m.Methods||(m.Methods={})),m.ContactServiceProvider={methods:["request"],events:["notified"]}},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0});const v=y(22),C=y(32),sessionMachineIsAuthedCheck=()=>C.userAuthStateTracker.IsSignedIn?v.SessionState.SignedIn:v.SessionState.SignedOut;m.sessionMachine={[v.SessionState.Initializing]:{[v.SessionAction.AttemptSharing]:v.SessionState.SharingInProgress,[v.SessionAction.AttemptJoining]:v.SessionState.JoiningInProgress,[v.SessionAction.AttemptSignIn]:v.SessionState.SigningIn,[v.SessionAction.SignOut]:v.SessionState.SignedOut},[v.SessionState.ExternallySigningIn]:{[v.SessionAction.AwaitExternalSignIn]:v.SessionState.ExternallySigningIn,[v.SessionAction.AttemptSignIn]:v.SessionState.SigningIn,[v.SessionAction.SignInSuccess]:v.SessionState.SignedIn,[v.SessionAction.SignInError]:v.SessionState.SignedOut,[v.SessionAction.SignOut]:v.SessionState.SignedOut,[v.SessionAction.SharingError]:v.SessionState.SignedOut,[v.SessionAction.JoiningError]:v.SessionState.SignedOut},[v.SessionState.SigningIn]:{[v.SessionAction.AwaitExternalSignIn]:v.SessionState.ExternallySigningIn,[v.SessionAction.SignInSuccess]:v.SessionState.SignedIn,[v.SessionAction.SignInError]:v.SessionState.SignedOut,[v.SessionAction.SignOut]:v.SessionState.SignedOut,[v.SessionAction.SharingError]:v.SessionState.SignedOut,[v.SessionAction.JoiningError]:v.SessionState.SignedOut},[v.SessionState.SignedIn]:{[v.SessionAction.AttemptSharing]:v.SessionState.SharingInProgress,[v.SessionAction.AttemptJoining]:v.SessionState.JoiningInProgress,[v.SessionAction.SignOut]:v.SessionState.SignedOut},[v.SessionState.SignedOut]:{[v.SessionAction.AttemptSignIn]:v.SessionState.SigningIn,[v.SessionAction.AwaitExternalSignIn]:v.SessionState.ExternallySigningIn,[v.SessionAction.SignInSuccess]:v.SessionState.SignedIn,[v.SessionAction.AttemptSharing]:v.SessionState.SharingInProgress,[v.SessionAction.SharingError]:v.SessionState.SignedOut,[v.SessionAction.JoiningError]:v.SessionState.SignedOut},[v.SessionState.SharingInProgress]:{[v.SessionAction.SharingError]:sessionMachineIsAuthedCheck,[v.SessionAction.SharingSuccess]:v.SessionState.Shared,[v.SessionAction.SignOut]:v.SessionState.SignedOut,[v.SessionAction.AttemptSignIn]:v.SessionState.SigningIn,[v.SessionAction.AwaitExternalSignIn]:v.SessionState.ExternallySigningIn,[v.SessionAction.SignInSuccess]:v.SessionState.SignedIn},[v.SessionState.Shared]:{[v.SessionAction.EndSharing]:v.SessionState.SignedIn,[v.SessionAction.SignOut]:v.SessionState.SignedOut},[v.SessionState.JoiningInProgress]:{[v.SessionAction.JoiningError]:sessionMachineIsAuthedCheck,[v.SessionAction.JoiningPendingReload]:v.SessionState.SignedIn,[v.SessionAction.JoiningSuccess]:v.SessionState.Joined,[v.SessionAction.SignOut]:v.SessionState.SignedOut,[v.SessionAction.AttemptSharing]:v.SessionState.SharingInProgress},[v.SessionState.Joined]:{[v.SessionAction.Unjoin]:v.SessionState.SignedIn,[v.SessionAction.SignOut]:v.SessionState.SignedOut}}},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0});const v=y(0),C=y(383),T=y(74),w=y(913),A=y(20),P=y(222),k=y(967),R=[T.SettingKeys.commandPrefix,T.SettingKeys.serviceUri,T.SettingKeys.signalRServiceUri,T.SettingKeys.scheme,T.SettingKeys.authority,T.SettingKeys.canCollectPII,T.SettingKeys.userEmail,T.SettingKeys.isInternal,T.SettingKeys.isCloudEnvironment,T.SettingKeys.name,T.SettingKeys.shortName,T.SettingKeys.abbreviation,T.SettingKeys.licenseUrl,T.SettingKeys.privacyUrl,T.SettingKeys.hasUsed,T.SettingKeys.configName,T.SettingKeys.activityTimeout,T.SettingKeys.customAccountAuthReloadFlag,T.SettingKeys.anonymousAuthReloadFlag,T.SettingKeys.nativeAuthFlow,T.SettingKeys.authenticationProvider,T.SettingKeys.useClientFileService,T.SettingKeys.remoteSettingsUri,T.SettingKeys.remoteSettingsUpdateMinutes,T.SettingKeys.runsInVSCodeDev,T.SettingKeys.performanceRun,T.SettingKeys.joinWorkspaceId,T.SettingKeys.performanceLogging,T.SettingKeys.logTelemetry],M=[T.SettingKeys.anonymousUserName,T.SettingKeys.microphoneId,T.SettingKeys.speakerId,T.SettingKeys.newChatDisplayDate,T.SettingKeys.newAudioDisplayDate,T.SettingKeys.sessionCount,T.SettingKeys.dontRequestFeedback,T.SettingKeys.dontRequestAdditionalFeedback,T.SettingKeys.surveyShownDate,T.SettingKeys.firstActivationTime,T.SettingKeys.hasSelectedLauncherClient];function isPrivateKey(h){return R.indexOf(h)>=0}function isMementoKey(h){return M.indexOf(h)>=0}function getInternal(h){if(C.defaultSettings.hasOwnProperty(h))return C.defaultSettings[h]}m.DefaultSettingsProvider=class DefaultSettingsProvider{constructor(){this.userSettings={}}async init(h,m){this.mementoConfigInstance=new MementoConfig(h),this.userSettings=await P.readUserSettings();const y=getInternal(T.SettingKeys.remoteSettingsUri);if(y){const v=getInternal(T.SettingKeys.remoteSettingsUpdateMinutes);await w.RemoteConfig.init(h,A.parse(y),v,m)}}get mementoConfig(){return this.mementoConfigInstance}get ready(){return w.RemoteConfig.waitForUpdate}get(h){if(this.userSettings.hasOwnProperty(h))return this.userSettings[h];const m=v.workspace.getConfiguration(getInternal(T.SettingKeys.configName)),extensionConfigValue=()=>m.get(h);if(isPrivateKey(h)||isMementoKey(h)){if(m.has(h))return extensionConfigValue();const y=getInternal(h);return void 0===y&&isMementoKey(h)?this.mementoConfigInstance.get(h):y}const y=k.EnterpriseConfig.get(h);if(void 0!==y)return y;const C=w.RemoteConfig.getDefault(h);if(void 0!==C){const y=m.inspect(h);if(y){if(void 0!==y.workspaceFolderValue)return y.workspaceFolderValue;if(void 0!==y.workspaceValue)return y.workspaceValue;if(void 0!==y.globalValue)return y.globalValue}return C}return extensionConfigValue()}save(h,m,y){if(isPrivateKey(h))return C.defaultSettings[h]=m;if(isMementoKey(h))return this.mementoConfigInstance.save(h,m);return v.workspace.getConfiguration(getInternal(T.SettingKeys.configName)).update(h,m,y)}};class MementoConfig{constructor(h){this.globalState=h.globalState}get(h){return this.globalState.get(h)}async save(h,m){await this.globalState.update(h,m)}}},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0});const v=y(20),C=y(2),T=y(161),w=y(223),A=y(69),P=y(0),k=y(400),R=y(403);class RemoteConfig{constructor(){this.settings=null,this.updated=!1,this.updateSignal=new C.Signal}static get Instance(){return RemoteConfig.singleton||(RemoteConfig.singleton=new RemoteConfig),RemoteConfig.singleton}async init(h,m,y,C){if(!m)throw new Error("A settings URI is required.");this.settingsFileUri=v.parse(v.resolve(m.href,"remoteSettings.json")),this.settingsFileUri.path=(m.path+"/remoteSettings.json").replace("//","/"),this.extensionVersion=T.ExtensionUtil.getExtensionVersion(w.LIVESHARE_EXTENSION_ID,!1),this.settings=await k.loadFilefromCache(this.settingsFileUri.href),null==C||C.verbose(`Downloading remote settings from ${this.settingsFileUri.href}`);const A=await k.initRemoteFileSubscribe(h,this.settingsFileUri.href,h=>{this.loadDownloadedSettings(h)},y,C);h&&h.subscriptions.push(A)}loadDownloadedSettings(h){this.settings=h,this.updated||(this.updated=!0,this.updateSignal.resolve())}get waitForUpdate(){if(!this.settingsFileUri)throw new Error("Not initialized.");return this.updateSignal.promise}getDefault(h){return this.getSettingValue(h,"default")}getOverride(h){return this.getSettingValue(h,"override")}getSettingValue(h,m){if(!this.settings)return;let y=this.settings[h];if(y){Array.isArray(y)||(y=[y]);for(let h of y){if((h.priority||"default")===m&&this.evaluateConditions(h.conditions))return h.value}}}evaluateConditions(h){if(!h)return!0;if(h.os){const m=R.getPlatform().replace("win32","win").replace("darwin","mac");if(!(h.os===m||Array.isArray(h.os)&&h.os.indexOf(m)>=0))return!1}return!(h.extensionVersion&&!A.satisfies(this.extensionVersion,h.extensionVersion))&&!(h.ideVersion&&!A.satisfies(P.version,h.ideVersion))}}const M=RemoteConfig.Instance;m.RemoteConfig=M},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0});const v=y(0),C=y(35),T=y(8),w=y(162),A=y(384),P=y(161),k=y(223);var R;!function(h){h.readOnly="readOnly",h.readWrite="readWrite"}(R=m.AnonymousAccessLevel||(m.AnonymousAccessLevel={}));m.workspaceSessionInfoTracker=new class WorkspaceSessionInfoTracker{constructor(){this.vslsWorkspaceSessionInfo=null,this.plannedWorkspaceList=null,this.isReadOnlyPrivate=!1,this.isPlannedSessionsChangedPrivate=!1,this.anonymousAccessMap=new Map,this.readOnlyChangedEmitter=new v.EventEmitter,this.onReadOnlyChanged=this.readOnlyChangedEmitter.event,this.plannedSessionsChangedEmitter=new v.EventEmitter,this.onPlannedSessionsChanged=this.plannedSessionsChangedEmitter.event,this.anonymousAccessLevelChangedInSessionEmitter=new v.EventEmitter,this.onAccessLevelChangedInSession=this.anonymousAccessLevelChangedInSessionEmitter.event}get workspaceSessionInfo(){return this.vslsWorkspaceSessionInfo}set workspaceSessionInfo(h){var m;this.vslsWorkspaceSessionInfo=h,(null===(m=this.vslsWorkspaceSessionInfo)||void 0===m?void 0:m.id)&&P.ExtensionUtil.getCommandContext("liveshare:isWeb")&&!P.ExtensionUtil.getCommandContext("liveshare:isNode")&&(this.vslsWorkspaceSessionInfo.joinUri=`${k.LIVESHARE_JOIN_URI}${this.vslsWorkspaceSessionInfo.id}`),(null==h?void 0:h.conversationId)&&(T.Telemetry.addContextProperty(w.TelemetryPropertyNames.CONVERSATION_ID,h.conversationId),T.Telemetry.addContextProperty(w.TelemetryPropertyNames.SESSION_ID,C()))}get isReadOnly(){return this.isReadOnlyPrivate}set isReadOnly(h){h!==m.workspaceSessionInfoTracker.isReadOnly&&(h?T.Telemetry.addContextProperty(w.TelemetryPropertyNames.IS_READONLY_SESSION,!0,!1):T.Telemetry.removeContextProperty(w.TelemetryPropertyNames.IS_READONLY_SESSION),m.workspaceSessionInfoTracker.isReadOnlyPrivate=h,this.readOnlyChangedEmitter.fire(h))}get isPlannedSessionsChanged(){return this.isPlannedSessionsChangedPrivate}set isPlannedSessionsChanged(h){h!==m.workspaceSessionInfoTracker.isPlannedSessionsChanged&&(m.workspaceSessionInfoTracker.isPlannedSessionsChangedPrivate=h,this.plannedSessionsChangedEmitter.fire(h)),m.workspaceSessionInfoTracker.isPlannedSessionsChangedPrivate=!1}async setAnonymousAccess(h,m){const y=new T.TelemetryEvent(w.TelemetryEventNames.RESPOND_ANONYMOUS_JOIN_REQUEST);switch(m){case A.localize("notification.AcceptReadOnly"):case A.localize("notification.Accept"):case A.localize("notification.AlwaysAcceptAnonymous"):this.anonymousAccessMap.set(h,R.readOnly),y.addProperty(w.TelemetryPropertyNames.READONLY,!0),y.addProperty(w.TelemetryPropertyNames.ACCEPTED,!0);break;case A.localize("notification.AcceptReadWrite"):this.anonymousAccessMap.set(h,R.readWrite),y.addProperty(w.TelemetryPropertyNames.READONLY,!1),y.addProperty(w.TelemetryPropertyNames.ACCEPTED,!0);break;case A.localize("notification.Reject"):y.addProperty(w.TelemetryPropertyNames.ACCEPTED,!1)}y.send()}async updateAnonymousAccess(h,m){const y=new T.TelemetryEvent(w.TelemetryEventNames.UPDATE_ANONYMOUS_GUEST_ACCESS_LEVEL),v=h.participantId,C=h.sessionId;m?(this.anonymousAccessMap.set(v,R.readOnly),this.anonymousAccessLevelChangedInSessionEmitter.fire(),this.anonymousUserId=C,y.addProperty(w.TelemetryPropertyNames.IS_ANONYMOUS_ELEVATED,!1)):(this.anonymousAccessMap.set(v,R.readWrite),this.anonymousAccessLevelChangedInSessionEmitter.fire(),this.anonymousUserId=C,y.addProperty(w.TelemetryPropertyNames.IS_ANONYMOUS_ELEVATED,!0)),y.send()}getAnonymousAccess(h){return this.anonymousAccessMap.get(h)}getAnonymousAccessMapHasTheProfile(h){const m=h.participantId;return this.anonymousAccessMap.has(m)}clearAnonymousAccessMap(){this.anonymousAccessMap.clear()}getAccessLevelChangedUserID(){return this.anonymousUserId}}},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0});const v=y(387),C=y(916),T=y(0),w=y(949),A=y(950);function getExperimentationService(h,m,y,P,k,...R){if(!k)throw new Error("Memento storage was not provided.");const M=T.workspace.getConfiguration("telemetry");if(!(void 0===T.env.isTelemetryEnabled?M.get("enableTelemetry",!0):T.env.isTelemetryEnabled))return new A.default;const N=[new v.VSCodeFilterProvider(h,m,y),...R],D=new w.MementoKeyValueStorage(k);return new C.ExperimentationService({filterProviders:N,telemetry:P,storageKey:"VSCode.ABExp.FeatureData",keyValueStorage:D,featuresTelemetryPropertyName:"VSCode.ABExp.Features",assignmentContextTelemetryPropertyName:"abexp.assignmentcontext",telemetryEventName:"query-expfeature",endpoint:"https://default.exp-tas.com/vscode/ab",refetchInterval:18e5})}m.getExperimentationService=getExperimentationService,m.getExperimentationServiceAsync=async function getExperimentationServiceAsync(h,m,y,v,C,...T){const w=getExperimentationService(h,m,y,v,C,...T);return await w.initializePromise,w}},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0});var v=y(917);m.ExperimentationService=v.ExperimentationService},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0});const v=y(918),C=y(921),T=y(945);class ExperimentationService extends T.ExperimentationServiceAutoPolling{constructor(h){super(h.telemetry,h.filterProviders||[],null!=h.refetchInterval?h.refetchInterval:0,h.featuresTelemetryPropertyName,h.assignmentContextTelemetryPropertyName,h.telemetryEventName,h.storageKey,h.keyValueStorage),this.options=h,this.invokeInit()}init(){this.featureProviders=[],this.addFeatureProvider(new v.TasApiFeatureProvider(new C.AxiosHttpClient(this.options.endpoint),this.telemetry,this.filterProviders)),super.init()}}m.ExperimentationService=ExperimentationService,ExperimentationService.REFRESH_RATE_IN_MINUTES=30},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0});const v=y(919);class TasApiFeatureProvider extends v.FilteredFeatureProvider{constructor(h,m,y){super(m,y),this.httpClient=h,this.telemetry=m,this.filterProviders=y}async fetch(){let h=this.getFilters(),m={};for(let y of h.keys()){const v=h.get(y);m[y]=v}let y=await this.httpClient.get({headers:m});h.keys.length>0&&this.PostEventToTelemetry(m);let v=y.data,C=v.Configs,T=[];for(let h of C)if(h.Parameters)for(let m of Object.keys(h.Parameters)){const y=m+(h.Parameters[m]?"":"cf");T.includes(y)||T.push(y)}return{features:T,assignmentContext:v.AssignmentContext,configs:C}}}m.TasApiFeatureProvider=TasApiFeatureProvider},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0});const v=y(920);class FilteredFeatureProvider extends v.BaseFeatureProvider{constructor(h,m){super(h),this.telemetry=h,this.filterProviders=m,this.cachedTelemetryEvents=[]}getFilters(){let h=new Map;for(let m of this.filterProviders){let y=m.getFilters();for(let m of y.keys()){let v=y.get(m);h.set(m,v)}}return h}PostEventToTelemetry(h){if(this.cachedTelemetryEvents.includes(h))return;const m=JSON.stringify(h);this.telemetry.postEvent("report-headers",new Map([["ABExp.headers",m]])),this.cachedTelemetryEvents.push(h)}}m.FilteredFeatureProvider=FilteredFeatureProvider},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0});m.BaseFeatureProvider=class BaseFeatureProvider{constructor(h){this.telemetry=h,this.isFetching=!1}async getFeatures(){if(this.isFetching&&this.fetchPromise)return this.fetchPromise;this.fetchPromise=this.fetch();let h=await this.fetchPromise;return this.isFetching=!1,this.fetchPromise=void 0,h}}},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0});const v=y(163);m.AxiosHttpClient=class AxiosHttpClient{constructor(h){this.endpoint=h}get(h){return v.default.get(this.endpoint,Object.assign(Object.assign({},h),{proxy:!1}))}}},function(h,m,y){"use strict";var v=y(33),C=y(388),T=y(923),w=y(395);function createInstance(h){var m=new T(h),y=C(T.prototype.request,m);return v.extend(y,T.prototype,m),v.extend(y,m),y}var A=createInstance(y(225));A.Axios=T,A.create=function create(h){return createInstance(w(A.defaults,h))},A.Cancel=y(396),A.CancelToken=y(942),A.isCancel=y(394),A.all=function all(h){return Promise.all(h)},A.spread=y(943),A.isAxiosError=y(944),h.exports=A,h.exports.default=A},function(h,m,y){"use strict";var v=y(33),C=y(224),T=y(924),w=y(925),A=y(395),P=y(941),k=P.validators;function Axios(h){this.defaults=h,this.interceptors={request:new T,response:new T}}Axios.prototype.request=function request(h){"string"==typeof h?(h=arguments[1]||{}).url=arguments[0]:h=h||{},(h=A(this.defaults,h)).method?h.method=h.method.toLowerCase():this.defaults.method?h.method=this.defaults.method.toLowerCase():h.method="get";var m=h.transitional;void 0!==m&&P.assertOptions(m,{silentJSONParsing:k.transitional(k.boolean,"1.0.0"),forcedJSONParsing:k.transitional(k.boolean,"1.0.0"),clarifyTimeoutError:k.transitional(k.boolean,"1.0.0")},!1);var y=[],v=!0;this.interceptors.request.forEach((function unshiftRequestInterceptors(m){"function"==typeof m.runWhen&&!1===m.runWhen(h)||(v=v&&m.synchronous,y.unshift(m.fulfilled,m.rejected))}));var C,T=[];if(this.interceptors.response.forEach((function pushResponseInterceptors(h){T.push(h.fulfilled,h.rejected)})),!v){var R=[w,void 0];for(Array.prototype.unshift.apply(R,y),R=R.concat(T),C=Promise.resolve(h);R.length;)C=C.then(R.shift(),R.shift());return C}for(var M=h;y.length;){var N=y.shift(),D=y.shift();try{M=N(M)}catch(h){D(h);break}}try{C=w(M)}catch(h){return Promise.reject(h)}for(;T.length;)C=C.then(T.shift(),T.shift());return C},Axios.prototype.getUri=function getUri(h){return h=A(this.defaults,h),C(h.url,h.params,h.paramsSerializer).replace(/^\?/,"")},v.forEach(["delete","get","head","options"],(function forEachMethodNoData(h){Axios.prototype[h]=function(m,y){return this.request(A(y||{},{method:h,url:m,data:(y||{}).data}))}})),v.forEach(["post","put","patch"],(function forEachMethodWithData(h){Axios.prototype[h]=function(m,y,v){return this.request(A(v||{},{method:h,url:m,data:y}))}})),h.exports=Axios},function(h,m,y){"use strict";var v=y(33);function InterceptorManager(){this.handlers=[]}InterceptorManager.prototype.use=function use(h,m,y){return this.handlers.push({fulfilled:h,rejected:m,synchronous:!!y&&y.synchronous,runWhen:y?y.runWhen:null}),this.handlers.length-1},InterceptorManager.prototype.eject=function eject(h){this.handlers[h]&&(this.handlers[h]=null)},InterceptorManager.prototype.forEach=function forEach(h){v.forEach(this.handlers,(function forEachHandler(m){null!==m&&h(m)}))},h.exports=InterceptorManager},function(h,m,y){"use strict";var v=y(33),C=y(926),T=y(394),w=y(225);function throwIfCancellationRequested(h){h.cancelToken&&h.cancelToken.throwIfRequested()}h.exports=function dispatchRequest(h){return throwIfCancellationRequested(h),h.headers=h.headers||{},h.data=C.call(h,h.data,h.headers,h.transformRequest),h.headers=v.merge(h.headers.common||{},h.headers[h.method]||{},h.headers),v.forEach(["delete","get","head","post","put","patch","common"],(function cleanHeaderConfig(m){delete h.headers[m]})),(h.adapter||w.adapter)(h).then((function onAdapterResolution(m){return throwIfCancellationRequested(h),m.data=C.call(h,m.data,m.headers,h.transformResponse),m}),(function onAdapterRejection(m){return T(m)||(throwIfCancellationRequested(h),m&&m.response&&(m.response.data=C.call(h,m.response.data,m.response.headers,h.transformResponse))),Promise.reject(m)}))}},function(h,m,y){"use strict";var v=y(33),C=y(225);h.exports=function transformData(h,m,y){var T=this||C;return v.forEach(y,(function transform(y){h=y.call(T,h,m)})),h}},function(h,m,y){"use strict";var v=y(33);h.exports=function normalizeHeaderName(h,m){v.forEach(h,(function processHeader(y,v){v!==m&&v.toUpperCase()===m.toUpperCase()&&(h[m]=y,delete h[v])}))}},function(h,m,y){"use strict";var v=y(33),C=y(389),T=y(929),w=y(224),A=y(390),P=y(932),k=y(933),R=y(227);h.exports=function xhrAdapter(h){return new Promise((function dispatchXhrRequest(m,y){var M=h.data,N=h.headers,D=h.responseType;v.isFormData(M)&&delete N["Content-Type"];var I=new XMLHttpRequest;if(h.auth){var x=h.auth.username||"",O=h.auth.password?unescape(encodeURIComponent(h.auth.password)):"";N.Authorization="Basic "+btoa(x+":"+O)}var L=A(h.baseURL,h.url);function onloadend(){if(I){var v="getAllResponseHeaders"in I?P(I.getAllResponseHeaders()):null,T={data:D&&"text"!==D&&"json"!==D?I.response:I.responseText,status:I.status,statusText:I.statusText,headers:v,config:h,request:I};C(m,y,T),I=null}}if(I.open(h.method.toUpperCase(),w(L,h.params,h.paramsSerializer),!0),I.timeout=h.timeout,"onloadend"in I?I.onloadend=onloadend:I.onreadystatechange=function handleLoad(){I&&4===I.readyState&&(0!==I.status||I.responseURL&&0===I.responseURL.indexOf("file:"))&&setTimeout(onloadend)},I.onabort=function handleAbort(){I&&(y(R("Request aborted",h,"ECONNABORTED",I)),I=null)},I.onerror=function handleError(){y(R("Network Error",h,null,I)),I=null},I.ontimeout=function handleTimeout(){var m="timeout of "+h.timeout+"ms exceeded";h.timeoutErrorMessage&&(m=h.timeoutErrorMessage),y(R(m,h,h.transitional&&h.transitional.clarifyTimeoutError?"ETIMEDOUT":"ECONNABORTED",I)),I=null},v.isStandardBrowserEnv()){var U=(h.withCredentials||k(L))&&h.xsrfCookieName?T.read(h.xsrfCookieName):void 0;U&&(N[h.xsrfHeaderName]=U)}"setRequestHeader"in I&&v.forEach(N,(function setRequestHeader(h,m){void 0===M&&"content-type"===m.toLowerCase()?delete N[m]:I.setRequestHeader(m,h)})),v.isUndefined(h.withCredentials)||(I.withCredentials=!!h.withCredentials),D&&"json"!==D&&(I.responseType=h.responseType),"function"==typeof h.onDownloadProgress&&I.addEventListener("progress",h.onDownloadProgress),"function"==typeof h.onUploadProgress&&I.upload&&I.upload.addEventListener("progress",h.onUploadProgress),h.cancelToken&&h.cancelToken.promise.then((function onCanceled(h){I&&(I.abort(),y(h),I=null)})),M||(M=null),I.send(M)}))}},function(h,m,y){"use strict";var v=y(33);h.exports=v.isStandardBrowserEnv()?function standardBrowserEnv(){return{write:function write(h,m,y,C,T,w){var A=[];A.push(h+"="+encodeURIComponent(m)),v.isNumber(y)&&A.push("expires="+new Date(y).toGMTString()),v.isString(C)&&A.push("path="+C),v.isString(T)&&A.push("domain="+T),!0===w&&A.push("secure"),document.cookie=A.join("; ")},read:function read(h){var m=document.cookie.match(new RegExp("(^|;\\s*)("+h+")=([^;]*)"));return m?decodeURIComponent(m[3]):null},remove:function remove(h){this.write(h,"",Date.now()-864e5)}}}():{write:function write(){},read:function read(){return null},remove:function remove(){}}},function(h,m,y){"use strict";h.exports=function isAbsoluteURL(h){return/^([a-z][a-z\d\+\-\.]*:)?\/\//i.test(h)}},function(h,m,y){"use strict";h.exports=function combineURLs(h,m){return m?h.replace(/\/+$/,"")+"/"+m.replace(/^\/+/,""):h}},function(h,m,y){"use strict";var v=y(33),C=["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"];h.exports=function parseHeaders(h){var m,y,T,w={};return h?(v.forEach(h.split("\n"),(function parser(h){if(T=h.indexOf(":"),m=v.trim(h.substr(0,T)).toLowerCase(),y=v.trim(h.substr(T+1)),m){if(w[m]&&C.indexOf(m)>=0)return;w[m]="set-cookie"===m?(w[m]?w[m]:[]).concat([y]):w[m]?w[m]+", "+y:y}})),w):w}},function(h,m,y){"use strict";var v=y(33);h.exports=v.isStandardBrowserEnv()?function standardBrowserEnv(){var h,m=/(msie|trident)/i.test(navigator.userAgent),y=document.createElement("a");function resolveURL(h){var v=h;return m&&(y.setAttribute("href",v),v=y.href),y.setAttribute("href",v),{href:y.href,protocol:y.protocol?y.protocol.replace(/:$/,""):"",host:y.host,search:y.search?y.search.replace(/^\?/,""):"",hash:y.hash?y.hash.replace(/^#/,""):"",hostname:y.hostname,port:y.port,pathname:"/"===y.pathname.charAt(0)?y.pathname:"/"+y.pathname}}return h=resolveURL(window.location.href),function isURLSameOrigin(m){var y=v.isString(m)?resolveURL(m):m;return y.protocol===h.protocol&&y.host===h.host}}():function isURLSameOrigin(){return!0}},function(h,m,y){"use strict";var v=y(33),C=y(389),T=y(390),w=y(224),A=y(52),P=y(46),k=y(391).http,R=y(391).https,M=y(20),N=y(47),D=y(393),I=y(227),x=y(226),O=/https:?/;h.exports=function httpAdapter(h){return new Promise((function dispatchHttpRequest(m,y){var L=function resolve(h){m(h)},U=function reject(h){y(h)},B=h.data,W=h.headers;if("User-Agent"in W||"user-agent"in W?W["User-Agent"]||W["user-agent"]||(delete W["User-Agent"],delete W["user-agent"]):W["User-Agent"]="axios/"+D.version,B&&!v.isStream(B)){if(Buffer.isBuffer(B));else if(v.isArrayBuffer(B))B=Buffer.from(new Uint8Array(B));else{if(!v.isString(B))return U(I("Data after transformation must be a string, an ArrayBuffer, a Buffer, or a Stream",h));B=Buffer.from(B,"utf-8")}W["Content-Length"]=B.length}var q=void 0;h.auth&&(q=(h.auth.username||"")+":"+(h.auth.password||""));var Y=T(h.baseURL,h.url),V=M.parse(Y),$=V.protocol||"http:";if(!q&&V.auth){var z=V.auth.split(":");q=(z[0]||"")+":"+(z[1]||"")}q&&delete W.Authorization;var G=O.test($),J=G?h.httpsAgent:h.httpAgent,X={path:w(V.path,h.params,h.paramsSerializer).replace(/^\?/,""),method:h.method.toUpperCase(),headers:W,agent:J,agents:{http:h.httpAgent,https:h.httpsAgent},auth:q};h.socketPath?X.socketPath=h.socketPath:(X.hostname=V.hostname,X.port=V.port);var Z,ee=h.proxy;if(!ee&&!1!==ee){var te=$.slice(0,-1)+"_proxy",re=process.env[te]||process.env[te.toUpperCase()];if(re){var ie=M.parse(re),se=process.env.no_proxy||process.env.NO_PROXY,oe=!0;if(se)oe=!se.split(",").map((function trim(h){return h.trim()})).some((function proxyMatch(h){return!!h&&("*"===h||("."===h[0]&&V.hostname.substr(V.hostname.length-h.length)===h||V.hostname===h))}));if(oe&&(ee={host:ie.hostname,port:ie.port,protocol:ie.protocol},ie.auth)){var ae=ie.auth.split(":");ee.auth={username:ae[0],password:ae[1]}}}}ee&&(X.headers.host=V.hostname+(V.port?":"+V.port:""),function setProxy(h,m,y){if(h.hostname=m.host,h.host=m.host,h.port=m.port,h.path=y,m.auth){var v=Buffer.from(m.auth.username+":"+m.auth.password,"utf8").toString("base64");h.headers["Proxy-Authorization"]="Basic "+v}h.beforeRedirect=function beforeRedirect(h){h.headers.host=h.host,setProxy(h,m,h.href)}}(X,ee,$+"//"+V.hostname+(V.port?":"+V.port:"")+X.path));var ce=G&&(!ee||O.test(ee.protocol));h.transport?Z=h.transport:0===h.maxRedirects?Z=ce?P:A:(h.maxRedirects&&(X.maxRedirects=h.maxRedirects),Z=ce?R:k),h.maxBodyLength>-1&&(X.maxBodyLength=h.maxBodyLength);var le=Z.request(X,(function handleResponse(m){if(!le.aborted){var y=m,T=m.req||le;if(204!==m.statusCode&&"HEAD"!==T.method&&!1!==h.decompress)switch(m.headers["content-encoding"]){case"gzip":case"compress":case"deflate":y=y.pipe(N.createUnzip()),delete m.headers["content-encoding"]}var w={status:m.statusCode,statusText:m.statusMessage,headers:m.headers,config:h,request:T};if("stream"===h.responseType)w.data=y,C(L,U,w);else{var A=[],P=0;y.on("data",(function handleStreamData(m){A.push(m),P+=m.length,h.maxContentLength>-1&&P>h.maxContentLength&&(y.destroy(),U(I("maxContentLength size of "+h.maxContentLength+" exceeded",h,null,T)))})),y.on("error",(function handleStreamError(m){le.aborted||U(x(m,h,null,T))})),y.on("end",(function handleStreamEnd(){var m=Buffer.concat(A);"arraybuffer"!==h.responseType&&(m=m.toString(h.responseEncoding),h.responseEncoding&&"utf8"!==h.responseEncoding||(m=v.stripBOM(m))),w.data=m,C(L,U,w)}))}}}));if(le.on("error",(function handleRequestError(m){le.aborted&&"ERR_FR_TOO_MANY_REDIRECTS"!==m.code||U(x(m,h,null,le))})),h.timeout){var ue=parseInt(h.timeout,10);if(isNaN(ue))return void U(I("error trying to parse `config.timeout` to int",h,"ERR_PARSE_TIMEOUT",le));le.setTimeout(ue,(function handleRequestTimeout(){le.abort(),U(I("timeout of "+ue+"ms exceeded",h,h.transitional&&h.transitional.clarifyTimeoutError?"ETIMEDOUT":"ECONNABORTED",le))}))}h.cancelToken&&h.cancelToken.promise.then((function onCanceled(h){le.aborted||(le.abort(),U(h))})),v.isStream(B)?B.on("error",(function handleStreamError(m){U(x(m,h,null,le))})).pipe(le):le.end(B)}))}},function(h,m,y){var v;h.exports=function(){if(!v){try{v=y(164)("follow-redirects")}catch(h){}"function"!=typeof v&&(v=function(){})}v.apply(null,arguments)}},function(h,m,y){m.log=function log(...h){return"object"==typeof console&&console.log&&console.log(...h)},m.formatArgs=function formatArgs(m){if(m[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+m[0]+(this.useColors?"%c ":" ")+"+"+h.exports.humanize(this.diff),!this.useColors)return;const y="color: "+this.color;m.splice(1,0,y,"color: inherit");let v=0,C=0;m[0].replace(/%[a-zA-Z%]/g,h=>{"%%"!==h&&(v++,"%c"===h&&(C=v))}),m.splice(C,0,y)},m.save=function save(h){try{h?m.storage.setItem("debug",h):m.storage.removeItem("debug")}catch(h){}},m.load=function load(){let h;try{h=m.storage.getItem("debug")}catch(h){}!h&&"undefined"!=typeof process&&"env"in process&&(h=process.env.DEBUG);return h},m.useColors=function useColors(){if("undefined"!=typeof window&&window.process&&("renderer"===window.process.type||window.process.__nwjs))return!0;if("undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/))return!1;return"undefined"!=typeof document&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||"undefined"!=typeof window&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)},m.storage=function localstorage(){try{return localStorage}catch(h){}}(),m.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"],h.exports=y(392)(m);const{formatters:v}=h.exports;v.j=function(h){try{return JSON.stringify(h)}catch(h){return"[UnexpectedJSONParseError]: "+h.message}}},function(h,m){var y=1e3,v=6e4,C=60*v,T=24*C;function plural(h,m,y,v){var C=m>=1.5*y;return Math.round(h/y)+" "+v+(C?"s":"")}h.exports=function(h,m){m=m||{};var w=typeof h;if("string"===w&&h.length>0)return function parse(h){if((h=String(h)).length>100)return;var m=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(h);if(!m)return;var w=parseFloat(m[1]);switch((m[2]||"ms").toLowerCase()){case"years":case"year":case"yrs":case"yr":case"y":return 315576e5*w;case"weeks":case"week":case"w":return 6048e5*w;case"days":case"day":case"d":return w*T;case"hours":case"hour":case"hrs":case"hr":case"h":return w*C;case"minutes":case"minute":case"mins":case"min":case"m":return w*v;case"seconds":case"second":case"secs":case"sec":case"s":return w*y;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return w;default:return}}(h);if("number"===w&&isFinite(h))return m.long?function fmtLong(h){var m=Math.abs(h);if(m>=T)return plural(h,m,T,"day");if(m>=C)return plural(h,m,C,"hour");if(m>=v)return plural(h,m,v,"minute");if(m>=y)return plural(h,m,y,"second");return h+" ms"}(h):function fmtShort(h){var m=Math.abs(h);if(m>=T)return Math.round(h/T)+"d";if(m>=C)return Math.round(h/C)+"h";if(m>=v)return Math.round(h/v)+"m";if(m>=y)return Math.round(h/y)+"s";return h+"ms"}(h);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(h))}},function(h,m,y){const v=y(88),C=y(10);m.init=function init(h){h.inspectOpts={};const y=Object.keys(m.inspectOpts);for(let v=0;v<y.length;v++)h.inspectOpts[y[v]]=m.inspectOpts[y[v]]},m.log=function log(...h){return process.stderr.write(C.format(...h)+"\n")},m.formatArgs=function formatArgs(y){const{namespace:v,useColors:C}=this;if(C){const m=this.color,C="[3"+(m<8?m:"8;5;"+m),T=`  ${C};1m${v} [0m`;y[0]=T+y[0].split("\n").join("\n"+T),y.push(C+"m+"+h.exports.humanize(this.diff)+"[0m")}else y[0]=function getDate(){if(m.inspectOpts.hideDate)return"";return(new Date).toISOString()+" "}()+v+" "+y[0]},m.save=function save(h){h?process.env.DEBUG=h:delete process.env.DEBUG},m.load=function load(){return process.env.DEBUG},m.useColors=function useColors(){return"colors"in m.inspectOpts?Boolean(m.inspectOpts.colors):v.isatty(process.stderr.fd)},m.colors=[6,2,3,4,5,1];try{const h=y(939);h&&(h.stderr||h).level>=2&&(m.colors=[20,21,26,27,32,33,38,39,40,41,42,43,44,45,56,57,62,63,68,69,74,75,76,77,78,79,80,81,92,93,98,99,112,113,128,129,134,135,148,149,160,161,162,163,164,165,166,167,168,169,170,171,172,173,178,179,184,185,196,197,198,199,200,201,202,203,204,205,206,207,208,209,214,215,220,221])}catch(h){}m.inspectOpts=Object.keys(process.env).filter(h=>/^debug_/i.test(h)).reduce((h,m)=>{const y=m.substring(6).toLowerCase().replace(/_([a-z])/g,(h,m)=>m.toUpperCase());let v=process.env[m];return v=!!/^(yes|on|true|enabled)$/i.test(v)||!/^(no|off|false|disabled)$/i.test(v)&&("null"===v?null:Number(v)),h[y]=v,h},{}),h.exports=y(392)(m);const{formatters:T}=h.exports;T.o=function(h){return this.inspectOpts.colors=this.useColors,C.inspect(h,this.inspectOpts).replace(/\s*\n\s*/g," ")},T.O=function(h){return this.inspectOpts.colors=this.useColors,C.inspect(h,this.inspectOpts)}},function(h,m,y){"use strict";const v=y(18),C=y(88),T=y(940),{env:w}=process;let A;function translateLevel(h){return 0!==h&&{level:h,hasBasic:!0,has256:h>=2,has16m:h>=3}}function supportsColor(h,m){if(0===A)return 0;if(T("color=16m")||T("color=full")||T("color=truecolor"))return 3;if(T("color=256"))return 2;if(h&&!m&&void 0===A)return 0;const y=A||0;if("dumb"===w.TERM)return y;if("win32"===process.platform){const h=v.release().split(".");return Number(h[0])>=10&&Number(h[2])>=10586?Number(h[2])>=14931?3:2:1}if("CI"in w)return["TRAVIS","CIRCLECI","APPVEYOR","GITLAB_CI"].some(h=>h in w)||"codeship"===w.CI_NAME?1:y;if("TEAMCITY_VERSION"in w)return/^(9\.(0*[1-9]\d*)\.|\d{2,}\.)/.test(w.TEAMCITY_VERSION)?1:0;if("GITHUB_ACTIONS"in w)return 1;if("truecolor"===w.COLORTERM)return 3;if("TERM_PROGRAM"in w){const h=parseInt((w.TERM_PROGRAM_VERSION||"").split(".")[0],10);switch(w.TERM_PROGRAM){case"iTerm.app":return h>=3?3:2;case"Apple_Terminal":return 2}}return/-256(color)?$/i.test(w.TERM)?2:/^screen|^xterm|^vt100|^vt220|^rxvt|color|ansi|cygwin|linux/i.test(w.TERM)||"COLORTERM"in w?1:y}T("no-color")||T("no-colors")||T("color=false")||T("color=never")?A=0:(T("color")||T("colors")||T("color=true")||T("color=always"))&&(A=1),"FORCE_COLOR"in w&&(A="true"===w.FORCE_COLOR?1:"false"===w.FORCE_COLOR?0:0===w.FORCE_COLOR.length?1:Math.min(parseInt(w.FORCE_COLOR,10),3)),h.exports={supportsColor:function getSupportLevel(h){return translateLevel(supportsColor(h,h&&h.isTTY))},stdout:translateLevel(supportsColor(!0,C.isatty(1))),stderr:translateLevel(supportsColor(!0,C.isatty(2)))}},function(h,m,y){"use strict";h.exports=(h,m=process.argv)=>{const y=h.startsWith("-")?"":1===h.length?"-":"--",v=m.indexOf(y+h),C=m.indexOf("--");return-1!==v&&(-1===C||v<C)}},function(h,m,y){"use strict";var v=y(393),C={};["object","boolean","number","function","string","symbol"].forEach((function(h,m){C[h]=function validator(y){return typeof y===h||"a"+(m<1?"n ":" ")+h}}));var T={},w=v.version.split(".");function isOlderVersion(h,m){for(var y=m?m.split("."):w,v=h.split("."),C=0;C<3;C++){if(y[C]>v[C])return!0;if(y[C]<v[C])return!1}return!1}C.transitional=function transitional(h,m,y){var C=m&&isOlderVersion(m);function formatMessage(h,m){return"[Axios v"+v.version+"] Transitional option '"+h+"'"+m+(y?". "+y:"")}return function(y,v,w){if(!1===h)throw new Error(formatMessage(v," has been removed in "+m));return C&&!T[v]&&(T[v]=!0,console.warn(formatMessage(v," has been deprecated since v"+m+" and will be removed in the near future"))),!h||h(y,v,w)}},h.exports={isOlderVersion:isOlderVersion,assertOptions:function assertOptions(h,m,y){if("object"!=typeof h)throw new TypeError("options must be an object");for(var v=Object.keys(h),C=v.length;C-- >0;){var T=v[C],w=m[T];if(w){var A=h[T],P=void 0===A||w(A,T,h);if(!0!==P)throw new TypeError("option "+T+" must be "+P)}else if(!0!==y)throw Error("Unknown option "+T)}},validators:C}},function(h,m,y){"use strict";var v=y(396);function CancelToken(h){if("function"!=typeof h)throw new TypeError("executor must be a function.");var m;this.promise=new Promise((function promiseExecutor(h){m=h}));var y=this;h((function cancel(h){y.reason||(y.reason=new v(h),m(y.reason))}))}CancelToken.prototype.throwIfRequested=function throwIfRequested(){if(this.reason)throw this.reason},CancelToken.source=function source(){var h;return{token:new CancelToken((function executor(m){h=m})),cancel:h}},h.exports=CancelToken},function(h,m,y){"use strict";h.exports=function spread(h){return function wrap(m){return h.apply(null,m)}}},function(h,m,y){"use strict";h.exports=function isAxiosError(h){return"object"==typeof h&&!0===h.isAxiosError}},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0});const v=y(946),C=y(948);class ExperimentationServiceAutoPolling extends v.ExperimentationServiceBase{constructor(h,m,y,v,T,w,A,P){if(super(h,v,T,w,A,P),this.telemetry=h,this.filterProviders=m,this.refreshRateMs=y,this.featuresTelemetryPropertyName=v,this.assignmentContextTelemetryPropertyName=T,this.telemetryEventName=w,this.storageKey=A,this.storage=P,y<1e3&&0!==y)throw new Error("The minimum refresh rate for polling is 1000 ms (1 second). If you wish to deactivate this auto-polling use value of 0.");y>0&&(this.pollingService=new C.PollingService(y),this.pollingService.OnPollTick(async()=>{await super.getFeaturesAsync()}))}init(){this.pollingService?this.pollingService.StartPolling(!0):super.getFeaturesAsync()}async getFeaturesAsync(h=!1){if(this.pollingService){this.pollingService.StopPolling();let m=await super.getFeaturesAsync(h);return this.pollingService.StartPolling(),m}return await super.getFeaturesAsync(h)}}m.ExperimentationServiceAutoPolling=ExperimentationServiceAutoPolling},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0});const v=y(947);m.ExperimentationServiceBase=class ExperimentationServiceBase{constructor(h,m,y,C,T,w){this.telemetry=h,this.featuresTelemetryPropertyName=m,this.assignmentContextTelemetryPropertyName=y,this.telemetryEventName=C,this.storageKey=T,this.storage=w,this.featuresConsumed=!1,this.cachedTelemetryEvents=[],this._features={features:[],assignmentContext:"",configs:[]},this.storageKey||(this.storageKey="ABExp.Features"),this.storage||(w=new v.MemoryKeyValueStorage),this.loadCachePromise=this.loadCachedFeatureData(),this.initializePromise=this.loadCachePromise,this.initialFetch=new Promise((h,m)=>{this.resolveInitialFetchPromise=h})}get features(){return this._features}set features(h){this._features=h,this.telemetry&&(this.telemetry.setSharedProperty(this.featuresTelemetryPropertyName,this.features.features.join(";")),this.telemetry.setSharedProperty(this.assignmentContextTelemetryPropertyName,this.features.assignmentContext))}async getFeaturesAsync(h=!1){if(null!=this.fetchPromise){try{await this.fetchPromise}catch(h){}return this.features}if(!this.featureProviders||0===this.featureProviders.length)return Promise.resolve({features:[],assignmentContext:"",configs:[]});this.fetchPromise=Promise.all(this.featureProviders.map(async h=>await h.getFeatures()));try{const m=await this.fetchPromise;this.updateFeatures(m,h)}catch(h){}return this.fetchPromise=void 0,this.resolveInitialFetchPromise&&(this.resolveInitialFetchPromise(),this.resolveInitialFetchPromise=void 0),this.features}updateFeatures(h,m=!1){let y={features:[],assignmentContext:"",configs:[]};for(let m of h){for(let h of m.features)y.features.includes(h)||y.features.push(h);for(let h of m.configs){const m=y.configs.find(m=>m.Id===h.Id);m?m.Parameters=Object.assign(Object.assign({},m.Parameters),h.Parameters):y.configs.push(h)}y.assignmentContext+=m.assignmentContext}!m&&this.featuresConsumed||(this.features=y),this.storage&&this.storage.setValue(this.storageKey,y)}async loadCachedFeatureData(){let h;this.storage&&(h=await this.storage.getValue(this.storageKey),void 0!==h&&void 0===h.configs&&(h.configs=[])),0===this.features.features.length&&(this.features=h||{features:[],assignmentContext:"",configs:[]})}isFlightEnabled(h){return this.featuresConsumed=!0,this.PostEventToTelemetry(h),this.features.features.includes(h)}async isCachedFlightEnabled(h){return await this.loadCachePromise,this.featuresConsumed=!0,this.PostEventToTelemetry(h),this.features.features.includes(h)}async isFlightEnabledAsync(h){const m=await this.getFeaturesAsync(!0);return this.featuresConsumed=!0,this.PostEventToTelemetry(h),m.features.includes(h)}getTreatmentVariable(h,m){var y;return this.featuresConsumed=!0,this.PostEventToTelemetry(`${h}.${m}`),null===(y=this.features.configs.find(m=>m.Id===h))||void 0===y?void 0:y.Parameters[m]}async getTreatmentVariableAsync(h,m,y){if(y){const y=this.featuresConsumed,v=this.getTreatmentVariable(h,m);if(void 0!==v)return v;this.featuresConsumed=y}return await this.getFeaturesAsync(!0),this.getTreatmentVariable(h,m)}PostEventToTelemetry(h){this.cachedTelemetryEvents.includes(h)||(this.telemetry.postEvent(this.telemetryEventName,new Map([["ABExp.queriedFeature",h]])),this.cachedTelemetryEvents.push(h))}invokeInit(){this.init()}addFeatureProvider(...h){if(null!=h&&null!=this.featureProviders)for(let m of h)this.featureProviders.push(m)}}},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0});m.MemoryKeyValueStorage=class MemoryKeyValueStorage{constructor(){this.storage=new Map}async getValue(h,m){return this.storage.has(h)?await Promise.resolve(this.storage.get(h)):await Promise.resolve(m||void 0)}setValue(h,m){this.storage.set(h,m)}}},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0});m.PollingService=class PollingService{constructor(h){this.fetchInterval=h}StopPolling(){clearInterval(this.intervalHandle),this.intervalHandle=void 0}OnPollTick(h){this.onTick=h}StartPolling(h=!1){this.intervalHandle&&this.StopPolling(),null!=this.onTick&&(h&&this.onTick().then(()=>{}).catch(()=>{}),this.intervalHandle=setInterval(async()=>{await this.onTick()},this.fetchInterval),this.intervalHandle.unref&&this.intervalHandle.unref())}}},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0});m.MementoKeyValueStorage=class MementoKeyValueStorage{constructor(h){this.mementoGlobalStorage=h}async getValue(h,m){return await this.mementoGlobalStorage.get(h)||m}setValue(h,m){this.mementoGlobalStorage.update(h,m)}}},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0});m.default=class TelemetryDisabledExperimentationService{constructor(){this.initializePromise=Promise.resolve(),this.initialFetch=Promise.resolve()}isFlightEnabled(h){return!1}isCachedFlightEnabled(h){return Promise.resolve(!1)}isFlightEnabledAsync(h){return Promise.resolve(!1)}getTreatmentVariable(h,m){}getTreatmentVariableAsync(h,m){return Promise.resolve(void 0)}}},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0});const v=y(397),C=y(5),T=y(952),w=y(4),A=y(399);function makeColorizeFunc(h){return m=>h+m+"[0m"}m.assert=function assert(h,m,y,P){h||(v.checkDebugging(),C.traceSource.withName(w.vsls.TraceSources.ClientCoEditing).error(`Assertion Violation: ${m}`),T.CoauthoringTelemetry.ReportFailedAssertion(y||m,P),A.showDiagnosticErrorMessage(`Coediting Assertion Violation: ${m}`))},function(h){h.black=makeColorizeFunc("[30m"),h.red=makeColorizeFunc("[31m"),h.green=makeColorizeFunc("[32m"),h.yellow=makeColorizeFunc("[33m"),h.blue=makeColorizeFunc("[34m"),h.magenta=makeColorizeFunc("[35m"),h.cyan=makeColorizeFunc("[36m"),h.white=makeColorizeFunc("[37m")}(m.colorize||(m.colorize={}));class LoggerImpl{constructor(){this.indentValue=0}indent(){this.indentValue++}reset(){this.indentValue=0}unindent(){this.indentValue--}logTrace(h,...m){this.logInternal(h.verbose.bind(h),...m)}log(...h){this.logInternal(console.log,...h)}logInternal(h,...m){let y="";for(let h=0;h<this.indentValue;h++)y+="|   ";h(y+m.join(""))}}m.LoggerImpl=LoggerImpl,m.logger=new LoggerImpl},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0});const v=y(15),C=y(8),T=y(398),w=y(162);class CoauthoringTelemetry{static init(){C.Telemetry.addFilter(new C.SendOnceFilter(Event.ASSERTION_FAILED,[w.TelemetryPropertyNames.EVENT_MESSAGE])),C.Telemetry.addFilter(new C.SendOnceFilter(Event.COEDITING_ERROR,[w.TelemetryPropertyNames.EVENT_MESSAGE])),C.Telemetry.addFilter(new C.SendOnceFilter(Event.DESYNC)),C.Telemetry.addFilter(new C.SendOnceFilter(Event.SYNC_CHECK)),C.Telemetry.addFilter(new C.SendOnceFilter(Event.SYNC_CHECK_LOCAL)),C.Telemetry.addFilter(new C.SendOnceFilter(Event.SYNC_CHECK_FOR_VERSION)),C.Telemetry.addFilter(new C.SendOnceFilter(Event.SLOW_SYNC_CHECK)),C.Telemetry.addFilter(new C.SendOnceFilter(Event.DROPPED_MESSAGE,[Property.ID_TYPE,Property.WITH_DELAY])),C.Telemetry.addFilter(new C.SendOnceFilter("block-coeditattempt",["liveshare.BlockReason"])),C.Telemetry.addFilter(new C.SendOnceFilter(w.TelemetryEventNames.ADD_EXTERNAL_FILE)),C.Telemetry.addFilter(new C.SendOnceFilter(Event.SLOW_PING)),this.coeditingLogs=new v.MemoryTraceListener(50)}static ReportMetrics(h){let m=new C.TelemetryEvent(Event.REPORT_METRICS);for(let y of h)y.AttachToEvent(m);m.send()}static get logListener(){return CoauthoringTelemetry.coeditingLogs}static getLogs(){return this.coeditingLogs.getLogs().reverse().join("\n")}static addLogs(h){let m=this.getLogs();m=m.replace(/[\\|\/]/gi,"-"),h.addProperty(Property.LOGS,m)}static BufferClosed(h,m,y,v,T,w,A,P,k,R,M,N,D){const I=new C.TelemetryEvent(Event.BUFFER_CLOSED);I.addProperty(Property.CONTENT_TYPE,h),I.addMeasure(Property.NUMBER_OF_LOCAL_EDITS,m),I.addMeasure(Property.NUMBER_OF_REMOTE_EDITS,y),I.addProperty(Property.NUMBER_OF_HIGH_DENSITY_EDITS,JSON.stringify(v)),I.addMeasure(Property.NUMBER_OF_LOCAL_UNDOS,T),I.addMeasure(Property.NUMBER_OF_REMOTE_UNDOS,w),I.addMeasure(Property.NUMBER_OF_SIMULTANEOUS_EDITS,k),I.addMeasure(Property.LINE_DIFF_COUNT,R),I.addMeasure(Property.LINE_DIFF_SUM,M),I.addMeasure(Property.NUMBER_OF_VISIBLE_EDITS,N),I.addMeasure(Property.NUMBER_OF_INVISIBLE_EDITS,D),I.send()}static AddSessionClosedEventAugmenter(h){this.sessionClosedEventAugmenters.push(h)}static SessionClosed(h,m,y,v,T,w,A,P,k,R){const M=new C.TelemetryEvent(Event.SESSION_CLOSED);this.sessionClosedEventAugmenters.forEach(h=>h(M)),this.sessionClosedEventAugmenters=[],M.addMeasure(Property.NUMBER_OF_JUMP_TOS,h),M.addMeasure(Property.NUMBER_OF_FAILED_JUMP_TOS,m),M.addMeasure(Property.NUMBER_OF_PINS,y),M.addMeasure(Property.NUMBER_OF_EXPLICIT_UNPINS,v),M.addMeasure(Property.NUMBER_OF_AUTOMATIC_UNPINS,T),M.addMeasure(Property.NUMBER_OF_SYNC_CHECKS,w),M.addMeasure(Property.NUMBER_OF_FAILED_SYNC_CHECKS,A),M.addMeasure(Property.NUMBER_OF_SLOW_SYNC_CHECKS,P),M.addMeasure(Property.NUMBER_OF_OPEN_DIFFS,k),M.addMeasure(Property.NUMBER_OF_CLOSED_DIFFS,R),M.send()}static ReportNonFunctionalNavigation(h){const m=new C.TelemetryEvent(Event.NON_FUNCTIONAL_NAVIGATION);m.addProperty(Property.NON_FUNCTIONAL_NAVIGATION,A[h]),m.send()}static ReportDesync(h,m,y,v=!1){const T=new C.TelemetryEvent(Event.DESYNC);T.addProperty(Property.DESYNC_REASON,P[h]),T.addProperty(Property.FILE_EXTENSION,m),T.addProperty(Property.MONIKER,y),T.addProperty(Property.DESYNC_RECOVERY,v),this.addLogs(T),T.send()}static ReportFuzzyDesync(h,m,y){const v=new C.TelemetryEvent(Event.FUZZY_DESYNC);v.addProperty(Property.FILE_EXTENSION,h),v.addProperty(Property.MONIKER,m),v.addProperty(Property.AUTO_SAVE,y),this.addLogs(v),v.send()}static ReportFalseDesync(){new C.TelemetryEvent(Event.FALSE_DESYNC).send()}static ReportSyncCheck(){new C.TelemetryEvent(Event.SYNC_CHECK).send()}static ReportLocalSyncCheck(){new C.TelemetryEvent(Event.SYNC_CHECK_LOCAL).send()}static ReportSyncCheckForVersion(h){const m=new C.TelemetryEvent(Event.SYNC_CHECK_FOR_VERSION);m.addProperty(Property.SENDING_SYNC_CHECK,h),m.send()}static ReportSlowSyncCheck(){new C.TelemetryEvent(Event.SLOW_SYNC_CHECK).send()}static ReportFailedAssertion(h,m){const y=new C.Fault(Event.ASSERTION_FAILED,C.FaultType.Error,h,new Error("Assertion Failed"));if(m){const h=m.split("."),v=h.length>1?h.pop():"NA",C=T.PathUtil.getMonikerFromRelativePath(m).moniker||"None";y.addProperty(Property.FILE_EXTENSION,v),y.addProperty(Property.MONIKER,C)}this.addLogs(y),y.send()}static ReportCoeditingError(h,m){new C.Fault(Event.COEDITING_ERROR,C.FaultType.Error,h,m).send()}static ReportDroppedMessage(h,m,y,v){const T=new C.TelemetryEvent(Event.DROPPED_MESSAGE);T.addMeasure(Property.EXPECTED_ID,h),T.addMeasure(Property.ACTUAL_ID,m),T.addProperty(Property.ID_TYPE,y),T.addProperty(Property.WITH_DELAY,v),T.send()}static ReportCaseSensitiveFileSystem(){new C.TelemetryEvent(Event.REPORT_CASE_SENSITIVE_FILE_SYSTEM).send()}}m.CoauthoringTelemetry=CoauthoringTelemetry,CoauthoringTelemetry.FEATURE_PREFIX="Coauthoring/",CoauthoringTelemetry.PROPERTY_PREFIX=w.TelemetryPropertyNames.FEATURE_NAME+"Coauthoring.",CoauthoringTelemetry.sessionClosedEventAugmenters=[];m.TimeTelemetry=class TimeTelemetry{constructor(h,m){this.total=0,this.canceled=0,this.failed=0,this.sum=0,this.buckets=[new Bucket(25),new Bucket(50),new Bucket(100),new Bucket(250),new Bucket(500),new Bucket(1e3),new Bucket(2e3),new Bucket(Number.MAX_SAFE_INTEGER)],this.name=h,CoauthoringTelemetry.AddSessionClosedEventAugmenter(h=>{m&&m(),this.AttachToEvent(h)})}RecordTime(h){this.total++,this.sum+=h.valueOf();for(let m=0;m<this.buckets.length;m++)if(this.buckets[m].max>=h)return void this.buckets[m].count++}AttachToEvent(h){this.buckets.forEach(m=>{h.addMeasure(`${CoauthoringTelemetry.PROPERTY_PREFIX}${this.name}.${m.name}`,m.count)}),h.addMeasure(`${CoauthoringTelemetry.PROPERTY_PREFIX}${this.name}.count`,this.total),h.addMeasure(`${CoauthoringTelemetry.PROPERTY_PREFIX}${this.name}.canceled`,this.canceled),h.addMeasure(`${CoauthoringTelemetry.PROPERTY_PREFIX}${this.name}.failed`,this.failed);let m=0;0!==this.total&&(m=this.sum/this.total),h.addMeasure(`${CoauthoringTelemetry.PROPERTY_PREFIX}${this.name}.average`,m)}RecordCancel(){this.canceled++,this.total++}RecordFailed(){this.failed++,this.total++}};class Bucket{constructor(h){this.max=0,this.count=0,this.max=h,this.name="bucket."+(this.max===Number.MAX_SAFE_INTEGER?"max":this.max.toString())}}var A,P;m.Bucket=Bucket,function(h){h[h.FindInFiles=0]="FindInFiles"}(A=m.NonFunctionalNavigation||(m.NonFunctionalNavigation={})),function(h){h[h.Unknown=0]="Unknown",h[h.MessagesOutOfOrder=1]="MessagesOutOfOrder"}(P=m.DesyncReason||(m.DesyncReason={}));class Event{}m.Event=Event,Event.NON_FUNCTIONAL_NAVIGATION=CoauthoringTelemetry.FEATURE_PREFIX+"navigate-nonfunctional",Event.BUFFER_CLOSED=CoauthoringTelemetry.FEATURE_PREFIX+"close-buffer",Event.SESSION_CLOSED=CoauthoringTelemetry.FEATURE_PREFIX+"close-session",Event.REPORT_METRICS=CoauthoringTelemetry.FEATURE_PREFIX+"report-timingmetrics",Event.DESYNC=CoauthoringTelemetry.FEATURE_PREFIX+"desync-coediting",Event.DESYNC_RELOAD=CoauthoringTelemetry.FEATURE_PREFIX+"desync-reload",Event.FUZZY_DESYNC=CoauthoringTelemetry.FEATURE_PREFIX+"desync-fuzzy",Event.FALSE_DESYNC=CoauthoringTelemetry.FEATURE_PREFIX+"desync-falsealarm",Event.SYNC_CHECK=CoauthoringTelemetry.FEATURE_PREFIX+"sync-check",Event.SYNC_CHECK_LOCAL=CoauthoringTelemetry.FEATURE_PREFIX+"sync-checklocal",Event.SYNC_CHECK_FOR_VERSION=CoauthoringTelemetry.FEATURE_PREFIX+"sync-checkforversion",Event.SLOW_SYNC_CHECK=CoauthoringTelemetry.FEATURE_PREFIX+"sync-checkslow",Event.COEDITING_ERROR=CoauthoringTelemetry.FEATURE_PREFIX+"coedit-processing-error",Event.DROPPED_MESSAGE=CoauthoringTelemetry.FEATURE_PREFIX+"drop-message",Event.DROPPED_HOST_MESSAGE_FAULT=w.TelemetryEventNames.FAULT_PREFIX+"drop-hostmessage-fault",Event.ASSERTION_FAILED=w.TelemetryEventNames.FAULT_PREFIX+"assert-coediting-fault",Event.ADD_UNTITLED_FILE=CoauthoringTelemetry.FEATURE_PREFIX+"add-untitledfile",Event.RECEIVE_UNTITLED_FILE=CoauthoringTelemetry.FEATURE_PREFIX+"receive-untitledfile",Event.CLOSE_UNTITLED_FILE=CoauthoringTelemetry.FEATURE_PREFIX+"close-untitledfile",Event.SAVE_UNTITLED_FILE=CoauthoringTelemetry.FEATURE_PREFIX+"save-untitledfile",Event.REPORT_CASE_SENSITIVE_FILE_SYSTEM=CoauthoringTelemetry.FEATURE_PREFIX+"report-casesensitivefilesystem",Event.SLOW_PING="ping-slow",Event.RESYNC_DOCUMENT="resync-document";class Property{}Property.CONTENT_TYPE=CoauthoringTelemetry.PROPERTY_PREFIX+"ContentType",Property.NUMBER_OF_LOCAL_EDITS=CoauthoringTelemetry.PROPERTY_PREFIX+"NumberOfLocalEdits",Property.NUMBER_OF_REMOTE_EDITS=CoauthoringTelemetry.PROPERTY_PREFIX+"NumberOfRemoteEdits",Property.NUMBER_OF_HIGH_DENSITY_EDITS=CoauthoringTelemetry.PROPERTY_PREFIX+"NumberOfHighDensityEdits",Property.NUMBER_OF_LOCAL_UNDOS=CoauthoringTelemetry.PROPERTY_PREFIX+"NumberOfLocalUndos",Property.NUMBER_OF_REMOTE_UNDOS=CoauthoringTelemetry.PROPERTY_PREFIX+"NumberOfRemoteUndos",Property.NUMBER_OF_HIGHLIGHTS=CoauthoringTelemetry.PROPERTY_PREFIX+"NumberOfHighlights",Property.AVERAGE_LATENCY=CoauthoringTelemetry.PROPERTY_PREFIX+"AverageLatency",Property.NUMBER_OF_JUMP_TOS=CoauthoringTelemetry.PROPERTY_PREFIX+"NumberOfJumpTos",Property.NUMBER_OF_FAILED_JUMP_TOS=CoauthoringTelemetry.PROPERTY_PREFIX+"NumberOfFailedJumpTos",Property.NUMBER_OF_PINS=CoauthoringTelemetry.PROPERTY_PREFIX+"NumberOfPins",Property.NUMBER_OF_EXPLICIT_UNPINS=CoauthoringTelemetry.PROPERTY_PREFIX+"NumberOfExplicitUnpins",Property.NUMBER_OF_AUTOMATIC_UNPINS=CoauthoringTelemetry.PROPERTY_PREFIX+"NumberOfAutomaticUnpins",Property.NUMBER_OF_SYNC_CHECKS=CoauthoringTelemetry.PROPERTY_PREFIX+"NumberOfSyncChecks",Property.SENDING_SYNC_CHECK=CoauthoringTelemetry.PROPERTY_PREFIX+"SendingSyncCheck",Property.NUMBER_OF_FAILED_SYNC_CHECKS=CoauthoringTelemetry.PROPERTY_PREFIX+"NumberOfFailedSyncChecks",Property.NUMBER_OF_SLOW_SYNC_CHECKS=CoauthoringTelemetry.PROPERTY_PREFIX+"NumberOfSlowSyncChecks",Property.NON_FUNCTIONAL_NAVIGATION=CoauthoringTelemetry.PROPERTY_PREFIX+"NonFunctionalNavigation",Property.DESYNC_REASON=CoauthoringTelemetry.PROPERTY_PREFIX+"DesyncReason",Property.FILE_EXTENSION=CoauthoringTelemetry.PROPERTY_PREFIX+"FileExtension",Property.MONIKER=CoauthoringTelemetry.PROPERTY_PREFIX+"Moniker",Property.AUTO_SAVE=CoauthoringTelemetry.PROPERTY_PREFIX+"AutoSave",Property.NUMBER_OF_SIMULTANEOUS_EDITS=CoauthoringTelemetry.PROPERTY_PREFIX+"NumSimultaneousEdits",Property.LINE_DIFF_SUM=CoauthoringTelemetry.PROPERTY_PREFIX+"LineDiffSum",Property.LINE_DIFF_COUNT=CoauthoringTelemetry.PROPERTY_PREFIX+"LineDiffCount",Property.NUMBER_OF_VISIBLE_EDITS=CoauthoringTelemetry.PROPERTY_PREFIX+"NumVisibleEdits",Property.NUMBER_OF_INVISIBLE_EDITS=CoauthoringTelemetry.PROPERTY_PREFIX+"NumInvisibleEdits",Property.DESYNC_RECOVERY=CoauthoringTelemetry.PROPERTY_PREFIX+"DesyncRecovery",Property.NUMBER_OF_OPEN_DIFFS=CoauthoringTelemetry.PROPERTY_PREFIX+"NumOpenDiff",Property.NUMBER_OF_CLOSED_DIFFS=CoauthoringTelemetry.PROPERTY_PREFIX+"NumClosedDiff",Property.ID_TYPE=CoauthoringTelemetry.PROPERTY_PREFIX+"IdType",Property.EXPECTED_ID=CoauthoringTelemetry.PROPERTY_PREFIX+"ExpectedEventId",Property.ACTUAL_ID=CoauthoringTelemetry.PROPERTY_PREFIX+"ActualEventId",Property.WITH_DELAY=CoauthoringTelemetry.PROPERTY_PREFIX+"WithDelay",Property.LOGS=CoauthoringTelemetry.PROPERTY_PREFIX+"Logs"},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0});const v=y(20),C=y(11),T=y(401),w=y(958),A=y(959);function fileDownloader(h,m){const y=v.parse(h),A=v.format(y),P=C.createHash("sha256").update(A).digest("hex");let k;return()=>{const h=Date.now()-(m||18e5),httpsDownload=h=>w.request(y,h).then(m=>{const saveFile=(h,m)=>new T.RemoteFile(Date.now(),m,h).saveFileAndClean(P);switch(m.getStatusCode()){case w.StatusCode.OK:return saveFile(m.getBuffer(),m.getHeaders().etag);case w.StatusCode.NotModified:return T.getCachedFile(P).then(m=>saveFile(m.getBuffer(),h));default:return Promise.reject("HTTPS error")}}).catch(()=>T.getCachedFile(P,k));return T.getCachedFile(P,k,h).then(m=>m.getDate()>=h?m:httpsDownload(m.getETag()),()=>httpsDownload()).then(h=>{const m=h.getETag();return k&&k===m?Promise.reject("no changes"):(k=m,h.getBuffer())})}}m.downloadFile=function downloadFile(h,m){return fileDownloader(h,m)()},m.subscribeOnFileUpdate=function subscribeOnFileUpdate(h,m,y){const v=fileDownloader(h,y=y||18e5);let C=0;return A.timeout(()=>(++C,v().then(m,()=>C<=1?m(null):null).catch(()=>null)),y,!0)}},function(h,m,y){var v;(function(){"use strict";var C={},T={"":"A","":"A","":"A","":"A","":"A","":"A","":"A","":"A","":"A","":"A","":"A","":"A","":"A","":"A","":"A","":"A","":"A","":"A","":"A","":"A","":"A","":"A","":"A","":"A","":"A","":"A","":"A","":"A","":"A","":"A","":"AA","":"AE","":"AE","":"AE","":"AO","":"AU","":"AV","":"AV","":"AY","":"B","":"B","":"B","":"B","":"B","":"B","":"C","":"C","":"C","":"C","":"C","":"C","":"C","":"C","":"D","":"D","":"D","":"D","":"D","":"D","":"D","":"D","":"D","":"D","":"D","":"DZ","":"DZ","":"E","":"E","":"E","":"E","":"E","":"E","":"E","":"E","":"E","":"E","":"E","":"E","":"E","":"E","":"E","":"E","":"E","":"E","":"E","":"E","":"E","":"E","":"E","":"E","":"E","":"E","":"ET","":"F","":"F","":"G","":"G","":"G","":"G","":"G","":"G","":"G","":"G","":"G","":"H","":"H","":"H","":"H","":"H","":"H","":"H","":"H","":"H","":"I","":"I","":"I","":"I","":"I","":"I","":"I","":"I","":"I","":"I","":"I","":"I","":"I","":"I","":"I","":"I","":"I","":"D","":"F","":"G","":"R","":"S","":"T","":"IS","":"J","":"J","":"K","":"K","":"K","":"K","":"K","":"K","":"K","":"K","":"K","":"K","":"L","":"L","":"L","":"L","":"L","":"L","":"L","":"L","":"L","":"L","":"L","":"L","":"L","":"L","":"LJ","":"M","":"M","":"M","":"M","":"N","":"N","":"N","":"N","":"N","":"N","":"N","":"N","":"N","":"N","":"N","":"N","":"NJ","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"OI","":"OO","":"E","":"O","":"OU","":"P","":"P","":"P","":"P","":"P","":"P","":"P","":"Q","":"Q","":"R","":"R","":"R","":"R","":"R","":"R","":"R","":"R","":"R","":"R","":"R","":"C","":"E","":"S","":"S","":"S","":"S","":"S","":"S","":"S","":"S","":"S","":"S","":"SS","":"T","":"T","":"T","":"T","":"T","":"T","":"T","":"T","":"T","":"T","":"T","":"A","":"L","":"M","":"V","":"TZ","":"U","":"U","":"U","":"U","":"U","":"U","":"U","":"U","":"U","":"U","":"U","":"U","":"U","":"U","":"U","":"U","":"U","":"U","":"U","":"U","":"U","":"U","":"U","":"U","":"U","":"U","":"U","":"U","":"U","":"U","":"V","":"V","":"V","":"V","":"VY","":"W","":"W","":"W","":"W","":"W","":"W","":"W","":"X","":"X","":"Y","":"Y","":"Y","":"Y","":"Y","":"Y","":"Y","":"Y","":"Y","":"Y","":"Y","":"Y","":"Z","":"Z","":"Z","":"Z","":"Z","":"Z","":"Z","":"Z","":"Z","":"IJ","":"OE","":"A","":"AE","":"B","":"B","":"C","":"D","":"E","":"F","":"G","":"G","":"H","":"I","":"R","":"J","":"K","":"L","":"L","":"M","":"N","":"O","":"OE","":"O","":"OU","":"P","":"R","":"N","":"R","":"S","":"T","":"E","":"R","":"U","":"V","":"W","":"Y","":"Z","":"a","":"a","":"a","":"a","":"a","":"a","":"a","":"a","":"a","":"a","":"a","":"a","":"a","":"a","":"a","":"a","":"a","":"a","":"a","":"a","":"a","":"a","":"a","":"a","":"a","":"a","":"a","":"a","":"a","":"a","":"a","":"a","":"aa","":"ae","":"ae","":"ae","":"ao","":"au","":"av","":"av","":"ay","":"b","":"b","":"b","":"b","":"b","":"b","":"b","":"b","":"o","":"c","":"c","":"c","":"c","":"c","":"c","":"c","":"c","":"c","":"d","":"d","":"d","":"d","":"d","":"d","":"d","":"d","":"d","":"d","":"d","":"d","":"d","":"d","":"i","":"j","":"j","":"j","":"dz","":"dz","":"e","":"e","":"e","":"e","":"e","":"e","":"e","":"e","":"e","":"e","":"e","":"e","":"e","":"e","":"e","":"e","":"e","":"e","":"e","":"e","":"e","":"e","":"e","":"e","":"e","":"e","":"e","":"e","":"et","":"f","":"f","":"f","":"f","":"g","":"g","":"g","":"g","":"g","":"g","":"g","":"g","":"g","":"g","":"h","":"h","":"h","":"h","":"h","":"h","":"h","":"h","":"h","":"h","":"h","":"hv","":"i","":"i","":"i","":"i","":"i","":"i","":"i","":"i","":"i","":"i","":"i","":"i","":"i","":"i","":"i","":"i","":"i","":"d","":"f","":"g","":"r","":"s","":"t","":"is","":"j","":"j","":"j","":"j","":"k","":"k","":"k","":"k","":"k","":"k","":"k","":"k","":"k","":"k","":"k","":"l","":"l","":"l","":"l","":"l","":"l","":"l","":"l","":"l","":"l","":"l","":"l","":"l","":"l","":"l","":"l","":"l","":"lj","":"s","":"s","":"s","":"s","":"m","":"m","":"m","":"m","":"m","":"m","":"n","":"n","":"n","":"n","":"n","":"n","":"n","":"n","":"n","":"n","":"n","":"n","":"n","":"n","":"n","":"nj","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"oi","":"oo","":"e","":"e","":"o","":"o","":"ou","":"p","":"p","":"p","":"p","":"p","":"p","":"p","":"p","":"p","":"q","":"q","":"q","":"q","":"r","":"r","":"r","":"r","":"r","":"r","":"r","":"r","":"r","":"r","":"r","":"r","":"r","":"r","":"r","":"r","":"c","":"c","":"e","":"r","":"s","":"s","":"s","":"s","":"s","":"s","":"s","":"s","":"s","":"s","":"s","":"s","":"s","":"s","":"g","":"ss","":"o","":"o","":"u","":"t","":"t","":"t","":"t","":"t","":"t","":"t","":"t","":"t","":"t","":"t","":"t","":"t","":"t","":"t","":"th","":"a","":"ae","":"e","":"g","":"h","":"h","":"h","":"i","":"k","":"l","":"m","":"m","":"oe","":"r","":"r","":"r","":"r","":"t","":"v","":"w","":"y","":"tz","":"u","":"u","":"u","":"u","":"u","":"u","":"u","":"u","":"u","":"u","":"u","":"u","":"u","":"u","":"u","":"u","":"u","":"u","":"u","":"u","":"u","":"u","":"u","":"u","":"u","":"u","":"u","":"u","":"u","":"u","":"u","":"ue","":"um","":"v","":"v","":"v","":"v","":"v","":"v","":"v","":"vy","":"w","":"w","":"w","":"w","":"w","":"w","":"w","":"w","":"x","":"x","":"x","":"y","":"y","":"y","":"y","":"y","":"y","":"y","":"y","":"y","":"y","":"y","":"y","":"y","":"z","":"z","":"z","":"z","":"z","":"z","":"z","":"z","":"z","":"z","":"z","":"z","":"z","":"z","":"ff","":"ffi","":"ffl","":"fi","":"fl","":"ij","":"oe","":"st","":"a","":"e","":"i","":"j","":"o","":"r","":"u","":"v","":"x"};function initialize(h,m){h.s=null!=m?"string"==typeof m?m:m.toString():m,h.orig=m,null!=m?h.__defineGetter__?h.__defineGetter__("length",(function(){return h.s.length})):h.length=m.length:h.length=-1}function S(h){initialize(this,h)}var w=String.prototype,A=S.prototype={between:function(h,m){var y=this.s,v=y.indexOf(h),C=y.indexOf(m,v+h.length);return-1==C&&null!=m?new this.constructor(""):-1==C&&null==m?new this.constructor(y.substring(v+h.length)):new this.constructor(y.slice(v+h.length,C))},camelize:function(){var h=this.trim().s.replace(/(\-|_|\s)+(.)?/g,(function(h,m,y){return y?y.toUpperCase():""}));return new this.constructor(h)},capitalize:function(){return new this.constructor(this.s.substr(0,1).toUpperCase()+this.s.substring(1).toLowerCase())},charAt:function(h){return this.s.charAt(h)},chompLeft:function(h){var m=this.s;return 0===m.indexOf(h)?(m=m.slice(h.length),new this.constructor(m)):this},chompRight:function(h){if(this.endsWith(h)){var m=this.s;return m=m.slice(0,m.length-h.length),new this.constructor(m)}return this},collapseWhitespace:function(){var h=this.s.replace(/[\s\xa0]+/g," ").replace(/^\s+|\s+$/g,"");return new this.constructor(h)},contains:function(h){return this.s.indexOf(h)>=0},count:function(h){return y(955)(this.s,h)},dasherize:function(){var h=this.trim().s.replace(/[_\s]+/g,"-").replace(/([A-Z])/g,"-$1").replace(/-+/g,"-").toLowerCase();return new this.constructor(h)},latinise:function(){var h=this.replace(/[^A-Za-z0-9\[\] ]/g,(function(h){return T[h]||h}));return new this.constructor(h)},decodeHtmlEntities:function(){var h=this.s;return h=h.replace(/&#(\d+);?/g,(function(h,m){return String.fromCharCode(m)})).replace(/&#[xX]([A-Fa-f0-9]+);?/g,(function(h,m){return String.fromCharCode(parseInt(m,16))})).replace(/&([^;\W]+;?)/g,(function(h,m){var y=m.replace(/;$/,""),v=C[m]||m.match(/;$/)&&C[y];return"number"==typeof v?String.fromCharCode(v):"string"==typeof v?v:h})),new this.constructor(h)},endsWith:function(){for(var h=Array.prototype.slice.call(arguments,0),m=0;m<h.length;++m){var y=this.s.length-h[m].length;if(y>=0&&this.s.indexOf(h[m],y)===y)return!0}return!1},escapeHTML:function(){return new this.constructor(this.s.replace(/[&<>"']/g,(function(h){return"&"+N[h]+";"})))},ensureLeft:function(h){var m=this.s;return 0===m.indexOf(h)?this:new this.constructor(h+m)},ensureRight:function(h){var m=this.s;return this.endsWith(h)?this:new this.constructor(m+h)},humanize:function(){if(null===this.s||void 0===this.s)return new this.constructor("");var h=this.underscore().replace(/_id$/,"").replace(/_/g," ").trim().capitalize();return new this.constructor(h)},isAlpha:function(){return!/[^a-z\xDF-\xFF]|^$/.test(this.s.toLowerCase())},isAlphaNumeric:function(){return!/[^0-9a-z\xDF-\xFF]/.test(this.s.toLowerCase())},isEmpty:function(){return null===this.s||void 0===this.s||/^[\s\xa0]*$/.test(this.s)},isLower:function(){return this.isAlpha()&&this.s.toLowerCase()===this.s},isNumeric:function(){return!/[^0-9]/.test(this.s)},isUpper:function(){return this.isAlpha()&&this.s.toUpperCase()===this.s},left:function(h){if(h>=0){var m=this.s.substr(0,h);return new this.constructor(m)}return this.right(-h)},lines:function(){return this.replaceAll("\r\n","\n").s.split("\n")},pad:function(h,m){if(null==m&&(m=" "),this.s.length>=h)return new this.constructor(this.s);h-=this.s.length;var y=Array(Math.ceil(h/2)+1).join(m),v=Array(Math.floor(h/2)+1).join(m);return new this.constructor(y+this.s+v)},padLeft:function(h,m){return null==m&&(m=" "),this.s.length>=h?new this.constructor(this.s):new this.constructor(Array(h-this.s.length+1).join(m)+this.s)},padRight:function(h,m){return null==m&&(m=" "),this.s.length>=h?new this.constructor(this.s):new this.constructor(this.s+Array(h-this.s.length+1).join(m))},parseCSV:function(h,m,y,v){h=h||",",y=y||"\\",void 0===m&&(m='"');var C=0,T=[],w=[],A=this.s.length,P=!1,k=!1,R=this,ca=function(h){return R.s.charAt(h)};if(void 0!==v)var M=[];for(m||(P=!0);C<A;){var N=ca(C);switch(N){case y:if(P&&(y!==m||ca(C+1)===m)){C+=1,T.push(ca(C));break}if(y!==m)break;case m:P=!P;break;case h:k&&(P=!1,k=!1),P&&m?T.push(N):(w.push(T.join("")),T.length=0);break;case v:k?(P=!1,k=!1,w.push(T.join("")),M.push(w),w=[],T.length=0):P?T.push(N):M&&(w.push(T.join("")),M.push(w),w=[],T.length=0);break;case" ":P&&T.push(N);break;default:P?T.push(N):N!==m&&(T.push(N),P=!0,k=!0)}C+=1}return w.push(T.join("")),M?(M.push(w),M):w},replaceAll:function(h,m){var y=this.s.split(h).join(m);return new this.constructor(y)},splitLeft:function(h,m,v){return y(956)(this.s,h,m,v)},splitRight:function(h,m,v){return y(957)(this.s,h,m,v)},strip:function(){for(var h=this.s,m=0,y=arguments.length;m<y;m++)h=h.split(arguments[m]).join("");return new this.constructor(h)},stripLeft:function(h){var m,y,v=ensureString(this.s);return void 0===h?y=/^\s+/g:(m=escapeRegExp(h),y=new RegExp("^["+m+"]+","g")),new this.constructor(v.replace(y,""))},stripRight:function(h){var m,y,v=ensureString(this.s);return void 0===h?y=/\s+$/g:(m=escapeRegExp(h),y=new RegExp("["+m+"]+$","g")),new this.constructor(v.replace(y,""))},right:function(h){if(h>=0){var m=this.s.substr(this.s.length-h,h);return new this.constructor(m)}return this.left(-h)},setValue:function(h){return initialize(this,h),this},slugify:function(){var h=new S(new S(this.s).latinise().s.replace(/[^\w\s-]/g,"").toLowerCase()).dasherize().s;return"-"===h.charAt(0)&&(h=h.substr(1)),new this.constructor(h)},startsWith:function(){for(var h=Array.prototype.slice.call(arguments,0),m=0;m<h.length;++m)if(0===this.s.lastIndexOf(h[m],0))return!0;return!1},stripPunctuation:function(){return new this.constructor(this.s.replace(/[^\w\s]|_/g,"").replace(/\s+/g," "))},stripTags:function(){var h=this.s,m=arguments.length>0?arguments:[""];return multiArgs(m,(function(m){h=h.replace(RegExp("</?"+m+"[^<>]*>","gi"),"")})),new this.constructor(h)},template:function(h,m,y){var v=this.s,C=(m=m||Export.TMPL_OPEN,y=y||Export.TMPL_CLOSE,m.replace(/[-[\]()*\s]/g,"\\$&").replace(/\$/g,"\\$")),T=y.replace(/[-[\]()*\s]/g,"\\$&").replace(/\$/g,"\\$"),w=new RegExp(C+"(.+?)"+T,"g");return(v.match(w)||[]).forEach((function(C){var T=C.substring(m.length,C.length-y.length).trim(),w=void 0===h[T]?"":h[T];v=v.replace(C,w)})),new this.constructor(v)},times:function(h){return new this.constructor(new Array(h+1).join(this.s))},titleCase:function(){var h=this.s;return h&&(h=h.replace(/(^[a-z]| [a-z]|-[a-z]|_[a-z])/g,(function(h){return h.toUpperCase()}))),new this.constructor(h)},toBoolean:function(){if("string"==typeof this.orig){var h=this.s.toLowerCase();return"true"===h||"yes"===h||"on"===h||"1"===h}return!0===this.orig||1===this.orig},toFloat:function(h){var m=parseFloat(this.s);return h?parseFloat(m.toFixed(h)):m},toInt:function(){return/^\s*-?0x/i.test(this.s)?parseInt(this.s,16):parseInt(this.s,10)},trim:function(){var h;return h=void 0===w.trim?this.s.replace(/(^\s*|\s*$)/g,""):this.s.trim(),new this.constructor(h)},trimLeft:function(){var h;return h=w.trimLeft?this.s.trimLeft():this.s.replace(/(^\s*)/g,""),new this.constructor(h)},trimRight:function(){var h;return h=w.trimRight?this.s.trimRight():this.s.replace(/\s+$/,""),new this.constructor(h)},truncate:function(h,m){var y=this.s;if(h=~~h,m=m||"...",y.length<=h)return new this.constructor(y);var v=y.slice(0,h+1).replace(/.(?=\W*\w*$)/g,(function(h){return h.toUpperCase()!==h.toLowerCase()?"A":" "}));return((v=v.slice(v.length-2).match(/\w\w/)?v.replace(/\s*\S+$/,""):new S(v.slice(0,v.length-1)).trimRight().s)+m).length>y.length?new S(y):new S(y.slice(0,v.length)+m)},toCSV:function(){var h=",",m='"',y="\\",v=!0,C=!1,T=[];function hasVal(h){return null!==h&&""!==h}if("object"==typeof arguments[0]?(h=arguments[0].delimiter||h,h=arguments[0].separator||h,m=arguments[0].qualifier||m,v=!!arguments[0].encloseNumbers,y=arguments[0].escape||y,C=!!arguments[0].keys):"string"==typeof arguments[0]&&(h=arguments[0]),"string"==typeof arguments[1]&&(m=arguments[1]),null===arguments[1]&&(m=null),this.orig instanceof Array)T=this.orig;else for(var w in this.orig)this.orig.hasOwnProperty(w)&&(C?T.push(w):T.push(this.orig[w]));for(var A=y+m,P=[],k=0;k<T.length;++k){var R=hasVal(m);if("number"==typeof T[k]&&(R&=v),R&&P.push(m),null!==T[k]&&void 0!==T[k]){var M=new S(T[k]).replaceAll(m,A).s;P.push(M)}else P.push("");R&&P.push(m),h&&P.push(h)}return P.length=P.length-1,new this.constructor(P.join(""))},toString:function(){return this.s},underscore:function(){var h=this.trim().s.replace(/([a-z\d])([A-Z]+)/g,"$1_$2").replace(/([A-Z\d]+)([A-Z][a-z])/g,"$1_$2").replace(/[-\s]+/g,"_").toLowerCase();return new this.constructor(h)},unescapeHTML:function(){return new this.constructor(this.s.replace(/\&([^;]+);/g,(function(h,m){var y;return m in M?M[m]:(y=m.match(/^#x([\da-fA-F]+)$/))?String.fromCharCode(parseInt(y[1],16)):(y=m.match(/^#(\d+)$/))?String.fromCharCode(~~y[1]):h})))},valueOf:function(){return this.s.valueOf()},wrapHTML:function(h,m){var y=this.s,v=null==h?"span":h,C="";if("object"==typeof m)for(var T in m)C+=" "+T+'="'+new this.constructor(m[T]).escapeHTML()+'"';return y="".concat("<",v,C,">",this,"</",v,">"),new this.constructor(y)}},P=[];var k=function getNativeStringProperties(){for(var h=function getNativeStringPropertyNames(){var h=[];if(Object.getOwnPropertyNames)return(h=Object.getOwnPropertyNames(w)).splice(h.indexOf("valueOf"),1),h.splice(h.indexOf("toString"),1),h;var m={};for(var y in String.prototype)m[y]=y;for(var y in Object.prototype)delete m[y];for(var y in m)h.push(y);return h}(),m={},y=0;y<h.length;++y){var v=h[y];if("to"!==v&&"toEnd"!==v){var C=w[v];try{var T=typeof C.apply("teststring");m[v]=T}catch(h){}}}return m}();for(var R in k)!function(h){var m=w[h];"function"==typeof m&&(A[h]||("string"===k[h]?A[h]=function(){return new this.constructor(m.apply(this,arguments))}:A[h]=m))}(R);function Export(h){return new S(h)}function multiArgs(h,m){var y,v=[];for(y=0;y<h.length;y++)v.push(h[y]),m&&m.call(h,h[y],y);return v}A.repeat=A.times,A.include=A.contains,A.toInteger=A.toInt,A.toBool=A.toBoolean,A.decodeHTMLEntities=A.decodeHtmlEntities,A.constructor=S,Export.extendPrototype=function extendPrototype(){for(var h in A)!function(h){var m=A[h];w.hasOwnProperty(h)||(P.push(h),w[h]=function(){return String.prototype.s=this,m.apply(this,arguments)})}(h)},Export.restorePrototype=function restorePrototype(){for(var h=0;h<P.length;++h)delete String.prototype[P[h]];P.length=0},Export.VERSION="3.3.1",Export.TMPL_OPEN="{{",Export.TMPL_CLOSE="}}",Export.ENTITIES=C,void 0!==h.exports?h.exports=Export:void 0===(v=function(){return Export}.apply(m,[]))||(h.exports=v);var M={lt:"<",gt:">",quot:'"',apos:"'",amp:"&"};function escapeRegExp(h){var m,y,v=[],C=/^[A-Za-z0-9]+$/;for(h=ensureString(h),y=0;y<h.length;++y)m=h.charAt(y),C.test(m)?v.push(m):"\\000"===m?v.push("\\000"):v.push("\\"+m);return v.join("")}function ensureString(h){return null==h?"":""+h}var N={};for(var D in M)N[M[D]]=D;C={amp:"&",gt:">",lt:"<",quot:'"',apos:"'",AElig:198,Aacute:193,Acirc:194,Agrave:192,Aring:197,Atilde:195,Auml:196,Ccedil:199,ETH:208,Eacute:201,Ecirc:202,Egrave:200,Euml:203,Iacute:205,Icirc:206,Igrave:204,Iuml:207,Ntilde:209,Oacute:211,Ocirc:212,Ograve:210,Oslash:216,Otilde:213,Ouml:214,THORN:222,Uacute:218,Ucirc:219,Ugrave:217,Uuml:220,Yacute:221,aacute:225,acirc:226,aelig:230,agrave:224,aring:229,atilde:227,auml:228,ccedil:231,eacute:233,ecirc:234,egrave:232,eth:240,euml:235,iacute:237,icirc:238,igrave:236,iuml:239,ntilde:241,oacute:243,ocirc:244,ograve:242,oslash:248,otilde:245,ouml:246,szlig:223,thorn:254,uacute:250,ucirc:251,ugrave:249,uuml:252,yacute:253,yuml:255,copy:169,reg:174,nbsp:160,iexcl:161,cent:162,pound:163,curren:164,yen:165,brvbar:166,sect:167,uml:168,ordf:170,laquo:171,not:172,shy:173,macr:175,deg:176,plusmn:177,sup1:185,sup2:178,sup3:179,acute:180,micro:181,para:182,middot:183,cedil:184,ordm:186,raquo:187,frac14:188,frac12:189,frac34:190,iquest:191,times:215,divide:247,"OElig;":338,"oelig;":339,"Scaron;":352,"scaron;":353,"Yuml;":376,"fnof;":402,"circ;":710,"tilde;":732,"Alpha;":913,"Beta;":914,"Gamma;":915,"Delta;":916,"Epsilon;":917,"Zeta;":918,"Eta;":919,"Theta;":920,"Iota;":921,"Kappa;":922,"Lambda;":923,"Mu;":924,"Nu;":925,"Xi;":926,"Omicron;":927,"Pi;":928,"Rho;":929,"Sigma;":931,"Tau;":932,"Upsilon;":933,"Phi;":934,"Chi;":935,"Psi;":936,"Omega;":937,"alpha;":945,"beta;":946,"gamma;":947,"delta;":948,"epsilon;":949,"zeta;":950,"eta;":951,"theta;":952,"iota;":953,"kappa;":954,"lambda;":955,"mu;":956,"nu;":957,"xi;":958,"omicron;":959,"pi;":960,"rho;":961,"sigmaf;":962,"sigma;":963,"tau;":964,"upsilon;":965,"phi;":966,"chi;":967,"psi;":968,"omega;":969,"thetasym;":977,"upsih;":978,"piv;":982,"ensp;":8194,"emsp;":8195,"thinsp;":8201,"zwnj;":8204,"zwj;":8205,"lrm;":8206,"rlm;":8207,"ndash;":8211,"mdash;":8212,"lsquo;":8216,"rsquo;":8217,"sbquo;":8218,"ldquo;":8220,"rdquo;":8221,"bdquo;":8222,"dagger;":8224,"Dagger;":8225,"bull;":8226,"hellip;":8230,"permil;":8240,"prime;":8242,"Prime;":8243,"lsaquo;":8249,"rsaquo;":8250,"oline;":8254,"frasl;":8260,"euro;":8364,"image;":8465,"weierp;":8472,"real;":8476,"trade;":8482,"alefsym;":8501,"larr;":8592,"uarr;":8593,"rarr;":8594,"darr;":8595,"harr;":8596,"crarr;":8629,"lArr;":8656,"uArr;":8657,"rArr;":8658,"dArr;":8659,"hArr;":8660,"forall;":8704,"part;":8706,"exist;":8707,"empty;":8709,"nabla;":8711,"isin;":8712,"notin;":8713,"ni;":8715,"prod;":8719,"sum;":8721,"minus;":8722,"lowast;":8727,"radic;":8730,"prop;":8733,"infin;":8734,"ang;":8736,"and;":8743,"or;":8744,"cap;":8745,"cup;":8746,"int;":8747,"there4;":8756,"sim;":8764,"cong;":8773,"asymp;":8776,"ne;":8800,"equiv;":8801,"le;":8804,"ge;":8805,"sub;":8834,"sup;":8835,"nsub;":8836,"sube;":8838,"supe;":8839,"oplus;":8853,"otimes;":8855,"perp;":8869,"sdot;":8901,"lceil;":8968,"rceil;":8969,"lfloor;":8970,"rfloor;":8971,"lang;":9001,"rang;":9002,"loz;":9674,"spades;":9824,"clubs;":9827,"hearts;":9829,"diams;":9830}}).call(this)},function(h,m){h.exports=function count(h,m){for(var y=0,v=h.indexOf(m);v>=0;)y+=1,v=h.indexOf(m,v+1);return y}},function(h,m){h.exports=function splitLeft(h,m,y,v){if(void 0===y)y=-1;var C=h.split(m),T=C.slice(0,y),w=C.slice(y);return C=0===w.length?T:T.concat(w.join(m)),void 0===v?C:v<0?C.slice(v):C.slice(0,v)}},function(h,m){h.exports=function splitRight(h,m,y,v){if(void 0===y)y=-1;if(void 0===v)v=0;for(var C=[h],T=h.length-1;T>=0;T--)0===C[0].slice(T).indexOf(m)&&(C.length<=y||-1===y)&&(C.splice(1,0,C[0].slice(T+m.length)),C[0]=C[0].slice(0,T));return v>=0?C.slice(-v):C.slice(0,-v)}},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0});const v=y(46);!function(h){h[h.OK=200]="OK",h[h.NotModified=304]="NotModified",h[h.NotFound=404]="NotFound"}(m.StatusCode||(m.StatusCode={}));class Response{constructor(h,m,y){this._statusCode=h,this._headers=m,this._buffer=y}getStatusCode(){return this._statusCode}getHeaders(){return this._headers}getBuffer(){return this._buffer}}m.Response=Response,m.request=function request(h,m){const y={hostname:h.hostname,path:h.path};return h.port&&(y.port=parseInt(h.port,10)),m&&(y.headers={"If-None-Match":m}),new Promise((h,m)=>v.get(y,h).on("error",m)).then(h=>{const m=[];return h.on("data",h=>m.push(h)),new Promise((m,y)=>h.on("end",m).on("error",y)).then(y=>new Response(h.statusCode,h.headers,Buffer.concat(m)))})}},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0});const v=y(960);m.interval=function interval(h,m){return v.deferredDisposable(()=>{const y={promise:Promise.resolve(),timer:null};return y.timer=setInterval(()=>y.promise=y.promise.then(h),m),y},h=>(clearInterval(h.timer),h.promise)).map(h=>null)},m.immediate=function immediate(h){return new Promise(m=>setImmediate(()=>m(h)))},m.sleep=function sleep(h){return new Promise(m=>setTimeout(m,h))},m.timeout=function timeout(h,m,y){return v.deferredDisposable(()=>{const v={ms:y?0:m,disposed:!1,promise:Promise.resolve(),timer:null},setNewTimeout=()=>{v.disposed||(v.timer=setTimeout(()=>v.promise=Promise.resolve().then(h).then(setNewTimeout),v.ms),v.ms=m)};return setNewTimeout(),v},h=>(h.disposed=!0,clearTimeout(h.timer),h.promise)).map(h=>null)}},function(h,m,y){"use strict";function lazy(h){var m=void 0;return function(){return void 0===m&&(m=h()),m}}function promiseFinally(h,m){var finalizeAndContinue=function(h){return Promise.resolve(m()).then((function(){return h}))};return h.then(finalizeAndContinue,(function(h){return finalizeAndContinue(Promise.reject(h))}))}function _call(h){return Promise.resolve().then(h)}Object.defineProperty(m,"__esModule",{value:!0}),m.lazy=lazy,m.promiseFinally=promiseFinally,m.deferredDisposable=function deferredDisposable(h,m){return function _deferredDisposable(h){return{using:function(m){return h().then((function(h){return promiseFinally(_call((function(){return m(h.value)})),h.dispose)}))},init:h,map:function(m){return _deferredDisposable((function(){return h().then((function(h){return{value:m(h.value),dispose:h.dispose}}))}))},and:function(m){return _deferredDisposable((function(){return h().then((function(h){return _call((function(){return m(h.value).init()})).then((function(m){return{value:m.value,dispose:function(){return promiseFinally(m.dispose(),h.dispose)}}}),(function(m){return h.dispose(),Promise.reject(m)}))}))}))}}}((function(){return _call(h).then((function(h){return{value:h,dispose:lazy((function(){return _call((function(){return m(h)}))}))}}))}))}},function(h,m,y){const v=y(962),{CommentArray:C}=y(402),{PREFIX_BEFORE:T,PREFIX_AFTER_PROP:w,PREFIX_AFTER_COLON:A,PREFIX_AFTER_VALUE:P,PREFIX_AFTER:k,PREFIX_BEFORE_ALL:R,PREFIX_AFTER_ALL:M,BRACKET_OPEN:N,BRACKET_CLOSE:D,CURLY_BRACKET_OPEN:I,CURLY_BRACKET_CLOSE:x,COLON:O,COMMA:L,MINUS:U,EMPTY:B,UNDEFINED:W,define:q,assign_non_prop_comments:Y}=y(165),tokenize=h=>v.tokenize(h,{comment:!0,loc:!0}),V=[];let $=null,z=null;const G=[];let J,X,Z=!1,ee=!1,te=null,re=null,ie=null,se=null;const clean=()=>{G.length=V.length=0,re=null,J=W},symbolFor=h=>Symbol.for(J!==W?h+O+J:h),transform=(h,m)=>se?se(h,m):m,unexpected=()=>{const h=new SyntaxError(`Unexpected token ${ie.value.slice(0,1)}`);throw Object.assign(h,ie.loc.start),h},unexpected_end=()=>{const h=new SyntaxError("Unexpected end of JSON input");throw Object.assign(h,re?re.loc.end:{line:1,column:0}),h},next=()=>{const h=te[++X];ee=ie&&h&&ie.loc.end.line===h.loc.start.line||!1,re=ie,ie=h},type=()=>(ie||unexpected_end(),"Punctuator"===ie.type?ie.value:ie.type),is=h=>type()===h,expect=h=>{is(h)||unexpected()},set_comments_host=h=>{V.push($),$=h},restore_comments_host=()=>{$=V.pop()},assign_after_comments=()=>{if(!z)return;const h=[];for(const m of z){if(!m.inline)break;h.push(m)}const{length:m}=h;m&&(m===z.length?z=null:z.splice(0,m),q($,symbolFor(k),h))},assign_comments=h=>{z&&(q($,symbolFor(h),z),z=null)},parse_comments=h=>{const m=[];for(;ie&&(is("LineComment")||is("BlockComment"));){const h={...ie,inline:ee};m.push(h),next()}Z||m.length&&(h?q($,symbolFor(h),m):z=m)},set_prop=(h,m)=>{m&&G.push(J),J=h},restore_prop=()=>{J=G.pop()};function walk(){let h=type();if(h===I)return next(),(()=>{const h={};set_comments_host(h),set_prop(W,!0);let m,y=!1;for(parse_comments();!(is(x)||y&&(assign_comments(P),expect(L),next(),parse_comments(),assign_after_comments(),is(x)));)y=!0,expect("String"),m=JSON.parse(ie.value),set_prop(m),assign_comments(T),next(),parse_comments(w),expect(O),next(),parse_comments(A),h[m]=transform(m,walk()),parse_comments();return y&&assign_comments(k),next(),J=void 0,y||assign_comments(T),restore_comments_host(),restore_prop(),h})();if(h===N)return next(),(()=>{const h=new C;set_comments_host(h),set_prop(W,!0);let m=!1,y=0;for(parse_comments();!(is(D)||m&&(assign_comments(P),expect(L),next(),parse_comments(),assign_after_comments(),is(D)));)m=!0,set_prop(y),assign_comments(T),h[y]=transform(y,walk()),y++,parse_comments();return m&&assign_comments(k),next(),J=void 0,m||assign_comments(T),restore_comments_host(),restore_prop(),h})();let m,y=B;switch(h===U&&(next(),h=type(),y=U),h){case"String":case"Boolean":case"Null":case"Numeric":return m=ie.value,next(),JSON.parse(y+m)}}h.exports={parse:(h,m,y)=>{clean(),te=tokenize(h),se=m,Z=y,te.length||unexpected_end(),X=-1,next(),set_comments_host({}),parse_comments(R);let v=walk();var C;return parse_comments(M),ie&&unexpected(),y||null===v||(C=v,Object(C)!==C&&(v=new Object(v)),Y(v,$)),restore_comments_host(),v=transform("",v),clean(),te.length=0,z=$=te=re=ie=se=null,v},tokenize:tokenize}},function(h,m,y){!function webpackUniversalModuleDefinition(m,y){h.exports=y()}(0,(function(){return function(h){var m={};function __webpack_require__(y){if(m[y])return m[y].exports;var v=m[y]={exports:{},id:y,loaded:!1};return h[y].call(v.exports,v,v.exports,__webpack_require__),v.loaded=!0,v.exports}return __webpack_require__.m=h,__webpack_require__.c=m,__webpack_require__.p="",__webpack_require__(0)}([function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0});var v=y(1),C=y(3),T=y(8),w=y(15);function parse(h,m,y){var w=null,proxyDelegate=function(h,m){y&&y(h,m),w&&w.visit(h,m)},A="function"==typeof y?proxyDelegate:null,P=!1;if(m){P="boolean"==typeof m.comment&&m.comment;var k="boolean"==typeof m.attachComment&&m.attachComment;(P||k)&&((w=new v.CommentHandler).attach=k,m.comment=!0,A=proxyDelegate)}var R,M=!1;m&&"string"==typeof m.sourceType&&(M="module"===m.sourceType),R=m&&"boolean"==typeof m.jsx&&m.jsx?new C.JSXParser(h,m,A):new T.Parser(h,m,A);var N=M?R.parseModule():R.parseScript();return P&&w&&(N.comments=w.comments),R.config.tokens&&(N.tokens=R.tokens),R.config.tolerant&&(N.errors=R.errorHandler.errors),N}m.parse=parse,m.parseModule=function parseModule(h,m,y){var v=m||{};return v.sourceType="module",parse(h,v,y)},m.parseScript=function parseScript(h,m,y){var v=m||{};return v.sourceType="script",parse(h,v,y)},m.tokenize=function tokenize(h,m,y){var v,C=new w.Tokenizer(h,m);v=[];try{for(;;){var T=C.getNextToken();if(!T)break;y&&(T=y(T)),v.push(T)}}catch(h){C.errorHandler.tolerate(h)}return C.errorHandler.tolerant&&(v.errors=C.errors()),v};var A=y(2);m.Syntax=A.Syntax,m.version="4.0.1"},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0});var v=y(2),C=function(){function CommentHandler(){this.attach=!1,this.comments=[],this.stack=[],this.leading=[],this.trailing=[]}return CommentHandler.prototype.insertInnerComments=function(h,m){if(h.type===v.Syntax.BlockStatement&&0===h.body.length){for(var y=[],C=this.leading.length-1;C>=0;--C){var T=this.leading[C];m.end.offset>=T.start&&(y.unshift(T.comment),this.leading.splice(C,1),this.trailing.splice(C,1))}y.length&&(h.innerComments=y)}},CommentHandler.prototype.findTrailingComments=function(h){var m=[];if(this.trailing.length>0){for(var y=this.trailing.length-1;y>=0;--y){var v=this.trailing[y];v.start>=h.end.offset&&m.unshift(v.comment)}return this.trailing.length=0,m}var C=this.stack[this.stack.length-1];if(C&&C.node.trailingComments){var T=C.node.trailingComments[0];T&&T.range[0]>=h.end.offset&&(m=C.node.trailingComments,delete C.node.trailingComments)}return m},CommentHandler.prototype.findLeadingComments=function(h){for(var m,y=[];this.stack.length>0;){if(!((T=this.stack[this.stack.length-1])&&T.start>=h.start.offset))break;m=T.node,this.stack.pop()}if(m){for(var v=(m.leadingComments?m.leadingComments.length:0)-1;v>=0;--v){var C=m.leadingComments[v];C.range[1]<=h.start.offset&&(y.unshift(C),m.leadingComments.splice(v,1))}return m.leadingComments&&0===m.leadingComments.length&&delete m.leadingComments,y}for(v=this.leading.length-1;v>=0;--v){var T;(T=this.leading[v]).start<=h.start.offset&&(y.unshift(T.comment),this.leading.splice(v,1))}return y},CommentHandler.prototype.visitNode=function(h,m){if(!(h.type===v.Syntax.Program&&h.body.length>0)){this.insertInnerComments(h,m);var y=this.findTrailingComments(m),C=this.findLeadingComments(m);C.length>0&&(h.leadingComments=C),y.length>0&&(h.trailingComments=y),this.stack.push({node:h,start:m.start.offset})}},CommentHandler.prototype.visitComment=function(h,m){var y="L"===h.type[0]?"Line":"Block",v={type:y,value:h.value};if(h.range&&(v.range=h.range),h.loc&&(v.loc=h.loc),this.comments.push(v),this.attach){var C={comment:{type:y,value:h.value,range:[m.start.offset,m.end.offset]},start:m.start.offset};h.loc&&(C.comment.loc=h.loc),h.type=y,this.leading.push(C),this.trailing.push(C)}},CommentHandler.prototype.visit=function(h,m){"LineComment"===h.type||"BlockComment"===h.type?this.visitComment(h,m):this.attach&&this.visitNode(h,m)},CommentHandler}();m.CommentHandler=C},function(h,m){"use strict";Object.defineProperty(m,"__esModule",{value:!0}),m.Syntax={AssignmentExpression:"AssignmentExpression",AssignmentPattern:"AssignmentPattern",ArrayExpression:"ArrayExpression",ArrayPattern:"ArrayPattern",ArrowFunctionExpression:"ArrowFunctionExpression",AwaitExpression:"AwaitExpression",BlockStatement:"BlockStatement",BinaryExpression:"BinaryExpression",BreakStatement:"BreakStatement",CallExpression:"CallExpression",CatchClause:"CatchClause",ClassBody:"ClassBody",ClassDeclaration:"ClassDeclaration",ClassExpression:"ClassExpression",ConditionalExpression:"ConditionalExpression",ContinueStatement:"ContinueStatement",DoWhileStatement:"DoWhileStatement",DebuggerStatement:"DebuggerStatement",EmptyStatement:"EmptyStatement",ExportAllDeclaration:"ExportAllDeclaration",ExportDefaultDeclaration:"ExportDefaultDeclaration",ExportNamedDeclaration:"ExportNamedDeclaration",ExportSpecifier:"ExportSpecifier",ExpressionStatement:"ExpressionStatement",ForStatement:"ForStatement",ForOfStatement:"ForOfStatement",ForInStatement:"ForInStatement",FunctionDeclaration:"FunctionDeclaration",FunctionExpression:"FunctionExpression",Identifier:"Identifier",IfStatement:"IfStatement",ImportDeclaration:"ImportDeclaration",ImportDefaultSpecifier:"ImportDefaultSpecifier",ImportNamespaceSpecifier:"ImportNamespaceSpecifier",ImportSpecifier:"ImportSpecifier",Literal:"Literal",LabeledStatement:"LabeledStatement",LogicalExpression:"LogicalExpression",MemberExpression:"MemberExpression",MetaProperty:"MetaProperty",MethodDefinition:"MethodDefinition",NewExpression:"NewExpression",ObjectExpression:"ObjectExpression",ObjectPattern:"ObjectPattern",Program:"Program",Property:"Property",RestElement:"RestElement",ReturnStatement:"ReturnStatement",SequenceExpression:"SequenceExpression",SpreadElement:"SpreadElement",Super:"Super",SwitchCase:"SwitchCase",SwitchStatement:"SwitchStatement",TaggedTemplateExpression:"TaggedTemplateExpression",TemplateElement:"TemplateElement",TemplateLiteral:"TemplateLiteral",ThisExpression:"ThisExpression",ThrowStatement:"ThrowStatement",TryStatement:"TryStatement",UnaryExpression:"UnaryExpression",UpdateExpression:"UpdateExpression",VariableDeclaration:"VariableDeclaration",VariableDeclarator:"VariableDeclarator",WhileStatement:"WhileStatement",WithStatement:"WithStatement",YieldExpression:"YieldExpression"}},function(h,m,y){"use strict";var v,C=this&&this.__extends||(v=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(h,m){h.__proto__=m}||function(h,m){for(var y in m)m.hasOwnProperty(y)&&(h[y]=m[y])},function(h,m){function __(){this.constructor=h}v(h,m),h.prototype=null===m?Object.create(m):(__.prototype=m.prototype,new __)});Object.defineProperty(m,"__esModule",{value:!0});var T=y(4),w=y(5),A=y(6),P=y(7),k=y(8),R=y(13),M=y(14);function getQualifiedElementName(h){var m;switch(h.type){case A.JSXSyntax.JSXIdentifier:m=h.name;break;case A.JSXSyntax.JSXNamespacedName:var y=h;m=getQualifiedElementName(y.namespace)+":"+getQualifiedElementName(y.name);break;case A.JSXSyntax.JSXMemberExpression:var v=h;m=getQualifiedElementName(v.object)+"."+getQualifiedElementName(v.property)}return m}R.TokenName[100]="JSXIdentifier",R.TokenName[101]="JSXText";var N=function(h){function JSXParser(m,y,v){return h.call(this,m,y,v)||this}return C(JSXParser,h),JSXParser.prototype.parsePrimaryExpression=function(){return this.match("<")?this.parseJSXRoot():h.prototype.parsePrimaryExpression.call(this)},JSXParser.prototype.startJSX=function(){this.scanner.index=this.startMarker.index,this.scanner.lineNumber=this.startMarker.line,this.scanner.lineStart=this.startMarker.index-this.startMarker.column},JSXParser.prototype.finishJSX=function(){this.nextToken()},JSXParser.prototype.reenterJSX=function(){this.startJSX(),this.expectJSX("}"),this.config.tokens&&this.tokens.pop()},JSXParser.prototype.createJSXNode=function(){return this.collectComments(),{index:this.scanner.index,line:this.scanner.lineNumber,column:this.scanner.index-this.scanner.lineStart}},JSXParser.prototype.createJSXChildNode=function(){return{index:this.scanner.index,line:this.scanner.lineNumber,column:this.scanner.index-this.scanner.lineStart}},JSXParser.prototype.scanXHTMLEntity=function(h){for(var m="&",y=!0,v=!1,C=!1,w=!1;!this.scanner.eof()&&y&&!v;){var A=this.scanner.source[this.scanner.index];if(A===h)break;if(v=";"===A,m+=A,++this.scanner.index,!v)switch(m.length){case 2:C="#"===A;break;case 3:C&&(y=(w="x"===A)||T.Character.isDecimalDigit(A.charCodeAt(0)),C=C&&!w);break;default:y=(y=y&&!(C&&!T.Character.isDecimalDigit(A.charCodeAt(0))))&&!(w&&!T.Character.isHexDigit(A.charCodeAt(0)))}}if(y&&v&&m.length>2){var P=m.substr(1,m.length-2);C&&P.length>1?m=String.fromCharCode(parseInt(P.substr(1),10)):w&&P.length>2?m=String.fromCharCode(parseInt("0"+P.substr(1),16)):C||w||!M.XHTMLEntities[P]||(m=M.XHTMLEntities[P])}return m},JSXParser.prototype.lexJSX=function(){var h=this.scanner.source.charCodeAt(this.scanner.index);if(60===h||62===h||47===h||58===h||61===h||123===h||125===h)return{type:7,value:A=this.scanner.source[this.scanner.index++],lineNumber:this.scanner.lineNumber,lineStart:this.scanner.lineStart,start:this.scanner.index-1,end:this.scanner.index};if(34===h||39===h){for(var m=this.scanner.index,y=this.scanner.source[this.scanner.index++],v="";!this.scanner.eof();){if((P=this.scanner.source[this.scanner.index++])===y)break;v+="&"===P?this.scanXHTMLEntity(y):P}return{type:8,value:v,lineNumber:this.scanner.lineNumber,lineStart:this.scanner.lineStart,start:m,end:this.scanner.index}}if(46===h){var C=this.scanner.source.charCodeAt(this.scanner.index+1),w=this.scanner.source.charCodeAt(this.scanner.index+2),A=46===C&&46===w?"...":".";m=this.scanner.index;return this.scanner.index+=A.length,{type:7,value:A,lineNumber:this.scanner.lineNumber,lineStart:this.scanner.lineStart,start:m,end:this.scanner.index}}if(96===h)return{type:10,value:"",lineNumber:this.scanner.lineNumber,lineStart:this.scanner.lineStart,start:this.scanner.index,end:this.scanner.index};if(T.Character.isIdentifierStart(h)&&92!==h){m=this.scanner.index;for(++this.scanner.index;!this.scanner.eof();){var P=this.scanner.source.charCodeAt(this.scanner.index);if(T.Character.isIdentifierPart(P)&&92!==P)++this.scanner.index;else{if(45!==P)break;++this.scanner.index}}return{type:100,value:this.scanner.source.slice(m,this.scanner.index),lineNumber:this.scanner.lineNumber,lineStart:this.scanner.lineStart,start:m,end:this.scanner.index}}return this.scanner.lex()},JSXParser.prototype.nextJSXToken=function(){this.collectComments(),this.startMarker.index=this.scanner.index,this.startMarker.line=this.scanner.lineNumber,this.startMarker.column=this.scanner.index-this.scanner.lineStart;var h=this.lexJSX();return this.lastMarker.index=this.scanner.index,this.lastMarker.line=this.scanner.lineNumber,this.lastMarker.column=this.scanner.index-this.scanner.lineStart,this.config.tokens&&this.tokens.push(this.convertToken(h)),h},JSXParser.prototype.nextJSXText=function(){this.startMarker.index=this.scanner.index,this.startMarker.line=this.scanner.lineNumber,this.startMarker.column=this.scanner.index-this.scanner.lineStart;for(var h=this.scanner.index,m="";!this.scanner.eof();){var y=this.scanner.source[this.scanner.index];if("{"===y||"<"===y)break;++this.scanner.index,m+=y,T.Character.isLineTerminator(y.charCodeAt(0))&&(++this.scanner.lineNumber,"\r"===y&&"\n"===this.scanner.source[this.scanner.index]&&++this.scanner.index,this.scanner.lineStart=this.scanner.index)}this.lastMarker.index=this.scanner.index,this.lastMarker.line=this.scanner.lineNumber,this.lastMarker.column=this.scanner.index-this.scanner.lineStart;var v={type:101,value:m,lineNumber:this.scanner.lineNumber,lineStart:this.scanner.lineStart,start:h,end:this.scanner.index};return m.length>0&&this.config.tokens&&this.tokens.push(this.convertToken(v)),v},JSXParser.prototype.peekJSXToken=function(){var h=this.scanner.saveState();this.scanner.scanComments();var m=this.lexJSX();return this.scanner.restoreState(h),m},JSXParser.prototype.expectJSX=function(h){var m=this.nextJSXToken();7===m.type&&m.value===h||this.throwUnexpectedToken(m)},JSXParser.prototype.matchJSX=function(h){var m=this.peekJSXToken();return 7===m.type&&m.value===h},JSXParser.prototype.parseJSXIdentifier=function(){var h=this.createJSXNode(),m=this.nextJSXToken();return 100!==m.type&&this.throwUnexpectedToken(m),this.finalize(h,new w.JSXIdentifier(m.value))},JSXParser.prototype.parseJSXElementName=function(){var h=this.createJSXNode(),m=this.parseJSXIdentifier();if(this.matchJSX(":")){var y=m;this.expectJSX(":");var v=this.parseJSXIdentifier();m=this.finalize(h,new w.JSXNamespacedName(y,v))}else if(this.matchJSX("."))for(;this.matchJSX(".");){var C=m;this.expectJSX(".");var T=this.parseJSXIdentifier();m=this.finalize(h,new w.JSXMemberExpression(C,T))}return m},JSXParser.prototype.parseJSXAttributeName=function(){var h,m=this.createJSXNode(),y=this.parseJSXIdentifier();if(this.matchJSX(":")){var v=y;this.expectJSX(":");var C=this.parseJSXIdentifier();h=this.finalize(m,new w.JSXNamespacedName(v,C))}else h=y;return h},JSXParser.prototype.parseJSXStringLiteralAttribute=function(){var h=this.createJSXNode(),m=this.nextJSXToken();8!==m.type&&this.throwUnexpectedToken(m);var y=this.getTokenRaw(m);return this.finalize(h,new P.Literal(m.value,y))},JSXParser.prototype.parseJSXExpressionAttribute=function(){var h=this.createJSXNode();this.expectJSX("{"),this.finishJSX(),this.match("}")&&this.tolerateError("JSX attributes must only be assigned a non-empty expression");var m=this.parseAssignmentExpression();return this.reenterJSX(),this.finalize(h,new w.JSXExpressionContainer(m))},JSXParser.prototype.parseJSXAttributeValue=function(){return this.matchJSX("{")?this.parseJSXExpressionAttribute():this.matchJSX("<")?this.parseJSXElement():this.parseJSXStringLiteralAttribute()},JSXParser.prototype.parseJSXNameValueAttribute=function(){var h=this.createJSXNode(),m=this.parseJSXAttributeName(),y=null;return this.matchJSX("=")&&(this.expectJSX("="),y=this.parseJSXAttributeValue()),this.finalize(h,new w.JSXAttribute(m,y))},JSXParser.prototype.parseJSXSpreadAttribute=function(){var h=this.createJSXNode();this.expectJSX("{"),this.expectJSX("..."),this.finishJSX();var m=this.parseAssignmentExpression();return this.reenterJSX(),this.finalize(h,new w.JSXSpreadAttribute(m))},JSXParser.prototype.parseJSXAttributes=function(){for(var h=[];!this.matchJSX("/")&&!this.matchJSX(">");){var m=this.matchJSX("{")?this.parseJSXSpreadAttribute():this.parseJSXNameValueAttribute();h.push(m)}return h},JSXParser.prototype.parseJSXOpeningElement=function(){var h=this.createJSXNode();this.expectJSX("<");var m=this.parseJSXElementName(),y=this.parseJSXAttributes(),v=this.matchJSX("/");return v&&this.expectJSX("/"),this.expectJSX(">"),this.finalize(h,new w.JSXOpeningElement(m,v,y))},JSXParser.prototype.parseJSXBoundaryElement=function(){var h=this.createJSXNode();if(this.expectJSX("<"),this.matchJSX("/")){this.expectJSX("/");var m=this.parseJSXElementName();return this.expectJSX(">"),this.finalize(h,new w.JSXClosingElement(m))}var y=this.parseJSXElementName(),v=this.parseJSXAttributes(),C=this.matchJSX("/");return C&&this.expectJSX("/"),this.expectJSX(">"),this.finalize(h,new w.JSXOpeningElement(y,C,v))},JSXParser.prototype.parseJSXEmptyExpression=function(){var h=this.createJSXChildNode();return this.collectComments(),this.lastMarker.index=this.scanner.index,this.lastMarker.line=this.scanner.lineNumber,this.lastMarker.column=this.scanner.index-this.scanner.lineStart,this.finalize(h,new w.JSXEmptyExpression)},JSXParser.prototype.parseJSXExpressionContainer=function(){var h,m=this.createJSXNode();return this.expectJSX("{"),this.matchJSX("}")?(h=this.parseJSXEmptyExpression(),this.expectJSX("}")):(this.finishJSX(),h=this.parseAssignmentExpression(),this.reenterJSX()),this.finalize(m,new w.JSXExpressionContainer(h))},JSXParser.prototype.parseJSXChildren=function(){for(var h=[];!this.scanner.eof();){var m=this.createJSXChildNode(),y=this.nextJSXText();if(y.start<y.end){var v=this.getTokenRaw(y),C=this.finalize(m,new w.JSXText(y.value,v));h.push(C)}if("{"!==this.scanner.source[this.scanner.index])break;var T=this.parseJSXExpressionContainer();h.push(T)}return h},JSXParser.prototype.parseComplexJSXElement=function(h){for(var m=[];!this.scanner.eof();){h.children=h.children.concat(this.parseJSXChildren());var y=this.createJSXChildNode(),v=this.parseJSXBoundaryElement();if(v.type===A.JSXSyntax.JSXOpeningElement){var C=v;if(C.selfClosing){var T=this.finalize(y,new w.JSXElement(C,[],null));h.children.push(T)}else m.push(h),h={node:y,opening:C,closing:null,children:[]}}if(v.type===A.JSXSyntax.JSXClosingElement){h.closing=v;var P=getQualifiedElementName(h.opening.name);if(P!==getQualifiedElementName(h.closing.name)&&this.tolerateError("Expected corresponding JSX closing tag for %0",P),!(m.length>0))break;T=this.finalize(h.node,new w.JSXElement(h.opening,h.children,h.closing));(h=m[m.length-1]).children.push(T),m.pop()}}return h},JSXParser.prototype.parseJSXElement=function(){var h=this.createJSXNode(),m=this.parseJSXOpeningElement(),y=[],v=null;if(!m.selfClosing){var C=this.parseComplexJSXElement({node:h,opening:m,closing:v,children:y});y=C.children,v=C.closing}return this.finalize(h,new w.JSXElement(m,y,v))},JSXParser.prototype.parseJSXRoot=function(){this.config.tokens&&this.tokens.pop(),this.startJSX();var h=this.parseJSXElement();return this.finishJSX(),h},JSXParser.prototype.isStartOfExpression=function(){return h.prototype.isStartOfExpression.call(this)||this.match("<")},JSXParser}(k.Parser);m.JSXParser=N},function(h,m){"use strict";Object.defineProperty(m,"__esModule",{value:!0});var y={NonAsciiIdentifierStart:/[\xAA\xB5\xBA\xC0-\xD6\xD8-\xF6\xF8-\u02C1\u02C6-\u02D1\u02E0-\u02E4\u02EC\u02EE\u0370-\u0374\u0376\u0377\u037A-\u037D\u037F\u0386\u0388-\u038A\u038C\u038E-\u03A1\u03A3-\u03F5\u03F7-\u0481\u048A-\u052F\u0531-\u0556\u0559\u0561-\u0587\u05D0-\u05EA\u05F0-\u05F2\u0620-\u064A\u066E\u066F\u0671-\u06D3\u06D5\u06E5\u06E6\u06EE\u06EF\u06FA-\u06FC\u06FF\u0710\u0712-\u072F\u074D-\u07A5\u07B1\u07CA-\u07EA\u07F4\u07F5\u07FA\u0800-\u0815\u081A\u0824\u0828\u0840-\u0858\u08A0-\u08B4\u0904-\u0939\u093D\u0950\u0958-\u0961\u0971-\u0980\u0985-\u098C\u098F\u0990\u0993-\u09A8\u09AA-\u09B0\u09B2\u09B6-\u09B9\u09BD\u09CE\u09DC\u09DD\u09DF-\u09E1\u09F0\u09F1\u0A05-\u0A0A\u0A0F\u0A10\u0A13-\u0A28\u0A2A-\u0A30\u0A32\u0A33\u0A35\u0A36\u0A38\u0A39\u0A59-\u0A5C\u0A5E\u0A72-\u0A74\u0A85-\u0A8D\u0A8F-\u0A91\u0A93-\u0AA8\u0AAA-\u0AB0\u0AB2\u0AB3\u0AB5-\u0AB9\u0ABD\u0AD0\u0AE0\u0AE1\u0AF9\u0B05-\u0B0C\u0B0F\u0B10\u0B13-\u0B28\u0B2A-\u0B30\u0B32\u0B33\u0B35-\u0B39\u0B3D\u0B5C\u0B5D\u0B5F-\u0B61\u0B71\u0B83\u0B85-\u0B8A\u0B8E-\u0B90\u0B92-\u0B95\u0B99\u0B9A\u0B9C\u0B9E\u0B9F\u0BA3\u0BA4\u0BA8-\u0BAA\u0BAE-\u0BB9\u0BD0\u0C05-\u0C0C\u0C0E-\u0C10\u0C12-\u0C28\u0C2A-\u0C39\u0C3D\u0C58-\u0C5A\u0C60\u0C61\u0C85-\u0C8C\u0C8E-\u0C90\u0C92-\u0CA8\u0CAA-\u0CB3\u0CB5-\u0CB9\u0CBD\u0CDE\u0CE0\u0CE1\u0CF1\u0CF2\u0D05-\u0D0C\u0D0E-\u0D10\u0D12-\u0D3A\u0D3D\u0D4E\u0D5F-\u0D61\u0D7A-\u0D7F\u0D85-\u0D96\u0D9A-\u0DB1\u0DB3-\u0DBB\u0DBD\u0DC0-\u0DC6\u0E01-\u0E30\u0E32\u0E33\u0E40-\u0E46\u0E81\u0E82\u0E84\u0E87\u0E88\u0E8A\u0E8D\u0E94-\u0E97\u0E99-\u0E9F\u0EA1-\u0EA3\u0EA5\u0EA7\u0EAA\u0EAB\u0EAD-\u0EB0\u0EB2\u0EB3\u0EBD\u0EC0-\u0EC4\u0EC6\u0EDC-\u0EDF\u0F00\u0F40-\u0F47\u0F49-\u0F6C\u0F88-\u0F8C\u1000-\u102A\u103F\u1050-\u1055\u105A-\u105D\u1061\u1065\u1066\u106E-\u1070\u1075-\u1081\u108E\u10A0-\u10C5\u10C7\u10CD\u10D0-\u10FA\u10FC-\u1248\u124A-\u124D\u1250-\u1256\u1258\u125A-\u125D\u1260-\u1288\u128A-\u128D\u1290-\u12B0\u12B2-\u12B5\u12B8-\u12BE\u12C0\u12C2-\u12C5\u12C8-\u12D6\u12D8-\u1310\u1312-\u1315\u1318-\u135A\u1380-\u138F\u13A0-\u13F5\u13F8-\u13FD\u1401-\u166C\u166F-\u167F\u1681-\u169A\u16A0-\u16EA\u16EE-\u16F8\u1700-\u170C\u170E-\u1711\u1720-\u1731\u1740-\u1751\u1760-\u176C\u176E-\u1770\u1780-\u17B3\u17D7\u17DC\u1820-\u1877\u1880-\u18A8\u18AA\u18B0-\u18F5\u1900-\u191E\u1950-\u196D\u1970-\u1974\u1980-\u19AB\u19B0-\u19C9\u1A00-\u1A16\u1A20-\u1A54\u1AA7\u1B05-\u1B33\u1B45-\u1B4B\u1B83-\u1BA0\u1BAE\u1BAF\u1BBA-\u1BE5\u1C00-\u1C23\u1C4D-\u1C4F\u1C5A-\u1C7D\u1CE9-\u1CEC\u1CEE-\u1CF1\u1CF5\u1CF6\u1D00-\u1DBF\u1E00-\u1F15\u1F18-\u1F1D\u1F20-\u1F45\u1F48-\u1F4D\u1F50-\u1F57\u1F59\u1F5B\u1F5D\u1F5F-\u1F7D\u1F80-\u1FB4\u1FB6-\u1FBC\u1FBE\u1FC2-\u1FC4\u1FC6-\u1FCC\u1FD0-\u1FD3\u1FD6-\u1FDB\u1FE0-\u1FEC\u1FF2-\u1FF4\u1FF6-\u1FFC\u2071\u207F\u2090-\u209C\u2102\u2107\u210A-\u2113\u2115\u2118-\u211D\u2124\u2126\u2128\u212A-\u2139\u213C-\u213F\u2145-\u2149\u214E\u2160-\u2188\u2C00-\u2C2E\u2C30-\u2C5E\u2C60-\u2CE4\u2CEB-\u2CEE\u2CF2\u2CF3\u2D00-\u2D25\u2D27\u2D2D\u2D30-\u2D67\u2D6F\u2D80-\u2D96\u2DA0-\u2DA6\u2DA8-\u2DAE\u2DB0-\u2DB6\u2DB8-\u2DBE\u2DC0-\u2DC6\u2DC8-\u2DCE\u2DD0-\u2DD6\u2DD8-\u2DDE\u3005-\u3007\u3021-\u3029\u3031-\u3035\u3038-\u303C\u3041-\u3096\u309B-\u309F\u30A1-\u30FA\u30FC-\u30FF\u3105-\u312D\u3131-\u318E\u31A0-\u31BA\u31F0-\u31FF\u3400-\u4DB5\u4E00-\u9FD5\uA000-\uA48C\uA4D0-\uA4FD\uA500-\uA60C\uA610-\uA61F\uA62A\uA62B\uA640-\uA66E\uA67F-\uA69D\uA6A0-\uA6EF\uA717-\uA71F\uA722-\uA788\uA78B-\uA7AD\uA7B0-\uA7B7\uA7F7-\uA801\uA803-\uA805\uA807-\uA80A\uA80C-\uA822\uA840-\uA873\uA882-\uA8B3\uA8F2-\uA8F7\uA8FB\uA8FD\uA90A-\uA925\uA930-\uA946\uA960-\uA97C\uA984-\uA9B2\uA9CF\uA9E0-\uA9E4\uA9E6-\uA9EF\uA9FA-\uA9FE\uAA00-\uAA28\uAA40-\uAA42\uAA44-\uAA4B\uAA60-\uAA76\uAA7A\uAA7E-\uAAAF\uAAB1\uAAB5\uAAB6\uAAB9-\uAABD\uAAC0\uAAC2\uAADB-\uAADD\uAAE0-\uAAEA\uAAF2-\uAAF4\uAB01-\uAB06\uAB09-\uAB0E\uAB11-\uAB16\uAB20-\uAB26\uAB28-\uAB2E\uAB30-\uAB5A\uAB5C-\uAB65\uAB70-\uABE2\uAC00-\uD7A3\uD7B0-\uD7C6\uD7CB-\uD7FB\uF900-\uFA6D\uFA70-\uFAD9\uFB00-\uFB06\uFB13-\uFB17\uFB1D\uFB1F-\uFB28\uFB2A-\uFB36\uFB38-\uFB3C\uFB3E\uFB40\uFB41\uFB43\uFB44\uFB46-\uFBB1\uFBD3-\uFD3D\uFD50-\uFD8F\uFD92-\uFDC7\uFDF0-\uFDFB\uFE70-\uFE74\uFE76-\uFEFC\uFF21-\uFF3A\uFF41-\uFF5A\uFF66-\uFFBE\uFFC2-\uFFC7\uFFCA-\uFFCF\uFFD2-\uFFD7\uFFDA-\uFFDC]|\uD800[\uDC00-\uDC0B\uDC0D-\uDC26\uDC28-\uDC3A\uDC3C\uDC3D\uDC3F-\uDC4D\uDC50-\uDC5D\uDC80-\uDCFA\uDD40-\uDD74\uDE80-\uDE9C\uDEA0-\uDED0\uDF00-\uDF1F\uDF30-\uDF4A\uDF50-\uDF75\uDF80-\uDF9D\uDFA0-\uDFC3\uDFC8-\uDFCF\uDFD1-\uDFD5]|\uD801[\uDC00-\uDC9D\uDD00-\uDD27\uDD30-\uDD63\uDE00-\uDF36\uDF40-\uDF55\uDF60-\uDF67]|\uD802[\uDC00-\uDC05\uDC08\uDC0A-\uDC35\uDC37\uDC38\uDC3C\uDC3F-\uDC55\uDC60-\uDC76\uDC80-\uDC9E\uDCE0-\uDCF2\uDCF4\uDCF5\uDD00-\uDD15\uDD20-\uDD39\uDD80-\uDDB7\uDDBE\uDDBF\uDE00\uDE10-\uDE13\uDE15-\uDE17\uDE19-\uDE33\uDE60-\uDE7C\uDE80-\uDE9C\uDEC0-\uDEC7\uDEC9-\uDEE4\uDF00-\uDF35\uDF40-\uDF55\uDF60-\uDF72\uDF80-\uDF91]|\uD803[\uDC00-\uDC48\uDC80-\uDCB2\uDCC0-\uDCF2]|\uD804[\uDC03-\uDC37\uDC83-\uDCAF\uDCD0-\uDCE8\uDD03-\uDD26\uDD50-\uDD72\uDD76\uDD83-\uDDB2\uDDC1-\uDDC4\uDDDA\uDDDC\uDE00-\uDE11\uDE13-\uDE2B\uDE80-\uDE86\uDE88\uDE8A-\uDE8D\uDE8F-\uDE9D\uDE9F-\uDEA8\uDEB0-\uDEDE\uDF05-\uDF0C\uDF0F\uDF10\uDF13-\uDF28\uDF2A-\uDF30\uDF32\uDF33\uDF35-\uDF39\uDF3D\uDF50\uDF5D-\uDF61]|\uD805[\uDC80-\uDCAF\uDCC4\uDCC5\uDCC7\uDD80-\uDDAE\uDDD8-\uDDDB\uDE00-\uDE2F\uDE44\uDE80-\uDEAA\uDF00-\uDF19]|\uD806[\uDCA0-\uDCDF\uDCFF\uDEC0-\uDEF8]|\uD808[\uDC00-\uDF99]|\uD809[\uDC00-\uDC6E\uDC80-\uDD43]|[\uD80C\uD840-\uD868\uD86A-\uD86C\uD86F-\uD872][\uDC00-\uDFFF]|\uD80D[\uDC00-\uDC2E]|\uD811[\uDC00-\uDE46]|\uD81A[\uDC00-\uDE38\uDE40-\uDE5E\uDED0-\uDEED\uDF00-\uDF2F\uDF40-\uDF43\uDF63-\uDF77\uDF7D-\uDF8F]|\uD81B[\uDF00-\uDF44\uDF50\uDF93-\uDF9F]|\uD82C[\uDC00\uDC01]|\uD82F[\uDC00-\uDC6A\uDC70-\uDC7C\uDC80-\uDC88\uDC90-\uDC99]|\uD835[\uDC00-\uDC54\uDC56-\uDC9C\uDC9E\uDC9F\uDCA2\uDCA5\uDCA6\uDCA9-\uDCAC\uDCAE-\uDCB9\uDCBB\uDCBD-\uDCC3\uDCC5-\uDD05\uDD07-\uDD0A\uDD0D-\uDD14\uDD16-\uDD1C\uDD1E-\uDD39\uDD3B-\uDD3E\uDD40-\uDD44\uDD46\uDD4A-\uDD50\uDD52-\uDEA5\uDEA8-\uDEC0\uDEC2-\uDEDA\uDEDC-\uDEFA\uDEFC-\uDF14\uDF16-\uDF34\uDF36-\uDF4E\uDF50-\uDF6E\uDF70-\uDF88\uDF8A-\uDFA8\uDFAA-\uDFC2\uDFC4-\uDFCB]|\uD83A[\uDC00-\uDCC4]|\uD83B[\uDE00-\uDE03\uDE05-\uDE1F\uDE21\uDE22\uDE24\uDE27\uDE29-\uDE32\uDE34-\uDE37\uDE39\uDE3B\uDE42\uDE47\uDE49\uDE4B\uDE4D-\uDE4F\uDE51\uDE52\uDE54\uDE57\uDE59\uDE5B\uDE5D\uDE5F\uDE61\uDE62\uDE64\uDE67-\uDE6A\uDE6C-\uDE72\uDE74-\uDE77\uDE79-\uDE7C\uDE7E\uDE80-\uDE89\uDE8B-\uDE9B\uDEA1-\uDEA3\uDEA5-\uDEA9\uDEAB-\uDEBB]|\uD869[\uDC00-\uDED6\uDF00-\uDFFF]|\uD86D[\uDC00-\uDF34\uDF40-\uDFFF]|\uD86E[\uDC00-\uDC1D\uDC20-\uDFFF]|\uD873[\uDC00-\uDEA1]|\uD87E[\uDC00-\uDE1D]/,NonAsciiIdentifierPart:/[\xAA\xB5\xB7\xBA\xC0-\xD6\xD8-\xF6\xF8-\u02C1\u02C6-\u02D1\u02E0-\u02E4\u02EC\u02EE\u0300-\u0374\u0376\u0377\u037A-\u037D\u037F\u0386-\u038A\u038C\u038E-\u03A1\u03A3-\u03F5\u03F7-\u0481\u0483-\u0487\u048A-\u052F\u0531-\u0556\u0559\u0561-\u0587\u0591-\u05BD\u05BF\u05C1\u05C2\u05C4\u05C5\u05C7\u05D0-\u05EA\u05F0-\u05F2\u0610-\u061A\u0620-\u0669\u066E-\u06D3\u06D5-\u06DC\u06DF-\u06E8\u06EA-\u06FC\u06FF\u0710-\u074A\u074D-\u07B1\u07C0-\u07F5\u07FA\u0800-\u082D\u0840-\u085B\u08A0-\u08B4\u08E3-\u0963\u0966-\u096F\u0971-\u0983\u0985-\u098C\u098F\u0990\u0993-\u09A8\u09AA-\u09B0\u09B2\u09B6-\u09B9\u09BC-\u09C4\u09C7\u09C8\u09CB-\u09CE\u09D7\u09DC\u09DD\u09DF-\u09E3\u09E6-\u09F1\u0A01-\u0A03\u0A05-\u0A0A\u0A0F\u0A10\u0A13-\u0A28\u0A2A-\u0A30\u0A32\u0A33\u0A35\u0A36\u0A38\u0A39\u0A3C\u0A3E-\u0A42\u0A47\u0A48\u0A4B-\u0A4D\u0A51\u0A59-\u0A5C\u0A5E\u0A66-\u0A75\u0A81-\u0A83\u0A85-\u0A8D\u0A8F-\u0A91\u0A93-\u0AA8\u0AAA-\u0AB0\u0AB2\u0AB3\u0AB5-\u0AB9\u0ABC-\u0AC5\u0AC7-\u0AC9\u0ACB-\u0ACD\u0AD0\u0AE0-\u0AE3\u0AE6-\u0AEF\u0AF9\u0B01-\u0B03\u0B05-\u0B0C\u0B0F\u0B10\u0B13-\u0B28\u0B2A-\u0B30\u0B32\u0B33\u0B35-\u0B39\u0B3C-\u0B44\u0B47\u0B48\u0B4B-\u0B4D\u0B56\u0B57\u0B5C\u0B5D\u0B5F-\u0B63\u0B66-\u0B6F\u0B71\u0B82\u0B83\u0B85-\u0B8A\u0B8E-\u0B90\u0B92-\u0B95\u0B99\u0B9A\u0B9C\u0B9E\u0B9F\u0BA3\u0BA4\u0BA8-\u0BAA\u0BAE-\u0BB9\u0BBE-\u0BC2\u0BC6-\u0BC8\u0BCA-\u0BCD\u0BD0\u0BD7\u0BE6-\u0BEF\u0C00-\u0C03\u0C05-\u0C0C\u0C0E-\u0C10\u0C12-\u0C28\u0C2A-\u0C39\u0C3D-\u0C44\u0C46-\u0C48\u0C4A-\u0C4D\u0C55\u0C56\u0C58-\u0C5A\u0C60-\u0C63\u0C66-\u0C6F\u0C81-\u0C83\u0C85-\u0C8C\u0C8E-\u0C90\u0C92-\u0CA8\u0CAA-\u0CB3\u0CB5-\u0CB9\u0CBC-\u0CC4\u0CC6-\u0CC8\u0CCA-\u0CCD\u0CD5\u0CD6\u0CDE\u0CE0-\u0CE3\u0CE6-\u0CEF\u0CF1\u0CF2\u0D01-\u0D03\u0D05-\u0D0C\u0D0E-\u0D10\u0D12-\u0D3A\u0D3D-\u0D44\u0D46-\u0D48\u0D4A-\u0D4E\u0D57\u0D5F-\u0D63\u0D66-\u0D6F\u0D7A-\u0D7F\u0D82\u0D83\u0D85-\u0D96\u0D9A-\u0DB1\u0DB3-\u0DBB\u0DBD\u0DC0-\u0DC6\u0DCA\u0DCF-\u0DD4\u0DD6\u0DD8-\u0DDF\u0DE6-\u0DEF\u0DF2\u0DF3\u0E01-\u0E3A\u0E40-\u0E4E\u0E50-\u0E59\u0E81\u0E82\u0E84\u0E87\u0E88\u0E8A\u0E8D\u0E94-\u0E97\u0E99-\u0E9F\u0EA1-\u0EA3\u0EA5\u0EA7\u0EAA\u0EAB\u0EAD-\u0EB9\u0EBB-\u0EBD\u0EC0-\u0EC4\u0EC6\u0EC8-\u0ECD\u0ED0-\u0ED9\u0EDC-\u0EDF\u0F00\u0F18\u0F19\u0F20-\u0F29\u0F35\u0F37\u0F39\u0F3E-\u0F47\u0F49-\u0F6C\u0F71-\u0F84\u0F86-\u0F97\u0F99-\u0FBC\u0FC6\u1000-\u1049\u1050-\u109D\u10A0-\u10C5\u10C7\u10CD\u10D0-\u10FA\u10FC-\u1248\u124A-\u124D\u1250-\u1256\u1258\u125A-\u125D\u1260-\u1288\u128A-\u128D\u1290-\u12B0\u12B2-\u12B5\u12B8-\u12BE\u12C0\u12C2-\u12C5\u12C8-\u12D6\u12D8-\u1310\u1312-\u1315\u1318-\u135A\u135D-\u135F\u1369-\u1371\u1380-\u138F\u13A0-\u13F5\u13F8-\u13FD\u1401-\u166C\u166F-\u167F\u1681-\u169A\u16A0-\u16EA\u16EE-\u16F8\u1700-\u170C\u170E-\u1714\u1720-\u1734\u1740-\u1753\u1760-\u176C\u176E-\u1770\u1772\u1773\u1780-\u17D3\u17D7\u17DC\u17DD\u17E0-\u17E9\u180B-\u180D\u1810-\u1819\u1820-\u1877\u1880-\u18AA\u18B0-\u18F5\u1900-\u191E\u1920-\u192B\u1930-\u193B\u1946-\u196D\u1970-\u1974\u1980-\u19AB\u19B0-\u19C9\u19D0-\u19DA\u1A00-\u1A1B\u1A20-\u1A5E\u1A60-\u1A7C\u1A7F-\u1A89\u1A90-\u1A99\u1AA7\u1AB0-\u1ABD\u1B00-\u1B4B\u1B50-\u1B59\u1B6B-\u1B73\u1B80-\u1BF3\u1C00-\u1C37\u1C40-\u1C49\u1C4D-\u1C7D\u1CD0-\u1CD2\u1CD4-\u1CF6\u1CF8\u1CF9\u1D00-\u1DF5\u1DFC-\u1F15\u1F18-\u1F1D\u1F20-\u1F45\u1F48-\u1F4D\u1F50-\u1F57\u1F59\u1F5B\u1F5D\u1F5F-\u1F7D\u1F80-\u1FB4\u1FB6-\u1FBC\u1FBE\u1FC2-\u1FC4\u1FC6-\u1FCC\u1FD0-\u1FD3\u1FD6-\u1FDB\u1FE0-\u1FEC\u1FF2-\u1FF4\u1FF6-\u1FFC\u200C\u200D\u203F\u2040\u2054\u2071\u207F\u2090-\u209C\u20D0-\u20DC\u20E1\u20E5-\u20F0\u2102\u2107\u210A-\u2113\u2115\u2118-\u211D\u2124\u2126\u2128\u212A-\u2139\u213C-\u213F\u2145-\u2149\u214E\u2160-\u2188\u2C00-\u2C2E\u2C30-\u2C5E\u2C60-\u2CE4\u2CEB-\u2CF3\u2D00-\u2D25\u2D27\u2D2D\u2D30-\u2D67\u2D6F\u2D7F-\u2D96\u2DA0-\u2DA6\u2DA8-\u2DAE\u2DB0-\u2DB6\u2DB8-\u2DBE\u2DC0-\u2DC6\u2DC8-\u2DCE\u2DD0-\u2DD6\u2DD8-\u2DDE\u2DE0-\u2DFF\u3005-\u3007\u3021-\u302F\u3031-\u3035\u3038-\u303C\u3041-\u3096\u3099-\u309F\u30A1-\u30FA\u30FC-\u30FF\u3105-\u312D\u3131-\u318E\u31A0-\u31BA\u31F0-\u31FF\u3400-\u4DB5\u4E00-\u9FD5\uA000-\uA48C\uA4D0-\uA4FD\uA500-\uA60C\uA610-\uA62B\uA640-\uA66F\uA674-\uA67D\uA67F-\uA6F1\uA717-\uA71F\uA722-\uA788\uA78B-\uA7AD\uA7B0-\uA7B7\uA7F7-\uA827\uA840-\uA873\uA880-\uA8C4\uA8D0-\uA8D9\uA8E0-\uA8F7\uA8FB\uA8FD\uA900-\uA92D\uA930-\uA953\uA960-\uA97C\uA980-\uA9C0\uA9CF-\uA9D9\uA9E0-\uA9FE\uAA00-\uAA36\uAA40-\uAA4D\uAA50-\uAA59\uAA60-\uAA76\uAA7A-\uAAC2\uAADB-\uAADD\uAAE0-\uAAEF\uAAF2-\uAAF6\uAB01-\uAB06\uAB09-\uAB0E\uAB11-\uAB16\uAB20-\uAB26\uAB28-\uAB2E\uAB30-\uAB5A\uAB5C-\uAB65\uAB70-\uABEA\uABEC\uABED\uABF0-\uABF9\uAC00-\uD7A3\uD7B0-\uD7C6\uD7CB-\uD7FB\uF900-\uFA6D\uFA70-\uFAD9\uFB00-\uFB06\uFB13-\uFB17\uFB1D-\uFB28\uFB2A-\uFB36\uFB38-\uFB3C\uFB3E\uFB40\uFB41\uFB43\uFB44\uFB46-\uFBB1\uFBD3-\uFD3D\uFD50-\uFD8F\uFD92-\uFDC7\uFDF0-\uFDFB\uFE00-\uFE0F\uFE20-\uFE2F\uFE33\uFE34\uFE4D-\uFE4F\uFE70-\uFE74\uFE76-\uFEFC\uFF10-\uFF19\uFF21-\uFF3A\uFF3F\uFF41-\uFF5A\uFF66-\uFFBE\uFFC2-\uFFC7\uFFCA-\uFFCF\uFFD2-\uFFD7\uFFDA-\uFFDC]|\uD800[\uDC00-\uDC0B\uDC0D-\uDC26\uDC28-\uDC3A\uDC3C\uDC3D\uDC3F-\uDC4D\uDC50-\uDC5D\uDC80-\uDCFA\uDD40-\uDD74\uDDFD\uDE80-\uDE9C\uDEA0-\uDED0\uDEE0\uDF00-\uDF1F\uDF30-\uDF4A\uDF50-\uDF7A\uDF80-\uDF9D\uDFA0-\uDFC3\uDFC8-\uDFCF\uDFD1-\uDFD5]|\uD801[\uDC00-\uDC9D\uDCA0-\uDCA9\uDD00-\uDD27\uDD30-\uDD63\uDE00-\uDF36\uDF40-\uDF55\uDF60-\uDF67]|\uD802[\uDC00-\uDC05\uDC08\uDC0A-\uDC35\uDC37\uDC38\uDC3C\uDC3F-\uDC55\uDC60-\uDC76\uDC80-\uDC9E\uDCE0-\uDCF2\uDCF4\uDCF5\uDD00-\uDD15\uDD20-\uDD39\uDD80-\uDDB7\uDDBE\uDDBF\uDE00-\uDE03\uDE05\uDE06\uDE0C-\uDE13\uDE15-\uDE17\uDE19-\uDE33\uDE38-\uDE3A\uDE3F\uDE60-\uDE7C\uDE80-\uDE9C\uDEC0-\uDEC7\uDEC9-\uDEE6\uDF00-\uDF35\uDF40-\uDF55\uDF60-\uDF72\uDF80-\uDF91]|\uD803[\uDC00-\uDC48\uDC80-\uDCB2\uDCC0-\uDCF2]|\uD804[\uDC00-\uDC46\uDC66-\uDC6F\uDC7F-\uDCBA\uDCD0-\uDCE8\uDCF0-\uDCF9\uDD00-\uDD34\uDD36-\uDD3F\uDD50-\uDD73\uDD76\uDD80-\uDDC4\uDDCA-\uDDCC\uDDD0-\uDDDA\uDDDC\uDE00-\uDE11\uDE13-\uDE37\uDE80-\uDE86\uDE88\uDE8A-\uDE8D\uDE8F-\uDE9D\uDE9F-\uDEA8\uDEB0-\uDEEA\uDEF0-\uDEF9\uDF00-\uDF03\uDF05-\uDF0C\uDF0F\uDF10\uDF13-\uDF28\uDF2A-\uDF30\uDF32\uDF33\uDF35-\uDF39\uDF3C-\uDF44\uDF47\uDF48\uDF4B-\uDF4D\uDF50\uDF57\uDF5D-\uDF63\uDF66-\uDF6C\uDF70-\uDF74]|\uD805[\uDC80-\uDCC5\uDCC7\uDCD0-\uDCD9\uDD80-\uDDB5\uDDB8-\uDDC0\uDDD8-\uDDDD\uDE00-\uDE40\uDE44\uDE50-\uDE59\uDE80-\uDEB7\uDEC0-\uDEC9\uDF00-\uDF19\uDF1D-\uDF2B\uDF30-\uDF39]|\uD806[\uDCA0-\uDCE9\uDCFF\uDEC0-\uDEF8]|\uD808[\uDC00-\uDF99]|\uD809[\uDC00-\uDC6E\uDC80-\uDD43]|[\uD80C\uD840-\uD868\uD86A-\uD86C\uD86F-\uD872][\uDC00-\uDFFF]|\uD80D[\uDC00-\uDC2E]|\uD811[\uDC00-\uDE46]|\uD81A[\uDC00-\uDE38\uDE40-\uDE5E\uDE60-\uDE69\uDED0-\uDEED\uDEF0-\uDEF4\uDF00-\uDF36\uDF40-\uDF43\uDF50-\uDF59\uDF63-\uDF77\uDF7D-\uDF8F]|\uD81B[\uDF00-\uDF44\uDF50-\uDF7E\uDF8F-\uDF9F]|\uD82C[\uDC00\uDC01]|\uD82F[\uDC00-\uDC6A\uDC70-\uDC7C\uDC80-\uDC88\uDC90-\uDC99\uDC9D\uDC9E]|\uD834[\uDD65-\uDD69\uDD6D-\uDD72\uDD7B-\uDD82\uDD85-\uDD8B\uDDAA-\uDDAD\uDE42-\uDE44]|\uD835[\uDC00-\uDC54\uDC56-\uDC9C\uDC9E\uDC9F\uDCA2\uDCA5\uDCA6\uDCA9-\uDCAC\uDCAE-\uDCB9\uDCBB\uDCBD-\uDCC3\uDCC5-\uDD05\uDD07-\uDD0A\uDD0D-\uDD14\uDD16-\uDD1C\uDD1E-\uDD39\uDD3B-\uDD3E\uDD40-\uDD44\uDD46\uDD4A-\uDD50\uDD52-\uDEA5\uDEA8-\uDEC0\uDEC2-\uDEDA\uDEDC-\uDEFA\uDEFC-\uDF14\uDF16-\uDF34\uDF36-\uDF4E\uDF50-\uDF6E\uDF70-\uDF88\uDF8A-\uDFA8\uDFAA-\uDFC2\uDFC4-\uDFCB\uDFCE-\uDFFF]|\uD836[\uDE00-\uDE36\uDE3B-\uDE6C\uDE75\uDE84\uDE9B-\uDE9F\uDEA1-\uDEAF]|\uD83A[\uDC00-\uDCC4\uDCD0-\uDCD6]|\uD83B[\uDE00-\uDE03\uDE05-\uDE1F\uDE21\uDE22\uDE24\uDE27\uDE29-\uDE32\uDE34-\uDE37\uDE39\uDE3B\uDE42\uDE47\uDE49\uDE4B\uDE4D-\uDE4F\uDE51\uDE52\uDE54\uDE57\uDE59\uDE5B\uDE5D\uDE5F\uDE61\uDE62\uDE64\uDE67-\uDE6A\uDE6C-\uDE72\uDE74-\uDE77\uDE79-\uDE7C\uDE7E\uDE80-\uDE89\uDE8B-\uDE9B\uDEA1-\uDEA3\uDEA5-\uDEA9\uDEAB-\uDEBB]|\uD869[\uDC00-\uDED6\uDF00-\uDFFF]|\uD86D[\uDC00-\uDF34\uDF40-\uDFFF]|\uD86E[\uDC00-\uDC1D\uDC20-\uDFFF]|\uD873[\uDC00-\uDEA1]|\uD87E[\uDC00-\uDE1D]|\uDB40[\uDD00-\uDDEF]/};m.Character={fromCodePoint:function(h){return h<65536?String.fromCharCode(h):String.fromCharCode(55296+(h-65536>>10))+String.fromCharCode(56320+(h-65536&1023))},isWhiteSpace:function(h){return 32===h||9===h||11===h||12===h||160===h||h>=5760&&[5760,8192,8193,8194,8195,8196,8197,8198,8199,8200,8201,8202,8239,8287,12288,65279].indexOf(h)>=0},isLineTerminator:function(h){return 10===h||13===h||8232===h||8233===h},isIdentifierStart:function(h){return 36===h||95===h||h>=65&&h<=90||h>=97&&h<=122||92===h||h>=128&&y.NonAsciiIdentifierStart.test(m.Character.fromCodePoint(h))},isIdentifierPart:function(h){return 36===h||95===h||h>=65&&h<=90||h>=97&&h<=122||h>=48&&h<=57||92===h||h>=128&&y.NonAsciiIdentifierPart.test(m.Character.fromCodePoint(h))},isDecimalDigit:function(h){return h>=48&&h<=57},isHexDigit:function(h){return h>=48&&h<=57||h>=65&&h<=70||h>=97&&h<=102},isOctalDigit:function(h){return h>=48&&h<=55}}},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0});var v=y(6),C=function C(h){this.type=v.JSXSyntax.JSXClosingElement,this.name=h};m.JSXClosingElement=C;var T=function T(h,m,y){this.type=v.JSXSyntax.JSXElement,this.openingElement=h,this.children=m,this.closingElement=y};m.JSXElement=T;var w=function w(){this.type=v.JSXSyntax.JSXEmptyExpression};m.JSXEmptyExpression=w;var A=function A(h){this.type=v.JSXSyntax.JSXExpressionContainer,this.expression=h};m.JSXExpressionContainer=A;var P=function P(h){this.type=v.JSXSyntax.JSXIdentifier,this.name=h};m.JSXIdentifier=P;var k=function k(h,m){this.type=v.JSXSyntax.JSXMemberExpression,this.object=h,this.property=m};m.JSXMemberExpression=k;var R=function R(h,m){this.type=v.JSXSyntax.JSXAttribute,this.name=h,this.value=m};m.JSXAttribute=R;var M=function M(h,m){this.type=v.JSXSyntax.JSXNamespacedName,this.namespace=h,this.name=m};m.JSXNamespacedName=M;var N=function N(h,m,y){this.type=v.JSXSyntax.JSXOpeningElement,this.name=h,this.selfClosing=m,this.attributes=y};m.JSXOpeningElement=N;var D=function D(h){this.type=v.JSXSyntax.JSXSpreadAttribute,this.argument=h};m.JSXSpreadAttribute=D;var I=function I(h,m){this.type=v.JSXSyntax.JSXText,this.value=h,this.raw=m};m.JSXText=I},function(h,m){"use strict";Object.defineProperty(m,"__esModule",{value:!0}),m.JSXSyntax={JSXAttribute:"JSXAttribute",JSXClosingElement:"JSXClosingElement",JSXElement:"JSXElement",JSXEmptyExpression:"JSXEmptyExpression",JSXExpressionContainer:"JSXExpressionContainer",JSXIdentifier:"JSXIdentifier",JSXMemberExpression:"JSXMemberExpression",JSXNamespacedName:"JSXNamespacedName",JSXOpeningElement:"JSXOpeningElement",JSXSpreadAttribute:"JSXSpreadAttribute",JSXText:"JSXText"}},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0});var v=y(2),C=function C(h){this.type=v.Syntax.ArrayExpression,this.elements=h};m.ArrayExpression=C;var T=function T(h){this.type=v.Syntax.ArrayPattern,this.elements=h};m.ArrayPattern=T;var w=function w(h,m,y){this.type=v.Syntax.ArrowFunctionExpression,this.id=null,this.params=h,this.body=m,this.generator=!1,this.expression=y,this.async=!1};m.ArrowFunctionExpression=w;var A=function A(h,m,y){this.type=v.Syntax.AssignmentExpression,this.operator=h,this.left=m,this.right=y};m.AssignmentExpression=A;var P=function P(h,m){this.type=v.Syntax.AssignmentPattern,this.left=h,this.right=m};m.AssignmentPattern=P;var k=function k(h,m,y){this.type=v.Syntax.ArrowFunctionExpression,this.id=null,this.params=h,this.body=m,this.generator=!1,this.expression=y,this.async=!0};m.AsyncArrowFunctionExpression=k;var R=function R(h,m,y){this.type=v.Syntax.FunctionDeclaration,this.id=h,this.params=m,this.body=y,this.generator=!1,this.expression=!1,this.async=!0};m.AsyncFunctionDeclaration=R;var M=function M(h,m,y){this.type=v.Syntax.FunctionExpression,this.id=h,this.params=m,this.body=y,this.generator=!1,this.expression=!1,this.async=!0};m.AsyncFunctionExpression=M;var N=function N(h){this.type=v.Syntax.AwaitExpression,this.argument=h};m.AwaitExpression=N;var D=function D(h,m,y){var C="||"===h||"&&"===h;this.type=C?v.Syntax.LogicalExpression:v.Syntax.BinaryExpression,this.operator=h,this.left=m,this.right=y};m.BinaryExpression=D;var I=function I(h){this.type=v.Syntax.BlockStatement,this.body=h};m.BlockStatement=I;var x=function x(h){this.type=v.Syntax.BreakStatement,this.label=h};m.BreakStatement=x;var O=function O(h,m){this.type=v.Syntax.CallExpression,this.callee=h,this.arguments=m};m.CallExpression=O;var L=function L(h,m){this.type=v.Syntax.CatchClause,this.param=h,this.body=m};m.CatchClause=L;var U=function U(h){this.type=v.Syntax.ClassBody,this.body=h};m.ClassBody=U;var B=function B(h,m,y){this.type=v.Syntax.ClassDeclaration,this.id=h,this.superClass=m,this.body=y};m.ClassDeclaration=B;var W=function W(h,m,y){this.type=v.Syntax.ClassExpression,this.id=h,this.superClass=m,this.body=y};m.ClassExpression=W;var q=function q(h,m){this.type=v.Syntax.MemberExpression,this.computed=!0,this.object=h,this.property=m};m.ComputedMemberExpression=q;var Y=function Y(h,m,y){this.type=v.Syntax.ConditionalExpression,this.test=h,this.consequent=m,this.alternate=y};m.ConditionalExpression=Y;var V=function V(h){this.type=v.Syntax.ContinueStatement,this.label=h};m.ContinueStatement=V;var $=function $(){this.type=v.Syntax.DebuggerStatement};m.DebuggerStatement=$;var z=function z(h,m){this.type=v.Syntax.ExpressionStatement,this.expression=h,this.directive=m};m.Directive=z;var G=function G(h,m){this.type=v.Syntax.DoWhileStatement,this.body=h,this.test=m};m.DoWhileStatement=G;var J=function J(){this.type=v.Syntax.EmptyStatement};m.EmptyStatement=J;var X=function X(h){this.type=v.Syntax.ExportAllDeclaration,this.source=h};m.ExportAllDeclaration=X;var Z=function Z(h){this.type=v.Syntax.ExportDefaultDeclaration,this.declaration=h};m.ExportDefaultDeclaration=Z;var ee=function ee(h,m,y){this.type=v.Syntax.ExportNamedDeclaration,this.declaration=h,this.specifiers=m,this.source=y};m.ExportNamedDeclaration=ee;var te=function te(h,m){this.type=v.Syntax.ExportSpecifier,this.exported=m,this.local=h};m.ExportSpecifier=te;var re=function re(h){this.type=v.Syntax.ExpressionStatement,this.expression=h};m.ExpressionStatement=re;var ie=function ie(h,m,y){this.type=v.Syntax.ForInStatement,this.left=h,this.right=m,this.body=y,this.each=!1};m.ForInStatement=ie;var se=function se(h,m,y){this.type=v.Syntax.ForOfStatement,this.left=h,this.right=m,this.body=y};m.ForOfStatement=se;var oe=function oe(h,m,y,C){this.type=v.Syntax.ForStatement,this.init=h,this.test=m,this.update=y,this.body=C};m.ForStatement=oe;var ae=function ae(h,m,y,C){this.type=v.Syntax.FunctionDeclaration,this.id=h,this.params=m,this.body=y,this.generator=C,this.expression=!1,this.async=!1};m.FunctionDeclaration=ae;var ce=function ce(h,m,y,C){this.type=v.Syntax.FunctionExpression,this.id=h,this.params=m,this.body=y,this.generator=C,this.expression=!1,this.async=!1};m.FunctionExpression=ce;var le=function le(h){this.type=v.Syntax.Identifier,this.name=h};m.Identifier=le;var ue=function ue(h,m,y){this.type=v.Syntax.IfStatement,this.test=h,this.consequent=m,this.alternate=y};m.IfStatement=ue;var de=function de(h,m){this.type=v.Syntax.ImportDeclaration,this.specifiers=h,this.source=m};m.ImportDeclaration=de;var he=function he(h){this.type=v.Syntax.ImportDefaultSpecifier,this.local=h};m.ImportDefaultSpecifier=he;var pe=function pe(h){this.type=v.Syntax.ImportNamespaceSpecifier,this.local=h};m.ImportNamespaceSpecifier=pe;var me=function me(h,m){this.type=v.Syntax.ImportSpecifier,this.local=h,this.imported=m};m.ImportSpecifier=me;var fe=function fe(h,m){this.type=v.Syntax.LabeledStatement,this.label=h,this.body=m};m.LabeledStatement=fe;var ye=function ye(h,m){this.type=v.Syntax.Literal,this.value=h,this.raw=m};m.Literal=ye;var ve=function ve(h,m){this.type=v.Syntax.MetaProperty,this.meta=h,this.property=m};m.MetaProperty=ve;var Se=function Se(h,m,y,C,T){this.type=v.Syntax.MethodDefinition,this.key=h,this.computed=m,this.value=y,this.kind=C,this.static=T};m.MethodDefinition=Se;var Ee=function Ee(h){this.type=v.Syntax.Program,this.body=h,this.sourceType="module"};m.Module=Ee;var Ce=function Ce(h,m){this.type=v.Syntax.NewExpression,this.callee=h,this.arguments=m};m.NewExpression=Ce;var _e=function _e(h){this.type=v.Syntax.ObjectExpression,this.properties=h};m.ObjectExpression=_e;var Te=function Te(h){this.type=v.Syntax.ObjectPattern,this.properties=h};m.ObjectPattern=Te;var be=function be(h,m,y,C,T,w){this.type=v.Syntax.Property,this.key=m,this.computed=y,this.value=C,this.kind=h,this.method=T,this.shorthand=w};m.Property=be;var we=function we(h,m,y,C){this.type=v.Syntax.Literal,this.value=h,this.raw=m,this.regex={pattern:y,flags:C}};m.RegexLiteral=we;var Ae=function Ae(h){this.type=v.Syntax.RestElement,this.argument=h};m.RestElement=Ae;var Pe=function Pe(h){this.type=v.Syntax.ReturnStatement,this.argument=h};m.ReturnStatement=Pe;var ke=function ke(h){this.type=v.Syntax.Program,this.body=h,this.sourceType="script"};m.Script=ke;var Ne=function Ne(h){this.type=v.Syntax.SequenceExpression,this.expressions=h};m.SequenceExpression=Ne;var De=function De(h){this.type=v.Syntax.SpreadElement,this.argument=h};m.SpreadElement=De;var Ie=function Ie(h,m){this.type=v.Syntax.MemberExpression,this.computed=!1,this.object=h,this.property=m};m.StaticMemberExpression=Ie;var Oe=function Oe(){this.type=v.Syntax.Super};m.Super=Oe;var Le=function Le(h,m){this.type=v.Syntax.SwitchCase,this.test=h,this.consequent=m};m.SwitchCase=Le;var Ue=function Ue(h,m){this.type=v.Syntax.SwitchStatement,this.discriminant=h,this.cases=m};m.SwitchStatement=Ue;var je=function je(h,m){this.type=v.Syntax.TaggedTemplateExpression,this.tag=h,this.quasi=m};m.TaggedTemplateExpression=je;var Be=function Be(h,m){this.type=v.Syntax.TemplateElement,this.value=h,this.tail=m};m.TemplateElement=Be;var He=function He(h,m){this.type=v.Syntax.TemplateLiteral,this.quasis=h,this.expressions=m};m.TemplateLiteral=He;var qe=function qe(){this.type=v.Syntax.ThisExpression};m.ThisExpression=qe;var Ye=function Ye(h){this.type=v.Syntax.ThrowStatement,this.argument=h};m.ThrowStatement=Ye;var Ve=function Ve(h,m,y){this.type=v.Syntax.TryStatement,this.block=h,this.handler=m,this.finalizer=y};m.TryStatement=Ve;var $e=function $e(h,m){this.type=v.Syntax.UnaryExpression,this.operator=h,this.argument=m,this.prefix=!0};m.UnaryExpression=$e;var Ke=function Ke(h,m,y){this.type=v.Syntax.UpdateExpression,this.operator=h,this.argument=m,this.prefix=y};m.UpdateExpression=Ke;var ze=function ze(h,m){this.type=v.Syntax.VariableDeclaration,this.declarations=h,this.kind=m};m.VariableDeclaration=ze;var Ge=function Ge(h,m){this.type=v.Syntax.VariableDeclarator,this.id=h,this.init=m};m.VariableDeclarator=Ge;var Xe=function Xe(h,m){this.type=v.Syntax.WhileStatement,this.test=h,this.body=m};m.WhileStatement=Xe;var Qe=function Qe(h,m){this.type=v.Syntax.WithStatement,this.object=h,this.body=m};m.WithStatement=Qe;var Ze=function Ze(h,m){this.type=v.Syntax.YieldExpression,this.argument=h,this.delegate=m};m.YieldExpression=Ze},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0});var v=y(9),C=y(10),T=y(11),w=y(7),A=y(12),P=y(2),k=y(13),R=function(){function Parser(h,m,y){void 0===m&&(m={}),this.config={range:"boolean"==typeof m.range&&m.range,loc:"boolean"==typeof m.loc&&m.loc,source:null,tokens:"boolean"==typeof m.tokens&&m.tokens,comment:"boolean"==typeof m.comment&&m.comment,tolerant:"boolean"==typeof m.tolerant&&m.tolerant},this.config.loc&&m.source&&null!==m.source&&(this.config.source=String(m.source)),this.delegate=y,this.errorHandler=new C.ErrorHandler,this.errorHandler.tolerant=this.config.tolerant,this.scanner=new A.Scanner(h,this.errorHandler),this.scanner.trackComment=this.config.comment,this.operatorPrecedence={")":0,";":0,",":0,"=":0,"]":0,"||":1,"&&":2,"|":3,"^":4,"&":5,"==":6,"!=":6,"===":6,"!==":6,"<":7,">":7,"<=":7,">=":7,"<<":8,">>":8,">>>":8,"+":9,"-":9,"*":11,"/":11,"%":11},this.lookahead={type:2,value:"",lineNumber:this.scanner.lineNumber,lineStart:0,start:0,end:0},this.hasLineTerminator=!1,this.context={isModule:!1,await:!1,allowIn:!0,allowStrictDirective:!0,allowYield:!0,firstCoverInitializedNameError:null,isAssignmentTarget:!1,isBindingElement:!1,inFunctionBody:!1,inIteration:!1,inSwitch:!1,labelSet:{},strict:!1},this.tokens=[],this.startMarker={index:0,line:this.scanner.lineNumber,column:0},this.lastMarker={index:0,line:this.scanner.lineNumber,column:0},this.nextToken(),this.lastMarker={index:this.scanner.index,line:this.scanner.lineNumber,column:this.scanner.index-this.scanner.lineStart}}return Parser.prototype.throwError=function(h){for(var m=[],y=1;y<arguments.length;y++)m[y-1]=arguments[y];var C=Array.prototype.slice.call(arguments,1),T=h.replace(/%(\d)/g,(function(h,m){return v.assert(m<C.length,"Message reference must be in range"),C[m]})),w=this.lastMarker.index,A=this.lastMarker.line,P=this.lastMarker.column+1;throw this.errorHandler.createError(w,A,P,T)},Parser.prototype.tolerateError=function(h){for(var m=[],y=1;y<arguments.length;y++)m[y-1]=arguments[y];var C=Array.prototype.slice.call(arguments,1),T=h.replace(/%(\d)/g,(function(h,m){return v.assert(m<C.length,"Message reference must be in range"),C[m]})),w=this.lastMarker.index,A=this.scanner.lineNumber,P=this.lastMarker.column+1;this.errorHandler.tolerateError(w,A,P,T)},Parser.prototype.unexpectedTokenError=function(h,m){var y,v=m||T.Messages.UnexpectedToken;if(h?(m||(v=2===h.type?T.Messages.UnexpectedEOS:3===h.type?T.Messages.UnexpectedIdentifier:6===h.type?T.Messages.UnexpectedNumber:8===h.type?T.Messages.UnexpectedString:10===h.type?T.Messages.UnexpectedTemplate:T.Messages.UnexpectedToken,4===h.type&&(this.scanner.isFutureReservedWord(h.value)?v=T.Messages.UnexpectedReserved:this.context.strict&&this.scanner.isStrictModeReservedWord(h.value)&&(v=T.Messages.StrictReservedWord))),y=h.value):y="ILLEGAL",v=v.replace("%0",y),h&&"number"==typeof h.lineNumber){var C=h.start,w=h.lineNumber,A=this.lastMarker.index-this.lastMarker.column,P=h.start-A+1;return this.errorHandler.createError(C,w,P,v)}C=this.lastMarker.index,w=this.lastMarker.line,P=this.lastMarker.column+1;return this.errorHandler.createError(C,w,P,v)},Parser.prototype.throwUnexpectedToken=function(h,m){throw this.unexpectedTokenError(h,m)},Parser.prototype.tolerateUnexpectedToken=function(h,m){this.errorHandler.tolerate(this.unexpectedTokenError(h,m))},Parser.prototype.collectComments=function(){if(this.config.comment){var h=this.scanner.scanComments();if(h.length>0&&this.delegate)for(var m=0;m<h.length;++m){var y=h[m],v=void 0;v={type:y.multiLine?"BlockComment":"LineComment",value:this.scanner.source.slice(y.slice[0],y.slice[1])},this.config.range&&(v.range=y.range),this.config.loc&&(v.loc=y.loc);var C={start:{line:y.loc.start.line,column:y.loc.start.column,offset:y.range[0]},end:{line:y.loc.end.line,column:y.loc.end.column,offset:y.range[1]}};this.delegate(v,C)}}else this.scanner.scanComments()},Parser.prototype.getTokenRaw=function(h){return this.scanner.source.slice(h.start,h.end)},Parser.prototype.convertToken=function(h){var m={type:k.TokenName[h.type],value:this.getTokenRaw(h)};if(this.config.range&&(m.range=[h.start,h.end]),this.config.loc&&(m.loc={start:{line:this.startMarker.line,column:this.startMarker.column},end:{line:this.scanner.lineNumber,column:this.scanner.index-this.scanner.lineStart}}),9===h.type){var y=h.pattern,v=h.flags;m.regex={pattern:y,flags:v}}return m},Parser.prototype.nextToken=function(){var h=this.lookahead;this.lastMarker.index=this.scanner.index,this.lastMarker.line=this.scanner.lineNumber,this.lastMarker.column=this.scanner.index-this.scanner.lineStart,this.collectComments(),this.scanner.index!==this.startMarker.index&&(this.startMarker.index=this.scanner.index,this.startMarker.line=this.scanner.lineNumber,this.startMarker.column=this.scanner.index-this.scanner.lineStart);var m=this.scanner.lex();return this.hasLineTerminator=h.lineNumber!==m.lineNumber,m&&this.context.strict&&3===m.type&&this.scanner.isStrictModeReservedWord(m.value)&&(m.type=4),this.lookahead=m,this.config.tokens&&2!==m.type&&this.tokens.push(this.convertToken(m)),h},Parser.prototype.nextRegexToken=function(){this.collectComments();var h=this.scanner.scanRegExp();return this.config.tokens&&(this.tokens.pop(),this.tokens.push(this.convertToken(h))),this.lookahead=h,this.nextToken(),h},Parser.prototype.createNode=function(){return{index:this.startMarker.index,line:this.startMarker.line,column:this.startMarker.column}},Parser.prototype.startNode=function(h,m){void 0===m&&(m=0);var y=h.start-h.lineStart,v=h.lineNumber;return y<0&&(y+=m,v--),{index:h.start,line:v,column:y}},Parser.prototype.finalize=function(h,m){if(this.config.range&&(m.range=[h.index,this.lastMarker.index]),this.config.loc&&(m.loc={start:{line:h.line,column:h.column},end:{line:this.lastMarker.line,column:this.lastMarker.column}},this.config.source&&(m.loc.source=this.config.source)),this.delegate){var y={start:{line:h.line,column:h.column,offset:h.index},end:{line:this.lastMarker.line,column:this.lastMarker.column,offset:this.lastMarker.index}};this.delegate(m,y)}return m},Parser.prototype.expect=function(h){var m=this.nextToken();7===m.type&&m.value===h||this.throwUnexpectedToken(m)},Parser.prototype.expectCommaSeparator=function(){if(this.config.tolerant){var h=this.lookahead;7===h.type&&","===h.value?this.nextToken():7===h.type&&";"===h.value?(this.nextToken(),this.tolerateUnexpectedToken(h)):this.tolerateUnexpectedToken(h,T.Messages.UnexpectedToken)}else this.expect(",")},Parser.prototype.expectKeyword=function(h){var m=this.nextToken();4===m.type&&m.value===h||this.throwUnexpectedToken(m)},Parser.prototype.match=function(h){return 7===this.lookahead.type&&this.lookahead.value===h},Parser.prototype.matchKeyword=function(h){return 4===this.lookahead.type&&this.lookahead.value===h},Parser.prototype.matchContextualKeyword=function(h){return 3===this.lookahead.type&&this.lookahead.value===h},Parser.prototype.matchAssign=function(){if(7!==this.lookahead.type)return!1;var h=this.lookahead.value;return"="===h||"*="===h||"**="===h||"/="===h||"%="===h||"+="===h||"-="===h||"<<="===h||">>="===h||">>>="===h||"&="===h||"^="===h||"|="===h},Parser.prototype.isolateCoverGrammar=function(h){var m=this.context.isBindingElement,y=this.context.isAssignmentTarget,v=this.context.firstCoverInitializedNameError;this.context.isBindingElement=!0,this.context.isAssignmentTarget=!0,this.context.firstCoverInitializedNameError=null;var C=h.call(this);return null!==this.context.firstCoverInitializedNameError&&this.throwUnexpectedToken(this.context.firstCoverInitializedNameError),this.context.isBindingElement=m,this.context.isAssignmentTarget=y,this.context.firstCoverInitializedNameError=v,C},Parser.prototype.inheritCoverGrammar=function(h){var m=this.context.isBindingElement,y=this.context.isAssignmentTarget,v=this.context.firstCoverInitializedNameError;this.context.isBindingElement=!0,this.context.isAssignmentTarget=!0,this.context.firstCoverInitializedNameError=null;var C=h.call(this);return this.context.isBindingElement=this.context.isBindingElement&&m,this.context.isAssignmentTarget=this.context.isAssignmentTarget&&y,this.context.firstCoverInitializedNameError=v||this.context.firstCoverInitializedNameError,C},Parser.prototype.consumeSemicolon=function(){this.match(";")?this.nextToken():this.hasLineTerminator||(2===this.lookahead.type||this.match("}")||this.throwUnexpectedToken(this.lookahead),this.lastMarker.index=this.startMarker.index,this.lastMarker.line=this.startMarker.line,this.lastMarker.column=this.startMarker.column)},Parser.prototype.parsePrimaryExpression=function(){var h,m,y,v=this.createNode();switch(this.lookahead.type){case 3:(this.context.isModule||this.context.await)&&"await"===this.lookahead.value&&this.tolerateUnexpectedToken(this.lookahead),h=this.matchAsyncFunction()?this.parseFunctionExpression():this.finalize(v,new w.Identifier(this.nextToken().value));break;case 6:case 8:this.context.strict&&this.lookahead.octal&&this.tolerateUnexpectedToken(this.lookahead,T.Messages.StrictOctalLiteral),this.context.isAssignmentTarget=!1,this.context.isBindingElement=!1,m=this.nextToken(),y=this.getTokenRaw(m),h=this.finalize(v,new w.Literal(m.value,y));break;case 1:this.context.isAssignmentTarget=!1,this.context.isBindingElement=!1,m=this.nextToken(),y=this.getTokenRaw(m),h=this.finalize(v,new w.Literal("true"===m.value,y));break;case 5:this.context.isAssignmentTarget=!1,this.context.isBindingElement=!1,m=this.nextToken(),y=this.getTokenRaw(m),h=this.finalize(v,new w.Literal(null,y));break;case 10:h=this.parseTemplateLiteral();break;case 7:switch(this.lookahead.value){case"(":this.context.isBindingElement=!1,h=this.inheritCoverGrammar(this.parseGroupExpression);break;case"[":h=this.inheritCoverGrammar(this.parseArrayInitializer);break;case"{":h=this.inheritCoverGrammar(this.parseObjectInitializer);break;case"/":case"/=":this.context.isAssignmentTarget=!1,this.context.isBindingElement=!1,this.scanner.index=this.startMarker.index,m=this.nextRegexToken(),y=this.getTokenRaw(m),h=this.finalize(v,new w.RegexLiteral(m.regex,y,m.pattern,m.flags));break;default:h=this.throwUnexpectedToken(this.nextToken())}break;case 4:!this.context.strict&&this.context.allowYield&&this.matchKeyword("yield")?h=this.parseIdentifierName():!this.context.strict&&this.matchKeyword("let")?h=this.finalize(v,new w.Identifier(this.nextToken().value)):(this.context.isAssignmentTarget=!1,this.context.isBindingElement=!1,this.matchKeyword("function")?h=this.parseFunctionExpression():this.matchKeyword("this")?(this.nextToken(),h=this.finalize(v,new w.ThisExpression)):h=this.matchKeyword("class")?this.parseClassExpression():this.throwUnexpectedToken(this.nextToken()));break;default:h=this.throwUnexpectedToken(this.nextToken())}return h},Parser.prototype.parseSpreadElement=function(){var h=this.createNode();this.expect("...");var m=this.inheritCoverGrammar(this.parseAssignmentExpression);return this.finalize(h,new w.SpreadElement(m))},Parser.prototype.parseArrayInitializer=function(){var h=this.createNode(),m=[];for(this.expect("[");!this.match("]");)if(this.match(","))this.nextToken(),m.push(null);else if(this.match("...")){var y=this.parseSpreadElement();this.match("]")||(this.context.isAssignmentTarget=!1,this.context.isBindingElement=!1,this.expect(",")),m.push(y)}else m.push(this.inheritCoverGrammar(this.parseAssignmentExpression)),this.match("]")||this.expect(",");return this.expect("]"),this.finalize(h,new w.ArrayExpression(m))},Parser.prototype.parsePropertyMethod=function(h){this.context.isAssignmentTarget=!1,this.context.isBindingElement=!1;var m=this.context.strict,y=this.context.allowStrictDirective;this.context.allowStrictDirective=h.simple;var v=this.isolateCoverGrammar(this.parseFunctionSourceElements);return this.context.strict&&h.firstRestricted&&this.tolerateUnexpectedToken(h.firstRestricted,h.message),this.context.strict&&h.stricted&&this.tolerateUnexpectedToken(h.stricted,h.message),this.context.strict=m,this.context.allowStrictDirective=y,v},Parser.prototype.parsePropertyMethodFunction=function(){var h=this.createNode(),m=this.context.allowYield;this.context.allowYield=!0;var y=this.parseFormalParameters(),v=this.parsePropertyMethod(y);return this.context.allowYield=m,this.finalize(h,new w.FunctionExpression(null,y.params,v,!1))},Parser.prototype.parsePropertyMethodAsyncFunction=function(){var h=this.createNode(),m=this.context.allowYield,y=this.context.await;this.context.allowYield=!1,this.context.await=!0;var v=this.parseFormalParameters(),C=this.parsePropertyMethod(v);return this.context.allowYield=m,this.context.await=y,this.finalize(h,new w.AsyncFunctionExpression(null,v.params,C))},Parser.prototype.parseObjectPropertyKey=function(){var h,m=this.createNode(),y=this.nextToken();switch(y.type){case 8:case 6:this.context.strict&&y.octal&&this.tolerateUnexpectedToken(y,T.Messages.StrictOctalLiteral);var v=this.getTokenRaw(y);h=this.finalize(m,new w.Literal(y.value,v));break;case 3:case 1:case 5:case 4:h=this.finalize(m,new w.Identifier(y.value));break;case 7:"["===y.value?(h=this.isolateCoverGrammar(this.parseAssignmentExpression),this.expect("]")):h=this.throwUnexpectedToken(y);break;default:h=this.throwUnexpectedToken(y)}return h},Parser.prototype.isPropertyKey=function(h,m){return h.type===P.Syntax.Identifier&&h.name===m||h.type===P.Syntax.Literal&&h.value===m},Parser.prototype.parseObjectProperty=function(h){var m,y=this.createNode(),v=this.lookahead,C=null,A=null,P=!1,k=!1,R=!1,M=!1;if(3===v.type){var N=v.value;this.nextToken(),P=this.match("["),C=(M=!(this.hasLineTerminator||"async"!==N||this.match(":")||this.match("(")||this.match("*")||this.match(",")))?this.parseObjectPropertyKey():this.finalize(y,new w.Identifier(N))}else this.match("*")?this.nextToken():(P=this.match("["),C=this.parseObjectPropertyKey());var D=this.qualifiedPropertyName(this.lookahead);if(3===v.type&&!M&&"get"===v.value&&D)m="get",P=this.match("["),C=this.parseObjectPropertyKey(),this.context.allowYield=!1,A=this.parseGetterMethod();else if(3===v.type&&!M&&"set"===v.value&&D)m="set",P=this.match("["),C=this.parseObjectPropertyKey(),A=this.parseSetterMethod();else if(7===v.type&&"*"===v.value&&D)m="init",P=this.match("["),C=this.parseObjectPropertyKey(),A=this.parseGeneratorMethod(),k=!0;else if(C||this.throwUnexpectedToken(this.lookahead),m="init",this.match(":")&&!M)!P&&this.isPropertyKey(C,"__proto__")&&(h.value&&this.tolerateError(T.Messages.DuplicateProtoProperty),h.value=!0),this.nextToken(),A=this.inheritCoverGrammar(this.parseAssignmentExpression);else if(this.match("("))A=M?this.parsePropertyMethodAsyncFunction():this.parsePropertyMethodFunction(),k=!0;else if(3===v.type){N=this.finalize(y,new w.Identifier(v.value));if(this.match("=")){this.context.firstCoverInitializedNameError=this.lookahead,this.nextToken(),R=!0;var I=this.isolateCoverGrammar(this.parseAssignmentExpression);A=this.finalize(y,new w.AssignmentPattern(N,I))}else R=!0,A=N}else this.throwUnexpectedToken(this.nextToken());return this.finalize(y,new w.Property(m,C,P,A,k,R))},Parser.prototype.parseObjectInitializer=function(){var h=this.createNode();this.expect("{");for(var m=[],y={value:!1};!this.match("}");)m.push(this.parseObjectProperty(y)),this.match("}")||this.expectCommaSeparator();return this.expect("}"),this.finalize(h,new w.ObjectExpression(m))},Parser.prototype.parseTemplateHead=function(){v.assert(this.lookahead.head,"Template literal must start with a template head");var h=this.createNode(),m=this.nextToken(),y=m.value,C=m.cooked;return this.finalize(h,new w.TemplateElement({raw:y,cooked:C},m.tail))},Parser.prototype.parseTemplateElement=function(){10!==this.lookahead.type&&this.throwUnexpectedToken();var h=this.createNode(),m=this.nextToken(),y=m.value,v=m.cooked;return this.finalize(h,new w.TemplateElement({raw:y,cooked:v},m.tail))},Parser.prototype.parseTemplateLiteral=function(){var h=this.createNode(),m=[],y=[],v=this.parseTemplateHead();for(y.push(v);!v.tail;)m.push(this.parseExpression()),v=this.parseTemplateElement(),y.push(v);return this.finalize(h,new w.TemplateLiteral(y,m))},Parser.prototype.reinterpretExpressionAsPattern=function(h){switch(h.type){case P.Syntax.Identifier:case P.Syntax.MemberExpression:case P.Syntax.RestElement:case P.Syntax.AssignmentPattern:break;case P.Syntax.SpreadElement:h.type=P.Syntax.RestElement,this.reinterpretExpressionAsPattern(h.argument);break;case P.Syntax.ArrayExpression:h.type=P.Syntax.ArrayPattern;for(var m=0;m<h.elements.length;m++)null!==h.elements[m]&&this.reinterpretExpressionAsPattern(h.elements[m]);break;case P.Syntax.ObjectExpression:h.type=P.Syntax.ObjectPattern;for(m=0;m<h.properties.length;m++)this.reinterpretExpressionAsPattern(h.properties[m].value);break;case P.Syntax.AssignmentExpression:h.type=P.Syntax.AssignmentPattern,delete h.operator,this.reinterpretExpressionAsPattern(h.left)}},Parser.prototype.parseGroupExpression=function(){var h;if(this.expect("("),this.match(")"))this.nextToken(),this.match("=>")||this.expect("=>"),h={type:"ArrowParameterPlaceHolder",params:[],async:!1};else{var m=this.lookahead,y=[];if(this.match("..."))h=this.parseRestElement(y),this.expect(")"),this.match("=>")||this.expect("=>"),h={type:"ArrowParameterPlaceHolder",params:[h],async:!1};else{var v=!1;if(this.context.isBindingElement=!0,h=this.inheritCoverGrammar(this.parseAssignmentExpression),this.match(",")){var C=[];for(this.context.isAssignmentTarget=!1,C.push(h);2!==this.lookahead.type&&this.match(",");){if(this.nextToken(),this.match(")")){this.nextToken();for(var T=0;T<C.length;T++)this.reinterpretExpressionAsPattern(C[T]);v=!0,h={type:"ArrowParameterPlaceHolder",params:C,async:!1}}else if(this.match("...")){this.context.isBindingElement||this.throwUnexpectedToken(this.lookahead),C.push(this.parseRestElement(y)),this.expect(")"),this.match("=>")||this.expect("=>"),this.context.isBindingElement=!1;for(T=0;T<C.length;T++)this.reinterpretExpressionAsPattern(C[T]);v=!0,h={type:"ArrowParameterPlaceHolder",params:C,async:!1}}else C.push(this.inheritCoverGrammar(this.parseAssignmentExpression));if(v)break}v||(h=this.finalize(this.startNode(m),new w.SequenceExpression(C)))}if(!v){if(this.expect(")"),this.match("=>")&&(h.type===P.Syntax.Identifier&&"yield"===h.name&&(v=!0,h={type:"ArrowParameterPlaceHolder",params:[h],async:!1}),!v)){if(this.context.isBindingElement||this.throwUnexpectedToken(this.lookahead),h.type===P.Syntax.SequenceExpression)for(T=0;T<h.expressions.length;T++)this.reinterpretExpressionAsPattern(h.expressions[T]);else this.reinterpretExpressionAsPattern(h);h={type:"ArrowParameterPlaceHolder",params:h.type===P.Syntax.SequenceExpression?h.expressions:[h],async:!1}}this.context.isBindingElement=!1}}}return h},Parser.prototype.parseArguments=function(){this.expect("(");var h=[];if(!this.match(")"))for(;;){var m=this.match("...")?this.parseSpreadElement():this.isolateCoverGrammar(this.parseAssignmentExpression);if(h.push(m),this.match(")"))break;if(this.expectCommaSeparator(),this.match(")"))break}return this.expect(")"),h},Parser.prototype.isIdentifierName=function(h){return 3===h.type||4===h.type||1===h.type||5===h.type},Parser.prototype.parseIdentifierName=function(){var h=this.createNode(),m=this.nextToken();return this.isIdentifierName(m)||this.throwUnexpectedToken(m),this.finalize(h,new w.Identifier(m.value))},Parser.prototype.parseNewExpression=function(){var h,m=this.createNode(),y=this.parseIdentifierName();if(v.assert("new"===y.name,"New expression must start with `new`"),this.match("."))if(this.nextToken(),3===this.lookahead.type&&this.context.inFunctionBody&&"target"===this.lookahead.value){var C=this.parseIdentifierName();h=new w.MetaProperty(y,C)}else this.throwUnexpectedToken(this.lookahead);else{var T=this.isolateCoverGrammar(this.parseLeftHandSideExpression),A=this.match("(")?this.parseArguments():[];h=new w.NewExpression(T,A),this.context.isAssignmentTarget=!1,this.context.isBindingElement=!1}return this.finalize(m,h)},Parser.prototype.parseAsyncArgument=function(){var h=this.parseAssignmentExpression();return this.context.firstCoverInitializedNameError=null,h},Parser.prototype.parseAsyncArguments=function(){this.expect("(");var h=[];if(!this.match(")"))for(;;){var m=this.match("...")?this.parseSpreadElement():this.isolateCoverGrammar(this.parseAsyncArgument);if(h.push(m),this.match(")"))break;if(this.expectCommaSeparator(),this.match(")"))break}return this.expect(")"),h},Parser.prototype.parseLeftHandSideExpressionAllowCall=function(){var h,m=this.lookahead,y=this.matchContextualKeyword("async"),v=this.context.allowIn;for(this.context.allowIn=!0,this.matchKeyword("super")&&this.context.inFunctionBody?(h=this.createNode(),this.nextToken(),h=this.finalize(h,new w.Super),this.match("(")||this.match(".")||this.match("[")||this.throwUnexpectedToken(this.lookahead)):h=this.inheritCoverGrammar(this.matchKeyword("new")?this.parseNewExpression:this.parsePrimaryExpression);;)if(this.match(".")){this.context.isBindingElement=!1,this.context.isAssignmentTarget=!0,this.expect(".");var C=this.parseIdentifierName();h=this.finalize(this.startNode(m),new w.StaticMemberExpression(h,C))}else if(this.match("(")){var T=y&&m.lineNumber===this.lookahead.lineNumber;this.context.isBindingElement=!1,this.context.isAssignmentTarget=!1;var A=T?this.parseAsyncArguments():this.parseArguments();if(h=this.finalize(this.startNode(m),new w.CallExpression(h,A)),T&&this.match("=>")){for(var P=0;P<A.length;++P)this.reinterpretExpressionAsPattern(A[P]);h={type:"ArrowParameterPlaceHolder",params:A,async:!0}}}else if(this.match("[")){this.context.isBindingElement=!1,this.context.isAssignmentTarget=!0,this.expect("[");C=this.isolateCoverGrammar(this.parseExpression);this.expect("]"),h=this.finalize(this.startNode(m),new w.ComputedMemberExpression(h,C))}else{if(10!==this.lookahead.type||!this.lookahead.head)break;var k=this.parseTemplateLiteral();h=this.finalize(this.startNode(m),new w.TaggedTemplateExpression(h,k))}return this.context.allowIn=v,h},Parser.prototype.parseSuper=function(){var h=this.createNode();return this.expectKeyword("super"),this.match("[")||this.match(".")||this.throwUnexpectedToken(this.lookahead),this.finalize(h,new w.Super)},Parser.prototype.parseLeftHandSideExpression=function(){v.assert(this.context.allowIn,"callee of new expression always allow in keyword.");for(var h=this.startNode(this.lookahead),m=this.matchKeyword("super")&&this.context.inFunctionBody?this.parseSuper():this.inheritCoverGrammar(this.matchKeyword("new")?this.parseNewExpression:this.parsePrimaryExpression);;)if(this.match("[")){this.context.isBindingElement=!1,this.context.isAssignmentTarget=!0,this.expect("[");var y=this.isolateCoverGrammar(this.parseExpression);this.expect("]"),m=this.finalize(h,new w.ComputedMemberExpression(m,y))}else if(this.match(".")){this.context.isBindingElement=!1,this.context.isAssignmentTarget=!0,this.expect(".");y=this.parseIdentifierName();m=this.finalize(h,new w.StaticMemberExpression(m,y))}else{if(10!==this.lookahead.type||!this.lookahead.head)break;var C=this.parseTemplateLiteral();m=this.finalize(h,new w.TaggedTemplateExpression(m,C))}return m},Parser.prototype.parseUpdateExpression=function(){var h,m=this.lookahead;if(this.match("++")||this.match("--")){var y=this.startNode(m),v=this.nextToken();h=this.inheritCoverGrammar(this.parseUnaryExpression),this.context.strict&&h.type===P.Syntax.Identifier&&this.scanner.isRestrictedWord(h.name)&&this.tolerateError(T.Messages.StrictLHSPrefix),this.context.isAssignmentTarget||this.tolerateError(T.Messages.InvalidLHSInAssignment);var C=!0;h=this.finalize(y,new w.UpdateExpression(v.value,h,C)),this.context.isAssignmentTarget=!1,this.context.isBindingElement=!1}else if(h=this.inheritCoverGrammar(this.parseLeftHandSideExpressionAllowCall),!this.hasLineTerminator&&7===this.lookahead.type&&(this.match("++")||this.match("--"))){this.context.strict&&h.type===P.Syntax.Identifier&&this.scanner.isRestrictedWord(h.name)&&this.tolerateError(T.Messages.StrictLHSPostfix),this.context.isAssignmentTarget||this.tolerateError(T.Messages.InvalidLHSInAssignment),this.context.isAssignmentTarget=!1,this.context.isBindingElement=!1;var A=this.nextToken().value;C=!1;h=this.finalize(this.startNode(m),new w.UpdateExpression(A,h,C))}return h},Parser.prototype.parseAwaitExpression=function(){var h=this.createNode();this.nextToken();var m=this.parseUnaryExpression();return this.finalize(h,new w.AwaitExpression(m))},Parser.prototype.parseUnaryExpression=function(){var h;if(this.match("+")||this.match("-")||this.match("~")||this.match("!")||this.matchKeyword("delete")||this.matchKeyword("void")||this.matchKeyword("typeof")){var m=this.startNode(this.lookahead),y=this.nextToken();h=this.inheritCoverGrammar(this.parseUnaryExpression),h=this.finalize(m,new w.UnaryExpression(y.value,h)),this.context.strict&&"delete"===h.operator&&h.argument.type===P.Syntax.Identifier&&this.tolerateError(T.Messages.StrictDelete),this.context.isAssignmentTarget=!1,this.context.isBindingElement=!1}else h=this.context.await&&this.matchContextualKeyword("await")?this.parseAwaitExpression():this.parseUpdateExpression();return h},Parser.prototype.parseExponentiationExpression=function(){var h=this.lookahead,m=this.inheritCoverGrammar(this.parseUnaryExpression);if(m.type!==P.Syntax.UnaryExpression&&this.match("**")){this.nextToken(),this.context.isAssignmentTarget=!1,this.context.isBindingElement=!1;var y=m,v=this.isolateCoverGrammar(this.parseExponentiationExpression);m=this.finalize(this.startNode(h),new w.BinaryExpression("**",y,v))}return m},Parser.prototype.binaryPrecedence=function(h){var m=h.value;return 7===h.type?this.operatorPrecedence[m]||0:4===h.type&&("instanceof"===m||this.context.allowIn&&"in"===m)?7:0},Parser.prototype.parseBinaryExpression=function(){var h=this.lookahead,m=this.inheritCoverGrammar(this.parseExponentiationExpression),y=this.lookahead,v=this.binaryPrecedence(y);if(v>0){this.nextToken(),this.context.isAssignmentTarget=!1,this.context.isBindingElement=!1;for(var C=[h,this.lookahead],T=m,A=this.isolateCoverGrammar(this.parseExponentiationExpression),P=[T,y.value,A],k=[v];!((v=this.binaryPrecedence(this.lookahead))<=0);){for(;P.length>2&&v<=k[k.length-1];){A=P.pop();var R=P.pop();k.pop(),T=P.pop(),C.pop();var M=this.startNode(C[C.length-1]);P.push(this.finalize(M,new w.BinaryExpression(R,T,A)))}P.push(this.nextToken().value),k.push(v),C.push(this.lookahead),P.push(this.isolateCoverGrammar(this.parseExponentiationExpression))}var N=P.length-1;m=P[N];for(var D=C.pop();N>1;){var I=C.pop(),x=D&&D.lineStart;M=this.startNode(I,x),R=P[N-1];m=this.finalize(M,new w.BinaryExpression(R,P[N-2],m)),N-=2,D=I}}return m},Parser.prototype.parseConditionalExpression=function(){var h=this.lookahead,m=this.inheritCoverGrammar(this.parseBinaryExpression);if(this.match("?")){this.nextToken();var y=this.context.allowIn;this.context.allowIn=!0;var v=this.isolateCoverGrammar(this.parseAssignmentExpression);this.context.allowIn=y,this.expect(":");var C=this.isolateCoverGrammar(this.parseAssignmentExpression);m=this.finalize(this.startNode(h),new w.ConditionalExpression(m,v,C)),this.context.isAssignmentTarget=!1,this.context.isBindingElement=!1}return m},Parser.prototype.checkPatternParam=function(h,m){switch(m.type){case P.Syntax.Identifier:this.validateParam(h,m,m.name);break;case P.Syntax.RestElement:this.checkPatternParam(h,m.argument);break;case P.Syntax.AssignmentPattern:this.checkPatternParam(h,m.left);break;case P.Syntax.ArrayPattern:for(var y=0;y<m.elements.length;y++)null!==m.elements[y]&&this.checkPatternParam(h,m.elements[y]);break;case P.Syntax.ObjectPattern:for(y=0;y<m.properties.length;y++)this.checkPatternParam(h,m.properties[y].value)}h.simple=h.simple&&m instanceof w.Identifier},Parser.prototype.reinterpretAsCoverFormalsList=function(h){var m,y=[h],v=!1;switch(h.type){case P.Syntax.Identifier:break;case"ArrowParameterPlaceHolder":y=h.params,v=h.async;break;default:return null}m={simple:!0,paramSet:{}};for(var C=0;C<y.length;++C){(w=y[C]).type===P.Syntax.AssignmentPattern?w.right.type===P.Syntax.YieldExpression&&(w.right.argument&&this.throwUnexpectedToken(this.lookahead),w.right.type=P.Syntax.Identifier,w.right.name="yield",delete w.right.argument,delete w.right.delegate):v&&w.type===P.Syntax.Identifier&&"await"===w.name&&this.throwUnexpectedToken(this.lookahead),this.checkPatternParam(m,w),y[C]=w}if(this.context.strict||!this.context.allowYield)for(C=0;C<y.length;++C){var w;(w=y[C]).type===P.Syntax.YieldExpression&&this.throwUnexpectedToken(this.lookahead)}if(m.message===T.Messages.StrictParamDupe){var A=this.context.strict?m.stricted:m.firstRestricted;this.throwUnexpectedToken(A,m.message)}return{simple:m.simple,params:y,stricted:m.stricted,firstRestricted:m.firstRestricted,message:m.message}},Parser.prototype.parseAssignmentExpression=function(){var h;if(!this.context.allowYield&&this.matchKeyword("yield"))h=this.parseYieldExpression();else{var m=this.lookahead,y=m;if(h=this.parseConditionalExpression(),3===y.type&&y.lineNumber===this.lookahead.lineNumber&&"async"===y.value&&(3===this.lookahead.type||this.matchKeyword("yield"))){var v=this.parsePrimaryExpression();this.reinterpretExpressionAsPattern(v),h={type:"ArrowParameterPlaceHolder",params:[v],async:!0}}if("ArrowParameterPlaceHolder"===h.type||this.match("=>")){this.context.isAssignmentTarget=!1,this.context.isBindingElement=!1;var C=h.async,A=this.reinterpretAsCoverFormalsList(h);if(A){this.hasLineTerminator&&this.tolerateUnexpectedToken(this.lookahead),this.context.firstCoverInitializedNameError=null;var k=this.context.strict,R=this.context.allowStrictDirective;this.context.allowStrictDirective=A.simple;var M=this.context.allowYield,N=this.context.await;this.context.allowYield=!0,this.context.await=C;var D=this.startNode(m);this.expect("=>");var I=void 0;if(this.match("{")){var x=this.context.allowIn;this.context.allowIn=!0,I=this.parseFunctionSourceElements(),this.context.allowIn=x}else I=this.isolateCoverGrammar(this.parseAssignmentExpression);var O=I.type!==P.Syntax.BlockStatement;this.context.strict&&A.firstRestricted&&this.throwUnexpectedToken(A.firstRestricted,A.message),this.context.strict&&A.stricted&&this.tolerateUnexpectedToken(A.stricted,A.message),h=C?this.finalize(D,new w.AsyncArrowFunctionExpression(A.params,I,O)):this.finalize(D,new w.ArrowFunctionExpression(A.params,I,O)),this.context.strict=k,this.context.allowStrictDirective=R,this.context.allowYield=M,this.context.await=N}}else if(this.matchAssign()){if(this.context.isAssignmentTarget||this.tolerateError(T.Messages.InvalidLHSInAssignment),this.context.strict&&h.type===P.Syntax.Identifier){var L=h;this.scanner.isRestrictedWord(L.name)&&this.tolerateUnexpectedToken(y,T.Messages.StrictLHSAssignment),this.scanner.isStrictModeReservedWord(L.name)&&this.tolerateUnexpectedToken(y,T.Messages.StrictReservedWord)}this.match("=")?this.reinterpretExpressionAsPattern(h):(this.context.isAssignmentTarget=!1,this.context.isBindingElement=!1);var U=(y=this.nextToken()).value,B=this.isolateCoverGrammar(this.parseAssignmentExpression);h=this.finalize(this.startNode(m),new w.AssignmentExpression(U,h,B)),this.context.firstCoverInitializedNameError=null}}return h},Parser.prototype.parseExpression=function(){var h=this.lookahead,m=this.isolateCoverGrammar(this.parseAssignmentExpression);if(this.match(",")){var y=[];for(y.push(m);2!==this.lookahead.type&&this.match(",");)this.nextToken(),y.push(this.isolateCoverGrammar(this.parseAssignmentExpression));m=this.finalize(this.startNode(h),new w.SequenceExpression(y))}return m},Parser.prototype.parseStatementListItem=function(){var h;if(this.context.isAssignmentTarget=!0,this.context.isBindingElement=!0,4===this.lookahead.type)switch(this.lookahead.value){case"export":this.context.isModule||this.tolerateUnexpectedToken(this.lookahead,T.Messages.IllegalExportDeclaration),h=this.parseExportDeclaration();break;case"import":this.context.isModule||this.tolerateUnexpectedToken(this.lookahead,T.Messages.IllegalImportDeclaration),h=this.parseImportDeclaration();break;case"const":h=this.parseLexicalDeclaration({inFor:!1});break;case"function":h=this.parseFunctionDeclaration();break;case"class":h=this.parseClassDeclaration();break;case"let":h=this.isLexicalDeclaration()?this.parseLexicalDeclaration({inFor:!1}):this.parseStatement();break;default:h=this.parseStatement()}else h=this.parseStatement();return h},Parser.prototype.parseBlock=function(){var h=this.createNode();this.expect("{");for(var m=[];!this.match("}");)m.push(this.parseStatementListItem());return this.expect("}"),this.finalize(h,new w.BlockStatement(m))},Parser.prototype.parseLexicalBinding=function(h,m){var y=this.createNode(),v=this.parsePattern([],h);this.context.strict&&v.type===P.Syntax.Identifier&&this.scanner.isRestrictedWord(v.name)&&this.tolerateError(T.Messages.StrictVarName);var C=null;return"const"===h?this.matchKeyword("in")||this.matchContextualKeyword("of")||(this.match("=")?(this.nextToken(),C=this.isolateCoverGrammar(this.parseAssignmentExpression)):this.throwError(T.Messages.DeclarationMissingInitializer,"const")):(!m.inFor&&v.type!==P.Syntax.Identifier||this.match("="))&&(this.expect("="),C=this.isolateCoverGrammar(this.parseAssignmentExpression)),this.finalize(y,new w.VariableDeclarator(v,C))},Parser.prototype.parseBindingList=function(h,m){for(var y=[this.parseLexicalBinding(h,m)];this.match(",");)this.nextToken(),y.push(this.parseLexicalBinding(h,m));return y},Parser.prototype.isLexicalDeclaration=function(){var h=this.scanner.saveState();this.scanner.scanComments();var m=this.scanner.lex();return this.scanner.restoreState(h),3===m.type||7===m.type&&"["===m.value||7===m.type&&"{"===m.value||4===m.type&&"let"===m.value||4===m.type&&"yield"===m.value},Parser.prototype.parseLexicalDeclaration=function(h){var m=this.createNode(),y=this.nextToken().value;v.assert("let"===y||"const"===y,"Lexical declaration must be either let or const");var C=this.parseBindingList(y,h);return this.consumeSemicolon(),this.finalize(m,new w.VariableDeclaration(C,y))},Parser.prototype.parseBindingRestElement=function(h,m){var y=this.createNode();this.expect("...");var v=this.parsePattern(h,m);return this.finalize(y,new w.RestElement(v))},Parser.prototype.parseArrayPattern=function(h,m){var y=this.createNode();this.expect("[");for(var v=[];!this.match("]");)if(this.match(","))this.nextToken(),v.push(null);else{if(this.match("...")){v.push(this.parseBindingRestElement(h,m));break}v.push(this.parsePatternWithDefault(h,m)),this.match("]")||this.expect(",")}return this.expect("]"),this.finalize(y,new w.ArrayPattern(v))},Parser.prototype.parsePropertyPattern=function(h,m){var y,v,C=this.createNode(),T=!1,A=!1;if(3===this.lookahead.type){var P=this.lookahead;y=this.parseVariableIdentifier();var k=this.finalize(C,new w.Identifier(P.value));if(this.match("=")){h.push(P),A=!0,this.nextToken();var R=this.parseAssignmentExpression();v=this.finalize(this.startNode(P),new w.AssignmentPattern(k,R))}else this.match(":")?(this.expect(":"),v=this.parsePatternWithDefault(h,m)):(h.push(P),A=!0,v=k)}else T=this.match("["),y=this.parseObjectPropertyKey(),this.expect(":"),v=this.parsePatternWithDefault(h,m);return this.finalize(C,new w.Property("init",y,T,v,!1,A))},Parser.prototype.parseObjectPattern=function(h,m){var y=this.createNode(),v=[];for(this.expect("{");!this.match("}");)v.push(this.parsePropertyPattern(h,m)),this.match("}")||this.expect(",");return this.expect("}"),this.finalize(y,new w.ObjectPattern(v))},Parser.prototype.parsePattern=function(h,m){var y;return this.match("[")?y=this.parseArrayPattern(h,m):this.match("{")?y=this.parseObjectPattern(h,m):(!this.matchKeyword("let")||"const"!==m&&"let"!==m||this.tolerateUnexpectedToken(this.lookahead,T.Messages.LetInLexicalBinding),h.push(this.lookahead),y=this.parseVariableIdentifier(m)),y},Parser.prototype.parsePatternWithDefault=function(h,m){var y=this.lookahead,v=this.parsePattern(h,m);if(this.match("=")){this.nextToken();var C=this.context.allowYield;this.context.allowYield=!0;var T=this.isolateCoverGrammar(this.parseAssignmentExpression);this.context.allowYield=C,v=this.finalize(this.startNode(y),new w.AssignmentPattern(v,T))}return v},Parser.prototype.parseVariableIdentifier=function(h){var m=this.createNode(),y=this.nextToken();return 4===y.type&&"yield"===y.value?this.context.strict?this.tolerateUnexpectedToken(y,T.Messages.StrictReservedWord):this.context.allowYield||this.throwUnexpectedToken(y):3!==y.type?this.context.strict&&4===y.type&&this.scanner.isStrictModeReservedWord(y.value)?this.tolerateUnexpectedToken(y,T.Messages.StrictReservedWord):(this.context.strict||"let"!==y.value||"var"!==h)&&this.throwUnexpectedToken(y):(this.context.isModule||this.context.await)&&3===y.type&&"await"===y.value&&this.tolerateUnexpectedToken(y),this.finalize(m,new w.Identifier(y.value))},Parser.prototype.parseVariableDeclaration=function(h){var m=this.createNode(),y=this.parsePattern([],"var");this.context.strict&&y.type===P.Syntax.Identifier&&this.scanner.isRestrictedWord(y.name)&&this.tolerateError(T.Messages.StrictVarName);var v=null;return this.match("=")?(this.nextToken(),v=this.isolateCoverGrammar(this.parseAssignmentExpression)):y.type===P.Syntax.Identifier||h.inFor||this.expect("="),this.finalize(m,new w.VariableDeclarator(y,v))},Parser.prototype.parseVariableDeclarationList=function(h){var m={inFor:h.inFor},y=[];for(y.push(this.parseVariableDeclaration(m));this.match(",");)this.nextToken(),y.push(this.parseVariableDeclaration(m));return y},Parser.prototype.parseVariableStatement=function(){var h=this.createNode();this.expectKeyword("var");var m=this.parseVariableDeclarationList({inFor:!1});return this.consumeSemicolon(),this.finalize(h,new w.VariableDeclaration(m,"var"))},Parser.prototype.parseEmptyStatement=function(){var h=this.createNode();return this.expect(";"),this.finalize(h,new w.EmptyStatement)},Parser.prototype.parseExpressionStatement=function(){var h=this.createNode(),m=this.parseExpression();return this.consumeSemicolon(),this.finalize(h,new w.ExpressionStatement(m))},Parser.prototype.parseIfClause=function(){return this.context.strict&&this.matchKeyword("function")&&this.tolerateError(T.Messages.StrictFunction),this.parseStatement()},Parser.prototype.parseIfStatement=function(){var h,m=this.createNode(),y=null;this.expectKeyword("if"),this.expect("(");var v=this.parseExpression();return!this.match(")")&&this.config.tolerant?(this.tolerateUnexpectedToken(this.nextToken()),h=this.finalize(this.createNode(),new w.EmptyStatement)):(this.expect(")"),h=this.parseIfClause(),this.matchKeyword("else")&&(this.nextToken(),y=this.parseIfClause())),this.finalize(m,new w.IfStatement(v,h,y))},Parser.prototype.parseDoWhileStatement=function(){var h=this.createNode();this.expectKeyword("do");var m=this.context.inIteration;this.context.inIteration=!0;var y=this.parseStatement();this.context.inIteration=m,this.expectKeyword("while"),this.expect("(");var v=this.parseExpression();return!this.match(")")&&this.config.tolerant?this.tolerateUnexpectedToken(this.nextToken()):(this.expect(")"),this.match(";")&&this.nextToken()),this.finalize(h,new w.DoWhileStatement(y,v))},Parser.prototype.parseWhileStatement=function(){var h,m=this.createNode();this.expectKeyword("while"),this.expect("(");var y=this.parseExpression();if(!this.match(")")&&this.config.tolerant)this.tolerateUnexpectedToken(this.nextToken()),h=this.finalize(this.createNode(),new w.EmptyStatement);else{this.expect(")");var v=this.context.inIteration;this.context.inIteration=!0,h=this.parseStatement(),this.context.inIteration=v}return this.finalize(m,new w.WhileStatement(y,h))},Parser.prototype.parseForStatement=function(){var h,m,y,v=null,C=null,A=null,k=!0,R=this.createNode();if(this.expectKeyword("for"),this.expect("("),this.match(";"))this.nextToken();else if(this.matchKeyword("var")){v=this.createNode(),this.nextToken();var M=this.context.allowIn;this.context.allowIn=!1;var N=this.parseVariableDeclarationList({inFor:!0});if(this.context.allowIn=M,1===N.length&&this.matchKeyword("in")){var D=N[0];D.init&&(D.id.type===P.Syntax.ArrayPattern||D.id.type===P.Syntax.ObjectPattern||this.context.strict)&&this.tolerateError(T.Messages.ForInOfLoopInitializer,"for-in"),v=this.finalize(v,new w.VariableDeclaration(N,"var")),this.nextToken(),h=v,m=this.parseExpression(),v=null}else 1===N.length&&null===N[0].init&&this.matchContextualKeyword("of")?(v=this.finalize(v,new w.VariableDeclaration(N,"var")),this.nextToken(),h=v,m=this.parseAssignmentExpression(),v=null,k=!1):(v=this.finalize(v,new w.VariableDeclaration(N,"var")),this.expect(";"))}else if(this.matchKeyword("const")||this.matchKeyword("let")){v=this.createNode();var I=this.nextToken().value;if(this.context.strict||"in"!==this.lookahead.value){M=this.context.allowIn;this.context.allowIn=!1;N=this.parseBindingList(I,{inFor:!0});this.context.allowIn=M,1===N.length&&null===N[0].init&&this.matchKeyword("in")?(v=this.finalize(v,new w.VariableDeclaration(N,I)),this.nextToken(),h=v,m=this.parseExpression(),v=null):1===N.length&&null===N[0].init&&this.matchContextualKeyword("of")?(v=this.finalize(v,new w.VariableDeclaration(N,I)),this.nextToken(),h=v,m=this.parseAssignmentExpression(),v=null,k=!1):(this.consumeSemicolon(),v=this.finalize(v,new w.VariableDeclaration(N,I)))}else v=this.finalize(v,new w.Identifier(I)),this.nextToken(),h=v,m=this.parseExpression(),v=null}else{var x=this.lookahead;M=this.context.allowIn;if(this.context.allowIn=!1,v=this.inheritCoverGrammar(this.parseAssignmentExpression),this.context.allowIn=M,this.matchKeyword("in"))this.context.isAssignmentTarget&&v.type!==P.Syntax.AssignmentExpression||this.tolerateError(T.Messages.InvalidLHSInForIn),this.nextToken(),this.reinterpretExpressionAsPattern(v),h=v,m=this.parseExpression(),v=null;else if(this.matchContextualKeyword("of"))this.context.isAssignmentTarget&&v.type!==P.Syntax.AssignmentExpression||this.tolerateError(T.Messages.InvalidLHSInForLoop),this.nextToken(),this.reinterpretExpressionAsPattern(v),h=v,m=this.parseAssignmentExpression(),v=null,k=!1;else{if(this.match(",")){for(var O=[v];this.match(",");)this.nextToken(),O.push(this.isolateCoverGrammar(this.parseAssignmentExpression));v=this.finalize(this.startNode(x),new w.SequenceExpression(O))}this.expect(";")}}if(void 0===h&&(this.match(";")||(C=this.parseExpression()),this.expect(";"),this.match(")")||(A=this.parseExpression())),!this.match(")")&&this.config.tolerant)this.tolerateUnexpectedToken(this.nextToken()),y=this.finalize(this.createNode(),new w.EmptyStatement);else{this.expect(")");var L=this.context.inIteration;this.context.inIteration=!0,y=this.isolateCoverGrammar(this.parseStatement),this.context.inIteration=L}return void 0===h?this.finalize(R,new w.ForStatement(v,C,A,y)):k?this.finalize(R,new w.ForInStatement(h,m,y)):this.finalize(R,new w.ForOfStatement(h,m,y))},Parser.prototype.parseContinueStatement=function(){var h=this.createNode();this.expectKeyword("continue");var m=null;if(3===this.lookahead.type&&!this.hasLineTerminator){var y=this.parseVariableIdentifier();m=y;var v="$"+y.name;Object.prototype.hasOwnProperty.call(this.context.labelSet,v)||this.throwError(T.Messages.UnknownLabel,y.name)}return this.consumeSemicolon(),null!==m||this.context.inIteration||this.throwError(T.Messages.IllegalContinue),this.finalize(h,new w.ContinueStatement(m))},Parser.prototype.parseBreakStatement=function(){var h=this.createNode();this.expectKeyword("break");var m=null;if(3===this.lookahead.type&&!this.hasLineTerminator){var y=this.parseVariableIdentifier(),v="$"+y.name;Object.prototype.hasOwnProperty.call(this.context.labelSet,v)||this.throwError(T.Messages.UnknownLabel,y.name),m=y}return this.consumeSemicolon(),null!==m||this.context.inIteration||this.context.inSwitch||this.throwError(T.Messages.IllegalBreak),this.finalize(h,new w.BreakStatement(m))},Parser.prototype.parseReturnStatement=function(){this.context.inFunctionBody||this.tolerateError(T.Messages.IllegalReturn);var h=this.createNode();this.expectKeyword("return");var m=!this.match(";")&&!this.match("}")&&!this.hasLineTerminator&&2!==this.lookahead.type||8===this.lookahead.type||10===this.lookahead.type?this.parseExpression():null;return this.consumeSemicolon(),this.finalize(h,new w.ReturnStatement(m))},Parser.prototype.parseWithStatement=function(){this.context.strict&&this.tolerateError(T.Messages.StrictModeWith);var h,m=this.createNode();this.expectKeyword("with"),this.expect("(");var y=this.parseExpression();return!this.match(")")&&this.config.tolerant?(this.tolerateUnexpectedToken(this.nextToken()),h=this.finalize(this.createNode(),new w.EmptyStatement)):(this.expect(")"),h=this.parseStatement()),this.finalize(m,new w.WithStatement(y,h))},Parser.prototype.parseSwitchCase=function(){var h,m=this.createNode();this.matchKeyword("default")?(this.nextToken(),h=null):(this.expectKeyword("case"),h=this.parseExpression()),this.expect(":");for(var y=[];!(this.match("}")||this.matchKeyword("default")||this.matchKeyword("case"));)y.push(this.parseStatementListItem());return this.finalize(m,new w.SwitchCase(h,y))},Parser.prototype.parseSwitchStatement=function(){var h=this.createNode();this.expectKeyword("switch"),this.expect("(");var m=this.parseExpression();this.expect(")");var y=this.context.inSwitch;this.context.inSwitch=!0;var v=[],C=!1;for(this.expect("{");!this.match("}");){var A=this.parseSwitchCase();null===A.test&&(C&&this.throwError(T.Messages.MultipleDefaultsInSwitch),C=!0),v.push(A)}return this.expect("}"),this.context.inSwitch=y,this.finalize(h,new w.SwitchStatement(m,v))},Parser.prototype.parseLabelledStatement=function(){var h,m=this.createNode(),y=this.parseExpression();if(y.type===P.Syntax.Identifier&&this.match(":")){this.nextToken();var v=y,C="$"+v.name;Object.prototype.hasOwnProperty.call(this.context.labelSet,C)&&this.throwError(T.Messages.Redeclaration,"Label",v.name),this.context.labelSet[C]=!0;var A=void 0;if(this.matchKeyword("class"))this.tolerateUnexpectedToken(this.lookahead),A=this.parseClassDeclaration();else if(this.matchKeyword("function")){var k=this.lookahead,R=this.parseFunctionDeclaration();this.context.strict?this.tolerateUnexpectedToken(k,T.Messages.StrictFunction):R.generator&&this.tolerateUnexpectedToken(k,T.Messages.GeneratorInLegacyContext),A=R}else A=this.parseStatement();delete this.context.labelSet[C],h=new w.LabeledStatement(v,A)}else this.consumeSemicolon(),h=new w.ExpressionStatement(y);return this.finalize(m,h)},Parser.prototype.parseThrowStatement=function(){var h=this.createNode();this.expectKeyword("throw"),this.hasLineTerminator&&this.throwError(T.Messages.NewlineAfterThrow);var m=this.parseExpression();return this.consumeSemicolon(),this.finalize(h,new w.ThrowStatement(m))},Parser.prototype.parseCatchClause=function(){var h=this.createNode();this.expectKeyword("catch"),this.expect("("),this.match(")")&&this.throwUnexpectedToken(this.lookahead);for(var m=[],y=this.parsePattern(m),v={},C=0;C<m.length;C++){var A="$"+m[C].value;Object.prototype.hasOwnProperty.call(v,A)&&this.tolerateError(T.Messages.DuplicateBinding,m[C].value),v[A]=!0}this.context.strict&&y.type===P.Syntax.Identifier&&this.scanner.isRestrictedWord(y.name)&&this.tolerateError(T.Messages.StrictCatchVariable),this.expect(")");var k=this.parseBlock();return this.finalize(h,new w.CatchClause(y,k))},Parser.prototype.parseFinallyClause=function(){return this.expectKeyword("finally"),this.parseBlock()},Parser.prototype.parseTryStatement=function(){var h=this.createNode();this.expectKeyword("try");var m=this.parseBlock(),y=this.matchKeyword("catch")?this.parseCatchClause():null,v=this.matchKeyword("finally")?this.parseFinallyClause():null;return y||v||this.throwError(T.Messages.NoCatchOrFinally),this.finalize(h,new w.TryStatement(m,y,v))},Parser.prototype.parseDebuggerStatement=function(){var h=this.createNode();return this.expectKeyword("debugger"),this.consumeSemicolon(),this.finalize(h,new w.DebuggerStatement)},Parser.prototype.parseStatement=function(){var h;switch(this.lookahead.type){case 1:case 5:case 6:case 8:case 10:case 9:h=this.parseExpressionStatement();break;case 7:var m=this.lookahead.value;h="{"===m?this.parseBlock():"("===m?this.parseExpressionStatement():";"===m?this.parseEmptyStatement():this.parseExpressionStatement();break;case 3:h=this.matchAsyncFunction()?this.parseFunctionDeclaration():this.parseLabelledStatement();break;case 4:switch(this.lookahead.value){case"break":h=this.parseBreakStatement();break;case"continue":h=this.parseContinueStatement();break;case"debugger":h=this.parseDebuggerStatement();break;case"do":h=this.parseDoWhileStatement();break;case"for":h=this.parseForStatement();break;case"function":h=this.parseFunctionDeclaration();break;case"if":h=this.parseIfStatement();break;case"return":h=this.parseReturnStatement();break;case"switch":h=this.parseSwitchStatement();break;case"throw":h=this.parseThrowStatement();break;case"try":h=this.parseTryStatement();break;case"var":h=this.parseVariableStatement();break;case"while":h=this.parseWhileStatement();break;case"with":h=this.parseWithStatement();break;default:h=this.parseExpressionStatement()}break;default:h=this.throwUnexpectedToken(this.lookahead)}return h},Parser.prototype.parseFunctionSourceElements=function(){var h=this.createNode();this.expect("{");var m=this.parseDirectivePrologues(),y=this.context.labelSet,v=this.context.inIteration,C=this.context.inSwitch,T=this.context.inFunctionBody;for(this.context.labelSet={},this.context.inIteration=!1,this.context.inSwitch=!1,this.context.inFunctionBody=!0;2!==this.lookahead.type&&!this.match("}");)m.push(this.parseStatementListItem());return this.expect("}"),this.context.labelSet=y,this.context.inIteration=v,this.context.inSwitch=C,this.context.inFunctionBody=T,this.finalize(h,new w.BlockStatement(m))},Parser.prototype.validateParam=function(h,m,y){var v="$"+y;this.context.strict?(this.scanner.isRestrictedWord(y)&&(h.stricted=m,h.message=T.Messages.StrictParamName),Object.prototype.hasOwnProperty.call(h.paramSet,v)&&(h.stricted=m,h.message=T.Messages.StrictParamDupe)):h.firstRestricted||(this.scanner.isRestrictedWord(y)?(h.firstRestricted=m,h.message=T.Messages.StrictParamName):this.scanner.isStrictModeReservedWord(y)?(h.firstRestricted=m,h.message=T.Messages.StrictReservedWord):Object.prototype.hasOwnProperty.call(h.paramSet,v)&&(h.stricted=m,h.message=T.Messages.StrictParamDupe)),"function"==typeof Object.defineProperty?Object.defineProperty(h.paramSet,v,{value:!0,enumerable:!0,writable:!0,configurable:!0}):h.paramSet[v]=!0},Parser.prototype.parseRestElement=function(h){var m=this.createNode();this.expect("...");var y=this.parsePattern(h);return this.match("=")&&this.throwError(T.Messages.DefaultRestParameter),this.match(")")||this.throwError(T.Messages.ParameterAfterRestParameter),this.finalize(m,new w.RestElement(y))},Parser.prototype.parseFormalParameter=function(h){for(var m=[],y=this.match("...")?this.parseRestElement(m):this.parsePatternWithDefault(m),v=0;v<m.length;v++)this.validateParam(h,m[v],m[v].value);h.simple=h.simple&&y instanceof w.Identifier,h.params.push(y)},Parser.prototype.parseFormalParameters=function(h){var m;if(m={simple:!0,params:[],firstRestricted:h},this.expect("("),!this.match(")"))for(m.paramSet={};2!==this.lookahead.type&&(this.parseFormalParameter(m),!this.match(")"))&&(this.expect(","),!this.match(")")););return this.expect(")"),{simple:m.simple,params:m.params,stricted:m.stricted,firstRestricted:m.firstRestricted,message:m.message}},Parser.prototype.matchAsyncFunction=function(){var h=this.matchContextualKeyword("async");if(h){var m=this.scanner.saveState();this.scanner.scanComments();var y=this.scanner.lex();this.scanner.restoreState(m),h=m.lineNumber===y.lineNumber&&4===y.type&&"function"===y.value}return h},Parser.prototype.parseFunctionDeclaration=function(h){var m=this.createNode(),y=this.matchContextualKeyword("async");y&&this.nextToken(),this.expectKeyword("function");var v,C=!y&&this.match("*");C&&this.nextToken();var A=null,P=null;if(!h||!this.match("(")){var k=this.lookahead;A=this.parseVariableIdentifier(),this.context.strict?this.scanner.isRestrictedWord(k.value)&&this.tolerateUnexpectedToken(k,T.Messages.StrictFunctionName):this.scanner.isRestrictedWord(k.value)?(P=k,v=T.Messages.StrictFunctionName):this.scanner.isStrictModeReservedWord(k.value)&&(P=k,v=T.Messages.StrictReservedWord)}var R=this.context.await,M=this.context.allowYield;this.context.await=y,this.context.allowYield=!C;var N=this.parseFormalParameters(P),D=N.params,I=N.stricted;P=N.firstRestricted,N.message&&(v=N.message);var x=this.context.strict,O=this.context.allowStrictDirective;this.context.allowStrictDirective=N.simple;var L=this.parseFunctionSourceElements();return this.context.strict&&P&&this.throwUnexpectedToken(P,v),this.context.strict&&I&&this.tolerateUnexpectedToken(I,v),this.context.strict=x,this.context.allowStrictDirective=O,this.context.await=R,this.context.allowYield=M,y?this.finalize(m,new w.AsyncFunctionDeclaration(A,D,L)):this.finalize(m,new w.FunctionDeclaration(A,D,L,C))},Parser.prototype.parseFunctionExpression=function(){var h=this.createNode(),m=this.matchContextualKeyword("async");m&&this.nextToken(),this.expectKeyword("function");var y,v=!m&&this.match("*");v&&this.nextToken();var C,A=null,P=this.context.await,k=this.context.allowYield;if(this.context.await=m,this.context.allowYield=!v,!this.match("(")){var R=this.lookahead;A=this.context.strict||v||!this.matchKeyword("yield")?this.parseVariableIdentifier():this.parseIdentifierName(),this.context.strict?this.scanner.isRestrictedWord(R.value)&&this.tolerateUnexpectedToken(R,T.Messages.StrictFunctionName):this.scanner.isRestrictedWord(R.value)?(C=R,y=T.Messages.StrictFunctionName):this.scanner.isStrictModeReservedWord(R.value)&&(C=R,y=T.Messages.StrictReservedWord)}var M=this.parseFormalParameters(C),N=M.params,D=M.stricted;C=M.firstRestricted,M.message&&(y=M.message);var I=this.context.strict,x=this.context.allowStrictDirective;this.context.allowStrictDirective=M.simple;var O=this.parseFunctionSourceElements();return this.context.strict&&C&&this.throwUnexpectedToken(C,y),this.context.strict&&D&&this.tolerateUnexpectedToken(D,y),this.context.strict=I,this.context.allowStrictDirective=x,this.context.await=P,this.context.allowYield=k,m?this.finalize(h,new w.AsyncFunctionExpression(A,N,O)):this.finalize(h,new w.FunctionExpression(A,N,O,v))},Parser.prototype.parseDirective=function(){var h=this.lookahead,m=this.createNode(),y=this.parseExpression(),v=y.type===P.Syntax.Literal?this.getTokenRaw(h).slice(1,-1):null;return this.consumeSemicolon(),this.finalize(m,v?new w.Directive(y,v):new w.ExpressionStatement(y))},Parser.prototype.parseDirectivePrologues=function(){for(var h=null,m=[];;){var y=this.lookahead;if(8!==y.type)break;var v=this.parseDirective();m.push(v);var C=v.directive;if("string"!=typeof C)break;"use strict"===C?(this.context.strict=!0,h&&this.tolerateUnexpectedToken(h,T.Messages.StrictOctalLiteral),this.context.allowStrictDirective||this.tolerateUnexpectedToken(y,T.Messages.IllegalLanguageModeDirective)):!h&&y.octal&&(h=y)}return m},Parser.prototype.qualifiedPropertyName=function(h){switch(h.type){case 3:case 8:case 1:case 5:case 6:case 4:return!0;case 7:return"["===h.value}return!1},Parser.prototype.parseGetterMethod=function(){var h=this.createNode(),m=this.context.allowYield;this.context.allowYield=!0;var y=this.parseFormalParameters();y.params.length>0&&this.tolerateError(T.Messages.BadGetterArity);var v=this.parsePropertyMethod(y);return this.context.allowYield=m,this.finalize(h,new w.FunctionExpression(null,y.params,v,!1))},Parser.prototype.parseSetterMethod=function(){var h=this.createNode(),m=this.context.allowYield;this.context.allowYield=!0;var y=this.parseFormalParameters();1!==y.params.length?this.tolerateError(T.Messages.BadSetterArity):y.params[0]instanceof w.RestElement&&this.tolerateError(T.Messages.BadSetterRestParameter);var v=this.parsePropertyMethod(y);return this.context.allowYield=m,this.finalize(h,new w.FunctionExpression(null,y.params,v,!1))},Parser.prototype.parseGeneratorMethod=function(){var h=this.createNode(),m=this.context.allowYield;this.context.allowYield=!0;var y=this.parseFormalParameters();this.context.allowYield=!1;var v=this.parsePropertyMethod(y);return this.context.allowYield=m,this.finalize(h,new w.FunctionExpression(null,y.params,v,!0))},Parser.prototype.isStartOfExpression=function(){var h=!0,m=this.lookahead.value;switch(this.lookahead.type){case 7:h="["===m||"("===m||"{"===m||"+"===m||"-"===m||"!"===m||"~"===m||"++"===m||"--"===m||"/"===m||"/="===m;break;case 4:h="class"===m||"delete"===m||"function"===m||"let"===m||"new"===m||"super"===m||"this"===m||"typeof"===m||"void"===m||"yield"===m}return h},Parser.prototype.parseYieldExpression=function(){var h=this.createNode();this.expectKeyword("yield");var m=null,y=!1;if(!this.hasLineTerminator){var v=this.context.allowYield;this.context.allowYield=!1,(y=this.match("*"))?(this.nextToken(),m=this.parseAssignmentExpression()):this.isStartOfExpression()&&(m=this.parseAssignmentExpression()),this.context.allowYield=v}return this.finalize(h,new w.YieldExpression(m,y))},Parser.prototype.parseClassElement=function(h){var m=this.lookahead,y=this.createNode(),v="",C=null,A=null,P=!1,k=!1,R=!1,M=!1;if(this.match("*"))this.nextToken();else if(P=this.match("["),"static"===(C=this.parseObjectPropertyKey()).name&&(this.qualifiedPropertyName(this.lookahead)||this.match("*"))&&(m=this.lookahead,R=!0,P=this.match("["),this.match("*")?this.nextToken():C=this.parseObjectPropertyKey()),3===m.type&&!this.hasLineTerminator&&"async"===m.value){var N=this.lookahead.value;":"!==N&&"("!==N&&"*"!==N&&(M=!0,m=this.lookahead,C=this.parseObjectPropertyKey(),3===m.type&&"constructor"===m.value&&this.tolerateUnexpectedToken(m,T.Messages.ConstructorIsAsync))}var D=this.qualifiedPropertyName(this.lookahead);return 3===m.type?"get"===m.value&&D?(v="get",P=this.match("["),C=this.parseObjectPropertyKey(),this.context.allowYield=!1,A=this.parseGetterMethod()):"set"===m.value&&D&&(v="set",P=this.match("["),C=this.parseObjectPropertyKey(),A=this.parseSetterMethod()):7===m.type&&"*"===m.value&&D&&(v="init",P=this.match("["),C=this.parseObjectPropertyKey(),A=this.parseGeneratorMethod(),k=!0),!v&&C&&this.match("(")&&(v="init",A=M?this.parsePropertyMethodAsyncFunction():this.parsePropertyMethodFunction(),k=!0),v||this.throwUnexpectedToken(this.lookahead),"init"===v&&(v="method"),P||(R&&this.isPropertyKey(C,"prototype")&&this.throwUnexpectedToken(m,T.Messages.StaticPrototype),!R&&this.isPropertyKey(C,"constructor")&&(("method"!==v||!k||A&&A.generator)&&this.throwUnexpectedToken(m,T.Messages.ConstructorSpecialMethod),h.value?this.throwUnexpectedToken(m,T.Messages.DuplicateConstructor):h.value=!0,v="constructor")),this.finalize(y,new w.MethodDefinition(C,P,A,v,R))},Parser.prototype.parseClassElementList=function(){var h=[],m={value:!1};for(this.expect("{");!this.match("}");)this.match(";")?this.nextToken():h.push(this.parseClassElement(m));return this.expect("}"),h},Parser.prototype.parseClassBody=function(){var h=this.createNode(),m=this.parseClassElementList();return this.finalize(h,new w.ClassBody(m))},Parser.prototype.parseClassDeclaration=function(h){var m=this.createNode(),y=this.context.strict;this.context.strict=!0,this.expectKeyword("class");var v=h&&3!==this.lookahead.type?null:this.parseVariableIdentifier(),C=null;this.matchKeyword("extends")&&(this.nextToken(),C=this.isolateCoverGrammar(this.parseLeftHandSideExpressionAllowCall));var T=this.parseClassBody();return this.context.strict=y,this.finalize(m,new w.ClassDeclaration(v,C,T))},Parser.prototype.parseClassExpression=function(){var h=this.createNode(),m=this.context.strict;this.context.strict=!0,this.expectKeyword("class");var y=3===this.lookahead.type?this.parseVariableIdentifier():null,v=null;this.matchKeyword("extends")&&(this.nextToken(),v=this.isolateCoverGrammar(this.parseLeftHandSideExpressionAllowCall));var C=this.parseClassBody();return this.context.strict=m,this.finalize(h,new w.ClassExpression(y,v,C))},Parser.prototype.parseModule=function(){this.context.strict=!0,this.context.isModule=!0,this.scanner.isModule=!0;for(var h=this.createNode(),m=this.parseDirectivePrologues();2!==this.lookahead.type;)m.push(this.parseStatementListItem());return this.finalize(h,new w.Module(m))},Parser.prototype.parseScript=function(){for(var h=this.createNode(),m=this.parseDirectivePrologues();2!==this.lookahead.type;)m.push(this.parseStatementListItem());return this.finalize(h,new w.Script(m))},Parser.prototype.parseModuleSpecifier=function(){var h=this.createNode();8!==this.lookahead.type&&this.throwError(T.Messages.InvalidModuleSpecifier);var m=this.nextToken(),y=this.getTokenRaw(m);return this.finalize(h,new w.Literal(m.value,y))},Parser.prototype.parseImportSpecifier=function(){var h,m,y=this.createNode();return 3===this.lookahead.type?(m=h=this.parseVariableIdentifier(),this.matchContextualKeyword("as")&&(this.nextToken(),m=this.parseVariableIdentifier())):(m=h=this.parseIdentifierName(),this.matchContextualKeyword("as")?(this.nextToken(),m=this.parseVariableIdentifier()):this.throwUnexpectedToken(this.nextToken())),this.finalize(y,new w.ImportSpecifier(m,h))},Parser.prototype.parseNamedImports=function(){this.expect("{");for(var h=[];!this.match("}");)h.push(this.parseImportSpecifier()),this.match("}")||this.expect(",");return this.expect("}"),h},Parser.prototype.parseImportDefaultSpecifier=function(){var h=this.createNode(),m=this.parseIdentifierName();return this.finalize(h,new w.ImportDefaultSpecifier(m))},Parser.prototype.parseImportNamespaceSpecifier=function(){var h=this.createNode();this.expect("*"),this.matchContextualKeyword("as")||this.throwError(T.Messages.NoAsAfterImportNamespace),this.nextToken();var m=this.parseIdentifierName();return this.finalize(h,new w.ImportNamespaceSpecifier(m))},Parser.prototype.parseImportDeclaration=function(){this.context.inFunctionBody&&this.throwError(T.Messages.IllegalImportDeclaration);var h,m=this.createNode();this.expectKeyword("import");var y=[];if(8===this.lookahead.type)h=this.parseModuleSpecifier();else{if(this.match("{")?y=y.concat(this.parseNamedImports()):this.match("*")?y.push(this.parseImportNamespaceSpecifier()):this.isIdentifierName(this.lookahead)&&!this.matchKeyword("default")?(y.push(this.parseImportDefaultSpecifier()),this.match(",")&&(this.nextToken(),this.match("*")?y.push(this.parseImportNamespaceSpecifier()):this.match("{")?y=y.concat(this.parseNamedImports()):this.throwUnexpectedToken(this.lookahead))):this.throwUnexpectedToken(this.nextToken()),!this.matchContextualKeyword("from")){var v=this.lookahead.value?T.Messages.UnexpectedToken:T.Messages.MissingFromClause;this.throwError(v,this.lookahead.value)}this.nextToken(),h=this.parseModuleSpecifier()}return this.consumeSemicolon(),this.finalize(m,new w.ImportDeclaration(y,h))},Parser.prototype.parseExportSpecifier=function(){var h=this.createNode(),m=this.parseIdentifierName(),y=m;return this.matchContextualKeyword("as")&&(this.nextToken(),y=this.parseIdentifierName()),this.finalize(h,new w.ExportSpecifier(m,y))},Parser.prototype.parseExportDeclaration=function(){this.context.inFunctionBody&&this.throwError(T.Messages.IllegalExportDeclaration);var h,m=this.createNode();if(this.expectKeyword("export"),this.matchKeyword("default"))if(this.nextToken(),this.matchKeyword("function")){var y=this.parseFunctionDeclaration(!0);h=this.finalize(m,new w.ExportDefaultDeclaration(y))}else if(this.matchKeyword("class")){y=this.parseClassDeclaration(!0);h=this.finalize(m,new w.ExportDefaultDeclaration(y))}else if(this.matchContextualKeyword("async")){y=this.matchAsyncFunction()?this.parseFunctionDeclaration(!0):this.parseAssignmentExpression();h=this.finalize(m,new w.ExportDefaultDeclaration(y))}else{this.matchContextualKeyword("from")&&this.throwError(T.Messages.UnexpectedToken,this.lookahead.value);y=this.match("{")?this.parseObjectInitializer():this.match("[")?this.parseArrayInitializer():this.parseAssignmentExpression();this.consumeSemicolon(),h=this.finalize(m,new w.ExportDefaultDeclaration(y))}else if(this.match("*")){if(this.nextToken(),!this.matchContextualKeyword("from")){var v=this.lookahead.value?T.Messages.UnexpectedToken:T.Messages.MissingFromClause;this.throwError(v,this.lookahead.value)}this.nextToken();var C=this.parseModuleSpecifier();this.consumeSemicolon(),h=this.finalize(m,new w.ExportAllDeclaration(C))}else if(4===this.lookahead.type){y=void 0;switch(this.lookahead.value){case"let":case"const":y=this.parseLexicalDeclaration({inFor:!1});break;case"var":case"class":case"function":y=this.parseStatementListItem();break;default:this.throwUnexpectedToken(this.lookahead)}h=this.finalize(m,new w.ExportNamedDeclaration(y,[],null))}else if(this.matchAsyncFunction()){y=this.parseFunctionDeclaration();h=this.finalize(m,new w.ExportNamedDeclaration(y,[],null))}else{var A=[],P=null,k=!1;for(this.expect("{");!this.match("}");)k=k||this.matchKeyword("default"),A.push(this.parseExportSpecifier()),this.match("}")||this.expect(",");if(this.expect("}"),this.matchContextualKeyword("from"))this.nextToken(),P=this.parseModuleSpecifier(),this.consumeSemicolon();else if(k){v=this.lookahead.value?T.Messages.UnexpectedToken:T.Messages.MissingFromClause;this.throwError(v,this.lookahead.value)}else this.consumeSemicolon();h=this.finalize(m,new w.ExportNamedDeclaration(null,A,P))}return h},Parser}();m.Parser=R},function(h,m){"use strict";Object.defineProperty(m,"__esModule",{value:!0}),m.assert=function assert(h,m){if(!h)throw new Error("ASSERT: "+m)}},function(h,m){"use strict";Object.defineProperty(m,"__esModule",{value:!0});var y=function(){function ErrorHandler(){this.errors=[],this.tolerant=!1}return ErrorHandler.prototype.recordError=function(h){this.errors.push(h)},ErrorHandler.prototype.tolerate=function(h){if(!this.tolerant)throw h;this.recordError(h)},ErrorHandler.prototype.constructError=function(h,m){var y=new Error(h);try{throw y}catch(h){Object.create&&Object.defineProperty&&(y=Object.create(h),Object.defineProperty(y,"column",{value:m}))}return y},ErrorHandler.prototype.createError=function(h,m,y,v){var C="Line "+m+": "+v,T=this.constructError(C,y);return T.index=h,T.lineNumber=m,T.description=v,T},ErrorHandler.prototype.throwError=function(h,m,y,v){throw this.createError(h,m,y,v)},ErrorHandler.prototype.tolerateError=function(h,m,y,v){var C=this.createError(h,m,y,v);if(!this.tolerant)throw C;this.recordError(C)},ErrorHandler}();m.ErrorHandler=y},function(h,m){"use strict";Object.defineProperty(m,"__esModule",{value:!0}),m.Messages={BadGetterArity:"Getter must not have any formal parameters",BadSetterArity:"Setter must have exactly one formal parameter",BadSetterRestParameter:"Setter function argument must not be a rest parameter",ConstructorIsAsync:"Class constructor may not be an async method",ConstructorSpecialMethod:"Class constructor may not be an accessor",DeclarationMissingInitializer:"Missing initializer in %0 declaration",DefaultRestParameter:"Unexpected token =",DuplicateBinding:"Duplicate binding %0",DuplicateConstructor:"A class may only have one constructor",DuplicateProtoProperty:"Duplicate __proto__ fields are not allowed in object literals",ForInOfLoopInitializer:"%0 loop variable declaration may not have an initializer",GeneratorInLegacyContext:"Generator declarations are not allowed in legacy contexts",IllegalBreak:"Illegal break statement",IllegalContinue:"Illegal continue statement",IllegalExportDeclaration:"Unexpected token",IllegalImportDeclaration:"Unexpected token",IllegalLanguageModeDirective:"Illegal 'use strict' directive in function with non-simple parameter list",IllegalReturn:"Illegal return statement",InvalidEscapedReservedWord:"Keyword must not contain escaped characters",InvalidHexEscapeSequence:"Invalid hexadecimal escape sequence",InvalidLHSInAssignment:"Invalid left-hand side in assignment",InvalidLHSInForIn:"Invalid left-hand side in for-in",InvalidLHSInForLoop:"Invalid left-hand side in for-loop",InvalidModuleSpecifier:"Unexpected token",InvalidRegExp:"Invalid regular expression",LetInLexicalBinding:"let is disallowed as a lexically bound name",MissingFromClause:"Unexpected token",MultipleDefaultsInSwitch:"More than one default clause in switch statement",NewlineAfterThrow:"Illegal newline after throw",NoAsAfterImportNamespace:"Unexpected token",NoCatchOrFinally:"Missing catch or finally after try",ParameterAfterRestParameter:"Rest parameter must be last formal parameter",Redeclaration:"%0 '%1' has already been declared",StaticPrototype:"Classes may not have static property named prototype",StrictCatchVariable:"Catch variable may not be eval or arguments in strict mode",StrictDelete:"Delete of an unqualified identifier in strict mode.",StrictFunction:"In strict mode code, functions can only be declared at top level or inside a block",StrictFunctionName:"Function name may not be eval or arguments in strict mode",StrictLHSAssignment:"Assignment to eval or arguments is not allowed in strict mode",StrictLHSPostfix:"Postfix increment/decrement may not have eval or arguments operand in strict mode",StrictLHSPrefix:"Prefix increment/decrement may not have eval or arguments operand in strict mode",StrictModeWith:"Strict mode code may not include a with statement",StrictOctalLiteral:"Octal literals are not allowed in strict mode.",StrictParamDupe:"Strict mode function may not have duplicate parameter names",StrictParamName:"Parameter name eval or arguments is not allowed in strict mode",StrictReservedWord:"Use of future reserved word in strict mode",StrictVarName:"Variable name may not be eval or arguments in strict mode",TemplateOctalLiteral:"Octal literals are not allowed in template strings.",UnexpectedEOS:"Unexpected end of input",UnexpectedIdentifier:"Unexpected identifier",UnexpectedNumber:"Unexpected number",UnexpectedReserved:"Unexpected reserved word",UnexpectedString:"Unexpected string",UnexpectedTemplate:"Unexpected quasi %0",UnexpectedToken:"Unexpected token %0",UnexpectedTokenIllegal:"Unexpected token ILLEGAL",UnknownLabel:"Undefined label '%0'",UnterminatedRegExp:"Invalid regular expression: missing /"}},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0});var v=y(9),C=y(4),T=y(11);function hexValue(h){return"0123456789abcdef".indexOf(h.toLowerCase())}function octalValue(h){return"01234567".indexOf(h)}var w=function(){function Scanner(h,m){this.source=h,this.errorHandler=m,this.trackComment=!1,this.isModule=!1,this.length=h.length,this.index=0,this.lineNumber=h.length>0?1:0,this.lineStart=0,this.curlyStack=[]}return Scanner.prototype.saveState=function(){return{index:this.index,lineNumber:this.lineNumber,lineStart:this.lineStart}},Scanner.prototype.restoreState=function(h){this.index=h.index,this.lineNumber=h.lineNumber,this.lineStart=h.lineStart},Scanner.prototype.eof=function(){return this.index>=this.length},Scanner.prototype.throwUnexpectedToken=function(h){return void 0===h&&(h=T.Messages.UnexpectedTokenIllegal),this.errorHandler.throwError(this.index,this.lineNumber,this.index-this.lineStart+1,h)},Scanner.prototype.tolerateUnexpectedToken=function(h){void 0===h&&(h=T.Messages.UnexpectedTokenIllegal),this.errorHandler.tolerateError(this.index,this.lineNumber,this.index-this.lineStart+1,h)},Scanner.prototype.skipSingleLineComment=function(h){var m,y,v=[];for(this.trackComment&&(v=[],m=this.index-h,y={start:{line:this.lineNumber,column:this.index-this.lineStart-h},end:{}});!this.eof();){var T=this.source.charCodeAt(this.index);if(++this.index,C.Character.isLineTerminator(T)){if(this.trackComment){y.end={line:this.lineNumber,column:this.index-this.lineStart-1};var w={multiLine:!1,slice:[m+h,this.index-1],range:[m,this.index-1],loc:y};v.push(w)}return 13===T&&10===this.source.charCodeAt(this.index)&&++this.index,++this.lineNumber,this.lineStart=this.index,v}}if(this.trackComment){y.end={line:this.lineNumber,column:this.index-this.lineStart};w={multiLine:!1,slice:[m+h,this.index],range:[m,this.index],loc:y};v.push(w)}return v},Scanner.prototype.skipMultiLineComment=function(){var h,m,y=[];for(this.trackComment&&(y=[],h=this.index-2,m={start:{line:this.lineNumber,column:this.index-this.lineStart-2},end:{}});!this.eof();){var v=this.source.charCodeAt(this.index);if(C.Character.isLineTerminator(v))13===v&&10===this.source.charCodeAt(this.index+1)&&++this.index,++this.lineNumber,++this.index,this.lineStart=this.index;else if(42===v){if(47===this.source.charCodeAt(this.index+1)){if(this.index+=2,this.trackComment){m.end={line:this.lineNumber,column:this.index-this.lineStart};var T={multiLine:!0,slice:[h+2,this.index-2],range:[h,this.index],loc:m};y.push(T)}return y}++this.index}else++this.index}if(this.trackComment){m.end={line:this.lineNumber,column:this.index-this.lineStart};T={multiLine:!0,slice:[h+2,this.index],range:[h,this.index],loc:m};y.push(T)}return this.tolerateUnexpectedToken(),y},Scanner.prototype.scanComments=function(){var h;this.trackComment&&(h=[]);for(var m=0===this.index;!this.eof();){var y=this.source.charCodeAt(this.index);if(C.Character.isWhiteSpace(y))++this.index;else if(C.Character.isLineTerminator(y))++this.index,13===y&&10===this.source.charCodeAt(this.index)&&++this.index,++this.lineNumber,this.lineStart=this.index,m=!0;else if(47===y)if(47===(y=this.source.charCodeAt(this.index+1))){this.index+=2;var v=this.skipSingleLineComment(2);this.trackComment&&(h=h.concat(v)),m=!0}else{if(42!==y)break;this.index+=2;v=this.skipMultiLineComment();this.trackComment&&(h=h.concat(v))}else if(m&&45===y){if(45!==this.source.charCodeAt(this.index+1)||62!==this.source.charCodeAt(this.index+2))break;this.index+=3;v=this.skipSingleLineComment(3);this.trackComment&&(h=h.concat(v))}else{if(60!==y||this.isModule)break;if("!--"!==this.source.slice(this.index+1,this.index+4))break;this.index+=4;v=this.skipSingleLineComment(4);this.trackComment&&(h=h.concat(v))}}return h},Scanner.prototype.isFutureReservedWord=function(h){switch(h){case"enum":case"export":case"import":case"super":return!0;default:return!1}},Scanner.prototype.isStrictModeReservedWord=function(h){switch(h){case"implements":case"interface":case"package":case"private":case"protected":case"public":case"static":case"yield":case"let":return!0;default:return!1}},Scanner.prototype.isRestrictedWord=function(h){return"eval"===h||"arguments"===h},Scanner.prototype.isKeyword=function(h){switch(h.length){case 2:return"if"===h||"in"===h||"do"===h;case 3:return"var"===h||"for"===h||"new"===h||"try"===h||"let"===h;case 4:return"this"===h||"else"===h||"case"===h||"void"===h||"with"===h||"enum"===h;case 5:return"while"===h||"break"===h||"catch"===h||"throw"===h||"const"===h||"yield"===h||"class"===h||"super"===h;case 6:return"return"===h||"typeof"===h||"delete"===h||"switch"===h||"export"===h||"import"===h;case 7:return"default"===h||"finally"===h||"extends"===h;case 8:return"function"===h||"continue"===h||"debugger"===h;case 10:return"instanceof"===h;default:return!1}},Scanner.prototype.codePointAt=function(h){var m=this.source.charCodeAt(h);if(m>=55296&&m<=56319){var y=this.source.charCodeAt(h+1);if(y>=56320&&y<=57343)m=1024*(m-55296)+y-56320+65536}return m},Scanner.prototype.scanHexEscape=function(h){for(var m="u"===h?4:2,y=0,v=0;v<m;++v){if(this.eof()||!C.Character.isHexDigit(this.source.charCodeAt(this.index)))return null;y=16*y+hexValue(this.source[this.index++])}return String.fromCharCode(y)},Scanner.prototype.scanUnicodeCodePointEscape=function(){var h=this.source[this.index],m=0;for("}"===h&&this.throwUnexpectedToken();!this.eof()&&(h=this.source[this.index++],C.Character.isHexDigit(h.charCodeAt(0)));)m=16*m+hexValue(h);return(m>1114111||"}"!==h)&&this.throwUnexpectedToken(),C.Character.fromCodePoint(m)},Scanner.prototype.getIdentifier=function(){for(var h=this.index++;!this.eof();){var m=this.source.charCodeAt(this.index);if(92===m)return this.index=h,this.getComplexIdentifier();if(m>=55296&&m<57343)return this.index=h,this.getComplexIdentifier();if(!C.Character.isIdentifierPart(m))break;++this.index}return this.source.slice(h,this.index)},Scanner.prototype.getComplexIdentifier=function(){var h,m=this.codePointAt(this.index),y=C.Character.fromCodePoint(m);for(this.index+=y.length,92===m&&(117!==this.source.charCodeAt(this.index)&&this.throwUnexpectedToken(),++this.index,"{"===this.source[this.index]?(++this.index,h=this.scanUnicodeCodePointEscape()):null!==(h=this.scanHexEscape("u"))&&"\\"!==h&&C.Character.isIdentifierStart(h.charCodeAt(0))||this.throwUnexpectedToken(),y=h);!this.eof()&&(m=this.codePointAt(this.index),C.Character.isIdentifierPart(m));)y+=h=C.Character.fromCodePoint(m),this.index+=h.length,92===m&&(y=y.substr(0,y.length-1),117!==this.source.charCodeAt(this.index)&&this.throwUnexpectedToken(),++this.index,"{"===this.source[this.index]?(++this.index,h=this.scanUnicodeCodePointEscape()):null!==(h=this.scanHexEscape("u"))&&"\\"!==h&&C.Character.isIdentifierPart(h.charCodeAt(0))||this.throwUnexpectedToken(),y+=h);return y},Scanner.prototype.octalToDecimal=function(h){var m="0"!==h,y=octalValue(h);return!this.eof()&&C.Character.isOctalDigit(this.source.charCodeAt(this.index))&&(m=!0,y=8*y+octalValue(this.source[this.index++]),"0123".indexOf(h)>=0&&!this.eof()&&C.Character.isOctalDigit(this.source.charCodeAt(this.index))&&(y=8*y+octalValue(this.source[this.index++]))),{code:y,octal:m}},Scanner.prototype.scanIdentifier=function(){var h,m=this.index,y=92===this.source.charCodeAt(m)?this.getComplexIdentifier():this.getIdentifier();if(3!==(h=1===y.length?3:this.isKeyword(y)?4:"null"===y?5:"true"===y||"false"===y?1:3)&&m+y.length!==this.index){var v=this.index;this.index=m,this.tolerateUnexpectedToken(T.Messages.InvalidEscapedReservedWord),this.index=v}return{type:h,value:y,lineNumber:this.lineNumber,lineStart:this.lineStart,start:m,end:this.index}},Scanner.prototype.scanPunctuator=function(){var h=this.index,m=this.source[this.index];switch(m){case"(":case"{":"{"===m&&this.curlyStack.push("{"),++this.index;break;case".":++this.index,"."===this.source[this.index]&&"."===this.source[this.index+1]&&(this.index+=2,m="...");break;case"}":++this.index,this.curlyStack.pop();break;case")":case";":case",":case"[":case"]":case":":case"?":case"~":++this.index;break;default:">>>="===(m=this.source.substr(this.index,4))?this.index+=4:"==="===(m=m.substr(0,3))||"!=="===m||">>>"===m||"<<="===m||">>="===m||"**="===m?this.index+=3:"&&"===(m=m.substr(0,2))||"||"===m||"=="===m||"!="===m||"+="===m||"-="===m||"*="===m||"/="===m||"++"===m||"--"===m||"<<"===m||">>"===m||"&="===m||"|="===m||"^="===m||"%="===m||"<="===m||">="===m||"=>"===m||"**"===m?this.index+=2:(m=this.source[this.index],"<>=!+-*%&|^/".indexOf(m)>=0&&++this.index)}return this.index===h&&this.throwUnexpectedToken(),{type:7,value:m,lineNumber:this.lineNumber,lineStart:this.lineStart,start:h,end:this.index}},Scanner.prototype.scanHexLiteral=function(h){for(var m="";!this.eof()&&C.Character.isHexDigit(this.source.charCodeAt(this.index));)m+=this.source[this.index++];return 0===m.length&&this.throwUnexpectedToken(),C.Character.isIdentifierStart(this.source.charCodeAt(this.index))&&this.throwUnexpectedToken(),{type:6,value:parseInt("0x"+m,16),lineNumber:this.lineNumber,lineStart:this.lineStart,start:h,end:this.index}},Scanner.prototype.scanBinaryLiteral=function(h){for(var m,y="";!this.eof()&&("0"===(m=this.source[this.index])||"1"===m);)y+=this.source[this.index++];return 0===y.length&&this.throwUnexpectedToken(),this.eof()||(m=this.source.charCodeAt(this.index),(C.Character.isIdentifierStart(m)||C.Character.isDecimalDigit(m))&&this.throwUnexpectedToken()),{type:6,value:parseInt(y,2),lineNumber:this.lineNumber,lineStart:this.lineStart,start:h,end:this.index}},Scanner.prototype.scanOctalLiteral=function(h,m){var y="",v=!1;for(C.Character.isOctalDigit(h.charCodeAt(0))?(v=!0,y="0"+this.source[this.index++]):++this.index;!this.eof()&&C.Character.isOctalDigit(this.source.charCodeAt(this.index));)y+=this.source[this.index++];return v||0!==y.length||this.throwUnexpectedToken(),(C.Character.isIdentifierStart(this.source.charCodeAt(this.index))||C.Character.isDecimalDigit(this.source.charCodeAt(this.index)))&&this.throwUnexpectedToken(),{type:6,value:parseInt(y,8),octal:v,lineNumber:this.lineNumber,lineStart:this.lineStart,start:m,end:this.index}},Scanner.prototype.isImplicitOctalLiteral=function(){for(var h=this.index+1;h<this.length;++h){var m=this.source[h];if("8"===m||"9"===m)return!1;if(!C.Character.isOctalDigit(m.charCodeAt(0)))return!0}return!0},Scanner.prototype.scanNumericLiteral=function(){var h=this.index,m=this.source[h];v.assert(C.Character.isDecimalDigit(m.charCodeAt(0))||"."===m,"Numeric literal must start with a decimal digit or a decimal point");var y="";if("."!==m){if(y=this.source[this.index++],m=this.source[this.index],"0"===y){if("x"===m||"X"===m)return++this.index,this.scanHexLiteral(h);if("b"===m||"B"===m)return++this.index,this.scanBinaryLiteral(h);if("o"===m||"O"===m)return this.scanOctalLiteral(m,h);if(m&&C.Character.isOctalDigit(m.charCodeAt(0))&&this.isImplicitOctalLiteral())return this.scanOctalLiteral(m,h)}for(;C.Character.isDecimalDigit(this.source.charCodeAt(this.index));)y+=this.source[this.index++];m=this.source[this.index]}if("."===m){for(y+=this.source[this.index++];C.Character.isDecimalDigit(this.source.charCodeAt(this.index));)y+=this.source[this.index++];m=this.source[this.index]}if("e"===m||"E"===m)if(y+=this.source[this.index++],"+"!==(m=this.source[this.index])&&"-"!==m||(y+=this.source[this.index++]),C.Character.isDecimalDigit(this.source.charCodeAt(this.index)))for(;C.Character.isDecimalDigit(this.source.charCodeAt(this.index));)y+=this.source[this.index++];else this.throwUnexpectedToken();return C.Character.isIdentifierStart(this.source.charCodeAt(this.index))&&this.throwUnexpectedToken(),{type:6,value:parseFloat(y),lineNumber:this.lineNumber,lineStart:this.lineStart,start:h,end:this.index}},Scanner.prototype.scanStringLiteral=function(){var h=this.index,m=this.source[h];v.assert("'"===m||'"'===m,"String literal must starts with a quote"),++this.index;for(var y=!1,w="";!this.eof();){var A=this.source[this.index++];if(A===m){m="";break}if("\\"===A)if((A=this.source[this.index++])&&C.Character.isLineTerminator(A.charCodeAt(0)))++this.lineNumber,"\r"===A&&"\n"===this.source[this.index]&&++this.index,this.lineStart=this.index;else switch(A){case"u":if("{"===this.source[this.index])++this.index,w+=this.scanUnicodeCodePointEscape();else{var P=this.scanHexEscape(A);null===P&&this.throwUnexpectedToken(),w+=P}break;case"x":var k=this.scanHexEscape(A);null===k&&this.throwUnexpectedToken(T.Messages.InvalidHexEscapeSequence),w+=k;break;case"n":w+="\n";break;case"r":w+="\r";break;case"t":w+="\t";break;case"b":w+="\b";break;case"f":w+="\f";break;case"v":w+="\v";break;case"8":case"9":w+=A,this.tolerateUnexpectedToken();break;default:if(A&&C.Character.isOctalDigit(A.charCodeAt(0))){var R=this.octalToDecimal(A);y=R.octal||y,w+=String.fromCharCode(R.code)}else w+=A}else{if(C.Character.isLineTerminator(A.charCodeAt(0)))break;w+=A}}return""!==m&&(this.index=h,this.throwUnexpectedToken()),{type:8,value:w,octal:y,lineNumber:this.lineNumber,lineStart:this.lineStart,start:h,end:this.index}},Scanner.prototype.scanTemplate=function(){var h="",m=!1,y=this.index,v="`"===this.source[y],w=!1,A=2;for(++this.index;!this.eof();){var P=this.source[this.index++];if("`"===P){A=1,w=!0,m=!0;break}if("$"===P){if("{"===this.source[this.index]){this.curlyStack.push("${"),++this.index,m=!0;break}h+=P}else if("\\"===P)if(P=this.source[this.index++],C.Character.isLineTerminator(P.charCodeAt(0)))++this.lineNumber,"\r"===P&&"\n"===this.source[this.index]&&++this.index,this.lineStart=this.index;else switch(P){case"n":h+="\n";break;case"r":h+="\r";break;case"t":h+="\t";break;case"u":if("{"===this.source[this.index])++this.index,h+=this.scanUnicodeCodePointEscape();else{var k=this.index,R=this.scanHexEscape(P);null!==R?h+=R:(this.index=k,h+=P)}break;case"x":var M=this.scanHexEscape(P);null===M&&this.throwUnexpectedToken(T.Messages.InvalidHexEscapeSequence),h+=M;break;case"b":h+="\b";break;case"f":h+="\f";break;case"v":h+="\v";break;default:"0"===P?(C.Character.isDecimalDigit(this.source.charCodeAt(this.index))&&this.throwUnexpectedToken(T.Messages.TemplateOctalLiteral),h+="\0"):C.Character.isOctalDigit(P.charCodeAt(0))?this.throwUnexpectedToken(T.Messages.TemplateOctalLiteral):h+=P}else C.Character.isLineTerminator(P.charCodeAt(0))?(++this.lineNumber,"\r"===P&&"\n"===this.source[this.index]&&++this.index,this.lineStart=this.index,h+="\n"):h+=P}return m||this.throwUnexpectedToken(),v||this.curlyStack.pop(),{type:10,value:this.source.slice(y+1,this.index-A),cooked:h,head:v,tail:w,lineNumber:this.lineNumber,lineStart:this.lineStart,start:y,end:this.index}},Scanner.prototype.testRegExp=function(h,m){var y=h,v=this;m.indexOf("u")>=0&&(y=y.replace(/\\u\{([0-9a-fA-F]+)\}|\\u([a-fA-F0-9]{4})/g,(function(h,m,y){var C=parseInt(m||y,16);return C>1114111&&v.throwUnexpectedToken(T.Messages.InvalidRegExp),C<=65535?String.fromCharCode(C):""})).replace(/[\uD800-\uDBFF][\uDC00-\uDFFF]/g,""));try{RegExp(y)}catch(h){this.throwUnexpectedToken(T.Messages.InvalidRegExp)}try{return new RegExp(h,m)}catch(h){return null}},Scanner.prototype.scanRegExpBody=function(){var h=this.source[this.index];v.assert("/"===h,"Regular expression literal must start with a slash");for(var m=this.source[this.index++],y=!1,w=!1;!this.eof();)if(m+=h=this.source[this.index++],"\\"===h)h=this.source[this.index++],C.Character.isLineTerminator(h.charCodeAt(0))&&this.throwUnexpectedToken(T.Messages.UnterminatedRegExp),m+=h;else if(C.Character.isLineTerminator(h.charCodeAt(0)))this.throwUnexpectedToken(T.Messages.UnterminatedRegExp);else if(y)"]"===h&&(y=!1);else{if("/"===h){w=!0;break}"["===h&&(y=!0)}return w||this.throwUnexpectedToken(T.Messages.UnterminatedRegExp),m.substr(1,m.length-2)},Scanner.prototype.scanRegExpFlags=function(){for(var h="";!this.eof();){var m=this.source[this.index];if(!C.Character.isIdentifierPart(m.charCodeAt(0)))break;if(++this.index,"\\"!==m||this.eof())h+=m,m;else if("u"===(m=this.source[this.index])){++this.index;var y=this.index,v=this.scanHexEscape("u");if(null!==v)for(h+=v,"\\u";y<this.index;++y)this.source[y];else this.index=y,h+="u","\\u";this.tolerateUnexpectedToken()}else"\\",this.tolerateUnexpectedToken()}return h},Scanner.prototype.scanRegExp=function(){var h=this.index,m=this.scanRegExpBody(),y=this.scanRegExpFlags();return{type:9,value:"",pattern:m,flags:y,regex:this.testRegExp(m,y),lineNumber:this.lineNumber,lineStart:this.lineStart,start:h,end:this.index}},Scanner.prototype.lex=function(){if(this.eof())return{type:2,value:"",lineNumber:this.lineNumber,lineStart:this.lineStart,start:this.index,end:this.index};var h=this.source.charCodeAt(this.index);return C.Character.isIdentifierStart(h)?this.scanIdentifier():40===h||41===h||59===h?this.scanPunctuator():39===h||34===h?this.scanStringLiteral():46===h?C.Character.isDecimalDigit(this.source.charCodeAt(this.index+1))?this.scanNumericLiteral():this.scanPunctuator():C.Character.isDecimalDigit(h)?this.scanNumericLiteral():96===h||125===h&&"${"===this.curlyStack[this.curlyStack.length-1]?this.scanTemplate():h>=55296&&h<57343&&C.Character.isIdentifierStart(this.codePointAt(this.index))?this.scanIdentifier():this.scanPunctuator()},Scanner}();m.Scanner=w},function(h,m){"use strict";Object.defineProperty(m,"__esModule",{value:!0}),m.TokenName={},m.TokenName[1]="Boolean",m.TokenName[2]="<end>",m.TokenName[3]="Identifier",m.TokenName[4]="Keyword",m.TokenName[5]="Null",m.TokenName[6]="Numeric",m.TokenName[7]="Punctuator",m.TokenName[8]="String",m.TokenName[9]="RegularExpression",m.TokenName[10]="Template"},function(h,m){"use strict";Object.defineProperty(m,"__esModule",{value:!0}),m.XHTMLEntities={quot:'"',amp:"&",apos:"'",gt:">",nbsp:"",iexcl:"",cent:"",pound:"",curren:"",yen:"",brvbar:"",sect:"",uml:"",copy:"",ordf:"",laquo:"",not:"",shy:"",reg:"",macr:"",deg:"",plusmn:"",sup2:"",sup3:"",acute:"",micro:"",para:"",middot:"",cedil:"",sup1:"",ordm:"",raquo:"",frac14:"",frac12:"",frac34:"",iquest:"",Agrave:"",Aacute:"",Acirc:"",Atilde:"",Auml:"",Aring:"",AElig:"",Ccedil:"",Egrave:"",Eacute:"",Ecirc:"",Euml:"",Igrave:"",Iacute:"",Icirc:"",Iuml:"",ETH:"",Ntilde:"",Ograve:"",Oacute:"",Ocirc:"",Otilde:"",Ouml:"",times:"",Oslash:"",Ugrave:"",Uacute:"",Ucirc:"",Uuml:"",Yacute:"",THORN:"",szlig:"",agrave:"",aacute:"",acirc:"",atilde:"",auml:"",aring:"",aelig:"",ccedil:"",egrave:"",eacute:"",ecirc:"",euml:"",igrave:"",iacute:"",icirc:"",iuml:"",eth:"",ntilde:"",ograve:"",oacute:"",ocirc:"",otilde:"",ouml:"",divide:"",oslash:"",ugrave:"",uacute:"",ucirc:"",uuml:"",yacute:"",thorn:"",yuml:"",OElig:"",oelig:"",Scaron:"",scaron:"",Yuml:"",fnof:"",circ:"",tilde:"",Alpha:"",Beta:"",Gamma:"",Delta:"",Epsilon:"",Zeta:"",Eta:"",Theta:"",Iota:"",Kappa:"",Lambda:"",Mu:"",Nu:"",Xi:"",Omicron:"",Pi:"",Rho:"",Sigma:"",Tau:"",Upsilon:"",Phi:"",Chi:"",Psi:"",Omega:"",alpha:"",beta:"",gamma:"",delta:"",epsilon:"",zeta:"",eta:"",theta:"",iota:"",kappa:"",lambda:"",mu:"",nu:"",xi:"",omicron:"",pi:"",rho:"",sigmaf:"",sigma:"",tau:"",upsilon:"",phi:"",chi:"",psi:"",omega:"",thetasym:"",upsih:"",piv:"",ensp:"",emsp:"",thinsp:"",zwnj:"",zwj:"",lrm:"",rlm:"",ndash:"",mdash:"",lsquo:"",rsquo:"",sbquo:"",ldquo:"",rdquo:"",bdquo:"",dagger:"",Dagger:"",bull:"",hellip:"",permil:"",prime:"",Prime:"",lsaquo:"",rsaquo:"",oline:"",frasl:"",euro:"",image:"",weierp:"",real:"",trade:"",alefsym:"",larr:"",uarr:"",rarr:"",darr:"",harr:"",crarr:"",lArr:"",uArr:"",rArr:"",dArr:"",hArr:"",forall:"",part:"",exist:"",empty:"",nabla:"",isin:"",notin:"",ni:"",prod:"",sum:"",minus:"",lowast:"",radic:"",prop:"",infin:"",ang:"",and:"",or:"",cap:"",cup:"",int:"",there4:"",sim:"",cong:"",asymp:"",ne:"",equiv:"",le:"",ge:"",sub:"",sup:"",nsub:"",sube:"",supe:"",oplus:"",otimes:"",perp:"",sdot:"",lceil:"",rceil:"",lfloor:"",rfloor:"",loz:"",spades:"",clubs:"",hearts:"",diams:"",lang:"",rang:""}},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0});var v=y(10),C=y(12),T=y(13),w=function(){function Reader(){this.values=[],this.curly=this.paren=-1}return Reader.prototype.beforeFunctionExpression=function(h){return["(","{","[","in","typeof","instanceof","new","return","case","delete","throw","void","=","+=","-=","*=","**=","/=","%=","<<=",">>=",">>>=","&=","|=","^=",",","+","-","*","**","/","%","++","--","<<",">>",">>>","&","|","^","!","~","&&","||","?",":","===","==",">=","<=","<",">","!=","!=="].indexOf(h)>=0},Reader.prototype.isRegexStart=function(){var h=this.values[this.values.length-1],m=null!==h;switch(h){case"this":case"]":m=!1;break;case")":var y=this.values[this.paren-1];m="if"===y||"while"===y||"for"===y||"with"===y;break;case"}":if(m=!1,"function"===this.values[this.curly-3])m=!!(v=this.values[this.curly-4])&&!this.beforeFunctionExpression(v);else if("function"===this.values[this.curly-4]){var v;m=!(v=this.values[this.curly-5])||!this.beforeFunctionExpression(v)}}return m},Reader.prototype.push=function(h){7===h.type||4===h.type?("{"===h.value?this.curly=this.values.length:"("===h.value&&(this.paren=this.values.length),this.values.push(h.value)):this.values.push(null)},Reader}(),A=function(){function Tokenizer(h,m){this.errorHandler=new v.ErrorHandler,this.errorHandler.tolerant=!!m&&("boolean"==typeof m.tolerant&&m.tolerant),this.scanner=new C.Scanner(h,this.errorHandler),this.scanner.trackComment=!!m&&("boolean"==typeof m.comment&&m.comment),this.trackRange=!!m&&("boolean"==typeof m.range&&m.range),this.trackLoc=!!m&&("boolean"==typeof m.loc&&m.loc),this.buffer=[],this.reader=new w}return Tokenizer.prototype.errors=function(){return this.errorHandler.errors},Tokenizer.prototype.getNextToken=function(){if(0===this.buffer.length){var h=this.scanner.scanComments();if(this.scanner.trackComment)for(var m=0;m<h.length;++m){var y=h[m],v=this.scanner.source.slice(y.slice[0],y.slice[1]),C={type:y.multiLine?"BlockComment":"LineComment",value:v};this.trackRange&&(C.range=y.range),this.trackLoc&&(C.loc=y.loc),this.buffer.push(C)}if(!this.scanner.eof()){var w=void 0;this.trackLoc&&(w={start:{line:this.scanner.lineNumber,column:this.scanner.index-this.scanner.lineStart},end:{}});var A="/"===this.scanner.source[this.scanner.index]&&this.reader.isRegexStart()?this.scanner.scanRegExp():this.scanner.lex();this.reader.push(A);var P={type:T.TokenName[A.type],value:this.scanner.source.slice(A.start,A.end)};if(this.trackRange&&(P.range=[A.start,A.end]),this.trackLoc&&(w.end={line:this.scanner.lineNumber,column:this.scanner.index-this.scanner.lineStart},P.loc=w),9===A.type){var k=A.pattern,R=A.flags;P.regex={pattern:k,flags:R}}this.buffer.push(P)}}return this.buffer.shift()},Tokenizer}();m.Tokenizer=A}])}))},function(h,m){const y=[1,10,100,1e3,1e4,1e5,1e6,1e7,1e8,1e9];let v;const log10=h=>h<1e5?h<100?h<10?0:1:h<1e4?h<1e3?2:3:4:h<1e7?h<1e6?5:6:h<1e9?h<1e8?7:8:9;function alphabeticalCompare(h,m){if(h===m)return 0;if(~~h===h&&~~m===m){if(0===h||0===m)return h<m?-1:1;if(h<0||m<0){if(m>=0)return-1;if(h>=0)return 1;h=-h,m=-m}const v=log10(h),C=log10(m);let T=0;return v<C?(h*=y[C-v-1],m/=10,T=-1):v>C&&(m*=y[v-C-1],h/=10,T=1),h===m?T:h<m?-1:1}const v=String(h),C=String(m);return v===C?0:v<C?-1:1}function makeAscendingRun(h,m,y,C){let T=m+1;if(T===y)return 1;if(C(h[T++],h[m])<0){for(;T<y&&C(h[T],h[T-1])<0;)T++;reverseRun(h,m,T),reverseRun(v,m,T)}else for(;T<y&&C(h[T],h[T-1])>=0;)T++;return T-m}function reverseRun(h,m,y){for(y--;m<y;){const v=h[m];h[m++]=h[y],h[y--]=v}}function binaryInsertionSort(h,m,y,C,T){for(C===m&&C++;C<y;C++){const y=h[C],w=v[C];let A=m,P=C;for(;A<P;){const m=A+P>>>1;T(y,h[m])<0?P=m:A=m+1}let k=C-A;switch(k){case 3:h[A+3]=h[A+2],v[A+3]=v[A+2];case 2:h[A+2]=h[A+1],v[A+2]=v[A+1];case 1:h[A+1]=h[A],v[A+1]=v[A];break;default:for(;k>0;)h[A+k]=h[A+k-1],v[A+k]=v[A+k-1],k--}h[A]=y,v[A]=w}}function gallopLeft(h,m,y,v,C,T){let w=0,A=0,P=1;if(T(h,m[y+C])>0){for(A=v-C;P<A&&T(h,m[y+C+P])>0;)w=P,P=1+(P<<1),P<=0&&(P=A);P>A&&(P=A),w+=C,P+=C}else{for(A=C+1;P<A&&T(h,m[y+C-P])<=0;)w=P,P=1+(P<<1),P<=0&&(P=A);P>A&&(P=A);const v=w;w=C-P,P=C-v}for(w++;w<P;){const v=w+(P-w>>>1);T(h,m[y+v])>0?w=v+1:P=v}return P}function gallopRight(h,m,y,v,C,T){let w=0,A=0,P=1;if(T(h,m[y+C])<0){for(A=C+1;P<A&&T(h,m[y+C-P])<0;)w=P,P=1+(P<<1),P<=0&&(P=A);P>A&&(P=A);const v=w;w=C-P,P=C-v}else{for(A=v-C;P<A&&T(h,m[y+C+P])>=0;)w=P,P=1+(P<<1),P<=0&&(P=A);P>A&&(P=A),w+=C,P+=C}for(w++;w<P;){const v=w+(P-w>>>1);T(h,m[y+v])<0?P=v:w=v+1}return P}class TimSort{constructor(h,m){this.array=h,this.compare=m;const{length:y}=h;this.length=y,this.minGallop=7,this.tmpStorageLength=y<512?y>>>1:256,this.tmp=new Array(this.tmpStorageLength),this.tmpIndex=new Array(this.tmpStorageLength),this.stackLength=y<120?5:y<1542?10:y<119151?19:40,this.runStart=new Array(this.stackLength),this.runLength=new Array(this.stackLength),this.stackSize=0}pushRun(h,m){this.runStart[this.stackSize]=h,this.runLength[this.stackSize]=m,this.stackSize+=1}mergeRuns(){for(;this.stackSize>1;){let h=this.stackSize-2;if(h>=1&&this.runLength[h-1]<=this.runLength[h]+this.runLength[h+1]||h>=2&&this.runLength[h-2]<=this.runLength[h]+this.runLength[h-1])this.runLength[h-1]<this.runLength[h+1]&&h--;else if(this.runLength[h]>this.runLength[h+1])break;this.mergeAt(h)}}forceMergeRuns(){for(;this.stackSize>1;){let h=this.stackSize-2;h>0&&this.runLength[h-1]<this.runLength[h+1]&&h--,this.mergeAt(h)}}mergeAt(h){const{compare:m}=this,{array:y}=this;let v=this.runStart[h],C=this.runLength[h];const T=this.runStart[h+1];let w=this.runLength[h+1];this.runLength[h]=C+w,h===this.stackSize-3&&(this.runStart[h+1]=this.runStart[h+2],this.runLength[h+1]=this.runLength[h+2]),this.stackSize--;const A=gallopRight(y[T],y,v,C,0,m);v+=A,C-=A,0!==C&&(w=gallopLeft(y[v+C-1],y,T,w,w-1,m),0!==w&&(C<=w?this.mergeLow(v,C,T,w):this.mergeHigh(v,C,T,w)))}mergeLow(h,m,y,C){const{compare:T}=this,{array:w}=this,{tmp:A}=this,{tmpIndex:P}=this;let k=0;for(k=0;k<m;k++)A[k]=w[h+k],P[k]=v[h+k];let R=0,M=y,N=h;if(w[N]=w[M],v[N]=v[M],N++,M++,0==--C){for(k=0;k<m;k++)w[N+k]=A[R+k],v[N+k]=P[R+k];return}if(1===m){for(k=0;k<C;k++)w[N+k]=w[M+k],v[N+k]=v[M+k];return w[N+C]=A[R],void(v[N+C]=P[R])}let{minGallop:D}=this;for(;;){let h=0,y=0,I=!1;do{if(T(w[M],A[R])<0){if(w[N]=w[M],v[N]=v[M],N++,M++,y++,h=0,0==--C){I=!0;break}}else if(w[N]=A[R],v[N]=P[R],N++,R++,h++,y=0,1==--m){I=!0;break}}while((h|y)<D);if(I)break;do{if(h=gallopRight(w[M],A,R,m,0,T),0!==h){for(k=0;k<h;k++)w[N+k]=A[R+k],v[N+k]=P[R+k];if(N+=h,R+=h,(m-=h)<=1){I=!0;break}}if(w[N]=w[M],v[N]=v[M],N++,M++,0==--C){I=!0;break}if(y=gallopLeft(A[R],w,M,C,0,T),0!==y){for(k=0;k<y;k++)w[N+k]=w[M+k],v[N+k]=v[M+k];if(N+=y,M+=y,0===(C-=y)){I=!0;break}}if(w[N]=A[R],v[N]=P[R],N++,R++,1==--m){I=!0;break}D--}while(h>=7||y>=7);if(I)break;D<0&&(D=0),D+=2}if(this.minGallop=D,D<1&&(this.minGallop=1),1===m){for(k=0;k<C;k++)w[N+k]=w[M+k],v[N+k]=v[M+k];w[N+C]=A[R],v[N+C]=P[R]}else{if(0===m)throw new Error("mergeLow preconditions were not respected");for(k=0;k<m;k++)w[N+k]=A[R+k],v[N+k]=P[R+k]}}mergeHigh(h,m,y,C){const{compare:T}=this,{array:w}=this,{tmp:A}=this,{tmpIndex:P}=this;let k=0;for(k=0;k<C;k++)A[k]=w[y+k],P[k]=v[y+k];let R=h+m-1,M=C-1,N=y+C-1,D=0,I=0;if(w[N]=w[R],v[N]=v[R],N--,R--,0==--m){for(D=N-(C-1),k=0;k<C;k++)w[D+k]=A[k],v[D+k]=P[k];return}if(1===C){for(N-=m,R-=m,I=N+1,D=R+1,k=m-1;k>=0;k--)w[I+k]=w[D+k],v[I+k]=v[D+k];return w[N]=A[M],void(v[N]=P[M])}let{minGallop:x}=this;for(;;){let y=0,O=0,L=!1;do{if(T(A[M],w[R])<0){if(w[N]=w[R],v[N]=v[R],N--,R--,y++,O=0,0==--m){L=!0;break}}else if(w[N]=A[M],v[N]=P[M],N--,M--,O++,y=0,1==--C){L=!0;break}}while((y|O)<x);if(L)break;do{if(y=m-gallopRight(A[M],w,h,m,m-1,T),0!==y){for(N-=y,R-=y,m-=y,I=N+1,D=R+1,k=y-1;k>=0;k--)w[I+k]=w[D+k],v[I+k]=v[D+k];if(0===m){L=!0;break}}if(w[N]=A[M],v[N]=P[M],N--,M--,1==--C){L=!0;break}if(O=C-gallopLeft(w[R],A,0,C,C-1,T),0!==O){for(N-=O,M-=O,C-=O,I=N+1,D=M+1,k=0;k<O;k++)w[I+k]=A[D+k],v[I+k]=P[D+k];if(C<=1){L=!0;break}}if(w[N]=w[R],v[N]=v[R],N--,R--,0==--m){L=!0;break}x--}while(y>=7||O>=7);if(L)break;x<0&&(x=0),x+=2}if(this.minGallop=x,x<1&&(this.minGallop=1),1===C){for(N-=m,R-=m,I=N+1,D=R+1,k=m-1;k>=0;k--)w[I+k]=w[D+k],v[I+k]=v[D+k];w[N]=A[M],v[N]=P[M]}else{if(0===C)throw new Error("mergeHigh preconditions were not respected");for(D=N-(C-1),k=0;k<C;k++)w[D+k]=A[k],v[D+k]=P[k]}}}h.exports={sort:function sort(h,m,y,C){if(!Array.isArray(h))throw new TypeError(`The "array" argument must be an array. Received ${h}`);v=[];const{length:T}=h;let w=0;for(;w<T;)v[w]=w++;m?"function"!=typeof m&&(C=y,y=m,m=alphabeticalCompare):m=alphabeticalCompare,y||(y=0),C||(C=T);let A=C-y;if(A<2)return v;let P=0;if(A<32)return P=makeAscendingRun(h,y,C,m),binaryInsertionSort(h,y,C,y+P,m),v;const k=new TimSort(h,m),R=function minRunLength(h){let m=0;for(;h>=32;)m|=1&h,h>>=1;return h+m}(A);do{if(P=makeAscendingRun(h,y,C,m),P<R){let v=A;v>R&&(v=R),binaryInsertionSort(h,y,y+v,y+P,m),P=v}k.pushRun(y,P),k.mergeRuns(),A-=P,y+=P}while(0!==A);return k.forceMergeRuns(),v}}},function(h,m,y){"use strict";const v=Object.prototype.hasOwnProperty;h.exports=(h,m)=>v.call(h,m)},function(h,m,y){const{isArray:v,isObject:C,isFunction:T,isNumber:w,isString:A}=y(229),P=y(966),{PREFIX_BEFORE_ALL:k,PREFIX_BEFORE:R,PREFIX_AFTER_PROP:M,PREFIX_AFTER_COLON:N,PREFIX_AFTER_VALUE:D,PREFIX_AFTER:I,PREFIX_AFTER_ALL:x,BRACKET_OPEN:O,BRACKET_CLOSE:L,CURLY_BRACKET_OPEN:U,CURLY_BRACKET_CLOSE:B,COLON:W,COMMA:q,EMPTY:Y,UNDEFINED:V}=y(165),$=/[\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,BEFORE=h=>`${R}:${h}`,AFTER_VALUE=h=>`${D}:${h}`,AFTER=h=>`${I}:${h}`,z={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},quote=h=>`"${(h=>($.lastIndex=0,$.test(h)?h.replace($,h=>{const m=z[h];return"string"==typeof m?m:h}):h))(h)}"`,process_comments=(h,m,y,v)=>{const C=h[Symbol.for(m)];if(!C||!C.length)return Y;let T=!1;const w=C.reduce((h,{inline:m,type:v,value:C})=>(T="LineComment"===v,h+(m?" ":"\n"+y)+((h,m)=>m?`//${h}`:`/*${h}*/`)(C,T)),Y);return v||T?w+"\n"+y:w};let G=null,J=Y;const join=(h,m,y)=>h?m?h+m.trim()+"\n"+y:h.trimRight()+"\n"+y:m?m.trimRight()+"\n"+y:Y,join_content=(h,m,y)=>{const v=process_comments(m,R,y+J,!0);return join(v,h,y)},object_stringify=(h,m)=>{if(!h)return"null";const y=m+J;let C=Y,T=Y,w=!0;return(v(G)?G:Object.keys(h)).forEach(m=>{const v=stringify(m,h,y);if(v===V)return;w||(C+=q),w=!1;const A=join(T,process_comments(h,BEFORE(m),y),y);C+=A||"\n"+y,C+=quote(m)+process_comments(h,`${M}:${m}`,y)+W+process_comments(h,(h=>`${N}:${h}`)(m),y)+" "+v+process_comments(h,AFTER_VALUE(m),y),T=process_comments(h,AFTER(m),y)}),C+=join(T,process_comments(h,I,y),y),U+join_content(C,h,m)+B};function stringify(h,m,y){let w=m[h];switch(C(w)&&T(w.toJSON)&&(w=w.toJSON(h)),T(G)&&(w=G.call(m,h,w)),typeof w){case"string":return quote(w);case"number":return Number.isFinite(w)?String(w):"null";case"boolean":case"null":return String(w);case"object":return v(w)?((h,m)=>{const y=m+J,{length:v}=h;let C=Y,T=Y;for(let m=0;m<v;m++){0!==m&&(C+=q),C+=join(T,process_comments(h,BEFORE(m),y),y)||"\n"+y,C+=stringify(m,h,y)||"null",C+=process_comments(h,AFTER_VALUE(m),y),T=process_comments(h,AFTER(m),y)}return C+=join(T,process_comments(h,I,y),y),O+join_content(C,h,m)+L})(w,y):object_stringify(w,y)}}const{toString:X}=Object.prototype,Z=["[object Number]","[object String]","[object Boolean]"];h.exports=(h,m,y)=>{const R=(h=>A(h)?h:w(h)?P(" ",h):Y)(y);if(!R)return JSON.stringify(h,m);T(m)||v(m)||(m=null),G=m,J=R;const M=(h=>{if("object"!=typeof h)return!1;const m=X.call(h);return Z.includes(m)})(h)?JSON.stringify(h):stringify("",{"":h},Y);return G=null,J=Y,C(h)?process_comments(h,k,Y).trimLeft()+M+process_comments(h,x,Y).trimRight():M}},function(h,m,y){"use strict";
/*!
 * repeat-string <https://github.com/jonschlinkert/repeat-string>
 *
 * Copyright (c) 2014-2015, Jon Schlinkert.
 * Licensed under the MIT License.
 */var v,C="";h.exports=function repeat(h,m){if("string"!=typeof h)throw new TypeError("expected a string");if(1===m)return h;if(2===m)return h+h;var y=h.length*m;if(v!==h||void 0===v)v=h,C="";else if(C.length>=y)return C.substr(0,y);for(;y>C.length&&m>1;)1&m&&(C+=h),m>>=1,h+=h;return C=(C+=h).substr(0,y)}},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0});const v=y(0),C=y(5),T=y(968),w=y(74),A=y(385),P=y(383);class EnterpriseConfig{constructor(){this.policyProviders=new Map,this.policyManagedSettings=[w.SettingKeys.allowedDomains,w.SettingKeys.allowReadWriteTerminals],this.resolutionMap=new Map,this.resolutionFactory=new T.ResolutionStrategyFactory,this.ignoreConfigUpdates=!1,v.workspace.onDidChangeConfiguration(h=>this.configurationChangeHandler(this.ignoreConfigUpdates,h))}static get Instance(){return EnterpriseConfig.singleton||(EnterpriseConfig.singleton=new EnterpriseConfig),EnterpriseConfig.singleton}async isEnabled(){const h=A.getExpService();return!!h&&await h.isCachedFlightEnabled("policies")}get(h){let m=this.resolutionMap.get(h);if(m&&(this.policyManagedSettings.includes(m.policySetting)||m.isEnforced))return m.value}async registerPolicyProvider(h,m){return await this.isEnabled()?(C.traceSource.info(`Register provier with name: ${h}`),m?(this.policyProviders.set(h,m),this.rebuildResolutionMap(),new v.Disposable(()=>{this.policyProviders.delete(h),this.rebuildResolutionMap()})):null):null}configurationChangeHandler(h,m){if(h)return;let y=v.workspace.getConfiguration(P.defaultSettings.configName);this.resolutionMap.forEach(async h=>{if(!h.isEnforced)return;let C=`${P.defaultSettings.configName}.${h.policySetting}`;if(m.affectsConfiguration(C)){if(y[h.policySetting]!==h.value)return this.ignoreConfigUpdates=!0,y.update(h.policySetting,h.value,v.ConfigurationTarget.Global),this.ignoreConfigUpdates=!1,void await v.window.showInformationMessage("An attempt to override a setting enforced by external extension. "+`The value of '${h.policySetting}' has been set back to '${h.value}'.`)}})}rebuildResolutionMap(){this.resolutionMap.clear(),this.policyProviders.forEach((h,m)=>{let y;try{y=h.providePolicies()}catch(h){return void C.traceSource.error(`'${m}' policy provider failed`,h)}for(let h of y){if(!this.resolutionMap.has(h.policySetting)){this.resolutionMap.set(h.policySetting,h);continue}let m=this.resolutionMap.get(h.policySetting);if(void 0===m){this.resolutionMap.set(h.policySetting,h);continue}let y=this.resolutionFactory.resolve(w.SettingKeys[h.policySetting],m.value,h.value);void 0===y?C.traceSource.info(`Failed to resolve policy conflict for: ${h.policySetting}`):h.value===y&&this.resolutionMap.set(h.policySetting,h)}});const h=v.workspace.getConfiguration(P.defaultSettings.configName);this.ignoreConfigUpdates=!0;for(let m of this.resolutionMap.values())this.policyManagedSettings.includes(m.policySetting)||h.update(m.policySetting,m.value,v.ConfigurationTarget.Global);this.ignoreConfigUpdates=!1}}const k=EnterpriseConfig.Instance;m.EnterpriseConfig=k},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0});const v=y(74),C=y(969),T=y(970),w=y(971),A=y(972);class DefaultFactoryConfig{constructor(){this.boolStrategy=new A.BooleanStrategy,this.inversedBoolStrategy=new A.BooleanStrategy(!0),this.connectionModeStrategy=new T.ConnectionModeStrategy,this.anonymousGuestApprovalStrategy=new C.AnonymousGuestApprovalStrategy,this.allowedDomainsStrategy=new w.AllowedDomainsStrategy}}m.DefaultFactoryConfig=DefaultFactoryConfig;m.ResolutionStrategyFactory=class ResolutionStrategyFactory{constructor(h){this.config=h||new DefaultFactoryConfig}resolve(h,m,y){let v=this.getResolutionStrategy(h);if(v)return v.resolvePolicy([m,y])}getResolutionStrategy(h){switch(h){case v.SettingKeys.allowGuestDebugControl:case v.SettingKeys.allowGuestTaskControl:case v.SettingKeys.autoShareServers:return this.config.boolStrategy;case v.SettingKeys.allowReadWriteTerminals:return this.config.inversedBoolStrategy;case v.SettingKeys.connectionMode:return this.config.connectionModeStrategy;case v.SettingKeys.anonymousGuestApproval:return this.config.anonymousGuestApprovalStrategy;case v.SettingKeys.allowedDomains:return this.config.allowedDomainsStrategy;default:return}}}},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0});m.AnonymousGuestApprovalStrategy=class AnonymousGuestApprovalStrategy{constructor(){this.default="prompt"}resolvePolicy(h){return h&&0!==h.length?h.includes("reject")?"reject":h.includes("prompt")?"prompt":h.includes("accept")?"accept":this.default:this.default}}},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0});m.ConnectionModeStrategy=class ConnectionModeStrategy{constructor(){this.default="auto"}resolvePolicy(h){return h&&0!==h.length?h.includes("direct")?"direct":h.includes("relay")?"relay":this.default:this.default}}},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0});m.AllowedDomainsStrategy=class AllowedDomainsStrategy{constructor(){this.default=[]}resolvePolicy(h){if(!h||0===h.length)return this.default;let m=new Array;return h.forEach(h=>{m=m.concat(h)}),m}}},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0});m.BooleanStrategy=class BooleanStrategy{constructor(h=!1){this.inverted=h,this.default=h}resolvePolicy(h){if(!h||0===h.length)return this.default;let m=h.reduce((h,m)=>h&&m);return this.inverted?!m:m}}},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0});const v=y(0);m.MemoryFile=class MemoryFile{constructor(h,m){this.uri=h,this.name=m,this.type=v.FileType.File,this.ctime=Date.now(),this.mtime=Date.now(),this.size=0,this.name=m}}},function(h,m,y){"use strict";var v=this&&this.__awaiter||function(h,m,y,v){return new(y||(y=Promise))((function(C,T){function fulfilled(h){try{step(v.next(h))}catch(h){T(h)}}function rejected(h){try{step(v.throw(h))}catch(h){T(h)}}function step(h){h.done?C(h.value):function adopt(h){return h instanceof y?h:new y((function(m){m(h)}))}(h.value).then(fulfilled,rejected)}step((v=v.apply(h,m||[])).next())}))};Object.defineProperty(m,"__esModule",{value:!0});const C=y(2),T=y(6);m.FileServiceCache=class FileServiceCache{constructor(h,m){let y=0,C=0,w=0;const onQueryCached=h=>{++C,++w,5===w&&(m.verbose(`totalCaches:${C} totalBatches:${y}`),w=0)};this.listServiceCache=new QueryServiceCache((m,v,C)=>(y+=m.length,h.listAsync(m,v,C)),onQueryCached,m.createChild("list"));let A=!0;const nonReadBatchCallback=(m,y,v)=>Promise.all(m.map(m=>h.readTextAsync(m,y,v)));this.readTextCache=new QueryServiceCache((m,C,w)=>v(this,void 0,void 0,(function*(){if(y+=m.length,!A)return yield nonReadBatchCallback(m,C,w);try{let y=[];const v={report:h=>{y=y.concat(h.results)}};let T=yield h.readTextWithProgressAsync(m,C,v);if(T=T.concat(y),T.length!==m.length)throw new Error("Invalid results -> readTextWithProgressAsync");return T}catch(h){if(h.code===T.ErrorCodes.MethodNotFound)return A=!1,yield nonReadBatchCallback(m,C,w);throw h}})),onQueryCached,m.createChild("readText")),h.onFilesChanged(h=>{h.changes.forEach(h=>{let m=h.path;m.startsWith("/")||(m="/"+m),this.invalidateCache(m)})})}invalidateCache(h){this.listServiceCache.invalidateCache(h),this.readTextCache.invalidateCache(h)}listAsync(h,m,y,v){return this.listServiceCache.query(h,m,y,v)}readTextAsync(h,m,y,v){return this.readTextCache.query(h,m,y,v)}};class QueryServiceCache{constructor(h,m,y){this.serviceCallback=h,this.onQueryCached=m,this.trace=y,this.cacheInfos=new Map,this.queryCache=new Map}invalidateCache(h){const m=Array.from(this.cacheInfos.keys()).filter(m=>m.startsWith(h));m.length>0&&(this.trace.verbose(`invalidate cache for path:${h} count:${m.length}`),m.forEach(h=>{const m=this.cacheInfos.get(h);m&&(m.resultSignal.isFulfilled?this.cacheInfos.delete(h):m.invalidated=!0)}))}query(h,m,y,T){return v(this,void 0,void 0,(function*(){const v=[],w=Date.now(),A=y?w+y:void 0;let P=h.map(h=>{const y=cacheKey(h,m),C=this.cacheInfos.get(y);if(C&&!(C.expiredTime&&w>C.expiredTime))return this.onQueryCached(h),C;v.push(h)});if(v.length>0){let h=0;P=P.map(y=>{if(!y){y={resultSignal:new C.Signal,expiredTime:A};const T=cacheKey(v[h++],m);this.cacheInfos.set(T,y)}return y});const y=JSON.stringify(m);let w=this.queryCache.get(y);if(w)w.numberOfQueries++,w.queryPaths.push(...v);else{w={queryPaths:v,numberOfQueries:1},this.queryCache.set(y,w),yield C.wait(5),this.queryCache.delete(y);try{this.trace.verbose(`flush query paths count:${v.length} numberOfQueries:${w.numberOfQueries}`);const y=yield this.serviceCallback(v,m,T);h=0,y.forEach(y=>{const C=cacheKey(v[h++],m),T=this.cacheInfos.get(C);T&&(T.resultSignal.resolve(y),T.invalidated&&this.cacheInfos.delete(C))})}catch(h){v.forEach(y=>{const v=cacheKey(y,m),C=this.cacheInfos.get(v);C&&(C.resultSignal.reject(h),this.cacheInfos.delete(v))})}}}const k=yield Promise.all(P.map(h=>h.resultSignal.promise));return y&&C.wait(y).then(()=>{this.removeExpiredCacheInfos()}),k}))}removeExpiredCacheInfos(){const h=Date.now(),m=Array.from(this.cacheInfos.entries()).filter(m=>m[1].expiredTime&&h>m[1].expiredTime&&m[1].resultSignal.isFulfilled).map(h=>h[0]);if(m.length>0){this.trace.verbose(`removing expired caches count:${m.length}`);for(const h of m)this.cacheInfos.delete(h)}}}function cacheKey(h,m){return`${h}-${JSON.stringify(m)}`}},function(h,m,y){"use strict";var v=this&&this.__awaiter||function(h,m,y,v){return new(y||(y=Promise))((function(C,T){function fulfilled(h){try{step(v.next(h))}catch(h){T(h)}}function rejected(h){try{step(v.throw(h))}catch(h){T(h)}}function step(h){h.done?C(h.value):function adopt(h){return h instanceof y?h:new y((function(m){m(h)}))}(h.value).then(fulfilled,rejected)}step((v=v.apply(h,m||[])).next())}))};Object.defineProperty(m,"__esModule",{value:!0});const C=y(4);m.HostSyncService=class HostSyncService{constructor(h,m,y,v){this.workspaceService=h,this.session=m,this.rpcServiceHandler=y,this.trace=v,this.disposables=[],this.serviceInfo=C.vsls.SyncService}init(){return v(this,void 0,void 0,(function*(){yield this.workspaceService.registerServicesAsync([C.vsls.SyncService.name],C.vsls.CollectionChangeType.Add),this.disposables.push(yield this.rpcServiceHandler.registerRpcService(this,this.serviceInfo))}))}dispose(){return v(this,void 0,void 0,(function*(){for(const h of this.disposables)h.dispose();this.disposables=[]}))}checkSyncAsync(h,m,y){return v(this,void 0,void 0,(function*(){return yield this.session.coeditingClient.isFileSynced(h,m)}))}checkSyncForVersionAsync(h,m,y,C){return v(this,void 0,void 0,(function*(){return(yield this.session.coeditingClient.isFileSyncedForVersion(h,void 0,m,y)).isSynced}))}checkSyncForVersion2Async(h,m,y,C,T){return v(this,void 0,void 0,(function*(){return yield this.session.coeditingClient.isFileSyncedForVersion(h,m,y,C)}))}}},function(h,m,y){"use strict";h.exports={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]}},function(h,m,y){"use strict";var v=y(978),C=Array.prototype.concat,T=Array.prototype.slice,w=h.exports=function swizzle(h){for(var m=[],y=0,w=h.length;y<w;y++){var A=h[y];v(A)?m=C.call(m,T.call(A)):m.push(A)}return m};w.wrap=function(h){return function(){return h(w(arguments))}}},function(h,m){h.exports=function isArrayish(h){return!(!h||"string"==typeof h)&&(h instanceof Array||Array.isArray(h)||h.length>=0&&(h.splice instanceof Function||Object.getOwnPropertyDescriptor(h,h.length-1)&&"String"!==h.constructor.name))}},function(h,m,y){"use strict";var v=this&&this.__awaiter||function(h,m,y,v){return new(y||(y=Promise))((function(C,T){function fulfilled(h){try{step(v.next(h))}catch(h){T(h)}}function rejected(h){try{step(v.throw(h))}catch(h){T(h)}}function step(h){h.done?C(h.value):function adopt(h){return h instanceof y?h:new y((function(m){m(h)}))}(h.value).then(fulfilled,rejected)}step((v=v.apply(h,m||[])).next())}))};Object.defineProperty(m,"__esModule",{value:!0});const C=y(0),T=y(7),w=y(35),A=y(15),P=y(5),k=y(238),R=y(169),M=y(2),N=y(5),D=y(4),I=y(75),x=y(13),O=y(409),L=y(237),U=y(61),B=y(24),W=y(168),q=y(982),Y=y(984),V=y(234),$=y(93),z=y(160),G=y(22),J=y(233),X=y(23),Z=y(63),ee=y(16),te=y(25),re=y(12),ie=y(14),se=y(985),oe=y(8),ae=y(17),ce=y(37),le=y(167),ue=y(53),de=y(986),he=y(230),pe=y(95),me=y(26),fe=y(171),ye=A.TraceFormat.formatPath;let ve=new WeakMap;function getEditorId(h){return ve.has(h)||ve.set(h,w()),ve.get(h)}var Se;function repeatCommandUntilContentMatches(h,m,y,v,T){return new Promise((w,A)=>{const P=y.version;C.commands.executeCommand(`default:${h}`).then(()=>{let C=y.getText(),A=y.version;C===m||P===A?(P===A&&v.verbose("Undo: Performing undo didn't actually make changes"),T?T():w()):setImmediate(()=>{repeatCommandUntilContentMatches(h,m,y,v,T||w)})})})}!function(h){h.unableToOpen="Unable to open this file -- only text documents are supported"}(Se=m.FileResponse||(m.FileResponse={}));function checkForDroppedMessage(h,m,y,v){y.delete(m),m!==h&&(y.add(h),setTimeout(()=>{y.has(h)&&(y.delete(h),$.CoauthoringTelemetry.ReportDroppedMessage(h,m,v,!0))},5e3),$.CoauthoringTelemetry.ReportDroppedMessage(h,m,v,!1),he.showDiagnosticErrorMessage(`Dropped coediting message. Expected ID: ${h}. Actual ID: ${m}. ID Type: ${v}.`))}var Ee;!function(h){h[h.SendBucket=0]="SendBucket",h[h.ReceivedBucket=1]="ReceivedBucket"}(Ee=m.BucketType||(m.BucketType={}));class CoEditing{constructor(h){var m,y,T;this.coEditorsJoinedEventName="coEditorSwitchedFile",this.onPinEventName="onPin",this.onFollowedEventName="onFollowed",this.onUnfollowedEventName="onUnfollowed",this.onUnpinEventName="onUnpin",this.onUpdateCoEditorPositionEventName="onUpdateCoEditorPosition",this.onUpdateCoEditorVisibleRangesEventName="onUpdateCoEditorVisibleRanges",this.coEditorsJoinedEvent=new x.EventEmitter,this.onPinEvent=new x.EventEmitter,this.onUnpinEvent=new x.EventEmitter,this.onFollowedEvent=new x.EventEmitter,this.onUnfollowedEvent=new x.EventEmitter,this.onUpdateCoEditorPositionEvent=new x.EventEmitter,this.onUpdateCoEditorVisibleRangesEvent=new x.EventEmitter,this.vscodeEventSubscriptions=[],this.isDisposed=!1,this.sharedFileClients={},this.sharedBinaryFileClients={},this.pendingRenames=[],this.pendingFileClientDeletes=new Map,this.lastActiveEditor=null,this.lastEditTimeForDoc=new Map,this.openUntitledFiles=new Map,this.untitledPrefix="/~untitled",this.nextDocumentChangeListener=new NextDocumentChangeListener,this.highestReceivedEventId=-1,this.highestSendId={},this.messageProcessQueue=Promise.resolve(),this.unprocessedMessages={},this.isGuest=!1,this.trackedMessages=new Map,this.textDocumentChangeEventMessageData=new WeakMap,this.textDocumentChangeEventMessageDataRequests=new WeakMap,this.serverVersion=-1,this.highestLocalTextChange=-1,this.textChangeEventHistory=[],this.textChangeEventHistoryMaxSize=1e3,this.unacknowledgedTextChangeIds={},this.clientDecoratorManagers={},this.positionTracker=new Y.PositionTracker,this.clientVisibileRanges={},this.currentVisibleEditors={},this.recentlyScrolled={},this.followingMe=new Map,this.joiningInitialFiles={},this.justChangedDocumentTimeout=null,this.pendingFileHandshakeCallbacks={},this.pendingFileSync={},this.savingFiles={},this.fileSaveRequestsPaused=!1,this.shouldCheckSync=!1,this.desyncedFiles=new Set,this.shouldCheckSyncForVersion=!0,this.jumpToInProgress=!1,this.jumpCount=0,this.failedJumpCount=0,this.pinCount=0,this.unpinCount=0,this.autoUnpinCount=0,this.syncCheckCount=0,this.failedSyncCheckCount=0,this.slowSyncCheckCount=0,this.openDiffCount=0,this.closedDiffCount=0,this.droppedEventIds=new Set,this.droppedSendIds=new Set,this.summoningParticipants=null,this.settingsCallbacks={},this.initialPinIdToOwner=-1,this.activeEditorsChangedTimeout=null,this.receivedBuckets=new Map([[D.vsls.MessageType.LayoutScroll,new $.TimeTelemetry("ReceivedScroll")],[D.vsls.MessageType.SelectionChange,new $.TimeTelemetry("ReceivedSelection")],[D.vsls.MessageType.TextChange,new $.TimeTelemetry("ReceivedTextChange")]]),this.sendBuckets=new Map([[D.vsls.MessageType.LayoutScroll,new $.TimeTelemetry("SendScroll")],[D.vsls.MessageType.SelectionChange,new $.TimeTelemetry("SendSelection")],[D.vsls.MessageType.TextChange,new $.TimeTelemetry("SendTextChange")]]),this.onAccessLevelChanged=()=>{const h=I.MessageFactory.AnonymousAccessLevelChangeMessage(this.clientID);this.postMessage(h)},this.updateNametagVisibilitySetting=()=>{const h=re.Settings.get(ie.SettingKeys.nameTagVisibility),m=W.NameTagVisibility[h||""];this.nameTagVisibility=m||W.NameTagVisibility.Activity,Object.keys(this.clientDecoratorManagers).forEach(h=>{this.clientDecoratorManagers[h]&&(this.clientDecoratorManagers[h].nameTagVisibility=this.nameTagVisibility,this.clientDecoratorManagers[h].updateDecorators())})},this.updateDiagnosticLoggingSetting=()=>{P.vslsCommands.API.setDiagnosticLogging(!0)},this.updateDiagnosticModeSetting=()=>{const h=re.Settings.get(ie.SettingKeys.diagnosticMode);B.ExtensionUtil.setCommandContext("liveshare:diagnosticModeEnabled",!!h),h?this.diagnosticOutputTraceListener.addOutputChannel(!1):this.diagnosticOutputTraceListener.removeOutputChannel()},this.updateShowReadOnlyUsersInEditorSetting=()=>{if("always"===re.Settings.get(ie.SettingKeys.showReadOnlyUsersInEditor))for(let h of this.collaboratorManager.getCollaboratorSessionIds())!this.clientDecoratorManagers[h]&&this.clientAccessCheck().isClientReadOnly(h)&&this.updateDecorators(h);else Object.keys(this.clientDecoratorManagers).forEach(h=>{const m=this.clientDecoratorManagers[h],y=parseInt(h,10);m&&NaN!==y&&this.clientAccessCheck().isClientReadOnly(h)&&!this.isPinned(y)&&(m.dispose(),delete this.clientDecoratorManagers[h])})},this.presenterIdToClear=-1,this.isGuest=h.isGuest,this.sourceEventService=h.sourceEventService,this.clientID=h.clientID,this.fileService=h.fileService,this.pathManager=h.pathManager,this.clientAccessCheck=h.clientAccessCheck,this.collaboratorManager=h.collaboratorManager,this.joinCompleted=h.joinCompleted;const w=parseInt(Object.keys(this.collaboratorManager.getCollaborators()).find(h=>this.collaboratorManager.getCollaborators()[h].isHost),10);this.presentationManager=new de.PresentationManager(w,null!==(m=h.presentationMode)&&void 0!==m&&m),this.presentationManager.onPresenterUpdate.on("onPresenterUpdate",()=>this.presenterDidChange());const R=re.Settings.get(ie.SettingKeys.nameTagVisibility),M=W.NameTagVisibility[R||""];this.nameTagVisibility=M||W.NameTagVisibility.Activity,this.coEditingTrace=P.traceSource.withName(D.vsls.TraceSources.ClientCoEditing),this.vsCodeEventTrace=P.traceSource.withName(D.vsls.TraceSources.ClientCoEditingVSCodeEvent),this.bufferManagerTrace=P.traceSource.withName(D.vsls.TraceSources.ClientCoEditingBufferManager),this.summonsSemaphore=new k.default(1),this.fileSystemManager=h.fileSystemManager,this.syncService=h.syncService,this.diagnosticOutputTraceListener=new A.OutputTraceListener("Visual Studio Live Share Coediting"),this.updateDiagnosticModeSetting(),this.diffViewCoEditing=new se.DiffView(this.pathManager),this.diffViewCoEditing.onDidOpenDiffView((h,m)=>this.onDiffViewOpen(h,m)),this.diffViewCoEditing.onDidCloseDiffView((h,m)=>this.onDiffViewClosed(h,m)),this.diffViewCoEditing.onDidOpenNewGitDocument(h=>this.onNewGitDocument(h)),this.vscodeEventSubscriptions.push(this.diffViewCoEditing),this.coEditingTrace.info(`Name tag behavior: ${this.nameTagVisibility}`),this.captureVisibleEditorInformation(C.window.visibleTextEditors),this.followingLabelDecoratorManager=new q.FollowingLabelDecoratorManager(this,this.collaboratorManager),this.vscodeEventSubscriptions.push(C.workspace.onDidChangeTextDocument(h=>{try{this._onDidChangeTextDocument(h)}catch(h){$.CoauthoringTelemetry.ReportCoeditingError("onDidChangeTextDocument error",h)}})),this.vscodeEventSubscriptions.push(C.window.onDidChangeTextEditorSelection(h=>this._onDidChangeTextEditorSelection(h)));try{"function"==typeof C.window.onDidChangeNotebookEditorSelection&&this.vscodeEventSubscriptions.push(C.window.onDidChangeNotebookEditorSelection(h=>this._onDidChangeNotebookEditorSelection(h))),"function"==typeof(null===(y=C.notebooks)||void 0===y?void 0:y.onDidSaveNotebookDocument)&&this.vscodeEventSubscriptions.push(null===(T=C.notebooks)||void 0===T?void 0:T.onDidSaveNotebookDocument(h=>this._onDidSaveNotebookDocument(h))),"function"==typeof C.window.onDidChangeNotebookEditorVisibleRanges&&this.vscodeEventSubscriptions.push(C.window.onDidChangeNotebookEditorVisibleRanges(h=>this._onDidChangeNotebookEditorVisibleRanges(h)))}catch(h){}this.vscodeEventSubscriptions.push(C.window.onDidChangeVisibleTextEditors(h=>v(this,void 0,void 0,(function*(){return yield this._onDidChangeVisibleTextEditors(h)})))),this.vscodeEventSubscriptions.push(C.window.onDidChangeActiveTextEditor(h=>this._onDidChangeActiveTextEditor(h))),this.vscodeEventSubscriptions.push(C.workspace.onDidCloseTextDocument(h=>this.onDidCloseTextDocument(h))),this.vscodeEventSubscriptions.push(C.workspace.onDidOpenTextDocument(h=>this.onDidOpenTextDocument(h))),this.vscodeEventSubscriptions.push(C.workspace.onDidSaveTextDocument(h=>this._onDidSaveTextDocument(h))),this.vscodeEventSubscriptions.push(C.workspace.onDidChangeConfiguration(h=>this._onDidChangeConfiguration(h))),"function"==typeof C.window.onDidChangeTextEditorVisibleRanges&&this.vscodeEventSubscriptions.push(C.window.onDidChangeTextEditorVisibleRanges(h=>this._onDidChangeTextEditorVisibleRanges(h))),this.vscodeEventSubscriptions.push(B.ExtensionUtil.registerCommand("liveshare.getCoeditingInformation",this.copyCoeditingInformationToClipboard,this)),this.settingsCallbacks["liveshare.nameTagVisibility"]=this.updateNametagVisibilitySetting,this.settingsCallbacks["liveshare.diagnosticLogging"]=this.updateDiagnosticLoggingSetting,this.settingsCallbacks["liveshare.showReadOnlyUsersInEditor"]=this.updateShowReadOnlyUsersInEditorSetting,this.settingsCallbacks["liveshare.diagnosticMode"]=this.updateDiagnosticModeSetting,me.workspaceSessionInfoTracker.onAccessLevelChangedInSession(this.onAccessLevelChanged)}get isHost(){return!this.isGuest}get isReadOnlyGuest(){return this.isGuest&&this.clientAccessCheck().isReadOnly}init(){if(this.sourceEventService.onEvent(h=>{this.trackMessage(h),this.messageProcessQueue=this.messageProcessQueue.then(()=>this._onMessage(h))},null,this.vscodeEventSubscriptions),this.fileService.onFilesChanged(h=>this.fileServiceFilesChanged(h)),this.isGuest){this.joiningInitialFiles={};const h=I.MessageFactory.JoinRequestMessage(this.clientID);this.postMessage(h),this.sendPing(),this.shouldCheckSync=!0,setTimeout(()=>this.checkSync(),1e4),C.workspace.textDocuments.length>0&&C.workspace.textDocuments.forEach(h=>{var m;const y=null===(m=this.pathManager.localPathToRelativePath(h.uri))||void 0===m?void 0:m.toLowerCase();y&&(this.savingFiles[y]=!0,h.save())})}this.onPin(h=>{if(h>0){const m=I.MessageFactory.FollowChangeMessage(this.clientID,h,!0);this.postMessage(m)}}),this.onUnpin(h=>{if(h>0){const m=I.MessageFactory.FollowChangeMessage(this.clientID,h,!1);this.postMessage(m)}}),this.shareActiveDocumentIfHost(),this.updatePinIconFromActiveEditor(),this._listenForUserInitiatedUndoRedo(),$.CoauthoringTelemetry.init(),this.coEditingTrace.addTraceListener($.CoauthoringTelemetry.logListener),this.vsCodeEventTrace.addTraceListener($.CoauthoringTelemetry.logListener),this.bufferManagerTrace.addTraceListener($.CoauthoringTelemetry.logListener)}resetLanguageServicesDataStructures(){this.textChangeEventHistory=[],this.unacknowledgedTextChangeIds={}}get currentServerVersion(){return this.serverVersion}get currentHighestLocalTextChange(){return this.highestLocalTextChange}get textChangeHistory(){return this.textChangeEventHistory}get hasUnacknowledgedTextChanges(){return this.removeOldUnacknowledgedTextChanges(),0!==Object.keys(this.unacknowledgedTextChangeIds).length}removeOldUnacknowledgedTextChanges(){const h=(new Date).getTime();for(const m in this.unacknowledgedTextChangeIds)h-this.unacknowledgedTextChangeIds[m]>5e3&&(delete this.unacknowledgedTextChangeIds[m],oe.Telemetry.sendFault($.Event.DROPPED_HOST_MESSAGE_FAULT,oe.FaultType.NonBlockingFault,"Did not receive acknowledgement of host message"))}recordIntoBucket(h,m,y){if(void 0!==h&&this.trackedMessages.has(h)){const v=this.trackedMessages.get(h);if("number"!=typeof v.receivedTime)return;if(m===Ee.SendBucket){this.sendBuckets.get(y).RecordTime(Date.now()-v.receivedTime)}else if(m===Ee.ReceivedBucket){this.receivedBuckets.get(y).RecordTime(Date.now()-v.receivedTime)}}}postMessage(h){if(this.isDisposed)return;h.sendId=CoEditing.sendId++;const m=h.trackingId;h.messageType===D.vsls.MessageType.TextChange?(this.highestLocalTextChange=h.sendId,this.unacknowledgedTextChangeIds[h.sendId]=(new Date).getTime(),this.recordIntoBucket(m,Ee.SendBucket,h.messageType)):h.messageType!==D.vsls.MessageType.LayoutScroll&&h.messageType!==D.vsls.MessageType.SelectionChange||this.recordIntoBucket(m,Ee.SendBucket,h.messageType),this.diagnosticOutputTraceListener.writeLine("coediting",`Post message: ${JSON.stringify(h)}`,!0),this.sourceEventService.fireEventAsync(I.CoauthoringService.SERVICE,JSON.stringify(h))}dispose(){this.isDisposed=!0,clearTimeout(this.pingTimeout),this.clientDecoratorManagers&&Object.keys(this.clientDecoratorManagers).forEach(h=>{this.clientDecoratorManagers[h].dispose()}),this.coEditorsJoinedEvent.removeAllListeners(),this.vscodeEventSubscriptions.forEach(h=>{h.dispose()}),this.nextDocumentChangeListener.dispose(),this.positionTracker.dispose(),this.updatePinableCommandStatus(!1),this.setPinned(!1),this.summoningParticipants=null,$.CoauthoringTelemetry.SessionClosed(this.jumpCount,this.failedJumpCount,this.pinCount,this.unpinCount,this.autoUnpinCount,this.syncCheckCount,this.failedSyncCheckCount,this.slowSyncCheckCount,this.openDiffCount,this.closedDiffCount),Object.keys(this.sharedFileClients).forEach(h=>{this.sharedFileClients[h].dispose()}),Object.keys(this.sharedBinaryFileClients).forEach(h=>{this.sharedBinaryFileClients[h].dispose()}),this.followingLabelDecoratorManager.dispose(),this.onFollowedEvent.removeAllListeners(),this.onUnfollowedEvent.removeAllListeners(),this.onPinEvent.removeAllListeners(),this.onUnpinEvent.removeAllListeners(),this.onUpdateCoEditorPositionEvent.removeAllListeners(),this.onUpdateCoEditorVisibleRangesEvent.removeAllListeners(),this.shouldCheckSync=!1;const h=new Map([...this.receivedBuckets,...this.sendBuckets]);$.CoauthoringTelemetry.ReportMetrics(h.values())}_listenForUserInitiatedUndoRedo(){re.featureFlags.localUndo&&(this.vscodeEventSubscriptions.push(B.ExtensionUtil.registerCommand("undo",this.performUserInitiatedUndo,this)),this.vscodeEventSubscriptions.push(B.ExtensionUtil.registerCommand("redo",this.performUserInitiatedRedo,this)))}trackMessage(h){const m=w();h.trackingId=m;const y={receivedTime:Date.now()};return this.trackedMessages.set(m,y),setTimeout(()=>this.trackedMessages.delete(m),6e4),m}getTrackedMessageData(h){return this.trackedMessages.get(h)}getClientIdForTextDocumentChangeEvent(h){return v(this,void 0,void 0,(function*(){const m=yield this.getTextDocumentChangeEventMessageData(h);return null==m?void 0:m.clientId}))}getTextDocumentChangeEventMessageData(h){return v(this,void 0,void 0,(function*(){if(this.textDocumentChangeEventMessageData.has(h))return this.textDocumentChangeEventMessageData.get(h);if(!this.textDocumentChangeEventMessageDataRequests.has(h)){let m;const y=new Promise((h,y)=>{m=h}),v=new Promise((h,m)=>{setTimeout(()=>h(void 0),1e3)}),C=Promise.race([y,v]);this.textDocumentChangeEventMessageDataRequests.set(h,{result:C,resolve:m})}return yield this.textDocumentChangeEventMessageDataRequests.get(h).result}))}_onDidChangeTextDocument(h){const m=Object.assign({},h);this.trackMessage(m);const y=this.pathManager.localPathToRelativePath(m.document.uri);if(null===y)return;this.lastEditTimeForDoc.set(y,(new Date).getTime()),this.vsCodeEventTrace.verbose(`onDidChangeTextDocument for ${ye(y)}: ${JSON.stringify(h.contentChanges.map(h=>({range:h.range,rangeLength:h.rangeLength,rangeOffset:h.rangeOffset,text:h.text.length})))}`);const v=this.getSharedFileClient(y);if(!v)return void this.coEditingTrace.warning(`Edited a shared document that did not have a file client opened (${ye(y)})`);const C=v.getBufferManagerStatus();if(m.contentChanges.length>0&&0===C.localChangesQueue&&C.collabBufferText===m.document.getText())return this.resyncSignal&&this.resyncSignal.resolve(),void this.coEditingTrace.verbose(`Ignoring onDidChangeTextDocument for ${ye(y)}`);this.vsCodeEventTrace.verbose(`Handling onDidChangeTextDocument for ${ye(y)}`);let T=!1;if(this.isHost&&(T=v.updateDirtyState(m.document.isDirty)),0===m.contentChanges.length)return void this.vsCodeEventTrace.verbose("onDidChangeTextDocument: Document dirty state changes");const w=v.onDidChangeTextDocument(m);this.textDocumentChangeEventMessageData.set(h,w),this.textDocumentChangeEventMessageDataRequests.has(h)&&this.textDocumentChangeEventMessageDataRequests.get(h).resolve(w),this.positionTracker.onDidChangeTextDocument(y,m),!v.waitingForRemoteEditsToBeApplied()&&T&&(m.document.uri.scheme===ue.PathManager.notebookCellScheme?this.postNotebookSaveMessageToOtherParticipants(m.document.fileName):this.postSaveMessageToOtherParticipants(v.fileName))}_onDidChangeTextEditorVisibleRanges(h){const m=Object.assign({},h);let y=this.trackMessage(m);if(!h.textEditor||!h.textEditor.document)return;const v=this.pathManager.localPathToRelativePath(h.textEditor.document.uri);if(!v)return;const C=getEditorId(h.textEditor);this.recentlyScrolled[C]||(this.vsCodeEventTrace.verbose(`onDidChangeTextEditorVisibleRanges (${ye(v)}): ${JSON.stringify(h.visibleRanges)}`),this.sendLayoutChangeMessage(v,C,h.visibleRanges,y))}_onDidChangeNotebookEditorVisibleRanges(h){if(!h.notebookEditor||!h.notebookEditor.document)return;const m=this.pathManager.localPathToRelativePath(h.notebookEditor.document.uri);if(!m)return;if(this.recentlyScrolled[getEditorId(h.notebookEditor)])return;this.vsCodeEventTrace.verbose(`onDidChangeNotebookEditorVisibleRanges (${ye(m)}): ${JSON.stringify(h.visibleRanges)}`);let y=h.visibleRanges;if(y.length<1)return;const v=y[0],C=I.MessageFactory.NotebookScrollMessage(this.clientID,m,v.start,v.end);this.postMessage(C)}_onDidChangeTextEditorSelection(h){const m=Object.assign({},h);let y=this.trackMessage(m);if(this.justChangedDocumentTimeout&&(clearTimeout(this.justChangedDocumentTimeout),this.justChangedDocumentTimeout=null),!h.textEditor||!h.textEditor.document)return;const v=h.textEditor.document,C=this.pathManager.localPathToRelativePath(v.uri);C&&this.vsCodeEventTrace.verbose(`onDidChangeTextEditorSelection (${ye(C)}): ${JSON.stringify(h.selections)}`),this.sendSelectionChangeMessage(v,h.selections,h.kind,void 0,y)}_onDidChangeNotebookEditorSelection(h){if(!h.notebookEditor||!h.notebookEditor.document)return;const m=this.pathManager.localPathToRelativePath(h.notebookEditor.document.uri);if(h.selections[0]){const y=I.MessageFactory.NotebookSelectionChangeMessage(this.clientID,m,h.selections[0].start);this.postMessage(y)}}_onDidChangeActiveTextEditor(h){var m;return v(this,void 0,void 0,(function*(){if(h&&h.document&&X.sessionStateTracker.State===G.SessionState.Shared&&re.Settings.get(ie.SettingKeys.shareExternalFiles)&&!C.workspace.getWorkspaceFolder(h.document.uri)&&"output"!==(null===(m=h.document.uri)||void 0===m?void 0:m.scheme)&&(yield this.fileService.registerExternalFilesAsync([h.document.uri.toString()]),new oe.TelemetryEvent(ae.TelemetryEventNames.ADD_EXTERNAL_FILE).send()),this.updatePinIconFromActiveEditor(),!h||!h.document)return void this.updatePinableCommandStatus(!1);const y=h.document,v=this.pathManager.localPathToRelativePath(y.uri);null!==v&&(this.vsCodeEventTrace.info(`onDidChangeActiveTextEditor (${ye(v)})`),this.shareActiveDocumentIfHost(),this.justChangedDocumentTimeout=setTimeout(()=>this.sendCurrentSelectionMessage(),500),Object.keys(this.clientDecoratorManagers).forEach(h=>{this.clientDecoratorManagers[h].updateDecorators()}))}))}_onDidChangeVisibleTextEditors(h){return v(this,void 0,void 0,(function*(){this.vsCodeEventTrace.verbose(`onDidChangeVisibleTextEditors (new active viewcolumns: ${h.map(h=>h.viewColumn).join(", ")})`),this.onDidChangeVisibleRanges(),this.diffViewCoEditing.onEditorsChanged(h,this.isHost,this.clientID);let m=h=h.filter(h=>{var m,y;return void 0!==h.viewColumn||[ue.PathManager.fileScheme,ue.PathManager.gitScheme,ue.PathManager.vslsSccScheme,ue.PathManager.rawScheme].includes(null===(y=null===(m=null==h?void 0:h.document)||void 0===m?void 0:m.uri)||void 0===y?void 0:y.scheme)});try{m=m.concat(C.window.visibleNotebookEditors)}catch(h){}this.activeEditorsChangedTimeout&&(clearTimeout(this.activeEditorsChangedTimeout),this.activeEditorsChangedTimeout=null),this.activeEditorsChangedTimeout=setTimeout(()=>{this.activeEditorsChangedTimeout=null,this.captureVisibleEditorInformation(m),this.presentationManager.isStrictFollowEnabled&&this.presentationManager.currentPresenterId!==this.clientID&&!this.isPinned(this.presentationManager.currentPresenterId)&&this.pin(null,this.presentationManager.currentPresenterId,!0)},1)}))}onDiffViewOpen(h,m){this.postDiffViewOpenMessageToOtherParticipants(h,m)}onDiffViewClosed(h,m){this.postDiffViewClosedMessageToOtherParticipants(h,m)}onNewGitDocument(h){let m=this.pathManager.localPathToRelativePath(h.uri);this.getSharedFileClient(m)||this.performFileOpenHandshake(m,h.getText())}onDidChangeVisibleRanges(){const h=[];for(let m of C.window.visibleTextEditors){const y=this.pathManager.localPathToRelativePath(m.document.uri),v=this.getSharedFileClient(y);v?h.push(Object.assign({editorId:getEditorId(m),fileVersion:v.version},v.getEditorVisibleRanges(m.visibleRanges))):h.push({editorId:getEditorId(m),fileVersion:-1,fileName:y})}const m=I.MessageFactory.VisibleRangesChangeMessage(this.clientID,h);this.postMessage(m)}_addPinnedInfoForEditor(h,m,y=-1){const v=getEditorId(h),C=this.currentVisibleEditors[v];let T=C?C.pinnedClient:-1;y>-1&&(T=y);const w={pinnedClient:T,column:h.viewColumn||1,id:v};m[getEditorId(h)]=w}getEditorInfoForClient(h){let m=null;return Object.keys(this.currentVisibleEditors).some(y=>{const v=this.currentVisibleEditors[y];return v.pinnedClient===h&&(m=v,!0)}),m}getColumnForPinnedClient(h){const m=this.getEditorInfoForClient(h);return null==m?C.ViewColumn.Active:m.column}getClientIdIfEditorIsPinned(h){if(!h)return-1;const m=getEditorId(h),y=this.currentVisibleEditors[m];return y?y.pinnedClient:-1}captureVisibleEditorInformation(h){let m={};h.forEach(h=>this._addPinnedInfoForEditor(h,m)),this.currentVisibleEditors=m,this.updatePinIconFromActiveEditor()}getClientVisibleRanges(h){return this.clientVisibileRanges[h]}onDidOpenTextDocument(h){return v(this,void 0,void 0,(function*(){const m=this.pathManager.localPathToRelativePath(h.uri);this.coEditingTrace.verbose(`onDidOpenTextDocument ${ye(m)}`),h.isUntitled&&this.isHost&&this.postUntitledFileOpenedMessageToOtherParticipants(m)}))}onDidCloseTextDocument(h){return v(this,void 0,void 0,(function*(){let m=this.pathManager.localPathToRelativePath(h.uri);this.coEditingTrace.verbose(`onDidCloseTextDocument ${ye(m)}`);let y=this.getSharedFileClient(m);if(!y)return;y.clearUndoStateDueToDocumentClosing();let v=this.getNewNameFromRename(y.fileName);if(v)this.renameSharedFileClient(y,v);else{if(h.isUntitled&&this.isHost){this.postUntitledFileClosedMessageToOtherParticipants(m);const h=this.pathManager.getFromVslsPathsToLocalPaths(m);h&&(this.pathManager.deleteFromLocalPathsToVslsPaths(h),this.pathManager.deleteFromVslsPathsToLocalPaths(m))}!this.isGuest&&(yield N.fileAccess.existsAsync(h.fileName))}}))}getNewNameFromRename(h){const m=this.pendingRenames.filter(m=>m.oldName===h)[0];if(!m)return null;const y=this.pendingRenames.indexOf(m);return this.pendingRenames.splice(y,1),m.newName}saveDocument(h,m){if(!h)return;const y=this.pathManager.localPathToRelativePath(h.uri);if(!y)return;if(this.fileSaveRequestsPaused)return;if(this.vsCodeEventTrace.info(`onDidSaveDocument (${ye(y)})`),this.isHost){const m=this.getSharedFileClient(y);m&&(m.takeSnapshot(),m.updateDirtyState(h.isDirty))}const v=y.toLowerCase();this.savingFiles[v]?delete this.savingFiles[v]:(this.vsCodeEventTrace.info(`onDidSaveDocument (${ye(y)})`),m(y),this.activeFileName&&this.activeFileName.startsWith(this.untitledPrefix)&&this.isHost&&new oe.TelemetryEvent($.Event.SAVE_UNTITLED_FILE).send())}_onDidSaveNotebookDocument(h){this.saveDocument(h,h=>this.postNotebookSaveMessageToOtherParticipants(h))}_onDidSaveTextDocument(h){this.saveDocument(h,h=>this.postSaveMessageToOtherParticipants(h))}postSaveMessageToOtherParticipants(h){const m=I.MessageFactory.SaveFileMessage(this.clientID,h);this.postMessage(m)}postNotebookSaveMessageToOtherParticipants(h){const m=I.MessageFactory.SaveNotebookMessage(this.clientID,h);this.postMessage(m)}postUntitledFileOpenedMessageToOtherParticipants(h){const m=I.MessageFactory.UntitledFileOpenedMessage(this.clientID,h);this.postMessage(m),new oe.TelemetryEvent($.Event.ADD_UNTITLED_FILE).send()}postUntitledFileClosedMessageToOtherParticipants(h){const m=I.MessageFactory.UntitledFileClosedMessage(this.clientID,h);this.postMessage(m),new oe.TelemetryEvent($.Event.CLOSE_UNTITLED_FILE).send()}postDiffViewOpenMessageToOtherParticipants(h,m){const y=I.MessageFactory.DiffViewOpenMessage(this.clientID,h,m);this.postMessage(y),this.openDiffCount++}postDiffViewClosedMessageToOtherParticipants(h,m){const y=I.MessageFactory.DiffViewClosedMessage(this.clientID,h,m);this.postMessage(y),this.closedDiffCount++}_onDidChangeConfiguration(h){z.ExtensionTelemetry.reportChangedSetting(),Object.keys(this.settingsCallbacks).forEach(m=>{h.affectsConfiguration(m)&&this.settingsCallbacks[m]()})}pauseProcessingFileSaveRequests(){this.fileSaveRequestsPaused=!0}resumeProcessingFileSaveRequests(){this.fileSaveRequestsPaused=!1}fileServiceFilesChanged(h){h.changes.forEach(h=>v(this,void 0,void 0,(function*(){if(!h.fullPath)return;const m=U.PathUtil.getRelativePathFromPrefixedPath(h.fullPath);let y;if(y=this.sharedBinaryFileClients[m.toLowerCase()]?this.getSharedBinaryFileClient(m):this.getSharedFileClient(m),this.coEditingTrace.verbose(`fileServiceFilesChanged for ${ye(m)} Change type: ${h.changeType}`),h.changeType!==D.vsls.FileChangeType.Added&&h.changeType!==D.vsls.FileChangeType.Updated||(this.isHost&&y&&!C.workspace.textDocuments.find(h=>{var m;return(null===(m=this.pathManager.localPathToRelativePath(h.uri))||void 0===m?void 0:m.toLowerCase())===y.fileName.toLowerCase()})?this.resetFileClient(y.fileName):this.isHost&&y&&this.sharedBinaryFileClients[y.fileName.toLowerCase()]&&this.resetBinaryFileClient(y.fileName)),h.changeType===D.vsls.FileChangeType.Added){const h=C.workspace.textDocuments.find(h=>this.pathManager.localPathToRelativePath(h.uri)===m);if(this.isGuest&&h&&h.isDirty&&!y){if(ce.getExpService().getTreatmentVariable("vscode","saveDirtyDocOnReadd")){this.savingFiles[m.toLowerCase()]=!0;let y=!1;try{y=yield h.save()}catch(h){}Z.assert(y,"Document should save successfully"),this.fileSystemManager().workspaceProvider.fireFilesChanged([{type:C.FileChangeType.Changed,uri:this.pathManager.relativePathToLocalPath(m)}])}}else this.isGuest&&this.sharedBinaryFileClients[y.fileName.toLowerCase()]&&(this.resetBinaryFileClient(y.fileName),this.fileSystemManager().workspaceProvider.fireFilesChanged([{type:C.FileChangeType.Changed,uri:this.pathManager.relativePathToLocalPath(m)}]))}y&&h.changeType===D.vsls.FileChangeType.Deleted&&this.removeSharedFileClient(y)})))}_onMessage(h){return v(this,void 0,void 0,(function*(){if(this.diagnosticOutputTraceListener.writeLine("coediting",`Receive message: ${JSON.stringify(h)}`,!0),this.isDisposed)return;if(h.sourceId!==I.CoauthoringService.SERVICE)return;if(-1!==this.highestReceivedEventId){checkForDroppedMessage(this.highestReceivedEventId+1,h.eventId,this.droppedEventIds,"eventId")}h.eventId<=this.highestReceivedEventId?this.coEditingTrace.error(`Message out of order: received ${h.eventId}, highest received is ${this.highestReceivedEventId}`):this.highestReceivedEventId=h.eventId;let m=JSON.parse(h.jsonContent);m=I.MessageFactory.CoauthoringMessage(m);const y=h.trackingId;m.trackingId=y,void 0!==y&&this.trackedMessages.has(y)&&(this.trackedMessages.get(y).clientId=m.clientId),this.recordActivity(m),m.messageType!==D.vsls.MessageType.TextChange&&m.messageType!==D.vsls.MessageType.SelectionChange&&m.messageType!==D.vsls.MessageType.LayoutScroll&&m.messageType!==D.vsls.MessageType.VisibleRangesChange&&m.messageType!==D.vsls.MessageType.NotebookScroll&&m.messageType!==D.vsls.MessageType.NotebookSelectionChange||fe.SessionTelemetry.recordActivity();try{const y=m.clientId;if(m.messageType===D.vsls.MessageType.TextChange){let h=m;h.clientId===this.clientID&&void 0!==h.sendId&&delete this.unacknowledgedTextChangeIds[h.sendId],void 0!==h.changeServerVersion&&(this.serverVersion=h.changeServerVersion,this.textChangeEventHistory.length>=this.textChangeEventHistoryMaxSize&&this.textChangeEventHistory.shift(),this.textChangeEventHistory.push(h))}if(void 0===y)return;if("number"==typeof m.sendId&&m.sendId>0){if("number"!=typeof this.highestSendId[y]&&(this.highestSendId[y]=-1),-1!==this.highestSendId[y]){checkForDroppedMessage(this.highestSendId[y]+1,m.sendId,this.droppedSendIds,"sendId")}m.sendId<=this.highestSendId[y]?this.coEditingTrace.error(`Message from client #${y} out of order: received ${m.sendId}, highest received is ${this.highestSendId[y]}`):this.highestSendId[y]=m.sendId}if(y===this.clientID&&m.messageType!==D.vsls.MessageType.TextChange&&m.messageType!==D.vsls.MessageType.AnonymousAccessLevelChange&&m.messageType!==D.vsls.MessageType.Ping&&m.messageType!==D.vsls.MessageType.JoinAcknowledge)return;let v=m.fileName,T=this.getSharedFileClient(v);if(I.IsFileContentMessage(m)&&!T){if(v)switch(m.messageType){case D.vsls.MessageType.TextChange:this.coEditingTrace.info(`The file client does not exist yet; queuing file message for ${ye(v)}: ${m.messageType}`),this.unprocessedMessages[v]||(this.unprocessedMessages[v]=[]),this.unprocessedMessages[v].push(new O.MessageAndVersionNumber(m,h.eventId));break;case D.vsls.MessageType.SelectionChange:this.coEditingTrace.info(`Processing a selection change for a file client that does not exist yet (${ye(v)})`),this.updateCoEditorPosition(m)}return}switch(this.coEditingTrace.verbose(`Received ${m.messageType} message for (${ye(v)})`),m.messageType){case D.vsls.MessageType.TextChange:case D.vsls.MessageType.SelectionChange:const v=m.fileVersion;T&&T.onIncomingMessage(m,h.eventId,v);break;case D.vsls.MessageType.NotebookSelectionChange:this.updateNotebookCellSelection(m);break;case D.vsls.MessageType.VisibleRangesChange:this.updateCoEditorVisibleRanges(m);break;case D.vsls.MessageType.LayoutScroll:this.updateCoEditorScrollPosition(m);break;case D.vsls.MessageType.NotebookScroll:this.updateCoEditorNotebookScrollPosition(m);break;case D.vsls.MessageType.AnonymousAccessLevelChange:const w=me.workspaceSessionInfoTracker.getAccessLevelChangedUserID();this.updateDecorators(w);break;case D.vsls.MessageType.JoinRequest:if(this.fireCoEditorsJoined([y]),!this.isHost)break;const A=this.collaboratorManager.getCollaboratorSessionIds();A.unshift(this.clientID);const P=this.activeFileName,k=[];Object.keys(this.sharedFileClients).forEach(h=>{const m=this.sharedFileClients[h].fileName;m===P?k.unshift(m):k.push(m)}),Object.keys(this.sharedBinaryFileClients).forEach(h=>{const m=this.sharedBinaryFileClients[h].fileName;m===P?k.unshift(m):k.push(m)}),this.postMessage(I.MessageFactory.JoinAcknowledgeMessage(this.clientID,y,A,k)),this.isHost&&this.presentationManager.presentationMode&&this.sendPresenterUpdateMessage(this.presentationManager.currentPresenterId);break;case D.vsls.MessageType.JoinAcknowledge:const R=m;R.joinerId===this.clientID?(this.initialPinIdToOwner=R.clientId,this.fireCoEditorsJoined(R.clientIds||[]),(R.files||[]).forEach((h,m)=>{const y=h.toLowerCase();this.joiningInitialFiles[y]=!0;const v=0===m;this.requestOpenSharedFile(h,v)})):this.isGuest&&this.sendCurrentSelectionMessage(),setTimeout(()=>this.onDidChangeVisibleRanges(),500);break;case D.vsls.MessageType.PresenterUpdate:const M=m;if(M.newPresenterId<0)return;this.presentationManager.presentationMode=!0,this.presenterIdToClear=this.presentationManager.currentPresenterId,this.presentationManager.updatePresenterId(M.newPresenterId);break;case D.vsls.MessageType.FollowChange:const N=m;if(N.followedClient!==this.clientID)return;this.followingMe.set(N.clientId,N.follow),N.follow?this.onFollowedEvent.emit(this.onFollowedEventName):this.onUnfollowedEvent.emit(this.onUnfollowedEventName);break;case D.vsls.MessageType.SaveFile:const x=m;this.onSaveFileMessage(x);try{const h=yield this.pathManager.openRelativePath(x.fileName);yield h.save()}catch(h){}break;case D.vsls.MessageType.SaveNotebook:const O=m,L=this.onSaveFileMessage(O);if(!L)break;try{const h=yield this.pathManager.relativePathToLocalPath(L);(yield C.workspace.openNotebookDocument(h)).save()}catch(h){}break;case D.vsls.MessageType.UntitledFileOpened:const U=m;if(U.fileName){const h=this.pathManager.relativePathToLocalPath(U.fileName);this.openUntitledFiles.has(h.path)||(this.openUntitledFiles.set(h.path,{type:C.FileType.File,ctime:(new Date).getTime(),mtime:(new Date).getTime(),size:0}),this.fileSystemManager().workspaceProvider.fireFilesChanged([{type:C.FileChangeType.Created,uri:h}]),this.fileSystemManager().workspaceProvider.fireFilesChanged([{type:C.FileChangeType.Changed,uri:h}]))}break;case D.vsls.MessageType.UntitledFileClosed:const B=m;if(B.fileName){const h=this.pathManager.relativePathToLocalPath(B.fileName);this.openUntitledFiles.delete(h.path),this.pathManager.deleteFromLocalPathsToVslsPaths(B.fileName),this.fileSystemManager().workspaceProvider.fireFilesChanged([{type:C.FileChangeType.Deleted,uri:h}]);const m=this.getSharedFileClient(h.path);m&&this.removeSharedFileClient(m)}break;case D.vsls.MessageType.DiffViewOpen:{const h=m;let y=this.pathManager.relativePathToLocalPath(h.leftFile),v=this.pathManager.relativePathToLocalPath(h.rightFile);this.diffViewCoEditing.saveDiffViewInformation(m.clientId,y,v);break}case D.vsls.MessageType.DiffViewClosed:{const h=m;let y=this.pathManager.relativePathToLocalPath(h.leftFile),v=this.pathManager.relativePathToLocalPath(h.rightFile);this.diffViewCoEditing.removeDiffViewInformation(m.clientId,y,v);break}case D.vsls.MessageType.FileOpenAcknowledge:const W=m;if(W.joinerId===this.clientID&&W.fileName){const h=W.fileName.toLowerCase();this.pendingFileHandshakeCallbacks[h]?this.pendingFileHandshakeCallbacks[h](W):this.coEditingTrace.warning(`Received unrequested fileOpenAcknowledge message for ${ye(W.fileName)}`)}else this.isGuest&&W.fileName===this.activeFileName&&this.sendCurrentSelectionMessage();break;case D.vsls.MessageType.FileOpenRequest:const q=m,Y=q.fileName;if(!Y)break;if(this.isGuest){if(!this.getSharedFileClient(Y))if(Y.startsWith(ue.PathManager.gitPrefix)){let h;h=yield C.workspace.openTextDocument(this.pathManager.relativePathToLocalPath(Y)),this.performFileOpenHandshake(Y,h.getText())}else this.requestOpenSharedFile(Y);break}let V=this.getSharedFileClient(Y);if(!V){let h;try{h=yield this.pathManager.openRelativePath(Y)}catch(h){const m=I.MessageFactory.FileOpenAcknowledgeMessage(this.clientID,Y,0,y,0,0,[],Se.unableToOpen,[],!0,!0);this.postMessage(m),this.coEditingTrace.error(Se.unableToOpen.toString());break}V=this.createSharedFileClient(Y,h.getText(),h.isDirty,0,h.languageId)}let $=V.getSavedSnapshotOrFallback(q.hashCode||NaN);const z=V.getCurrentHistory(),G=z.shift(),J=I.MessageFactory.FileOpenAcknowledgeMessage(this.clientID,Y,V.version,y,$.serverVersionNumber,G.serverVersionNumber,$.changes,$.fallbackText,z,!1,!1);this.postMessage(J),q.sendJumpTo&&q.fileName===this.activeFileName&&this.sendCurrentSelectionMessage(y);break;case D.vsls.MessageType.ResetFileClient:if(this.isHost||!T)break;yield this.removeSharedFileClient(T);const X=C.workspace.textDocuments.find(h=>{var m;return(null===(m=this.pathManager.localPathToRelativePath(h.uri))||void 0===m?void 0:m.toLowerCase())===T.fileName.toLowerCase()});X&&X.save().then(()=>{this.fileSystemManager().workspaceProvider.fireFilesChanged([{type:C.FileChangeType.Changed,uri:this.pathManager.relativePathToLocalPath(T.fileName)}])});break;case D.vsls.MessageType.Handshake:const Z=m;T&&T.onHandshake(Z);break;case D.vsls.MessageType.Summon:const ee=m;this.summoningParticipants||(this.summoningParticipants=new Set),void 0!==ee.recipientId&&ee.recipientId===this.clientID&&(this.summoningParticipants.add(m.clientId),this.RespondToSummonsAsync(m.clientId)),this.summoningParticipants.has(m.clientId)||void 0!==ee.recipientId||(this.summoningParticipants.add(m.clientId),this.RespondToSummonsAsync(m.clientId));break;case D.vsls.MessageType.Ping:m.clientId===this.clientID&&this.receivePing();break;default:this.coEditingTrace.warning(`Received unknown message type: ${m.messageType}`)}}catch(h){const y=`Rejected promise while processing a coauthoring message of type ${m.messageType}`;this.coEditingTrace.error(`${y}`),$.CoauthoringTelemetry.ReportCoeditingError(y,h)}}))}onSaveFileMessage(h){if(this.isReadOnlyGuest||!h.fileName)return;const m=h.fileName.toLowerCase();return this.savingFiles[m]=!0,m}recordActivity(h){switch(h.messageType){case D.vsls.MessageType.SaveFile:{const m=h;R.activitySource.fire({timestamp:new Date,name:`${R.ActivityType.workspace}/saveFile`,data:{peer:m.clientId,file:this.pathManager.relativePathToLocalPath(m.fileName)}});break}case D.vsls.MessageType.FileOpenRequest:{const m=h;R.activitySource.fire({timestamp:new Date,name:`${R.ActivityType.workspace}/openFile`,data:{peer:m.clientId,file:this.pathManager.relativePathToLocalPath(m.fileName)}});break}}}RespondToSummonsAsync(h){return v(this,void 0,void 0,(function*(){if(yield this.summonsSemaphore.acquire(),!this.positionTracker.getClientPosition(h))return this.summoningParticipants.delete(h),void this.summonsSemaphore.release();if("accept"===re.Settings.get(ie.SettingKeys.focusBehavior)){let m=te.localize("notification.FocusAccept");m=m.replace("$(userId)",this.collaboratorManager.getDisplayName(h)),C.window.showInformationMessage(m),this.pin(this.activeEditor,h)}else{let m=te.localize("notification.FocusRequest");m=m.replace("$(userId)",this.collaboratorManager.getDisplayName(h));const y="Follow",v="Ignore";(yield C.window.showInformationMessage(m,y,v))===y&&this.pin(this.activeEditor,h)}this.summoningParticipants.delete(h),this.summonsSemaphore.release()}))}getSharedFileClientFromEditor(h){if(!h||!h.document)return null;const m=this.pathManager.localPathToRelativePath(h.document.uri);return this.getSharedFileClient(m)}getSharedFileClient(h){if("string"!=typeof h)return null;const m=h.toLowerCase();return this.sharedFileClients[m]||null}getSharedBinaryFileClient(h){if("string"!=typeof h)return null;const m=h.toLowerCase();return this.sharedBinaryFileClients[m]||null}createSharedBinaryFileClient(h,m,y=0,v=!1,C=!1){const T=this.getSharedBinaryFileClient(h);if(T){if(!v)return this.coEditingTrace.warning(`Attempted to re-create an existing file client for ${ye(h)}`),T;T.version+1}this.coEditingTrace.info(`Creating binary file client for ${ye(h)}`),this.pathManager.relativePathToLocalPath(h);const w=h.toLowerCase(),A=new ClientBinaryFileData(h,m);return T&&this.removeSharedFileClient(T),this.sharedBinaryFileClients[w]=A,C&&this.postMessage(I.MessageFactory.FileOpenRequestMessage(this.clientID,h,0,!1)),A}createSharedFileClient(h,m,y,v=0,C,T=!1,w=!1){const A=this.getSharedFileClient(h);if(A){if(!T)return this.coEditingTrace.warning(`Attempted to re-create an existing file client for ${ye(h)}`),A;v=A.version+1}this.coEditingTrace.info(`Creating file client for ${ye(h)}`);const P=this.pathManager.relativePathToLocalPath(h),k=h.toLowerCase(),R=new ClientFileData(this,h,P,m,this.bufferManagerTrace,y,v);return A&&this.removeSharedFileClient(A),this.sharedFileClients[k]=R,C&&R.setLanguageId(C),R.takeSnapshot(),w&&this.postMessage(I.MessageFactory.FileOpenRequestMessage(this.clientID,h,0,!1)),R}renameSharedFileClient(h,m){const y=h.fileName.toLowerCase();delete this.sharedFileClients[y],h.updateFileName(m),this.sharedFileClients[m.toLowerCase()]=h}removeSharedFileClient(h){return v(this,void 0,void 0,(function*(){this.coEditingTrace.verbose(`removeSharedFileClient ${ye(h.fileName)}`),this.sharedBinaryFileClients[h.fileName.toLowerCase()]?delete this.sharedBinaryFileClients[h.fileName.toLowerCase()]:delete this.sharedFileClients[h.fileName.toLowerCase()];const m=new M.Signal;this.pendingFileClientDeletes.set(h.fileName.toLowerCase(),m.promise),yield h.dispose(),m.resolve(),this.pendingFileClientDeletes.delete(h.fileName.toLowerCase())}))}shareActiveDocumentIfHost(){if(this.isGuest)return;const h=this.activeFileName;if(!h||this.getSharedFileClient(h))return;const m=this.activeEditor,y=m&&m.document;y&&(this.createSharedFileClient(h,y.getText(),y.isDirty,0,y.languageId),this.postMessage(I.MessageFactory.FileOpenRequestMessage(this.clientID,h,0,!1)))}requestOpenSharedFile(h,m=!1){return v(this,void 0,void 0,(function*(){if(this.isHost)return;let y;try{y=yield this.pathManager.openRelativePath(h,m)}catch(h){return}const v=this.getSharedFileClient(h);v&&(v.setLanguageId(y.languageId),v.drainMessageQueue())}))}performBinaryFileOpenHandshake(h,m){return v(this,void 0,void 0,(function*(){const y=this.getSharedBinaryFileClient(h);if(y){const h=y.getContent();return Promise.resolve(h)}const v=yield this.readAsBinaryFile(m.path);return this.createSharedBinaryFileClient(h,v,0),Promise.resolve(v)}))}readAsBinaryFile(h){return v(this,void 0,void 0,(function*(){const m=new D.vsls.FileReadOptions;return m.useBase64=!0,yield this.fileService.readTextAsync(h,m)}))}performFileOpenHandshake(h,m){return v(this,void 0,void 0,(function*(){if(this.isHost)return!0;const y=h.toLowerCase();if(this.pendingFileClientDeletes.has(y)&&(yield this.pendingFileClientDeletes.get(y)),this.pendingFileSync[y])return this.pendingFileSync[y];const T=this.getSharedFileClient(h);return T?T.getBufferContent():this.pendingFileSync[y]=new Promise((T,w)=>v(this,void 0,void 0,(function*(){const v=yield new Promise((v,C)=>{this.pendingFileHandshakeCallbacks[y]=v;const T=L.calculateFileHash(m),w=!!this.joiningInitialFiles[y];delete this.joiningInitialFiles[y];const A=I.MessageFactory.FileOpenRequestMessage(this.clientID,h,T,w||-1!==this.initialPinIdToOwner);this.postMessage(A)});if(delete this.pendingFileHandshakeCallbacks[y],v.wasUnableToOpen)return delete this.pendingFileSync[y],void T(!1);const w=v.fallbackText?v.fallbackText:m,A=new V.CollabBuffer(w,this.coEditingTrace);(v.changes||[]).forEach(m=>{this.coEditingTrace.verbose(`Applying file open acknowledge message change for ${ye(h)}`),A.applyRemoteEdits(m.filter(h=>void 0!==h.start&&void 0!==h.length).map(h=>({position:h.start,length:h.length,text:h.newText||""})))});const P=this.createSharedFileClient(h,A.getContent(),!1,v.fileVersion);P.initializeHistory(v),this.unprocessedMessages[h]&&(this.unprocessedMessages[h].forEach(h=>{P.onIncomingMessage(h.message,h.serverVersionNumber,h.message.fileVersion,O.CoeditingIncomingMessageBehavior.Queue),P.updateInitialHistoryHighWatermark(h.serverVersionNumber)}),delete this.unprocessedMessages[h]);const k=C.workspace.textDocuments.find(h=>{var m;return(null===(m=this.pathManager.localPathToRelativePath(h.uri))||void 0===m?void 0:m.toLowerCase())===y});k&&(P.queueMessages(),this.savingFiles[y]=!0,k.save().then(()=>{this.fileSystemManager().workspaceProvider.fireFilesChanged([{type:C.FileChangeType.Changed,uri:k.uri}]),setTimeout(()=>P.processMessages(),1e3)})),T(P.getBufferContent()),delete this.pendingFileSync[y]})))}))}uriToFileName(h){return this.pathManager.localPathToRelativePath(h)}updateNotebookCellSelection(h){return v(this,void 0,void 0,(function*(){const m=h.clientId;if(void 0===m||m===this.clientID||!h.fileName||void 0===h.index)return;const y=yield this.pathManager.openRelativePath(h.fileName);let v=new C.Position(h.index,0),T=new C.Range(v,v);this.positionTracker.setNotebookPosition(m,h.fileName,y,T,!1),this.updateDecorators(m);const w=this.getColumnForPinnedClient(m);w&&w!==C.ViewColumn.Active&&this.jumpTo(m),this.initialPinIdToOwner=-1}))}updateCoEditorPosition(h){return v(this,void 0,void 0,(function*(){const m=h.clientId;if(void 0===m||m===this.clientID||!h.fileName||void 0===h.start||void 0===h.length)return;let y;try{y=yield this.pathManager.openRelativePath(h.fileName)}catch(h){return}const v=this.getSharedFileClient(h.fileName);if(!v)return;const T=h.fileName,w=v.toVSCodeDocumentPos(h.start),A=v.toVSCodeDocumentPos(h.start+h.length),P=new C.Range(w,A);if(this.positionTracker.setClientPosition(m,T,y,P,h.isReversed||!1),!(yield this.clientAccessCheck().isClientReadOnly(m))||this.isPinned(m)||"always"===re.Settings.get(ie.SettingKeys.showReadOnlyUsersInEditor)){this.updateDecorators(m),h.forceJumpForClientId===this.clientID&&this.joinCompleted.then(()=>{-1!==this.initialPinIdToOwner?(this.initialPinIdToOwner=-1,C.window.visibleTextEditors.length>0?this.jumpTo(m,C.window.visibleTextEditors[0].viewColumn):this.jumpTo(m)):this.jumpTo(m)});const y=this.getColumnForPinnedClient(m);if(y&&y!==C.ViewColumn.Active)this.jumpTo(m,y,!1,!0);else{let h=this.getEditorInfoForClient(m);h&&void 0===h.column&&this.jumpTo(m)}}this.onUpdateCoEditorPositionEvent.emit(this.onUpdateCoEditorPositionEventName,{clientId:m,fileName:T,document:y,range:P,isReversed:h.isReversed||!1,kind:h.kind})}))}updateDecorators(h){const m=this.collaboratorManager.getDisplayName(h);this.clientDecoratorManagers[h]||(this.clientDecoratorManagers[h]=new W.ClientDecoratorManager(h,m,this.nameTagVisibility,this.positionTracker)),this.clientDecoratorManagers[h].updateNameTag(m),this.clientDecoratorManagers[h].updateDecorators()}updateCoEditorVisibleRanges(h){const m=[];for(let y of h.clientVisibleRanges){const v=this.getSharedFileClient(y.fileName);if(v&&v.version===y.fileVersion){const C=v.transformVisibleRanges(h.clientId,y).visibleRanges.map(h=>v.vslsRangeToVSCodeRange(h));m.push({fileName:y.fileName,editorId:y.editorId,visibleRanges:C})}else m.push({fileName:y.fileName,editorId:y.editorId,visibleRanges:[]})}this.clientVisibileRanges[h.clientId]=m,this.onUpdateCoEditorVisibleRangesEvent.emit(this.onUpdateCoEditorVisibleRangesEventName,{clientId:h.clientId,reason:J.UpdateCoEditorVisibleRangesReason.EDITORS})}updateCoEditorScrollPosition(h){let m=null;const y=this.getSharedFileClient(h.fileName);if(y&&(m=y.transformScrollSelectionToCurrent(h)),!m||!y)return;this.clientVisibileRanges[h.clientId]||(this.clientVisibileRanges[h.clientId]=[]);const v={fileName:h.fileName,editorId:h.editorId,visibleRanges:m.visibleRanges.map(h=>y.vslsRangeToVSCodeRange(h))};let T=this.clientVisibileRanges[h.clientId].findIndex(h=>h.editorId===v.editorId);T>=0&&this.clientVisibileRanges[h.clientId].splice(T,1),this.clientVisibileRanges[h.clientId].push(v),this.onUpdateCoEditorVisibleRangesEvent.emit(this.onUpdateCoEditorVisibleRangesEventName,{clientId:h.clientId,fileName:h.fileName,editorId:h.editorId,reason:J.UpdateCoEditorVisibleRangesReason.SCROLL});const w=y.vslsRangeToVSCodeRange(m),A=this.getEditorInfoFromScrollMessage(h);if(!A)return;const P=C.window.visibleTextEditors.find(h=>getEditorId(h)===(null==A?void 0:A.id));if(!P)return;P.revealRange(w,C.TextEditorRevealType.Default);const k=h.trackingId;this.recordIntoBucket(k,Ee.ReceivedBucket,D.vsls.MessageType.LayoutScroll),this.updateRecentlyScrolled(A.id)}updateCoEditorNotebookScrollPosition(h){const m=this.getEditorInfoFromScrollMessage(h);if(!m)return;let y;try{y=C.window.visibleNotebookEditors.find(h=>getEditorId(h)===(null==m?void 0:m.id))}catch(h){}if(!y)return;const v=new C.NotebookRange(h.start,h.end);y.revealRange(v,C.NotebookEditorRevealType.AtTop)}getEditorInfoFromScrollMessage(h){if(h.clientId===this.clientID)return;return this.getEditorInfoForClient(h.clientId||NaN)}updateRecentlyScrolled(h){const m=this.recentlyScrolled[h];m&&clearTimeout(m),this.recentlyScrolled[h]=setTimeout(()=>{delete this.recentlyScrolled[h]},CoEditing.recentlyScrolledTimeout)}jumpToNotebook(h,m,y,T=!1,w){return v(this,void 0,void 0,(function*(){const y=C.workspace.notebookDocuments.find(h=>h.uri.toString()===m.documentUri.toString()),v=yield C.window.showNotebookDocument(y);if(w){let h=C.window.visibleTextEditors;try{h=h.concat(C.window.visibleNotebookEditors),this.captureVisibleEditorInformation(h)}catch(h){}}if(this._addPinnedInfoForEditor(v,this.currentVisibleEditors,h),this.updatePinIconFromActiveEditor(),!w){const h=m.range.start.line,y=new C.NotebookRange(h,h);v.revealRange(y,C.NotebookEditorRevealType.AtTop)}}))}jumpTo(h,m,y=!1,w){return v(this,void 0,void 0,(function*(){let A=this.positionTracker.getClientPosition(h);if(y&&++this.jumpCount,!A)return void(y&&(++this.failedJumpCount,this.showJumpFailedNotification()));if(A.notebookPosition)return yield this.jumpToNotebook(h,A.notebookPosition,m,y,w);if(A.documentPosition&&A.documentPosition.documentUri.toString().startsWith(ue.PathManager.notebookCellScheme))return yield this.jumpToNotebook(h,A.documentPosition,m,y,w);const P=A.documentPosition;if(!P)return void(y&&(++this.failedJumpCount,this.showJumpFailedNotification()));this.jumpToInProgress=!0;const k=yield this.pathManager.openRelativePath(P.fileName);let R;const M=this.pathManager.relativePathToLocalPath(P.fileName);let N=this.diffViewCoEditing.findDiffViewInformation(h,M);if(N){let h=T.basename(N.leftFile.path);yield C.commands.executeCommand("vscode.diff",N.leftFile,N.rightFile,h,{}),R=C.window.visibleTextEditors.filter(h=>h.document.uri.toString()===M.toString())[0]}else R=yield function asyncThrowableWithRetry(h,m=3){return v(this,void 0,void 0,(function*(){for(let y=0;y<m-1;y++)try{return yield h()}catch(h){}return h()}))}(()=>C.window.showTextDocument(k,m,!0));this._addPinnedInfoForEditor(R,this.currentVisibleEditors,h),this.jumpToInProgress=!1,this.updatePinIconFromActiveEditor(),void 0===R.visibleRanges[0].intersection(P.range)&&(yield C.commands.executeCommand("editor.unfold",{selectionLines:[P.range.start.line],levels:Number.MAX_VALUE,direction:"up"}),R.revealRange(P.range,C.TextEditorRevealType.Default))}))}pin(h,m,y){if(oe.Telemetry.sendTelemetryEvent(ae.TelemetryEventNames.PIN),++this.pinCount,!this.positionTracker.getClientPosition(m))return++this.failedJumpCount,void this.showJumpFailedNotification();h&&this._addPinnedInfoForEditor(h,this.currentVisibleEditors,m);let v=h?h.viewColumn:C.ViewColumn.Active;!y&&v||(v=-2),B.ExtensionUtil.setCommandContext("liveshare:isFollowing",!0),this.jumpTo(m,v).then(()=>this.updateDecorators(m)),this.onPinEvent.emit(this.onPinEventName,m)}getUsersBeingFollowed(){const h={};for(let m of Object.keys(this.currentVisibleEditors)){h[this.currentVisibleEditors[m].pinnedClient]=!0}return h}getUsersFollowingYou(){return this.followingMe}unpinByEditor(h,{explicit:m=!1}){const y=getEditorId(h),v=this.currentVisibleEditors[y];v&&-1!==v.pinnedClient&&(m?++this.unpinCount:++this.autoUnpinCount,this.unpin(v))}unpinByClient(h,{explicit:m=!1}){const y=this.getEditorInfoForClient(h);if(!y)return;m&&++this.unpinCount,this.unpin(y);const v=I.MessageFactory.FollowChangeMessage(this.clientID,h,!1);this.postMessage(v),this.onUnpinEvent.emit(this.onUnpinEventName,h)}unpin(h){if(this.presentationManager.isStrictFollowEnabled&&this.presentationManager.currentPresenterId!==this.clientID&&h.id===this.getEditorInfoForClient(this.presentationManager.currentPresenterId).id)return;const m=h.pinnedClient;!function(h){v(this,void 0,void 0,(function*(){try{(yield h.clientAccessCheck().isClientReadOnly(m))&&h.clientDecoratorManagers[m]&&"always"!==re.Settings.get(ie.SettingKeys.showReadOnlyUsersInEditor)&&(h.clientDecoratorManagers[m].dispose(),delete h.clientDecoratorManagers[m])}catch(m){h.coEditingTrace.error("Error unpinning read-only participant")}}))}(this),h.pinnedClient=-1;const y=this.activeEditor;y&&getEditorId(y)===h.id&&this.setPinned(!1)}isPinned(h){return null!==this.getEditorInfoForClient(h)}updatePinableCommandStatus(h){B.ExtensionUtil.setCommandContext("liveshare:isFollowable",h)}setPinned(h,m=-1){h?this.onPinEvent.emit(this.onPinEventName,m):this.onUnpinEvent.emit(this.onUnpinEventName,m),B.ExtensionUtil.setCommandContext("liveshare:isFollowing",h)}updatePinIconFromActiveEditor(){if(this.jumpToInProgress)return;if(null===this.activeFileName)return void this.updatePinableCommandStatus(!1);this.updatePinableCommandStatus(!0);const h=this.activeEditor,m=h?this.currentVisibleEditors[getEditorId(h)]:null;m&&m.pinnedClient>-1?this.setPinned(!0,m.pinnedClient):this.setPinned(!1)}sendPresenterUpdateMessage(h){const m=I.MessageFactory.PresenterUpdateMessage(this.clientID,h);this.postMessage(m)}presenterDidChange(){if(this.isHost)this.sendPresenterUpdateMessage(this.presentationManager.currentPresenterId),this.presentationManager.currentPresenterId!==this.clientID&&this.pin(null,this.presentationManager.currentPresenterId,!0);else{const h=this.getColumnForPinnedClient(this.presenterIdToClear);this.pin(null,this.presentationManager.currentPresenterId,h!==C.ViewColumn.One),this.presenterIdToClear=this.presentationManager.currentPresenterId}}lastKnownFileForClient(h){var m,y;const v=this.positionTracker.getClientPosition(h),C=(null===(m=null==v?void 0:v.documentPosition)||void 0===m?void 0:m.fileName)||(null===(y=null==v?void 0:v.notebookPosition)||void 0===y?void 0:y.fileName);return null==C?void 0:C.replace(/^\/*/,"")}onCoEditorSwitchedFile(h){this.positionTracker.onCoEditorSwitchedFile(h)}onCoEditorsJoined(h){this.coEditorsJoinedEvent.addListener(this.coEditorsJoinedEventName,h)}onFollowed(h){return this.onFollowedEvent.addListener(this.onFollowedEventName,h),new C.Disposable(()=>{this.onFollowedEvent.removeListener(this.onFollowedEventName,h)})}onUnfollowed(h){return this.onUnfollowedEvent.addListener(this.onUnfollowedEventName,h),new C.Disposable(()=>{this.onUnfollowedEvent.removeListener(this.onUnfollowedEventName,h)})}onPin(h){return this.onPinEvent.addListener(this.onPinEventName,h),new C.Disposable(()=>{this.onPinEvent.removeListener(this.onPinEventName,h)})}onUnpin(h){return this.onUnpinEvent.addListener(this.onUnpinEventName,h),new C.Disposable(()=>{this.onUnpinEvent.removeListener(this.onUnpinEventName,h)})}onUpdateCoEditorPosition(h){return this.onUpdateCoEditorPositionEvent.addListener(this.onUpdateCoEditorPositionEventName,h),new C.Disposable(()=>{this.onUpdateCoEditorPositionEvent.removeListener(this.onUpdateCoEditorPositionEventName,h)})}onUpdateCoEditorVisibleRanges(h){this.onUpdateCoEditorVisibleRangesEvent.addListener(this.onUpdateCoEditorVisibleRangesEventName,h)}onWorkspaceSessionChanged(h){return v(this,void 0,void 0,(function*(){const m=h.sessionNumber;h.changeType===D.vsls.WorkspaceSessionChangeType.Unjoined&&this.collaboratorManager.wasCoEditor(m)&&(this.clientDecoratorManagers[m]&&(this.clientDecoratorManagers[m].dispose(),delete this.clientDecoratorManagers[m]),"number"==typeof this.highestSendId[m]&&delete this.highestSendId[m],this.unpinByClient(m,{explicit:!1}))}))}performUserInitiatedUndo(h){return v(this,void 0,void 0,(function*(){let m=this.getSharedFileClientFromEditor(this.activeEditor);!!m&&m.undoLastLocalEdit()||C.commands.executeCommand("default:undo",h)}))}performUserInitiatedRedo(h){return v(this,void 0,void 0,(function*(){let m=this.getSharedFileClientFromEditor(this.activeEditor);!!m&&m.redoLastLocalEdit()||C.commands.executeCommand("default:redo",h)}))}sendCurrentSelectionMessage(h){const m=this.activeEditor;if(!m)return;const y=m.document;let v=m.selections;if((!v||!v.length)&&y){const h=y.positionAt(0);v.push(new C.Selection(h,h))}this.sendSelectionChangeMessage(y,v,void 0,h,void 0)}get activeDocument(){return this.activeEditor?this.activeEditor.document:null}get activeFileName(){return this.fileNameForEditor(this.activeEditor)}get activeEditor(){const h=C.window.activeTextEditor;return h&&(this.lastActiveEditor=h),this.lastActiveEditor}fileNameForEditor(h){if(!h||!h.document)return null;const m=h.document.uri;return this.pathManager.localPathToRelativePath(m)}sendLayoutChangeMessage(h,m,y,v){const C=this.getSharedFileClient(h);h&&C&&C.onDidChangeTextEditorVisibleRange(h,m,y,v)}sendSelectionChangeMessage(h,m,y,v,C){const T=this.pathManager.localPathToRelativePath(h.uri),w=this.getSharedFileClient(T);T&&w&&w.onDidChangeTextEditorSelection(m,T,y,v,C)}fireCoEditorsJoined(h){this.collaboratorManager.coEditorsJoined(h),this.coEditorsJoinedEvent.emit(this.coEditorsJoinedEventName,h)}showJumpFailedNotification(){C.window.showInformationMessage("The target participant is not currently editing a shared document")}resyncDocument(h){return v(this,void 0,void 0,(function*(){return this.isGuest?this.resyncDocumentGuest(h):this.resyncDocumentHost(h)}))}resyncDocumentGuest(h){return v(this,void 0,void 0,(function*(){const m=yield C.workspace.openTextDocument(h),y=this.pathManager.localPathToRelativePath(h),T=this.getSharedFileClient(y);let w=T.getBufferManagerStatus();if(L.removeLineEndings(w.collabBufferText)===L.removeLineEndings(m.getText()))return;new oe.TelemetryEvent($.Event.RESYNC_DOCUMENT).send();let A=!1;yield M.withRetries(()=>v(this,void 0,void 0,(function*(){A=m.isDirty,this.savingFiles[y]=!0;let h=!1;try{h=yield m.save()}catch(h){}if(Z.assert(h,"resyncDocument: document should save successfully"),w=T.getBufferManagerStatus(),L.removeLineEndings(w.collabBufferText)===L.removeLineEndings(m.getText()))return;Z.assert(void 0===this.resyncSignal,"Should only be one resync in progress at a time"),this.resyncSignal=new M.Signal;const v=new M.Signal;if(setTimeout(()=>v.resolve(!0),5e3),this.fileSystemManager().workspaceProvider.fireFilesChanged([{type:C.FileChangeType.Changed,uri:m.uri}]),yield Promise.race([this.resyncSignal.promise,v.promise]),this.resyncSignal=void 0,L.removeLineEndings(w.collabBufferText)!==L.removeLineEndings(m.getText()))throw new Error("Did not resync document successfully")}))),T.clearLocalChangesQueue()}))}resyncDocumentHost(h){return v(this,void 0,void 0,(function*(){const m=yield C.workspace.openTextDocument(h),y=this.pathManager.localPathToRelativePath(h),T=this.getSharedFileClient(y),w=T.getBufferManagerStatus();L.removeLineEndings(w.collabBufferText)!==L.removeLineEndings(m.getText())&&(new oe.TelemetryEvent($.Event.RESYNC_DOCUMENT).send(),yield M.withRetries(()=>v(this,void 0,void 0,(function*(){const y=m.validateRange(new C.Range(0,0,Number.MAX_SAFE_INTEGER,Number.MAX_SAFE_INTEGER)),v=new C.WorkspaceEdit;if(v.replace(h,y,w.collabBufferText),!(yield C.workspace.applyEdit(v))||L.removeLineEndings(w.collabBufferText)!==L.removeLineEndings(m.getText()))throw new Error("Did not resync document successfully")}))),T.clearLocalChangesQueue())}))}sendPing(){this.pingTimeout||(this.postMessage(I.MessageFactory.PingMessage(this.clientID)),this.pingTimeout=setTimeout(()=>{new oe.TelemetryEvent($.Event.SLOW_PING).send(),he.showDiagnosticErrorMessage("Slow Live Share connection")},1e4))}receivePing(){clearTimeout(this.pingTimeout),this.pingTimeout=void 0,setTimeout(()=>this.sendPing(),1e4)}getFileHash(h,m=!0){return v(this,void 0,void 0,(function*(){const y=C.workspace.textDocuments.filter(m=>this.pathManager.localPathToRelativePath(m.uri)===h);if(0===y.length&&m){return yield this.pathManager.openRelativePath(h),yield this.getFileHash(h,!1)}return Z.assert(1===y.length,`One and only one document should match file name. Actual: ${y.length}`),L.calculateFileHash(L.removeLineEndings(y[0].getText()))}))}checkFuzzyDesync(h,m){if(m)this.desyncedFiles.has(h)&&(this.desyncedFiles.delete(h),$.CoauthoringTelemetry.ReportFalseDesync());else{const m="autoSave";if(!this.desyncedFiles.has(h)){this.desyncedFiles.add(h);const y=h.split("."),v=y.length>1?y.pop():"NA",T=U.PathUtil.getMonikerFromRelativePath(h).moniker||"None",w=C.workspace.getConfiguration().files[m];$.CoauthoringTelemetry.ReportFuzzyDesync(v,T,w),he.showDiagnosticErrorMessage("Desync Detected!")}}}isFileSynced(h,m){return v(this,void 0,void 0,(function*(){if((new Date).getTime()-(this.lastEditTimeForDoc.get(h)||0)<=CoEditing.syncTime)return!0;const y=(yield this.getFileHash(h))===m;return this.checkFuzzyDesync(h,y),y}))}checkSync(){return v(this,void 0,void 0,(function*(){if(this.shouldCheckSync){if(this.activeDocument){const h=this.pathManager.localPathToRelativePath(this.activeDocument.uri);if(h){if((new Date).getTime()-(this.lastEditTimeForDoc.get(h)||0)>CoEditing.syncTime)try{const m=(new Date).getTime(),y=yield this.syncService.checkSyncAsync(h,L.calculateFileHash(L.removeLineEndings(this.activeDocument.getText()))),v=(new Date).getTime()-m>CoEditing.slowSyncCheckTime;v&&(this.slowSyncCheckCount++,$.CoauthoringTelemetry.ReportSlowSyncCheck()),this.syncCheckCount++,$.CoauthoringTelemetry.ReportSyncCheck(),y?this.checkFuzzyDesync(h,y):v||(this.failedSyncCheckCount++,this.checkFuzzyDesync(h,y))}catch(h){if(h.code===ee.RpcErrorCodes.ServiceNotAvailable)return void(this.shouldCheckSync=!1);this.coEditingTrace.error("Failed to check sync status")}}}setTimeout(()=>this.checkSync(),CoEditing.syncTime)}}))}checkSyncForVersion(h,m,y,C){return v(this,void 0,void 0,(function*(){if(this.shouldCheckSyncForVersion)try{const v=yield this.syncService.checkSyncForVersion2Async(h,m,y,C);$.CoauthoringTelemetry.ReportSyncCheckForVersion(!0),Z.assert(v.isSynced,"File should be in sync on guest")}catch(h){h.code!==ee.RpcErrorCodes.ServiceNotAvailable&&h.code!==ee.RpcErrorCodes.MethodNotFound||(this.shouldCheckSyncForVersion=!1),this.coEditingTrace.error("Failed to check sync for version.")}}))}isFileSyncedForVersion(h,m,y,C){return v(this,void 0,void 0,(function*(){$.CoauthoringTelemetry.ReportSyncCheckForVersion(!1);const v=this.getSharedFileClient(h);if(!h||!v)return Z.assert(!1,"Host should have a file client for file guest is trying to check sync of"),Promise.resolve({isSynced:!1,fileVersion:0});let T=!0;return void 0!==m&&v.version!==m||(T=yield v.isFileSyncedForVersion(y,C),Z.assert(T,"File should be in sync on host")),{isSynced:T,fileVersion:v.version}}))}getCoeditingInformation(){return C.window.visibleTextEditors.map(h=>h.document).filter(h=>h.uri.scheme!==ue.PathManager.outputScheme).map(h=>this.getCoeditingInformationForDocument(h)).join("\n\n")}getCoeditingInformationForDocument(h){const m=this.pathManager.localPathToRelativePath(h.uri),y=this.getSharedFileClient(m);let v=`Document URI: ${h.uri.toString()}\nRelative path: ${m}\nHas file client: ${!!y}`;if(y){const m=h.getText()===y.getBufferContent(),C=y.getBufferManagerStatus();delete C.collabBufferText,v+=`\nBuffer contents match document contents: ${m}\nBuffer manager status: ${JSON.stringify(C,null,2)}`}return v}copyCoeditingInformationToClipboard(){return v(this,void 0,void 0,(function*(){const h=this.getCoeditingInformation();yield(new pe.ClipboardUtil).copyToClipboardAsync(h),C.window.showInformationMessage(te.localize("notification.CoeditingInformationCopiedToClipboard"))}))}resetFileClient(h){return v(this,void 0,void 0,(function*(){if(!this.isHost)return;if(!this.getSharedFileClient(h))return;let m;try{m=yield this.pathManager.openRelativePath(h)}catch(h){return void Z.assert(!1,"Should be able to open document that is being reset")}const y=this.createSharedFileClient(h,m.getText(),m.isDirty,void 0,m.languageId,!0);this.postMessage(I.MessageFactory.ResetFileClientMessage(this.clientID,y.fileName))}))}resetBinaryFileClient(h){return v(this,void 0,void 0,(function*(){if(!this.getSharedBinaryFileClient(h))return;const m=yield this.readAsBinaryFile(h),y=this.createSharedBinaryFileClient(h,m,void 0,!0,!0);this.postMessage(I.MessageFactory.ResetFileClientMessage(this.clientID,y.fileName))}))}}m.CoEditing=CoEditing,CoEditing.sendId=0,CoEditing.recentlyScrolledTimeout=250,CoEditing.syncTime=5e3,CoEditing.slowSyncCheckTime=1e4;class NextDocumentChangeListener{constructor(){this.listeningTo=new Set,this.changeEvents={},this.listener=C.workspace.onDidChangeTextDocument(h=>{const m=h.document.uri.toString();this.listeningTo.has(m)&&(this.changeEvents[m]=h,this.listeningTo.delete(m))})}dispose(){this.listener.dispose()}startListening(h){const m=h.toString();this.changeEvents[m]&&delete this.changeEvents[m],this.listeningTo.add(m)}stopListening(h){return this.changeEvents[h.toString()]}}class ClientBinaryFileData{constructor(h,m,y=0){this.currentFileName=h,this.content=m,this.versionValue=y}getContent(){return this.content}get version(){return this.versionValue}get fileName(){return this.currentFileName}dispose(){}}m.ClientBinaryFileData=ClientBinaryFileData;class ClientFileData{constructor(h,m,y,T,w,A,P=0){this.client=h,this.wasDirty=A,this.lastLocalEdit=null,this.simultaneousEdits=0,this.lineDiffCount=0,this.lineDiffSum=0,this.visibleEdits=0,this.invisibleEdits=0,this.remoteEdits=0,this.localEdits=0,this.wasLastEditRemote=!1,this.isMarkedReadOnlyByOwner=!1,this.queueBehavior=O.CoeditingIncomingMessageBehavior.QueueAndProcess,this.editTransitionCounts=[0,0,0],this.currentFileName=m,this.versionValue=P;const k=this,R=new class{constructor(){this.clientID=h.clientID,this.clientCount=10,this.trace=w}applyEdit(T,w){var A,P;return v(this,void 0,void 0,(function*(){const v="string"==typeof w?h.getTrackedMessageData(w):void 0,R=new C.WorkspaceEdit;R.set(y,T),k.editMessageData=v,h.nextDocumentChangeListener.startListening(y),this.trace.verbose(`vscode.workspace.applyEdit for ${ye(m)}: ${JSON.stringify(T.map(h=>({range:h.range,newText:h.newText.length,newEol:h.newEol})))}`);const M=yield C.workspace.applyEdit(R);this.trace.verbose(`vscode.workspace.applyEdit result for ${ye(m)}: ${M}`);const N=null===(A=h.nextDocumentChangeListener.stopListening(y))||void 0===A?void 0:A.contentChanges;return k.editMessageData=void 0,M&&v&&void 0!==v.receivedTime&&h.recordIntoBucket(w,Ee.ReceivedBucket,D.vsls.MessageType.TextChange),M?N&&function changesMatchEdits(h,m){if(h.length!==m.length)return!1;m=[...m];for(let y of h){const h=m.findIndex(h=>y.range.isEqual(h.range)&&y.newText===h.text);if(h<0)return!1;m.splice(h,1)}return!0}(T,N)?J.ApplyEditResult.SUCCESSFUL:(null===(P=ce.getExpService())||void 0===P?void 0:P.getTreatmentVariable(le.TreatmentVariables.VSCodeConfig,le.TreatmentVariables.ResyncOnMisappliedEdit))?J.ApplyEditResult.MODIFIED:J.ApplyEditResult.SUCCESSFUL:J.ApplyEditResult.FAILED}))}resync(){return h.resyncDocument(y)}checkSync(h){$.CoauthoringTelemetry.ReportLocalSyncCheck();const v=C.workspace.textDocuments.filter(h=>y.toString()===h.uri.toString());if(Z.assert(v.length>0,"Document should be open if performing sync check"),v.length>0){const y=v[0].getText();for(let h of v)Z.assert(h.getText()===y,"All documents for the same file should have the same text");Z.assert(y===h,"Buffer contents - with line endings - should match VS Code document text",void 0,m),Z.assert(L.removeLineEndings(y)===L.removeLineEndings(h),"Buffer contents should match VS Code document text",void 0,m)}}checkHostSync(y,v){h.checkSyncForVersion(m,P,y,v)}postMessage(m){I.IsFileContentMessage(m)&&(m.fileVersion=P),h.postMessage(m)}updateClientPosition(m){h.updateCoEditorPosition(m)}undoBufferToMatchContents(h){return v(this,void 0,void 0,(function*(){const m=C.window.activeTextEditor;if(!m)return"";let y=m.document;const v=y.getText();return yield repeatCommandUntilContentMatches("undo",h,y,this.trace),v}))}redoUntilNoMoreToRedo(m,y){return v(this,void 0,void 0,(function*(){const v=C.window.activeTextEditor;if(!v)return;const T=v.document,w=T.uri.toString(),A=C.workspace.onDidChangeTextDocument(m=>{m=Object.assign({},m),h.trackMessage(m),m.document.uri.toString()===w&&y(m)});yield repeatCommandUntilContentMatches("redo",m,T,this.trace),A.dispose()}))}performSingleUndo(){const h=C.window.activeTextEditor;if(!h)return Promise.resolve({edits:[],contents:""});const m=h.document;return new Promise(h=>{const y=[],v=m.uri;let T=C.workspace.onDidChangeTextDocument(h=>{h.document.uri.toString()===v.toString()&&y.push(...h.contentChanges)});C.commands.executeCommand("default:undo",null).then(()=>{h({edits:y,contents:m.getText()}),T.dispose()})})}performSingleRedo(){const h=C.window.activeTextEditor;if(!h)return Promise.resolve("");const m=h.document;return new Promise(h=>{C.commands.executeCommand("default:redo",null).then(()=>{h(m.getText())})})}};this.bufferManager=new O.VSCodeBufferManager(R,m,T,h.isHost)}get version(){return this.versionValue}queueMessages(){this.queueBehavior=O.CoeditingIncomingMessageBehavior.Queue}processMessages(){this.queueBehavior!==O.CoeditingIncomingMessageBehavior.QueueAndProcess&&(this.queueBehavior=O.CoeditingIncomingMessageBehavior.QueueAndProcess,this.drainMessageQueue())}clearLocalChangesQueue(){this.bufferManager.clearLocalChangesQueue()}onDidChangeTextDocument(h){if(!this.isMarkedReadOnlyByOwner)return this.updateEditTelemetry(h,this.waitingForRemoteEditsToBeApplied()),this.bufferManager.onDidChangeTextDocument(h),this.editMessageData}onDidChangeTextEditorSelection(h,m,y,v,C){this.isMarkedReadOnlyByOwner||this.bufferManager.onDidChangeTextEditorSelection(h,m,y,v,C)}onDidChangeTextEditorVisibleRange(h,m,y,v){this.bufferManager.onDidChangeTextEditorVisibleRanges(h,this.version,m,y,v)}getEditorVisibleRanges(h){return this.bufferManager.getEditorVisibleRanges(h)}transformVisibleRanges(h,m){return this.bufferManager.transformVisibleRangesToCurrent(h,m)}onIncomingMessage(h,m,y,v){"number"==typeof y&&this.version!==y||this.bufferManager.onIncomingMessage(h,m,v||this.queueBehavior)}isFileSyncedForVersion(h,m){return this.bufferManager.isFileSyncedForVersion(h,m)}onHandshake(h){this.bufferManager.onHandshake(h)}getBufferManagerStatus(){return this.bufferManager.getBufferManagerStatus()}waitingForRemoteEditsToBeApplied(){return this.bufferManager.getBufferManagerStatus().waitingForRemoteEditsToBeApplied}getBufferContent(){return this.bufferManager.getBufferManagerStatus().collabBufferText}updateDirtyState(h){let m=!1;return this.wasDirty||h||(m=!0),this.wasDirty=h,m}takeSnapshot(){this.bufferManager.takeSnapshot()}getSavedSnapshotOrFallback(h){return this.bufferManager.getSavedSnapshotOrFallback(h)}getCurrentHistory(){return this.bufferManager.getCurrentHistory()}undoLastLocalEdit(){return this.bufferManager.undoLastLocalEdit()}redoLastLocalEdit(){return this.bufferManager.redoLastLocalEdit()}clearUndoStateDueToDocumentClosing(){this.bufferManager.clearUndoStateDueToDocumentClosing()}get fileName(){return this.currentFileName}updateFileName(h){this.currentFileName=h,this.bufferManager.updateFileName(this.currentFileName)}initializeHistory(h){this.bufferManager.initializeHistory(h),this.isMarkedReadOnlyByOwner=h.isReadOnly||!1}updateInitialHistoryHighWatermark(h){this.bufferManager.updateInitialHistoryHighWatermark(h)}drainMessageQueue(){this.bufferManager.processQueuedMessages()}transformScrollSelectionToCurrent(h){return void 0!==h.fileVersion&&this.version!==h.fileVersion?null:this.bufferManager.transformScrollSelectionToCurrent(h)}toVSCodeDocumentPos(h){return this.bufferManager.toVSCodeDocumentPos(h)}vslsRangeToVSCodeRange(h){const m=this.toVSCodeDocumentPos(h.start),y=this.toVSCodeDocumentPos(h.start+h.length);return new C.Range(m,y)}dispose(){return v(this,void 0,void 0,(function*(){$.CoauthoringTelemetry.BufferClosed(this.languageId||"",this.localEdits,this.remoteEdits,this.editTransitionCounts,this.bufferManager.numberOfLocalUndos,this.bufferManager.numberOfRemoteUndos,0,0,this.simultaneousEdits,this.lineDiffCount,this.lineDiffSum,this.visibleEdits,this.invisibleEdits),yield this.bufferManager.dispose()}))}setLanguageId(h){this.languageId=h}updateEditTelemetry(h,m){if(m?this.remoteEdits+=1:(this.localEdits+=1,this.lastLocalEdit=h),this.wasLastEditRemote===m)return;if(this.wasLastEditRemote=m,this.remoteEdits+this.localEdits===1)return;const y=this.timeOfLastEdit,v=(this.timeOfLastEdit=Date.now())-y;v>ClientFileData.slowEditTransitionTime?this.editTransitionCounts[2]+=1:v<ClientFileData.quickEditTransitionTime?this.editTransitionCounts[0]+=1:this.editTransitionCounts[1]+=1,m&&v<ClientFileData.slowEditTransitionTime&&this.updateSimultaneousEditingTelemetry(h)}updateSimultaneousEditingTelemetry(h){this.simultaneousEdits++;const m=ClientFileData.getDocumentChangeLineDiff(this.lastLocalEdit,h);void 0!==m&&(this.lineDiffCount++,this.lineDiffSum+=m);const y=ClientFileData.isDocumentChangeVisible(h);!0===y?this.visibleEdits++:!1===y&&this.invisibleEdits++}static getDocumentChangeLineDiff(h,m){if(h&&1===h.contentChanges.length&&1===m.contentChanges.length){let y=h.contentChanges[0].range,v=m.contentChanges[0].range;return y.start.line<=v.start.line?v.start.line-y.end.line:y.start.line-v.end.line}}static isDocumentChangeVisible(h){if(1!==h.contentChanges.length)return;const m=C.window.activeTextEditor;if(!m||h.document!==m.document)return!1;for(let y of m.visibleRanges)if(y.contains(h.contentChanges[0].range))return!0;return!1}}m.ClientFileData=ClientFileData,ClientFileData.quickEditTransitionTime=1e3,ClientFileData.slowEditTransitionTime=5e3},function(h,m,y){"use strict";var v,C=this&&this.__extends||(v=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(h,m){h.__proto__=m}||function(h,m){for(var y in m)m.hasOwnProperty(y)&&(h[y]=m[y])},function(h,m){function __(){this.constructor=h}v(h,m),h.prototype=null===m?Object.create(m):(__.prototype=m.prototype,new __)});m.__esModule=!0;var T=function(h){function Lock(){return h.call(this,1)||this}return C(Lock,h),Lock}(y(415).default);m.Lock=T},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0});const v=y(0);class ActivityType{}m.ActivityType=ActivityType,ActivityType.session="session",ActivityType.workspace="workspace",ActivityType.debug="debug",ActivityType.terminal="terminal";class ActivitySource{constructor(){this.activityEmitter=new v.EventEmitter}get onActivity(){return this.activityEmitter.event}fire(h){this.activityEmitter.fire(h)}}m.ActivitySource=ActivitySource,m.activitySource=new ActivitySource},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0});const v=y(0),C=y(983),T=y(168),w=y(37),A=y(167);class FollowingLabelDecorator{constructor(h,m,y){this.textEditor=h,this.coediting=m,this.collaboratorManager=y,this.disposables=[],this.updateDecorator(),this.disposables.push(this.coediting.onPin(()=>this.updateDecorator())),this.disposables.push(this.coediting.onUnpin(()=>this.updateDecorator()))}createTextEditorLabelDecorator(){const h=this.getClientName(this.followedClientId),m=T.SharedColors.requestColor(this.followedClientId);this.textEditorLabelDecorator=new C.TextEditorLabelDecorator(this.textEditor,`Following ${h}`,T.DecoratorUtils.toCssColor(m.backgroundColor),T.DecoratorUtils.toCssColor(m.textColor))}updateDecorator(){var h;this.updateFollowedClient()&&(this.textEditorLabelDecorator&&this.removeTextEditorLabelDecorator(),void 0!==this.followedClientId&&(this.textEditorLabelDecorator||(null===(h=w.getExpService())||void 0===h?void 0:h.getTreatmentVariable(A.TreatmentVariables.VSCodeConfig,A.TreatmentVariables.FollowIndicator))&&this.createTextEditorLabelDecorator()))}removeTextEditorLabelDecorator(){var h;null===(h=this.textEditorLabelDecorator)||void 0===h||h.dispose(),this.textEditorLabelDecorator=void 0}dispose(){this.disposables.forEach(h=>h.dispose()),this.removeTextEditorLabelDecorator()}updateFollowedClient(){const h=this.followedClientId;return this.followedClientId=this.coediting.getClientIdIfEditorIsPinned(this.textEditor),this.followedClientId<0&&(this.followedClientId=void 0),h!==this.followedClientId}getClientName(h){const m=this.collaboratorManager.getCollaborators()[h];return(null==m?void 0:m.name)||(null==m?void 0:m.userName)||(null==m?void 0:m.email)}}m.FollowingLabelDecoratorManager=class FollowingLabelDecoratorManager{constructor(h,m){this.coediting=h,this.collaboratorManager=m,this.followingLabelDecorators=new Map,this.disposables=[],this.updateFollowingLabelDecorators(),this.disposables.push(v.window.onDidChangeVisibleTextEditors(()=>this.updateFollowingLabelDecorators()))}updateFollowingLabelDecorators(){const h=Array.from(this.followingLabelDecorators.keys());h.filter(h=>v.window.visibleTextEditors.indexOf(h)<0).forEach(h=>{const m=this.followingLabelDecorators.get(h);this.followingLabelDecorators.delete(h),m.dispose()}),v.window.visibleTextEditors.filter(m=>h.indexOf(m)<0).forEach(h=>{this.followingLabelDecorators.set(h,new FollowingLabelDecorator(h,this.coediting,this.collaboratorManager))})}dispose(){for(let h of this.followingLabelDecorators.values())h.dispose();this.disposables.forEach(h=>h.dispose())}}},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0});const v=y(0),C=y(168),T=new v.ThemeColor("statusBar.foreground"),w=new v.ThemeColor("statusBar.background");m.TextEditorLabelDecorator=class TextEditorLabelDecorator{constructor(h,m,y,C){this.textEditor=h,this.label=m,this.backgroundColor=y,this.textColor=C,this.disposables=[],this.setInitialLongestLine(),this.createDecoration(),this.render(),this.disposables.push(v.window.onDidChangeTextEditorVisibleRanges(h=>{h.textEditor===this.textEditor&&this.render()})),this.disposables.push(v.workspace.onDidChangeTextDocument(h=>{if(h.document.uri.toString()!==this.textEditor.document.uri.toString())return;const m=this.longestLine;h.contentChanges.forEach(h=>{for(let m=h.range.start.line;m<=h.range.end.line;m++)this.updateLongestLine(m)}),this.longestLine!==m&&(this.createDecoration(),this.render())}))}createDecoration(){this.decoration&&this.decoration.dispose(),this.decoration=function getTextEditorLabelDecoration(h,m,y,A){const P=C.DecoratorUtils.stringifyCssProperties({"--scroll-signal":`calc(max(100%, ${m+15}ch) - 100%)`,"--amplified-scroll-signal":"calc(1000000000*var(--scroll-signal))","--right-for-scroll":"calc(100% - 50vw)","--right":"min(var(--amplified-scroll-signal), var(--right-for-scroll))",position:"absolute",padding:"0ch 4ch 0ch 4ch","border-radius":".5ch",top:"0ch",right:"var(--right)","pointer-events":"none","z-index":1}),k={rangeBehavior:v.DecorationRangeBehavior.ClosedClosed,after:{contentText:h,textDecoration:`none; ${P}`,backgroundColor:y||w,color:A||T}};return v.window.createTextEditorDecorationType(k)}(this.label,this.longestLine,this.backgroundColor,this.textColor),this.disposables.push(this.decoration)}setInitialLongestLine(){this.longestLine=0;for(let h=0;h<this.textEditor.document.lineCount;h++)this.updateLongestLine(h)}updateLongestLine(h){this.longestLine=Math.max(this.longestLine,this.textEditor.document.lineAt(h).text.replace(/\t/g,"    ").length)}render(){const h=Math.min(...this.textEditor.visibleRanges.map(h=>h.start.line)),m=new v.Position(h,0),y=new v.Range(m,m);this.textEditor.setDecorations(this.decoration,[y])}dispose(){this.disposables.forEach(h=>h.dispose())}}},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0});const v=y(0),C=y(13);class PositionTracker{constructor(){this.coEditorSwitchedFileEventName="coEditorSwitchedFile",this.namedPositionsChangedEventName="namedPositionsChanged",this.namedPositionsChanged=new C.EventEmitter,this.namedPositions={},this.clientPositions={},this.coEditorSwitchedFileEvent=new C.EventEmitter}dispose(){this.coEditorSwitchedFileEvent.removeAllListeners(),this.namedPositionsChanged.removeAllListeners(),this.namedPositions={}}onCoEditorSwitchedFile(h){this.coEditorSwitchedFileEvent.addListener(this.coEditorSwitchedFileEventName,h)}onNamedPositionsChanged(h){this.namedPositionsChanged.addListener(this.namedPositionsChangedEventName,h)}setClientPosition(h,m,y,v,C){var T;const w=this.getClientPosition(h),A=PositionTracker.createPosition(m,y,v,C);this.clientPositions[h]=w||{},this.clientPositions[h].documentPosition=A,(null===(T=null==w?void 0:w.notebookPosition)||void 0===T?void 0:T.documentUri.path)!==y.uri.path&&(this.clientPositions[h].notebookPosition=void 0),PositionTracker.isDifferentPosition(null==w?void 0:w.documentPosition,A)&&this.coEditorSwitchedFileEvent.emit(this.coEditorSwitchedFileEventName,h,m)}setNotebookPosition(h,m,y,v,C,T){var w;const A=this.getClientPosition(h),P=PositionTracker.createNotebookPosition(m,y,v);this.clientPositions[h]=A||{},this.clientPositions[h].notebookPosition=P,(null===(w=null==A?void 0:A.documentPosition)||void 0===w?void 0:w.documentUri.path)!==y.uri.path&&(this.clientPositions[h].documentPosition=void 0)}setNamedPosition(h,m,y,v,C){const T=this.getNamedPosition(h),w=Object.assign({name:h},PositionTracker.createPosition(m,y,v,C));this.namedPositions[h]=w,PositionTracker.isDifferentPosition(T,w)&&this.namedPositionsChanged.emit(this.namedPositionsChangedEventName,[w])}static createPosition(h,m,y,v){return{fileName:h,documentUri:m.uri,range:y,isReversed:v,startOffset:m.offsetAt(y.start),endOffset:m.offsetAt(y.end)}}static createNotebookPosition(h,m,y){return{fileName:h,documentUri:m.uri,range:y}}static isDifferentPosition(h,m){return h!==m&&(!h||!m||h.fileName!==m.fileName||h.range.start!==m.range.start||h.range.end!==m.range.end)}onDidChangeTextDocument(h,m){const y=m.document;Object.keys(this.clientPositions).forEach(v=>{var C;const T=null===(C=this.clientPositions[v])||void 0===C?void 0:C.documentPosition;if(T&&T.fileName===h){let h=T;m.contentChanges.forEach(m=>{h=PositionTracker.trackForSingleEdit(h,y,m)}),this.clientPositions[v]={notebookPosition:this.clientPositions[v].notebookPosition,documentPosition:h}}});const v=[];Object.keys(this.namedPositions).forEach(C=>{const T=this.namedPositions[C];if(T&&T.fileName===h){let h=T;m.contentChanges.forEach(m=>{h=PositionTracker.trackForSingleEdit(h,y,m)});const w=Object.assign({name:T.name},h);this.namedPositions[C]=w,PositionTracker.isDifferentPosition(T,w)&&v.push(w)}}),v.length&&this.namedPositionsChanged.emit(this.namedPositionsChangedEventName,v)}getClientPosition(h){return this.clientPositions[h]}getNamedPosition(h){return this.namedPositions[h]}static trackForSingleEdit(h,m,y){const C=PositionTracker.translateOffset(h.range.start,h.startOffset,m,y),T=PositionTracker.translateOffset(h.range.end,h.endOffset,m,y),w=Object.assign({},h),A=m.positionAt(C),P=m.positionAt(T),k=new v.Range(A,P);return w.startOffset=C,w.endOffset=T,w.range=k,w}static translateOffset(h,m,y,v){if(v.range.start.isAfter(h))return m;if(v.range.end.isBeforeOrEqual(h)){return m+(v.text.length-v.rangeLength)}return y.offsetAt(v.range.start)+v.text.length}}m.PositionTracker=PositionTracker},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0});const v=y(53),C=y(13);class DiffView extends C.EventEmitter{constructor(h){super(),this.onDiffViewOpenEventName="onDiffViewOpen",this.onDiffViewClosedEventName="onDiffViewClosed",this.onNewGitDocumentEventName="onNewGitDocument",this.currentVisibleDiffViews={},this.pathManager=h}saveDiffViewInformation(h,m,y){if(m&&y){let v={leftFile:m,rightFile:y},C=this.currentVisibleDiffViews[h];C||(C=[],this.currentVisibleDiffViews[h]=C),C.push(v)}}findDiffViewInformation(h,m){let y=this.currentVisibleDiffViews[h];return y?y.find(h=>m.toString()===h.leftFile.toString()||m.toString()===h.rightFile.toString()):null}removeDiffViewInformation(h,m,y){let v=this.currentVisibleDiffViews[h];v&&(v=v.filter(h=>m.toString()!==h.leftFile.toString()||y.toString()!==h.rightFile.toString()),this.currentVisibleDiffViews[h]=v)}notifyDiffViewsClosed(h,m){let y=this.currentVisibleDiffViews[h];y&&(y=y.filter(h=>{if(m.filter(m=>{var y,v,C,T;return void 0===m.viewColumn&&(h.leftFile.toString()===(null===(v=null===(y=m.document)||void 0===y?void 0:y.uri)||void 0===v?void 0:v.toString())||h.rightFile.toString()===(null===(T=null===(C=m.document)||void 0===C?void 0:C.uri)||void 0===T?void 0:T.toString()))}).length>=2)return!0;{let m=this.pathManager.localPathToRelativePath(h.leftFile),y=this.pathManager.localPathToRelativePath(h.rightFile);return this.emit(this.onDiffViewClosedEventName,m,y),!1}}),this.currentVisibleDiffViews[h]=y)}onHostEditorsChanged(h,m){let y=h.filter(h=>{var m,y;return void 0===h.viewColumn&&[v.PathManager.fileScheme,v.PathManager.gitScheme].includes(null===(y=null===(m=null==h?void 0:h.document)||void 0===m?void 0:m.uri)||void 0===y?void 0:y.scheme)});if(y.length>=2)for(let h=0;h<y.length;h++)for(let v=h+1;v<y.length;v++){const C=y[h],T=y[v];if(C.document.uri.fsPath===T.document.uri.fsPath){let h=this.pathManager.localPathToRelativePath(C.document.uri),y=this.pathManager.localPathToRelativePath(T.document.uri);h&&y&&(this.saveDiffViewInformation(m,C.document.uri,T.document.uri),this.emit(this.onDiffViewOpenEventName,h,y))}}}onGuestEditorsChanged(h,m){let y=h.filter(h=>{var m,y;return void 0===h.viewColumn&&[v.PathManager.vslsSccScheme,v.PathManager.rawScheme].includes(null===(y=null===(m=null==h?void 0:h.document)||void 0===m?void 0:m.uri)||void 0===y?void 0:y.scheme)});if(y.length>=2)for(let h=0;h<y.length;h++)for(let v=h+1;v<y.length;v++){const C=y[h].document.uri,T=y[v].document.uri,w=this.getRawUriFromGuestEditorUri(C),A=this.getRawUriFromGuestEditorUri(T);if(w.toString()===A.toString()){let h=this.pathManager.localPathToRelativePath(C),y=this.pathManager.localPathToRelativePath(T);this.saveDiffViewInformation(m,C,T),this.emit(this.onDiffViewOpenEventName,h,y)}}}initGuestGitDocuments(h){h.filter(h=>{var m,y;return(null===(y=null===(m=null==h?void 0:h.document)||void 0===m?void 0:m.uri)||void 0===y?void 0:y.scheme)===v.PathManager.vslsSccScheme}).forEach(h=>{this.emit(this.onNewGitDocumentEventName,h.document)})}onEditorsChanged(h,m,y){h.length>=2&&(m?this.onHostEditorsChanged(h,y):(this.onGuestEditorsChanged(h,y),this.initGuestGitDocuments(h))),this.notifyDiffViewsClosed(y,h)}onDidOpenDiffView(h){this.addListener(this.onDiffViewOpenEventName,h)}onDidCloseDiffView(h){this.addListener(this.onDiffViewClosedEventName,h)}onDidOpenNewGitDocument(h){this.addListener(this.onNewGitDocumentEventName,h)}dispose(){return this.removeAllListeners(),Promise.resolve()}getRawUriFromGuestEditorUri(h){return h.scheme===v.PathManager.vslsSccScheme?this.pathManager.resourceUriFromLiveShareSourceControlUri(h):h}}m.DiffView=DiffView},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0});const v=y(37),C=y(24),T=y(13),w=y(12),A=y(14);m.PresentationManager=class PresentationManager{constructor(h,m){this.onPresenterUpdate=new T.EventEmitter,this.isPresentationModeExperimentEnabled=!1,this.presenterId=h,this.presentationMode=m;const y=v.getExpService();null==y||y.isCachedFlightEnabled("strictFollow").then(h=>{this.isPresentationModeExperimentEnabled=h}),C.ExtensionUtil.setCommandContext("liveshare:isPresentation",this.presentationMode)}get currentPresenterId(){return this.presenterId}get isStrictFollowEnabled(){const h=w.Settings.get(A.SettingKeys.alwaysFollowHost);return this.isPresentationModeExperimentEnabled&&(h||this.presentationMode)}updatePresenterId(h){this.presenterId!==h&&(this.presenterId=h,this.onPresenterUpdate.emit("onPresenterUpdate"))}}},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0});const v=y(988);m.clipboard=new class NodeClipboard{writeAsync(h){return v.write(h)}readAsync(){return Promise.resolve(v.readSync())}}},function(h,m,y){"use strict";const v=y(989),C=y(1014),T=y(1015),w=y(1016);function platform(){switch(process.platform){case"darwin":return T;case"win32":return w;case"android":if("/data/data/com.termux/files/usr"!==process.env.PREFIX)throw new Error("You need to install Termux for this module to work on Android: https://termux.com");return v;default:return C}}m.write=h=>"string"!=typeof h?Promise.reject(new TypeError(`Expected a string, got ${typeof h}`)):platform().copy({input:h}).then(()=>{}),m.read=()=>platform().paste({stripEof:!1}),m.writeSync=h=>{if("string"!=typeof h)throw new TypeError(`Expected a string, got ${typeof h}`);platform().copySync({input:h})},m.readSync=()=>platform().pasteSync({stripEof:!1}).stdout},function(h,m,y){"use strict";const v=y(170),handler=h=>{if("ENOENT"===h.code)throw new Error("Couldn't find the termux-api scripts. You can install them with: apt install termux-api");throw h};h.exports={copy:h=>v("termux-clipboard-set",h).catch(handler),paste:h=>v.stdout("termux-clipboard-get",h).catch(handler),copySync:h=>{try{return v.sync("termux-clipboard-set",h)}catch(h){handler(h)}},pasteSync:h=>{try{return v.sync("termux-clipboard-get",h)}catch(h){handler(h)}}}},function(h,m,y){"use strict";var v=y(41),C=y(991),T=y(1004),w=v.spawnSync;function spawn(h,m,y){var w,A;return w=C(h,m,y),A=v.spawn(w.command,w.args,w.options),T.hookChildProcess(A,w),A}h.exports=spawn,h.exports.spawn=spawn,h.exports.sync=function spawnSync(h,m,v){var A,P;if(!w)try{w=y(!function webpackMissingModule(){var h=new Error("Cannot find module 'spawn-sync'");throw h.code="MODULE_NOT_FOUND",h}())}catch(h){throw new Error("In order to use spawnSync on node 0.10 or older, you must install spawn-sync:\n\n  npm install spawn-sync --save")}return A=C(h,m,v),(P=w(A.command,A.args,A.options)).error=P.error||T.verifyENOENTSync(P.status,A),P},h.exports._parse=C,h.exports._enoent=T},function(h,m,y){"use strict";var v=y(416),C=y(999),T=y(418),w=y(1e3),A=y(1001),P="win32"===process.platform,k=/\.(?:com|exe)$/i,R=parseInt(process.version.substr(1).split(".")[0],10)>=6||4===parseInt(process.version.substr(1).split(".")[0],10)&&parseInt(process.version.substr(1).split(".")[1],10)>=8;h.exports=function parse(h,m,y){var M;return m&&!Array.isArray(m)&&(y=m,m=null),M={command:h,args:m=m?m.slice(0):[],options:y=y||{},file:void 0,original:h},y.shell?function parseShell(h){var m;return R||(m=[h.command].concat(h.args).join(" "),P?(h.command="string"==typeof h.options.shell?h.options.shell:process.env.comspec||"cmd.exe",h.args=["/d","/s","/c",'"'+m+'"'],h.options.windowsVerbatimArguments=!0):("string"==typeof h.options.shell?h.command=h.options.shell:"android"===process.platform?h.command="/system/bin/sh":h.command="/bin/sh",h.args=["-c",m])),h}(M):function parseNonShell(h){var m,y,R;return P?(h.file=v(h.command),h.file=h.file||v(h.command,!0),(m=h.file&&A(h.file))?(h.args.unshift(h.file),h.command=m,y=C||!k.test(v(m)||v(m,!0))):y=C||!k.test(h.file),y&&(R="echo"!==h.command,h.command=w(h.command),h.args=h.args.map((function(h){return T(h,R)})),h.args=["/d","/s","/c",'"'+h.command+(h.args.length?" "+h.args.join(" "):"")+'"'],h.command=process.env.comspec||"cmd.exe",h.options.windowsVerbatimArguments=!0),h):h}(M)}},function(h,m,y){h.exports=which,which.sync=function whichSync(h,m){for(var y=getPathInfo(h,m=m||{}),v=y.env,T=y.ext,A=y.extExe,P=[],k=0,R=v.length;k<R;k++){var M=v[k];'"'===M.charAt(0)&&'"'===M.slice(-1)&&(M=M.slice(1,-1));var N=C.join(M,h);!M&&/^\.[\\\/]/.test(h)&&(N=h.slice(0,2)+N);for(var D=0,I=T.length;D<I;D++){var x=N+T[D];try{if(w.sync(x,{pathExt:A})){if(!m.all)return x;P.push(x)}}catch(h){}}}if(m.all&&P.length)return P;if(m.nothrow)return null;throw getNotFoundError(h)};var v="win32"===process.platform||"cygwin"===process.env.OSTYPE||"msys"===process.env.OSTYPE,C=y(7),T=v?";":":",w=y(993);function getNotFoundError(h){var m=new Error("not found: "+h);return m.code="ENOENT",m}function getPathInfo(h,m){var y=m.colon||T,C=m.path||process.env.PATH||"",w=[""];C=C.split(y);var A="";return v&&(C.unshift(process.cwd()),w=(A=m.pathExt||process.env.PATHEXT||".EXE;.CMD;.BAT;.COM").split(y),-1!==h.indexOf(".")&&""!==w[0]&&w.unshift("")),(h.match(/\//)||v&&h.match(/\\/))&&(C=[""]),{env:C,ext:w,extExe:A}}function which(h,m,y){"function"==typeof m&&(y=m,m={});var v=getPathInfo(h,m),T=v.env,A=v.ext,P=v.extExe,k=[];!function F(v,R){if(v===R)return m.all&&k.length?y(null,k):y(getNotFoundError(h));var M=T[v];'"'===M.charAt(0)&&'"'===M.slice(-1)&&(M=M.slice(1,-1));var N=C.join(M,h);!M&&/^\.[\\\/]/.test(h)&&(N=h.slice(0,2)+N),function E(h,C){if(h===C)return F(v+1,R);var T=A[h];w(N+T,{pathExt:P},(function(v,w){if(!v&&w){if(!m.all)return y(null,N+T);k.push(N+T)}return E(h+1,C)}))}(0,A.length)}(0,T.length)}},function(h,m,y){var v;y(21);function isexe(h,m,y){if("function"==typeof m&&(y=m,m={}),!y){if("function"!=typeof Promise)throw new TypeError("callback not provided");return new Promise((function(y,v){isexe(h,m||{},(function(h,m){h?v(h):y(m)}))}))}v(h,m||{},(function(h,v){h&&("EACCES"===h.code||m&&m.ignoreErrors)&&(h=null,v=!1),y(h,v)}))}v="win32"===process.platform||global.TESTING_WINDOWS?y(994):y(995),h.exports=isexe,isexe.sync=function sync(h,m){try{return v.sync(h,m||{})}catch(h){if(m&&m.ignoreErrors||"EACCES"===h.code)return!1;throw h}}},function(h,m,y){h.exports=isexe,isexe.sync=function sync(h,m){return checkStat(v.statSync(h),h,m)};var v=y(21);function checkStat(h,m,y){return!(!h.isSymbolicLink()&&!h.isFile())&&function checkPathExt(h,m){var y=void 0!==m.pathExt?m.pathExt:process.env.PATHEXT;if(!y)return!0;if(-1!==(y=y.split(";")).indexOf(""))return!0;for(var v=0;v<y.length;v++){var C=y[v].toLowerCase();if(C&&h.substr(-C.length).toLowerCase()===C)return!0}return!1}(m,y)}function isexe(h,m,y){v.stat(h,(function(v,C){y(v,!v&&checkStat(C,h,m))}))}},function(h,m,y){h.exports=isexe,isexe.sync=function sync(h,m){return checkStat(v.statSync(h),m)};var v=y(21);function isexe(h,m,y){v.stat(h,(function(h,v){y(h,!h&&checkStat(v,m))}))}function checkStat(h,m){return h.isFile()&&function checkMode(h,m){var y=h.mode,v=h.uid,C=h.gid,T=void 0!==m.uid?m.uid:process.getuid&&process.getuid(),w=void 0!==m.gid?m.gid:process.getgid&&process.getgid(),A=parseInt("100",8),P=parseInt("010",8),k=parseInt("001",8),R=A|P;return y&k||y&P&&C===w||y&A&&v===T||y&R&&0===T}(h,m)}},function(h,m,y){"pseudomap"===process.env.npm_package_name&&"test"===process.env.npm_lifecycle_script&&(process.env.TEST_PSEUDOMAP="true"),"function"!=typeof Map||process.env.TEST_PSEUDOMAP?h.exports=y(997):h.exports=Map},function(h,m){var y=Object.prototype.hasOwnProperty;function PseudoMap(h){if(!(this instanceof PseudoMap))throw new TypeError("Constructor PseudoMap requires 'new'");if(this.clear(),h)if(h instanceof PseudoMap||"function"==typeof Map&&h instanceof Map)h.forEach((function(h,m){this.set(m,h)}),this);else{if(!Array.isArray(h))throw new TypeError("invalid argument");h.forEach((function(h){this.set(h[0],h[1])}),this)}}function same(h,m){return h===m||h!=h&&m!=m}function Entry(h,m,y){this.key=h,this.value=m,this._index=y}function find(h,m){for(var v=0,C="_"+m,T=C;y.call(h,T);T=C+v++)if(same(h[T].key,m))return h[T]}h.exports=PseudoMap,PseudoMap.prototype.forEach=function(h,m){m=m||this,Object.keys(this._data).forEach((function(y){"size"!==y&&h.call(m,this._data[y].value,this._data[y].key)}),this)},PseudoMap.prototype.has=function(h){return!!find(this._data,h)},PseudoMap.prototype.get=function(h){var m=find(this._data,h);return m&&m.value},PseudoMap.prototype.set=function(h,m){!function set(h,m,v){for(var C=0,T="_"+m,w=T;y.call(h,w);w=T+C++)if(same(h[w].key,m))return void(h[w].value=v);h.size++,h[w]=new Entry(m,v,w)}(this._data,h,m)},PseudoMap.prototype.delete=function(h){var m=find(this._data,h);m&&(delete this._data[m._index],this._data.size--)},PseudoMap.prototype.clear=function(){var h=Object.create(null);h.size=0,Object.defineProperty(this,"_data",{value:h,enumerable:!1,configurable:!0,writable:!1})},Object.defineProperty(PseudoMap.prototype,"size",{get:function(){return this._data.size},set:function(h){},enumerable:!0,configurable:!0}),PseudoMap.prototype.values=PseudoMap.prototype.keys=PseudoMap.prototype.entries=function(){throw new Error("iterators are not implemented in this version")}},function(h,m){function Yallist(h){var m=this;if(m instanceof Yallist||(m=new Yallist),m.tail=null,m.head=null,m.length=0,h&&"function"==typeof h.forEach)h.forEach((function(h){m.push(h)}));else if(arguments.length>0)for(var y=0,v=arguments.length;y<v;y++)m.push(arguments[y]);return m}function push(h,m){h.tail=new Node(m,h.tail,null,h),h.head||(h.head=h.tail),h.length++}function unshift(h,m){h.head=new Node(m,null,h.head,h),h.tail||(h.tail=h.head),h.length++}function Node(h,m,y,v){if(!(this instanceof Node))return new Node(h,m,y,v);this.list=v,this.value=h,m?(m.next=this,this.prev=m):this.prev=null,y?(y.prev=this,this.next=y):this.next=null}h.exports=Yallist,Yallist.Node=Node,Yallist.create=Yallist,Yallist.prototype.removeNode=function(h){if(h.list!==this)throw new Error("removing node which does not belong to this list");var m=h.next,y=h.prev;m&&(m.prev=y),y&&(y.next=m),h===this.head&&(this.head=m),h===this.tail&&(this.tail=y),h.list.length--,h.next=null,h.prev=null,h.list=null},Yallist.prototype.unshiftNode=function(h){if(h!==this.head){h.list&&h.list.removeNode(h);var m=this.head;h.list=this,h.next=m,m&&(m.prev=h),this.head=h,this.tail||(this.tail=h),this.length++}},Yallist.prototype.pushNode=function(h){if(h!==this.tail){h.list&&h.list.removeNode(h);var m=this.tail;h.list=this,h.prev=m,m&&(m.next=h),this.tail=h,this.head||(this.head=h),this.length++}},Yallist.prototype.push=function(){for(var h=0,m=arguments.length;h<m;h++)push(this,arguments[h]);return this.length},Yallist.prototype.unshift=function(){for(var h=0,m=arguments.length;h<m;h++)unshift(this,arguments[h]);return this.length},Yallist.prototype.pop=function(){if(this.tail){var h=this.tail.value;return this.tail=this.tail.prev,this.tail?this.tail.next=null:this.head=null,this.length--,h}},Yallist.prototype.shift=function(){if(this.head){var h=this.head.value;return this.head=this.head.next,this.head?this.head.prev=null:this.tail=null,this.length--,h}},Yallist.prototype.forEach=function(h,m){m=m||this;for(var y=this.head,v=0;null!==y;v++)h.call(m,y.value,v,this),y=y.next},Yallist.prototype.forEachReverse=function(h,m){m=m||this;for(var y=this.tail,v=this.length-1;null!==y;v--)h.call(m,y.value,v,this),y=y.prev},Yallist.prototype.get=function(h){for(var m=0,y=this.head;null!==y&&m<h;m++)y=y.next;if(m===h&&null!==y)return y.value},Yallist.prototype.getReverse=function(h){for(var m=0,y=this.tail;null!==y&&m<h;m++)y=y.prev;if(m===h&&null!==y)return y.value},Yallist.prototype.map=function(h,m){m=m||this;for(var y=new Yallist,v=this.head;null!==v;)y.push(h.call(m,v.value,this)),v=v.next;return y},Yallist.prototype.mapReverse=function(h,m){m=m||this;for(var y=new Yallist,v=this.tail;null!==v;)y.push(h.call(m,v.value,this)),v=v.prev;return y},Yallist.prototype.reduce=function(h,m){var y,v=this.head;if(arguments.length>1)y=m;else{if(!this.head)throw new TypeError("Reduce of empty list with no initial value");v=this.head.next,y=this.head.value}for(var C=0;null!==v;C++)y=h(y,v.value,C),v=v.next;return y},Yallist.prototype.reduceReverse=function(h,m){var y,v=this.tail;if(arguments.length>1)y=m;else{if(!this.tail)throw new TypeError("Reduce of empty list with no initial value");v=this.tail.prev,y=this.tail.value}for(var C=this.length-1;null!==v;C--)y=h(y,v.value,C),v=v.prev;return y},Yallist.prototype.toArray=function(){for(var h=new Array(this.length),m=0,y=this.head;null!==y;m++)h[m]=y.value,y=y.next;return h},Yallist.prototype.toArrayReverse=function(){for(var h=new Array(this.length),m=0,y=this.tail;null!==y;m++)h[m]=y.value,y=y.prev;return h},Yallist.prototype.slice=function(h,m){(m=m||this.length)<0&&(m+=this.length),(h=h||0)<0&&(h+=this.length);var y=new Yallist;if(m<h||m<0)return y;h<0&&(h=0),m>this.length&&(m=this.length);for(var v=0,C=this.head;null!==C&&v<h;v++)C=C.next;for(;null!==C&&v<m;v++,C=C.next)y.push(C.value);return y},Yallist.prototype.sliceReverse=function(h,m){(m=m||this.length)<0&&(m+=this.length),(h=h||0)<0&&(h+=this.length);var y=new Yallist;if(m<h||m<0)return y;h<0&&(h=0),m>this.length&&(m=this.length);for(var v=this.length,C=this.tail;null!==C&&v>m;v--)C=C.prev;for(;null!==C&&v>h;v--,C=C.prev)y.push(C.value);return y},Yallist.prototype.reverse=function(){for(var h=this.head,m=this.tail,y=h;null!==y;y=y.prev){var v=y.prev;y.prev=y.next,y.next=v}return this.head=m,this.tail=h,this}},function(h,m,y){"use strict";h.exports=function hasEmptyArgumentBug(){var h;return"win32"===process.platform&&(0===(h=process.version.substr(1).split(".").map((function(h){return parseInt(h,10)})))[0]&&h[1]<12)}()},function(h,m,y){"use strict";var v=y(418);h.exports=function escapeCommand(h){return/^[a-z0-9_-]+$/i.test(h)?h:v(h,!0)}},function(h,m,y){"use strict";var v=y(21),C=y(417),T=y(1002),w=new C({max:50,maxAge:3e4});h.exports=function readShebang(h){var m,y,C;if(w.has(h))return w.get(h);m=new Buffer(150);try{y=v.openSync(h,"r"),v.readSync(y,m,0,150,0),v.closeSync(y)}catch(h){}return C=T(m.toString()),w.set(h,C),C}},function(h,m,y){"use strict";var v=y(1003);h.exports=function(h){var m=h.match(v);if(!m)return null;var y=m[0].replace(/#! ?/,"").split(" "),C=y[0].split("/").pop(),T=y[1];return"env"===C?T:C+(T?" "+T:"")}},function(h,m,y){"use strict";h.exports=/^#!.*/},function(h,m,y){"use strict";var v="win32"===process.platform,C=y(416),T=0===process.version.indexOf("v0.10.");function notFoundError(h,m){var y;return(y=new Error(m+" "+h+" ENOENT")).code=y.errno="ENOENT",y.syscall=m+" "+h,y}function verifyENOENT(h,m){return v&&1===h&&!m.file?notFoundError(m.original,"spawn"):null}h.exports.hookChildProcess=function hookChildProcess(h,m){var y;v&&(y=h.emit,h.emit=function(v,C){var T;return"exit"===v&&(T=verifyENOENT(C,m))?y.call(h,"error",T):y.apply(h,arguments)})},h.exports.verifyENOENT=verifyENOENT,h.exports.verifyENOENTSync=function verifyENOENTSync(h,m){return v&&1===h&&!m.file||T&&-1===h&&(m.file=v?m.file:C(m.original),!m.file)?notFoundError(m.original,"spawnSync"):null},h.exports.notFoundError=notFoundError},function(h,m,y){"use strict";h.exports=function(h){var m="string"==typeof h?"\n":"\n".charCodeAt(),y="string"==typeof h?"\r":"\r".charCodeAt();return h[h.length-1]===m&&(h=h.slice(0,h.length-1)),h[h.length-1]===y&&(h=h.slice(0,h.length-1)),h}},function(h,m,y){"use strict";const v=y(7),C=y(1007);h.exports=h=>{let m;h=Object.assign({cwd:process.cwd(),path:process.env[C()]},h);let y=v.resolve(h.cwd);const T=[];for(;m!==y;)T.push(v.join(y,"node_modules/.bin")),m=y,y=v.resolve(y,"..");return T.push(v.dirname(process.execPath)),T.concat(h.path).join(v.delimiter)},h.exports.env=m=>{m=Object.assign({env:process.env},m);const y=Object.assign({},m.env),v=C({env:y});return m.path=y[v],y[v]=h.exports(m),y}},function(h,m,y){"use strict";h.exports=h=>{const m=(h=h||{}).env||process.env;return"win32"!==(h.platform||process.platform)?"PATH":Object.keys(m).find(h=>"PATH"===h.toUpperCase())||"Path"}},function(h,m,y){"use strict";var v=h.exports=function(h){return null!==h&&"object"==typeof h&&"function"==typeof h.pipe};v.writable=function(h){return v(h)&&!1!==h.writable&&"function"==typeof h._write&&"object"==typeof h._writableState},v.readable=function(h){return v(h)&&!1!==h.readable&&"function"==typeof h._read&&"object"==typeof h._readableState},v.duplex=function(h){return v.writable(h)&&v.readable(h)},v.transform=function(h){return v.duplex(h)&&"function"==typeof h._transform&&"object"==typeof h._transformState}},function(h,m,y){"use strict";const v=y(1010);function getStream(h,m){if(!h)return Promise.reject(new Error("Expected a stream"));const y=(m=Object.assign({maxBuffer:1/0},m)).maxBuffer;let C,T;const w=new Promise((w,A)=>{const error=h=>{h&&(h.bufferedData=C.getBufferedValue()),A(h)};C=v(m),h.once("error",error),h.pipe(C),C.on("data",()=>{C.getBufferedLength()>y&&A(new Error("maxBuffer exceeded"))}),C.once("error",error),C.on("end",w),T=()=>{h.unpipe&&h.unpipe(C)}});return w.then(T,T),w.then(()=>C.getBufferedValue())}h.exports=getStream,h.exports.buffer=(h,m)=>getStream(h,Object.assign({},m,{encoding:"buffer"})),h.exports.array=(h,m)=>getStream(h,Object.assign({},m,{array:!0}))},function(h,m,y){"use strict";const v=y(19).PassThrough;h.exports=h=>{const m=(h=Object.assign({},h)).array;let y=h.encoding;const C="buffer"===y;let T=!1;m?T=!(y||C):y=y||"utf8",C&&(y=null);let w=0;const A=[],P=new v({objectMode:T});return y&&P.setEncoding(y),P.on("data",h=>{A.push(h),T?w=A.length:w+=h.length}),P.getBufferedValue=()=>m?A:C?Buffer.concat(A,w):A.join(""),P.getBufferedLength=()=>w,P}},function(h,m,y){"use strict";h.exports=(h,m)=>(m=m||(()=>{}),h.then(h=>new Promise(h=>{h(m())}).then(()=>h),h=>new Promise(h=>{h(m())}).then(()=>{throw h})))},function(h,m,y){"use strict";let v;try{if(v=process.binding("uv"),"function"!=typeof v.errname)throw new TypeError("uv.errname is not a function")}catch(h){console.error("execa/lib/errname: unable to establish process.binding('uv')",h),v=null}function errname(h,m){if(h)return h.errname(m);if(!(m<0))throw new Error("err >= 0");return`Unknown system error ${m}`}h.exports=h=>errname(v,h),h.exports.__test__=errname},function(h,m,y){"use strict";const v=["stdin","stdout","stderr"];h.exports=h=>{if(!h)return null;if(h.stdio&&(h=>v.some(m=>Boolean(h[m])))(h))throw new Error(`It's not possible to provide \`stdio\` in combination with one of ${v.map(h=>`\`${h}\``).join(", ")}`);if("string"==typeof h.stdio)return h.stdio;const m=h.stdio||[];if(!Array.isArray(m))throw new TypeError(`Expected \`stdio\` to be of type \`string\` or \`Array\`, got \`${typeof m}\``);const y=[],C=Math.max(m.length,v.length);for(let T=0;T<C;T++){let C=null;void 0!==m[T]?C=m[T]:void 0!==h[v[T]]&&(C=h[v[T]]),y[T]=C}return y}},function(h,m,y){"use strict";const v=y(7),C=y(170),handler=h=>{if("ENOENT"===h.code)throw new Error("Couldn't find the required `xsel` binary. On Debian/Ubuntu you can install it with: sudo apt install xsel");throw h},T=v.join(__dirname,"../fallbacks/linux/xsel");h.exports={copy:h=>C(T,["--clipboard","--input"],h).catch(()=>C("xsel",["--clipboard","--input"],h)).catch(handler),paste:h=>C.stdout(T,["--clipboard","--output"],h).catch(()=>C.stdout("xsel",["--clipboard","--output"],h)).catch(handler),copySync:h=>{try{return C.sync(T,["--clipboard","--input"],h)}catch(m){try{return C.sync("xsel",["--clipboard","--input"],h)}catch(h){handler(h)}}},pasteSync:h=>{try{return C.sync(T,["--clipboard","--output"],h)}catch(m){try{return C.sync("xsel",["--clipboard","--output"],h)}catch(h){handler(h)}}}}},function(h,m,y){"use strict";const v=y(170),C=Object.assign({},process.env,{LC_CTYPE:"UTF-8"});h.exports={copy:h=>v("pbcopy",Object.assign({},h,{env:C})),paste:h=>v.stdout("pbpaste",Object.assign({},h,{env:C})),copySync:h=>v.sync("pbcopy",Object.assign({},h,{env:C})),pasteSync:h=>v.sync("pbpaste",Object.assign({},h,{env:C}))}},function(h,m,y){"use strict";const v=y(7),C=y(170),T="x64"===y(1017)()?v.join(__dirname,"../fallbacks/windows/clipboard_x86_64.exe"):v.join(__dirname,"../fallbacks/windows/clipboard_i686.exe");h.exports={copy:h=>C(T,["--copy"],h),paste:h=>C.stdout(T,["--paste"],h),copySync:h=>C.sync(T,["--copy"],h),pasteSync:h=>C.sync(T,["--paste"],h)}},function(h,m,y){var v=y(41),C=y(21),T=y(7);h.exports=function arch(){if("x64"===process.arch)return"x64";if("darwin"===process.platform)return"x64";if("win32"===process.platform){var h=!1;try{h=!(!process.env.SYSTEMROOT||!C.statSync(process.env.SYSTEMROOT))}catch(h){}var m=h?process.env.SYSTEMROOT:"C:\\Windows",y=!1;try{y=!!C.statSync(T.join(m,"sysnative"))}catch(h){}return y?"x64":"x86"}return"linux"===process.platform&&"64\n"===v.execSync("getconf LONG_BIT",{encoding:"utf8"})?"x64":"x86"}},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0});const v=y(0),C=y(4),T=y(62),w=y(32),A=y(26),P=y(37);m.CollaboratorManager=class CollaboratorManager{constructor(h,m){this.sessionContext=h,this.userIdBySessionIdHistory={},this.coEditorsHistory={},this.coEditors={},this.coEditorsIDE={},this.coEditorCount=0,this.profiles={},this.profileByUserIdHistory={},this.profileByUserId={},this.collaboratorChangedEmitter=new v.EventEmitter,this.onCollaboratorChanged=this.collaboratorChangedEmitter.event,this.collaboratorsJoinedEmitter=new v.EventEmitter,this.onCollaboratorsJoined=this.collaboratorsJoinedEmitter.event,this.localUserInfo=w.userAuthStateTracker.userInfo,this.profiles=m||{};for(let h of Object.keys(m)){const y=m[h];this.userIdBySessionIdHistory[h]=y.id}}onWorkspaceSessionChanged(h){const m=!!this.profileByUserIdHistory[h.userProfile.id],y=this.localUserInfo.id===h.userProfile.id,v=!!this.sessionContext.hasCollaborators;h.changeType===C.vsls.WorkspaceSessionChangeType.Joined?(this.profiles[h.sessionNumber]=h.userProfile,this.userIdBySessionIdHistory[h.sessionNumber]=h.userProfile.id,this.profileByUserIdHistory[h.userProfile.id]=h.userProfile,this.profileByUserId[h.userProfile.id]=h.userProfile,this.coEditorsIDE[h.sessionNumber]=h.applicationName):h.changeType===C.vsls.WorkspaceSessionChangeType.Unjoined&&(delete this.coEditors[h.sessionNumber],delete this.profiles[h.sessionNumber],delete this.profileByUserId[h.userProfile.id],this.coEditorCount>0&&--this.coEditorCount),this.coEditorCount<=0&&(this.sessionContext.hasCollaborators=!1),this.collaboratorChangedEmitter.fire({userProfile:h.userProfile,changeType:h.changeType,applicationName:h.applicationName,disconnectedReason:h.disconnectedReason,sessionNumber:h.sessionNumber,collaboratorSessionHash:this.getProfileIndex(h.userProfile.id),previouslyJoined:m,isHost:y,hasCollaborators:v})}getDisplayName(h){const m=this.profiles[h],y=A.workspaceSessionInfoTracker.getAnonymousAccess(m.id)===A.AnonymousAccessLevel.readWrite;return m?m.isAnonymous?this.isReadWriteAnonymousEnabled()&&y?`${m.name} (${T.READ_WRITE_LABEL})`:`${m.name} (${T.READ_ONLY_LABEL})`:m.name||m.userName||m.email:this.sessionContext.coeditingClient&&h===this.sessionContext.coeditingClient.clientID?this.localUserInfo.displayName||this.localUserInfo.emailAddress:`Collaborator ${h}`}isReadWriteAnonymousEnabled(){var h;return null===(h=P.getExpService())||void 0===h?void 0:h.getTreatmentVariable("vscode","readWriteAnonymous")}getUserId(h){const m=this.profiles[h];return m&&m.id}getEmailOrUsername(h){const m=this.profiles[h];if(m)return m.email||m.userName||""}getProfileIndex(h){return Object.keys(this.profileByUserIdHistory).findIndex(m=>m===h)}getIDEs(){return new Set(this.getCollaboratorSessionIds().map(h=>this.coEditorsIDE[h]))}getCollaboratorCount(){return this.coEditorCount}getCollaboratorCountByIDE(h){return this.getCollaboratorEmailsOrUsernamesByIDE(h).length}getDistinctCollaboratorCount(){return new Set(this.getCollaboratorEmailsOrUsernames()).size}getDistinctCollaboratorCountByIDE(h){return new Set(this.getCollaboratorEmailsOrUsernamesByIDE(h).filter(h=>h!==this.localUserInfo.emailAddress&&h!==this.localUserInfo.userName)).size}getCollaboratorSessionIds(){return Object.keys(this.coEditors).map(h=>parseInt(h,10))}getCollaboratorEmailsOrUsernames(){return this.getCollaboratorSessionIds().map(h=>this.getEmailOrUsername(h))}getCollaboratorEmailsOrUsernamesByIDE(h){return this.getCollaboratorSessionIds().filter(m=>this.coEditorsIDE[m]===h).map(h=>this.getEmailOrUsername(h))}coEditorsJoined(h){h.forEach(h=>{h!==this.sessionContext.coeditingClient.clientID&&(this.coEditorsHistory[h]=!0,this.coEditors[h]=!0,++this.coEditorCount)}),this.coEditorCount>0&&(this.sessionContext.hasCollaborators=!0),this.collaboratorsJoinedEmitter.fire()}wasCoEditor(h){return void 0!==this.coEditorsHistory[h]}getCollaborators(){return Object.assign({},this.profiles)}dispose(){this.collaboratorChangedEmitter.dispose(),this.collaboratorsJoinedEmitter.dispose(),this.sessionContext.hasCollaborators=!1}}},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0});const v=y(8);m.CollaboratorsTelemetry=class CollaboratorsTelemetry{static endSession(){this.activeEvent&&this.activeEvent.end(v.TelemetryResult.Success)}static resetActiveEvent(h){this.activeEvent=v.Telemetry.startTimedEvent(SessionTelemetryEventNames.HAS_COLLABORATORS_CHANGED),this.activeEvent.addProperty(SessionTelemetryPropertyNames.HAS_COLLABORATORS,h)}static sendChangeCollaboratorsEvent(h){v.Telemetry.sendTelemetryEvent(SessionTelemetryEventNames.COLLABORATORS_CHANGED,{[SessionTelemetryPropertyNames.HAS_COLLABORATORS]:h.hasCollaborators.toString(),[SessionTelemetryPropertyNames.COLLABORATOR_SESSION_HASH]:h.collaboratorSessionHash.toString(),[SessionTelemetryPropertyNames.PREVIOUSLY_JOINED]:h.previouslyJoined.toString(),[SessionTelemetryPropertyNames.IS_HOST]:h.isHost.toString(),[SessionTelemetryPropertyNames.CHANGE_TYPE]:h.changeType.toString(),[SessionTelemetryPropertyNames.APPLICATION_NAME]:h.applicationName,[SessionTelemetryPropertyNames.DISCONNECTED_REASON]:h.disconnectedReason&&h.disconnectedReason.toString()||""})}};class SessionTelemetryEventNames{}SessionTelemetryEventNames.HAS_COLLABORATORS_CHANGED="change-hascollaborators",SessionTelemetryEventNames.COLLABORATORS_CHANGED="change-collaborators";class SessionTelemetryPropertyNames{}SessionTelemetryPropertyNames.HAS_COLLABORATORS=v.TelemetryPropertyNames.FEATURE_NAME+"HasCollaborators",SessionTelemetryPropertyNames.COLLABORATOR_SESSION_HASH=v.TelemetryPropertyNames.FEATURE_NAME+"CollaboratorSessionHash",SessionTelemetryPropertyNames.PREVIOUSLY_JOINED=v.TelemetryPropertyNames.FEATURE_NAME+"PreviouslyJoined",SessionTelemetryPropertyNames.IS_HOST=v.TelemetryPropertyNames.FEATURE_NAME+"IsHost",SessionTelemetryPropertyNames.CHANGE_TYPE=v.TelemetryPropertyNames.FEATURE_NAME+"ChangeType",SessionTelemetryPropertyNames.APPLICATION_NAME=v.TelemetryPropertyNames.FEATURE_NAME+"ApplicationName",SessionTelemetryPropertyNames.DISCONNECTED_REASON=v.TelemetryPropertyNames.FEATURE_NAME+"DisconnectedReason"},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0});m.ContextUtil=class ContextUtil{scrubPrefix(h){return h?h.replace("liveshare.",""):h}}},function(h,m,y){"use strict";var v=this&&this.__awaiter||function(h,m,y,v){return new(y||(y=Promise))((function(C,T){function fulfilled(h){try{step(v.next(h))}catch(h){T(h)}}function rejected(h){try{step(v.throw(h))}catch(h){T(h)}}function step(h){h.done?C(h.value):function adopt(h){return h instanceof y?h:new y((function(m){m(h)}))}(h.value).then(fulfilled,rejected)}step((v=v.apply(h,m||[])).next())}))};Object.defineProperty(m,"__esModule",{value:!0});const C=y(0),T=y(69),w=y(5),A=y(4),P=y(22),k=y(23),R=y(32),M=y(24),N=y(12),D=y(14),I=y(25);class ProgressNotifierUtil{constructor(h,m,y){this.contextUtil=h,this.workspaceService=m,this.trace=y}create(h,m,y){return v(this,void 0,void 0,(function*(){const A=ProgressNotifierUtil.correlationIndex++;this.trace.info(`Progress notifier opened: ${A}.`);const R=T.gte(T.coerce(C.version),"1.22.0")?C.ProgressLocation.Notification:C.ProgressLocation.Window;return yield w.NotificationUtil.withProgress({title:I.localize("notification.ProgressNotifiers").replace("$(options.title)",h.title),cancellable:!0,location:R},(h,C)=>v(this,void 0,void 0,(function*(){const v=N.Settings.get(D.SettingKeys.diagnosticLogging),statusCallback=m=>{const y=this.generateMessage(m.newStatus);h.report({message:y})},T=k.sessionStateTracker.onStateChanged(m=>{const y=this.generateMessage(P.SessionState[m.newState]);h.report({message:y})});let w;v&&(w=k.sessionStateTracker.onStatusChanged(statusCallback));const unsubscribe=()=>{T&&T.dispose(),w&&w.dispose()};C&&C.onCancellationRequested(()=>{this.trace.info(`Progress notifier cancelled: ${A}.`),unsubscribe()}),m&&m.onCancellationRequested(()=>{this.trace.info(`Progress notifier cancelled by command: ${A}.`),unsubscribe()}),this.workspaceService.onProgressUpdated(this.onWorkspaceProgressUpdated.bind(this,h));const R=yield y(C);return this.trace.info(`Progress notifier finished: ${A}.`),unsubscribe(),R})))}))}onWorkspaceProgressUpdated(h,m){switch(m.progress){case A.vsls.WorkspaceProgress.WaitingForHost:{const y=M.ExtensionUtil.getWaitingForHostProgressUpdateString(m.progress,R.userAuthStateTracker.userInfo);h.report({message:y});break}case A.vsls.WorkspaceProgress.OpeningRemoteSession:case A.vsls.WorkspaceProgress.JoiningRemoteSession:h.report({message:M.ExtensionUtil.getProgressUpdateString(m.progress)})}}generateMessage(h){return h===P.SessionState[P.SessionState.ExternallySigningIn]?"Sign in to proceed.":h!==P.SessionState[P.SessionState.SharingInProgress]&&h!==P.SessionState[P.SessionState.JoiningInProgress]?h?this.contextUtil.scrubPrefix(h).match(ProgressNotifierUtil.statusTextGeneratorRegex).slice(0,-1).join(" "):h:void 0}}m.ProgressNotifierUtil=ProgressNotifierUtil,ProgressNotifierUtil.statusTextGeneratorRegex=/([A-Z]?[^A-Z]*)/g,ProgressNotifierUtil.correlationIndex=0},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0});const v=y(34);m.CommandContextBuilder=class CommandContextBuilder{constructor(h){this.trace=h}build(h,m,y){return{trace:this.trace.withName(y||this.buildTrace(h,m)),commandText:m,commandName:""}}buildTrace(h,m){let y="";return(h=v.DecoratorHelper.getCoreCommand(h))&&h.constructor&&h.constructor.name&&(y=h.constructor.name,y=y.replace("CommandDecorator","")),`Command:${"Object"===y?m:y}`}}},function(h,m,y){"use strict";var v=this&&this.__awaiter||function(h,m,y,v){return new(y||(y=Promise))((function(C,T){function fulfilled(h){try{step(v.next(h))}catch(h){T(h)}}function rejected(h){try{step(v.throw(h))}catch(h){T(h)}}function step(h){h.done?C(h.value):function adopt(h){return h instanceof y?h:new y((function(m){m(h)}))}(h.value).then(fulfilled,rejected)}step((v=v.apply(h,m||[])).next())}))};Object.defineProperty(m,"__esModule",{value:!0});const C=y(172);m.MetaProfilingCommandDecorator=class MetaProfilingCommandDecorator{constructor(h,m){this.command=h,this.next=m,this.friendlyName=(this.next&&this.next.constructor&&this.next.constructor.name).replace("CommandDecorator","")}invoke(h,m){return v(this,void 0,void 0,(function*(){let y=void 0,v=!1;C.TimeTracker.start(this.friendlyName,"Decorator:"),m.trace.info(`Decorator: ${this.friendlyName} Starting`);try{y=yield this.next.invoke(h,m)}catch(h){throw v=!0,h}finally{const h=v?"Failed":"Success";C.TimeTracker.stop(this.friendlyName,"Decorator:",h),m.trace.info(`Decorator: ${this.friendlyName} Completed ${h}`)}return y}))}}},function(h,m,y){"use strict";var v=this&&this.__awaiter||function(h,m,y,v){return new(y||(y=Promise))((function(C,T){function fulfilled(h){try{step(v.next(h))}catch(h){T(h)}}function rejected(h){try{step(v.throw(h))}catch(h){T(h)}}function step(h){h.done?C(h.value):function adopt(h){return h instanceof y?h:new y((function(m){m(h)}))}(h.value).then(fulfilled,rejected)}step((v=v.apply(h,m||[])).next())}))};Object.defineProperty(m,"__esModule",{value:!0});const C=y(0),T=y(8),w=y(17);m.CommandRegistryProvider=class CommandRegistryProvider{constructor(h,m,y){this.commandContextBuilder=h,this.telemetry=m,this.trace=y,this.disposables={}}register(h,m){this.disposables[h]=C.commands.registerCommand(h,(y,C)=>v(this,void 0,void 0,(function*(){try{y=y||{};const v=m();return C=C||this.commandContextBuilder.build(v,h),yield v.invoke(y,C)}catch(m){if(m&&!m.hasRecorded){const y=`Unhandled exception command:${h} message:${m.message}`;this.trace.error(y),this.telemetry.sendFault(w.TelemetryEventNames.UNHANDLED_COMMAND_ERROR_FAULT,T.FaultType.Error,y,m)}}})))}dispose(h){const m=this.disposables[h];m&&m.dispose()}disposeAll(){for(const h in this.disposables)h&&this.dispose(h)}}},function(h,m,y){"use strict";var v=this&&this.__awaiter||function(h,m,y,v){return new(y||(y=Promise))((function(C,T){function fulfilled(h){try{step(v.next(h))}catch(h){T(h)}}function rejected(h){try{step(v.throw(h))}catch(h){T(h)}}function step(h){h.done?C(h.value):function adopt(h){return h instanceof y?h:new y((function(m){m(h)}))}(h.value).then(fulfilled,rejected)}step((v=v.apply(h,m||[])).next())}))};Object.defineProperty(m,"__esModule",{value:!0});const C=y(2),T=y(5),w=y(23),A=y(22),P=y(17),k=y(96),R=y(239),M=y(32),N=y(62),D=y(25),I=y(8);m.AuthenticationFlow=class AuthenticationFlow{constructor(h,m){this.authenticationProvider=h,this.trace=m}attemptAuthenticationCheckFlow(h,m){return v(this,void 0,void 0,(function*(){const{cancellationTokenSource:y}=m,v=y&&y.token;let C,T=!1;w.sessionStateTracker.point(P.TelemetryPropertyNames.SIGNIN_CHECK_STARTING);try{T=yield this.attemptAuthenticationCheckFlowCore(h,m)}catch(h){C=h}const A={successPoint:P.TelemetryPropertyNames.SIGNIN_CHECK_COMPLETED,cancelPoint:P.TelemetryPropertyNames.SIGNIN_CHECK_COMPLETED_CANCEL,errorPoint:P.TelemetryPropertyNames.SIGNIN_CHECK_COMPLETED_ERROR,neutralPoint:P.TelemetryPropertyNames.SIGNIN_CHECK_COMPLETED,telemetryEventName:P.TelemetryEventNames.AUTH_SILENT_CHECK,isAuthenticated:T,error:C,cancellationToken:v,allowsNeutralOutcome:!0,isNative:h.isNativeAuth};return yield this.processAuthResult(A),T}))}attemptPromptedUserLoginFlow(h,m){return v(this,void 0,void 0,(function*(){if(h&&h.shouldPromptForAuth){const h={title:"Launch Sign In"};m.telemetryEvent.addProperty(P.TelemetryPropertyNames.COMMAND_AUTH_PROMPT_OPENED,!0),w.sessionStateTracker.point(P.TelemetryPropertyNames.SIGNIN_PROMPT_STARTING);const y=yield T.NotificationUtil.showInformationMessage(D.localize("notification.YouNeedToSignInBeforeJoin"),!1,{},h);if(w.sessionStateTracker.point(P.TelemetryPropertyNames.SIGNIN_PROMPT_COMPLETED),m.telemetryEvent.addProperty(P.TelemetryPropertyNames.COMMAND_AUTH_PROMPT_QUESTION_RESULT,y&&y.title),!(y&&y.title===h.title))throw new C.CancellationError("Operation cancelled @ sign in again.")}yield this.attemptLoginFlow(h,m)}))}attemptPromptedUserAnonymousLoginFlow(h,m){return v(this,void 0,void 0,(function*(){const{token:h}=m.cancellationTokenSource;if(!0===h.isCancellationRequested)throw m.telemetryEvent.addProperty(P.TelemetryPropertyNames.AUTH_CANCEL_ANONYMOUS_LOGIN_FLOW,!0),new C.CancellationError;const y=D.localize("generic.SignIn"),v=D.localize("generic.ContinueAsAnonymous");m.telemetryEvent.addProperty(P.TelemetryPropertyNames.COMMAND_AUTH_PROMPT_OPENED,!0),w.sessionStateTracker.point(P.TelemetryPropertyNames.SIGNIN_PROMPT_STARTING);const A=yield T.NotificationUtil.showInformationMessage(D.localize("notification.SignIntoJoin"),!1,v,y);if(w.sessionStateTracker.point(P.TelemetryPropertyNames.SIGNIN_PROMPT_COMPLETED),m.telemetryEvent.addProperty(P.TelemetryPropertyNames.COMMAND_AUTH_PROMPT_QUESTION_RESULT,A),!A)throw m.telemetryEvent.addProperty(P.TelemetryPropertyNames.AUTH_CANCEL_NO_ANON_AUTH,!0),new C.CancellationError;if(A===v){m.telemetryEvent.addProperty(P.TelemetryPropertyNames.USER_OPTED_OUT_TO_AUTH_ON_JOIN,!0);const h=yield this.authenticationProvider.askForUserName();return m.telemetryEvent.addProperty(P.TelemetryPropertyNames.USER_PICKED_NAME_LENGTH,h.length),m.telemetryEvent.addProperty(P.TelemetryPropertyNames.USER_PICKED_DEFAULT_NAME,h===N.DEFAULT_ANONYMOUS_USER_NAME),!!M.userAuthStateTracker.isCurrentUserAnonymous()||(yield this.attemptAnonymousLoginFlow(m))}return!1}))}attemptAnonymousLoginFlow(h){return v(this,void 0,void 0,(function*(){const{cancellationTokenSource:m}=h;if(m&&m.token.isCancellationRequested)return;w.sessionStateTracker.point(P.TelemetryPropertyNames.SIGNIN_STARTING);const y=yield this.authenticationProvider.attemptAnonymousLoginVSCodeAccount(void 0,m.token);return w.sessionStateTracker.point(P.TelemetryPropertyNames.SIGNIN_COMPLETED),y&&w.sessionStateTracker.transition(A.SessionAction.SignInSuccess),y}))}attemptLoginFlow(h,m){return v(this,void 0,void 0,(function*(){const{cancellationTokenSource:y}=m,v=y&&y.token;let C,T=!1;w.sessionStateTracker.point(P.TelemetryPropertyNames.SIGNIN_STARTING);try{h.isNativeAuth?(w.sessionStateTracker.transition(A.SessionAction.AttemptSignIn),T=yield this.authenticationProvider.attemptPromptedNativeLogin(m)):T=yield this.attemptLoginFlowCoreBrowserVSCodeAccount(m)}catch(h){C=h}const k={successPoint:P.TelemetryPropertyNames.SIGNIN_COMPLETED,cancelPoint:P.TelemetryPropertyNames.SIGNIN_COMPLETED_CANCEL,errorPoint:P.TelemetryPropertyNames.SIGNIN_COMPLETED_ERROR,telemetryEventName:P.TelemetryEventNames.AUTH_PROMPTED_SIGNIN,isAuthenticated:T,error:C,cancellationToken:v,allowsNeutralOutcome:!1,isNative:h.isNativeAuth};yield this.processAuthResult(k)}))}processAuthResult(h){var m;return v(this,void 0,void 0,(function*(){let y=!1;try{if(h.isAuthenticated)return w.sessionStateTracker.point(h.successPoint),void w.sessionStateTracker.transition(A.SessionAction.SignInSuccess);if((null===(m=h.cancellationToken)||void 0===m?void 0:m.isCancellationRequested)||h.error instanceof C.CancellationError)throw w.sessionStateTracker.point(h.cancelPoint),w.sessionStateTracker.transition(A.SessionAction.SignInError),y=!0,h.error||new C.CancellationError;if(h.error||!h.allowsNeutralOutcome)throw w.sessionStateTracker.point(h.errorPoint),w.sessionStateTracker.transition(A.SessionAction.SignInError),h.error||new Error(D.localize("error.UnexpectedAuthenticationError"));w.sessionStateTracker.point(h.neutralPoint),w.sessionStateTracker.transition(A.SessionAction.SignOut)}finally{const m=new I.TelemetryEvent(h.telemetryEventName);m.addProperty(P.TelemetryPropertyNames.LOGIN_IS_NATIVE,h.isNative),m.addProperty(P.TelemetryPropertyNames.LOGIN_RESULT,h.isAuthenticated),m.addProperty(P.TelemetryPropertyNames.LOGIN_IS_CANCELED,y),m.send()}}))}attemptAuthenticationCheckFlowCore(h,m){return v(this,void 0,void 0,(function*(){const{cancellationTokenSource:y}=m,v=y&&y.token;let C=this.authenticationProvider.isAuthenticated();return C||(w.sessionStateTracker.transition(A.SessionAction.AttemptSignIn),C=h.isNativeAuth?yield this.authenticationProvider.attemptSilentNativeLogin(h,m):yield this.authenticationProvider.attemptDefaultLoginVSCodeAccount(h,v)),C}))}attemptLoginFlowCoreBrowserVSCodeAccount(h){return v(this,void 0,void 0,(function*(){const{cancellationTokenSource:m}=h,y=m&&m.token;w.sessionStateTracker.transition(A.SessionAction.AwaitExternalSignIn),w.sessionStateTracker.point(P.TelemetryPropertyNames.EXTERNAL_SIGNIN_STARTING);const v=yield k.auth.API.askToSignIn({shouldSkipQuestion:!0,strategies:[k.auth.API.defaultStrategy,R.liveshareGithubStrategy]});if(h.telemetryEvent.addProperty(P.TelemetryPropertyNames.EXTERNAL_SIGNIN_USER_COMPLETE_FLOW_TOKEN_SET,!!v),w.sessionStateTracker.point(P.TelemetryPropertyNames.EXTERNAL_SIGNIN_USER_COMPLETE_FLOW),y.isCancellationRequested)throw w.sessionStateTracker.transition(A.SessionAction.SignOut),h.telemetryEvent.addProperty(P.TelemetryPropertyNames.AUTH_CANCEL_NO_TOKEN_USER_CANCELLED,!0),new C.CancellationError;if(!v)throw new C.CancellationError("Authentication incomplete.");return w.sessionStateTracker.point(P.TelemetryPropertyNames.EXTERNAL_SIGNIN_COMPLETE),w.sessionStateTracker.transition(A.SessionAction.AttemptSignIn),yield this.authenticationProvider.attemptLoginVSCodeAccount(v,y)}))}}},function(h,m,y){"use strict";var v=this&&this.__awaiter||function(h,m,y,v){return new(y||(y=Promise))((function(C,T){function fulfilled(h){try{step(v.next(h))}catch(h){T(h)}}function rejected(h){try{step(v.throw(h))}catch(h){T(h)}}function step(h){h.done?C(h.value):function adopt(h){return h instanceof y?h:new y((function(m){m(h)}))}(h.value).then(fulfilled,rejected)}step((v=v.apply(h,m||[])).next())}))};Object.defineProperty(m,"__esModule",{value:!0});const C=y(1027),T=y(420),w=y(423),A=y(174),P=y(1045),k=y(1046);m.activateInternal=(h,m,y,P=[],k)=>v(void 0,void 0,void 0,(function*(){return A.Constants.extensionName=m,w.keytarService.init(k),T.registeredStrategies.push(...P),new C.VSCodeLoginHelper(h,y).api})),m.activate=function activate(h){return v(this,void 0,void 0,(function*(){const y=yield m.activateInternal(h,"ms-vsliveshare.vscode-account",new P.FakeTelemetryReporter);return new k.ProtocolHandler(y,h)}))},m.deactivate=function deactivate(){}},function(h,m,y){"use strict";var v=this&&this.__awaiter||function(h,m,y,v){return new(y||(y=Promise))((function(C,T){function fulfilled(h){try{step(v.next(h))}catch(h){T(h)}}function rejected(h){try{step(v.throw(h))}catch(h){T(h)}}function step(h){h.done?C(h.value):function adopt(h){return h instanceof y?h:new y((function(m){m(h)}))}(h.value).then(fulfilled,rejected)}step((v=v.apply(h,m||[])).next())}))},C=this&&this.__importStar||function(h){if(h&&h.__esModule)return h;var m={};if(null!=h)for(var y in h)Object.hasOwnProperty.call(h,y)&&(m[y]=h[y]);return m.default=h,m};Object.defineProperty(m,"__esModule",{value:!0});const T=C(y(0)),w=y(0),A=y(2),P=y(1028),k=y(1029),R=y(1030),M=y(1031),N=y(420),D=y(419),I=y(423),x=y(174),O=y(1043),L=y(1044),U=y(422),B=y(421);class VSCodeLoginHelper{constructor(h,m){this.context=h,this.reporter=m,this.onStatusChanged=new w.EventEmitter,this.onTokensChanged=new w.EventEmitter,this.initialLoginAttemptSignal=new A.Signal,this.api={status:"Initializing",defaultStrategy:N.defaultStrategy,onStatusChanged:this.onStatusChanged.event,waitForLogin:()=>this.waitForLogin(),waitForInitialLogin:this.initialLoginAttemptSignal.promise,get tokens(){return[...VSCodeLoginHelper.tokensInternal]},onSessionsChanged:this.onTokensChanged.event,getTokensOrAskToSignIn:(h={})=>this.getTokenOrAskToSignIn(h),askToSignIn:h=>this.askForLogin(h),getCachedTokens:(h={})=>v(this,void 0,void 0,(function*(){return yield this.getCachedToken(h)})),logOut:h=>this.logout(h),authCallback:h=>v(this,void 0,void 0,(function*(){yield this.handleAuthCallback(h)})),getRedirectUri:h=>U.getRedirectUri(h),fetchPost:(h,m,y)=>B.fetchPost(h,m,y),CancellationError:D.CancellationError},this.getTokenOrAskToSignIn=(h={})=>v(this,void 0,void 0,(function*(){h=this.getOptionsWithDefaults(h);const{strategies:m,notificationOptions:y}=h,v=yield this.getCachedToken(h);if(v&&v.length)return v;if(h.shouldSkipQuestion)try{const h=yield this.login("login",m,y);return h?[h]:[]}catch(h){}const C=yield this.askForLogin(h);return C?[C]:[]})),this.updateAllTokensInternal=h=>v(this,void 0,void 0,(function*(){return(yield Promise.all(h.map(h=>k.reflectPromise(this.getTokenForStrategy(h))))).filter(h=>h.status===k.ReflectedPromiseStatus.resolved).map(h=>h.value)})),this.updateAllTokens=L.throttle(this.updateAllTokensInternal,x.Constants.UPDATE_TOKENS_THROTTLE_PERIOD_MS);const y=this.context.subscriptions;try{y.push(w.commands.registerCommand("vscode-account.login",h=>this.login("login",h).catch(console.error))),y.push(w.commands.registerCommand("vscode-account.logout",()=>this.logout().catch(console.error))),y.push(w.commands.registerCommand("vscode-account.askForLogin",()=>this.askForLogin().catch(console.error)))}catch(h){console.log("VSCode Account: the extension commands already exist.")}this.initialize("activation").catch(console.error)}handleAuthCallback(h){return v(this,void 0,void 0,(function*(){for(let m of N.registeredStrategies){if(yield m.receiveProtocolHandlerCallback(h))return}yield T.window.showErrorMessage("Failed to find the entity that initialized this sign-in request. Please try again.")}))}getOptionsWithDefaults(h={}){const m=N.registeredStrategies.length?void 0:[N.defaultStrategy];return Object.assign({strategies:m,shouldSkipQuestion:!1,message:"Sign in to proceed."},h)}getCachedToken(h){return v(this,void 0,void 0,(function*(){yield this.initialLoginAttemptSignal.promise;const m=h.strategies||N.registeredStrategies;let y=VSCodeLoginHelper.tokensInternal.filter((function(y){const v=m.indexOf(y.strategy),C=-1!==v;let T=h.minExpiration||0;T=C&&m[v].minExpiration||T;const w=O.getExpirationTimeMS(y);return C&&w>=1e3*T}));if(y.length)return this.updateAllTokens(m),y;return yield this.updateAllTokens(m)}))}createQuickPick(h){return h.map(h=>{const{publicName:m,prefixLabel:y="Sign in with"}=h,{description:v=`Use your default browser to ${y.toLowerCase()} ${m}`}=h;return{strategy:h,label:`${y} ${m}`,description:"",detail:v,enabled:()=>!0}})}login(h,m,y){return v(this,void 0,void 0,(function*(){const C=m||N.registeredStrategies;let A=C[0];if(C.length>1){const h=yield T.window.showQuickPick(this.createQuickPick(C));if(!h)return;A=h.strategy}let k="newLogin",I="uninitialized";const x=new w.CancellationTokenSource;try{I=A.name,this.beginLoggingIn(),k="newLoginCodeFlow";const createSignInTask=m=>v(this,void 0,void 0,(function*(){const y=new P.CancellableTask(()=>v(this,void 0,void 0,(function*(){const m=yield A.getAccessToken();if(!m)return void this.sendLoginTelemetry(h,k,I,"failure");const y=yield this.handleTokenResponse(m,A);return this.sendLoginTelemetry(h,k,I,"success"),y})),m);return yield y.run()})),m="Signing in...";if(y){return y.progress.report({message:m}),yield createSignInTask(y.cancellationToken)}const C={title:m,location:w.ProgressLocation.Notification,cancellable:!0};return yield w.window.withProgress(C,(h,m)=>v(this,void 0,void 0,(function*(){return yield createSignInTask(m)})))}catch(m){if(m instanceof R.VSCodeLoginError&&m.reason?this.sendLoginTelemetry(h,k,I,"error",M.getErrorMessage(m.reason)||M.getErrorMessage(m)):m instanceof D.CancellationError?this.sendLoginTelemetry(h,k,I,"cancel",M.getErrorMessage(m)):this.sendLoginTelemetry(h,k,I,"failure",M.getErrorMessage(m)),!(m instanceof D.CancellationError))throw m}finally{x.cancel(),x.dispose(),this.updateStatus()}}))}handleTokenResponse(h,m){return v(this,void 0,void 0,(function*(){return yield I.keytarService.storeAccessTokenToKeytar(m,h.accessToken),h.refreshToken&&(yield I.keytarService.storeRefreshTokenToKeytar(m,h.refreshToken)),yield this.updateSingleToken(m,h),{accessToken:h.accessToken,refreshToken:h.refreshToken,expiresOn:h.expiresOn,tokenType:h.tokenType,strategy:m}}))}sendLoginTelemetry(h,m,y,v,C){const T={trigger:h,path:m,cloud:y,outcome:v};C&&(T.message=C),this.reporter.sendTelemetryEvent("login",T)}logout(h=N.registeredStrategies){return v(this,void 0,void 0,(function*(){yield this.api.waitForLogin();for(const m of h)yield I.keytarService.deleteAccessTokenFromKeytar(m),yield I.keytarService.deleteRefreshTokenFromKeytar(m);yield this.clearTokensForStrategies(h),this.updateStatus()}))}getTokenForStrategy(h){return v(this,void 0,void 0,(function*(){const m=yield I.keytarService.getRefreshTokenFromkeytar(h);if(m)try{const y=yield h.refreshToken(m);if(y){return yield this.handleTokenResponse(y,h)}}catch(h){}const y=yield I.keytarService.getAccessTokenFromKeytar(h);if(!y)throw new R.VSCodeLoginError(`Could not find access token for the strategy "${h.name}".`);if(h.parseTokenPayloadFromAccessToken){const m=h.parseTokenPayloadFromAccessToken(y);if(!m)throw new R.VSCodeLoginError(`Could not parse accessToken for the strategy "${h.name}".`);return yield this.handleTokenResponse(m,h)}throw new R.VSCodeLoginError(`Could not refresh nor access token for the strategy "${h.name}".`)}))}initialize(h){return v(this,void 0,void 0,(function*(){this.beginLoggingIn();const m=N.registeredStrategies.map(m=>this.initializeStrategy(m,h));yield Promise.all(m),this.updateStatus(),"activation"===h&&this.initialLoginAttemptSignal.resolve("LoggedIn"===this.api.status)}))}initializeStrategy(h,m){return v(this,void 0,void 0,(function*(){try{h.onTokenUpdated&&h.onTokenUpdated(m=>v(this,void 0,void 0,(function*(){yield this.handleTokenResponse(m,h)}))),yield this.getTokenForStrategy(h),this.sendLoginTelemetry(m,"tryExisting","uninitialized","success")}catch(y){yield this.clearTokensForStrategies([h]),y instanceof R.VSCodeLoginError&&y.reason?this.sendLoginTelemetry(m,"tryExisting","uninitialized","error",M.getErrorMessage(y.reason)||M.getErrorMessage(y)):this.sendLoginTelemetry(m,"tryExisting","uninitialized","failure",M.getErrorMessage(y))}}))}beginLoggingIn(){"LoggedIn"!==this.api.status&&(this.api.status="LoggingIn",this.onStatusChanged.fire(this.api.status))}updateStatus(){const h=VSCodeLoginHelper.tokensInternal.length?"LoggedIn":"LoggedOut";this.api.status!==h&&(this.api.status=h,this.onStatusChanged.fire(this.api.status))}updateSingleToken(h,m){return v(this,void 0,void 0,(function*(){const y=VSCodeLoginHelper.tokensInternal.findIndex((function(m){return h===m.strategy}));-1!==y?VSCodeLoginHelper.tokensInternal.splice(y,1,m):VSCodeLoginHelper.tokensInternal.push(m),this.onTokensChanged.fire()}))}clearTokensForStrategies(h=N.registeredStrategies){for(let m of h)this.clearTokenForStrategy(m)}clearTokenForStrategy(h){const m=VSCodeLoginHelper.tokensInternal.length;VSCodeLoginHelper.tokensInternal=VSCodeLoginHelper.tokensInternal.filter(m=>m.strategy!==h),m!==VSCodeLoginHelper.tokensInternal.length&&this.onTokensChanged.fire()}askForLogin(h={}){return v(this,void 0,void 0,(function*(){let m=!1;if((h=this.getOptionsWithDefaults(h)).shouldSkipQuestion)m=!0;else{const y={title:"Sign In"};m=(yield w.window.showInformationMessage(h.message,y))===y}if(m){return yield this.login("login",h.strategies,h.notificationOptions)}}))}waitForLogin(){return v(this,void 0,void 0,(function*(){switch(this.api.status){case"LoggedIn":return!0;case"LoggedOut":return!1;case"Initializing":case"LoggingIn":return new Promise(h=>{const m=this.api.onStatusChanged(()=>{m.dispose(),h(this.waitForLogin())})});default:const h=this.api.status;throw new Error(`Unexpected status '${h}'`)}}))}}m.VSCodeLoginHelper=VSCodeLoginHelper,VSCodeLoginHelper.tokensInternal=[],m.listAll=function listAll(h,m){return v(this,void 0,void 0,(function*(){const y=[];for(let v=yield m;v.length||v.nextLink;v=v.nextLink?yield h.listNext(v.nextLink):[])y.push(...v);return y}))}},function(h,m,y){"use strict";var v=this&&this.__awaiter||function(h,m,y,v){return new(y||(y=Promise))((function(C,T){function fulfilled(h){try{step(v.next(h))}catch(h){T(h)}}function rejected(h){try{step(v.throw(h))}catch(h){T(h)}}function step(h){h.done?C(h.value):function adopt(h){return h instanceof y?h:new y((function(m){m(h)}))}(h.value).then(fulfilled,rejected)}step((v=v.apply(h,m||[])).next())}))};Object.defineProperty(m,"__esModule",{value:!0});const C=y(419),T=y(2);m.CancellableTask=class CancellableTask{constructor(h,m){this.task=h,this.cancellationToken=m,this.signal=new T.Signal}run(){return v(this,void 0,void 0,(function*(){return this.task().then(this.signal.resolve.bind(this.signal)).catch(this.signal.reject.bind(this.signal)),this.cancellationToken.onCancellationRequested(h=>{this.signal.reject(new C.CancellationError(h||"Cancelled."))}),this.signal.promise}))}}},function(h,m,y){"use strict";var v;Object.defineProperty(m,"__esModule",{value:!0}),function(h){h.pending="pending",h.resolved="resolved",h.rejected="rejected"}(v=m.ReflectedPromiseStatus||(m.ReflectedPromiseStatus={})),m.reflectPromise=h=>h.then(h=>({status:v.resolved,value:h}),h=>({status:v.rejected,reason:h}))},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0});class VSCodeLoginError extends Error{constructor(h,m){super(h),this.reason=m}}m.VSCodeLoginError=VSCodeLoginError},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0}),m.getErrorMessage=function getErrorMessage(h){if(!h)return;if(h.message&&"string"==typeof h.message)return h.message;if(h.stack&&"string"==typeof h.stack)return h.stack.split("\n")[0];const m=String(h);if(!m||"[object Object]"===m){const m=h.constructor;if(m&&m.name&&"string"==typeof m.name)return m.name}return m}},function(h,m,y){"use strict";var v=this&&this.__awaiter||function(h,m,y,v){return new(y||(y=Promise))((function(C,T){function fulfilled(h){try{step(v.next(h))}catch(h){T(h)}}function rejected(h){try{step(v.throw(h))}catch(h){T(h)}}function step(h){h.done?C(h.value):function adopt(h){return h instanceof y?h:new y((function(m){m(h)}))}(h.value).then(fulfilled,rejected)}step((v=v.apply(h,m||[])).next())}))},C=this&&this.__importStar||function(h){if(h&&h.__esModule)return h;var m={};if(null!=h)for(var y in h)Object.hasOwnProperty.call(h,y)&&(m[y]=h[y]);return m.default=h,m};Object.defineProperty(m,"__esModule",{value:!0});const T=y(0),w=C(y(1033)),A=C(y(173)),P=y(2),k=y(1039),R=y(174),M=y(1040),N=y(421),D=y(422),I=["online.dev.core.vsengsaas.visualstudio.com","online-ppe.core.vsengsaas.visualstudio.com","online.visualstudio.com"];m.AADv2Strategy=class AADv2Strategy{constructor(){this.name="AADv2",this.publicName="Microsoft",this.endpointUrl="https://login.microsoftonline.com/",this.scope="email openid offline_access api://9db1d849-f699-4cfb-8160-64bed3335c72/All",this.clientId="a3037261-2c94-4a2e-b53f-090f6cdd712a",this.tenantId="common",this.activeRequests=new Map,this.minExpiration=0,this.getAccessToken=()=>v(this,void 0,void 0,(function*(){try{const h=yield this.getRedirectUri(),m=new URLSearchParams(h.query),y=M.guid(),v=`${this.endpointUrl}${this.tenantId}/oauth2/v2.0/authorize`,C=T.Uri.parse(v),A=m.get("state")||y;if(!A)throw new Error("No state param found.");const R=decodeURIComponent(h.with({query:""}).toString()),N={response_type:"code",scope:this.scope,client_id:this.clientId,redirect_uri:R,response_mode:"query",nonce:y,state:A,prompt:"select_account"},D=new P.Signal,I={strategy:this,redirect_uri:R,signal:D};this.activeRequests.set(A,I);const x=`${C}?${w.stringify(N).toString()}`;return k.isRunningIntegrationTest()?T.window.showInformationMessage("[SIGNIN] "+x):yield T.env.openExternal(T.Uri.parse(x)),D.promise}catch(h){throw new Error(h)}})),this.exchangeAuthorizationCode=(h,m)=>v(this,void 0,void 0,(function*(){const y={client_id:this.clientId,scope:this.scope,redirect_uri:m.redirect_uri,grant_type:"authorization_code",code:h},v=yield this.getRedirectUri(),C=I.indexOf(v.authority),A=I[C],P=w.stringify(y),k=A&&T.env.uiKind===T.UIKind.Web?`https://${A}/aad-code-grant-v2/${this.tenantId}/oauth2/v2.0/token`:`${this.endpointUrl}${this.tenantId}/oauth2/v2.0/token`,R=yield N.fetchPost(k,P);if(R.error_description)throw new Error(R.error_description);return this.jsonToToken(R)})),this.parseTokenPayloadFromAccessToken=h=>{const m=1e3*A.default(h).exp;return new Date(m).getTime()-Date.now()<=this.minExpiration?null:{accessToken:h,expiresOn:m,tokenType:"aadv2-vcode-account",strategy:this}}}getRedirectUri(){return D.getRedirectUri(R.Constants.extensionName)}receiveProtocolHandlerCallback(h){return v(this,void 0,void 0,(function*(){const m=w.parse(h.query),{state:y}=m;if(!y||"string"!=typeof y)return!1;const v=decodeURIComponent(y),C=this.activeRequests.get(v);if(!C)return!1;this.activeRequests.delete(v);const T=m.error;if(T)return console.log(T),C.signal.resolve(null),!0;const A=m.code;if(!A||"string"!=typeof A)return console.log('No "code" query param found.'),C.signal.resolve(null),!0;try{const h=yield this.exchangeAuthorizationCode(A,C);C.signal.resolve(h)}catch(h){console.log(h),C.signal.resolve(null)}finally{return!0}}))}refreshToken(h){return v(this,void 0,void 0,(function*(){const m=w.stringify({client_id:this.clientId,scope:this.scope,refresh_token:h,grant_type:"refresh_token"}),y=yield this.getRedirectUri(),v=I.indexOf(y.authority),C=I[v],A=C&&T.env.uiKind===T.UIKind.Web?`https://${C}/aad-code-grant-v2`:`${this.endpointUrl}${this.tenantId}/oauth2/v2.0/token`,P=yield N.fetchPost(A,m);if(P.error_description)throw new Error(P.error_description);return this.jsonToToken(P)}))}jsonToToken(h){return{accessToken:h.access_token,refreshToken:h.refresh_token,expiresOn:Date.now()+1e3*(h.expires_in-10),tokenType:h.token_type,strategy:this}}}},function(h,m,y){"use strict";const v=y(1034),C=y(1035),T=y(1036);function validateArrayFormatSeparator(h){if("string"!=typeof h||1!==h.length)throw new TypeError("arrayFormatSeparator must be single character string")}function encode(h,m){return m.encode?m.strict?v(h):encodeURIComponent(h):h}function decode(h,m){return m.decode?C(h):h}function removeHash(h){const m=h.indexOf("#");return-1!==m&&(h=h.slice(0,m)),h}function extract(h){const m=(h=removeHash(h)).indexOf("?");return-1===m?"":h.slice(m+1)}function parseValue(h,m){return m.parseNumbers&&!Number.isNaN(Number(h))&&"string"==typeof h&&""!==h.trim()?h=Number(h):!m.parseBooleans||null===h||"true"!==h.toLowerCase()&&"false"!==h.toLowerCase()||(h="true"===h.toLowerCase()),h}function parse(h,m){validateArrayFormatSeparator((m=Object.assign({decode:!0,sort:!0,arrayFormat:"none",arrayFormatSeparator:",",parseNumbers:!1,parseBooleans:!1},m)).arrayFormatSeparator);const y=function parserForArrayFormat(h){let m;switch(h.arrayFormat){case"index":return(h,y,v)=>{m=/\[(\d*)\]$/.exec(h),h=h.replace(/\[\d*\]$/,""),m?(void 0===v[h]&&(v[h]={}),v[h][m[1]]=y):v[h]=y};case"bracket":return(h,y,v)=>{m=/(\[\])$/.exec(h),h=h.replace(/\[\]$/,""),m?void 0!==v[h]?v[h]=[].concat(v[h],y):v[h]=[y]:v[h]=y};case"comma":case"separator":return(m,y,v)=>{const C="string"==typeof y&&y.split("").indexOf(h.arrayFormatSeparator)>-1?y.split(h.arrayFormatSeparator).map(m=>decode(m,h)):null===y?y:decode(y,h);v[m]=C};default:return(h,m,y)=>{void 0!==y[h]?y[h]=[].concat(y[h],m):y[h]=m}}}(m),v=Object.create(null);if("string"!=typeof h)return v;if(!(h=h.trim().replace(/^[?#&]/,"")))return v;for(const C of h.split("&")){let[h,w]=T(m.decode?C.replace(/\+/g," "):C,"=");w=void 0===w?null:"comma"===m.arrayFormat?w:decode(w,m),y(decode(h,m),w,v)}for(const h of Object.keys(v)){const y=v[h];if("object"==typeof y&&null!==y)for(const h of Object.keys(y))y[h]=parseValue(y[h],m);else v[h]=parseValue(y,m)}return!1===m.sort?v:(!0===m.sort?Object.keys(v).sort():Object.keys(v).sort(m.sort)).reduce((h,m)=>{const y=v[m];return Boolean(y)&&"object"==typeof y&&!Array.isArray(y)?h[m]=function keysSorter(h){return Array.isArray(h)?h.sort():"object"==typeof h?keysSorter(Object.keys(h)).sort((h,m)=>Number(h)-Number(m)).map(m=>h[m]):h}(y):h[m]=y,h},Object.create(null))}m.extract=extract,m.parse=parse,m.stringify=(h,m)=>{if(!h)return"";validateArrayFormatSeparator((m=Object.assign({encode:!0,strict:!0,arrayFormat:"none",arrayFormatSeparator:","},m)).arrayFormatSeparator);const y=function encoderForArrayFormat(h){switch(h.arrayFormat){case"index":return m=>(y,v)=>{const C=y.length;return void 0===v||h.skipNull&&null===v?y:null===v?[...y,[encode(m,h),"[",C,"]"].join("")]:[...y,[encode(m,h),"[",encode(C,h),"]=",encode(v,h)].join("")]};case"bracket":return m=>(y,v)=>void 0===v||h.skipNull&&null===v?y:null===v?[...y,[encode(m,h),"[]"].join("")]:[...y,[encode(m,h),"[]=",encode(v,h)].join("")];case"comma":case"separator":return m=>(y,v)=>null==v||0===v.length?y:0===y.length?[[encode(m,h),"=",encode(v,h)].join("")]:[[y,encode(v,h)].join(h.arrayFormatSeparator)];default:return m=>(y,v)=>void 0===v||h.skipNull&&null===v?y:null===v?[...y,encode(m,h)]:[...y,[encode(m,h),"=",encode(v,h)].join("")]}}(m),v=Object.assign({},h);if(m.skipNull)for(const h of Object.keys(v))void 0!==v[h]&&null!==v[h]||delete v[h];const C=Object.keys(v);return!1!==m.sort&&C.sort(m.sort),C.map(v=>{const C=h[v];return void 0===C?"":null===C?encode(v,m):Array.isArray(C)?C.reduce(y(v),[]).join("&"):encode(v,m)+"="+encode(C,m)}).filter(h=>h.length>0).join("&")},m.parseUrl=(h,m)=>({url:removeHash(h).split("?")[0]||"",query:parse(extract(h),m)}),m.stringifyUrl=(h,y)=>{const v=removeHash(h.url).split("?")[0]||"",C=m.extract(h.url),T=m.parse(C),w=function getHash(h){let m="";const y=h.indexOf("#");return-1!==y&&(m=h.slice(y)),m}(h.url),A=Object.assign(T,h.query);let P=m.stringify(A,y);return P&&(P=`?${P}`),`${v}${P}${w}`}},function(h,m,y){"use strict";h.exports=h=>encodeURIComponent(h).replace(/[!'()*]/g,h=>`%${h.charCodeAt(0).toString(16).toUpperCase()}`)},function(h,m,y){"use strict";var v=new RegExp("%[a-f0-9]{2}","gi"),C=new RegExp("(%[a-f0-9]{2})+","gi");function decodeComponents(h,m){try{return decodeURIComponent(h.join(""))}catch(h){}if(1===h.length)return h;m=m||1;var y=h.slice(0,m),v=h.slice(m);return Array.prototype.concat.call([],decodeComponents(y),decodeComponents(v))}function decode(h){try{return decodeURIComponent(h)}catch(C){for(var m=h.match(v),y=1;y<m.length;y++)m=(h=decodeComponents(m,y).join("")).match(v);return h}}h.exports=function(h){if("string"!=typeof h)throw new TypeError("Expected `encodedURI` to be of type `string`, got `"+typeof h+"`");try{return h=h.replace(/\+/g," "),decodeURIComponent(h)}catch(m){return function customDecodeURIComponent(h){for(var m={"%FE%FF":"","%FF%FE":""},y=C.exec(h);y;){try{m[y[0]]=decodeURIComponent(y[0])}catch(h){var v=decode(y[0]);v!==y[0]&&(m[y[0]]=v)}y=C.exec(h)}m["%C2"]="";for(var T=Object.keys(m),w=0;w<T.length;w++){var A=T[w];h=h.replace(new RegExp(A,"g"),m[A])}return h}(h)}}},function(h,m,y){"use strict";h.exports=(h,m)=>{if("string"!=typeof h||"string"!=typeof m)throw new TypeError("Expected the arguments to be of type `string`");if(""===m)return[h];const y=h.indexOf(m);return-1===y?[h]:[h.slice(0,y),h.slice(y+m.length)]}},function(h,m,y){var v=y(1038);h.exports=function(h){var m=h.replace(/-/g,"+").replace(/_/g,"/");switch(m.length%4){case 0:break;case 2:m+="==";break;case 3:m+="=";break;default:throw"Illegal base64url string!"}try{return function b64DecodeUnicode(h){return decodeURIComponent(v(h).replace(/(.)/g,(function(h,m){var y=m.charCodeAt(0).toString(16).toUpperCase();return y.length<2&&(y="0"+y),"%"+y})))}(m)}catch(h){return v(m)}}},function(h,m){function InvalidCharacterError(h){this.message=h}InvalidCharacterError.prototype=new Error,InvalidCharacterError.prototype.name="InvalidCharacterError",h.exports="undefined"!=typeof window&&window.atob&&window.atob.bind(window)||function polyfill(h){var m=String(h).replace(/=+$/,"");if(m.length%4==1)throw new InvalidCharacterError("'atob' failed: The string to be decoded is not correctly encoded.");for(var y,v,C=0,T=0,w="";v=m.charAt(T++);~v&&(y=C%4?64*y+v:v,C++%4)?w+=String.fromCharCode(255&y>>(-2*C&6)):0)v="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".indexOf(v);return w}},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0});const v=y(174);m.isRunningIntegrationTest=function isRunningIntegrationTest(){return!(process.env.VSONLINE_TEST_MODE!==v.Constants.VSONLINE_INTEGRATION_TEST)}},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0}),m.guid=()=>"xxxxxxxxxxxxxxxyxxxxxxxxxxxxxxx".replace(/[xy]/g,h=>{const m=16*Math.random()|0;return("x"===h?m:3&m|8).toString(16)})},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0}),m.isFunction=h=>"function"==typeof h},function(h,m,y){"use strict";var v=this&&this.__importStar||function(h){if(h&&h.__esModule)return h;var m={};if(null!=h)for(var y in h)Object.hasOwnProperty.call(h,y)&&(m[y]=h[y]);return m.default=h,m};Object.defineProperty(m,"__esModule",{value:!0});const C=v(y(0));m.getKeytar=()=>function getNodeModule(h){const m=require;try{return m(`${C.env.appRoot}/node_modules.asar/${h}`)}catch(h){}try{return m(`${C.env.appRoot}/node_modules/${h}`)}catch(h){}}("keytar")},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0}),m.getExpirationTimeMS=h=>new Date(h.expiresOn).getTime()-Date.now()},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0}),m.throttle=(h,m)=>{let y;return(...v)=>{if(y)return y;if(y=h(...v),setTimeout(()=>{y=void 0},m),!y)throw new Error("Throttle function does not have the running promise.");return y}}},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0});m.FakeTelemetryReporter=class FakeTelemetryReporter{sendTelemetryEvent(h,m){}dispose(){}}},function(h,m,y){"use strict";var v=this&&this.__awaiter||function(h,m,y,v){return new(y||(y=Promise))((function(C,T){function fulfilled(h){try{step(v.next(h))}catch(h){T(h)}}function rejected(h){try{step(v.throw(h))}catch(h){T(h)}}function step(h){h.done?C(h.value):function adopt(h){return h instanceof y?h:new y((function(m){m(h)}))}(h.value).then(fulfilled,rejected)}step((v=v.apply(h,m||[])).next())}))};Object.defineProperty(m,"__esModule",{value:!0});const C=y(0);m.ProtocolHandler=class ProtocolHandler{constructor(h,m){this.api=h,"function"==typeof C.window.registerUriHandler&&m.subscriptions.push(C.window.registerUriHandler(this))}handleUri(h){return v(this,void 0,void 0,(function*(){const{path:m}=h;switch(m.split("?")[0]){case"/signin":yield this.api.authCallback(h)}}))}dispose(){}}},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0});const v=y(424);class LiveShareGithubStrategy extends v.LiveShareStrategyBase{}m.LiveShareGithubStrategy=LiveShareGithubStrategy},function(h,m,y){"use strict";var v=this&&this.__awaiter||function(h,m,y,v){return new(y||(y=Promise))((function(C,T){function fulfilled(h){try{step(v.next(h))}catch(h){T(h)}}function rejected(h){try{step(v.throw(h))}catch(h){T(h)}}function step(h){h.done?C(h.value):function adopt(h){return h instanceof y?h:new y((function(m){m(h)}))}(h.value).then(fulfilled,rejected)}step((v=v.apply(h,m||[])).next())}))};Object.defineProperty(m,"__esModule",{value:!0});const C=y(25),T=y(424),w=y(96);class LiveShareAnonymousStrategy extends T.LiveShareStrategyBase{constructor(){super(...arguments),this.name="LiveShareAnonymous",this.publicName=C.localize("anonymousAuthStrategy.readOnlyUser"),this.prefixLabel=C.localize("anonymousAuthStrategy.continueAs"),this.description=C.localize("anonymousAuthStrategy.continueAsDescription"),this.getAccessToken=()=>v(this,void 0,void 0,(function*(){return yield this.getAnonymousToken()}))}getAnonymousToken(){return v(this,void 0,void 0,(function*(){const h=yield w.auth.API.fetchPost(`${this.endpointUrl()}auth/anonymous-token`,void 0,{"Content-Type":"application/json"});if(h.error_description)throw new Error(h.error_description);return this.parseTokenPayloadFromAccessToken(h.access_token)}))}refreshToken(h){return v(this,void 0,void 0,(function*(){return yield this.getAnonymousToken()}))}}m.LiveShareAnonymousStrategy=LiveShareAnonymousStrategy},function(h,m,y){"use strict";var v=this&&this.__awaiter||function(h,m,y,v){return new(y||(y=Promise))((function(C,T){function fulfilled(h){try{step(v.next(h))}catch(h){T(h)}}function rejected(h){try{step(v.throw(h))}catch(h){T(h)}}function step(h){h.done?C(h.value):function adopt(h){return h instanceof y?h:new y((function(m){m(h)}))}(h.value).then(fulfilled,rejected)}step((v=v.apply(h,m||[])).next())}))};Object.defineProperty(m,"__esModule",{value:!0});const C=y(0),T=y(8),w=y(17),A=y(24),P=y(63),k=y(75),R=y(12),M=y(14),N=y(5);function unPinAndFollowToTheSide(h,m){m.coeditingClient.unpinByClient(h,{explicit:!0}),m.coeditingClient.pin(null,h,!0)}m.CoEditingCommands=class CoEditingCommands{constructor(h){this.sessionContext=h}init(){return v(this,void 0,void 0,(function*(){yield A.ExtensionUtil.tryRegisterCommand("liveshare.follow",this.pinWithParticipantPrompt,this,!1),yield A.ExtensionUtil.tryRegisterCommand("liveshare.followToTheSide",this.followToTheSide,this,!1),yield A.ExtensionUtil.tryRegisterCommand("liveshare.followToTheSideFromActivityBar",this.followToTheSideSpecificUser,this,!1),yield A.ExtensionUtil.tryRegisterCommand("liveshare.followToTheSideFromTreeExplorer",this.followToTheSideSpecificUser,this,!1),yield A.ExtensionUtil.tryRegisterCommand("liveshare.followFromFileTreeExplorer",this.followSpecificUser,this,!1),yield A.ExtensionUtil.tryRegisterCommand("liveshare.followFromActivityBar",this.followSpecificUser,this,!1),yield A.ExtensionUtil.tryRegisterCommand("liveshare.listParticipants",this.listParticipants,this,!1),yield A.ExtensionUtil.tryRegisterCommand("liveshare.focusParticipantFromActivityBar",this.focusParticipant,this,!1),yield A.ExtensionUtil.tryRegisterCommand("liveshare.focusParticipantFromFileTreeExplorer",this.focusParticipant,this,!1),yield A.ExtensionUtil.tryRegisterCommand("liveshare.unfollow",this.unpinEditorCommandHandler,this,!0),yield A.ExtensionUtil.tryRegisterCommand("liveshare.unfollowFromFileTreeExplorer",this.unpinClientCommandHandler,this,!1),yield A.ExtensionUtil.tryRegisterCommand("liveshare.unfollowFromActivityBar",this.unpinClientCommandHandler,this,!1),yield A.ExtensionUtil.tryRegisterCommand("liveshare.changePresenter",this.changePresenter,this,!1)}))}dispose(){return v(this,void 0,void 0,(function*(){A.ExtensionUtil.disposeCommand("liveshare.follow"),A.ExtensionUtil.disposeCommand("liveshare.followFromFileTreeExplorer"),A.ExtensionUtil.disposeCommand("liveshare.followFromActivityBar"),A.ExtensionUtil.disposeCommand("liveshare.unfollow"),A.ExtensionUtil.disposeCommand("liveshare.unfollowFromFileTreeExplorer"),A.ExtensionUtil.disposeCommand("liveshare.unfollowFromActivityBar")}))}followToTheSide(){return v(this,void 0,void 0,(function*(){if(!this.getCollaboratorsIfWeHaveSome())return;if(!C.window.activeTextEditor)return this.pinWithParticipantPrompt(!1);let h=this.sessionContext.coeditingClient.getClientIdIfEditorIsPinned(C.window.activeTextEditor);-1===h&&(h=yield this.promptForParticipantsToFollow(!1)),-1!==h&&unPinAndFollowToTheSide(h,this.sessionContext)}))}followToTheSideSpecificUser(h){unPinAndFollowToTheSide(null==h?void 0:h.sessionId,this.sessionContext)}followSpecificUser(h){return v(this,arguments,void 0,(function*(){if(void 0===h){let h="";const m=[].slice.call(arguments);return m.forEach(m=>h+=` ${null===m?null:typeof m}`),T.Telemetry.sendFault(w.TelemetryEventNames.FOLLOW_USER_FAILURE,T.FaultType.Error,`User is undefined. Args length: ${m.length}. Args types: ${h}`),void(yield this.pinWithParticipantPrompt(!0))}yield this.sessionContext.coeditingClient.pin(null,h.sessionId)}))}changePresenter(h){return v(this,void 0,void 0,(function*(){const m=h||(yield this.promptForParticipantToPresent());m<0||this.sessionContext.coeditingClient.presentationManager.updatePresenterId(m)}))}pinWithParticipantPrompt(h){return v(this,void 0,void 0,(function*(){const m=this.getCollaboratorsIfWeHaveSome();if(!m)return;let y=!1;"boolean"==typeof h&&(y=h);let v=m[0];(m.length>1||y)&&(v=yield this.promptForParticipantsToFollow(y)),-1!==v&&(yield this.sessionContext.coeditingClient.pin(null,v))}))}promptForParticipantToPresent(){return v(this,void 0,void 0,(function*(){const h=[this.sessionContext.coeditingClient.clientID].concat(this.sessionContext.collaboratorManager.getCollaboratorSessionIds()).map(h=>{let m=this.sessionContext.collaboratorManager.getDisplayName(h);return this.sessionContext.coeditingClient.presentationManager.currentPresenterId===h&&(m=`${m} (Current Presenter)`),{description:m,label:"$(person)",targetSessionId:h}}),m=yield C.window.showQuickPick(h,{placeHolder:"Select a new presenter or press 'Escape' to cancel."});return m?m.targetSessionId:-1}))}promptForParticipantsToFollow(h){return v(this,void 0,void 0,(function*(){const m=this.getCollaboratorsIfWeHaveSome();if(!m)return-1;const y=h?m.length+" participant location(s) listed below. Select one to follow or press 'Escape' when done.":"Select a participant to follow",v=m.map(h=>{const m=this.sessionContext.collaboratorManager.getDisplayName(h),y=this.sessionContext.coeditingClient.lastKnownFileForClient(h);return{description:m,detail:y?`Currently editing ${y}`:"Not currently editing a shared document",label:"$(file-symlink-file)",targetSessionId:h}}),T=yield C.window.showQuickPick(v,{placeHolder:y});return T?T.targetSessionId:-1}))}unpinClientCommandHandler(h){var m,y;return v(this,void 0,void 0,(function*(){if(void 0===h){const{coeditingClient:h}=this.sessionContext,y=h.getUsersBeingFollowed(),v=Object.keys(y)[0];return P.assert(Object.keys(y).length<=1,"User is following more than one person."),P.assert(Object.keys(y).length>=1,"User is following less than one person."),void 0===v?void T.Telemetry.sendFault(w.TelemetryEventNames.UNFOLLOW_USER_FAILURE,T.FaultType.Error,`User parameter is undefined. Cannot find followed user from getUsersBeingFollowed(): ${y}.`):void(null===(m=this.sessionContext.coeditingClient)||void 0===m||m.unpinByClient(Number(v),{explicit:!0}))}null===(y=this.sessionContext.coeditingClient)||void 0===y||y.unpinByClient(h.sessionId,{explicit:!0})}))}unpinEditorCommandHandler(h,m,y){var C;return v(this,void 0,void 0,(function*(){null===(C=this.sessionContext.coeditingClient)||void 0===C||C.unpinByEditor(h,{explicit:!0})}))}getCollaboratorsIfWeHaveSome(){if(!this.sessionContext.coeditingClient||!this.sessionContext.collaboratorManager)return;const h=this.sessionContext.collaboratorManager.getCollaboratorSessionIds();return h.length<1?void 0:h}listParticipants(){return v(this,void 0,void 0,(function*(){yield this.pinWithParticipantPrompt(!0)}))}focusParticipant(h){return v(this,void 0,void 0,(function*(){T.Telemetry.sendTelemetryEvent(w.TelemetryEventNames.FOCUS_PARTICIPANT),this.sessionContext.coeditingClient.postMessage(k.MessageFactory.SummonMessage(this.sessionContext.coeditingClient.clientID,h.sessionId));const m=!!R.Settings.get(M.SettingKeys.showVerboseNotifications);yield N.NotificationUtil.showInformationMessage("Focus request sent.",m)}))}}},function(h,m,y){"use strict";var v=this&&this.__awaiter||function(h,m,y,v){return new(y||(y=Promise))((function(C,T){function fulfilled(h){try{step(v.next(h))}catch(h){T(h)}}function rejected(h){try{step(v.throw(h))}catch(h){T(h)}}function step(h){h.done?C(h.value):function adopt(h){return h instanceof y?h:new y((function(m){m(h)}))}(h.value).then(fulfilled,rejected)}step((v=v.apply(h,m||[])).next())}))};Object.defineProperty(m,"__esModule",{value:!0});const C=y(5),T=y(23);class SessionStateManager extends(C.Inittable(C.Disposable(Object))){constructor(){super(),this.handlers=[],this.stateChangedRegistration=T.sessionStateTracker.onStateChanged(h=>this.handleSessionStateChanged(h.newState,h.oldState))}registerHandler(h){this.handlers.push(h)}dispose(){const h=Object.create(null,{dispose:{get:()=>super.dispose}});return v(this,void 0,void 0,(function*(){this.stateChangedRegistration.dispose(),yield Promise.all(this.handlers.map(h=>h.dispose?h.dispose():Promise.resolve())),yield h.dispose.call(this)}))}handleSessionStateChanged(h,m){return v(this,void 0,void 0,(function*(){yield Promise.all(this.handlers.map(y=>y.handleSessionStateChanged(h,m)))}))}}m.SessionStateManager=SessionStateManager},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0});const v=y(426),C=y(34);m.errorNotificationCommandDecoratorFactory=(h,m,y,T,w=!1,A)=>new v.ErrorNotificationCommandDecorator(C.DecoratorHelper.getCoreCommand(h),h,m.telemetry(),y,T,w,A)},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0});const v=y(427),C=y(34);m.telemetryCommandDecoratorFactory=(h,m,y,T,w,A,P)=>new v.TelemetryCommandDecorator(C.DecoratorHelper.getCoreCommand(h),h,m.workspaceService(),m.telemetry(),y,T,w,A||1,P)},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0});class IndeterminateError extends Error{constructor(h,m){super(h),this.code=m}}m.IndeterminateError=IndeterminateError},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0});const v=y(433),C=y(5),T=y(97),w=y(12),A=y(14);class GitHubAuthTokenProvider extends v.VsCodeNativeAuthTokenProvider{constructor(h){h=null!=h?h:C.traceSource.withName(T.SupportedAuthProviders.GitHub);const m=w.Settings.get(A.SettingKeys.runsInVSCodeDev)?["read:user","user:email","repo"]:["read:user","user:email"];super(T.SupportedAuthProviders.GitHub,m,h)}}m.GitHubAuthTokenProvider=GitHubAuthTokenProvider},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0}),m.WebECDiffieHellman=m.WebDiffieHellman=void 0;const v=y(9),C=y(434),T=y(245),w=y(248),A=y(54),P=y(249);class WebDiffieHellman extends T.KeyExchangeAlgorithm{constructor(h,m,y){super(h,m,y,w.WebHmac.getHashDigestLength(y))}createKeyExchange(){return new WebDiffieHellmanKex(this.keySizeInBits,w.WebHmac.getWebHashAlgorithmName(this.hashAlgorithmName),this.hashDigestLength)}}m.WebDiffieHellman=WebDiffieHellman;class WebDiffieHellmanKex{constructor(h,m,y){switch(this.hashAlgorithmName=m,this.digestLength=y,h){case 1024:this.dh=(0,C.getDiffieHellman)("modp2");break;case 2048:this.dh=(0,C.getDiffieHellman)("modp14");break;case 4096:this.dh=(0,C.getDiffieHellman)("modp16");break;default:throw new Error("Invalid DH bit length.")}}startKeyExchange(){const h=this.dh.generateKeys(),m=A.BigInt.fromBytes(h,{unsigned:!0}).toBytes();return Promise.resolve(m)}decryptKeyExchange(h){const m=this.dh.computeSecret(h),y=A.BigInt.fromBytes(m,{unsigned:!0}).toBytes();return Promise.resolve(y)}async sign(h){const m=await crypto.subtle.digest(this.hashAlgorithmName,h);return v.Buffer.from(m)}dispose(){}}class WebECDiffieHellman extends T.KeyExchangeAlgorithm{constructor(h,m,y){super(h,m,y,w.WebHmac.getHashDigestLength(y))}createKeyExchange(){return new WebECDiffieHellmanKex(this.keySizeInBits,w.WebHmac.getWebHashAlgorithmName(this.hashAlgorithmName),this.hashDigestLength)}}m.WebECDiffieHellman=WebECDiffieHellman;class WebECDiffieHellmanKex{constructor(h,m,y){this.bitLength=h,this.hashAlgorithmName=m,this.digestLength=y,this.algorithm={name:"ECDH",namedCurve:"P-"+h}}async startKeyExchange(){this.keyPair||(this.keyPair=await crypto.subtle.generateKey(this.algorithm,!0,["deriveBits"]));const h=await crypto.subtle.exportKey("jwk",this.keyPair.publicKey),m=P.JsonWebKeyFormatter.parseEC(h),y=Math.ceil(this.bitLength/8),C=v.Buffer.alloc(1+2*y);return C[0]=4,m.x.toBytes({unsigned:!0,length:y}).copy(C,1),m.y.toBytes({unsigned:!0,length:y}).copy(C,1+y),v.Buffer.from(C)}async decryptKeyExchange(h){if(!this.keyPair)throw new Error("Key exchange not started.");const m=h,y=P.JsonWebKeyFormatter.formatEC({curve:{name:this.algorithm.namedCurve},x:A.BigInt.fromBytes(m.slice(1,1+(m.length-1)/2),{unsigned:!0}),y:A.BigInt.fromBytes(m.slice(1+(m.length-1)/2),{unsigned:!0})}),C=await crypto.subtle.importKey("jwk",y,this.algorithm,!1,[]),T=v.Buffer.from(await crypto.subtle.deriveBits(Object.assign(Object.assign({},this.algorithm),{public:C}),this.keyPair.privateKey,8*Math.ceil(this.bitLength/8)));return A.BigInt.fromBytes(T,{unsigned:!0}).toBytes()}async sign(h){const m=await crypto.subtle.digest(this.hashAlgorithmName,h);return v.Buffer.from(m)}dispose(){}}},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0}),m.WebRsa=void 0;const v=y(9),C=y(126),T=y(248),w=y(38),A=y(249);class WebRsaKeyPair{constructor(h){this.hashAlgorithm=h,this.comment=null}get hasPublicKey(){return!!this.publicKey}get hasPrivateKey(){return!!this.privateKey}get keyAlgorithmName(){return WebRsa.keyAlgorithmName}async generate(h){h=null!=h?h:WebRsaKeyPair.defaultKeySize;try{const m={name:"RSASSA-PKCS1-v1_5",modulusLength:h,publicExponent:new Uint8Array([1,0,1]),hash:{name:this.hashAlgorithm}},y=await crypto.subtle.generateKey(m,!0,["sign","verify"]);this.publicKey=y.publicKey,this.privateKey=y.privateKey}catch(h){throw new Error("Failed to generate RSA key pair: "+h)}}async setPublicKeyBytes(h){if(!h)throw new TypeError("Buffer is required.");const m=new w.SshDataReader(h),y=m.readString("ascii");if(y!==this.keyAlgorithmName&&y!==WebRsa.rsaWithSha256&&y!==WebRsa.rsaWithSha512)throw new Error(`Invalid RSA key algorithm: ${y}`);const v=m.readBigInt(),C=m.readBigInt(),T=A.JsonWebKeyFormatter.formatRsa({modulus:C,exponent:v},!1);T.alg="RS"+this.hashAlgorithm.replace("SHA-",""),T.key_ops=["verify"];try{const h={name:"RSASSA-PKCS1-v1_5",hash:{name:this.hashAlgorithm}};this.publicKey=await crypto.subtle.importKey("jwk",T,h,!0,["verify"])}catch(h){throw new Error("Failed to import RSA public key: "+h)}}async getPublicKeyBytes(h){if(!this.publicKey)return null;let m;h||(h=this.keyAlgorithmName);try{m=await crypto.subtle.exportKey("jwk",this.publicKey)}catch(h){throw new Error("Failed to export RSA public key: "+h)}const{modulus:y,exponent:C}=A.JsonWebKeyFormatter.parseRsa(m,!1),T=v.Buffer.alloc(512),P=new w.SshDataWriter(T);return P.writeString(h,"ascii"),P.writeBigInt(C),P.writeBigInt(y),P.toBuffer()}async importParameters(h){const m=h.d?A.JsonWebKeyFormatter.formatRsa(h,!0):null,y=A.JsonWebKeyFormatter.formatRsa(h,!1),v={name:"RSASSA-PKCS1-v1_5",hash:{name:this.hashAlgorithm}};try{this.publicKey=await crypto.subtle.importKey("jwk",y,v,!0,["verify"]),this.privateKey=m?await crypto.subtle.importKey("jwk",m,v,!0,["sign"]):void 0}catch(h){if(!(h instanceof Error))throw h;throw new Error("Failed to import RSA key pair: "+h.message)}}async exportParameters(){var h;if(!this.publicKey)throw new Error("Public key not set.");let m;try{m=await crypto.subtle.exportKey("jwk",null!==(h=this.privateKey)&&void 0!==h?h:this.publicKey)}catch(h){if(!(h instanceof Error))throw h;throw new Error("Failed to export RSA public key: "+h.message)}return A.JsonWebKeyFormatter.parseRsa(m,!!this.privateKey)}dispose(){}}WebRsaKeyPair.defaultKeySize=2048;class WebRsa extends C.PublicKeyAlgorithm{constructor(h,m){super(h,WebRsa.keyAlgorithmName,m)}createKeyPair(){const h=WebRsa.convertHashAlgorithmName(this.hashAlgorithmName);return new WebRsaKeyPair(h)}async generateKeyPair(h){const m=WebRsa.convertHashAlgorithmName(this.hashAlgorithmName),y=new WebRsaKeyPair(m);return await y.generate(h),y}createSigner(h){if(!(h instanceof WebRsaKeyPair))throw new TypeError("RSA key pair object expected.");const m=WebRsa.convertHashAlgorithmName(this.hashAlgorithmName);return new WebRsaSignerVerifier(h,m,T.WebHmac.getHashDigestLength(this.hashAlgorithmName))}createVerifier(h){if(!(h instanceof WebRsaKeyPair))throw new TypeError("RSA key pair object expected.");const m=WebRsa.convertHashAlgorithmName(this.hashAlgorithmName);return new WebRsaSignerVerifier(h,m,T.WebHmac.getHashDigestLength(this.hashAlgorithmName))}static convertHashAlgorithmName(h){return h.replace("SHA2-","SHA-")}}m.WebRsa=WebRsa,WebRsa.keyAlgorithmName="ssh-rsa",WebRsa.rsaWithSha256="rsa-sha2-256",WebRsa.rsaWithSha512="rsa-sha2-512",WebRsa.KeyPair=WebRsaKeyPair;class WebRsaSignerVerifier{constructor(h,m,y){this.keyPair=h,this.hashAlgorithm=m,this.digestLength=y}async sign(h){if(!this.keyPair.privateKey)throw new Error("Private key not set.");return await this.convertKeyHashAlgorithm(),v.Buffer.from(await crypto.subtle.sign("RSASSA-PKCS1-v1_5",this.keyPair.privateKey,h))}async verify(h,m){if(!this.keyPair.publicKey)throw new Error("Public key not set.");return await this.convertKeyHashAlgorithm(),await crypto.subtle.verify("RSASSA-PKCS1-v1_5",this.keyPair.publicKey,m,h)}async convertKeyHashAlgorithm(){if(this.keyPair.hashAlgorithm!==this.hashAlgorithm){const h=await this.keyPair.exportParameters();this.keyPair=new WebRsaKeyPair(this.hashAlgorithm),await this.keyPair.importParameters(h)}}dispose(){}}},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0}),m.WebECDsa=void 0;const v=y(9),C=y(126),T=y(38),w=y(175),A=y(54),P=y(249);class WebECDsaKeyPair{constructor(h){this.comment=null,h&&(this.algorithmName=h)}get hasPublicKey(){return!!this.publicKey}get hasPrivateKey(){return!!this.privateKey}get keyAlgorithmName(){return this.algorithmName}get algorithmName(){return this.algorithm}set algorithmName(h){const m=h.split("-")[2];if(this.curve=w.curves.find(h=>h.name===m),!this.curve)throw new Error("Invalid or unsupported ECDSA algorithm: "+h);this.algorithm=h}async generate(){try{const h={name:"ECDSA",namedCurve:this.curve.shortName},m=await crypto.subtle.generateKey(h,!0,["sign","verify"]);this.publicKey=m.publicKey,this.privateKey=m.privateKey}catch(h){throw new Error("Failed to generate RSA key pair: "+h)}}async setPublicKeyBytes(h,m){if(!h)throw new TypeError("Buffer is required.");const y=new T.SshDataReader(h),v=y.readString("ascii");if(this.algorithmName=m||v,y.readString("ascii")!==this.curve.name)throw new Error("EC curve name does not match.");const C=y.readBinary(),w=Math.ceil(this.curve.keySize/8),k=A.BigInt.fromBytes(C.slice(1,1+w),{unsigned:!0}),R=A.BigInt.fromBytes(C.slice(1+w,C.length),{unsigned:!0}),M=P.JsonWebKeyFormatter.formatEC({curve:{name:this.curve.shortName,oid:this.curve.oid},x:k,y:R});try{const h={name:"ECDSA",namedCurve:this.curve.shortName};this.publicKey=await crypto.subtle.importKey("jwk",M,h,!0,["verify"])}catch(h){throw new Error("Failed to import EC public key: "+h)}}async getPublicKeyBytes(h){if(!this.publicKey)return null;let m;try{m=await crypto.subtle.exportKey("jwk",this.publicKey)}catch(h){throw new Error("Failed to export ECDSA public key: "+h)}const y=v.Buffer.from(m.x,"base64"),C=v.Buffer.from(m.y,"base64"),w=Math.ceil(this.curve.keySize/8);if(y.length!==w||C.length!==w)throw new Error("Unexpected key length.");h=h||this.algorithmName||this.keyAlgorithmName;const A=v.Buffer.alloc(h.length+y.length+C.length+10),P=new T.SshDataWriter(A);return P.writeString(h,"ascii"),P.writeString(this.curve.name,"ascii"),P.writeUInt32(1+y.length+C.length),P.writeByte(4),P.write(y),P.write(C),P.toBuffer()}async importParameters(h){if(!h.curve)throw new TypeError("A curve is required.");let m;if(h.curve.oid){if(m=w.curves.find(m=>m.oid===h.curve.oid),!m)throw new Error(`Unsupported curve OID: ${h.curve.oid}`)}else{if(!h.curve.name)throw new TypeError("A curve OID or name is required.");if(m=w.curves.find(m=>m.name===h.curve.name),!m)throw new Error(`Unsupported curve: ${h.curve.name}`)}this.algorithmName="ecdsa-sha2-"+m.name;const y={name:"ECDSA",namedCurve:this.curve.shortName},v=P.JsonWebKeyFormatter.formatEC(h);v.crv=this.curve.shortName;try{v.d?(this.privateKey=await crypto.subtle.importKey("jwk",v,y,!0,["sign"]),v.d=void 0):this.privateKey=void 0,this.publicKey=await crypto.subtle.importKey("jwk",v,y,!0,["verify"])}catch(h){throw new Error("Failed to import ECDSA key pair: "+h)}}async exportParameters(){var h;const m=null!==(h=this.privateKey)&&void 0!==h?h:this.publicKey;if(!m)throw new Error("Key not present.");let y;try{y=await crypto.subtle.exportKey("jwk",m)}catch(h){throw new Error("Failed to export ECDSA key pair: "+h)}const v=P.JsonWebKeyFormatter.parseEC(y);return v.curve={name:this.curve.name,oid:this.curve.oid},v}dispose(){}}class WebECDsa extends C.PublicKeyAlgorithm{constructor(h,m){super(h,h,m)}createKeyPair(){return new WebECDsaKeyPair(this.name)}async generateKeyPair(){const h=new WebECDsaKeyPair(this.name);return await h.generate(),h}createSigner(h){if(!(h instanceof WebECDsaKeyPair))throw new TypeError("ECDSA key pair object expected.");const m=WebECDsa.convertHashAlgorithmName(this.hashAlgorithmName);return new WebECDsaSignerVerifier(h,m)}createVerifier(h){if(!(h instanceof WebECDsaKeyPair))throw new TypeError("ECDSA key pair object expected.");const m=WebECDsa.convertHashAlgorithmName(this.hashAlgorithmName);return new WebECDsaSignerVerifier(h,m)}static convertHashAlgorithmName(h){return h.replace("SHA2-","SHA-")}static getSignatureLength(h){return 2*(5+Math.ceil(h/8))}}m.WebECDsa=WebECDsa,WebECDsa.ecdsaSha2Nistp256="ecdsa-sha2-nistp256",WebECDsa.ecdsaSha2Nistp384="ecdsa-sha2-nistp384",WebECDsa.ecdsaSha2Nistp521="ecdsa-sha2-nistp521",WebECDsa.curves=w.curves,WebECDsa.KeyPair=WebECDsaKeyPair;class WebECDsaSignerVerifier{constructor(h,m){this.keyPair=h,this.hashAlgorithm=m}get digestLength(){const h=this.keyPair.curve;return h?WebECDsa.getSignatureLength(h.keySize):0}async sign(h){if(!this.keyPair.privateKey)throw new Error("Private key not set.");let m=v.Buffer.from(await crypto.subtle.sign({name:"ECDSA",hash:{name:this.hashAlgorithm}},this.keyPair.privateKey,h));const y=Math.ceil(this.keyPair.curve.keySize/8);if(m.length!==2*y)throw new Error(`Unexpected signature length: ${m.length}`);const C=A.BigInt.fromBytes(m.slice(0,y),{unsigned:!0}),w=A.BigInt.fromBytes(m.slice(y,m.length),{unsigned:!0}),P=new T.SshDataWriter(v.Buffer.alloc(this.digestLength));return P.writeBinary(C.toBytes({unsigned:!0,length:y+1})),P.writeBinary(w.toBytes({unsigned:!0,length:y+1})),m=P.toBuffer(),m}async verify(h,m){if(!this.keyPair.publicKey)throw new Error("Public key not set.");const y=new T.SshDataReader(m),C=y.readBigInt(),w=y.readBigInt(),A=Math.ceil(this.keyPair.curve.keySize/8);return m=v.Buffer.alloc(2*A),C.toBytes({unsigned:!0,length:A}).copy(m,0),w.toBytes({unsigned:!0,length:A}).copy(m,A),await crypto.subtle.verify({name:"ECDSA",hash:{name:this.hashAlgorithm}},this.keyPair.publicKey,m,h)}dispose(){}}},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0}),m.WebEncryption=void 0;const v=y(48),C=y(9),T=y(246);class WebEncryption extends T.EncryptionAlgorithm{constructor(h,m,y,v){super(h),this.algorithmName=m,this.cipherMode=y,this.keySizeInBits=v,this.blockSizeInBits=WebEncryption.getBlockSize(m)}get keyLength(){return this.keySizeInBits/8}get blockLength(){return this.blockSizeInBits/8}async createCipher(h,m,y){const v=new WebCipher(h,this.algorithmName,this.cipherMode,this.keySizeInBits,this.blockSizeInBits);return await v.init(m,y),v}static getBlockSize(h){if("AES"===h)return 128;throw new Error(`Unsupported encryption algorithm: ${h}`)}}m.WebEncryption=WebEncryption;class WebCipher{constructor(h,m,y,v,T){if(this.isEncryption=h,this.algorithmName=m,this.cipherMode=y,this.keySizeInBits=v,this.blockSizeInBits=T,this.tag=null,"AES"===this.algorithmName&&"CTR"===this.cipherMode)this.transform=this.aesCtr.bind(this,h);else if("AES"===this.algorithmName&&"CBC"===this.cipherMode)this.transform=this.aesCbc.bind(this,h);else{if("AES"!==this.algorithmName||"GCM"!==this.cipherMode)throw new Error(`Unsupported encryption algorithm: ${this.algorithmName}-${this.cipherMode}`);this.transform=this.aesGcm.bind(this,h),this.associatedData=C.Buffer.alloc(4),this.decryptBuffer=C.Buffer.alloc(4*this.blockLength)}}get blockLength(){return this.blockSizeInBits/8}async init(h,m){try{const m=`${this.algorithmName}-${this.cipherMode}`;this.key=await crypto.subtle.importKey("raw",h,{name:m,length:this.keySizeInBits},!1,this.isEncryption?["encrypt"]:["decrypt"])}catch(h){throw new Error("Failed to initialize AES: "+h)}"GCM"===this.cipherMode?this.iv=C.Buffer.from(m.slice(0,12)):this.iv=C.Buffer.from(m)}async aesCtr(h,m){if(m.length%this.blockLength!=0){const h="Encrypt/decrypt input has invalid length "+`${m.length}, not a multiple of block size ${this.blockLength}.`;throw(0,v.trace)("Error: "+h),new Error(h)}let y;if(y=h?C.Buffer.from(await crypto.subtle.encrypt({name:"AES-CTR",counter:this.iv,length:this.blockSizeInBits},this.key,m)):C.Buffer.from(await crypto.subtle.decrypt({name:"AES-CTR",counter:this.iv,length:this.blockSizeInBits},this.key,m)),y.length!==m.length){const h="Result from encrypt/decrypt has invalid length "+`${y.length}, expected ${m.length}.`;throw(0,v.trace)("Error: "+h),new Error(h)}const T=m.length/this.blockLength;for(let h=0;h<T;h++)for(let h=this.iv.length-1;h>=0&&(this.iv[h]=this.iv[h]+1,!this.iv[h]);h--);return y}async aesCbc(h,m){if(h){let h=C.Buffer.from(await crypto.subtle.encrypt({name:"AES-CBC",iv:this.iv},this.key,m));return h=h.slice(0,m.length),h}return C.Buffer.from(await crypto.subtle.decrypt({name:"AES-CBC",iv:this.iv},this.key,m))}async aesGcm(h,m){if(m.length%this.blockLength!=0){const h="Encrypt/decrypt input has invalid length "+`${m.length}, not a multiple of block size ${this.blockLength}.`;throw(0,v.trace)("Error: "+h),new Error(h)}const y=m.length;let T;if(this.associatedData[0]=y>>>24,this.associatedData[1]=y>>>16,this.associatedData[2]=y>>>8,this.associatedData[3]=y,h)T=C.Buffer.from(await crypto.subtle.encrypt({name:"AES-GCM",iv:this.iv,additionalData:this.associatedData,tagLength:8*this.digestLength},this.key,m)),this.tag=T.slice(T.length-this.digestLength),T=T.slice(0,T.length-this.digestLength);else{if(!this.tag)throw new Error("AES-GCM tag was not set before decrypting.");const h=m.length+this.digestLength;if(this.decryptBuffer.length<h){let m=2*this.decryptBuffer.length;for(;m<h;)m*=2;this.decryptBuffer=C.Buffer.alloc(m)}const y=this.decryptBuffer.slice(0,h);m.copy(y,0),this.tag.copy(y,m.length),T=C.Buffer.from(await crypto.subtle.decrypt({name:"AES-GCM",iv:this.iv,additionalData:this.associatedData,tagLength:8*this.digestLength},this.key,y))}if(T.length!==m.length){const h="Result from encrypt/decrypt has invalid length "+`${T.length}, expected ${m.length}.`;throw(0,v.trace)("Error: "+h),new Error(h)}let w=12;for(;--w>=4&&(this.iv[w]++,0===this.iv[w]););return T}get digestLength(){return 16}get authenticatedEncryption(){return"GCM"===this.cipherMode}async sign(h){if(!this.tag)throw new Error("AES-GCM tag was not obtained by encrypting.");return this.tag}async verify(h,m){if(m.length!==this.digestLength)throw new Error("Incorrect AES-GCM tag length.");return this.tag=m,!0}dispose(){}}},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0}),m.WebRandom=void 0;m.WebRandom=class WebRandom{getBytes(h){crypto.getRandomValues(h)}}},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0}),m.NodeRsa=void 0;const v=y(11),C=y(9),T=y(126),w=y(38),A=y(250),P=y(437),k=process.versions.node.split(".").map(h=>parseInt(h,10)),R=k[0]>10||10===k[0]&&k[1]>=12,M=k[0]>11||11===k[0]&&k[1]>=6;class NodeRsaKeyPair{constructor(){this.comment=null}get hasPublicKey(){return!!this.publicKey}get hasPrivateKey(){return!!this.privateKey}get keyAlgorithmName(){return NodeRsa.keyAlgorithmName}generate(h){return h=null!=h?h:NodeRsaKeyPair.defaultKeySize,R&&M?this.generateNodeKeyPairObjects(h):R?this.generateNodeKeyPairBuffers(h):this.generateExternalKeyPair(h)}async generateNodeKeyPairObjects(h){[this.publicKey,this.privateKey]=await new Promise((m,y)=>{const C={modulusLength:h};try{v.generateKeyPair("rsa",C,(h,v,C)=>{h?y(h):m([v,C])})}catch(h){y(h)}})}async generateNodeKeyPairBuffers(h){[this.publicKey,this.privateKey]=await new Promise((m,y)=>{const C={modulusLength:h,publicKeyEncoding:{type:"pkcs1",format:"pem"},privateKeyEncoding:{type:"pkcs1",format:"pem",cipher:void 0,passphrase:void 0}};try{v.generateKeyPair("rsa",C,(h,v,C)=>{h?y(h):m([v,C])})}catch(h){y(h)}})}async generateExternalKeyPair(h){const m=new(await Promise.resolve().then(()=>y(438)))({b:h});this.publicKey=m.exportKey("pkcs1-public-pem"),this.privateKey=m.exportKey("pkcs1-private-pem"),this.publicKey.endsWith("\n")||(this.publicKey+="\n"),this.privateKey.endsWith("\n")||(this.privateKey+="\n")}async setPublicKeyBytes(h){if(!h)throw new TypeError("Buffer is required.");const m=new w.SshDataReader(h),y=m.readString("ascii");if(y!==this.keyAlgorithmName&&y!==NodeRsa.rsaWithSha256&&y!==NodeRsa.rsaWithSha512)throw new Error(`Invalid RSA key algorithm: ${y}`);const C=m.readBigInt(),T=m.readBigInt();h=P.Pkcs1KeyFormatter.formatRsaPublic({modulus:T,exponent:C}),this.publicKey=M?v.createPublicKey({key:h,type:"pkcs1",format:"der"}):(0,P.formatPem)(h,"RSA PUBLIC KEY")}async getPublicKeyBytes(h){if(!this.publicKey)return null;let m;h||(h=this.keyAlgorithmName),m="string"==typeof this.publicKey?(0,P.parsePem)(this.publicKey):this.publicKey.export({type:"pkcs1",format:"der"});const y=P.Pkcs1KeyFormatter.parseRsaPublic(m),v=C.Buffer.alloc(512),T=new w.SshDataWriter(v);return T.writeString(h,"ascii"),T.writeBigInt(y.exponent),T.writeBigInt(y.modulus),m=T.toBuffer(),m}async importParameters(h){if(M)this.publicKey=v.createPublicKey({key:P.Pkcs1KeyFormatter.formatRsaPublic(h),format:"der",type:"pkcs1"}),h.d?this.privateKey=v.createPrivateKey({key:P.Pkcs1KeyFormatter.formatRsaPrivate(h),format:"der",type:"pkcs1"}):this.privateKey=void 0;else{const m=P.Pkcs1KeyFormatter.formatRsaPublic(h);if(this.publicKey=(0,P.formatPem)(m,"RSA PUBLIC KEY"),h.d){const m=P.Pkcs1KeyFormatter.formatRsaPrivate(h);this.privateKey=(0,P.formatPem)(m,"RSA PRIVATE KEY")}}}async exportParameters(){var h,m;if(!this.publicKey)throw new Error("Public key not set.");let y;return y=M?(null!==(h=this.privateKey)&&void 0!==h?h:this.publicKey).export({format:"der",type:"pkcs1"}):(0,P.parsePem)(null!==(m=this.privateKey)&&void 0!==m?m:this.publicKey),this.privateKey?P.Pkcs1KeyFormatter.parseRsaPrivate(y):P.Pkcs1KeyFormatter.parseRsaPublic(y)}dispose(){this.publicKey=void 0,this.privateKey=void 0}}NodeRsaKeyPair.defaultKeySize=2048;class NodeRsa extends T.PublicKeyAlgorithm{constructor(h,m){super(h,NodeRsa.keyAlgorithmName,m)}createKeyPair(){return new NodeRsaKeyPair}async generateKeyPair(h){const m=new NodeRsaKeyPair;return await m.generate(h),m}createSigner(h){if(!(h instanceof NodeRsaKeyPair))throw new TypeError("RSA key pair object expected.");return new NodeRsaSignerVerifier(h,NodeRsa.convertHashAlgorithmName(this.hashAlgorithmName),A.NodeHmac.getHashDigestLength(this.hashAlgorithmName))}createVerifier(h){if(!(h instanceof NodeRsaKeyPair))throw new TypeError("RSA key pair object expected.");return new NodeRsaSignerVerifier(h,NodeRsa.convertHashAlgorithmName(this.hashAlgorithmName),A.NodeHmac.getHashDigestLength(this.hashAlgorithmName))}static convertHashAlgorithmName(h){return h.replace("SHA2-","SHA")}}m.NodeRsa=NodeRsa,NodeRsa.keyAlgorithmName="ssh-rsa",NodeRsa.rsaWithSha256="rsa-sha2-256",NodeRsa.rsaWithSha512="rsa-sha2-512",NodeRsa.KeyPair=NodeRsaKeyPair;class NodeRsaSignerVerifier{constructor(h,m,y){this.keyPair=h,this.hashAlgorithmName=m,this.digestLength=y}async sign(h){if(!this.keyPair.privateKey)throw new Error("Private key not set.");const m=v.createSign(this.hashAlgorithmName);return m.update(h),m.sign(this.keyPair.privateKey)}async verify(h,m){if(!this.keyPair.publicKey)throw new Error("Public key not set.");const y=v.createVerify(this.hashAlgorithmName);return y.update(h),y.verify(this.keyPair.publicKey,m)}dispose(){}}},function(h,m,y){var v=y(43)._,C=(y(11),y(127)),T=y(43),w=y(99),A=y(1065);m.BigInteger=C,h.exports.Key=function(){function RSAKey(){this.n=null,this.e=0,this.d=null,this.p=null,this.q=null,this.dmp1=null,this.dmq1=null,this.coeff=null}return RSAKey.prototype.setOptions=function(h){var m=w[h.signingScheme],y=w[h.encryptionScheme];m===y?this.signingScheme=this.encryptionScheme=y.makeScheme(this,h):(this.encryptionScheme=y.makeScheme(this,h),this.signingScheme=m.makeScheme(this,h)),this.encryptEngine=A.getEngine(this,h)},RSAKey.prototype.generate=function(h,m){var y=h>>1;this.e=parseInt(m,16);for(var v=new C(m,16);;){for(;this.p=new C(h-y,1),0!==this.p.subtract(C.ONE).gcd(v).compareTo(C.ONE)||!this.p.isProbablePrime(10););for(;this.q=new C(y,1),0!==this.q.subtract(C.ONE).gcd(v).compareTo(C.ONE)||!this.q.isProbablePrime(10););if(this.p.compareTo(this.q)<=0){var T=this.p;this.p=this.q,this.q=T}var w=this.p.subtract(C.ONE),A=this.q.subtract(C.ONE),P=w.multiply(A);if(0===P.gcd(v).compareTo(C.ONE)){if(this.n=this.p.multiply(this.q),this.n.bitLength()<h)continue;this.d=v.modInverse(P),this.dmp1=this.d.mod(w),this.dmq1=this.d.mod(A),this.coeff=this.q.modInverse(this.p);break}}this.$$recalculateCache()},RSAKey.prototype.setPrivate=function(h,m,y,w,A,P,k,R){if(!(h&&m&&y&&h.length>0&&(v.isNumber(m)||m.length>0)&&y.length>0))throw Error("Invalid RSA private key");this.n=new C(h),this.e=v.isNumber(m)?m:T.get32IntFromBuffer(m,0),this.d=new C(y),w&&A&&P&&k&&R&&(this.p=new C(w),this.q=new C(A),this.dmp1=new C(P),this.dmq1=new C(k),this.coeff=new C(R)),this.$$recalculateCache()},RSAKey.prototype.setPublic=function(h,m){if(!(h&&m&&h.length>0&&(v.isNumber(m)||m.length>0)))throw Error("Invalid RSA public key");this.n=new C(h),this.e=v.isNumber(m)?m:T.get32IntFromBuffer(m,0),this.$$recalculateCache()},RSAKey.prototype.$doPrivate=function(h){if(this.p||this.q)return h.modPow(this.d,this.n);for(var m=h.mod(this.p).modPow(this.dmp1,this.p),y=h.mod(this.q).modPow(this.dmq1,this.q);m.compareTo(y)<0;)m=m.add(this.p);return m.subtract(y).multiply(this.coeff).mod(this.p).multiply(this.q).add(y)},RSAKey.prototype.$doPublic=function(h){return h.modPowInt(this.e,this.n)},RSAKey.prototype.encrypt=function(h,m){var y=[],v=[],C=h.length,T=Math.ceil(C/this.maxMessageLength)||1,w=Math.ceil(C/T||1);if(1==T)y.push(h);else for(var A=0;A<T;A++)y.push(h.slice(A*w,(A+1)*w));for(var P=0;P<y.length;P++)v.push(this.encryptEngine.encrypt(y[P],m));return Buffer.concat(v)},RSAKey.prototype.decrypt=function(h,m){if(h.length%this.encryptedDataLength>0)throw Error("Incorrect data or key");for(var y=[],v=0,C=0,T=h.length/this.encryptedDataLength,w=0;w<T;w++)C=(v=w*this.encryptedDataLength)+this.encryptedDataLength,y.push(this.encryptEngine.decrypt(h.slice(v,Math.min(C,h.length)),m));return Buffer.concat(y)},RSAKey.prototype.sign=function(h){return this.signingScheme.sign.apply(this.signingScheme,arguments)},RSAKey.prototype.verify=function(h,m,y){return this.signingScheme.verify.apply(this.signingScheme,arguments)},RSAKey.prototype.isPrivate=function(){return!!(this.n&&this.e&&this.d)},RSAKey.prototype.isPublic=function(h){return this.n&&this.e&&!(h&&this.d)||!1},Object.defineProperty(RSAKey.prototype,"keySize",{get:function(){return this.cache.keyBitLength}}),Object.defineProperty(RSAKey.prototype,"encryptedDataLength",{get:function(){return this.cache.keyByteLength}}),Object.defineProperty(RSAKey.prototype,"maxMessageLength",{get:function(){return this.encryptionScheme.maxMessageLength()}}),RSAKey.prototype.$$recalculateCache=function(){this.cache=this.cache||{},this.cache.keyBitLength=this.n.bitLength(),this.cache.keyByteLength=this.cache.keyBitLength+6>>3},RSAKey}()},function(h,m,y){var v=y(127),C=y(11),T=y(68),w={md2:Buffer.from("3020300c06082a864886f70d020205000410","hex"),md5:Buffer.from("3020300c06082a864886f70d020505000410","hex"),sha1:Buffer.from("3021300906052b0e03021a05000414","hex"),sha224:Buffer.from("302d300d06096086480165030402040500041c","hex"),sha256:Buffer.from("3031300d060960864801650304020105000420","hex"),sha384:Buffer.from("3041300d060960864801650304020205000430","hex"),sha512:Buffer.from("3051300d060960864801650304020305000440","hex"),ripemd160:Buffer.from("3021300906052b2403020105000414","hex"),rmd160:Buffer.from("3021300906052b2403020105000414","hex")},A={ripemd160:"rmd160"};h.exports={isEncryption:!0,isSignature:!0},h.exports.makeScheme=function(h,m){function Scheme(h,m){this.key=h,this.options=m}return Scheme.prototype.maxMessageLength=function(){return this.options.encryptionSchemeOptions&&this.options.encryptionSchemeOptions.padding==T.RSA_NO_PADDING?this.key.encryptedDataLength:this.key.encryptedDataLength-11},Scheme.prototype.encPad=function(h,m){var y;if(m=m||{},h.length>this.key.maxMessageLength)throw new Error("Message too long for RSA (n="+this.key.encryptedDataLength+", l="+h.length+")");if(this.options.encryptionSchemeOptions&&this.options.encryptionSchemeOptions.padding==T.RSA_NO_PADDING)return(y=Buffer.alloc(this.key.maxMessageLength-h.length)).fill(0),Buffer.concat([y,h]);if(1===m.type)return(y=Buffer.alloc(this.key.encryptedDataLength-h.length-1)).fill(255,0,y.length-1),y[0]=1,y[y.length-1]=0,Buffer.concat([y,h]);(y=Buffer.alloc(this.key.encryptedDataLength-h.length))[0]=0,y[1]=2;for(var v=C.randomBytes(y.length-3),w=0;w<v.length;w++){for(var A=v[w];0===A;)A=C.randomBytes(1)[0];y[w+2]=A}return y[y.length-1]=0,Buffer.concat([y,h])},Scheme.prototype.encUnPad=function(h,m){m=m||{};var y=0;if(this.options.encryptionSchemeOptions&&this.options.encryptionSchemeOptions.padding==T.RSA_NO_PADDING)return"function"==typeof h.lastIndexOf?h.slice(h.lastIndexOf("\0")+1,h.length):h.slice(String.prototype.lastIndexOf.call(h,"\0")+1,h.length);if(h.length<4)return null;if(1===m.type){if(0!==h[0]||1!==h[1])return null;for(y=3;0!==h[y];)if(255!=h[y]||++y>=h.length)return null}else{if(0!==h[0]||2!==h[1])return null;for(y=3;0!==h[y];)if(++y>=h.length)return null}return h.slice(y+1,h.length)},Scheme.prototype.sign=function(h){var m=this.options.signingSchemeOptions.hash||"sha256";if("browser"===this.options.environment){m=A[m]||m;var y=C.createHash(m);y.update(h);var T=this.pkcs1pad(y.digest(),m);return this.key.$doPrivate(new v(T)).toBuffer(this.key.encryptedDataLength)}var w=C.createSign("RSA-"+m.toUpperCase());return w.update(h),w.sign(this.options.rsaUtils.exportKey("private"))},Scheme.prototype.verify=function(h,m,y){if(this.options.encryptionSchemeOptions&&this.options.encryptionSchemeOptions.padding==T.RSA_NO_PADDING)return!1;var w=this.options.signingSchemeOptions.hash||"sha256";if("browser"===this.options.environment){w=A[w]||w,y&&(m=Buffer.from(m,y));var P=C.createHash(w);P.update(h);var k=this.pkcs1pad(P.digest(),w);return this.key.$doPublic(new v(m)).toBuffer().toString("hex")==k.toString("hex")}var R=C.createVerify("RSA-"+w.toUpperCase());return R.update(h),R.verify(this.options.rsaUtils.exportKey("public"),m,y)},Scheme.prototype.pkcs0pad=function(h){var m=Buffer.alloc(this.key.maxMessageLength-h.length);return m.fill(0),Buffer.concat([m,h])},Scheme.prototype.pkcs0unpad=function(h){return"function"==typeof h.lastIndexOf?h.slice(h.lastIndexOf("\0")+1,h.length):h.slice(String.prototype.lastIndexOf.call(h,"\0")+1,h.length)},Scheme.prototype.pkcs1pad=function(h,m){var y=w[m];if(!y)throw Error("Unsupported hash algorithm");var v=Buffer.concat([y,h]);if(v.length+10>this.key.encryptedDataLength)throw Error("Key is too short for signing algorithm ("+m+")");var C=Buffer.alloc(this.key.encryptedDataLength-v.length-1);return C.fill(255,0,C.length-1),C[0]=1,C[C.length-1]=0,Buffer.concat([C,v])},new Scheme(h,m)}},function(h,m,y){y(127);var v=y(11);h.exports={isEncryption:!0,isSignature:!1},h.exports.digestLength={md4:16,md5:16,ripemd160:20,rmd160:20,sha1:20,sha224:28,sha256:32,sha384:48,sha512:64};h.exports.eme_oaep_mgf1=function(m,y,C){C=C||"sha1";for(var T=h.exports.digestLength[C],w=Math.ceil(y/T),A=Buffer.alloc(T*w),P=Buffer.alloc(4),k=0;k<w;++k){var R=v.createHash(C);R.update(m),P.writeUInt32BE(k,0),R.update(P),R.digest().copy(A,k*T)}return A.slice(0,y)},h.exports.makeScheme=function(m,y){function Scheme(h,m){this.key=h,this.options=m}return Scheme.prototype.maxMessageLength=function(){return this.key.encryptedDataLength-2*h.exports.digestLength[this.options.encryptionSchemeOptions.hash||"sha1"]-2},Scheme.prototype.encPad=function(m){var y=this.options.encryptionSchemeOptions.hash||"sha1",C=this.options.encryptionSchemeOptions.mgf||h.exports.eme_oaep_mgf1,T=this.options.encryptionSchemeOptions.label||Buffer.alloc(0),w=this.key.encryptedDataLength,A=h.exports.digestLength[y];if(m.length>w-2*A-2)throw new Error("Message is too long to encode into an encoded message with a length of "+w+" bytes, increaseemLen to fix this error (minimum value for given parameters and options: "+(w-2*A-2)+")");var P=v.createHash(y);P.update(T),P=P.digest();var k=Buffer.alloc(w-m.length-2*A-1);k.fill(0),k[k.length-1]=1;for(var R=Buffer.concat([P,k,m]),M=v.randomBytes(A),N=C(M,R.length,y),D=0;D<R.length;D++)R[D]^=N[D];for(N=C(R,A,y),D=0;D<M.length;D++)M[D]^=N[D];var I=Buffer.alloc(1+M.length+R.length);return I[0]=0,M.copy(I,1),R.copy(I,1+M.length),I},Scheme.prototype.encUnPad=function(m){var y=this.options.encryptionSchemeOptions.hash||"sha1",C=this.options.encryptionSchemeOptions.mgf||h.exports.eme_oaep_mgf1,T=this.options.encryptionSchemeOptions.label||Buffer.alloc(0),w=h.exports.digestLength[y];if(m.length<2*w+2)throw new Error("Error decoding message, the supplied message is not long enough to be a valid OAEP encoded message");for(var A=m.slice(1,w+1),P=m.slice(1+w),k=C(P,w,y),R=0;R<A.length;R++)A[R]^=k[R];for(k=C(A,P.length,y),R=0;R<P.length;R++)P[R]^=k[R];var M=v.createHash(y);if(M.update(T),M=M.digest(),P.slice(0,w).toString("hex")!=M.toString("hex"))throw new Error("Error decoding message, the lHash calculated from the label provided and the lHash in the encrypted data do not match.");for(R=w;0===P[R++]&&R<P.length;);if(1!=P[R-1])throw new Error("Error decoding message, there is no padding message separator byte");return P.slice(R)},new Scheme(m,y)}},function(h,m,y){var v=y(127),C=y(11);h.exports={isEncryption:!1,isSignature:!0};h.exports.makeScheme=function(h,m){var T=y(99).pkcs1_oaep;function Scheme(h,m){this.key=h,this.options=m}return Scheme.prototype.sign=function(h){var m=C.createHash(this.options.signingSchemeOptions.hash||"sha1");m.update(h);var y=this.emsa_pss_encode(m.digest(),this.key.keySize-1);return this.key.$doPrivate(new v(y)).toBuffer(this.key.encryptedDataLength)},Scheme.prototype.verify=function(h,m,y){y&&(m=Buffer.from(m,y)),m=new v(m);var T=Math.ceil((this.key.keySize-1)/8),w=this.key.$doPublic(m).toBuffer(T),A=C.createHash(this.options.signingSchemeOptions.hash||"sha1");return A.update(h),this.emsa_pss_verify(A.digest(),w,this.key.keySize-1)},Scheme.prototype.emsa_pss_encode=function(h,m){var y=this.options.signingSchemeOptions.hash||"sha1",v=this.options.signingSchemeOptions.mgf||T.eme_oaep_mgf1,w=this.options.signingSchemeOptions.saltLength||20,A=T.digestLength[y],P=Math.ceil(m/8);if(P<A+w+2)throw new Error("Output length passed to emBits("+m+") is too small for the options specified("+y+", "+w+"). To fix this issue increase the value of emBits. (minimum size: "+(8*A+8*w+9)+")");var k=C.randomBytes(w),R=Buffer.alloc(8+A+w);R.fill(0,0,8),h.copy(R,8),k.copy(R,8+h.length);var M=C.createHash(y);M.update(R),M=M.digest();var N=Buffer.alloc(P-k.length-A-2);N.fill(0);var D=Buffer.alloc(N.length+1+k.length);N.copy(D),D[N.length]=1,k.copy(D,N.length+1);for(var I=v(M,D.length,y),x=Buffer.alloc(D.length),O=0;O<I.length;O++)x[O]=D[O]^I[O];var L=8*P-m,U=255^255>>8-L<<8-L;x[0]=x[0]&U;var B=Buffer.alloc(x.length+M.length+1);return x.copy(B,0),M.copy(B,x.length),B[B.length-1]=188,B},Scheme.prototype.emsa_pss_verify=function(h,m,y){var v=this.options.signingSchemeOptions.hash||"sha1",w=this.options.signingSchemeOptions.mgf||T.eme_oaep_mgf1,A=this.options.signingSchemeOptions.saltLength||20,P=T.digestLength[v],k=Math.ceil(y/8);if(k<P+A+2||188!=m[m.length-1])return!1;var R=Buffer.alloc(k-P-1);m.copy(R,0,0,k-P-1);for(var M=0,N=0,D=8*k-y;N<D;N++)M|=1<<7-N;if(0!=(R[0]&M))return!1;var I=m.slice(k-P-1,k-1),x=w(I,R.length,v);for(N=0;N<R.length;N++)R[N]^=x[N];for(M=255^255>>8-(D=8*k-y)<<8-D,R[0]=R[0]&M,N=0;0===R[N]&&N<R.length;N++);if(1!=R[N])return!1;var O=R.slice(R.length-A),L=Buffer.alloc(8+P+A);L.fill(0,0,8),h.copy(L,8),O.copy(L,8+h.length);var U=C.createHash(v);return U.update(L),U=U.digest(),I.toString("hex")===U.toString("hex")},new Scheme(h,m)}},function(h,m,y){var v=y(11);h.exports={getEngine:function(h,m){var C=y(439);return"node"===m.environment&&"function"==typeof v.publicEncrypt&&"function"==typeof v.privateDecrypt&&(C="function"==typeof v.privateEncrypt&&"function"==typeof v.publicDecrypt?y(1066):y(1067)),C(h,m)}}},function(h,m,y){var v=y(11),C=y(68),T=y(99);h.exports=function(h,m){var y=T.pkcs1.makeScheme(h,m);return{encrypt:function(h,T){var w;if(T)return w=C.RSA_PKCS1_PADDING,m.encryptionSchemeOptions&&m.encryptionSchemeOptions.padding&&(w=m.encryptionSchemeOptions.padding),v.privateEncrypt({key:m.rsaUtils.exportKey("private"),padding:w},h);w=C.RSA_PKCS1_OAEP_PADDING,"pkcs1"===m.encryptionScheme&&(w=C.RSA_PKCS1_PADDING),m.encryptionSchemeOptions&&m.encryptionSchemeOptions.padding&&(w=m.encryptionSchemeOptions.padding);var A=h;return w===C.RSA_NO_PADDING&&(A=y.pkcs0pad(h)),v.publicEncrypt({key:m.rsaUtils.exportKey("public"),padding:w},A)},decrypt:function(h,T){var w;if(T)return w=C.RSA_PKCS1_PADDING,m.encryptionSchemeOptions&&m.encryptionSchemeOptions.padding&&(w=m.encryptionSchemeOptions.padding),v.publicDecrypt({key:m.rsaUtils.exportKey("public"),padding:w},h);w=C.RSA_PKCS1_OAEP_PADDING,"pkcs1"===m.encryptionScheme&&(w=C.RSA_PKCS1_PADDING),m.encryptionSchemeOptions&&m.encryptionSchemeOptions.padding&&(w=m.encryptionSchemeOptions.padding);var A=v.privateDecrypt({key:m.rsaUtils.exportKey("private"),padding:w},h);return w===C.RSA_NO_PADDING?y.pkcs0unpad(A):A}}}},function(h,m,y){var v=y(11),C=y(68),T=y(99);h.exports=function(h,m){var w=y(439)(h,m),A=T.pkcs1.makeScheme(h,m);return{encrypt:function(h,y){if(y)return w.encrypt(h,y);var T=C.RSA_PKCS1_OAEP_PADDING;"pkcs1"===m.encryptionScheme&&(T=C.RSA_PKCS1_PADDING),m.encryptionSchemeOptions&&m.encryptionSchemeOptions.padding&&(T=m.encryptionSchemeOptions.padding);var P=h;return T===C.RSA_NO_PADDING&&(P=A.pkcs0pad(h)),v.publicEncrypt({key:m.rsaUtils.exportKey("public"),padding:T},P)},decrypt:function(h,y){if(y)return w.decrypt(h,y);var T=C.RSA_PKCS1_OAEP_PADDING;"pkcs1"===m.encryptionScheme&&(T=C.RSA_PKCS1_PADDING),m.encryptionSchemeOptions&&m.encryptionSchemeOptions.padding&&(T=m.encryptionSchemeOptions.padding);var P=v.privateDecrypt({key:m.rsaUtils.exportKey("private"),padding:T},h);return T===C.RSA_NO_PADDING?A.pkcs0unpad(P):P}}}},function(h,m,y){var v=y(253),C=y(254),T=y(1069),w=y(1070);for(var A in h.exports={Reader:T,Writer:w},C)C.hasOwnProperty(A)&&(h.exports[A]=C[A]);for(var P in v)v.hasOwnProperty(P)&&(h.exports[P]=v[P])},function(h,m,y){var v=y(28),C=y(440).Buffer,T=y(254),w=y(253).newInvalidAsn1Error;function Reader(h){if(!h||!C.isBuffer(h))throw new TypeError("data must be a node Buffer");this._buf=h,this._size=h.length,this._len=0,this._offset=0}Object.defineProperty(Reader.prototype,"length",{enumerable:!0,get:function(){return this._len}}),Object.defineProperty(Reader.prototype,"offset",{enumerable:!0,get:function(){return this._offset}}),Object.defineProperty(Reader.prototype,"remain",{get:function(){return this._size-this._offset}}),Object.defineProperty(Reader.prototype,"buffer",{get:function(){return this._buf.slice(this._offset)}}),Reader.prototype.readByte=function(h){if(this._size-this._offset<1)return null;var m=255&this._buf[this._offset];return h||(this._offset+=1),m},Reader.prototype.peek=function(){return this.readByte(!0)},Reader.prototype.readLength=function(h){if(void 0===h&&(h=this._offset),h>=this._size)return null;var m=255&this._buf[h++];if(null===m)return null;if(128==(128&m)){if(0===(m&=127))throw w("Indefinite length not supported");if(m>4)throw w("encoding too long");if(this._size-h<m)return null;this._len=0;for(var y=0;y<m;y++)this._len=(this._len<<8)+(255&this._buf[h++])}else this._len=m;return h},Reader.prototype.readSequence=function(h){var m=this.peek();if(null===m)return null;if(void 0!==h&&h!==m)throw w("Expected 0x"+h.toString(16)+": got 0x"+m.toString(16));var y=this.readLength(this._offset+1);return null===y?null:(this._offset=y,m)},Reader.prototype.readInt=function(){return this._readTag(T.Integer)},Reader.prototype.readBoolean=function(){return 0!==this._readTag(T.Boolean)},Reader.prototype.readEnumeration=function(){return this._readTag(T.Enumeration)},Reader.prototype.readString=function(h,m){h||(h=T.OctetString);var y=this.peek();if(null===y)return null;if(y!==h)throw w("Expected 0x"+h.toString(16)+": got 0x"+y.toString(16));var v=this.readLength(this._offset+1);if(null===v)return null;if(this.length>this._size-v)return null;if(this._offset=v,0===this.length)return m?C.alloc(0):"";var A=this._buf.slice(this._offset,this._offset+this.length);return this._offset+=this.length,m?A:A.toString("utf8")},Reader.prototype.readOID=function(h){h||(h=T.OID);var m=this.readString(h,!0);if(null===m)return null;for(var y=[],v=0,C=0;C<m.length;C++){var w=255&m[C];v<<=7,v+=127&w,0==(128&w)&&(y.push(v),v=0)}return v=y.shift(),y.unshift(v%40),y.unshift(v/40>>0),y.join(".")},Reader.prototype._readTag=function(h){v.ok(void 0!==h);var m=this.peek();if(null===m)return null;if(m!==h)throw w("Expected 0x"+h.toString(16)+": got 0x"+m.toString(16));var y=this.readLength(this._offset+1);if(null===y)return null;if(this.length>4)throw w("Integer too long: "+this.length);if(this.length>this._size-y)return null;this._offset=y;for(var C=this._buf[this._offset],T=0,A=0;A<this.length;A++)T<<=8,T|=255&this._buf[this._offset++];return 128==(128&C)&&4!==A&&(T-=1<<8*A),T>>0},h.exports=Reader},function(h,m,y){var v=y(28),C=y(440).Buffer,T=y(254),w=y(253).newInvalidAsn1Error,A={size:1024,growthFactor:8};function Writer(h){h=function merge(h,m){return v.ok(h),v.equal(typeof h,"object"),v.ok(m),v.equal(typeof m,"object"),Object.getOwnPropertyNames(h).forEach((function(y){if(!m[y]){var v=Object.getOwnPropertyDescriptor(h,y);Object.defineProperty(m,y,v)}})),m}(A,h||{}),this._buf=C.alloc(h.size||1024),this._size=this._buf.length,this._offset=0,this._options=h,this._seq=[]}Object.defineProperty(Writer.prototype,"buffer",{get:function(){if(this._seq.length)throw w(this._seq.length+" unended sequence(s)");return this._buf.slice(0,this._offset)}}),Writer.prototype.writeByte=function(h){if("number"!=typeof h)throw new TypeError("argument must be a Number");this._ensure(1),this._buf[this._offset++]=h},Writer.prototype.writeInt=function(h,m){if("number"!=typeof h)throw new TypeError("argument must be a Number");"number"!=typeof m&&(m=T.Integer);for(var y=4;(0==(4286578688&h)||-8388608==(4286578688&h))&&y>1;)y--,h<<=8;if(y>4)throw w("BER ints cannot be > 0xffffffff");for(this._ensure(2+y),this._buf[this._offset++]=m,this._buf[this._offset++]=y;y-- >0;)this._buf[this._offset++]=(4278190080&h)>>>24,h<<=8},Writer.prototype.writeNull=function(){this.writeByte(T.Null),this.writeByte(0)},Writer.prototype.writeEnumeration=function(h,m){if("number"!=typeof h)throw new TypeError("argument must be a Number");return"number"!=typeof m&&(m=T.Enumeration),this.writeInt(h,m)},Writer.prototype.writeBoolean=function(h,m){if("boolean"!=typeof h)throw new TypeError("argument must be a Boolean");"number"!=typeof m&&(m=T.Boolean),this._ensure(3),this._buf[this._offset++]=m,this._buf[this._offset++]=1,this._buf[this._offset++]=h?255:0},Writer.prototype.writeString=function(h,m){if("string"!=typeof h)throw new TypeError("argument must be a string (was: "+typeof h+")");"number"!=typeof m&&(m=T.OctetString);var y=C.byteLength(h);this.writeByte(m),this.writeLength(y),y&&(this._ensure(y),this._buf.write(h,this._offset),this._offset+=y)},Writer.prototype.writeBuffer=function(h,m){if("number"!=typeof m)throw new TypeError("tag must be a number");if(!C.isBuffer(h))throw new TypeError("argument must be a buffer");this.writeByte(m),this.writeLength(h.length),this._ensure(h.length),h.copy(this._buf,this._offset,0,h.length),this._offset+=h.length},Writer.prototype.writeStringArray=function(h){if(!h instanceof Array)throw new TypeError("argument must be an Array[String]");var m=this;h.forEach((function(h){m.writeString(h)}))},Writer.prototype.writeOID=function(h,m){if("string"!=typeof h)throw new TypeError("argument must be a string");if("number"!=typeof m&&(m=T.OID),!/^([0-9]+\.){3,}[0-9]+$/.test(h))throw new Error("argument is not a valid OID string");var y=h.split("."),v=[];v.push(40*parseInt(y[0],10)+parseInt(y[1],10)),y.slice(2).forEach((function(h){!function encodeOctet(h,m){m<128?h.push(m):m<16384?(h.push(m>>>7|128),h.push(127&m)):m<2097152?(h.push(m>>>14|128),h.push(255&(m>>>7|128)),h.push(127&m)):m<268435456?(h.push(m>>>21|128),h.push(255&(m>>>14|128)),h.push(255&(m>>>7|128)),h.push(127&m)):(h.push(255&(m>>>28|128)),h.push(255&(m>>>21|128)),h.push(255&(m>>>14|128)),h.push(255&(m>>>7|128)),h.push(127&m))}(v,parseInt(h,10))}));var C=this;this._ensure(2+v.length),this.writeByte(m),this.writeLength(v.length),v.forEach((function(h){C.writeByte(h)}))},Writer.prototype.writeLength=function(h){if("number"!=typeof h)throw new TypeError("argument must be a Number");if(this._ensure(4),h<=127)this._buf[this._offset++]=h;else if(h<=255)this._buf[this._offset++]=129,this._buf[this._offset++]=h;else if(h<=65535)this._buf[this._offset++]=130,this._buf[this._offset++]=h>>8,this._buf[this._offset++]=h;else{if(!(h<=16777215))throw w("Length too long (> 4 bytes)");this._buf[this._offset++]=131,this._buf[this._offset++]=h>>16,this._buf[this._offset++]=h>>8,this._buf[this._offset++]=h}},Writer.prototype.startSequence=function(h){"number"!=typeof h&&(h=T.Sequence|T.Constructor),this.writeByte(h),this._seq.push(this._offset),this._ensure(3),this._offset+=3},Writer.prototype.endSequence=function(){var h=this._seq.pop(),m=h+3,y=this._offset-m;if(y<=127)this._shift(m,y,-2),this._buf[h]=y;else if(y<=255)this._shift(m,y,-1),this._buf[h]=129,this._buf[h+1]=y;else if(y<=65535)this._buf[h]=130,this._buf[h+1]=y>>8,this._buf[h+2]=y;else{if(!(y<=16777215))throw w("Sequence too long");this._shift(m,y,1),this._buf[h]=131,this._buf[h+1]=y>>16,this._buf[h+2]=y>>8,this._buf[h+3]=y}},Writer.prototype._shift=function(h,m,y){v.ok(void 0!==h),v.ok(void 0!==m),v.ok(y),this._buf.copy(this._buf,h+y,h,h+m),this._offset+=y},Writer.prototype._ensure=function(h){if(v.ok(h),this._size-this._offset<h){var m=this._size*this._options.growthFactor;m-this._offset<h&&(m+=h);var y=C.alloc(m);this._buf.copy(y,0,0,this._offset),this._buf=y,this._size=m}},h.exports=Writer},function(h,m,y){y(43)._;function formatParse(h){h=h.split("-");for(var m="private",y={type:"default"},v=1;v<h.length;v++)if(h[v])switch(h[v]){case"public":case"private":m=h[v];break;case"pem":case"der":y.type=h[v]}return{scheme:h[0],keyType:m,keyOpt:y}}h.exports={pkcs1:y(1072),pkcs8:y(1073),components:y(1074),isPrivateExport:function(m){return h.exports[m]&&"function"==typeof h.exports[m].privateExport},isPrivateImport:function(m){return h.exports[m]&&"function"==typeof h.exports[m].privateImport},isPublicExport:function(m){return h.exports[m]&&"function"==typeof h.exports[m].publicExport},isPublicImport:function(m){return h.exports[m]&&"function"==typeof h.exports[m].publicImport},detectAndImport:function(m,y,v){if(void 0===v){for(var C in h.exports)if("function"==typeof h.exports[C].autoImport&&h.exports[C].autoImport(m,y))return!0}else if(v){var T=formatParse(v);if(!h.exports[T.scheme])throw Error("Unsupported key format");"private"===T.keyType?h.exports[T.scheme].privateImport(m,y,T.keyOpt):h.exports[T.scheme].publicImport(m,y,T.keyOpt)}return!1},detectAndExport:function(m,y){if(y){var v=formatParse(y);if(h.exports[v.scheme]){if("private"===v.keyType){if(!m.isPrivate())throw Error("This is not private key");return h.exports[v.scheme].privateExport(m,v.keyOpt)}if(!m.isPublic())throw Error("This is not public key");return h.exports[v.scheme].publicExport(m,v.keyOpt)}throw Error("Unsupported key format")}}}},function(h,m,y){var v=y(252).Ber,C=y(43)._,T=y(43);h.exports={privateExport:function(h,m){m=m||{};var y=h.n.toBuffer(),C=h.d.toBuffer(),w=h.p.toBuffer(),A=h.q.toBuffer(),P=h.dmp1.toBuffer(),k=h.dmq1.toBuffer(),R=h.coeff.toBuffer(),M=y.length+C.length+w.length+A.length+P.length+k.length+R.length+512,N=new v.Writer({size:M});return N.startSequence(),N.writeInt(0),N.writeBuffer(y,2),N.writeInt(h.e),N.writeBuffer(C,2),N.writeBuffer(w,2),N.writeBuffer(A,2),N.writeBuffer(P,2),N.writeBuffer(k,2),N.writeBuffer(R,2),N.endSequence(),"der"===m.type?N.buffer:"-----BEGIN RSA PRIVATE KEY-----\n"+T.linebrk(N.buffer.toString("base64"),64)+"\n-----END RSA PRIVATE KEY-----"},privateImport:function(h,m,y){var w;if("der"!==(y=y||{}).type){if(Buffer.isBuffer(m)&&(m=m.toString("utf8")),!C.isString(m))throw Error("Unsupported key format");var A=T.trimSurroundingText(m,"-----BEGIN RSA PRIVATE KEY-----","-----END RSA PRIVATE KEY-----").replace(/\s+|\n\r|\n|\r$/gm,"");w=Buffer.from(A,"base64")}else{if(!Buffer.isBuffer(m))throw Error("Unsupported key format");w=m}var P=new v.Reader(w);P.readSequence(),P.readString(2,!0),h.setPrivate(P.readString(2,!0),P.readString(2,!0),P.readString(2,!0),P.readString(2,!0),P.readString(2,!0),P.readString(2,!0),P.readString(2,!0),P.readString(2,!0))},publicExport:function(h,m){m=m||{};var y=h.n.toBuffer(),C=y.length+512,w=new v.Writer({size:C});return w.startSequence(),w.writeBuffer(y,2),w.writeInt(h.e),w.endSequence(),"der"===m.type?w.buffer:"-----BEGIN RSA PUBLIC KEY-----\n"+T.linebrk(w.buffer.toString("base64"),64)+"\n-----END RSA PUBLIC KEY-----"},publicImport:function(h,m,y){var w;if("der"!==(y=y||{}).type){if(Buffer.isBuffer(m)&&(m=m.toString("utf8")),C.isString(m)){var A=T.trimSurroundingText(m,"-----BEGIN RSA PUBLIC KEY-----","-----END RSA PUBLIC KEY-----").replace(/\s+|\n\r|\n|\r$/gm,"");w=Buffer.from(A,"base64")}}else{if(!Buffer.isBuffer(m))throw Error("Unsupported key format");w=m}var P=new v.Reader(w);P.readSequence(),h.setPublic(P.readString(2,!0),P.readString(2,!0))},autoImport:function(m,y){return/^[\S\s]*-----BEGIN RSA PRIVATE KEY-----\s*(?=(([A-Za-z0-9+/=]+\s*)+))\1-----END RSA PRIVATE KEY-----[\S\s]*$/g.test(y)?(h.exports.privateImport(m,y),!0):!!/^[\S\s]*-----BEGIN RSA PUBLIC KEY-----\s*(?=(([A-Za-z0-9+/=]+\s*)+))\1-----END RSA PUBLIC KEY-----[\S\s]*$/g.test(y)&&(h.exports.publicImport(m,y),!0)}}},function(h,m,y){var v=y(252).Ber,C=y(43)._,T=y(43);h.exports={privateExport:function(h,m){m=m||{};var y=h.n.toBuffer(),C=h.d.toBuffer(),w=h.p.toBuffer(),A=h.q.toBuffer(),P=h.dmp1.toBuffer(),k=h.dmq1.toBuffer(),R=h.coeff.toBuffer(),M=y.length+C.length+w.length+A.length+P.length+k.length+R.length+512,N=new v.Writer({size:M});N.startSequence(),N.writeInt(0),N.writeBuffer(y,2),N.writeInt(h.e),N.writeBuffer(C,2),N.writeBuffer(w,2),N.writeBuffer(A,2),N.writeBuffer(P,2),N.writeBuffer(k,2),N.writeBuffer(R,2),N.endSequence();var D=new v.Writer({size:M});return D.startSequence(),D.writeInt(0),D.startSequence(),D.writeOID("1.2.840.113549.1.1.1"),D.writeNull(),D.endSequence(),D.writeBuffer(N.buffer,4),D.endSequence(),"der"===m.type?D.buffer:"-----BEGIN PRIVATE KEY-----\n"+T.linebrk(D.buffer.toString("base64"),64)+"\n-----END PRIVATE KEY-----"},privateImport:function(h,m,y){var w;if("der"!==(y=y||{}).type){if(Buffer.isBuffer(m)&&(m=m.toString("utf8")),!C.isString(m))throw Error("Unsupported key format");var A=T.trimSurroundingText(m,"-----BEGIN PRIVATE KEY-----","-----END PRIVATE KEY-----").replace("-----END PRIVATE KEY-----","").replace(/\s+|\n\r|\n|\r$/gm,"");w=Buffer.from(A,"base64")}else{if(!Buffer.isBuffer(m))throw Error("Unsupported key format");w=m}var P=new v.Reader(w);if(P.readSequence(),P.readInt(0),"1.2.840.113549.1.1.1"!==new v.Reader(P.readString(48,!0)).readOID(6,!0))throw Error("Invalid Public key format");var k=new v.Reader(P.readString(4,!0));k.readSequence(),k.readString(2,!0),h.setPrivate(k.readString(2,!0),k.readString(2,!0),k.readString(2,!0),k.readString(2,!0),k.readString(2,!0),k.readString(2,!0),k.readString(2,!0),k.readString(2,!0))},publicExport:function(h,m){m=m||{};var y=h.n.toBuffer(),C=y.length+512,w=new v.Writer({size:C});w.writeByte(0),w.startSequence(),w.writeBuffer(y,2),w.writeInt(h.e),w.endSequence();var A=new v.Writer({size:C});return A.startSequence(),A.startSequence(),A.writeOID("1.2.840.113549.1.1.1"),A.writeNull(),A.endSequence(),A.writeBuffer(w.buffer,3),A.endSequence(),"der"===m.type?A.buffer:"-----BEGIN PUBLIC KEY-----\n"+T.linebrk(A.buffer.toString("base64"),64)+"\n-----END PUBLIC KEY-----"},publicImport:function(h,m,y){var w;if("der"!==(y=y||{}).type){if(Buffer.isBuffer(m)&&(m=m.toString("utf8")),C.isString(m)){var A=T.trimSurroundingText(m,"-----BEGIN PUBLIC KEY-----","-----END PUBLIC KEY-----").replace(/\s+|\n\r|\n|\r$/gm,"");w=Buffer.from(A,"base64")}}else{if(!Buffer.isBuffer(m))throw Error("Unsupported key format");w=m}var P=new v.Reader(w);if(P.readSequence(),"1.2.840.113549.1.1.1"!==new v.Reader(P.readString(48,!0)).readOID(6,!0))throw Error("Invalid Public key format");var k=new v.Reader(P.readString(3,!0));k.readByte(),k.readSequence(),h.setPublic(k.readString(2,!0),k.readString(2,!0))},autoImport:function(m,y){return/^[\S\s]*-----BEGIN PRIVATE KEY-----\s*(?=(([A-Za-z0-9+/=]+\s*)+))\1-----END PRIVATE KEY-----[\S\s]*$/g.test(y)?(h.exports.privateImport(m,y),!0):!!/^[\S\s]*-----BEGIN PUBLIC KEY-----\s*(?=(([A-Za-z0-9+/=]+\s*)+))\1-----END PUBLIC KEY-----[\S\s]*$/g.test(y)&&(h.exports.publicImport(m,y),!0)}}},function(h,m,y){y(43)._,y(43);h.exports={privateExport:function(h,m){return{n:h.n.toBuffer(),e:h.e,d:h.d.toBuffer(),p:h.p.toBuffer(),q:h.q.toBuffer(),dmp1:h.dmp1.toBuffer(),dmq1:h.dmq1.toBuffer(),coeff:h.coeff.toBuffer()}},privateImport:function(h,m,y){if(!(m.n&&m.e&&m.d&&m.p&&m.q&&m.dmp1&&m.dmq1&&m.coeff))throw Error("Invalid key data");h.setPrivate(m.n,m.e,m.d,m.p,m.q,m.dmp1,m.dmq1,m.coeff)},publicExport:function(h,m){return{n:h.n.toBuffer(),e:h.e}},publicImport:function(h,m,y){if(!m.n||!m.e)throw Error("Invalid key data");h.setPublic(m.n,m.e)},autoImport:function(m,y){return!(!y.n||!y.e)&&(y.d&&y.p&&y.q&&y.dmp1&&y.dmq1&&y.coeff?(h.exports.privateImport(m,y),!0):(h.exports.publicImport(m,y),!0))}}},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0}),m.NodeECDsa=void 0;const v=y(11),C=y(9),T=y(126),w=y(175),A=y(54),P=y(251),k=y(38),R=y(437),M=process.versions.node.split(".").map(h=>parseInt(h,10)),N=M[0]>10||10===M[0]&&M[1]>=12,D=M[0]>11||11===M[0]&&M[1]>=6;class NodeECDsaKeyPair{constructor(h){this.comment=null,h&&(this.algorithmName=h)}get hasPublicKey(){return!!this.publicKey}get hasPrivateKey(){return!!this.privateKey}get keyAlgorithmName(){return this.algorithmName}get algorithmName(){return this.algorithm}set algorithmName(h){const m=h.split("-")[2];if(this.curve=w.curves.find(h=>h.name===m),!this.curve)throw new Error("Invalid or unsupported ECDSA algorithm: "+h);this.algorithm=h}generate(){return N&&D?this.generateNodeKeyPairObjects():N?this.generateNodeKeyPairBuffers():this.generateExternalKeyPair()}async generateNodeKeyPairObjects(){[this.publicKey,this.privateKey]=await new Promise((h,m)=>{const y={namedCurve:this.curve.shortName};try{v.generateKeyPair("ec",y,(y,v,C)=>{y?m(y):h([v,C])})}catch(h){m(h)}})}async generateNodeKeyPairBuffers(){[this.publicKey,this.privateKey]=await new Promise((h,m)=>{const y={namedCurve:this.curve.shortName,publicKeyEncoding:{type:"spki",format:"pem"},privateKeyEncoding:{type:"sec1",format:"pem",cipher:void 0,passphrase:void 0}};try{v.generateKeyPair("ec",y,(y,v,C)=>{y?m(y):h([v,C])})}catch(h){m(h)}})}async generateExternalKeyPair(){throw new Error("This version of node does not support generating key pairs. Use node >= 10.12.")}async setPublicKeyBytes(h,m){if(!h)throw new TypeError("Buffer is required.");const y=new k.SshDataReader(h),C=y.readString("ascii");this.algorithmName=m||C;const T=y.readString("ascii");this.algorithmName=`ecdsa-sha2-${T}`;const w=y.readBinary(),P=A.BigInt.fromBytes(w.slice(1,1+(w.length-1)/2),{unsigned:!0}),M=A.BigInt.fromBytes(w.slice(1+(w.length-1)/2),{unsigned:!0}),N=R.Sec1KeyFormatter.formatECPublic({curve:{name:this.curve.name,oid:this.curve.oid},x:P,y:M});this.publicKey=D?v.createPublicKey({key:N,type:"spki",format:"der"}):(0,R.formatPem)(N,"PUBLIC KEY")}async getPublicKeyBytes(h){if(!this.publicKey)return null;let m;m="string"==typeof this.publicKey?(0,R.parsePem)(this.publicKey):this.publicKey.export({type:"spki",format:"der"});const y=R.Sec1KeyFormatter.parseECPublic(m);h=h||this.algorithmName||this.keyAlgorithmName;const v=new k.SshDataWriter(C.Buffer.alloc(512));v.writeString(h,"ascii"),v.writeString(this.curve.name,"ascii");const T=Math.ceil(this.curve.keySize/8),w=y.x.toBytes({unsigned:!0,length:T}),A=y.y.toBytes({unsigned:!0,length:T});return v.writeUInt32(1+w.length+A.length),v.writeByte(4),v.write(w),v.write(A),v.toBuffer()}async importParameters(h){if(!h.curve)throw new TypeError("A curve is required.");let m;if(h.curve.oid){if(m=w.curves.find(m=>m.oid===h.curve.oid),!m)throw new Error(`Unsupported curve OID: ${h.curve.oid}`)}else{if(!h.curve.name)throw new TypeError("A curve OID or name is required.");if(m=w.curves.find(m=>m.name===h.curve.name),!m)throw new Error(`Unsupported curve: ${h.curve.name}`)}this.algorithmName="ecdsa-sha2-"+m.name;const y=R.Sec1KeyFormatter.formatECPublic(h);if(this.publicKey=D?v.createPublicKey({key:y,type:"spki",format:"der"}):(0,R.formatPem)(y,"EC PUBLIC KEY"),h.d){const m=R.Sec1KeyFormatter.formatECPrivate(h);this.privateKey=D?v.createPrivateKey({key:m,type:"sec1",format:"der"}):(0,R.formatPem)(m,"EC PRIVATE KEY")}else this.privateKey=void 0}async exportParameters(){var h,m;if(!this.publicKey)throw new Error("Key is not present.");let y;return y="string"==typeof this.publicKey?(0,R.parsePem)(null!==(h=this.privateKey)&&void 0!==h?h:this.publicKey):(null!==(m=this.privateKey)&&void 0!==m?m:this.publicKey).export({type:this.privateKey?"sec1":"spki",format:"der"}),this.privateKey?R.Sec1KeyFormatter.parseECPrivate(y):R.Sec1KeyFormatter.parseECPublic(y)}dispose(){}}class NodeECDsa extends T.PublicKeyAlgorithm{constructor(h,m){super(h,h,m)}createKeyPair(){return new NodeECDsaKeyPair(this.name)}async generateKeyPair(){const h=new NodeECDsaKeyPair(this.name);return await h.generate(),h}createSigner(h){if(!(h instanceof NodeECDsaKeyPair))throw new TypeError("ECDSA key pair object expected.");return new NodeECDsaSignerVerifier(h,NodeECDsa.convertHashAlgorithmName(this.hashAlgorithmName))}createVerifier(h){if(!(h instanceof NodeECDsaKeyPair))throw new TypeError("ECDSA key pair object expected.");return new NodeECDsaSignerVerifier(h,NodeECDsa.convertHashAlgorithmName(this.hashAlgorithmName))}static convertHashAlgorithmName(h){return h.replace("SHA2-","SHA")}static getSignatureLength(h){return 2*(5+Math.ceil(h/8))}}m.NodeECDsa=NodeECDsa,NodeECDsa.ecdsaSha2Nistp256="ecdsa-sha2-nistp256",NodeECDsa.ecdsaSha2Nistp384="ecdsa-sha2-nistp384",NodeECDsa.ecdsaSha2Nistp521="ecdsa-sha2-nistp521",NodeECDsa.curves=w.curves,NodeECDsa.KeyPair=NodeECDsaKeyPair;class NodeECDsaSignerVerifier{constructor(h,m){this.keyPair=h,this.hashAlgorithmName=m}get digestLength(){const h=this.keyPair.curve;return h?NodeECDsa.getSignatureLength(h.keySize):0}async sign(h){if(!this.keyPair.privateKey)throw new Error("Private key not set.");const m=v.createSign(this.hashAlgorithmName);m.update(h);let y=m.sign(this.keyPair.privateKey);const T=new P.DerReader(y),w=T.readInteger(),A=T.readInteger(),R=Math.ceil(this.keyPair.curve.keySize/8),M=new k.SshDataWriter(C.Buffer.alloc(this.digestLength));return M.writeBinary(w.toBytes({unsigned:!0,length:R+1})),M.writeBinary(A.toBytes({unsigned:!0,length:R+1})),y=M.toBuffer(),y}async verify(h,m){if(!this.keyPair.publicKey)throw new Error("Public key not set.");const y=new k.SshDataReader(m),T=y.readBigInt(),w=y.readBigInt(),A=new P.DerWriter(C.Buffer.alloc(m.length));A.writeInteger(T),A.writeInteger(w),m=A.toBuffer();const R=v.createVerify(this.hashAlgorithmName);return R.update(h),R.verify(this.keyPair.publicKey,m)}dispose(){}}},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0}),m.NodeEncryption=void 0;const v=y(11),C=y(9),T=y(246),w=y(48);class NodeEncryption extends T.EncryptionAlgorithm{constructor(h,m,y,v){if(super(h),this.algorithmName=m,this.cipherMode=y,this.keySizeInBits=v,"AES"!==m)throw new Error(`Unsupported encryption algorithm: ${m}`);this.blockSizeInBits=NodeEncryption.getBlockSize(m)}get keyLength(){return this.keySizeInBits/8}get blockLength(){return this.blockSizeInBits/8}async createCipher(h,m,y){let v;if("CTR"===this.cipherMode||"CBC"===this.cipherMode)v=new NodeAesCipher(h,this.keySizeInBits,this.blockSizeInBits,m,y,this.cipherMode);else{if("GCM"!==this.cipherMode)throw new Error(`Unsupported cipher mode: ${this.cipherMode}`);v=new NodeAesGcmCipher(h,this.keySizeInBits,this.blockSizeInBits,m,y)}return v}static getBlockSize(h){if("AES"===h)return 128;throw new Error(`Unsupported encryption algorithm: ${h}`)}}m.NodeEncryption=NodeEncryption;class NodeAesCipher{constructor(h,m,y,C,T,w){this.isEncryption=h,this.keySizeInBits=m,this.blockSizeInBits=y;const A=`AES-${this.keySizeInBits}-${w}`;this.cipher=this.isEncryption?v.createCipheriv(A,C,T):v.createDecipheriv(A,C,T),this.cipher.setAutoPadding(!1)}get blockLength(){return this.blockSizeInBits/8}transform(h){const m=this.cipher.update(h);if(m.length!==h.length){const y="Result from encrypt/decrypt has invalid length "+`${m.length}, expected ${h.length}.`;throw(0,w.trace)("Error: "+y),new Error(y)}return Promise.resolve(m)}dispose(){}}class NodeAesGcmCipher{constructor(h,m,y,v,T){this.isEncryption=h,this.keySizeInBits=m,this.blockSizeInBits=y,this.tag=null,this.algorithmName=`aes-${this.keySizeInBits}-gcm`,this.key=C.Buffer.alloc(v.length),v.copy(this.key),this.nonce=C.Buffer.alloc(12),T.copy(this.nonce,0,0,12),this.associatedData=C.Buffer.alloc(4)}get blockLength(){return this.blockSizeInBits/8}get digestLength(){return 16}get authenticatedEncryption(){return!0}transform(h){if(h.length%this.blockLength!=0){const m="Encrypt/decrypt input has invalid length "+`${h.length}, not a multiple of block size ${this.blockLength}.`;throw(0,w.trace)("Error: "+m),new Error(m)}const m=this.isEncryption?v.createCipheriv(this.algorithmName,this.key,this.nonce):v.createDecipheriv(this.algorithmName,this.key,this.nonce),y=h.length;if(this.associatedData[0]=y>>>24,this.associatedData[1]=y>>>16,this.associatedData[2]=y>>>8,this.associatedData[3]=y,m.setAAD(this.associatedData),!this.isEncryption){if(!this.tag)throw new Error("AES-GCM tag was not set before decrypting.");m.setAuthTag(this.tag)}const C=m.update(h);if(C.length!==h.length){const m="Result from encrypt/decrypt has invalid length "+`${C.length}, expected ${h.length}.`;throw(0,w.trace)("Error: "+m),new Error(m)}m.final(),this.isEncryption?this.tag=m.getAuthTag():this.tag=null;let T=12;for(;--T>=4&&(this.nonce[T]++,0===this.nonce[T]););return Promise.resolve(C)}async sign(h){if(!this.tag)throw new Error("AES-GCM tag was not obtained by encrypting.");return this.tag}async verify(h,m){if(m.length!==this.digestLength)throw new Error("Incorrect AES-GCM tag length.");return this.tag=m,!0}dispose(){}}},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0}),m.NodeRandom=void 0;const v=y(11);m.NodeRandom=class NodeRandom{getBytes(h){v.randomBytes(h.length).copy(h)}}},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0}),m.SshProtocol=void 0;const v=y(48),C=y(9),T=y(176),w=y(129),A=y(101),P=y(38),k=y(55),R=y(257),M=y(76),N=y(49);class SequencedMessage{constructor(h,m){this.sequence=h,this.message=m}}class SshProtocol{constructor(h,m,y){this.config=m,this.metrics=y,this.sessionSemaphore=new w.Semaphore(1),this.inboundPacketSequence=0,this.outboundPacketSequence=0,this.inboundFlow=0,this.outboundFlow=0,this.recentSentMessages=new T.Queue,this.sendWriter=new P.SshDataWriter(C.Buffer.alloc(1024)),this.receiveWriter=new P.SshDataWriter(C.Buffer.alloc(1024)),this.extensions=null,this.kexService=null,this.algorithms=null,this.outgoingMessagesHaveLatencyInfo=!1,this.incomingMessagesHaveLatencyInfo=!1,this.outgoingMessagesHaveReconnectInfo=!1,this.incomingMessagesHaveReconnectInfo=!1,this.stream=h}get lastIncomingSequence(){return this.inboundPacketSequence-1}getSentMessages(h){if(h===this.outboundPacketSequence+1)return[];if(this.recentSentMessages.size>0&&h<this.recentSentMessages.peek().sequence)return null;const m=new Array;for(let y of this.recentSentMessages)if(y.sequence>=h){const h=y.message;h instanceof R.KeyExchangeMessage||h instanceof k.DisconnectMessage||m.push(h)}return m}async writeProtocolVersion(h,m){const y=this.stream;if(!y)throw new Error("SSH session disconnected.");const v=C.Buffer.from(h+"\r\n");return await y.write(v,m),this.metrics.addMessageSent(v.length),Promise.resolve()}async readProtocolVersion(h){const m=this.stream;if(!m)throw new Error("SSH session disconnected.");const y=C.Buffer.alloc(255);let v=0;for(let C=0;C<y.length;C++){const T=await m.read(1,h);if(!T)break;y[C]=T[0];const w=13,A=10;if(C>0&&y[C-1]===w&&y[C]===A){const h=y.toString("utf8",0,C-1);if(h.startsWith("SSH-"))return this.metrics.addMessageReceived(C+1),h;if(v>20)break;v++,C=-1}}throw new N.SshConnectionError("Failed to read the protocol version",k.SshDisconnectReason.protocolError)}async handleNewKeys(h){try{await this.sessionSemaphore.wait(h),this.inboundFlow=0,this.outboundFlow=0,this.algorithms=this.kexService.finishKeyExchange()}finally{this.sessionSemaphore.release()}}async read(h,m){const y=this.stream;if(!y)return!1;let C=0;do{let T;try{T=await y.read(h.length-C,m)}catch(h){if(!(h instanceof Error))throw h;if(y.isDisposed)return!1;throw y.dispose(),this.stream=null,(0,v.trace)("Error reading from stream: "+h.message),new N.SshConnectionError("Error reading from stream: "+h.message,k.SshDisconnectReason.connectionLost)}if(!T)return!1;T.copy(h,C),C+=T.length}while(C<h.length);return!0}async write(h,m){const y=this.stream;if(!y)return!1;try{await y.write(h,m)}catch(h){if(!(h instanceof Error))throw h;if(y.isDisposed)return!1;throw y.dispose(),this.stream=null,(0,v.trace)("Error writing to stream: "+h.message),new N.SshConnectionError("Error writing to stream: "+h.message,k.SshDisconnectReason.connectionLost)}return!0}async considerReExchange(h,m){const y=this.kexService;if(!y)return;let v=null,C=null;!y.exchanging&&(h||this.inboundFlow+this.outboundFlow>this.config.keyRotationThreshold)&&([v,C]=await y.startKeyExchange(h)),v&&(await this.sendMessage(v,m),C&&await this.sendMessage(C,m))}async computeHmac(h,m,y){const v=new P.SshDataWriter(C.Buffer.alloc(4+m.length));return v.writeUInt32(y),v.write(m),await h.sign(v.toBuffer())}async verifyHmac(h,m,y,v){const T=new P.SshDataWriter(C.Buffer.alloc(4+m.length));return T.writeUInt32(y),T.write(m),await h.verify(T.toBuffer(),v)}async readAndVerifyHmac(h,m,y,v){if(!await this.read(y,v))return!1;if(!await this.verifyHmac(h,m,this.inboundPacketSequence,y))throw new N.SshConnectionError("Invalid MAC",k.SshDisconnectReason.macError);return!0}async sendMessage(h,m){var y;const T=this.algorithms,w=null==T?void 0:T.compressor,A=null==T?void 0:T.cipher,P=null==T?void 0:T.messageSigner;let k;await this.sessionSemaphore.wait(m);try{const T=A?Math.max(8,A.blockLength):8,R=SshProtocol.packetLengthSize+SshProtocol.paddingLengthSize;if(this.sendWriter.position=R,h.write(this.sendWriter),this.outgoingMessagesHaveReconnectInfo&&(this.sendWriter.writeUInt64(this.lastIncomingSequence),this.outgoingMessagesHaveLatencyInfo)){const h=Math.min(4294967295,Math.round(1e3*(this.metrics.time-this.lastIncomingTimestamp)));this.sendWriter.writeUInt32(h)}let N=this.sendWriter.toBuffer().slice(R);null!=w&&(N=w.compress(N));let D=T-((!((null==P?void 0:P.encryptThenMac)||(null==P?void 0:P.authenticatedEncryption))?SshProtocol.packetLengthSize:0)+SshProtocol.paddingLengthSize+N.length)%T;D<4&&(D+=T);const I=SshProtocol.paddingLengthSize+N.length+D;this.sendWriter.position=0,this.sendWriter.writeUInt32(I),this.sendWriter.writeByte(D),null!=w?this.sendWriter.write(N):this.sendWriter.position+=N.length,this.sendWriter.writeRandom(D),N=this.sendWriter.toBuffer();let x=null;if((null==P?void 0:P.encryptThenMac)&&A){const h=N.slice(SshProtocol.packetLengthSize,N.length);(await A.transform(h)).copy(h),x=await this.computeHmac(P,N,this.outboundPacketSequence)}else if(null==P?void 0:P.authenticatedEncryption){let h=N.slice(SshProtocol.packetLengthSize,N.length);(await A.transform(h)).copy(h),x=await P.sign(h)}else P&&(x=await this.computeHmac(P,N,this.outboundPacketSequence)),A&&(N=await A.transform(N));if(h instanceof M.ChannelDataMessage?v.traceData.enabled&&(0,v.traceData)(`Sending #${this.outboundPacketSequence} ${h}`):(0,v.trace)(`Sending #${this.outboundPacketSequence} ${h}`),this.incomingMessagesHaveReconnectInfo){const m=new SequencedMessage(this.outboundPacketSequence,h);m.sentTime=this.metrics.time,this.recentSentMessages.enqueue(m)}if(this.outboundPacketSequence++,this.outboundFlow+=I,x){const h=C.Buffer.concat([N,x],N.length+x.length);k=await this.write(h,m)}else k=await this.write(N,m);this.metrics.addMessageSent(SshProtocol.packetLengthSize+I+(null!==(y=null==P?void 0:P.digestLength)&&void 0!==y?y:0))}finally{this.sessionSemaphore.release()}return await this.considerReExchange(!1,m),k}async receiveMessage(h){var m;const y=this.algorithms,C=null==y?void 0:y.decipher,T=null==y?void 0:y.messageVerifier,w=null==y?void 0:y.decompressor,R=!((null==T?void 0:T.encryptThenMac)||(null==T?void 0:T.authenticatedEncryption)),D=R?C?Math.max(8,C.blockLength):8:SshProtocol.packetLengthSize;this.receiveWriter.position=D;let I=this.receiveWriter.toBuffer();if(!await this.read(I,h))return null;this.lastIncomingTimestamp=this.metrics.time,C&&R&&(I=await C.transform(I),this.receiveWriter.position=0,this.receiveWriter.write(I));const x=new P.SshDataReader(I).readUInt32();if(x>SshProtocol.maxPacketLength)throw(0,v.trace)("Invalid packet length."),new N.SshConnectionError("Invalid packet length.",k.SshDisconnectReason.protocolError);const O=SshProtocol.packetLengthSize+x;O>D&&this.receiveWriter.skip(O-D),T&&this.receiveWriter.skip(T.digestLength);const L=this.receiveWriter.toBuffer(),U=L.slice(0,O),B=L.slice(O);let W=U.slice(D,O);if(W.length>0){if(!await this.read(W,h))return null;if((null==T?void 0:T.encryptThenMac)&&!await this.readAndVerifyHmac(T,U,B,h))return null;if(C){if(null==T?void 0:T.authenticatedEncryption){if(!await this.read(B,h))return null;await T.verify(W,B)}try{W=await C.transform(W)}catch(h){throw(null==T?void 0:T.authenticatedEncryption)?new N.SshConnectionError("Invalid MAC",k.SshDisconnectReason.macError):h}this.receiveWriter.position=D,this.receiveWriter.write(W)}}if(T&&!T.encryptThenMac&&!T.authenticatedEncryption&&!await this.readAndVerifyHmac(T,U,B,h))return null;const q=U[SshProtocol.packetLengthSize];let Y=U.slice(SshProtocol.packetLengthSize+SshProtocol.paddingLengthSize,SshProtocol.packetLengthSize+(x-q));if(w&&(Y=w.decompress(Y)),this.incomingMessagesHaveReconnectInfo){let h,m;if(this.incomingMessagesHaveLatencyInfo){const y=new P.SshDataReader(Y.slice(Y.length-12,Y.length));h=y.readUInt64(),m=y.readUInt32()/1e3,Y=Y.slice(0,Y.length-12)}else{h=new P.SshDataReader(Y.slice(Y.length-8,Y.length)).readUInt64(),m=0,Y=Y.slice(0,Y.length-8)}for(;this.recentSentMessages.size>0;){const y=this.recentSentMessages.peek();if(y.sequence>h)break;if(this.stream&&this.incomingMessagesHaveLatencyInfo&&y.sequence===h){const h=this.lastIncomingTimestamp-y.sentTime-m;this.metrics.updateLatency(h)}this.recentSentMessages.dequeue()}}const V=Y[0];let $=A.SshMessage.create(V,Y);if(!$){const h=new k.UnimplementedMessage;h.sequenceNumber=this.inboundPacketSequence,h.unimplementedMessageType=V,$=h}return $ instanceof M.ChannelDataMessage?v.traceData.enabled&&(0,v.traceData)(`Receiving #${this.inboundPacketSequence} ${$}`):(0,v.trace)(`Receiving #${this.inboundPacketSequence} ${$}`),await this.sessionSemaphore.wait(h),this.inboundPacketSequence++,this.inboundFlow+=x,this.sessionSemaphore.release(),this.metrics.addMessageReceived(SshProtocol.packetLengthSize+x+(null!==(m=null==T?void 0:T.digestLength)&&void 0!==m?m:0)),await this.considerReExchange(!1,h),$}dispose(){try{this.stream&&this.stream.close().catch(h=>{(0,v.trace)("Error closing stream: "+h.message)})}catch(h){if(!(h instanceof Error))throw h;(0,v.trace)("Error closing stream: "+h.message)}this.stream=null,this.metrics.updateLatency(0),this.algorithms&&this.algorithms.dispose()}}m.SshProtocol=SshProtocol,SshProtocol.maxPacketLength=1048576,SshProtocol.packetLengthSize=4,SshProtocol.paddingLengthSize=1},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0}),m.SshSessionAlgorithms=void 0;m.SshSessionAlgorithms=class SshSessionAlgorithms{dispose(){this.cipher&&this.cipher.dispose(),this.decipher&&this.decipher.dispose(),this.signer&&this.signer.dispose(),this.verifier&&this.verifier.dispose()}}},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0}),m.SshClientSession=void 0;const v=y(48),C=y(128),T=y(55),w=y(259),A=y(77),P=y(78),k=y(125),R=y(258),M=y(130),N=y(49);class SshClientSession extends C.SshSession{constructor(h){super(h,!0),this.serviceRequests=new Map,this.clientAuthCompletion=null}async authenticate(h,m){return!!await this.authenticateServer(m)&&!!await this.authenticateClient(h,m)}async authenticateServer(h){if(!this.kexService||!this.kexService.hostKey)throw new Error("Encrypt the session before authenticating.");try{this.principal=await this.raiseAuthenticatingEvent(new w.SshAuthenticatingEventArgs(w.SshAuthenticationType.serverPublicKey,{publicKey:this.kexService.hostKey},h))}catch(h){if(!(h instanceof Error))throw h;throw(0,v.trace)("Error while authenticating server: "+h.message),h}return this.principal?((0,v.trace)(`${this} server authenticated.`),!0):(await this.close(T.SshDisconnectReason.hostKeyNotVerifiable,"Server authentication failed."),(0,v.trace)(`${this} server authentication failed.`),!1)}authenticateClient(h,m,y){if(!h)throw new TypeError("A credentials object is required.");return"function"==typeof m?this.authenticateClientWithCompletion(h,m,y):new Promise(async(y,v)=>{await this.authenticateClientWithCompletion(h,(h,m)=>{h?v(h):y(m)},m)})}async authenticateClientWithCompletion(h,m,y){if(this.clientAuthCompletion=new A.PromiseCompletionSource,this.clientAuthCompletion.promise.then(h=>m(void 0,h),h=>m(h)),y){if(y.isCancellationRequested)throw new P.CancellationError;y.onCancellationRequested(h=>{this.clientAuthCompletion&&this.clientAuthCompletion.reject(new P.CancellationError)})}let v=this.getService(R.AuthenticationService);if(!v){const h=new T.ServiceRequestMessage;h.serviceName=R.AuthenticationService.serviceName,await this.sendMessage(h,y),v=this.activateService(R.AuthenticationService)}await v.authenticateClient(h,y)}onAuthenticationComplete(h){h?(0,v.trace)(`${this} client authenticated.`):(0,v.trace)(`${this} client authentication failed.`),this.clientAuthCompletion&&(this.clientAuthCompletion.resolve(h),this.clientAuthCompletion=null)}async requestService(h,m){let y=!1,v=this.serviceRequests.get(h);if(v||(v=new A.PromiseCompletionSource,this.serviceRequests.set(h,v),y=!0),y){const y=new T.ServiceRequestMessage;y.serviceName=h,await this.sendMessage(y,m)}await v.promise}async handleServiceAcceptMessage(h,m){const y=this.serviceRequests.get(h.serviceName);null==y||y.resolve(!0)}async openChannel(h,m,y){if(!this.connectionService){const h=new T.ServiceRequestMessage;h.serviceName=M.ConnectionService.serviceName,await this.sendMessage(h,y)}return await super.openChannel(h,m,y)}handleDisconnected(){return this.reconnecting?(this.reconnecting=!1,!1):super.handleDisconnected()}async reconnect(h,m){if(this.isClosed)throw new N.ObjectDisposedError(this);if(this.isConnected)throw new Error("Already connected.");if(!this.protocol)throw new Error("The session was never previously connected.");if(this.reconnecting)throw new Error("Already reconnecting.");this.reconnecting=!0;try{await this.reconnectInternal(h,m)}finally{this.reconnecting=!1}}async reconnectInternal(h,m){var y,C,w,A,P,R;const M=this.sessionId,D=this.protocol,I=null===(y=this.kexService)||void 0===y?void 0:y.hostKey;if(!(M&&D&&this.kexService&&I&&(null===(C=D.extensions)||void 0===C?void 0:C.has(k.SshProtocolExtensionNames.sessionReconnect))))throw new Error("Reconnect was not enabled for this session.");let x;try{if(this.sessionId=null,await this.connect(h,m),!this.sessionId||!this.algorithms||!this.algorithms.signer)throw new Error("Session is not encrypted.");const y=this.kexService.hostKey,C=y?await y.getPublicKeyBytes():null,w=await I.getPublicKeyBytes();if(!C||!w||!C.equals(w)){const h="The server host key is different.";throw(0,v.trace)(`Reconnection failed: ${h}`),new N.SshReconnectError(h,T.SshReconnectFailureReason.differentServerHostKey)}x=this.sessionId}catch(h){throw this.protocol=D,super.handleDisconnected(),h}finally{this.sessionId=M,this.kexService.hostKey=I}const O=await this.createReconnectToken(M,x),L=new T.SessionReconnectRequestMessage;L.requestType="session-reconnect@microsoft.com",L.clientReconnectToken=O,L.lastReceivedSequenceNumber=D.lastIncomingSequence,L.wantReply=!0;const U=await this.requestResponse(L,T.SessionReconnectResponseMessage,T.SessionReconnectFailureMessage,m);if(U instanceof T.SessionReconnectFailureMessage){const h=null!==(w=U.reasonCode)&&void 0!==w?w:T.SshReconnectFailureReason.unknownServerFailure,m=null!==(A=U.description)&&void 0!==A?A:"The server rejected the reconnect request.";throw(0,v.trace)(`Reconnection failed: ${m}`),this.protocol=D,new N.SshReconnectError(m,h)}if(!this.verifyReconnectToken(M,x,null!==(P=U.serverReconnectToken)&&void 0!==P?P:Buffer.alloc(0))){const h="The reconnect token provided by the server was invalid.";throw(0,v.trace)(`Reconnection failed: ${h}`),new N.SshReconnectError(h,T.SshReconnectFailureReason.invalidServerReconnectToken)}(0,v.trace)("Reconnect request was accepted by the server.");const B=D.getSentMessages((null!==(R=U.lastReceivedSequenceNumber)&&void 0!==R?R:0)+1);if(!B){const h="Client is unable to re-send messages requested by the server.";throw(0,v.trace)(`Reconnection failed: ${h}`),new N.SshReconnectError(h,T.SshReconnectFailureReason.clientDroppedMessages)}let W=0;for(let h of B)await this.sendMessage(h,m),W++;D.dispose(),this.metrics.addReconnection(),(0,v.trace)(`Reconnected. Re-sent ${W} dropped messages.`)}dispose(){this.clientAuthCompletion&&this.clientAuthCompletion.reject(new N.ObjectDisposedError(this)),super.dispose()}}m.SshClientSession=SshClientSession},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0}),m.SshServerSession=void 0;const v=y(128),C=y(6),T=y(55),w=y(49),A=y(125),P=y(48);class SshServerSession extends v.SshSession{constructor(h,m){super(h,!1),this.reconnectedEmitter=new C.Emitter,this.onReconnected=this.reconnectedEmitter.event,this.credentials={publicKeys:[]};const y=h.protocolExtensions.includes(A.SshProtocolExtensionNames.sessionReconnect);if(y&&!m)throw new Error("When reconnect is enabled, server sessions require a reference to a shared collection to track reconnectable sessions.");if(!y&&m)throw new Error("When reconnect is not enabled, the reconnectable sessions collection is not applicable.");this.reconnectableSessions=m}async handleServiceRequestMessage(h,m){if(!this.activateService(h.serviceName))throw new w.SshConnectionError(`Service "${h.serviceName}" not available.`,T.SshDisconnectReason.serviceNotAvailable);{const y=new T.ServiceAcceptMessage;y.serviceName=h.serviceName,await this.sendMessage(y,m)}}async handleRequestMessage(h,m){var y;if("session-reconnect@microsoft.com"===h.requestType&&(null===(y=this.config.protocolExtensions)||void 0===y?void 0:y.includes(A.SshProtocolExtensionNames.sessionReconnect))){const y=h.convertTo(new T.SessionReconnectRequestMessage);await this.reconnect(y,m)}else await super.handleRequestMessage(h,m)}async enableReconnect(h){await super.enableReconnect(h),this.reconnectableSessions.includes(this)||this.reconnectableSessions.push(this)}handleDisconnected(){return!!this.reconnecting||super.handleDisconnected()}async reconnect(h,m){var y,v,C;if(!this.reconnectableSessions)throw new Error("Disconnected sessions collection should have been initialied when reconnect is enabled.");let w;for(let m of this.reconnectableSessions)if(m!==this&&await this.verifyReconnectToken(m.sessionId,this.sessionId,null!==(y=h.clientReconnectToken)&&void 0!==y?y:Buffer.alloc(0))){w=m,this.reconnectableSessions.splice(this.reconnectableSessions.indexOf(w),1);break}if(!w||w.isClosed){const h="Requested reconnect session was not found or the reconnect token provided by the client was invalid.";(0,P.trace)(`Reconnect failed: ${h}`);const y=new T.SessionReconnectFailureMessage;return y.reasonCode=T.SshReconnectFailureReason.sessionNotFound,y.description=h,void await this.sendMessage(y,m)}const A=w.protocol.getSentMessages((null!==(v=h.lastReceivedSequenceNumber)&&void 0!==v?v:0)+1);if(!A){this.reconnectableSessions.push(w);const h="Server is unable to re-send messages requested by the client.";(0,P.trace)(`Reconnect failed: ${h}`);const y=new T.SessionReconnectFailureMessage;return y.reasonCode=T.SshReconnectFailureReason.serverDroppedMessages,y.description=h,void await this.sendMessage(y,m)}const k=new T.SessionReconnectResponseMessage;k.serverReconnectToken=await this.createReconnectToken(w.sessionId,this.sessionId),k.lastReceivedSequenceNumber=w.protocol.lastIncomingSequence,await this.sendMessage(k,m);try{for(w.reconnecting=!0,null===(C=w.protocol)||void 0===C||C.dispose();w.isConnected;)await new Promise(h=>setTimeout(()=>h(),5));w.protocol=this.protocol,w.protocol.kexService=w.kexService,this.protocol=void 0;for(let h of A)await w.sendMessage(h,m);this.dispose()}finally{w.reconnecting=!1}this.reconnectableSessions.push(w),w.metrics.addReconnection(),w.processMessages().catch(h=>{(0,P.trace)(`Unhandled error processing messages: ${h.message||JSON.stringify(h)}`)}),(0,P.trace)(`Session reconnected. Re-sent ${A.length} dropped messages.`),w.reconnectedEmitter.fire()}dispose(){if(this.reconnectableSessions){const h=this.reconnectableSessions.indexOf(this);h>=0&&this.reconnectableSessions.splice(h,1)}super.dispose()}}m.SshServerSession=SshServerSession},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0}),m.WebSocketStream=m.NodeStream=m.BaseStream=void 0;const v=y(9),C=y(6),T=y(78),w=y(49);function handleCancellation(h,m){m&&(m.isCancellationRequested?h(new T.CancellationError):m.onCancellationRequested(()=>{h(new T.CancellationError)}))}class BaseStream{constructor(){this.incomingData=[],this.pendingReads=[],this.error=null,this.disposed=!1,this.closedEmitter=new C.Emitter,this.closed=this.closedEmitter.event}onData(h){for(;this.pendingReads.length>0;){const m=this.pendingReads.shift();if(m.count>=h.length)return void m.resolve(h);{const y=h.slice(0,m.count);h=h.slice(m.count),m.resolve(y)}}this.incomingData.push(h)}onEnd(){for(;this.pendingReads.length>0;){this.pendingReads.shift().resolve(null)}this.incomingData.push(v.Buffer.alloc(0))}onError(h){for(this.error||(this.error=h);this.pendingReads.length>0;){this.pendingReads.shift().reject(h)}}async read(h,m){if(this.disposed)throw new w.ObjectDisposedError(this);if(this.incomingData.length>0){let m=this.incomingData[0];return 0===m.length?null:(h>=m.length?this.incomingData.shift():(this.incomingData[0]=m.slice(h),m=m.slice(0,h)),m)}if(this.error)throw this.error;return await new Promise((y,v)=>{if(m){if(m.isCancellationRequested)return void v(new T.CancellationError);m.onCancellationRequested(()=>{for(let h=0;h<this.pendingReads.length;h++)if(Object.is(m,this.pendingReads[h].cancellation)){this.pendingReads.splice(h--,1)[0].reject(new T.CancellationError)}})}this.pendingReads.push({count:h,resolve:y,reject:v,cancellation:m})})}dispose(){if(!this.disposed){this.disposed=!0;const h=new w.ObjectDisposedError(this);this.onError(h),this.fireOnClose(h)}}fireOnClose(h){this.closedEmitter.fire({error:h})}get isDisposed(){return this.disposed}}m.BaseStream=BaseStream;m.NodeStream=class NodeStream extends BaseStream{constructor(h,m){if(super(),!h)throw new TypeError("Duplex or Readable/Writable stream are required.");this.readStream=h,this.writeStream=m||h,this.readStream.on("data",this.onData.bind(this)),this.readStream.on("end",this.onEnd.bind(this)),this.readStream.on("error",this.onError.bind(this)),this.readStream.on("close",()=>{this.onEnd(),this.fireOnClose()})}async write(h,m){if(!h)throw new TypeError("Data is required.");if(this.disposed)throw new w.ObjectDisposedError(this);return new Promise((y,v)=>{handleCancellation(v,m),this.writeStream.write(h,h=>{h?v(h):y()})})}async close(h,m){if(this.disposed)throw new w.ObjectDisposedError(this);await new Promise((h,y)=>{handleCancellation(y,m),this.writeStream.end(h)}),this.disposed=!0,this.onError(h||new w.ObjectDisposedError(this)),this.closedEmitter.fire({error:h})}dispose(){if(!this.disposed){const h=new w.ObjectDisposedError(this);this.readStream.destroy(h),this.writeStream.destroy(h)}super.dispose()}};m.WebSocketStream=class WebSocketStream extends BaseStream{constructor(h){if(super(),this.websocket=h,!h)throw new TypeError("WebSocket is required.");if("string"==typeof h.binaryType&&"arraybuffer"!==h.binaryType)throw new Error("WebSocket must use arraybuffer binary type.");h.onmessage=h=>{this.onData(v.Buffer.from(h.data))},h.onclose=h=>{if(h.wasClean)this.onEnd();else{const m=new Error(h.reason);m.code=h.code,this.onError(m)}}}async write(h,m){if(!h)throw new TypeError("Data is required.");if(this.disposed)throw new w.ObjectDisposedError(this);if("readyState"in this.websocket&&(2===this.websocket.readyState||3===this.websocket.readyState))throw new DOMException("WebSocket is already in CLOSING or CLOSED state.","InvalidStateError");this.websocket.send(h)}async close(h,m){if(this.disposed)throw new w.ObjectDisposedError(this);if(h){const m="number"==typeof h.code?h.code:void 0;this.websocket.close(m,h.message)}else this.websocket.close();this.disposed=!0,this.closedEmitter.fire({error:h}),this.onError(h||new Error("Stream closed."))}dispose(){this.disposed||this.websocket.close(),super.dispose()}}},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0}),m.SshRpcMessageStream=void 0;const v=y(6),C=y(9),T=y(38);class SshRpcMessageReader{constructor(h){this.channel=h,this.errorEmitter=new v.Emitter,this.closeEmitter=new v.Emitter,this.partialMessageEmitter=new v.Emitter,this.callback=null,this.messageBuffer=new T.SshDataWriter(C.Buffer.alloc(1024)),this.headersLength=null,this.messageLength=null,this.onError=this.errorEmitter.event,this.onClose=this.closeEmitter.event,this.onPartialMessage=this.partialMessageEmitter.event,this.eventRegistration=this.channel.onDataReceived(this.onDataReceived.bind(this)),this.channel.onClosed(h=>{h.error&&this.errorEmitter.fire(h.error),this.closeEmitter.fire()})}listen(h){this.callback=h}dispose(){this.eventRegistration&&this.eventRegistration.dispose()}onDataReceived(h){if(this.messageBuffer.write(h),this.channel.adjustWindow(h.length),h=this.messageBuffer.toBuffer(),null===this.messageLength){const m=h.indexOf("\r\n\r\n");if(m<0)return;const y=h.slice(0,m).toString();if(!y.startsWith("Content-Length: "))throw new Error(`Message does not start with JSON-RPC headers.\n${y}`);this.headersLength=m+"\r\n\r\n".length,this.messageLength=parseInt(y.substr("Content-Length: ".length,m-"Content-Length: ".length),10)}const m=this.messageBuffer.position,y=this.headersLength+this.messageLength;if(m>=y){if(this.callback){const m=h.slice(this.headersLength,y).toString();let v;try{v=JSON.parse(m)}catch(h){if(!(h instanceof Error))throw h;throw new Error(`Failed to parse JSON-RPC message: ${h.message}\n${m}`)}this.callback(v)}this.messageLength=null,this.messageBuffer.position=0,m>y&&this.onDataReceived(h.slice(y))}}}class SshRpcMessageWriter{constructor(h){this.channel=h,this.errorEmitter=new v.Emitter,this.closeEmitter=new v.Emitter,this.onError=this.errorEmitter.event,this.onClose=this.closeEmitter.event,this.channel.onClosed(h=>{h.error&&this.errorEmitter.fire([h.error,h.errorMessage&&{jsonrpc:h.errorMessage}||void 0,h.exitStatus]),this.closeEmitter.fire()})}write(h){const m=JSON.stringify(h),y=C.Buffer.from(m),v=C.Buffer.from("Content-Length: "+y.length+"\r\n\r\n"),T=C.Buffer.alloc(v.length+y.length);v.copy(T,0),y.copy(T,v.length),this.channel.send(T).catch(h=>{this.errorEmitter.fire([h,void 0,void 0])})}dispose(){}}m.SshRpcMessageStream=class SshRpcMessageStream{constructor(h){this.reader=new SshRpcMessageReader(h),this.writer=new SshRpcMessageWriter(h)}}},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0}),m.SessionContour=void 0;const v=y(49),C=y(176),T=y(129);class SessionContour{constructor(h=256){if(this.intervalMs=SessionContour.initialInterval,this.count=0,this.updateQueue=new C.Queue,this.updateSemaphore=new T.Semaphore(0),this.disposed=!1,h<2||0!=(h&h-1))throw new Error("Contour intervals must be a power of two.");this.maxIntervals=h,this.intervalBytesSent=new Array(h),this.intervalBytesReceived=new Array(h),this.intervalLatencyMin=new Array(h),this.intervalLatencyMax=new Array(h),this.intervalLatencySum=new Array(h),this.intervalLatencyCount=new Array(h),this.intervalLatencyAvg=new Array(h),this.intervalBytesSent.fill(0),this.intervalBytesReceived.fill(0),this.intervalLatencyMin.fill(0),this.intervalLatencyMax.fill(0),this.intervalLatencySum.fill(0),this.intervalLatencyCount.fill(0),this.intervalLatencyAvg.fill(0)}get intervalCount(){return this.count}get interval(){return this.intervalMs}get bytesSent(){return this.intervalBytesSent.slice(0,this.count)}get bytesReceived(){return this.intervalBytesReceived.slice(0,this.count)}get latencyMinMs(){return this.intervalLatencyMin.slice(0,this.count)}get latencyMaxMs(){return this.intervalLatencyMax.slice(0,this.count)}get latencyAverageMs(){return this.intervalLatencyAvg.slice(0,this.count)}onMessageSent(h){this.updateQueue.enqueue({time:h.time,bytesSent:h.size}),this.updateSemaphore.tryRelease()}onMessageReceived(h){this.updateQueue.enqueue({time:h.time,bytesReceived:h.size}),this.updateSemaphore.tryRelease()}onLatencyUpdated(h){this.updateQueue.enqueue(h),this.updateSemaphore.tryRelease()}onSessionClosed(){this.updateSemaphore.tryRelease()}async collectMetrics(h,m){if(!h)throw new TypeError("A session metrics object is required.");if(this.disposed)throw new v.ObjectDisposedError(this);const y=[];y.push(h.onMessageSent(this.onMessageSent.bind(this))),y.push(h.onMessageReceived(this.onMessageReceived.bind(this))),y.push(h.onLatencyUpdated(this.onLatencyUpdated.bind(this))),y.push(h.onSessionClosed(this.onSessionClosed.bind(this)));try{for(;!(null==m?void 0:m.isCancellationRequested);){try{await this.updateSemaphore.wait(m)}catch(h){break}const h=this.updateQueue.dequeue();if(!h)break;const y=this.updateInterval(h.time);h.bytesSent&&(this.intervalBytesSent[y]+=h.bytesSent),h.bytesReceived&&(this.intervalBytesReceived[y]+=h.bytesReceived);const v=h.latency;v&&((!this.intervalLatencyMin[y]||v<this.intervalLatencyMin[y])&&(this.intervalLatencyMin[y]=v),(!this.intervalLatencyMax[y]||v>this.intervalLatencyMax[y])&&(this.intervalLatencyMax[y]=v),this.intervalLatencySum[y]+=v,this.intervalLatencyCount[y]++,this.intervalLatencyAvg[y]=this.intervalLatencySum[y]/this.intervalLatencyCount[y])}this.disposed&&this.updateSemaphore.dispose()}finally{for(let h of y)h.dispose()}}updateInterval(h){let m=Math.floor(h/this.intervalMs);if(m>=this.intervalCount){for(;m>=this.maxIntervals;)this.expandIntervals(),m=Math.floor(h/this.intervalMs);this.count=m+1}return m}expandIntervals(){const combineLatency=(h,m,y)=>0===h?m:0===m?h:y(h,m),h=this.maxIntervals/2;for(let m=0;m<h;m++){const h=2*m,y=2*m+1;this.intervalBytesSent[m]=this.intervalBytesSent[h]+this.intervalBytesSent[y],this.intervalBytesReceived[m]=this.intervalBytesReceived[h]+this.intervalBytesReceived[y],this.intervalLatencyMin[m]=combineLatency(this.intervalLatencyMin[h],this.intervalLatencyMin[y],Math.min),this.intervalLatencyMax[m]=combineLatency(this.intervalLatencyMax[h],this.intervalLatencyMax[y],Math.max),this.intervalLatencySum[m]=this.intervalLatencySum[h]+this.intervalLatencySum[y];const v=this.intervalLatencyCount[h]+this.intervalLatencyCount[y];this.intervalLatencyCount[m]=v,this.intervalLatencyAvg[m]=0===v?0:this.intervalLatencySum[m]/this.intervalLatencyCount[m]}this.intervalBytesSent.fill(0,h,this.maxIntervals),this.intervalBytesReceived.fill(0,h,this.maxIntervals),this.intervalLatencyMin.fill(0,h,this.maxIntervals),this.intervalLatencyMax.fill(0,h,this.maxIntervals),this.intervalLatencySum.fill(0,h,this.maxIntervals),this.intervalLatencyCount.fill(0,h,this.maxIntervals),this.intervalLatencyAvg.fill(0,h,this.maxIntervals),this.intervalMs*=2}dispose(){this.disposed=!0,this.updateSemaphore.tryRelease()}export(){const getScale=h=>Math.max(0,Math.ceil(Math.log2(Math.max(...h)/255))),applyReverseScale=(h,m)=>Math.round(h/Math.pow(2,m)),h=Buffer.alloc(3+5*(2+this.intervalCount)),m=Math.log2(this.interval/SessionContour.initialInterval);h[0]=1,h[1]=5,h[2]=m,h[3]=getScale(this.latencyMinMs),h[4]=getScale(this.latencyMaxMs),h[5]=getScale(this.latencyAverageMs),h[6]=getScale(this.bytesSent),h[7]=getScale(this.bytesReceived),h[8]=w.latencyMin,h[9]=w.latencyMax,h[10]=w.latencyAverage,h[11]=w.bytesSent,h[12]=w.bytesReceived;for(let m=0;m<this.intervalCount;m++){const y=13+5*m;h[y+0]=applyReverseScale(this.intervalLatencyMin[m],h[3]),h[y+1]=applyReverseScale(this.intervalLatencyMax[m],h[4]),h[y+2]=applyReverseScale(this.intervalLatencyAvg[m],h[5]),h[y+3]=applyReverseScale(this.intervalBytesSent[m],h[6]),h[y+4]=applyReverseScale(this.intervalBytesReceived[m],h[7])}return h.toString("base64")}static import(h){const m=Buffer.from(h,"base64");if(m.length<3)throw new Error("Invalid session contour string.");const y=m[0],v=m[1],C=m[2];if(1!==y)throw new Error(`Unsupported session contour version: ${y}`);const T=(m.length-3)/v-2;if(T<1||m.length!==3+v*(T+2))throw new Error("Incomplete session contour string.");const A=Math.pow(2,Math.ceil(Math.log2(T))),P=new SessionContour(A);P.intervalMs=Math.pow(2,C)*SessionContour.initialInterval,P.count=T;const k=new Array(v);for(let h=0;h<v;h++)k[h]=Math.pow(2,m[3+h]);const R=new Array(v);for(let h=0;h<v;h++)R[h]=m[3+v+h];for(let h=0;h<T;h++){const y=3+(2+h)*v;for(let C=0;C<v;C++)switch(R[C]){case w.latencyMin:P.intervalLatencyMin[h]=m[y+C]*k[C];break;case w.latencyMax:P.intervalLatencyMax[h]=m[y+C]*k[C];break;case w.latencyAverage:P.intervalLatencyAvg[h]=P.intervalLatencySum[h]=m[y+C]*k[C],P.intervalLatencyCount[h]=0===m[y+C]?0:1;break;case w.bytesSent:P.intervalBytesSent[h]=m[y+C]*k[C];break;case w.bytesReceived:P.intervalBytesReceived[h]=m[y+C]*k[C]}}return P}}var w;m.SessionContour=SessionContour,SessionContour.initialInterval=1e3,function(h){h[h.none=0]="none",h[h.latencyMin=1]="latencyMin",h[h.latencyMax=2]="latencyMax",h[h.latencyAverage=3]="latencyAverage",h[h.bytesSent=11]="bytesSent",h[h.bytesReceived=12]="bytesReceived"}(w||(w={}))},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0}),m.MultiChannelStream=void 0;const v=y(6),C=y(48),T=y(449),w=y(128),A=y(125),P=y(55),k=y(130);m.MultiChannelStream=class MultiChannelStream{constructor(h){if(this.transportStream=h,this.disposed=!1,this.disposables=[],this.closedEmitter=new v.Emitter,this.onClosed=this.closedEmitter.event,this.channelOpeningEmitter=new v.Emitter,!h)throw new TypeError("transportStream is required.");const m=new A.SshSessionConfiguration(!1);this.session=new w.SshSession(m),this.session.onClosed(this.onSessionClosed,this,this.disposables),this.session.onChannelOpening(this.onSessionChannelOpening,this,this.disposables)}get isClosed(){return this.disposed||this.session.isClosed}get onChannelOpening(){return this.isClosed||this.session.activateService(k.ConnectionService),this.channelOpeningEmitter.event}async connect(h){await this.session.connect(this.transportStream,h)}async acceptChannel(h,m){return await this.session.connect(this.transportStream,m),await this.session.acceptChannel(h,m)}async acceptStream(h,m){return new T.SshStream(await this.acceptChannel(h,m))}async openChannel(h,m){return await this.session.connect(this.transportStream,m),await this.session.openChannel(null!=h?h:null,m)}async openStream(h,m){return new T.SshStream(await this.openChannel(h,m))}async connectAndRunUntilClosed(h){const m=[],y=new Promise((y,v)=>{null==h||h.onCancellationRequested(v,null,m),this.session.onClosed(y,null,m)});try{await this.connect(h),await y}finally{m.forEach(h=>h.dispose()),await this.close()}}dispose(){if(!this.disposed){this.disposed=!0,this.session.dispose(),this.unsubscribe();try{this.transportStream&&this.transportStream.close().catch(h=>{(0,C.trace)("Error closing transport stream: "+h.message)})}catch(h){if(!(h instanceof Error))throw h;(0,C.trace)("Error closing transport stream: "+h.message)}}}async close(){this.disposed||(this.disposed=!0,await this.session.close(P.SshDisconnectReason.none,"SshSession disposed"),this.session.dispose(),this.unsubscribe(),await this.transportStream.close())}onSessionClosed(h){this.unsubscribe(),this.closedEmitter.fire(h)}onSessionChannelOpening(h){this.channelOpeningEmitter.fire(h)}unsubscribe(){this.disposables.forEach(h=>h.dispose()),this.disposables=[]}}},function(h,m,y){"use strict";var v=this&&this.__awaiter||function(h,m,y,v){return new(y||(y=Promise))((function(C,T){function fulfilled(h){try{step(v.next(h))}catch(h){T(h)}}function rejected(h){try{step(v.throw(h))}catch(h){T(h)}}function step(h){h.done?C(h.value):function adopt(h){return h instanceof y?h:new y((function(m){m(h)}))}(h.value).then(fulfilled,rejected)}step((v=v.apply(h,m||[])).next())}))};Object.defineProperty(m,"__esModule",{value:!0});const C=y(433),T=y(5),w=y(97),A=y(173),P=["email","openid","offline_access","9bd5ab7f-4031-4045-ace9-6bebbad202f6/all"];class MicrosoftAuthTokenProvider extends C.VsCodeNativeAuthTokenProvider{constructor(h){h=null!=h?h:T.traceSource.withName(w.SupportedAuthProviders.Microsoft),super(w.SupportedAuthProviders.Microsoft,P,h)}getAccessToken(){return v(this,void 0,void 0,(function*(){if(this.cascadeTokenIsValid())return this.cascadeToken;yield this.tryLoadSession(!1);const h=this.session;if(!h)return;let m=void 0;if(h.idToken){const y=A(h.idToken);m=y.altsecid||y.puid?h.idToken:h.accessToken}else m=h.accessToken;return m?(this.cascadeToken=yield this.tokenExchangeService.exchange(this.providerId,m),this.cascadeToken):void 0}))}}m.MicrosoftAuthTokenProvider=MicrosoftAuthTokenProvider},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0});const v=y(4),C=y(2);m.RpcServices=class RpcServices{constructor(h,m){this.rpcFactory=h,this.rpcServiceHandler=m,this.workspaceService=C.lazyLoad(()=>this.rpcFactory(v.vsls.WorkspaceService,v.vsls.TraceSources.ClientRpcWorkspace)),this.sourceEventService=C.lazyLoad(()=>this.rpcFactory(v.vsls.SourceEventService,v.vsls.TraceSources.ClientRpcSourceEvent)),this.workspaceAccessControlService=C.lazyLoad(()=>this.rpcFactory(v.vsls.WorkspaceAccessControlService,v.vsls.TraceSources.ClientWorkspaceAccessControl)),this.fileService=C.lazyLoad(()=>this.rpcFactory(v.vsls.FileService,v.vsls.TraceSources.ClientRpcFile)),this.accessControlService=C.lazyLoad(()=>this.rpcFactory(v.vsls.AccessControlService,v.vsls.TraceSources.ClientAccessControl)),this.syncService=C.lazyLoad(()=>this.rpcFactory(v.vsls.SyncService,"SyncService")),this.workspaceUserService=C.lazyLoad(()=>this.rpcFactory(v.vsls.WorkspaceUserService,v.vsls.TraceSources.ClientRpcWorkspaceUser)),this.serverSharingService=C.lazyLoad(()=>this.rpcFactory(v.vsls.ServerSharingService,v.vsls.TraceSources.ClientRpcServerSharing)),this.portForwardingService=C.lazyLoad(()=>this.rpcFactory(v.vsls.PortForwardingService,v.vsls.TraceSources.ClientRpcPortForwarding)),this.streamManagerService=C.lazyLoad(()=>this.rpcFactory(v.vsls.StreamManagerService,v.vsls.TraceSources.ClientRpcStreamManager)),this.streamService=C.lazyLoad(()=>this.rpcFactory(v.vsls.StreamService,v.vsls.TraceSources.ClientRpcStream)),this.chatService=C.lazyLoad(()=>this.rpcFactory(v.vsls.ChatService,v.vsls.TraceSources.ClientRpcChat)),this.terminalService=C.lazyLoad(()=>this.rpcFactory(v.vsls.TerminalService,v.vsls.TraceSources.ClientRpcTerminal))}}},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0});const v=y(23),C=y(22);function isSharedState(h){return h===C.SessionState.SharingInProgress||h===C.SessionState.Shared}function isJoinedState(h){return h===C.SessionState.JoiningInProgress||h===C.SessionState.Joined}m.stateLazyLoad=function stateLazyLoad(h){let m,y;return()=>(m&&function isSameState(h,m){return isSharedState(h)&&isSharedState(m)||isJoinedState(h)&&isJoinedState(m)}(y,v.sessionStateTracker.State)||(m=isSharedState(v.sessionStateTracker.State)?h.host?h.host():h.default():isJoinedState(v.sessionStateTracker.State)&&h.guest?h.guest():h.default(),y=v.sessionStateTracker.State),m)}},function(h,m,y){"use strict";var v=this&&this.__awaiter||function(h,m,y,v){return new(y||(y=Promise))((function(C,T){function fulfilled(h){try{step(v.next(h))}catch(h){T(h)}}function rejected(h){try{step(v.throw(h))}catch(h){T(h)}}function step(h){h.done?C(h.value):function adopt(h){return h instanceof y?h:new y((function(m){m(h)}))}(h.value).then(fulfilled,rejected)}step((v=v.apply(h,m||[])).next())}))};Object.defineProperty(m,"__esModule",{value:!0});const C=y(0),T=y(12),w=y(14),A=y(5),P=y(24);m.askToSignInAndReload=function askToSignInAndReload(h,m){return v(this,void 0,void 0,(function*(){const y=m;if(y){if(P.ExtensionUtil.context.globalState.get(y))return}const v=["Sign In"];y&&v.push("Don't show again");const k=yield A.NotificationUtil.showInformationMessage(h,!1,...v);"Sign In"===k&&(yield C.commands.executeCommand(`${T.Settings.get(w.SettingKeys.commandPrefix)}.signInAndReload`)),"Don't show again"===k&&P.ExtensionUtil.context&&(yield P.ExtensionUtil.context.globalState.update(y,!0))}))}},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0}),m.welcomePage='<!DOCTYPE html>\n<html lang="en">\n<head>\n    <meta http-equiv="Content-Security-Policy"\n        content="default-src \'none\'; font-src \'self\' data:; img-src vscode-resource: https:; script-src \'nonce-${nonce}\'; style-src \'nonce-${nonce}\'">\n    <link rel="stylesheet" href="${styleUri}" nonce="${nonce}">\n</head>\n<body>\n    \x3c!-- The following empty script tag is used to inject variables --\x3e\n    <script nonce="${nonce}"><\/script>\n    <div class="vsliveshare-welcome-page-main">\n        <header>\n            <img class="vsls-icon" src="https://aka.ms/vsls-icon" />\n            <div>\n                <h1 data-loc-id="158957f7">Visual Studio Live Share</h1>\n                <h2 data-loc-id="ea0c1d8a">Real-time Collaborative Development</h2>\n            </div>\n        </header>\n        <div class="js-liveshare-simple-share-full">\n            <separator></separator>\n            <p id="simple-page-text">Start your first collaboration session using Live Share</p>\n            <img id="simple-page-icon" src="https://aka.ms/vsls-developer-icon"/>\n            <button class="js-share-now-button">Share now</button>\n            <div id="simple-page-bottom-buttons">\n                <a class="simple-page-bottom-button" href="https://docs.microsoft.com/en-us/visualstudio/liveshare/use/vscode">User guide</a> \n                <a class="simple-page-bottom-button" href="http://aka.ms/vsls-troubleshooting">Help</a>\n                <a class="simple-page-bottom-button" href="https://github.com/MicrosoftDocs/live-share/issues">Feedback</a>\n            </div>\n        </div>\n        <div class="js-liveshare-share-full">\n            <separator></separator>\n            <p data-loc-id="0d9f3218">Welcome to Visual Studio Live Share! Get your team started with collaborative editing and debugging in\n                just a few simple steps:</p>\n            <div class="js-liveshare-action-signin clearfix">\n                <button class="sign-in-button js-sign-in-button" data-loc-id="3f1c30e2">Launch Sign In</button>\n                <details class="why-details">\n                    <summary><a id="why-sign-in" class="pointer" data-loc-id="bc546aef">Why sign in?</a></summary>\n                    <p data-loc-id="cf2f9959">When collaborating, it\'s important that others can identify who you are, in order to be confident\n                        with sharing access to their code and development environment. To make it easy to get started,\n                        you can sign in using an existing GitHub or Microsoft account.</p>\n                </details>\n                <p class="step-heading separator" data-loc-id="8ab2ea50">After signing in:</p>\n                <div class="spacer"></div>\n            </div>\n            <div class="js-liveshare-share-pre">\n                <section class="features-section">\n                    <div class="features-section__icon">\n                        <span class="ms-Icon ms-Icon--Share">\n                    </div>\n                    <div class="features-section__body">\n                        <h3 class="section-heads" data-loc-id="a01698c9">Share</h3>\n                        <p data-loc-id="355c621a">Click the <i>Live Share</i> button in your status bar, which will share your project,\n                            and copy a unique session URL to your clipboard.</p>\n                        <img src="https://aka.ms/vsls/quickstart/share" width="136px" height="57px" left="78px"\n                            top="98px" alt="Visual Studio Code share status bar item" />\n                        <p data-loc-id="9b33da5c">You\'ll be asked to sign in the first time you share (using a GitHub or Microsoft\n                            account), which allows others to identify you when collaborating.</p>\n                        <blockquote>\n                            <p data-loc-id="d8d8a4a9">On Windows, you may be asked to allow Live Share to open a firewall port, in\n                                order to enable peer-to-peer connections.</p>\n                        </blockquote>\n                    </div>\n                </section>\n            </div>\n\n            <section class="features-section">\n                <div class="features-section__icon">\n                    <span class="ms-Icon ms-Icon--ChatInviteFriend">\n                </div>\n                <div class="features-section__body">\n                    <h3 class="section-heads" data-loc-id="963c8400">Invite</h3>\n                    <p data-loc-id="0b30f81c">Send the session URL to the developers you\'d like to collaborate with (up to 30!), using\n                        e-mail, Skype, Slack, etc. <a id="security-info-link" href="https://aka.ms/vsls-security" data-loc-id="2278f11a">View\n                            security info</a> to understand more about\n                        secure sharing.</p>\n                    <div class="liveshare-share-post clearfix js-liveshare-action-post">\n                        <blockquote id="js-share-with-yourself-blockquote">\n                            <p data-loc-id="b4832819">Want to evaluate VS Live Share but don\'t have anyone to collaborate with? No problem!\n                                You can\n                                actually join your own session from another instance of VS Code.</p>\n                        </blockquote>\n                        <p id="js-join-uri" data-loc-id="d02e6362">Collaboration session URL: <p class="box js-liveshare-join-uri-button">\n                                ${joinUri}</p>\n                        </p>\n                        <button class="copy-invite-button js-liveshare-join-uri-button" data-loc-id="c98e64e5">Copy invite link</button>\n                        <button class="try-joinin-yourself-button js-liveshare-join-self-button" data-loc-id="6f05d343">Try joining\n                            yourself</button>\n                    </div>\n                </div>\n\n            </section>\n            <div class="step-heading-Collaborate">\n                <section class="features-section">\n                    <div class="features-section__icon">\n                        <span class="ms-Icon ms-Icon--People">\n                    </div>\n                    <div class="features-section__body">\n                        <h3 class="section-heads" data-loc-id="479e98d8">Collaborate</h3>\n                        <p data-loc-id="85f5992f">That\'s it! Once an invited "guest" joins, you\'ll get a notification, and will see their\n                            cursor appear in your currently opened file. All guests will start out <a\n                                id="follow-guest-link1" href="https://aka.ms/vsls-docs/vscode#following" data-loc-id="56ed9b91" aria-label="following - to follow a guest">"following"</a>\n                            you, which means\n                            that as you scroll or navigate between files, they will track those actions as well.\n                            This makes it easy to orient them with the issue/question/task you\'re about to start\n                            collaborating on.</p>\n                        <div class="step-heading-Collaborate_details">\n                            <div>\n                                <p data-loc-id="cc31088b">Additionally, to get the most out of Live Share, open up the <em>Session Details</em> view (shown to the right) and try out the following things:</p>\n                                <ul>\n                                    <li data-loc-id="2de7ba6c">Move your cursor, edit and highlight text, and watch guests do the same</li>\n                                    <li data-loc-id="d971c713"><a id="follow-guest-link2" href="https://aka.ms/vsls-docs/vscode#following" data-loc-id="02e07150">Follow a\n                                            guest</a>, and have them scroll and/or navigate to other files</li>\n                                    <li data-loc-id="a439566f"><a id="share-debug-session-link"\n                                                                href="https://aka.ms/vsls-docs/vscode#co-debugging" data-loc-id="33fa59be">Share a debug\n                                            session</a>, by pressing F5, then stepping together in real time</li>\n                                    <li data-loc-id="b9915c7f"><a id="share-server-link" href="https://aka.ms/vsls-docs/vscode#share-a-server" data-loc-id="bb9ef18d">Share a\n                                            server</a>, so\n                                        guests can view a locally running web app, database, etc.</li>\n                                    <li data-loc-id="4f10551a"><a id="share-terminal-link"\n                                                                href="https://aka.ms/vsls-docs/vscode#share-a-terminal" data-loc-id="f0ca3085">Share a terminal</a> and\n                                        run commands collaboratively</li>\n                                    <li data-loc-id="2744afe4"><a id="start-voice-call-link" href="https://aka.ms/vsls-audio" data-loc-id="4c8e870f">Start a voice\n                                            call</a> using the VS Live Share Audio extension</li>\n                                </ul>\n                            </div>\n                            <img src="https://aka.ms/vsls-vscode-viewlet" />\n                        </div>\n                    </div>\n                </section>\n            </div>\n        </div>\n\n        <div class="js-liveshare-join-full">\n            <separator></separator>\n            <p data-loc-id="50d7cc6a">Welcome to Visual Studio Live Share! Youve joined into a collaboration session and can begin editing and debugging in real-time.</p>\n            <div class="js-liveshare-action-signin clearfix">\n                <button class="sign-in-button js-sign-in-button" data-loc-id="d0a95743">Launch Sign In</button>\n                <details class="why-details">\n                    <summary><a id="join-why-sign-in" class="pointer" data-loc-id="0deadd51">Why sign in?</a></summary>\n                    <p data-loc-id="dd7df3a2">When collaborating, it\'s important that others can identify who you are, in order to be confident\n                        with sharing access to their code and development environment. To make it easy to get started,\n                        you can sign in using an existing GitHub or Microsoft account.</p>\n                </details>\n                <p class="step-heading separator" data-loc-id="0293ad40">After signing in:</p>\n                <div class="spacer"></div>\n            </div>\n            <div class="step-heading-edit">\n                <section class="features-section">\n                    <div class="features-section__icon">\n                        <span class="ms-Icon ms-Icon--Edit">\n                    </div>\n                    <div class="features-section__body">\n                        <h3 class="section-heads" data-loc-id="8d9ee863">Edit</h3>\n                        <div class="step-heading-Collaborate_details">\n                            <div>\n                                <p data-loc-id="d48e2fbb">Move your cursor around, edit, and highlight text. You\'ll be able to see other participants doing\n                                    the same. You can also navigate to other files, since you have access to the entire shared project.</p>\n                                <p data-loc-id="9bf70ecd">Additionally, to get the most out of Live Share, open up the <em>Session Details</em> view (shown to the right) and try out the following things:</p>\n                                <ul>\n                                    <li data-loc-id="63be0ba1">\n                                        <a href="https://aka.ms/vsls-docs/vscode#following">Follow a participant</a>, by clicking their name under the <em>Participants</em> list\n                                    </li>\n                                    <li data-loc-id="f44edc67">\n                                        <a href="https://aka.ms/vsls-docs/vscode#focusing">Focus a participant</a>, to call their attention to the code you\'re looking at\n                                    </li>\n                                    <li data-loc-id="406e1451">\n                                        <a id="start-voice-call-link" href="https://aka.ms/vsls-audio">Join a voice call</a>, using the Live Share Audio extension\n                                    </li>\n                                </ul>\n                            </div>\n                            <img src="https://aka.ms/vsls-vscode-viewlet" alt="Visual Studio Code command viewlet" />\n                        </div>\n                    </div>\n                </section>\n            </div>\n\n            <div class="step-heading-debug">\n                <section class="features-section">\n                    <div class="features-section__icon">\n                        <span class="ms-Icon ms-Icon--Bug">\n                    </div>\n                    <div class="features-section__body">\n                        <h3 class="section-heads" data-loc-id="10ee5256">Debug</h3>\n                        <p data-loc-id="90400e31"> Work through an issue/question/task with your team in\n                            real-time, using the following collaborative debugging capabilities:</p>\n                        <ul>\n                            <li data-loc-id="1f48f4a3">\n                                    <a href="https://aka.ms/vsls-docs/vscode#co-debugging">Debug together</a>, by starting a debug session, setting breakpoints and then stepping\n                            </li>\n                            <li data-loc-id="b7ab71e4">\n                                <a href="https://aka.ms/vsls-docs/vscode#share-a-server">View shared severs</a>, to browser web apps, REST APIs, etc. running on the host\'s machine\n                            </li>\n                            <li data-loc-id="0b9ac20d">\n                                <a href="https://aka.ms/vsls-docs/vscode#share-a-terminal">View shared terminals</a>, to view build output, run commands, etc.\n                            </li>\n                        </ul>\n                    </div>\n                </section>\n            </div>\n\n        </div>\n        <div class = "bottom-text">\n        <p data-loc-id="f9283848">If you run into any problems, see our <a id="troubleshooting-link"\n                                    href="http://aka.ms/vsls-troubleshooting" data-loc-id="90ef1fca">troubleshooting documentation</a> for potential workarounds.\n            Additionally, if you have any questions and/or feedback, please don\'t hesitate to reach out to the team on\n            <a id="github-link" href="http://github.com/microsoft/live-share">GitHub</a>. </p>\n       </div>\n    </div>\n\n    <div class="vsliveshare-dynamic-welcome-page">\n        <header id="dynamic-welcome-page-header">\n            <img class="vsls-icon" src="https://aka.ms/vsls-icon" />\n            <div>\n                <h1 data-loc-id="158957f7">Visual Studio Live Share</h1>\n                <h2 data-loc-id="ea0c1d8a">Real-time Collaborative Development</h2>\n            </div>\n        </header>\n        \n        <div id="vsliveshare-dynamic-welcome-page-main">\n            <separator></separator>\n            <p id="dynamic-welcome-page-title">Start collaborating in 3 simple steps</p>\n            <div id="dynamic-welcome-page-content">\n                <div id="dynamic-welcome-page-start-session">\n                    <img id="dynamic-page-share-icon" class="dynamic-welcome-page-icon" src="https://aka.ms/vsls-share-gray-icon"/>\n                    <button class="dynamic-welcome-page-button dynamic-welcome-page-start-button vsls-blue-button">Share</button>\n                    <div class="dynamic-welcome-page-content-element-text content-element-share">\n                        <p>\n                            To share in the future:\n                        </p>\n                        <ol>\n                            <li>Go to Live Share from your side pane.</li>\n                            <li>Click on \'Start collaboration session\' under \'Session Details.</li>\n                        </ol>\n                        <img src="https://aka.ms/vsls-start-collaboration-session" width="60%" height="auto"/>\n                    </div>\n                </div>\n                <div id="dynamic-welcome-page-authenticate">\n                    <img id="dynamic-page-authenticate-icon" class="dynamic-welcome-page-icon" src="https://aka.ms/vsls-authenticate-gray-icon"/>\n                    <p id="dynamic-page-authenticate-button" class="dynamic-welcome-page-button-outline vsls-gray-button-outline">Follow steps to authenticate</p>\n                    <p class="dynamic-welcome-page-content-element-text">\n                        Authentication only happens once.\n                        <br>\n                        Once authenticated using Github or Microsoft you don\'t need to authenticate again, unless you sign-out explicitly.\n                    </p>\n                </div>\n                <div id="dynamic-welcome-page-share-session">\n                    <div>\n                        <div id="dynamic-welcome-page-invite-others">\n                            <img id="dynamic-page-invite-icon" class="dynamic-welcome-page-icon" src="https://aka.ms/vsls-invite-gray-icon"/>\n                            <p id="dynamic-page-invite-button" class="dynamic-welcome-page-button-outline vsls-gray-button-outline">Invite others</p>\n                        </div>\n                        \x3c!-- OR --\x3e\n                        <div id="dynamic-welcome-page-invite-join-yourself">\n                            <img id="dynamic-page-join-yourself-icon" class="dynamic-welcome-page-icon" src="https://aka.ms/vsls-join-yourself-gray-icon"/>\n                            <button id="dynamic-page-join-yourself-button" class="dynamic-welcome-page-button">Join yourself to learn</button>\n                        </div>\n                    </div>\n                    <p class="dynamic-welcome-page-content-element-text" id="share-session-content-element-text">\n                        Inviting others to your session.\n                        <br>\n                        You can invite others to a session you start by sharing the session URL with them. This session link is automatically copied to your clipboard when you start a session.\n                        <br>\n                        You can always access the session URL from the \'Session Details\' bar. <img src="https://aka.ms/vsls-session-details-img" width="30%" height="auto"/>\n                    </p>\n                </div>\n            </div>\n        </div>\n\n        <div id="liveshare-collaboration-details">\n            <header id="collaboration-header">\n                <img class="vsls-icon" src="https://aka.ms/vsls-collaboration-white-icon"/>\n                <div>\n                    <h1>Collaborate</h1>\n                    <h2>Deep Dive into Live Shares features</h2>\n                </div>\n            </header>\n            <p>\n                Once your guest has joined your live Share session, they will start <span class="bold-text">"following"</span> you. You can now start with the primary feature of co-editing using Live Share. \n                Scroll through your code and navigate between files as you guest follows along. But you can do so much more.\n            </p>\n            <table>\n                <tr>\n                    <td>\n                        <div>\n                            <p>\n                                Additionally, to get the most out of Live Share, open up the <em>Session Details</em> view (shown to the right) and try out the following things:\n                            </p>\n                            <ul>\n                                <li>\n                                    Move your cursor, edit and highlight text, and watch guests do the same\n                                </li>\n                                <li >\n                                    <a id="follow-guest-link2" href="https://aka.ms/vsls-docs/vscode#following">Follow a guest</a>, and have them scroll and/or navigate to other files\n                                </li>\n                                <li>\n                                    <a id="share-debug-session-link" href="https://aka.ms/vsls-docs/vscode#co-debugging">Share a debug session</a>, by pressing F5, then stepping together in real time\n                                </li>\n                                <li>\n                                    <a id="share-server-link" href="https://aka.ms/vsls-docs/vscode#share-a-server">Share a server</a>, so guests can view a locally running web app, database, etc.\n                                </li>\n                                <li>\n                                    <a id="share-terminal-link" href="https://aka.ms/vsls-docs/vscode#share-a-terminal">Share a terminal</a> and run commands collaboratively\n                                </li>\n                                <li>\n                                    <a id="start-voice-call-link" href="https://aka.ms/vsls-audio">Start a voice call</a> using the VS Live Share Audio extension\n                                </li>\n                            </ul>\n                        </div>\n                    </td>\n                    <td>\n                        <img src="https://aka.ms/vsls-vscode-viewlet" />\n                    </td>\n                </tr>\n            </table>\n        </div>\n        <div class="dynamic-page-bottom-text">\n            <p>\n                If you run into any problems, see our <a id="troubleshooting-link" href="http://aka.ms/vsls-troubleshooting">troubleshooting documentation</a> \n                for potential workarounds. Additionally, if you have any questions and/or feedback, please don\'t hesitate to reach out to the team on\n                <a id="github-link" href="http://github.com/microsoft/live-share">GitHub</a>.\n            </p>\n        </div>\n    </div>\n    <script nonce="${nonce}" src="${mainScriptUri}"><\/script>\n</body>\n'},function(h,m,y){"use strict";var v=this&&this.__awaiter||function(h,m,y,v){return new(y||(y=Promise))((function(C,T){function fulfilled(h){try{step(v.next(h))}catch(h){T(h)}}function rejected(h){try{step(v.throw(h))}catch(h){T(h)}}function step(h){h.done?C(h.value):function adopt(h){return h instanceof y?h:new y((function(m){m(h)}))}(h.value).then(fulfilled,rejected)}step((v=v.apply(h,m||[])).next())}))};Object.defineProperty(m,"__esModule",{value:!0});const C=y(26),T=y(95);m.copyInvitationLinkToClipboard=function copyInvitationLinkToClipboard(){return v(this,void 0,void 0,(function*(){const h=C.workspaceSessionInfoTracker.workspaceSessionInfo.joinUri;return yield(new T.ClipboardUtil).copyToClipboardAsync(h)}))}},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0});const v=y(17),C=y(5);m.SamplingFilter=class SamplingFilter{constructor(h){this.samplingConfig=h}shouldSend(h,m,y){if(!h)return!0;const C=this.samplingConfig[h];if("number"==typeof C&&!isNaN(C)){if(0===C||Math.random()*C>1)return!1;y[v.TelemetryPropertyNames.SAMPLE_RATE]=C}return!0}};m.MissingConversationIdFilter=class MissingConversationIdFilter{shouldSend(h,m,y){return h!==v.TelemetryEventNames.SHARE_WORKSPACE||"Success"!==m[v.TelemetryPropertyNames.EVENT_RESULT]||m[v.TelemetryPropertyNames.CONVERSATION_ID]||C.NotificationUtil.showErrorMessage("A share happened, but conversationId was not set. Please email mowillia@microsoft.com so she can reproduce this with your steps!"),!0}}},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0});const v=y(1094),C=y(344),T=y(171),w=y(8),A=y(17);class MethodSummary{constructor(){this.numMessages=0,this.firstMessage=0,this.maxMessage=0,this.minMessage=0,this.metricTotal=0}get averageMessage(){return 0===this.numMessages?0:this.metricTotal/this.numMessages}addMessage(h){0===this.numMessages?this.firstMessage=this.maxMessage=this.minMessage=h:(this.maxMessage=Math.max(h,this.maxMessage),this.minMessage=Math.min(h,this.minMessage)),this.numMessages++,this.metricTotal+=h}}class MethodTimingRequestSummary{constructor(){this.latencySummary=new MethodSummary,this.processingSummary=new MethodSummary,this.combinedSummary=new MethodSummary}}class RpcTimingTelemetry{static updateTelemetry(h,m,y,v){RpcTimingTelemetry.requestSummaries.has(h)||RpcTimingTelemetry.requestSummaries.set(h,new MethodTimingRequestSummary);const C=RpcTimingTelemetry.requestSummaries.get(h);C.latencySummary.addMessage(m),C.processingSummary.addMessage(y),C.combinedSummary.addMessage(v)}static postRequestSummaries(){for(const[h,m]of RpcTimingTelemetry.requestSummaries){const y=new w.TelemetryEvent(RpcTelemetryEventNames.SUMMARIZE_RPC_REQUEST_TIMES);y.addProperty(RpcTelemetryPropertyNames.METHOD_NAME,h),y.addMeasure(RpcTelemetryPropertyNames.NUMBER_OF_MESSAGES,m.latencySummary.numMessages),y.addProperty(RpcTelemetryPropertyNames.FIRST_MESSAGE,JSON.stringify([m.latencySummary.firstMessage,m.processingSummary.firstMessage,m.combinedSummary.firstMessage])),y.addProperty(RpcTelemetryPropertyNames.MAX_MESSAGE,JSON.stringify([m.latencySummary.maxMessage,m.processingSummary.maxMessage,m.combinedSummary.maxMessage])),y.addProperty(RpcTelemetryPropertyNames.MIN_MESSAGE,JSON.stringify([m.latencySummary.minMessage,m.processingSummary.minMessage,m.combinedSummary.minMessage])),y.addProperty(RpcTelemetryPropertyNames.AVERAGE_MESSAGE,JSON.stringify([m.latencySummary.averageMessage,m.processingSummary.averageMessage,m.combinedSummary.averageMessage])),y.send()}RpcTimingTelemetry.requestSummaries.clear()}}m.RpcTimingTelemetry=RpcTimingTelemetry,RpcTimingTelemetry.requestSummaries=new Map;class RpcSizeTelemetry{static updateTelemetry(h,m,y){RpcSizeTelemetry.methodSummaries.has(h)||RpcSizeTelemetry.methodSummaries.set(h,new Map);const v=RpcSizeTelemetry.methodSummaries.get(h);v.has(m)||v.set(m,new MethodSummary),v.get(m).addMessage(y)}static postMethodSummaries(){for(const[h,m]of RpcSizeTelemetry.methodSummaries)for(const[y,v]of m){const m=new w.TelemetryEvent(RpcTelemetryEventNames.SUMMARIZE_RPC_METHOD_SIZES);m.addProperty(RpcTelemetryPropertyNames.METHOD_NAME,h),m.addProperty(RpcTelemetryPropertyNames.METHOD_TYPE,y),m.addMeasure(RpcTelemetryPropertyNames.NUMBER_OF_MESSAGES,v.numMessages),m.addMeasure(RpcTelemetryPropertyNames.FIRST_MESSAGE,v.firstMessage),m.addMeasure(RpcTelemetryPropertyNames.MAX_MESSAGE,v.maxMessage),m.addMeasure(RpcTelemetryPropertyNames.MIN_MESSAGE,v.minMessage),m.addMeasure(RpcTelemetryPropertyNames.AVERAGE_MESSAGE,v.averageMessage),m.send()}RpcSizeTelemetry.methodSummaries.clear()}}m.RpcSizeTelemetry=RpcSizeTelemetry,RpcSizeTelemetry.methodSummaries=new Map;m.LanguageServiceRpcMethodNameProvider=class LanguageServiceRpcMethodNameProvider{constructor(){this.serviceNames=["languageServerProvider-any","languageServerProvider-Roslyn"]}getMethod(h){if(h.params&&(h.params.length>0&&h.params[0].method||h.params.length>1&&h.params[1].method)){return`${h.method.split(".")[0]}.${h.params[0].method?h.params[0].method:h.params[1].method}`}}};class RequestMessageCacheRecord{constructor(h){this.requestMessage=h,this.constructedTime=(new Date).getTime()}}class TelemetryRpcFilterBase{constructor(...h){this.requestMessages=new Map,this.methodNameProviders=new Map;for(const m of h)this.addMethodNameProvider(m)}addMethodNameProvider(h){for(const m of h.serviceNames)this.methodNameProviders.set(m,h)}cacheRequestMessage(h){if(C.isRequestMessage(h)){const m=h;this.requestMessages.set(m.id,new RequestMessageCacheRecord(m))}}getModifiedMethodName(h,m){const y=h.split(".")[0],v=this.methodNameProviders.get(y);if(v){const h=v.getMethod(m);if(h)return h}return h}getRequestMessage(h){const m="number"==typeof h?h:h.id;if(null!==m&&this.requestMessages.has(m)){const h=this.requestMessages.get(m).requestMessage;if(this.requestMessages.delete(m),h.method){return{requestMsg:h,methodName:this.getModifiedMethodName(h.method,h)}}}}}class TelemetryRpcErrorFilter extends TelemetryRpcFilterBase{constructor(...h){super(...h),T.SessionTelemetry.sessionEvent.on(T.SessionTelemetry.sessionEndEventName,()=>{this.reportExpiredRequests(),this.requestMessages.clear()})}readWriteFilter(h){return this.cacheRequestMessage(h),this.checkForError(h),this.checkForCancellation(h),h}checkForError(h){if(C.isResponseMessage(h)){const m=h,y=this.getRequestMessage(h);if(m.error){const m=y?y.methodName:"";TelemetryRpcErrorFilter.reportRpcError(m,h.error)}}}checkForCancellation(h){if(C.isNotificationMessage(h)&&"$/cancelRequest"===h.method){const m=h.params.id,y=this.getRequestMessage(m);TelemetryRpcErrorFilter.reportCancelledRequest(y?y.methodName:"NA")}}static reportRpcError(h,m){const y=new w.Fault(RpcTelemetryEventNames.RECEIVE_RPC_FAULT,w.FaultType.Error,m.message);y.addProperty(RpcTelemetryPropertyNames.METHOD_NAME,h),y.addProperty(RpcTelemetryPropertyNames.ERROR_CODE,m.code),y.addProperty(RpcTelemetryPropertyNames.ERROR_DATA,JSON.stringify(m.data)),y.sendAsError([RpcTelemetryPropertyNames.ERROR_DATA])}static reportCancelledRequest(h){const m=new w.TelemetryEvent(RpcTelemetryEventNames.CANCEL_RPC_REQUEST);m.addProperty(RpcTelemetryPropertyNames.METHOD_NAME,h),m.send()}getExpiredRequests(){const h=(new Date).getTime(),m=new Map;for(let[,y]of this.requestMessages)if(h-y.constructedTime>6e4){const h=this.getModifiedMethodName(y.requestMessage.method,y.requestMessage),v=m.get(h)||0;m.set(h,v+1)}return m}reportExpiredRequests(){const h=this.getExpiredRequests();for(const[m,y]of h){const h=new w.TelemetryEvent(RpcTelemetryEventNames.EXPIRE_RPC_REQUESTS);h.addProperty(RpcTelemetryPropertyNames.METHOD_NAME,m),h.addMeasure(RpcTelemetryPropertyNames.NUMBER_OF_MESSAGES,y),h.send()}}}m.TelemetryRpcErrorFilter=TelemetryRpcErrorFilter;m.TelemetryRpcFilter=class TelemetryRpcFilter extends TelemetryRpcFilterBase{constructor(...h){super(...h),T.SessionTelemetry.sessionEvent.on(T.SessionTelemetry.sessionEndEventName,()=>{RpcTimingTelemetry.postRequestSummaries(),RpcSizeTelemetry.postMethodSummaries()})}writeFilter(h){return this.cacheRequestMessage(h),h}readFilter(h){if(C.isRequestMessage(h)||C.isNotificationMessage(h)){const m=this.getModifiedMethodName(h.method,h);void 0!==h.size&&RpcSizeTelemetry.updateTelemetry(m,C.isRequestMessage(h)?"request":"notification",h.size)}else if(C.isResponseMessage(h)&&void 0!==h.id&&this.requestMessages.has(h.id)){const m=this.getRequestMessage(h),y=m?m.methodName:"";void 0!==h.size&&RpcSizeTelemetry.updateTelemetry(y,"response",h.size),void 0!==h.times&&RpcTimingTelemetry.updateTelemetry(y,v.TimedRpcMessageUtils.getLatency(h.times),v.TimedRpcMessageUtils.getProcessingTime(h.times),v.TimedRpcMessageUtils.getTotalTime(h.times))}return h}};class RpcTelemetryEventNames{}m.RpcTelemetryEventNames=RpcTelemetryEventNames,RpcTelemetryEventNames.SUMMARIZE_RPC_REQUEST_TIMES="summarize-rpcrequesttimes",RpcTelemetryEventNames.SUMMARIZE_RPC_METHOD_SIZES="summarize-rpcmethodsizes",RpcTelemetryEventNames.RECEIVE_RPC_FAULT=A.TelemetryEventNames.FAULT_PREFIX+"receive-rpc-fault",RpcTelemetryEventNames.EXPIRE_RPC_REQUESTS="expire-rpcrequests",RpcTelemetryEventNames.CANCEL_RPC_REQUEST="cancel-rpcrequest";class RpcTelemetryPropertyNames{}m.RpcTelemetryPropertyNames=RpcTelemetryPropertyNames,RpcTelemetryPropertyNames.METHOD_NAME=A.TelemetryPropertyNames.FEATURE_NAME+"MethodName",RpcTelemetryPropertyNames.METHOD_TYPE=A.TelemetryPropertyNames.FEATURE_NAME+"MethodType",RpcTelemetryPropertyNames.NUMBER_OF_MESSAGES=A.TelemetryPropertyNames.FEATURE_NAME+"NumberOfMessages",RpcTelemetryPropertyNames.FIRST_MESSAGE=A.TelemetryPropertyNames.FEATURE_NAME+"FirstMessage",RpcTelemetryPropertyNames.MAX_MESSAGE=A.TelemetryPropertyNames.FEATURE_NAME+"MaxMessage",RpcTelemetryPropertyNames.MIN_MESSAGE=A.TelemetryPropertyNames.FEATURE_NAME+"MinMessage",RpcTelemetryPropertyNames.AVERAGE_MESSAGE=A.TelemetryPropertyNames.FEATURE_NAME+"AverageMessage",RpcTelemetryPropertyNames.ERROR_CODE=A.TelemetryPropertyNames.FEATURE_NAME+"ErrorCode",RpcTelemetryPropertyNames.ERROR_DATA=A.TelemetryPropertyNames.FEATURE_NAME+"ErrorData"},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0});m.WrappedMessageReader=class WrappedMessageReader{constructor(h,m){this.messageReader=h,this.messageTransformer=m,this.onError=this.messageReader.onError,this.onClose=this.messageReader.onClose,this.onPartialMessage=this.messageReader.onPartialMessage}listen(h){this.messageReader.listen(m=>{h(this.messageTransformer(m))})}dispose(){this.messageReader.dispose()}};m.WrappedMessageWriter=class WrappedMessageWriter{constructor(h,m){this.messageWriter=h,this.messageTransformer=m,this.onError=this.messageWriter.onError,this.onClose=this.messageWriter.onClose}write(h){this.messageWriter.write(this.messageTransformer(h))}dispose(){this.messageWriter.dispose()}};m.TimingFilter=class TimingFilter{constructor(){this.times=new Map}filter(h,m){if("number"!=typeof m.id)return m;if(this.times.has(m.id)){const y=Date.now()-this.times.get(m.id);this.times.delete(m.id),(h||void 0!==m.times)&&(m.times=TimedRpcMessageUtils.addTime(m.times,y))}else this.times.set(m.id,Date.now());return m}};class TimedRpcMessageUtils{static addTime(h,m){void 0===h&&(h=[]);const y=m-TimedRpcMessageUtils.getTotalTime(h);return h.push(y>0?y:0),h}static getLatency(h){let m=0;if(h)for(let y=1;y<h.length;y+=2)m+=h[y];return m}static getProcessingTime(h){let m=0;if(h)for(let y=0;y<h.length;y+=2)m+=h[y];return m}static getTotalTime(h){return TimedRpcMessageUtils.getLatency(h)+TimedRpcMessageUtils.getProcessingTime(h)}}m.TimedRpcMessageUtils=TimedRpcMessageUtils,m.AddContextToRpcMessage=function AddContextToRpcMessage(h){if(!h)return h;const m=h.context,y=h.params;return"object"!=typeof m||"object"!=typeof y||Array.isArray(y)||y.context?h:Object.assign({},h,{params:Object.assign({context:m},y)})};m.RpcRequestsWithContext=class RpcRequestsWithContext{constructor(){this.methods=new Set,this.readFilter=this.filterMessage.bind(this)}add(h){h&&this.methods.add(h)}filterMessage(h){const m=h;if(!m.method||!this.methods.has(m.method))return h;const y=h.context||{};return m.params?Array.isArray(m.params)&&m.params.push(y):m.params=[y],m}}},function(h,m,y){"use strict";var v=this&&this.__awaiter||function(h,m,y,v){return new(y||(y=Promise))((function(C,T){function fulfilled(h){try{step(v.next(h))}catch(h){T(h)}}function rejected(h){try{step(v.throw(h))}catch(h){T(h)}}function step(h){h.done?C(h.value):function adopt(h){return h instanceof y?h:new y((function(m){m(h)}))}(h.value).then(fulfilled,rejected)}step((v=v.apply(h,m||[])).next())}))};Object.defineProperty(m,"__esModule",{value:!0});const C=y(4),T=y(0);m.RpcServiceHelper=class RpcServiceHelper{static registerHostRpcService(h,m,y,w){return v(this,void 0,void 0,(function*(){if(!h)throw new Error("service argument is missing or undefined");if(!m)throw new Error("serviceInfo argument is missing or undefined");if(!y)throw new Error("dependencies argument is missing or undefined");const A=m.name;if(!A)throw new Error("serviceInfo.serviceName is empty or undefined");const P=y.workspaceService(),k=y.sessionContext(),R=y.rpcServiceHandler().registerRpcService(h,m);try{yield P.registerServicesAsync([A],C.vsls.CollectionChangeType.Add)}catch(h){throw R.dispose(),h}const M=new T.Disposable(()=>v(this,void 0,void 0,(function*(){if(R.dispose(),k.isStartingCollaboration||k.isCollaborating)try{yield P.registerServicesAsync([A],C.vsls.CollectionChangeType.Remove)}catch(h){}})));return w&&w.push(M),M}))}}},function(h,m,y){"use strict";var v=this&&this.__awaiter||function(h,m,y,v){return new(y||(y=Promise))((function(C,T){function fulfilled(h){try{step(v.next(h))}catch(h){T(h)}}function rejected(h){try{step(v.throw(h))}catch(h){T(h)}}function step(h){h.done?C(h.value):function adopt(h){return h instanceof y?h:new y((function(m){m(h)}))}(h.value).then(fulfilled,rejected)}step((v=v.apply(h,m||[])).next())}))};Object.defineProperty(m,"__esModule",{value:!0});const C=y(0),T=y(5),w=y(455),A=y(14),P=y(37),k=y(451);class EnterpriseConfig{constructor(){this.policyProviders=new Map,this.policyManagedSettings=[A.SettingKeys.allowedDomains,A.SettingKeys.allowReadWriteTerminals],this.resolutionMap=new Map,this.resolutionFactory=new w.ResolutionStrategyFactory,this.ignoreConfigUpdates=!1,C.workspace.onDidChangeConfiguration(h=>this.configurationChangeHandler(this.ignoreConfigUpdates,h))}static get Instance(){return EnterpriseConfig.singleton||(EnterpriseConfig.singleton=new EnterpriseConfig),EnterpriseConfig.singleton}isEnabled(){return v(this,void 0,void 0,(function*(){const h=P.getExpService();return!!h&&(yield h.isCachedFlightEnabled("policies"))}))}get(h){let m=this.resolutionMap.get(h);if(m&&(this.policyManagedSettings.includes(m.policySetting)||m.isEnforced))return m.value}registerPolicyProvider(h,m){return v(this,void 0,void 0,(function*(){return(yield this.isEnabled())?(T.traceSource.info(`Register provier with name: ${h}`),m?(this.policyProviders.set(h,m),this.rebuildResolutionMap(),new C.Disposable(()=>{this.policyProviders.delete(h),this.rebuildResolutionMap()})):null):null}))}configurationChangeHandler(h,m){if(h)return;let y=C.workspace.getConfiguration(k.defaultSettings.configName);this.resolutionMap.forEach(h=>v(this,void 0,void 0,(function*(){if(!h.isEnforced)return;let v=`${k.defaultSettings.configName}.${h.policySetting}`;if(m.affectsConfiguration(v)){if(y[h.policySetting]!==h.value)return this.ignoreConfigUpdates=!0,y.update(h.policySetting,h.value,C.ConfigurationTarget.Global),this.ignoreConfigUpdates=!1,void(yield C.window.showInformationMessage("An attempt to override a setting enforced by external extension. "+`The value of '${h.policySetting}' has been set back to '${h.value}'.`))}})))}rebuildResolutionMap(){this.resolutionMap.clear(),this.policyProviders.forEach((h,m)=>{let y;try{y=h.providePolicies()}catch(h){return void T.traceSource.error(`'${m}' policy provider failed`,h)}for(let h of y){if(!this.resolutionMap.has(h.policySetting)){this.resolutionMap.set(h.policySetting,h);continue}let m=this.resolutionMap.get(h.policySetting);if(void 0===m){this.resolutionMap.set(h.policySetting,h);continue}let y=this.resolutionFactory.resolve(A.SettingKeys[h.policySetting],m.value,h.value);void 0===y?T.traceSource.info(`Failed to resolve policy conflict for: ${h.policySetting}`):h.value===y&&this.resolutionMap.set(h.policySetting,h)}});const h=C.workspace.getConfiguration(k.defaultSettings.configName);this.ignoreConfigUpdates=!0;for(let m of this.resolutionMap.values())this.policyManagedSettings.includes(m.policySetting)||h.update(m.policySetting,m.value,C.ConfigurationTarget.Global);this.ignoreConfigUpdates=!1}}const R=EnterpriseConfig.Instance;m.EnterpriseConfig=R},function(h,m,y){"use strict";var v=this&&this.__awaiter||function(h,m,y,v){return new(y||(y=Promise))((function(C,T){function fulfilled(h){try{step(v.next(h))}catch(h){T(h)}}function rejected(h){try{step(v.throw(h))}catch(h){T(h)}}function step(h){h.done?C(h.value):function adopt(h){return h instanceof y?h:new y((function(m){m(h)}))}(h.value).then(fulfilled,rejected)}step((v=v.apply(h,m||[])).next())}))};Object.defineProperty(m,"__esModule",{value:!0});const C=y(0),T=y(71),w=y(102),A=y(131),P=y(16),k=y(26),R=y(23),M=y(22);function toSessionStates(h){const m=h===M.SessionState.Shared,y=h===M.SessionState.Joined;return{isSharedState:m,isJoinedState:y,isSharingState:h===M.SessionState.SharingInProgress,isJoiningState:h===M.SessionState.JoiningInProgress,notSharedOrJoined:!m&&!y}}function isExtensionProviderVisible(h,m){return!h.supportedContext&&!m.notSharedOrJoined||h.supportedContext===w.TreeDataProviderContext.Joined&&m.isJoinedState||h.supportedContext===w.TreeDataProviderContext.Sharing&&m.isSharedState||h.supportedContext===w.TreeDataProviderContext.SharedOrJoined&&!m.notSharedOrJoined||h.supportedContext===w.TreeDataProviderContext.NotSharedOrJoined&&m.notSharedOrJoined}m.SessionExplorerProvider=class SessionExplorerProvider{constructor(h){this.sessionContext=h,this.extensionItemProviders=new Map,this.extensionProviders=[],this.changeEventEmitter=new C.EventEmitter,this.onDidChangeTreeData=this.changeEventEmitter.event,R.sessionStateTracker.onStateChanged(h=>this.forceRefreshState(h.oldState,h.newState)),k.workspaceSessionInfoTracker.onReadOnlyChanged(()=>this.forceRefresh()),this.sessionContext.onAccessControlChanged(()=>this.forceRefresh())}getExtensionTreeDataProvider(h){const m=this.extensionProviders.find(m=>m.id===h);if(m)return m}registerTreeDataProvider(h){if(this.extensionProviders.indexOf(h)>=0)return null;let m=void 0;return h.onDidChangeTreeData&&(m=h.onDidChangeTreeData(h=>{this.refresh(h)})),this.extensionProviders.push(h),this.refresh(),new C.Disposable(()=>{const y=this.extensionProviders.indexOf(h);y<0||(m&&(m.dispose(),m=void 0),this.extensionProviders.splice(y,1),this.refresh())})}refresh(h){this.changeEventEmitter.fire(h)}getTreeItem(h){const m=this.extensionItemProviders.get(h);return m?m.getTreeItem(h):h}getChildren(h){return v(this,void 0,void 0,(function*(){try{return h?yield this.getElementChildren(h):yield this.getDefaultRootChildren()}catch(h){if(h instanceof P.RpcConnectionShutdownError)return[];throw h}}))}forceRefresh(){this.extensionProviders.forEach(h=>{h.refreshItems&&h.refreshItems()}),this.refresh()}forceRefreshState(h,m){const y=toSessionStates(h),v=toSessionStates(m);for(const h of this.extensionProviders)if(isExtensionProviderVisible(h,y)!==isExtensionProviderVisible(h,v))return void this.forceRefresh()}getDefaultRootChildren(){return v(this,void 0,void 0,(function*(){const h=R.sessionStateTracker.State,m=toSessionStates(h);if(m.isSharingState||m.isJoiningState)return[new T.TreeViewItem({type:"loading",label:m.isSharingState?"Starting collaboration session...":"Joining collaboration session...",iconPath:A.TreeDataProviderBase.getThemeIconPath("loading")})];let y=[];this.extensionItemProviders.clear();for(const h of this.extensionProviders)if(isExtensionProviderVisible(h,m)){const m=yield h.getChildren();if(m&&m.length>0){for(let y of m)this.extensionItemProviders.set(y,h);y=y.concat(m)}}return R.sessionStateTracker.State!==h?yield this.getDefaultRootChildren():y}))}getElementChildren(h){return v(this,void 0,void 0,(function*(){const m=this.extensionItemProviders.get(h);if(m){const y=yield m.getChildren(h);for(let h of y)this.extensionItemProviders.set(h,m);return y}return[]}))}}},function(h,m,y){"use strict";var v=this&&this.__awaiter||function(h,m,y,v){return new(y||(y=Promise))((function(C,T){function fulfilled(h){try{step(v.next(h))}catch(h){T(h)}}function rejected(h){try{step(v.throw(h))}catch(h){T(h)}}function step(h){h.done?C(h.value):function adopt(h){return h instanceof y?h:new y((function(m){m(h)}))}(h.value).then(fulfilled,rejected)}step((v=v.apply(h,m||[])).next())}))};Object.defineProperty(m,"__esModule",{value:!0});const C=y(0),T=y(7),w=y(102),A=y(131),P=y(71),k=y(26),R=y(4),M=y(25),N=y(24),D=y(53),I=y(37),x=y(64),O=y(1101);var L,U;!function(h){h.readOnly="readOnly",h.readWrite="readWrite"}(L=m.AnonymousAccessLevel||(m.AnonymousAccessLevel={}));class ParticipantSessionExplorerItem extends P.TreeViewItem{constructor(h){super(h),this.options=h,this.sessionId=h.sessionId,this.participantId=h.participantId}}function getLocalizeInviteStatus(h){switch(h){case R.vsls.InviteContactStatus.Invited:return M.localize("inviteContactStatus.invited");case R.vsls.InviteContactStatus.Dismissed:return M.localize("inviteContactStatus.dismissed");case R.vsls.InviteContactStatus.Joining:return M.localize("inviteContactStatus.joining")}}m.ParticipantSessionExplorerItem=ParticipantSessionExplorerItem,function(h){h.Participants="participants",h.InvitedContact="contacts.invited",h.CurrentUser="participants.currentuser",h.Guest="participants.guest",h.FollowedGuest="participants.guest.followed",h.Participant="participants.participant",h.FollowedParticipant="participants.participant.followed",h.GuestAnonymous="participants.guest.anonymous",h.FollowedGuestAnonymous="participants.guest.followed.anonymous",h.GuestElevated="participants.guest.elevated",h.FollowedGuestElevated="participants.guest.followed.elevated",h.GuestElevatedAnonymous="participants.guest.elevated.anonymous",h.FollowedGuestElevatedAnonymous="participants.guest.followed.elevated.anonymous"}(U=m.ParticipantsViewItem||(m.ParticipantsViewItem={}));const B=new Map([[D.PathManager.notebookCellScheme,()=>""]]);class ParticipantsTreeDataProvider extends A.TreeDataProviderBase{constructor(h,m,y,v){super(U.Participants,w.TreeDataProviderContext.SharedOrJoined),this.sessionContext=h,this.clientAccessCheck=m,this.contactManager=y,this.isSessionExplorer=v,this.sessionContext.onCollaboratorChanged(h=>{h&&h.changeType===R.vsls.WorkspaceSessionChangeType.Unjoined&&this.forceRefreshItems()}),this.sessionContext.onCollaboratorsJoined(()=>{this.forceRefreshItems()}),this.sessionContext.onAccessControlChanged(()=>this.forceRefreshItems()),y.onInviteStatusChanged(()=>this.forceRefreshItems())}registerCoEditing(h){const m=[];return m.push(h.onPin(()=>this.forceRefreshItems())),m.push(h.onUnpin(()=>this.forceRefreshItems())),m.push(h.onFollowed(()=>this.forceRefreshItems())),m.push(h.onUnfollowed(()=>this.forceRefreshItems())),m.push(h.onUpdateCoEditorPosition(()=>this.forceRefreshItems())),C.Disposable.from(...m)}getRootItem(){const h=this.getApprovedParticipants(),m=new P.TreeViewItem({type:U.Participants,collapsibleState:C.TreeItemCollapsibleState.Expanded,label:`Participants (${h.length})`});return Promise.resolve(m)}getChildrenItems(h){return v(this,void 0,void 0,(function*(){const h=[];if(!this.sessionContext.collaboratorManager)return h;let m=0;const y=this.getApprovedParticipants();for(let v of y){const{sessionId:y,participant:C}=v;h.push(yield this.getParticipantRow(m++,y,C))}const v=this.contactManager.invitedContacts;return h.push(...v.map(h=>new ParticipantSessionExplorerItem({sessionId:void 0,contactId:h.id,type:U.InvitedContact,label:`${h.contact.displayName} (${getLocalizeInviteStatus(h.inviteStatus)})`,iconPath:A.TreeDataProviderBase.getThemeIconPath("loading")}))),0===h.length?this.getDefaultParticipantsActions():h}))}getDefaultParticipantsActions(){return[new P.TreeViewItem({type:x.ViewItem.Other,collapsibleState:C.TreeItemCollapsibleState.None,label:"Invite participants...",command:{title:"Invite participants...",command:this.isSessionExplorer?"liveshare.collaboration.link.copyFromFileTreeExplorer":"liveshare.collaboration.link.copyFromActivityBar"}})]}getApprovedParticipants(){const h=[],m=this.sessionContext.collaboratorManager.getCollaborators(),y=this.sessionContext.collaboratorManager.getCollaboratorSessionIds();for(let v of y){const y=m[v],C=v;!y||C===this.sessionContext.coeditingClient.clientID||y.isHost&&y.isOnlineUser||h.push({sessionId:C,participant:y})}return h}getParticipantRow(h,m,y){return v(this,void 0,void 0,(function*(){const v=y.name||y.userName||y.email,{positionTracker:C}=this.sessionContext.coeditingClient,w=C.getClientPosition(m),A=(null==w?void 0:w.documentPosition)||(null==w?void 0:w.notebookPosition);let P="",k="";if(A&&A.fileName){const h=A.range;let m="";m=B.has(A.documentUri.scheme)?B.get(A.documentUri.scheme)(h):h&&h.start?`:${h.start.line+1}`:"",P=`   ${T.basename(A.documentUri.path)}${m}`,k=`  ${A.documentUri.path}${m}`}const{coeditingClient:R}=this.sessionContext,M=R.getUsersBeingFollowed()[m],D=yield O.getIconPathForUser(h,m,M),I=yield this.getUserTreeItemType(m),x=I||"",L=x.startsWith(U.FollowedGuest)||x.startsWith(U.FollowedParticipant),W=L?"Unfollow Participant":"Follow Participant",q=`${L?"liveshare.unfollow":"liveshare.follow"}${this.isSessionExplorer?"FromFileTreeExplorer":"FromActivityBar"}`;let Y=yield N.ExtensionUtil.getAnonymousReadOnlyLabel(this.clientAccessCheck(),y,m),V="";const $=R.getUsersFollowingYou().get(m);return M&&$?P="  following each other":M?P="   following":$&&(P="  following you"),V=Y,Y="",new ParticipantSessionExplorerItem({sessionId:m,participantId:y.id,type:I,label:`${v}${Y} ${P}`,tooltip:`${v}${Y} ${k}`,description:V,iconPath:D,command:{title:W,command:q,arguments:[{sessionId:m}]}})}))}isReadWriteAnonymousEnabled(){var h;return null===(h=I.getExpService())||void 0===h?void 0:h.getTreatmentVariable("vscode","readWriteAnonymous")}getUserTreeItemType(h){return v(this,void 0,void 0,(function*(){const{coeditingClient:m}=this.sessionContext,{workspaceSessionInfo:y}=k.workspaceSessionInfoTracker,{sessions:v}=y,C=m.getUsersBeingFollowed()[h],T=v[h],w=yield this.clientAccessCheck().isClientExplicitlyReadWrite(h);if(T.isAnonymous){const m=k.workspaceSessionInfoTracker.getAnonymousAccess(T.id),y=this.isReadWriteAnonymousEnabled()&&m===L.readWrite;return this.getUserTreeItemTypeAnonymous(h,y)}if(C){const h=w?U.FollowedGuestElevated:U.FollowedGuest;return m.isHost?h:U.FollowedParticipant}const A=w?U.GuestElevated:U.Guest;return m.isHost?A:U.Participant}))}getUserTreeItemTypeAnonymous(h,m){const{coeditingClient:y}=this.sessionContext;if(y.getUsersBeingFollowed()[h]){const h=m?U.FollowedGuestElevatedAnonymous:U.FollowedGuestAnonymous;return y.isHost?h:U.FollowedParticipant}const v=m?U.GuestElevatedAnonymous:U.GuestAnonymous;return y.isHost?v:U.Participant}}m.ParticipantsTreeDataProvider=ParticipantsTreeDataProvider},function(h,m,y){"use strict";var v=this&&this.__awaiter||function(h,m,y,v){return new(y||(y=Promise))((function(C,T){function fulfilled(h){try{step(v.next(h))}catch(h){T(h)}}function rejected(h){try{step(v.throw(h))}catch(h){T(h)}}function step(h){h.done?C(h.value):function adopt(h){return h instanceof y?h:new y((function(m){m(h)}))}(h.value).then(fulfilled,rejected)}step((v=v.apply(h,m||[])).next())}))};Object.defineProperty(m,"__esModule",{value:!0});const C=y(0),T=y(1100).version;function getApi(h){return v(this,void 0,void 0,(function*(){const y=C.extensions.getExtension(m.extensionId);if(!y)return null;const v=y.isActive?y.exports:yield y.activate();return v?v.getApi?v.getApi(T,h):v.getApiAsync(T):null}))}m.extensionId="ms-vsliveshare.vsliveshare",m.getApi=getApi,m.getApiAsync=function getApiAsync(){return getApi()},function(h){h.AllowGuestDebugControl="allowGuestDebugControl",h.AllowGuestTaskControl="allowGuestTaskControl",h.AutoShareServers="autoShareServers",h.AnonymousGuestApproval="anonymousGuestApproval",h.ConnectionMode="connectionMode",h.AllowedDomains="allowedDomains",h.AllowReadWriteTerminals="allowReadWriteTerminals"}(m.PolicySetting||(m.PolicySetting={})),function(h){h[h.None=0]="None",h[h.Host=1]="Host",h[h.Guest=2]="Guest"}(m.Role||(m.Role={})),function(h){h[h.None=0]="None",h[h.ReadOnly=1]="ReadOnly",h[h.ReadWrite=3]="ReadWrite",h[h.Owner=255]="Owner"}(m.Access||(m.Access={})),function(h){h.Session="liveshare.session",h.ExplorerSession="liveshare.session.explorer",h.PlannedSessions="liveshare.plannedSessions",h.Contacts="liveshare.contacts",h.Help="liveshare.help"}(m.View||(m.View={})),function(h){h.Participants="participants",h.Servers="servers",h.Terminals="terminals",h.Comments="comments",h.Chat="chat",h.CurrentUser="participants.currentuser",h.Guest="participants.guest",h.FollowedGuest="participants.guest.followed",h.Participant="participants.participant",h.FollowedParticipant="participants.participant.followed",h.GuestAnonymous="participants.guest.anonymous",h.FollowedGuestAnonymous="participants.guest.followed.anonymous",h.GuestElevated="participants.guest.elevated",h.FollowedGuestElevated="participants.guest.followed.elevated",h.GuestElevatedAnonymous="participants.guest.elevated.anonymous",h.FollowedGuestElevatedAnonymous="participants.guest.followed.elevated.anonymous",h.LocalServer="servers.local",h.RemoteServer="servers.remote",h.LocalTerminalReadOnly="terminals.local.readonly",h.LocalTerminalReadWrite="terminals.local.readwrite",h.RemoteTerminal="terminals.remote",h.SuggestedContacts="contacts.suggested",h.AvailableContacts="contacts.available",h.ContactsProvider="contacts.provider",h.SelfContact="contacts.selfContact",h.Contact="contacts.contact",h.ContactInvited="contacts.contact.invited",h.ContactOffline="contacts.contact.offline",h.RecentContact="contacts.recentContact",h.RecentContactOffline="contacts.recentContact.offline",h.RecentContactInvited="contacts.recentContact.invited",h.NoContact="contacts.noContact",h.RecentContacts="contacts.RecentContacts",h.NoSuggestedContacts="contacts.NoSuggestedUsers",h.NoRecentContacts="contacts.NoRecentContacts",h.InvitedContact="contacts.invited",h.SessionFeedbackQuestion="help.sessionFeedback",h.ReportAProblem="help.reportAProblem",h.TweetUsYourFeedback="help.tweetUsYourFeedback",h.Survey="help.survey",h.GoodFeedback="help.goodFeedback",h.BadFeedback="help.badFeedback",h.DontAskAgain="help.dontAskAgain",h.Thankyou="help.thankyou",h.MoreInfo="help.moreinfo",h.ConfigureSettings="help.configureSettings",h.Loading="loading",h.Other="other"}(m.ViewItem||(m.ViewItem={}));class ActivityType{}m.ActivityType=ActivityType,ActivityType.session="session",ActivityType.workspace="workspace",ActivityType.debug="debug",ActivityType.terminal="terminal"},function(h){h.exports=JSON.parse('{"name":"vsls","displayName":"VS Live Share extension API","description":"Enables VS Code extensions to access Live Share capabilities.","version":"0.0.0-placeholder","publisher":"ms-vsliveshare","main":"vscode.js","preview":true,"license":"SEE LICENSE IN LICENSE.txt","homepage":"https://aka.ms/vsls","bugs":{"url":"https://aka.ms/vsls-issues","email":"vsls-feedback@microsoft.com"},"author":{"name":"Microsoft"},"keywords":["Live Share"],"categories":["Other"],"repository":{"url":"https://github.com/MicrosoftDocs/live-share"},"dependencies":{"@microsoft/servicehub-framework":"^2.6.74"}}')},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0});const v=y(5),C=y(7),T=y(1102),w=y(5),A=y(5),renderCircleIcon=(h,m=!1)=>`\n        <svg xmlns="http://www.w3.org/2000/svg">\n            \x3c!--\n                SVG inside SVG is because VSCode ignores the width / height on the root\n                element. So nesting it lets us use the width/height to scale it. The\n                x/y are to reposition it to be centered.\n            --\x3e\n            <svg width="16px" height="16px" viewBox="0 0 16 16" version="1.1">\n                <circle id="filled" fill="${h}" fill-rule="nonzero" cx="8" cy="8" r="${m?6:0}"></circle>\n                <path d="M8,14 C4.6862915,14 2,11.3137085 2,8 C2,4.6862915 4.6862915,2 8,2 C11.3137085,2 14,4.6862915 14,8 C14,11.3137085 11.3137085,14 8,14 Z M8,12 C10.209139,12 12,10.209139 12,8 C12,5.790861 10.209139,4 8,4 C5.790861,4 4,5.790861 4,8 C4,10.209139 5.790861,12 8,12 Z" id="stroke" fill="${h}" fill-rule="nonzero"></path>\n            </svg>\n        </svg>\n    `;const P=new class IconsProvider{constructor(){this.trace=A.traceSource.withName("IconsProvider"),this.icons={},this.createIconBundle=async h=>{const m=h.replace(/\,|\.|\(|\)|\s/gim,"_");this.iconsRoot||(this.iconsRoot=w.getExtensionUri("images").fsPath);const y=C.join(this.iconsRoot,`./user-icon-${m}-icon.svg`),T=C.join(this.iconsRoot,`./user-icon-${m}-filled-icon.svg`);return await v.fileAccess.existsAsync(y)&&await v.fileAccess.existsAsync(T)||(await v.fileAccess.writeFileAsync(y,renderCircleIcon(h,!1)),await v.fileAccess.writeFileAsync(T,renderCircleIcon(h,!0))),{normal:y,filled:T}}}async getIcon(h){const m=this.icons[h];if(m)return m;try{this.icons[h]=await this.createIconBundle(h)}catch(h){return this.trace.error("Creating icon bundle failed",h),null}return this.icons[h]}async getIconByUserId(h){const m=T.SharedColors.requestColor(h),{backgroundColor:y}=m,v=`rgb(${parseInt(`${255*y.red}`,10)}, ${parseInt(`${255*y.green}`,10)}, ${parseInt(`${255*y.blue}`,10)})`;return await this.getIcon(v)}};m.getIconPathForUser=async function getIconPathForUser(h,m,y){const v=await P.getIconByUserId(m);let C;if(v){const h=y?v.filled:v.normal;C={dark:h,light:h}}return C}},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0});const v=y(0),C=y(414),T=y(1103);var w;!function(h){h.Never="Never",h.Activity="Activity",h.Always="Always"}(w=m.NameTagVisibility||(m.NameTagVisibility={}));class TextEditorDecoratorBase{constructor(h){this.color=h,this.backgroundCssColor=DecoratorUtils.toCssColor(this.color.backgroundColor),this.textCssColor=DecoratorUtils.toCssColor(this.color.textColor)}dispose(){this.decoration&&this.decoration.dispose()}render(h,m,y,v){this.decoration&&(this.decoration.dispose(),this.decoration=void 0),h&&h.length&&m&&y&&(this._createDecorationStyle(m,y,v),this._renderCore(h,m,y))}}m.TextEditorDecoratorBase=TextEditorDecoratorBase;class CursorDecorator extends TextEditorDecoratorBase{constructor(h,m){super(h),this.displayName=m}_renderCore(h,m,y){if(!this.decoration)return;const C={range:new v.Range(m,m)};y.isEmpty&&(C.hoverMessage=this.displayName),h.forEach(h=>{h.setDecorations(this.decoration,[C])})}_createDecorationStyle(h,m){const y=0===h.character?"0.17":"0.25",C={position:"absolute",display:"inline-block",top:"0","font-size":"200%","font-weight":"bold","z-index":1},T=DecoratorUtils.stringifyCssProperties(C),w={rangeBehavior:v.DecorationRangeBehavior.ClosedClosed,before:{contentText:"",margin:`0px 0px 0px -${y}ch`,color:this.backgroundCssColor,textDecoration:`none; ${T}`}};this.decoration=v.window.createTextEditorDecorationType(w)}}m.CursorDecorator=CursorDecorator;class NameTagDecorator extends TextEditorDecoratorBase{constructor(h,m){super(h),this.displayName=m}updateDisplayName(h){this.displayName=h}_renderCore(h,m,y){if(!this.decoration)return;const C=new v.Range(m,m);h.forEach(h=>{h.setDecorations(this.decoration,[C])})}_createDecorationStyle(h,m,y){let C=!0;(0===h.line||m&&!m.isEmpty&&!m.isSingleLine&&m.end.isEqual(h))&&(C=!(!y||0!==h.line||1!==y));const T={position:"absolute",top:`${C?-1:1}rem`,"border-radius":"0.15rem",padding:"0px 0.5ch",display:"inline-block","pointer-events":"none",color:this.textCssColor,"font-size":"0.7rem","z-index":1,"font-weight":"bold"},w=DecoratorUtils.stringifyCssProperties(T),A={backgroundColor:this.backgroundCssColor,rangeBehavior:v.DecorationRangeBehavior.ClosedClosed,textDecoration:"none; position: relative; z-index: 1;",after:{contentText:this.displayName,backgroundColor:this.backgroundCssColor,textDecoration:`none; ${w}`}};this.decoration=v.window.createTextEditorDecorationType(A)}}m.NameTagDecorator=NameTagDecorator;class RulerDecorator extends TextEditorDecoratorBase{constructor(h){super(h.withBackgroundAlpha(.6))}_renderCore(h,m,y){if(!this.decoration)return;const C=new v.Range(m,m);h.forEach(h=>{h.setDecorations(this.decoration,[C])})}_createDecorationStyle(h,m){this.decoration=v.window.createTextEditorDecorationType({overviewRulerLane:v.OverviewRulerLane.Full,overviewRulerColor:this.backgroundCssColor})}}m.RulerDecorator=RulerDecorator;class SelectionDecorator extends TextEditorDecoratorBase{constructor(h,m){super(h.withBackgroundAlpha(.35)),this.displayName=m}_renderCore(h,m,y){if(y.isEmpty)return;const v={range:y,hoverMessage:this.displayName};h.forEach(h=>{h.setDecorations(this.decoration,[v])})}_createDecorationStyle(h,m){this.decoration=v.window.createTextEditorDecorationType({backgroundColor:this.backgroundCssColor,borderRadius:"0.1rem"})}}m.SelectionDecorator=SelectionDecorator;m.ClientDecoratorManager=class ClientDecoratorManager{constructor(h,m,y,v){this.clientId=h,this.clientDisplayName=m,this.clientColor=SharedColors.requestColor(h),this.nameTagVisibility=y,this.positionTracker=v,this.selectionDecorator=new SelectionDecorator(this.clientColor,this.clientDisplayName),this.cursorDecorator=new CursorDecorator(this.clientColor,this.clientDisplayName),this.nameTagDecorator=new NameTagDecorator(this.clientColor,this.clientDisplayName),this.rulerDecorator=new RulerDecorator(this.clientColor)}dispose(){this.nameTagVisibilityTimer&&clearTimeout(this.nameTagVisibilityTimer),this.disposeDecorators()}updateNameTag(h){this.nameTagDecorator.updateDisplayName(h)}updateDecorators(){var h;const m=this.positionTracker.getClientPosition(this.clientId),y=[],C=(null==m?void 0:m.documentPosition)||(null==m?void 0:m.notebookPosition);let A;if(C){v.window.visibleTextEditors.forEach(h=>{h.document.uri.toString()===C.documentUri.toString()&&(h.document.uri.scheme.startsWith(T.PathManager.notebookCellScheme)&&(A=h.document.lineCount),y.push(h))});try{v.window.visibleNotebookEditors.forEach(h=>{h.document.uri.toString()===C.documentUri.toString()&&y.push(h)})}catch(h){}}if(!y.length)return void this.disposeDecorators();const P=C.range,k=(null===(h=m.documentPosition)||void 0===h?void 0:h.isReversed)?P.start:P.end;switch(this.selectionDecorator.render(y,k,P),this.rulerDecorator.render(y,k,P),this.nameTagVisibility){case w.Always:this.cursorDecorator.render(y,k,P),this.nameTagDecorator.render(y,k,P,A);break;case w.Never:this.cursorDecorator.render(y,k,P),this.nameTagDecorator&&this.nameTagDecorator.dispose();break;case w.Activity:default:this.nameTagVisibilityTimer&&clearTimeout(this.nameTagVisibilityTimer),this.cursorDecorator.render(y,k,P),this.nameTagDecorator.render(y,k,P,A),this.nameTagVisibilityTimer=setTimeout(()=>{this.nameTagDecorator.dispose()},1500)}}disposeDecorators(){this.selectionDecorator.dispose(),this.cursorDecorator.dispose(),this.nameTagDecorator.dispose(),this.rulerDecorator.dispose()}};class DecoratorColor{constructor(h,m){this.backgroundColor=h,this.textColor=m}withBackgroundAlpha(h){h=Math.max(0,h),h=Math.min(1,h);const m=new v.Color(this.backgroundColor.red,this.backgroundColor.green,this.backgroundColor.blue,h);return new DecoratorColor(m,this.textColor)}}class SharedColors{static requestColor(h){return SharedColors._initcolors(),SharedColors.allColors[h%SharedColors.allColors.length]}static _initcolors(){if(SharedColors.allColors)return;const h=[["rgba(0, 0, 0, 1)","rgba(255, 185, 0, 1)"],["rgba(255, 255, 255, 1)","rgba(16, 124, 16, 1)"],["rgba(255, 255, 255, 1)","rgba(180, 0, 158, 1)"],["rgba(0, 0, 0, 1)","rgba(186, 216, 10, 1)"],["rgba(0, 0, 0, 1)","rgba(255, 140, 0, 1)"],["rgba(255, 255, 255, 1)","rgba(227, 0, 140, 1)"],["rgba(255, 255, 255, 1)","rgba(92, 45, 145, 1)"],["rgba(0, 0, 0, 1)","rgba(0, 178, 148, 1)"],["rgba(0, 0, 0, 1)","rgba(255, 241, 0, 1)"],["rgba(0, 0, 0, 1)","rgba(180, 160, 255, 1)"]],m=v.workspace.getConfiguration("workbench.colorCustomizations");let y=m&&m["cascade.cursorForegroundBackgroundColors"];y&&Array.isArray(y)&&(SharedColors.allColors=SharedColors.parseColors(y)),SharedColors.allColors&&SharedColors.allColors.length||(SharedColors.allColors=SharedColors.parseColors(h))}static parseColors(h){return h.map(h=>{if(h&&2===h.length){const m=DecoratorUtils.toVSCodeColor(h[0]),y=DecoratorUtils.toVSCodeColor(h[1]);if(m&&y)return new DecoratorColor(y,m)}}).filter(h=>!!h).reverse()}}m.SharedColors=SharedColors;class DecoratorUtils{static stringifyCssProperties(h){return Object.keys(h).map(m=>`${m}: ${h[m]};`).join(" ")}static toCssColor(h){return`rgba(${Math.round(255*h.red)}, ${Math.round(255*h.green)}, ${Math.round(255*h.blue)}, ${h.alpha})`}static toVSCodeColor(h){const m=C.get.rgb(h);if(m){const[h,y,C,T]=m;return new v.Color(h/255,y/255,C/255,T)}return null}static isSamePosition(h,m){return null!==h&&null!==m&&h.isEqual(m)}static isSameRange(h,m){return null!==h&&null!==m&&h.isEqual(m)}}m.DecoratorUtils=DecoratorUtils},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0});const v=y(7),C=y(35),T=y(0),w=y(4),A=y(398),P=y(1104),k=y(260),R=y(1105),M=y(92),N=y(461),D=y(1108);class PathManager{constructor(h,m){this.forcePrefixedRoot=h,this.fileService=m,this.localPathsToVslsPaths=new Map,this.vslsPathsToLocalPaths=new Map,this.scheme=`${M.Settings.scheme}:`}async init(){this.fileService().onExternalFilesChanged(h=>{h.changeType===w.vsls.CollectionChangeType.Add&&this.registerExternalFilesAsync(h.localPaths,h.vslsPaths)})}async registerExternalFilesAsync(h,m){if(null!=h)for(let y=0;y<h.length;++y){let v=A.PathUtil.normalizePath(h[y]),C=A.PathUtil.normalizePath(m[y]);this.localPathsToVslsPaths.set(v,C),this.vslsPathsToLocalPaths.set(C,v)}}code2ProtocolUriConverter(h){if(!h)return;if("http"===h.scheme.toLowerCase()||"https"===h.scheme.toLowerCase()||"command"===h.scheme.toLowerCase())return h.toString();const m=this.code2protocolWorkspaceFilesOnly(h);if(null!==m)return m.toString();let y=h.toString();if(this.localPathsToVslsPaths.has(y))return`${PathManager.rawScheme}:${this.localPathsToVslsPaths.get(y)}`;let w=v.basename(h.fsPath),A=C(),P=T.Uri.parse(`${M.Settings.scheme}:${PathManager.externalPrefix}/${A}/${w}`).toString().toLowerCase();return this.fileService().registerNamedExternalFilesAsync([y],[A]),P}code2protocolWorkspaceFilesOnly(h){let m=T.workspace.getWorkspaceFolder(h);if(!m)return null;const y=T.workspace.asRelativePath(h,!1),v=A.PathUtil.convertToForwardSlashes(y);let C="";return(m.index>0||this.forcePrefixedRoot)&&(C=`~${m.index}/`),T.Uri.parse(`${this.scheme}/${C}${v}`)}protocol2CodeUriConverter(h){if(h)return this.protocolUri2CodeUriConverter(T.Uri.parse(h))}isExternalVslsPath(h){return h.startsWith(PathManager.externalPrefix)&&h.length>PathManager.externalPrefix.length+1}protocolUri2CodeUriConverter(h){const m=T.workspace.workspaceFolders?T.workspace.workspaceFolders[0]:null,y=h.scheme.toLowerCase(),C=h.path.startsWith(PathManager.notebookCellPrefix);if(y===PathManager.rawScheme&&m&&m.uri.scheme===PathManager.rawScheme||"http"===y||"https"===y)return h.path.startsWith(PathManager.gitPrefix)?this.LiveShareSourceControlUriFromRelativeGitUri(h):C?this.NotebookCellUriFromRelativeNotebookCellUri(h):h;if(y!==PathManager.rawScheme)throw new Error("Unknown path format from the client");if(h.path.startsWith(PathManager.untitledPrefix))return T.Uri.parse(`${PathManager.untitledScheme}:${v.basename(h.path)}`);if(h.path.startsWith(PathManager.gitPrefix))return this.GitUriFromRelativeGitUri(h);if(C)return this.NotebookCellUriFromRelativeNotebookCellUri(h);if((R.sessionStateTracker.State===k.SessionState.Shared||R.sessionStateTracker.State===k.SessionState.SharingInProgress)&&this.isExternalVslsPath(h.path)){let m=h.path,y=this.vslsPathsToLocalPaths.get(m);if(y)return T.Uri.parse(y)}if(!m)return h;let{moniker:w,relativePath:P}=A.PathUtil.getMonikerFromUri(h),M=parseInt(w,10);if(void 0===T.Uri.joinPath){let y=m.uri.fsPath;if(""!==w){const m=T.workspace.workspaceFolders[M];if(!m)return h;y=m.uri.fsPath}return(y.endsWith("/")||y.endsWith("\\"))&&(y=y.substr(0,y.length-1)),(P.startsWith("/")||P.startsWith("\\"))&&(P=P.substring(1)),T.Uri.file(v.join(y,P))}let N=m.uri;if(""!==w){const m=T.workspace.workspaceFolders[M];if(!m)return h;N=m.uri}return N.path.length>1&&(N.path.endsWith("/")||N.path.endsWith("\\"))&&(N=N.with({path:N.path.substring(0,N.path.length-1)})),T.Uri.joinPath(N,P)}relativePathToLocalPath(h){if(!h)return null;if(h.startsWith(this.scheme)||h.startsWith("file:"))throw new Error("Supplied path is not a relative path");let m=null;return m=h.startsWith("/")?`${this.scheme}${h}`:`${this.scheme}/${h}`,this.protocol2CodeUriConverter(m)}localPathToRelativePath(h){if(!h||h.scheme===PathManager.outputScheme)return null;if(h.scheme===PathManager.rawScheme)return h.path;if(h.scheme!==PathManager.gitScheme&&h.scheme!==PathManager.vslsSccScheme&&h.scheme!==PathManager.notebookCellScheme){if(!!!T.workspace.getWorkspaceFolder(h)){if(R.sessionStateTracker.State===k.SessionState.Shared||R.sessionStateTracker.State===k.SessionState.SharingInProgress){if(h.scheme===PathManager.untitledScheme){let m=this.localPathsToVslsPaths.get(h.fsPath);if(!m){let y=C().replace(/-/g,"");const v=T.workspace.asRelativePath(h,!1);return m=`${PathManager.untitledPrefix}/${y}/${v}`,this.localPathsToVslsPaths.set(h.fsPath,m),this.vslsPathsToLocalPaths.set(m,h.fsPath),m}return m}let m=A.PathUtil.normalizePath(h.toString()),y=this.localPathsToVslsPaths.get(m);if(y)return y}return null}}if(h.scheme===PathManager.gitScheme){let m=T.workspace.asRelativePath(h.fsPath,!1);return this.RelativeGitUriFromGitUri(h,m)}if(h.scheme===PathManager.vslsSccScheme)return this.RelativeGitUriFromLiveShareSourceControlUri(h);if(h.scheme===PathManager.notebookCellScheme)return this.RelativeNotebookCellPathFromLocalNotebookCellUri(h);const m=this.code2protocolWorkspaceFilesOnly(h);return null==m?void 0:m.path}getFromVslsPathsToLocalPaths(h){return this.vslsPathsToLocalPaths.get(h)}deleteFromVslsPathsToLocalPaths(h){return this.vslsPathsToLocalPaths.delete(h)}getFromLocalPathsToVslsPaths(h){return this.localPathsToVslsPaths.get(h)}deleteFromLocalPathsToVslsPaths(h){return this.localPathsToVslsPaths.delete(h)}LiveShareSourceControlUriFromRelativeGitUri(h){const m=this.GetRelativeGitUriDetails(h.path);if(m){let h=m.ref,y=m.hostPath;y.startsWith("/")&&(y=y.slice(1,y.length));let v=T.Uri.file(y),C=m.guestPath,w={path:v.fsPath,version:JSON.stringify({ref:h}),sccId:1,groupId:"workingTree",resourceUri:C};const A=`vsls-scc:${v.fsPath}?${JSON.stringify(w)}`;return T.Uri.parse(A)}return null}resourceUriFromLiveShareSourceControlUri(h){let m=JSON.parse(h.query).resourceUri;return T.Uri.parse(m)}RelativeGitUriFromLiveShareSourceControlUri(h){let m=JSON.parse(h.query),y=void 0,v=null==m?void 0:m.version;if(v){let h=JSON.parse(v);y=null==h?void 0:h.ref}y||(y="~");let C=A.PathUtil.convertToForwardSlashes(h.path);return C.startsWith("/")&&(C=C.slice(1,C.length)),`${PathManager.gitPrefix}/${y}/${C}::${m.resourceUri}`}RelativeGitUriFromGitUri(h,m){let y=JSON.parse(h.query);return`${PathManager.gitPrefix}/${y.ref}${h.path}::${this.scheme}/${m}`}GitUriFromRelativeGitUri(h){const m=this.GetRelativeGitUriDetails(h.path);if(m){let h={path:T.Uri.file(m.hostPath).fsPath,ref:m.ref};return T.Uri.parse(`${PathManager.gitScheme}:/${m.hostPath}?${JSON.stringify(h)}`)}return null}GetRelativeGitUriDetails(h){if(h.startsWith("/~git/")){let m=h.substr("/~git/".length,h.length-"/~git/".length),y=m.indexOf("/"),v=m.substr(0,y),C=m.substr(y+1,m.length-y).split("::");if(2===C.length)return{ref:v,hostPath:C[0],guestPath:C[1]}}return null}RelativeNotebookCellPathFromLocalNotebookCellUri(h){var m;const y=null===(m=T.workspace.notebookDocuments)||void 0===m?void 0:m.find(m=>m.uri.path===h.path);if(!y)return null;const v=this.localPathToRelativePath(y.uri),C=y.notebookType.startsWith(N.NotebookConstants.mirrorNotebookTypePrefix)?y.notebookType.substring(N.NotebookConstants.mirrorNotebookTypePrefix.length):y.notebookType,w=D.findNotebookCell(h);if(!w)return null;const A=D.getCellId(w);return A?`${PathManager.notebookCellPrefix}${v}?${C}#${A}`:null}getLocalNotebookUriFromRelativeNotebookCellUri(h){const m=h.path.substring(PathManager.notebookCellPrefix.length);return this.relativePathToLocalPath(m)}NotebookCellUriFromRelativeNotebookCellUri(h){var m,y;const v=this.getLocalNotebookUriFromRelativeNotebookCellUri(h);return null===(y=null===(m=D.findNotebookCellById(v,h.fragment))||void 0===m?void 0:m.document)||void 0===y?void 0:y.uri}async openNotebookCellDocument(h,m=!1){const y=T.Uri.parse(h),v=this.getLocalNotebookUriFromRelativeNotebookCellUri(y);if(await T.workspace.openNotebookDocument(v))return this.openRelativePath(h,m,!1);throw new Error(`Could not open notebook ${h}`)}async openRelativePath(h,m=!1,y=!0){const v=this.relativePathToLocalPath(h);if(v){if(v.scheme===PathManager.notebookCellScheme){const h=D.findNotebookCell(v),y=null==h?void 0:h.document;return m&&h&&await T.window.showNotebookDocument(null==h?void 0:h.notebook),P.assert(null!==y,"Notebook cell document should be non-null"),y}const h=await T.workspace.openTextDocument(v);return m&&await T.window.showTextDocument(h),h}if(h.startsWith(PathManager.notebookCellPrefix)&&y)return this.openNotebookCellDocument(h,m);throw new Error(`Could not open relative path ${h}`)}async dispose(){this.localPathsToVslsPaths.clear(),this.vslsPathsToLocalPaths.clear()}}m.PathManager=PathManager,PathManager.outputScheme="output",PathManager.githubDevScheme="vscode-vfs",PathManager.fileScheme="file",PathManager.gitScheme="git",PathManager.vslsSccScheme="vsls-scc",PathManager.externalPrefix="/~external",PathManager.untitledPrefix="/~untitled",PathManager.gitPrefix="/~git",PathManager.untitledScheme="untitled",PathManager.notebookCellScheme="vscode-notebook-cell",PathManager.notebookCellPrefix="/~notebook",PathManager.rawScheme=M.Settings.scheme,m.VSLS_SCHEME=PathManager.rawScheme,m.FILE_SCHEME=PathManager.fileScheme,m.GITHUB_DEV_SCHEME=PathManager.githubDevScheme,m.KNOWN_SCHEMES=["http","https",m.VSLS_SCHEME]},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0});const v=y(5),C=y(397),T=y(399),w=y(460);m.assert=function assert(h,m,y){h||(C.checkDebugging(),v.traceSource.withName("Asserts").error(`Assertion Violation: ${m}`),w.ExtensionTelemetry.ReportFailedAssertion(y||m),T.showDiagnosticErrorMessage(`Assertion Violation: ${m}`))}},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0});const v=y(0),C=y(260),T=y(1106),w=y(460);m.sessionStateTracker=new class SessionStateTracker{constructor(){this.stateChangedEmitter=new v.EventEmitter,this.onStateChanged=this.stateChangedEmitter.event,this.statusChangedEmitter=new v.EventEmitter,this.onStatusChanged=this.statusChangedEmitter.event,this.currentState=C.SessionState.Initializing,this.currentHigherState=void 0}get State(){return this.currentState}get HigherState(){return this.currentHigherState}transitionHigherState(h,m){h===C.SessionState.SharingInProgress||h===C.SessionState.JoiningInProgress||h===C.SessionState.Shared||h===C.SessionState.Joined?this.currentHigherState=h:m!==C.SessionAction.SharingError&&m!==C.SessionAction.JoiningError&&m!==C.SessionAction.EndSharing&&m!==C.SessionAction.Unjoin||(this.currentHigherState=void 0)}transition(h){const m=T.sessionMachine[this.State];if(m){let y=m[h];return void 0!==y?("function"==typeof y&&(y=y()),this.transitionHigherState(y,h),this.sendTransitionTelemetry(y,h),this.setState(y,h),this.State):void 0}}sendTransitionTelemetry(h,m){w.ExtensionTelemetry.sendTransition(C.SessionState[this.State],C.SessionState[h],C.SessionAction[m])}setState(h,m){const y=this.currentState,v=this.currentAction;this.currentState=h,this.currentAction=m,this.stateChangedEmitter.fire({newState:h,oldState:y,newAction:m,oldAction:v})}setStatus(h){const m=this.currentStatus;this.currentStatus=h,this.statusChangedEmitter.fire({newStatus:h,oldStatus:m})}point(h){void 0!==h&&this.setStatus(h)}},m.setSessionStateTracker=function setSessionStateTracker(h){m.sessionStateTracker=h}},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0});const v=y(260),C=y(1107),sessionMachineIsAuthedCheck=()=>C.userAuthStateTracker.IsSignedIn?v.SessionState.SignedIn:v.SessionState.SignedOut;m.sessionMachine={[v.SessionState.Initializing]:{[v.SessionAction.AttemptSharing]:v.SessionState.SharingInProgress,[v.SessionAction.AttemptJoining]:v.SessionState.JoiningInProgress,[v.SessionAction.AttemptSignIn]:v.SessionState.SigningIn,[v.SessionAction.SignOut]:v.SessionState.SignedOut},[v.SessionState.ExternallySigningIn]:{[v.SessionAction.AwaitExternalSignIn]:v.SessionState.ExternallySigningIn,[v.SessionAction.AttemptSignIn]:v.SessionState.SigningIn,[v.SessionAction.SignInSuccess]:v.SessionState.SignedIn,[v.SessionAction.SignInError]:v.SessionState.SignedOut,[v.SessionAction.SignOut]:v.SessionState.SignedOut,[v.SessionAction.SharingError]:v.SessionState.SignedOut,[v.SessionAction.JoiningError]:v.SessionState.SignedOut},[v.SessionState.SigningIn]:{[v.SessionAction.AwaitExternalSignIn]:v.SessionState.ExternallySigningIn,[v.SessionAction.SignInSuccess]:v.SessionState.SignedIn,[v.SessionAction.SignInError]:v.SessionState.SignedOut,[v.SessionAction.SignOut]:v.SessionState.SignedOut,[v.SessionAction.SharingError]:v.SessionState.SignedOut,[v.SessionAction.JoiningError]:v.SessionState.SignedOut},[v.SessionState.SignedIn]:{[v.SessionAction.AttemptSharing]:v.SessionState.SharingInProgress,[v.SessionAction.AttemptJoining]:v.SessionState.JoiningInProgress,[v.SessionAction.SignOut]:v.SessionState.SignedOut},[v.SessionState.SignedOut]:{[v.SessionAction.AttemptSignIn]:v.SessionState.SigningIn,[v.SessionAction.AwaitExternalSignIn]:v.SessionState.ExternallySigningIn,[v.SessionAction.SignInSuccess]:v.SessionState.SignedIn,[v.SessionAction.AttemptSharing]:v.SessionState.SharingInProgress,[v.SessionAction.SharingError]:v.SessionState.SignedOut,[v.SessionAction.JoiningError]:v.SessionState.SignedOut},[v.SessionState.SharingInProgress]:{[v.SessionAction.SharingError]:sessionMachineIsAuthedCheck,[v.SessionAction.SharingSuccess]:v.SessionState.Shared,[v.SessionAction.SignOut]:v.SessionState.SignedOut,[v.SessionAction.AttemptSignIn]:v.SessionState.SigningIn,[v.SessionAction.AwaitExternalSignIn]:v.SessionState.ExternallySigningIn,[v.SessionAction.SignInSuccess]:v.SessionState.SignedIn},[v.SessionState.Shared]:{[v.SessionAction.EndSharing]:v.SessionState.SignedIn,[v.SessionAction.SignOut]:v.SessionState.SignedOut},[v.SessionState.JoiningInProgress]:{[v.SessionAction.JoiningError]:sessionMachineIsAuthedCheck,[v.SessionAction.JoiningPendingReload]:v.SessionState.SignedIn,[v.SessionAction.JoiningSuccess]:v.SessionState.Joined,[v.SessionAction.SignOut]:v.SessionState.SignedOut,[v.SessionAction.AttemptSharing]:v.SessionState.SharingInProgress},[v.SessionState.Joined]:{[v.SessionAction.Unjoin]:v.SessionState.SignedIn,[v.SessionAction.SignOut]:v.SessionState.SignedOut}}},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0});const v=y(0),C=y(2);m.userAuthStateTracker=new class UserAuthStateTracker{constructor(){this.userInfoChangedEmitter=new v.EventEmitter,this.onUserInfoChanged=this.userInfoChangedEmitter.event,this.isCustomAccount=!1,this.defaultAuthAttemptCompleteSignal=new C.Signal}get userInfo(){return this.vslsUserInfo}set userInfo(h){this.vslsUserInfo=h,this.userInfoChangedEmitter.fire()}isCurrentUserAnonymous(){return!(!this.userInfo||!this.userInfo.isAnonymous)}get IsSignedIn(){return!!this.userInfo}completeDefaultAuthAttempt(){this.defaultAuthAttemptCompleteSignal.resolve({})}}},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0});const v=y(0),C=y(461);function findNotebookCellWithCustomMetadata(h,m,y){var C;if(!v.workspace.notebookDocuments)return;const T=v.workspace.notebookDocuments.find(m=>m.uri.toString()===h.toString());return T?null===(C=T.getCells())||void 0===C?void 0:C.find(h=>h.metadata[m]===y):void 0}function getCellId(h){var m;if(null===(m=null==h?void 0:h.metadata)||void 0===m?void 0:m.hasOwnProperty(C.NotebookConstants.cellIdPropertyName))return h.metadata[C.NotebookConstants.cellIdPropertyName]}m.findNotebookCell=function findNotebookCell(h){var m;if(v.workspace.notebookDocuments)for(let y of v.workspace.notebookDocuments){const v=null===(m=y.getCells())||void 0===m?void 0:m.find(m=>m.document.uri.path===h.path&&m.document.uri.fragment===h.fragment);if(v)return v}},m.findNotebookCellWithCustomMetadata=findNotebookCellWithCustomMetadata,m.findNotebookCellById=function findNotebookCellById(h,m){return findNotebookCellWithCustomMetadata(h,C.NotebookConstants.cellIdPropertyName,m)},m.getNotebookCellData=function getNotebookCellData(h){let m=new v.NotebookCellData(h.kind,h.document.getText(),h.document.languageId);return m.metadata=h.metadata,m},m.getCellId=getCellId,m.sortCells=function sortCells(h){h.sort((h,m)=>h.index-m.index)},m.getNotebookHash=function getNotebookHash(h){return h.map(h=>getCellId(h)).join("")}},function(h,m,y){"use strict";var v=this&&this.__awaiter||function(h,m,y,v){return new(y||(y=Promise))((function(C,T){function fulfilled(h){try{step(v.next(h))}catch(h){T(h)}}function rejected(h){try{step(v.throw(h))}catch(h){T(h)}}function step(h){h.done?C(h.value):function adopt(h){return h instanceof y?h:new y((function(m){m(h)}))}(h.value).then(fulfilled,rejected)}step((v=v.apply(h,m||[])).next())}))};Object.defineProperty(m,"__esModule",{value:!0});const C=y(0),T=y(102),w=y(131),A=y(71),P=y(26),k=y(454),R=y(16);class TerminalSessionExplorerItem extends A.TreeViewItem{constructor(h){super(h),this.options=h,this.terminalId=h.terminalId}}var M;m.TerminalSessionExplorerItem=TerminalSessionExplorerItem,function(h){h.Terminals="terminals",h.LocalTerminalReadOnly="terminals.local.readonly",h.LocalTerminalReadWrite="terminals.local.readwrite",h.RemoteTerminal="terminals.remote",h.Other="other"}(M=m.TerminalsViewItem||(m.TerminalsViewItem={}));class TerminalsTreeDataProvider extends w.TreeDataProviderBase{constructor(h,m,y){super(M.Terminals,T.TreeDataProviderContext.SharedOrJoined),this.sessionContext=h,this.isSessionExplorer=m,this.trace=y}refreshItems(){super.refreshItems(),this.sharedTerminals=void 0}registerTerminalService(h){this.terminalService=h;const m=[];return m.push(h.onTerminalStarted(()=>this.forceRefreshItems())),m.push(h.onTerminalStopped(()=>this.forceRefreshItems())),m.push(h.onTerminalReadOnlyChanged(()=>this.forceRefreshItems())),C.Disposable.from(...m)}getRootItem(){return v(this,void 0,void 0,(function*(){return yield this.refreshSharedTerminals(),new A.TreeViewItem({type:M.Terminals,collapsibleState:C.TreeItemCollapsibleState.Expanded,label:`Shared Terminals (${this.sharedTerminals.length})`})}))}getChildrenItems(h){return v(this,void 0,void 0,(function*(){const h=[];if(!this.terminalService)return h;yield this.refreshSharedTerminals();for(const m of this.sharedTerminals)h.push(yield this.getTerminalRow(m,this.sessionContext.coeditingClient.isHost));return 0===h.length?this.getDefaultTerminalsActions():h}))}getDefaultTerminalsActions(){return this.sessionContext.coeditingClient.isHost?[new A.TreeViewItem({type:M.Other,collapsibleState:C.TreeItemCollapsibleState.None,label:"Share terminal...",command:{title:"Share terminal...",command:this.isSessionExplorer?"liveshare.fileTreeExplorer.shareTerminal":"liveshare.activityBar.shareTerminal"}})]:[new A.TreeViewItem({type:M.Other,collapsibleState:C.TreeItemCollapsibleState.None,label:"No terminals shared"})]}refreshSharedTerminals(){return v(this,void 0,void 0,(function*(){if(!this.sharedTerminals)try{this.sharedTerminals=yield this.terminalService.getRunningTerminalsAsync()}catch(h){h.code!==R.RpcErrorCodes.ServiceNotAvailable&&this.trace.error("Could not get running terminals",h),this.sharedTerminals=[]}}))}getTerminalRow(h,m){return v(this,void 0,void 0,(function*(){const y=h.options.readOnlyForGuests||P.workspaceSessionInfoTracker.isReadOnly,v=(h.options.name||"").replace(k.sharedTerminalName,"");return new TerminalSessionExplorerItem({label:`${v.trim()} (${y?"Read-only":"Read/write"})`,terminalId:h.id,type:m?h.options.readOnlyForGuests?M.LocalTerminalReadOnly:M.LocalTerminalReadWrite:M.RemoteTerminal,iconPath:w.TreeDataProviderBase.getThemeIconPath("terminal"),command:{title:"Focus terminal",command:this.isSessionExplorer?"liveshare.fileTreeExplorer.openTerminal":"liveshare.activityBar.openTerminal",arguments:[{terminalId:h.id}]}})}))}}m.TerminalsTreeDataProvider=TerminalsTreeDataProvider},function(h,m,y){"use strict";var v=this&&this.__awaiter||function(h,m,y,v){return new(y||(y=Promise))((function(C,T){function fulfilled(h){try{step(v.next(h))}catch(h){T(h)}}function rejected(h){try{step(v.throw(h))}catch(h){T(h)}}function step(h){h.done?C(h.value):function adopt(h){return h instanceof y?h:new y((function(m){m(h)}))}(h.value).then(fulfilled,rejected)}step((v=v.apply(h,m||[])).next())}))};Object.defineProperty(m,"__esModule",{value:!0});const C=y(0),T=y(102),w=y(131),A=y(71),P=y(16);class ServerSessionExplorerItem extends A.TreeViewItem{constructor(h){super(h),this.options=h,this.port=h.port}}var k;m.ServerSessionExplorerItem=ServerSessionExplorerItem,function(h){h.Servers="servers",h.LocalServer="servers.local",h.RemoteServer="servers.remote",h.Other="other"}(k=m.ServerSharingViewItem||(m.ServerSharingViewItem={}));class ServerSharingTreeDataProvider extends w.TreeDataProviderBase{constructor(h,m,y){super(k.Servers,T.TreeDataProviderContext.SharedOrJoined),this.sessionContext=h,this.isSessionExplorer=m,this.trace=y}registerServices(h,m){this.serverSharingService=h,this.portForwardingService=m;const y=[];return y.push(h.onSharingChanged(()=>this.forceRefreshItems())),y.push(h.onSharingStarted(()=>this.forceRefreshItems())),y.push(h.onSharingStopped(()=>this.forceRefreshItems())),y.push(m.onSharingChanged(()=>this.forceRefreshItems())),y.push(m.onSharingStarted(()=>this.forceRefreshItems())),y.push(m.onSharingStopped(()=>this.forceRefreshItems())),C.Disposable.from(...y)}refreshItems(){super.refreshItems(),this.sharedServers=void 0}getRootItem(){return v(this,void 0,void 0,(function*(){return yield this.refreshSharedServers(),new A.TreeViewItem({type:k.Servers,collapsibleState:C.TreeItemCollapsibleState.Expanded,label:`Shared Servers (${this.sharedServers.length})`})}))}getChildrenItems(h){return v(this,void 0,void 0,(function*(){const h=[];if(!this.serverSharingService)return h;yield this.refreshSharedServers();for(let m of this.sharedServers)h.push(yield this.getServerRow(m,this.sessionContext.coeditingClient.isHost));return 0===h.length?this.getDefaultServersActions():h}))}getDefaultServersActions(){return this.sessionContext.coeditingClient.isHost?[new A.TreeViewItem({type:k.Other,collapsibleState:C.TreeItemCollapsibleState.None,label:"Share server...",command:{title:"Share server...",command:this.isSessionExplorer?"liveshare.fileTreeExplorer.shareServer":"liveshare.activityBar.shareServer"}})]:[new A.TreeViewItem({type:k.Other,collapsibleState:C.TreeItemCollapsibleState.None,label:"No servers shared"})]}refreshSharedServers(){return v(this,void 0,void 0,(function*(){if(!this.sharedServers)try{this.sharedServers=this.sessionContext.coeditingClient.isHost?yield this.serverSharingService.getSharedServersAsync():yield this.portForwardingService.getSharedServersAsync()}catch(h){h.code!==P.RpcErrorCodes.ServiceNotAvailable&&this.trace.error("Could not get shared servers",h),this.sharedServers=[]}}))}getServerRow(h,m){return v(this,void 0,void 0,(function*(){const y=m?h.sourcePort:h.destinationPort;return new ServerSessionExplorerItem({port:y,type:m?k.LocalServer:k.RemoteServer,label:h.sessionName,iconPath:w.TreeDataProviderBase.getThemeIconPath("server"),tooltip:`${h.sessionName} (port ${y})`,command:{title:"Open Server in Browser",command:this.isSessionExplorer?"liveshare.fileTreeExplorer.openServerInBrowser":"liveshare.activityBar.openServerInBrowser",arguments:[{port:y}]}})}))}}m.ServerSharingTreeDataProvider=ServerSharingTreeDataProvider},function(h,m,y){"use strict";var v=this&&this.__awaiter||function(h,m,y,v){return new(y||(y=Promise))((function(C,T){function fulfilled(h){try{step(v.next(h))}catch(h){T(h)}}function rejected(h){try{step(v.throw(h))}catch(h){T(h)}}function step(h){h.done?C(h.value):function adopt(h){return h instanceof y?h:new y((function(m){m(h)}))}(h.value).then(fulfilled,rejected)}step((v=v.apply(h,m||[])).next())}))};Object.defineProperty(m,"__esModule",{value:!0});const C=y(0),T=y(159),w=y(261),A=y(71),P=y(8),k=y(24),R=y(178),M=y(22),N=y(23),D=y(17),I=y(12),x=y(14),O=y(64);var L;!function(h){h[h.Question=0]="Question",h[h.Survey=1]="Survey",h[h.ThankYou=2]="ThankYou",h[h.Default=3]="Default"}(L||(L={}));m.HelpViewletProvider=class HelpViewletProvider{constructor(){this.changeEventEmitter=new C.EventEmitter,this.onDidChangeTreeData=this.changeEventEmitter.event,this.state=L.Default,this.onStateChanged=h=>{h.newState!==M.SessionState.Shared&&h.newState!==M.SessionState.Joined||this.setState(L.Default),h.newState!==M.SessionState.SignedIn||h.oldState!==M.SessionState.Shared&&h.oldState!==M.SessionState.Joined||this.sessionEnd()},this.refresh=()=>this.changeEventEmitter.fire(void 0),this.getTreeItem=h=>h,N.sessionStateTracker.onStateChanged(this.onStateChanged),k.ExtensionUtil.registerCommand("liveshare.provideFeedback",this.provideFeedback,this),k.ExtensionUtil.registerCommand("liveshare.openLink",this.openLink),k.ExtensionUtil.registerCommand("liveshare.reportAProblem",this.reportAProblem),k.ExtensionUtil.registerCommand("liveshare.moreInfo",this.moreInfo),k.ExtensionUtil.registerCommand("liveshare.configureSettings",this.configureSettings)}sessionEnd(){return v(this,void 0,void 0,(function*(){(yield this.showSurvey())?this.setState(L.Survey):(yield I.Settings.get(x.SettingKeys.dontRequestFeedback))||this.getSessionNumber()%5!=0||this.setState(L.Question)}))}setState(h){this.state=h,this.refresh()}getChildren(h){return v(this,void 0,void 0,(function*(){return yield h?this.getElementChildren(h):this.getDefaultRootChildren()}))}getElementChildren(h){return v(this,void 0,void 0,(function*(){return yield this.getFeedbackChildren()}))}provideFeedback(h){return v(this,void 0,void 0,(function*(){const m=h.name;P.TelemetryEvent.create(D.TelemetryEventNames.FEEDBACK,{properties:{feedback:m}}).send(),m===O.ViewItem.DontAskAgain&&(yield I.Settings.save(x.SettingKeys.dontRequestFeedback,!0)),this.feedbackReceived()}))}feedbackReceived(){return v(this,void 0,void 0,(function*(){this.setState(L.ThankYou),T.setTimeout(()=>{this.setState(L.Default)},5e3)}))}openLink(h){return v(this,void 0,void 0,(function*(){P.TelemetryEvent.create(D.TelemetryEventNames.OPEN_LINK,{properties:{url:h}}).send(),k.ExtensionUtil.openBrowser(h)}))}reportAProblem(){return v(this,void 0,void 0,(function*(){k.ExtensionUtil.reportIssue()}))}moreInfo(){return v(this,void 0,void 0,(function*(){yield R.showWelcomePage(R.WelcomePageSource.Help)}))}configureSettings(){return v(this,void 0,void 0,(function*(){const{name:h,publisher:m}=k.ExtensionUtil.getPackage();yield C.commands.executeCommand("workbench.action.openSettings",`@ext:${m}.${h}`)}))}getFeedbackChildren(){return v(this,void 0,void 0,(function*(){let h=[];return this.state===L.Question?h=[new A.TreeViewItem({type:O.ViewItem.GoodFeedback,collapsibleState:C.TreeItemCollapsibleState.None,label:" It was great!",command:{title:"It was great!",command:"liveshare.provideFeedback",arguments:[{name:O.ViewItem.GoodFeedback}]}}),new A.TreeViewItem({type:O.ViewItem.BadFeedback,collapsibleState:C.TreeItemCollapsibleState.None,label:" Needs improvement",command:{title:"Needs improvement",command:"liveshare.provideFeedback",arguments:[{name:O.ViewItem.BadFeedback}]}}),new A.TreeViewItem({type:O.ViewItem.DontAskAgain,collapsibleState:C.TreeItemCollapsibleState.None,label:" Don't ask again",command:{title:"Don't ask again",command:"liveshare.provideFeedback",arguments:[{name:O.ViewItem.DontAskAgain}]}})]:this.state===L.ThankYou&&(h=[new A.TreeViewItem({type:O.ViewItem.Thankyou,collapsibleState:C.TreeItemCollapsibleState.None,label:"Thank you for your feedback!"})]),h}))}getSessionNumber(){return I.Settings.get(x.SettingKeys.sessionCount)+1}showSurvey(){return v(this,void 0,void 0,(function*(){const h=(yield I.Settings.get(x.SettingKeys.surveyShownDate))||0;return Date.now()-h>=7776e6&&Math.random()<=.01}))}saveSurveyShownDate(){return v(this,void 0,void 0,(function*(){const h=Date.now();yield I.Settings.save(x.SettingKeys.surveyShownDate,h)}))}showSurveyToast(){return v(this,void 0,void 0,(function*(){(yield C.window.showInformationMessage("We'd love to hear about your Live Share experience! Do you mind taking a quick feedback survey?",{title:"Take Survey"}))?k.ExtensionUtil.openBrowser("https://aka.ms/vsls-nps"):new P.TelemetryEvent(D.TelemetryEventNames.DISMISS_SURVEY).send()}))}getDefaultRootChildren(){return v(this,void 0,void 0,(function*(){let h=[];this.state===L.Survey?(this.showSurveyToast(),h.push(new A.TreeViewItem({type:O.ViewItem.Survey,collapsibleState:C.TreeItemCollapsibleState.None,label:"Take a feedback survey",command:{title:"Take a feedback survey",command:"liveshare.openLink",arguments:["https://aka.ms/vsls-nps"]},iconPath:{dark:k.ExtensionUtil.getExtensionUri("images/dark/survey-dark.svg"),light:k.ExtensionUtil.getExtensionUri("images/light/survey-light.svg")}})),this.saveSurveyShownDate()):this.state!==L.Question&&this.state!==L.ThankYou||h.push(new A.TreeViewItem({type:O.ViewItem.SessionFeedbackQuestion,collapsibleState:C.TreeItemCollapsibleState.Expanded,label:"How was your collaboration session?",iconPath:{dark:k.ExtensionUtil.getExtensionUri("images/dark/survey-dark.svg"),light:k.ExtensionUtil.getExtensionUri("images/light/survey-light.svg")}})),h.push(new A.TreeViewItem({type:O.ViewItem.TweetUsYourFeedback,collapsibleState:C.TreeItemCollapsibleState.None,label:"Tweet us your feedback",command:{title:"Tweet us your feedback",command:"liveshare.openLink",arguments:["https://aka.ms/vsls/TwitterFeedback"]},iconPath:{dark:k.ExtensionUtil.getExtensionUri("images/twitter.svg"),light:k.ExtensionUtil.getExtensionUri("images/twitter.svg")}})),h.push(new A.TreeViewItem({type:O.ViewItem.ReportAProblem,collapsibleState:C.TreeItemCollapsibleState.None,label:"Report a problem",command:{title:"Report a problem",command:"liveshare.reportAProblem"},iconPath:{dark:k.ExtensionUtil.getExtensionUri("images/dark/github-dark.svg"),light:k.ExtensionUtil.getExtensionUri("images/light/github-light.svg")}})),h.push(new A.TreeViewItem({type:O.ViewItem.ConfigureSettings,collapsibleState:C.TreeItemCollapsibleState.None,label:"Configure Settings",command:{title:"Configure Settings",command:"liveshare.configureSettings"},iconPath:{dark:k.ExtensionUtil.getExtensionUri("images/dark/settings.svg"),light:k.ExtensionUtil.getExtensionUri("images/light/settings.svg")}})),h.push(new A.TreeViewItem({type:O.ViewItem.MoreInfo,collapsibleState:C.TreeItemCollapsibleState.None,label:"More Info",command:{title:"More Info",command:"liveshare.moreInfo"},iconPath:{dark:k.ExtensionUtil.getExtensionUri("images/dark/info-dark.svg"),light:k.ExtensionUtil.getExtensionUri("images/light/info-light.svg")}}));const m=yield w.getLabelAndLinkTreeViewItems("HelpViewlet");return h.push(...m),h}))}}},function(h,m,y){"use strict";var v=this&&this.__awaiter||function(h,m,y,v){return new(y||(y=Promise))((function(C,T){function fulfilled(h){try{step(v.next(h))}catch(h){T(h)}}function rejected(h){try{step(v.throw(h))}catch(h){T(h)}}function step(h){h.done?C(h.value):function adopt(h){return h instanceof y?h:new y((function(m){m(h)}))}(h.value).then(fulfilled,rejected)}step((v=v.apply(h,m||[])).next())}))};Object.defineProperty(m,"__esModule",{value:!0});const C=y(0),T=y(64),w=y(102),A=y(261),P=y(71),k=y(25);m.CollabActionTreeDataProvider=class CollabActionTreeDataProvider{constructor(h){this.isInFileTreeExplorer=h}get supportedContext(){return w.TreeDataProviderContext.NotSharedOrJoined}getTreeItem(h){return h}getChildren(h){return v(this,void 0,void 0,(function*(){const h=this.isInFileTreeExplorer?"liveshare.startFromFileTreeExplorer":"liveshare.startFromActivityBar",m=this.isInFileTreeExplorer?"liveshare.joinFromFileTreeExplorer":"liveshare.joinFromActivityBar",y=k.localize("startCollaborationSession");let v=[new P.TreeViewItem({type:T.ViewItem.Other,collapsibleState:C.TreeItemCollapsibleState.None,label:k.localize("joinCollaborationSession"),command:{title:"Join collaboration session...",command:m}}),new P.TreeViewItem({type:T.ViewItem.Other,collapsibleState:C.TreeItemCollapsibleState.None,label:y,command:{title:y,command:h}})];const w={access:T.Access.ReadOnly},R=this.isInFileTreeExplorer?"liveshare.startReadOnlyFromFileTreeExplorer":"liveshare.startReadOnlyFromActivityBar";v.push(new P.TreeViewItem({type:T.ViewItem.Other,collapsibleState:C.TreeItemCollapsibleState.None,label:k.localize("startReadOnlyCollaborationSession"),command:{title:"Start read-only collaboration session..",command:R,arguments:[w]}}));const M=yield A.getLabelAndLinkTreeViewItems("SessionExplorer");return v.push(...M),Promise.resolve(v)}))}}},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0});const v=y(242),C=y(8);function decorate(h){return(m,y,v)=>{let C=null,T=null;if("function"==typeof v.value?(C="value",T=v.value):"function"==typeof v.get&&(C="get",T=v.get),!T||!C)throw new Error("not supported");v[C]=h(T,y,m)}}function done(h){return h.then(()=>{})}m.decorate=decorate,m.debounce=function debounce(h){return decorate((m,y)=>{const v=`$debounce$${y}`;return function(...y){clearTimeout(this[v]),this[v]=setTimeout(()=>m.apply(this,y),h)}})},m.throttle=decorate((function _throttle(h,m){const y=`$throttle$current$${m}`,v=`$throttle$next$${m}`,trigger=function(...m){if(this[v])return this[v];if(this[y])return this[v]=done(this[y]).then(()=>(this[v]=void 0,trigger.apply(this,m))),this[v];this[y]=h.apply(this,m);const clear=()=>this[y]=void 0;return done(this[y]).then(clear,clear),this[y]};return trigger})),m.done=done,m.memoize=decorate((function _memoize(h,m){const y=`$memoize$${m}`;return function(...m){return this.hasOwnProperty(y)||Object.defineProperty(this,y,{configurable:!1,enumerable:!1,writable:!1,value:h.apply(this,m)}),this[y]}})),m.instrumented=function instrumented({telemetryEventName:h,telemetryFaultEventName:m,telemetryProperties:y,onError:T}){return decorate((w,A,P)=>function(...k){const sendFault=y=>{const w=P&&P.constructor&&P.constructor.name?`${P.constructor.name}.${A}`:A,k=v.TelemetryUtil.DeriveTelemetryResult(y),R=v.TelemetryUtil.BuildTelemetryMessage(w,k,y.message);if(C.Telemetry.sendFault(m||h+"-fault",v.TelemetryUtil.MapTelemetryResultToFaultType(k),R,y),this.trace&&this.trace.traceEvent&&this.trace.traceEvent(v.TelemetryUtil.MapTelemetryResultToTraceEventType(k),0,`[${w}]: ${R}`),"function"==typeof T)return T.apply(this,y);if(void 0!==T)return T;throw y},sendSuccess=m=>{const v=void 0===y?void 0:"function"==typeof y?y.apply(this,m):y;return C.Telemetry.sendTelemetryEvent(h,v),m};try{const h=w.apply(this,k);return h&&"function"==typeof h.then?h.then(h=>sendSuccess(h),h=>sendFault(h)):sendSuccess(h)}catch(h){return sendFault(h)}})}},function(h,m,y){"use strict";var v=this&&this.__awaiter||function(h,m,y,v){return new(y||(y=Promise))((function(C,T){function fulfilled(h){try{step(v.next(h))}catch(h){T(h)}}function rejected(h){try{step(v.throw(h))}catch(h){T(h)}}function step(h){h.done?C(h.value):function adopt(h){return h instanceof y?h:new y((function(m){m(h)}))}(h.value).then(fulfilled,rejected)}step((v=v.apply(h,m||[])).next())}))};Object.defineProperty(m,"__esModule",{value:!0});const C=y(34);m.singleInvocationCommandDecorator=function singleInvocationCommandDecorator(h){return C.DecoratorHelper.setupDecorator(m=>new SingleInvocationCommandDecorator(h,m))};const T={numInvocations:0,maxInvocations:1};class SingleInvocationCommandDecorator{constructor(h,m){this.commandId=h,this.next=m,SingleInvocationCommandDecorator.commandInvocations[h]||(SingleInvocationCommandDecorator.commandInvocations[h]=Object.assign({},T))}get numInvocations(){return SingleInvocationCommandDecorator.commandInvocations[this.commandId].numInvocations}set numInvocations(h){SingleInvocationCommandDecorator.commandInvocations[this.commandId].numInvocations=h}get maxInvocations(){return SingleInvocationCommandDecorator.commandInvocations[this.commandId].maxInvocations}invoke(h,m){return v(this,void 0,void 0,(function*(){if(!(this.numInvocations>=this.maxInvocations)){this.numInvocations++;try{return yield this.next.invoke(h,m)}catch(h){throw h}finally{this.numInvocations--}}}))}}m.SingleInvocationCommandDecorator=SingleInvocationCommandDecorator,SingleInvocationCommandDecorator.commandInvocations={}},function(h,m,y){"use strict";var v=this&&this.__awaiter||function(h,m,y,v){return new(y||(y=Promise))((function(C,T){function fulfilled(h){try{step(v.next(h))}catch(h){T(h)}}function rejected(h){try{step(v.throw(h))}catch(h){T(h)}}function step(h){h.done?C(h.value):function adopt(h){return h instanceof y?h:new y((function(m){m(h)}))}(h.value).then(fulfilled,rejected)}step((v=v.apply(h,m||[])).next())}))};Object.defineProperty(m,"__esModule",{value:!0});const C=y(14),T=y(12),w=y(64),A=y(464),P=y(1120),k=y(1121),R=y(1122);m.ExtensionSetupBase=class ExtensionSetupBase{constructor(h,m){this.commandRegistryProvider=h,this.dependencies=m,this.didInit=!1,this.commandFiles={}}init(){return v(this,void 0,void 0,(function*(){this.registerCommands(),Object.keys(this.commandFiles).forEach(h=>{this.commandRegistryProvider.register(h,this.getCommandBuilder(this.commandFiles[h]))}),this.didInit=!0}))}registerCommands(){A.registerCommands(this),this.registerJoinCommands(),this.registerShareCommands(),this.registerUserElevationCommand(),this.registerCreateInvitationLinkCommand(),this.registerCreateSessionCommand()}register(h,m,y){const v={builder:m,options:y};this.commandFiles[(h=>{const m=`${T.Settings.get(C.SettingKeys.commandPrefix)}.`;return h.startsWith(m)?h:`${m}${h}`})(h)]=v}dispose(){return v(this,void 0,void 0,(function*(){this.didInit&&this.commandRegistryProvider.disposeAll()}))}getCommandBuilder(h){return()=>{const{builder:m}=h,y=m(this.dependencies);return{invoke:(m,v)=>y.invoke(Object.assign(Object.assign({},h.options),m),v)}}}registerJoinCommands(){const h=["join","joinFromFileTreeExplorer","joinFromActivityBar","joinFromWelcomeContent"];for(let m of h)this.register(m,this.joinCommandBuilder,{isAllowAnonymous:!0})}registerShareCommands(){const h=["start","startFromFileTreeExplorer","startFromActivityBar","startFromWelcomeContent","startFromWelcomePage"];for(let m of h)this.register(m,this.shareCommandBuilder);const m=["startReadOnly","startReadOnlyFromFileTreeExplorer","startReadOnlyFromActivityBar","startReadOnlyFromWelcomeContent"];for(let h of m)this.register(h,this.shareCommandBuilder,{access:w.Access.ReadOnly});this.register("startPresentation",this.shareCommandBuilder,{isPresentation:!0})}registerUserElevationCommand(){const h=["liveshare.activityBar.user.elevate","liveshare.fileTreeExplorer.user.elevate"],m=["liveshare.activityBar.user.decrease","liveshare.fileTreeExplorer.user.decrease"];for(let m of h)this.register(m,P.builder,{isReadOnly:!1});for(let h of m)this.register(h,P.builder,{isReadOnly:!0})}registerCreateInvitationLinkCommand(){this.register("createInvitationLink",k.builder)}registerCreateSessionCommand(){this.register("createSession",R.builder)}}},function(h,m,y){"use strict";var v=this&&this.__decorate||function(h,m,y,v){var C,T=arguments.length,w=T<3?m:null===v?v=Object.getOwnPropertyDescriptor(m,y):v;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)w=Reflect.decorate(h,m,y,v);else for(var A=h.length-1;A>=0;A--)(C=h[A])&&(w=(T<3?C(w):T>3?C(m,y,w):C(m,y))||w);return T>3&&w&&Object.defineProperty(m,y,w),w},C=this&&this.__awaiter||function(h,m,y,v){return new(y||(y=Promise))((function(C,T){function fulfilled(h){try{step(v.next(h))}catch(h){T(h)}}function rejected(h){try{step(v.throw(h))}catch(h){T(h)}}function step(h){h.done?C(h.value):function adopt(h){return h instanceof y?h:new y((function(m){m(h)}))}(h.value).then(fulfilled,rejected)}step((v=v.apply(h,m||[])).next())}))};Object.defineProperty(m,"__esModule",{value:!0});const T=y(262),w=y(180),A=y(263),P=y(132),k=y(103),R=y(179),M=y(181),N=y(22),D=y(17);m.builder=function builder(){return new x};const I={statusPostAuth:N.SessionAction.AttemptSignIn,authAttemptMax:1};let x=class SignInCommand{invoke(h,m){return C(this,void 0,void 0,(function*(){return!1}))}};x=v([M.cancellationDecorator(),P.errorNotificationCommandDecorator("Signing in",D.TelemetryEventNames.SIGN_IN_FAULT_EXPLICIT),k.telemetryCommandDecorator(D.TelemetryEventNames.SIGN_IN_EXPLICIT,D.TelemetryEventNames.SIGN_IN_FAULT_EXPLICIT,"ExplicitSignIn"),R.telemetryStatusCommandDecorator(),A.validationCommandDecorator(),T.sessionStateTransitionsCommandDecorator(N.SessionAction.AttemptSignIn,N.SessionAction.SignInSuccess,N.SessionAction.SignInError),w.authenticationCommandDecorator(I)],x),m.SignInCommand=x},function(h,m,y){"use strict";var v=this&&this.__awaiter||function(h,m,y,v){return new(y||(y=Promise))((function(C,T){function fulfilled(h){try{step(v.next(h))}catch(h){T(h)}}function rejected(h){try{step(v.throw(h))}catch(h){T(h)}}function step(h){h.done?C(h.value):function adopt(h){return h instanceof y?h:new y((function(m){m(h)}))}(h.value).then(fulfilled,rejected)}step((v=v.apply(h,m||[])).next())}))};Object.defineProperty(m,"__esModule",{value:!0});const C=y(0),T=y(23),w=y(22),A=y(32),P=y(24);m.builder=function builder(h){return new SignOutCommand(h)};class SignOutCommand{constructor(h){this.dependencies=h}invoke(h,m){return v(this,void 0,void 0,(function*(){if(T.sessionStateTracker.State!==w.SessionState.Joined&&T.sessionStateTracker.State!==w.SessionState.Shared)if(A.userAuthStateTracker.IsSignedIn){if(!this.dependencies.sessionContext().isStartingCollaboration)return P.ExtensionUtil.runWithProgress(()=>this.dependencies.authenticationProvider().signOut(),{title:"Signing Out"});yield P.ExtensionUtil.showErrorAsync("Cannot sign out while collaboration is starting.")}else yield C.window.showInformationMessage("Not signed in.")}))}}},function(h,m,y){"use strict";var v=this&&this.__decorate||function(h,m,y,v){var C,T=arguments.length,w=T<3?m:null===v?v=Object.getOwnPropertyDescriptor(m,y):v;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)w=Reflect.decorate(h,m,y,v);else for(var A=h.length-1;A>=0;A--)(C=h[A])&&(w=(T<3?C(w):T>3?C(m,y,w):C(m,y))||w);return T>3&&w&&Object.defineProperty(m,y,w),w},C=this&&this.__metadata||function(h,m){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(h,m)},T=this&&this.__awaiter||function(h,m,y,v){return new(y||(y=Promise))((function(C,T){function fulfilled(h){try{step(v.next(h))}catch(h){T(h)}}function rejected(h){try{step(v.throw(h))}catch(h){T(h)}}function step(h){h.done?C(h.value):function adopt(h){return h instanceof y?h:new y((function(m){m(h)}))}(h.value).then(fulfilled,rejected)}step((v=v.apply(h,m||[])).next())}))};Object.defineProperty(m,"__esModule",{value:!0});const w=y(0),A=y(5),P=y(262),k=y(180),R=y(263),M=y(132),N=y(103),D=y(179),I=y(181),x=y(463),O=y(17),L=y(22),U=y(24);m.builder=function builder(h){return new W(h.fileSystemManager())};const B={statusPostAuth:L.SessionAction.AttemptJoining,authAttemptMax:2};let W=class SignInAndReloadCommand extends A.CommandBase{constructor(h){super(),this.fileSystemManager=h}invoke(h,m){return T(this,void 0,void 0,(function*(){const{cancellationTokenSource:h}=m;if(!h||!h.token.isCancellationRequested)return yield this.fileSystemManager.registerFileSystemProvider(!1),this.fileSystemManager.disposeWorkspaceProvider(),yield w.workspace.saveAll(!1),yield U.ExtensionUtil.setTransientWorkspace(!1),yield w.commands.executeCommand("workbench.action.reloadWindow"),!0}))}};W=v([I.cancellationDecorator(),M.errorNotificationCommandDecorator("Signing in",O.TelemetryEventNames.JOIN_FAULT),N.telemetryCommandDecorator(O.TelemetryEventNames.WORKSPACE_SIGNIN_RELOAD,O.TelemetryEventNames.JOIN_FAULT,"SignInToElevate",1),D.telemetryStatusCommandDecorator(),R.validationCommandDecorator(),x.progressCommandDecorator(),P.sessionStateTransitionsCommandDecorator(null,L.SessionAction.JoiningSuccess,L.SessionAction.JoiningError),k.authenticationCommandDecorator(B),C("design:paramtypes",[Object])],W),m.SignInAndReloadCommand=W},function(h,m,y){"use strict";var v=this&&this.__awaiter||function(h,m,y,v){return new(y||(y=Promise))((function(C,T){function fulfilled(h){try{step(v.next(h))}catch(h){T(h)}}function rejected(h){try{step(v.throw(h))}catch(h){T(h)}}function step(h){h.done?C(h.value):function adopt(h){return h instanceof y?h:new y((function(m){m(h)}))}(h.value).then(fulfilled,rejected)}step((v=v.apply(h,m||[])).next())}))};Object.defineProperty(m,"__esModule",{value:!0});const C=y(5),T=y(75),w=y(12),A=y(14),P=y(8),k=y(17);m.builder=function builder(h){return new FocusParticipantsCommand(h)};class FocusParticipantsCommand{constructor(h){this.dependencies=h}invoke(h,m){return v(this,void 0,void 0,(function*(){if(P.Telemetry.sendTelemetryEvent(k.TelemetryEventNames.FOCUS_PARTICIPANTS),!this.dependencies.sessionContext().coeditingClient)return;this.dependencies.sessionContext().coeditingClient.postMessage(T.MessageFactory.SummonMessage(this.dependencies.sessionContext().coeditingClient.clientID));const h=!!w.Settings.get(A.SettingKeys.showVerboseNotifications);yield C.NotificationUtil.showInformationMessage("Focus request sent.",h)}))}}m.FocusParticipantsCommand=FocusParticipantsCommand},function(h,m,y){"use strict";var v=this&&this.__decorate||function(h,m,y,v){var C,T=arguments.length,w=T<3?m:null===v?v=Object.getOwnPropertyDescriptor(m,y):v;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)w=Reflect.decorate(h,m,y,v);else for(var A=h.length-1;A>=0;A--)(C=h[A])&&(w=(T<3?C(w):T>3?C(m,y,w):C(m,y))||w);return T>3&&w&&Object.defineProperty(m,y,w),w},C=this&&this.__metadata||function(h,m){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(h,m)},T=this&&this.__awaiter||function(h,m,y,v){return new(y||(y=Promise))((function(C,T){function fulfilled(h){try{step(v.next(h))}catch(h){T(h)}}function rejected(h){try{step(v.throw(h))}catch(h){T(h)}}function step(h){h.done?C(h.value):function adopt(h){return h instanceof y?h:new y((function(m){m(h)}))}(h.value).then(fulfilled,rejected)}step((v=v.apply(h,m||[])).next())}))};Object.defineProperty(m,"__esModule",{value:!0});const w=y(103),A=y(132),P=y(17),k=y(26);m.builder=function builder(h){return new R(h.workspaceAccessControlManager())};let R=class UserElevationToggleCommand{constructor(h){this.workspaceAccessControlManager=h}invoke(h,m){return T(this,void 0,void 0,(function*(){if(!h||"number"!=typeof h.sessionId||isNaN(h.sessionId))return;k.workspaceSessionInfoTracker.getAnonymousAccessMapHasTheProfile(h)&&(yield k.workspaceSessionInfoTracker.updateAnonymousAccess(h,h.isReadOnly)),yield this.workspaceAccessControlManager.setUserReadOnly(h.isReadOnly,h.sessionId)}))}};R=v([A.errorNotificationCommandDecorator("Changing user permissions",P.TelemetryEventNames.USER_ELEVATION_TOGGLE_COMMAND_FAULT),w.telemetryCommandDecorator(P.TelemetryEventNames.USER_ELEVATION_TOGGLE_COMMAND,P.TelemetryEventNames.USER_ELEVATION_TOGGLE_COMMAND_FAULT,"Toggle user read/write access",1),C("design:paramtypes",[Object])],R)},function(h,m,y){"use strict";var v=this&&this.__decorate||function(h,m,y,v){var C,T=arguments.length,w=T<3?m:null===v?v=Object.getOwnPropertyDescriptor(m,y):v;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)w=Reflect.decorate(h,m,y,v);else for(var A=h.length-1;A>=0;A--)(C=h[A])&&(w=(T<3?C(w):T>3?C(m,y,w):C(m,y))||w);return T>3&&w&&Object.defineProperty(m,y,w),w},C=this&&this.__metadata||function(h,m){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(h,m)},T=this&&this.__awaiter||function(h,m,y,v){return new(y||(y=Promise))((function(C,T){function fulfilled(h){try{step(v.next(h))}catch(h){T(h)}}function rejected(h){try{step(v.throw(h))}catch(h){T(h)}}function step(h){h.done?C(h.value):function adopt(h){return h instanceof y?h:new y((function(m){m(h)}))}(h.value).then(fulfilled,rejected)}step((v=v.apply(h,m||[])).next())}))};Object.defineProperty(m,"__esModule",{value:!0});const w=y(264),A=y(17),P=y(103);y(4);m.builder=function builder(h){return new k(h.workspaceService())};let k=class CreateInvitationLinkCommand extends w.LiveShareCommandBase{constructor(h){super(),this.workspaceService=h}invoke(h,m){return T(this,void 0,void 0,(function*(){const{cancellationTokenSource:y}=m;return m.telemetryEvent.addProperty(A.TelemetryPropertyNames.CREATE_INVITATION_LINK,!0),yield this.workspaceService.createInvitationLinkAsync(h,y&&y.token)}))}};k=v([P.telemetryCommandDecorator(A.TelemetryEventNames.CREATE_INVITATION_LINK,A.TelemetryEventNames.CREATE_INVITATION_LINK_FAULT,"CreateInvitationLink",1),C("design:paramtypes",[Object])],k),m.CreateInvitationLinkCommand=k},function(h,m,y){"use strict";var v=this&&this.__decorate||function(h,m,y,v){var C,T=arguments.length,w=T<3?m:null===v?v=Object.getOwnPropertyDescriptor(m,y):v;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)w=Reflect.decorate(h,m,y,v);else for(var A=h.length-1;A>=0;A--)(C=h[A])&&(w=(T<3?C(w):T>3?C(m,y,w):C(m,y))||w);return T>3&&w&&Object.defineProperty(m,y,w),w},C=this&&this.__metadata||function(h,m){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(h,m)},T=this&&this.__awaiter||function(h,m,y,v){return new(y||(y=Promise))((function(C,T){function fulfilled(h){try{step(v.next(h))}catch(h){T(h)}}function rejected(h){try{step(v.throw(h))}catch(h){T(h)}}function step(h){h.done?C(h.value):function adopt(h){return h instanceof y?h:new y((function(m){m(h)}))}(h.value).then(fulfilled,rejected)}step((v=v.apply(h,m||[])).next())}))};Object.defineProperty(m,"__esModule",{value:!0});const w=y(0),A=(y(4),y(264)),P=y(103),k=y(179),R=y(132),M=y(181),N=y(180),D=y(17),I=y(26),x=y(22),O=y(1123),L=y(25);m.builder=function builder(h){return new B(h.workspaceService(),h.workspaceAccessControlManager())};const U={statusPostAuth:x.SessionAction.Create};let B=class CreateSessionCommand extends A.LiveShareCommandBase{constructor(h,m){super(),this.workspaceService=h,this.workspaceAccessControlManager=m}invoke(h,m){return T(this,void 0,void 0,(function*(){const{cancellationTokenSource:h}=m;try{let y;yield w.window.withProgress({location:w.ProgressLocation.Notification,title:L.localize("CreateLinkProgress")},()=>T(this,void 0,void 0,(function*(){y=yield this.workspaceService.createPersistentWorkspaceAsync(null,!0,h&&h.token)}))),I.workspaceSessionInfoTracker.workspaceSessionInfo=y,yield O.showReusableLink(this.workspaceAccessControlManager,y,m),m.telemetryEvent.addProperty(D.TelemetryPropertyNames.CREATE_WORKSPACE,!0)}catch(h){throw m.trace.error(`Failed to create a Reusable Session link. ${h}`),new Error(L.localize("CannotCreatePersistentSession"))}}))}};B=v([M.cancellationDecorator(),R.errorNotificationCommandDecorator("Creating a Reusable Session link",D.TelemetryEventNames.CREATE_FAULT),P.telemetryCommandDecorator(D.TelemetryEventNames.CREATE_WORKSPACE,D.TelemetryEventNames.CREATE_FAULT,"Create",1),k.telemetryStatusCommandDecorator(),N.authenticationCommandDecorator(U),C("design:paramtypes",[Object,Object])],B),m.CreateSessionCommand=B},function(h,m,y){"use strict";var v=this&&this.__awaiter||function(h,m,y,v){return new(y||(y=Promise))((function(C,T){function fulfilled(h){try{step(v.next(h))}catch(h){T(h)}}function rejected(h){try{step(v.throw(h))}catch(h){T(h)}}function step(h){h.done?C(h.value):function adopt(h){return h instanceof y?h:new y((function(m){m(h)}))}(h.value).then(fulfilled,rejected)}step((v=v.apply(h,m||[])).next())}))};Object.defineProperty(m,"__esModule",{value:!0});const C=y(0),T=y(95),w=y(452),A=y(17),P=y(25);m.showReusableLink=function showReusableLink(h,m,y,k){return v(this,void 0,void 0,(function*(){const v=m.joinUri.toString(),k=m.id,R=yield(new T.ClipboardUtil).copyToClipboardAsync(v),M={id:1,title:P.localize("generic.MoreInfo")},N={id:2,title:R?P.localize("generic.CopyAgain"):P.localize("generic.CopyLink")},D={id:3,title:P.localize("generic.StartSharing")};let I=[M,N,D];const x=yield C.window.showInformationMessage(R?P.localize("notification.ReusableInvitationLinkCopied"):P.localize("notification.ReusableInvitationLinkCreated"),!0,...I);if(x)switch(x.id){case N.id:y.telemetryEvent.addProperty(A.TelemetryPropertyNames.COPYLINK_FROM_CREATE_WORKSPACE,!0),yield w.showInvitationLink(h,v,!R,!1);break;case M.id:y.telemetryEvent.addProperty(A.TelemetryPropertyNames.MOREINFO_FROM_CREATE_WORKSPACE,!0),C.commands.executeCommand("vscode.open",C.Uri.parse("https://aka.ms/vsls-reusable"));break;case D.id:const m="liveshare.start";y.telemetryEvent.addProperty(A.TelemetryPropertyNames.SHARE_FROM_CREATE_WORKSPACE,!0),yield C.commands.executeCommand(m,{sessionId:k})}}))}},function(h,m,y){"use strict";var v=this&&this.__awaiter||function(h,m,y,v){return new(y||(y=Promise))((function(C,T){function fulfilled(h){try{step(v.next(h))}catch(h){T(h)}}function rejected(h){try{step(v.throw(h))}catch(h){T(h)}}function step(h){h.done?C(h.value):function adopt(h){return h instanceof y?h:new y((function(m){m(h)}))}(h.value).then(fulfilled,rejected)}step((v=v.apply(h,m||[])).next())}))};Object.defineProperty(m,"__esModule",{value:!0});const C=y(0),T=y(12),w=y(14),A=y(17),P=y(62),k=y(4),R=y(94),M=y(22),N=y(32),D=y(26),I=y(23),x=y(24),O=y(25);var L;function shouldStatusBarItemBeVisible(h=!1){switch(T.Settings.get(w.SettingKeys.showInStatusBar)){case L.WhileCollaborating:return!!(R.SessionContext.isCollaborating||R.SessionContext.isStartingCollaboration||h);case L.Never:return h;case L.Always:default:return!0}return!0}!function(h){h.Always="always",h.WhileCollaborating="whileCollaborating",h.Never="never"}(L||(L={}));const getEmojiNameSuffix=()=>{const h=T.Settings.isInsidersFeatureSet||T.Settings.isInternalFeatureSet?" ":"";let m=T.Settings.isVSLSTeamMember?" ":"";return m=T.Settings.get(w.SettingKeys.nativeAuthFlow)?" ":m,`${h}${m}`},getNameSuffix=()=>{const h=w.FeatureSet[T.Settings.get(w.SettingKeys.featureSet)];return T.Settings.get(w.SettingKeys.isInternal)?" (Internal User)":h===w.FeatureSet.insiders?" (Insider)":""};m.StatusBarController=class StatusBarController{constructor(h,m){this.commandEnabledCallback=h,this.quickPickItemsProvider=m,this.updateStatusBarPromise=Promise.resolve(),this.userStatusBarItem=C.window.createStatusBarItem(C.StatusBarAlignment.Left,4),this.userStatusBarItem.hide(),this.collabStatusBarItem=C.window.createStatusBarItem(C.StatusBarAlignment.Left,3),this.collabStatusBarItem.hide(),this.updateStatusBar(new InitialState),R.SessionContext.onCoeditingClientChanged(h=>{h&&this.registerClientListeners(h)}),I.sessionStateTracker.onStateChanged(h=>v(this,void 0,void 0,(function*(){return yield this.onSessionStateChanged(h.newState)}))),D.workspaceSessionInfoTracker.onReadOnlyChanged(()=>v(this,void 0,void 0,(function*(){I.sessionStateTracker.State!==M.SessionState.Joined&&I.sessionStateTracker.State!==M.SessionState.Shared||(yield this.onSessionStateChanged(I.sessionStateTracker.State))})))}refresh(){this.updateStatusBar(this.currentState)}onSessionStateChanged(h){return v(this,void 0,void 0,(function*(){let m=this.getStatusBarState(h);this.updateStatusBarPromise=this.updateStatusBarPromise.then(()=>v(this,void 0,void 0,(function*(){yield this.updateStatusBar(m)})))}))}getStatusBarState(h){switch(h){case M.SessionState.Initializing:return new InitialState;case M.SessionState.SigningIn:return new SigningInState;case M.SessionState.ExternallySigningIn:return new SignedOutState;case M.SessionState.SignedIn:return new SignedInState(this.quickPickItemsProvider);case M.SessionState.SharingInProgress:return N.userAuthStateTracker.IsSignedIn?new SharingInProgressState(this.quickPickItemsProvider):new SigningInState;case M.SessionState.Shared:return new SharedState(this.quickPickItemsProvider);case M.SessionState.JoiningInProgress:return N.userAuthStateTracker.IsSignedIn?new JoiningState(this.quickPickItemsProvider):new SigningInState;case M.SessionState.Joined:return new JoinedState(this.commandEnabledCallback,this.quickPickItemsProvider);default:case M.SessionState.SignedOut:return new SignedOutState}}updateStatusBar(h){return v(this,void 0,void 0,(function*(){this.disposed||(this.currentState=h,shouldStatusBarItemBeVisible()?(yield h.updateUserStatusBarItem(this.userStatusBarItem),yield h.updateCollabStatusBarItem(this.collabStatusBarItem)):(this.userStatusBarItem.hide(),this.collabStatusBarItem.hide()))}))}registerClientListeners(h){h.onCoEditorSwitchedFile((h,m)=>v(this,void 0,void 0,(function*(){I.sessionStateTracker.State!==M.SessionState.Joined&&I.sessionStateTracker.State!==M.SessionState.Shared||(yield this.currentState.onCoEditorSwitchedFile(h,m,this.collabStatusBarItem))}))),h.onCoEditorsJoined(h=>v(this,void 0,void 0,(function*(){I.sessionStateTracker.State!==M.SessionState.Joined&&I.sessionStateTracker.State!==M.SessionState.Shared||(yield this.currentState.onCoEditorsJoined(h,this.collabStatusBarItem))})))}onWorkspaceSessionChanged(h){return v(this,void 0,void 0,(function*(){this.currentState instanceof CollaborationState&&h.changeType===k.vsls.WorkspaceSessionChangeType.Unjoined&&(yield this.currentState.onCoEditorLeft(h.sessionNumber,this.collabStatusBarItem))}))}dispose(){this.updateStatusBar(new InitialState),this.disposed=!0}};class StatusBarState{hideItem(h){h.hide(),h.text=void 0,h.command=void 0,h.tooltip=void 0}}m.StatusBarState=StatusBarState;class InitialState extends StatusBarState{updateUserStatusBarItem(h){return v(this,void 0,void 0,(function*(){this.hideItem(h)}))}updateCollabStatusBarItem(h){return v(this,void 0,void 0,(function*(){this.hideItem(h)}))}}m.InitialState=InitialState;class SignedOutState extends StatusBarState{updateUserStatusBarItem(h){return v(this,void 0,void 0,(function*(){const m=C.workspace.workspaceFolders&&C.workspace.workspaceFolders[0],y=m&&m.uri.scheme===T.Settings.get(w.SettingKeys.scheme);if(I.sessionStateTracker.State===M.SessionState.ExternallySigningIn&&y)return h.text="$(person) Sign in",h.command=`${T.Settings.get(w.SettingKeys.commandPrefix)}.signin`,h.tooltip=`Sign in to enable ${T.Settings.get(w.SettingKeys.name)} collaboration.`,void h.show();h.text="$(live-share) Live Share",h.command=`${T.Settings.get(w.SettingKeys.commandPrefix)}.start`,h.tooltip=`Share the workspace with ${T.Settings.get(w.SettingKeys.name)}.`,h.show()}))}updateCollabStatusBarItem(h){return v(this,void 0,void 0,(function*(){this.hideItem(h)}))}}m.SignedOutState=SignedOutState;class SigningInState extends StatusBarState{updateUserStatusBarItem(h){return v(this,void 0,void 0,(function*(){h.hide()}))}updateCollabStatusBarItem(h){return v(this,void 0,void 0,(function*(){this.hideItem(h)}))}}m.SigningInState=SigningInState;class SignedInState extends StatusBarState{constructor(h){super(),this.quickPickItemsProvider=h}get userInfo(){return N.userAuthStateTracker.userInfo}get isCurrentUserAnonymous(){return N.userAuthStateTracker.isCurrentUserAnonymous()}get currentUserQuickPickItems(){const h=[{label:"$(live-share) "+O.localize("statusbar.StartSession"),description:"",detail:O.localize("statusbar.StartSessionMessage"),command:"liveshare.start",enabled:()=>!0},{label:"$(live-share) "+O.localize("statusbar.StartReadOnly"),description:"",detail:O.localize("statusbar.StartReadOnlyMessage"),command:"liveshare.startReadOnly",enabled:()=>!0},{label:"$(organization) "+O.localize("statusbar.JoinSession"),description:"",detail:O.localize("statusbar.JoinSessionMessage"),command:"liveshare.join",enabled:()=>!0}];return T.Settings.get(w.SettingKeys.nativeAuthFlow)||h.push({label:`$(sign-out) Sign Out (${this.userInfo.userName||this.userInfo.emailAddress} via ${this.userInfo.providerName})`,description:"",detail:`Sign out of your ${T.Settings.get(w.SettingKeys.name)} account.`,command:`${T.Settings.get(w.SettingKeys.commandPrefix)}.signout`,enabled:()=>!0}),h}updateUserStatusBarItem(h){return v(this,void 0,void 0,(function*(){yield x.ExtensionUtil.tryRegisterCommand("_liveshare.showSignedInUserOptions",()=>this.showQuickPick(this.currentUserQuickPickItems,{placeHolder:O.localize("statusbar.SignedUserPlaceholder")}).then(h=>h&&C.commands.executeCommand(h.command,h.commandArg))),this.isCurrentUserAnonymous?h.hide():(h.text=`$(person) ${this.signedInName}${getEmojiNameSuffix()}`,h.command="_liveshare.showSignedInUserOptions",h.tooltip=`Signed in to ${T.Settings.get(w.SettingKeys.name)}${this.signedInInfo}${getNameSuffix()}`,h.show())}))}updateCollabStatusBarItem(h){return v(this,void 0,void 0,(function*(){h.text="$(live-share) Live Share",h.command="liveshare.start",h.tooltip=O.localize("statusbar.StartCollaboration"),h.show()}))}showQuickPick(h,m){const y=this.quickPickItemsProvider.getQuickPickItems(I.sessionStateTracker.State),v=h.length>1?h.length-1:0,T=h.slice(0);T.splice(v,0,...y);const w=T.filter(h=>h.enabled());return C.window.showQuickPick(w,m)}get signedInName(){if(!this.userInfo)return"";const{displayName:h="",emailAddress:m,userName:y}=this.userInfo;if(h){return h.replace(/ .*$/,"")}return y||m||"Signed In"}get signedInInfo(){return this.userInfo.isAnonymous?` as ${T.Settings.get(w.SettingKeys.anonymousUserName)} (${P.READ_ONLY_LABEL})`:this.userInfo.displayName?" as "+this.userInfo.displayName+(this.userInfo.emailAddress?" <"+this.userInfo.emailAddress+">":" <"+this.userInfo.userName+">")+" ("+this.userInfo.providerName+")":" as "+(this.userInfo.emailAddress?this.userInfo.emailAddress:this.userInfo.userName)+" ("+this.userInfo.providerName+")"}}m.SignedInState=SignedInState;class SharingInProgressState extends SignedInState{updateCollabStatusBarItem(h){return v(this,void 0,void 0,(function*(){h.hide()}))}updateUserStatusBarItem(h){const m=Object.create(null,{updateUserStatusBarItem:{get:()=>super.updateUserStatusBarItem}});return v(this,void 0,void 0,(function*(){yield m.updateUserStatusBarItem.call(this,h),h.command=void 0}))}}m.SharingInProgressState=SharingInProgressState;class JoiningState extends SignedInState{updateCollabStatusBarItem(h){return v(this,void 0,void 0,(function*(){h.hide()}))}updateUserStatusBarItem(h){const m=Object.create(null,{updateUserStatusBarItem:{get:()=>super.updateUserStatusBarItem}});return v(this,void 0,void 0,(function*(){yield m.updateUserStatusBarItem.call(this,h),h.command=void 0}))}}m.JoiningState=JoiningState;class CollaborationState extends SignedInState{updateCollabStatusBarItem(h){return v(this,void 0,void 0,(function*(){return this.innerUpdateCollabStatusBarItem(h,!1)}))}onCoEditorSwitchedFile(h,m,y){return v(this,void 0,void 0,(function*(){if(1===R.SessionContext.collaboratorManager.getCollaboratorCount())return this.innerUpdateCollabStatusBarItem(y,!0)}))}onCoEditorsJoined(h,m){return v(this,void 0,void 0,(function*(){const y=R.SessionContext.collaboratorManager.getCollaboratorCount()-h.length;return this.innerUpdateCollabStatusBarItem(m,y>=1)}))}onCoEditorLeft(h,m){if(!R.SessionContext.collaboratorManager.wasCoEditor(h))return;const y=R.SessionContext.collaboratorManager.getCollaboratorCount()>0;return this.innerUpdateCollabStatusBarItem(m,y)}innerUpdateCollabStatusBarItem(h,m){return v(this,void 0,void 0,(function*(){const y=I.sessionStateTracker.State;if(y!==M.SessionState.Joined&&y!==M.SessionState.Shared||!shouldStatusBarItemBeVisible())return;const v=R.SessionContext.collaboratorManager.getCollaboratorCount(),C=y===M.SessionState.Shared&&D.workspaceSessionInfoTracker.isReadOnly?` (${P.READ_ONLY_LABEL})`:"";if(h.text=`$(organization) ${v}${C}`,v>0){const y=R.SessionContext.collaboratorManager.getCollaboratorSessionIds();if(1===v){const m=y[0],v=R.SessionContext.collaboratorManager.getDisplayName(m),C=R.SessionContext.coeditingClient.lastKnownFileForClient(m);h.tooltip=C?`Follow ${v} (currently editing ${C})`:`${v} (not currently editing a shared document)`}else h.tooltip="Follow a participant's cursor.";m||(h.command="liveshare.listParticipants")}else h.command=null,h.tooltip="There are no participants (to invite others, start by clicking on your name in the status bar)";h.show()}))}}m.CollaborationState=CollaborationState;class SharedState extends CollaborationState{constructor(h){super(h),this.sharingQuickPickItems=[{label:"$(clippy) "+O.localize("statusbar.InviteOthers"),description:"",detail:O.localize("statusbar.InviteOthersMessage"),command:"liveshare.collaboration.link.copy",enabled:()=>!0},{label:"$(megaphone) "+O.localize("statusbar.FocusParticipants"),description:"",detail:O.localize("statusbar.FocusParticipantsMessage"),command:"liveshare.focusParticipants",enabled:()=>R.SessionContext.collaboratorManager.getCollaboratorCount()>0},{label:"$(terminal) "+`${D.workspaceSessionInfoTracker.isReadOnly?O.localize("statusbar.ShareReadOnlyTerminal"):O.localize("statusbar.ShareTerminal")}`,description:"",detail:O.localize("statusbar.ShareTerminalMessage"),command:"liveshare.shareTerminal",commandArg:A.TelemetryEventOrigin.StatusBar,enabled:()=>!0},{label:"$(plug) "+O.localize("statusbar.ShareServer"),description:"",detail:O.localize("statusbar.ShareServerMessage"),command:"liveshare.shareServer",commandArg:A.TelemetryEventOrigin.StatusBar,enabled:()=>!0},{label:"$(plug) "+O.localize("statusbar.ShowSharedServers"),description:"",detail:O.localize("statusbar.ShowSharedServersMessage"),command:"liveshare.listServers",commandArg:A.TelemetryEventOrigin.StatusBar,enabled:()=>R.SessionContext.hasServersShared},{label:"$(plug) "+O.localize("statusbar.StopSharingServer"),description:"",detail:O.localize("statusbar.StopSharingServerMessage"),command:"liveshare.unshareServer",commandArg:A.TelemetryEventOrigin.StatusBar,enabled:()=>R.SessionContext.hasServersShared},{label:"$(circle-slash) "+O.localize("statusbar.StopCollaborationSession"),description:"",detail:O.localize("statusbar.StopCollaborationSessionMessage"),command:"liveshare.end",enabled:()=>!0}]}updateUserStatusBarItem(h){return v(this,void 0,void 0,(function*(){const m="_liveshare.showSharedUserOptions";yield x.ExtensionUtil.tryRegisterCommand(m,()=>this.showQuickPick(this.sharingQuickPickItems,{placeHolder:O.localize("statusbar.placeHolder")}).then(h=>h&&C.commands.executeCommand(h.command,h.commandArg)),void 0,!1,!0),h.text=`$(broadcast) ${this.signedInName}${getEmojiNameSuffix()}`,h.command=m,h.tooltip=`Sharing via ${T.Settings.get(w.SettingKeys.name)}${this.signedInInfo}${getNameSuffix()}`,h.show()}))}}m.SharedState=SharedState;class JoinedState extends CollaborationState{constructor(h,m){super(m),this.commandEnabledCallback=h,this.collaboratorQuickPickItems=[{label:"$(person) "+O.localize("generic.SignIn"),description:"",detail:O.localize("statusbar.SignInMessage"),command:"liveshare.signInAndReload",enabled:()=>N.userAuthStateTracker.isCurrentUserAnonymous()},{label:"$(megaphone) "+O.localize("statusbar.FocusParticipants"),description:"",detail:O.localize("statusbar.FocusParticipantsMessage"),command:"liveshare.focusParticipants",enabled:()=>R.SessionContext.collaboratorManager.getCollaboratorCount()>0},{label:"$(bug) "+O.localize("statusbar.AttachSharedDebuggingSession"),description:"",detail:O.localize("statusbar.AttachSharedDebuggingSessionMessage"),command:"liveshare.debug",enabled:()=>this.commandEnabledCallback("liveshare.debug")},{label:"$(terminal) "+O.localize("statusbar.AccessSharedTerminal"),description:"",detail:O.localize("statusbar.AccessSharedTerminalMessage"),command:"liveshare.listTerminals",commandArg:A.TelemetryEventOrigin.StatusBar,enabled:()=>R.SessionContext.hasSharedTerminals},{label:"$(plug) "+O.localize("statusbar.AccessSharedServer"),description:"",detail:O.localize("statusbar.AccessSharedServerMessage"),command:"liveshare.listServers",commandArg:A.TelemetryEventOrigin.StatusBar,enabled:()=>R.SessionContext.hasServersShared},{label:"$(circle-slash) "+O.localize("statusbar.LeaveCollaborationSession"),description:"",detail:O.localize("statusbar.LeaveCollaborationSessionMessage"),command:"liveshare.leave",enabled:()=>!0}]}updateUserStatusBarItem(h){return v(this,void 0,void 0,(function*(){const m="_liveshare.showCollaboratorOptions";yield x.ExtensionUtil.tryRegisterCommand(m,()=>this.showQuickPick(this.collaboratorQuickPickItems,{placeHolder:O.localize("statusbar.placeHolder")}).then(h=>h&&C.commands.executeCommand(h.command,h.commandArg)));const y=D.workspaceSessionInfoTracker.isReadOnly?` (${P.READ_ONLY_LABEL})`:"",v=this.userInfo.isAnonymous?T.Settings.get(w.SettingKeys.anonymousUserName):this.signedInName;h.text=`$(broadcast) ${v}${y}${getEmojiNameSuffix()}`,h.command=m,h.tooltip=`Collaborating via ${T.Settings.get(w.SettingKeys.name)}${this.signedInInfo}${getNameSuffix()}`,h.show()}))}}m.JoinedState=JoinedState},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0});const v=y(0),C=y(12),T=y(14),w=y(22),A=y(23),P=y(25),k=[w.SessionState.ExternallySigningIn,w.SessionState.Initializing,w.SessionState.SignedIn,w.SessionState.SignedOut,w.SessionState.SigningIn];m.createSimpleStatusBar=function createSimpleStatusBar(){const h=v.window.createStatusBarItem(v.StatusBarAlignment.Left,3);h.text="$(live-share) Live Share",h.command="liveshare.start",h.tooltip=P.localize("statusbar.StartCollaboration");const show=()=>{"always"===C.Settings.get(T.SettingKeys.showInStatusBar)&&h.show()};show(),A.sessionStateTracker.onStateChanged(m=>{k.indexOf(m.newState)>=0?show():h.hide()})}},function(h,m,y){"use strict";var v=this&&this.__awaiter||function(h,m,y,v){return new(y||(y=Promise))((function(C,T){function fulfilled(h){try{step(v.next(h))}catch(h){T(h)}}function rejected(h){try{step(v.throw(h))}catch(h){T(h)}}function step(h){h.done?C(h.value):function adopt(h){return h instanceof y?h:new y((function(m){m(h)}))}(h.value).then(fulfilled,rejected)}step((v=v.apply(h,m||[])).next())}))};Object.defineProperty(m,"__esModule",{value:!0});const C=y(0),T=y(8),w=y(17),A=y(24),P=y(22),k=y(23),R=y(12),M=y(14),N=y(96),D=y(5),I=y(453),x=y(15);m.registerProtocolHandler=h=>{"function"==typeof C.window.registerUriHandler&&A.ExtensionUtil.context.subscriptions.push(C.window.registerUriHandler(new VSLSProtocolHandler(h)))};class VSLSProtocolHandler{constructor(h){this.telemetryEvent=h}handleUri(h){return v(this,void 0,void 0,(function*(){const{path:m}=h,y=m.split("?")[0];switch(D.traceSource.verbose(`handleUri => uri:${x.TraceFormat.formatText(h.toString())}`),y){case"/join":return this.join(h);case"/signin":yield N.auth.API.authCallback(h)}}))}join(h){const m=function parseQuery(h){const m={},y=(h="?"===h[0]?h.substr(1):h).split("&");for(let h=0;h<y.length;h++){const v=y[h].split("="),C=decodeURIComponent(v[0]),T=decodeURIComponent(v[1]||"");m[C]=T}return m}(h.query),{vslsLink:y,correlationId:v}=m,C=h.with({query:`workspaceId=censored&correlationId=${v}`});if(this.reportInvocationToTelemetry(C),!y)throw new Error("VSCode protocol handler passed a link with unknown format.");{const h=`${R.Settings.get(M.SettingKeys.commandPrefix)}.join`,m=decodeURIComponent(y),C=k.sessionStateTracker.State===P.SessionState.Joined||k.sessionStateTracker.State===P.SessionState.Shared;D.traceSource.verbose(`VSLSProtocolHandler join => link:${m} correlationId:${v}`);const T={correlationId:v,link:m,newWindow:C};I.executeNextCommand(h,T)}}reportInvocationToTelemetry(h){new T.TelemetryEvent(w.TelemetryEventNames.INVOKE_NEWPROTOCOLHANDLER).addProperty(w.TelemetryPropertyNames.URI,h.toString()).correlateWith(this.telemetryEvent).send()}dispose(){}}},function(h,m,y){"use strict";var v=this&&this.__awaiter||function(h,m,y,v){return new(y||(y=Promise))((function(C,T){function fulfilled(h){try{step(v.next(h))}catch(h){T(h)}}function rejected(h){try{step(v.throw(h))}catch(h){T(h)}}function step(h){h.done?C(h.value):function adopt(h){return h instanceof y?h:new y((function(m){m(h)}))}(h.value).then(fulfilled,rejected)}step((v=v.apply(h,m||[])).next())}))};Object.defineProperty(m,"__esModule",{value:!0});const C=y(0),T=y(2),w=y(5),A=y(32),P=y(62),k=y(12),R=y(14),M=y(5),N=y(23),D=y(17),I=y(22),x=y(96),O=y(172),L=y(239),U=y(97),B=y(25);function getDefaultTokenToUse(h,m){if(1===h.length)return h[0];for(let y of h)if(y.strategy!==m)return y}m.AuthenticationProvider=class AuthenticationProvider{constructor(h,m){this.authService=h,this.shouldClearCache=!1,m&&(this.nativeAuth=new U.NativeAuthProvider,this.nativeAuth.onSignOut(this.handleOnDidSignOut.bind(this)))}isAuthenticated(){return A.userAuthStateTracker.IsSignedIn}clearCache(h){return v(this,void 0,void 0,(function*(){A.userAuthStateTracker.userInfo=void 0,this.shouldClearCache=!0}))}handleOnDidSignOut(){return v(this,void 0,void 0,(function*(){N.sessionStateTracker.State===I.SessionState.Shared?yield C.commands.executeCommand("liveshare.end"):N.sessionStateTracker.State===I.SessionState.Joined&&(yield C.commands.executeCommand("liveshare.leave")),yield this.signOut()}))}getUsernameFromInput(){return v(this,void 0,void 0,(function*(){const h=k.Settings.get(R.SettingKeys.anonymousUserName);const m=((yield M.NotificationUtil.showInputBox({prompt:"Enter the name to display to other participants",ignoreFocusOut:!0,value:h||P.DEFAULT_ANONYMOUS_USER_NAME}))||"").trim();return m?m.slice(0,50):P.DEFAULT_ANONYMOUS_USER_NAME}))}askForUserName(){return v(this,void 0,void 0,(function*(){const h=yield this.getUsernameFromInput();return h&&(yield k.Settings.save(R.SettingKeys.anonymousUserName,h)),h}))}attemptLoginVSCodeAccount(h,m){return v(this,void 0,void 0,(function*(){this.shouldClearCache=!1,N.sessionStateTracker.point(D.TelemetryPropertyNames.ATTEMPT_LOGIN_STARTING);const logout=()=>v(this,void 0,void 0,(function*(){yield x.auth.API.logOut([h.strategy])}));try{let y=void 0;const v=h.strategy.publicName.toLowerCase();y="vsls"!==h.tokenType?yield this.authService.loginWithExternalTokenAsync({providerName:v},{token:h.accessToken},{cache:!1,cacheDefault:!1},null,m):yield this.authService.loginAsync({token:h.accessToken},{cache:!1,cacheDefault:!1},null,m),y?y.providerName||(y.providerName=v):yield logout(),A.userAuthStateTracker.userInfo=y}catch(h){throw yield logout(),h}return A.userAuthStateTracker.isCustomAccount=!1,N.sessionStateTracker.point(D.TelemetryPropertyNames.ATTEMPT_LOGIN_COMPLETE),!!A.userAuthStateTracker.userInfo}))}attemptSilentNativeLogin(h,m){var y,C,T,P;return v(this,void 0,void 0,(function*(){if(!this.nativeAuth)return w.traceSource.info("Attempt to use silent native auth when it's turned off."),!1;let M;if(N.sessionStateTracker.point(D.TelemetryPropertyNames.SILENT_NATIVE_LOGIN_STARTING),m){const{cancellationTokenSource:h}=m;M=h&&h.token}this.shouldClearCache=!1,A.userAuthStateTracker.isCustomAccount=!1;let I=!1;yield x.auth.API.waitForInitialLogin;const L=k.Settings.get(R.SettingKeys.authenticationProvider);let B=U.SupportedAuthProviders[L];B||(B=U.SupportedAuthProviders.GitHub);const W=yield O.TimeTracker.timeIt("getCachedToken",()=>v(this,void 0,void 0,(function*(){return yield this.nativeAuth.getCachedToken(B)})));W&&(w.traceSource.info(`Attempt to log in with ${B} auth provider.`),I=yield O.TimeTracker.timeIt("attemptLoginWithNativeToken",()=>v(this,void 0,void 0,(function*(){return yield this.attemptLoginWithNativeToken(W,M)}))),I?(w.traceSource.info(`Authenticated with "${B}" auth provider.`),N.sessionStateTracker.point(D.TelemetryPropertyNames.SILENT_NATIVE_LOGIN_SIGNED_IN_WITH_NATIVE_PROVIDER),null===(y=null==m?void 0:m.telemetryEvent)||void 0===y||y.addProperty(D.TelemetryPropertyNames.SILENT_NATIVE_LOGIN_AUTH_PROVIDER,B)):this.nativeAuth.resetAccessTokenCache(B));const q=this.anonymousAuthStrategy;if(!I&&h.isAllowAnonymous&&q){N.sessionStateTracker.point(D.TelemetryPropertyNames.SILENT_NATIVE_LOGIN_ATTEMPTING_ANONYMOUS_STRATEGY);const h=yield q.getAccessToken();null===(C=null==m?void 0:m.telemetryEvent)||void 0===C||C.addProperty(D.TelemetryPropertyNames.SILENT_NATIVE_LOGIN_IS_ANONYMOUS_TOKEN_SET,!!h),h&&(w.traceSource.info("Attempt to log in as anonymous with previously acquired token."),I=yield this.attemptLoginWithNativeToken(h.accessToken,M)),I&&(w.traceSource.info("Authenticated as anonymous."),null===(T=null==m?void 0:m.telemetryEvent)||void 0===T||T.addProperty(D.TelemetryPropertyNames.SILENT_NATIVE_LOGIN_AUTH_PROVIDER,q.name),N.sessionStateTracker.point(D.TelemetryPropertyNames.SILENT_NATIVE_LOGIN_SIGNED_IN_AS_ANONYMOUS))}return null===(P=null==m?void 0:m.telemetryEvent)||void 0===P||P.addProperty(D.TelemetryPropertyNames.SILENT_NATIVE_LOGIN_RESULT,I),I}))}attemptPromptedNativeLogin(h){return v(this,void 0,void 0,(function*(){if(!this.nativeAuth)return w.traceSource.info("Attempt to use prompted native auth when it's turned off."),!1;let m;N.sessionStateTracker.point(D.TelemetryPropertyNames.PROMPTED_NATIVE_LOGIN_STARTING);const y=Object.entries(U.SupportedAuthProviders).map(([h,m])=>({label:h,description:B.localize("authentication.SignInPrompt").replace("${key}",h),id:m}));w.traceSource.info("Present auth provider picker.");const v=yield C.window.showQuickPick(y,{ignoreFocusOut:!0,placeHolder:B.localize("authentication.SignInPromptPlaceholder")});if(!v)throw w.traceSource.info("Auth provider picker has been cancelled by the user."),new T.CancellationError;m=v.id,k.Settings.save(R.SettingKeys.authenticationProvider,v.label);const{cancellationTokenSource:A}=h,P=A&&A.token;if(P&&P.isCancellationRequested)throw w.traceSource.info("Auth has been cancelled via cancellationToken before we've got an auth token."),N.sessionStateTracker.point(D.TelemetryPropertyNames.PROMPTED_NATIVE_LOGIN_CANCELED_VIA_CANCELLATION_TOKEN),new T.CancellationError;if(!m)throw w.traceSource.info("Auth has been cancelled by the user before we've got a token."),N.sessionStateTracker.point(D.TelemetryPropertyNames.PROMPTED_NATIVE_LOGIN_THE_USER_CANCELED_AUTH_PROVIDER_PICK),new T.CancellationError;h.telemetryEvent.addProperty(D.TelemetryPropertyNames.PROMPTED_NATIVE_LOGIN_SELECTED_AUTH_PROVIDER,m),w.traceSource.info(`Attempt to log in with ${m} auth provider.`);const M=yield this.nativeAuth.getCachedTokenOrLogin(m,h);if(P&&P.isCancellationRequested)throw w.traceSource.info("Auth cancelled after we've got a token."),N.sessionStateTracker.point(D.TelemetryPropertyNames.PROMPTED_NATIVE_LOGIN_CANCELED_VIA_CANCELLATION_TOKEN),new T.CancellationError;if(!M)throw N.sessionStateTracker.point(D.TelemetryPropertyNames.PROMPTED_NATIVE_LOGIN_FAILED_TO_ACQUIRE_AUTH_TOKEN),new Error(`Auth token returned by ${m} provider is empty.`);const I=yield this.attemptLoginWithNativeToken(M,P);return I?w.traceSource.info(`Authenticated with "${m}" auth provider.`):this.nativeAuth.resetAccessTokenCache(m),h.telemetryEvent.addProperty(D.TelemetryPropertyNames.PROMPTED_NATIVE_LOGIN_RESULT,I),I}))}attemptLoginWithNativeToken(h,m){return v(this,void 0,void 0,(function*(){return A.userAuthStateTracker.userInfo=yield this.authService.loginAsync({token:h},{cache:!1,cacheDefault:!1},null,m),!!A.userAuthStateTracker.userInfo}))}attemptAnonymousLoginVSCodeAccount(h,m){return v(this,void 0,void 0,(function*(){this.shouldClearCache=!1,N.sessionStateTracker.point(D.TelemetryPropertyNames.ATTEMPT_ANONYMOUS_LOGIN_STARTING);const h=this.anonymousAuthStrategy;if(!h)throw new Error("Anonymous login not supported");const y=yield x.auth.API.getTokensOrAskToSignIn({shouldSkipQuestion:!0,strategies:[h]});return!!y.length&&(yield this.attemptLoginVSCodeAccount(y[0],m),N.sessionStateTracker.point(D.TelemetryPropertyNames.ATTEMPT_ANONYMOUS_LOGIN_COMPLETE),!!A.userAuthStateTracker.userInfo)}))}attemptDefaultLoginVSCodeAccount(h,m){return v(this,void 0,void 0,(function*(){this.shouldClearCache=!1,N.sessionStateTracker.point(D.TelemetryPropertyNames.ATTEMPT_DEFAULT_LOGIN_STARTING),A.userAuthStateTracker.isCustomAccount=!1;const y=yield this.getDefaultStrategies(),v=this.anonymousAuthStrategy;h.isAllowAnonymous&&v&&y.push(v),yield x.auth.API.waitForInitialLogin;let C=yield x.auth.API.getCachedTokens({strategies:y});if(!C.length)return!1;yield this.waitForAuthenticateService();for(let h=0;h<C.length;h++){const y=getDefaultTokenToUse(C.slice(h),v);if(!y)return!1;if(yield this.attemptLoginVSCodeAccount(y,m)){w.traceSource.info(`Authenticated with "${y.strategy.name}" strategy.`);break}}return N.sessionStateTracker.point(D.TelemetryPropertyNames.ATTEMPT_DEFAULT_LOGIN_COMPLETE),!!A.userAuthStateTracker.userInfo}))}attemptLogin(h,m,y){return v(this,void 0,void 0,(function*(){this.shouldClearCache=!1,N.sessionStateTracker.point(D.TelemetryPropertyNames.ATTEMPT_LOGIN_STARTING),A.userAuthStateTracker.userInfo=yield this.authService.loginAsync({code:h},{cache:!0,cacheDefault:!0},null,y);let m=k.Settings.get(R.SettingKeys.account),v=k.Settings.get(R.SettingKeys.accountProvider);return A.userAuthStateTracker.isCustomAccount=!(!m&&!v),N.sessionStateTracker.point(D.TelemetryPropertyNames.ATTEMPT_LOGIN_COMPLETE),!!A.userAuthStateTracker.userInfo}))}signOut(){return v(this,void 0,void 0,(function*(){if(!this.isAuthenticated())return;const h=yield this.getDefaultStrategies();yield x.auth.API.logOut(h),yield this.authService.logoutAsync({cache:!0}),A.userAuthStateTracker.userInfo=void 0,N.sessionStateTracker.transition(I.SessionAction.SignOut)}))}get anonymousAuthStrategy(){return L.liveshareAnonymousStrategy}getDefaultStrategies(){return v(this,void 0,void 0,(function*(){return[x.auth.API.defaultStrategy,L.liveshareGithubStrategy]}))}waitForAuthenticateService(){return Promise.resolve()}waitForAuthenticatedUserToken(){return v(this,void 0,void 0,(function*(){let h,m=yield this.authService.getCurrentAuthenticatedUserAsync();return m&&m.accessToken?m.accessToken:yield new Promise(m=>h=this.authService.onAuthenticationChanged(y=>{y.accessToken&&(h.dispose(),m(y.accessToken))}))}))}}},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0});const v=y(0),C=y(466),T=y(53),w=y(25),A=y(12),P=y(14);m.ShareCommandUtilities=class ShareCommandUtilities{static buildShareInfo(){const h=(A.Settings.get(P.SettingKeys.anonymousGuestApproval)||"").toLowerCase(),m=C.getAllRootFileSystemPaths(),y=m.foundUnsupportedSchemes?v.workspace.workspaceFolders.filter(h=>(null==h?void 0:h.uri.scheme.toLowerCase())===T.PathManager.fileScheme):v.workspace.workspaceFolders,k=y&&y.length>0&&y[0]?y[0].name:w.localize("emptyWorkspace.liveShareWorkspace");return[{rootDirectories:m.paths,name:k,connectionMode:A.Settings.get(P.SettingKeys.connectionMode),areAnonymousGuestsAllowed:"reject"!==h},m]}}},function(h,m,y){"use strict";var v=this&&this.__awaiter||function(h,m,y,v){return new(y||(y=Promise))((function(C,T){function fulfilled(h){try{step(v.next(h))}catch(h){T(h)}}function rejected(h){try{step(v.throw(h))}catch(h){T(h)}}function step(h){h.done?C(h.value):function adopt(h){return h instanceof y?h:new y((function(m){m(h)}))}(h.value).then(fulfilled,rejected)}step((v=v.apply(h,m||[])).next())}))};Object.defineProperty(m,"__esModule",{value:!0});const C=y(0),T=y(24),w=y(26),A=y(95),P=y(23),k=y(22),R=y(4),M=y(5),N=y(14),D=y(12),I=y(178),x=y(1130);m.VSCODE_OPEN_EXTERNAL_URI_PREFIX="vscode://ms-vsliveshare.vsliveshare/join?vslsLink=";m.Commands=class Commands{constructor(h){this.coreDependencies=h,this.getWorkspaceSessionInfo=()=>{if(this.coreDependencies.sessionContext())return w.workspaceSessionInfoTracker.workspaceSessionInfo},this.removeUserCommandHandler=h=>v(this,void 0,void 0,(function*(){if(!h||void 0===h.sessionId)return;const{sessionId:m}=h;!m||m<1||(yield this.workspaceUserService.removeUserAsync(m,R.vsls.WorkspaceDisconnectedReason.UserRemoved))})),this.blockUserCommandHandler=h=>v(this,void 0,void 0,(function*(){if(!h||void 0===h.sessionId)return;const{sessionId:m}=h;!m||m<1||(yield this.workspaceUserService.removeUserAsync(m,R.vsls.WorkspaceDisconnectedReason.UserBlocked))})),this.openInVSCodeCommandHandler=()=>{const h=this.getWorkspaceSessionInfo();if(h)return C.env.openExternal(C.Uri.parse(`${m.VSCODE_OPEN_EXTERNAL_URI_PREFIX}${encodeURI(h.joinUri)}`)),Promise.resolve()},this.openInVSCommandHandler=()=>{const h=this.getWorkspaceSessionInfo();if(h)return C.env.openExternal(C.Uri.parse(`vsls:?action=join&workspaceId=${h.id}`)),Promise.resolve()}}initialize(){this.register(T.ExtensionUtil.context),this.initializeEvents(),D.Settings.get(N.SettingKeys.diagnosticLogging)?T.ExtensionUtil.setCommandContext("liveshare:logsEnabled",!0):T.ExtensionUtil.setCommandContext("liveshare:logsEnabled",!1)}get workspaceUserService(){return this.coreDependencies.workspaceUserService()}get sessionContext(){return this.coreDependencies.sessionContext()}get statusBarController(){return this.coreDependencies.statusBarController()}get workspaceAccessControlManager(){return this.coreDependencies.workspaceAccessControlManager()}register(h){h.subscriptions.push(T.ExtensionUtil.registerCommand("liveshare.collaboration.link.copy",this.copyCollaborationLinkCommandHandler,this)),h.subscriptions.push(T.ExtensionUtil.registerCommand("liveshare.collaboration.link.copyFromFileTreeExplorer",this.copyCollaborationLinkCommandHandler,this)),h.subscriptions.push(T.ExtensionUtil.registerCommand("liveshare.collaboration.link.copyFromActivityBar",this.copyCollaborationLinkCommandHandler,this)),h.subscriptions.push(T.ExtensionUtil.registerCommand("liveshare.removeParticipant",this.removeUserCommandHandler,this)),h.subscriptions.push(T.ExtensionUtil.registerCommand("liveshare.removeParticipantFromFileTreeExplorer",this.removeUserCommandHandler,this)),h.subscriptions.push(T.ExtensionUtil.registerCommand("liveshare.removeParticipantFromActivityBar",this.removeUserCommandHandler,this)),h.subscriptions.push(T.ExtensionUtil.registerCommand("liveshare.blockParticipant",this.blockUserCommandHandler,this)),h.subscriptions.push(T.ExtensionUtil.registerCommand("liveshare.blockParticipantFromFileTreeExplorer",this.blockUserCommandHandler,this)),h.subscriptions.push(T.ExtensionUtil.registerCommand("liveshare.blockParticipantFromActivityBar",this.blockUserCommandHandler,this)),h.subscriptions.push(T.ExtensionUtil.registerCommand("liveshare.help",()=>I.showWelcomePage(I.WelcomePageSource.Help))),h.subscriptions.push(T.ExtensionUtil.registerCommand("liveshare.openInVSCode",this.openInVSCodeCommandHandler,this)),h.subscriptions.push(T.ExtensionUtil.registerCommand("liveshare.exportLogs",()=>x.exportLogs(),this))}initializeEvents(){this.workspaceUserService.onWorkspaceSessionChanged(this.onWorkspaceSessionChanged,this)}onWorkspaceSessionChanged(h){return v(this,void 0,void 0,(function*(){try{this.sessionContext.collaboratorManager&&this.sessionContext.collaboratorManager.onWorkspaceSessionChanged(h),this.statusBarController&&this.statusBarController.onWorkspaceSessionChanged(h),this.sessionContext.coeditingClient&&this.sessionContext.coeditingClient.onWorkspaceSessionChanged(h),P.sessionStateTracker.State===k.SessionState.Shared&&(yield this.workspaceAccessControlManager.onWorkspaceSessionChanged(h))}catch(h){M.traceSource.error("onWorkspaceSessionChanged error",h)}}))}copyCollaborationLinkCommandHandler(){return v(this,void 0,void 0,(function*(){const h=this.getWorkspaceSessionInfo();if(!h)return;const m=h.joinUri;(yield(new A.ClipboardUtil).copyToClipboardAsync(m))?yield C.window.showInformationMessage("Invite link copied to clipboard! Send it to anyone you trust."):yield C.window.showInputBox({prompt:"Copy Live Share invitation link",value:m,ignoreFocusOut:!0})}))}}},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0});const v=y(0),C=y(5),T=y(161),w=y(215),A=y(18),P=y(7);m.exportLogs=async function exportLogs(h=!0){const m=await async function getLogZipPathAsync(h=!0){let m;if(h){const h=await v.window.showSaveDialog({filters:{"Zipped Log Files":["zip"]}});if(!h||!h.fsPath)return;m=h.fsPath}else m=P.join(A.tmpdir(),"LiveShareLogs.zip");return m}(h);m&&(await async function zipLogsAsync(h){await v.window.withProgress({location:v.ProgressLocation.Window},async()=>{await C.LogZipExporter.createLogZipFileAsync(h,w.LogFileTraceListener.defaultLogDirectory)})}(m),await async function notifyLogsExportedAsync(h,m){const y={title:"Go To Logs",isCloseAffordance:!1},C=m?`Live Share Logs exported to ${h}`:`Live Share logs have been successfully exported to ${h}. Please attach them to the GitHub issue that will be opened in your browser, or send them to vsls-feedback@microsoft.com `;return await v.window.showInformationMessage(C,y)===y}(m,h)&&T.ExtensionUtil.revealFileInOS(m))}},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0});const v=y(104),C=y(488),T=y(2),w=y(135),A=y(5),P=y(12),k=y(14);m.initLocalConnectionHub=T.once((h,m)=>new v.ConnectionHub((h||A.traceSource).createChild("localConnectionHub"),w.getOrCreatePerformance().createGroup("LocalConnectionHub"),m||C.LocalClientConnection)),m.joinWithLocalConnectionHub=(h,y,v)=>{const C={enableSignalRConnection:P.Settings.get("enableSignalRConnection"),connectionMode:P.Settings.get(k.SettingKeys.connectionMode),hubCrossRegionEnabled:P.Settings.get("hubCrossRegionEnabled"),traceHubData:P.Settings.get("traceHubData")},T=Object.assign(Object.assign({},y),{workspaceOptions:C});return m.initLocalConnectionHub(h,v).connectOnce(T)}},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0}),function(h){h[h.Reconnecting=1]="Reconnecting",h[h.Reconnected=2]="Reconnected",h[h.Closed=3]="Closed"}(m.ConnectedState||(m.ConnectedState={}))},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0}),function(h){h.Auto="auto",h.Direct="direct",h.Relay="relay",h.Local="local",h.SignalR="signalR"}(m.ConnectionMode||(m.ConnectionMode={}))},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0});m.LatencyMetrics=class LatencyMetrics{constructor(h,m,y,v){this.current=h,this.average=m,this.min=y,this.max=v}}},function(h,m,y){"use strict";var v=this&&this.__awaiter||function(h,m,y,v){return new(y||(y=Promise))((function(C,T){function fulfilled(h){try{step(v.next(h))}catch(h){T(h)}}function rejected(h){try{step(v.throw(h))}catch(h){T(h)}}function step(h){h.done?C(h.value):function adopt(h){return h instanceof y?h:new y((function(m){m(h)}))}(h.value).then(fulfilled,rejected)}step((v=v.apply(h,m||[])).next())}))},C=this&&this.__importStar||function(h){if(h&&h.__esModule)return h;var m={};if(null!=h)for(var y in h)Object.hasOwnProperty.call(h,y)&&(m[y]=h[y]);return m.default=h,m};Object.defineProperty(m,"__esModule",{value:!0});const T=y(15),w=y(200),A=y(2),P=C(y(29)),k=y(4);class WorkspaceApi{constructor(h,m,y){this.serviceUri=h,this.tokenProvider=m,this.logger=y,this.getRequestHeaders=()=>v(this,void 0,void 0,(function*(){return{Authorization:`Bearer ${yield this.tokenProvider()}`,"Cache-Control":"no-cache","Content-Type":"application/json"}})),A.assertDefined(h,"service uri needs to be defined");let C=h;C.endsWith("/")||(C+="/"),C.includes("api/v1.2")||(C+="api/v1.2"),this.baseUri=this.removeTrailingSlash(C),this.httpClient=new w.HttpClient(y)}static getWorkspaceSessionInfo(h,m,y){return v(this,void 0,void 0,(function*(){y.info(`getWorkspaceSessionInfo -> workspaceId:${h}`);const v=new WorkspaceApi(m.liveShareEndpoint,()=>m.token,y),[C,T]=yield Promise.all([v.getWorkspaceAccess(h),v.getWorkspaceInfo(h)]),w=Object.assign(Object.assign({},C),T);return A.assertDefined(T,"Cannot get LiveShare workspace info."),A.assertDefined(C,"Cannot get LiveShare workspace access."),A.assertDefined(T.relaySas,"No RelaySas token found."),w}))}deleteWorkspace(h){return v(this,void 0,void 0,(function*(){A.assertDefined(h,"Cannot get Live Share workspaceId"),h=h.toUpperCase();const m=`${this.baseUri}/workspace/${h}`;return this.logger.log(T.LogLevel.Debug,`delete workspace -> ${m}`),(yield this.httpClient.delete(m,{headers:yield this.getRequestHeaders()})).ok}))}getManagedWorkspaces(){return v(this,void 0,void 0,(function*(){const h=`${this.baseUri}/workspace/managed`;return this.logger.log(T.LogLevel.Debug,`get managed workspaces -> ${h}`),yield this.httpClient.get(h,{headers:yield this.getRequestHeaders()}).value()}))}deleteLink(h){return v(this,void 0,void 0,(function*(){A.assertDefined(h,"Cannot get Live Share workspaceId"),h=h.toUpperCase();const m=`${this.baseUri}/workspace/link/${h}`;return this.logger.log(T.LogLevel.Debug,`delete link -> ${m}`),(yield this.httpClient.delete(m,{headers:yield this.getRequestHeaders()})).ok}))}rename(h,m){return v(this,void 0,void 0,(function*(){const y=`${this.baseUri}/workspace/${h.toUpperCase()}`;return this.logger.log(T.LogLevel.Debug,`rename workspace -> ${y}`),yield this.httpClient.post(y,{headers:yield this.getRequestHeaders(),body:JSON.stringify(m)}).value()}))}getWorkspaceInfo(h){return v(this,void 0,void 0,(function*(){A.assertDefined(h,"Cannot get Live Share workspaceId"),h=h.toUpperCase();const m=`${this.baseUri}/workspace/${h}`;return this.logger.log(T.LogLevel.Debug,`get workspace info -> ${m}`),yield this.httpClient.get(m,{headers:yield this.getRequestHeaders()}).value()}))}getWorkspaceAccess(h){return v(this,void 0,void 0,(function*(){A.assertDefined(h,"Cannot get Live Share workspaceId"),h=h.toUpperCase();const m=`${this.baseUri}/workspace/${h}/user`;return this.logger.log(T.LogLevel.Debug,`get workspace access -> ${m}`),yield this.httpClient.put(m,{headers:yield this.getRequestHeaders()}).value()}))}postWorkspaceInfo(h){return v(this,void 0,void 0,(function*(){const m=`${this.baseUri}/workspace`;return this.logger.log(T.LogLevel.Debug,`post workspace info -> ${m}`),yield this.httpClient.post(m,{headers:yield this.getRequestHeaders(),body:JSON.stringify(h)}).value()}))}createInvitationLink(h){return v(this,void 0,void 0,(function*(){const m=`${this.baseUri}/workspace/${h.workspaceId}/link`;return yield this.httpClient.put(m,{headers:yield this.getRequestHeaders(),body:JSON.stringify(h)}).value()}))}getWorkspaceUserProfile(h,m){var y;return v(this,void 0,void 0,(function*(){A.assertDefined(h,"Cannot get Live Share workspaceId"),h=h.toUpperCase();const v=`${this.baseUri}/workspace/${h}/user`;this.logger.log(T.LogLevel.Debug,`get workspace user profile -> ${v}`);const C=yield this.httpClient.get(v,{headers:Object.assign(Object.assign({},yield this.getRequestHeaders()),{"User-Session-Token":m})}).value();return(null===(y=C)||void 0===y?void 0:y.username)&&(C.userName=C.username),C}))}static createSshKeys(){return v(this,void 0,void 0,(function*(){const h=P.SshAlgorithms.publicKey.rsaWithSha512,m=yield h.generateKeyPair(),y=(yield m.getPublicKeyBytes(m.keyAlgorithmName)).toString("base64");return[m,y]}))}createSharedWorkspace(h){var m;return v(this,void 0,void 0,(function*(){const y=yield WorkspaceApi.createSshKeys(),v={name:h.name,connectionMode:null!==(m=h.connectionMode)&&void 0!==m?m:k.vsls.ConnectionMode.Relay,areAnonymousGuestsAllowed:h.areAnonymousGuestsAllowed,hostPublicKeys:[y[1]],connectLinks:h.connectLinks},C=yield this.postWorkspaceInfo(v);return{workspaceInfo:C,hostPrivateKeys:[y[0]],getWorkspaceUserProfile:h=>this.getWorkspaceUserProfile(C.id,h)}}))}removeTrailingSlash(h){return h.endsWith("/")?h.substr(0,h.length-1):h}}m.WorkspaceApi=WorkspaceApi},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0});const v=new WeakMap,C=new WeakMap;function pd(h){const m=v.get(h);return console.assert(null!=m,"'this' is expected an Event object, but got",h),m}function setCancelFlag(h){null==h.passiveListener?h.event.cancelable&&(h.canceled=!0,"function"==typeof h.event.preventDefault&&h.event.preventDefault()):"undefined"!=typeof console&&"function"==typeof console.error&&console.error("Unable to preventDefault inside passive event listener invocation.",h.passiveListener)}function Event(h,m){v.set(this,{eventTarget:h,event:m,eventPhase:2,currentTarget:h,canceled:!1,stopped:!1,immediateStopped:!1,passiveListener:null,timeStamp:m.timeStamp||Date.now()}),Object.defineProperty(this,"isTrusted",{value:!1,enumerable:!0});const y=Object.keys(m);for(let h=0;h<y.length;++h){const m=y[h];m in this||Object.defineProperty(this,m,defineRedirectDescriptor(m))}}function defineRedirectDescriptor(h){return{get(){return pd(this).event[h]},set(m){pd(this).event[h]=m},configurable:!0,enumerable:!0}}function defineCallDescriptor(h){return{value(){const m=pd(this).event;return m[h].apply(m,arguments)},configurable:!0,enumerable:!0}}function getWrapper(h){if(null==h||h===Object.prototype)return Event;let m=C.get(h);return null==m&&(m=function defineWrapper(h,m){const y=Object.keys(m);if(0===y.length)return h;function CustomEvent(m,y){h.call(this,m,y)}CustomEvent.prototype=Object.create(h.prototype,{constructor:{value:CustomEvent,configurable:!0,writable:!0}});for(let v=0;v<y.length;++v){const C=y[v];if(!(C in h.prototype)){const h="function"==typeof Object.getOwnPropertyDescriptor(m,C).value;Object.defineProperty(CustomEvent.prototype,C,h?defineCallDescriptor(C):defineRedirectDescriptor(C))}}return CustomEvent}(getWrapper(Object.getPrototypeOf(h)),h),C.set(h,m)),m}function isStopped(h){return pd(h).immediateStopped}function setPassiveListener(h,m){pd(h).passiveListener=m}Event.prototype={get type(){return pd(this).event.type},get target(){return pd(this).eventTarget},get currentTarget(){return pd(this).currentTarget},composedPath(){const h=pd(this).currentTarget;return null==h?[]:[h]},get NONE(){return 0},get CAPTURING_PHASE(){return 1},get AT_TARGET(){return 2},get BUBBLING_PHASE(){return 3},get eventPhase(){return pd(this).eventPhase},stopPropagation(){const h=pd(this);h.stopped=!0,"function"==typeof h.event.stopPropagation&&h.event.stopPropagation()},stopImmediatePropagation(){const h=pd(this);h.stopped=!0,h.immediateStopped=!0,"function"==typeof h.event.stopImmediatePropagation&&h.event.stopImmediatePropagation()},get bubbles(){return Boolean(pd(this).event.bubbles)},get cancelable(){return Boolean(pd(this).event.cancelable)},preventDefault(){setCancelFlag(pd(this))},get defaultPrevented(){return pd(this).canceled},get composed(){return Boolean(pd(this).event.composed)},get timeStamp(){return pd(this).timeStamp},get srcElement(){return pd(this).eventTarget},get cancelBubble(){return pd(this).stopped},set cancelBubble(h){if(!h)return;const m=pd(this);m.stopped=!0,"boolean"==typeof m.event.cancelBubble&&(m.event.cancelBubble=!0)},get returnValue(){return!pd(this).canceled},set returnValue(h){h||setCancelFlag(pd(this))},initEvent(){}},Object.defineProperty(Event.prototype,"constructor",{value:Event,configurable:!0,writable:!0}),"undefined"!=typeof window&&void 0!==window.Event&&(Object.setPrototypeOf(Event.prototype,window.Event.prototype),C.set(window.Event.prototype,Event));const T=new WeakMap;function isObject(h){return null!==h&&"object"==typeof h}function getListeners(h){const m=T.get(h);if(null==m)throw new TypeError("'this' is expected an EventTarget object, but got another value.");return m}function defineEventAttribute(h,m){Object.defineProperty(h,`on${m}`,function defineEventAttributeDescriptor(h){return{get(){let m=getListeners(this).get(h);for(;null!=m;){if(3===m.listenerType)return m.listener;m=m.next}return null},set(m){"function"==typeof m||isObject(m)||(m=null);const y=getListeners(this);let v=null,C=y.get(h);for(;null!=C;)3===C.listenerType?null!==v?v.next=C.next:null!==C.next?y.set(h,C.next):y.delete(h):v=C,C=C.next;if(null!==m){const C={listener:m,listenerType:3,passive:!1,once:!1,next:null};null===v?y.set(h,C):v.next=C}},configurable:!0,enumerable:!0}}(m))}function defineCustomEventTarget(h){function CustomEventTarget(){EventTarget.call(this)}CustomEventTarget.prototype=Object.create(EventTarget.prototype,{constructor:{value:CustomEventTarget,configurable:!0,writable:!0}});for(let m=0;m<h.length;++m)defineEventAttribute(CustomEventTarget.prototype,h[m]);return CustomEventTarget}function EventTarget(){if(!(this instanceof EventTarget)){if(1===arguments.length&&Array.isArray(arguments[0]))return defineCustomEventTarget(arguments[0]);if(arguments.length>0){const h=new Array(arguments.length);for(let m=0;m<arguments.length;++m)h[m]=arguments[m];return defineCustomEventTarget(h)}throw new TypeError("Cannot call a class as a function")}T.set(this,new Map)}EventTarget.prototype={addEventListener(h,m,y){if(null==m)return;if("function"!=typeof m&&!isObject(m))throw new TypeError("'listener' should be a function or an object.");const v=getListeners(this),C=isObject(y),T=(C?Boolean(y.capture):Boolean(y))?1:2,w={listener:m,listenerType:T,passive:C&&Boolean(y.passive),once:C&&Boolean(y.once),next:null};let A=v.get(h);if(void 0===A)return void v.set(h,w);let P=null;for(;null!=A;){if(A.listener===m&&A.listenerType===T)return;P=A,A=A.next}P.next=w},removeEventListener(h,m,y){if(null==m)return;const v=getListeners(this),C=(isObject(y)?Boolean(y.capture):Boolean(y))?1:2;let T=null,w=v.get(h);for(;null!=w;){if(w.listener===m&&w.listenerType===C)return void(null!==T?T.next=w.next:null!==w.next?v.set(h,w.next):v.delete(h));T=w,w=w.next}},dispatchEvent(h){if(null==h||"string"!=typeof h.type)throw new TypeError('"event.type" should be a string.');const m=getListeners(this),y=h.type;let v=m.get(y);if(null==v)return!0;const C=function wrapEvent(h,m){return new(getWrapper(Object.getPrototypeOf(m)))(h,m)}(this,h);let T=null;for(;null!=v;){if(v.once?null!==T?T.next=v.next:null!==v.next?m.set(y,v.next):m.delete(y):T=v,setPassiveListener(C,v.passive?v.listener:null),"function"==typeof v.listener)try{v.listener.call(this,C)}catch(h){"undefined"!=typeof console&&"function"==typeof console.error&&console.error(h)}else 3!==v.listenerType&&"function"==typeof v.listener.handleEvent&&v.listener.handleEvent(C);if(isStopped(C))break;v=v.next}return setPassiveListener(C,null),function setEventPhase(h,m){pd(h).eventPhase=m}(C,0),function setCurrentTarget(h,m){pd(h).currentTarget=m}(C,null),!C.defaultPrevented}},Object.defineProperty(EventTarget.prototype,"constructor",{value:EventTarget,configurable:!0,writable:!0}),"undefined"!=typeof window&&void 0!==window.EventTarget&&Object.setPrototypeOf(EventTarget.prototype,window.EventTarget.prototype),m.defineEventAttribute=defineEventAttribute,m.EventTarget=EventTarget,m.default=EventTarget,h.exports=EventTarget,h.exports.EventTarget=h.exports.default=EventTarget,h.exports.defineEventAttribute=defineEventAttribute},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0}),m.workspaceServiceClient={name:"workspaceServiceClient",methods:["getSessionInfo","join","disconnect","openStreamingChannel","keepAlive","checkConnection","setCheckConnectionOptions"],events:["hostConnectionChanged","workspaceMetricsUpdated"]}},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0});class NoHostConnectedError extends Error{constructor(h){super(`Host not connected to workspace:${h}`),this.workspaceId=h}}m.NoHostConnectedError=NoHostConnectedError,function(h){h[h.ConnectionError=1]="ConnectionError",h[h.SasInvalid=2]="SasInvalid",h[h.EndpointNotFound=3]="EndpointNotFound",h[h.ListenerOffline=4]="ListenerOffline",h[h.ServerError=5]="ServerError"}(m.RelayErrorType||(m.RelayErrorType={}));class RelayConnectionError extends Error{constructor(h,m){super(h),this.errorContext=m}}m.RelayConnectionError=RelayConnectionError},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0}),m.RPC_ERR_NO_HOST_NOT_CONNECTED=270,m.RPC_ERR_RELAY_CONNECTIONY_SSH=271},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0});class TelemetryEventNames{}m.TelemetryEventNames=TelemetryEventNames,TelemetryEventNames.WORKSPACE_RECONNECT="workspace-reconnect";class TelemetryPropertyNames{}m.TelemetryPropertyNames=TelemetryPropertyNames,TelemetryPropertyNames.RECONNECT_SUCCEEDED="reconnect-succeeded",TelemetryPropertyNames.RECONNECT_ELAPSED="reconnect-elapsed",TelemetryPropertyNames.RECONNECT_RETRY_COUNT="reconnect-retry-count",TelemetryPropertyNames.RECONNECT_ERROR_MESSAGE="reconnect-error-message",TelemetryPropertyNames.RECONNECT_ERROR_REASON="reconnect-error-reason"},function(h,m,y){"use strict";var v=this&&this.__importStar||function(h){if(h&&h.__esModule)return h;var m={};if(null!=h)for(var y in h)Object.hasOwnProperty.call(h,y)&&(m[y]=h[y]);return m.default=h,m};Object.defineProperty(m,"__esModule",{value:!0});const C=v(y(6)),T=y(2),w=y(469),A=y(16);class WorkspaceClientBase extends T.DisposableClass{constructor(h,m){super(m),this.rcpClientInstance=h,this.onHostConnectionChangedEmitter=new C.Emitter,this.onHostConnectionChanged=this.onHostConnectionChangedEmitter.event,this.onWorkspaceMetricsUpdatedEmitter=new C.Emitter,this.onWorkspaceMetricsUpdated=this.onWorkspaceMetricsUpdatedEmitter.event,this.rpcProxyCache=new A.RpcProxyCache(this.rcpClientInstance,m),this.addToDisposables(T.createDisposable(()=>{this.stopCheckConnection("disposed")}))}get rpcClient(){return this.rcpClientInstance}getServiceProxy(h,m){return this.rpcProxyCache.getOrCreate(h,m)}setCheckConnectionOptions(h){return h.enabled&&void 0===this.checkConnectionDisposable&&!this.isDisposed?(this.ensureIsJoined(),this.checkConnectionDisposable=w.checkWorkspaceClient(this,this.trace,h.metricsTimeout,h.checkConnectionTimeout,()=>this.canCheckConnection())):h.enabled||this.stopCheckConnection("connection options"),Promise.resolve()}ensureIsJoined(){}canCheckConnection(){return!0}stopCheckConnection(h){this.trace.info(`stopCheckConnection reason:'${h}'`),void 0!==this.checkConnectionDisposable&&(this.checkConnectionDisposable.dispose(),this.checkConnectionDisposable=void 0)}}m.WorkspaceClientBase=WorkspaceClientBase},function(h,m,y){"use strict";var v=this&&this.__awaiter||function(h,m,y,v){return new(y||(y=Promise))((function(C,T){function fulfilled(h){try{step(v.next(h))}catch(h){T(h)}}function rejected(h){try{step(v.throw(h))}catch(h){T(h)}}function step(h){h.done?C(h.value):function adopt(h){return h instanceof y?h:new y((function(m){m(h)}))}(h.value).then(fulfilled,rejected)}step((v=v.apply(h,m||[])).next())}))},C=this&&this.__importStar||function(h){if(h&&h.__esModule)return h;var m={};if(null!=h)for(var y in h)Object.hasOwnProperty.call(h,y)&&(m[y]=h[y]);return m.default=h,m};Object.defineProperty(m,"__esModule",{value:!0});const T=C(y(29)),w=y(2),A=y(16),P=y(39),k=y(4),R=y(1143),M=y(8);class WorkspaceClient extends P.WorkspaceClientBase{constructor(h,m,y){super(new A.RpcClient({create:h=>this.rpcConnected.promise},h),h),this.socketStreamFactory=m,this.sshReconnectOptions=y,this.checkConnectionMutex=new w.Mutex,this.rpcConnected=new w.Signal}join(h){var m;return v(this,void 0,void 0,(function*(){const y=null!==(m=h.performance)&&void 0!==m?m:{measure:(h,m)=>m()};w.assertDefined(h.connectionInfo||h.sessionInfoFactory||0!==h.liveShareEndpoint.length,"join connect options expected");const v=yield this.getSessionInfo(h,y);if(!1===v.isHostConnected)throw new P.NoHostConnectedError(h.workspaceId);this.sshWorkspaceSession=yield this.createWorkspaceSession(y,v),y.measure({id:"ssh-auth-completion",name:"Ssh auth completion"},()=>this.sshWorkspaceSession.authCompletion).catch(h=>{this.trace.error("auth failed")}),this.addToDisposables(this.sshWorkspaceSession);const C=this.sshWorkspaceSession.sshSession,fireMetricsUpdated=(h,m,y)=>{this.onWorkspaceMetricsUpdatedEmitter.fire({bytesIn:h,bytesOut:m,latency:y})};null==C||C.metrics.onMessageReceived(()=>{fireMetricsUpdated(C.metrics.bytesReceived,void 0,void 0)}),null==C||C.metrics.onMessageSent(()=>{fireMetricsUpdated(void 0,C.metrics.bytesSent,void 0)}),null==C||C.metrics.onLatencyUpdated(()=>{const h=new P.LatencyMetrics(C.metrics.latencyCurrentMs,C.metrics.latencyAverageMs,C.metrics.latencyMinMs,C.metrics.latencyMaxMs);fireMetricsUpdated(void 0,void 0,h)}),this.trace.info("join started");const{clientVersionInfo:T,workspaceJoinInfo:A,clientCapabilities:k}=h,R=y.measure({id:"join-internal",name:"Joining the workspace"},()=>this.joinInternal(v,null!=T?T:{},A,k));return yield Promise.all([this.sshWorkspaceSession.authCompletion,R]),this.onWorkspaceSessionConnectionChange(h),h.checkConnectionOptions&&(yield this.setCheckConnectionOptions(h.checkConnectionOptions)),this.workspaceSessionInfo}))}ensureIsJoined(){w.assertDefined(this.sshWorkspaceSession,"Ssh session not initiated yet")}canCheckConnection(){var h;return!1===(null===(h=this.sshWorkspaceSession)||void 0===h?void 0:h.isReconnecting)}createWorkspaceSession(h,m){return v(this,void 0,void 0,(function*(){return yield h.measure({id:"createSshWorkspaceSession",name:"Creating the ssh workspace session"},()=>R.SshWorkspaceSessionFactory.createSshWorkspaceSession(m,this.trace,this.socketStreamFactory,this.sshReconnectOptions))}))}onWorkspaceSessionConnectionChange(h){var m;const sendReconnectEvent=(m,y)=>{var v;const C=new M.TelemetryEvent(P.TelemetryEventNames.WORKSPACE_RECONNECT),w=h.telemetryProperties;if(w&&Object.keys(w).forEach(h=>C.addProperty(h,w[h])),C.addProperty(M.TelemetryPropertyNames.FEATURE_NAME+P.TelemetryPropertyNames.RECONNECT_SUCCEEDED,void 0===y.error),C.addProperty(M.TelemetryPropertyNames.FEATURE_NAME+P.TelemetryPropertyNames.RECONNECT_ELAPSED,m),C.addProperty(M.TelemetryPropertyNames.FEATURE_NAME+P.TelemetryPropertyNames.RECONNECT_RETRY_COUNT,y.retryCount),void 0!==y.error){if(y.error instanceof T.SshReconnectError){const h=null!==(v=y.error.reason)&&void 0!==v?v:T.SshReconnectFailureReason.unknownClientFailure;C.addProperty(M.TelemetryPropertyNames.FEATURE_NAME+P.TelemetryPropertyNames.RECONNECT_ERROR_REASON,h)}C.addProperty(M.TelemetryPropertyNames.FEATURE_NAME+P.TelemetryPropertyNames.RECONNECT_ERROR_MESSAGE,y.error.message)}C.send()};let y;null===(m=this.sshWorkspaceSession)||void 0===m||m.onConnectedStateChanged(h=>{const m=y?Date.now()-y:0;h.state===P.ConnectedState.Reconnecting?y=Date.now():(h.state===P.ConnectedState.Reconnected||h.state===P.ConnectedState.Closed)&&(y&&sendReconnectEvent(m,h),y=void 0),this.onHostConnectionChangedEmitter.fire({state:h.state,duration:m})}),this.trace.info("join completed")}disconnect(){return v(this,void 0,void 0,(function*(){if(this.workspaceSessionInfo){const h=this.workspaceSessionInfo;this.workspaceSessionInfo=void 0,this.trace.info("unjoing"),yield this.getServiceProxy(k.vsls.WorkspaceService).unjoinWorkspaceAsync(h.id),this.dispose("disconnect")}}))}getSessionInfo(h,m){return v(this,void 0,void 0,(function*(){return h.connectionInfo?h.connectionInfo:h.sessionInfoFactory?yield h.sessionInfoFactory(h.workspaceId):yield m.measure({id:"workspaceApi-getWorkspaceSessionInfo",name:"get workspace session info from liveshare"},()=>P.WorkspaceApi.getWorkspaceSessionInfo(h.workspaceId,h,this.trace.createChild("WorkspaceApi")))}))}joinInternal(h,m,y,C){return v(this,void 0,void 0,(function*(){const v=yield this.sshWorkspaceSession.createRpcMessageStream(),T=[],w=v.reader.listen.bind(v.reader);let A;v.reader.listen=h=>{A=h,w(m=>{!this.rpcConnected.isFulfilled&&m.hasOwnProperty("method")&&T.push(m),h(m)})};const P=this.rcpClientInstance.createRpcConnection(v,this.trace);P.listen();const R=this.getServiceProxyWithConnection(P,k.vsls.ConfigurationService),M=yield R.exchangeVersionsAsync({},m);this.trace.info("Host version: "+JSON.stringify(M)),C||((C=new k.vsls.ClientCapabilities).isNonInteractive=!1);let N={id:h.id,connectionMode:k.vsls.ConnectionMode.Local,joiningUserSessionToken:h.sessionToken,clientCapabilities:C};y&&(N=Object.assign(Object.assign({},N),y));const D=this.getServiceProxyWithConnection(P,{name:k.vsls.WorkspaceService.name,methods:k.vsls.WorkspaceService.methods,voidMethods:k.vsls.WorkspaceService.voidMethods,events:[]});this.workspaceSessionInfo=yield D.joinWorkspaceAsync(N),this.rpcConnected.resolve(P),T.forEach(h=>{A(h)}),this.trace.info(`joinWorkspace -> session:${this.workspaceSessionInfo.sessionNumber} conversation:${this.workspaceSessionInfo.conversationId} join messages count:${T.length}`)}))}getServiceProxyWithConnection(h,m){return A.RpcProxy.createWithConnection(m,h,this.trace)}openStreamingChannel(h,m){return v(this,void 0,void 0,(function*(){return w.assertDefined(this.sshWorkspaceSession,"Ssh session not initiated yet"),this.trace.info(`openStreamingChannel -> streamId:${h}`),yield this.sshWorkspaceSession.openStreamingChannel(h,m)}))}checkConnection(h){return v(this,void 0,void 0,(function*(){w.assertDefined(this.sshWorkspaceSession,"Ssh session not initiated yet"),this.trace.verbose("checking ssh connection");const m=this.sshWorkspaceSession.sshSession;w.assert(!m.isClosed,"ssh session is closed");const y=new T.SessionRequestMessage("ping-check-connection",!0);yield this.checkConnectionMutex.dispatch(()=>m.request(y,h))}))}}m.WorkspaceClient=WorkspaceClient},function(h,m,y){"use strict";var v=this&&this.__awaiter||function(h,m,y,v){return new(y||(y=Promise))((function(C,T){function fulfilled(h){try{step(v.next(h))}catch(h){T(h)}}function rejected(h){try{step(v.throw(h))}catch(h){T(h)}}function step(h){h.done?C(h.value):function adopt(h){return h instanceof y?h:new y((function(m){m(h)}))}(h.value).then(fulfilled,rejected)}step((v=v.apply(h,m||[])).next())}))},C=this&&this.__importStar||function(h){if(h&&h.__esModule)return h;var m={};if(null!=h)for(var y in h)Object.hasOwnProperty.call(h,y)&&(m[y]=h[y]);return m.default=h,m},T=this&&this.__importDefault||function(h){return h&&h.__esModule?h:{default:h}};Object.defineProperty(m,"__esModule",{value:!0});const w=C(y(29)),A=y(2),P=y(470),k=y(1165),R=T(y(164)),M=60*A.TIME_SECOND_MS,N=5*A.TIME_SECOND_MS,D=5*A.TIME_SECOND_MS;m.SshWorkspaceSessionFactory=class SshWorkspaceSessionFactory{static createSshWorkspaceSession(h,m,y,C){return v(this,void 0,void 0,(function*(){const T=y||P.SshHelpers.openConnection,I=m.createChild("ssh");R.default.enable(R.default.disable()+",vs-ssh"),"object"==typeof R.default.inspectOpts&&(R.default.inspectOpts.hideDate=!0);const x=R.default.log;R.default.log=function(...h){"vs-ssh"===this.namespace?I.info(h[0],...h.slice(1)):x()};const O=C||{enabled:!0};let L=yield T(h,m);const U=yield P.SshHelpers.createSshClientSession(),B=new w.PromiseCompletionSource;return m.verbose("authenticating..."),yield P.SshHelpers.authenticate(U,h,h,L,B),new k.SshWorkspaceSession(U,B.promise,m.createChild("SshWorkspaceSession"),O.enabled?()=>v(this,void 0,void 0,(function*(){const y=O.maxTimeReconnect||M,v=O.retryTimeout||N;m.info(`reconnect started maxTimeReconnect:${y} retryTimeout:${v}`);const C=Date.now();let P,k=1;for(;Date.now()-C<=y&&!U.isClosed;){try{L=yield T(h,m),m.info(`reconnecting ssh session retryCount:${k}`),yield A.timeoutPromise(U.reconnect(L),D,new Error("timeout on ssh reconnection")),m.info(`ssh session successfully reconnected on retryCount:${k} time:${(Date.now()-C).toFixed(1)}`),P=void 0;break}catch(h){if(P=h,h instanceof w.SshReconnectError){m.error(`failed to reconnect ssh session: ${h.message}`);break}m.verbose(`failed to reconnect ssh session retryCount:${k} error:${h}`),yield A.wait(v)}++k}return P&&(m.error(`unable to reconnect ssh session -> retryCount:${k}`),U.dispose()),{retryCount:k,error:P}})):void 0)}))}}},function(h,m,y){h.exports=y(1145)},function(h,m,y){h.exports={server:y(1146),client:y(476),router:y(1155),frame:y(474),request:y(473),connection:y(268),w3cwebsocket:y(1157),deprecation:y(1161),version:y(1162)}},function(h,m,y){var v=y(79).extend,C=y(79),T=y(10),w=y(471)("websocket:server"),A=y(13).EventEmitter,P=y(473),k=function WebSocketServer(h){A.call(this),this._handlers={upgrade:this.handleUpgrade.bind(this),requestAccepted:this.handleRequestAccepted.bind(this),requestResolved:this.handleRequestResolved.bind(this)},this.connections=[],this.pendingRequests=[],h&&this.mount(h)};T.inherits(k,A),k.prototype.mount=function(h){if(this.config={httpServer:null,maxReceivedFrameSize:65536,maxReceivedMessageSize:1048576,fragmentOutgoingMessages:!0,fragmentationThreshold:16384,keepalive:!0,keepaliveInterval:2e4,dropConnectionOnKeepaliveTimeout:!0,keepaliveGracePeriod:1e4,useNativeKeepalive:!1,assembleFragments:!0,autoAcceptConnections:!1,ignoreXForwardedFor:!1,parseCookies:!0,parseExtensions:!0,disableNagleAlgorithm:!0,closeTimeout:5e3},v(this.config,h),!this.config.httpServer)throw new Error("You must specify an httpServer on which to mount the WebSocket server.");Array.isArray(this.config.httpServer)||(this.config.httpServer=[this.config.httpServer]);var m=this._handlers.upgrade;this.config.httpServer.forEach((function(h){h.on("upgrade",m)}))},k.prototype.unmount=function(){var h=this._handlers.upgrade;this.config.httpServer.forEach((function(m){m.removeListener("upgrade",h)}))},k.prototype.closeAllConnections=function(){this.connections.forEach((function(h){h.close()})),this.pendingRequests.forEach((function(h){process.nextTick((function(){h.reject(503)}))}))},k.prototype.broadcast=function(h){Buffer.isBuffer(h)?this.broadcastBytes(h):"function"==typeof h.toString&&this.broadcastUTF(h)},k.prototype.broadcastUTF=function(h){this.connections.forEach((function(m){m.sendUTF(h)}))},k.prototype.broadcastBytes=function(h){this.connections.forEach((function(m){m.sendBytes(h)}))},k.prototype.shutDown=function(){this.unmount(),this.closeAllConnections()},k.prototype.handleUpgrade=function(h,m){var y=this,v=new P(m,h,this.config);try{v.readHandshake()}catch(h){return v.reject(h.httpCode?h.httpCode:400,h.message,h.headers),w("Invalid handshake: %s",h.message),void this.emit("upgradeError",h)}this.pendingRequests.push(v),v.once("requestAccepted",this._handlers.requestAccepted),v.once("requestResolved",this._handlers.requestResolved),m.once("close",(function(){y._handlers.requestResolved(v)})),!this.config.autoAcceptConnections&&C.eventEmitterListenerCount(this,"request")>0?this.emit("request",v):this.config.autoAcceptConnections?v.accept(v.requestedProtocols[0],v.origin):v.reject(404,"No handler is configured to accept the connection.")},k.prototype.handleRequestAccepted=function(h){var m=this;h.once("close",(function(y,v){m.handleConnectionClose(h,y,v)})),this.connections.push(h),this.emit("connect",h)},k.prototype.handleConnectionClose=function(h,m,y){var v=this.connections.indexOf(h);-1!==v&&this.connections.splice(v,1),this.emit("close",h,m,y)},k.prototype.handleRequestResolved=function(h){var m=this.pendingRequests.indexOf(h);-1!==m&&this.pendingRequests.splice(m,1)},h.exports=k},function(h,m,y){function load(){var h;try{h=m.storage.debug}catch(h){}return!h&&"undefined"!=typeof process&&"env"in process&&(h=process.env.DEBUG),h}(m=h.exports=y(472)).log=function log(){return"object"==typeof console&&console.log&&Function.prototype.apply.call(console.log,console,arguments)},m.formatArgs=function formatArgs(h){var y=this.useColors;if(h[0]=(y?"%c":"")+this.namespace+(y?" %c":" ")+h[0]+(y?"%c ":" ")+"+"+m.humanize(this.diff),!y)return;var v="color: "+this.color;h.splice(1,0,v,"color: inherit");var C=0,T=0;h[0].replace(/%[a-zA-Z%]/g,(function(h){"%%"!==h&&(C++,"%c"===h&&(T=C))})),h.splice(T,0,v)},m.save=function save(h){try{null==h?m.storage.removeItem("debug"):m.storage.debug=h}catch(h){}},m.load=load,m.useColors=function useColors(){if("undefined"!=typeof window&&window.process&&"renderer"===window.process.type)return!0;return"undefined"!=typeof document&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||"undefined"!=typeof window&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)},m.storage="undefined"!=typeof chrome&&void 0!==chrome.storage?chrome.storage.local:function localstorage(){try{return window.localStorage}catch(h){}}(),m.colors=["lightseagreen","forestgreen","goldenrod","dodgerblue","darkorchid","crimson"],m.formatters.j=function(h){try{return JSON.stringify(h)}catch(h){return"[UnexpectedJSONParseError]: "+h.message}},m.enable(load())},function(h,m){var y=1e3,v=6e4,C=60*v,T=24*C;function plural(h,m,y){if(!(h<m))return h<1.5*m?Math.floor(h/m)+" "+y:Math.ceil(h/m)+" "+y+"s"}h.exports=function(h,m){m=m||{};var w=typeof h;if("string"===w&&h.length>0)return function parse(h){if((h=String(h)).length>100)return;var m=/^((?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|years?|yrs?|y)?$/i.exec(h);if(!m)return;var w=parseFloat(m[1]);switch((m[2]||"ms").toLowerCase()){case"years":case"year":case"yrs":case"yr":case"y":return 315576e5*w;case"days":case"day":case"d":return w*T;case"hours":case"hour":case"hrs":case"hr":case"h":return w*C;case"minutes":case"minute":case"mins":case"min":case"m":return w*v;case"seconds":case"second":case"secs":case"sec":case"s":return w*y;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return w;default:return}}(h);if("number"===w&&!1===isNaN(h))return m.long?function fmtLong(h){return plural(h,T,"day")||plural(h,C,"hour")||plural(h,v,"minute")||plural(h,y,"second")||h+" ms"}(h):function fmtShort(h){if(h>=T)return Math.round(h/T)+"d";if(h>=C)return Math.round(h/C)+"h";if(h>=v)return Math.round(h/v)+"m";if(h>=y)return Math.round(h/y)+"s";return h+"ms"}(h);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(h))}},function(h,m,y){var v=y(88),C=y(10);(m=h.exports=y(472)).init=function init(h){h.inspectOpts={};for(var y=Object.keys(m.inspectOpts),v=0;v<y.length;v++)h.inspectOpts[y[v]]=m.inspectOpts[y[v]]},m.log=function log(){return w.write(C.format.apply(C,arguments)+"\n")},m.formatArgs=function formatArgs(h){var y=this.namespace;if(this.useColors){var v=this.color,C="  [3"+v+";1m"+y+" [0m";h[0]=C+h[0].split("\n").join("\n"+C),h.push("[3"+v+"m+"+m.humanize(this.diff)+"[0m")}else h[0]=(new Date).toUTCString()+" "+y+" "+h[0]},m.save=function save(h){null==h?delete process.env.DEBUG:process.env.DEBUG=h},m.load=load,m.useColors=function useColors(){return"colors"in m.inspectOpts?Boolean(m.inspectOpts.colors):v.isatty(T)},m.colors=[6,2,3,4,5,1],m.inspectOpts=Object.keys(process.env).filter((function(h){return/^debug_/i.test(h)})).reduce((function(h,m){var y=m.substring(6).toLowerCase().replace(/_([a-z])/g,(function(h,m){return m.toUpperCase()})),v=process.env[m];return v=!!/^(yes|on|true|enabled)$/i.test(v)||!/^(no|off|false|disabled)$/i.test(v)&&("null"===v?null:Number(v)),h[y]=v,h}),{});var T=parseInt(process.env.DEBUG_FD,10)||2;1!==T&&2!==T&&C.deprecate((function(){}),"except for stderr(2) and stdout(1), any other usage of DEBUG_FD is deprecated. Override debug.log if you want to use a different log function (https://git.io/debug_fd)")();var w=1===T?process.stdout:2===T?process.stderr:function createWritableStdioStream(h){var m;switch(process.binding("tty_wrap").guessHandleType(h)){case"TTY":(m=new v.WriteStream(h))._type="tty",m._handle&&m._handle.unref&&m._handle.unref();break;case"FILE":var C=y(21);(m=new C.SyncWriteStream(h,{autoClose:!1}))._type="fs";break;case"PIPE":case"TCP":var T=y(31);(m=new T.Socket({fd:h,readable:!1,writable:!0})).readable=!1,m.read=null,m._type="pipe",m._handle&&m._handle.unref&&m._handle.unref();break;default:throw new Error("Implement me. Unknown stream file type!")}return m.fd=h,m._isStdio=!0,m}(T);function load(){return process.env.DEBUG}m.formatters.o=function(h){return this.inspectOpts.colors=this.useColors,C.inspect(h,this.inspectOpts).split("\n").map((function(h){return h.trim()})).join(" ")},m.formatters.O=function(h){return this.inspectOpts.colors=this.useColors,C.inspect(h,this.inspectOpts)},m.enable(load())},function(h,m,y){"use strict";try{h.exports=y(475)(__dirname)}catch(m){h.exports=y(1151)}},function(h,m,y){"use strict";h.exports={mask:(h,m,y,v,C)=>{for(var T=0;T<C;T++)y[v+T]=h[T]^m[3&T]},unmask:(h,m)=>{const y=h.length;for(var v=0;v<y;v++)h[v]^=m[3&v]}}},function(h,m,y){var v=y(9).Buffer,C=y(13).EventEmitter,T=y(79).bufferAllocUnsafe;function BufferList(h){if(!(this instanceof BufferList))return new BufferList(h);C.call(this);var m=this;void 0===h&&(h={}),m.encoding=h.encoding;var y={next:null,buffer:null},w={next:null,buffer:null},A=0;m.__defineGetter__("length",(function(){return A}));var P=0;m.write=function(h){return y.buffer?(w.next={next:null,buffer:h},w=w.next):(y.buffer=h,w=y),A+=h.length,m.emit("write",h),!0},m.end=function(h){v.isBuffer(h)&&m.write(h)},m.push=function(){var h=[].concat.apply([],arguments);return h.forEach(m.write),m},m.forEach=function(h){if(!y.buffer)return T(0);if(y.buffer.length-P<=0)return m;for(var v={buffer:y.buffer.slice(P),next:y.next};v&&v.buffer;){if(h(v.buffer))break;v=v.next}return m},m.join=function(h,v){if(!y.buffer)return T(0);null==h&&(h=0),null==v&&(v=m.length);var C=T(v-h),w=0;return m.forEach((function(m){if(h<w+m.length&&w<v&&m.copy(C,Math.max(0,w-h),Math.max(0,h-w),Math.min(m.length,v-w)),(w+=m.length)>v)return!0})),C},m.joinInto=function(h,v,C,w){if(!y.buffer)return new T(0);null==C&&(C=0),null==w&&(w=m.length);var A=h;if(A.length-v<w-C)throw new Error("Insufficient space available in target Buffer.");var P=0;return m.forEach((function(h){if(C<P+h.length&&P<w&&h.copy(A,Math.max(v,v+P-C),Math.max(0,C-P),Math.min(h.length,w-P)),(P+=h.length)>w)return!0})),A},m.advance=function(h){for(P+=h,A-=h;y.buffer&&P>=y.buffer.length;)P-=y.buffer.length,y=y.next?y.next:{buffer:null,next:null};return null===y.buffer&&(w={next:null,buffer:null}),m.emit("advance",h),m},m.take=function(h,y){null==h?h=m.length:"number"!=typeof h&&(y=h,h=m.length);if(y||(y=m.encoding),y){var v="";return m.forEach((function(m){if(h<=0)return!0;v+=m.toString(y,0,Math.min(h,m.length)),h-=m.length})),v}return m.join(0,h)},m.toString=function(){return m.take("binary")}}h.exports=BufferList,h.exports.BufferList=BufferList,y(10).inherits(BufferList,C)},function(h,m,y){"use strict";try{h.exports=y(475)(__dirname)}catch(m){h.exports=y(1154)}},function(h,m,y){"use strict";h.exports=function isValidUTF8(h){const m=h.length;let y=0;for(;y<m;)if(0==(128&h[y]))y++;else if(192==(224&h[y])){if(y+1===m||128!=(192&h[y+1])||192==(254&h[y]))return!1;y+=2}else if(224==(240&h[y])){if(y+2>=m||128!=(192&h[y+1])||128!=(192&h[y+2])||224===h[y]&&128==(224&h[y+1])||237===h[y]&&160==(224&h[y+1]))return!1;y+=3}else{if(240!=(248&h[y]))return!1;if(y+3>=m||128!=(192&h[y+1])||128!=(192&h[y+2])||128!=(192&h[y+3])||240===h[y]&&128==(240&h[y+1])||244===h[y]&&h[y+1]>143||h[y]>244)return!1;y+=4}return!0}},function(h,m,y){var v=y(79).extend,C=y(10),T=y(13).EventEmitter,w=y(1156);function WebSocketRouter(h){T.call(this),this.config={server:null},h&&v(this.config,h),this.handlers=[],this._requestHandler=this.handleRequest.bind(this),this.config.server&&this.attachServer(this.config.server)}C.inherits(WebSocketRouter,T),WebSocketRouter.prototype.attachServer=function(h){if(!h)throw new Error("You must specify a WebSocketServer instance to attach to.");this.server=h,this.server.on("request",this._requestHandler)},WebSocketRouter.prototype.detachServer=function(){if(!this.server)throw new Error("Cannot detach from server: not attached.");this.server.removeListener("request",this._requestHandler),this.server=null},WebSocketRouter.prototype.mount=function(h,m,y){if(!h)throw new Error("You must specify a path for this handler.");if(m||(m="____no_protocol____"),!y)throw new Error("You must specify a callback for this handler.");if(!((h=this.pathToRegExp(h))instanceof RegExp))throw new Error("Path must be specified as either a string or a RegExp.");var v=h.toString();if(m=m.toLocaleLowerCase(),-1!==this.findHandlerIndex(v,m))throw new Error("You may only mount one handler per path/protocol combination.");this.handlers.push({path:h,pathString:v,protocol:m,callback:y})},WebSocketRouter.prototype.unmount=function(h,m){var y=this.findHandlerIndex(this.pathToRegExp(h).toString(),m);if(-1===y)throw new Error("Unable to find a route matching the specified path and protocol.");this.handlers.splice(y,1)},WebSocketRouter.prototype.findHandlerIndex=function(h,m){m=m.toLocaleLowerCase();for(var y=0,v=this.handlers.length;y<v;y++){var C=this.handlers[y];if(C.pathString===h&&C.protocol===m)return y}return-1},WebSocketRouter.prototype.pathToRegExp=function(h){return"string"==typeof h&&("*"===h?h=/^.*$/:(h=h.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&"),h=new RegExp("^"+h+"$"))),h},WebSocketRouter.prototype.handleRequest=function(h){var m=h.requestedProtocols;0===m.length&&(m=["____no_protocol____"]);for(var y=0;y<m.length;y++)for(var v=m[y].toLocaleLowerCase(),C=0,T=this.handlers.length;C<T;C++){var A=this.handlers[C];if(A.path.test(h.resourceURL.pathname)&&(v===A.protocol||"*"===A.protocol)){var P=new w(h,v);return void A.callback(P)}}h.reject(404,"No handler is available for the given request.")},h.exports=WebSocketRouter},function(h,m,y){var v=y(10),C=y(13).EventEmitter;function WebSocketRouterRequest(h,m){C.call(this),this.webSocketRequest=h,this.protocol="____no_protocol____"===m?null:m,this.origin=h.origin,this.resource=h.resource,this.resourceURL=h.resourceURL,this.httpRequest=h.httpRequest,this.remoteAddress=h.remoteAddress,this.webSocketVersion=h.webSocketVersion,this.requestedExtensions=h.requestedExtensions,this.cookies=h.cookies}v.inherits(WebSocketRouterRequest,C),WebSocketRouterRequest.prototype.accept=function(h,m){var y=this.webSocketRequest.accept(this.protocol,h,m);return this.emit("requestAccepted",y),y},WebSocketRouterRequest.prototype.reject=function(h,m,y){this.webSocketRequest.reject(h,m,y),this.emit("requestRejected",this)},h.exports=WebSocketRouterRequest},function(h,m,y){var v=y(476),C=y(477),T=y(478);const w=0,A=1,P=2,k=3;function W3CWebSocket(h,m,y,C,A,P){T.EventTarget.call(this),(P=P||{}).assembleFragments=!0;var k=this;this._url=h,this._readyState=w,this._protocol=void 0,this._extensions="",this._bufferedAmount=0,this._binaryType="arraybuffer",this._connection=void 0,this._client=new v(P),this._client.on("connect",(function(h){onConnect.call(k,h)})),this._client.on("connectFailed",(function(){onConnectFailed.call(k)})),this._client.connect(h,m,y,C,A)}function createCloseEvent(h,m){var y=new T.Event("close");return y.code=h,y.reason=m,y.wasClean=void 0===h||1e3===h,y}function createMessageEvent(h){var m=new T.Event("message");return m.data=h,m}function onConnect(h){var m=this;this._readyState=A,this._connection=h,this._protocol=h.protocol,this._extensions=h.extensions,this._connection.on("close",(function(h,y){onClose.call(m,h,y)})),this._connection.on("message",(function(h){onMessage.call(m,h)})),this.dispatchEvent(new T.Event("open"))}function onConnectFailed(){destroy.call(this),this._readyState=k;try{this.dispatchEvent(new T.Event("error"))}finally{this.dispatchEvent(createCloseEvent(1006,"connection failed"))}}function onClose(h,m){destroy.call(this),this._readyState=k,this.dispatchEvent(createCloseEvent(h,m||""))}function onMessage(h){if(h.utf8Data)this.dispatchEvent(createMessageEvent(h.utf8Data));else if(h.binaryData&&"arraybuffer"===this.binaryType){for(var m=h.binaryData,y=new ArrayBuffer(m.length),v=new Uint8Array(y),C=0,T=m.length;C<T;++C)v[C]=m[C];this.dispatchEvent(createMessageEvent(y))}}function destroy(){this._client.removeAllListeners(),this._connection&&this._connection.removeAllListeners()}h.exports=W3CWebSocket,Object.defineProperties(W3CWebSocket.prototype,{url:{get:function(){return this._url}},readyState:{get:function(){return this._readyState}},protocol:{get:function(){return this._protocol}},extensions:{get:function(){return this._extensions}},bufferedAmount:{get:function(){return this._bufferedAmount}}}),Object.defineProperties(W3CWebSocket.prototype,{binaryType:{get:function(){return this._binaryType},set:function(h){if("arraybuffer"!==h)throw new SyntaxError('just "arraybuffer" type allowed for "binaryType" attribute');this._binaryType=h}}}),[["CONNECTING",w],["OPEN",A],["CLOSING",P],["CLOSED",k]].forEach((function(h){Object.defineProperty(W3CWebSocket.prototype,h[0],{get:function(){return h[1]}})})),[["CONNECTING",w],["OPEN",A],["CLOSING",P],["CLOSED",k]].forEach((function(h){Object.defineProperty(W3CWebSocket,h[0],{get:function(){return h[1]}})})),W3CWebSocket.prototype.send=function(h){if(this._readyState!==A)throw new Error("cannot call send() while not connected");if("string"==typeof h||h instanceof String)this._connection.sendUTF(h);else if(h instanceof Buffer)this._connection.sendBytes(h);else{if(!h.byteLength&&0!==h.byteLength)throw new Error("unknown binary data:",h);h=C(h),this._connection.sendBytes(h)}},W3CWebSocket.prototype.close=function(h,m){switch(this._readyState){case w:onConnectFailed.call(this),this._client.on("connect",(function(y){h?y.close(h,m):y.close()}));break;case A:this._readyState=P,h?this._connection.close(h,m):this._connection.close()}}},function(h,m){h.exports=isTypedArray,isTypedArray.strict=isStrictTypedArray,isTypedArray.loose=isLooseTypedArray;var y=Object.prototype.toString,v={"[object Int8Array]":!0,"[object Int16Array]":!0,"[object Int32Array]":!0,"[object Uint8Array]":!0,"[object Uint8ClampedArray]":!0,"[object Uint16Array]":!0,"[object Uint32Array]":!0,"[object Float32Array]":!0,"[object Float64Array]":!0};function isTypedArray(h){return isStrictTypedArray(h)||isLooseTypedArray(h)}function isStrictTypedArray(h){return h instanceof Int8Array||h instanceof Int16Array||h instanceof Int32Array||h instanceof Uint8Array||h instanceof Uint8ClampedArray||h instanceof Uint16Array||h instanceof Uint32Array||h instanceof Float32Array||h instanceof Float64Array}function isLooseTypedArray(h){return v[y.call(h)]}},function(h,m){function _EventTarget(){"function"!=typeof this.addEventListener&&(this._listeners={},this.addEventListener=_addEventListener,this.removeEventListener=_removeEventListener,this.dispatchEvent=_dispatchEvent)}function _addEventListener(h,m){var y,v,C;if(h&&m){for(void 0===(y=this._listeners[h])&&(this._listeners[h]=y=[]),v=0;C=y[v];v++)if(C===m)return;y.push(m)}}function _removeEventListener(h,m){var y,v,C;if(h&&m&&void 0!==(y=this._listeners[h])){for(v=0;C=y[v];v++)if(C===m){y.splice(v,1);break}0===y.length&&delete this._listeners[h]}}function _dispatchEvent(h){var m,y,v,C,T,w=!1;if(!h||"string"!=typeof h.type)throw new Error("`event` must have a valid `type` property");h._yaeti&&(h.target=this,h.cancelable=!0);try{h.stopImmediatePropagation=function(){w=!0}}catch(h){}for(m=h.type,y=this._listeners[m]||[],"function"==typeof(v=this["on"+m])&&v.call(this,h),C=0;(T=y[C])&&!w;C++)T.call(this,h);return!h.defaultPrevented}h.exports=_EventTarget,Object.defineProperties(_EventTarget.prototype,{listeners:{get:function(){return this._listeners}}})},function(h,m){h.exports=function _Event(h){this.type=h,this.isTrusted=!1,this._yaeti=!0}},function(h,m){var y={disableWarnings:!1,deprecationWarningMap:{},warn:function(h){!this.disableWarnings&&this.deprecationWarningMap[h]&&(console.warn("DEPRECATION WARNING: "+this.deprecationWarningMap[h]),this.deprecationWarningMap[h]=!1)}};h.exports=y},function(h,m,y){h.exports=y(1163).version},function(h){h.exports=JSON.parse('{"name":"websocket","description":"Websocket Client & Server Library implementing the WebSocket protocol as specified in RFC 6455.","keywords":["websocket","websockets","socket","networking","comet","push","RFC-6455","realtime","server","client"],"author":"Brian McKelvey <theturtle32@gmail.com> (https://github.com/theturtle32)","contributors":["Iaki Baz Castillo <ibc@aliax.net> (http://dev.sipdoc.net)"],"version":"1.0.34","repository":{"type":"git","url":"https://github.com/theturtle32/WebSocket-Node.git"},"homepage":"https://github.com/theturtle32/WebSocket-Node","engines":{"node":">=4.0.0"},"dependencies":{"bufferutil":"^4.0.1","debug":"^2.2.0","es5-ext":"^0.10.50","typedarray-to-buffer":"^3.1.5","utf-8-validate":"^5.0.2","yaeti":"^0.0.6"},"devDependencies":{"buffer-equal":"^1.0.0","gulp":"^4.0.2","gulp-jshint":"^2.0.4","jshint-stylish":"^2.2.1","jshint":"^2.0.0","tape":"^4.9.1"},"config":{"verbose":false},"scripts":{"test":"tape test/unit/*.js","gulp":"gulp"},"main":"index","directories":{"lib":"./lib"},"browser":"lib/browser.js","license":"Apache-2.0"}')},function(h){h.exports=JSON.parse('{"error.relayConnectionError":"Failed to connect to the codespace.","error.relayEndpointNotFound":"The relay endpoint for the codespace is invalid or no longer exists.","error.relayListenerOffline":"The codespace is currently offline.","error.relaySasInvalid":"Failed to connect to the codespace through the relay: invalid relay SAS.","error.relayServerError":"Failed to connect to the codespace due to an unknown relay error."}')},function(h,m,y){"use strict";var v=this&&this.__awaiter||function(h,m,y,v){return new(y||(y=Promise))((function(C,T){function fulfilled(h){try{step(v.next(h))}catch(h){T(h)}}function rejected(h){try{step(v.throw(h))}catch(h){T(h)}}function step(h){h.done?C(h.value):function adopt(h){return h instanceof y?h:new y((function(m){m(h)}))}(h.value).then(fulfilled,rejected)}step((v=v.apply(h,m||[])).next())}))},C=this&&this.__importStar||function(h){if(h&&h.__esModule)return h;var m={};if(null!=h)for(var y in h)Object.hasOwnProperty.call(h,y)&&(m[y]=h[y]);return m.default=h,m};Object.defineProperty(m,"__esModule",{value:!0});const T=y(6),w=C(y(29)),A=y(39),P=y(2);class SshWorkspaceSession extends P.DisposableClass{constructor(h,m,y,v){super(y),this.sshSession=h,this.authCompletion=m,this.onConnectedStateChangedEmitter=new T.Emitter,this.isReconnectingFlag=!1,this.onConnectedStateChanged=this.onConnectedStateChangedEmitter.event,this.addToDisposables(h,h.onDisconnected(h=>{v?(this.isReconnectingFlag=!0,this.onConnectedStateChangedEmitter.fire({state:A.ConnectedState.Reconnecting,retryCount:0}),v().then(h=>{this.isReconnectingFlag=!1,this.onConnectedStateChangedEmitter.fire({state:void 0===h.error?A.ConnectedState.Reconnected:A.ConnectedState.Closed,retryCount:h.retryCount,error:h.error})}).catch(h=>{this.isReconnectingFlag=!1})):(this.isReconnectingFlag=!1,this.onConnectedStateChangedEmitter.fire({state:A.ConnectedState.Closed,retryCount:0}),this.dispose("auto reconnect disabled"))}))}get isReconnecting(){return this.isReconnectingFlag}createRpcMessageStream(){return v(this,void 0,void 0,(function*(){const h=new w.ChannelRequestMessage;h.requestType="json-rpc",h.wantReply=!0;const m=yield this.sshSession.openChannel(null,h);return new w.SshRpcMessageStream(m)}))}openStreamingChannel(h,m){return v(this,void 0,void 0,(function*(){if(!this.sshSession)throw new Error("Ssh session not initiated yet");const y=yield this.sshSession.openChannel(),v=`stream-transport-${h}`;if(!(yield y.request(new w.ChannelRequestMessage(v),m)))throw new Error(`Failed to create stream transport channel with streamId - ${h}`);return y}))}}m.SshWorkspaceSession=SshWorkspaceSession},function(h,m,y){"use strict";var v=this&&this.__decorate||function(h,m,y,v){var C,T=arguments.length,w=T<3?m:null===v?v=Object.getOwnPropertyDescriptor(m,y):v;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)w=Reflect.decorate(h,m,y,v);else for(var A=h.length-1;A>=0;A--)(C=h[A])&&(w=(T<3?C(w):T>3?C(m,y,w):C(m,y))||w);return T>3&&w&&Object.defineProperty(m,y,w),w},C=this&&this.__metadata||function(h,m){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(h,m)},T=this&&this.__awaiter||function(h,m,y,v){return new(y||(y=Promise))((function(C,T){function fulfilled(h){try{step(v.next(h))}catch(h){T(h)}}function rejected(h){try{step(v.throw(h))}catch(h){T(h)}}function step(h){h.done?C(h.value):function adopt(h){return h instanceof y?h:new y((function(m){m(h)}))}(h.value).then(fulfilled,rejected)}step((v=v.apply(h,m||[])).next())}))};Object.defineProperty(m,"__esModule",{value:!0});const w=y(2),A=y(6),P=y(4),k=y(269),R=y(480),M=y(134),N=y(65),D=y(1167),I=y(133),x=y(481),O=y(2),L=y(482),U=y(1168),B=y(483),compactSharedServer=h=>{const{sessionName:m,sourcePort:y,privacy:v,isTCPServerConnectionEstablished:C,hasTLSHandshakePassed:T}=h;return`${m}:${y}:${v}:${C}:${T}`},compactSharedServers=h=>h.map(compactSharedServer);m.DEFAULT_FORWARDING_HOST="127.0.0.1";class VSCodeConnection extends I.Connection{constructor(h,m,y,v){super(h.createChild("vscode"),m),this.performance=m,this.options=y,this.connectionHubs=v,this.onVSCodeServerStartedEmitter=new A.Emitter,this.onVSCodeServerStarted=this.onVSCodeServerStartedEmitter.event,this.forecastChannels=[],this.vscodeServerHostClientReference=null,this.sharedServerReference=null,this.liveshareConnectionReference=null,this.serverSharingServiceReference=null,this.remotePortReference=null}getId(h){const{workspaceId:m,environmentId:y,vsCodeQuality:v,vsCodeCommit:C}=h;return`${m}_${y}_${v}_${C}`}getRpcService(h){return this.workspaceClient.getServiceProxy(h)}get workspaceClient(){w.assertDefined(this.liveshareConnection,"No LiveShare connection found.");const{workspaceClient:h}=this.liveshareConnection;return w.assertDefined(h,"No WorkspaceClient found."),h}get vscodeServerHostClient(){return w.assertDefined(this.vscodeServerHostClientReference,"No VSCodeServerHostClient defined."),this.vscodeServerHostClientReference}get serverSharingService(){return w.assertDefined(this.serverSharingServiceReference,"No ServerSharing service found."),this.serverSharingServiceReference}get liveshareConnection(){return w.assertDefined(this.liveshareConnectionReference,"No LiveShare connection found."),this.liveshareConnectionReference}createConnection(){return T(this,void 0,void 0,(function*(){const[h]=this.connectionHubs;w.assertDefined(h,"LiveShareConnectionHub not found.");try{this.initializeConnection(),this.trace.info("get LS connection"),this.liveshareConnectionReference=yield this.performance.measure({name:"liveshare connection"},()=>T(this,void 0,void 0,(function*(){return yield h.connectOnce(this.options,{performance:this.performance.createGroup("liveshare connection")})}))),this.liveshareConnectionReference.addToDisposables(this),this.addToDisposables(this.liveshareConnectionReference.onConnectionChanged(h=>{const{previousStatus:m,status:y}=h;this.trace.info(`LiveShareConnection status changed: "${m}" -> "${y}"`),this.dispose("LiveShareConnection disconnected")}),this.liveshareConnectionReference.onDispose(h=>{this.trace.info("LiveShareConnection disposed"),this.dispose("LiveShareConnection disposed")}));const{workspaceClient:m}=this.liveshareConnectionReference;yield this.getVSCodeSharedServer(m);for(let h=0;h<VSCodeConnection.channelForecast;h++)this.forecastChannels.push(this.openChannel(this.performance,!1));return this.onConnectionChangedHandler("connected"),this}catch(h){throw this.handleConnectionError(h),M.errorToConnectionError(h)}}))}get sharedServer(){return w.assertDefined(this.sharedServerReference,"No SharedServer found."),this.sharedServerReference}getVSCodeSharedServer(h){return T(this,void 0,void 0,(function*(){const m=this.performance.createGroup("share vscode server",R.PerformanceGroupIds.VSCodeServerStartup);this.serverSharingServiceReference=h.getServiceProxy(P.vsls.ServerSharingService);const y=yield m.measure({name:"start vscode server",id:k.PerformanceEventIds.VSCodeServerStartupServerStart},()=>T(this,void 0,void 0,(function*(){return yield this.startVSCodeServer(h)})));return w.assertDefined(y,new N.ConnectionError(`VSCode Server port is "${y}"`)),this.trace.info(`forwarding the VSCode Server port "${y}".`),this.addToDisposables(this.serverSharingService.onSharingStopped(h=>{const{server:m}=h;this.trace.verbose("serverSharingService onSharingStopped:",m),m.sourcePort===y&&(this.trace.info("serverSharingService closed.",m),this.onConnectionChangedHandler("disconnected",new N.ConnectionError("Port closed.")))})),this.sharedServerReference=yield m.measure({name:"share vscode server TCP port",id:k.PerformanceEventIds.VSCodeServerStartupServerTcpPortForwarding},()=>T(this,void 0,void 0,(function*(){const{clientId:h}=this.options;return yield this.serverSharingService.startSharingAsync(y,L.getVSCodeServerSessionName(h),"")}))),this.trace.info(`VSCode Server port "${y}" forwarded.`),this.sharedServerReference}))}getSharedServers(h=3*w.TIME_SECOND_MS){return T(this,void 0,void 0,(function*(){try{const m=yield w.timeoutPromise(this.serverSharingService.getSharedServersAsync(),h,new N.ConnectionError("Getting shared servers timed out."));return this.trace.verbose("got shared servers list",compactSharedServers(m)),m}catch(h){throw this.trace.error("getting shared servers failed: ",h),this.liveshareConnection.dispose(`disposed by vscode connection: "${h.message}"`),h}}))}startVSCodeServer(h){return T(this,void 0,void 0,(function*(){const{shouldReuseExistingServers:m=!1,clientId:y}=this.options;if(this.trace.info("starting vscode server..",this.options),this.vscodeServerHostClientReference=h.getServiceProxy(x.vscodeServerHostRPCService),m){this.trace.info("checking if existing vscode server can be reused");const h=yield this.getSharedServers();this.trace.info("checking already running ports",compactSharedServers(h));const m=h.reverse().find(h=>h.sessionName===L.getVSCodeServerSessionName(y));if(m)return this.remotePortReference=m.sourcePort,this.trace.info(`reusing already shared port ${this.remotePortReference}`),this.onVSCodeServerStartedEmitter.fire({port:this.remotePort,connectionToken:this.options.vsCodeCommit}),this.remotePortReference}return this.trace.info("vscode started, forwarding the server port"),this.remotePortReference=yield this.vscodeServerHostClient.startRemoteServerAsync(Object.assign(Object.assign({},this.options),{quality:this.options.vsCodeQuality})),this.trace.info(`the server port forwarded, port number is ${this.remotePortReference}`),this.trace.info("vscode server startup complete"),this.onVSCodeServerStartedEmitter.fire({port:this.remotePort,connectionToken:this.options.vsCodeCommit}),this.remotePort}))}get remotePort(){return w.assertDefined(this.remotePortReference,"No remote port found."),this.remotePortReference}startForwardingPort(h,y=new Set,v=m.DEFAULT_FORWARDING_HOST,C){return T(this,void 0,void 0,(function*(){this.trace.info(`start sharing the port "${h}"`);const m=yield this.getSharedServers(C);return yield this.startForwardingPortCore(m,h,v,y)}))}updateForwardedPortProtocol(h,m,y){return T(this,void 0,void 0,(function*(){this.trace.info(`updating protocol of "${h}" to "${m}"`);const v=yield this.getSharedServers(y),C=D.findSourcePort(v,h);return w.assertDefined(C,`No port "${h}" found.`),yield this.updateForwardedPortProtocolCore(C,h,m)}))}updateForwardedPortPrivacy(h,y,v=new Set,C=m.DEFAULT_FORWARDING_HOST,A){return T(this,void 0,void 0,(function*(){this.trace.info(`updating privacy of "${h}" to "${y}"`);const m=yield this.getSharedServers(A),T=D.findSourcePort(m,h);return w.assertDefined(T,`No port "${h}" found.`),yield this.updateForwardedPortPrivacyCore(T,h,y,v,C)}))}stopForwardingPort(h){return T(this,void 0,void 0,(function*(){const m=this.workspaceClient.getServiceProxy(P.vsls.ServerSharingService);return yield m.stopSharingAsync(h),this}))}openChannel(h=this.performance,m=!0){return T(this,void 0,void 0,(function*(){if(m){const h=this.forecastChannels.shift();if(h)return yield h}const y=this.getRpcService(P.vsls.StreamManagerService),v=yield h.measure({name:"get stream Id",id:w.randomString()},()=>T(this,void 0,void 0,(function*(){return w.assertDefined(this.sharedServer,"No SharedServer found."),yield y.getStreamAsync(this.sharedServer.streamName,this.sharedServer.streamCondition)})));return(yield h.measure({name:`open streaming channel "${v}"`},()=>T(this,void 0,void 0,(function*(){return yield this.workspaceClient.openStreamingChannel(v)}))))||null}))}sendHandshakeRequest(h){return T(this,void 0,void 0,(function*(){const m=new w.Signal;try{this.trace.info("opening ssh channel");const y=yield this.openChannel();w.assertDefined(y,"Cannot open a channel.");const v=y.onDataReceived(h=>{v.dispose(),this.trace.info(`response: \n${h.toString()}\n`),y.adjustWindow(h.length),m.resolve(y)});this.addToDisposables(v),this.trace.info(`sending the request: \n${h}\n`),yield y.send(Buffer.from(h)),this.trace.info(" connected")}catch(h){this.trace.info("failed to send request"),m.reject(h)}return yield m.promise}))}disconnect(h){const m=Object.create(null,{disconnect:{get:()=>super.disconnect}});return T(this,void 0,void 0,(function*(){if(this.trace.info(`disconnecting with reason: "${h}"`),this.isDisconnected)this.trace.info("already disconnected");else{try{this.remotePortReference&&this.serverSharingServiceReference&&(this.trace.info(`stop sharing vscode server port "${this.remotePortReference}"`),yield this.serverSharingService.stopSharingAsync(this.remotePortReference)),yield this.vscodeServerHostClient.shutDownRemoteServerAsync()}catch(h){this.trace.warning("error while disconnecting",h)}finally{this.remotePortReference=null,this.vscodeServerHostClientReference=null}m.disconnect.call(this,h)}}))}startForwardingPortCore(h,y,v=m.DEFAULT_FORWARDING_HOST,C){return T(this,void 0,void 0,(function*(){const m=D.findSourcePort(h,y);if(m)return this.trace.info(`port ${y} is already forwarded.`),m;const T=new U.PortSignal(y,P.vsls.ChangeKind.Start,this.serverSharingService),w=yield this.serverSharingService.startSharingAsync(y,v,"");return B.isVSCodeServerSession(v)||C.has(y)||(yield T.waitForSignal()),w}))}updateForwardedPortProtocolCore(h,m,y){return T(this,void 0,void 0,(function*(){return h.hasTLSHandshakePassed===y?(this.trace.info(`port ${m} protocol is already ${y?"https":"http"}.`),this):(yield this.serverSharingService.updateSharedServerProtocolAsync(m,y),this.trace.info(`port ${m} protocol updated to ${y?"https":"http"}.`),this)}))}updateForwardedPortPrivacyCore(h,y,v,C,w=m.DEFAULT_FORWARDING_HOST){return T(this,void 0,void 0,(function*(){if(h.privacy===v)return this.trace.info(`port ${y} privacy is already ${v}.`),this;const m=new U.PortSignal(y,P.vsls.ChangeKind.Update,this.serverSharingService);return yield this.serverSharingService.updateSharedServerPrivacyAsync(y,v),this.trace.info(`port ${y} privacy updated to ${v}.`),B.isVSCodeServerSession(w)||C.has(y)||(yield m.waitForSignal()),this}))}dispose(h){return null==this.remotePortReference||(this.trace.info(`stopping remote port "${this.remotePortReference}"`),this.stopForwardingPort(this.remotePortReference).catch(h=>{this.trace.warning("failed to stop forwarding vscode server port")})),super.dispose(h)}}VSCodeConnection.channelForecast=2,v([O.withHelperDecorator(w.withMutexByArguments,{serializeArguments:(h,y,v=m.DEFAULT_FORWARDING_HOST)=>`${y}_${v}`}),C("design:type",Function),C("design:paramtypes",[Array,Number,String,Set]),C("design:returntype",Promise)],VSCodeConnection.prototype,"startForwardingPortCore",null),m.VSCodeConnection=VSCodeConnection},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0}),m.findSourcePort=(h,m,y)=>h.find(h=>{const{sourcePort:v,sessionName:C}=h,T=v===m;return y?T&&C===y:T})},function(h,m,y){"use strict";var v=this&&this.__awaiter||function(h,m,y,v){return new(y||(y=Promise))((function(C,T){function fulfilled(h){try{step(v.next(h))}catch(h){T(h)}}function rejected(h){try{step(v.throw(h))}catch(h){T(h)}}function step(h){h.done?C(h.value):function adopt(h){return h instanceof y?h:new y((function(m){m(h)}))}(h.value).then(fulfilled,rejected)}step((v=v.apply(h,m||[])).next())}))};Object.defineProperty(m,"__esModule",{value:!0});m.PortSignal=class PortSignal{constructor(h,m,y){this.promise=new Promise((function(v,C){y.onSharingSucceeded(y=>{y.port===h&&y.changeKind===m&&v()}),y.onSharingFailed(y=>{y.port===h&&y.changeKind===m&&C(y.errorDetail)})}))}waitForSignal(){return v(this,void 0,void 0,(function*(){try{yield this.promise}catch(h){throw Error(h)}}))}}},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0});const v=y(2),C=y(267);class CodespaceConnection extends C.LiveShareConnection{setWorkspaceSessionInfo(h){this.trace.verbose("setWorkspaceSessionInfo",h);const{ownerId:m,sessionNumber:y,sessions:C}=h;v.assertDefined(m,"No owner id defined."),this.trace.info(`ownerId: "${m}"`),v.assert(!m.startsWith("vm_"),"Session host is not updated to the user, retrying..."),v.assertDefined(C,"Workspace sessions not defined.");const T=C[y];v.assertDefined(T,`Session #${y} not defined.`),v.assert(T.isOwner,"Session does not have owner permissions"),super.setWorkspaceSessionInfo(h)}}m.CodespaceConnection=CodespaceConnection},function(h,m,y){"use strict";var v=this&&this.__awaiter||function(h,m,y,v){return new(y||(y=Promise))((function(C,T){function fulfilled(h){try{step(v.next(h))}catch(h){T(h)}}function rejected(h){try{step(v.throw(h))}catch(h){T(h)}}function step(h){h.done?C(h.value):function adopt(h){return h instanceof y?h:new y((function(m){m(h)}))}(h.value).then(fulfilled,rejected)}step((v=v.apply(h,m||[])).next())}))};Object.defineProperty(m,"__esModule",{value:!0});const C=y(2),T=y(267);class LiveShareJointConnection extends T.LiveShareConnection{constructor(h,m,y,v){super(h.createChild("liveshare-joint"),m,y),this.performance=m,this.options=y,this.connectionHubs=v,this.connectionReference=null}get type(){return C.assertDefined(this.connectionReference,""),this.connectionReference.type}get workspaceSessionInfo(){if(this.connectionReference)return this.connectionReference.workspaceSessionInfo}get connection(){return this.connectionReference}createConnection(){return v(this,void 0,void 0,(function*(){try{this.trace.info("creating connection"),this.connectionSignal=new C.Signal,this.addToDisposables(this.connectionSignal),this.onConnectionChangedHandler("connecting");const h=this.connectionHubs.map((h,m)=>h.connectOnce(this.options,{performance:this.performance.createGroup(`connection #${m}`)})),m=yield C.raceAsync(h);return m.addToDisposables(this),C.assertDefined(this.connectionSignal,"No connection signal found."),this.connectionReference=m,this.workspaceClientReference=m.workspaceClient,this.addToDisposables(m),this.addToDisposables(m.onConnectionChanged(this.onConnectionChangedEventEmitter.fire.bind(m))),this.onConnectionChangedHandler("connected"),this}catch(h){throw this.handleConnectionError(h),h}}))}}m.LiveShareJointConnection=LiveShareJointConnection},function(h,m,y){"use strict";var v=this&&this.__awaiter||function(h,m,y,v){return new(y||(y=Promise))((function(C,T){function fulfilled(h){try{step(v.next(h))}catch(h){T(h)}}function rejected(h){try{step(v.throw(h))}catch(h){T(h)}}function step(h){h.done?C(h.value):function adopt(h){return h instanceof y?h:new y((function(m){m(h)}))}(h.value).then(fulfilled,rejected)}step((v=v.apply(h,m||[])).next())}))};Object.defineProperty(m,"__esModule",{value:!0});const C=y(2),T=y(133);class VSCodeJointConnection extends T.Connection{constructor(h,m,y,v){super(h.createChild("vscode-joint"),m),this.performance=m,this.options=y,this.connectionHubs=v,this.connectionReference=null}getSharedServers(){throw new C.NotImplementedError("Method not implemented.")}get vscodeServerHostClient(){return C.assertDefined(this.connectionReference,"No connection found."),this.connectionReference.vscodeServerHostClient}get serverSharingService(){return C.assertDefined(this.connectionReference,"No connection found."),this.connectionReference.serverSharingService}getRpcService(h){throw new Error("Method not implemented.")}get connection(){return C.assertDefined(this.connectionReference,"No connection found."),this.connectionReference}get workspaceClient(){C.assertDefined(this.connectionReference,"No connection found.");const{liveshareConnection:h}=this.connectionReference;return C.assertDefined(h,"No LiveShare connection found."),h.workspaceClient}get liveshareConnection(){var h,m;return C.assertDefined(null===(h=this.connectionReference)||void 0===h?void 0:h.liveshareConnection,"No LiveShare conneciton found."),null===(m=this.connectionReference)||void 0===m?void 0:m.liveshareConnection}get sharedServer(){return this.connection.sharedServer}openChannel(h){var m;return v(this,void 0,void 0,(function*(){const y=yield null===(m=this.connectionReference)||void 0===m?void 0:m.openChannel(h);return null!=y?y:null}))}get onVSCodeServerStarted(){return this.connection.onVSCodeServerStarted}get remotePort(){return C.assertDefined(this.connectionReference,"No connection found."),this.connectionReference.remotePort}startForwardingPort(h){return v(this,void 0,void 0,(function*(){return yield this.connection.startForwardingPort(h)}))}updateForwardedPortProtocol(h,m){return v(this,void 0,void 0,(function*(){return yield this.connection.updateForwardedPortProtocol(h,m),this}))}updateForwardedPortPrivacy(h,m){return v(this,void 0,void 0,(function*(){return yield this.connection.updateForwardedPortPrivacy(h,m),this}))}stopForwardingPort(h){var m;return v(this,void 0,void 0,(function*(){return yield null===(m=this.connection)||void 0===m?void 0:m.stopForwardingPort(h),this}))}sendHandshakeRequest(h){return v(this,void 0,void 0,(function*(){return yield this.connection.sendHandshakeRequest(h)}))}createConnectionMock(){return v(this,void 0,void 0,(function*(){try{this.trace.info("creating connection"),this.connectionSignal=new C.Signal,this.addToDisposables(this.connectionSignal);const[h,m]=this.connectionHubs;C.assertDefined(h,"No VSCode ConnectionHub found."),C.assertDefined(m,"No Remote VSCode ConnectionHub found."),this.onConnectionChangedHandler("connecting");const y=yield C.raceAsync([h.connectOnce(this.options,{performance:this.performance.createGroup("main-thread")}),m.connectOnce(this.options,{performance:this.performance.createGroup("service-worker")})]);return C.assertDefined(this.connectionSignal,"No connection signal found."),C.assertDefined(y.liveshareConnection,"Connected but no LiveShare connection found."),this.connectionReference=y,this.addToDisposables(y),this.addToDisposables(y.onConnectionChanged(this.onConnectionChangedEventEmitter.fire.bind(y))),this.connectionSignal.resolve(this),C.defer(()=>{this.onConnectionChangedHandler("connected")}),this}catch(h){throw this.handleConnectionError(h),h}}))}}m.VSCodeJointConnection=VSCodeJointConnection},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0}),m.HUB_CONNECTION_DEFAULT_OPTIONS={retries:3,retryDelay:0,timeout:1/0,shouldReconnect:!0},m.HUB_NO_RETRY_OPTIONS=Object.assign(Object.assign({},m.HUB_CONNECTION_DEFAULT_OPTIONS),{retries:0,shouldReconnect:!1})},function(h,m,y){"use strict";var v=this&&this.__awaiter||function(h,m,y,v){return new(y||(y=Promise))((function(C,T){function fulfilled(h){try{step(v.next(h))}catch(h){T(h)}}function rejected(h){try{step(v.throw(h))}catch(h){T(h)}}function step(h){h.done?C(h.value):function adopt(h){return h instanceof y?h:new y((function(m){m(h)}))}(h.value).then(fulfilled,rejected)}step((v=v.apply(h,m||[])).next())}))};Object.defineProperty(m,"__esModule",{value:!0});const C=y(2);class ConnectionHubRecord extends C.DisposableClass{constructor(h,m,y,v,C){super(h),this.connectionArg=m,this.connectionOptionsArg=y,this.hubConnectionOptionsArg=v,this.eventHandlerArg=C,this.addToDisposables(C,m)}get connection(){return this.connectionArg}get connectionOptions(){return this.connectionOptionsArg}get hubConnectionOptions(){return this.hubConnectionOptionsArg}get eventHandler(){return this.eventHandlerArg}disconnect(h){const m=Object.create(null,{dispose:{get:()=>super.dispose}});return v(this,void 0,void 0,(function*(){return yield this.connection.disconnect(h),m.dispose.call(this,h)}))}}m.ConnectionHubRecord=ConnectionHubRecord},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0});var v=y(65);m.ConnectionError=v.ConnectionError;var C=y(266);m.ConnectionTimeoutError=C.ConnectionTimeoutError;var T=y(467);m.ConnectionStateError=T.ConnectionStateError;var w=y(265);m.ConnectionCancellationError=w.ConnectionCancellationError},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0});var v=y(1176);m.VSCodeConnectionMock=v.VSCodeConnectionMock;var C=y(1177);m.ConnectionHubMock=C.ConnectionHubMock;var T=y(271);m.ConnectionMock=T.ConnectionMock,function __export(h){for(var y in h)m.hasOwnProperty(y)||(m[y]=h[y])}(y(1178))},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0});const v=y(6),C=y(271);class VSCodeConnectionMock extends C.ConnectionMock{constructor(){super(...arguments),this.onVSCodeServerStarted=(new v.Emitter).event}get workspaceClient(){return{}}get liveshareConnection(){return{}}get vscodeServerHostClient(){return{}}sendHandshakeRequest(h){return{}}openChannel(h){return Promise.resolve(null)}startForwardingPort(h){return Promise.resolve({})}stopForwardingPort(h){return Promise.resolve(this)}updateForwardedPortProtocol(h,m){return Promise.resolve(this)}updateForwardedPortPrivacy(h,m){return Promise.resolve(this)}get serverSharingService(){return{}}get sharedServer(){return{}}get remotePort(){return 0}getSharedServers(){throw new Error("Method not implemented.")}getRpcService(h){throw new Error("Method not implemented.")}}m.VSCodeConnectionMock=VSCodeConnectionMock},function(h,m,y){"use strict";var v=this&&this.__awaiter||function(h,m,y,v){return new(y||(y=Promise))((function(C,T){function fulfilled(h){try{step(v.next(h))}catch(h){T(h)}}function rejected(h){try{step(v.throw(h))}catch(h){T(h)}}function step(h){h.done?C(h.value):function adopt(h){return h instanceof y?h:new y((function(m){m(h)}))}(h.value).then(fulfilled,rejected)}step((v=v.apply(h,m||[])).next())}))};Object.defineProperty(m,"__esModule",{value:!0});const C=y(2),T=y(484);class ConnectionHubMock extends T.ConnectionHub{constructor(){super(...arguments),this.mockCreateConnectionFail=(h,m=1)=>{this.createConnection=()=>v(this,void 0,void 0,(function*(){throw yield C.wait(m),h}))}}getConnectionIdMock(h){return this.getConnectionId(h)}getConnectionMock(h){const m=this.getConnectionId(h),y=this.connections[m];return y?y.connection:void 0}getConnectionRecordMock(h){const m=this.getConnectionId(h);return this.connections[m]}}m.ConnectionHubMock=ConnectionHubMock},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0});var v=y(1179);m.getConnectionHubMockOptions=v.getConnectionHubMockOptions;var C=y(487);m.getConnectionMockOptions=C.getConnectionMockOptions;var T=y(1188);m.getLiveShareConnectionMockOptions=T.getLiveShareConnectionMockOptions},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0});const v=y(135),C=y(15),T=y(271);m.testTrace=new C.TraceSource("test-trace"),m.performance=v.initializePerformanceInstance("test:start"),m.getConnectionHubMockOptions=(h={})=>{const{trace:y=m.testTrace,childHubs:v}=h;return[y,m.performance,T.ConnectionMock,v]}},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0});m.WaterfallNode=class WaterfallNode{constructor(h,m,y,v,C,T){this.id=h,this.name=m,this.path=y,this.rawMeasure=v,this.perfGoups=T,this.groups=[],this.getTotalDuration=()=>{let h=0;for(let m of this.groups){const y=m.measure.startTime+m.measure.duration;y>h&&(h=y)}return h},this.measure={name:v.name,duration:v.duration,startTime:v.startTime,entryType:v.entryType};for(let h of C)this.groups.push(Object.assign(Object.assign({},h),{groups:[]}));for(let h of this.perfGoups)this.groups.push(h.getWaterfall());const w=this.getTotalDuration()-this.measure.startTime;this.measure=Object.assign(Object.assign({},this.measure),{duration:w})}}},function(h,m,y){"use strict";var v=this&&this.__awaiter||function(h,m,y,v){return new(y||(y=Promise))((function(C,T){function fulfilled(h){try{step(v.next(h))}catch(h){T(h)}}function rejected(h){try{step(v.throw(h))}catch(h){T(h)}}function step(h){h.done?C(h.value):function adopt(h){return h instanceof y?h:new y((function(m){m(h)}))}(h.value).then(fulfilled,rejected)}step((v=v.apply(h,m||[])).next())}))};Object.defineProperty(m,"__esModule",{value:!0});const C=y(6),T=y(486);class PerformanceBlocks{constructor(h){this.pathString=h,this.blocks={},this.onAnyEventEmitter=new C.Emitter,this.onAnyEvent=this.onAnyEventEmitter.event,this.markBlock=h=>{const{id:m,name:y,type:v}=h,C=`${this.pathString}.block: ${null!=m?m:y}`,w=`${C}-${v}`;if(this.blocks[C]&&this.blocks[C][v])throw new Error(`The event "${w}" already marked in this group.`);T.performance.mark(w);const[A]=T.performance.getEntriesByName(w),P=this.blocks[C]||{path:C,id:"start"===v?m:void 0,name:"start"===v?y:void 0};if(P[h.type]=Object.assign(Object.assign({},h),{path:w}),this.blocks[C]=P,m&&void 0!==A){const h={id:m,name:y,type:v,measure:A};if("end"===v){const[y]=T.performance.getEntriesByName(`${C}-start`);if(!y)throw new Error(`No start block found for event ${m}`);h.measure=Object.assign(Object.assign({},A),{duration:A.startTime-y.startTime})}this.onAnyEventEmitter.fire(h),this.invokeBlock(h)}return this},this.markBlockStart=h=>this.markBlock(Object.assign({type:"start"},h)),this.markBlockEnd=h=>this.markBlock(Object.assign({type:"end"},h)),this.getBlock=h=>{const m=`${this.pathString}.block: ${h}`,y=this.blocks[m];if(y)return y},this.measure=(h,m)=>v(this,void 0,void 0,(function*(){this.markBlock(Object.assign(Object.assign({},h),{type:"start"}));try{return yield m()}finally{this.markBlock(Object.assign(Object.assign({},h),{type:"end"}))}})),this.measureSync=(h,m)=>{this.markBlock(Object.assign(Object.assign({},h),{type:"start"}));try{return m()}finally{this.markBlock(Object.assign(Object.assign({},h),{type:"end"}))}},this.measures=()=>{const h=[];for(let[m,y]of Object.entries(this.blocks)){const{start:v,end:C}=y;if(!v||!C)continue;T.performance.measure(y.path,`${v.path}`,`${C.path}`);const[w]=T.performance.getEntriesByName(y.path);if(!w)throw new Error(`No measure found in Performance API for "${m}".`);h.push({id:y.id,name:y.name,measure:w})}return h},this.invokeBlock=h=>{const m=this.getBlockCallbackId(h),y=PerformanceBlocks.onEventEmitters[m];y&&y.fire(h)},this.getBlockCallbackId=h=>{const{id:m,type:y}=h;return`${m}-${y}`},this.onEvent=(h,m)=>{const y=this.getBlockCallbackId(h);let v=PerformanceBlocks.onEventEmitters[y];return v||(v=new C.Emitter,PerformanceBlocks.onEventEmitters[y]=v),v.event(m),this}}}m.PerformanceBlocks=PerformanceBlocks,PerformanceBlocks.onEventEmitters={}},function(h,m,y){"use strict";var v=this&&this.__importDefault||function(h){return h&&h.__esModule?h:{default:h}};Object.defineProperty(m,"__esModule",{value:!0});const C=v(y(1183)),T=y(1185),logInternal=(h,m,y,v,T)=>{const w=`[${y}ms - ${y+v}ms]`;console[h]([`${m}:`,C.default.cyan(`${v}ms`),C.default.magenta(`+${y-T}ms`),C.default.gray(w)].join(" "))},logEmptyNode=(h,m)=>{const{name:y,measure:v}=h,{startTime:C,duration:T}=v;((h,m,y,v)=>{logInternal("log",h,m,y,v)})(y,Math.round(C),Math.round(T),m)};m.logPerformanceWaterfall=(h,y)=>{const{measure:v,name:C}=h,{startTime:w,duration:A}=v,P=Math.round(w);y=null!=y?y:Math.round(w),((h,m,y,v)=>{logInternal("groupCollapsed",h,m,y,v)})(C,P,Math.round(A),y);for(let v of T.sortByStartTime([...h.groups]))v.groups.length?m.logPerformanceWaterfall(v,y):logEmptyNode(v,y);console.groupEnd()}},function(h,m,y){"use strict";
/*!
 * ansi-colors <https://github.com/doowb/ansi-colors>
 *
 * Copyright (c) 2015-2017, Brian Woodward.
 * Released under the MIT License.
 */var v=y(1184);m.bgblack=function bgblack(h){return v(40,49,h)},m.bgblue=function bgblue(h){return v(44,49,h)},m.bgcyan=function bgcyan(h){return v(46,49,h)},m.bggreen=function bggreen(h){return v(42,49,h)},m.bgmagenta=function bgmagenta(h){return v(45,49,h)},m.bgred=function bgred(h){return v(41,49,h)},m.bgwhite=function bgwhite(h){return v(47,49,h)},m.bgyellow=function bgyellow(h){return v(43,49,h)},m.black=function black(h){return v(30,39,h)},m.blue=function blue(h){return v(34,39,h)},m.bold=function bold(h){return v(1,22,h)},m.cyan=function cyan(h){return v(36,39,h)},m.dim=function dim(h){return v(2,22,h)},m.gray=function gray(h){return v(90,39,h)},m.green=function green(h){return v(32,39,h)},m.grey=function grey(h){return v(90,39,h)},m.hidden=function hidden(h){return v(8,28,h)},m.inverse=function inverse(h){return v(7,27,h)},m.italic=function italic(h){return v(3,23,h)},m.magenta=function magenta(h){return v(35,39,h)},m.red=function red(h){return v(31,39,h)},m.reset=function reset(h){return v(0,0,h)},m.strikethrough=function strikethrough(h){return v(9,29,h)},m.underline=function underline(h){return v(4,24,h)},m.white=function white(h){return v(37,39,h)},m.yellow=function yellow(h){return v(33,39,h)}},function(h,m,y){"use strict";h.exports=function(h,m,y){return"["+h+"m"+y+"["+m+"m"}},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0}),m.sortByStartTime=h=>[...h].sort((h,m)=>h.measure.startTime-m.measure.startTime)},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0});var v=y(1187);m.PerformanceMock=v.PerformanceMock},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0});const v=y(485);class PerformanceMock extends v.Performance{get groupsMock(){return this.groups}}m.PerformanceMock=PerformanceMock},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0});const v=y(15),C=y(2),T=y(487);m.testTrace=new v.TraceSource(C.randomString()),m.getRandomLiveShareMockOptions=()=>({liveShareEndpoint:"mock-liveshare-endpoint",workspaceId:"mock-id",connectionInfo:{id:"mock-connection-id",relayLink:"sb://test-namespace.servicebus.windows.net/anyEndpointId",relaySas:"mock-relay",hostPublicKeys:["mock-host-public-key"],sessionToken:"mock-session-token"},token:"mock-token",id:"mock-id",someProp:"mock-prop",numericProp:12345}),m.getLiveShareConnectionMockOptions=(h={})=>{const{trace:y=m.testTrace}=h;return[y,new T.PerformanceMock("test-performance","test-start","test-path-string"),Object.assign({},m.getRandomLiveShareMockOptions())]}},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0})},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0});const v=y(494),C=y(183),T=y(272);class ContactServiceProxy extends v.HubProxyBase{constructor(h,m,y){super(h,m,y?"presenceServiceHub":void 0),this.updatePropertiesCallbacks=new C.CallbackContainer,this.receiveMessageCallbacks=new C.CallbackContainer,this.connectionChangedCallbacks=new C.CallbackContainer,h.on(this.toHubMethodName("updateValues"),(h,m,y)=>this.updateValues(v.keysToCamel(h),m,y)),h.on(this.toHubMethodName("receiveMessage"),(h,m,y,C)=>this.receiveMessage(v.keysToCamel(h),v.keysToCamel(m),y,C)),h.on(this.toHubMethodName("connectionChanged"),(h,m)=>this.connectionChanged(v.keysToCamel(h),m))}onUpdateProperties(h){return this.updatePropertiesCallbacks.add(h)}onMessageReceived(h){return this.receiveMessageCallbacks.add(h)}onConnectionChanged(h){return this.connectionChangedCallbacks.add(h)}async registerSelfContact(h,m){return await this.invoke("RegisterSelfContactAsync",h,m)}publishProperties(h){return this.send("PublishPropertiesAsync",h)}sendMessage(h,m,y){return this.send("SendMessageAsync",h,m,y)}async addSubcriptions(h,m){return this.invoke("AddSubcriptionsAsync",h,m)}requestSubcriptions(h,m,y){return this.invoke("RequestSubcriptionsAsync",h,m,y)}removeSubscription(h){return this.send("RemoveSubscription",h)}unregisterSelfContact(){return this.send("UnregisterSelfContactAsync")}updateValues(h,m,y){this.logger&&this.logger.log(T.LogLevel.Debug,`ContactServiceProxy.updateValues contact:${JSON.stringify(h)} properties:${JSON.stringify(m)}`),this.updatePropertiesCallbacks.items.forEach(v=>v(h,m,y))}receiveMessage(h,m,y,v){this.logger&&this.logger.log(T.LogLevel.Debug,`ContactServiceProxy.receiveMessage targetContact:${JSON.stringify(h)} fromContact:${JSON.stringify(m)} messageType:${y} body:${JSON.stringify(v)}`),this.receiveMessageCallbacks.items.forEach(C=>C(h,m,y,v))}connectionChanged(h,m){this.logger&&this.logger.log(T.LogLevel.Debug,`ContactServiceProxy.connectionChanged contact:${JSON.stringify(h)} changeType:${m}`),this.connectionChangedCallbacks.items.forEach(y=>y(h,m))}}m.ContactServiceProxy=ContactServiceProxy},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0});const v=y(495),C=y(494),T=y(493),w=y(183),A=y(272);var P;!function(h){h.ReceiveData="receiveData",h.ParticipantChanged="participantChanged",h.HubDeleted="hubDeleted",h.CreateHub="CreateHubAsync",h.DeleteHub="DeleteHubAsync",h.JoinHub="JoinHubAsync",h.SendDataHubEx="SendDataHubExAsync",h.LeaveHub="LeaveHubAsync",h.Update="UpdateAsync"}(P||(P={}));class RelayServiceProxy extends C.HubProxyBase{constructor(h,m,y){super(h,m,y?"relayServiceHub":void 0),this.relayHubs=new Map,this.traceHubData=!1;const v="undefined"!=typeof process&&void 0!==process.release&&"node"===process.release.name;h.onConnectionStateChanged(async()=>{h.isConnected||(await Promise.all(Array.from(this.relayHubs.values()).map(h=>h._OnDisconnected())),this.relayHubs.clear())}),h.on(this.toHubMethodName(P.ReceiveData),async(h,m,y,C,T,w)=>{let P;P="string"==typeof T?v?Buffer.from(T,"base64"):k.decode(T):T,this.logger&&this.traceHubData&&this.logger.log(A.LogLevel.Debug,`receiveData -> hubId:${h} fromParticipantId:${m} type:${C} length:${P?P.length:0} crc:${P?crc32(P):"n/a"} properties:${JSON.stringify(w)}`);const R=this.relayHubs.get(h);R&&await R._OnReceiveData(m,y,C,P,w)}),h.on(this.toHubMethodName(P.ParticipantChanged),async(h,m,y,v)=>{this.logger&&this.logger.log(A.LogLevel.Debug,`participantChanged -> hubId:${h} participantId:${m} properties:${JSON.stringify(y)} changeType:${v}`);const C=this.relayHubs.get(h);C&&await C._OnParticipantChanged(m,y,v)}),h.on(this.toHubMethodName(P.HubDeleted),async h=>{this.logger&&this.logger.log(A.LogLevel.Debug,`hubDeleted -> hubId:${h}`);const m=this.relayHubs.get(h);m&&(this.relayHubs.delete(h),await m._OnDeleted())})}createHub(h){return this.invoke(P.CreateHub,h)}async joinHub(h,m,y){let v=this.relayHubs.get(h);return v?v.isDisconnected&&await v.rejoin(y):v=await this._joinHubInternal(m=>new RelayHubProxy(this,h,m),h,m,y),v}async deleteHub(h){await this.invoke(P.DeleteHub,h)}async _joinHubInternal(h,m,y,v){const T=h(await this.invokeKeysToCamel(P.JoinHub,m,y,C.keysToPascal(v)));return this.relayHubs.set(m,T),T}}m.RelayServiceProxy=RelayServiceProxy;class RelayHubProxy{constructor(h,m,y){this.relayServiceProxy=h,this.id=m,this.receiveDataCallbacks=new w.CallbackContainer,this.participantChangedCallbacks=new w.CallbackContainer,this.hubDeletedCallbacks=new w.CallbackContainer,this.hubDisconnectedCallbacks=new w.CallbackContainer,this.joinHubInfo=null,this.selfParticipantInstance=null,this.hubParticipants=new Map,this.isDisconnected=!1,this.setJoinHubInfo(y)}setJoinHubInfo(h){this.hubParticipants.clear(),h.participants.forEach(m=>{const y={id:m.id,properties:m.properties};h.participantId===m.id&&(this.selfParticipantInstance=y),this.hubParticipants.set(m.id,y)}),this.joinHubInfo=h}get serviceId(){return this.joinHubInfo.serviceId}get stamp(){return this.joinHubInfo.stamp}get selfParticipant(){return this.selfParticipantInstance}get participants(){return Array.from(this.hubParticipants.values())}onReceiveData(h){return this.receiveDataCallbacks.add(h)}onParticipantChanged(h){return this.participantChangedCallbacks.add(h)}onDeleted(h){return this.hubDeletedCallbacks.add(h)}onDisconnected(h){return this.hubDisconnectedCallbacks.add(h)}async rejoin(h){if(!this.isDisconnected)throw new Error(`Relay hub:${this.id} is connected`);await this.relayServiceProxy._joinHubInternal(h=>(this.setJoinHubInfo(h),this),this.id,this.selfParticipant.properties,h||{})}async sendData(h,m,y,v,w,k){const R=this.relayServiceProxy.logger;R&&this.relayServiceProxy.traceHubData&&R.log(A.LogLevel.Debug,`sendData -> hubId:${this.id} option:${h} target:${JSON.stringify(m)} type:${y} length:${v?v.length:0} crc:${v?crc32(v):"n/a"} properties:${JSON.stringify(w)}`);const M=v?Array.from(v):null,N={hubId:this.id,sendOption:h,targetParticipantIds:m||null,type:y},D=C.keysToPascal(N);return D.MessageProperties=w,k===T.HubMethodOption.Invoke?await this.relayServiceProxy.invoke(P.SendDataHubEx,D,M):(await this.relayServiceProxy.send(P.SendDataHubEx,D,M),0)}async update(h){await this.relayServiceProxy.invoke(P.Update,this.id,h)}async dispose(){const h=this.relayServiceProxy.logger;h&&h.log(A.LogLevel.Debug,`leaving -> hubId:${this.id}`),await this.relayServiceProxy.send(P.LeaveHub,this.id),this._OnDisconnected()}async _OnDeleted(){for(const h of this.hubDeletedCallbacks.items)await h()}async _OnDisconnected(){this.isDisconnected=!0;for(const h of this.hubDisconnectedCallbacks.items)await h()}async _OnReceiveData(h,m,y,v,C){const T=this.hubParticipants.get(h);if(T){const h={fromParticipant:T,uniqueId:m,type:y,data:v,properties:C};for(const m of this.receiveDataCallbacks.items)await m(h)}}async _OnParticipantChanged(h,m,y){let C;if(y===v.ParticipantChangeType.Added?(C={id:h,properties:m},this.hubParticipants.set(h,C)):y===v.ParticipantChangeType.Removed?(C=this.hubParticipants.get(h),this.hubParticipants.delete(h)):y===v.ParticipantChangeType.Updated&&(C=this.hubParticipants.get(h),C&&(C.properties=m)),C){const h={participant:C,changeType:y};for(const m of this.participantChangedCallbacks.items)await m(h)}}}const k={_keyStr:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",decodeArrayBuffer:function(h){var m=parseInt(h.length/4*3,10),y=new ArrayBuffer(m);return this.decode(h,y),y},removePaddingChars:function(h){return 64==this._keyStr.indexOf(h.charAt(h.length-1))?h.substring(0,h.length-1):h},decode:function(h,m){h=this.removePaddingChars(h);var y,v,C,T,w,A,P,k=(h=this.removePaddingChars(h)).length/4*3,R=0,M=0;for(y=m?new Uint8Array(m):new Uint8Array(k),h=h.replace(/[^A-Za-z0-9\+\/\=]/g,""),R=0;R<k;R+=3)v=this._keyStr.indexOf(h.charAt(M++))<<2|(w=this._keyStr.indexOf(h.charAt(M++)))>>4,C=(15&w)<<4|(A=this._keyStr.indexOf(h.charAt(M++)))>>2,T=(3&A)<<6|(P=this._keyStr.indexOf(h.charAt(M++))),y[R]=v,64!=A&&(y[R+1]=C),64!=P&&(y[R+2]=T);return y}};let R;function crc32(h){R||(R=function makeCrcTable(){let h;const m=[];for(let y=0;y<256;y++){h=y;for(let m=0;m<8;m++)h=1&h?3988292384^h>>>1:h>>>1;m[y]=h}return m}());let m=-1;for(let y=0;y<h.length;y++)m=m>>>8^R[255&(m^h[y])];return(((-1^m)>>>0)+4294967296).toString(16).substr(-8).toUpperCase()}},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0});const v=y(496),C=y(497);class SequenceRelayDataHubProxy extends v.RelayDataHubProxy{constructor(h,m,y){super(h,m),this.receiveDataBuffer=new Map,this.currentSequence=y||0,this.totalEvents=0}static createForTypeAndParticipant(h,m,y,v){return new SequenceRelayDataHubProxy(h,h=>h.type===m&&h.fromParticipant.id===y,v)}async processReceivedData(h){const m=C.RelayHubMessageProperties.getMessageSequence(h.properties);if(m&&-1!==m)if(-1===this.currentSequence||this.currentSequence+1===m)for(this.currentSequence=m,await this.fireReceivedData(h);;){const h=this.tryRemove(this.currentSequence+1);if(!h)break;await this.fireReceivedData(h),++this.currentSequence}else m>this.currentSequence&&m-this.currentSequence>10&&console.debug(`###-----\x3e sequence/current:${m}/${this.currentSequence}`),this.receiveDataBuffer.set(m,h),++this.totalEvents;else await this.fireReceivedData(h)}tryRemove(h){const m=this.receiveDataBuffer.get(h);if(m)return this.receiveDataBuffer.delete(h),m}}m.SequenceRelayDataHubProxy=SequenceRelayDataHubProxy},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0});var v=y(1194);m.HubClient=v.HubClient},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0});const v=y(330),C=y(1195),T=y(66),w=y(1197),A=y(1198);class HubClient{constructor(h,m){this.hubConnection=h,this.logger=m,this.isRunningFlag=!1,this.attemptConnectionCallbacks=new T.CallbackContainer,this.connectionStateCallbacks=new T.CallbackContainer,this.connectSleepCancellation=new A.CancellationToken,h.onclose(h=>this.onClosed(h)),this.hubProxyInstance=new w.HubProxy(this)}static createWithHub(h,m){return new HubClient(h,m)}static create(h,m,y){return y&&y.log(v.LogLevel.Debug,`createWithOptions url:${h}`),new HubClient((new v.HubConnectionBuilder).withUrl(h,m).build(),y)}get hubProxy(){return this.hubProxyInstance}start(){return this.isRunning||(this.log(v.LogLevel.Debug,"HubClient.start"),this.isRunningFlag=!0,this.state===v.HubConnectionState.Connected)?Promise.resolve():this.attemptConnect()}async stop(){this.isRunning&&(this.log(v.LogLevel.Debug,"HubClient.stop"),this.isRunningFlag=!1,await this.hubConnection.stop())}connect(){return this.state===v.HubConnectionState.Connected?Promise.resolve():new Promise((h,m)=>{const y=this.onAttemptConnection((C,T,w)=>(this.log(v.LogLevel.Debug,`connect err:${w}`),y.dispose(),w?m(w):h(),Promise.resolve()));this.isRunning?this.connectSleepCancellation.cancel():this.start()})}get state(){return this.hubConnection.state}get isConnected(){return this.state===v.HubConnectionState.Connected}get isRunning(){return this.isRunningFlag}onAttemptConnection(h){return this.attemptConnectionCallbacks.add(h)}onConnectionStateChanged(h){return this.connectionStateCallbacks.add(h)}async attemptConnect(){this.log(v.LogLevel.Debug,"attemptConnect"),await this.fireAttemptConnection(0,0,void 0),await C.connect(this.hubConnection,async(h,m,y)=>this.isRunningFlag?(await this.fireAttemptConnection(h,m,y),void 0!==m?m:0):-1,-1,5e3,6e4,this.logger?this.logger:v.NullLogger.instance,this.connectSleepCancellation),this.isConnected&&await this.fireConnectionStateChanged()}async onClosed(h){this.log(v.LogLevel.Debug,`onClosed error:${h}`),await this.fireConnectionStateChanged(),this.isRunning&&this.attemptConnect()}log(h,m){this.logger&&this.logger.log(h,m)}async fireConnectionStateChanged(){for(const h of this.connectionStateCallbacks.items)await h()}async fireAttemptConnection(h,m,y){for(const v of this.attemptConnectionCallbacks.items)await v(h,m,y)}}m.HubClient=HubClient},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0});const v=y(330),C=y(1196);function sleep(h,m){return new Promise(y=>{let v;const resolveCallback=()=>{v&&v.dispose(),y()},C=setTimeout(()=>{resolveCallback()},h);v=m.onCancellationRequest(()=>{clearTimeout(C),resolveCallback()})})}m.connect=async function connect(h,m,y,T,w,A,P){const k=new C.ExponentialBackoff(y,T,w);for(;;)try{A.log(v.LogLevel.Debug,`hubConnection.start -> retries:${k.retriesCount}`),await h.start(),await m(k.retriesCount),A.log(v.LogLevel.Debug,"Succesfully connected...");break}catch(h){let y=k.nextDelayMilliseconds();if(A.log(v.LogLevel.Error,`Failed to connect-> delay:${y} err:${JSON.stringify(h)}`),y=await m(k.retriesCount,y,h),-1===y)break;await sleep(y,P)}}},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0});m.ExponentialBackoff=class ExponentialBackoff{constructor(h,m,y){this.maxRetries=h,this.delayMilliseconds=m,this.maxDelayMilliseconds=y,this.retries=0,this.pow=1}get retriesCount(){return this.retries}nextDelayMilliseconds(){if(-1!==this.maxRetries&&this.retries===this.maxRetries)throw new Error("Max retry attempts exceeded.");return++this.retries,this.retries<31&&(this.pow=this.pow<<1),Math.min(this.delayMilliseconds*(this.pow-1)/2,this.maxDelayMilliseconds)}}},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0});m.HubProxy=class HubProxy{constructor(h){this.hubClient=h}get hubConnection(){return this.hubClient.hubConnection}get isConnected(){return this.hubClient.isConnected}connect(){return this.hubClient.connect()}onConnectionStateChanged(h){return this.hubClient.onConnectionStateChanged(h)}send(h,...m){return this.hubConnection.send(h,...m)}invoke(h,...m){return this.hubConnection.invoke(h,...m)}on(h,m){return this.hubConnection.on(h,m),{dispose:()=>this.hubConnection.off(h)}}}},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0});const v=y(66);m.CancellationToken=class CancellationToken{constructor(){this.cancellationRequestCallbacks=new v.CallbackContainer}onCancellationRequest(h){return this.cancellationRequestCallbacks.add(h)}cancel(){for(const h of this.cancellationRequestCallbacks.items)h()}}},function(h,m){"function"==typeof Object.create?h.exports=function inherits(h,m){m&&(h.super_=m,h.prototype=Object.create(m.prototype,{constructor:{value:h,enumerable:!1,writable:!0,configurable:!0}}))}:h.exports=function inherits(h,m){if(m){h.super_=m;var TempCtor=function(){};TempCtor.prototype=m.prototype,h.prototype=new TempCtor,h.prototype.constructor=h}}},function(h,m,y){"use strict";var v=y(187).Buffer,C=y(10);h.exports=function(){function BufferList(){!function _classCallCheck(h,m){if(!(h instanceof m))throw new TypeError("Cannot call a class as a function")}(this,BufferList),this.head=null,this.tail=null,this.length=0}return BufferList.prototype.push=function push(h){var m={data:h,next:null};this.length>0?this.tail.next=m:this.head=m,this.tail=m,++this.length},BufferList.prototype.unshift=function unshift(h){var m={data:h,next:this.head};0===this.length&&(this.tail=m),this.head=m,++this.length},BufferList.prototype.shift=function shift(){if(0!==this.length){var h=this.head.data;return 1===this.length?this.head=this.tail=null:this.head=this.head.next,--this.length,h}},BufferList.prototype.clear=function clear(){this.head=this.tail=null,this.length=0},BufferList.prototype.join=function join(h){if(0===this.length)return"";for(var m=this.head,y=""+m.data;m=m.next;)y+=h+m.data;return y},BufferList.prototype.concat=function concat(h){if(0===this.length)return v.alloc(0);if(1===this.length)return this.head.data;for(var m,y,C,T=v.allocUnsafe(h>>>0),w=this.head,A=0;w;)m=w.data,y=T,C=A,m.copy(y,C),A+=w.data.length,w=w.next;return T},BufferList}(),C&&C.inspect&&C.inspect.custom&&(h.exports.prototype[C.inspect.custom]=function(){var h=C.inspect({length:this.length});return this.constructor.name+" "+h})},function(h,m,y){h.exports=y(10).deprecate},function(h,m,y){"use strict";h.exports=PassThrough;var v=y(505),C=Object.create(y(136));function PassThrough(h){if(!(this instanceof PassThrough))return new PassThrough(h);v.call(this,h)}C.inherits=y(105),C.inherits(PassThrough,v),PassThrough.prototype._transform=function(h,m,y){y(null,h)}},function(h,m,y){"use strict";var v=y(499).Transform,C=y(105),T=y(184);function Base(h){(h=h||{}).objectMode=!0,h.highWaterMark=16,v.call(this,h),this._msgpack=h.msgpack}function Encoder(h){if(!(this instanceof Encoder))return(h=h||{}).msgpack=this,new Encoder(h);Base.call(this,h),this._wrap="wrap"in h&&h.wrap}function Decoder(h){if(!(this instanceof Decoder))return(h=h||{}).msgpack=this,new Decoder(h);Base.call(this,h),this._chunks=T(),this._wrap="wrap"in h&&h.wrap}C(Base,v),C(Encoder,Base),Encoder.prototype._transform=function(h,m,y){var v=null;try{v=this._msgpack.encode(this._wrap?h.value:h).slice(0)}catch(h){return this.emit("error",h),y()}this.push(v),y()},C(Decoder,Base),Decoder.prototype._transform=function(h,m,y){h&&this._chunks.append(h);try{var v=this._msgpack.decode(this._chunks);this._wrap&&(v={value:v}),this.push(v)}catch(h){return void(h instanceof this._msgpack.IncompleteBufferError?y():this.emit("error",h))}this._chunks.length>0?this._transform(null,m,y):y()},h.exports.decoder=Decoder,h.exports.encoder=Encoder},function(h,m,y){"use strict";var v=y(184);function IncompleteBufferError(h){Error.call(this),Error.captureStackTrace&&Error.captureStackTrace(this,this.constructor),this.name=this.constructor.name,this.message=h||"unable to decode"}y(10).inherits(IncompleteBufferError,Error),h.exports=function buildDecode(h,m){return function decode(h){h instanceof v||(h=v().append(h));var m=tryDecode(h);if(m)return h.consume(m.bytesConsumed),m.value;throw new IncompleteBufferError};function isValidDataSize(h,m,y){return m>=y+h}function buildDecodeResult(h,m){return{value:h,bytesConsumed:m}}function tryDecode(h,m){m=void 0===m?0:m;var y=h.length-m;if(y<=0)return null;var v,C,T,w=h.readUInt8(m),A=0;if(!function hasMinBufferSize(h,m){var y=function getSize(h){switch(h){case 196:return 2;case 197:return 3;case 198:return 5;case 199:return 3;case 200:return 4;case 201:return 6;case 202:return 5;case 203:return 9;case 204:return 2;case 205:return 3;case 206:return 5;case 207:return 9;case 208:return 2;case 209:return 3;case 210:return 5;case 211:return 9;case 212:return 3;case 213:return 4;case 214:return 6;case 215:return 10;case 216:return 18;case 217:return 2;case 218:return 3;case 219:return 5;case 222:return 3;default:return-1}}(h);return!(-1!==y&&m<y)}(w,y))return null;switch(w){case 192:return buildDecodeResult(null,1);case 194:return buildDecodeResult(!1,1);case 195:return buildDecodeResult(!0,1);case 204:return buildDecodeResult(A=h.readUInt8(m+1),2);case 205:return buildDecodeResult(A=h.readUInt16BE(m+1),3);case 206:return buildDecodeResult(A=h.readUInt32BE(m+1),5);case 207:for(T=7;T>=0;T--)A+=h.readUInt8(m+T+1)*Math.pow(2,8*(7-T));return buildDecodeResult(A,9);case 208:return buildDecodeResult(A=h.readInt8(m+1),2);case 209:return buildDecodeResult(A=h.readInt16BE(m+1),3);case 210:return buildDecodeResult(A=h.readInt32BE(m+1),5);case 211:return buildDecodeResult(A=function readInt64BE(h,m){var y=128==(128&h[m]);if(y)for(var v=1,C=m+7;C>=m;C--){var T=(255^h[C])+v;h[C]=255&T,v=T>>8}var w=h.readUInt32BE(m+0),A=h.readUInt32BE(m+4);return(4294967296*w+A)*(y?-1:1)}(h.slice(m+1,m+9),0),9);case 202:return buildDecodeResult(A=h.readFloatBE(m+1),5);case 203:return buildDecodeResult(A=h.readDoubleBE(m+1),9);case 217:return isValidDataSize(v=h.readUInt8(m+1),y,2)?buildDecodeResult(A=h.toString("utf8",m+2,m+2+v),2+v):null;case 218:return isValidDataSize(v=h.readUInt16BE(m+1),y,3)?buildDecodeResult(A=h.toString("utf8",m+3,m+3+v),3+v):null;case 219:return isValidDataSize(v=h.readUInt32BE(m+1),y,5)?buildDecodeResult(A=h.toString("utf8",m+5,m+5+v),5+v):null;case 196:return isValidDataSize(v=h.readUInt8(m+1),y,2)?buildDecodeResult(A=h.slice(m+2,m+2+v),2+v):null;case 197:return isValidDataSize(v=h.readUInt16BE(m+1),y,3)?buildDecodeResult(A=h.slice(m+3,m+3+v),3+v):null;case 198:return isValidDataSize(v=h.readUInt32BE(m+1),y,5)?buildDecodeResult(A=h.slice(m+5,m+5+v),5+v):null;case 220:return y<3?null:(v=h.readUInt16BE(m+1),decodeArray(h,m,v,3));case 221:return y<5?null:(v=h.readUInt32BE(m+1),decodeArray(h,m,v,5));case 222:return v=h.readUInt16BE(m+1),decodeMap(h,m,v,3);case 223:return v=h.readUInt32BE(m+1),decodeMap(h,m,v,5);case 212:return decodeFixExt(h,m,1);case 213:return decodeFixExt(h,m,2);case 214:return decodeFixExt(h,m,4);case 215:return decodeFixExt(h,m,8);case 216:return decodeFixExt(h,m,16);case 199:return v=h.readUInt8(m+1),C=h.readUInt8(m+2),isValidDataSize(v,y,3)?decodeExt(h,m,C,v,3):null;case 200:return v=h.readUInt16BE(m+1),C=h.readUInt8(m+3),isValidDataSize(v,y,4)?decodeExt(h,m,C,v,4):null;case 201:return v=h.readUInt32BE(m+1),C=h.readUInt8(m+5),isValidDataSize(v,y,6)?decodeExt(h,m,C,v,6):null}if(144==(240&w))return decodeArray(h,m,v=15&w,1);if(128==(240&w))return decodeMap(h,m,v=15&w,1);if(160==(224&w))return isValidDataSize(v=31&w,y,1)?buildDecodeResult(A=h.toString("utf8",m+1,m+v+1),v+1):null;if(w>=224)return buildDecodeResult(A=w-256,1);if(w<128)return buildDecodeResult(w,1);throw new Error("not implemented yet")}function decodeArray(h,m,y,v){var C,T=[],w=0;for(m+=v,C=0;C<y;C++){var A=tryDecode(h,m);if(!A)return null;T.push(A.value),m+=A.bytesConsumed,w+=A.bytesConsumed}return buildDecodeResult(T,v+w)}function decodeMap(h,y,v,C){var T,w,A={},P=0;for(y+=C,w=0;w<v;w++){var k=tryDecode(h,y);if(!k)return null;var R=tryDecode(h,y+=k.bytesConsumed);if(!R)return null;if("__proto__"===(T=k.value)){if("error"===m.protoAction)throw new SyntaxError("Object contains forbidden prototype property");if("remove"===m.protoAction)continue}A[T]=R.value,y+=R.bytesConsumed,P+=k.bytesConsumed+R.bytesConsumed}return buildDecodeResult(A,C+P)}function decodeFixExt(h,m,y){var v=h.readInt8(m+1);return decodeExt(h,m,v,y,2)}function decodeExt(m,y,v,C,T){var w,A;if(y+=T,v<0)switch(v){case-1:return function decodeTimestamp(h,m,y){var v,C=0;switch(m){case 4:v=h.readUInt32BE(0);break;case 8:var T=h.readUInt32BE(0),w=h.readUInt32BE(4);C=T/4,v=(3&T)*Math.pow(2,32)+w;break;case 12:throw new Error("timestamp 96 is not yet implemented")}var A=1e3*v+Math.round(C/1e6);return buildDecodeResult(new Date(A),m+y)}(A=m.slice(y,y+C),C,T)}for(w=0;w<h.length;w++){if(v===h[w].type)return A=m.slice(y,y+C),buildDecodeResult(h[w].decode(A),T+C)}throw new Error("unable to find ext type "+v)}},h.exports.IncompleteBufferError=IncompleteBufferError},function(h,m,y){"use strict";var v=y(274).Buffer,C=y(184);function encodeFloat(h,m){var y,C=!0;return Math.fround&&(C=Math.fround(h)!==h),m&&(C=!0),C?((y=v.allocUnsafe(9))[0]=203,y.writeDoubleBE(h,1)):((y=v.allocUnsafe(5))[0]=202,y.writeFloatBE(h,1)),y}h.exports=function buildEncode(h,m,y,T){function encode(w,A){var P,k;if(void 0===w)throw new Error("undefined is not encodable in msgpack!");if(function isNaN(h){return h!=h&&"number"==typeof h}(w))throw new Error("NaN is not encodable in msgpack!");if(null===w)(P=v.allocUnsafe(1))[0]=192;else if(!0===w)(P=v.allocUnsafe(1))[0]=195;else if(!1===w)(P=v.allocUnsafe(1))[0]=194;else if("string"==typeof w)(k=v.byteLength(w))<32?((P=v.allocUnsafe(1+k))[0]=160|k,k>0&&P.write(w,1)):k<=255&&!y?((P=v.allocUnsafe(2+k))[0]=217,P[1]=k,P.write(w,2)):k<=65535?((P=v.allocUnsafe(3+k))[0]=218,P.writeUInt16BE(k,1),P.write(w,3)):((P=v.allocUnsafe(5+k))[0]=219,P.writeUInt32BE(k,1),P.write(w,5));else if(w&&(w.readUInt32LE||w instanceof Uint8Array))w instanceof Uint8Array&&(w=v.from(w)),w.length<=255?((P=v.allocUnsafe(2))[0]=196,P[1]=w.length):w.length<=65535?((P=v.allocUnsafe(3))[0]=197,P.writeUInt16BE(w.length,1)):((P=v.allocUnsafe(5))[0]=198,P.writeUInt32BE(w.length,1)),P=C([P,w]);else if(Array.isArray(w))w.length<16?(P=v.allocUnsafe(1))[0]=144|w.length:w.length<65536?((P=v.allocUnsafe(3))[0]=220,P.writeUInt16BE(w.length,1)):((P=v.allocUnsafe(5))[0]=221,P.writeUInt32BE(w.length,1)),P=w.reduce((function(h,m){return h.append(encode(m,!0)),h}),C().append(P));else{if(!T&&"function"==typeof w.getDate)return function encodeDate(h){var m,y=1*h,T=Math.floor(y/1e3),w=1e6*(y-1e3*T);if(w||T>4294967295){(m=v.allocUnsafe(10))[0]=215,m[1]=-1;var A=4*w,P=T/Math.pow(2,32),k=A+P&4294967295,R=4294967295&T;m.writeInt32BE(k,2),m.writeInt32BE(R,6)}else(m=v.allocUnsafe(6))[0]=214,m[1]=-1,m.writeUInt32BE(Math.floor(y/1e3),2);return C().append(m)}(w);if("object"==typeof w)P=function encodeExt(m){var y,T,w,A=[];for(y=0;y<h.length;y++)if(h[y].check(m)){T=h[y].encode(m);break}if(!T)return null;1===(w=T.length-1)?A.push(212):2===w?A.push(213):4===w?A.push(214):8===w?A.push(215):16===w?A.push(216):w<256?(A.push(199),A.push(w)):w<65536?(A.push(200),A.push(w>>8),A.push(255&w)):(A.push(201),A.push(w>>24),A.push(w>>16&255),A.push(w>>8&255),A.push(255&w));return C().append(v.from(A)).append(T)}(w)||function encodeObject(h){var m,y,T=[],w=0;for(m in h)h.hasOwnProperty(m)&&void 0!==h[m]&&"function"!=typeof h[m]&&(++w,T.push(encode(m,!0)),T.push(encode(h[m],!0)));w<16?(y=v.allocUnsafe(1))[0]=128|w:w<65535?((y=v.allocUnsafe(3))[0]=222,y.writeUInt16BE(w,1)):((y=v.allocUnsafe(5))[0]=223,y.writeUInt32BE(w,1));return T.unshift(y),T.reduce((function(h,m){return h.append(m)}),C())}(w);else if("number"==typeof w){if(function isFloat(h){return h%1!=0}(w))return encodeFloat(w,m);if(w>=0)if(w<128)(P=v.allocUnsafe(1))[0]=w;else if(w<256)(P=v.allocUnsafe(2))[0]=204,P[1]=w;else if(w<65536)(P=v.allocUnsafe(3))[0]=205,P.writeUInt16BE(w,1);else if(w<=4294967295)(P=v.allocUnsafe(5))[0]=206,P.writeUInt32BE(w,1);else{if(!(w<=9007199254740991))return encodeFloat(w,!0);(P=v.allocUnsafe(9))[0]=207,function write64BitUint(h,m){for(var y=7;y>=0;y--)h[y+1]=255&m,m/=256}(P,w)}else if(w>=-32)(P=v.allocUnsafe(1))[0]=256+w;else if(w>=-128)(P=v.allocUnsafe(2))[0]=208,P.writeInt8(w,1);else if(w>=-32768)(P=v.allocUnsafe(3))[0]=209,P.writeInt16BE(w,1);else if(w>-214748365)(P=v.allocUnsafe(5))[0]=210,P.writeInt32BE(w,1);else{if(!(w>=-9007199254740991))return encodeFloat(w,!0);(P=v.allocUnsafe(9))[0]=211,function write64BitInt(h,m,y){var v=y<0;v&&(y=Math.abs(y));var C=y%4294967296,T=y/4294967296;if(h.writeUInt32BE(Math.floor(T),m+0),h.writeUInt32BE(C,m+4),v)for(var w=1,A=m+7;A>=m;A--){var P=(255^h[A])+w;h[A]=255&P,w=P>>8}}(P,1,w)}}}if(!P)throw new Error("not implemented yet");return A?P:P.slice()}return encode}},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0});const v=y(273),C=y(506);class HubConnectionServiceFactory extends C.HubConnectionServiceFactoryBase{constructor(h,m,y){super(m,y),this.hubAuthentication=h}createHubConnectionService(h,m,y){return v.HubConnectionService.create(this.hubAuthentication,h,y)}}m.HubConnectionServiceFactory=HubConnectionServiceFactory},function(h,m,y){"use strict";var v=this&&this.__awaiter||function(h,m,y,v){return new(y||(y=Promise))((function(C,T){function fulfilled(h){try{step(v.next(h))}catch(h){T(h)}}function rejected(h){try{step(v.throw(h))}catch(h){T(h)}}function step(h){h.done?C(h.value):function adopt(h){return h instanceof y?h:new y((function(m){m(h)}))}(h.value).then(fulfilled,rejected)}step((v=v.apply(h,m||[])).next())}))};Object.defineProperty(m,"__esModule",{value:!0});const C=y(6),T=y(4),w=y(491),A=y(16),P=y(2),k=y(273),R=y(507);m.RpcHubConnectionService=class RpcHubConnectionService{constructor(h,m){this.rpcServer=h,this.trace=m,this.nextHubId=0,this.hubServices=new Map,this.onConnectionStateChangedEmitter=new C.Emitter,this.onRunningStateChangedEmitter=new C.Emitter,this.onAttemptConnectionEmitter=new C.Emitter,this.onConnectionStateChanged=this.onConnectionStateChangedEmitter.event,this.onRunningStateChanged=this.onRunningStateChangedEmitter.event,this.onAttemptConnection=this.onAttemptConnectionEmitter.event,h.registerRpcService(this,w.rpcHubConnectionServiceInfo)}dispose(){}_getOrCreate(h){return v(this,void 0,void 0,(function*(){if(0===this.hubServices.size)throw new Error("No hub connection service is defined");const[m]=this.hubServices.values();if(void 0===h||(yield m.stamp())===h)return this.trace.verbose(`_getOrCreate default -> uri: ${m.uri} stamp:${h}`),m.service.hubConnectionService;const y=new URL(m.uri),v=`${y.protocol}//${h}-${y.host}${y.pathname}`;this.trace.verbose(`_getOrCreate creating -> uri: ${v} stamp:${h}`);const T=new C.Emitter,w=new k.HubConnectionService({onAuthenticationChanged:T.event},v,this.trace.withName(`HubConnectionService:${h}`));return w.setCurrentUserInfo(m.service.hubConnectionService.currentUserInfo),w}))}getOrCreateService(h,m){return this.getOrCreateInternal(h,m)[1].service.hubConnectionService}getOrCreateAsync(h,m,y){A.assertRpcRequestContext(y);const v=this.getOrCreateInternal(h,y),C=v[1].service.hubConnectionService,T={hubId:v[0],isEnabled:C.enabled,isConnected:C.isConnected,isRunning:C.isRunning,authUserInfo:C.currentUserInfo};return Promise.resolve(T)}setHubEnabledAsync(h,m,y){return this.trace.info(`-> setHubEnabled hubId:${h} newState:${m}`),this.getHubServiceInfo(h).service.setEnabledAsync(m)}setHubAuthenticateInfoAsync(h,m,y){var v;return this.trace.info(`-> setHubAuthenticateInfo hubId:${h} user id:${null===(v=null==m?void 0:m.userInfo)||void 0===v?void 0:v.id}`),this.getHubServiceInfo(h).hubAuthChangedEmitter.fire({account:m.userInfo,accessToken:m.accessToken}),Promise.resolve()}getOrCreateInternal(h,m){A.assertRpcRequestContext(m),this.trace.info(`-> getOrCreate uri:${h} session:${m.session}`);const y=this.getHubServiceEntry(h);if(y)return this.addRpcConnection(h,y[0],y[1],m),y;this.trace.info(`Adding hub service with uri:${h}`);const v=new C.Emitter,w=++this.nextHubId,M=new k.HubConnectionService({onAuthenticationChanged:v.event},h,this.trace.withName(`HubConnectionService:${w}`));M.onAttemptConnection(h=>{this.onAttemptConnectionEmitter.fire(Object.assign(Object.assign({},h),{hubId:w}))}),M.onConnectionStateChanged(()=>{this.onConnectionStateChangedEmitter.fire({hubId:w,state:M.isConnected})}),M.onRunningStateChanged(()=>{this.onRunningStateChangedEmitter.fire({hubId:w,state:M.isRunning})});const N=new VslsHubConnectionService(M,this.trace),D=Object.assign(Object.assign({},T.vsls.HubConnectionService),{name:`${T.vsls.HubConnectionService.name}:${w}`}),I=this.rpcServer.registerRpcService(N,D),x={uri:h,service:N,hubAuthChangedEmitter:v,rpcConnections:new Set,stamp:P.once(()=>R.getStampFromUri(h,this.trace)),dispose:()=>{I.dispose(),M.enabled=!1}};return this.hubServices.set(w,x),this.addRpcConnection(h,w,x,m),[w,x]}removeRpcConnection(h,m,y,v){y.rpcConnections.delete(v.connection)&&(this.trace.info(`Remove rpc session:${v.session} uri:${h}`),0===y.rpcConnections.size&&P.wait(15e3).then(()=>{0===y.rpcConnections.size&&(this.trace.info(`Removing hub service with uri:${h}`),y.dispose(),this.hubServices.delete(m))}).catch(()=>{}))}addRpcConnection(h,m,y,v){y.rpcConnections.has(v.connection)||(this.trace.info(`Adding rpc session:${v.session} uri:${h}`),y.rpcConnections.add(v.connection),v.connection.onClose(()=>this.removeRpcConnection(h,m,y,v)),v.connection.onDispose(()=>this.removeRpcConnection(h,m,y,v)))}getHubServiceEntry(h){return Array.from(this.hubServices.entries()).find(m=>m[1].uri===h)}getHubServiceInfo(h){const m=this.hubServices.get(h);if(!m)throw new Error(`Hub service:${h} not defined`);return m}};class VslsHubConnectionService{constructor(h,m){this.hubConnectionService=h,this.trace=m,this.onMethods=new Map,this.onHubConnectionStateChangedEmitter=new C.Emitter,this.onHubConnectionAttemptedEmitter=new C.Emitter,this.onHubMethodNotifiedEmitter=new C.Emitter,this.onHubConnectionStateChanged=this.onHubConnectionStateChangedEmitter.event,this.onHubConnectionAttempted=this.onHubConnectionAttemptedEmitter.event,this.onHubMethodNotified=this.onHubMethodNotifiedEmitter.event,this.hubConnectionService.onAttemptConnection(h=>{this.onHubConnectionAttemptedEmitter.fire({retries:h.retries,errorDetails:h.error,error:h.error?T.vsls.HubConnectionError.ServiceUnavailable:T.vsls.HubConnectionError.None})}),this.hubConnectionService.onConnectionStateChanged(h=>{this.onHubConnectionStateChangedEmitter.fire({isConnected:this.hubConnectionService.isConnected})})}getIsConnectedAsync(h){return Promise.resolve(this.hubConnectionService.isConnected)}getIsAttemptingAsync(h){return Promise.resolve(this.hubConnectionService.isRunning)}getEnabledAsync(h){return Promise.resolve(this.hubConnectionService.enabled)}setEnabledAsync(h,m){return this.hubConnectionService.enabled=h,Promise.resolve()}registerHubMethodNotifyAsync(h,m,y,v){return this.onMethods.has(h)||this.onMethods.set(h,this.hubConnectionService.registerMethod(h,(...m)=>{this.onHubMethodNotifiedEmitter.fire({methodName:h,parameters:m})})),Promise.resolve()}unregisterHubMethodNotifyAsync(h,m){var y;return null===(y=this.onMethods.get(h))||void 0===y||y.dispose(),Promise.resolve()}invokeHubMethodAsync(h,m,y,C,T){return v(this,void 0,void 0,(function*(){this.trace.verbose(`invoke -> method:${y[0]} session:${null==T?void 0:T.session}`);try{return yield this.hubConnectionService.hubConnection.invoke(h,...y)}catch(h){throw this.trace.error(`Failed to invoke method:${y[0]}`),h}}))}sendHubMethodAsync(h,m,y,v){return this.trace.verbose(`send -> method:${m[0]} session:${null==v?void 0:v.session}`),this.hubConnectionService.hubConnection.send(h,...m)}}},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0});const v=y(2);m.dependencies={hubConnectionServiceFactory:v.lazyLoadMutable(()=>null)}},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0});const v=y(510),C=y(66);class HubStream extends v.BaseStream{constructor(h,m,y,v){super(),this.relayHubProxy=h,this.dataTypeSend=y,this.targetParticipant=v,this.nextSequence=0,this.disposables=[];const T=C.SequenceRelayDataHubProxy.createForTypeAndParticipant(h,m,v);this.disposables.push(T),this.disposables.push(T.onReceiveData(h=>(this.onData(Buffer.from(h.data)),Promise.resolve()))),this.disposables.push(h.onParticipantChanged(h=>(h.changeType===C.ParticipantChangeType.Removed&&h.participant.id===this.targetParticipant&&this.close(new Error(`participant id:${h.participant.id} removed`)),Promise.resolve())));const w=h.relayServiceProxy.hubProxy;this.disposables.push(w.onConnectionStateChanged(()=>(w.isConnected||this.close(new Error("hub proxy was disconnected")),Promise.resolve())))}async write(h,m){if(!h)throw new TypeError("Data is required.");if(this.disposed)throw new Error("HubStream diposed");await this.relayHubProxy.sendData(C.SendOption.ExcludeSelf,[this.targetParticipant],this.dataTypeSend,h,C.RelayHubMessageProperties.createMessageSequence(++this.nextSequence))}close(h,m){return this.disposables.forEach(h=>h.dispose()),this.disposables=[],this.onError(h||new Error("Stream closed.")),this.closedEmitter.fire({error:h}),Promise.resolve()}}m.HubStream=HubStream},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0}),m.WebECDiffieHellman=m.WebDiffieHellman=void 0;const v=y(9),C=y(434),T=y(276),w=y(279),A=y(56),P=y(280);class WebDiffieHellman extends T.KeyExchangeAlgorithm{constructor(h,m,y){super(h,m,y,w.WebHmac.getHashDigestLength(y))}createKeyExchange(){return new WebDiffieHellmanKex(this.keySizeInBits,w.WebHmac.getWebHashAlgorithmName(this.hashAlgorithmName),this.hashDigestLength)}}m.WebDiffieHellman=WebDiffieHellman;class WebDiffieHellmanKex{constructor(h,m,y){switch(this.hashAlgorithmName=m,this.digestLength=y,h){case 1024:this.dh=(0,C.getDiffieHellman)("modp2");break;case 2048:this.dh=(0,C.getDiffieHellman)("modp14");break;case 4096:this.dh=(0,C.getDiffieHellman)("modp16");break;default:throw new Error("Invalid DH bit length.")}}startKeyExchange(){const h=this.dh.generateKeys(),m=A.BigInt.fromBytes(h,{unsigned:!0}).toBytes();return Promise.resolve(m)}decryptKeyExchange(h){const m=this.dh.computeSecret(h),y=A.BigInt.fromBytes(m,{unsigned:!0}).toBytes();return Promise.resolve(y)}async sign(h){const m=await crypto.subtle.digest(this.hashAlgorithmName,h);return v.Buffer.from(m)}dispose(){}}class WebECDiffieHellman extends T.KeyExchangeAlgorithm{constructor(h,m,y){super(h,m,y,w.WebHmac.getHashDigestLength(y))}createKeyExchange(){return new WebECDiffieHellmanKex(this.keySizeInBits,w.WebHmac.getWebHashAlgorithmName(this.hashAlgorithmName),this.hashDigestLength)}}m.WebECDiffieHellman=WebECDiffieHellman;class WebECDiffieHellmanKex{constructor(h,m,y){this.bitLength=h,this.hashAlgorithmName=m,this.digestLength=y,this.algorithm={name:"ECDH",namedCurve:"P-"+h}}async startKeyExchange(){this.keyPair||(this.keyPair=await crypto.subtle.generateKey(this.algorithm,!0,["deriveBits"]));const h=await crypto.subtle.exportKey("jwk",this.keyPair.publicKey),m=P.JsonWebKeyFormatter.parseEC(h),y=Math.ceil(this.bitLength/8),C=v.Buffer.alloc(1+2*y);return C[0]=4,m.x.toBytes({unsigned:!0,length:y}).copy(C,1),m.y.toBytes({unsigned:!0,length:y}).copy(C,1+y),v.Buffer.from(C)}async decryptKeyExchange(h){if(!this.keyPair)throw new Error("Key exchange not started.");const m=h,y=P.JsonWebKeyFormatter.formatEC({curve:{name:this.algorithm.namedCurve},x:A.BigInt.fromBytes(m.slice(1,1+(m.length-1)/2),{unsigned:!0}),y:A.BigInt.fromBytes(m.slice(1+(m.length-1)/2),{unsigned:!0})}),C=await crypto.subtle.importKey("jwk",y,this.algorithm,!1,[]),T=v.Buffer.from(await crypto.subtle.deriveBits(Object.assign(Object.assign({},this.algorithm),{public:C}),this.keyPair.privateKey,8*Math.ceil(this.bitLength/8)));return A.BigInt.fromBytes(T,{unsigned:!0}).toBytes()}async sign(h){const m=await crypto.subtle.digest(this.hashAlgorithmName,h);return v.Buffer.from(m)}dispose(){}}},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0}),m.WebRsa=void 0;const v=y(9),C=y(138),T=y(279),w=y(40),A=y(280);class WebRsaKeyPair{constructor(h){this.hashAlgorithm=h,this.comment=null}get hasPublicKey(){return!!this.publicKey}get hasPrivateKey(){return!!this.privateKey}get keyAlgorithmName(){return WebRsa.keyAlgorithmName}async generate(h){h=null!=h?h:WebRsaKeyPair.defaultKeySize;try{const m={name:"RSASSA-PKCS1-v1_5",modulusLength:h,publicExponent:new Uint8Array([1,0,1]),hash:{name:this.hashAlgorithm}},y=await crypto.subtle.generateKey(m,!0,["sign","verify"]);this.publicKey=y.publicKey,this.privateKey=y.privateKey}catch(h){throw new Error("Failed to generate RSA key pair: "+h)}}async setPublicKeyBytes(h){if(!h)throw new TypeError("Buffer is required.");const m=new w.SshDataReader(h),y=m.readString("ascii");if(y!==this.keyAlgorithmName&&y!==WebRsa.rsaWithSha256&&y!==WebRsa.rsaWithSha512)throw new Error(`Invalid RSA key algorithm: ${y}`);const v=m.readBigInt(),C=m.readBigInt(),T=A.JsonWebKeyFormatter.formatRsa({modulus:C,exponent:v},!1);T.alg="RS"+this.hashAlgorithm.replace("SHA-",""),T.key_ops=["verify"];try{const h={name:"RSASSA-PKCS1-v1_5",hash:{name:this.hashAlgorithm}};this.publicKey=await crypto.subtle.importKey("jwk",T,h,!0,["verify"])}catch(h){throw new Error("Failed to import RSA public key: "+h)}}async getPublicKeyBytes(h){if(!this.publicKey)return null;let m;h||(h=this.keyAlgorithmName);try{m=await crypto.subtle.exportKey("jwk",this.publicKey)}catch(h){throw new Error("Failed to export RSA public key: "+h)}const{modulus:y,exponent:C}=A.JsonWebKeyFormatter.parseRsa(m,!1),T=v.Buffer.alloc(512),P=new w.SshDataWriter(T);return P.writeString(h,"ascii"),P.writeBigInt(C),P.writeBigInt(y),P.toBuffer()}async importParameters(h){const m=h.d?A.JsonWebKeyFormatter.formatRsa(h,!0):null,y=A.JsonWebKeyFormatter.formatRsa(h,!1),v={name:"RSASSA-PKCS1-v1_5",hash:{name:this.hashAlgorithm}};try{this.publicKey=await crypto.subtle.importKey("jwk",y,v,!0,["verify"]),this.privateKey=m?await crypto.subtle.importKey("jwk",m,v,!0,["sign"]):void 0}catch(h){if(!(h instanceof Error))throw h;throw new Error("Failed to import RSA key pair: "+h.message)}}async exportParameters(){var h;if(!this.publicKey)throw new Error("Public key not set.");let m;try{m=await crypto.subtle.exportKey("jwk",null!==(h=this.privateKey)&&void 0!==h?h:this.publicKey)}catch(h){if(!(h instanceof Error))throw h;throw new Error("Failed to export RSA public key: "+h.message)}return A.JsonWebKeyFormatter.parseRsa(m,!!this.privateKey)}dispose(){}}WebRsaKeyPair.defaultKeySize=2048;class WebRsa extends C.PublicKeyAlgorithm{constructor(h,m){super(h,WebRsa.keyAlgorithmName,m)}createKeyPair(){const h=WebRsa.convertHashAlgorithmName(this.hashAlgorithmName);return new WebRsaKeyPair(h)}async generateKeyPair(h){const m=WebRsa.convertHashAlgorithmName(this.hashAlgorithmName),y=new WebRsaKeyPair(m);return await y.generate(h),y}createSigner(h){if(!(h instanceof WebRsaKeyPair))throw new TypeError("RSA key pair object expected.");const m=WebRsa.convertHashAlgorithmName(this.hashAlgorithmName);return new WebRsaSignerVerifier(h,m,T.WebHmac.getHashDigestLength(this.hashAlgorithmName))}createVerifier(h){if(!(h instanceof WebRsaKeyPair))throw new TypeError("RSA key pair object expected.");const m=WebRsa.convertHashAlgorithmName(this.hashAlgorithmName);return new WebRsaSignerVerifier(h,m,T.WebHmac.getHashDigestLength(this.hashAlgorithmName))}static convertHashAlgorithmName(h){return h.replace("SHA2-","SHA-")}}m.WebRsa=WebRsa,WebRsa.keyAlgorithmName="ssh-rsa",WebRsa.rsaWithSha256="rsa-sha2-256",WebRsa.rsaWithSha512="rsa-sha2-512",WebRsa.KeyPair=WebRsaKeyPair;class WebRsaSignerVerifier{constructor(h,m,y){this.keyPair=h,this.hashAlgorithm=m,this.digestLength=y}async sign(h){if(!this.keyPair.privateKey)throw new Error("Private key not set.");return await this.convertKeyHashAlgorithm(),v.Buffer.from(await crypto.subtle.sign("RSASSA-PKCS1-v1_5",this.keyPair.privateKey,h))}async verify(h,m){if(!this.keyPair.publicKey)throw new Error("Public key not set.");return await this.convertKeyHashAlgorithm(),await crypto.subtle.verify("RSASSA-PKCS1-v1_5",this.keyPair.publicKey,m,h)}async convertKeyHashAlgorithm(){if(this.keyPair.hashAlgorithm!==this.hashAlgorithm){const h=await this.keyPair.exportParameters();this.keyPair=new WebRsaKeyPair(this.hashAlgorithm),await this.keyPair.importParameters(h)}}dispose(){}}},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0}),m.WebECDsa=void 0;const v=y(9),C=y(138),T=y(40),w=y(188),A=y(56),P=y(280);class WebECDsaKeyPair{constructor(h){this.comment=null,h&&(this.algorithmName=h)}get hasPublicKey(){return!!this.publicKey}get hasPrivateKey(){return!!this.privateKey}get keyAlgorithmName(){return this.algorithmName}get algorithmName(){return this.algorithm}set algorithmName(h){const m=h.split("-")[2];if(this.curve=w.curves.find(h=>h.name===m),!this.curve)throw new Error("Invalid or unsupported ECDSA algorithm: "+h);this.algorithm=h}async generate(){try{const h={name:"ECDSA",namedCurve:this.curve.shortName},m=await crypto.subtle.generateKey(h,!0,["sign","verify"]);this.publicKey=m.publicKey,this.privateKey=m.privateKey}catch(h){throw new Error("Failed to generate RSA key pair: "+h)}}async setPublicKeyBytes(h,m){if(!h)throw new TypeError("Buffer is required.");const y=new T.SshDataReader(h),v=y.readString("ascii");if(this.algorithmName=m||v,y.readString("ascii")!==this.curve.name)throw new Error("EC curve name does not match.");const C=y.readBinary(),w=Math.ceil(this.curve.keySize/8),k=A.BigInt.fromBytes(C.slice(1,1+w),{unsigned:!0}),R=A.BigInt.fromBytes(C.slice(1+w,C.length),{unsigned:!0}),M=P.JsonWebKeyFormatter.formatEC({curve:{name:this.curve.shortName,oid:this.curve.oid},x:k,y:R});try{const h={name:"ECDSA",namedCurve:this.curve.shortName};this.publicKey=await crypto.subtle.importKey("jwk",M,h,!0,["verify"])}catch(h){throw new Error("Failed to import EC public key: "+h)}}async getPublicKeyBytes(h){if(!this.publicKey)return null;let m;try{m=await crypto.subtle.exportKey("jwk",this.publicKey)}catch(h){throw new Error("Failed to export ECDSA public key: "+h)}const y=v.Buffer.from(m.x,"base64"),C=v.Buffer.from(m.y,"base64"),w=Math.ceil(this.curve.keySize/8);if(y.length!==w||C.length!==w)throw new Error("Unexpected key length.");h=h||this.algorithmName||this.keyAlgorithmName;const A=v.Buffer.alloc(h.length+y.length+C.length+10),P=new T.SshDataWriter(A);return P.writeString(h,"ascii"),P.writeString(this.curve.name,"ascii"),P.writeUInt32(1+y.length+C.length),P.writeByte(4),P.write(y),P.write(C),P.toBuffer()}async importParameters(h){if(!h.curve)throw new TypeError("A curve is required.");let m;if(h.curve.oid){if(m=w.curves.find(m=>m.oid===h.curve.oid),!m)throw new Error(`Unsupported curve OID: ${h.curve.oid}`)}else{if(!h.curve.name)throw new TypeError("A curve OID or name is required.");if(m=w.curves.find(m=>m.name===h.curve.name),!m)throw new Error(`Unsupported curve: ${h.curve.name}`)}this.algorithmName="ecdsa-sha2-"+m.name;const y={name:"ECDSA",namedCurve:this.curve.shortName},v=P.JsonWebKeyFormatter.formatEC(h);v.crv=this.curve.shortName;try{v.d?(this.privateKey=await crypto.subtle.importKey("jwk",v,y,!0,["sign"]),v.d=void 0):this.privateKey=void 0,this.publicKey=await crypto.subtle.importKey("jwk",v,y,!0,["verify"])}catch(h){throw new Error("Failed to import ECDSA key pair: "+h)}}async exportParameters(){var h;const m=null!==(h=this.privateKey)&&void 0!==h?h:this.publicKey;if(!m)throw new Error("Key not present.");let y;try{y=await crypto.subtle.exportKey("jwk",m)}catch(h){throw new Error("Failed to export ECDSA key pair: "+h)}const v=P.JsonWebKeyFormatter.parseEC(y);return v.curve={name:this.curve.name,oid:this.curve.oid},v}dispose(){}}class WebECDsa extends C.PublicKeyAlgorithm{constructor(h,m){super(h,h,m)}createKeyPair(){return new WebECDsaKeyPair(this.name)}async generateKeyPair(){const h=new WebECDsaKeyPair(this.name);return await h.generate(),h}createSigner(h){if(!(h instanceof WebECDsaKeyPair))throw new TypeError("ECDSA key pair object expected.");const m=WebECDsa.convertHashAlgorithmName(this.hashAlgorithmName);return new WebECDsaSignerVerifier(h,m)}createVerifier(h){if(!(h instanceof WebECDsaKeyPair))throw new TypeError("ECDSA key pair object expected.");const m=WebECDsa.convertHashAlgorithmName(this.hashAlgorithmName);return new WebECDsaSignerVerifier(h,m)}static convertHashAlgorithmName(h){return h.replace("SHA2-","SHA-")}static getSignatureLength(h){return 2*(5+Math.ceil(h/8))}}m.WebECDsa=WebECDsa,WebECDsa.ecdsaSha2Nistp256="ecdsa-sha2-nistp256",WebECDsa.ecdsaSha2Nistp384="ecdsa-sha2-nistp384",WebECDsa.ecdsaSha2Nistp521="ecdsa-sha2-nistp521",WebECDsa.curves=w.curves,WebECDsa.KeyPair=WebECDsaKeyPair;class WebECDsaSignerVerifier{constructor(h,m){this.keyPair=h,this.hashAlgorithm=m}get digestLength(){const h=this.keyPair.curve;return h?WebECDsa.getSignatureLength(h.keySize):0}async sign(h){if(!this.keyPair.privateKey)throw new Error("Private key not set.");let m=v.Buffer.from(await crypto.subtle.sign({name:"ECDSA",hash:{name:this.hashAlgorithm}},this.keyPair.privateKey,h));const y=Math.ceil(this.keyPair.curve.keySize/8);if(m.length!==2*y)throw new Error(`Unexpected signature length: ${m.length}`);const C=A.BigInt.fromBytes(m.slice(0,y),{unsigned:!0}),w=A.BigInt.fromBytes(m.slice(y,m.length),{unsigned:!0}),P=new T.SshDataWriter(v.Buffer.alloc(this.digestLength));return P.writeBinary(C.toBytes({unsigned:!0,length:y+1})),P.writeBinary(w.toBytes({unsigned:!0,length:y+1})),m=P.toBuffer(),m}async verify(h,m){if(!this.keyPair.publicKey)throw new Error("Public key not set.");const y=new T.SshDataReader(m),C=y.readBigInt(),w=y.readBigInt(),A=Math.ceil(this.keyPair.curve.keySize/8);return m=v.Buffer.alloc(2*A),C.toBytes({unsigned:!0,length:A}).copy(m,0),w.toBytes({unsigned:!0,length:A}).copy(m,A),await crypto.subtle.verify({name:"ECDSA",hash:{name:this.hashAlgorithm}},this.keyPair.publicKey,m,h)}dispose(){}}},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0}),m.WebEncryption=void 0;const v=y(50),C=y(9),T=y(277);class WebEncryption extends T.EncryptionAlgorithm{constructor(h,m,y,v){super(h),this.algorithmName=m,this.cipherMode=y,this.keySizeInBits=v,this.blockSizeInBits=WebEncryption.getBlockSize(m)}get keyLength(){return this.keySizeInBits/8}get blockLength(){return this.blockSizeInBits/8}async createCipher(h,m,y){const v=new WebCipher(h,this.algorithmName,this.cipherMode,this.keySizeInBits,this.blockSizeInBits);return await v.init(m,y),v}static getBlockSize(h){if("AES"===h)return 128;throw new Error(`Unsupported encryption algorithm: ${h}`)}}m.WebEncryption=WebEncryption;class WebCipher{constructor(h,m,y,v,T){if(this.isEncryption=h,this.algorithmName=m,this.cipherMode=y,this.keySizeInBits=v,this.blockSizeInBits=T,this.tag=null,"AES"===this.algorithmName&&"CTR"===this.cipherMode)this.transform=this.aesCtr.bind(this,h);else if("AES"===this.algorithmName&&"CBC"===this.cipherMode)this.transform=this.aesCbc.bind(this,h);else{if("AES"!==this.algorithmName||"GCM"!==this.cipherMode)throw new Error(`Unsupported encryption algorithm: ${this.algorithmName}-${this.cipherMode}`);this.transform=this.aesGcm.bind(this,h),this.associatedData=C.Buffer.alloc(4),this.decryptBuffer=C.Buffer.alloc(4*this.blockLength)}}get blockLength(){return this.blockSizeInBits/8}async init(h,m){try{const m=`${this.algorithmName}-${this.cipherMode}`;this.key=await crypto.subtle.importKey("raw",h,{name:m,length:this.keySizeInBits},!1,this.isEncryption?["encrypt"]:["decrypt"])}catch(h){throw new Error("Failed to initialize AES: "+h)}"GCM"===this.cipherMode?this.iv=C.Buffer.from(m.slice(0,12)):this.iv=C.Buffer.from(m)}async aesCtr(h,m){if(m.length%this.blockLength!=0){const h="Encrypt/decrypt input has invalid length "+`${m.length}, not a multiple of block size ${this.blockLength}.`;throw(0,v.trace)("Error: "+h),new Error(h)}let y;if(y=h?C.Buffer.from(await crypto.subtle.encrypt({name:"AES-CTR",counter:this.iv,length:this.blockSizeInBits},this.key,m)):C.Buffer.from(await crypto.subtle.decrypt({name:"AES-CTR",counter:this.iv,length:this.blockSizeInBits},this.key,m)),y.length!==m.length){const h="Result from encrypt/decrypt has invalid length "+`${y.length}, expected ${m.length}.`;throw(0,v.trace)("Error: "+h),new Error(h)}const T=m.length/this.blockLength;for(let h=0;h<T;h++)for(let h=this.iv.length-1;h>=0&&(this.iv[h]=this.iv[h]+1,!this.iv[h]);h--);return y}async aesCbc(h,m){if(h){let h=C.Buffer.from(await crypto.subtle.encrypt({name:"AES-CBC",iv:this.iv},this.key,m));return h=h.slice(0,m.length),h}return C.Buffer.from(await crypto.subtle.decrypt({name:"AES-CBC",iv:this.iv},this.key,m))}async aesGcm(h,m){if(m.length%this.blockLength!=0){const h="Encrypt/decrypt input has invalid length "+`${m.length}, not a multiple of block size ${this.blockLength}.`;throw(0,v.trace)("Error: "+h),new Error(h)}const y=m.length;let T;if(this.associatedData[0]=y>>>24,this.associatedData[1]=y>>>16,this.associatedData[2]=y>>>8,this.associatedData[3]=y,h)T=C.Buffer.from(await crypto.subtle.encrypt({name:"AES-GCM",iv:this.iv,additionalData:this.associatedData,tagLength:8*this.digestLength},this.key,m)),this.tag=T.slice(T.length-this.digestLength),T=T.slice(0,T.length-this.digestLength);else{if(!this.tag)throw new Error("AES-GCM tag was not set before decrypting.");const h=m.length+this.digestLength;if(this.decryptBuffer.length<h){let m=2*this.decryptBuffer.length;for(;m<h;)m*=2;this.decryptBuffer=C.Buffer.alloc(m)}const y=this.decryptBuffer.slice(0,h);m.copy(y,0),this.tag.copy(y,m.length),T=C.Buffer.from(await crypto.subtle.decrypt({name:"AES-GCM",iv:this.iv,additionalData:this.associatedData,tagLength:8*this.digestLength},this.key,y))}if(T.length!==m.length){const h="Result from encrypt/decrypt has invalid length "+`${T.length}, expected ${m.length}.`;throw(0,v.trace)("Error: "+h),new Error(h)}let w=12;for(;--w>=4&&(this.iv[w]++,0===this.iv[w]););return T}get digestLength(){return 16}get authenticatedEncryption(){return"GCM"===this.cipherMode}async sign(h){if(!this.tag)throw new Error("AES-GCM tag was not obtained by encrypting.");return this.tag}async verify(h,m){if(m.length!==this.digestLength)throw new Error("Incorrect AES-GCM tag length.");return this.tag=m,!0}dispose(){}}},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0}),m.WebRandom=void 0;m.WebRandom=class WebRandom{getBytes(h){crypto.getRandomValues(h)}}},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0}),m.NodeRsa=void 0;const v=y(11),C=y(9),T=y(138),w=y(40),A=y(281),P=y(513),k=process.versions.node.split(".").map(h=>parseInt(h,10)),R=k[0]>10||10===k[0]&&k[1]>=12,M=k[0]>11||11===k[0]&&k[1]>=6;class NodeRsaKeyPair{constructor(){this.comment=null}get hasPublicKey(){return!!this.publicKey}get hasPrivateKey(){return!!this.privateKey}get keyAlgorithmName(){return NodeRsa.keyAlgorithmName}generate(h){return h=null!=h?h:NodeRsaKeyPair.defaultKeySize,R&&M?this.generateNodeKeyPairObjects(h):R?this.generateNodeKeyPairBuffers(h):this.generateExternalKeyPair(h)}async generateNodeKeyPairObjects(h){[this.publicKey,this.privateKey]=await new Promise((m,y)=>{const C={modulusLength:h};try{v.generateKeyPair("rsa",C,(h,v,C)=>{h?y(h):m([v,C])})}catch(h){y(h)}})}async generateNodeKeyPairBuffers(h){[this.publicKey,this.privateKey]=await new Promise((m,y)=>{const C={modulusLength:h,publicKeyEncoding:{type:"pkcs1",format:"pem"},privateKeyEncoding:{type:"pkcs1",format:"pem",cipher:void 0,passphrase:void 0}};try{v.generateKeyPair("rsa",C,(h,v,C)=>{h?y(h):m([v,C])})}catch(h){y(h)}})}async generateExternalKeyPair(h){const m=new(await Promise.resolve().then(()=>y(438)))({b:h});this.publicKey=m.exportKey("pkcs1-public-pem"),this.privateKey=m.exportKey("pkcs1-private-pem"),this.publicKey.endsWith("\n")||(this.publicKey+="\n"),this.privateKey.endsWith("\n")||(this.privateKey+="\n")}async setPublicKeyBytes(h){if(!h)throw new TypeError("Buffer is required.");const m=new w.SshDataReader(h),y=m.readString("ascii");if(y!==this.keyAlgorithmName&&y!==NodeRsa.rsaWithSha256&&y!==NodeRsa.rsaWithSha512)throw new Error(`Invalid RSA key algorithm: ${y}`);const C=m.readBigInt(),T=m.readBigInt();h=P.Pkcs1KeyFormatter.formatRsaPublic({modulus:T,exponent:C}),this.publicKey=M?v.createPublicKey({key:h,type:"pkcs1",format:"der"}):(0,P.formatPem)(h,"RSA PUBLIC KEY")}async getPublicKeyBytes(h){if(!this.publicKey)return null;let m;h||(h=this.keyAlgorithmName),m="string"==typeof this.publicKey?(0,P.parsePem)(this.publicKey):this.publicKey.export({type:"pkcs1",format:"der"});const y=P.Pkcs1KeyFormatter.parseRsaPublic(m),v=C.Buffer.alloc(512),T=new w.SshDataWriter(v);return T.writeString(h,"ascii"),T.writeBigInt(y.exponent),T.writeBigInt(y.modulus),m=T.toBuffer(),m}async importParameters(h){if(M)this.publicKey=v.createPublicKey({key:P.Pkcs1KeyFormatter.formatRsaPublic(h),format:"der",type:"pkcs1"}),h.d?this.privateKey=v.createPrivateKey({key:P.Pkcs1KeyFormatter.formatRsaPrivate(h),format:"der",type:"pkcs1"}):this.privateKey=void 0;else{const m=P.Pkcs1KeyFormatter.formatRsaPublic(h);if(this.publicKey=(0,P.formatPem)(m,"RSA PUBLIC KEY"),h.d){const m=P.Pkcs1KeyFormatter.formatRsaPrivate(h);this.privateKey=(0,P.formatPem)(m,"RSA PRIVATE KEY")}}}async exportParameters(){var h,m;if(!this.publicKey)throw new Error("Public key not set.");let y;return y=M?(null!==(h=this.privateKey)&&void 0!==h?h:this.publicKey).export({format:"der",type:"pkcs1"}):(0,P.parsePem)(null!==(m=this.privateKey)&&void 0!==m?m:this.publicKey),this.privateKey?P.Pkcs1KeyFormatter.parseRsaPrivate(y):P.Pkcs1KeyFormatter.parseRsaPublic(y)}dispose(){this.publicKey=void 0,this.privateKey=void 0}}NodeRsaKeyPair.defaultKeySize=2048;class NodeRsa extends T.PublicKeyAlgorithm{constructor(h,m){super(h,NodeRsa.keyAlgorithmName,m)}createKeyPair(){return new NodeRsaKeyPair}async generateKeyPair(h){const m=new NodeRsaKeyPair;return await m.generate(h),m}createSigner(h){if(!(h instanceof NodeRsaKeyPair))throw new TypeError("RSA key pair object expected.");return new NodeRsaSignerVerifier(h,NodeRsa.convertHashAlgorithmName(this.hashAlgorithmName),A.NodeHmac.getHashDigestLength(this.hashAlgorithmName))}createVerifier(h){if(!(h instanceof NodeRsaKeyPair))throw new TypeError("RSA key pair object expected.");return new NodeRsaSignerVerifier(h,NodeRsa.convertHashAlgorithmName(this.hashAlgorithmName),A.NodeHmac.getHashDigestLength(this.hashAlgorithmName))}static convertHashAlgorithmName(h){return h.replace("SHA2-","SHA")}}m.NodeRsa=NodeRsa,NodeRsa.keyAlgorithmName="ssh-rsa",NodeRsa.rsaWithSha256="rsa-sha2-256",NodeRsa.rsaWithSha512="rsa-sha2-512",NodeRsa.KeyPair=NodeRsaKeyPair;class NodeRsaSignerVerifier{constructor(h,m,y){this.keyPair=h,this.hashAlgorithmName=m,this.digestLength=y}async sign(h){if(!this.keyPair.privateKey)throw new Error("Private key not set.");const m=v.createSign(this.hashAlgorithmName);return m.update(h),m.sign(this.keyPair.privateKey)}async verify(h,m){if(!this.keyPair.publicKey)throw new Error("Public key not set.");const y=v.createVerify(this.hashAlgorithmName);return y.update(h),y.verify(this.keyPair.publicKey,m)}dispose(){}}},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0}),m.NodeECDsa=void 0;const v=y(11),C=y(9),T=y(138),w=y(188),A=y(56),P=y(282),k=y(40),R=y(513),M=process.versions.node.split(".").map(h=>parseInt(h,10)),N=M[0]>10||10===M[0]&&M[1]>=12,D=M[0]>11||11===M[0]&&M[1]>=6;class NodeECDsaKeyPair{constructor(h){this.comment=null,h&&(this.algorithmName=h)}get hasPublicKey(){return!!this.publicKey}get hasPrivateKey(){return!!this.privateKey}get keyAlgorithmName(){return this.algorithmName}get algorithmName(){return this.algorithm}set algorithmName(h){const m=h.split("-")[2];if(this.curve=w.curves.find(h=>h.name===m),!this.curve)throw new Error("Invalid or unsupported ECDSA algorithm: "+h);this.algorithm=h}generate(){return N&&D?this.generateNodeKeyPairObjects():N?this.generateNodeKeyPairBuffers():this.generateExternalKeyPair()}async generateNodeKeyPairObjects(){[this.publicKey,this.privateKey]=await new Promise((h,m)=>{const y={namedCurve:this.curve.shortName};try{v.generateKeyPair("ec",y,(y,v,C)=>{y?m(y):h([v,C])})}catch(h){m(h)}})}async generateNodeKeyPairBuffers(){[this.publicKey,this.privateKey]=await new Promise((h,m)=>{const y={namedCurve:this.curve.shortName,publicKeyEncoding:{type:"spki",format:"pem"},privateKeyEncoding:{type:"sec1",format:"pem",cipher:void 0,passphrase:void 0}};try{v.generateKeyPair("ec",y,(y,v,C)=>{y?m(y):h([v,C])})}catch(h){m(h)}})}async generateExternalKeyPair(){throw new Error("This version of node does not support generating key pairs. Use node >= 10.12.")}async setPublicKeyBytes(h,m){if(!h)throw new TypeError("Buffer is required.");const y=new k.SshDataReader(h),C=y.readString("ascii");this.algorithmName=m||C;const T=y.readString("ascii");this.algorithmName=`ecdsa-sha2-${T}`;const w=y.readBinary(),P=A.BigInt.fromBytes(w.slice(1,1+(w.length-1)/2),{unsigned:!0}),M=A.BigInt.fromBytes(w.slice(1+(w.length-1)/2),{unsigned:!0}),N=R.Sec1KeyFormatter.formatECPublic({curve:{name:this.curve.name,oid:this.curve.oid},x:P,y:M});this.publicKey=D?v.createPublicKey({key:N,type:"spki",format:"der"}):(0,R.formatPem)(N,"PUBLIC KEY")}async getPublicKeyBytes(h){if(!this.publicKey)return null;let m;m="string"==typeof this.publicKey?(0,R.parsePem)(this.publicKey):this.publicKey.export({type:"spki",format:"der"});const y=R.Sec1KeyFormatter.parseECPublic(m);h=h||this.algorithmName||this.keyAlgorithmName;const v=new k.SshDataWriter(C.Buffer.alloc(512));v.writeString(h,"ascii"),v.writeString(this.curve.name,"ascii");const T=Math.ceil(this.curve.keySize/8),w=y.x.toBytes({unsigned:!0,length:T}),A=y.y.toBytes({unsigned:!0,length:T});return v.writeUInt32(1+w.length+A.length),v.writeByte(4),v.write(w),v.write(A),v.toBuffer()}async importParameters(h){if(!h.curve)throw new TypeError("A curve is required.");let m;if(h.curve.oid){if(m=w.curves.find(m=>m.oid===h.curve.oid),!m)throw new Error(`Unsupported curve OID: ${h.curve.oid}`)}else{if(!h.curve.name)throw new TypeError("A curve OID or name is required.");if(m=w.curves.find(m=>m.name===h.curve.name),!m)throw new Error(`Unsupported curve: ${h.curve.name}`)}this.algorithmName="ecdsa-sha2-"+m.name;const y=R.Sec1KeyFormatter.formatECPublic(h);if(this.publicKey=D?v.createPublicKey({key:y,type:"spki",format:"der"}):(0,R.formatPem)(y,"EC PUBLIC KEY"),h.d){const m=R.Sec1KeyFormatter.formatECPrivate(h);this.privateKey=D?v.createPrivateKey({key:m,type:"sec1",format:"der"}):(0,R.formatPem)(m,"EC PRIVATE KEY")}else this.privateKey=void 0}async exportParameters(){var h,m;if(!this.publicKey)throw new Error("Key is not present.");let y;return y="string"==typeof this.publicKey?(0,R.parsePem)(null!==(h=this.privateKey)&&void 0!==h?h:this.publicKey):(null!==(m=this.privateKey)&&void 0!==m?m:this.publicKey).export({type:this.privateKey?"sec1":"spki",format:"der"}),this.privateKey?R.Sec1KeyFormatter.parseECPrivate(y):R.Sec1KeyFormatter.parseECPublic(y)}dispose(){}}class NodeECDsa extends T.PublicKeyAlgorithm{constructor(h,m){super(h,h,m)}createKeyPair(){return new NodeECDsaKeyPair(this.name)}async generateKeyPair(){const h=new NodeECDsaKeyPair(this.name);return await h.generate(),h}createSigner(h){if(!(h instanceof NodeECDsaKeyPair))throw new TypeError("ECDSA key pair object expected.");return new NodeECDsaSignerVerifier(h,NodeECDsa.convertHashAlgorithmName(this.hashAlgorithmName))}createVerifier(h){if(!(h instanceof NodeECDsaKeyPair))throw new TypeError("ECDSA key pair object expected.");return new NodeECDsaSignerVerifier(h,NodeECDsa.convertHashAlgorithmName(this.hashAlgorithmName))}static convertHashAlgorithmName(h){return h.replace("SHA2-","SHA")}static getSignatureLength(h){return 2*(5+Math.ceil(h/8))}}m.NodeECDsa=NodeECDsa,NodeECDsa.ecdsaSha2Nistp256="ecdsa-sha2-nistp256",NodeECDsa.ecdsaSha2Nistp384="ecdsa-sha2-nistp384",NodeECDsa.ecdsaSha2Nistp521="ecdsa-sha2-nistp521",NodeECDsa.curves=w.curves,NodeECDsa.KeyPair=NodeECDsaKeyPair;class NodeECDsaSignerVerifier{constructor(h,m){this.keyPair=h,this.hashAlgorithmName=m}get digestLength(){const h=this.keyPair.curve;return h?NodeECDsa.getSignatureLength(h.keySize):0}async sign(h){if(!this.keyPair.privateKey)throw new Error("Private key not set.");const m=v.createSign(this.hashAlgorithmName);m.update(h);let y=m.sign(this.keyPair.privateKey);const T=new P.DerReader(y),w=T.readInteger(),A=T.readInteger(),R=Math.ceil(this.keyPair.curve.keySize/8),M=new k.SshDataWriter(C.Buffer.alloc(this.digestLength));return M.writeBinary(w.toBytes({unsigned:!0,length:R+1})),M.writeBinary(A.toBytes({unsigned:!0,length:R+1})),y=M.toBuffer(),y}async verify(h,m){if(!this.keyPair.publicKey)throw new Error("Public key not set.");const y=new k.SshDataReader(m),T=y.readBigInt(),w=y.readBigInt(),A=new P.DerWriter(C.Buffer.alloc(m.length));A.writeInteger(T),A.writeInteger(w),m=A.toBuffer();const R=v.createVerify(this.hashAlgorithmName);return R.update(h),R.verify(this.keyPair.publicKey,m)}dispose(){}}},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0}),m.NodeEncryption=void 0;const v=y(11),C=y(9),T=y(277),w=y(50);class NodeEncryption extends T.EncryptionAlgorithm{constructor(h,m,y,v){if(super(h),this.algorithmName=m,this.cipherMode=y,this.keySizeInBits=v,"AES"!==m)throw new Error(`Unsupported encryption algorithm: ${m}`);this.blockSizeInBits=NodeEncryption.getBlockSize(m)}get keyLength(){return this.keySizeInBits/8}get blockLength(){return this.blockSizeInBits/8}async createCipher(h,m,y){let v;if("CTR"===this.cipherMode||"CBC"===this.cipherMode)v=new NodeAesCipher(h,this.keySizeInBits,this.blockSizeInBits,m,y,this.cipherMode);else{if("GCM"!==this.cipherMode)throw new Error(`Unsupported cipher mode: ${this.cipherMode}`);v=new NodeAesGcmCipher(h,this.keySizeInBits,this.blockSizeInBits,m,y)}return v}static getBlockSize(h){if("AES"===h)return 128;throw new Error(`Unsupported encryption algorithm: ${h}`)}}m.NodeEncryption=NodeEncryption;class NodeAesCipher{constructor(h,m,y,C,T,w){this.isEncryption=h,this.keySizeInBits=m,this.blockSizeInBits=y;const A=`AES-${this.keySizeInBits}-${w}`;this.cipher=this.isEncryption?v.createCipheriv(A,C,T):v.createDecipheriv(A,C,T),this.cipher.setAutoPadding(!1)}get blockLength(){return this.blockSizeInBits/8}transform(h){const m=this.cipher.update(h);if(m.length!==h.length){const y="Result from encrypt/decrypt has invalid length "+`${m.length}, expected ${h.length}.`;throw(0,w.trace)("Error: "+y),new Error(y)}return Promise.resolve(m)}dispose(){}}class NodeAesGcmCipher{constructor(h,m,y,v,T){this.isEncryption=h,this.keySizeInBits=m,this.blockSizeInBits=y,this.tag=null,this.algorithmName=`aes-${this.keySizeInBits}-gcm`,this.key=C.Buffer.alloc(v.length),v.copy(this.key),this.nonce=C.Buffer.alloc(12),T.copy(this.nonce,0,0,12),this.associatedData=C.Buffer.alloc(4)}get blockLength(){return this.blockSizeInBits/8}get digestLength(){return 16}get authenticatedEncryption(){return!0}transform(h){if(h.length%this.blockLength!=0){const m="Encrypt/decrypt input has invalid length "+`${h.length}, not a multiple of block size ${this.blockLength}.`;throw(0,w.trace)("Error: "+m),new Error(m)}const m=this.isEncryption?v.createCipheriv(this.algorithmName,this.key,this.nonce):v.createDecipheriv(this.algorithmName,this.key,this.nonce),y=h.length;if(this.associatedData[0]=y>>>24,this.associatedData[1]=y>>>16,this.associatedData[2]=y>>>8,this.associatedData[3]=y,m.setAAD(this.associatedData),!this.isEncryption){if(!this.tag)throw new Error("AES-GCM tag was not set before decrypting.");m.setAuthTag(this.tag)}const C=m.update(h);if(C.length!==h.length){const m="Result from encrypt/decrypt has invalid length "+`${C.length}, expected ${h.length}.`;throw(0,w.trace)("Error: "+m),new Error(m)}m.final(),this.isEncryption?this.tag=m.getAuthTag():this.tag=null;let T=12;for(;--T>=4&&(this.nonce[T]++,0===this.nonce[T]););return Promise.resolve(C)}async sign(h){if(!this.tag)throw new Error("AES-GCM tag was not obtained by encrypting.");return this.tag}async verify(h,m){if(m.length!==this.digestLength)throw new Error("Incorrect AES-GCM tag length.");return this.tag=m,!0}dispose(){}}},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0}),m.NodeRandom=void 0;const v=y(11);m.NodeRandom=class NodeRandom{getBytes(h){v.randomBytes(h.length).copy(h)}}},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0}),m.SshProtocol=void 0;const v=y(50),C=y(9),T=y(189),w=y(140),A=y(109),P=y(40),k=y(57),R=y(285),M=y(81),N=y(51);class SequencedMessage{constructor(h,m){this.sequence=h,this.message=m}}class SshProtocol{constructor(h,m,y){this.config=m,this.metrics=y,this.sessionSemaphore=new w.Semaphore(1),this.inboundPacketSequence=0,this.outboundPacketSequence=0,this.inboundFlow=0,this.outboundFlow=0,this.recentSentMessages=new T.Queue,this.sendWriter=new P.SshDataWriter(C.Buffer.alloc(1024)),this.receiveWriter=new P.SshDataWriter(C.Buffer.alloc(1024)),this.extensions=null,this.kexService=null,this.algorithms=null,this.outgoingMessagesHaveLatencyInfo=!1,this.incomingMessagesHaveLatencyInfo=!1,this.outgoingMessagesHaveReconnectInfo=!1,this.incomingMessagesHaveReconnectInfo=!1,this.stream=h}get lastIncomingSequence(){return this.inboundPacketSequence-1}getSentMessages(h){if(h===this.outboundPacketSequence+1)return[];if(this.recentSentMessages.size>0&&h<this.recentSentMessages.peek().sequence)return null;const m=new Array;for(let y of this.recentSentMessages)if(y.sequence>=h){const h=y.message;h instanceof R.KeyExchangeMessage||h instanceof k.DisconnectMessage||m.push(h)}return m}async writeProtocolVersion(h,m){const y=this.stream;if(!y)throw new Error("SSH session disconnected.");const v=C.Buffer.from(h+"\r\n");return await y.write(v,m),this.metrics.addMessageSent(v.length),Promise.resolve()}async readProtocolVersion(h){const m=this.stream;if(!m)throw new Error("SSH session disconnected.");const y=C.Buffer.alloc(255);let v=0;for(let C=0;C<y.length;C++){const T=await m.read(1,h);if(!T)break;y[C]=T[0];const w=13,A=10;if(C>0&&y[C-1]===w&&y[C]===A){const h=y.toString("utf8",0,C-1);if(h.startsWith("SSH-"))return this.metrics.addMessageReceived(C+1),h;if(v>20)break;v++,C=-1}}throw new N.SshConnectionError("Failed to read the protocol version",k.SshDisconnectReason.protocolError)}async handleNewKeys(h){try{await this.sessionSemaphore.wait(h),this.inboundFlow=0,this.outboundFlow=0,this.algorithms=this.kexService.finishKeyExchange()}finally{this.sessionSemaphore.release()}}async read(h,m){const y=this.stream;if(!y)return!1;let C=0;do{let T;try{T=await y.read(h.length-C,m)}catch(h){if(!(h instanceof Error))throw h;if(y.isDisposed)return!1;throw y.dispose(),this.stream=null,(0,v.trace)("Error reading from stream: "+h.message),new N.SshConnectionError("Error reading from stream: "+h.message,k.SshDisconnectReason.connectionLost)}if(!T)return!1;T.copy(h,C),C+=T.length}while(C<h.length);return!0}async write(h,m){const y=this.stream;if(!y)return!1;try{await y.write(h,m)}catch(h){if(!(h instanceof Error))throw h;if(y.isDisposed)return!1;throw y.dispose(),this.stream=null,(0,v.trace)("Error writing to stream: "+h.message),new N.SshConnectionError("Error writing to stream: "+h.message,k.SshDisconnectReason.connectionLost)}return!0}async considerReExchange(h,m){const y=this.kexService;if(!y)return;let v=null,C=null;!y.exchanging&&(h||this.inboundFlow+this.outboundFlow>this.config.keyRotationThreshold)&&([v,C]=await y.startKeyExchange(h)),v&&(await this.sendMessage(v,m),C&&await this.sendMessage(C,m))}async computeHmac(h,m,y){const v=new P.SshDataWriter(C.Buffer.alloc(4+m.length));return v.writeUInt32(y),v.write(m),await h.sign(v.toBuffer())}async verifyHmac(h,m,y,v){const T=new P.SshDataWriter(C.Buffer.alloc(4+m.length));return T.writeUInt32(y),T.write(m),await h.verify(T.toBuffer(),v)}async readAndVerifyHmac(h,m,y,v){if(!await this.read(y,v))return!1;if(!await this.verifyHmac(h,m,this.inboundPacketSequence,y))throw new N.SshConnectionError("Invalid MAC",k.SshDisconnectReason.macError);return!0}async sendMessage(h,m){var y;const T=this.algorithms,w=null==T?void 0:T.compressor,A=null==T?void 0:T.cipher,P=null==T?void 0:T.messageSigner;let k;await this.sessionSemaphore.wait(m);try{const T=A?Math.max(8,A.blockLength):8,R=SshProtocol.packetLengthSize+SshProtocol.paddingLengthSize;if(this.sendWriter.position=R,h.write(this.sendWriter),this.outgoingMessagesHaveReconnectInfo&&(this.sendWriter.writeUInt64(this.lastIncomingSequence),this.outgoingMessagesHaveLatencyInfo)){const h=Math.min(4294967295,Math.round(1e3*(this.metrics.time-this.lastIncomingTimestamp)));this.sendWriter.writeUInt32(h)}let N=this.sendWriter.toBuffer().slice(R);null!=w&&(N=w.compress(N));let D=T-((!((null==P?void 0:P.encryptThenMac)||(null==P?void 0:P.authenticatedEncryption))?SshProtocol.packetLengthSize:0)+SshProtocol.paddingLengthSize+N.length)%T;D<4&&(D+=T);const I=SshProtocol.paddingLengthSize+N.length+D;this.sendWriter.position=0,this.sendWriter.writeUInt32(I),this.sendWriter.writeByte(D),null!=w?this.sendWriter.write(N):this.sendWriter.position+=N.length,this.sendWriter.writeRandom(D),N=this.sendWriter.toBuffer();let x=null;if((null==P?void 0:P.encryptThenMac)&&A){const h=N.slice(SshProtocol.packetLengthSize,N.length);(await A.transform(h)).copy(h),x=await this.computeHmac(P,N,this.outboundPacketSequence)}else if(null==P?void 0:P.authenticatedEncryption){let h=N.slice(SshProtocol.packetLengthSize,N.length);(await A.transform(h)).copy(h),x=await P.sign(h)}else P&&(x=await this.computeHmac(P,N,this.outboundPacketSequence)),A&&(N=await A.transform(N));if(h instanceof M.ChannelDataMessage?v.traceData.enabled&&(0,v.traceData)(`Sending #${this.outboundPacketSequence} ${h}`):(0,v.trace)(`Sending #${this.outboundPacketSequence} ${h}`),this.incomingMessagesHaveReconnectInfo){const m=new SequencedMessage(this.outboundPacketSequence,h);m.sentTime=this.metrics.time,this.recentSentMessages.enqueue(m)}if(this.outboundPacketSequence++,this.outboundFlow+=I,x){const h=C.Buffer.concat([N,x],N.length+x.length);k=await this.write(h,m)}else k=await this.write(N,m);this.metrics.addMessageSent(SshProtocol.packetLengthSize+I+(null!==(y=null==P?void 0:P.digestLength)&&void 0!==y?y:0))}finally{this.sessionSemaphore.release()}return await this.considerReExchange(!1,m),k}async receiveMessage(h){var m;const y=this.algorithms,C=null==y?void 0:y.decipher,T=null==y?void 0:y.messageVerifier,w=null==y?void 0:y.decompressor,R=!((null==T?void 0:T.encryptThenMac)||(null==T?void 0:T.authenticatedEncryption)),D=R?C?Math.max(8,C.blockLength):8:SshProtocol.packetLengthSize;this.receiveWriter.position=D;let I=this.receiveWriter.toBuffer();if(!await this.read(I,h))return null;this.lastIncomingTimestamp=this.metrics.time,C&&R&&(I=await C.transform(I),this.receiveWriter.position=0,this.receiveWriter.write(I));const x=new P.SshDataReader(I).readUInt32();if(x>SshProtocol.maxPacketLength)throw(0,v.trace)("Invalid packet length."),new N.SshConnectionError("Invalid packet length.",k.SshDisconnectReason.protocolError);const O=SshProtocol.packetLengthSize+x;O>D&&this.receiveWriter.skip(O-D),T&&this.receiveWriter.skip(T.digestLength);const L=this.receiveWriter.toBuffer(),U=L.slice(0,O),B=L.slice(O);let W=U.slice(D,O);if(W.length>0){if(!await this.read(W,h))return null;if((null==T?void 0:T.encryptThenMac)&&!await this.readAndVerifyHmac(T,U,B,h))return null;if(C){if(null==T?void 0:T.authenticatedEncryption){if(!await this.read(B,h))return null;await T.verify(W,B)}try{W=await C.transform(W)}catch(h){throw(null==T?void 0:T.authenticatedEncryption)?new N.SshConnectionError("Invalid MAC",k.SshDisconnectReason.macError):h}this.receiveWriter.position=D,this.receiveWriter.write(W)}}if(T&&!T.encryptThenMac&&!T.authenticatedEncryption&&!await this.readAndVerifyHmac(T,U,B,h))return null;const q=U[SshProtocol.packetLengthSize];let Y=U.slice(SshProtocol.packetLengthSize+SshProtocol.paddingLengthSize,SshProtocol.packetLengthSize+(x-q));if(w&&(Y=w.decompress(Y)),this.incomingMessagesHaveReconnectInfo){let h,m;if(this.incomingMessagesHaveLatencyInfo){const y=new P.SshDataReader(Y.slice(Y.length-12,Y.length));h=y.readUInt64(),m=y.readUInt32()/1e3,Y=Y.slice(0,Y.length-12)}else{h=new P.SshDataReader(Y.slice(Y.length-8,Y.length)).readUInt64(),m=0,Y=Y.slice(0,Y.length-8)}for(;this.recentSentMessages.size>0;){const y=this.recentSentMessages.peek();if(y.sequence>h)break;if(this.stream&&this.incomingMessagesHaveLatencyInfo&&y.sequence===h){const h=this.lastIncomingTimestamp-y.sentTime-m;this.metrics.updateLatency(h)}this.recentSentMessages.dequeue()}}const V=Y[0];let $=A.SshMessage.create(V,Y);if(!$){const h=new k.UnimplementedMessage;h.sequenceNumber=this.inboundPacketSequence,h.unimplementedMessageType=V,$=h}return $ instanceof M.ChannelDataMessage?v.traceData.enabled&&(0,v.traceData)(`Receiving #${this.inboundPacketSequence} ${$}`):(0,v.trace)(`Receiving #${this.inboundPacketSequence} ${$}`),await this.sessionSemaphore.wait(h),this.inboundPacketSequence++,this.inboundFlow+=x,this.sessionSemaphore.release(),this.metrics.addMessageReceived(SshProtocol.packetLengthSize+x+(null!==(m=null==T?void 0:T.digestLength)&&void 0!==m?m:0)),await this.considerReExchange(!1,h),$}dispose(){try{this.stream&&this.stream.close().catch(h=>{(0,v.trace)("Error closing stream: "+h.message)})}catch(h){if(!(h instanceof Error))throw h;(0,v.trace)("Error closing stream: "+h.message)}this.stream=null,this.metrics.updateLatency(0),this.algorithms&&this.algorithms.dispose()}}m.SshProtocol=SshProtocol,SshProtocol.maxPacketLength=1048576,SshProtocol.packetLengthSize=4,SshProtocol.paddingLengthSize=1},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0}),m.SshSessionAlgorithms=void 0;m.SshSessionAlgorithms=class SshSessionAlgorithms{dispose(){this.cipher&&this.cipher.dispose(),this.decipher&&this.decipher.dispose(),this.signer&&this.signer.dispose(),this.verifier&&this.verifier.dispose()}}},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0}),m.SshClientSession=void 0;const v=y(50),C=y(139),T=y(57),w=y(287),A=y(82),P=y(83),k=y(137),R=y(286),M=y(141),N=y(51);class SshClientSession extends C.SshSession{constructor(h){super(h,!0),this.serviceRequests=new Map,this.clientAuthCompletion=null}async authenticate(h,m){return!!await this.authenticateServer(m)&&!!await this.authenticateClient(h,m)}async authenticateServer(h){if(!this.kexService||!this.kexService.hostKey)throw new Error("Encrypt the session before authenticating.");try{this.principal=await this.raiseAuthenticatingEvent(new w.SshAuthenticatingEventArgs(w.SshAuthenticationType.serverPublicKey,{publicKey:this.kexService.hostKey},h))}catch(h){if(!(h instanceof Error))throw h;throw(0,v.trace)("Error while authenticating server: "+h.message),h}return this.principal?((0,v.trace)(`${this} server authenticated.`),!0):(await this.close(T.SshDisconnectReason.hostKeyNotVerifiable,"Server authentication failed."),(0,v.trace)(`${this} server authentication failed.`),!1)}authenticateClient(h,m,y){if(!h)throw new TypeError("A credentials object is required.");return"function"==typeof m?this.authenticateClientWithCompletion(h,m,y):new Promise(async(y,v)=>{await this.authenticateClientWithCompletion(h,(h,m)=>{h?v(h):y(m)},m)})}async authenticateClientWithCompletion(h,m,y){if(this.clientAuthCompletion=new A.PromiseCompletionSource,this.clientAuthCompletion.promise.then(h=>m(void 0,h),h=>m(h)),y){if(y.isCancellationRequested)throw new P.CancellationError;y.onCancellationRequested(h=>{this.clientAuthCompletion&&this.clientAuthCompletion.reject(new P.CancellationError)})}let v=this.getService(R.AuthenticationService);if(!v){const h=new T.ServiceRequestMessage;h.serviceName=R.AuthenticationService.serviceName,await this.sendMessage(h,y),v=this.activateService(R.AuthenticationService)}await v.authenticateClient(h,y)}onAuthenticationComplete(h){h?(0,v.trace)(`${this} client authenticated.`):(0,v.trace)(`${this} client authentication failed.`),this.clientAuthCompletion&&(this.clientAuthCompletion.resolve(h),this.clientAuthCompletion=null)}async requestService(h,m){let y=!1,v=this.serviceRequests.get(h);if(v||(v=new A.PromiseCompletionSource,this.serviceRequests.set(h,v),y=!0),y){const y=new T.ServiceRequestMessage;y.serviceName=h,await this.sendMessage(y,m)}await v.promise}async handleServiceAcceptMessage(h,m){const y=this.serviceRequests.get(h.serviceName);null==y||y.resolve(!0)}async openChannel(h,m,y){if(!this.connectionService){const h=new T.ServiceRequestMessage;h.serviceName=M.ConnectionService.serviceName,await this.sendMessage(h,y)}return await super.openChannel(h,m,y)}handleDisconnected(){return this.reconnecting?(this.reconnecting=!1,!1):super.handleDisconnected()}async reconnect(h,m){if(this.isClosed)throw new N.ObjectDisposedError(this);if(this.isConnected)throw new Error("Already connected.");if(!this.protocol)throw new Error("The session was never previously connected.");if(this.reconnecting)throw new Error("Already reconnecting.");this.reconnecting=!0;try{await this.reconnectInternal(h,m)}finally{this.reconnecting=!1}}async reconnectInternal(h,m){var y,C,w,A,P,R;const M=this.sessionId,D=this.protocol,I=null===(y=this.kexService)||void 0===y?void 0:y.hostKey;if(!(M&&D&&this.kexService&&I&&(null===(C=D.extensions)||void 0===C?void 0:C.has(k.SshProtocolExtensionNames.sessionReconnect))))throw new Error("Reconnect was not enabled for this session.");let x;try{if(this.sessionId=null,await this.connect(h,m),!this.sessionId||!this.algorithms||!this.algorithms.signer)throw new Error("Session is not encrypted.");const y=this.kexService.hostKey,C=y?await y.getPublicKeyBytes():null,w=await I.getPublicKeyBytes();if(!C||!w||!C.equals(w)){const h="The server host key is different.";throw(0,v.trace)(`Reconnection failed: ${h}`),new N.SshReconnectError(h,T.SshReconnectFailureReason.differentServerHostKey)}x=this.sessionId}catch(h){throw this.protocol=D,super.handleDisconnected(),h}finally{this.sessionId=M,this.kexService.hostKey=I}const O=await this.createReconnectToken(M,x),L=new T.SessionReconnectRequestMessage;L.requestType="session-reconnect@microsoft.com",L.clientReconnectToken=O,L.lastReceivedSequenceNumber=D.lastIncomingSequence,L.wantReply=!0;const U=await this.requestResponse(L,T.SessionReconnectResponseMessage,T.SessionReconnectFailureMessage,m);if(U instanceof T.SessionReconnectFailureMessage){const h=null!==(w=U.reasonCode)&&void 0!==w?w:T.SshReconnectFailureReason.unknownServerFailure,m=null!==(A=U.description)&&void 0!==A?A:"The server rejected the reconnect request.";throw(0,v.trace)(`Reconnection failed: ${m}`),this.protocol=D,new N.SshReconnectError(m,h)}if(!this.verifyReconnectToken(M,x,null!==(P=U.serverReconnectToken)&&void 0!==P?P:Buffer.alloc(0))){const h="The reconnect token provided by the server was invalid.";throw(0,v.trace)(`Reconnection failed: ${h}`),new N.SshReconnectError(h,T.SshReconnectFailureReason.invalidServerReconnectToken)}(0,v.trace)("Reconnect request was accepted by the server.");const B=D.getSentMessages((null!==(R=U.lastReceivedSequenceNumber)&&void 0!==R?R:0)+1);if(!B){const h="Client is unable to re-send messages requested by the server.";throw(0,v.trace)(`Reconnection failed: ${h}`),new N.SshReconnectError(h,T.SshReconnectFailureReason.clientDroppedMessages)}let W=0;for(let h of B)await this.sendMessage(h,m),W++;D.dispose(),this.metrics.addReconnection(),(0,v.trace)(`Reconnected. Re-sent ${W} dropped messages.`)}dispose(){this.clientAuthCompletion&&this.clientAuthCompletion.reject(new N.ObjectDisposedError(this)),super.dispose()}}m.SshClientSession=SshClientSession},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0}),m.SshServerSession=void 0;const v=y(139),C=y(6),T=y(57),w=y(51),A=y(137),P=y(50);class SshServerSession extends v.SshSession{constructor(h,m){super(h,!1),this.reconnectedEmitter=new C.Emitter,this.onReconnected=this.reconnectedEmitter.event,this.credentials={publicKeys:[]};const y=h.protocolExtensions.includes(A.SshProtocolExtensionNames.sessionReconnect);if(y&&!m)throw new Error("When reconnect is enabled, server sessions require a reference to a shared collection to track reconnectable sessions.");if(!y&&m)throw new Error("When reconnect is not enabled, the reconnectable sessions collection is not applicable.");this.reconnectableSessions=m}async handleServiceRequestMessage(h,m){if(!this.activateService(h.serviceName))throw new w.SshConnectionError(`Service "${h.serviceName}" not available.`,T.SshDisconnectReason.serviceNotAvailable);{const y=new T.ServiceAcceptMessage;y.serviceName=h.serviceName,await this.sendMessage(y,m)}}async handleRequestMessage(h,m){var y;if("session-reconnect@microsoft.com"===h.requestType&&(null===(y=this.config.protocolExtensions)||void 0===y?void 0:y.includes(A.SshProtocolExtensionNames.sessionReconnect))){const y=h.convertTo(new T.SessionReconnectRequestMessage);await this.reconnect(y,m)}else await super.handleRequestMessage(h,m)}async enableReconnect(h){await super.enableReconnect(h),this.reconnectableSessions.includes(this)||this.reconnectableSessions.push(this)}handleDisconnected(){return!!this.reconnecting||super.handleDisconnected()}async reconnect(h,m){var y,v,C;if(!this.reconnectableSessions)throw new Error("Disconnected sessions collection should have been initialied when reconnect is enabled.");let w;for(let m of this.reconnectableSessions)if(m!==this&&await this.verifyReconnectToken(m.sessionId,this.sessionId,null!==(y=h.clientReconnectToken)&&void 0!==y?y:Buffer.alloc(0))){w=m,this.reconnectableSessions.splice(this.reconnectableSessions.indexOf(w),1);break}if(!w||w.isClosed){const h="Requested reconnect session was not found or the reconnect token provided by the client was invalid.";(0,P.trace)(`Reconnect failed: ${h}`);const y=new T.SessionReconnectFailureMessage;return y.reasonCode=T.SshReconnectFailureReason.sessionNotFound,y.description=h,void await this.sendMessage(y,m)}const A=w.protocol.getSentMessages((null!==(v=h.lastReceivedSequenceNumber)&&void 0!==v?v:0)+1);if(!A){this.reconnectableSessions.push(w);const h="Server is unable to re-send messages requested by the client.";(0,P.trace)(`Reconnect failed: ${h}`);const y=new T.SessionReconnectFailureMessage;return y.reasonCode=T.SshReconnectFailureReason.serverDroppedMessages,y.description=h,void await this.sendMessage(y,m)}const k=new T.SessionReconnectResponseMessage;k.serverReconnectToken=await this.createReconnectToken(w.sessionId,this.sessionId),k.lastReceivedSequenceNumber=w.protocol.lastIncomingSequence,await this.sendMessage(k,m);try{for(w.reconnecting=!0,null===(C=w.protocol)||void 0===C||C.dispose();w.isConnected;)await new Promise(h=>setTimeout(()=>h(),5));w.protocol=this.protocol,w.protocol.kexService=w.kexService,this.protocol=void 0;for(let h of A)await w.sendMessage(h,m);this.dispose()}finally{w.reconnecting=!1}this.reconnectableSessions.push(w),w.metrics.addReconnection(),w.processMessages().catch(h=>{(0,P.trace)(`Unhandled error processing messages: ${h.message||JSON.stringify(h)}`)}),(0,P.trace)(`Session reconnected. Re-sent ${A.length} dropped messages.`),w.reconnectedEmitter.fire()}dispose(){if(this.reconnectableSessions){const h=this.reconnectableSessions.indexOf(this);h>=0&&this.reconnectableSessions.splice(h,1)}super.dispose()}}m.SshServerSession=SshServerSession},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0}),m.WebSocketStream=m.NodeStream=m.BaseStream=void 0;const v=y(9),C=y(6),T=y(83),w=y(51);function handleCancellation(h,m){m&&(m.isCancellationRequested?h(new T.CancellationError):m.onCancellationRequested(()=>{h(new T.CancellationError)}))}class BaseStream{constructor(){this.incomingData=[],this.pendingReads=[],this.error=null,this.disposed=!1,this.closedEmitter=new C.Emitter,this.closed=this.closedEmitter.event}onData(h){for(;this.pendingReads.length>0;){const m=this.pendingReads.shift();if(m.count>=h.length)return void m.resolve(h);{const y=h.slice(0,m.count);h=h.slice(m.count),m.resolve(y)}}this.incomingData.push(h)}onEnd(){for(;this.pendingReads.length>0;){this.pendingReads.shift().resolve(null)}this.incomingData.push(v.Buffer.alloc(0))}onError(h){for(this.error||(this.error=h);this.pendingReads.length>0;){this.pendingReads.shift().reject(h)}}async read(h,m){if(this.disposed)throw new w.ObjectDisposedError(this);if(this.incomingData.length>0){let m=this.incomingData[0];return 0===m.length?null:(h>=m.length?this.incomingData.shift():(this.incomingData[0]=m.slice(h),m=m.slice(0,h)),m)}if(this.error)throw this.error;return await new Promise((y,v)=>{if(m){if(m.isCancellationRequested)return void v(new T.CancellationError);m.onCancellationRequested(()=>{for(let h=0;h<this.pendingReads.length;h++)if(Object.is(m,this.pendingReads[h].cancellation)){this.pendingReads.splice(h--,1)[0].reject(new T.CancellationError)}})}this.pendingReads.push({count:h,resolve:y,reject:v,cancellation:m})})}dispose(){if(!this.disposed){this.disposed=!0;const h=new w.ObjectDisposedError(this);this.onError(h),this.fireOnClose(h)}}fireOnClose(h){this.closedEmitter.fire({error:h})}get isDisposed(){return this.disposed}}m.BaseStream=BaseStream;m.NodeStream=class NodeStream extends BaseStream{constructor(h,m){if(super(),!h)throw new TypeError("Duplex or Readable/Writable stream are required.");this.readStream=h,this.writeStream=m||h,this.readStream.on("data",this.onData.bind(this)),this.readStream.on("end",this.onEnd.bind(this)),this.readStream.on("error",this.onError.bind(this)),this.readStream.on("close",()=>{this.onEnd(),this.fireOnClose()})}async write(h,m){if(!h)throw new TypeError("Data is required.");if(this.disposed)throw new w.ObjectDisposedError(this);return new Promise((y,v)=>{handleCancellation(v,m),this.writeStream.write(h,h=>{h?v(h):y()})})}async close(h,m){if(this.disposed)throw new w.ObjectDisposedError(this);await new Promise((h,y)=>{handleCancellation(y,m),this.writeStream.end(h)}),this.disposed=!0,this.onError(h||new w.ObjectDisposedError(this)),this.closedEmitter.fire({error:h})}dispose(){if(!this.disposed){const h=new w.ObjectDisposedError(this);this.readStream.destroy(h),this.writeStream.destroy(h)}super.dispose()}};m.WebSocketStream=class WebSocketStream extends BaseStream{constructor(h){if(super(),this.websocket=h,!h)throw new TypeError("WebSocket is required.");if("string"==typeof h.binaryType&&"arraybuffer"!==h.binaryType)throw new Error("WebSocket must use arraybuffer binary type.");h.onmessage=h=>{this.onData(v.Buffer.from(h.data))},h.onclose=h=>{if(h.wasClean)this.onEnd();else{const m=new Error(h.reason);m.code=h.code,this.onError(m)}}}async write(h,m){if(!h)throw new TypeError("Data is required.");if(this.disposed)throw new w.ObjectDisposedError(this);if("readyState"in this.websocket&&(2===this.websocket.readyState||3===this.websocket.readyState))throw new DOMException("WebSocket is already in CLOSING or CLOSED state.","InvalidStateError");this.websocket.send(h)}async close(h,m){if(this.disposed)throw new w.ObjectDisposedError(this);if(h){const m="number"==typeof h.code?h.code:void 0;this.websocket.close(m,h.message)}else this.websocket.close();this.disposed=!0,this.closedEmitter.fire({error:h}),this.onError(h||new Error("Stream closed."))}dispose(){this.disposed||this.websocket.close(),super.dispose()}}},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0}),m.SshRpcMessageStream=void 0;const v=y(6),C=y(9),T=y(40);class SshRpcMessageReader{constructor(h){this.channel=h,this.errorEmitter=new v.Emitter,this.closeEmitter=new v.Emitter,this.partialMessageEmitter=new v.Emitter,this.callback=null,this.messageBuffer=new T.SshDataWriter(C.Buffer.alloc(1024)),this.headersLength=null,this.messageLength=null,this.onError=this.errorEmitter.event,this.onClose=this.closeEmitter.event,this.onPartialMessage=this.partialMessageEmitter.event,this.eventRegistration=this.channel.onDataReceived(this.onDataReceived.bind(this)),this.channel.onClosed(h=>{h.error&&this.errorEmitter.fire(h.error),this.closeEmitter.fire()})}listen(h){this.callback=h}dispose(){this.eventRegistration&&this.eventRegistration.dispose()}onDataReceived(h){if(this.messageBuffer.write(h),this.channel.adjustWindow(h.length),h=this.messageBuffer.toBuffer(),null===this.messageLength){const m=h.indexOf("\r\n\r\n");if(m<0)return;const y=h.slice(0,m).toString();if(!y.startsWith("Content-Length: "))throw new Error(`Message does not start with JSON-RPC headers.\n${y}`);this.headersLength=m+"\r\n\r\n".length,this.messageLength=parseInt(y.substr("Content-Length: ".length,m-"Content-Length: ".length),10)}const m=this.messageBuffer.position,y=this.headersLength+this.messageLength;if(m>=y){if(this.callback){const m=h.slice(this.headersLength,y).toString();let v;try{v=JSON.parse(m)}catch(h){if(!(h instanceof Error))throw h;throw new Error(`Failed to parse JSON-RPC message: ${h.message}\n${m}`)}this.callback(v)}this.messageLength=null,this.messageBuffer.position=0,m>y&&this.onDataReceived(h.slice(y))}}}class SshRpcMessageWriter{constructor(h){this.channel=h,this.errorEmitter=new v.Emitter,this.closeEmitter=new v.Emitter,this.onError=this.errorEmitter.event,this.onClose=this.closeEmitter.event,this.channel.onClosed(h=>{h.error&&this.errorEmitter.fire([h.error,h.errorMessage&&{jsonrpc:h.errorMessage}||void 0,h.exitStatus]),this.closeEmitter.fire()})}write(h){const m=JSON.stringify(h),y=C.Buffer.from(m),v=C.Buffer.from("Content-Length: "+y.length+"\r\n\r\n"),T=C.Buffer.alloc(v.length+y.length);v.copy(T,0),y.copy(T,v.length),this.channel.send(T).catch(h=>{this.errorEmitter.fire([h,void 0,void 0])})}dispose(){}}m.SshRpcMessageStream=class SshRpcMessageStream{constructor(h){this.reader=new SshRpcMessageReader(h),this.writer=new SshRpcMessageWriter(h)}}},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0}),m.SessionContour=void 0;const v=y(51),C=y(189),T=y(140);class SessionContour{constructor(h=256){if(this.intervalMs=SessionContour.initialInterval,this.count=0,this.updateQueue=new C.Queue,this.updateSemaphore=new T.Semaphore(0),this.disposed=!1,h<2||0!=(h&h-1))throw new Error("Contour intervals must be a power of two.");this.maxIntervals=h,this.intervalBytesSent=new Array(h),this.intervalBytesReceived=new Array(h),this.intervalLatencyMin=new Array(h),this.intervalLatencyMax=new Array(h),this.intervalLatencySum=new Array(h),this.intervalLatencyCount=new Array(h),this.intervalLatencyAvg=new Array(h),this.intervalBytesSent.fill(0),this.intervalBytesReceived.fill(0),this.intervalLatencyMin.fill(0),this.intervalLatencyMax.fill(0),this.intervalLatencySum.fill(0),this.intervalLatencyCount.fill(0),this.intervalLatencyAvg.fill(0)}get intervalCount(){return this.count}get interval(){return this.intervalMs}get bytesSent(){return this.intervalBytesSent.slice(0,this.count)}get bytesReceived(){return this.intervalBytesReceived.slice(0,this.count)}get latencyMinMs(){return this.intervalLatencyMin.slice(0,this.count)}get latencyMaxMs(){return this.intervalLatencyMax.slice(0,this.count)}get latencyAverageMs(){return this.intervalLatencyAvg.slice(0,this.count)}onMessageSent(h){this.updateQueue.enqueue({time:h.time,bytesSent:h.size}),this.updateSemaphore.tryRelease()}onMessageReceived(h){this.updateQueue.enqueue({time:h.time,bytesReceived:h.size}),this.updateSemaphore.tryRelease()}onLatencyUpdated(h){this.updateQueue.enqueue(h),this.updateSemaphore.tryRelease()}onSessionClosed(){this.updateSemaphore.tryRelease()}async collectMetrics(h,m){if(!h)throw new TypeError("A session metrics object is required.");if(this.disposed)throw new v.ObjectDisposedError(this);const y=[];y.push(h.onMessageSent(this.onMessageSent.bind(this))),y.push(h.onMessageReceived(this.onMessageReceived.bind(this))),y.push(h.onLatencyUpdated(this.onLatencyUpdated.bind(this))),y.push(h.onSessionClosed(this.onSessionClosed.bind(this)));try{for(;!(null==m?void 0:m.isCancellationRequested);){try{await this.updateSemaphore.wait(m)}catch(h){break}const h=this.updateQueue.dequeue();if(!h)break;const y=this.updateInterval(h.time);h.bytesSent&&(this.intervalBytesSent[y]+=h.bytesSent),h.bytesReceived&&(this.intervalBytesReceived[y]+=h.bytesReceived);const v=h.latency;v&&((!this.intervalLatencyMin[y]||v<this.intervalLatencyMin[y])&&(this.intervalLatencyMin[y]=v),(!this.intervalLatencyMax[y]||v>this.intervalLatencyMax[y])&&(this.intervalLatencyMax[y]=v),this.intervalLatencySum[y]+=v,this.intervalLatencyCount[y]++,this.intervalLatencyAvg[y]=this.intervalLatencySum[y]/this.intervalLatencyCount[y])}this.disposed&&this.updateSemaphore.dispose()}finally{for(let h of y)h.dispose()}}updateInterval(h){let m=Math.floor(h/this.intervalMs);if(m>=this.intervalCount){for(;m>=this.maxIntervals;)this.expandIntervals(),m=Math.floor(h/this.intervalMs);this.count=m+1}return m}expandIntervals(){const combineLatency=(h,m,y)=>0===h?m:0===m?h:y(h,m),h=this.maxIntervals/2;for(let m=0;m<h;m++){const h=2*m,y=2*m+1;this.intervalBytesSent[m]=this.intervalBytesSent[h]+this.intervalBytesSent[y],this.intervalBytesReceived[m]=this.intervalBytesReceived[h]+this.intervalBytesReceived[y],this.intervalLatencyMin[m]=combineLatency(this.intervalLatencyMin[h],this.intervalLatencyMin[y],Math.min),this.intervalLatencyMax[m]=combineLatency(this.intervalLatencyMax[h],this.intervalLatencyMax[y],Math.max),this.intervalLatencySum[m]=this.intervalLatencySum[h]+this.intervalLatencySum[y];const v=this.intervalLatencyCount[h]+this.intervalLatencyCount[y];this.intervalLatencyCount[m]=v,this.intervalLatencyAvg[m]=0===v?0:this.intervalLatencySum[m]/this.intervalLatencyCount[m]}this.intervalBytesSent.fill(0,h,this.maxIntervals),this.intervalBytesReceived.fill(0,h,this.maxIntervals),this.intervalLatencyMin.fill(0,h,this.maxIntervals),this.intervalLatencyMax.fill(0,h,this.maxIntervals),this.intervalLatencySum.fill(0,h,this.maxIntervals),this.intervalLatencyCount.fill(0,h,this.maxIntervals),this.intervalLatencyAvg.fill(0,h,this.maxIntervals),this.intervalMs*=2}dispose(){this.disposed=!0,this.updateSemaphore.tryRelease()}export(){const getScale=h=>Math.max(0,Math.ceil(Math.log2(Math.max(...h)/255))),applyReverseScale=(h,m)=>Math.round(h/Math.pow(2,m)),h=Buffer.alloc(3+5*(2+this.intervalCount)),m=Math.log2(this.interval/SessionContour.initialInterval);h[0]=1,h[1]=5,h[2]=m,h[3]=getScale(this.latencyMinMs),h[4]=getScale(this.latencyMaxMs),h[5]=getScale(this.latencyAverageMs),h[6]=getScale(this.bytesSent),h[7]=getScale(this.bytesReceived),h[8]=w.latencyMin,h[9]=w.latencyMax,h[10]=w.latencyAverage,h[11]=w.bytesSent,h[12]=w.bytesReceived;for(let m=0;m<this.intervalCount;m++){const y=13+5*m;h[y+0]=applyReverseScale(this.intervalLatencyMin[m],h[3]),h[y+1]=applyReverseScale(this.intervalLatencyMax[m],h[4]),h[y+2]=applyReverseScale(this.intervalLatencyAvg[m],h[5]),h[y+3]=applyReverseScale(this.intervalBytesSent[m],h[6]),h[y+4]=applyReverseScale(this.intervalBytesReceived[m],h[7])}return h.toString("base64")}static import(h){const m=Buffer.from(h,"base64");if(m.length<3)throw new Error("Invalid session contour string.");const y=m[0],v=m[1],C=m[2];if(1!==y)throw new Error(`Unsupported session contour version: ${y}`);const T=(m.length-3)/v-2;if(T<1||m.length!==3+v*(T+2))throw new Error("Incomplete session contour string.");const A=Math.pow(2,Math.ceil(Math.log2(T))),P=new SessionContour(A);P.intervalMs=Math.pow(2,C)*SessionContour.initialInterval,P.count=T;const k=new Array(v);for(let h=0;h<v;h++)k[h]=Math.pow(2,m[3+h]);const R=new Array(v);for(let h=0;h<v;h++)R[h]=m[3+v+h];for(let h=0;h<T;h++){const y=3+(2+h)*v;for(let C=0;C<v;C++)switch(R[C]){case w.latencyMin:P.intervalLatencyMin[h]=m[y+C]*k[C];break;case w.latencyMax:P.intervalLatencyMax[h]=m[y+C]*k[C];break;case w.latencyAverage:P.intervalLatencyAvg[h]=P.intervalLatencySum[h]=m[y+C]*k[C],P.intervalLatencyCount[h]=0===m[y+C]?0:1;break;case w.bytesSent:P.intervalBytesSent[h]=m[y+C]*k[C];break;case w.bytesReceived:P.intervalBytesReceived[h]=m[y+C]*k[C]}}return P}}var w;m.SessionContour=SessionContour,SessionContour.initialInterval=1e3,function(h){h[h.none=0]="none",h[h.latencyMin=1]="latencyMin",h[h.latencyMax=2]="latencyMax",h[h.latencyAverage=3]="latencyAverage",h[h.bytesSent=11]="bytesSent",h[h.bytesReceived=12]="bytesReceived"}(w||(w={}))},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0}),m.MultiChannelStream=void 0;const v=y(6),C=y(50),T=y(522),w=y(139),A=y(137),P=y(57),k=y(141);m.MultiChannelStream=class MultiChannelStream{constructor(h){if(this.transportStream=h,this.disposed=!1,this.disposables=[],this.closedEmitter=new v.Emitter,this.onClosed=this.closedEmitter.event,this.channelOpeningEmitter=new v.Emitter,!h)throw new TypeError("transportStream is required.");const m=new A.SshSessionConfiguration(!1);this.session=new w.SshSession(m),this.session.onClosed(this.onSessionClosed,this,this.disposables),this.session.onChannelOpening(this.onSessionChannelOpening,this,this.disposables)}get isClosed(){return this.disposed||this.session.isClosed}get onChannelOpening(){return this.isClosed||this.session.activateService(k.ConnectionService),this.channelOpeningEmitter.event}async connect(h){await this.session.connect(this.transportStream,h)}async acceptChannel(h,m){return await this.session.connect(this.transportStream,m),await this.session.acceptChannel(h,m)}async acceptStream(h,m){return new T.SshStream(await this.acceptChannel(h,m))}async openChannel(h,m){return await this.session.connect(this.transportStream,m),await this.session.openChannel(null!=h?h:null,m)}async openStream(h,m){return new T.SshStream(await this.openChannel(h,m))}async connectAndRunUntilClosed(h){const m=[],y=new Promise((y,v)=>{null==h||h.onCancellationRequested(v,null,m),this.session.onClosed(y,null,m)});try{await this.connect(h),await y}finally{m.forEach(h=>h.dispose()),await this.close()}}dispose(){if(!this.disposed){this.disposed=!0,this.session.dispose(),this.unsubscribe();try{this.transportStream&&this.transportStream.close().catch(h=>{(0,C.trace)("Error closing transport stream: "+h.message)})}catch(h){if(!(h instanceof Error))throw h;(0,C.trace)("Error closing transport stream: "+h.message)}}}async close(){this.disposed||(this.disposed=!0,await this.session.close(P.SshDisconnectReason.none,"SshSession disposed"),this.session.dispose(),this.unsubscribe(),await this.transportStream.close())}onSessionClosed(h){this.unsubscribe(),this.closedEmitter.fire(h)}onSessionChannelOpening(h){this.channelOpeningEmitter.fire(h)}unsubscribe(){this.disposables.forEach(h=>h.dispose()),this.disposables=[]}}},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0});const v=y(66),C=y(6),T=y(510);m.createSshRpcMessageStream=function createSshRpcMessageStream(h,m,y,C,w){const A=new SshRelayChannel(h,m,y,w||v.SequenceRelayDataHubProxy.createForTypeAndParticipant(h,m,y),C);return new T.SshRpcMessageStream(A)};class SshRelayChannel{constructor(h,m,y,T,w){this.relayHubProxy=h,this.streamId=m,this.targetParticipant=y,this.closeOnError=w,this.dataReceivedEmitter=new C.Emitter,this.nextSequence=0,this.disposables=[],this.onDataReceived=this.dataReceivedEmitter.event,this.closedEmitter=new C.Emitter,this.onClosed=this.closedEmitter.event,this.disposables.push(T),this.disposables.push(T.onReceiveData(h=>(this.dataReceivedEmitter.fire(Buffer.from(h.data)),Promise.resolve()))),this.disposables.push(h.onParticipantChanged(h=>(h.changeType===v.ParticipantChangeType.Removed&&h.participant.id===this.targetParticipant&&this.fireError(new Error(`participant id:${h.participant.id} removed`)),Promise.resolve()))),this.disposables.push(h.onDisconnected(async()=>(this.fireError(new Error("hub proxy disconnected")),Promise.resolve())))}dispose(){this.disposables.forEach(h=>h.dispose()),this.disposables=[]}async send(h,m){await this.relayHubProxy.sendData(v.SendOption.ExcludeSelf,[this.targetParticipant],this.streamId,h,v.RelayHubMessageProperties.createMessageSequence(++this.nextSequence))}adjustWindow(h){}fireError(h){this.closedEmitter.fire({error:h}),this.closeOnError&&this.closedEmitter.fire({})}}},function(h,m,y){"use strict";var v=this&&this.__awaiter||function(h,m,y,v){return new(y||(y=Promise))((function(C,T){function fulfilled(h){try{step(v.next(h))}catch(h){T(h)}}function rejected(h){try{step(v.throw(h))}catch(h){T(h)}}function step(h){h.done?C(h.value):function adopt(h){return h instanceof y?h:new y((function(m){m(h)}))}(h.value).then(fulfilled,rejected)}step((v=v.apply(h,m||[])).next())}))};Object.defineProperty(m,"__esModule",{value:!0});const C=y(2);m.HubProxyUtils=class HubProxyUtils{static waitForConnection(h,m){return v(this,void 0,void 0,(function*(){if(!h.isConnected){const y=new C.Signal(m),v=h.onConnectionStateChanged(()=>(h.isConnected&&y.resolve(!0),Promise.resolve()));yield y.promise,v.dispose()}}))}}},function(h,m,y){"use strict";var v=this&&this.__awaiter||function(h,m,y,v){return new(y||(y=Promise))((function(C,T){function fulfilled(h){try{step(v.next(h))}catch(h){T(h)}}function rejected(h){try{step(v.throw(h))}catch(h){T(h)}}function step(h){h.done?C(h.value):function adopt(h){return h instanceof y?h:new y((function(m){m(h)}))}(h.value).then(fulfilled,rejected)}step((v=v.apply(h,m||[])).next())}))};Object.defineProperty(m,"__esModule",{value:!0});const C=y(16),T=y(66),w=y(6),A=y(142);m.createRelayHubEventNotifier=function createRelayHubEventNotifier(h,m){let y=0;const P=m||A.DATA_TYPE_LIVESHARE_HUB,k=new C.RpcMessageWriter;h.onHubJoined(h=>{h?k.onSendCallback=m=>v(this,void 0,void 0,(function*(){yield h.sendData(T.SendOption.None,null,`${P}${A.POST_FIX_NOTIFY}`,m,T.RelayHubMessageProperties.createMessageSequence(++y))})):(y=0,k.onSendCallback=null)});const R=w.createMessageConnection({},k);return(h,m)=>R.sendNotification(h,m)}},function(h,m,y){"use strict";var v=this&&this.__awaiter||function(h,m,y,v){return new(y||(y=Promise))((function(C,T){function fulfilled(h){try{step(v.next(h))}catch(h){T(h)}}function rejected(h){try{step(v.throw(h))}catch(h){T(h)}}function step(h){h.done?C(h.value):function adopt(h){return h instanceof y?h:new y((function(m){m(h)}))}(h.value).then(fulfilled,rejected)}step((v=v.apply(h,m||[])).next())}))};Object.defineProperty(m,"__esModule",{value:!0});const C=y(6),T=y(523),w=y(2);m.createRelayHubProxyServerProvider=function createRelayHubProxyServerProvider(h,m,y,A){const P=new C.Emitter,k=new T.RelayHubProxyServer(h,m,y),R=k.onStreamJoined(h=>{P.fire(h)});let M=new w.Signal;const N={name:"signalR",ready:M.promise,onRpcStreamJoined:P.event,acceptConnections:h=>k.acceptConnections(h),dispose:()=>v(this,void 0,void 0,(function*(){if(R.dispose(),D.dispose(),h.hubProxy.isConnected){y.info(`deleting hub:${m}`);try{yield h.deleteHub(m)}catch(h){y.error(`Failed to delete hub id:${m}`,h)}}}))},D=k.onHubJoined(h=>{h?M.resolve():(M=new w.Signal,N.ready=M.promise)});return N}},function(h,m,y){"use strict";var v=this&&this.__awaiter||function(h,m,y,v){return new(y||(y=Promise))((function(C,T){function fulfilled(h){try{step(v.next(h))}catch(h){T(h)}}function rejected(h){try{step(v.throw(h))}catch(h){T(h)}}function step(h){h.done?C(h.value):function adopt(h){return h instanceof y?h:new y((function(m){m(h)}))}(h.value).then(fulfilled,rejected)}step((v=v.apply(h,m||[])).next())}))};Object.defineProperty(m,"__esModule",{value:!0});const C=y(16),T=y(66),w=y(6),A=y(275),P=y(509),k=y(142);m.RpcUtils=class RpcUtils{static createRpcClient(h,m,y,R,M){return M=M||P.HubStreamUtils.getHostParticipant,new C.RpcClient({create:C=>v(this,void 0,void 0,(function*(){yield h.hubProxy.connect();const v=yield h.joinHub(m,null,{}),C=M(v).id,P=R||k.DATA_TYPE_LIVESHARE_HUB,N=T.SequenceRelayDataHubProxy.createForTypeAndParticipant(v,P,C);T.SequenceRelayDataHubProxy.createForTypeAndParticipant(v,`${P}${k.POST_FIX_NOTIFY}`,C,-1).onReceiveData(h=>N.fireReceivedData(h));const D=A.createSshRpcMessageStream(v,P,C,!0,N),I=w.createMessageConnection(D.reader,D.writer);return I.listen(),yield v.sendData(T.SendOption.None,[C],k.DATA_TYPE_JOINED_READY,null),y.verbose(`successfully joined rpc session on hubId:${m} host id:${C}`),I}))},y)}}},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0});const v=y(31),C=y(20),T=y(29),w=y(15),A=y(39);m.openDirectConnection=async function openDirectConnection(h,m){if("string"!=typeof h||!h)throw new Error("Cannot connect to workspace. Direct connect link is not a valid string.");let y;try{y=C.parse(h)}catch(h){throw new Error(`Workspace direct connect link is not a valid URL: ${h.message||h}`)}const{protocol:P,hostname:k,port:R,path:M,query:N}=y;if(!R||!k||"/"!==M||N||"net.tcp:"!==P)throw new Error("Cannot connect to workspace. Unexpected format of direct connect link.");const D=parseInt(R,10);if(isNaN(D))throw new Error("Cannot connect to workspace. Cannot parse port number of direct connect link.");m.log(w.LogLevel.Debug,`connecting to direct link '${y}'`);const I=await new Promise((h,m)=>{let y=!1;const C=v.createConnection(D,k,()=>{h(C),y=!0});C.on("close",()=>{y||m(new Error("connection closed."))}),C.on("error",h=>{y||m(h)})});return m.log(w.LogLevel.Debug,"creating socket SSH..."),[new T.NodeStream(I),A.ConnectionMode.Direct]}},function(h,m,y){"use strict";var v=this&&this.__awaiter||function(h,m,y,v){return new(y||(y=Promise))((function(C,T){function fulfilled(h){try{step(v.next(h))}catch(h){T(h)}}function rejected(h){try{step(v.throw(h))}catch(h){T(h)}}function step(h){h.done?C(h.value):function adopt(h){return h instanceof y?h:new y((function(m){m(h)}))}(h.value).then(fulfilled,rejected)}step((v=v.apply(h,m||[])).next())}))};Object.defineProperty(m,"__esModule",{value:!0});const C=y(104),T=y(524);class LocalClientConnection extends C.LiveShareConnection{get type(){return C.TConnectionTypes.WorkspaceHub}createWorkspaceClient(){return v(this,void 0,void 0,(function*(){const h=this.options.workspaceOptions;return T.createLocalWorkspaceClient(this.trace.createChild("workspaceclient"),h)}))}}m.LocalClientConnection=LocalClientConnection},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0});const v=y(6),C=y(29),T=y(31),w=y(18),A=y(2);async function tryStartTcpListener(h,m,y,v){const C=T.createServer(y),w=new A.Signal;C.on("error",y=>{null==v||v.error(`socket server err:${y}`),"EADDRINUSE"===y.code&&(++h>m?w.reject(new Error("Exhaust ports")):(null==v||v.info(`listening attempt on port:${h}`),C.listen(h)))}),C.on("listening",()=>{const h=C.address();null==v||v.info(`server listening on address:${JSON.stringify(h)}`),w.resolve()});try{return C.listen(h,"0.0.0.0"),await w.promise,[h,C]}catch(h){return null}}m.createDirectConnectionProvider=async function createDirectConnectionProvider(h){const m=new v.Emitter,y=new v.Emitter,T=new v.Emitter,listenerCallback=y=>{h.verbose(`accepting direct connection on address:${JSON.stringify(y.address())}`),m.fire(new C.NodeStream(y))};let A=await tryStartTcpListener(5990,5999,listenerCallback,h);if(null===A&&(A=await tryStartTcpListener(14600,14999,listenerCallback,h)),null===A)return null;const P=A[0],k=A[1],R=w.networkInterfaces(),M=[];return Object.keys(R).forEach(h=>{R[h].forEach(h=>{h.internal||("IPv6"===h.family?M.push(`net.tcp://[${h.address}]:${P}/`):M.push(`net.tcp://${h.address}:${P}/`))})}),{name:"direct",onRpcStreamJoined:m.event,onClose:y.event,onError:T.event,acceptConnections:h=>Promise.resolve(),dispose(){null==k||k.close()},connectLinks:M}}},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0});const v=y(35),C=y(1236),T=y(1242);m.startLocalWorkspaceHubService=async function startLocalWorkspaceHubService(h,m){const y=`vsclsws.${v().replace(/-/g,"")}`,w={traceSource:m,pipe:y,socketServerFactory:(m,y)=>new C.MutliChannelRpcSocketServer(y,v=>new T.WorkspaceHubService(v,h,m,y.withName("WorkspaceHubService")))};return[await C.startSocketServer(w),y]}},function(h,m,y){"use strict";function __export(h){for(var y in h)m.hasOwnProperty(y)||(m[y]=h[y])}Object.defineProperty(m,"__esModule",{value:!0}),__export(y(1237)),__export(y(1241))},function(h,m,y){"use strict";var v=this&&this.__awaiter||function(h,m,y,v){return new(y||(y=Promise))((function(C,T){function fulfilled(h){try{step(v.next(h))}catch(h){T(h)}}function rejected(h){try{step(v.throw(h))}catch(h){T(h)}}function step(h){h.done?C(h.value):function adopt(h){return h instanceof y?h:new y((function(m){m(h)}))}(h.value).then(fulfilled,rejected)}step((v=v.apply(h,m||[])).next())}))};Object.defineProperty(m,"__esModule",{value:!0});const C=y(143),T=y(29);m.MutliChannelRpcSocketServer=class MutliChannelRpcSocketServer{constructor(h,m){this.rpcServer=new C.MultiChannelRpcServer(h.withName("RpcServer")),this.server=m(this.rpcServer)}accept(h){return v(this,void 0,void 0,(function*(){const m=new T.NodeStream(h),[y]=yield this.rpcServer.acceptStream(m);return y}))}dispose(){return v(this,void 0,void 0,(function*(){this.server&&"function"==typeof this.server.dispose&&(yield Promise.resolve(this.server.dispose()))}))}}},function(h,m,y){"use strict";var v=this&&this.__awaiter||function(h,m,y,v){return new(y||(y=Promise))((function(C,T){function fulfilled(h){try{step(v.next(h))}catch(h){T(h)}}function rejected(h){try{step(v.throw(h))}catch(h){T(h)}}function step(h){h.done?C(h.value):function adopt(h){return h instanceof y?h:new y((function(m){m(h)}))}(h.value).then(fulfilled,rejected)}step((v=v.apply(h,m||[])).next())}))},C=this&&this.__importStar||function(h){if(h&&h.__esModule)return h;var m={};if(null!=h)for(var y in h)Object.hasOwnProperty.call(h,y)&&(m[y]=h[y]);return m.default=h,m};Object.defineProperty(m,"__esModule",{value:!0});const T=y(16),w=y(2),A=C(y(29)),P=y(2),k=C(y(6));class SshRpcServer extends T.RpcServer{constructor(h,m){super(m),this.sshPrivateKeys=h,this.rpcServerProviders=[],this.reconnectableSessions=[],this.rpcSessions=new Map,this.onSessionClosedEmitter=new k.Emitter,this.onUserAuthenticateCallbacks=new P.CallbackContainer,this.sshServerSessionNumber=0,this.onSessionClosed=this.onSessionClosedEmitter.event}dispose(h){this.reconnectableSessions.forEach(h=>h.dispose()),super.dispose(h)}acceptConnections(h){return v(this,void 0,void 0,(function*(){yield Promise.all(this.rpcServerProviders.map(m=>m.acceptConnections(h)))}))}registerRpcServerProvider(h){this.rpcServerProviders.push(h);const m=h.onRpcStreamJoined(m=>{this.acceptRpcStream(h.name,m).catch(h=>{this.trace.error("Failed to accept rpc stream",h)})});return{dispose:()=>v(this,void 0,void 0,(function*(){this.trace.info(`unregister rpc server provider:${h.name}`),m.dispose();const y=this.rpcServerProviders.indexOf(h);-1!==y&&this.rpcServerProviders.splice(y,1),"function"==typeof h.dispose&&(this.trace.verbose(`dispose rpc server provider:${h.name}`),yield h.dispose())}))}}onUserAuthenticate(h){return this.onUserAuthenticateCallbacks.add(h)}closeSshSession(h){return v(this,void 0,void 0,(function*(){const m=this.getSshSession(h);m&&(yield m.close(A.SshDisconnectReason.byApplication))}))}getSshSession(h){return this.rpcSessions.get(h)}acceptRpcStream(h,m){return v(this,void 0,void 0,(function*(){const y=yield function createServerSession(h,m,y,C,T){return v(this,void 0,void 0,(function*(){y.verbose("Created socket stream");const v=yield function createSshServerSession(h){const m=new A.SshSessionConfiguration;return m.keyExchangeAlgorithms.splice(0),m.keyExchangeAlgorithms.push(A.SshAlgorithms.keyExchange.ecdhNistp384Sha384),m.keyExchangeAlgorithms.push(A.SshAlgorithms.keyExchange.ecdhNistp256Sha256),m.keyExchangeAlgorithms.push(A.SshAlgorithms.keyExchange.dhGroup14Sha256),m.protocolExtensions.push(A.SshProtocolExtensionNames.sessionReconnect),m.protocolExtensions.push(A.SshProtocolExtensionNames.sessionLatency),new A.SshServerSession(m,h)}(T);y.verbose("created SSH server session"),v.credentials={publicKeys:m},v.onAuthenticating(h=>{const m=h.password;y.verbose("authenticating request"),null!==m&&(h.authenticationPromise=C(m))}),v.onChannelOpening(h=>{void 0===v.principal&&(y.error("unauthenticated request"),h.failureReason=A.SshChannelOpenFailureReason.administrativelyProhibited,h.failureDescription="Not authenticated")});const w=v.onChannelOpening(h=>{h.channel.onRequest(h=>{h.isAuthorized="json-rpc"===h.requestType,y.info("rpc channel opening request "+h.requestType),w.dispose()})});yield v.connect(h),y.verbose("connected to server session");const P=yield v.acceptChannel();return y.verbose(`opened channel ${P.channelId}`),P}))}(m,this.sshPrivateKeys,this.trace,h=>v(this,void 0,void 0,(function*(){for(const m of this.onUserAuthenticateCallbacks.items){const y=yield m(h);if(void 0!==y)return y}})),this.reconnectableSessions),C=++this.sshServerSessionNumber;this.trace.verbose(`Created ssh server session:${C} for provider:${h}`);const T=y.session;let P;const onRpcSessionClosed=h=>{this.trace.verbose(`ssh server session:${C} closed reason:${h}`),this.onSessionClosedEmitter.fire(P),this.rpcSessions.delete(P)};T.onDisconnected(h=>v(this,void 0,void 0,(function*(){this.trace.info(`Disconnected server session:${C} waiting to reconnect.`);let h=!1;T.onReconnected(m=>{this.trace.info(`Reconnected server session:${C}`),h=!0}),yield w.wait(6e4),h||(this.trace.info(`Closing disconnected server session:${C} because the client `+"has not reconnected within the timeout."),yield T.close(A.SshDisconnectReason.connectionLost),onRpcSessionClosed(A.SshDisconnectReason.connectionLost))})));const k=new A.SshRpcMessageStream(y);P=this.acceptRpcMessageStream(k)[0],P.listen(),this.rpcSessions.set(P,T),T.onClosed(h=>onRpcSessionClosed(h.reason))}))}}m.SshRpcServer=SshRpcServer},function(h,m,y){"use strict";var v=this&&this.__awaiter||function(h,m,y,v){return new(y||(y=Promise))((function(C,T){function fulfilled(h){try{step(v.next(h))}catch(h){T(h)}}function rejected(h){try{step(v.throw(h))}catch(h){T(h)}}function step(h){h.done?C(h.value):function adopt(h){return h instanceof y?h:new y((function(m){m(h)}))}(h.value).then(fulfilled,rejected)}step((v=v.apply(h,m||[])).next())}))},C=this&&this.__importStar||function(h){if(h&&h.__esModule)return h;var m={};if(null!=h)for(var y in h)Object.hasOwnProperty.call(h,y)&&(m[y]=h[y]);return m.default=h,m};Object.defineProperty(m,"__esModule",{value:!0});const T=y(16),w=C(y(29)),A=C(y(6));class MultiChannelRpcServer extends T.RpcServer{constructor(){super(...arguments),this.acceptedStreams=new Map,this.onRpcConnectionDisposedEmitter=new A.Emitter,this.onRpcConnectionDisposed=this.onRpcConnectionDisposedEmitter.event}acceptStream(h){return v(this,void 0,void 0,(function*(){const m=new w.MultiChannelStream(h),y=yield m.acceptChannel(),C=new w.SshRpcMessageStream(y),T=this.acceptRpcMessageStream(C),A=T[0];this.acceptedStreams.set(A,m);const P=h.closed(()=>{P.dispose(),A.dispose()});return A.onDispose(m=>v(this,void 0,void 0,(function*(){P.dispose(),this.acceptedStreams.delete(A),this.onRpcConnectionDisposedEmitter.fire(A),h.isDisposed||(yield h.close())}))),T}))}getMultiChannelStream(h){return this.acceptedStreams.get(h)}}m.MultiChannelRpcServer=MultiChannelRpcServer},function(h,m,y){"use strict";var v=this&&this.__awaiter||function(h,m,y,v){return new(y||(y=Promise))((function(C,T){function fulfilled(h){try{step(v.next(h))}catch(h){T(h)}}function rejected(h){try{step(v.throw(h))}catch(h){T(h)}}function step(h){h.done?C(h.value):function adopt(h){return h instanceof y?h:new y((function(m){m(h)}))}(h.value).then(fulfilled,rejected)}step((v=v.apply(h,m||[])).next())}))};Object.defineProperty(m,"__esModule",{value:!0});const C=y(525),T=y(526);m.createDuplexMultiChannelRpcClient=function createDuplexMultiChannelRpcClient(h,m){return v(this,void 0,void 0,(function*(){const[y,v]=C.createDuplexStreams(),w=h.acceptStream(y),A=T.createMultiChannelRpcClient(v,m),[P,k]=yield Promise.all([w,A]);return P[0].listen(),k}))}},function(h,m,y){"use strict";var v=this&&this.__awaiter||function(h,m,y,v){return new(y||(y=Promise))((function(C,T){function fulfilled(h){try{step(v.next(h))}catch(h){T(h)}}function rejected(h){try{step(v.throw(h))}catch(h){T(h)}}function step(h){h.done?C(h.value):function adopt(h){return h instanceof y?h:new y((function(m){m(h)}))}(h.value).then(fulfilled,rejected)}step((v=v.apply(h,m||[])).next())}))};Object.defineProperty(m,"__esModule",{value:!0});const C=y(31),T=y(18),w=y(21),A=y(2),P=y(67);m.startSocketServer=function startSocketServer(h){return v(this,void 0,void 0,(function*(){if(!h.port&&!h.pipe)throw Error("You need to specify a port or a pipe name");const{traceSource:m,getLogs:y,socketServerFactory:k,serverHost:R={}}=h,M=h.keepAliveTime||1e4,N={keepAliveCount:0,rpcConnectionCount:0,options:h,stop:h=>stopRpcServer(h)},keepAlive=y=>{const v=y||M;++N.keepAliveCount,m.verbose(`keepAlive start -> time:${v}`),A.wait(v).then(()=>{--N.keepAliveCount,m.verbose(`keepAlive end -> count:${N.keepAliveCount+N.rpcConnectionCount}`),N.keepAliveCount+N.rpcConnectionCount===0&&(h.autoExit?(m.info("shutting down due to inactivity..."),stopRpcServer(99)):"function"==typeof R.keepAliveTriggered&&R.keepAliveTriggered(N))})},D=k(keepAlive,m),I=[];let x;const stopRpcServer=h=>v(this,void 0,void 0,(function*(){if(x){const h=new A.Signal;m.writeLine("closing socket server..."),I.forEach(h=>h.destroy()),x.close(y=>{h.resolve(),m.writeLine(`server closed err:${null!=y?y:"n/a"}`)}),yield h.promise}m.writeLine("stopping rpc server...");try{yield D.dispose()}catch(h){m.error("failed to dispose server",h)}m.info("rpc server stopped"),"function"==typeof R.serverStopped&&R.serverStopped(h,N)}));let O;O=h.port?m=>{const y=h.port+m;x.listen(y,"localhost")}:y=>{const v=0===y?h.pipe:`${h.pipe}-${y}`,C=h.isRawPipe?v:P.getPipePath(v);if("win32"!==T.platform()&&w.existsSync(C)){m.warning(`pipe:${C} already exist, attempting to delete it`);try{w.unlinkSync(C)}catch(h){m.error("failed to delete existing pipe:",h)}}x.listen(C)},x=C.createServer((function(h){I.push(h),h.on("close",(function(){I.splice(I.indexOf(h),1)})),D.accept(h).then(h=>{h.listen(),h.onRequest("logService.getLogs",(h,m)=>"function"==typeof y?y(m):[]);const v=[];++N.rpcConnectionCount,m.info(`rpc created count:${N.rpcConnectionCount}`);const removeRpc=h=>{v.forEach(h=>h.dispose()),--N.rpcConnectionCount,m.info(`rpc event:${h} count:${N.rpcConnectionCount}`),keepAlive()};v.push(h.onDispose(h=>removeRpc("disposed"))),v.push(h.onClose(h=>removeRpc("closed")))}).catch(h=>{m.info("failed to accept socket",h)})}));const L=h.maxRetries||20;let U=0;return x.on("error",h=>{m.error(`socket server err:${h}`),"EADDRINUSE"===h.code&&(++U,U>=L?"function"==typeof R.serverStopped&&R.serverStopped(h,N):(m.info(`listening retry:${U}`),O(U)))}),x.on("listening",()=>{const y=x.address();if(m.info(`rpc server listening on address:${JSON.stringify(y)}`),h.isAdmin){m.info("change pipe permission...");try{w.chmodSync(String(y),"777")}catch(h){m.info("failed to change pipe permission.",h)}}}),O(0),keepAlive(),N}))}},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0});var v=y(1243);m.WorkspaceHubService=v.WorkspaceHubService},function(h,m,y){"use strict";var v=this&&this.__awaiter||function(h,m,y,v){return new(y||(y=Promise))((function(C,T){function fulfilled(h){try{step(v.next(h))}catch(h){T(h)}}function rejected(h){try{step(v.throw(h))}catch(h){T(h)}}function step(h){h.done?C(h.value):function adopt(h){return h instanceof y?h:new y((function(m){m(h)}))}(h.value).then(fulfilled,rejected)}step((v=v.apply(h,m||[])).next())}))},C=this&&this.__importStar||function(h){if(h&&h.__esModule)return h;var m={};if(null!=h)for(var y in h)Object.hasOwnProperty.call(h,y)&&(m[y]=h[y]);return m.default=h,m};Object.defineProperty(m,"__esModule",{value:!0});const T=C(y(6)),w=y(104),A=y(15),P=y(16),k=y(2),R=y(39),M=y(1244);m.WorkspaceHubService=class WorkspaceHubService{constructor(h,m,y,C){this.rpcServer=h,this.connectionHub=m,this.keepAliveCallback=y,this.logger=C,this.onHostConnectionChangedEmitter=new T.Emitter,this.onWorkspaceMetricsUpdatedEmitter=new T.Emitter,this.workspaceConnections=new Map,this.onHostConnectionChanged=this.onHostConnectionChangedEmitter.event,this.onWorkspaceMetricsUpdated=this.onWorkspaceMetricsUpdatedEmitter.event,this.rpcServer.registerRpcService(this,R.workspaceServiceClient),this.rpcServer.onHandleNoneRequest((h,m,...y)=>v(this,void 0,void 0,(function*(){for(const v of this.workspaceConnections.values()){const C=v.getJoinedRpcConnection(h);if(C){const h=yield v.rpcWorkspaceConnection;try{const T=Date.now();y.splice(0,1);const w=yield h.sendRequest(m,...y),P=(Date.now()-T).toFixed(1);return this.logger.verbose(`remote rpc request method: "${m}" result: "${A.TraceFormat.stringify(w)}" workspace: "${v.workspaceId}" rpc session #${C}\n                            t:${P}`),w}catch(h){throw this.logger.error(`failed to handle request for method:${m} params:${JSON.stringify(y)}`,h),h}}}this.logger.warning(`no joined connections found to handle request for method:${m}`)}))),this.rpcServer.onRpcConnectionDisposed(h=>{for(const m of this.workspaceConnections.values())m.onRpcConnectionDisposed(h)})}dispose(){return v(this,void 0,void 0,(function*(){for(const h of this.workspaceConnections.values())yield h.disconnect();this.workspaceConnections.clear()}))}getSessionInfoAsync(h,m,y){return v(this,void 0,void 0,(function*(){P.assertRpcRequestContext(y);const m=this.workspaceConnections.get(h);if(this.logger.info(`-> getSessionInfo workspaceId:${h} session:${y.session} found:${m?"true":"false"}`),m)return m.addJoinedConnection(y),m.workspaceSessionInfo}))}joinAsync(h,m,y){return v(this,void 0,void 0,(function*(){P.assertRpcRequestContext(y);const v=h.workspaceId;k.assertDefined(v,"workspace id needs to be defined"),this.logger.info(`-> join workspaceId:${v} session:${y.session}`);try{const C=yield this.connectionHub.connectOnce(h);let T=this.workspaceConnections.get(v);return T?yield T.checkConnection(m):(this.logger.info(`adding workspace connection for workspaceId:${v}`),T=new M.WorkspaceConnection(v,C,this,this.logger.withName(`WorkspaceConnection:${v}`)),this.workspaceConnections.set(v,T),T.addToDisposables(T.onDispose(()=>{this.workspaceConnections.delete(v)}))),-1===this.rpcServer.rpcConnections.indexOf(y.connection)?T.checkNoRpcJoined():T.addJoinedConnection(y),T.workspaceSessionInfo}catch(h){throw h instanceof w.ConnectionError?this.throwRpcError(v,h.originalError):this.throwRpcError(v,h),h}}))}throwRpcError(h,m){if(m instanceof R.NoHostConnectedError)throw new T.ResponseError(R.RPC_ERR_NO_HOST_NOT_CONNECTED,m.message,h);if(m instanceof R.RelayConnectionError)throw new T.ResponseError(R.RPC_ERR_RELAY_CONNECTIONY_SSH,m.message,m.errorContext)}disconnectAsync(h,m,y){return v(this,void 0,void 0,(function*(){P.assertRpcRequestContext(y),this.logger.info(`disconnect workspaceId:${h} session:${y.session}`);const m=this.workspaceConnections.get(h);k.assertDefined(m,`Workspace id:${h} not found.`),yield m.disconnect(y.connection)}))}openStreamingChannelAsync(h,m,y,C){return v(this,void 0,void 0,(function*(){P.assertRpcRequestContext(C),this.logger.info(`open stream channel workspaceId:${h} streamId:${m} session:${C.session}`);const v=this.workspaceConnections.get(h);k.assertDefined(v,`Workspace id:${h} not found.`),yield v.openStreamingChannel(m,C.connection,y)}))}keepAliveAsync(h,m,y){return v(this,void 0,void 0,(function*(){P.assertRpcRequestContext(y),this.logger.info(`keep alive time:${h} session:${y.session}`),this.keepAliveCallback(h)}))}checkConnectionAsync(h,m,y){return v(this,void 0,void 0,(function*(){P.assertRpcRequestContext(y);const v=this.workspaceConnections.get(h);if(!v)throw new Error(`workspace id:${h} not found`);yield v.checkConnection(m)}))}setCheckConnectionOptionsAsync(h,m){return v(this,void 0,void 0,(function*(){this.logger.info(`setCheckConnectionOptionsAsync workspaceId:${h} options:${JSON.stringify(m)}`);const y=this.workspaceConnections.get(h);if(!y)throw new Error(`workspace id:${h} not found`);yield y.workspaceClient.setCheckConnectionOptions(m)}))}_getRequestMultiChannelStream(h){return this.rpcServer.getMultiChannelStream(h)}_removeWorkspaceConnection(h){return this.workspaceConnections.delete(h)}_fireHostConnectionChanged(h){this.onHostConnectionChangedEmitter.fire(h)}_fireWorkspaceMetricsUpdated(h){this.onWorkspaceMetricsUpdatedEmitter.fire(h)}}},function(h,m,y){"use strict";var v=this&&this.__awaiter||function(h,m,y,v){return new(y||(y=Promise))((function(C,T){function fulfilled(h){try{step(v.next(h))}catch(h){T(h)}}function rejected(h){try{step(v.throw(h))}catch(h){T(h)}}function step(h){h.done?C(h.value):function adopt(h){return h instanceof y?h:new y((function(m){m(h)}))}(h.value).then(fulfilled,rejected)}step((v=v.apply(h,m||[])).next())}))};Object.defineProperty(m,"__esModule",{value:!0});const C=y(2),T=y(39),w=y(2);class WorkspaceConnection extends C.DisposableClass{constructor(h,m,y,v){super(v.createChild(`workspace-connection:${h}`)),this.workspaceId=h,this.connection=m,this.workspaceHubService=y,this.logger=v,this.joinedConnections=new Map,this.streamChannels=new Map,m.addToDisposables(this),this.workspaceClient.rpcClient.ensureConnectionAsync().then(h=>{h.onNotification((h,...m)=>{this.logger.verbose(`joined sendNotification method:${h}`);for(const y of this.joinedConnections.keys())y.sendNotification(h,m)})}).catch(h=>{v.error("Failed to hookup notifications",h)}),this.addToDisposables(this.workspaceClient.onHostConnectionChanged(m=>{this.trace.verbose(`host connection changed to "${T.ConnectedState[m.state]}"`),this.workspaceHubService._fireHostConnectionChanged({workspaceId:h,state:m.state,duration:m.duration})})),this.addToDisposables(this.workspaceClient.onWorkspaceMetricsUpdated(m=>{this.workspaceHubService._fireWorkspaceMetricsUpdated({workspaceId:h,bytesIn:m.bytesIn,bytesOut:m.bytesOut,latency:m.latency})}),m.onConnectionChanged(h=>{"disconnected"===h.status&&this.handleDisconnected("connection disconnected")}))}get workspaceClient(){return w.assertDefined(this.connection.workspaceClient,"workspace client undefined"),this.connection.workspaceClient}get workspaceSessionInfo(){return w.assertDefined(this.connection.workspaceSessionInfo,"workspace session undefined"),this.connection.workspaceSessionInfo}get rpcWorkspaceConnection(){return this.workspaceClient.rpcClient.ensureConnectionAsync()}getJoinedRpcConnection(h){return this.joinedConnections.get(h)}openStreamingChannel(h,m,y){return v(this,void 0,void 0,(function*(){let v=this.streamChannels.get(h);if(!v){try{const m=Date.now();v=yield this.workspaceClient.openStreamingChannel(h,y);const C=(Date.now()-m).toFixed(1);this.logger.info(`openStreamingChannel streamId:${h} completed in t:${C}`)}catch(y){throw this.logger.error(`Failed to open remote stream: ${h}`,y),yield this.acceptChannel(m),y}this.streamChannels.set(h,v),this.logger.verbose(`added streamId:${h}`)}const C=yield this.acceptChannel(m);this.forwardRemoteChannel(v,C)}))}addJoinedConnection(h){this.logger.info(`join -> adding rpc connection session:${h.session}`),this.joinedConnections.set(h.connection,h.session)}disconnect(h){return v(this,void 0,void 0,(function*(){const m="disconnect";this.logger.info(m),h&&this.joinedConnections.delete(h),yield this.workspaceClient.disconnect(),this.dispose(m),this.connection.disconnect(),this.removeFromHubService(m),this.disposeJoinedRpcConnections(m)}))}onRpcConnectionDisposed(h){this.joinedConnections.has(h)&&(this.logger.info(`remove rpc connection rpc session:${this.joinedConnections.get(h)}`),this.joinedConnections.delete(h),this.checkNoRpcJoined())}checkNoRpcJoined(){this.logger.verbose("checkNoRpcJoined");const noRpcJoined=()=>0===this.joinedConnections.size;noRpcJoined()&&w.wait(45e3).then(()=>{if(noRpcJoined()&&!this.isDisposed){this.logger.info("disconnect due to no rpc joined");try{this.disconnect()}catch(h){this.logger.error("failed to disconnect workspace",h)}}})}checkConnection(h){return v(this,void 0,void 0,(function*(){try{this.logger.info("check connection"),yield w.timeoutPromise(this.workspaceClient.checkConnection(h),3e3,new Error("Failed to check connection"))}catch(h){this.logger.error("failed to check connection",h);const m="check connection failed";throw this.removeFromHubService(m),this.workspaceClient.dispose(m),h}}))}handleDisconnected(h){this.removeFromHubService(h),this.disposeJoinedRpcConnections(h),this.dispose(h)}forwardRemoteChannel(h,m){h.onDataReceived(y=>{y=Buffer.from(y),m.send(y).then(()=>{h.adjustWindow(y.length)},h=>{this.logger.error("Error sending channel data: "+h.message,h)})}),m.onDataReceived(y=>{y=Buffer.from(y),h.send(y).then(()=>{m.adjustWindow(y.length)},h=>{this.logger.error("Error sending channel data: "+h.message,h)})}),h.onClosed(h=>{m.close()}),m.onClosed(m=>{h.close()})}acceptChannel(h){return this.workspaceHubService._getRequestMultiChannelStream(h).acceptChannel()}disposeJoinedRpcConnections(h){if(0===this.joinedConnections.size)return;this.logger.info(`disposeJoinedRpcConnections reason:${h}`);const m=Array.from(this.joinedConnections.keys());this.joinedConnections.clear();for(const h of m)h.dispose()}removeFromHubService(h){this.workspaceHubService._removeWorkspaceConnection(this.workspaceId)&&this.logger.info(`removed from the hub service reason:${h}`)}}m.WorkspaceConnection=WorkspaceConnection},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0});class ArgumentError extends Error{constructor(h,m){super(h),this.argumentName=m}}m.ArgumentError=ArgumentError;m.Requires=class Requires{static Argument(h,m,y){if(!h)throw new ArgumentError(y,m)}static NotNullOrUndefined(h,m){if(!h)throw new ArgumentError("Parameter "+m+" is required",m);return h}}},function(h,m,y){"use strict";var v=this&&this.__awaiter||function(h,m,y,v){return new(y||(y=Promise))((function(C,T){function fulfilled(h){try{step(v.next(h))}catch(h){T(h)}}function rejected(h){try{step(v.throw(h))}catch(h){T(h)}}function step(h){h.done?C(h.value):function adopt(h){return h instanceof y?h:new y((function(m){m(h)}))}(h.value).then(fulfilled,rejected)}step((v=v.apply(h,m||[])).next())}))};Object.defineProperty(m,"__esModule",{value:!0});const C=y(69),T=y(0),w=y(5),A=y(1247),P=y(6),k=y(2),R=y(8),M=y(4),N=y(61),D=y(25);m.SearchProvider=class SearchProvider{constructor(h){this.fileservice=h.fileService(),this.fileSearchOptionsMap=new Map,this.fileListMap=new Map,this.fileservice.onFilesChanged(h=>this.onFilesChanged(h)),this.trace=w.traceSource.withName(M.vsls.TraceSources.AgentFile),this.pathManager=h.pathManager()}onFilesChanged(h){return v(this,void 0,void 0,(function*(){for(let m of h.changes)yield this.updateList(m)}))}updateList(h){return v(this,void 0,void 0,(function*(){if(!h.fullPath)return;const{moniker:m}=N.PathUtil.getMonikerFromRelativePath(h.fullPath),y=N.PathUtil.getRelativePathFromPrefixedPath(h.fullPath),v=N.PathUtil.getPrefixedRoot(m);let C=yield this.getCachedList(v);switch(C||(C=[]),h.changeType){case M.vsls.FileChangeType.Deleted:let h=C?C.indexOf(y):-1;if(-1===h)break;C.splice(h,1);break;case M.vsls.FileChangeType.Added:const m=this.fileSearchOptionsMap.get(v);if(!m)break;let T={excludePatterns:m.excludes,enableMultipleRoots:!0};(yield this.fileservice.isExcludedAsync(y,T))||C.push(y)}this.fileListMap.set(v,Promise.resolve(C))}))}getFiles(h,m){return v(this,void 0,void 0,(function*(){try{const y=[h.folder.path],v={excludePatterns:h.excludes,enableMultipleRoots:!0,includePatterns:y},C=yield this.fileservice.getFilesAsync(v,m);return A.FileSearchTelemetry.sendFindFileDiagnostics(C.length,!!h.useIgnoreFiles),C}catch(h){this.trace.error(h),R.Telemetry.sendFault(A.SearchServiceTelemetryEventNames.FIND_FILE_FAULT,R.FaultType.Error,"Failed to get files from host",h)}}))}getCachedList(h){const m=this.fileListMap.get(h);if(m)return m}getFileResults(h,m){return v(this,void 0,void 0,(function*(){const y=h.folder.path;let v;const C=this.fileListMap.get(y);if(C&&(v=yield C),!v||!this.fileSearchOptionsMap.has(y)){const C=new k.Signal;try{this.fileListMap.set(y,C.promise),v=yield this.getFiles(h,m),C.resolve(v)}catch(h){throw this.fileListMap.delete(y),C.reject(h),h}this.fileSearchOptionsMap.set(y,h)}return v}))}provideFileSearchResults(h,m,y){return v(this,void 0,void 0,(function*(){const v=yield this.getFileResults(h,y);v&&v.forEach(h=>m.report(h))}))}provideFileIndex(h,m){return v(this,void 0,void 0,(function*(){const y=yield this.getFileResults(h,m);if(y){return y.map(h=>this.pathManager.relativePathToLocalPath(h))}return[]}))}toVsCodeTextSearchResult1(h){return{uri:this.pathManager.relativePathToLocalPath(h.path),ranges:h.ranges?h.ranges.map(h=>new T.Range(h.line,h.column,h.endLine,h.endColumn)):[],preview:{text:h.text,matches:h.previewRanges?h.previewRanges.map(h=>new T.Range(h.line,h.column,h.endLine,h.endColumn)):[]}}}toVsCodeTextSearchResult2(h){return{uri:this.pathManager.relativePathToLocalPath(h.path),ranges:[new T.Range(h.line,h.column,h.line,h.column+h.length)],preview:{text:h.text,matches:[new T.Range(0,h.column,0,h.column+h.length)]}}}toVsCodeTextSearchResult3(h){return{uri:this.pathManager.relativePathToLocalPath(h.path),range:new T.Range(h.line,h.column,h.line,h.column+h.length),preview:{text:h.text,match:new T.Range(0,h.column,0,h.column+h.length)}}}toVslsTextSearchOptions(h,m){return{pattern:h.pattern,isRegex:h.isRegExp,isCaseSensitive:h.isCaseSensitive,isWordMatch:h.isWordMatch,includeHiddenFiles:m.useIgnoreFiles,encoding:m.encoding,fileIncludes:m.includes,fileExcludes:m.excludes}}provideTextSearchResults(h,m,y,w){return v(this,void 0,void 0,(function*(){let v=this.toVslsTextSearchOptions(h,m);const k=new A.TextSearchTelemetry;k.startTextSearch();let R=[],M=!1,N=0,I=!1,x=!1,O={report:h=>{M||(M=!0,k.saveFirstResultTime());try{C.gte(T.version,"1.29.0")?h.ranges&&h.previewRanges?(x=!0,y.report(this.toVsCodeTextSearchResult1(h))):x||y.report(this.toVsCodeTextSearchResult2(h)):C.gte(T.version,"1.26.0")&&y.report(this.toVsCodeTextSearchResult3(h)),N++}catch(h){}!0===h.hitResultsLimit&&(I=!0)}};try{try{yield this.fileservice.getTextSearchResultsWithProgressAsync(v,O,w),k.saveTextSearchResults(N)}catch(h){h.code===P.ErrorCodes.MethodNotFound&&(R=yield this.fileservice.getTextSearchResultsAsync(v,w),C.gte(T.version,"1.29.0")?R.forEach(h=>{y.report(this.toVsCodeTextSearchResult1(h))}):C.gte(T.version,"1.26.0")&&R.forEach(h=>{y.report(this.toVsCodeTextSearchResult3(h))})),R.length>0&&R[R.length-1].hitResultsLimit&&(I=!0),k.saveTextSearchResults(R.length)}}catch(h){return{limitHit:I}}return k.send(),C.gte(T.version,"1.28.0")||I&&T.window.showInformationMessage(D.localize("info.SearchResultsLimited")),{limitHit:I}}))}}},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0});const v=y(8),C=y(17);class FileSearchTelemetry{static sendFindFileDiagnostics(h,m){const y=new v.TelemetryEvent(SearchServiceTelemetryEventNames.FIND_FILE);y.addMeasure(SearchServiceTelemetryPropertyNames.FILE_COUNT,h),y.addProperty(SearchServiceTelemetryPropertyNames.USE_IGNORE_FILES,m),y.send()}}m.FileSearchTelemetry=FileSearchTelemetry,FileSearchTelemetry.PROPERTY_PREFIX=C.TelemetryPropertyNames.FEATURE_NAME+"Search.";class TextSearchTelemetry{startTextSearch(){this.textSearchEvent=v.Telemetry.startTimedEvent(SearchServiceTelemetryEventNames.TEXT_SEARCH)}saveFirstResultTime(){this.textSearchEvent.markTime(SearchServiceTelemetryPropertyNames.FIRST_RESULT_TIME)}saveTextSearchResults(h){this.textSearchEvent.addMeasure(SearchServiceTelemetryPropertyNames.RESULTS_COUNT,h),this.textSearchEvent.markTime(SearchServiceTelemetryPropertyNames.RESULTS_RECEIVED_TIME)}send(){this.textSearchEvent.send()}}m.TextSearchTelemetry=TextSearchTelemetry,TextSearchTelemetry.PROPERTY_PREFIX=C.TelemetryPropertyNames.FEATURE_NAME+"Search.";class SearchServiceTelemetryEventNames{}m.SearchServiceTelemetryEventNames=SearchServiceTelemetryEventNames,SearchServiceTelemetryEventNames.FIND_FILE_FAULT="find-file-fault",SearchServiceTelemetryEventNames.FIND_FILE="find-file",SearchServiceTelemetryEventNames.TEXT_SEARCH="find-text";class SearchServiceTelemetryPropertyNames{}SearchServiceTelemetryPropertyNames.FILE_COUNT=FileSearchTelemetry.PROPERTY_PREFIX+"FileCount",SearchServiceTelemetryPropertyNames.USE_IGNORE_FILES=FileSearchTelemetry.PROPERTY_PREFIX+"UseIgnoreFiles",SearchServiceTelemetryPropertyNames.RESULTS_RECEIVED_TIME=TextSearchTelemetry.PROPERTY_PREFIX+"ResultsReceivedTime",SearchServiceTelemetryPropertyNames.RESULTS_COUNT=TextSearchTelemetry.PROPERTY_PREFIX+"ResultsCount",SearchServiceTelemetryPropertyNames.FIRST_RESULT_TIME=TextSearchTelemetry.PROPERTY_PREFIX+"FirstResultTime"},function(h,m,y){"use strict";var v=this&&this.__awaiter||function(h,m,y,v){return new(y||(y=Promise))((function(C,T){function fulfilled(h){try{step(v.next(h))}catch(h){T(h)}}function rejected(h){try{step(v.throw(h))}catch(h){T(h)}}function step(h){h.done?C(h.value):function adopt(h){return h instanceof y?h:new y((function(m){m(h)}))}(h.value).then(fulfilled,rejected)}step((v=v.apply(h,m||[])).next())}))};Object.defineProperty(m,"__esModule",{value:!0});const C=y(2),T=y(8),w=y(24),A=y(17),P=y(4);let k;m.reconnectHostCallback=function reconnectHostCallback(h,m){if(h){k.resolve();const h=new T.TelemetryEvent(A.TelemetryEventNames.REPORT_AGENTPROGRESS,!0);h.addProperty(A.TelemetryPropertyNames.EVENT_MESSAGE,P.vsls.WorkspaceProgress.ReconnectedToHost),h.addMeasure(A.TelemetryPropertyNames.PROGRESS_DURATION,m),h.send()}else{k=new C.Signal,w.ExtensionUtil.runWithProgress(()=>v(this,void 0,void 0,(function*(){yield k.promise})),{title:w.ExtensionUtil.getProgressUpdateString(P.vsls.WorkspaceProgress.ReconnectingToHost)});const h=new T.TelemetryEvent(A.TelemetryEventNames.REPORT_AGENTPROGRESS,!0);h.addProperty(A.TelemetryPropertyNames.EVENT_MESSAGE,P.vsls.WorkspaceProgress.ReconnectingToHost),h.addMeasure(A.TelemetryPropertyNames.PROGRESS_DURATION,m),h.send()}}},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0});const v=y(169),C=[];m.recordTerminalActivities=function recordTerminalActivities(h){C.push(h.onTerminalStarted(h=>{v.activitySource.fire({timestamp:new Date,name:`${v.ActivityType.terminal}/share`,data:{name:h.terminal.options.name,readOnly:h.terminal.options.readOnlyForGuests}})})),C.push(h.onTerminalStopped(h=>{v.activitySource.fire({timestamp:new Date,name:`${v.ActivityType.terminal}/unshare`,data:{name:h.terminal.options.name,readOnly:h.terminal.options.readOnlyForGuests}})})),C.push(h.onTerminalReadOnlyChanged(h=>{v.activitySource.fire({timestamp:new Date,name:`${v.ActivityType.terminal}/changeAccess`,data:{name:h.terminal.options.name,readOnly:h.terminal.options.readOnlyForGuests}})}))},m.disposeActivityListeners=function disposeActivityListeners(){for(let h of C)h.dispose()}},function(h,m,y){"use strict";var v=this&&this.__awaiter||function(h,m,y,v){return new(y||(y=Promise))((function(C,T){function fulfilled(h){try{step(v.next(h))}catch(h){T(h)}}function rejected(h){try{step(v.throw(h))}catch(h){T(h)}}function step(h){h.done?C(h.value):function adopt(h){return h instanceof y?h:new y((function(m){m(h)}))}(h.value).then(fulfilled,rejected)}step((v=v.apply(h,m||[])).next())}))};Object.defineProperty(m,"__esModule",{value:!0});const C=y(0),T=y(4),w=y(26),A=y(232),P=y(12),k=y(14),R=y(17),M=y(8),N=y(5);m.initInviteLinkSupport=function initInviteLinkSupport(h){h.addListener(A.ContactManagerEvents.InviteLinkReceived,m=>v(this,void 0,void 0,(function*(){yield function handleInviteLinkReceived(h,m,y){var A;return v(this,void 0,void 0,(function*(){if(w.workspaceSessionInfoTracker.workspaceSessionInfo&&w.workspaceSessionInfoTracker.workspaceSessionInfo.joinUri===m.link)return void(null==y||y.verbose(`Invite link received for uri:${m.link} but already joined`));const fireInviteStatusChanged=y=>v(this,void 0,void 0,(function*(){yield h.fireInviteStatusChanged(m.originator.contact.id,m.provider.selfUserId,y)})),N=m.originator.contact.id===m.provider.selfUserId;if(h.isDoNotDisturbState&&!N)return void(yield fireInviteStatusChanged(T.vsls.InviteContactStatus.Dismissed));yield fireInviteStatusChanged(T.vsls.InviteContactStatus.Invited);const D=new M.TelemetryEvent(R.TelemetryEventNames.SHOW_LINK_INVITE_TOAST);D.send();const I={id:1,title:"Accept"};let x=[I];const O=null===(A=m.originator)||void 0===A?void 0:A.contact,L=O.displayName||O.DisplayName||"Unknown User",U=yield C.window.showInformationMessage(`${L} invited you to join a collaboration session`,...x),B=new M.TelemetryEvent(R.TelemetryEventNames.RESPOND_TOAST);if(B.correlateWith(D),B.addProperty(R.TelemetryPropertyNames.TOAST_RESULT,null==U?void 0:U.title),B.send(),U&&U.id===I.id){yield fireInviteStatusChanged(T.vsls.InviteContactStatus.Joining);const h={targetContactId:m.originator.contact.id,fromContactId:m.provider.selfUserId},y={newWindow:!1,link:m.link,inviteLinkJoining:h};yield C.commands.executeCommand(`${P.Settings.get(k.SettingKeys.commandPrefix)}.join`,y)}else yield fireInviteStatusChanged(T.vsls.InviteContactStatus.Dismissed)}))}(h,m,N.traceSource)})))}},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0}),function __export(h){for(var y in h)m.hasOwnProperty(y)||(m[y]=h[y])}(y(527));var v=y(1252);m.FileService=v.FileService;var C=y(1253);m.SourceEventService=C.SourceEventService;var T=y(1254);m.WorkspaceService=T.WorkspaceService;var w=y(1258);m.WorkspaceUserService=w.WorkspaceUserService;var A=y(1259);m.WorkspaceAccessControlService=A.WorkspaceAccessControlService;var P=y(1260);m.AccessControlService=P.AccessControlService;var k=y(1261);m.createWorkspaceApi=k.createWorkspaceApi},function(h,m,y){"use strict";var v=this&&this.__awaiter||function(h,m,y,v){return new(y||(y=Promise))((function(C,T){function fulfilled(h){try{step(v.next(h))}catch(h){T(h)}}function rejected(h){try{step(v.throw(h))}catch(h){T(h)}}function step(h){h.done?C(h.value):function adopt(h){return h instanceof y?h:new y((function(m){m(h)}))}(h.value).then(fulfilled,rejected)}step((v=v.apply(h,m||[])).next())}))};Object.defineProperty(m,"__esModule",{value:!0});const C=y(0),T=y(35),w=y(4),A=y(16),P=y(53),k=y(61),R=y(527);function constructExternalRemotePathFromLocalPath(h,m){const y=(h=C.Uri.parse(h).path).substr(h.lastIndexOf("/")+1);return`${P.PathManager.externalPrefix}/${m||T()}/${y}`}class FileService extends R.TextSearchService{constructor(h,m,y,v,T,A){super(y,T),this.rpcServiceHandler=h,this.workspaceService=m,this.clientAccessCheck=v,this.hostSessionId=A,this.disposables=[],this.localPathsToVslsPaths=new Map,this.vslsPathsToLocalPaths=new Map,this.serviceInfo=w.vsls.FileService,this.contextMethods=["registerExternalFiles","writeText","createDirectory","delete","move"],this.onFilesChangedEmitter=new C.EventEmitter,this.onFilesChanged=this.onFilesChangedEmitter.event,this.onRootsChangedEmitter=new C.EventEmitter,this.onRootsChanged=this.onRootsChangedEmitter.event,this.onExternalFilesChangedEmitter=new C.EventEmitter,this.onExternalFilesChanged=this.onExternalFilesChangedEmitter.event}getLocalUri(h){let m;if(function isExternalVslsPath(h){return h.startsWith(P.PathManager.externalPrefix)&&h.length>P.PathManager.externalPrefix.length+1}(h)){if(!this.vslsPathsToLocalPaths.has(h))throw new Error("External file has not been registered");const y=this.vslsPathsToLocalPaths.get(h);m=C.Uri.parse(y)}else m=C.Uri.joinPath(C.workspace.workspaceFolders[0].uri,h);return m}init(){return v(this,void 0,void 0,(function*(){yield this.workspaceService.registerServicesAsync([w.vsls.FileService.name],w.vsls.CollectionChangeType.Add),this.disposables.push(this.rpcServiceHandler.registerRpcService(this,this.serviceInfo,this.contextMethods))}))}registerExternalFilesAsync(h,m,y,C){return v(this,void 0,void 0,(function*(){return this.registerNamedExternalFilesAsync(h,null,m,y,C)}))}registerNamedExternalFilesAsync(h,m,y,C,T){return v(this,void 0,void 0,(function*(){if(this.hostSessionId&&(null==T?void 0:T.session)!==this.hostSessionId)throw new Error("Invalid rpc request. This method is allowed only by the host session");if(void 0===this.hostSessionId&&y)throw new Error("Cannot register external files");if(m&&m.length!==h.length)throw new Error("Number of LocalPaths and UUIDs length differ");const v=[],C=[];return h.forEach((h,y)=>{if(!this.localPathsToVslsPaths.has(h)){const T=k.PathUtil.normalizePath(h);let w=m?constructExternalRemotePathFromLocalPath(T,m[y]):constructExternalRemotePathFromLocalPath(T);this.localPathsToVslsPaths.set(h,w),this.vslsPathsToLocalPaths.set(w,h),v.push(T),C.push(w)}}),v.length>0&&this.onExternalFilesChangedEmitter.fire({changeType:w.vsls.CollectionChangeType.Add,localPaths:v,vslsPaths:C}),h.map(h=>this.localPathsToVslsPaths.get(h))}))}listRootsAsync(h,m){return v(this,void 0,void 0,(function*(){const h=[];if(void 0!==C.workspace.workspaceFolders)for(const m of C.workspace.workspaceFolders){const y={fullPath:m.uri.toString(),path:"/",friendlyName:m.name};h.push(y)}return h}))}listAsync(h,m,y){return v(this,void 0,void 0,(function*(){const m=[];for(const y of h){const h=this.getLocalUri(y);let v;try{v=yield C.workspace.fs.stat(h)}catch(h){m.push(fileNotfound(y));continue}const T=[];if((null==v?void 0:v.type)===C.FileType.Directory){const m=yield C.workspace.fs.readDirectory(h);for(const y of m){const m={path:C.Uri.joinPath(h,y[0]).path,exists:!0,isDirectory:y[1]===C.FileType.Directory};T.push(m)}}const w={path:y,exists:void 0!==v,isDirectory:(null==v?void 0:v.type)===C.FileType.Directory,hasChildren:0!==T.length,children:T};m.push(w)}return m}))}readTextAsync(h,m,y){return v(this,void 0,void 0,(function*(){try{const m=this.getLocalUri(h),y=yield C.workspace.fs.readFile(m);return{path:h,text:y.toString()}}catch(m){if("FileNotFound"===(null==m?void 0:m.code))return fileNotfound(h);throw m}}))}readTextWithProgressAsync(h,m,y,C){return v(this,void 0,void 0,(function*(){const v=yield Promise.all(h.map(h=>this.readTextAsync(h,m,C))),T=[];let w=0,P=0,k=[];const reportProgress=()=>{k.length>0&&y.report({results:k})};return v.forEach(h=>{var m,y;0===w?T.push(h):k.push(h),P+=null!==(y=null===(m=h.text)||void 0===m?void 0:m.length)&&void 0!==y?y:0,P>A.rpcMaxMessageSize&&(++w,reportProgress(),P=0,k=[])}),reportProgress(),T}))}writeTextAsync(h,m,y,T,w){return v(this,void 0,void 0,(function*(){if(yield this.clientAccessCheck().isClientReadOnly(T))throw new Error("Read-only clients cannot create files");const y=this.pathManager.relativePathToLocalPath(h);return yield C.workspace.fs.writeFile(y,(new TextEncoder).encode(m)),{path:h}}))}createDirectoryAsync(h,m,y){return v(this,void 0,void 0,(function*(){if(yield this.clientAccessCheck().isClientReadOnly(m))throw new Error("Read-only clients cannot create directories");const y=this.pathManager.relativePathToLocalPath(h);return yield C.workspace.fs.createDirectory(y),{path:h}}))}deleteAsync(h,m,y,T){return v(this,void 0,void 0,(function*(){if(yield this.clientAccessCheck().isClientReadOnly(y))throw new Error("Read-only clients cannot delete files");const v=this.pathManager.relativePathToLocalPath(h);try{yield C.workspace.fs.delete(v,{useTrash:m.useTrash})}catch(h){yield C.workspace.fs.delete(v)}}))}copyAsync(h,m,y,v){throw new Error("Method not implemented.")}moveAsync(h,m,y,T,w){return v(this,void 0,void 0,(function*(){if(yield this.clientAccessCheck().isClientReadOnly(T))throw new Error("Read-only clients cannot move files");const v=this.pathManager.relativePathToLocalPath(h),w=this.pathManager.relativePathToLocalPath(m);return yield C.workspace.fs.rename(v,w,{overwrite:y.overwrite}),{path:m}}))}getFilesAsync(h,m){return v(this,void 0,void 0,(function*(){return(yield C.workspace.findFiles("**/*","{**/.git,**/.svn,**/.hg,**/CVS,**/.DS_Store,**/node_modules,**/bower_components,**/*.code-search}")).map(h=>this.pathManager.localPathToRelativePath(h))}))}isExcludedAsync(h,m,y){return v(this,void 0,void 0,(function*(){return!1}))}findFilesAsync(h,m,y){return v(this,void 0,void 0,(function*(){return[]}))}clearRootsAsync(h){return v(this,void 0,void 0,(function*(){}))}addRootAsync(h,m){throw new Error("Method not implemented.")}removeRootAsync(h,m){throw new Error("Method not implemented.")}replaceRootAsync(h,m){throw new Error("Method not implemented.")}dispose(){return v(this,void 0,void 0,(function*(){yield this.workspaceService.registerServicesAsync([w.vsls.FileService.name],w.vsls.CollectionChangeType.Remove);for(const h of this.disposables)h.dispose();this.disposables=[]}))}}m.FileService=FileService;const fileNotfound=h=>({path:h,exists:!1})},function(h,m,y){"use strict";var v=this&&this.__awaiter||function(h,m,y,v){return new(y||(y=Promise))((function(C,T){function fulfilled(h){try{step(v.next(h))}catch(h){T(h)}}function rejected(h){try{step(v.throw(h))}catch(h){T(h)}}function step(h){h.done?C(h.value):function adopt(h){return h instanceof y?h:new y((function(m){m(h)}))}(h.value).then(fulfilled,rejected)}step((v=v.apply(h,m||[])).next())}))};Object.defineProperty(m,"__esModule",{value:!0});const C=y(0),T=y(4);m.SourceEventService=class SourceEventService{constructor(){this.eventIds=new Map,this.sourceData=new Map,this.eventEmitter=new C.EventEmitter,this.serviceInfo=T.vsls.SourceEventService,this.onEvent=this.eventEmitter.event}fireEventAsync(h,m,y){return v(this,void 0,void 0,(function*(){let y=1;if(this.eventIds.has(h)){y=this.eventIds.get(h)+1}this.eventIds.set(h,y);const v={eventId:y,sourceId:h,jsonContent:m};this.eventEmitter.fire(v)}))}setSourceDataAsync(h,m,y,v){return this.sourceData.set(h,m),y?this.fireEventAsync(h,m,v):Promise.resolve()}getSourceDataAsync(h,m){return v(this,void 0,void 0,(function*(){return this.sourceData.get(h)}))}}},function(h,m,y){"use strict";var v=this&&this.__awaiter||function(h,m,y,v){return new(y||(y=Promise))((function(C,T){function fulfilled(h){try{step(v.next(h))}catch(h){T(h)}}function rejected(h){try{step(v.throw(h))}catch(h){T(h)}}function step(h){h.done?C(h.value):function adopt(h){return h instanceof y?h:new y((function(m){m(h)}))}(h.value).then(fulfilled,rejected)}step((v=v.apply(h,m||[])).next())}))};Object.defineProperty(m,"__esModule",{value:!0});const C=y(6),T=y(4),w=y(528),A=y(2);m.WorkspaceService=class WorkspaceService{constructor(h,m,y,v,A){this.workspaceServer=h,this.workspaceUserService=m,this.workspaceAccessControlService=y,this.workspaceApi=v,this.logger=A,this.registerServiceNames=new Set,this.onServicesChangedEmitter=new C.Emitter,this.onConnectionStatusChangedEmitter=new C.Emitter,this.onProgressUpdatedEmitter=new C.Emitter,this.onUserRemovedEmitter=new C.Emitter,this.onUserBlockedEmitter=new C.Emitter,this.onWorkspaceReadyForConnectionEmitter=new C.Emitter,this.serviceInfo=T.vsls.WorkspaceService,this.onServicesChanged=this.onServicesChangedEmitter.event,this.onConnectionStatusChanged=this.onConnectionStatusChangedEmitter.event,this.onProgressUpdated=this.onProgressUpdatedEmitter.event,this.onUserRemoved=this.onUserRemovedEmitter.event,this.onUserBlocked=this.onUserBlockedEmitter.event,this.onWorkspaceReadyForConnection=this.onWorkspaceReadyForConnectionEmitter.event,h.onUserProfileChanged(h=>{if(h.changeType===w.UserProfileChangeType.Closed||h.changeType===w.UserProfileChangeType.Removed){const m=h.changeType===w.UserProfileChangeType.Removed?T.vsls.WorkspaceDisconnectedReason.Requested:void 0;this.workspaceUserService.notifyUserUnjoinedWorkspaceSession(h.sessionNumber,h.userProfile,m)}})}registerServicesAsync(h,m,y){return v(this,void 0,void 0,(function*(){h.forEach(h=>{m===T.vsls.CollectionChangeType.Add?this.registerServiceNames.add(h):m===T.vsls.CollectionChangeType.Add&&this.registerServiceNames.delete(h)}),this.fireServicesChanged(h,m)}))}notiyServicesChanged(h,m){const y=new Set([...this.workspaceServer.serviceNames,...Array.from(this.registerServiceNames)]);y.delete(T.vsls.WorkspaceService.name),h.connection.sendNotification("workspace.servicesChanged",{serviceNames:[...y],changeType:m})}joinWorkspaceAsync(h,m,y){return v(this,void 0,void 0,(function*(){A.assertDefined(y,"rpc request expected"),this.logger.info(`joinWorkspace joinInfo:${JSON.stringify(h)}`);const m=yield this.workspaceServer.sharedWorkspace.getWorkspaceUserProfile(h.joiningUserSessionToken);m.clientCapabilities={extensionReadOnlySupport:!0,clientReadOnlySupport:!0},m.isAnonymous&&h.anonymousUserName&&(m.name=h.anonymousUserName);const v=y.session,C=y.connection;this.workspaceServer.addUserProfile(m,y),yield this.workspaceUserService.addGuestOrThrowRejectionAsync(v,m,h.id,C),this.notiyServicesChanged(y,T.vsls.CollectionChangeType.Add);const w=this.workspaceServer.sharedWorkspace.workspaceInfo;return{sessionNumber:v,id:w.id,name:w.name,conversationId:w.conversationId,joinUri:w.joinLink,connectionMode:T.vsls.ConnectionMode.Relay,sessions:this.workspaceServer.joinedProfiles,accessControl:this.workspaceAccessControlService.accessControl}}))}unjoinWorkspaceAsync(h,m,y){A.assertDefined(y,"rpc request expected"),this.logger.info(`unjoinWorkspace workspaceId:${h}`),this.notiyServicesChanged(y,T.vsls.CollectionChangeType.Remove);const C=y.connection;return A.defer(()=>v(this,void 0,void 0,(function*(){this.workspaceServer.removeUserProfile(C,w.UserProfileChangeType.Removed);try{yield this.workspaceServer.closeSshSession(C)}catch(h){}})),250),Promise.resolve()}getWorkspaceAsync(h,m){A.notImplemented()}listWorkspacesAsync(h,m){A.notImplemented()}createPersistentWorkspaceAsync(h,m,y){A.notImplemented()}deleteWorkspaceAsync(h,m){A.notImplemented()}renameWorkspaceAsync(h,m,y){A.notImplemented()}shareWorkspaceAsync(h,m){A.notImplemented()}createInvitationLinkAsync(h,m){return v(this,void 0,void 0,(function*(){return(yield this.workspaceApi.createInvitationLink(h)).joinLink}))}getInvitationLinksAsync(h,m){A.notImplemented()}unshareWorkspaceAsync(h,m){A.notImplemented()}beginJoinWorkspaceAsync(h,m){A.notImplemented()}canUserShareWorkspaceAsync(h,m){A.notImplemented()}canUserHostWorkspaceAsync(h,m){A.notImplemented()}createPublicInviteLinkAsync(h,m){A.notImplemented()}disconnectGuestAsync(h,m,y){A.notImplemented()}unjoinOnlineEnvironmentsGuestsAsync(h,m){A.notImplemented()}setWorkspaceReadyForConnectionAsync(h,m){A.notImplemented()}updateWorkspaceOwnerAsync(h,m,y,v){A.notImplemented()}fireServicesChanged(h,m){this.onServicesChangedEmitter.fire({serviceNames:h,changeType:m})}fireConnectionStatusChanged(h,m){this.onConnectionStatusChangedEmitter.fire({connectionStatus:h,disconnectedReason:m})}}},function(h,m,y){"use strict";var v=this&&this.__awaiter||function(h,m,y,v){return new(y||(y=Promise))((function(C,T){function fulfilled(h){try{step(v.next(h))}catch(h){T(h)}}function rejected(h){try{step(v.throw(h))}catch(h){T(h)}}function step(h){h.done?C(h.value):function adopt(h){return h instanceof y?h:new y((function(m){m(h)}))}(h.value).then(fulfilled,rejected)}step((v=v.apply(h,m||[])).next())}))},C=this&&this.__importStar||function(h){if(h&&h.__esModule)return h;var m={};if(null!=h)for(var y in h)Object.hasOwnProperty.call(h,y)&&(m[y]=h[y]);return m.default=h,m};Object.defineProperty(m,"__esModule",{value:!0});const T=y(4),w=C(y(6)),A=y(143),P=y(16),k=y(2),R=y(1256),M=y(1257);var N;!function(h){h[h.None=0]="None",h[h.Added=1]="Added",h[h.Removed=2]="Removed",h[h.Closed=3]="Closed"}(N=m.UserProfileChangeType||(m.UserProfileChangeType={}));class WorkspaceServer extends A.SshRpcServer{constructor(h,m,...y){super(h.hostPrivateKeys,m),this.sharedWorkspace=h,this.joinedProfiles={},this.joinedRpcSessions=new Map,this.onUserProfileChangedEmitter=new w.Emitter,this.onUserProfileChanged=this.onUserProfileChangedEmitter.event,this.onUserAuthenticate(y=>v(this,void 0,void 0,(function*(){let v=null;try{v=yield h.getWorkspaceUserProfile(y)}catch(h){m.error("Failed to get user profile",h)}return v}))),this.onSessionClosed(h=>this.removeUserProfile(h,N.Closed));const C=h.workspaceInfo,A={joinWorkspaceAsync:(m,y,w)=>v(this,void 0,void 0,(function*(){k.assertDefined(w,"rpc request expected");const y=yield h.getWorkspaceUserProfile(m.joiningUserSessionToken),v=w.session;return this.addUserProfile(y,w),{sessionNumber:v,id:C.id,name:C.name,conversationId:C.conversationId,joinUri:C.joinLink,connectionMode:T.vsls.ConnectionMode.Relay,sessions:this.joinedProfiles,accessControl:{defaultAccessControl:{isReadOnly:!1},userAccessControl:{}}}})),unjoinWorkspaceAsync:(h,m,y)=>{const C=y.connection;return k.defer(()=>v(this,void 0,void 0,(function*(){yield this.closeSshSession(C)})),5),Promise.resolve()}};this.registerRpcService(A,T.vsls.WorkspaceService,void 0,!1);const P={exchangeVersionsAsync:(h,m,y)=>Promise.resolve({version:"1.0"})};this.registerRpcService(P,T.vsls.ConfigurationService,void 0,!1);const D=new R.StreamManagerService(this,h,m.createChild("StreamManagerService"));this.registerStreamProvider=h=>{D.registerProvider(h)},this.registerRpcService(D,T.vsls.StreamManagerService);const I=new M.StreamService(D,m.createChild("StreamService"));this.registerRpcService(I,T.vsls.StreamService),y.forEach(h=>this.registerRpcService(h[0],h[1]))}get userProfiles(){return this.joinedProfiles}isHost(h){const m=this.userProfiles[h.toString()];return!0===(null==m?void 0:m.isHost)}isOwner(h){const m=this.userProfiles[h.toString()];return!0===(null==m?void 0:m.isOwner)}assertIsHost(h){k.assertDefined(h,P.rpcContextExpectedMessage),k.assert(this.isHost(h.session),"Rpc context is not the host session")}addUserProfile(h,m){const y=m.session;this.trace.info(`Adding user name:'${h.userName}' with session number ${y}`),this.joinedRpcSessions.set(m.connection,y),this.joinedProfiles[y]=h,this.onUserProfileChangedEmitter.fire({sessionNumber:y,changeType:N.Added,userProfile:h})}removeUserProfile(h,m){const y=this.joinedRpcSessions.get(h);if(y)return this.joinedRpcSessions.delete(h),[y,this.removeJoinedProfile(y,m)]}removeJoinedProfile(h,m){const y=this.joinedProfiles[h];if(y)return this.trace.info(`Removing user ${y.name} with session number ${h}`),delete this.joinedProfiles[h],this.onUserProfileChangedEmitter.fire({sessionNumber:h,changeType:m,userProfile:y}),y}}m.WorkspaceServer=WorkspaceServer},function(h,m,y){"use strict";var v=this&&this.__awaiter||function(h,m,y,v){return new(y||(y=Promise))((function(C,T){function fulfilled(h){try{step(v.next(h))}catch(h){T(h)}}function rejected(h){try{step(v.throw(h))}catch(h){T(h)}}function step(h){h.done?C(h.value):function adopt(h){return h instanceof y?h:new y((function(m){m(h)}))}(h.value).then(fulfilled,rejected)}step((v=v.apply(h,m||[])).next())}))},C=this&&this.__importStar||function(h){if(h&&h.__esModule)return h;var m={};if(null!=h)for(var y in h)Object.hasOwnProperty.call(h,y)&&(m[y]=h[y]);return m.default=h,m};Object.defineProperty(m,"__esModule",{value:!0});const T=C(y(29)),w=y(16);m.StreamManagerService=class StreamManagerService{constructor(h,m,y){this.sshRpcServer=h,this.sharedWorkspace=m,this.logger=y,this.streamProviderMap=new Map,this.streamIdMap=new Map,this.streamsInRpcSession=new Map}getStreamAsync(h,m,y,C){return v(this,void 0,void 0,(function*(){w.assertRpcRequestContext(C),this.logger.verbose(`get stream name:${h} condition:${m}`);const v=this.streamProviderMap.get(h);if(!v)return null;const A=yield v.getStream(C.session,m,y);if(!A)return null;this.streamIdMap.set(A[0],A[1]);let P=this.streamsInRpcSession.get(C.connection);if(!P){P=[],this.streamsInRpcSession.set(C.connection,P);const y=this.sshRpcServer.getSshSession(C.connection);if(y){const v=y.onChannelOpening(y=>{if(y.channel.channelType===T.SshChannel.sessionChannelType){const v=y.channel,C=v.onClosed(()=>{C.dispose(),T.dispose()}),T=v.onRequest(y=>{var w;if(C.dispose(),T.dispose(),(null===(w=y.requestType)||void 0===w?void 0:w.startsWith("stream-transport-"))&&!y.isAuthorized){const C=y.requestType.substring("stream-transport-".length),T=this.streamIdMap.get(C);if(!T)return;this.logger.verbose(`->forwardChannel stream name:${h} condition:${m}`),this.forwardChannel(T,v),y.isAuthorized=!0}})}}),w=C.connection.onDispose(()=>{w.dispose(),v.dispose(),this.streamsInRpcSession.delete(C.connection)})}}return-1===P.indexOf(A[0])&&A.push(A[0]),A[0]}))}registerProvider(h){this.logger.verbose(`->registerProvider name:${h.streamName}`),h.initialize&&h.initialize(this.sharedWorkspace),this.streamProviderMap.set(h.streamName,h),h.streams&&h.streams.forEach(h=>this.streamIdMap.set(h[0],h[1]))}getStreamOrDefault(h){return this.streamIdMap.get(h)}disposeStream(h,m){return v(this,void 0,void 0,(function*(){this.logger.verbose(`->disposeStream id:${h}`);const y=this.getStreamOrDefault(h);if(y){yield y.dispose(),this.streamIdMap.delete(h);const v=this.streamsInRpcSession.get(m.connection),C=null==v?void 0:v.indexOf(h);C&&(v.splice(C,1),0===(null==v?void 0:v.length)&&this.streamsInRpcSession.delete(m.connection))}}))}forwardChannel(h,m){h.onDataReceived(y=>{y=Buffer.from(y),m.send(y).then(()=>{h.adjustWindow(y.length)},h=>{this.logger.error("Error sending channel data: "+h.message,h)})}),m.onDataReceived(y=>{y=Buffer.from(y),h.send(y).then(()=>{m.adjustWindow(y.length)},h=>{this.logger.error("Error sending channel data: "+h.message,h)})}),h.onClosed(h=>{m.close().catch(h=>{this.logger.error("Failed to close ssh channel")})}),m.onClosed(m=>{h.close().catch(h=>{this.logger.error("Failed to close local channel")})})}}},function(h,m,y){"use strict";var v=this&&this.__awaiter||function(h,m,y,v){return new(y||(y=Promise))((function(C,T){function fulfilled(h){try{step(v.next(h))}catch(h){T(h)}}function rejected(h){try{step(v.throw(h))}catch(h){T(h)}}function step(h){h.done?C(h.value):function adopt(h){return h instanceof y?h:new y((function(m){m(h)}))}(h.value).then(fulfilled,rejected)}step((v=v.apply(h,m||[])).next())}))};Object.defineProperty(m,"__esModule",{value:!0});const C=y(2),T=y(16);m.StreamService=class StreamService{constructor(h,m){this.streamManagerService=h,this.logger=m,this.streamBuffers=new Map}getStreamTraitsAsync(h,m){return v(this,void 0,void 0,(function*(){const m=this.getStream(h);return(!1!==m.canRead?1:0)|(!1!==m.canWrite?2:0)}))}getLengthAsync(h,m){C.notImplemented()}setLengthAsync(h,m,y){C.notImplemented()}seekAsync(h,m,y,v){C.notImplemented()}readBytesAsync(h,m,y){return v(this,void 0,void 0,(function*(){const v=this.getStream(h);let T=this.streamBuffers.get(h);T||(T=new StreamBuffer(v),this.streamBuffers.set(h,T),v.onClosed(()=>{this.streamBuffers.delete(h)}));const w=yield T.readBytes(m,y);if(null!==w){this.logger.verbose(`<- readBytes id:${h} length: ${w.length} crc:${C.crc32(w)}`);let m=w.toString();return m.length>0&&"x"!==m[0]&&(m="x"+w.toString("base64")),m}return null}))}writeBytesAsync(h,m,y){m.length>0&&" "===m[0]&&(m=m.substring(1));const v=Buffer.from(m);return this.logger.verbose(`-> writeBytes id:${h} length: ${v.length} crc:${C.crc32(v)}`),this.getStream(h).send(v,y)}disposeStreamAsync(h,m,y){return T.assertRpcRequestContext(y),this.streamManagerService.disposeStream(h,y)}getStream(h){const m=this.streamManagerService.getStreamOrDefault(h);if(!m)throw new Error(`Stream id:${h} not found`);return m}};class StreamBuffer{constructor(h){this.stream=h,this.buffer=null,this.dataReceived=null;const m=[];m.push(h.onDataReceived(h=>{this.dataReceived?(this.dataReceived.resolve(h),this.dataReceived=null):this.buffer?this.buffer=Buffer.concat([this.buffer,h]):this.buffer=Buffer.from(h)})),m.push(this.stream.onClosed(h=>{m.forEach(h=>h.dispose()),this.dataReceived&&this.dataReceived.resolve(null)}))}readBytes(h,m){return v(this,void 0,void 0,(function*(){if(this.buffer){if(this.buffer.length<h){const h=this.buffer;return this.buffer=null,h}{const m=this.buffer.slice(0,h);return this.buffer=this.buffer.slice(h),m}}return this.dataReceived=new C.Signal(m),yield this.dataReceived.promise}))}}},function(h,m,y){"use strict";var v=this&&this.__awaiter||function(h,m,y,v){return new(y||(y=Promise))((function(C,T){function fulfilled(h){try{step(v.next(h))}catch(h){T(h)}}function rejected(h){try{step(v.throw(h))}catch(h){T(h)}}function step(h){h.done?C(h.value):function adopt(h){return h instanceof y?h:new y((function(m){m(h)}))}(h.value).then(fulfilled,rejected)}step((v=v.apply(h,m||[])).next())}))};Object.defineProperty(m,"__esModule",{value:!0});const C=y(6),T=y(4),w=y(2);class GuestSession{constructor(h,m,y,v,C){this.rpcSession=h,this.userProfile=m,this.joinId=y,this.resolveRequestPromise=v,this.rejectRequestPromise=C,this.blocked=!1,this.removed=!1,this.rejected=!1}block(){this.blocked=!0}remove(){this.removed=!0}reject(){this.rejected=!0}get isBlocked(){return this.blocked}get isRemoved(){return this.removed}get isRejected(){return this.rejected}}var A;!function(h){h[h.SUCCESS=0]="SUCCESS",h[h.REJECTED=1]="REJECTED",h[h.CANCELLED=2]="CANCELLED"}(A||(A={}));function isSameUser(h,m,y){return h.isAnonymous?h.id===y.userProfile.id&&m===y.joinId:h.name===y.userProfile.name&&h.email===y.userProfile.email&&m===y.joinId}m.WorkspaceUserService=class WorkspaceUserService{constructor(h){this.disconnect=h,this.onWorkspaceSessionChangedEmitter=new C.Emitter,this.serviceInfo=T.vsls.WorkspaceUserService,this.onWorkspaceSessionChanged=this.onWorkspaceSessionChangedEmitter.event,this.guestSessions=new Map}fireWorkspaceSessionChanged(h,m,y,v="VS Code",C){this.onWorkspaceSessionChangedEmitter.fire({changeType:h,sessionNumber:m,userProfile:y,applicationName:v,disconnectedReason:C})}acceptOrRejectGuestAsync(h,m,y){const v=this.guestSessions.get(h);return v&&(m.accept||"number"!=typeof m.errorCode||0===m.errorCode||v.rejectRequestPromise(new C.ResponseError(m.errorCode,m.message)),v.resolveRequestPromise(m.accept?A.SUCCESS:A.REJECTED)),Promise.resolve()}autoAcceptGuestsAsync(h,m){w.notImplemented()}removeUserAsync(h,m,y){const v=this.guestSessions.get(h);if(v){if(m===T.vsls.WorkspaceDisconnectedReason.SessionEnded){const h={connectionStatus:T.vsls.WorkspaceConnectionStatus.Disconnected,disconnectedReason:T.vsls.WorkspaceDisconnectedReason.SessionEnded};v.rpcSession.sendNotification(`${T.vsls.WorkspaceService.name}.connectionStatusChanged`,h)}else m===T.vsls.WorkspaceDisconnectedReason.UserBlocked?(v.block(),v.rpcSession.sendNotification(`${T.vsls.WorkspaceService.name}.userBlocked`)):(v.remove(),v.rpcSession.sendNotification(`${T.vsls.WorkspaceService.name}.userRemoved`));setTimeout(()=>this.disconnect(v.rpcSession),1e3)}}removeAllInteractiveUsersAsync(h){w.notImplemented()}fireProgressUpdatedToGuestAsync(h,m,y){const v=this.guestSessions.get(m);if(v){const m={progress:h,duration:0};v.rpcSession.sendNotification(`${T.vsls.WorkspaceService.name}.progressUpdated`,m)}return Promise.resolve()}getCountOfGuestsWithSameAccountAsync(h,m,y){w.notImplemented()}createGuestDisplayNameAsync(h,m){w.notImplemented()}getCachedGuestDisplayNameAsync(h,m){w.notImplemented()}getGuestUserProfileAsync(h,m){w.notImplemented()}getCountOfInteractiveGuestsAsync(h){w.notImplemented()}notifyUserUnjoinedWorkspaceSession(h,m,y){this.guestSessions.has(h)&&this.fireWorkspaceSessionChanged(T.vsls.WorkspaceSessionChangeType.Unjoined,h,m,"",y)}addGuestOrThrowRejectionAsync(h,m,y,w){return v(this,void 0,void 0,(function*(){let v,P;const k=new Promise((h,m)=>{v=h,P=m}),R=new GuestSession(w,m,y,v,P);let M;this.guestSessions.set(h,R),this.throwIfUserIsBlocked(m,y),this.fireWorkspaceSessionChanged(T.vsls.WorkspaceSessionChangeType.Requested,h,m);try{M=yield k}catch(y){throw this.cancelGuestJoin(h,m),y}if(M===A.REJECTED)throw R.reject(),new C.ResponseError(T.vsls.ErrorCodes.CollaborationSessionGuestRejected,"Rejected by host");if(M===A.CANCELLED)throw this.cancelGuestJoin(h,m),new C.ResponseError(T.vsls.ErrorCodes.CollaborationSessionGuestCanceled,"Join request canceled");M===A.SUCCESS&&this.fireWorkspaceSessionChanged(T.vsls.WorkspaceSessionChangeType.Joined,h,m)}))}cancelGuestJoin(h,m){this.fireWorkspaceSessionChanged(T.vsls.WorkspaceSessionChangeType.Canceled,h,m),this.guestSessions.delete(h)}throwIfUserIsBlocked(h,m){for(let y of this.guestSessions.values())if(isSameUser(h,m,y)&&(y.isBlocked||y.isRejected))throw new C.ResponseError(T.vsls.ErrorCodes.CollaborationSessionGuestBlocked,"Already blocked by host")}}},function(h,m,y){"use strict";var v=this&&this.__awaiter||function(h,m,y,v){return new(y||(y=Promise))((function(C,T){function fulfilled(h){try{step(v.next(h))}catch(h){T(h)}}function rejected(h){try{step(v.throw(h))}catch(h){T(h)}}function step(h){h.done?C(h.value):function adopt(h){return h instanceof y?h:new y((function(m){m(h)}))}(h.value).then(fulfilled,rejected)}step((v=v.apply(h,m||[])).next())}))};Object.defineProperty(m,"__esModule",{value:!0});const C=y(6),T=y(4),w=y(16),A=y(17),P=y(8),k=y(243),R={name:"setWorkspaceAccessControl",enabledInReadOnlySession:!0,ownerOnly:!0},M={name:"rejectRestrictedOperation",enabledInReadOnlySession:!0,ownerOnly:!0},N={name:"setRestrictedOperationAccess",enabledInReadOnlySession:!0,ownerOnly:!0};m.WorkspaceAccessControlService=class WorkspaceAccessControlService{constructor(h){this.userAccessControl={},this.defaultAccessControl={isReadOnly:!1},this.onAccessControlChangedEmitter=new C.Emitter,this.onOperationRejectedEmitter=new C.Emitter,this.onOperationAccessChangedEmitter=new C.Emitter,this.onOpeationAccessRequestedEmitter=new C.Emitter,this.serviceInfo=T.vsls.WorkspaceAccessControlService,this.onAccessControlChanged=this.onAccessControlChangedEmitter.event,this.onOperationRejected=this.onOperationRejectedEmitter.event,this.onOperationAccessChanged=this.onOperationAccessChangedEmitter.event,this.onOpeationAccessRequested=this.onOpeationAccessRequestedEmitter.event,this.operationAccessCheck=new OperationAccessCheck(this,h)}setAccessControlAsync(h,m,y){return v(this,void 0,void 0,(function*(){w.assertRpcRequestContext(y),this.operationAccessCheck.verifyCanPerformOperation(y.session,R),this.userAccessControl=h.userAccessControl,this.defaultAccessControl=h.defaultAccessControl,this.onAccessControlChangedEmitter.fire({accessControl:h})}))}requestOperationAccessAsync(h,m,y){return v(this,void 0,void 0,(function*(){new P.TelemetryEvent(A.TelemetryEventNames.REQUEST_RESTRICTED_OPERATION).addProperty(A.TelemetryPropertyNames.OPERATION_NAME,h.name).send(),this.onOpeationAccessRequestedEmitter.fire({sessionId:y.session,operation:h})}))}setOperationAccessAsync(h,m,y,C){return v(this,void 0,void 0,(function*(){w.assertRpcRequestContext(C),this.operationAccessCheck.verifyCanPerformOperation(C.session,N),new P.TelemetryEvent(A.TelemetryEventNames.SET_RESTRICTED_OPERATION_ACCESS).addProperty(A.TelemetryPropertyNames.OPERATION_NAME,h.name).addProperty(A.TelemetryPropertyNames.OPERATION_ACCESS,m).send(),this.onOperationAccessChangedEmitter.fire({operation:h,access:m})}))}rejectOperationAsync(h,m,y,C){return v(this,void 0,void 0,(function*(){w.assertRpcRequestContext(C),this.operationAccessCheck.verifyCanPerformOperation(C.session,M),this.onOperationRejectedEmitter.fire({operation:h,access:m})}))}get accessControl(){return{defaultAccessControl:this.defaultAccessControl,userAccessControl:this.userAccessControl}}getAccessControlAsync(h){return v(this,void 0,void 0,(function*(){return this.accessControl}))}};class OperationAccessCheck extends k.ClientAccessCheck{get isReadOnly(){return!1}logRejectedOperation(h,m){return Promise.resolve()}}},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0});const v=y(0),C=y(4),T=y(32),w=y(26),A=y(37);m.AccessControlService=class AccessControlService{constructor(h){var m,y;this.accessControlChangedEmitter=new v.EventEmitter,this.onAccessControlChanged=this.accessControlChangedEmitter.event,this.serviceInfo=C.vsls.AccessControlService;const P=w.workspaceSessionInfoTracker.workspaceSessionInfo;if(!P)throw Error("workspaceSessionInfoTracker.workspaceSessionInfo is not set");const k=null===(m=A.getExpService())||void 0===m?void 0:m.getTreatmentVariable("vscode","readWriteAnonymous"),R=k&&function getAnonymousAccessLevel(){const m=h.sessionContext().collaboratorManager;if(!m)return;const y=Object.values(null==m?void 0:m.getCollaborators()).find(h=>{var m;return h.id===(null===(m=T.userAuthStateTracker.userInfo)||void 0===m?void 0:m.id)});if(!y)return;return w.workspaceSessionInfoTracker.getAnonymousAccess(y.id)}()===w.AnonymousAccessLevel.readOnly,M=!k&&(null===(y=T.userAuthStateTracker.userInfo)||void 0===y?void 0:y.isAnonymous),N=P.accessControl,D=N.defaultAccessControl&&N.defaultAccessControl.isReadOnly,I=!!(M||D||R);this.sessionNumber=P.sessionNumber,this.accessControl=N.userAccessControl[P.sessionNumber]||{isReadOnly:I},this.setAccessControl(this.accessControl),h.workspaceAccessControlService().onAccessControlChanged(this.sessionAcs_AccessControlChanged,this)}getAccessControlAsync(){return Promise.resolve(this.accessControl)}setAccessControl(h){h.isReadOnly!==this.accessControl.isReadOnly&&(this.accessControl=h,this.accessControlChangedEmitter.fire({accessControl:h}))}sessionAcs_AccessControlChanged(h){const m=this.getUserAccessControl(h.accessControl);this.setAccessControl(m)}getUserAccessControl(h){return h.userAccessControl[this.sessionNumber]||h.defaultAccessControl}}},function(h,m,y){"use strict";var v=this&&this.__awaiter||function(h,m,y,v){return new(y||(y=Promise))((function(C,T){function fulfilled(h){try{step(v.next(h))}catch(h){T(h)}}function rejected(h){try{step(v.throw(h))}catch(h){T(h)}}function step(h){h.done?C(h.value):function adopt(h){return h instanceof y?h:new y((function(m){m(h)}))}(h.value).then(fulfilled,rejected)}step((v=v.apply(h,m||[])).next())}))};Object.defineProperty(m,"__esModule",{value:!0});const C=y(12),T=y(14),w=y(39),A=y(5);m.createWorkspaceApi=function createWorkspaceApi(h){const m=C.Settings.get(T.SettingKeys.serviceUri);return new w.WorkspaceApi(m,()=>v(this,void 0,void 0,(function*(){return(yield h.authService().getCurrentAuthenticatedUserAsync()).accessToken})),A.traceSource.withName("WorkspaceApi"))}},function(h,m,y){"use strict";var v=this&&this.__awaiter||function(h,m,y,v){return new(y||(y=Promise))((function(C,T){function fulfilled(h){try{step(v.next(h))}catch(h){T(h)}}function rejected(h){try{step(v.throw(h))}catch(h){T(h)}}function step(h){h.done?C(h.value):function adopt(h){return h instanceof y?h:new y((function(m){m(h)}))}(h.value).then(fulfilled,rejected)}step((v=v.apply(h,m||[])).next())}))};Object.defineProperty(m,"__esModule",{value:!0});const C=y(20),T=y(2),w=y(24),A=y(62),P=y(69),k=y(0),R=y(400),M=y(403);class RemoteConfig{constructor(){this.settings=null,this.updated=!1,this.updateSignal=new T.Signal}static get Instance(){return RemoteConfig.singleton||(RemoteConfig.singleton=new RemoteConfig),RemoteConfig.singleton}init(h,m,y,T){return v(this,void 0,void 0,(function*(){if(!m)throw new Error("A settings URI is required.");this.settingsFileUri=C.parse(C.resolve(m.href,"remoteSettings.json")),this.settingsFileUri.path=(m.path+"/remoteSettings.json").replace("//","/"),this.extensionVersion=w.ExtensionUtil.getExtensionVersion(A.LIVESHARE_EXTENSION_ID,!1),this.settings=yield R.loadFilefromCache(this.settingsFileUri.href),null==T||T.verbose(`Downloading remote settings from ${this.settingsFileUri.href}`);const v=yield R.initRemoteFileSubscribe(h,this.settingsFileUri.href,h=>{this.loadDownloadedSettings(h)},y,T);h&&h.subscriptions.push(v)}))}loadDownloadedSettings(h){this.settings=h,this.updated||(this.updated=!0,this.updateSignal.resolve())}get waitForUpdate(){if(!this.settingsFileUri)throw new Error("Not initialized.");return this.updateSignal.promise}getDefault(h){return this.getSettingValue(h,"default")}getOverride(h){return this.getSettingValue(h,"override")}getSettingValue(h,m){if(!this.settings)return;let y=this.settings[h];if(y){Array.isArray(y)||(y=[y]);for(let h of y){if((h.priority||"default")===m&&this.evaluateConditions(h.conditions))return h.value}}}evaluateConditions(h){if(!h)return!0;if(h.os){const m=M.getPlatform().replace("win32","win").replace("darwin","mac");if(!(h.os===m||Array.isArray(h.os)&&h.os.indexOf(m)>=0))return!1}return!(h.extensionVersion&&!P.satisfies(this.extensionVersion,h.extensionVersion))&&!(h.ideVersion&&!P.satisfies(k.version,h.ideVersion))}}const N=RemoteConfig.Instance;m.RemoteConfig=N},function(h,m,y){"use strict";var v=this&&this.__awaiter||function(h,m,y,v){return new(y||(y=Promise))((function(C,T){function fulfilled(h){try{step(v.next(h))}catch(h){T(h)}}function rejected(h){try{step(v.throw(h))}catch(h){T(h)}}function step(h){h.done?C(h.value):function adopt(h){return h instanceof y?h:new y((function(m){m(h)}))}(h.value).then(fulfilled,rejected)}step((v=v.apply(h,m||[])).next())}))};Object.defineProperty(m,"__esModule",{value:!0});const C=y(0),T=y(290);m.registerGitProvider=function registerGitProvider(h,m){try{const y=C.extensions.getExtension("vscode.git");if(y){const v=y.exports.getAPI(1);h("git",new GitProvider(v,m))}}catch(h){m.error(`Failed to register Git provider error:${h}`)}};class GitProvider extends T.ProviderBase{constructor(h,m){super(),this.api=h,this.trace=m;const y=h._model.git;if("function"!=typeof y.exec)throw new Error("Missing Git exec function");this.gitPrivate=y}requestInitialize(h){return v(this,void 0,void 0,(function*(){if(this.gitPrivate){const h=this.api.repositories;h.length>0?this.notifyRepoSuggestedUsers(h[0]):this.api.onDidOpenRepository(h=>v(this,void 0,void 0,(function*(){this.notifyRepoSuggestedUsers(h)})))}return{description:"Git",capabilities:{supportsDispose:!1,supportsInviteLink:!1,supportsPresence:!1,supportsContactPresenceRequest:!1,supportsPublishPresence:!1}}}))}notifyRepoSuggestedUsers(h){return v(this,void 0,void 0,(function*(){this.getAuthors(h).then(h=>{this.notifySuggestedUsers(h.map(h=>({id:h.email,displayName:h.author,email:h.email})))})}))}getAuthors(h){return v(this,void 0,void 0,(function*(){const m=new Date,y=new Set,C=[],T=(yield this.gitExec(h,["config","--global","user.email"])).trim(),w=(yield this.gitExec(h,["config","--global","user.name"])).trim();let A=0;if(yield h.status(),h.state&&h.state.HEAD){const processCommit=P=>v(this,void 0,void 0,(function*(){if(!P||A>75||y.size>10)return;const v=yield this.getAuthorInfo(h,P);if(v.timestamp){const h=Math.abs(m.getTime()-v.timestamp.getTime());if(Math.ceil(h/864e5)>30)return}v.email===T||v.author===w||!v.email||y.has(v.email)||v.email.includes("@users.noreply.github.com")||(y.add(v.email),C.push(v)),++A;const{parents:k}=yield h.getCommit(P);k.length>0&&(yield Promise.all(k.map(h=>processCommit(h))))}));yield processCommit(h.state.HEAD.commit)}return C}))}getAuthorInfo(h,m){return v(this,void 0,void 0,(function*(){const y=yield this.gitExec(h,["show","-s","--format=%an <%ae> [%ai]",m]),v=y.substr(0,y.indexOf("<")).trim();let C=void 0;const T=y.match(/\<(.*?)\>/);T&&(C=T[1]);let w=void 0;const A=y.match(/\[(.*?)\]/);return A&&2===A.length&&(w=new Date(A[1])),{email:C,author:v,timestamp:w}}))}gitExec(h,m){return v(this,void 0,void 0,(function*(){const y=this.gitPrivate.exec(h.rootUri.fsPath,m);try{return(yield y).stdout}catch(h){throw this.trace.error(`gitExec:err:${h}`),h}}))}}},function(h,m,y){"use strict";var v=this&&this.__awaiter||function(h,m,y,v){return new(y||(y=Promise))((function(C,T){function fulfilled(h){try{step(v.next(h))}catch(h){T(h)}}function rejected(h){try{step(v.throw(h))}catch(h){T(h)}}function step(h){h.done?C(h.value):function adopt(h){return h instanceof y?h:new y((function(m){m(h)}))}(h.value).then(fulfilled,rejected)}step((v=v.apply(h,m||[])).next())}))};Object.defineProperty(m,"__esModule",{value:!0});const C=y(290),T=y(3);m.registerSelfInviteProvider=function registerSelfInviteProvider(h,m,y){m("selfInvite",new SelfInviteProvider(h,y))};class SelfInviteProvider extends C.ProviderBase{constructor(h,m){super(),T.sessionStateTracker.onStateChanged(y=>v(this,void 0,void 0,(function*(){y.newState!==T.SessionState.SignedOut&&y.newState!==T.SessionState.SignedIn||this.notifySelfSuggestion(h,y.newState===T.SessionState.SignedIn,m)}))),T.sessionStateTracker.State===T.SessionState.SignedIn&&this.notifySelfSuggestion(h,!0,m)}requestInitialize(h){return v(this,void 0,void 0,(function*(){return{description:"Self invite provider",capabilities:{supportsDispose:!1,supportsInviteLink:!1,supportsPresence:!1,supportsContactPresenceRequest:!1,supportsPublishPresence:!1}}}))}notifySelfSuggestion(h,m,y){return v(this,void 0,void 0,(function*(){const v=[];if(m){const m=yield h.getCurrentUserAsync();m&&v.push({id:m.id,displayName:m.displayName,email:m.emailAddress})}y.verbose(`SelfInviteProvider-> status:${v.length>0}`),this.notifySuggestedUsers(v)}))}}},function(h,m,y){"use strict";var v=this&&this.__awaiter||function(h,m,y,v){return new(y||(y=Promise))((function(C,T){function fulfilled(h){try{step(v.next(h))}catch(h){T(h)}}function rejected(h){try{step(v.throw(h))}catch(h){T(h)}}function step(h){h.done?C(h.value):function adopt(h){return h instanceof y?h:new y((function(m){m(h)}))}(h.value).then(fulfilled,rejected)}step((v=v.apply(h,m||[])).next())}))};Object.defineProperty(m,"__esModule",{value:!0});const C=y(0),T=y(5),w=y(3),A=y(4);class IdlePresenceStatus extends T.VscodeSessionStatusProvider{constructor(h,m){super(h.createChild("idle-status-provider"),m),this.presenseStatusChangedEvent=new C.EventEmitter,w.sessionStateTracker.onStateChanged(h=>v(this,void 0,void 0,(function*(){this.reset()}))),this.onSessionStatusChanged(h=>{h===T.VscodeSessionStatus.Active?this.presenseStatusChangedEvent.fire(A.contactProtocol.PresenceStatus.Available):h===T.VscodeSessionStatus.Idle&&this.presenseStatusChangedEvent.fire(A.contactProtocol.PresenceStatus.Away)})}get id(){return"idle"}get status(){switch(this.sessionStatus){case T.VscodeSessionStatus.Idle:return A.contactProtocol.PresenceStatus.Away;default:return A.contactProtocol.PresenceStatus.Available}}get priority(){return 10}get onStatusChanged(){return this.presenseStatusChangedEvent.event}reset(){super.reset()}}m.IdlePresenceStatus=IdlePresenceStatus},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0});const v=y(1267),C=y(1268),T=y(1269),w=y(1270),A=y(1271),P=y(1272),k=y(1273),R=y(1274),M=y(1275),N=y(1276),D=y(1277);m.registerCommands=h=>{h.register("inviteUserJoin",v.builder),h.register("inviteUserJoinByEmail",C.builder),h.register("inviteNoUserJoinByEmail",T.builder),h.register("removeRecentContact",w.builder),h.register("inviteAvailableContacts",A.builder),h.register("selectPresenceProvider",P.builder),h.register("inviteSearchContacts",k.builder),h.register("changeSelfPresenceFromAvailable",R.builder),h.register("changeSelfPresenceFromAway",R.builder),h.register("changeSelfPresenceFromBusy",R.builder),h.register("changeSelfPresenceFromDoNotDisturb",R.builder),h.register("signInPresence",N.builder),h.register("signOutPresence",D.builder),h.register("changePresenceAvailable",M.builder),h.register("changePresenceBusy",M.builder),h.register("changePresenceDoNotDisturb",M.builder),h.register("changePresenceAway",M.builder),h.register("changePresenceInvisible",M.builder)}},function(h,m,y){"use strict";var v=this&&this.__decorate||function(h,m,y,v){var C,T=arguments.length,w=T<3?m:null===v?v=Object.getOwnPropertyDescriptor(m,y):v;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)w=Reflect.decorate(h,m,y,v);else for(var A=h.length-1;A>=0;A--)(C=h[A])&&(w=(T<3?C(w):T>3?C(m,y,w):C(m,y))||w);return T>3&&w&&Object.defineProperty(m,y,w),w},C=this&&this.__awaiter||function(h,m,y,v){return new(y||(y=Promise))((function(C,T){function fulfilled(h){try{step(v.next(h))}catch(h){T(h)}}function rejected(h){try{step(v.throw(h))}catch(h){T(h)}}function step(h){h.done?C(h.value):function adopt(h){return h instanceof y?h:new y((function(m){m(h)}))}(h.value).then(fulfilled,rejected)}step((v=v.apply(h,m||[])).next())}))};Object.defineProperty(m,"__esModule",{value:!0});const T=y(111),w=y(3);m.builder=function builder(){return new A};let A=class InviteContactCommand{invoke(h,m){return C(this,void 0,void 0,(function*(){return m.telemetryEvent.addProperty(w.TelemetryPropertyNames.INVITE_CONTACT_TYPE,h.options.type),T.ContactCommandUtilities.inviteHelper(h.contactModel)}))}};A=v([w.telemetryCommandDecorator(w.TelemetryEventNames.INVITE_CONTACT,w.TelemetryEventNames.INVITE_CONTACT_FAULT,"InviteContact",1)],A)},function(h,m,y){"use strict";var v=this&&this.__decorate||function(h,m,y,v){var C,T=arguments.length,w=T<3?m:null===v?v=Object.getOwnPropertyDescriptor(m,y):v;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)w=Reflect.decorate(h,m,y,v);else for(var A=h.length-1;A>=0;A--)(C=h[A])&&(w=(T<3?C(w):T>3?C(m,y,w):C(m,y))||w);return T>3&&w&&Object.defineProperty(m,y,w),w},C=this&&this.__awaiter||function(h,m,y,v){return new(y||(y=Promise))((function(C,T){function fulfilled(h){try{step(v.next(h))}catch(h){T(h)}}function rejected(h){try{step(v.throw(h))}catch(h){T(h)}}function step(h){h.done?C(h.value):function adopt(h){return h instanceof y?h:new y((function(m){m(h)}))}(h.value).then(fulfilled,rejected)}step((v=v.apply(h,m||[])).next())}))};Object.defineProperty(m,"__esModule",{value:!0});const T=y(111),w=y(3);m.builder=function builder(){return new A};let A=class InviteContactByEmailCommand{invoke(h,m){return C(this,void 0,void 0,(function*(){return T.ContactCommandUtilities.inviteByEmail(h.contactModel.contact.email,h.contactModel.contact.displayName)}))}};A=v([w.telemetryCommandDecorator(w.TelemetryEventNames.INVITE_CONTACT_BY_EMAIL,w.TelemetryEventNames.INVITE_CONTACT_BY_EMAIL_FAULT,"InviteContactByEmail",1)],A)},function(h,m,y){"use strict";var v=this&&this.__decorate||function(h,m,y,v){var C,T=arguments.length,w=T<3?m:null===v?v=Object.getOwnPropertyDescriptor(m,y):v;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)w=Reflect.decorate(h,m,y,v);else for(var A=h.length-1;A>=0;A--)(C=h[A])&&(w=(T<3?C(w):T>3?C(m,y,w):C(m,y))||w);return T>3&&w&&Object.defineProperty(m,y,w),w},C=this&&this.__awaiter||function(h,m,y,v){return new(y||(y=Promise))((function(C,T){function fulfilled(h){try{step(v.next(h))}catch(h){T(h)}}function rejected(h){try{step(v.throw(h))}catch(h){T(h)}}function step(h){h.done?C(h.value):function adopt(h){return h instanceof y?h:new y((function(m){m(h)}))}(h.value).then(fulfilled,rejected)}step((v=v.apply(h,m||[])).next())}))};Object.defineProperty(m,"__esModule",{value:!0});const T=y(111),w=y(3);m.builder=function builder(){return new A};let A=class InviteNoContactByEmailCommand{invoke(h,m){return C(this,void 0,void 0,(function*(){return T.ContactCommandUtilities.inviteByEmail("","")}))}};A=v([w.telemetryCommandDecorator(w.TelemetryEventNames.INVITE_NO_CONTACT_BY_EMAIL,w.TelemetryEventNames.INVITE_NO_CONTACT_BY_EMAIL_FAULT,"InviteNoContactByEmail",1)],A)},function(h,m,y){"use strict";var v=this&&this.__decorate||function(h,m,y,v){var C,T=arguments.length,w=T<3?m:null===v?v=Object.getOwnPropertyDescriptor(m,y):v;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)w=Reflect.decorate(h,m,y,v);else for(var A=h.length-1;A>=0;A--)(C=h[A])&&(w=(T<3?C(w):T>3?C(m,y,w):C(m,y))||w);return T>3&&w&&Object.defineProperty(m,y,w),w},C=this&&this.__awaiter||function(h,m,y,v){return new(y||(y=Promise))((function(C,T){function fulfilled(h){try{step(v.next(h))}catch(h){T(h)}}function rejected(h){try{step(v.throw(h))}catch(h){T(h)}}function step(h){h.done?C(h.value):function adopt(h){return h instanceof y?h:new y((function(m){m(h)}))}(h.value).then(fulfilled,rejected)}step((v=v.apply(h,m||[])).next())}))};Object.defineProperty(m,"__esModule",{value:!0});const T=y(3),w=y(58);m.builder=function builder(){return new A};let A=class RemoveRecentContactCommand{invoke(h,m){return C(this,void 0,void 0,(function*(){return yield w.ContactManager.removeRecentContact(h.contactModel)}))}};A=v([T.telemetryCommandDecorator(T.TelemetryEventNames.REMOVE_RECENT_CONTACT,T.TelemetryEventNames.REMOVE_RECENT_CONTACT_FAULT,"RemoveRecentContact",1)],A)},function(h,m,y){"use strict";var v=this&&this.__decorate||function(h,m,y,v){var C,T=arguments.length,w=T<3?m:null===v?v=Object.getOwnPropertyDescriptor(m,y):v;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)w=Reflect.decorate(h,m,y,v);else for(var A=h.length-1;A>=0;A--)(C=h[A])&&(w=(T<3?C(w):T>3?C(m,y,w):C(m,y))||w);return T>3&&w&&Object.defineProperty(m,y,w),w},C=this&&this.__awaiter||function(h,m,y,v){return new(y||(y=Promise))((function(C,T){function fulfilled(h){try{step(v.next(h))}catch(h){T(h)}}function rejected(h){try{step(v.throw(h))}catch(h){T(h)}}function step(h){h.done?C(h.value):function adopt(h){return h instanceof y?h:new y((function(m){m(h)}))}(h.value).then(fulfilled,rejected)}step((v=v.apply(h,m||[])).next())}))};Object.defineProperty(m,"__esModule",{value:!0});const T=y(0),w=y(3),A=y(4),P=y(191),k=y(58),R=y(144),M=y(111);m.builder=function builder(){return new N};let N=class InviteAvailableContactsCommand{invoke(h,m){return C(this,void 0,void 0,(function*(){const h=k.ContactManager.getAllAvailableContacts(h=>h.contact.status!==A.contactProtocol.PresenceStatus.Unknown&&h.contact.status!==A.contactProtocol.PresenceStatus.Offline).sort(P.defaultCompareContacts),m=h.map(h=>`${h.contact.displayName?h.contact.displayName:h.contact.id} (${R.ContactsProviderViewlet.getPresenceStatusName(h)})`),y=yield T.window.showQuickPick(m,{placeHolder:"Select a contact to invite:"});if(!y)return;const v=h[m.indexOf(y)];return yield M.ContactCommandUtilities.inviteHelper(v)}))}};N=v([w.telemetryCommandDecorator(w.TelemetryEventNames.INVITE_AVAILABLE_CONTACTS,w.TelemetryEventNames.INVITE_AVAILABLE_CONTACTS_FAULT,"InviteAvailableContacts",1)],N)},function(h,m,y){"use strict";var v=this&&this.__decorate||function(h,m,y,v){var C,T=arguments.length,w=T<3?m:null===v?v=Object.getOwnPropertyDescriptor(m,y):v;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)w=Reflect.decorate(h,m,y,v);else for(var A=h.length-1;A>=0;A--)(C=h[A])&&(w=(T<3?C(w):T>3?C(m,y,w):C(m,y))||w);return T>3&&w&&Object.defineProperty(m,y,w),w},C=this&&this.__awaiter||function(h,m,y,v){return new(y||(y=Promise))((function(C,T){function fulfilled(h){try{step(v.next(h))}catch(h){T(h)}}function rejected(h){try{step(v.throw(h))}catch(h){T(h)}}function step(h){h.done?C(h.value):function adopt(h){return h instanceof y?h:new y((function(m){m(h)}))}(h.value).then(fulfilled,rejected)}step((v=v.apply(h,m||[])).next())}))};Object.defineProperty(m,"__esModule",{value:!0});const T=y(0),w=y(3),A=y(58);m.builder=function builder(){return new P};let P=class SelectPresenceProviderCommand{invoke(h){return C(this,void 0,void 0,(function*(){const h=A.ContactManager.serviceProviders.filter(h=>h.capabilites.supportsContactPresenceRequest).sort((h,m)=>h.priority>m.priority?-1:h.priority<m.priority?1:0);if(h.length>0){const m=A.ContactManager.selectedPreferedProviderId,y=h.map(h=>(h.serviceId===m?"$(check) ":"")+h.descriptionName),v=yield T.window.showQuickPick(y,{placeHolder:w.localize("selectPresenceProviderCommand.placeHolder")});if(v){const m=h[y.indexOf(v)];A.ContactManager.setPreferedPresenceProvider(m)}}}))}};P=v([w.telemetryCommandDecorator(w.TelemetryEventNames.SELECT_PRESENCE_PROVIDER,w.TelemetryEventNames.SELECT_PRESENCE_PROVIDER_FAULT,"SelectPresenceProvider",1)],P)},function(h,m,y){"use strict";var v=this&&this.__decorate||function(h,m,y,v){var C,T=arguments.length,w=T<3?m:null===v?v=Object.getOwnPropertyDescriptor(m,y):v;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)w=Reflect.decorate(h,m,y,v);else for(var A=h.length-1;A>=0;A--)(C=h[A])&&(w=(T<3?C(w):T>3?C(m,y,w):C(m,y))||w);return T>3&&w&&Object.defineProperty(m,y,w),w},C=this&&this.__awaiter||function(h,m,y,v){return new(y||(y=Promise))((function(C,T){function fulfilled(h){try{step(v.next(h))}catch(h){T(h)}}function rejected(h){try{step(v.throw(h))}catch(h){T(h)}}function step(h){h.done?C(h.value):function adopt(h){return h instanceof y?h:new y((function(m){m(h)}))}(h.value).then(fulfilled,rejected)}step((v=v.apply(h,m||[])).next())}))};Object.defineProperty(m,"__esModule",{value:!0});const T=y(0),w=y(111),A=y(3),P=y(4),k=y(58),R=y(191),M=y(144);m.builder=function builder(){return new N};let N=class InviteSearchContactsCommand{invoke(){return C(this,void 0,void 0,(function*(){const h=[];try{return yield new Promise((m,y)=>{const v=T.window.createQuickPick();v.placeholder=A.localize("searchContacts.placeholder");let C=null;h.push(v.onDidChangeValue(h=>{C&&C.cancel(),h?(v.busy=!0,C=new T.CancellationTokenSource,k.ContactManager.searchContacts([{property:P.contactProtocol.ContactProperty.DisplayName,expression:`^${h}`,options:1}],100,C.token).then(h=>{v.items=h.sort(R.defaultCompareContacts).map(h=>new ContactItem(h)),v.busy=!1})):v.items=[]}),v.onDidChangeSelection(h=>{const y=h[0];y instanceof ContactItem&&(w.ContactCommandUtilities.inviteHelper(y.contactModel).then(h=>m(h)),v.hide())}),v.onDidHide(()=>{C&&C.cancel(),m(!1),v.dispose()})),v.show()})}finally{h.forEach(h=>h.dispose())}}))}};N=v([A.telemetryCommandDecorator(A.TelemetryEventNames.INVITE_SEARCH_CONTACTS,A.TelemetryEventNames.INVITE_SEARCH_CONTACTS_FAULT,"InviteSearchContactsCommand",1)],N);class ContactItem{constructor(h){this.contactModel=h,this.label=`${h.contact.displayName} (${M.ContactsProviderViewlet.getPresenceStatusName(h)})`,this.description=h.contact.email}}},function(h,m,y){"use strict";var v=this&&this.__decorate||function(h,m,y,v){var C,T=arguments.length,w=T<3?m:null===v?v=Object.getOwnPropertyDescriptor(m,y):v;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)w=Reflect.decorate(h,m,y,v);else for(var A=h.length-1;A>=0;A--)(C=h[A])&&(w=(T<3?C(w):T>3?C(m,y,w):C(m,y))||w);return T>3&&w&&Object.defineProperty(m,y,w),w},C=this&&this.__awaiter||function(h,m,y,v){return new(y||(y=Promise))((function(C,T){function fulfilled(h){try{step(v.next(h))}catch(h){T(h)}}function rejected(h){try{step(v.throw(h))}catch(h){T(h)}}function step(h){h.done?C(h.value):function adopt(h){return h instanceof y?h:new y((function(m){m(h)}))}(h.value).then(fulfilled,rejected)}step((v=v.apply(h,m||[])).next())}))};Object.defineProperty(m,"__esModule",{value:!0});const T=y(0),w=y(291),A=y(3),P=y(4),k=y(58),R=y(144);m.builder=function builder(){return new M};let M=class ChangeSelfPresenceCommand{invoke(h,m){return C(this,void 0,void 0,(function*(){const h=k.ContactManager.presenceStatus,m=k.ContactManager.supportedPresenceStatus.slice(0),y=k.ContactManager.signedStatus===P.contactProtocol.SignedStatus.SignedIn;y&&-1===m.findIndex(h=>h===P.contactProtocol.PresenceStatus.Offline)&&m.push(P.contactProtocol.PresenceStatus.Offline);const v=m.map(m=>(h===m?"$(check) ":"")+R.ContactsProviderViewlet.toPresenceStatusName(m)),C=yield T.window.showQuickPick(v,{placeHolder:"Specify your status:"});if(!C)return;let A=m[v.indexOf(C)];y&&A===P.contactProtocol.PresenceStatus.Offline?(yield w.setLivesharePresenceEnabled(!1),yield k.ContactManager.signOut()):yield k.ContactManager.publishPresence(A)}))}};M=v([A.telemetryCommandDecorator(A.TelemetryEventNames.CHANGE_SELF_PRESENCE,A.TelemetryEventNames.CHANGE_SELF_PRESENCE_FAULT,"ChangeSelfPresence",1)],M)},function(h,m,y){"use strict";var v=this&&this.__decorate||function(h,m,y,v){var C,T=arguments.length,w=T<3?m:null===v?v=Object.getOwnPropertyDescriptor(m,y):v;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)w=Reflect.decorate(h,m,y,v);else for(var A=h.length-1;A>=0;A--)(C=h[A])&&(w=(T<3?C(w):T>3?C(m,y,w):C(m,y))||w);return T>3&&w&&Object.defineProperty(m,y,w),w},C=this&&this.__awaiter||function(h,m,y,v){return new(y||(y=Promise))((function(C,T){function fulfilled(h){try{step(v.next(h))}catch(h){T(h)}}function rejected(h){try{step(v.throw(h))}catch(h){T(h)}}function step(h){h.done?C(h.value):function adopt(h){return h instanceof y?h:new y((function(m){m(h)}))}(h.value).then(fulfilled,rejected)}step((v=v.apply(h,m||[])).next())}))};Object.defineProperty(m,"__esModule",{value:!0});const T=y(3);m.builder=function builder(){return new w};let w=class ChangeSelfPresenceStatusCommand{invoke(h,m){return C(this,void 0,void 0,(function*(){let y=m.commandText.substr("liveshare.changePresence".length);y=y.charAt(0).toLowerCase()+y.slice(1);const v=y;yield h.contactServiceManager.publishPresence(v,{})}))}};w=v([T.telemetryCommandDecorator(T.TelemetryEventNames.CHANGE_SELF_PRESENCE_STATUS,T.TelemetryEventNames.CHANGE_SELF_PRESENCE_STATUS_FAULT,"ChangeSelfPresenceStatus",1)],w)},function(h,m,y){"use strict";var v=this&&this.__decorate||function(h,m,y,v){var C,T=arguments.length,w=T<3?m:null===v?v=Object.getOwnPropertyDescriptor(m,y):v;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)w=Reflect.decorate(h,m,y,v);else for(var A=h.length-1;A>=0;A--)(C=h[A])&&(w=(T<3?C(w):T>3?C(m,y,w):C(m,y))||w);return T>3&&w&&Object.defineProperty(m,y,w),w},C=this&&this.__awaiter||function(h,m,y,v){return new(y||(y=Promise))((function(C,T){function fulfilled(h){try{step(v.next(h))}catch(h){T(h)}}function rejected(h){try{step(v.throw(h))}catch(h){T(h)}}function step(h){h.done?C(h.value):function adopt(h){return h instanceof y?h:new y((function(m){m(h)}))}(h.value).then(fulfilled,rejected)}step((v=v.apply(h,m||[])).next())}))};Object.defineProperty(m,"__esModule",{value:!0});const T=y(0),w=y(291),A=y(3),P=y(4),k=y(58),R=y(144);m.builder=function builder(){return new M};let M=class SignInPresenceCommand{invoke(h,m){return C(this,void 0,void 0,(function*(){const h=A.localize("generic.SignIn");if((yield T.window.showWarningMessage(A.localize("presence.signInMessage"),{modal:!0},h))!==h)return;const m=k.ContactManager.supportedPresenceStatus.slice(0);m.push(P.contactProtocol.PresenceStatus.Offline);const y=m.map(h=>(h===P.contactProtocol.PresenceStatus.Offline?"$(check) ":"")+R.ContactsProviderViewlet.toPresenceStatusName(h)),v=yield T.window.showQuickPick(y,{placeHolder:"Specify your status:"});if(!v||v===y[y.length-1])return;const onSignedStateChanged=h=>C(this,void 0,void 0,(function*(){if(h!==P.contactProtocol.SignedStatus.SignedIn&&h!==P.contactProtocol.SignedStatus.SignedOut||k.ContactManager.removeListener(A.ContactManagerEvents.SignedStateChanged,onSignedStateChanged),h===P.contactProtocol.SignedStatus.SignedIn){const h=m[y.indexOf(v)];yield k.ContactManager.publishPresence(h)}}));k.ContactManager.addListener(A.ContactManagerEvents.SignedStateChanged,onSignedStateChanged),yield w.setLivesharePresenceEnabled(!0),yield k.ContactManager.signIn()}))}};M=v([A.telemetryCommandDecorator(A.TelemetryEventNames.SIGN_IN_PRESENCE,A.TelemetryEventNames.SIGN_IN_PRESENCE_FAULT,"SignInPresence",1)],M)},function(h,m,y){"use strict";var v=this&&this.__decorate||function(h,m,y,v){var C,T=arguments.length,w=T<3?m:null===v?v=Object.getOwnPropertyDescriptor(m,y):v;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)w=Reflect.decorate(h,m,y,v);else for(var A=h.length-1;A>=0;A--)(C=h[A])&&(w=(T<3?C(w):T>3?C(m,y,w):C(m,y))||w);return T>3&&w&&Object.defineProperty(m,y,w),w},C=this&&this.__awaiter||function(h,m,y,v){return new(y||(y=Promise))((function(C,T){function fulfilled(h){try{step(v.next(h))}catch(h){T(h)}}function rejected(h){try{step(v.throw(h))}catch(h){T(h)}}function step(h){h.done?C(h.value):function adopt(h){return h instanceof y?h:new y((function(m){m(h)}))}(h.value).then(fulfilled,rejected)}step((v=v.apply(h,m||[])).next())}))};Object.defineProperty(m,"__esModule",{value:!0});const T=y(3),w=y(58);m.builder=function builder(){return new A};let A=class SignOutPresenceCommand{invoke(h,m){return C(this,void 0,void 0,(function*(){yield w.ContactManager.signOut()}))}};A=v([T.telemetryCommandDecorator(T.TelemetryEventNames.SIGN_OUT_PRESENCE,T.TelemetryEventNames.SIGN_OUT_PRESENCE_FAULT,"SignOutPresence",1)],A)},function(h,m,y){"use strict";var v=this&&this.__awaiter||function(h,m,y,v){return new(y||(y=Promise))((function(C,T){function fulfilled(h){try{step(v.next(h))}catch(h){T(h)}}function rejected(h){try{step(v.throw(h))}catch(h){T(h)}}function step(h){h.done?C(h.value):function adopt(h){return h instanceof y?h:new y((function(m){m(h)}))}(h.value).then(fulfilled,rejected)}step((v=v.apply(h,m||[])).next())}))};Object.defineProperty(m,"__esModule",{value:!0});const C=y(0),T=y(1279),w=y(1321),A=y(1322),P=y(84),k=y(8),R=y(3),M=y(4),N=y(1323),D=y(1324),I=y(5),x=y(112),O=y(1325),L=y(221);m.ChatViewController=class ChatViewController{constructor(h,m,y,C,T){this.authCoreService=h,this.clientAccessCheck=m,this.rpcServices=y,this.trace=T,this.tracePrefix="[Chat View Controller]",this.messages={},this.users={},this.isUIReady=!1,this.typingTimers={},this.unreadWindowCounts={},this.authCoreService.onAuthenticationChanged(h=>v(this,void 0,void 0,(function*(){var m;yield this.updateUser(null===(m=h.account)||void 0===m?void 0:m.id)}))),R.workspaceSessionInfoTracker.onReadOnlyChanged(()=>v(this,void 0,void 0,(function*(){yield this.updateUser()}))),R.sessionStateTracker.onStateChanged(h=>v(this,void 0,void 0,(function*(){switch(h.newState){case R.SessionState.Shared:yield this.initialize(),yield this.chatServiceProxy.sendMessage(R.localize("chat.sessionStarted"));break;case R.SessionState.Joined:yield this.initialize(),(yield this.chatServiceProxy.getMessageHistory()).forEach(h=>v(this,void 0,void 0,(function*(){yield this.onMessageReceived({message:h})}))),yield this.chatServiceProxy.sendMessage(R.localize("chat.sessionJoined"));break}}))),R.SessionContext.onCollaboratorChanged(h=>v(this,void 0,void 0,(function*(){if(h&&h.changeType===M.vsls.WorkspaceSessionChangeType.Unjoined){const m={type:L.ChatMessageType.Text,fromId:h.sessionNumber.toString(),body:{text:R.localize("chat.sessionLeft"),timestamp:new Date}};yield this.onMessageReceived({message:m})}}))),this.rpcServices.workspaceService().onConnectionStatusChanged(h=>v(this,void 0,void 0,(function*(){h.disconnectedReason===M.vsls.WorkspaceDisconnectedReason.SessionEnded&&R.sessionStateTracker.State===R.SessionState.Shared&&(yield this.chatServiceProxy.sendMessage(R.localize("chat.sessionEnded")))}))),this.chatViewChanged=C,this.chatStatusBarItem=new A.ChatStatusBarItem}initialize(){return v(this,void 0,void 0,(function*(){this.trace.info(`${this.tracePrefix} initialize`),this.users={},yield this.createChatWindow(),this.chatServiceProxy=new O.ChatServiceProxy(this.rpcServices.chatService(),h=>v(this,void 0,void 0,(function*(){return yield this.onMessageReceived({message:h})}))),yield this.updateUser(),this.clearMessages()}))}onMessageReceived(h){var m;return v(this,void 0,void 0,(function*(){let{type:y,fromId:C,body:T}=h.message;this.trace.info(`${this.tracePrefix} notify. type:${y}, from:${C}`);const w=null===(m=null===R.workspaceSessionInfoTracker||void 0===R.workspaceSessionInfoTracker?void 0:R.workspaceSessionInfoTracker.workspaceSessionInfo)||void 0===m?void 0:m.sessionNumber.toString();if(w&&w!==C)switch(void 0===C&&(C=w),this.users[C]||(yield this.prepareContactForDisplay(C)),y){case L.ChatMessageType.Text:const{text:h,timestamp:m}=T;k.Telemetry.sendTelemetryEvent(R.TelemetryEventNames.CHAT_NOTIFY,{[R.TelemetryPropertyNames.CHAT_NOTIFY_TYPE]:L.ChatMessageType.Text.toString()});const w=(("string"==typeof m?new Date(m):m).getTime()/1e3).toString();let A={};A[w]=this.toWebviewMessage(h,w,C),yield this.updateMessages(A);break;case L.ChatMessageType.Typing:yield this.updateWebview(C);const P=`${C}`;this.typingTimers[P]&&(clearTimeout(this.typingTimers[P]),this.typingTimers[P]=void 0);const M=setTimeout(()=>v(this,void 0,void 0,(function*(){yield this.updateWebview()})),500);this.typingTimers[P]=M;break;default:const N=`Unsupported chat message type: ${y}`;throw k.Telemetry.sendFault(R.TelemetryEventNames.CHAT_FAULT,k.FaultType.Error,N),new Error(N)}}))}openSessionChat(h){return v(this,void 0,void 0,(function*(){this.trace.info(`${this.tracePrefix} open session chat: ${P.VSLS_CHAT_WINDOW.id}`),k.Telemetry.sendTelemetryEvent(D.CommunicationsTelemetryEventNames.OPEN_CHAT_WINDOW,{[D.CommunicationsTelemetryPropertyNames.CHAT_EVENT_SOURCE]:h}),yield C.commands.executeCommand("workbench.action.focusLastEditorGroup"),this.loadUi(),yield this.updateWebview(),yield this.updateChatUI()}))}chatWindowInfo(){return{contact:P.VSLS_CHAT_WINDOW,unread:this.getUnreadCount()}}static isUnsupportedChatExtensionInstalled(h){const m=C.extensions.all.find(h=>"karigari.chat"===h.id);if(!m)return!1;const y=[0,33],v=m.packageJSON.version;if(v){const m=v.split(".");if((null==m?void 0:m.length)>1){const v=parseInt(m[0],10),C=parseInt(m[1],10);if(v>y[0]||C>y[1])return!1;h&&I.NotificationUtil.showErrorMessage(R.localize("chat.legacyExtensionUnsupported"))}}return!0}static getCurrentUserId(){var h;const m=null===(h=R.SessionContext.coeditingClient)||void 0===h?void 0:h.clientID;return"number"==typeof m?R.SessionContext.collaboratorManager.getUserId(m):void 0}sendToExtension(h){return v(this,void 0,void 0,(function*(){const{type:m,body:y}=h;switch(this.trace.info(`${this.tracePrefix} Sending to extension (${m})`),m){case N.MessageType.ready:this.isUIReady=!0,this.pendingMessage&&(yield this.sendToUI(this.pendingMessage));break;case N.MessageType.command:yield this.handleCommand(y);break;case N.MessageType.focus:yield this.onFocus();break;case N.MessageType.text:yield this.chatServiceProxy.sendMessage(y);break;case N.MessageType.typing:yield this.chatServiceProxy.sendTyping()}}))}handleCommand(h){return v(this,void 0,void 0,(function*(){switch(h.toLowerCase().trim()){case N.CommandType.clear:k.Telemetry.sendTelemetryEvent(R.TelemetryEventNames.CHAT_COMMAND_INVOKED,{[R.TelemetryPropertyNames.CHAT_COMMAND]:N.CommandType.clear}),this.clearMessages();break;case N.CommandType.end:k.Telemetry.sendTelemetryEvent(R.TelemetryEventNames.CHAT_COMMAND_INVOKED,{[R.TelemetryPropertyNames.CHAT_COMMAND]:N.CommandType.end}),R.sessionStateTracker.State===R.SessionState.Shared?yield C.commands.executeCommand("liveshare.end"):R.sessionStateTracker.State===R.SessionState.Joined&&(yield C.commands.executeCommand("liveshare.leave"));break;default:k.Telemetry.sendTelemetryEvent(R.TelemetryEventNames.CHAT_COMMAND_INVOKED,{[R.TelemetryPropertyNames.CHAT_COMMAND]:"unknown"}),yield this.chatServiceProxy.sendMessage(h)}}))}clearMessages(){return v(this,void 0,void 0,(function*(){const h=this.messages[P.VSLS_CHAT_WINDOW.id]||{},m={};Object.keys(h).forEach(h=>{m[h]=void 0}),yield this.updateMessages(m)}))}loadUi(){this.webview?this.webview.reveal():(this.webview=new w.default(()=>{this.webview=void 0,this.isUIReady=!1}),this.webview.setMessageHandler(h=>v(this,void 0,void 0,(function*(){return yield this.sendToExtension(h)}))))}sendToUI(h){return v(this,void 0,void 0,(function*(){if(this.isUIReady){const{messages:m}=h,y=Object.keys(m).length;this.trace.info(`${this.tracePrefix} Sending to webview: ${y} messages`),this.webview&&(this.webview.update(h),this.pendingMessage=void 0,this.webview.isVisible()&&(yield this.updateReadMarker()))}else this.pendingMessage=h}))}updateUser(h){var m;return v(this,void 0,void 0,(function*(){if(null===(m=null===R.workspaceSessionInfoTracker||void 0===R.workspaceSessionInfoTracker?void 0:R.workspaceSessionInfoTracker.workspaceSessionInfo)||void 0===m?void 0:m.sessions)if(h){for(const m in R.workspaceSessionInfoTracker.workspaceSessionInfo.sessions)if(R.workspaceSessionInfoTracker.workspaceSessionInfo.sessions[m].id===h){yield this.prepareContactForDisplay(m);break}}else{const h=R.workspaceSessionInfoTracker.workspaceSessionInfo.sessionNumber.toString();this.currentUser=yield this.prepareContactForDisplay(h)}}))}onFocus(){return v(this,void 0,void 0,(function*(){yield this.updateReadMarker(),yield this.updateChatUI()}))}getUnreadCount(){const{readTimestamp:h}=this.chatWindow,m=this.currentUser;if(!m)return 0;const y=this.messages[P.VSLS_CHAT_WINDOW.id]||{};return Object.keys(y).filter(v=>y[v].userId!==m.id&&(!!h&&+v>+h)).length}updateStatusBarItem(){const h=this.getUnreadCount();this.chatStatusBarItem.updateCount(h)}updateChatUI(){return v(this,void 0,void 0,(function*(){if(!(yield x.CommunicationsManager.isChatEnabled()))return;const h=this.getUnreadCount();this.unreadWindowCounts[P.VSLS_CHAT_WINDOW.id]!==h&&(this.unreadWindowCounts[P.VSLS_CHAT_WINDOW.id]=h,this.updateStatusBarItem(),this.chatViewChanged.fire())}))}updateReadMarker(){return v(this,void 0,void 0,(function*(){const h=this.getLastTimestamp();if(this.chatWindow&&h){const{readTimestamp:m}=this.chatWindow;if(!m||+m<+h){const m=(+h+1).toString(),y=this.markChatWindow(m);y&&(this.chatWindow=y)}}}))}markChatWindow(h){return Object.assign(Object.assign({},this.chatWindow),{readTimestamp:h,unreadCount:0})}getLastTimestamp(){const h=this.messages[P.VSLS_CHAT_WINDOW.id]||{},m=Object.keys(h).map(h=>+h);if(m.length>0)return Math.max(...m).toString()}prepareContactForDisplay(h){var m;return v(this,void 0,void 0,(function*(){if(R.sessionStateTracker.State!==R.SessionState.Joined&&R.sessionStateTracker.State!==R.SessionState.Shared)return;let y=(yield this.chatServiceProxy.getParticipants()).find(m=>m.id===h);if(!y)return;const v=null===(m=null===R.workspaceSessionInfoTracker||void 0===R.workspaceSessionInfoTracker?void 0:R.workspaceSessionInfoTracker.workspaceSessionInfo)||void 0===m?void 0:m.sessions[h],C=y.email&&"anonymous"!==y.email?y.email:`anonymous${h}`,T=(null==v?void 0:v.avatarUri)||this.defaultAvatar(C),w=v?yield R.ExtensionUtil.getAnonymousReadOnlyLabel(this.clientAccessCheck(),v):"",A={id:h,displayName:`${y.name}${w}`,avatarUri:T,email:C};return this.users[h]=A,A}))}defaultAvatar(h){return T.imageUrl({email:h,parameters:{size:"200",d:"retro"},secure:!0})}updateWebview(h){return v(this,void 0,void 0,(function*(){if(this.currentUser&&this.chatWindow){const m=this.users,y=this.messages[P.VSLS_CHAT_WINDOW.id]||{};let v;h&&(v=m[h]);const{fontFamily:T,fontSize:w}=C.workspace.getConfiguration("editor");let A="";v&&(A=R.localize("chat.typingStatus").replace("$(username)",v.displayName));let k={fontFamily:T,fontSize:w,provider:"",messages:y,users:m,currentUser:this.currentUser,window:this.chatWindow,statusText:A};yield this.sendToUI(k)}}))}createChatWindow(){return v(this,void 0,void 0,(function*(){let h=this.chatWindow;if(!h){const m=+new Date/1e3-60;h={id:P.VSLS_CHAT_WINDOW.id,name:P.VSLS_CHAT_WINDOW.displayName,type:"im",isDisabled:!1,readTimestamp:m.toString(),unreadCount:0},this.chatWindow=h}return h}))}updateMessages(h){return v(this,void 0,void 0,(function*(){const m=this.messages[P.VSLS_CHAT_WINDOW.id]||{},y=Object.keys(h).filter(m=>void 0===h[m]),v={};Object.keys(m).forEach(h=>{y.indexOf(h)>=0||(v[h]=m[h])}),Object.keys(h).forEach(m=>{const y=h[m];y&&(v[m]=y)}),this.messages[P.VSLS_CHAT_WINDOW.id]=v,Object.keys(this.messages[P.VSLS_CHAT_WINDOW.id]).forEach(h=>{void 0===this.messages[P.VSLS_CHAT_WINDOW.id][h]&&delete this.messages[P.VSLS_CHAT_WINDOW.id][h]}),yield this.updateWebview(),this.updateChatUI()}))}toWebviewMessage(h,m,y){return{text:h,timestamp:m,content:void 0,reactions:[],replies:{},userId:y}}}},function(h,m,y){var v=y(530),C={includes:y(1280),trim:y(1310)},T=y(1320),w={},getQueryString=function(h){var m="",y=v.stringify(h);return""!==y&&(m="?"+y),m},getBaseUrl=function(h){var m="http://www.gravatar.com/";return h&&(m="https://secure.gravatar.com/"),m},sanitize=function(h){return h.email=h.email||"",h.type=C.trim(h.type),h.$emailHash=T(h.email.toLowerCase().trim()),h};w.imageUrl=function(h){h=sanitize(h);var m=getBaseUrl(h.secure)+"avatar/",y=getQueryString(h.parameters);return m+h.$emailHash+y},w.getProfileUrl=function(h){h=sanitize(h);var m=getBaseUrl(h.secure);C.includes(["json","xml","qr","php","vcf"],h.type)||(h.type="json");var y=getQueryString(h.parameters);return m+h.$emailHash+"."+h.type+y},h.exports=w},function(h,m,y){var v=y(293),C=y(531),T=y(1287),w=y(1288),A=y(1292),P=Math.max;h.exports=function includes(h,m,y,k){h=C(h)?h:A(h),y=y&&!k?w(y):0;var R=h.length;return y<0&&(y=P(R+y,0)),T(h)?y<=R&&h.indexOf(m,y)>-1:!!R&&v(h,m,y)>-1}},function(h,m){h.exports=function baseFindIndex(h,m,y,v){for(var C=h.length,T=y+(v?1:-1);v?T--:++T<C;)if(m(h[T],T,h))return T;return-1}},function(h,m){h.exports=function baseIsNaN(h){return h!=h}},function(h,m){h.exports=function strictIndexOf(h,m,y){for(var v=y-1,C=h.length;++v<C;)if(h[v]===m)return v;return-1}},function(h,m,y){var v=y(145),C=y(534);h.exports=function isFunction(h){if(!C(h))return!1;var m=v(h);return"[object Function]"==m||"[object GeneratorFunction]"==m||"[object AsyncFunction]"==m||"[object Proxy]"==m}},function(h,m,y){var v=y(294),C=Object.prototype,T=C.hasOwnProperty,w=C.toString,A=v?v.toStringTag:void 0;h.exports=function getRawTag(h){var m=T.call(h,A),y=h[A];try{h[A]=void 0;var v=!0}catch(h){}var C=w.call(h);return v&&(m?h[A]=y:delete h[A]),C}},function(h,m){var y=Object.prototype.toString;h.exports=function objectToString(h){return y.call(h)}},function(h,m,y){var v=y(145),C=y(295),T=y(146);h.exports=function isString(h){return"string"==typeof h||!C(h)&&T(h)&&"[object String]"==v(h)}},function(h,m,y){var v=y(1289);h.exports=function toInteger(h){var m=v(h),y=m%1;return m==m?y?m-y:m:0}},function(h,m,y){var v=y(1290);h.exports=function toFinite(h){return h?(h=v(h))===1/0||h===-1/0?17976931348623157e292*(h<0?-1:1):h==h?h:0:0===h?h:0}},function(h,m,y){var v=y(536),C=y(534),T=y(537),w=/^[-+]0x[0-9a-f]+$/i,A=/^0b[01]+$/i,P=/^0o[0-7]+$/i,k=parseInt;h.exports=function toNumber(h){if("number"==typeof h)return h;if(T(h))return NaN;if(C(h)){var m="function"==typeof h.valueOf?h.valueOf():h;h=C(m)?m+"":m}if("string"!=typeof h)return 0===h?h:+h;h=v(h);var y=A.test(h);return y||P.test(h)?k(h.slice(2),y?2:8):w.test(h)?NaN:+h}},function(h,m){var y=/\s/;h.exports=function trimmedEndIndex(h){for(var m=h.length;m--&&y.test(h.charAt(m)););return m}},function(h,m,y){var v=y(1293),C=y(1294);h.exports=function values(h){return null==h?[]:v(h,C(h))}},function(h,m,y){var v=y(538);h.exports=function baseValues(h,m){return v(m,(function(m){return h[m]}))}},function(h,m,y){var v=y(1295),C=y(1306),T=y(531);h.exports=function keys(h){return T(h)?v(h):C(h)}},function(h,m,y){var v=y(1296),C=y(1297),T=y(295),w=y(1299),A=y(1301),P=y(1302),k=Object.prototype.hasOwnProperty;h.exports=function arrayLikeKeys(h,m){var y=T(h),R=!y&&C(h),M=!y&&!R&&w(h),N=!y&&!R&&!M&&P(h),D=y||R||M||N,I=D?v(h.length,String):[],x=I.length;for(var O in h)!m&&!k.call(h,O)||D&&("length"==O||M&&("offset"==O||"parent"==O)||N&&("buffer"==O||"byteLength"==O||"byteOffset"==O)||A(O,x))||I.push(O);return I}},function(h,m){h.exports=function baseTimes(h,m){for(var y=-1,v=Array(h);++y<h;)v[y]=m(y);return v}},function(h,m,y){var v=y(1298),C=y(146),T=Object.prototype,w=T.hasOwnProperty,A=T.propertyIsEnumerable,P=v(function(){return arguments}())?v:function(h){return C(h)&&w.call(h,"callee")&&!A.call(h,"callee")};h.exports=P},function(h,m,y){var v=y(145),C=y(146);h.exports=function baseIsArguments(h){return C(h)&&"[object Arguments]"==v(h)}},function(h,m,y){(function(h){var v=y(532),C=y(1300),T=m&&!m.nodeType&&m,w=T&&"object"==typeof h&&h&&!h.nodeType&&h,A=w&&w.exports===T?v.Buffer:void 0,P=(A?A.isBuffer:void 0)||C;h.exports=P}).call(this,y(296)(h))},function(h,m){h.exports=function stubFalse(){return!1}},function(h,m){var y=/^(?:0|[1-9]\d*)$/;h.exports=function isIndex(h,m){var v=typeof h;return!!(m=null==m?9007199254740991:m)&&("number"==v||"symbol"!=v&&y.test(h))&&h>-1&&h%1==0&&h<m}},function(h,m,y){var v=y(1303),C=y(1304),T=y(1305),w=T&&T.isTypedArray,A=w?C(w):v;h.exports=A},function(h,m,y){var v=y(145),C=y(535),T=y(146),w={};w["[object Float32Array]"]=w["[object Float64Array]"]=w["[object Int8Array]"]=w["[object Int16Array]"]=w["[object Int32Array]"]=w["[object Uint8Array]"]=w["[object Uint8ClampedArray]"]=w["[object Uint16Array]"]=w["[object Uint32Array]"]=!0,w["[object Arguments]"]=w["[object Array]"]=w["[object ArrayBuffer]"]=w["[object Boolean]"]=w["[object DataView]"]=w["[object Date]"]=w["[object Error]"]=w["[object Function]"]=w["[object Map]"]=w["[object Number]"]=w["[object Object]"]=w["[object RegExp]"]=w["[object Set]"]=w["[object String]"]=w["[object WeakMap]"]=!1,h.exports=function baseIsTypedArray(h){return T(h)&&C(h.length)&&!!w[v(h)]}},function(h,m){h.exports=function baseUnary(h){return function(m){return h(m)}}},function(h,m,y){(function(h){var v=y(533),C=m&&!m.nodeType&&m,T=C&&"object"==typeof h&&h&&!h.nodeType&&h,w=T&&T.exports===C&&v.process,A=function(){try{var h=T&&T.require&&T.require("util").types;return h||w&&w.binding&&w.binding("util")}catch(h){}}();h.exports=A}).call(this,y(296)(h))},function(h,m,y){var v=y(1307),C=y(1308),T=Object.prototype.hasOwnProperty;h.exports=function baseKeys(h){if(!v(h))return C(h);var m=[];for(var y in Object(h))T.call(h,y)&&"constructor"!=y&&m.push(y);return m}},function(h,m){var y=Object.prototype;h.exports=function isPrototype(h){var m=h&&h.constructor;return h===("function"==typeof m&&m.prototype||y)}},function(h,m,y){var v=y(1309)(Object.keys,Object);h.exports=v},function(h,m){h.exports=function overArg(h,m){return function(y){return h(m(y))}}},function(h,m,y){var v=y(539),C=y(536),T=y(1311),w=y(1313),A=y(1314),P=y(1315),k=y(1319);h.exports=function trim(h,m,y){if((h=k(h))&&(y||void 0===m))return C(h);if(!h||!(m=v(m)))return h;var R=P(h),M=P(m),N=A(R,M),D=w(R,M)+1;return T(R,N,D).join("")}},function(h,m,y){var v=y(1312);h.exports=function castSlice(h,m,y){var C=h.length;return y=void 0===y?C:y,!m&&y>=C?h:v(h,m,y)}},function(h,m){h.exports=function baseSlice(h,m,y){var v=-1,C=h.length;m<0&&(m=-m>C?0:C+m),(y=y>C?C:y)<0&&(y+=C),C=m>y?0:y-m>>>0,m>>>=0;for(var T=Array(C);++v<C;)T[v]=h[v+m];return T}},function(h,m,y){var v=y(293);h.exports=function charsEndIndex(h,m){for(var y=h.length;y--&&v(m,h[y],0)>-1;);return y}},function(h,m,y){var v=y(293);h.exports=function charsStartIndex(h,m){for(var y=-1,C=h.length;++y<C&&v(m,h[y],0)>-1;);return y}},function(h,m,y){var v=y(1316),C=y(1317),T=y(1318);h.exports=function stringToArray(h){return C(h)?T(h):v(h)}},function(h,m){h.exports=function asciiToArray(h){return h.split("")}},function(h,m){var y=RegExp("[\\u200d\\ud800-\\udfff\\u0300-\\u036f\\ufe20-\\ufe2f\\u20d0-\\u20ff\\ufe0e\\ufe0f]");h.exports=function hasUnicode(h){return y.test(h)}},function(h,m){var y="[\\ud800-\\udfff]",v="[\\u0300-\\u036f\\ufe20-\\ufe2f\\u20d0-\\u20ff]",C="\\ud83c[\\udffb-\\udfff]",T="[^\\ud800-\\udfff]",w="(?:\\ud83c[\\udde6-\\uddff]){2}",A="[\\ud800-\\udbff][\\udc00-\\udfff]",P="(?:"+v+"|"+C+")"+"?",k="[\\ufe0e\\ufe0f]?"+P+("(?:\\u200d(?:"+[T,w,A].join("|")+")[\\ufe0e\\ufe0f]?"+P+")*"),R="(?:"+[T+v+"?",v,w,A,y].join("|")+")",M=RegExp(C+"(?="+C+")|"+R+k,"g");h.exports=function unicodeToArray(h){return h.match(M)||[]}},function(h,m,y){var v=y(539);h.exports=function toString(h){return null==h?"":v(h)}},function(h,m,y){var v;!function(C){"use strict";function safeAdd(h,m){var y=(65535&h)+(65535&m);return(h>>16)+(m>>16)+(y>>16)<<16|65535&y}function md5cmn(h,m,y,v,C,T){return safeAdd(function bitRotateLeft(h,m){return h<<m|h>>>32-m}(safeAdd(safeAdd(m,h),safeAdd(v,T)),C),y)}function md5ff(h,m,y,v,C,T,w){return md5cmn(m&y|~m&v,h,m,C,T,w)}function md5gg(h,m,y,v,C,T,w){return md5cmn(m&v|y&~v,h,m,C,T,w)}function md5hh(h,m,y,v,C,T,w){return md5cmn(m^y^v,h,m,C,T,w)}function md5ii(h,m,y,v,C,T,w){return md5cmn(y^(m|~v),h,m,C,T,w)}function binlMD5(h,m){var y,v,C,T,w;h[m>>5]|=128<<m%32,h[14+(m+64>>>9<<4)]=m;var A=1732584193,P=-271733879,k=-1732584194,R=271733878;for(y=0;y<h.length;y+=16)v=A,C=P,T=k,w=R,A=md5ff(A,P,k,R,h[y],7,-680876936),R=md5ff(R,A,P,k,h[y+1],12,-389564586),k=md5ff(k,R,A,P,h[y+2],17,606105819),P=md5ff(P,k,R,A,h[y+3],22,-1044525330),A=md5ff(A,P,k,R,h[y+4],7,-176418897),R=md5ff(R,A,P,k,h[y+5],12,1200080426),k=md5ff(k,R,A,P,h[y+6],17,-1473231341),P=md5ff(P,k,R,A,h[y+7],22,-45705983),A=md5ff(A,P,k,R,h[y+8],7,1770035416),R=md5ff(R,A,P,k,h[y+9],12,-1958414417),k=md5ff(k,R,A,P,h[y+10],17,-42063),P=md5ff(P,k,R,A,h[y+11],22,-1990404162),A=md5ff(A,P,k,R,h[y+12],7,1804603682),R=md5ff(R,A,P,k,h[y+13],12,-40341101),k=md5ff(k,R,A,P,h[y+14],17,-1502002290),A=md5gg(A,P=md5ff(P,k,R,A,h[y+15],22,1236535329),k,R,h[y+1],5,-165796510),R=md5gg(R,A,P,k,h[y+6],9,-1069501632),k=md5gg(k,R,A,P,h[y+11],14,643717713),P=md5gg(P,k,R,A,h[y],20,-373897302),A=md5gg(A,P,k,R,h[y+5],5,-701558691),R=md5gg(R,A,P,k,h[y+10],9,38016083),k=md5gg(k,R,A,P,h[y+15],14,-660478335),P=md5gg(P,k,R,A,h[y+4],20,-405537848),A=md5gg(A,P,k,R,h[y+9],5,568446438),R=md5gg(R,A,P,k,h[y+14],9,-1019803690),k=md5gg(k,R,A,P,h[y+3],14,-187363961),P=md5gg(P,k,R,A,h[y+8],20,1163531501),A=md5gg(A,P,k,R,h[y+13],5,-1444681467),R=md5gg(R,A,P,k,h[y+2],9,-51403784),k=md5gg(k,R,A,P,h[y+7],14,1735328473),A=md5hh(A,P=md5gg(P,k,R,A,h[y+12],20,-1926607734),k,R,h[y+5],4,-378558),R=md5hh(R,A,P,k,h[y+8],11,-2022574463),k=md5hh(k,R,A,P,h[y+11],16,1839030562),P=md5hh(P,k,R,A,h[y+14],23,-35309556),A=md5hh(A,P,k,R,h[y+1],4,-1530992060),R=md5hh(R,A,P,k,h[y+4],11,1272893353),k=md5hh(k,R,A,P,h[y+7],16,-155497632),P=md5hh(P,k,R,A,h[y+10],23,-1094730640),A=md5hh(A,P,k,R,h[y+13],4,681279174),R=md5hh(R,A,P,k,h[y],11,-358537222),k=md5hh(k,R,A,P,h[y+3],16,-722521979),P=md5hh(P,k,R,A,h[y+6],23,76029189),A=md5hh(A,P,k,R,h[y+9],4,-640364487),R=md5hh(R,A,P,k,h[y+12],11,-421815835),k=md5hh(k,R,A,P,h[y+15],16,530742520),A=md5ii(A,P=md5hh(P,k,R,A,h[y+2],23,-995338651),k,R,h[y],6,-198630844),R=md5ii(R,A,P,k,h[y+7],10,1126891415),k=md5ii(k,R,A,P,h[y+14],15,-1416354905),P=md5ii(P,k,R,A,h[y+5],21,-57434055),A=md5ii(A,P,k,R,h[y+12],6,1700485571),R=md5ii(R,A,P,k,h[y+3],10,-1894986606),k=md5ii(k,R,A,P,h[y+10],15,-1051523),P=md5ii(P,k,R,A,h[y+1],21,-2054922799),A=md5ii(A,P,k,R,h[y+8],6,1873313359),R=md5ii(R,A,P,k,h[y+15],10,-30611744),k=md5ii(k,R,A,P,h[y+6],15,-1560198380),P=md5ii(P,k,R,A,h[y+13],21,1309151649),A=md5ii(A,P,k,R,h[y+4],6,-145523070),R=md5ii(R,A,P,k,h[y+11],10,-1120210379),k=md5ii(k,R,A,P,h[y+2],15,718787259),P=md5ii(P,k,R,A,h[y+9],21,-343485551),A=safeAdd(A,v),P=safeAdd(P,C),k=safeAdd(k,T),R=safeAdd(R,w);return[A,P,k,R]}function binl2rstr(h){var m,y="",v=32*h.length;for(m=0;m<v;m+=8)y+=String.fromCharCode(h[m>>5]>>>m%32&255);return y}function rstr2binl(h){var m,y=[];for(y[(h.length>>2)-1]=void 0,m=0;m<y.length;m+=1)y[m]=0;var v=8*h.length;for(m=0;m<v;m+=8)y[m>>5]|=(255&h.charCodeAt(m/8))<<m%32;return y}function rstr2hex(h){var m,y,v="";for(y=0;y<h.length;y+=1)m=h.charCodeAt(y),v+="0123456789abcdef".charAt(m>>>4&15)+"0123456789abcdef".charAt(15&m);return v}function str2rstrUTF8(h){return unescape(encodeURIComponent(h))}function rawMD5(h){return function rstrMD5(h){return binl2rstr(binlMD5(rstr2binl(h),8*h.length))}(str2rstrUTF8(h))}function rawHMACMD5(h,m){return function rstrHMACMD5(h,m){var y,v,C=rstr2binl(h),T=[],w=[];for(T[15]=w[15]=void 0,C.length>16&&(C=binlMD5(C,8*h.length)),y=0;y<16;y+=1)T[y]=909522486^C[y],w[y]=1549556828^C[y];return v=binlMD5(T.concat(rstr2binl(m)),512+8*m.length),binl2rstr(binlMD5(w.concat(v),640))}(str2rstrUTF8(h),str2rstrUTF8(m))}function md5(h,m,y){return m?y?rawHMACMD5(m,h):function hexHMACMD5(h,m){return rstr2hex(rawHMACMD5(h,m))}(m,h):y?rawMD5(h):function hexMD5(h){return rstr2hex(rawMD5(h))}(h)}void 0===(v=function(){return md5}.call(m,y,m,h))||(h.exports=v)}()},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0});const v=y(0),C=y(3);m.default=class WebviewContainer{constructor(h){this.onDidDispose=h;let m=C.ExtensionUtil.getExtensionUri("webview");const y=[m];C.ExtensionUtil.isNode()&&(m=m.with({scheme:"vscode-resource"})),this.panel=v.window.createWebviewPanel("chatPanel","Chat",v.ViewColumn.Beside,{enableScripts:!0,retainContextWhenHidden:!0,localResourceRoots:y}),this.panel.webview.html=function getWebviewContent(h){return`<!DOCTYPE html>\n  <html lang="en">\n  <head>\n      <meta charset="UTF-8">\n      <meta name="viewport" content="width=device-width, initial-scale=1.0">\n      <title>Chat</title>\n\n      <link href="${h}/css/app.css" rel="preload" as="style">\n      <link href="${h}/js/chunk-vendors.js" rel="preload" as="script">\n      <link href="${h}/js/app.js" rel="preload" as="script">\n      <link href="${h}/css/app.css" rel="stylesheet">\n  </head>\n  <body>\n      <div id="app"> </div>\n      <script src="${h}/js/chunk-vendors.js"> <\/script>\n      <script src="${h}/js/app.js"> <\/script>\n  </body>\n  </html>`}(m.toString()),this.panel.onDidDispose(()=>{this.panel=null,this.onDidDispose()})}setMessageHandler(h){this.panel.webview.onDidReceiveMessage(m=>h(m))}update(h){const{messages:m,users:y,window:v,currentUser:C}=h,T=this.getAnnotatedMessages(m,v,C),w=this.getMessageGroups(T,y);this.panel.webview.postMessage(Object.assign(Object.assign({},h),{messages:w})),this.panel.title=v?v.name:""}reveal(){this.panel.reveal()}isVisible(){return this.panel.visible}getAnnotatedMessages(h,m,y){if(m){const{readTimestamp:v}=m;let C={};return Object.keys(h).forEach(m=>{const T=h[m],w=T.userId!==y.id,A=!!v&&w&&+m>+v;C[m]=Object.assign(Object.assign({},T),{isUnread:A})}),C}return h}getMessageGroups(h,m){let y={};return Object.keys(h).forEach(m=>{const v=new Date(1e3*+m),C=this.toDateString(v);C in y||(y[C]={}),y[C][m]=h[m]}),Object.keys(y).sort((h,m)=>h.localeCompare(m)).map(h=>{const v=y[h];return{groups:this.getMessageGroupsForDate(v,m),date:h}})}toDateString(h){let m=(h.getMonth()+1).toString(),y=h.getDate().toString();return 1===m.length&&(m=`0${m}`),1===y.length&&(y=`0${y}`),`${h.getFullYear()}-${m}-${y}`}getMessageGroupsForDate(h,m){const y=Object.keys(h).sort((h,m)=>+h-+m).reduce((y,v)=>{const{current:C,groups:T}=y,w=h[v],A=!!C.userId&&w.userId===C.userId,P=!!C.ts&&+v-+C.ts<300;if(A&&P)return{groups:T,current:Object.assign(Object.assign({},C),{ts:v,messages:[...C.messages,w]})};{const h={messages:[w],userId:w.userId,user:m[w.userId],minTimestamp:v,ts:v,key:v};return{groups:C.ts?[...T,C]:[...T],current:h}}},{current:{},groups:[]}),v=y.current,C=y.groups;return v.ts?[...C,v]:C}}},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0});const v=y(0),C=y(3);m.ChatStatusBarItem=class ChatStatusBarItem{constructor(){this.chatIcon="$(comment-discussion)",this.unreadCount=0,this.isVisible=!1,this.item=v.window.createStatusBarItem(v.StatusBarAlignment.Left);const h="extension.liveshare.chatStatusBar";this.disposableCommand=v.commands.registerCommand(h,()=>v.commands.executeCommand("liveshare.openSessionChat")),this.item.command=h}updateCount(h){return this.unreadCount=h,this.item.text=`${this.chatIcon} `+C.localize("chat.statusBarText").replace("$(unreads)",h.toLocaleString()),this.unreadCount>0?this.show():this.hide()}show(){this.isVisible||(this.item.show(),this.isVisible=!0)}hide(){this.isVisible&&(this.item.hide(),this.isVisible=!1)}dispose(){this.item.dispose(),this.disposableCommand.dispose()}}},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0}),function(h){h.text="text",h.typing="typing",h.thread_reply="thread_reply",h.command="command",h.link="link",h.focus="is_focused",h.ready="is_ready",h.fetch_replies="fetch_replies"}(m.MessageType||(m.MessageType={})),function(h){h.clear="/clear",h.share="/share",h.end="/end"}(m.CommandType||(m.CommandType={}))},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0});const v=y(3);class CommunicationsTelemetryEventNames{}m.CommunicationsTelemetryEventNames=CommunicationsTelemetryEventNames,CommunicationsTelemetryEventNames.OPEN_CHAT_WINDOW="open-chat-window";class CommunicationsTelemetryPropertyNames{}m.CommunicationsTelemetryPropertyNames=CommunicationsTelemetryPropertyNames,CommunicationsTelemetryPropertyNames.CHAT_EVENT_SOURCE=v.TelemetryPropertyNames.FEATURE_NAME+"ChatEventSource",CommunicationsTelemetryPropertyNames.CHAT_TYPE=v.TelemetryPropertyNames.FEATURE_NAME+"ChatType",CommunicationsTelemetryPropertyNames.CHAT_FAILURE=v.TelemetryPropertyNames.FEATURE_NAME+"ChatFailure"},function(h,m,y){"use strict";var v=this&&this.__awaiter||function(h,m,y,v){return new(y||(y=Promise))((function(C,T){function fulfilled(h){try{step(v.next(h))}catch(h){T(h)}}function rejected(h){try{step(v.throw(h))}catch(h){T(h)}}function step(h){h.done?C(h.value):function adopt(h){return h instanceof y?h:new y((function(m){m(h)}))}(h.value).then(fulfilled,rejected)}step((v=v.apply(h,m||[])).next())}))};Object.defineProperty(m,"__esModule",{value:!0});const C=y(221);m.ChatServiceProxy=class ChatServiceProxy{constructor(h,m){this.chatRpcService=h,this.updateWebviewCallback=m,this.chatRpcService.onMessageReceived(h=>this.updateWebviewCallback(h.message))}getMessageHistory(){return v(this,void 0,void 0,(function*(){return yield this.chatRpcService.getMessageHistoryAsync()}))}getParticipants(){return v(this,void 0,void 0,(function*(){return yield this.chatRpcService.getParticipantsAsync()}))}sendMessage(h){return v(this,void 0,void 0,(function*(){const m={timestamp:new Date,text:h},y={type:C.ChatMessageType.Text,body:m};yield this.updateWebviewCallback(y),yield this.chatRpcService.sendMessageAsync(y)}))}sendTyping(){return v(this,void 0,void 0,(function*(){const h={type:C.ChatMessageType.Typing};yield this.chatRpcService.sendMessageAsync(h)}))}}},function(h,m,y){"use strict";var v=this&&this.__awaiter||function(h,m,y,v){return new(y||(y=Promise))((function(C,T){function fulfilled(h){try{step(v.next(h))}catch(h){T(h)}}function rejected(h){try{step(v.throw(h))}catch(h){T(h)}}function step(h){h.done?C(h.value):function adopt(h){return h instanceof y?h:new y((function(m){m(h)}))}(h.value).then(fulfilled,rejected)}step((v=v.apply(h,m||[])).next())}))};Object.defineProperty(m,"__esModule",{value:!0});const C=y(0),T=y(540),w=y(3),A=y(1327),P=y(5),k=y(84),R=y(8),M=y(297),N=y(1328),D=y(1329),I=y(1330);m.CallingServiceManager=class CallingServiceManager{constructor(h,m,y,T){this.authCoreService=h,this.rpcClient=m,this.registeredServicesCallback=y,this.trace=T,this.newCallEventEmitter=new C.EventEmitter,this.onNewAudioCallAvailable=this.newCallEventEmitter.event,this.muteChangedEventEmitter=new C.EventEmitter,this.onMuteChanged=this.muteChangedEventEmitter.event,this.participantsListChangedEventEmitter=new C.EventEmitter,this.onParticipantsListChanged=this.participantsListChangedEventEmitter.event,this.participantChangedEventEmitter=new C.EventEmitter,this.onParticipantChanged=this.participantChangedEventEmitter.event,this.onNotify=h=>v(this,void 0,void 0,(function*(){switch(h.callingEventType){case k.CallingEventType.CallStarted:h.callId&&(R.Telemetry.sendTelemetryEvent(w.TelemetryEventNames.AUDIO_CALL_STARTED_NOTIFICATION),this.newCallEventEmitter.fire(),this.trackedCalls.has(h.callId)||(this.trackedCalls.set(h.callId,!0),(yield this.callingServiceProxy.getCallInfo())||(yield this.promptToJoinCall())));break;case k.CallingEventType.CallInformationRequest:if(this.isCallStarted){const h=yield this.getCallInfo();h&&"Connected"===h.state&&(R.Telemetry.sendTelemetryEvent(w.TelemetryEventNames.AUDIO_CALL_INFO_NOTIFICATION),this.sendCallStartedNotification(h))}break;default:throw R.Telemetry.sendTelemetryEvent(w.TelemetryEventNames.AUDIO_CALL_UNEXPECTED_NOTIFICATION),new Error(`Unexpected call event type: ${h.callingEventType}`)}})),this.callingServiceProxy=new N.CallingServiceProxy,this.audioStatusBarController=new D.AudioStatusBarController(this,this.trace),w.sessionStateTracker.onStateChanged(h=>v(this,void 0,void 0,(function*(){h.newState===w.SessionState.Joined&&M.AudioSessionContext.transition(M.AudioSessionAction.LiveShareSessionStarted)}))),M.AudioSessionContext.transition(M.AudioSessionAction.InitializeDone)}initialize(){return v(this,void 0,void 0,(function*(){this.trackedCalls=new Map,this.messagingService=new I.MessagingService(k.MESSAGE_SERVICE_NAME,this.rpcClient,this.registeredServicesCallback,this.trace),yield this.messagingService.initialize(),this.messagingService.onNotify(this.onNotify),yield this.registerCommands(),yield this.callingServiceProxy.initialize(h=>this.onCallChanged(h))}))}commandStartOrJoinCall(){return v(this,void 0,void 0,(function*(){if(this.isConnecting)return void this.trace.warning("Attempt to start or join a call that is already connecting.");this.isConnecting=!0;const h=R.Telemetry.startTimedEvent(w.TelemetryEventNames.AUDIO_CONNECT_CALL);try{M.AudioSessionContext.transition(M.AudioSessionAction.AttemptConnectAudio);const h=w.workspaceSessionInfoTracker.workspaceSessionInfo.id;yield w.ExtensionUtil.runWithProgress(()=>v(this,void 0,void 0,(function*(){return yield this.connectToCall(h)})),{title:w.localize("calling.connectingAudio")}),M.AudioSessionContext.transition(M.AudioSessionAction.AudioConnected)}catch(m){if(m instanceof P.CancellationError)return this.trace.warning(`startOrJoinCall: cancellation on connect to audio: ${m.message}`),M.AudioSessionContext.transition(M.AudioSessionAction.AudioConnectionFailed),void h.end(R.TelemetryResult.Cancel);throw this.trace.error(`startOrJoinCall: Caught error while trying to connect to audio: ${m.message} ${m.stack}`),M.AudioSessionContext.transition(M.AudioSessionAction.AudioConnectionFailed),h.end(R.TelemetryResult.Failure,m.message),m}finally{this.isConnecting=!1}h.end(R.TelemetryResult.Success)}))}promptToJoinCall(){return v(this,void 0,void 0,(function*(){const h=w.localize("calling.joinButton"),m=yield C.window.showInformationMessage(w.localize("calling.joinInformationMessage"),h);m===h&&(yield this.commandStartOrJoinCall()),R.Telemetry.sendTelemetryEvent(w.TelemetryEventNames.JOIN_PROMPT_DISPLAYED,{[w.TelemetryPropertyNames.SELECTED_ACTION]:m})}))}getCallInfo(){return v(this,void 0,void 0,(function*(){if(this.isCallStarted)return yield this.callingServiceProxy.getCallInfo()}))}checkIfCallIsAvailable(){this.trace.info("checkIfCallIsAvailable");const h={callingEventType:k.CallingEventType.CallInformationRequest};this.messagingService.notify(h)}getSelectedDevices(){return v(this,void 0,void 0,(function*(){return this.isCallStarted?(R.Telemetry.sendTelemetryEvent(w.TelemetryEventNames.AUDIO_GET_SELECTED_DEVICES),yield this.callingServiceProxy.getSelectedDevices()):{}}))}getParticipants(){return v(this,void 0,void 0,(function*(){if(!this.isCallStarted)return[];return R.Telemetry.sendTelemetryEvent(w.TelemetryEventNames.AUDIO_GET_PARTICIPANTS),(yield this.callingServiceProxy.getParticipants())||[]}))}endCall(){return v(this,void 0,void 0,(function*(){this.isCallStarted&&(R.Telemetry.sendTelemetryEvent(w.TelemetryEventNames.AUDIO_END_CALL),yield this.callingServiceProxy.endCall(),this.isCallStarted=!1)}))}enumerateDevices(){return v(this,void 0,void 0,(function*(){return this.isCallStarted?(R.Telemetry.sendTelemetryEvent(w.TelemetryEventNames.AUDIO_ENUMERATE_DEVICES),yield this.callingServiceProxy.getDevices()):[]}))}isMuted(){return v(this,void 0,void 0,(function*(){return!!this.isCallStarted&&(yield this.callingServiceProxy.isMuted())}))}onLiveShareSessionEnded(){return v(this,void 0,void 0,(function*(){try{yield this.endCall(),yield this.dispose()}catch(h){this.trace.error(`Failed to clean up call: ${h.message} ${h.stack}`)}}))}mute(h){return v(this,void 0,void 0,(function*(){this.isCallStarted&&(R.Telemetry.sendTelemetryEvent(w.TelemetryEventNames.AUDIO_MUTE),yield this.callingServiceProxy.mute(h),h||(yield w.ExtensionUtil.setCommandContext("liveshare:audioIsMuted","true"),this.muteChangedEventEmitter.fire(void 0)))}))}unmute(h){return v(this,void 0,void 0,(function*(){this.isCallStarted&&(R.Telemetry.sendTelemetryEvent(w.TelemetryEventNames.AUDIO_UNMUTE),yield this.callingServiceProxy.unmute(h),h||(yield w.ExtensionUtil.setCommandContext("liveshare:audioIsMuted","false"),this.muteChangedEventEmitter.fire(void 0)))}))}setDevice(h,m){return v(this,void 0,void 0,(function*(){if(!this.isCallStarted)return;const y=yield this.getSelectedDevices();let v;switch(m){case"Microphone":v=w.SettingKeys.microphoneId,y.microphone=h;break;case"Speaker":v=w.SettingKeys.speakerId,y.speaker=h;break;default:return}R.Telemetry.sendTelemetryEvent(w.TelemetryEventNames.AUDIO_SELECT_DEVICE,{[w.TelemetryPropertyNames.AUDIO_DEVICE_TYPE]:m}),yield this.callingServiceProxy.selectDevices(y),yield w.Settings.save(v,h)}))}dispose(){return v(this,void 0,void 0,(function*(){this.isDisposed||(this.isDisposed=!0,this.isCallStarted=!1,this.currentTokenInfo=null)}))}connectToCall(h){return v(this,void 0,void 0,(function*(){try{this.isCallStarted=!1;const m=`99:${h}`;let y;const v=yield this.authCoreService.getCurrentUserAsync();v&&(y=v.displayName||v.userName||v.emailAddress),y=y||"Unknown user";const C=yield this.getVSLSToken();yield this.callingServiceProxy.startOrJoinCall(m,y,C),this.isCallStarted=!0,yield this.setUserPreferences()}catch(h){if(!this.isDisposed)throw this.trace.error(`Failed to connect call: ${h.message} ${h.stack}`),h;throw new P.CancellationError(h.message)}}))}registerCommands(){return v(this,void 0,void 0,(function*(){yield w.ExtensionUtil.tryRegisterCommand(k.CallingServiceCommands.startOrJoinCall,()=>v(this,void 0,void 0,(function*(){return yield this.commandStartOrJoinCall()}))),yield w.ExtensionUtil.tryRegisterCommand(k.CallingServiceCommands.endCall,()=>v(this,void 0,void 0,(function*(){return yield this.leaveCall()}))),yield w.ExtensionUtil.tryRegisterCommand(k.CallingServiceCommands.muteSelf,()=>v(this,void 0,void 0,(function*(){return yield this.mute()}))),yield w.ExtensionUtil.tryRegisterCommand(k.CallingServiceCommands.unmuteSelf,()=>v(this,void 0,void 0,(function*(){return yield this.unmute()}))),yield w.ExtensionUtil.tryRegisterCommand(k.CallingServiceCommands.muteOrUnmute,()=>v(this,void 0,void 0,(function*(){return yield this.muteOrUnmute()}))),yield w.ExtensionUtil.tryRegisterCommand(k.CallingServiceCommands.selectMicrophone,()=>v(this,void 0,void 0,(function*(){return yield this.selectMicrophone()}))),yield w.ExtensionUtil.tryRegisterCommand(k.CallingServiceCommands.selectSpeaker,()=>v(this,void 0,void 0,(function*(){return yield this.selectSpeaker()}))),yield w.ExtensionUtil.tryRegisterCommand(k.CallingServiceCommands.setMicrophone,h=>v(this,void 0,void 0,(function*(){return yield this.setDevice(h,"Microphone")}))),yield w.ExtensionUtil.tryRegisterCommand(k.CallingServiceCommands.setSpeaker,h=>v(this,void 0,void 0,(function*(){return yield this.setDevice(h,"Speaker")}))),yield w.ExtensionUtil.tryRegisterCommand(k.CallingServiceCommands.viewParticipants,()=>v(this,void 0,void 0,(function*(){return yield this.viewParticipants()})))}))}muteOrUnmute(){return v(this,void 0,void 0,(function*(){(yield this.isMuted())?yield this.unmute():yield this.mute()}))}leaveCall(){return v(this,void 0,void 0,(function*(){try{M.AudioSessionContext.transition(M.AudioSessionAction.AttemptDisconnectAudio),yield w.ExtensionUtil.runWithProgress(()=>v(this,void 0,void 0,(function*(){return yield this.endCall()})),{title:w.localize("calling.disconnectingAudio")}),M.AudioSessionContext.transition(M.AudioSessionAction.AudioDisconnected)}catch(h){throw this.trace.error(`leaveAudio: Caught error: ${h.message} ${h.stack}`),M.AudioSessionContext.transition(M.AudioSessionAction.AudioConnectionFailed),h}}))}viewParticipants(){return v(this,void 0,void 0,(function*(){const h=(yield this.callingServiceProxy.getParticipants()).map(h=>({label:"",description:h.displayName}));return C.window.showQuickPick(h,{placeHolder:w.localize("calling.viewParticipantsQuickPickPlaceholder")})}))}selectMicrophone(){return v(this,void 0,void 0,(function*(){const h=yield this.buildDeviceList("Microphone");return this.showEnabledQuickPick(h,{placeHolder:w.localize("calling.selectMicrophoneQuickPickPlaceholder")}).then(h=>h&&C.commands.executeCommand(h.command,h.commandArg))}))}selectSpeaker(){return v(this,void 0,void 0,(function*(){const h=yield this.buildDeviceList("Speaker");return this.showEnabledQuickPick(h,{placeHolder:w.localize("calling.selectSpeakersQuickPickPlaceholder")}).then(h=>h&&C.commands.executeCommand(h.command,h.commandArg))}))}buildDeviceList(h){return v(this,void 0,void 0,(function*(){const m=yield this.enumerateDevices(),y=yield this.getSelectedDevices();return m.filter(m=>m.type===h).map(m=>({command:`liveshare.callingService.setDevice.${h.toLowerCase()}`,commandArg:m.id,label:`${this.isSelectedDevice(m,y)?"$(check)":"   "} ${m.name}`,enabled:()=>!0}))}))}isSelectedDevice(h,m){if(!h)return!1;switch(h.type){case"Camera":return m.camera&&h.id===m.camera;case"Microphone":return m.microphone&&h.id===m.microphone;case"Speaker":return m.speaker&&h.id===m.speaker;default:return!1}}showEnabledQuickPick(h,m){return C.window.showQuickPick(h.filter(h=>h.enabled()),m)}setUserPreferences(){return v(this,void 0,void 0,(function*(){const h=w.Settings.get(w.SettingKeys.microphoneId);h&&(yield this.setDevice(h,"Microphone"));const m=w.Settings.get(w.SettingKeys.speakerId);m&&(yield this.setDevice(m,"Speaker"))}))}onCallChanged(h){return v(this,void 0,void 0,(function*(){switch(this.trace.info(`Call changed event received from calling service: ${h.changeType}`),h.changeType){case T.CallChangedType.callStarted:const m=h.info;this.sendCallStartedNotification(m);break;case T.CallChangedType.callDisconnected:M.AudioSessionContext.transition(M.AudioSessionAction.AudioDisconnected),this.checkIfCallIsAvailable();break;case T.CallChangedType.participantsListChanged:this.participantsListChangedEventEmitter.fire();break;case T.CallChangedType.participantChanged:const y=h.info;this.participantChangedEventEmitter.fire(y);break;default:throw new Error(`Unexpected call change type: ${h.changeType}`)}}))}sendCallStartedNotification(h){const m={callingEventType:k.CallingEventType.CallStarted,groupContext:h.callId,callId:h.callId};this.messagingService.notify(m)}getVSLSToken(){return v(this,void 0,void 0,(function*(){return this.currentTokenInfo&&(new Date).getTime()<this.currentTokenInfo.expiresIn-36e5||(this.currentTokenInfo=yield A.getVSLSTokenFromAuthService(this.trace)),this.currentTokenInfo}))}}},function(h,m,y){"use strict";var v=this&&this.__awaiter||function(h,m,y,v){return new(y||(y=Promise))((function(C,T){function fulfilled(h){try{step(v.next(h))}catch(h){T(h)}}function rejected(h){try{step(v.throw(h))}catch(h){T(h)}}function step(h){h.done?C(h.value):function adopt(h){return h instanceof y?h:new y((function(m){m(h)}))}(h.value).then(fulfilled,rejected)}step((v=v.apply(h,m||[])).next())}))};Object.defineProperty(m,"__esModule",{value:!0});const C=y(46),T=y(35),w=y(84);class DeferredPromise{constructor(){let h,m;this.promise=new Promise((y,v)=>{h=y,m=v}),this.deferredReject=m,this.deferredResolve=h}resolve(h){this.deferredResolve(h)}reject(h){this.deferredReject(h)}}m.DeferredPromise=DeferredPromise,m.getVSLSTokenFromAuthService=function getVSLSTokenFromAuthService(h){return v(this,void 0,void 0,(function*(){const h={hostname:"authsvc-server.teams.microsoft.com",port:443,path:"/v1.0/authz/visitor",method:"POST",headers:{"Content-Type":"application/json","x-ms-request-id":T(),"x-ms-client-type":"ms-vsliveshare.vsliveshare"}},m=JSON.stringify({tenantId:w.AUTH_TOKEN_TENANT_ID});let y;const v=new DeferredPromise;let A="";const P=C.request(h,h=>{200===h.statusCode?(h.setEncoding("utf8"),h.on("data",h=>{A+=h}),h.on("end",(function(){const h=JSON.parse(A);y=h.tokens,v.resolve()}))):v.reject(`Expected 200 status code to get SkypeToken. status code: ${h.statusCode}`)});if(P.on("error",h=>{v.reject(`HTTPS request failed for SkypeToken: ${h.message}`)}),P.write(m),P.end(),yield v.promise.catch(h=>{throw new Error(h)}),!y)throw new Error("Error retrieving SkypeToken");return y.skypeId=function getSkypeId(h){try{const m=h.split(".")[1].replace(/-/g,"+").replace(/_/g,"/"),y=JSON.parse(Buffer.from(m,"base64").toString("ascii"));if(!y.skypeid)throw new Error("skypeid claim not found");return y.skypeid}catch(h){throw new Error(`Cannot retrieve skypeid from token: ${h.message}`)}}(y.skypeToken),y}))}},function(h,m,y){"use strict";var v=this&&this.__awaiter||function(h,m,y,v){return new(y||(y=Promise))((function(C,T){function fulfilled(h){try{step(v.next(h))}catch(h){T(h)}}function rejected(h){try{step(v.throw(h))}catch(h){T(h)}}function step(h){h.done?C(h.value):function adopt(h){return h instanceof y?h:new y((function(m){m(h)}))}(h.value).then(fulfilled,rejected)}step((v=v.apply(h,m||[])).next())}))};Object.defineProperty(m,"__esModule",{value:!0});const C=y(0),T=y(540),w=y(3);m.CallingServiceProxy=class CallingServiceProxy{initialize(h){return v(this,void 0,void 0,(function*(){yield w.ExtensionUtil.tryRegisterCommand(T.CallingServiceProxyCommands.onCallChangedEvent,m=>v(this,void 0,void 0,(function*(){return yield h(m)})))}))}getCallInfo(){return v(this,void 0,void 0,(function*(){return yield C.commands.executeCommand(T.CallingServiceProxyCommands.getCallInfo)}))}startOrJoinCall(h,m,y){return v(this,void 0,void 0,(function*(){return yield C.commands.executeCommand(T.CallingServiceProxyCommands.startOrJoinCall,h,m,y)}))}getDevices(){return v(this,void 0,void 0,(function*(){return yield C.commands.executeCommand(T.CallingServiceProxyCommands.getDevices)}))}getSelectedDevices(){return v(this,void 0,void 0,(function*(){return yield C.commands.executeCommand(T.CallingServiceProxyCommands.getSelectedDevices)}))}selectDevices(h){return v(this,void 0,void 0,(function*(){return yield C.commands.executeCommand(T.CallingServiceProxyCommands.selectDevices,h)}))}getParticipants(){return v(this,void 0,void 0,(function*(){return yield C.commands.executeCommand(T.CallingServiceProxyCommands.getParticipants)}))}endCall(){return v(this,void 0,void 0,(function*(){return yield C.commands.executeCommand(T.CallingServiceProxyCommands.endCall)}))}isMuted(){return v(this,void 0,void 0,(function*(){return yield C.commands.executeCommand(T.CallingServiceProxyCommands.isMuted)}))}mute(h){return v(this,void 0,void 0,(function*(){return yield C.commands.executeCommand(T.CallingServiceProxyCommands.mute,h)}))}unmute(h){return v(this,void 0,void 0,(function*(){return yield C.commands.executeCommand(T.CallingServiceProxyCommands.unmute,h)}))}}},function(h,m,y){"use strict";var v=this&&this.__awaiter||function(h,m,y,v){return new(y||(y=Promise))((function(C,T){function fulfilled(h){try{step(v.next(h))}catch(h){T(h)}}function rejected(h){try{step(v.throw(h))}catch(h){T(h)}}function step(h){h.done?C(h.value):function adopt(h){return h instanceof y?h:new y((function(m){m(h)}))}(h.value).then(fulfilled,rejected)}step((v=v.apply(h,m||[])).next())}))};Object.defineProperty(m,"__esModule",{value:!0});const C=y(0),T=y(297),w=y(3),A=y(84);m.AudioStatusBarController=class AudioStatusBarController{constructor(h,m){this.callingServiceManager=h,this.trace=m,this.updateStatusBarPromise=Promise.resolve(),this.audioConnectedStatusBarItem=C.window.createStatusBarItem(C.StatusBarAlignment.Left,2),this.audioConnectedStatusBarItem.hide(),this.updateStatusBar(new NoAudioState),T.AudioSessionContext.addListener(T.AudioSessionEvents.StateChanged,(h,m)=>v(this,void 0,void 0,(function*(){return yield this.onSessionStateChanged(h)}))),this.callingServiceManager.onMuteChanged(()=>v(this,void 0,void 0,(function*(){return yield this.onMuteChanged()})))}onMuteChanged(){return v(this,void 0,void 0,(function*(){const h=yield this.callingServiceManager.isMuted();this.trace.info(`mute changed isMuted:${h}`),this.audioConnectedStatusBarItem.text=h?"$(mute)":"$(unmute)"}))}updateStatusBar(h){const m=this.currentState;this.currentState=h,m&&m.dispose(),h.updateAudioConnectedStatusBarItem(this.audioConnectedStatusBarItem)}onSessionStateChanged(h){return v(this,void 0,void 0,(function*(){let m=this.getStatusBarState(h);this.updateStatusBarPromise=this.updateStatusBarPromise.then(()=>v(this,void 0,void 0,(function*(){this.updateStatusBar(m),yield w.ExtensionUtil.setCommandContext("liveshare:audioSessionState",h.toString())})))}))}getStatusBarState(h){switch(h){case T.AudioSessionState.LiveShareWithAudio:return new LiveShareWithAudioState(this.callingServiceManager);default:return new NoAudioState}}};class StatusBarState{constructor(){this.disposed=!1}updateStatusBarItem(h){this.hideItem(h)}updateAudioConnectedStatusBarItem(h){this.hideItem(h)}hideItem(h){h.hide(),h.text=void 0,h.command=void 0,h.tooltip=void 0}showQuickPick(h,m){return C.window.showQuickPick(h.filter(h=>h.enabled()),m)}dispose(){this.disposed=!0}}m.StatusBarState=StatusBarState;class NoAudioState extends StatusBarState{}m.NoAudioState=NoAudioState;class LiveShareWithAudioState extends StatusBarState{constructor(h){super(),this.callingService=h}updateAudioConnectedStatusBarItem(h){return v(this,void 0,void 0,(function*(){const m=A.CallingServiceCommands.callSettings;yield w.ExtensionUtil.tryRegisterCommand(m,()=>v(this,void 0,void 0,(function*(){return this.showQuickPick(yield this.connectedQuickPickItems(),{placeHolder:w.localize("calling.quickPickConnectedPlaceholder")}).then(h=>h&&C.commands.executeCommand(h.command,h.commandArg))}))),h.text=(yield this.callingService.isMuted())?"$(mute)":"$(unmute)",h.command=m,h.show()}))}connectedQuickPickItems(){return v(this,void 0,void 0,(function*(){let h=yield this.callingService.isMuted();return[{label:w.localize("calling.quickPickDisconnectLabel"),description:"",detail:w.localize("calling.quickPickDisconnectDetail"),command:A.CallingServiceCommands.endCall,enabled:()=>!0},{label:h?w.localize("calling.quickPickUnmuteYourselfLabel"):w.localize("calling.quickPickMuteYourselfLabel"),description:"",detail:h?w.localize("calling.quickPickUnmuteYourselfDetail"):w.localize("calling.quickPickMuteYourselfDetail"),command:A.CallingServiceCommands.muteOrUnmute,enabled:()=>!0},{label:w.localize("calling.quickPickViewParticipantsLabel"),description:"",detail:w.localize("calling.quickPickViewParticipantsDetail"),command:A.CallingServiceCommands.viewParticipants,enabled:()=>!0},{label:w.localize("calling.quickPickConfigureSpeakersLabel"),description:"",detail:w.localize("calling.quickPickConfigureSpeakersDetail"),command:A.CallingServiceCommands.selectSpeaker,enabled:()=>!0},{label:w.localize("calling.quickPickConfigureMicrophoneLabel"),description:"",detail:w.localize("calling.quickPickConfigureMicrophoneDetail"),command:A.CallingServiceCommands.selectMicrophone,enabled:()=>!0}]}))}}m.LiveShareWithAudioState=LiveShareWithAudioState},function(h,m,y){"use strict";var v=this&&this.__awaiter||function(h,m,y,v){return new(y||(y=Promise))((function(C,T){function fulfilled(h){try{step(v.next(h))}catch(h){T(h)}}function rejected(h){try{step(v.throw(h))}catch(h){T(h)}}function step(h){h.done?C(h.value):function adopt(h){return h instanceof y?h:new y((function(m){m(h)}))}(h.value).then(fulfilled,rejected)}step((v=v.apply(h,m||[])).next())}))};Object.defineProperty(m,"__esModule",{value:!0});const C=y(84);m.MessagingService=class MessagingService{constructor(h,m,y,v){this.name=h,this.rpcClient=m,this.registeredServicesCallback=y,this.trace=v}initialize(){return v(this,void 0,void 0,(function*(){this.name=`${C.MESSAGE_SERVICE_NAME}.${C.MESSAGE_SERVICE_NOTIFICATION_EVENT_NAME}`,this.connection=yield this.rpcClient.ensureConnectionAsync();const h=yield this.registeredServicesCallback();(null==h?void 0:h.includes(C.MESSAGE_SERVICE_NAME))&&(this.isServiceAvailable=!0)}))}onNotify(h){this.trace.verbose(`onNotify(${this.name})`),this.connection.onNotification(this.name,(...m)=>{const y=m[0];this.trace.verbose(`onNotify(${this.name})`);try{h(y)}catch(h){this.trace.warning(`Notification handler (${this.name}) failed: `+h.message)}})}notify(h){if(this.isServiceAvailable){this.trace.verbose(`notify(${this.name})`);try{this.connection.sendNotification(this.name,[h])}catch(h){this.trace.warning(`notify(${this.name}) failed: `+h.message)}}else this.trace.verbose(`notify(${this.name}) - service not available`)}}},function(h,m,y){"use strict";var v=this&&this.__awaiter||function(h,m,y,v){return new(y||(y=Promise))((function(C,T){function fulfilled(h){try{step(v.next(h))}catch(h){T(h)}}function rejected(h){try{step(v.throw(h))}catch(h){T(h)}}function step(h){h.done?C(h.value):function adopt(h){return h instanceof y?h:new y((function(m){m(h)}))}(h.value).then(fulfilled,rejected)}step((v=v.apply(h,m||[])).next())}))};Object.defineProperty(m,"__esModule",{value:!0});const C=y(84),T=y(3),w=y(112),A=y(541);m.chatViewItem="chat";class ChatTreeDataProvider extends T.TreeDataProviderBase{constructor(){super(m.chatViewItem,T.TreeDataProviderContext.SharedOrJoined),w.CommunicationsManager.onChatViewChanged(()=>this.forceRefreshItems())}getChildrenItems(h){return v(this,void 0,void 0,(function*(){}))}getRootItem(){var h;return v(this,void 0,void 0,(function*(){const y=null===(h=w.CommunicationsManager.chatViewController)||void 0===h?void 0:h.chatWindowInfo();if(!y)return;let v=A.formatUnreadLabel(T.localize("chat.sessionChatLabel"),y.unread);return new T.TreeViewItem({type:m.chatViewItem,label:v,tooltip:v,command:{title:T.localize("chat.openSessionChatWindow"),command:"liveshare.openSessionChat",arguments:[C.VSLS_CHAT_WINDOW]}})}))}}m.ChatTreeDataProvider=ChatTreeDataProvider},function(h,m,y){"use strict";var v=this&&this.__awaiter||function(h,m,y,v){return new(y||(y=Promise))((function(C,T){function fulfilled(h){try{step(v.next(h))}catch(h){T(h)}}function rejected(h){try{step(v.throw(h))}catch(h){T(h)}}function step(h){h.done?C(h.value):function adopt(h){return h instanceof y?h:new y((function(m){m(h)}))}(h.value).then(fulfilled,rejected)}step((v=v.apply(h,m||[])).next())}))};Object.defineProperty(m,"__esModule",{value:!0});const C=y(0),T=y(3),w=y(297),A=y(112),P=y(84),k=y(541);var R;m.audioViewItem="audio",function(h){h.Disconnected="audio.disconnected",h.StartOrJoin="audio.startOrJoin",h.Connecting="audio.connecting",h.Disconnecting="audio.disconnecting",h.ParticipantsList="audio.participants",h.Participant="audio.participant",h.ParticipantMuted="audio.participant.muted",h.Self="audio.self",h.SelfMuted="audio.self.muted"}(R||(R={}));class AudioSessionExplorerItem extends T.TreeViewItem{constructor(h){super(h),this.options=h,this.participantId=h.participantId}}class AudioTreeDataProvider extends T.TreeDataProviderBase{constructor(h,y){super(m.audioViewItem,T.TreeDataProviderContext.SharedOrJoined),this.authCoreService=h,this.clientAccessCheck=y,this.isCallAvailable=!1,this.isChildItemCacheDisabled=!0,this.initialize()}initialize(){this.callingService=A.CommunicationsManager.callingServiceManager,this.participantsListItem=new AudioSessionExplorerItem({type:R.ParticipantsList,label:T.localize("calling.treeAudioCallParticipantsInitial"),collapsibleState:C.TreeItemCollapsibleState.Expanded,contextValue:R.ParticipantsList}),this.participantItems=new Map,this.selfItem=new AudioSessionExplorerItem({type:R.Self,label:"",contextValue:R.Self}),w.AudioSessionContext.addListener(w.AudioSessionEvents.StateChanged,h=>v(this,void 0,void 0,(function*(){return yield this.onSessionStateChanged(h)}))),this.sessionState=w.AudioSessionState.LiveShareWithoutAudio,this.callingService.onNewAudioCallAvailable(()=>{this.isCallAvailable=!0,this.refresh()}),this.callingService.onMuteChanged(h=>v(this,void 0,void 0,(function*(){return yield this.onMuteChanged(h)}))),this.callingService.onParticipantsListChanged(()=>v(this,void 0,void 0,(function*(){return this.refresh(yield this.updateParticipantsListItem())}))),this.callingService.onParticipantChanged(h=>this.onParticipantChanged(h)),this.callingService.checkIfCallIsAvailable()}getChildrenItems(h){return v(this,void 0,void 0,(function*(){let m;switch(h.contextValue){case R.Disconnected:switch(this.sessionState){case w.AudioSessionState.LiveShareWithoutAudio:return m=this.isCallAvailable?T.localize("calling.treeJoinAudioCall"):T.localize("calling.treeStartAudioCall"),[new AudioSessionExplorerItem({type:R.StartOrJoin,label:m,command:{title:m,command:P.CallingServiceCommands.startOrJoinCall}})];case w.AudioSessionState.AudioConnecting:return m=this.isCallAvailable?T.localize("calling.treeJoiningAudioCall"):T.localize("calling.treeStartingAudioCall"),[new AudioSessionExplorerItem({type:R.Connecting,label:m,iconPath:T.TreeDataProviderBase.getThemeIconPath("loading")})];default:return[]}case R.ParticipantsList:switch(this.sessionState){case w.AudioSessionState.AudioDisconnecting:return[new AudioSessionExplorerItem({type:R.Disconnecting,label:T.localize("calling.treeEndingAudioCall"),iconPath:T.TreeDataProviderBase.getThemeIconPath("loading")})];default:return this.isCallAvailable=!1,yield this.getCallParticipants()}default:return[]}}))}getRootItem(){return v(this,void 0,void 0,(function*(){let h=void 0;switch(this.sessionState){case w.AudioSessionState.LiveShareWithoutAudio:case w.AudioSessionState.AudioConnecting:h=new AudioSessionExplorerItem({type:R.Disconnected,label:T.localize("calling.treeAudioCallLabel"),collapsibleState:C.TreeItemCollapsibleState.Expanded});break;case w.AudioSessionState.AudioDisconnecting:h=new AudioSessionExplorerItem({type:R.ParticipantsList,label:T.localize("calling.treeAudioCallLabel"),collapsibleState:C.TreeItemCollapsibleState.Expanded,contextValue:R.ParticipantsList});break;case w.AudioSessionState.LiveShareWithAudio:const m=1+(yield this.callingService.getParticipants()).length;this.participantsListItem.label=T.localize("calling.treeAudioCallParticipantsCount").replace("$(participantCount)",m.toString()),h=this.participantsListItem;break;default:return}return h}))}getCallParticipants(){return v(this,void 0,void 0,(function*(){const h=[],m=yield this.callingService.getParticipants();for(let y of m)this.createOrUpdateTreeItemForParticipant(y),h.push(y.id);for(let m of Array.from(this.participantItems.keys()))h.indexOf(m)<0&&this.participantItems.delete(m);return[this.selfItem].concat(Array.from(this.participantItems.values()))}))}onParticipantChanged(h){this.refresh(this.createOrUpdateTreeItemForParticipant(h))}updateParticipantsListItem(){return v(this,void 0,void 0,(function*(){return yield this.getRootItem(),this.participantsListItem}))}createOrUpdateTreeItemForParticipant(h){const m=h.isMuted,y=!m&&h.isSpeaking,v=m?R.ParticipantMuted:R.Participant,C=T.TreeDataProviderBase.getThemeIconPath(m?"speaker-mute":y?"speaker-sound":"speaker");let w=this.participantItems.get(h.id);return w?(w.label=h.displayName,w.contextValue=v,w.iconPath=C):(w=new AudioSessionExplorerItem({type:v,label:h.displayName,iconPath:C}),w.id=h.id,this.participantItems.set(h.id,w)),w}onSessionStateChanged(h){return v(this,void 0,void 0,(function*(){this.sessionState=h,h===w.AudioSessionState.LiveShareWithAudio&&(yield this.updateTreeItemForSelf()),this.refresh()}))}onMuteChanged(h){return v(this,void 0,void 0,(function*(){if(h){let m=this.participantItems.get(h.id);m&&this.refresh(m)}else yield this.updateTreeItemForSelf(),this.refresh()}))}updateTreeItemForSelf(){return v(this,void 0,void 0,(function*(){const h=yield this.callingService.isMuted(),m=yield this.authCoreService.getCurrentUserAsync();let y=m?m.displayName||m.userName||m.emailAddress:T.localize("calling.treeUnknownUser");const v=k.getCollaborators().find(h=>h.id===m.id);if(v){const h=yield T.ExtensionUtil.getAnonymousReadOnlyLabel(this.clientAccessCheck(),v);y=`${v.name||y}${h}`}this.selfItem.label=T.localize("calling.treeSelfItem").replace("$(displayName)",y),this.selfItem.contextValue=h?R.SelfMuted:R.Self,this.selfItem.iconPath=T.TreeDataProviderBase.getThemeIconPath(h?"speaker-mute":"speaker")}))}dispose(){return v(this,void 0,void 0,(function*(){for(;this.providerRegistrations.length>0;){const h=this.providerRegistrations.pop();yield h.dispose()}}))}}m.AudioTreeDataProvider=AudioTreeDataProvider},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0});const v=y(1334),C=y(1335);m.registerCommands=h=>{h.register("openSessionChat",v.builder),h.register("startOrJoinCall",C.StartOrJoinCallCommandBuilder)}},function(h,m,y){"use strict";var v=this&&this.__decorate||function(h,m,y,v){var C,T=arguments.length,w=T<3?m:null===v?v=Object.getOwnPropertyDescriptor(m,y):v;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)w=Reflect.decorate(h,m,y,v);else for(var A=h.length-1;A>=0;A--)(C=h[A])&&(w=(T<3?C(w):T>3?C(m,y,w):C(m,y))||w);return T>3&&w&&Object.defineProperty(m,y,w),w},C=this&&this.__awaiter||function(h,m,y,v){return new(y||(y=Promise))((function(C,T){function fulfilled(h){try{step(v.next(h))}catch(h){T(h)}}function rejected(h){try{step(v.throw(h))}catch(h){T(h)}}function step(h){h.done?C(h.value):function adopt(h){return h instanceof y?h:new y((function(m){m(h)}))}(h.value).then(fulfilled,rejected)}step((v=v.apply(h,m||[])).next())}))};Object.defineProperty(m,"__esModule",{value:!0});const T=y(112),w=y(3);m.builder=function builder(){return new A};let A=class OpenSessionChatCommand{invoke(h,m){return C(this,void 0,void 0,(function*(){return yield T.CommunicationsManager.openSessionChat("command_palette")}))}};A=v([w.telemetryCommandDecorator(w.TelemetryEventNames.CHAT_OPEN_SESSION,w.TelemetryEventNames.CHAT_OPEN_SESSION_FAULT,"OpenSessionChat",1)],A)},function(h,m,y){"use strict";var v=this&&this.__decorate||function(h,m,y,v){var C,T=arguments.length,w=T<3?m:null===v?v=Object.getOwnPropertyDescriptor(m,y):v;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)w=Reflect.decorate(h,m,y,v);else for(var A=h.length-1;A>=0;A--)(C=h[A])&&(w=(T<3?C(w):T>3?C(m,y,w):C(m,y))||w);return T>3&&w&&Object.defineProperty(m,y,w),w},C=this&&this.__awaiter||function(h,m,y,v){return new(y||(y=Promise))((function(C,T){function fulfilled(h){try{step(v.next(h))}catch(h){T(h)}}function rejected(h){try{step(v.throw(h))}catch(h){T(h)}}function step(h){h.done?C(h.value):function adopt(h){return h instanceof y?h:new y((function(m){m(h)}))}(h.value).then(fulfilled,rejected)}step((v=v.apply(h,m||[])).next())}))};Object.defineProperty(m,"__esModule",{value:!0});const T=y(112),w=y(3);m.StartOrJoinCallCommandBuilder=function StartOrJoinCallCommandBuilder(){return new A};let A=class StartOrJoinCallCommand{invoke(h,m){return C(this,void 0,void 0,(function*(){const h=T.CommunicationsManager.callingServiceManager;return yield null==h?void 0:h.commandStartOrJoinCall()}))}};A=v([w.telemetryCommandDecorator(w.TelemetryEventNames.START_OR_JOIN_AUDIO,w.TelemetryEventNames.START_OR_JOIN_AUDIO_FAULT,"StartOrJoinCall",1)],A)},function(h,m,y){"use strict";var v=this&&this.__awaiter||function(h,m,y,v){return new(y||(y=Promise))((function(C,T){function fulfilled(h){try{step(v.next(h))}catch(h){T(h)}}function rejected(h){try{step(v.throw(h))}catch(h){T(h)}}function step(h){h.done?C(h.value):function adopt(h){return h instanceof y?h:new y((function(m){m(h)}))}(h.value).then(fulfilled,rejected)}step((v=v.apply(h,m||[])).next())}))};Object.defineProperty(m,"__esModule",{value:!0});const C=y(0),T=y(4),w=y(3);m.ChatService=class ChatService{constructor(h){this.eventEmitter=new C.EventEmitter,this.messageHistory=[],this.participants=new Map,this.disposables=[],this.serviceInfo=T.vsls.ChatService,this.onMessageReceived=this.eventEmitter.event,this.disposables.push(h.workspaceUserService().onWorkspaceSessionChanged(h=>this.onUserSessionChanged(h)));const m=w.workspaceSessionInfoTracker.workspaceSessionInfo;if(!m)throw Error("workspaceSessionInfoTracker.workspaceSessionInfo is not set");const y=m.sessions[m.sessionNumber];this.addOrUpdateParticipant(y,m.sessionNumber)}getMessageHistoryAsync(){return v(this,void 0,void 0,(function*(){return this.messageHistory}))}getParticipantsAsync(){return v(this,void 0,void 0,(function*(){return Array.from(this.participants.values())}))}sendMessageAsync(h,m,y){return v(this,void 0,void 0,(function*(){h.fromId=y.session.toString(),h.type===T.vsls.ChatMessageType.Text&&(200===this.messageHistory.length&&this.messageHistory.shift(),this.messageHistory.push(h)),this.eventEmitter.fire({message:h})}))}dispose(){for(const h of this.disposables)h.dispose();this.disposables=[]}disposeAsync(){return v(this,void 0,void 0,(function*(){this.dispose()}))}onUserSessionChanged(h){this.addOrUpdateParticipant(h.userProfile,h.sessionNumber)}addOrUpdateParticipant(h,m){const y={name:h.name||h.userName,email:h.email,id:m.toString()};this.participants.set(m,y)}}},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0});var v=y(1338);m.HubConnectionServiceFactory=v.HubConnectionServiceFactory;var C=y(1339);m.PresenceServiceProvider=C.PresenceServiceProvider;var T=y(1340);m.RpcHubConnectionServiceFactory=T.RpcHubConnectionServiceFactory},function(h,m,y){"use strict";var v=this&&this.__awaiter||function(h,m,y,v){return new(y||(y=Promise))((function(C,T){function fulfilled(h){try{step(v.next(h))}catch(h){T(h)}}function rejected(h){try{step(v.throw(h))}catch(h){T(h)}}function step(h){h.done?C(h.value):function adopt(h){return h instanceof y?h:new y((function(m){m(h)}))}(h.value).then(fulfilled,rejected)}step((v=v.apply(h,m||[])).next())}))};Object.defineProperty(m,"__esModule",{value:!0});const C=y(3),T=y(2),w=y(80);class HubConnectionServiceFactory extends w.HubConnectionServiceFactory{constructor(h,m,y,v){super(h,m,v),this.contactManager=y}getDefaultStamp(){var h;return v(this,void 0,void 0,(function*(){const m=(new Date).getTime(),y=null===(h=this.contactManager)||void 0===h?void 0:h.getServiceManager(C.constants.LIVESHARE_PRESENCE_PROVIDER_ID),getSelfContactStamp=()=>{var h;return null===(h=null==y?void 0:y.selfUser)||void 0===h?void 0:h.properties.stamp};let v=getSelfContactStamp();const logSelfResolved=()=>{this.logger.verbose(`Default stamp:${v} from self contact t:${(new Date).getTime()-m} ms`)};if(v)return logSelfResolved(),v;const w=new T.Signal;return y&&y.once(C.ContactServiceEvents.SelfContactChanged,()=>{v=getSelfContactStamp(),v&&(logSelfResolved(),w.resolve(v))}),yield Promise.race([this.defaultStampRequest(),w.promise])}))}}m.HubConnectionServiceFactory=HubConnectionServiceFactory},function(h,m,y){"use strict";var v=this&&this.__awaiter||function(h,m,y,v){return new(y||(y=Promise))((function(C,T){function fulfilled(h){try{step(v.next(h))}catch(h){T(h)}}function rejected(h){try{step(v.throw(h))}catch(h){T(h)}}function step(h){h.done?C(h.value):function adopt(h){return h instanceof y?h:new y((function(m){m(h)}))}(h.value).then(fulfilled,rejected)}step((v=v.apply(h,m||[])).next())}))};Object.defineProperty(m,"__esModule",{value:!0});const C=y(4),T=y(110),w=y(3),A=y(80);var P;!function(h){h.email="email",h.displayName="name",h.status="status",h.avatarUri="avatarUri",h.contactId="contactId",h.idReserved="_Id"}(P||(P={}));const k=[P.email,P.displayName,P.status,P.avatarUri],isReservedProperty=h=>void 0!==k.find(m=>h===m),R=[C.contactProtocol.PresenceStatus.Unknown,C.contactProtocol.PresenceStatus.Available,C.contactProtocol.PresenceStatus.Busy,C.contactProtocol.PresenceStatus.DoNotDisturb,C.contactProtocol.PresenceStatus.Away,C.contactProtocol.PresenceStatus.Invisible,C.contactProtocol.PresenceStatus.Offline];class PresenceServiceProvider extends T.ProviderBase{constructor(h,m){super(),this.hubConnectionService=h,this.traceSource=m,this.currentSubscriptions=new Map,this.contactServiceProxy=h.getOrCreateProxy(A.HubProxyType.ContactService),this.contactServiceProxy.onUpdateProperties((h,m,y)=>this.onUpdateProperties(h,m,y)),this.contactServiceProxy.onMessageReceived((h,m,y,v)=>this.onMessageReceived(h,m,y,v)),h.onRunningStateChanged(()=>this.onRunningStateChanged()),h.onConnectionStateChanged(()=>this.onConnectionStateChanged())}requestAsync(h,m,y){const T=Object.create(null,{requestAsync:{get:()=>super.requestAsync}});return v(this,void 0,void 0,(function*(){if(h===C.contactProtocol.Methods.RequestInitializeName)return T.requestAsync.call(this,h,m,y);let v=null;switch(h){case C.contactProtocol.Methods.RequestSendMessageName:yield this.requestSendMessage(m);break;case C.contactProtocol.Methods.RequestInviteName:yield this.requestInvite(m);break;case C.contactProtocol.Methods.RequestPublishPresenceName:yield this.requestPublishPresence(m);break;case C.contactProtocol.Methods.RequestContactPresenceName:v=yield this.requestContactPresence(m);break;case C.contactProtocol.Methods.RequestContactPresenceDisposeName:yield this.requestContactPresenceDispose(m);break;case C.contactProtocol.Methods.RequestSignInName:yield this.requestSignIn(m);break;case C.contactProtocol.Methods.RequestSignOutName:yield this.requestSignOut();break;default:throw new Error(`type:${h} not supported`)}return v}))}requestInitialize(h){return v(this,void 0,void 0,(function*(){this.enablePublish=h.enablePublish,this.publishPresence=h.publishPresence;let m=null;this.isServiceConnected&&(m=PresenceServiceProvider.userInfoToContact(this.userInfo));const y=new C.contactProtocol.InitializeResponse;return y.description="Live Share",y.capabilities=PresenceServiceProvider.createCapabilites(this.capabilitiesEnabled),y.selfContact=m,y.signedState=this.isServiceConnected?C.contactProtocol.SignedStatus.SignedIn:this.isRunning?C.contactProtocol.SignedStatus.SigningIn:C.contactProtocol.SignedStatus.SignedOut,y.providerPriority=0,y}))}get capabilitiesEnabled(){return this.isServiceConnected&&this.isAuthorizedUser}get isAuthorizedUser(){return!w.userAuthStateTracker.isCurrentUserAnonymous()}requestSendMessage(h){return v(this,void 0,void 0,(function*(){yield this.contactServiceProxy.sendMessage({id:h.targetContactId},h.type,h.body)}))}requestInvite(h){return v(this,void 0,void 0,(function*(){const m={Link:h.link,Contact:{id:this.userInfo.id,email:this.userInfo.emailAddress,displayName:this.userInfo.displayName}};yield this.contactServiceProxy.sendMessage({id:h.targetContactId},"inviteLink",m)}))}requestPublishPresence(h){return v(this,void 0,void 0,(function*(){if(this.isPublishEnabled){this.publishPresence=h;const m={};h.status!==C.contactProtocol.PresenceStatus.Unknown&&(m[P.status]=h.status),h.properties&&Object.assign(m,h.properties),this.capabilitiesEnabled&&(yield this.contactServiceProxy.publishProperties(m))}}))}requestContactPresence(h){return v(this,void 0,void 0,(function*(){const m=[],y=[],addEmptyRequestContact=h=>{m.push({contactId:h.id,contact:h})};if(h.contacts.forEach(h=>{if((v=h.id)&&v.length>=36)if(this.currentSubscriptions.has(h.id)){const y=this.currentSubscriptions.get(h.id);y.addSubscriptionCount(),m.push(PresenceServiceProvider.createContactResponse(h,y))}else{const m={};m[P.idReserved]=h.id,y.push({contact:h,properties:m})}else if(h.email&&h.email.length>0){const v=this.findContactSunscriptionByEmail(h.email);if(v)v.addSubscriptionCount(),m.push(PresenceServiceProvider.createContactResponse(h,v));else{const m={};m[P.email]=h.email,y.push({contact:h,properties:m})}}else addEmptyRequestContact(h);var v}),y.length>0){const h=yield this.contactServiceProxy.requestSubcriptions(y.map(h=>h.properties),["*"],!0);for(let v=0;v<h.length;++v){const T=y[v].contact,w=h[v];if(w){const h=new ContactSubscription;h.id=tryGetProperty(w,P.idReserved),h.email=tryGetProperty(w,P.email),h.displayName=tryGetProperty(w,P.displayName),h.avatarUri=tryGetProperty(w,P.avatarUri);const y=tryGetProperty(w,P.status);h.status=y?PresenceServiceProvider.toPresenceStatus(y):C.contactProtocol.PresenceStatus.Unknown,Array.from(Object.keys(w)).forEach(m=>{isReservedProperty(m)||(h.properties[m]=w[m])}),m.push(PresenceServiceProvider.createContactResponse(T,h)),this.currentSubscriptions.set(h.id,h)}else addEmptyRequestContact(T)}}return{contacts:m}}))}requestContactPresenceDispose(h){return v(this,void 0,void 0,(function*(){if(!this.isServiceConnected)return;const m=this.userInfoId,y=h.contactIds.filter(h=>h!==m);if(y.length>0){const h=[];if(y.forEach(m=>{this.currentSubscriptions.has(m)&&this.currentSubscriptions.get(m).removeSubscriptionCount()&&(h.push(m),this.traceSource.verbose(`Remove subscription for contact Id:${m}`),this.currentSubscriptions.delete(m))}),h.length>0){const m=h.map(h=>({id:h}));yield this.contactServiceProxy.removeSubscription(m)}}}))}requestSignIn(h){return v(this,void 0,void 0,(function*(){this.traceSource.verbose("reguestSignIn"),this.signInRequested=!0,yield this.hubConnectionService.setEnabled(!0),this.hubConnectionService.isConnected&&(yield this.signIn())}))}requestSignOut(){return v(this,void 0,void 0,(function*(){this.traceSource.verbose("reguestSignOut"),this.signInRequested=!1,yield this.contactServiceProxy.unregisterSelfContact(),this.signOut(),this.notifySignedOut()}))}onUpdateProperties(h,m,y){this.traceSource.verbose(`onUpdateProperties -> contact Id:${h.id}`);const v=Array.from(Object.keys(m)).filter(h=>!isReservedProperty(h));if(this.currentSubscriptions.has(h.id)){const y=this.currentSubscriptions.get(h.id);let C;C=tryGetProperty(m,P.email),C&&(y.email=C),C=tryGetProperty(m,P.displayName),C&&(y.displayName=C),C=tryGetProperty(m,P.avatarUri),C&&(y.avatarUri=C),C=tryGetProperty(m,P.status),C&&(y.status=C),v.forEach(h=>y.properties[h]=m[h])}m.hasOwnProperty(P.status)&&this.notifyPresenceChanged(h.id,PresenceServiceProvider.toPresenceStatus(m[P.status]));const C=Array.from(Object.keys(m)).filter(h=>h!==P.status&&isReservedProperty(h)).map(h=>({property:PresenceServiceProvider.toContactProperty(h),value:m[h]}));if(C.length>0&&this.notifyContactChanged(h.id,C),v.length>0){const y={};v.forEach(h=>y[h]=m[h]),this.notifyContactPropertiesChanged(h.id,y)}}onMessageReceived(h,m,y,v){if("inviteLink"===y){const h=v,y=new C.contactProtocol.InviteReceivedNotification;y.fromContactId=m.id,y.link=h.Link,y.fromContact=h.Contact,this.notify(C.contactProtocol.Methods.NotifyInviteReceivedName,y)}else{const h=new C.contactProtocol.MessageReceivedNotification;h.fromContactId=m.id,h.body=v,h.type=y,this.notify(C.contactProtocol.Methods.NotifyMessageReceivedName,h)}}publishUserInfo(h){return v(this,void 0,void 0,(function*(){this.traceSource.verbose(`publishUserInfo -> id:${h.id} email:${h.emailAddress}`);let m={};m[P.email]=h.emailAddress,m[P.displayName]=h.displayName,m[P.status]=C.contactProtocol.PresenceStatus.Available,m[P.avatarUri]=h.avatarUri,this.publishPresence&&(m[P.status]=this.publishPresence.status,this.publishPresence.properties&&Object.assign(m,this.publishPresence.properties)),this.isPublishEnabled||(m={});const y=yield this.contactServiceProxy.registerSelfContact(h.id,m);this.notify(C.contactProtocol.Methods.NotifySelfContactName,{contact:PresenceServiceProvider.userInfoToContact(h),registrationInfo:y})}))}get userInfo(){return this.hubConnectionService.userInfo}get userInfoId(){var h;return null===(h=this.userInfo)||void 0===h?void 0:h.id}get isServiceConnected(){return this.hubConnectionService.isConnected}get isRunning(){return this.hubConnectionService.isRunning}get isPublishEnabled(){return!this.enablePublish||!0===this.enablePublish}findContactSunscriptionByEmail(h){return Array.from(this.currentSubscriptions.values()).find(m=>m.email===h)}notifyCurrentCapabilites(h){this.notify(C.contactProtocol.Methods.NotifyCapabilitiesUpdateName,PresenceServiceProvider.createCapabilites(void 0===h?this.capabilitiesEnabled:h))}onRunningStateChanged(){this.isRunning?this.signInRequested&&this.notifySigningIn():this.notifySignedOut()}notifySigningIn(){this.notifySignedStateChanged(C.contactProtocol.SignedStatus.SigningIn)}notifySignedIn(){this.notifySignedStateChanged(C.contactProtocol.SignedStatus.SignedIn)}notifySignedOut(){this.notifySignedStateChanged(C.contactProtocol.SignedStatus.SignedOut)}onConnectionStateChanged(){return v(this,void 0,void 0,(function*(){this.hubConnectionService.isConnected?this.signInRequested&&(yield this.signIn()):(this.signOut(),this.notifySignedStateChanged(this.isRunning&&this.signInRequested?C.contactProtocol.SignedStatus.SigningIn:C.contactProtocol.SignedStatus.SignedOut))}))}signIn(){return v(this,void 0,void 0,(function*(){this.isAuthorizedUser&&(yield this.publishUserInfo(this.userInfo)),this.notifyCurrentCapabilites(),this.notifySignedIn()}))}signOut(){this.currentSubscriptions.clear(),this.notifyCurrentCapabilites(!1),this.notifyPresenceChanged(this.userInfoId,C.contactProtocol.PresenceStatus.Offline)}static toContactProperty(h){switch(h){case P.email:return C.contactProtocol.ContactProperty.Email;case P.displayName:return C.contactProtocol.ContactProperty.DisplayName;case P.status:return C.contactProtocol.ContactProperty.Status;case P.avatarUri:return C.contactProtocol.ContactProperty.AvatarUri;default:throw new Error("Invaild property")}}static createCapabilites(h){const m=new C.contactProtocol.Capabilities;return m.supportsDispose=h,m.supportsPresence=h,m.supportsPublishPresence=h,m.supportsInviteLink=h,m.supportsSelfContact=h,m.supportsContactPresenceRequest=h,m.supportsMessageRequest=h,m.supportedPresenceStatus=[C.contactProtocol.PresenceStatus.Available,C.contactProtocol.PresenceStatus.DoNotDisturb,C.contactProtocol.PresenceStatus.Away],m.supportsSignedStateRequest=!0,m}static userInfoToContact(h){const m=new C.contactProtocol.Contact;return m.id=h.id,m.email=h.emailAddress,m.displayName=h.displayName,m.status=C.contactProtocol.PresenceStatus.Available,m.avatarUri=h.avatarUri,m}static createContactResponse(h,m){return{contactId:h.id,contact:{id:m.id,email:h.email?h.email:m.email,displayName:h.displayName?h.displayName:m.displayName,avatarUri:h.avatarUri?h.avatarUri:m.avatarUri,status:m.status},properties:m.properties}}static toPresenceStatus(h){return Number.isInteger(h)?R[h]:h}}m.PresenceServiceProvider=PresenceServiceProvider;class ContactSubscription extends C.contactProtocol.Contact{constructor(){super(),this.counter=1,this.properties={}}addSubscriptionCount(){++this.counter}removeSubscriptionCount(){return--this.counter,0===this.counter}}function tryGetProperty(h,m){if(h.hasOwnProperty(m))return h[m]}},function(h,m,y){"use strict";var v=this&&this.__awaiter||function(h,m,y,v){return new(y||(y=Promise))((function(C,T){function fulfilled(h){try{step(v.next(h))}catch(h){T(h)}}function rejected(h){try{step(v.throw(h))}catch(h){T(h)}}function step(h){h.done?C(h.value):function adopt(h){return h instanceof y?h:new y((function(m){m(h)}))}(h.value).then(fulfilled,rejected)}step((v=v.apply(h,m||[])).next())}))};Object.defineProperty(m,"__esModule",{value:!0});const C=y(6),T=y(4),w=y(80),A=y(16),P=y(1341);class RpcHubConnectionServiceFactory extends w.HubConnectionServiceFactoryBase{constructor(h,m,y,v){super(y,v),this.rpcClient=h,this.hubAuthentication=m,this.trace=v,this.rpcHubConnectionService=A.RpcProxy.create(w.rpcHubConnectionServiceInfo,h,v.withName("RpcHubConnectionService"))}createHubConnectionService(h,m,y){return v(this,void 0,void 0,(function*(){const m=yield this.rpcHubConnectionService.getOrCreateAsync(h,C.CancellationToken.None);return new RpcHubConnectionService(m,this.rpcClient,this.rpcHubConnectionService,this.hubAuthentication,this.trace)}))}}m.RpcHubConnectionServiceFactory=RpcHubConnectionServiceFactory;class RpcHubConnectionService extends w.HubConnectionServiceBase{constructor(h,m,y,v,C){super(v,C),this.hubInfo=h,this.rpcHubConnectionService=y,this.isConnectedFlag=!1,this.isRunningFlag=!1;const w=Object.assign(Object.assign({},T.vsls.HubConnectionService),{name:`${T.vsls.HubConnectionService.name}:${this.hubId}`}),k=A.RpcProxy.create(w,m,C.withName("vsls.HubConnectionService"));this.hubProxyInstance=new P.HubProxy(k,h.isConnected,C.withName("HubProxy")),this.enabledFlag=h.isEnabled,this.isConnectedFlag=h.isConnected,this.isRunningFlag=h.isRunning,super.setCurrentUserInfo(h.authUserInfo),y.onAttemptConnection(h=>{h.hubId===this.hubId&&this.attemptConnectionEmitter.fire(h)}),y.onConnectionStateChanged(h=>{h.hubId===this.hubId&&(this.isConnectedFlag=h.state,this.connectionStateChangedEmitter.fire())}),y.onRunningStateChanged(h=>{h.hubId===this.hubId&&(this.isRunningFlag=h.state,this.runningStateChangedEmitter.fire())})}get hubId(){return this.hubInfo.hubId}setEnabled(h){const m=Object.create(null,{setEnabled:{get:()=>super.setEnabled}});return v(this,void 0,void 0,(function*(){this.enabled!==h&&(yield m.setEnabled.call(this,h),yield this.rpcHubConnectionService.setHubEnabledAsync(this.hubId,h))}))}setCurrentUserInfo(h){h&&h.accessToken&&h.userInfo&&super.setCurrentUserInfo(h)}get hubProxy(){return this.hubProxyInstance}get isConnected(){return this.isConnectedFlag&&this.enabled}get isRunning(){return this.isRunningFlag}updateHubClientConnection(){this.rpcHubConnectionService.setHubAuthenticateInfoAsync(this.hubId,this.currentUserInfo).catch(h=>{this.traceSource.error("Failed to set hub auth info",h)})}}},function(h,m,y){"use strict";var v=this&&this.__awaiter||function(h,m,y,v){return new(y||(y=Promise))((function(C,T){function fulfilled(h){try{step(v.next(h))}catch(h){T(h)}}function rejected(h){try{step(v.throw(h))}catch(h){T(h)}}function step(h){h.done?C(h.value):function adopt(h){return h instanceof y?h:new y((function(m){m(h)}))}(h.value).then(fulfilled,rejected)}step((v=v.apply(h,m||[])).next())}))};Object.defineProperty(m,"__esModule",{value:!0});const C=y(2);m.HubProxy=class HubProxy{constructor(h,m,y){this.hubConnectionService=h,this.trace=y,this.onHubMethods=new Map,this.onConnectionStateChangedCallbacks=[],this.isConnectedValue=m,h.onHubMethodNotified(h=>this.onHubMethodNotified(h)),h.onHubConnectionStateChanged(h=>v(this,void 0,void 0,(function*(){this.isConnectedValue=h.isConnected,yield Promise.all(this.onConnectionStateChangedCallbacks.map(h=>h()))})))}onConnectionStateChanged(h){return this.onConnectionStateChangedCallbacks.push(h),{dispose:()=>{const m=this.onConnectionStateChangedCallbacks.indexOf(h);-1!==m&&this.onConnectionStateChangedCallbacks.splice(m,1)}}}get isConnected(){return this.isConnectedValue}connect(){C.notImplemented()}send(h,...m){return this.hubConnectionService.sendHubMethodAsync(h,m)}invoke(h,...m){return v(this,void 0,void 0,(function*(){return yield this.hubConnectionService.invokeHubMethodAsync(h,"object",m)}))}on(h,m){const y=new Array(m.length).fill("object");return this.hubConnectionService.registerHubMethodNotifyAsync(h,y).catch(m=>{this.trace.error(`Failed to register method:${h}`,m)}),this.onHubMethods.set(h,m),{dispose:()=>{this.hubConnectionService.unregisterHubMethodNotifyAsync(h).catch(m=>{this.trace.error(`Failed to unregister method:${h}`,m)})}}}onHubMethodNotified(h){const m=this.onHubMethods.get(h.methodName);if(m){let y=h.parameters;y&&(y=y.map(h=>"Buffer"===(null==h?void 0:h.type)&&(null==h?void 0:h.data)?null==h?void 0:h.data:h)),m(...y)}}}},function(h,m,y){"use strict";var v=this&&this.__awaiter||function(h,m,y,v){return new(y||(y=Promise))((function(C,T){function fulfilled(h){try{step(v.next(h))}catch(h){T(h)}}function rejected(h){try{step(v.throw(h))}catch(h){T(h)}}function step(h){h.done?C(h.value):function adopt(h){return h instanceof y?h:new y((function(m){m(h)}))}(h.value).then(fulfilled,rejected)}step((v=v.apply(h,m||[])).next())}))};Object.defineProperty(m,"__esModule",{value:!0});const C=y(0),T=y(35),w=y(228),A=y(6),P=y(3),k=y(4),R=y(8),M=y(16),N=y(169);var D;!function(h){h.Automatic="Automatic",h.Manual="Manual",h.Prompt="Prompt"}(D=m.JoinDebugSessionOption||(m.JoinDebugSessionOption={}));class JoinDebugManager{constructor(h,m,y,v,C,w){this.debuggerHostService=h,this.sessionContext=m,this.fileSystemManager=y,this.pathManager=v,this.clientAccessCheck=C,this.trace=w,this.activeJoinedDebugSessions=new Map,this.sharedDebugSessions=[],this.delayedStartDebugSessions=[],this.unmodifiedLaunchConfigurations=new Map,this.eventRegistrations=[],this.joinUniqueId=T()}init(){return v(this,void 0,void 0,(function*(){this.debuggerHostService.onDebugSessionChanged(this.onDebugSessionChanged,this,this.eventRegistrations),this.debuggerHostService.onLaunchConfigurationsChanged(this.onLaunchConfigurationsChanged,this,this.eventRegistrations),C.debug.registerDebugConfigurationProvider("*",this),C.debug.onDidStartDebugSession(this.onDidStartDebugSession,this,this.eventRegistrations),C.debug.onDidTerminateDebugSession(this.onDidTerminateDebugSession,this,this.eventRegistrations);const h=R.Telemetry.startTimedEvent(P.TelemetryEventNames.INITIALIZE_DEBUGGING,!0);try{this.sharedDebugSessions=yield this.debuggerHostService.getCurrentDebugSessionsAsync()}catch(h){if(h.code!==M.RpcErrorCodes.ServiceNotAvailable)throw h;this.sharedDebugSessions=[]}if(h.addMeasure(P.TelemetryPropertyNames.NUM_DEBUGGING_PROCESSES,this.sharedDebugSessions?this.sharedDebugSessions.length:0),this.sharedDebugSessions&&this.sharedDebugSessions.length>0){const m=this.sharedDebugSessions.slice(0),launchAll=()=>{const h=m.map(h=>this.isDebugSessionValid(h)?this.joinDebugSession(h):null);return Promise.all(h)},launchAllInvoke=()=>{launchAll().catch(h=>{this.trace.error("Failed to launch debug sessions",h)})};if(h.addProperty(P.TelemetryPropertyNames.DEBUG_PROMPT,(this.joinDebugSessionOptionValue===D.Prompt).toString()),this.joinDebugSessionOptionValue===D.Automatic)launchAllInvoke();else if(this.joinDebugSessionOptionValue===D.Prompt){(yield C.window.showInformationMessage("The host is already in a collaborative debugging session that you can join",{title:"Join session now"}))&&launchAllInvoke()}}try{this.setLaunchConfigurations(yield this.debuggerHostService.getLaunchConfigurationsAsync())}catch(h){if(this.trace.error("Failed to get launch configurations",h),h.code!==M.RpcErrorCodes.MethodNotFound&&h.code!==M.RpcErrorCodes.ServiceNotAvailable)throw h;this.setLaunchConfigurations(null)}const m=this.fileSystemManager.workspaceProvider;m&&(m.registerWorkspaceProvider(this),this.fireLaunchConfigurationsChanged(m)),h.end(R.TelemetryResult.Success),this.isInited=!0}))}dispose(){return this.eventRegistrations.forEach(h=>h.dispose()),Promise.resolve()}resolveDebugConfiguration(h,m,y){return v(this,void 0,void 0,(function*(){if(this.trace.verbose(`resolveDebugConfiguration configuration:${JSON.stringify(m)}`),"vslsJoin"===m.type&&m.joinUniqueId)return m;if("vslsJoin"!==m.type)return"vslsShare"===m.type&&(m=m.adapterProxy.configuration),yield this.launchRemoteDebugConfiguration(h,m);if(!m.debugSession){const y=this.sharedDebugSessions.find(h=>(h.configurationProperties&&h.configurationProperties.name?h.configurationProperties.name:h.name)===m.name);if(!y||y.configurationProperties&&y.configurationProperties.launchUniqueId)return yield this.launchRemoteDebugConfiguration(h,m);m=this.toDebugConfiguration(y)}return m.joinUniqueId=this.joinUniqueId,yield this.setupDebugConfiguration(m),m}))}getAvailableDebugSessions(){return this.sharedDebugSessions.filter(h=>!this.activeJoinedDebugSessions.has(h.sessionId))}joinDebugSession(h){var m;return v(this,void 0,void 0,(function*(){const y=C.workspace.workspaceFolders;N.activitySource.fire({timestamp:new Date,name:`${N.ActivityType.debug}/join`});let v=void 0;const T=null===(m=null==h?void 0:h.configurationProperties)||void 0===m?void 0:m.__parentId;if(T){const m=this.activeJoinedDebugSessions.get(T);if(!m)return void this.delayedStartDebugSessions.push(h);v={parentSession:m,compact:!0}}yield C.debug.startDebugging(y?y[0]:void 0,this.toDebugConfiguration(h),v)}))}onReadFile(h){return v(this,void 0,void 0,(function*(){const{moniker:m}=P.PathUtil.getMonikerFromRelativePath(h.path);if("0"!==m&&m)return;if(!this.isLaunchConfigurationsExists()||h.path!==JoinDebugManager.vscodeLaunchPath)return;h.exists=!0;const y="string"==typeof this.rawLaunchConfigurationData;h.text=y?this.rawLaunchConfigurationData.toString():JSON.stringify(this.rawLaunchConfigurationData,null,4),h.attributes=y?void 0:k.vsls.FileAttributes.Hidden}))}onReadDirectory(h){return v(this,void 0,void 0,(function*(){if(h.length<1||!this.isLaunchConfigurationsExists())return;const m=h[0],{moniker:y}=P.PathUtil.getMonikerFromRelativePath(m.path);if("0"!==y&&y)return;if("/"===m.path&&!m.children.some(h=>h.path===JoinDebugManager.vscodePath))return void m.children.push({path:JoinDebugManager.vscodePath,isDirectory:!0,hasChildren:!0});if(m.path!==JoinDebugManager.vscodePath||m.children&&m.children.find(h=>h.path===JoinDebugManager.vscodeLaunchPath))return;m.exists=!0,m.isDirectory=!0;const v={path:JoinDebugManager.vscodeLaunchPath,isDirectory:!1,hasChildren:!1};m.children||(m.children=[]),m.children.push(v)}))}onStat(h){return v(this,void 0,void 0,(function*(){const m=h[0];if(!m||m.exists||!this.isLaunchConfigurationsExists())return;const{moniker:y}=P.PathUtil.getMonikerFromRelativePath(m.path);"0"!==y&&y||m.path!==JoinDebugManager.vscodePath&&m.path!==JoinDebugManager.vscodeLaunchPath||(m.exists=!0,m.mtime=new Date(0),m.isDirectory=m.path===JoinDebugManager.vscodePath)}))}canAttach(){return this.getAvailableDebugSessions().length>0}attach(){return v(this,void 0,void 0,(function*(){if(P.sessionStateTracker.State!==P.SessionState.Joined)throw new Error("Not currently in a collaboration session.");let h=this.getAvailableDebugSessions();if(0!==h.length)if(1===h.length)yield P.ExtensionUtil.runWithProgress(()=>this.joinDebugSession(h[0]),{title:"Joining Debug Session..."});else{let m=[];h.forEach(h=>{m.push({label:h.name})});let y=yield C.window.showQuickPick(m,{placeHolder:"Select the debug session"});if(y){let m=h.filter(h=>h.name===y.label)[0];yield P.ExtensionUtil.runWithProgress(()=>this.joinDebugSession(m),{title:"Joining Debug Session..."})}}else yield C.window.showInformationMessage("No debug session available to join")}))}setupDebugConfiguration(h){return Promise.resolve()}launchRemoteDebugConfiguration(h,m){return v(this,void 0,void 0,(function*(){this.trace.verbose(`launchRemoteDebugConfiguration workspaceFolder:${JSON.stringify(h)} configuration:${JSON.stringify(m)}`);const y=this.sessionContext.coeditingClient.clientID;yield this.clientAccessCheck.verifyCanPerformOperation(y,JoinDebugManager.launchDebugOperation);const v=this.unmodifiedLaunchConfigurations.get(h?h.index.toString():"0");if(!v)return this.trace.warning("No configuration root"),null;let T=v.find(h=>h.name===m.name);if(!T)return this.trace.error(`Failed to find remote configuration:${m.name}`),null;{const y={};Object.assign(y,T),y.launchUniqueId=this.joinUniqueId,m.noDebug&&(y.noDebug=!0),h&&(y.__workspaceIndex=h.index);try{this.trace.verbose(`launchDebugSessionAsync remoteDebugConfiguration:${JSON.stringify(y)}`),yield this.debuggerHostService.launchDebugSessionAsync(y)}catch(h){if(this.trace.error("Failed to launch remote debug session",h),!(h instanceof A.ResponseError&&h.code===k.vsls.ErrorCodes.RemoteLaunchNotEnabled))throw h;yield C.window.showInformationMessage(P.ExtensionUtil.getErrorString(k.vsls.ErrorCodes.RemoteLaunchNotEnabled))}}}))}onDidStartDebugSession(h){return v(this,void 0,void 0,(function*(){if("vslsJoin"===h.type){this.trace.info(`Starting joined debug session:${h.id} name:${h.name}`);let m=(yield h.customRequest("debugSessionId")).Id;this.activeJoinedDebugSessions.set(m,h);let y=!0;this.sharedDebugSessions.find(h=>h.sessionId===m)||(this.trace.verbose(`Terminate ${h.id} due to removed shared debug session id:${m}`),h.customRequest("forceTerminate"),y=!1),this.delayedStartDebugSessions=this.delayedStartDebugSessions.filter(h=>h.configurationProperties.__parentId!==m||(y&&this.joinDebugSession(h).catch(h=>{this.trace.error("Failed to join debug session",h)}),!1))}}))}onDidTerminateDebugSession(h){if("vslsJoin"===h.type){this.trace.info(`Terminate joined debug session:${h.id}`);for(let[m,y]of this.activeJoinedDebugSessions)if(y.id===h.id){this.activeJoinedDebugSessions.delete(m),this.sharedDebugSessions.forEach(h=>{if(h.configurationProperties.__parentId===m){this.activeJoinedDebugSessions.get(h.sessionId).customRequest("forceTerminate")}});const h=this.sharedDebugSessions.findIndex(h=>h.configurationProperties&&h.sessionId===m&&h.configurationProperties.launchUniqueId===this.joinUniqueId);h>=0&&this.sharedDebugSessions.splice(h);break}}}get joinDebugSessionOptionValue(){const h=P.Settings.get(P.SettingKeys.joinDebugSessionOption);return D[h]}toDebugConfiguration(h){const m=h.configurationProperties&&h.configurationProperties.launchUniqueId===this.joinUniqueId,y=h.configurationProperties&&h.configurationProperties.noDebug;return{type:"vslsJoin",request:m?"launch":"attach",name:h.name,noDebug:y,debugSession:h,debugServer:P.Settings.get("debugAdapter"),enableMultipleRoots:!0}}onDebugSessionChanged(h){return v(this,void 0,void 0,(function*(){if(h.changeType===k.vsls.DebugSessionChangeType.Add){if(this.trace.info(`Host debug session started:${h.debugSession.sessionId}`),this.sharedDebugSessions.push(h.debugSession),this.joinDebugSessionOptionValue===D.Automatic)yield this.joinDebugSession(h.debugSession);else if(this.joinDebugSessionOptionValue===D.Prompt){(yield C.window.showInformationMessage(`The host has started a collaborative debugging session ('${h.debugSession.name}') that you can join`,{title:"Join session now"}))&&this.isDebugSessionValid(h.debugSession)&&(yield this.joinDebugSession(h.debugSession))}}else if(h.changeType===k.vsls.DebugSessionChangeType.Remove){const m=h.debugSession.sessionId;this.trace.info(`Host debug session removed:${m}`);const y=this.sharedDebugSessions.findIndex(h=>h.sessionId===m);y>=0&&this.sharedDebugSessions.splice(y,1),this.activeJoinedDebugSessions.has(h.debugSession.sessionId)&&(this.trace.verbose(`Attempt to terminate joined debug session:${h.debugSession.sessionId}`),yield this.activeJoinedDebugSessions.get(h.debugSession.sessionId).customRequest("forceTerminate"))}}))}isDebugSessionValid(h){return void 0!==this.sharedDebugSessions.find(m=>m.sessionId===h.sessionId)}setLaunchConfigurations(h){if(this.trace.verbose("->setLaunchConfigurations"),this.unmodifiedLaunchConfigurations=new Map,this.rawLaunchConfigurationData=h,!h)return;let m=h;if("string"==typeof h)try{m=w.parse(h)}catch(h){return void this.trace.error("Failed to parse launch configuration",h)}if(this.unmodifiedLaunchConfigurations.set("0",m.configurations instanceof Array?m.configurations:[]),!m.configurationsByRoot)return;const y=m.configurationsByRoot,v=Object.keys(y);for(let h of v){const m=y[h];m&&m.configurations instanceof Array&&this.unmodifiedLaunchConfigurations.set(h,m.configurations)}}isLaunchConfigurationsExists(){return null!=this.rawLaunchConfigurationData}onLaunchConfigurationsChanged(h){this.setLaunchConfigurations(h.launchConfigurations);const m=this.fileSystemManager.workspaceProvider;m&&this.fireLaunchConfigurationsChanged(m)}fireLaunchConfigurationsChanged(h){const m={type:C.FileChangeType.Changed,uri:this.pathManager.relativePathToLocalPath(JoinDebugManager.vscodeLaunchPath)};h.fireFilesChanged([m])}}m.JoinDebugManager=JoinDebugManager,JoinDebugManager.vscodePath="/.vscode",JoinDebugManager.vscodeLaunchPath=`${JoinDebugManager.vscodePath}/launch.json`,JoinDebugManager.launchDebugOperation={name:P.WellKnownRestrictedOperations.LaunchDebug}},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0});const v=y(0),C=y(1344),T=y(113),w=y(113);m.JoinDebugAdapterDescriptorFactory=class JoinDebugAdapterDescriptorFactory{constructor(h,m,y){this.workspaceServices=h,this.rpcFactory=m,this.trace=y}createDebugAdapterDescriptor(h,m){const y=h.configuration.debugSession;this.trace.verbose(`creating JoinDebugSession for id:${h.id} sessionId:${y.sessionId}`);const A=`${w.debugSessionHostService.name}-${y.sessionId}`,P={name:A,methods:T.debugSessionHostService.methods,events:T.debugSessionHostService.events},k=this.rpcFactory(P,P.name),R=new C.JoinDebugSession(k,y,this.trace.withName(`JoinDebugSession:${y.sessionId}`)),M=this.workspaceServices.onServiceRemoved(h=>{h===A&&(this.trace.verbose(`force terminate sessionId:${y.sessionId}`),R.forceTerminate(),M.dispose())});return new v.DebugAdapterInlineImplementation(R)}}},function(h,m,y){"use strict";var v=this&&this.__awaiter||function(h,m,y,v){return new(y||(y=Promise))((function(C,T){function fulfilled(h){try{step(v.next(h))}catch(h){T(h)}}function rejected(h){try{step(v.throw(h))}catch(h){T(h)}}function step(h){h.done?C(h.value):function adopt(h){return h instanceof y?h:new y((function(m){m(h)}))}(h.value).then(fulfilled,rejected)}step((v=v.apply(h,m||[])).next())}))};Object.defineProperty(m,"__esModule",{value:!0});const C=y(300),T=y(300),w=y(113),A=y(300),P=y(16),k=y(304);class JoinDebugSession extends C.DebugSession{constructor(h,m,y){super(),this.debugSessionHostService=h,this.debugSession=m,this.trace=y,this.seq=0,this.stoppedEvent=void 0,this.terminateOnDisconnect=!1}forceTerminate(){this.sendEvent(new T.TerminatedEvent)}get isStopped(){return void 0!==this.stoppedEvent}initializeRequest(h,m){return v(this,void 0,void 0,(function*(){h.body=this.debugSession.capabilities,this.sendResponse(h),this.sendEvent(new T.InitializedEvent),yield this.initializeHostRequest()}))}customRequest(h,m,y,v){switch(h){case"debugSessionId":m.body={Id:this.debugSession.sessionId};break;case"forceTerminate":this.forceTerminate()}return this.sendResponse(m),Promise.resolve()}configurationDoneRequest(h,m){super.configurationDoneRequest(h,m)}launchRequest(h,m,y){this.terminateOnDisconnect=!0,this.attachToEvents(),this.sendResponse(h)}attachRequest(h,m,y){this.attachToEvents(),this.sendResponse(h)}stackTraceRequest(h,m,y){return v(this,void 0,void 0,(function*(){if(this.isStopped){let v=k.getStackTrace(m,this.stoppedEvent,y);h.body=v||(yield this.handleProtocolRequest(y.command,m))}this.sendResponse(h)}))}scopesRequest(h,m,y){return v(this,void 0,void 0,(function*(){if(this.isStopped){const v=m.frameId.toString();this.stoppedEvent.scopes.hasOwnProperty(v)?h.body={scopes:this.stoppedEvent.scopes[v]}:h.body=yield this.handleProtocolRequest(y.command,m)}this.sendResponse(h)}))}variablesRequest(h,m,y){return v(this,void 0,void 0,(function*(){this.isStopped&&(h.body=yield this.handleProtocolRequest(y.command,m)),this.sendResponse(h)}))}sourceRequest(h,m,y){return v(this,void 0,void 0,(function*(){if(this.isStopped){let v=m.source.sourceReference?m.source.sourceReference.toString():void 0;this.stoppedEvent.sourceReferenceContent&&v&&this.stoppedEvent.sourceReferenceContent.hasOwnProperty(v)?h.body=this.stoppedEvent.sourceReferenceContent[v]:h.body=yield this.handleProtocolRequest(y.command,m)}this.sendResponse(h)}))}setBreakPointsRequest(h,m,y){return v(this,void 0,void 0,(function*(){const v=m.source.path;h.body=yield this.handleProtocolRequest(y.command,m),h.body.breakpoints.forEach(h=>{h.source&&(h.source.path=v)}),this.sendResponse(h)}))}setVariableRequest(h,m,y){return v(this,void 0,void 0,(function*(){h.body=yield this.handleProtocolRequest(y.command,m),this.sendResponse(h)}))}setExpressionRequest(h,m,y){return v(this,void 0,void 0,(function*(){h.body=yield this.handleProtocolRequest(y.command,m),this.sendResponse(h)}))}evaluateRequest(h,m,y){return v(this,void 0,void 0,(function*(){h.body=yield this.handleProtocolRequest(y.command,m),this.sendResponse(h)}))}threadsRequest(h,m){return this.isStopped&&(h.body={threads:this.stoppedEvent.threads}),this.sendResponse(h),Promise.resolve()}disconnectRequest(h,m,y){return v(this,void 0,void 0,(function*(){this.sendResponse(h),this.shutdown(),this.terminateOnDisconnect&&(yield this.handleProtocolRequest("terminate"))}))}continueRequest(h,m,y){return v(this,void 0,void 0,(function*(){yield this.continue(w.ContinueReason.Go,m.threadId),this.sendResponse(h)}))}nextRequest(h,m,y){return v(this,void 0,void 0,(function*(){yield this.continue(w.ContinueReason.StepOver,m.threadId),this.sendResponse(h)}))}stepInRequest(h,m,y){return v(this,void 0,void 0,(function*(){yield this.continue(w.ContinueReason.StepIn,m.threadId),this.sendResponse(h)}))}stepOutRequest(h,m,y){return v(this,void 0,void 0,(function*(){yield this.continue(w.ContinueReason.StepOut,m.threadId),this.sendResponse(h)}))}restartRequest(h,m,y){return v(this,void 0,void 0,(function*(){h.body=yield this.handleProtocolRequest(y.command,m),this.sendResponse(h)}))}pauseRequest(h,m,y){return v(this,void 0,void 0,(function*(){h.body=yield this.handleProtocolRequest(y.command,m),this.sendResponse(h)}))}loadedSourcesRequest(h,m,y){return v(this,void 0,void 0,(function*(){h.body=yield this.handleProtocolRequest(y.command,m),this.sendResponse(h)}))}attachToEvents(){this.debugSessionHostService.onDebugEvent(this.onDebugEvent,this),this.debugSessionHostService.onUIDebugEvent(this.onUIDebugEvent,this)}onDebugEvent(h){let m={seq:this.seq++,type:"event",event:h.body.type,body:h.body};if(this.trace.verbose(`onDebugEvent event:${m.event}`),"uiStopped"===m.event){const h=m;this.continueReason=void 0;const y=h.body,v=y.threads?y.threads:y.Threads,C=y.stackFrames?y.stackFrames:y.StackFrames,w=y.scopes?y.scopes:y.Scopes,A=y.sourceReferenceContent?y.sourceReferenceContent:y.SourceReferenceContent;this.stoppedEvent={threads:v,stackFrames:C,scopes:w,sourceReferenceContent:A},this.trace.verbose(`onDebugEvent:stoppedEvent -> reason:${h.body.reason}`),m=new T.StoppedEvent(h.body.reason,h.body.threadId)}this.sendEvent(m)}onUIDebugEvent(h){if(this.trace.verbose(`onUIDebugEvent event:${h.body.type}`),"enterRunMode"===h.body.type&&void 0===this.continueReason){const m=h.body;2!==m.Reason&&8!==m.Reason||(this.trace.verbose(`onUIDebugEvent::EnterRunMode threadId:${m.ThreadId} reason:${m.Reason}`),this.stoppedEvent=void 0,this.sendEvent(new A.ContinuedEvent(m.ThreadId)))}}handleProtocolRequest(h,m){return v(this,void 0,void 0,(function*(){try{return yield this.debugSessionHostService.handleProtocolRequestAsync(h,m)}catch(m){throw this.trace.error(`Failed to handleProtocolRequest for type:${h}. Error:${m}`),m}}))}continue(h,m){return v(this,void 0,void 0,(function*(){this.stoppedEvent=void 0,this.continueReason=h,this.trace.verbose(`Continue->reason:${h}`);try{yield this.debugSessionHostService.continueAsync(h,m),this.trace.verbose("Continue <---")}catch(h){h.code===P.RpcErrorCodes.ServiceNotAvailable&&this.trace.verbose("Continue <---disconnected")}}))}initializeHostRequest(){return v(this,void 0,void 0,(function*(){const h=!0===this.debugSession.capabilities.SupportsModulesRequest;let m;try{const y={includeModules:h};m=yield this.debugSessionHostService.initializeRequestAsync(y)}catch(h){if(h.code!==P.RpcErrorCodes.MethodNotFound){if(h.code===P.RpcErrorCodes.ServiceNotAvailable)return void this.sendEvent(new T.TerminatedEvent);throw h}m={stoppedEvent:yield this.debugSessionHostService.getCurrentStoppedEventAsync(),outputEvents:[],replayEvents:[],modulesResponse:null}}if(null!=m.stoppedEvent){const h={body:m.stoppedEvent};h.body.type="uiStopped",this.trace.verbose(`initializeHostRequest -> stoppedEvent reason:${h.body.reason}`),"entry"===h.body.reason&&(h.body.reason="breakpoint"),this.onDebugEvent(h)}}))}}m.JoinDebugSession=JoinDebugSession},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0}),m.ProtocolServer=void 0;const v=y(13),C=y(302);class Emitter{get event(){return this._event||(this._event=(h,m)=>{let y;return this._listener=h,this._this=m,y={dispose:()=>{this._listener=void 0,this._this=void 0}},y}),this._event}fire(h){if(this._listener)try{this._listener.call(this._this,h)}catch(h){}}hasListener(){return!!this._listener}dispose(){this._listener=void 0,this._this=void 0}}class ProtocolServer extends v.EventEmitter{constructor(){super(),this._sendMessage=new Emitter,this._pendingRequests=new Map,this.onDidSendMessage=this._sendMessage.event}dispose(){}handleMessage(h){if("request"===h.type)this.dispatchRequest(h);else if("response"===h.type){const m=h,y=this._pendingRequests.get(m.request_seq);y&&(this._pendingRequests.delete(m.request_seq),y(m))}}_isRunningInline(){return this._sendMessage&&this._sendMessage.hasListener()}start(h,m){this._sequence=1,this._writableStream=m,this._rawData=Buffer.alloc(0),h.on("data",h=>this._handleData(h)),h.on("close",()=>{this._emitEvent(new C.Event("close"))}),h.on("error",h=>{this._emitEvent(new C.Event("error","inStream error: "+(h&&h.message)))}),m.on("error",h=>{this._emitEvent(new C.Event("error","outStream error: "+(h&&h.message)))}),h.resume()}stop(){this._writableStream&&this._writableStream.end()}sendEvent(h){this._send("event",h)}sendResponse(h){h.seq>0?console.error(`attempt to send more than one response for command ${h.command}`):this._send("response",h)}sendRequest(h,m,y,v){const T={command:h};if(m&&Object.keys(m).length>0&&(T.arguments=m),this._send("request",T),v){this._pendingRequests.set(T.seq,v);const h=setTimeout(()=>{clearTimeout(h);const m=this._pendingRequests.get(T.seq);m&&(this._pendingRequests.delete(T.seq),m(new C.Response(T,"timeout")))},y)}}dispatchRequest(h){}_emitEvent(h){this.emit(h.event,h)}_send(h,m){if(m.type=h,m.seq=this._sequence++,this._writableStream){const h=JSON.stringify(m);this._writableStream.write(`Content-Length: ${Buffer.byteLength(h,"utf8")}\r\n\r\n${h}`,"utf8")}this._sendMessage.fire(m)}_handleData(h){for(this._rawData=Buffer.concat([this._rawData,h]);;){if(this._contentLength>=0){if(this._rawData.length>=this._contentLength){const h=this._rawData.toString("utf8",0,this._contentLength);if(this._rawData=this._rawData.slice(this._contentLength),this._contentLength=-1,h.length>0)try{let m=JSON.parse(h);this.handleMessage(m)}catch(h){this._emitEvent(new C.Event("error","Error handling data: "+(h&&h.message)))}continue}}else{const h=this._rawData.indexOf(ProtocolServer.TWO_CRLF);if(-1!==h){const m=this._rawData.toString("utf8",0,h).split("\r\n");for(let h=0;h<m.length;h++){const y=m[h].split(/: +/);"Content-Length"==y[0]&&(this._contentLength=+y[1])}this._rawData=this._rawData.slice(h+ProtocolServer.TWO_CRLF.length);continue}}break}}}m.ProtocolServer=ProtocolServer,ProtocolServer.TWO_CRLF="\r\n\r\n"},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0}),m.runDebugAdapter=void 0;const v=y(31);m.runDebugAdapter=function runDebugAdapter(h){let m=0;if(process.argv.slice(2).forEach((function(h,y,v){const C=/^--server=(\d{4,5})$/.exec(h);C&&(m=parseInt(C[1],10))})),m>0)console.error(`waiting for debug protocol on port ${m}`),v.createServer(m=>{console.error(">> accepted connection from client"),m.on("end",()=>{console.error(">> client connection closed\n")});const y=new h(!1,!0);y.setRunAsServer(!0),y.start(m,m)}).listen(m);else{const m=new h(!1);process.on("SIGTERM",()=>{m.shutdown()}),m.start(process.stdin,process.stdout)}}},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0}),m.LoggingDebugSession=void 0;const v=y(303),C=v.logger,T=y(301);class LoggingDebugSession extends T.DebugSession{constructor(h,m,y){super(m,y),this.obsolete_logFilePath=h,this.on("error",h=>{C.error(h.body)})}start(h,m){super.start(h,m),C.init(h=>this.sendEvent(h),this.obsolete_logFilePath,this._isServer)}sendEvent(h){if(!(h instanceof v.LogOutputEvent)){let m=h;h instanceof T.OutputEvent&&h.body&&h.body.data&&h.body.data.doNotLogOutput&&(delete h.body.data.doNotLogOutput,m=Object.assign({},h),m.body=Object.assign(Object.assign({},h.body),{output:"<output not logged>"})),C.verbose(`To client: ${JSON.stringify(m)}`)}super.sendEvent(h)}sendRequest(h,m,y,v){C.verbose(`To client: ${JSON.stringify(h)}(${JSON.stringify(m)}), timeout: ${y}`),super.sendRequest(h,m,y,v)}sendResponse(h){C.verbose(`To client: ${JSON.stringify(h)}`),super.sendResponse(h)}dispatchRequest(h){C.verbose(`From client: ${h.command}(${JSON.stringify(h.arguments)})`),super.dispatchRequest(h)}}m.LoggingDebugSession=LoggingDebugSession},function(h,m,y){"use strict";var v=this&&this.__awaiter||function(h,m,y,v){return new(y||(y=Promise))((function(C,T){function fulfilled(h){try{step(v.next(h))}catch(h){T(h)}}function rejected(h){try{step(v.throw(h))}catch(h){T(h)}}function step(h){h.done?C(h.value):function adopt(h){return h instanceof y?h:new y((function(m){m(h)}))}(h.value).then(fulfilled,rejected)}step((v=v.apply(h,m||[])).next())}))};Object.defineProperty(m,"__esModule",{value:!0}),m.InternalLogger=void 0;const C=y(21),T=y(7),w=y(1349),A=y(303);function getFormattedTimeString(){let h=new Date;return _padZeroes(2,String(h.getUTCHours()))+":"+_padZeroes(2,String(h.getUTCMinutes()))+":"+_padZeroes(2,String(h.getUTCSeconds()))+"."+_padZeroes(3,String(h.getUTCMilliseconds()))+" UTC"}function _padZeroes(h,m){return m.length>=h?m:String("0".repeat(h)+m).slice(-h)}m.InternalLogger=class InternalLogger{constructor(h,m){this.beforeExitCallback=()=>this.dispose(),this._logCallback=h,this._logToConsole=m,this._minLogLevel=A.LogLevel.Warn,this.disposeCallback=(h,m)=>{this.dispose(),m=m||2,m+=128,process.exit(m)}}setup(h){return v(this,void 0,void 0,(function*(){if(this._minLogLevel=h.consoleMinLogLevel,this._prependTimestamp=h.prependTimestamp,h.logFilePath)if(T.isAbsolute(h.logFilePath)){const handleError=m=>this.sendLog(`Error creating log file at path: ${h.logFilePath}. Error: ${m.toString()}\n`,A.LogLevel.Error);try{yield w(T.dirname(h.logFilePath)),this.log("Verbose logs are written to:\n",A.LogLevel.Warn),this.log(h.logFilePath+"\n",A.LogLevel.Warn),this._logFileStream=C.createWriteStream(h.logFilePath),this.logDateTime(),this.setupShutdownListeners(),this._logFileStream.on("error",h=>{handleError(h)})}catch(h){handleError(h)}}else this.log(`logFilePath must be an absolute path: ${h.logFilePath}`,A.LogLevel.Error)}))}logDateTime(){let h=new Date;const m=h.getUTCFullYear()+"-"+`${h.getUTCMonth()+1}`+"-"+h.getUTCDate()+", "+getFormattedTimeString();this.log(m+"\n",A.LogLevel.Verbose,!1)}setupShutdownListeners(){process.addListener("beforeExit",this.beforeExitCallback),process.addListener("SIGTERM",this.disposeCallback),process.addListener("SIGINT",this.disposeCallback)}removeShutdownListeners(){process.removeListener("beforeExit",this.beforeExitCallback),process.removeListener("SIGTERM",this.disposeCallback),process.removeListener("SIGINT",this.disposeCallback)}dispose(){return new Promise(h=>{this.removeShutdownListeners(),this._logFileStream?(this._logFileStream.end(h),this._logFileStream=null):h()})}log(h,m,y=!0){if(this._minLogLevel!==A.LogLevel.Stop){if(m>=this._minLogLevel&&this.sendLog(h,m),this._logToConsole){const y=m===A.LogLevel.Error?console.error:m===A.LogLevel.Warn?console.warn:null;y&&y((0,A.trimLastNewline)(h))}m===A.LogLevel.Error&&(h=`[${A.LogLevel[m]}] ${h}`),this._prependTimestamp&&y&&(h="["+getFormattedTimeString()+"] "+h),this._logFileStream&&this._logFileStream.write(h)}}sendLog(h,m){if(h.length>1500){const m=!!h.match(/(\n|\r\n)$/);h=h.substr(0,1500)+"[...]",m&&(h+="\n")}if(this._logCallback){const y=new A.LogOutputEvent(h,m);this._logCallback(y)}}}},function(h,m,y){const v=y(1350),C=y(1351),{mkdirpNative:T,mkdirpNativeSync:w}=y(1352),{mkdirpManual:A,mkdirpManualSync:P}=y(542),{useNative:k,useNativeSync:R}=y(1354),mkdirp=(h,m)=>(h=C(h),m=v(m),k(m)?T(h,m):A(h,m));mkdirp.sync=(h,m)=>(h=C(h),m=v(m),R(m)?w(h,m):P(h,m)),mkdirp.native=(h,m)=>T(C(h),v(m)),mkdirp.manual=(h,m)=>A(C(h),v(m)),mkdirp.nativeSync=(h,m)=>w(C(h),v(m)),mkdirp.manualSync=(h,m)=>P(C(h),v(m)),h.exports=mkdirp},function(h,m,y){const{promisify:v}=y(10),C=y(21);h.exports=h=>{if(h)if("object"==typeof h)h={mode:511,fs:C,...h};else if("number"==typeof h)h={mode:h,fs:C};else{if("string"!=typeof h)throw new TypeError("invalid options argument");h={mode:parseInt(h,8),fs:C}}else h={mode:511,fs:C};return h.mkdir=h.mkdir||h.fs.mkdir||C.mkdir,h.mkdirAsync=v(h.mkdir),h.stat=h.stat||h.fs.stat||C.stat,h.statAsync=v(h.stat),h.statSync=h.statSync||h.fs.statSync||C.statSync,h.mkdirSync=h.mkdirSync||h.fs.mkdirSync||C.mkdirSync,h}},function(h,m,y){const v=process.env.__TESTING_MKDIRP_PLATFORM__||process.platform,{resolve:C,parse:T}=y(7);h.exports=h=>{if(/\0/.test(h))throw Object.assign(new TypeError("path must be a string without null bytes"),{path:h,code:"ERR_INVALID_ARG_VALUE"});if(h=C(h),"win32"===v){const m=/[*|"<>?:]/,{root:y}=T(h);if(m.test(h.substr(y.length)))throw Object.assign(new Error("Illegal characters in path."),{path:h,code:"EINVAL"})}return h}},function(h,m,y){const{dirname:v}=y(7),{findMade:C,findMadeSync:T}=y(1353),{mkdirpManual:w,mkdirpManualSync:A}=y(542);h.exports={mkdirpNative:(h,m)=>(m.recursive=!0,v(h)===h?m.mkdirAsync(h,m):C(m,h).then(y=>m.mkdirAsync(h,m).then(()=>y).catch(y=>{if("ENOENT"===y.code)return w(h,m);throw y}))),mkdirpNativeSync:(h,m)=>{if(m.recursive=!0,v(h)===h)return m.mkdirSync(h,m);const y=T(m,h);try{return m.mkdirSync(h,m),y}catch(y){if("ENOENT"===y.code)return A(h,m);throw y}}}},function(h,m,y){const{dirname:v}=y(7),findMade=(h,m,y)=>y===m?Promise.resolve():h.statAsync(m).then(h=>h.isDirectory()?y:void 0,y=>"ENOENT"===y.code?findMade(h,v(m),m):void 0),findMadeSync=(h,m,y)=>{if(y!==m)try{return h.statSync(m).isDirectory()?y:void 0}catch(y){return"ENOENT"===y.code?findMadeSync(h,v(m),m):void 0}};h.exports={findMade:findMade,findMadeSync:findMadeSync}},function(h,m,y){const v=y(21),C=(process.env.__TESTING_MKDIRP_NODE_VERSION__||process.version).replace(/^v/,"").split("."),T=+C[0]>10||10==+C[0]&&+C[1]>=12,w=T?h=>h.mkdir===v.mkdir:()=>!1,A=T?h=>h.mkdirSync===v.mkdirSync:()=>!1;h.exports={useNative:w,useNativeSync:A}},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0}),m.Handles=void 0;m.Handles=class Handles{constructor(h){this.START_HANDLE=1e3,this._handleMap=new Map,this._nextHandle="number"==typeof h?h:this.START_HANDLE}reset(){this._nextHandle=this.START_HANDLE,this._handleMap=new Map}create(h){var m=this._nextHandle++;return this._handleMap.set(m,h),m}get(h,m){return this._handleMap.get(h)||m}}},function(h,m,y){"use strict";var v=this&&this.__awaiter||function(h,m,y,v){return new(y||(y=Promise))((function(C,T){function fulfilled(h){try{step(v.next(h))}catch(h){T(h)}}function rejected(h){try{step(v.throw(h))}catch(h){T(h)}}function step(h){h.done?C(h.value):function adopt(h){return h instanceof y?h:new y((function(m){m(h)}))}(h.value).then(fulfilled,rejected)}step((v=v.apply(h,m||[])).next())}))};Object.defineProperty(m,"__esModule",{value:!0});const C=y(0),T=y(3),w=y(4),A=y(5);class BreakpointManager{constructor(h,m,y){this.isSharing=h,this.sourceEventService=m,this.pathManager=y,this.ignoreChangeBreakpoints=!1,this.onDidChangeBreakpoints=h=>v(this,void 0,void 0,(function*(){if(this.ignoreChangeBreakpoints)return;let m=!1;if(h.added.length>0){const y=this.toSourceBreakpoints(h.added);this.logBreakpoints("Local breakpoints added:",y),y.length>0&&(m=!0,yield this.sourceEventService.fireEventAsync(BreakpointManager.debugBreakpointsAddId,BreakpointManager.toJson(y)))}else if(h.removed.length>0){const y=this.toSourceBreakpoints(h.removed);this.logBreakpoints("Local breakpoints removed:",y),y.length>0&&(m=!0,yield this.sourceEventService.fireEventAsync(BreakpointManager.debugBreakpointsRemoveId,BreakpointManager.toJson(y)))}else if(h.changed.length>0){const y=this.toSourceBreakpoints(h.changed);this.logBreakpoints("Local breakpoints changed:",y),y.length>0&&(m=!0,yield this.sourceEventService.fireEventAsync(BreakpointManager.debugBreakpointsChangeId,BreakpointManager.toJson(y)))}this.isSharing&&m&&(yield this.updateCollaborationBreakpoints())})),this.onSourceEvent=h=>v(this,void 0,void 0,(function*(){let m=!1;if(h.sourceId===BreakpointManager.debugBreakpointsAddId){const y=BreakpointManager.toBreakpoints(h.jsonContent);this.logBreakpoints("Remote breakpoints added:",y);const v=this.toVSCodeBreakpoints(y);v.length>0&&(m=this.addLocalBreakpoints(v))}else if(h.sourceId===BreakpointManager.debugBreakpointsRemoveId){const y=BreakpointManager.toBreakpoints(h.jsonContent);this.logBreakpoints("Remote breakpoints removed:",y);const v=this.toVSCodeBreakpoints(y);v.length>0&&(m=this.removeLocalBreakpoints(v))}else if(h.sourceId===BreakpointManager.debugBreakpointsChangeId){const y=BreakpointManager.toBreakpoints(h.jsonContent);this.logBreakpoints("Remote breakpoints updated:",y);const v=this.toVSCodeBreakpoints(y);v.length>0&&(m=this.updateLocalBreakpoints(v))}this.isSharing&&m&&(yield this.updateCollaborationBreakpoints())})),this.trace=A.traceSource.withName(w.vsls.TraceSources.BreakpointManager),this.sourceEventService.onEvent(this.onSourceEvent)}static hasVSCodeSupport(){return"function"==typeof C.debug.addBreakpoints}init(){return v(this,void 0,void 0,(function*(){if(this.trace.verbose("initialize"),this.onDidChangeBreakpointsEvt=C.debug.onDidChangeBreakpoints(this.onDidChangeBreakpoints,this),this.isSharing)yield this.updateCollaborationBreakpoints();else{const h=yield this.getCollaborationBreakpoints(),m=this.toVSCodeBreakpoints(h);this.removeLocalBreakpoints(C.debug.breakpoints),this.addLocalBreakpoints(m)}}))}dispose(){return this.onDidChangeBreakpointsEvt.dispose(),Promise.resolve()}addLocalBreakpoints(h){if((h=h.filter(h=>"location"in h&&!this.sourceBreakpointExists(h))).length>0){h.forEach(h=>{const m=h;this.trace.verbose(`addBreakpoint srcBkpt uri:${m.location.uri.path} line:${m.location.range.start.line} character:${m.location.range.start.character}`)});try{this.ignoreChangeBreakpoints=!0,C.debug.addBreakpoints(h)}catch(h){this.trace.error("Failed to add breakpoints",h)}finally{this.ignoreChangeBreakpoints=!1}return!0}return!1}removeLocalBreakpoints(h){if((h=h.map(h=>"location"in h&&this.findSourceBreakpoint(h)).filter(h=>void 0!==h)).length>0){h.forEach(h=>{const m=h;this.trace.verbose(`removeBreakpoint srcBkpt uri:${m.location.uri.path} line:${m.location.range.start.line} character:${m.location.range.start.character}`)});try{this.ignoreChangeBreakpoints=!0,C.debug.removeBreakpoints(h)}finally{this.ignoreChangeBreakpoints=!1}return!0}return!1}updateLocalBreakpoints(h){return h=h.filter(h=>{if(!("location"in h))return!1;const m=h,y=this.findSourceBreakpoint(m);return y&&(y.enabled!==m.enabled||y.condition!==m.condition||y.hitCondition!==m.hitCondition)}),!!this.removeLocalBreakpoints(h)&&this.addLocalBreakpoints(h)}updateCollaborationBreakpoints(){return v(this,void 0,void 0,(function*(){const h=this.getCurrentBreakpoints();this.trace.verbose(`updateCollaborationBreakpoints total:${h.length}`),yield this.sourceEventService.setSourceDataAsync(BreakpointManager.debugBreakpointsSourceId,BreakpointManager.toJson(h),!1)}))}getCollaborationBreakpoints(){return v(this,void 0,void 0,(function*(){const h=yield this.sourceEventService.getSourceDataAsync(BreakpointManager.debugBreakpointsSourceId);return BreakpointManager.toBreakpoints(h)}))}getCurrentBreakpoints(){return this.toSourceBreakpoints(C.debug.breakpoints)}logBreakpoints(h,m){let y=void 0;m.forEach(m=>{y||(y=h),y+="\n"+BreakpointManager.toString(m)}),y&&this.trace.verbose(y)}toSourceBreakpoints(h){return h.filter(h=>this.isLiveShareSourceBreakpoint(h)).map(h=>this.toBreakpoint(h))}static toString(h){return`Path:${h.source.path} Line:${h.line} Column:${h.column} EndColumn:${h.endColumn}`}static toBreakpoints(h){return h?JSON.parse(h):[]}static toJson(h){return JSON.stringify(h)}findSourceBreakpoint(h){return C.debug.breakpoints.find(m=>{if(!("location"in m))return!1;const y=m,v=y.location.uri.toString()===h.location.uri.toString(),C=y.location.range.start.line===h.location.range.start.line;return v&&C})}sourceBreakpointExists(h){return void 0!==this.findSourceBreakpoint(h)}toBreakpoint(h){const m=h.location.uri,y={path:this.pathManager.localPathToRelativePath(m)};return{condition:h.condition,enabled:h.enabled,hitCondition:h.hitCondition,verified:!1,source:y,line:h.location.range.start.line+1,column:h.location.range.start.character+1,endLine:h.location.range.end.line+1,endColumn:h.location.range.end.character+1}}toVSCodeBreakpoint(h){let m=h.source.path;(null==m?void 0:m.startsWith(this.pathManager.scheme))&&(m=m.substring(this.pathManager.scheme.length));const y=this.pathManager.relativePathToLocalPath(m),v=BreakpointManager.toVSCodePosition(h.line,void 0),T=BreakpointManager.toVSCodePosition(h.line,h.column),w=new C.Location(y,new C.Range(v,T)),A=parseInt(h.hitCondition,10)?h.hitCondition:void 0;return new C.SourceBreakpoint(w,h.enabled,h.condition,A)}toVSCodeBreakpoints(h){return h.map(h=>this.toVSCodeBreakpoint(h))}isLiveShareSourceBreakpoint(h){if(!("location"in h))return!1;const m=h.location.uri;return this.isSharing?!!C.workspace.getWorkspaceFolder(m):m.scheme===T.Settings.scheme}static toVSCodePosition(h,m){return new C.Position(h?h-1:0,m?m-1:0)}}m.BreakpointManager=BreakpointManager,BreakpointManager.debugBreakpointsSourceId="debugBreakpoints",BreakpointManager.debugBreakpointsAddId="debugBreakpointsAdd",BreakpointManager.debugBreakpointsRemoveId="debugBreakpointsRemove",BreakpointManager.debugBreakpointsChangeId="debugBreakpointsChange"},function(h,m,y){"use strict";var v=this&&this.__awaiter||function(h,m,y,v){return new(y||(y=Promise))((function(C,T){function fulfilled(h){try{step(v.next(h))}catch(h){T(h)}}function rejected(h){try{step(v.throw(h))}catch(h){T(h)}}function step(h){h.done?C(h.value):function adopt(h){return h instanceof y?h:new y((function(m){m(h)}))}(h.value).then(fulfilled,rejected)}step((v=v.apply(h,m||[])).next())}))};Object.defineProperty(m,"__esModule",{value:!0});const C=y(0),T=y(544),w=y(543),A=y(3),P=y(1358),k=y(113);class TrackDebugManager extends w.ShareDebugManagerBase{constructor(h,m,y){super(h,m,y),this.trace.verbose("TrackDebugManager created"),C.debug.registerDebugAdapterTrackerFactory("*",this)}createDebugAdapterTracker(h){return new DebugAdapterTracker(this,h,this.trace.createChild(h.id))}}m.TrackDebugManager=TrackDebugManager;class DebugAdapterTracker extends T.DebugAdapterTrackerBase{constructor(h,m,y){super(h,m,y),this.debugSessionHostService=null,this.stopDisposable=null}get isConnected(){return null!==this.debugSessionHostService}notifyDebugEvent(h){this.debugSessionHostService.fireHostDebugEvent(h)}fireEnterRunMode(h,m){var y;null===(y=this.debugSessionHostService)||void 0===y||y.fireEnterRunMode(h,m)}startSession(){return v(this,void 0,void 0,(function*(){this.debugSessionHostService=new P.DebugSessionHostService(this.capabilities,(h,m)=>v(this,void 0,void 0,(function*(){return yield this.session.customRequest(h,m)})),A.dependencies.pathManager(),this.trace.withName(`DebugSessionHostService-${this.session.id}`)),this.debugSessionHostService.onTerminateRequest(()=>v(this,void 0,void 0,(function*(){yield this.terminate()}))),this.lastStoppedEvent&&(yield this.debugSessionHostService.setStoppedEvent(this.lastStoppedEvent));const h=Object.assign(Object.assign({},k.debugSessionHostService),{name:`${k.debugSessionHostService.name}-${this.session.id}`});this.stopDisposable=yield A.RpcServiceHelper.registerHostRpcService(this.debugSessionHostService,h,A.dependencies)}))}stopSession(){return v(this,void 0,void 0,(function*(){this.stopDisposable&&(yield this.stopDisposable.dispose()),this.stopDisposable=null,this.debugSessionHostService=null}))}}},function(h,m,y){"use strict";var v=this&&this.__awaiter||function(h,m,y,v){return new(y||(y=Promise))((function(C,T){function fulfilled(h){try{step(v.next(h))}catch(h){T(h)}}function rejected(h){try{step(v.throw(h))}catch(h){T(h)}}function step(h){h.done?C(h.value):function adopt(h){return h instanceof y?h:new y((function(m){m(h)}))}(h.value).then(fulfilled,rejected)}step((v=v.apply(h,m||[])).next())}))};Object.defineProperty(m,"__esModule",{value:!0});const C=y(0),T=y(113),w=y(1359),A=y(299),P=y(113),k=y(3);function toProtocolResponse(h){return{body:h}}m.DebugSessionHostService=class DebugSessionHostService{constructor(h,m,y,v){this.capabilities=h,this.requestAdapter=m,this.pathManager=y,this.trace=v,this.onDebugEventEmitter=new C.EventEmitter,this.onUIDebugEventEmitter=new C.EventEmitter,this.onTerminateRequestEmitter=new C.EventEmitter,this.replayDebugEventsHelper=new ReplayDebugEventsHelper,this.stackFrameRequestCache=new StackFrameRequestCache,this.sourceReferenceCache=new Set,this.lastStoppedEvent=null,this.onTerminateRequest=this.onTerminateRequestEmitter.event,this.onDebugEvent=this.onDebugEventEmitter.event,this.onUIDebugEvent=this.onUIDebugEventEmitter.event,this.protocolRequestCache=new w.ProtocolRequestCache((h,m)=>this.handleProtocolRequestInternal(h,m))}setStoppedEvent(h){return v(this,void 0,void 0,(function*(){this.setLastStoppedEvent(yield this.createUIStoppedEvent(h,h.body.threadId))}))}continueAsync(h,m,y){switch(this.fireEnterRunMode(h===T.ContinueReason.Go?A.EventReason.Go:A.EventReason.Step,m),h){case T.ContinueReason.Go:return this.requestHostAdapter("continue",{threadId:m});case T.ContinueReason.StepIn:return this.requestHostAdapter("stepIn",{threadId:m});case T.ContinueReason.StepOut:return this.requestHostAdapter("stepOut",{threadId:m});case T.ContinueReason.StepOver:return this.requestHostAdapter("next",{threadId:m});default:throw new Error(`Invalid reason:${h}`)}}handleProtocolRequestAsync(h,m,y){return v(this,void 0,void 0,(function*(){if("terminate"===h)return void this.onTerminateRequestEmitter.fire();const y=(new Date).getTime();try{const v=yield this.protocolRequestCache.request(h,m);return this.trace.verbose(`-> handleProtocolRequest requestType:${h} t:${(new Date).getTime()-y}`),v}catch(m){throw this.trace.error(`-> handleProtocolRequest requestType:${h} failed`,m),m}}))}getCurrentStoppedEventAsync(h){return Promise.resolve(this.lastStoppedEvent)}initializeRequestAsync(h,m){return v(this,void 0,void 0,(function*(){let m=null;if(h.includeModules&&!0===this.capabilities.supportsModulesRequest)try{m=yield this.requestHostAdapter("modules",null)}catch(h){}return{stoppedEvent:this.lastStoppedEvent,outputEvents:this.replayDebugEventsHelper.outputEvents,replayEvents:this.replayDebugEventsHelper.debugEvents,modulesResponse:m}}))}fireHostDebugEvent(h){"stopped"===(null==h?void 0:h.event)?this.fireStopEvent(h).catch(h=>{this.trace.error("Failed to fire stop event",h)}):"continued"!==(null==h?void 0:h.event)&&(h.body.type=h.event,"breakpoint"===h.event&&this.sourceToProtocol(h.body.breakpoint.source),this.fireDebugEvent(h))}fireEnterRunMode(h,m){h!==A.EventReason.Go&&h!==A.EventReason.Step||this.setLastStoppedEvent(null);const y={type:"enterRunMode",Reason:h,ThreadId:m};this.onUIDebugEventEmitter.fire({body:y})}fireStopEvent(h){return v(this,void 0,void 0,(function*(){this.trace.verbose(`->fireStopEventAsync reason:${h.body.reason} thread:${h.body.threadId}`),this.setLastStoppedEvent(yield this.createUIStoppedEvent(h,h.body.threadId));const m=Object.assign(Object.assign({},h),{event:P.uiStoppedEventName,body:Object.assign(Object.assign(Object.assign({},h.body),this.lastStoppedEvent),{type:P.uiStoppedEventName})});this.fireDebugEvent(m),this.trace.verbose("<-fireStopEventAsync")}))}setLastStoppedEvent(h){this.lastStoppedEvent=h,this.protocolRequestCache.isEnabled=null!==h}handleProtocolRequestInternal(h,m){return v(this,void 0,void 0,(function*(){switch(h){case"stackTrace":this.stackFrameRequestCache.cacheRequest(m);break;case"setBreakpoints":this.protocolToSource(m.source)}return yield this.requestAdapterConverter(h,m)}))}createUIStoppedEvent(h,m){var y;return v(this,void 0,void 0,(function*(){const v=yield this.getThreads();m=m||((null==v?void 0:v.length)>0?v[0].id:0);let C=null;const T=[],w=new Map,A=new Map,P=new Map;w.set(m,P);for(let h of this.stackFrameRequestCache.snapshot){const y={threadId:m,startFrame:0,levels:h[1],format:isNullFormat(h[0])?null:h[0]},v=yield this.getStackTraceResponse(y);P.set(h[0],v),v.body.stackFrames.length>0&&T.push(v.body.stackFrames[0])}if(T.length>0){const h=null===(y=T[0].source)||void 0===y?void 0:y.sourceReference;if(h>0&&!this.sourceReferenceCache.has(h)){C=new Map;try{const m=yield this.handleSourceRequest({sourceReference:h});C.set(h,m),this.sourceReferenceCache.add(h)}catch(h){this.trace.error("handleSourceRequestfailed",h)}}const m=yield this.getScopes(T[0].id);T.forEach(h=>{A.set(h.id,m)})}const k={};Array.from(w.entries()).forEach(h=>{k[String(h[0])]=Array.from(h[1].entries()).map(h=>({key:h[0],value:{stackFrames:h[1].body.stackFrames,totalFrames:h[1].body.totalFrames}}))});const R={};Array.from(A.entries()).forEach(h=>{R[String(h[0])]=h[1]});let M=null;return C&&(M={},Array.from(C.entries()).forEach(h=>{M[String(h[0])]=Object.assign({},h[1].body)})),Object.assign(Object.assign({},h.body),{threads:v,scopes:R,sourceReferenceContent:M,stackFrames:k})}))}fireDebugEvent(h){this.replayDebugEventsHelper.addEvent(h),this.onDebugEventEmitter.fire(h)}getThreads(){return v(this,void 0,void 0,(function*(){return(yield this.requestHostAdapter("threads",{})).body.threads}))}getStackTraceResponse(h){return v(this,void 0,void 0,(function*(){return yield this.requestHostAdapter("stackTrace",h)}))}getScopes(h){return v(this,void 0,void 0,(function*(){return(yield this.requestHostAdapter("scopes",{frameId:h})).body.scopes}))}handleSourceRequest(h){return v(this,void 0,void 0,(function*(){return yield this.requestHostAdapter("source",h)}))}requestHostAdapter(h,m){return v(this,void 0,void 0,(function*(){return toProtocolResponse(yield this.requestAdapterConverter(h,m))}))}requestAdapterConverter(h,m){return v(this,void 0,void 0,(function*(){const y=yield this.requestAdapter(h,m);switch(h){case"stackTrace":toProtocolResponse(y).body.stackFrames.forEach(h=>this.stackFrameToProtocol(h));break;case"setBreakpoints":toProtocolResponse(y).body.breakpoints.forEach(h=>this.sourceToProtocol(h.source));break;case"scopes":toProtocolResponse(y).body.scopes.forEach(h=>this.sourceToProtocol(h.source))}return y}))}sourceToProtocol(h){if(h){if(h.path){const m=C.Uri.file(h.path);h.path=`${k.Settings.scheme}:${this.pathManager.localPathToRelativePath(m)}`}h.sources&&h.sources.forEach(h=>this.sourceToProtocol(h))}}stackFrameToProtocol(h){this.sourceToProtocol(h.source)}protocolToSource(h){if(!h)return;let m=h.path;if(m){m.startsWith(this.pathManager.scheme)&&(m=m.substring(this.pathManager.scheme.length));const y=this.pathManager.relativePathToLocalPath(m);h.path=y.path}h.sources&&h.sources.forEach(h=>this.protocolToSource(h))}};class ReplayDebugEventsHelper{constructor(){this.replayEvents=[],this.replayAllEvents=!0}get outputEvents(){return this.replayEvents.filter(h=>"output"===h.type).map(h=>h)}get debugEvents(){if(this.replayAllEvents){this.replayAllEvents=!1;const h=this.replayEvents;return this.replayEvents=this.replayEvents.filter(h=>isReplayDebugEventType(h)),h}return this.replayEvents.slice()}addEvent(h){this.replayAllEvents&&this.replayEvents.length<100?this.replayEvents.push(h):isReplayDebugEventType(h)&&(100===this.replayEvents.length&&this.replayEvents.splice(0,1),this.replayEvents.push(h))}}const R=["process"];function isReplayDebugEventType(h){var m;if("output"===h.type){const y=null===(m=h.body)||void 0===m?void 0:m.category;return"console"===y||"stderr"===y||"stdout"===y}return-1!==R.findIndex(m=>m===h.type)}const M={};class StackFrameRequestCache{constructor(){this.stackFrameFormatRequests=new Map}get snapshot(){const h=Array.from(this.stackFrameFormatRequests.entries()).map(h=>[JSON.parse(h[0]),h[1]]);return 0===h.length&&h.push([M,20]),h}cacheRequest(h){if(0===h.startFrame&&h.levels){let m=h.format;isNullFormat(m)&&(m=M);const y=JSON.stringify(m),v=0|this.stackFrameFormatRequests.get(y);this.stackFrameFormatRequests.set(y,Math.max(v,h.levels))}}}function isNullFormat(h){return null==h||"{}"===JSON.stringify(h)}},function(h,m,y){"use strict";var v=this&&this.__awaiter||function(h,m,y,v){return new(y||(y=Promise))((function(C,T){function fulfilled(h){try{step(v.next(h))}catch(h){T(h)}}function rejected(h){try{step(v.throw(h))}catch(h){T(h)}}function step(h){h.done?C(h.value):function adopt(h){return h instanceof y?h:new y((function(m){m(h)}))}(h.value).then(fulfilled,rejected)}step((v=v.apply(h,m||[])).next())}))};Object.defineProperty(m,"__esModule",{value:!0});m.ProtocolRequestCache=class ProtocolRequestCache{constructor(h){this.requestCallback=h,this.requestCache=new Map,this.isEnabledFlag=!1}get isEnabled(){return this.isEnabledFlag}set isEnabled(h){this.isEnabledFlag=h,this.requestCache.clear()}request(h,m){return v(this,void 0,void 0,(function*(){let y;if(this.isEnabledFlag&&function isRequestTypeEnabled(h){return"stackTrace"===h||"threads"===h||"scopes"===h||"variables"===h||"source"===h}(h)){const v=`${h}:${JSON.stringify(null!=m?m:null)}`;y=this.requestCache.get(v),y||(y=yield this.requestCallback(h,m),this.requestCache.set(v,y))}else(function requestInvalidatesCache(h,m){switch(h){case"setDebuggerProperty":case"setVariable":case"setExpression":case"setDataBreakpoints":case"loadSymbols":case"addFavorite":case"removeFavorite":case"createObjectId":case"destroyObjectId":return!0;case"evaluate":{const h=m;return"hover"!==(null==h?void 0:h.context)}}return!1})(h,m)&&this.requestCache.clear(),y=yield this.requestCallback(h,m);return y}))}}},function(h,m,y){"use strict";var v=this&&this.__awaiter||function(h,m,y,v){return new(y||(y=Promise))((function(C,T){function fulfilled(h){try{step(v.next(h))}catch(h){T(h)}}function rejected(h){try{step(v.throw(h))}catch(h){T(h)}}function step(h){h.done?C(h.value):function adopt(h){return h instanceof y?h:new y((function(m){m(h)}))}(h.value).then(fulfilled,rejected)}step((v=v.apply(h,m||[])).next())}))};Object.defineProperty(m,"__esModule",{value:!0});const C=y(5),T=y(545),w=y(547),A=y(3);class ServerManager extends(C.Inittable(C.Disposable(Object))){constructor(h){super(),this.dependencies=h,this.hostController=w.hostServerControllerFactory(this.dependencies),this.stateChangedRegistration=A.sessionStateTracker.onStateChanged(h=>this.handleSessionStateChanged(h.newState,h.oldState))}dispose(){const h=Object.create(null,{dispose:{get:()=>super.dispose}});return v(this,void 0,void 0,(function*(){this.stateChangedRegistration.dispose(),this.hostController&&(yield this.hostController.dispose()),this.guestController&&(yield this.guestController.dispose()),yield h.dispose.call(this)}))}handleSessionStateChanged(h,m){return v(this,void 0,void 0,(function*(){switch(h){case A.SessionState.Shared:yield this.hostController.activate();break;case A.SessionState.JoiningInProgress:yield this.hostController.dispose(),this.guestController=T.guestServerControllerFactory(this.dependencies);break;case A.SessionState.Joined:yield this.guestController.activate();break;default:m===A.SessionState.Shared&&(yield this.hostController.deactivate()),this.guestController&&m===A.SessionState.Joined&&(yield this.guestController.deactivate())}}))}}m.ServerManager=ServerManager},function(h,m,y){"use strict";var v=this&&this.__awaiter||function(h,m,y,v){return new(y||(y=Promise))((function(C,T){function fulfilled(h){try{step(v.next(h))}catch(h){T(h)}}function rejected(h){try{step(v.throw(h))}catch(h){T(h)}}function step(h){h.done?C(h.value):function adopt(h){return h instanceof y?h:new y((function(m){m(h)}))}(h.value).then(fulfilled,rejected)}step((v=v.apply(h,m||[])).next())}))};Object.defineProperty(m,"__esModule",{value:!0});const C=y(0),T=y(110);class ContactApi{constructor(h,m){this.contactManager=h,this.onDidChangePropertyEmitter=new C.EventEmitter,this.attachContactModel(m)}get onDidChange(){return this.onDidChangePropertyEmitter.event}get id(){return this.contact.id}get email(){return this.contact.email}get displayName(){return this.contact.displayName}get status(){return this.contact.status.toString()}get avatarUri(){return this.contact.avatarUri}get isRecentContact(){return this.contactManager.isRecentContat(this.contactModel)}get isSuggestedContact(){return this.contactManager.isSuggestedContat(this.contactModel)}get allowInvites(){return this.contactModel.properties.allowInvites}get contact(){return this.contactModel.contact}invite(h){return h&&h.useEmail?T.ContactCommandUtilities.inviteByEmail(this.email,this.displayName):T.ContactCommandUtilities.inviteHelper(this.contactModel)}attachContactModel(h){this.onDidChangePropertyDisposable&&(this.onDidChangePropertyDisposable.dispose(),this.onDidChangePropertyDisposable=null),this.contactModel=h,this.onDidChangePropertyDisposable=h.onDidChangeProperty(h=>{this.onDidChangePropertyEmitter.fire(h)})}static getContacts(h,m){return v(this,void 0,void 0,(function*(){const y={},v=yield T.ContactManager.requestContacts(m);v.contactModels.forEach(m=>{y[m.contact.email]=new ContactApi(h,m)});const C=v.onContactsChanged(()=>{v.contactModels.forEach(h=>{const m=y[h.contact.email];m&&(m.attachContactModel(h),m.onDidChangePropertyEmitter.fire([]))})});return{contacts:y,dispose:()=>(C.dispose(),v.dispose())}}))}}m.ContactApi=ContactApi},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0}),m.default=function getStackFrames(){if(!Error.captureStackTrace)return null;const h=new Error,m=Error.prepareStackTrace;Error.prepareStackTrace=(h,m)=>m,Error.captureStackTrace(h,getStackFrames);const y=h.stack;return Error.prepareStackTrace=m,Array.isArray(y)?y.map(h=>{const m=h.getTypeName(),y=h.getMethodName();return{functionName:m&&y?m+"."+y:h.getFunctionName(),fileName:h.getFileName()}}):null}},function(h,m,y){"use strict";var v=this&&this.__awaiter||function(h,m,y,v){return new(y||(y=Promise))((function(C,T){function fulfilled(h){try{step(v.next(h))}catch(h){T(h)}}function rejected(h){try{step(v.throw(h))}catch(h){T(h)}}function step(h){h.done?C(h.value):function adopt(h){return h instanceof y?h:new y((function(m){m(h)}))}(h.value).then(fulfilled,rejected)}step((v=v.apply(h,m||[])).next())}))};Object.defineProperty(m,"__esModule",{value:!0});const C=y(1364),T=y(85),w=y(3),A=y(4),P=y(16),k=y(0);m.getRemoteServiceBrokerFromHost=function getRemoteServiceBrokerFromHost(h,m,y,N){var D;return v(this,void 0,void 0,(function*(){if(!w.Settings.isInsidersFeatureSet)return null;let v=!1;if(null===(D=null===w.workspaceSessionInfoTracker||void 0===w.workspaceSessionInfoTracker?void 0:w.workspaceSessionInfoTracker.workspaceSessionInfo)||void 0===D?void 0:D.sessions)for(const h in w.workspaceSessionInfoTracker.workspaceSessionInfo.sessions)if(w.workspaceSessionInfoTracker.workspaceSessionInfo.sessions.hasOwnProperty(h)){const m=parseInt(h,10);if(w.workspaceSessionInfoTracker.workspaceSessionInfo.sessionNumber===m){v=w.workspaceSessionInfoTracker.workspaceSessionInfo.sessions[m].isOwner;break}}v?M.TrustedServer:M.UntrustedServer;const I=P.RpcProxy.create(R,h,y.withName(A.vsls.TraceSources.RemoteServiceBroker)),x={protocolVersion:"3.0",availableServices:[]},O=yield I.checkCompatibilityAsync(x,N);if(!O)return y.warning("The host is not sharing its remote service broker."),null;if(!O.protocolVersion)return y.error("The host did not disclose its protocol version."),null;const L=O.protocolVersion.split("."),U="3.0".split(".");if(L[0]!==U[0])return y.error(`Incompatible service broker on host. Local version 3.0, remote version ${O.protocolVersion}.`),null;y.info("Service broker on host is active and compatible. Connecting...");const B=yield m.connectToChannel("IServiceBroker-3",N);if(!B)return null;let W;try{const h=T.default.create();W=null==N?void 0:N.onCancellationRequested(m=>h.cancel(m));const m=yield C.RemoteServiceBroker.connectToMultiplexingDuplex(B,{protocolMajorVersion:2},h.token);return m.defaultClientCulture=k.env.language,m.defaultClientUICulture=k.env.language,m}catch(h){throw B.end(h),h}finally{null==W||W.dispose()}}))};const R={name:"ServiceBrokerHost",methods:["checkCompatibility"],events:[]};var M;!function(h){h[h.SameProcess=0]="SameProcess",h[h.OtherProcessOnSameMachine=1]="OtherProcessOnSameMachine",h[h.TrustedServer=2]="TrustedServer",h[h.UntrustedServer=3]="UntrustedServer",h[h.NexusServer=4]="NexusServer",h[h.NexusClient=5]="NexusClient"}(M||(M={}))},function(h,m,y){"use strict";var v=this&&this.__createBinding||(Object.create?function(h,m,y,v){void 0===v&&(v=y),Object.defineProperty(h,v,{enumerable:!0,get:function(){return m[y]}})}:function(h,m,y,v){void 0===v&&(v=y),h[v]=m[y]}),C=this&&this.__exportStar||function(h,m){for(var y in h)"default"===y||m.hasOwnProperty(y)||v(m,h,y)};Object.defineProperty(m,"__esModule",{value:!0});var T=y(147);Object.defineProperty(m,"Formatters",{enumerable:!0,get:function(){return T.Formatters}}),Object.defineProperty(m,"MessageDelimiters",{enumerable:!0,get:function(){return T.MessageDelimiters}}),Object.defineProperty(m,"RemoteServiceConnections",{enumerable:!0,get:function(){return T.RemoteServiceConnections}}),C(y(554),m);var w=y(567);Object.defineProperty(m,"AuthorizationServiceClient",{enumerable:!0,get:function(){return w.AuthorizationServiceClient}});var A=y(1383);Object.defineProperty(m,"ProtectedOperation",{enumerable:!0,get:function(){return A.ProtectedOperation}});var P=y(1384);Object.defineProperty(m,"RemoteServiceBroker",{enumerable:!0,get:function(){return P.RemoteServiceBroker}});var k=y(570);Object.defineProperty(m,"RemoteServiceConnectionInfo",{enumerable:!0,get:function(){return k.RemoteServiceConnectionInfo}});var R=y(555);Object.defineProperty(m,"ServiceJsonRpcDescriptor",{enumerable:!0,get:function(){return R.ServiceJsonRpcDescriptor}}),Object.defineProperty(m,"JsonRpcConnection",{enumerable:!0,get:function(){return R.JsonRpcConnection}});var M=y(307);Object.defineProperty(m,"ServiceMoniker",{enumerable:!0,get:function(){return M.ServiceMoniker}});var N=y(556);Object.defineProperty(m,"ServiceRpcDescriptor",{enumerable:!0,get:function(){return N.ServiceRpcDescriptor}})},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0}),m.BE32MessageWriter=m.BE32MessageReader=void 0;const v=y(6),C=y(85),T=y(19),w=y(558),A=y(148);m.BE32MessageReader=class BE32MessageReader{constructor(h,m){this.readable=h,this.decoder=m,this.errorEmitter=new v.Emitter,this.closeEmitter=new v.Emitter,this.partialMessageEmitter=new v.Emitter}get onError(){return this.errorEmitter.event}get onClose(){return this.closeEmitter.event}get onPartialMessage(){return this.partialMessageEmitter.event}listen(h){this.readable.on("error",h=>this.errorEmitter.fire(h));const m=C.default.create();return(async()=>{try{for(;;){const y=await A.getBufferFrom(this.readable,4,!0,m.token);if(!y)return void this.closeEmitter.fire();const v=y.readInt32BE(0),C=await A.getBufferFrom(this.readable,v,!1,m.token),T=await this.decoder(C);h(T)}}catch(h){this.errorEmitter.fire(h)}})(),v.Disposable.create(()=>m.cancel())}dispose(){this.errorEmitter.dispose(),this.closeEmitter.dispose()}};function asError(h){return h instanceof Error?h:new Error(`Writer received error. Reason: ${"string"==typeof h.message?h.message:"unknown"}`)}m.BE32MessageWriter=class BE32MessageWriter{constructor(h,m){this.writable=h,this.encoder=m,this.errorEmitter=new v.Emitter,this.closeEmitter=new v.Emitter,this.semaphore=new w.Semaphore(1),this.headerBuffer=Buffer.alloc(4),this.errorCount=0,h.on("error",h=>this.errorEmitter.fire([h,void 0,void 0])),h.once("close",()=>this.closeEmitter.fire())}get onError(){return this.errorEmitter.event}get onClose(){return this.closeEmitter.event}async write(h){await this.semaphore.use(async()=>{try{const m=await this.encoder(h);this.headerBuffer.writeInt32BE(m.byteLength,0),this.writable instanceof T.Writable&&this.writable.cork();const y=Promise.all([A.writeAsync(this.writable,this.headerBuffer),A.writeAsync(this.writable,m)]);this.writable instanceof T.Writable&&this.writable.uncork(),await y}catch(h){this.errorCount++,this.errorEmitter.fire([asError(h),void 0,this.errorCount])}})}dispose(){this.errorEmitter.dispose(),this.closeEmitter.dispose()}}},function(h,m,y){"use strict";var v,C=this&&this.__extends||(v=function(h,m){return(v=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(h,m){h.__proto__=m}||function(h,m){for(var y in m)m.hasOwnProperty(y)&&(h[y]=m[y])})(h,m)},function(h,m){function __(){this.constructor=h}v(h,m),h.prototype=null===m?Object.create(m):(__.prototype=m.prototype,new __)});Object.defineProperty(m,"__esModule",{value:!0});var NOOP=function(){},T=function(){function CancellationToken(h,m){this._isCancelled=h,this.canBeCancelled=m,this._callbacks=new Set}return Object.defineProperty(CancellationToken.prototype,"isCancelled",{get:function(){return this._isCancelled},enumerable:!0,configurable:!0}),Object.defineProperty(CancellationToken.prototype,"reason",{get:function(){if(this.isCancelled)return this._reason;throw new Error("This token is not cancelled.")},enumerable:!0,configurable:!0}),CancellationToken.prototype.racePromise=function(h){var m=this;return this.canBeCancelled?new Promise((function(y,v){var C=m.onCancelled((function(h){return v(new CancellationToken.CancellationError(h))}));h.then((function(h){y(h),C()}),(function(h){v(h),C()}))})):h},CancellationToken.prototype.throwIfCancelled=function(){if(this._isCancelled)throw new CancellationToken.CancellationError(this._reason)},CancellationToken.prototype.onCancelled=function(h){var m=this;return this.canBeCancelled?this.isCancelled?(h(this.reason),NOOP):(this._callbacks.add(h),function(){return m._callbacks&&m._callbacks.delete(h)}):NOOP},CancellationToken.create=function(){var h=new CancellationToken(!1,!0);return{token:h,cancel:function(m){h._isCancelled||(h._isCancelled=!0,h._reason=m,h._callbacks.forEach((function(h){return h(m)})),delete h._callbacks)}}},CancellationToken.timeout=function(h){var m=CancellationToken.create(),y=m.token,v=m.cancel,C=setTimeout((function(){return v(CancellationToken.timeout)}),h);return{token:y,cancel:function(h){y._isCancelled||(clearTimeout(C),v(h))}}},CancellationToken.all=function(){for(var h=[],m=0;m<arguments.length;m++)h[m]=arguments[m];if(h.some((function(h){return!h.canBeCancelled})))return CancellationToken.CONTINUE;var y=CancellationToken.create(),v=h.length,handleNextTokenCancelled=function(){if(0==--v){var m=h.map((function(h){return h._reason}));y.cancel(m)}};return h.forEach((function(h){return h.onCancelled(handleNextTokenCancelled)})),y.token},CancellationToken.race=function(){for(var h=[],m=0;m<arguments.length;m++)h[m]=arguments[m];for(var y=0,v=h;y<v.length;y++){var C=v[y];if(C._isCancelled)return C}var T,w=CancellationToken.create(),handleAnyTokenCancelled=function(h){T.forEach((function(h){return h()})),w.cancel(h)};return T=h.map((function(h){return h.onCancelled(handleAnyTokenCancelled)})),w.token},CancellationToken.CANCELLED=new CancellationToken(!0,!0),CancellationToken.CONTINUE=new CancellationToken(!1,!1),CancellationToken}();!function(h){var m=function(h){function CancellationError(m){var y=h.call(this,"Operation cancelled")||this;return y.reason=m,Object.setPrototypeOf(y,CancellationError.prototype),y}return C(CancellationError,h),CancellationError}(Error);h.CancellationError=m}(T||(T={})),m.default=T},function(h,m){function c(h){return h&&h.isBuffer&&h}h.exports=c("undefined"!=typeof Buffer&&Buffer)||c(this.Buffer)||c("undefined"!=typeof window&&window.Buffer)||this.Buffer},function(h,m,y){var v=y(44);function alloc(h){return new Array(h)}(m=h.exports=alloc(0)).alloc=alloc,m.concat=v.concat,m.from=function from(h){if(!v.isBuffer(h)&&v.isView(h))h=v.Uint8Array.from(h);else if(v.isArrayBuffer(h))h=new Uint8Array(h);else{if("string"==typeof h)return v.from.call(m,h);if("number"==typeof h)throw new TypeError('"value" argument must not be a number')}return Array.prototype.slice.call(h)}},function(h,m,y){var v=y(44),C=v.global;function alloc(h){return new C(h)}(m=h.exports=v.hasBuffer?alloc(0):[]).alloc=v.hasBuffer&&C.alloc||alloc,m.concat=v.concat,m.from=function from(h){if(!v.isBuffer(h)&&v.isView(h))h=v.Uint8Array.from(h);else if(v.isArrayBuffer(h))h=new Uint8Array(h);else{if("string"==typeof h)return v.from.call(m,h);if("number"==typeof h)throw new TypeError('"value" argument must not be a number')}return C.from&&1!==C.from.length?C.from(h):new C(h)}},function(h,m,y){var v=y(44);function alloc(h){return new Uint8Array(h)}(m=h.exports=v.hasArrayBuffer?alloc(0):[]).alloc=alloc,m.concat=v.concat,m.from=function from(h){if(v.isView(h)){var y=h.byteOffset,C=h.byteLength;(h=h.buffer).byteLength!==C&&(h.slice?h=h.slice(y,y+C):(h=new Uint8Array(h)).byteLength!==C&&(h=Array.prototype.slice.call(h,y,y+C)))}else{if("string"==typeof h)return v.from.call(m,h);if("number"==typeof h)throw new TypeError('"value" argument must not be a number')}return new Uint8Array(h)}},function(h,m){m.copy=function copy(h,m,y,v){var C;y||(y=0);v||0===v||(v=this.length);m||(m=0);var T=v-y;if(h===this&&y<m&&m<v)for(C=T-1;C>=0;C--)h[C+m]=this[C+y];else for(C=0;C<T;C++)h[C+m]=this[C+y];return T},m.toString=function toString(h,m,y){var v=0|m;y||(y=this.length);var C="",T=0;for(;v<y;)(T=this[v++])<128?C+=String.fromCharCode(T):(192==(224&T)?T=(31&T)<<6|63&this[v++]:224==(240&T)?T=(15&T)<<12|(63&this[v++])<<6|63&this[v++]:240==(248&T)&&(T=(7&T)<<18|(63&this[v++])<<12|(63&this[v++])<<6|63&this[v++]),T>=65536?(T-=65536,C+=String.fromCharCode(55296+(T>>>10),56320+(1023&T))):C+=String.fromCharCode(T));return C},m.write=function write(h,m){var y=m||(m|=0),v=h.length,C=0,T=0;for(;T<v;)(C=h.charCodeAt(T++))<128?this[y++]=C:C<2048?(this[y++]=192|C>>>6,this[y++]=128|63&C):C<55296||C>57343?(this[y++]=224|C>>>12,this[y++]=128|C>>>6&63,this[y++]=128|63&C):(C=65536+(C-55296<<10|h.charCodeAt(T++)-56320),this[y++]=240|C>>>18,this[y++]=128|C>>>12&63,this[y++]=128|C>>>6&63,this[y++]=128|63&C);return y-m}},function(h,m,y){m.setExtPackers=function setExtPackers(h){h.addExtPacker(14,Error,[packError,encode]),h.addExtPacker(1,EvalError,[packError,encode]),h.addExtPacker(2,RangeError,[packError,encode]),h.addExtPacker(3,ReferenceError,[packError,encode]),h.addExtPacker(4,SyntaxError,[packError,encode]),h.addExtPacker(5,TypeError,[packError,encode]),h.addExtPacker(6,URIError,[packError,encode]),h.addExtPacker(10,RegExp,[packRegExp,encode]),h.addExtPacker(11,Boolean,[packValueOf,encode]),h.addExtPacker(12,String,[packValueOf,encode]),h.addExtPacker(13,Date,[Number,encode]),h.addExtPacker(15,Number,[packValueOf,encode]),"undefined"!=typeof Uint8Array&&(h.addExtPacker(17,Int8Array,w),h.addExtPacker(18,Uint8Array,w),h.addExtPacker(19,Int16Array,w),h.addExtPacker(20,Uint16Array,w),h.addExtPacker(21,Int32Array,w),h.addExtPacker(22,Uint32Array,w),h.addExtPacker(23,Float32Array,w),"undefined"!=typeof Float64Array&&h.addExtPacker(24,Float64Array,w),"undefined"!=typeof Uint8ClampedArray&&h.addExtPacker(25,Uint8ClampedArray,w),h.addExtPacker(26,ArrayBuffer,w),h.addExtPacker(29,DataView,w));C.hasBuffer&&h.addExtPacker(27,T,C.from)};var v,C=y(44),T=C.global,w=C.Uint8Array.from,A={name:1,message:1,stack:1,columnNumber:1,fileName:1,lineNumber:1};function encode(h){return v||(v=y(560).encode),v(h)}function packValueOf(h){return h.valueOf()}function packRegExp(h){(h=RegExp.prototype.toString.call(h).split("/")).shift();var m=[h.pop()];return m.unshift(h.join("/")),m}function packError(h){var m={};for(var y in A)m[y]=h[y];return m}},function(h,m,y){var v=y(186),C=y(312),T=C.Uint64BE,w=C.Int64BE,A=y(44),P=y(311),k=y(1374),R=y(562).uint8,M=y(310).ExtBuffer,N="undefined"!=typeof Uint8Array,D="undefined"!=typeof Map,I=[];I[1]=212,I[2]=213,I[4]=214,I[8]=215,I[16]=216,m.getWriteType=function getWriteType(h){var m=k.getWriteToken(h),y=h&&h.useraw,C=N&&h&&h.binarraybuffer,x=C?A.isArrayBuffer:A.isBuffer,O=C?function bin_arraybuffer(h,m){bin_buffer(h,new Uint8Array(m))}:bin_buffer,L=D&&h&&h.usemap?function map_to_map(h,y){if(!(y instanceof Map))return obj_to_map(h,y);var v=y.size;m[v<16?128+v:v<=65535?222:223](h,v);var C=h.codec.encode;y.forEach((function(m,y,v){C(h,y),C(h,m)}))}:obj_to_map;return{boolean:function bool(h,y){m[y?195:194](h,y)},function:nil,number:function number(h,y){var v,C=0|y;if(y!==C)return void m[v=203](h,y);v=-32<=C&&C<=127?255&C:0<=C?C<=255?204:C<=65535?205:206:-128<=C?208:-32768<=C?209:210;m[v](h,C)},object:y?function object_raw(h,y){if(x(y))return function raw(h,y){var v=y.length;m[v<32?160+v:v<=65535?218:219](h,v),h.send(y)}(h,y);object(h,y)}:object,string:function _string(h){return function string(y,v){var C=v.length,T=5+3*C;y.offset=y.reserve(T);var w=y.buffer,A=h(C),k=y.offset+A;C=P.write.call(w,v,k);var R=h(C);if(A!==R){var M=k+R-A,N=k+C;P.copy.call(w,w,M,k,N)}m[1===R?160+C:R<=3?215+R:219](y,C),y.offset+=C}}(y?function raw_head_size(h){return h<32?1:h<=65535?3:5}:function str_head_size(h){return h<32?1:h<=255?2:h<=65535?3:5}),symbol:nil,undefined:nil};function object(h,y){if(null===y)return nil(h,y);if(x(y))return O(h,y);if(v(y))return function array(h,y){var v=y.length;m[v<16?144+v:v<=65535?220:221](h,v);for(var C=h.codec.encode,T=0;T<v;T++)C(h,y[T])}(h,y);if(T.isUint64BE(y))return function uint64(h,y){m[207](h,y.toArray())}(h,y);if(w.isInt64BE(y))return function int64(h,y){m[211](h,y.toArray())}(h,y);var C=h.codec.getExtPacker(y);if(C&&(y=C(y)),y instanceof M)return function ext(h,y){var v=y.buffer,C=v.length,T=I[C]||(C<255?199:C<=65535?200:201);m[T](h,C),R[y.type](h),h.send(v)}(h,y);L(h,y)}function nil(h,y){m[192](h,y)}function bin_buffer(h,y){var v=y.length;m[v<255?196:v<=65535?197:198](h,v),h.send(y)}function obj_to_map(h,y){var v=Object.keys(y),C=v.length;m[C<16?128+C:C<=65535?222:223](h,C);var T=h.codec.encode;v.forEach((function(m){T(h,m),T(h,y[m])}))}}},function(h,m,y){var v=y(561),C=y(312),T=C.Uint64BE,w=C.Int64BE,A=y(562).uint8,P=y(44),k=P.global,R=P.hasBuffer&&"TYPED_ARRAY_SUPPORT"in k&&!k.TYPED_ARRAY_SUPPORT,M=P.hasBuffer&&k.prototype||{};function init_token(){var h=A.slice();return h[196]=write1(196),h[197]=write2(197),h[198]=write4(198),h[199]=write1(199),h[200]=write2(200),h[201]=write4(201),h[202]=writeN(202,4,M.writeFloatBE||writeFloatBE,!0),h[203]=writeN(203,8,M.writeDoubleBE||writeDoubleBE,!0),h[204]=write1(204),h[205]=write2(205),h[206]=write4(206),h[207]=writeN(207,8,writeUInt64BE),h[208]=write1(208),h[209]=write2(209),h[210]=write4(210),h[211]=writeN(211,8,writeInt64BE),h[217]=write1(217),h[218]=write2(218),h[219]=write4(219),h[220]=write2(220),h[221]=write4(221),h[222]=write2(222),h[223]=write4(223),h}function write1(h){return function(m,y){var v=m.reserve(2),C=m.buffer;C[v++]=h,C[v]=y}}function write2(h){return function(m,y){var v=m.reserve(3),C=m.buffer;C[v++]=h,C[v++]=y>>>8,C[v]=y}}function write4(h){return function(m,y){var v=m.reserve(5),C=m.buffer;C[v++]=h,C[v++]=y>>>24,C[v++]=y>>>16,C[v++]=y>>>8,C[v]=y}}function writeN(h,m,y,v){return function(C,T){var w=C.reserve(m+1);C.buffer[w++]=h,y.call(C.buffer,T,w,v)}}function writeUInt64BE(h,m){new T(this,m,h)}function writeInt64BE(h,m){new w(this,m,h)}function writeFloatBE(h,m){v.write(this,h,m,!1,23,4)}function writeDoubleBE(h,m){v.write(this,h,m,!1,52,8)}m.getWriteToken=function getWriteToken(h){return h&&h.uint8array?function init_uint8array(){var h=init_token();return h[202]=writeN(202,4,writeFloatBE),h[203]=writeN(203,8,writeDoubleBE),h}():R||P.hasBuffer&&h&&h.safe?function init_safe(){var h=A.slice();return h[196]=writeN(196,1,k.prototype.writeUInt8),h[197]=writeN(197,2,k.prototype.writeUInt16BE),h[198]=writeN(198,4,k.prototype.writeUInt32BE),h[199]=writeN(199,1,k.prototype.writeUInt8),h[200]=writeN(200,2,k.prototype.writeUInt16BE),h[201]=writeN(201,4,k.prototype.writeUInt32BE),h[202]=writeN(202,4,k.prototype.writeFloatBE),h[203]=writeN(203,8,k.prototype.writeDoubleBE),h[204]=writeN(204,1,k.prototype.writeUInt8),h[205]=writeN(205,2,k.prototype.writeUInt16BE),h[206]=writeN(206,4,k.prototype.writeUInt32BE),h[207]=writeN(207,8,writeUInt64BE),h[208]=writeN(208,1,k.prototype.writeInt8),h[209]=writeN(209,2,k.prototype.writeInt16BE),h[210]=writeN(210,4,k.prototype.writeInt32BE),h[211]=writeN(211,8,writeInt64BE),h[217]=writeN(217,1,k.prototype.writeUInt8),h[218]=writeN(218,2,k.prototype.writeUInt16BE),h[219]=writeN(219,4,k.prototype.writeUInt32BE),h[220]=writeN(220,2,k.prototype.writeUInt16BE),h[221]=writeN(221,4,k.prototype.writeUInt32BE),h[222]=writeN(222,2,k.prototype.writeUInt16BE),h[223]=writeN(223,4,k.prototype.writeUInt32BE),h}():init_token()}},function(h,m,y){m.setExtUnpackers=function setExtUnpackers(h){h.addExtUnpacker(14,[decode,unpackError(Error)]),h.addExtUnpacker(1,[decode,unpackError(EvalError)]),h.addExtUnpacker(2,[decode,unpackError(RangeError)]),h.addExtUnpacker(3,[decode,unpackError(ReferenceError)]),h.addExtUnpacker(4,[decode,unpackError(SyntaxError)]),h.addExtUnpacker(5,[decode,unpackError(TypeError)]),h.addExtUnpacker(6,[decode,unpackError(URIError)]),h.addExtUnpacker(10,[decode,unpackRegExp]),h.addExtUnpacker(11,[decode,unpackClass(Boolean)]),h.addExtUnpacker(12,[decode,unpackClass(String)]),h.addExtUnpacker(13,[decode,unpackClass(Date)]),h.addExtUnpacker(15,[decode,unpackClass(Number)]),"undefined"!=typeof Uint8Array&&(h.addExtUnpacker(17,unpackClass(Int8Array)),h.addExtUnpacker(18,unpackClass(Uint8Array)),h.addExtUnpacker(19,[unpackArrayBuffer,unpackClass(Int16Array)]),h.addExtUnpacker(20,[unpackArrayBuffer,unpackClass(Uint16Array)]),h.addExtUnpacker(21,[unpackArrayBuffer,unpackClass(Int32Array)]),h.addExtUnpacker(22,[unpackArrayBuffer,unpackClass(Uint32Array)]),h.addExtUnpacker(23,[unpackArrayBuffer,unpackClass(Float32Array)]),"undefined"!=typeof Float64Array&&h.addExtUnpacker(24,[unpackArrayBuffer,unpackClass(Float64Array)]),"undefined"!=typeof Uint8ClampedArray&&h.addExtUnpacker(25,unpackClass(Uint8ClampedArray)),h.addExtUnpacker(26,unpackArrayBuffer),h.addExtUnpacker(29,[unpackArrayBuffer,unpackClass(DataView)]));C.hasBuffer&&h.addExtUnpacker(27,unpackClass(T))};var v,C=y(44),T=C.global,w={name:1,message:1,stack:1,columnNumber:1,fileName:1,lineNumber:1};function decode(h){return v||(v=y(564).decode),v(h)}function unpackRegExp(h){return RegExp.apply(null,h)}function unpackError(h){return function(m){var y=new h;for(var v in w)y[v]=m[v];return y}}function unpackClass(h){return function(m){return new h(m)}}function unpackArrayBuffer(h){return new Uint8Array(h).buffer}},function(h,m,y){var v=y(565);function init_token(h){var m,y=new Array(256);for(m=0;m<=127;m++)y[m]=constant(m);for(m=128;m<=143;m++)y[m]=fix(m-128,h.map);for(m=144;m<=159;m++)y[m]=fix(m-144,h.array);for(m=160;m<=191;m++)y[m]=fix(m-160,h.str);for(y[192]=constant(null),y[193]=null,y[194]=constant(!1),y[195]=constant(!0),y[196]=flex(h.uint8,h.bin),y[197]=flex(h.uint16,h.bin),y[198]=flex(h.uint32,h.bin),y[199]=flex(h.uint8,h.ext),y[200]=flex(h.uint16,h.ext),y[201]=flex(h.uint32,h.ext),y[202]=h.float32,y[203]=h.float64,y[204]=h.uint8,y[205]=h.uint16,y[206]=h.uint32,y[207]=h.uint64,y[208]=h.int8,y[209]=h.int16,y[210]=h.int32,y[211]=h.int64,y[212]=fix(1,h.ext),y[213]=fix(2,h.ext),y[214]=fix(4,h.ext),y[215]=fix(8,h.ext),y[216]=fix(16,h.ext),y[217]=flex(h.uint8,h.str),y[218]=flex(h.uint16,h.str),y[219]=flex(h.uint32,h.str),y[220]=flex(h.uint16,h.array),y[221]=flex(h.uint32,h.array),y[222]=flex(h.uint16,h.map),y[223]=flex(h.uint32,h.map),m=224;m<=255;m++)y[m]=constant(m-256);return y}function constant(h){return function(){return h}}function flex(h,m){return function(y){var v=h(y);return m(y,v)}}function fix(h,m){return function(y){return m(y,h)}}m.getReadToken=function getReadToken(h){var m=v.getReadFormat(h);return h&&h.useraw?function init_useraw(h){var m,y=init_token(h).slice();for(y[217]=y[196],y[218]=y[197],y[219]=y[198],m=160;m<=191;m++)y[m]=fix(m-160,h.bin);return y}(m):init_token(m)}},function(h,m,y){m.Encoder=Encoder;var v=y(566),C=y(308).EncodeBuffer;function Encoder(h){if(!(this instanceof Encoder))return new Encoder(h);C.call(this,h)}Encoder.prototype=new C,v.mixin(Encoder.prototype),Encoder.prototype.encode=function(h){this.write(h),this.emit("data",this.read())},Encoder.prototype.end=function(h){arguments.length&&this.encode(h),this.flush(),this.emit("end")}},function(h,m,y){m.Decoder=Decoder;var v=y(566),C=y(313).DecodeBuffer;function Decoder(h){if(!(this instanceof Decoder))return new Decoder(h);C.call(this,h)}Decoder.prototype=new C,v.mixin(Decoder.prototype),Decoder.prototype.decode=function(h){arguments.length&&this.write(h),this.flush()},Decoder.prototype.push=function(h){this.emit("data",h)},Decoder.prototype.end=function(h){this.decode(h),this.emit("end")}},function(h,m,y){m.createEncodeStream=EncodeStream;var v=y(10),C=y(19).Transform,T=y(308).EncodeBuffer;v.inherits(EncodeStream,C);var w={objectMode:!0};function EncodeStream(h){if(!(this instanceof EncodeStream))return new EncodeStream(h);h?h.objectMode=!0:h=w,C.call(this,h);var m=this;(this.encoder=new T(h)).push=function(h){m.push(h)}}EncodeStream.prototype._transform=function(h,m,y){this.encoder.write(h),y&&y()},EncodeStream.prototype._flush=function(h){this.encoder.flush(),h&&h()}},function(h,m,y){m.createDecodeStream=DecodeStream;var v=y(10),C=y(19).Transform,T=y(313).DecodeBuffer;v.inherits(DecodeStream,C);var w={objectMode:!0};function DecodeStream(h){if(!(this instanceof DecodeStream))return new DecodeStream(h);h?h.objectMode=!0:h=w,C.call(this,h);var m=this;(this.decoder=new T(h)).push=function(h){m.push(h)}}DecodeStream.prototype._transform=function(h,m,y){this.decoder.write(h),this.decoder.flush(),y&&y()}},function(h,m,y){y(314),y(309),m.createCodec=y(193).createCodec},function(h,m,y){y(314),y(309),m.codec={preset:y(193).preset}},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0}),m.ProtectedOperation=void 0;const v=y(28);!function(h){h.create=function create(h,m){return Object.freeze({operationMoniker:h,requiredTrustLevel:m})},h.isSupersetOf=function isSupersetOf(h,m){return v(h),v(m),h.operationMoniker===m.operationMoniker&&(h.requiredTrustLevel===m.requiredTrustLevel||!!h.requiredTrustLevel&&!!m.requiredTrustLevel&&h.requiredTrustLevel>m.requiredTrustLevel)},h.equals=function equals(h,m){return h===m||!(!h||!m)&&(h.operationMoniker===m.operationMoniker&&h.requiredTrustLevel===m.requiredTrustLevel)}}(m.ProtectedOperation||(m.ProtectedOperation={}))},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0}),m.RemoteServiceBroker=void 0;const v=y(28),C=y(85),T=y(13),w=y(1385),A=y(567),P=y(147),k=y(554),R=y(1389),M=y(570),N=y(557);class RemoteServiceBroker extends T.EventEmitter{constructor(h,m,y){super(),this.serviceBroker=h,this.multiplexingStream=y,this.isDisposed=!1,this.ownsMxStream=!1,this.defaultClientCulture="en-US",this.defaultClientUICulture="en-US",v(h),v(m),(m.supportedConnections&P.RemoteServiceConnections.Multiplexing)===P.RemoteServiceConnections.Multiplexing&&v(y),this.serviceBroker=h,this.serviceBroker.on("availabilityChanged",h=>{this.emit("availabilityChanged",h)}),this.multiplexingStream=y}static async connectToDuplex(h,m=C.default.CONTINUE){v(h);const y=k.FrameworkServices.remoteServiceBroker.constructRpcConnection(h),T=new R.ProxyForIRemoteServiceBroker(y.messageConnection);return await RemoteServiceBroker.initializeBrokerConnection(T,m)}static async connectToRemoteServiceBroker(h,m=C.default.CONTINUE){return v(h),await RemoteServiceBroker.initializeBrokerConnection(h,m)}static async connectToMultiplexingDuplex(h,m,y=C.default.CONTINUE){v(h);const T=await w.MultiplexingStream.CreateAsync(h,m,y),A=await T.acceptChannelAsync("",void 0,y),P=k.FrameworkServices.remoteServiceBroker.constructRpcConnection(A),M=new R.ProxyForIRemoteServiceBroker(P.messageConnection),N=await this.connectToMultiplexingRemoteServiceBroker(M,T,y);return N.ownsMxStream=!0,N}static async connectToMultiplexingRemoteServiceBroker(h,m,y=C.default.CONTINUE){v(h),v(m);const T={supportedConnections:P.RemoteServiceConnections.Multiplexing},w=await RemoteServiceBroker.initializeBrokerConnection(h,y,T,m);return w.ownsMxStream=!1,w}static async initializeBrokerConnection(h,m=C.default.CONTINUE,y,v){y=y||{supportedConnections:P.RemoteServiceConnections.None};try{await h.handshake(y,m)}catch(m){const y=h;throw null==y||y.dispose(),m}return new RemoteServiceBroker(h,y,v)}setAuthorizationService(h){var m;v(h),null===(m=this.authorizationClient)||void 0===m||m.dispose(),this.authorizationClient=new A.AuthorizationServiceClient(h)}async getProxy(h,m,y=C.default.CONTINUE){let T,A;v(h),m=m||{clientCulture:this.defaultClientCulture,clientUICulture:this.defaultClientUICulture},m=await this.applyAuthorization(m,y);let P={};try{if(P=await this.serviceBroker.requestServiceChannel(h.moniker,m,y),!P||M.RemoteServiceConnectionInfo.isEmpty(P))return null;if(!P.multiplexingChannelId||!this.multiplexingStream)throw P.pipeName?new Error("Cannot connect to named pipe"):new Error("Unsupported connection type");A=await this.multiplexingStream.acceptChannel(P.multiplexingChannelId),T=h.constructRpc(null==m?void 0:m.clientRpcTarget,A)}catch(h){throw null==T||T.dispose(),N.IsReadWriteStream(A)?A.end():A instanceof w.Channel&&A.dispose(),!A&&(null==P?void 0:P.requestId)&&await this.serviceBroker.cancelServiceRequest(P.requestId,y),h}return T}async getPipe(h,m,y=C.default.CONTINUE){if(v(h),m=m||{clientCulture:"en-US",clientUICulture:"en-US"},(m=await this.applyAuthorization(m,y)).clientRpcTarget)throw new Error("Cannot connect pipe to service with client RPC target");let T={},w=null,A=null;try{if(T=await this.serviceBroker.requestServiceChannel(h,m,y),!T||M.RemoteServiceConnectionInfo.isEmpty(T))return null;if(!T.multiplexingChannelId||!this.multiplexingStream)throw T.pipeName?new Error("Cannot connect to named pipe"):new Error("Unsupported connection type");return A=await this.multiplexingStream.acceptChannelAsync("",void 0,y),w=A.stream,w}catch(h){throw null==A||A.dispose(),null==w||w.end(),!w&&(null==T?void 0:T.requestId)&&await this.serviceBroker.cancelServiceRequest(T.requestId,y),h}}dispose(){var h;this.isDisposed=!0,this.serviceBroker.removeAllListeners(P.availabilityChangedEvent);const m=this.serviceBroker;null==m||m.dispose(),null===(h=this.authorizationClient)||void 0===h||h.dispose(),this.multiplexingStream&&this.ownsMxStream&&this.multiplexingStream.dispose()}async applyAuthorization(h,m){return this.authorizationClient&&!h.clientCredentials&&(h.clientCredentials=await this.authorizationClient.getCredentials(m)),h}}m.RemoteServiceBroker=RemoteServiceBroker},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0});var v=y(568);m.Channel=v.Channel;var C=y(1388);m.FullDuplexStream=C.FullDuplexStream;var T=y(316);m.MultiplexingStream=T.MultiplexingStream;var w=y(317);m.MultiplexingStreamOptions=w.MultiplexingStreamOptions;var A=y(148);m.writeSubstream=A.writeSubstream,m.readSubstream=A.readSubstream},function(h,m,y){"use strict";var v;h.exports=(v=()=>{},h=>(h.catch(v),h))},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0});const v=y(316),C=y(11),T=y(148),w=y(559),A=y(192),P=y(315);class MultiplexingStreamFormatter{static getIsOddRandomData(){return C.randomBytes(16)}static isOdd(h,m){let y;for(let v=0;v<h.length;v++){const C=h[v],T=m[v];if(C>T){y=!0;break}if(C<T){y=!1;break}}if(void 0===y)throw new Error("Unable to determine even/odd party.");return y}}m.MultiplexingStreamFormatter=MultiplexingStreamFormatter;class MultiplexingStreamV1Formatter extends MultiplexingStreamFormatter{constructor(h){super(),this.stream=h}end(){this.stream.end()}async writeHandshakeAsync(){const h=MultiplexingStreamFormatter.getIsOddRandomData(),m=Buffer.concat([MultiplexingStreamV1Formatter.protocolMagicNumber,h]);return await T.writeAsync(this.stream,m),h}async readHandshakeAsync(h,m){const y=h,v=await T.getBufferFrom(this.stream,MultiplexingStreamV1Formatter.protocolMagicNumber.length+16,!1,m);for(let h=0;h<MultiplexingStreamV1Formatter.protocolMagicNumber.length;h++){const m=MultiplexingStreamV1Formatter.protocolMagicNumber[h],y=v.readUInt8(h);if(m!==y)throw new Error(`Protocol magic number mismatch. Expected ${m} but was ${y}.`)}return{isOdd:MultiplexingStreamFormatter.isOdd(y,v.slice(MultiplexingStreamV1Formatter.protocolMagicNumber.length)),protocolVersion:{major:1,minor:0}}}async writeFrameAsync(h,m){const y=new Buffer(7);y.writeInt8(h.code,0),y.writeUInt32BE(h.channelId||0,1),y.writeUInt16BE((null==m?void 0:m.length)||0,5),await T.writeAsync(this.stream,y),m&&m.length>0&&await T.writeAsync(this.stream,m)}async readFrameAsync(h){const m=await T.getBufferFrom(this.stream,7,!0,h);if(null===m)return null;const y=new P.FrameHeader(m.readInt8(0),m.readUInt32BE(1)),v=m.readUInt16BE(5);return{header:y,payload:await T.getBufferFrom(this.stream,v)}}serializeOfferParameters(h){const m=new Buffer(h.name,v.MultiplexingStream.ControlFrameEncoding);if(m.length>v.MultiplexingStream.framePayloadMaxLength)throw new Error("Name is too long.");return m}deserializeOfferParameters(h){return{name:h.toString(v.MultiplexingStream.ControlFrameEncoding)}}serializerAcceptanceParameters(h){return new Buffer([])}deserializerAcceptanceParameters(h){return{}}serializeContentProcessed(h){throw new Error("Not supported in the V1 protocol.")}deserializeContentProcessed(h){throw new Error("Not supported in the V1 protocol.")}}m.MultiplexingStreamV1Formatter=MultiplexingStreamV1Formatter,MultiplexingStreamV1Formatter.protocolMagicNumber=new Buffer([47,223,29,80]);class MultiplexingStreamV2Formatter extends MultiplexingStreamFormatter{constructor(h){super(),this.reader=w.createDecodeStream(),h.pipe(this.reader),this.writer=h}end(){this.writer.end()}async writeHandshakeAsync(){const h=MultiplexingStreamFormatter.getIsOddRandomData(),m=[[MultiplexingStreamV2Formatter.ProtocolVersion.major,MultiplexingStreamV2Formatter.ProtocolVersion.minor],h];return await T.writeAsync(this.writer,w.encode(m)),h}async readHandshakeAsync(h,m){const y=await this.readMessagePackAsync(m);if(null===y)throw new Error("No data received during handshake.");return{isOdd:MultiplexingStreamFormatter.isOdd(h,y[1]),protocolVersion:{major:y[0][0],minor:y[0][1]}}}async writeFrameAsync(h,m){const y=[h.code];(h.channelId||m&&m.length>0)&&(y.push(h.channelId),m&&m.length>0&&y.push(m)),await T.writeAsync(this.writer,w.encode(y))}async readFrameAsync(h){const m=await this.readMessagePackAsync(h);return null===m?null:{header:new P.FrameHeader(m[0],m.length>1?m[1]:void 0),payload:m[2]||Buffer.from([])}}serializeOfferParameters(h){const m=[h.name];return h.remoteWindowSize&&m.push(h.remoteWindowSize),w.encode(m)}deserializeOfferParameters(h){const m=w.decode(h);return{name:m[0],remoteWindowSize:m[1]}}serializerAcceptanceParameters(h){const m=[];return h.remoteWindowSize&&m.push(h.remoteWindowSize),w.encode(m)}deserializerAcceptanceParameters(h){return{remoteWindowSize:w.decode(h)[0]}}serializeContentProcessed(h){return w.encode([h])}deserializeContentProcessed(h){return w.decode(h)[0]}async readMessagePackAsync(h){const m=new A.Deferred;for(;;){const y=this.reader.read();if(null===y){const y=new A.Deferred;this.reader.once("readable",y.resolve.bind(y)),this.reader.once("end",m.resolve.bind(m));const v=Promise.race([y.promise,m.promise]);if(await(h?h.racePromise(v):v),y.isCompleted)continue;return null}return y}}}m.MultiplexingStreamV2Formatter=MultiplexingStreamV2Formatter,MultiplexingStreamV2Formatter.ProtocolVersion={major:2,minor:0}},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0});const v=y(19);class FullDuplexStream{static CreatePair(){const h=new v.PassThrough,m=new v.PassThrough;return{first:FullDuplexStream.Splice(h,m),second:FullDuplexStream.Splice(m,h)}}static Splice(h,m){const y=new v.Duplex({write(h,y,v){m.write(h,y,v)},final(h){m.end(h)}});return y.read=h.read.bind(h),y.on=h.on.bind(h),y}}m.FullDuplexStream=FullDuplexStream},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0}),m.ProxyForIRemoteServiceBroker=void 0;const v=y(28),C=y(85),T=y(13),w=y(147);class ProxyForIRemoteServiceBroker extends T.EventEmitter{constructor(h){super(),this.rpc=h,this.isDisposedRpc=!1,v(h),this.rpc.onDispose(()=>{this.isDisposedRpc=!0,this.dispose()}),this.rpc.onNotification(w.availabilityChangedEvent,h=>{this.emit("availabilityChanged",h)}),h.listen()}async handshake(h,m=C.default.CONTINUE){if(!this.isDisposedRpc)return await this.rpc.sendRequest("handshake",[h])}async requestServiceChannel(h,m,y=C.default.CONTINUE){if(!this.isDisposedRpc){return await this.rpc.sendRequest("requestServiceChannel",[h,m])}return{}}async cancelServiceRequest(h,m=C.default.CONTINUE){this.isDisposedRpc||await this.rpc.sendRequest("cancelServiceRequest",[h])}dispose(){this.isDisposedRpc||(this.rpc.dispose(),this.isDisposedRpc=!0)}}m.ProxyForIRemoteServiceBroker=ProxyForIRemoteServiceBroker},function(h,m,y){"use strict";var v=this&&this.__awaiter||function(h,m,y,v){return new(y||(y=Promise))((function(C,T){function fulfilled(h){try{step(v.next(h))}catch(h){T(h)}}function rejected(h){try{step(v.throw(h))}catch(h){T(h)}}function step(h){h.done?C(h.value):function adopt(h){return h instanceof y?h:new y((function(m){m(h)}))}(h.value).then(fulfilled,rejected)}step((v=v.apply(h,m||[])).next())}))};Object.defineProperty(m,"__esModule",{value:!0});const C=y(551),T=y(1391);class LiveShareExtensionApi extends C.LiveShareExtensionApiBase{constructor(h){super(h)}getCallingPackage(h){return v(this,void 0,void 0,(function*(){let m=T.default("LiveShareExtensionApi.getApi",h);return m||(m=T.default("LiveShareExtensionApi.getApiAsync",h)),m}))}}m.LiveShareExtensionApi=LiveShareExtensionApi},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0});const v=y(7),C=y(5),T=y(550);function getPackageInfo(h){const m=v.join(h,"package.json");try{const h=C.loadJSON(m);return T.getPackageInfo(h)}catch(h){return null}}m.default=function getCallingPackage(h,m){if(!m)return null;const y=m.findIndex(m=>m.functionName===h);if(y>=0&&y<m.length-1){const h=(m[y+1].fileName||"").replace(/[\\\/][^\\\/]*$/,"").replace(/[\\\/]node_modules[\\\/].*/,"");return getPackageInfo(h)||getPackageInfo(v.dirname(h))}return null}},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0});const v=y(306);m.StatusbarQuickPickItemsProvider=class StatusbarQuickPickItemsProvider{getQuickPickItems(h){return v.ExtensionContributions.getQuickPickItems()}}},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0});const v=y(1394),C=y(2);m.portForwardingService=C.lazyLoad(()=>v.createPortForwardingService())},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0});const v=y(3);m.createPortForwardingService=function createPortForwardingService(){return v.dependencies.portForwardingService()}},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0});const v=y(7),C=y(18),T=y(0),w=y(67),A=y(4),P=y(5),k=y(571),R=y(3),M=y(15),N=y(575);m.workspaceHubPortFowardingServiceFactory=function workspaceHubPortFowardingServiceFactory(h,m){return new WorkspaceHubPortFowardingService(h,R.dependencies,m)};class WorkspaceHubPortFowardingService extends(P.Inittable(P.Disposable(Object))){constructor(h,m,y){super(),this.dependencies=h,this.rpcServices=m,this.logger=y,this.sharingStarted=new T.EventEmitter,this.pipeSharingStarted=new T.EventEmitter,this.browseSharingStarted=new T.EventEmitter,this.sharingStopped=new T.EventEmitter,this.pipeSharingStopped=new T.EventEmitter,this.sharingChanged=new T.EventEmitter,this.disposeCts=new T.CancellationTokenSource,this.disposables=[this.disposeCts],this.serverDisposables=new Map,this.alwaysUseFreePort=!1,this.servers=new Map,this.pipes=[],this.serviceInfo=A.vsls.PortForwardingService,this.service.onSharingStarted(this.serverSharingStarted,this,this.disposables),this.service.onBrowseSharingStarted(this.serverBrowseSharingStarted,this,this.disposables),this.service.onSharingChanged(this.serverSharingChanged,this,this.disposables),this.service.onSharingStopped(this.serverSharingStopped,this,this.disposables),this.service.onPipeSharingStarted(this.serverPipeSharingStarted,this,this.disposables),this.service.onPipeSharingStopped(this.serverPipeSharingStopped,this,this.disposables)}get service(){return this.rpcServices.serverSharingService()}getSharedServersAsync(){return Promise.resolve(Array.from(this.servers.values()))}getSharedPipesAsync(){return Promise.resolve(this.pipes)}getLastAccessTimeAsync(){return Promise.resolve(0)}setDestinationPortAsync(h,m){throw Error("Not implemented")}get onSharingStarted(){return this.sharingStarted.event}get onPipeSharingStarted(){return this.pipeSharingStarted.event}get onBrowseSharingStarted(){return this.browseSharingStarted.event}get onSharingStopped(){return this.sharingStopped.event}get onPipeSharingStopped(){return this.pipeSharingStopped.event}get onSharingChanged(){return this.sharingChanged.event}async serverSharingStarted({server:h}){await this.startForwarding(h)}serverBrowseSharingStarted({server:h}){this.startBrowseSharing(h)}serverSharingStopped({server:h}){this.stopForwarding(h,!0)}serverSharingChanged({server:{sourcePort:h,sessionName:m,isTCPServerConnectionEstablished:y,hasTLSHandshakePassed:v,privacy:C}}){const T=this.servers.get(h);!T||m===T.sessionName&&y===T.isTCPServerConnectionEstablished&&v===T.hasTLSHandshakePassed&&C===T.privacy||this.sharingChanged.fire({server:T})}serverPipeSharingStarted({pipe:h}){this.startPipeForwarding(h)}serverPipeSharingStopped({pipe:h}){this.stopPipeForwarding(h)}async init(){if(!this.isInitialized){await super.init();let h=[];try{h=await this.service.getSharedServersAsync(this.disposeCts.token)}catch(h){this.logger.error("Failed to get remote servers",h)}this.alwaysUseFreePort=await WorkspaceHubPortFowardingService.isWorkspaceTracked(R.workspaceSessionInfoTracker.workspaceSessionInfo),h&&h.forEach(h=>this.startForwarding(h,!0,!0));try{const h=await this.service.getSharedPipesAsync(this.disposeCts.token);h&&h.forEach(h=>this.startPipeForwarding(h))}catch(h){}}}static async isWorkspaceTracked({id:h,conversationId:m}){if(h&&m)try{const y=v.join(C.tmpdir(),"VSLS-WS",M.Privacy.getSha256Hash(`${h}\n${m}`,20));return await w.fileAccess.existsAsync(y)}catch(h){}return!1}async dispose(){this.isDisposed||(this.disposeCts.cancel(),this.disposables.splice(0).forEach(h=>h.dispose()),this.serverDisposables.forEach(h=>h.dispose()),this.serverDisposables.clear(),this.sudoPortforwarderClient&&await this.sudoPortforwarderClient.disconnect(),await super.dispose())}async startForwarding(h,m=!0,y=!1){this.isDisposed;const{sourcePort:v}=h;if(this.servers.has(v)||this.serverDisposables.has(v))return;let T;if(C.platform()!==w.OSPlatform.WINDOWS&&!this.alwaysUseFreePort&&v<1024&&!this.disableSudoPortForwarder&&(T=await this.startSudoPortForwarder(h),this.isDisposed))return;if(!T&&(T=await this.startLocalPortForwarder(h),!T))return;const A=Object.assign(Object.assign({},h),{destinationPort:T});this.servers.set(v,A),m&&this.sharingStarted.fire({server:A}),y&&h.browseUrl&&this.startBrowseSharing(A)}async startSudoPortForwarder(h){try{if(!this.sudoPortforwarderClient){const m=this.dependencies.workspaceId;if(!m||this.isDisposed)return;const y=await this.dependencies.hubPipeName;if(!y||this.isDisposed)return;if(!this.sudoPortforwarderClient){const v=await P.NotificationUtil.showInformationMessage(`Live Share host is sharing a server at port ${h.sourcePort}. How do you want to map it?`,!1,"Random free port",`System port ${h.sourcePort} (elevation required)`);if(this.isDisposed)return;if("Random free port"===v)return void(this.disableSudoPortForwarder=!0);const C=await N.createSudoPortForwardingHubClient(R.constants.LIVESHARE_EXTENSION_ID,m,this.logger.createChild("PortForwardingHubClient"),{sudoWindowName:"Live Share Port Forwarder",timeoutMs:12e4,failFast:!0});if(this.isDisposed)return;if(await C.connect(y),this.sudoPortforwarderClient||this.isDisposed){if(await C.disconnect(),this.isDisposed)return}else this.sudoPortforwarderClient=C}}const m=await this.sudoPortforwarderClient.startPortForwarding(h);if(m&&!this.isDisposed)return this.serverDisposables.set(h.sourcePort,{dispose:()=>this.sudoPortforwarderClient.stopPortForwarding(h)}),m}catch(h){this.logger.error(`Error starting sudo port forwarder: ${h}`),this.disableSudoPortForwarder=!0}}async startLocalPortForwarder(h){const{sourcePort:m}=h,y=this.logger.withName(`liveshare-tunnel${m}`),v=new k.LocalPortForwarder(y,h,await this.dependencies.workspaceConnectionPromise,this.rpcServices.streamManagerService(),this.alwaysUseFreePort?0:m);this.serverDisposables.set(m,v);try{await v.start(1)}catch(h){y.error(`Error starting local port forwarder for port ${m}: ${h.message||h}`),this.serverDisposables.delete(m)}if(!this.isDisposed&&this.serverDisposables.has(m))return v.localPort;v.dispose()}stopForwarding({sourcePort:h},m){if(this.isDisposed||!h)return;const y=this.serverDisposables.get(h);y&&(y.dispose(),this.serverDisposables.delete(h));const v=this.servers.get(h);v&&(this.servers.delete(h),m&&this.sharingStopped.fire({server:v}))}startBrowseSharing(h){}startPipeForwarding(h){}stopPipeForwarding(h){}}},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0});const v=y(104),C=y(2),T=y(1397),w=y(1399);m.initWorkspaceHubConnectionHub=C.once(h=>new v.ConnectionHub(h.createChild("sudo-pf-remote"),w.performance,T.HubClientConnection))},function(h,m,y){"use strict";var v=this&&this.__decorate||function(h,m,y,v){var C,T=arguments.length,w=T<3?m:null===v?v=Object.getOwnPropertyDescriptor(m,y):v;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)w=Reflect.decorate(h,m,y,v);else for(var A=h.length-1;A>=0;A--)(C=h[A])&&(w=(T<3?C(w):T>3?C(m,y,w):C(m,y))||w);return T>3&&w&&Object.defineProperty(m,y,w),w},C=this&&this.__metadata||function(h,m){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(h,m)},T=this&&this.__awaiter||function(h,m,y,v){return new(y||(y=Promise))((function(C,T){function fulfilled(h){try{step(v.next(h))}catch(h){T(h)}}function rejected(h){try{step(v.throw(h))}catch(h){T(h)}}function step(h){h.done?C(h.value):function adopt(h){return h instanceof y?h:new y((function(m){m(h)}))}(h.value).then(fulfilled,rejected)}step((v=v.apply(h,m||[])).next())}))};Object.defineProperty(m,"__esModule",{value:!0});const w=y(2),A=y(104),P=y(573),k=y(67),R=y(29);let M=0;class HubClientConnection extends A.LiveShareConnection{constructor(){super(...arguments),this.socket=null}get type(){return A.TConnectionTypes.WorkspaceHub}createWorkspaceClient(){return T(this,void 0,void 0,(function*(){const{hubPipeName:h}=this.options,m=yield this.startSocketSessionForHubWorkspace(h);return yield P.WorkspaceHubClient.create(new R.NodeStream(m),this.trace.createChild(`workspace-hub-client:${++M}`))}))}startSocketSessionForHubWorkspace(h){return T(this,void 0,void 0,(function*(){return yield w.withRetries(m=>T(this,void 0,void 0,(function*(){const y=20-m;this.trace.verbose(`trying to connect to the TCP socket, retries left: "${m}" (retry: "${y}")`);const v=0===y?h:`${h}-${y}`;return this.socket=yield k.startSocketSessionOnPipe(v),this.socket.on("close",this.dispose.bind(this,"TCP socket closed.")),this.socket.on("end",this.dispose.bind(this,"TCP socket ended")),this.socket})),{retries:20,retryDelay:1e3})}))}dispose(h){var m,y;this.isDisposed||(null===(m=this.workspaceClientReference)||void 0===m||m.disconnect().catch(h=>{this.trace.verbose("error while disconnecting workspace client: ",w.errorToObject(h))}).finally(()=>{var m;null===(m=this.workspaceClientReference)||void 0===m||m.dispose(h),this.workspaceClientReference=void 0,this.workspaceSessionInfoReference=void 0}),null===(y=this.socket)||void 0===y||y.destroy())}}v([w.withHelperDecorator(w.once),C("design:type",Function),C("design:paramtypes",[String]),C("design:returntype",Promise)],HubClientConnection.prototype,"startSocketSessionForHubWorkspace",null),m.HubClientConnection=HubClientConnection},function(h,m,y){"use strict";var v=this&&this.__awaiter||function(h,m,y,v){return new(y||(y=Promise))((function(C,T){function fulfilled(h){try{step(v.next(h))}catch(h){T(h)}}function rejected(h){try{step(v.throw(h))}catch(h){T(h)}}function step(h){h.done?C(h.value):function adopt(h){return h instanceof y?h:new y((function(m){m(h)}))}(h.value).then(fulfilled,rejected)}step((v=v.apply(h,m||[])).next())}))},C=this&&this.__importStar||function(h){if(h&&h.__esModule)return h;var m={};if(null!=h)for(var y in h)Object.hasOwnProperty.call(h,y)&&(m[y]=h[y]);return m.default=h,m};Object.defineProperty(m,"__esModule",{value:!0});const T=C(y(6)),w=y(15),A=y(39),P=y(16),k=y(143),R=y(2);class WorkspaceHubClient extends R.DisposableClass{constructor(h,m){super(m),this.multiChannelRpcClient=h,this.onHostConnectionChangedEmitter=new T.Emitter,this.onWorkspaceMetricsUpdatedEmitter=new T.Emitter,this.onHostConnectionChanged=this.onHostConnectionChangedEmitter.event,this.onWorkspaceMetricsUpdated=this.onWorkspaceMetricsUpdatedEmitter.event;const fireHostConnectionChanged=h=>{this.onHostConnectionChangedEmitter.fire(h)};let y=!1;const fireHostConnectionClosed=(h,v)=>{y||(m.info(`firing host connection closed -> reason:${h}`),y=!0,fireHostConnectionChanged(null!=v?v:{state:A.ConnectedState.Closed,duration:0}),this.disconnect().catch(h=>{m.info("error while disconnecting workspace hub client",R.errorToObject(h))}),this.dispose("host connection closed"))};h.rpcConnection.onDispose(()=>{fireHostConnectionClosed("onDisposed"),this.isDisposed||m.warning("Rpc connection was disposed from our hub service")});const v=m.createChild("rpc");this.workspaceServiceClient=P.RpcProxy.create(A.workspaceServiceClient,this.rpcClient,new w.Logger(m.name,(h,m,...y)=>{m.startsWith("> workspaceServiceClient.workspaceMetricsUpdated")||m.includes("workspaceServiceClient.checkConnection()")||v.log(h,m,...y)})),this.workspaceServiceClient.onHostConnectionChanged(h=>{h.workspaceId===this.joinedWorkspaceId&&(h.state===A.ConnectedState.Closed?fireHostConnectionClosed("onHostConnectionChanged",h):fireHostConnectionChanged(h))}),this.workspaceServiceClient.onWorkspaceMetricsUpdated(h=>{h.workspaceId===this.joinedWorkspaceId&&this.onWorkspaceMetricsUpdatedEmitter.fire(h)}),this.addToDisposables({dispose:()=>fireHostConnectionClosed("disposed")},h),this.rpcProxyCache=new P.RpcProxyCache(this.multiChannelRpcClient,m)}static create(h,m){return v(this,void 0,void 0,(function*(){const y=yield k.createMultiChannelRpcClient(h,m);return new WorkspaceHubClient(y,m)}))}get rpcClient(){return this.multiChannelRpcClient}getServiceProxy(h){return this.rpcProxyCache.getOrCreate(h)}join(h){return v(this,void 0,void 0,(function*(){const m=Date.now(),y=h.workspaceId;let v;if(h.sessionInfoFactory&&(v=yield this.workspaceServiceClient.getSessionInfoAsync(y)),!v)try{const m=Object.assign({},h);["performance","sessionInfoFactory"].forEach(h=>delete m[h]),Object.keys(m).filter(h=>h.startsWith("mock")).forEach(h=>delete m[h]),h.sessionInfoFactory&&(m.connectionInfo=yield h.sessionInfoFactory(y)),v=yield this.workspaceServiceClient.joinAsync(m)}catch(h){if(h instanceof T.ResponseError){if(h.code===A.RPC_ERR_NO_HOST_NOT_CONNECTED)throw new A.NoHostConnectedError(h.data);if(h.code===A.RPC_ERR_RELAY_CONNECTIONY_SSH)throw new A.RelayConnectionError(h.message,h.data)}throw h}this.joinedWorkspaceId=y;const C=(Date.now()-m).toFixed(1);return this.trace.info(`join completed -> time:${C} session:${v.sessionNumber} conversation:${v.conversationId}`),v}))}openStreamingChannel(h,m){return v(this,void 0,void 0,(function*(){R.assertDefined(this.joinedWorkspaceId,"Workspace not joined.");const[y]=yield Promise.all([this.multiChannelRpcClient.multiChannelStream.openChannel(),this.workspaceServiceClient.openStreamingChannelAsync(this.joinedWorkspaceId,h,null!=m?m:T.CancellationToken.None)]);return y}))}disconnect(){return v(this,void 0,void 0,(function*(){R.assertDefined(this.joinedWorkspaceId,"workspace not joined"),yield this.workspaceServiceClient.disconnectAsync(this.joinedWorkspaceId),this.dispose()}))}keepAlive(h){return this.workspaceServiceClient.keepAliveAsync(h)}checkConnection(h){return v(this,void 0,void 0,(function*(){R.assertDefined(this.joinedWorkspaceId,"workspace not joined"),yield this.workspaceServiceClient.checkConnectionAsync(this.joinedWorkspaceId,h)}))}setCheckConnectionOptions(h){return v(this,void 0,void 0,(function*(){R.assertDefined(this.joinedWorkspaceId,"workspace not joined"),yield this.workspaceServiceClient.setCheckConnectionOptionsAsync(this.joinedWorkspaceId,h)}))}}m.WorkspaceHubClient=WorkspaceHubClient},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0});const v=y(135);m.performance=v.initializePerformanceInstance("start")},function(h,m,y){"use strict";var v=this&&this.__awaiter||function(h,m,y,v){return new(y||(y=Promise))((function(C,T){function fulfilled(h){try{step(v.next(h))}catch(h){T(h)}}function rejected(h){try{step(v.throw(h))}catch(h){T(h)}}function step(h){h.done?C(h.value):function adopt(h){return h instanceof y?h:new y((function(m){m(h)}))}(h.value).then(fulfilled,rejected)}step((v=v.apply(h,m||[])).next())}))};Object.defineProperty(m,"__esModule",{value:!0});const C=y(16),T=y(4),w=y(574),A=y(572),P=y(2);class SudoPortForwarderService extends P.DisposableClass{constructor(h,m,y){super(h.createChild("sudo-pf-service")),this.workspaceId=m,this.connectionHub=y,this.sudoLocalPortForwarders=new Map,this.hubPipeName=null,this.rpcServer=new C.RpcServer(h.createChild("RpcServer")),this.rpcServer.registerRpcService(this,A.SudoPortForwarderServiceClient),this.addToDisposables(this.rpcServer),this.rpcServer.addToDisposables(this)}acceptStream(h){const m=this.rpcServer.acceptRpcMessageStream(h)[0];return m.onClose(()=>{this.disconnectAsync()}),m}connectAsync(h){return v(this,void 0,void 0,(function*(){try{this.hubPipeName=h;const m=Date.now();this.trace.info(`connectAsync: Connecting now.. pipename ${h}`),(yield this.connectionHub.connect({hubPipeName:h,workspaceId:this.workspaceId,liveShareEndpoint:"",token:""})).workspaceClient.rpcClient.onClose(()=>{this.sudoLocalPortForwarders.forEach(h=>v(this,void 0,void 0,(function*(){yield h.stop()}))),this.sudoLocalPortForwarders=new Map});const y=(Date.now()-m).toFixed(1);this.trace.verbose(`connectAsync: connected -> total time:${y}`)}catch(h){throw this.trace.error("connectAsync: Error connecting",h),h}}))}startPortForwardingAsync(h){return v(this,void 0,void 0,(function*(){try{this.trace.verbose("startPortForwardingAsync");const m=Date.now();P.assertDefined(this.hubPipeName,"No hub pipe name set, please call `connectAsync` first.");const y=yield this.connectionHub.connect({hubPipeName:this.hubPipeName,workspaceId:this.workspaceId,liveShareEndpoint:"",token:""}),v=y.workspaceClient.getServiceProxy(T.vsls.StreamManagerService),C=new w.LocalPortForwarder(this.trace,h,y.workspaceClient,v,h.sourcePort,void 0,[]);this.sudoLocalPortForwarders.set(h.sourcePort,C),yield C.start();const A=(Date.now()-m).toFixed(1);return this.trace.verbose(`startPortForwardingAsync: forwarded port -> total time:${A}`),C.localPort}catch(h){throw this.trace.error("startPortForwardingAsync: Error forwarding port",h),h}}))}stopPortForwardingAsync(h){return v(this,void 0,void 0,(function*(){try{const m=this.sudoLocalPortForwarders.get(h.sourcePort);if(!m)return void this.trace.error(`stopPortForwardingAsync: Trying to stop port forwarder (for port ${h.sourcePort}) which is not already forwarded`);yield m.stop(),this.sudoLocalPortForwarders.delete(h.sourcePort),this.trace.verbose("stopPortForwardingAsync: stopped forwarded port")}catch(h){throw this.trace.error("stopPortForwardingAsync: Error stopping forwarded port",h),h}}))}disconnectAsync(){var h;return v(this,void 0,void 0,(function*(){if(!this.hubPipeName)return void this.trace.info("not connected");const m=yield this.connectionHub.getConnection({hubPipeName:this.hubPipeName,workspaceId:this.workspaceId,liveShareEndpoint:"",token:""});yield null===(h=null==m?void 0:m.workspaceClient)||void 0===h?void 0:h.disconnect()}))}}m.SudoPortForwarderService=SudoPortForwarderService},function(h,m,y){"use strict";const v=y(31);class Locked extends Error{constructor(h){super(`${h} is locked`)}}const C={old:new Set,young:new Set};let T;const getAvailablePort=h=>new Promise((m,y)=>{const C=v.createServer();C.unref(),C.on("error",y),C.listen(h,()=>{const{port:h}=C.address();C.close(()=>{m(h)})})});h.exports=async h=>{let m;h&&(m="number"==typeof h.port?[h.port]:h.port),void 0===T&&(T=setInterval(()=>{C.old=C.young,C.young=new Set},15e3),T.unref&&T.unref());for(const y of function*(h){h&&(yield*h),yield 0}(m))try{let m=await getAvailablePort({...h,port:y});for(;C.old.has(m)||C.young.has(m);){if(0!==y)throw new Locked(y);m=await getAvailablePort({...h,port:y})}return C.young.add(m),m}catch(h){if(!(["EADDRINUSE","EACCES"].includes(h.code)||h instanceof Locked))throw h}throw new Error("No available ports found")},h.exports.makeRange=(h,m)=>{if(!Number.isInteger(h)||!Number.isInteger(m))throw new TypeError("`from` and `to` must be integer numbers");if(h<1024||h>65535)throw new RangeError("`from` must be between 1024 and 65535");if(m<1024||m>65536)throw new RangeError("`to` must be between 1024 and 65536");if(m<h)throw new RangeError("`to` must be greater than or equal to `from`");return function*(h,m){for(let y=h;y<=m;y++)yield y}(h,m)}},function(h,m,y){"use strict";var v=this&&this.__awaiter||function(h,m,y,v){return new(y||(y=Promise))((function(C,T){function fulfilled(h){try{step(v.next(h))}catch(h){T(h)}}function rejected(h){try{step(v.throw(h))}catch(h){T(h)}}function step(h){h.done?C(h.value):function adopt(h){return h instanceof y?h:new y((function(m){m(h)}))}(h.value).then(fulfilled,rejected)}step((v=v.apply(h,m||[])).next())}))};Object.defineProperty(m,"__esModule",{value:!0});const C=y(2);class SudoPortforwarderClient extends C.DisposableClass{constructor(h,m){super(h.createChild("sudo-pf-client")),this.portforwarderClient=m}connect(h){return v(this,void 0,void 0,(function*(){const m=Date.now();yield this.portforwarderClient.connectAsync(h);const y=Math.round(Date.now()-m);this.trace.verbose(`connect codespacePortForwarderService completed -> time:${y}`)}))}startPortForwarding(h){return v(this,void 0,void 0,(function*(){const m=Date.now(),y=yield this.portforwarderClient.startPortForwardingAsync(h),v=Math.round(Date.now()-m);return this.trace.verbose(`start portforwarding using codespacePortForwarderService completed -> time:${v}`),y}))}stopPortForwarding(h){return v(this,void 0,void 0,(function*(){const m=Date.now();yield this.portforwarderClient.stopPortForwardingAsync(h);const y=Math.round(Date.now()-m);this.trace.verbose(`stop portforwarding using codespacePortForwarderService completed -> time:${y}`)}))}disconnect(){return v(this,void 0,void 0,(function*(){const h=Date.now();yield this.portforwarderClient.disconnectAsync();const m=Math.round(Date.now()-h);this.trace.verbose(`disconnect codespacePortForwarderService completed -> time:${m}`)}))}}m.SudoPortforwarderClient=SudoPortforwarderClient},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0}),m.LOGS_DIRECTORY="CodespacePortForwarder_logs"},function(h,m,y){"use strict";var v=this&&this.__awaiter||function(h,m,y,v){return new(y||(y=Promise))((function(C,T){function fulfilled(h){try{step(v.next(h))}catch(h){T(h)}}function rejected(h){try{step(v.throw(h))}catch(h){T(h)}}function step(h){h.done?C(h.value):function adopt(h){return h instanceof y?h:new y((function(m){m(h)}))}(h.value).then(fulfilled,rejected)}step((v=v.apply(h,m||[])).next())}))},C=this&&this.__importStar||function(h){if(h&&h.__esModule)return h;var m={};if(null!=h)for(var y in h)Object.hasOwnProperty.call(h,y)&&(m[y]=h[y]);return m.default=h,m};Object.defineProperty(m,"__esModule",{value:!0});const T=C(y(577)),w=C(y(6)),A=y(571),P=y(16),k=y(67),R=y(2),M=y(576),N=y(318),D=new R.Mutex;function getHubAppFilePath(h){return N.getAppFilePath(M.hubPortForwardingAppFile,h)}function launchSudoPortForwardingHub(h,m,y,v){const C=getHubAppFilePath(h);return k.sudoExecAgent(T.execPath,[C,"--workspaceId",m,"--pipe",y,"--keepAliveTime","60000","--autoExit","--noLogConsole"],{ELECTRON_RUN_AS_NODE:"1"},v||"Codespaces Port Forwarder")}m.createSudoPortForwardingHubClient=function createSudoPortForwardingHubClient(h,m,y,C){const T=getHubAppFilePath(h),{sudoWindowName:M,timeoutMs:I,failFast:x}=C||{};return D.dispatch(()=>v(this,void 0,void 0,(function*(){const C=N.getAgentPipeName(T,"pf",m),D=(new Date).getTime();let O,L=0;for(;;)try{const h=yield k.startSocketSessionOnPipe(C),m=w.createMessageConnection(h,h);m.listen();const T=new P.RpcClient({create:h=>v(this,void 0,void 0,(function*(){return Promise.resolve(m)}))},y);return new A.SudoPortforwarderClient(y,P.RpcProxy.create(A.SudoPortForwarderServiceClient,T,y))}catch(v){++L;const w=(new Date).getTime()-D;if(1===L){try{yield k.lockAgent(T,()=>(launchSudoPortForwardingHub(h,m,C,M).catch(h=>{y.error(h),x&&(O=h||new Error("Failed to launch sudo port forwarding hub"))}),Promise.resolve()),y)}catch(h){y.error("Failed to start sudo process",h)}yield R.wait(1e4)}else{if("number"!=typeof I&&5===L||"number"==typeof I&&w>I)throw y.error("Failed to connect to the hub workspace process",v),v;if(O)throw O;y.verbose(`Attempting connection:${L} failed`),yield R.wait(1e3)}}})))}},function(h,m,y){"use strict";var v=this&&this.__awaiter||function(h,m,y,v){return new(y||(y=Promise))((function(C,T){function fulfilled(h){try{step(v.next(h))}catch(h){T(h)}}function rejected(h){try{step(v.throw(h))}catch(h){T(h)}}function step(h){h.done?C(h.value):function adopt(h){return h instanceof y?h:new y((function(m){m(h)}))}(h.value).then(fulfilled,rejected)}step((v=v.apply(h,m||[])).next())}))},C=this&&this.__importStar||function(h){if(h&&h.__esModule)return h;var m={};if(null!=h)for(var y in h)Object.hasOwnProperty.call(h,y)&&(m[y]=h[y]);return m.default=h,m};Object.defineProperty(m,"__esModule",{value:!0});const T=C(y(21)),w=C(y(18)),A=C(y(10)),P=C(y(7)),k=C(y(577)),R=C(y(41)),M=C(y(69)),N=y(2),D=y(15),I=y(67),x=y(318),O=y(135),L=y(143),U=y(29),B=O.getOrCreatePerformance(),W=A.promisify(T.mkdir),q=A.promisify(T.readFile);let Y;function isNodeInstalled(){return v(this,void 0,void 0,(function*(){if(void 0!==Y)return Y;const h=new N.Signal;return R.exec("node --version",(m,y,v)=>{m&&h.resolve(!1);const C=M.coerce(y);h.resolve(null!=C&&M.gte(C,"v10.0.0"))}),Y=yield h.promise,Y}))}function getLogDirectory(h){return v(this,void 0,void 0,(function*(){const m=P.join(w.tmpdir(),h);try{yield W(m)}catch(h){}return m}))}m.isNodeInstalled=isNodeInstalled,m.getLogDirectory=getLogDirectory,m.launchOrGetAgentRpcClient=function launchOrGetAgentRpcClient(h,m,y,C,T,w){return v(this,void 0,void 0,(function*(){const v=yield launchOrGetAgentSocket(h,m,y,C,T,w);return yield L.createMultiChannelRpcClient(new U.NodeStream(v),T)}))};let V=0;const $=new N.Mutex;function launchOrGetAgentSocket(h,m,y,C,T,w){return $.dispatch(()=>(++V,B.measure({id:`launch-hub-agent-${V}`,name:`Launching the hub agent -> count:${V}`},()=>function launchOrGetAgentSocketInternal(h,m,y,C,T,w){return v(this,void 0,void 0,(function*(){let A,P=0;for(;;)try{return A=0===P?m:`${m}-${P}`,yield createSocket(A,T)}catch(A){if(++P,P<20)continue;const k=new N.Signal;let R=0;const readListeningAddress=h=>v(this,void 0,void 0,(function*(){let m=void 0;try{m=getListeningAddress(yield q(h,"utf-8"))}catch(h){}m?(T.info(`rpc server address info:${m} retry:${R}`),k.resolve(m)):R<500&&(++R,setTimeout(()=>readListeningAddress(h),10))}));yield I.lockAgent(h,()=>v(this,void 0,void 0,(function*(){const v=yield launchAgent(h,m,y,C,w);setTimeout(()=>readListeningAddress(v),10)})),T);const M=yield Promise.race([k.promise,N.wait(1e4)]);if(!M){const h="Failed to get listening address info from the hub agent";throw T.error(h),new Error(h)}return yield createSocket(String(M),T,!0)}}))}(h,m,y,C,T,w))))}function getListeningAddress(h){const m=h.match(/[^\r\n]+/g);if(m)for(let h=0;h<m.length;h++){const y=m[h].indexOf("rpc server listening on address:");if(-1!==y){const v=m[h].substr(y+"rpc server listening on address:".length).replace(/(\r\n|\n|\r)/gm,"");return JSON.parse(v)}}}function launchAgent(h,m,y,C,w){return v(this,void 0,void 0,(function*(){N.assert(T.existsSync(h),`App node entry point missing. Path:${h}`);const v=(yield isNodeInstalled())?"node":k.execPath,A=yield getLogDirectory(C),R=(new Date).toISOString().replace(/T/,"_").replace(/:|-/g,"").replace(/\..+/,""),M=P.join(A,`${R}_${Date.now()}_HubAgent.log`),O=x.getExtension(y),L=O.packageJSON,U=x.vscodeModule(),B={key:L.aiKey,featureName:"hub-agent.",reporterConfiguration:{name:L.name,version:L.version,extensionPath:O.extensionPath,env:{appRoot:U.env.appRoot,sessionId:U.env.sessionId,machineId:U.env.machineId,remoteName:U.env.remoteName}}},W=[`"${h}"`,"--noVerbose","--autoExit","--keepAliveTime","60000","--noLogConsole","--isRawPipe","--logFile",`"${M}"`,"--maxLogSize","1024","--telemetryOptions",Buffer.from(JSON.stringify(B)).toString("base64")];return w&&W.push(...w),D.LoggerSettings.disableObfuscation&&W.push("--disableObfuscation"),W.push("--pipe",I.getPipePath(m)),I.execAgent(v,W,{ELECTRON_RUN_AS_NODE:"1"}).unref(),M}))}function createSocket(h,m,y){return v(this,void 0,void 0,(function*(){const v=yield I.startSocketSessionOnPipe(h,y);return m.info(`hub socket successfully created on pipe:${h}`),v}))}m.launchOrGetAgentSocket=launchOrGetAgentSocket},function(h,m,y){"use strict";var v=this&&this.__awaiter||function(h,m,y,v){return new(y||(y=Promise))((function(C,T){function fulfilled(h){try{step(v.next(h))}catch(h){T(h)}}function rejected(h){try{step(v.throw(h))}catch(h){T(h)}}function step(h){h.done?C(h.value):function adopt(h){return h instanceof y?h:new y((function(m){m(h)}))}(h.value).then(fulfilled,rejected)}step((v=v.apply(h,m||[])).next())}))};Object.defineProperty(m,"__esModule",{value:!0});const C=y(0),T=y(4),w=y(2),A=y(1407);m.ServerSharingService=class ServerSharingService{constructor(h,m){this.workspaceServer=h,this.logger=m,this.streamId=0,this.sharedServers=new Map,this.onSharingStartedEmitter=new C.EventEmitter,this.onPipeSharingStartedEmitter=new C.EventEmitter,this.onBrowseSharingStartedEmitter=new C.EventEmitter,this.onSharingStoppedEmitter=new C.EventEmitter,this.onPipeSharingStoppedEmitter=new C.EventEmitter,this.onSharingChangedEmitter=new C.EventEmitter,this.onSharingSucceededEmitter=new C.EventEmitter,this.onSharingFailedmitter=new C.EventEmitter,this.streamName="server_sharing",this.serviceInfo=T.vsls.ServerSharingService,this.onSharingStarted=this.onSharingStartedEmitter.event,this.onPipeSharingStarted=this.onPipeSharingStartedEmitter.event,this.onBrowseSharingStarted=this.onBrowseSharingStartedEmitter.event,this.onSharingStopped=this.onSharingStoppedEmitter.event,this.onPipeSharingStopped=this.onPipeSharingStoppedEmitter.event,this.onSharingChanged=this.onSharingChangedEmitter.event,this.onSharingSucceeded=this.onSharingSucceededEmitter.event,this.onSharingFailed=this.onSharingFailedmitter.event}getStream(h,m,y){return v(this,void 0,void 0,(function*(){if(this.logger.info(`getStream -> sessionId:${h} condition:${m}`),m.startsWith("pipe:"))throw new Error("pipe not yet supported");{const h=Number(m);if(!this.sharedServers.has(h))return null;const v=yield A.connectToLocalTcpPort(h,y),T=new C.EventEmitter,w=new C.EventEmitter;v.on("data",h=>{w.fire(h)});const P={onDataReceived:w.event,onClosed:T.event,send:(h,m)=>(v.write(h),Promise.resolve()),dispose:()=>{T.fire()},adjustWindow:h=>{},close:(h,m)=>(v.end(),Promise.resolve())};return v.on("close",()=>{T.fire()}),v.on("error",h=>{T.fire()}),Promise.resolve([this.getNextStreamId(),P])}}))}startSharingAsync(h,m,y,v,C){let T;this.logger.info(`startSharing -> port:${h} sessionName:${m}`),this.workspaceServer.assertIsHost(C);let w=this.sharedServers.get(h);if(w)return this.logger.info(`Port ${h} is already shared, nothing to do`),Promise.resolve(getSharedServer(h,w.sessionName,w.browseUrl));w=new SharedServerData(m,y),this.sharedServers.set(h,w),T=w.addRef();const A=getSharedServer(h,w.sessionName,w.browseUrl);return T&&this.onSharingStartedEmitter.fire({server:A}),null!=y&&this.onBrowseSharingStartedEmitter.fire({server:A}),Promise.resolve(A)}startSharingPipeAsync(h,m,y,v){w.notImplemented()}stopSharingAsync(h,m,y){return this.logger.info(`stopSharing -> port:${h}`),this.workspaceServer.assertIsHost(y),this.stopSharing(h,!0),Promise.resolve()}stopSharingPipeAsync(h,m){w.notImplemented()}stopSharingBrowseSessionsAsync(h){w.notImplemented()}getSharedServersAsync(h){return Promise.resolve(Array.from(this.sharedServers.entries()).map(h=>getSharedServer(h[0],h[1].sessionName,h[1].browseUrl)))}getSharedPipesAsync(h){return Promise.resolve([])}updateSessionNameAsync(h,m,y){w.notImplemented()}updateSharedServerVisibilityAsync(h,m,y){w.notImplemented()}updateSharedServerProtocolAsync(h,m,y){w.notImplemented()}updateSharedServerPrivacyAsync(h,m,y){w.notImplemented()}invokeSharingSucceeded(h){w.notImplemented()}invokeSharingFailed(h){w.notImplemented()}stopSharing(h,m){const y=this.sharedServers.get(h);if(!y)throw new Error(`Port:${h} not forwarded`);const v=y.release()||m;return v?this.sharedServers.delete(h):y.browseUrl=null,v&&this.onSharingStoppedEmitter.fire({server:getSharedServer(h,y.sessionName,y.browseUrl)}),v}getNextStreamId(){return`ServerSharing_${++this.streamId}`}};class SharedServerData extends class RefCountData{constructor(){this.referenceCount=0}addRef(){return 0==this.referenceCount++}release(){return 0==--this.referenceCount}}{constructor(h,m){super(),this.sessionName=h,this.browseUrl=m}}function getSharedServer(h,m,y,v=!1,C=!1,w=T.vsls.PrivacyEnum.Private){return{sourcePort:h,sessionName:m,streamName:"server_sharing",streamCondition:h.toString(),browseUrl:y,isTCPServerConnectionEstablished:v,hasTLSHandshakePassed:C,privacy:w}}},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0});const v=y(67),C=y(2);m.connectToLocalTcpPort=async function connectToLocalTcpPort(h,m){let y;for(;;){try{return await v.startSocketSessionOnPort(h)}catch(h){y=h}if(await C.wait(100),null==m?void 0:m.isCancellationRequested)throw new C.CancellationError}}},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0});var v=y(114);m.PlannedSessionsUtils=v.PlannedSessionsUtils;var C=y(1409);m.PlannedSessionsProvider=C.PlannedSessionsProvider;var T=y(1410);m.ListPlannedSessionsCommandBuilder=T.builder;var w=y(1411);m.CreatePlannedSessionCommandBuilder=w.builder;var A=y(1412);m.DeletePlannedSessionCommandBuilder=A.builder;var P=y(1413);m.RenamePlannedSessionCommandBuilder=P.builder;var k=y(1414);m.CopyPlannedSessionLinkCommandBuilder=k.builder;var R=y(1415);m.JoinPlannedSessionCommandBuilder=R.builder},function(h,m,y){"use strict";var v=this&&this.__awaiter||function(h,m,y,v){return new(y||(y=Promise))((function(C,T){function fulfilled(h){try{step(v.next(h))}catch(h){T(h)}}function rejected(h){try{step(v.throw(h))}catch(h){T(h)}}function step(h){h.done?C(h.value):function adopt(h){return h instanceof y?h:new y((function(m){m(h)}))}(h.value).then(fulfilled,rejected)}step((v=v.apply(h,m||[])).next())}))};Object.defineProperty(m,"__esModule",{value:!0});const C=y(0),T=y(5),w=y(3),A=y(8),P=y(25);var k;!function(h){h.plannedSession="plannedSession",h.other="other"}(k||(k={}));class PlannedSessionTreeViewItem extends w.TreeViewItem{constructor(h){super(h),this.options=h,this.workspaceInfo=h.workspaceInfos}}m.PlannedSessionTreeViewItem=PlannedSessionTreeViewItem;m.PlannedSessionsProvider=class PlannedSessionsProvider{constructor(){this.changeEventEmitter=new C.EventEmitter,this.onDidChangeTreeData=this.changeEventEmitter.event,this.onStateChanged=h=>{h.newState===w.SessionState.SignedIn?(w.ExtensionUtil.setCommandContext("liveshare:isPlannedSessionsReady",!0),T.traceSource.info('"Planned sessions are enabled, state: '+w.SessionState[h.newState]),A.Telemetry.sendTelemetryEvent(w.TelemetryEventNames.SHOW_PLANNED_SESSIONS)):(w.ExtensionUtil.setCommandContext("liveshare:isPlannedSessionsReady",!1),T.traceSource.info('"Planned sessions are disabled, state: '+w.SessionState[h.newState])),this.refresh()},this.onPlannedSessionChanged=h=>{this.refresh()},this.refresh=()=>{this.changeEventEmitter.fire(void 0)},this.getTreeItem=h=>h,w.workspaceSessionInfoTracker.onPlannedSessionsChanged(this.onPlannedSessionChanged),w.sessionStateTracker.onStateChanged(this.onStateChanged),w.ExtensionUtil.setCommandContext("liveshare:isPlannedSessionsReady",!1)}getChildren(h){return v(this,void 0,void 0,(function*(){return yield this.getDefaultRootChildren()}))}getDefaultRootChildren(){var h;return v(this,void 0,void 0,(function*(){let m=[],y=w.sessionStateTracker.State;const v=w.localize("plannedSessions.NewLabel"),P=w.localize("plannedSessions.CreateaPlannedSessionTooltip");if(y===w.SessionState.SignedOut||y===w.SessionState.Initializing||y===w.SessionState.Joined||y===w.SessionState.JoiningInProgress||y===w.SessionState.SharingInProgress||y===w.SessionState.Shared||w.userAuthStateTracker.isCurrentUserAnonymous())return m;if(T.traceSource.info('"Planned sessions are ready, listing workspaces'),yield C.commands.executeCommand("liveshare.listPlannedSessions"),this.plannedSessionsList=null===w.workspaceSessionInfoTracker||void 0===w.workspaceSessionInfoTracker?void 0:w.workspaceSessionInfoTracker.plannedWorkspaceList,void 0!==this.plannedSessionsList&&0!==(null===(h=this.plannedSessionsList)||void 0===h?void 0:h.length))for(let h of this.plannedSessionsList)m.push(yield this.getPlannedSessionRow(h));if(0===m.length)m.push(new w.TreeViewItem({type:k.other,collapsibleState:C.TreeItemCollapsibleState.None,label:v,tooltip:P,command:{title:"Create Planned Session",command:"liveshare.createPlannedSessionFromFileTreeExplorer"}}));else{const h=new A.TelemetryEvent(w.TelemetryEventNames.PLANNED_SESSIONS_LIST_IS_NOT_EMPTY);h.addProperty(w.TelemetryPropertyNames.PLANNED_SESSIONS_LIST_SIZE,m.length),h.send()}return m}))}getPlannedSessionRow(h){return v(this,void 0,void 0,(function*(){const m=w.localize("plannedSessions.expiresatTooltip"),y=w.localize("Name: "),v=new Date(h.expiresAt),C=P.localizeDate(v);return new PlannedSessionTreeViewItem({label:`${h.label}`,workspaceInfos:h,type:k.plannedSession,tooltip:y+`${h.label}`+"\r\n\n"+m+C})}))}}},function(h,m,y){"use strict";var v=this&&this.__decorate||function(h,m,y,v){var C,T=arguments.length,w=T<3?m:null===v?v=Object.getOwnPropertyDescriptor(m,y):v;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)w=Reflect.decorate(h,m,y,v);else for(var A=h.length-1;A>=0;A--)(C=h[A])&&(w=(T<3?C(w):T>3?C(m,y,w):C(m,y))||w);return T>3&&w&&Object.defineProperty(m,y,w),w},C=this&&this.__metadata||function(h,m){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(h,m)},T=this&&this.__awaiter||function(h,m,y,v){return new(y||(y=Promise))((function(C,T){function fulfilled(h){try{step(v.next(h))}catch(h){T(h)}}function rejected(h){try{step(v.throw(h))}catch(h){T(h)}}function step(h){h.done?C(h.value):function adopt(h){return h instanceof y?h:new y((function(m){m(h)}))}(h.value).then(fulfilled,rejected)}step((v=v.apply(h,m||[])).next())}))};Object.defineProperty(m,"__esModule",{value:!0});const w=y(3);m.builder=function builder(h){return new P(h.plannedSessionsService())};const A={statusPostAuth:w.SessionAction.Create};let P=class ListPlannedSessionCommand{constructor(h){this.plannedSessionsService=h}invoke(h,m){return T(this,void 0,void 0,(function*(){try{let h=yield this.plannedSessionsService.listWorkspacesAsync({onlyManagedWorkspaces:!0});w.workspaceSessionInfoTracker.plannedWorkspaceList=h,m.telemetryEvent.addProperty(w.TelemetryPropertyNames.LIST_PLANNED_SESSION,!0)}catch(h){m.trace.error(`Failed to list a Planned Sessions. ${h}`)}}))}};P=v([w.cancellationDecorator(),w.telemetryCommandDecorator(w.TelemetryEventNames.LIST_PLANNED_SESSION,w.TelemetryEventNames.LIST_PLANNED_SESSION_FAULT,"List",1),w.telemetryStatusCommandDecorator(),w.authenticationCommandDecorator(A),C("design:paramtypes",[Object])],P),m.ListPlannedSessionCommand=P},function(h,m,y){"use strict";var v=this&&this.__decorate||function(h,m,y,v){var C,T=arguments.length,w=T<3?m:null===v?v=Object.getOwnPropertyDescriptor(m,y):v;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)w=Reflect.decorate(h,m,y,v);else for(var A=h.length-1;A>=0;A--)(C=h[A])&&(w=(T<3?C(w):T>3?C(m,y,w):C(m,y))||w);return T>3&&w&&Object.defineProperty(m,y,w),w},C=this&&this.__metadata||function(h,m){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(h,m)},T=this&&this.__awaiter||function(h,m,y,v){return new(y||(y=Promise))((function(C,T){function fulfilled(h){try{step(v.next(h))}catch(h){T(h)}}function rejected(h){try{step(v.throw(h))}catch(h){T(h)}}function step(h){h.done?C(h.value):function adopt(h){return h instanceof y?h:new y((function(m){m(h)}))}(h.value).then(fulfilled,rejected)}step((v=v.apply(h,m||[])).next())}))};Object.defineProperty(m,"__esModule",{value:!0});const w=y(0),A=y(578),P=y(114),k=y(3);m.builder=function builder(h){return new M(h.plannedSessionsService())};const R={statusPostAuth:k.SessionAction.Create};let M=class CreatePlannedSessionCommand{constructor(h){this.plannesSessionsService=h}invoke(h,m){return T(this,void 0,void 0,(function*(){const{cancellationTokenSource:h}=m;try{let y=yield P.PlannedSessionsUtils.getUsernameFromInputAsync(A.DEFAULT_PLANNED_SESSION_LABEL,h.token);if(y){yield w.window.withProgress({location:w.ProgressLocation.Notification,title:k.localize("progress.creatingPlannedSession")},()=>T(this,void 0,void 0,(function*(){yield this.plannesSessionsService.createPersistentWorkspaceAsync(y,!0,h&&h.token)})));let v=yield this.plannesSessionsService.listWorkspacesAsync({onlyManagedWorkspaces:!0});k.workspaceSessionInfoTracker.isPlannedSessionsChanged=!0,k.workspaceSessionInfoTracker.plannedWorkspaceList=v,m.telemetryEvent.addProperty(k.TelemetryPropertyNames.CREATE_PLANNED_SESSION,!0)}}catch(h){throw m.trace.error(`Failed to create a Planned Session link. ${h}`),new Error(k.localize("error.CannotCreatePlannedSession"))}}))}};M=v([k.cancellationDecorator(),k.errorNotificationCommandDecorator("Creating a Planned Session link",k.TelemetryEventNames.CREATE_PLANNED_SESSION_FAULT),k.telemetryCommandDecorator(k.TelemetryEventNames.CREATE_PLANNED_SESSION,k.TelemetryEventNames.CREATE_PLANNED_SESSION_FAULT,"Create Planned Session",1),k.telemetryStatusCommandDecorator(),k.authenticationCommandDecorator(R),C("design:paramtypes",[Object])],M),m.CreatePlannedSessionCommand=M},function(h,m,y){"use strict";var v=this&&this.__decorate||function(h,m,y,v){var C,T=arguments.length,w=T<3?m:null===v?v=Object.getOwnPropertyDescriptor(m,y):v;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)w=Reflect.decorate(h,m,y,v);else for(var A=h.length-1;A>=0;A--)(C=h[A])&&(w=(T<3?C(w):T>3?C(m,y,w):C(m,y))||w);return T>3&&w&&Object.defineProperty(m,y,w),w},C=this&&this.__metadata||function(h,m){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(h,m)},T=this&&this.__awaiter||function(h,m,y,v){return new(y||(y=Promise))((function(C,T){function fulfilled(h){try{step(v.next(h))}catch(h){T(h)}}function rejected(h){try{step(v.throw(h))}catch(h){T(h)}}function step(h){h.done?C(h.value):function adopt(h){return h instanceof y?h:new y((function(m){m(h)}))}(h.value).then(fulfilled,rejected)}step((v=v.apply(h,m||[])).next())}))};Object.defineProperty(m,"__esModule",{value:!0});const w=y(0),A=y(114),P=y(3);m.builder=function builder(h){return new R(h.plannedSessionsService())};const k={statusPostAuth:P.SessionAction.Create};let R=class DeletePlannedSessionCommand{constructor(h){this.plannedSessionsService=h}invoke(h,m){return T(this,void 0,void 0,(function*(){const{cancellationTokenSource:y}=m,v=y&&y.token;try{let y,C=yield this.plannedSessionsService.listWorkspacesAsync({onlyManagedWorkspaces:!0});if(void 0===h.workspaceInfo||null===h.workspaceInfo){let h=yield A.PlannedSessionsUtils.selectPlannedSessionItemFromCommandPaletteAsync(C,v);y=null==h?void 0:h.id}else y=h.workspaceInfo.id;y&&(yield w.window.withProgress({location:w.ProgressLocation.Notification,title:P.localize("progress.deletingPlannedSession")},()=>T(this,void 0,void 0,(function*(){yield this.plannedSessionsService.deleteWorkspaceAsync(y,v)}))),P.workspaceSessionInfoTracker.isPlannedSessionsChanged=!0,P.workspaceSessionInfoTracker.plannedWorkspaceList=C,m.telemetryEvent.addProperty(P.TelemetryPropertyNames.DELETE_PLANNED_SESSION,!0))}catch(h){throw m.trace.error(`Failed to delete Planned Session. ${h.message}`),new Error(P.localize("error.CannotDeletePlannedSession"))}}))}};R=v([P.cancellationDecorator(),P.errorNotificationCommandDecorator("Delete a Planned Session",P.TelemetryEventNames.DELETE_PLANNED_SESSION_FAULT),P.telemetryCommandDecorator(P.TelemetryEventNames.DELETE_PLANNED_SESSION,P.TelemetryEventNames.DELETE_PLANNED_SESSION_FAULT,"Delete planned session",1),P.telemetryStatusCommandDecorator(),P.authenticationCommandDecorator(k),C("design:paramtypes",[Object])],R),m.DeletePlannedSessionCommand=R},function(h,m,y){"use strict";var v=this&&this.__decorate||function(h,m,y,v){var C,T=arguments.length,w=T<3?m:null===v?v=Object.getOwnPropertyDescriptor(m,y):v;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)w=Reflect.decorate(h,m,y,v);else for(var A=h.length-1;A>=0;A--)(C=h[A])&&(w=(T<3?C(w):T>3?C(m,y,w):C(m,y))||w);return T>3&&w&&Object.defineProperty(m,y,w),w},C=this&&this.__metadata||function(h,m){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(h,m)},T=this&&this.__awaiter||function(h,m,y,v){return new(y||(y=Promise))((function(C,T){function fulfilled(h){try{step(v.next(h))}catch(h){T(h)}}function rejected(h){try{step(v.throw(h))}catch(h){T(h)}}function step(h){h.done?C(h.value):function adopt(h){return h instanceof y?h:new y((function(m){m(h)}))}(h.value).then(fulfilled,rejected)}step((v=v.apply(h,m||[])).next())}))};Object.defineProperty(m,"__esModule",{value:!0});const w=y(114),A=y(3);m.builder=function builder(h){return new k(h.plannedSessionsService())};const P={statusPostAuth:A.SessionAction.Create};let k=class RenamePlannedSessionCommand{constructor(h){this.plannedSessionsService=h}invoke(h,m){return T(this,void 0,void 0,(function*(){const{cancellationTokenSource:y}=m,v=y&&y.token;try{let y,C,T,P=A.workspaceSessionInfoTracker.plannedWorkspaceList;if(void 0===h.workspaceInfo||null===h.workspaceInfo){let h=yield w.PlannedSessionsUtils.selectPlannedSessionItemFromCommandPaletteAsync(P);y=h.id,C=yield w.PlannedSessionsUtils.getUsernameFromInputAsync(h.label,v),T=A.workspaceSessionInfoTracker.plannedWorkspaceList.indexOf(h)}else y=h.workspaceInfo.id,C=yield w.PlannedSessionsUtils.getUsernameFromInputAsync(h.workspaceInfo.label,v),T=A.workspaceSessionInfoTracker.plannedWorkspaceList.indexOf(h.workspaceInfo);if(y&&C){let h=yield this.plannedSessionsService.renameWorkspaceAsync(y,C,v);A.workspaceSessionInfoTracker.plannedWorkspaceList[T].label=h,A.workspaceSessionInfoTracker.isPlannedSessionsChanged=!0,m.telemetryEvent.addProperty(A.TelemetryPropertyNames.RENAME_PLANNED_SESSION,!0)}}catch(h){throw m.trace.error(`Failed to rename Planned Session. ${h.message}`),new Error(A.localize("error.CannotRenamePlannedSession"))}}))}};k=v([A.cancellationDecorator(),A.errorNotificationCommandDecorator("Rename Planned Session",A.TelemetryEventNames.RENAME_PLANNED_SESSION_FAULT),A.telemetryCommandDecorator(A.TelemetryEventNames.RENAME_PLANNED_SESSION,A.TelemetryEventNames.RENAME_PLANNED_SESSION_FAULT,"Rename Planned Session",1),A.telemetryStatusCommandDecorator(),A.authenticationCommandDecorator(P),C("design:paramtypes",[Object])],k),m.RenamePlannedSessionCommand=k},function(h,m,y){"use strict";var v=this&&this.__decorate||function(h,m,y,v){var C,T=arguments.length,w=T<3?m:null===v?v=Object.getOwnPropertyDescriptor(m,y):v;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)w=Reflect.decorate(h,m,y,v);else for(var A=h.length-1;A>=0;A--)(C=h[A])&&(w=(T<3?C(w):T>3?C(m,y,w):C(m,y))||w);return T>3&&w&&Object.defineProperty(m,y,w),w},C=this&&this.__metadata||function(h,m){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(h,m)},T=this&&this.__awaiter||function(h,m,y,v){return new(y||(y=Promise))((function(C,T){function fulfilled(h){try{step(v.next(h))}catch(h){T(h)}}function rejected(h){try{step(v.throw(h))}catch(h){T(h)}}function step(h){h.done?C(h.value):function adopt(h){return h instanceof y?h:new y((function(m){m(h)}))}(h.value).then(fulfilled,rejected)}step((v=v.apply(h,m||[])).next())}))};Object.defineProperty(m,"__esModule",{value:!0});const w=y(5),A=y(114),P=y(3);m.builder=function builder(h){return new R};const k={statusPostAuth:P.SessionAction.Create};let R=class CopyPlannedSessionLinkCommand{constructor(){}invoke(h,m){return T(this,void 0,void 0,(function*(){const{cancellationTokenSource:y}=m;y&&y.token;try{let y,v=P.workspaceSessionInfoTracker.plannedWorkspaceList;if(void 0===h.workspaceInfo||null===h.workspaceInfo){y=(yield A.PlannedSessionsUtils.selectPlannedSessionItemFromCommandPaletteAsync(v)).joinUri}else y=h.workspaceInfo.joinUri;y&&(yield A.PlannedSessionsUtils.copyToClipboardAsync(y),yield w.NotificationUtil.showInformationMessage(P.localize("notification.CopyPlannedSessionLink"),!1),m.telemetryEvent.addProperty(P.TelemetryPropertyNames.COPY_PLANNED_SESSION_LINK,!0))}catch(h){throw m.trace.error(`Failed to copy Planned Session link. ${h}`),new Error(P.localize("error.CannotCopyPlannedSessionLink"))}}))}};R=v([P.cancellationDecorator(),P.errorNotificationCommandDecorator("Copy Planned Session link",P.TelemetryEventNames.COPY_PLANNED_SESSION_LINK_FAULT),P.telemetryCommandDecorator(P.TelemetryEventNames.COPY_PLANNED_SESSION_LINK,P.TelemetryEventNames.COPY_PLANNED_SESSION_LINK_FAULT,"Copy planned session link",1),P.telemetryStatusCommandDecorator(),P.authenticationCommandDecorator(k),C("design:paramtypes",[])],R),m.CopyPlannedSessionLinkCommand=R},function(h,m,y){"use strict";var v=this&&this.__decorate||function(h,m,y,v){var C,T=arguments.length,w=T<3?m:null===v?v=Object.getOwnPropertyDescriptor(m,y):v;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)w=Reflect.decorate(h,m,y,v);else for(var A=h.length-1;A>=0;A--)(C=h[A])&&(w=(T<3?C(w):T>3?C(m,y,w):C(m,y))||w);return T>3&&w&&Object.defineProperty(m,y,w),w},C=this&&this.__metadata||function(h,m){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(h,m)},T=this&&this.__awaiter||function(h,m,y,v){return new(y||(y=Promise))((function(C,T){function fulfilled(h){try{step(v.next(h))}catch(h){T(h)}}function rejected(h){try{step(v.throw(h))}catch(h){T(h)}}function step(h){h.done?C(h.value):function adopt(h){return h instanceof y?h:new y((function(m){m(h)}))}(h.value).then(fulfilled,rejected)}step((v=v.apply(h,m||[])).next())}))};Object.defineProperty(m,"__esModule",{value:!0});const w=y(0),A=y(114),P=y(3);m.builder=function builder(h){return new R(h.plannedSessionsService())};const k={statusPostAuth:P.SessionAction.Create};let R=class JoinPlannedSessionCommand{constructor(h){this.plannedSessionsSerivce=h}invoke(h,m){return T(this,void 0,void 0,(function*(){try{let m,y=P.workspaceSessionInfoTracker.plannedWorkspaceList;if(void 0===h.workspaceInfo||null===h.workspaceInfo){m=(yield A.PlannedSessionsUtils.selectPlannedSessionItemFromCommandPaletteAsync(y)).joinUri}else m=h.workspaceInfo.joinUri;if(m){const h={link:m,isPlannedSession:!0};yield w.commands.executeCommand("liveshare.join",h)}}catch(h){throw m.trace.error(`Failed to join Planned Session. ${h}`),new Error(P.localize("error.CannotJoinPlannedSession"))}}))}};R=v([P.cancellationDecorator(),P.errorNotificationCommandDecorator("Join Planned Session",P.TelemetryEventNames.JOIN_PLANNED_SESSION_FAULT),P.telemetryCommandDecorator(P.TelemetryEventNames.JOINED_PS_FROM_VIEWLET,P.TelemetryEventNames.JOIN_PLANNED_SESSION_FAULT,"Join planned session from viewlet",1),P.telemetryStatusCommandDecorator(),P.authenticationCommandDecorator(k),C("design:paramtypes",[Object])],R),m.JoinPlannedSessionCommand=R},function(h,m,y){"use strict";var v=this&&this.__decorate||function(h,m,y,v){var C,T=arguments.length,w=T<3?m:null===v?v=Object.getOwnPropertyDescriptor(m,y):v;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)w=Reflect.decorate(h,m,y,v);else for(var A=h.length-1;A>=0;A--)(C=h[A])&&(w=(T<3?C(w):T>3?C(m,y,w):C(m,y))||w);return T>3&&w&&Object.defineProperty(m,y,w),w};Object.defineProperty(m,"__esModule",{value:!0});const C=y(0),T=y(5),w=y(3),A=y(4),P=y(319),k=y(39),R=y(584),M=y(586),N=y(1462),D=y(200),I=y(2),x=y(7),O=y(1468),L=y(592),U=y(1469),B=y(326),W=y(595),q=y(110),Y=y(16),V=y(305),$=y(598),z=y(594),G=y(325);w.ExtensionUtil.isNode()||(x.posix={join:(...h)=>x.join(...h)});const askToSignIn=async(h,m)=>{const y=await w.JoinCommandUtilities.showInformationMessage(w.localize(h),!1,w.localize("Sign in"));y===w.localize("Sign in")?(await C.commands.executeCommand("liveshare.signin"),await C.commands.executeCommand("liveshare.join",m)):y||C.commands.executeCommand("_liveshareweb.gotoSessionPage")},J={statusPostAuth:w.SessionAction.AttemptJoining,authAttemptMax:1};m.joinCommandBuilder=function joinCommandBuilder(h){return new Z(h,[O.default,L.default,searchProviderInit,tasksInit])},m.leaveCommandBuilder=function leaveCommandBuilder(h){return new LeaveCollaborationCommand(h)};let X=I.createDisposable(()=>{throw new Error("Invalid operation")}),Z=class JoinCommand extends T.CommandBase{constructor(h,m){super(),this.dependencies=h,this.initializers=m}async invoke(h,m){var y;if(void 0===h.link||""===h.link){let m="";try{m=await(new w.ClipboardUtil).pasteFromClipboardAsync(),m=m.trim()}catch(h){}const validateInput=h=>w.JoinCommandUtilities.extractLiveshareWorkspaceId(h.trim())?void 0:"Invalid collaboration session URL";if(h.link=await C.window.showInputBox({prompt:"Enter the URL of the collaboration session to join",ignoreFocusOut:!0,value:w.JoinCommandUtilities.extractLiveshareLink(m),validateInput:validateInput}),!h.link)throw new I.CancellationError("Operation cancelled @ getcollaboration session URL dialog.")}const v=w.JoinCommandUtilities.extractLiveshareWorkspaceId(null===(y=h.link)||void 0===y?void 0:y.toString());if(w.JoinCommandUtilities.setInviteLinkJoining(v,h,m),h.isActivate||!await U.joinWorkspace(v,m,h.newWindow))try{await this.join(v,m)}finally{await w.JoinCommandUtilities.finishInviteLinkJoining(q.ContactManager,v)}}async onCancellationRequested(h,m){}async join(h,m){w.TimeTracker.start("join");const y=[];w.TimeTracker.markTime("create connection options");const v=G.isLiveshareHubEnabled()?z.createLiveshareConnectionOptionsWithInfo(h):await z.createLiveshareConnectionOptions(h,this.dependencies,m),C=T.traceSource.withName("WorkspaceClient"),R=await w.TimeTracker.timeIt("joinWithLocalConnectionHub",async()=>await w.joinWithLocalConnectionHub(C,v,U.getConnectionClass())),N=R.workspaceClient,D=R.workspaceSessionInfo,x=this.dependencies.agentRpcServer;x.onHandleNoneRequest(async(h,m,...y)=>{const[v,w]=Y.normalizeRpcParameters(y);return await N.rpcClient.sendRequest(C,m,{report:(h,m)=>{x.sendNotification(T.traceSource,Y.methodProgress,[{id:v,value:h}])}},w,...y)}),x.onHandleNoneNotification((h,m,...y)=>{N.rpcClient.sendNotification(C,m,y)}),N.rpcClient.onHandleNoneNotification((h,m,...y)=>{x.sendNotification(T.traceSource,m,y)});const O=N.getServiceProxy(A.vsls.WorkspaceService);y.push(Y.rpcUtils.onAllEvents(O,A.vsls.WorkspaceService.events,(h,m)=>{x.sendNotification(T.traceSource,`${A.vsls.WorkspaceService.name}.${h}`,[m])})),y.push(I.createDisposable(async()=>{try{await I.timeoutPromise(N.disconnect(),250)}catch(m){C.error(`Failed to unjoin from workspace:${h}`,m),N.dispose()}})),N.onHostConnectionChanged(h=>{if(h.state===k.ConnectedState.Reconnected||h.state===k.ConnectedState.Reconnecting)w.reconnectHostCallback(h.state===k.ConnectedState.Reconnected,h.duration);else if(h.state===k.ConnectedState.Closed){const h={connectionStatus:A.vsls.WorkspaceConnectionStatus.Disconnected,disconnectedReason:A.vsls.WorkspaceDisconnectedReason.ConnectionLost};x.sendNotification(T.traceSource,`${A.vsls.WorkspaceService.name}.connectionStatusChanged`,h)}}),w.workspaceSessionInfoTracker.workspaceSessionInfo=D;const L=Object.entries(D.sessions).find(([h,m])=>!!m.isHost);this.dependencies.hostSessionId.value=Number(L[0]);const q=new w.AccessControlService(this.dependencies);w.TimeTracker.markTime("registerRpcService"),x.registerRpcService(q,q.serviceInfo);const initHandler=async m=>{try{const v=await m(this.dependencies,R,h);v&&y.push(v)}catch(h){T.traceSource.error(`failed to invoke initializer:${m.name} reason:${h}`)}};w.TimeTracker.markTime("pathManager init"),await this.dependencies.pathManager().init(),w.TimeTracker.markTime("accessControlManager init"),await this.dependencies.accessControlManager().init(),w.TimeTracker.markTime("workspaceProvider init"),this.dependencies.fileSystemManager().workspaceProvider.init(),w.TimeTracker.markTime("createorUpdateWorkspaceFile"),this.dependencies.fileSystemManager().workspaceProvider.createorUpdateWorkspaceFile(h,D.name),y.push(await B.initCoEditingContext(this.dependencies,!0)),w.TimeTracker.markTime("registerGuestTerminalHandler"),W.registerGuestTerminalHandler(this.dependencies,N),await initHandler(portForwardInit),w.ExtensionUtil.isNode()?w.SessionContext.joined():w.SessionContext.environmentReadyForFileOperation();const initDisposable=async h=>{await h.init(),y.push(h)};w.TimeTracker.markTime("coEditingCommands"),await initDisposable(this.dependencies.coEditingCommands()),w.TimeTracker.markTime("commentManager"),await initDisposable(P.reviewsDependencies.commentManager());const V=new $.GuestNotebooksService(this.dependencies,Y.RpcProxy.create($.NotebooksService,this.dependencies.rpcClient(),T.traceSource.withName("Notebooks")));try{V.init()}catch(h){}y.push(await w.TimeTracker.timeIt("activate lsp",async()=>await M.lspClient.activateAsync(w.ExtensionUtil.context,N.rpcClient,[...this.dependencies.workspaceServices().registeredServices]))),w.TimeTracker.markTime("addAdditionalRootsFromFileServiceToWorkspace"),w.JoinCommandUtilities.addAdditionalRootsFromFileServiceToWorkspace(this.dependencies.fileService(),D),await w.TimeTracker.timeIt("initializers",async()=>await Promise.all(this.initializers.map(h=>initHandler(h)))),w.TimeTracker.markTime("guestSourceControlManager"),await initDisposable(P.reviewsDependencies.guestSourceControlManager()),X=I.createDisposablesSeries(C,...y);const J={};let Z=0;const ee=N.onWorkspaceMetricsUpdated(h=>{h.bytesIn&&void 0===J.bytesIn&&(Z|=1,J.bytesIn=h.bytesIn),h.bytesOut&&void 0===J.bytesOut&&(Z|=2,J.bytesOut=h.bytesOut),h.latency&&void 0===J.latency&&(Z|=4,J.latency=h.latency),7===Z&&(C.info(`join metrics:${JSON.stringify(J)}`),ee.dispose())});w.ExtensionUtil.isNode()||w.SessionContext.joined(),w.TimeTracker.stop("join")}};function searchProviderInit(h){const m=new w.SearchProvider(h);w.ExtensionUtil.context.subscriptions.push(C.workspace.registerTextSearchProvider(w.Settings.scheme,m)),w.ExtensionUtil.context.subscriptions.push(C.workspace.registerFileSearchProvider(w.Settings.scheme,new N.CachedSearchProvider(m)))}async function tasksInit(h,m){const y=new R.WorkspaceTaskClient(h,h.accessControlManager(),async y=>{const v=await h.streamManagerService().getStreamAsync(y.name,y.condition);return await m.workspaceClient.openStreamingChannel(v)});await y.init(),w.ExtensionUtil.context.subscriptions.push(R.registerTaskProvider())}async function portForwardInit(h,m,y){if(w.ExtensionUtil.isNode()){const v=await w.startLocalWorkspaceHubService(w.initLocalConnectionHub(void 0,U.getConnectionClass()),T.traceSource),C=V.workspaceHubPortFowardingServiceFactory({hubPipeName:v[1],workspaceId:y,workspaceConnectionPromise:Promise.resolve(m.workspaceClient)},T.traceSource.withName("hubPortFowardingService"));return h.agentRpcServer.registerRpcService(C,C.serviceInfo),await C.init(),{dispose:async()=>{await C.dispose(),await v[0].stop()}}}}Z=v([w.cancellationDecorator(),w.errorNotificationCommandDecorator("Joining collaboration session",w.TelemetryEventNames.JOIN_FAULT,!0,async(h,m,y)=>{switch(h.code){case T.CommandErrorCode.FORBIDDEN_ANONYMOUS:const h=w.localize("The Host doesn't allow anonymous users in the session. Consider signing in so they know who you are.");await askToSignIn(`${m.commandName}: ${h}`,y);break;case A.vsls.ErrorCodes.CollaborationSessionGuestRejected:C.commands.executeCommand("_liveshareweb.gotoSessionPage")}},async(h,m,y)=>{if(h instanceof D.HttpClientError)return w.localize("The collaboration session is no longer active.")}),w.telemetryCommandDecorator(w.TelemetryEventNames.JOIN_WORKSPACE,w.TelemetryEventNames.JOIN_FAULT,"Join",1,(h,m)=>{}),w.telemetryStatusCommandDecorator(),w.validationCommandDecorator(),w.sessionStateTransitionsCommandDecorator(w.SessionAction.AttemptJoining,w.SessionAction.JoiningSuccess,w.SessionAction.JoiningError),w.authenticationCommandDecorator(J),w.progressCommandDecorator()],Z);class LeaveCollaborationCommand extends T.CommandBase{constructor(h){super(),this.dependencies=h}async invoke(h,m){this.dependencies.agentRpcServer.clear(),await X.dispose(),w.sessionStateTracker.transition(w.SessionAction.Unjoin),await U.leaveCollaboration()}}},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0});const v=y(149);var C;!function(h){h.ParseError=-32700,h.InvalidRequest=-32600,h.MethodNotFound=-32601,h.InvalidParams=-32602,h.InternalError=-32603,h.serverErrorStart=-32099,h.serverErrorEnd=-32e3,h.ServerNotInitialized=-32002,h.UnknownErrorCode=-32001,h.RequestCancelled=-32800,h.ContentModified=-32801,h.MessageWriteError=1,h.MessageReadError=2}(C=m.ErrorCodes||(m.ErrorCodes={}));class ResponseError extends Error{constructor(h,m,y){super(m),this.code=v.number(h)?h:C.UnknownErrorCode,this.data=y,Object.setPrototypeOf(this,ResponseError.prototype)}toJson(){return{code:this.code,message:this.message,data:this.data}}}m.ResponseError=ResponseError;class AbstractMessageType{constructor(h,m){this._method=h,this._numberOfParams=m}get method(){return this._method}get numberOfParams(){return this._numberOfParams}}m.AbstractMessageType=AbstractMessageType;m.RequestType0=class RequestType0 extends AbstractMessageType{constructor(h){super(h,0)}};m.RequestType=class RequestType extends AbstractMessageType{constructor(h){super(h,1)}};m.RequestType1=class RequestType1 extends AbstractMessageType{constructor(h){super(h,1)}};m.RequestType2=class RequestType2 extends AbstractMessageType{constructor(h){super(h,2)}};m.RequestType3=class RequestType3 extends AbstractMessageType{constructor(h){super(h,3)}};m.RequestType4=class RequestType4 extends AbstractMessageType{constructor(h){super(h,4)}};m.RequestType5=class RequestType5 extends AbstractMessageType{constructor(h){super(h,5)}};m.RequestType6=class RequestType6 extends AbstractMessageType{constructor(h){super(h,6)}};m.RequestType7=class RequestType7 extends AbstractMessageType{constructor(h){super(h,7)}};m.RequestType8=class RequestType8 extends AbstractMessageType{constructor(h){super(h,8)}};m.RequestType9=class RequestType9 extends AbstractMessageType{constructor(h){super(h,9)}};m.NotificationType=class NotificationType extends AbstractMessageType{constructor(h){super(h,1),this._=void 0}};m.NotificationType0=class NotificationType0 extends AbstractMessageType{constructor(h){super(h,0)}};m.NotificationType1=class NotificationType1 extends AbstractMessageType{constructor(h){super(h,1)}};m.NotificationType2=class NotificationType2 extends AbstractMessageType{constructor(h){super(h,2)}};m.NotificationType3=class NotificationType3 extends AbstractMessageType{constructor(h){super(h,3)}};m.NotificationType4=class NotificationType4 extends AbstractMessageType{constructor(h){super(h,4)}};m.NotificationType5=class NotificationType5 extends AbstractMessageType{constructor(h){super(h,5)}};m.NotificationType6=class NotificationType6 extends AbstractMessageType{constructor(h){super(h,6)}};m.NotificationType7=class NotificationType7 extends AbstractMessageType{constructor(h){super(h,7)}};m.NotificationType8=class NotificationType8 extends AbstractMessageType{constructor(h){super(h,8)}};m.NotificationType9=class NotificationType9 extends AbstractMessageType{constructor(h){super(h,9)}},m.isRequestMessage=function isRequestMessage(h){let m=h;return m&&v.string(m.method)&&(v.string(m.id)||v.number(m.id))},m.isNotificationMessage=function isNotificationMessage(h){let m=h;return m&&v.string(m.method)&&void 0===h.id},m.isResponseMessage=function isResponseMessage(h){let m=h;return m&&(void 0!==m.result||!!m.error)&&(v.string(m.id)||v.number(m.id)||null===m.id)}},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0});const v=y(195),C=y(149);var T;!function(h){h.None=Object.freeze({isCancellationRequested:!1,onCancellationRequested:v.Event.None}),h.Cancelled=Object.freeze({isCancellationRequested:!0,onCancellationRequested:v.Event.None}),h.is=function is(m){let y=m;return y&&(y===h.None||y===h.Cancelled||C.boolean(y.isCancellationRequested)&&!!y.onCancellationRequested)}}(T=m.CancellationToken||(m.CancellationToken={}));const w=Object.freeze((function(h,m){let y=setTimeout(h.bind(m),0);return{dispose(){clearTimeout(y)}}}));class MutableToken{constructor(){this._isCancelled=!1}cancel(){this._isCancelled||(this._isCancelled=!0,this._emitter&&(this._emitter.fire(void 0),this.dispose()))}get isCancellationRequested(){return this._isCancelled}get onCancellationRequested(){return this._isCancelled?w:(this._emitter||(this._emitter=new v.Emitter),this._emitter.event)}dispose(){this._emitter&&(this._emitter.dispose(),this._emitter=void 0)}}m.CancellationTokenSource=class CancellationTokenSource{get token(){return this._token||(this._token=new MutableToken),this._token}cancel(){this._token?this._token.cancel():this._token=T.Cancelled}dispose(){this._token?this._token instanceof MutableToken&&this._token.dispose():this._token=T.None}}},function(h,m,y){"use strict";var v;Object.defineProperty(m,"__esModule",{value:!0}),function(h){h.None=0,h.First=1,h.Last=2}(v=m.Touch||(m.Touch={}));m.LinkedMap=class LinkedMap{constructor(){this._map=new Map,this._head=void 0,this._tail=void 0,this._size=0}clear(){this._map.clear(),this._head=void 0,this._tail=void 0,this._size=0}isEmpty(){return!this._head&&!this._tail}get size(){return this._size}has(h){return this._map.has(h)}get(h){const m=this._map.get(h);if(m)return m.value}set(h,m,y=v.None){let C=this._map.get(h);if(C)C.value=m,y!==v.None&&this.touch(C,y);else{switch(C={key:h,value:m,next:void 0,previous:void 0},y){case v.None:this.addItemLast(C);break;case v.First:this.addItemFirst(C);break;case v.Last:default:this.addItemLast(C)}this._map.set(h,C),this._size++}}delete(h){const m=this._map.get(h);return!!m&&(this._map.delete(h),this.removeItem(m),this._size--,!0)}shift(){if(!this._head&&!this._tail)return;if(!this._head||!this._tail)throw new Error("Invalid list");const h=this._head;return this._map.delete(h.key),this.removeItem(h),this._size--,h.value}forEach(h,m){let y=this._head;for(;y;)m?h.bind(m)(y.value,y.key,this):h(y.value,y.key,this),y=y.next}forEachReverse(h,m){let y=this._tail;for(;y;)m?h.bind(m)(y.value,y.key,this):h(y.value,y.key,this),y=y.previous}values(){let h=[],m=this._head;for(;m;)h.push(m.value),m=m.next;return h}keys(){let h=[],m=this._head;for(;m;)h.push(m.key),m=m.next;return h}addItemFirst(h){if(this._head||this._tail){if(!this._head)throw new Error("Invalid list");h.next=this._head,this._head.previous=h}else this._tail=h;this._head=h}addItemLast(h){if(this._head||this._tail){if(!this._tail)throw new Error("Invalid list");h.previous=this._tail,this._tail.next=h}else this._head=h;this._tail=h}removeItem(h){if(h===this._head&&h===this._tail)this._head=void 0,this._tail=void 0;else if(h===this._head)this._head=h.next;else if(h===this._tail)this._tail=h.previous;else{const m=h.next,y=h.previous;if(!m||!y)throw new Error("Invalid list");m.previous=y,y.next=m}}touch(h,m){if(!this._head||!this._tail)throw new Error("Invalid list");if(m===v.First||m===v.Last)if(m===v.First){if(h===this._head)return;const m=h.next,y=h.previous;h===this._tail?(y.next=void 0,this._tail=y):(m.previous=y,y.next=m),h.previous=void 0,h.next=this._head,this._head.previous=h,this._head=h}else if(m===v.Last){if(h===this._tail)return;const m=h.next,y=h.previous;h===this._head?(m.previous=void 0,this._head=m):(m.previous=y,y.next=m),h.next=void 0,h.previous=this._tail,this._tail.next=h,this._tail=h}}}},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0});const v=y(7),C=y(18),T=y(11),w=y(31),A=y(321),P=y(322);m.generateRandomPipeName=function generateRandomPipeName(){const h=T.randomBytes(21).toString("hex");return"win32"===process.platform?`\\\\.\\pipe\\vscode-jsonrpc-${h}-sock`:v.join(C.tmpdir(),`vscode-${h}.sock`)},m.createClientPipeTransport=function createClientPipeTransport(h,m="utf-8"){let y,v=new Promise((h,m)=>{y=h});return new Promise((C,T)=>{let k=w.createServer(h=>{k.close(),y([new A.SocketMessageReader(h,m),new P.SocketMessageWriter(h,m)])});k.on("error",T),k.listen(h,()=>{k.removeListener("error",T),C({onConnected:()=>v})})})},m.createServerPipeTransport=function createServerPipeTransport(h,m="utf-8"){const y=w.createConnection(h);return[new A.SocketMessageReader(y,m),new P.SocketMessageWriter(y,m)]}},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0});const v=y(31),C=y(321),T=y(322);m.createClientSocketTransport=function createClientSocketTransport(h,m="utf-8"){let y,w=new Promise((h,m)=>{y=h});return new Promise((A,P)=>{let k=v.createServer(h=>{k.close(),y([new C.SocketMessageReader(h,m),new T.SocketMessageWriter(h,m)])});k.on("error",P),k.listen(h,"127.0.0.1",()=>{k.removeListener("error",P),A({onConnected:()=>w})})})},m.createServerSocketTransport=function createServerSocketTransport(h,m="utf-8"){const y=v.createConnection(h,"127.0.0.1");return[new C.SocketMessageReader(y,m),new T.SocketMessageWriter(y,m)]}},function(h,m,y){"use strict";var v,C,T,w,A,P,k,R,M,N,D,I,x,O,L,U,B,W,q,Y;y.r(m),y.d(m,"Position",(function(){return v})),y.d(m,"Range",(function(){return C})),y.d(m,"Location",(function(){return T})),y.d(m,"LocationLink",(function(){return w})),y.d(m,"Color",(function(){return A})),y.d(m,"ColorInformation",(function(){return P})),y.d(m,"ColorPresentation",(function(){return k})),y.d(m,"FoldingRangeKind",(function(){return R})),y.d(m,"FoldingRange",(function(){return M})),y.d(m,"DiagnosticRelatedInformation",(function(){return N})),y.d(m,"DiagnosticSeverity",(function(){return D})),y.d(m,"DiagnosticTag",(function(){return I})),y.d(m,"Diagnostic",(function(){return x})),y.d(m,"Command",(function(){return O})),y.d(m,"TextEdit",(function(){return L})),y.d(m,"TextDocumentEdit",(function(){return U})),y.d(m,"CreateFile",(function(){return B})),y.d(m,"RenameFile",(function(){return W})),y.d(m,"DeleteFile",(function(){return q})),y.d(m,"WorkspaceEdit",(function(){return Y})),y.d(m,"WorkspaceChange",(function(){return Te})),y.d(m,"TextDocumentIdentifier",(function(){return V})),y.d(m,"VersionedTextDocumentIdentifier",(function(){return $})),y.d(m,"TextDocumentItem",(function(){return z})),y.d(m,"MarkupKind",(function(){return G})),y.d(m,"MarkupContent",(function(){return J})),y.d(m,"CompletionItemKind",(function(){return X})),y.d(m,"InsertTextFormat",(function(){return Z})),y.d(m,"CompletionItemTag",(function(){return ee})),y.d(m,"CompletionItem",(function(){return te})),y.d(m,"CompletionList",(function(){return re})),y.d(m,"MarkedString",(function(){return ie})),y.d(m,"Hover",(function(){return se})),y.d(m,"ParameterInformation",(function(){return oe})),y.d(m,"SignatureInformation",(function(){return ae})),y.d(m,"DocumentHighlightKind",(function(){return ce})),y.d(m,"DocumentHighlight",(function(){return le})),y.d(m,"SymbolKind",(function(){return ue})),y.d(m,"SymbolTag",(function(){return de})),y.d(m,"SymbolInformation",(function(){return he})),y.d(m,"DocumentSymbol",(function(){return pe})),y.d(m,"CodeActionKind",(function(){return me})),y.d(m,"CodeActionContext",(function(){return fe})),y.d(m,"CodeAction",(function(){return ye})),y.d(m,"CodeLens",(function(){return ve})),y.d(m,"FormattingOptions",(function(){return Se})),y.d(m,"DocumentLink",(function(){return Ee})),y.d(m,"SelectionRange",(function(){return Ce})),y.d(m,"EOL",(function(){return we})),y.d(m,"TextDocument",(function(){return be})),function(h){h.create=function create(h,m){return{line:h,character:m}},h.is=function is(h){var m=h;return Ae.objectLiteral(m)&&Ae.number(m.line)&&Ae.number(m.character)}}(v||(v={})),function(h){h.create=function create(h,m,y,C){if(Ae.number(h)&&Ae.number(m)&&Ae.number(y)&&Ae.number(C))return{start:v.create(h,m),end:v.create(y,C)};if(v.is(h)&&v.is(m))return{start:h,end:m};throw new Error("Range#create called with invalid arguments["+h+", "+m+", "+y+", "+C+"]")},h.is=function is(h){var m=h;return Ae.objectLiteral(m)&&v.is(m.start)&&v.is(m.end)}}(C||(C={})),function(h){h.create=function create(h,m){return{uri:h,range:m}},h.is=function is(h){var m=h;return Ae.defined(m)&&C.is(m.range)&&(Ae.string(m.uri)||Ae.undefined(m.uri))}}(T||(T={})),function(h){h.create=function create(h,m,y,v){return{targetUri:h,targetRange:m,targetSelectionRange:y,originSelectionRange:v}},h.is=function is(h){var m=h;return Ae.defined(m)&&C.is(m.targetRange)&&Ae.string(m.targetUri)&&(C.is(m.targetSelectionRange)||Ae.undefined(m.targetSelectionRange))&&(C.is(m.originSelectionRange)||Ae.undefined(m.originSelectionRange))}}(w||(w={})),function(h){h.create=function create(h,m,y,v){return{red:h,green:m,blue:y,alpha:v}},h.is=function is(h){var m=h;return Ae.number(m.red)&&Ae.number(m.green)&&Ae.number(m.blue)&&Ae.number(m.alpha)}}(A||(A={})),function(h){h.create=function create(h,m){return{range:h,color:m}},h.is=function is(h){var m=h;return C.is(m.range)&&A.is(m.color)}}(P||(P={})),function(h){h.create=function create(h,m,y){return{label:h,textEdit:m,additionalTextEdits:y}},h.is=function is(h){var m=h;return Ae.string(m.label)&&(Ae.undefined(m.textEdit)||L.is(m))&&(Ae.undefined(m.additionalTextEdits)||Ae.typedArray(m.additionalTextEdits,L.is))}}(k||(k={})),function(h){h.Comment="comment",h.Imports="imports",h.Region="region"}(R||(R={})),function(h){h.create=function create(h,m,y,v,C){var T={startLine:h,endLine:m};return Ae.defined(y)&&(T.startCharacter=y),Ae.defined(v)&&(T.endCharacter=v),Ae.defined(C)&&(T.kind=C),T},h.is=function is(h){var m=h;return Ae.number(m.startLine)&&Ae.number(m.startLine)&&(Ae.undefined(m.startCharacter)||Ae.number(m.startCharacter))&&(Ae.undefined(m.endCharacter)||Ae.number(m.endCharacter))&&(Ae.undefined(m.kind)||Ae.string(m.kind))}}(M||(M={})),function(h){h.create=function create(h,m){return{location:h,message:m}},h.is=function is(h){var m=h;return Ae.defined(m)&&T.is(m.location)&&Ae.string(m.message)}}(N||(N={})),function(h){h.Error=1,h.Warning=2,h.Information=3,h.Hint=4}(D||(D={})),function(h){h.Unnecessary=1,h.Deprecated=2}(I||(I={})),function(h){h.create=function create(h,m,y,v,C,T){var w={range:h,message:m};return Ae.defined(y)&&(w.severity=y),Ae.defined(v)&&(w.code=v),Ae.defined(C)&&(w.source=C),Ae.defined(T)&&(w.relatedInformation=T),w},h.is=function is(h){var m=h;return Ae.defined(m)&&C.is(m.range)&&Ae.string(m.message)&&(Ae.number(m.severity)||Ae.undefined(m.severity))&&(Ae.number(m.code)||Ae.string(m.code)||Ae.undefined(m.code))&&(Ae.string(m.source)||Ae.undefined(m.source))&&(Ae.undefined(m.relatedInformation)||Ae.typedArray(m.relatedInformation,N.is))}}(x||(x={})),function(h){h.create=function create(h,m){for(var y=[],v=2;v<arguments.length;v++)y[v-2]=arguments[v];var C={title:h,command:m};return Ae.defined(y)&&y.length>0&&(C.arguments=y),C},h.is=function is(h){var m=h;return Ae.defined(m)&&Ae.string(m.title)&&Ae.string(m.command)}}(O||(O={})),function(h){h.replace=function replace(h,m){return{range:h,newText:m}},h.insert=function insert(h,m){return{range:{start:h,end:h},newText:m}},h.del=function del(h){return{range:h,newText:""}},h.is=function is(h){var m=h;return Ae.objectLiteral(m)&&Ae.string(m.newText)&&C.is(m.range)}}(L||(L={})),function(h){h.create=function create(h,m){return{textDocument:h,edits:m}},h.is=function is(h){var m=h;return Ae.defined(m)&&$.is(m.textDocument)&&Array.isArray(m.edits)}}(U||(U={})),function(h){h.create=function create(h,m){var y={kind:"create",uri:h};return void 0===m||void 0===m.overwrite&&void 0===m.ignoreIfExists||(y.options=m),y},h.is=function is(h){var m=h;return m&&"create"===m.kind&&Ae.string(m.uri)&&(void 0===m.options||(void 0===m.options.overwrite||Ae.boolean(m.options.overwrite))&&(void 0===m.options.ignoreIfExists||Ae.boolean(m.options.ignoreIfExists)))}}(B||(B={})),function(h){h.create=function create(h,m,y){var v={kind:"rename",oldUri:h,newUri:m};return void 0===y||void 0===y.overwrite&&void 0===y.ignoreIfExists||(v.options=y),v},h.is=function is(h){var m=h;return m&&"rename"===m.kind&&Ae.string(m.oldUri)&&Ae.string(m.newUri)&&(void 0===m.options||(void 0===m.options.overwrite||Ae.boolean(m.options.overwrite))&&(void 0===m.options.ignoreIfExists||Ae.boolean(m.options.ignoreIfExists)))}}(W||(W={})),function(h){h.create=function create(h,m){var y={kind:"delete",uri:h};return void 0===m||void 0===m.recursive&&void 0===m.ignoreIfNotExists||(y.options=m),y},h.is=function is(h){var m=h;return m&&"delete"===m.kind&&Ae.string(m.uri)&&(void 0===m.options||(void 0===m.options.recursive||Ae.boolean(m.options.recursive))&&(void 0===m.options.ignoreIfNotExists||Ae.boolean(m.options.ignoreIfNotExists)))}}(q||(q={})),function(h){h.is=function is(h){var m=h;return m&&(void 0!==m.changes||void 0!==m.documentChanges)&&(void 0===m.documentChanges||m.documentChanges.every((function(h){return Ae.string(h.kind)?B.is(h)||W.is(h)||q.is(h):U.is(h)})))}}(Y||(Y={}));var V,$,z,G,J,X,Z,ee,te,re,ie,se,oe,ae,ce,le,ue,de,he,pe,me,fe,ye,ve,Se,Ee,Ce,_e=function(){function TextEditChangeImpl(h){this.edits=h}return TextEditChangeImpl.prototype.insert=function(h,m){this.edits.push(L.insert(h,m))},TextEditChangeImpl.prototype.replace=function(h,m){this.edits.push(L.replace(h,m))},TextEditChangeImpl.prototype.delete=function(h){this.edits.push(L.del(h))},TextEditChangeImpl.prototype.add=function(h){this.edits.push(h)},TextEditChangeImpl.prototype.all=function(){return this.edits},TextEditChangeImpl.prototype.clear=function(){this.edits.splice(0,this.edits.length)},TextEditChangeImpl}(),Te=function(){function WorkspaceChange(h){var m=this;this._textEditChanges=Object.create(null),h&&(this._workspaceEdit=h,h.documentChanges?h.documentChanges.forEach((function(h){if(U.is(h)){var y=new _e(h.edits);m._textEditChanges[h.textDocument.uri]=y}})):h.changes&&Object.keys(h.changes).forEach((function(y){var v=new _e(h.changes[y]);m._textEditChanges[y]=v})))}return Object.defineProperty(WorkspaceChange.prototype,"edit",{get:function(){return this._workspaceEdit},enumerable:!0,configurable:!0}),WorkspaceChange.prototype.getTextEditChange=function(h){if($.is(h)){if(this._workspaceEdit||(this._workspaceEdit={documentChanges:[]}),!this._workspaceEdit.documentChanges)throw new Error("Workspace edit is not configured for document changes.");var m=h;if(!(v=this._textEditChanges[m.uri])){var y={textDocument:m,edits:C=[]};this._workspaceEdit.documentChanges.push(y),v=new _e(C),this._textEditChanges[m.uri]=v}return v}if(this._workspaceEdit||(this._workspaceEdit={changes:Object.create(null)}),!this._workspaceEdit.changes)throw new Error("Workspace edit is not configured for normal text edit changes.");var v;if(!(v=this._textEditChanges[h])){var C=[];this._workspaceEdit.changes[h]=C,v=new _e(C),this._textEditChanges[h]=v}return v},WorkspaceChange.prototype.createFile=function(h,m){this.checkDocumentChanges(),this._workspaceEdit.documentChanges.push(B.create(h,m))},WorkspaceChange.prototype.renameFile=function(h,m,y){this.checkDocumentChanges(),this._workspaceEdit.documentChanges.push(W.create(h,m,y))},WorkspaceChange.prototype.deleteFile=function(h,m){this.checkDocumentChanges(),this._workspaceEdit.documentChanges.push(q.create(h,m))},WorkspaceChange.prototype.checkDocumentChanges=function(){if(!this._workspaceEdit||!this._workspaceEdit.documentChanges)throw new Error("Workspace edit is not configured for document changes.")},WorkspaceChange}();!function(h){h.create=function create(h){return{uri:h}},h.is=function is(h){var m=h;return Ae.defined(m)&&Ae.string(m.uri)}}(V||(V={})),function(h){h.create=function create(h,m){return{uri:h,version:m}},h.is=function is(h){var m=h;return Ae.defined(m)&&Ae.string(m.uri)&&(null===m.version||Ae.number(m.version))}}($||($={})),function(h){h.create=function create(h,m,y,v){return{uri:h,languageId:m,version:y,text:v}},h.is=function is(h){var m=h;return Ae.defined(m)&&Ae.string(m.uri)&&Ae.string(m.languageId)&&Ae.number(m.version)&&Ae.string(m.text)}}(z||(z={})),function(h){h.PlainText="plaintext",h.Markdown="markdown"}(G||(G={})),function(h){h.is=function is(m){var y=m;return y===h.PlainText||y===h.Markdown}}(G||(G={})),function(h){h.is=function is(h){var m=h;return Ae.objectLiteral(h)&&G.is(m.kind)&&Ae.string(m.value)}}(J||(J={})),function(h){h.Text=1,h.Method=2,h.Function=3,h.Constructor=4,h.Field=5,h.Variable=6,h.Class=7,h.Interface=8,h.Module=9,h.Property=10,h.Unit=11,h.Value=12,h.Enum=13,h.Keyword=14,h.Snippet=15,h.Color=16,h.File=17,h.Reference=18,h.Folder=19,h.EnumMember=20,h.Constant=21,h.Struct=22,h.Event=23,h.Operator=24,h.TypeParameter=25}(X||(X={})),function(h){h.PlainText=1,h.Snippet=2}(Z||(Z={})),function(h){h.Deprecated=1}(ee||(ee={})),function(h){h.create=function create(h){return{label:h}}}(te||(te={})),function(h){h.create=function create(h,m){return{items:h||[],isIncomplete:!!m}}}(re||(re={})),function(h){h.fromPlainText=function fromPlainText(h){return h.replace(/[\\`*_{}[\]()#+\-.!]/g,"\\$&")},h.is=function is(h){var m=h;return Ae.string(m)||Ae.objectLiteral(m)&&Ae.string(m.language)&&Ae.string(m.value)}}(ie||(ie={})),function(h){h.is=function is(h){var m=h;return!!m&&Ae.objectLiteral(m)&&(J.is(m.contents)||ie.is(m.contents)||Ae.typedArray(m.contents,ie.is))&&(void 0===h.range||C.is(h.range))}}(se||(se={})),function(h){h.create=function create(h,m){return m?{label:h,documentation:m}:{label:h}}}(oe||(oe={})),function(h){h.create=function create(h,m){for(var y=[],v=2;v<arguments.length;v++)y[v-2]=arguments[v];var C={label:h};return Ae.defined(m)&&(C.documentation=m),Ae.defined(y)?C.parameters=y:C.parameters=[],C}}(ae||(ae={})),function(h){h.Text=1,h.Read=2,h.Write=3}(ce||(ce={})),function(h){h.create=function create(h,m){var y={range:h};return Ae.number(m)&&(y.kind=m),y}}(le||(le={})),function(h){h.File=1,h.Module=2,h.Namespace=3,h.Package=4,h.Class=5,h.Method=6,h.Property=7,h.Field=8,h.Constructor=9,h.Enum=10,h.Interface=11,h.Function=12,h.Variable=13,h.Constant=14,h.String=15,h.Number=16,h.Boolean=17,h.Array=18,h.Object=19,h.Key=20,h.Null=21,h.EnumMember=22,h.Struct=23,h.Event=24,h.Operator=25,h.TypeParameter=26}(ue||(ue={})),function(h){h.Deprecated=1}(de||(de={})),function(h){h.create=function create(h,m,y,v,C){var T={name:h,kind:m,location:{uri:v,range:y}};return C&&(T.containerName=C),T}}(he||(he={})),function(h){h.create=function create(h,m,y,v,C,T){var w={name:h,detail:m,kind:y,range:v,selectionRange:C};return void 0!==T&&(w.children=T),w},h.is=function is(h){var m=h;return m&&Ae.string(m.name)&&Ae.number(m.kind)&&C.is(m.range)&&C.is(m.selectionRange)&&(void 0===m.detail||Ae.string(m.detail))&&(void 0===m.deprecated||Ae.boolean(m.deprecated))&&(void 0===m.children||Array.isArray(m.children))}}(pe||(pe={})),function(h){h.Empty="",h.QuickFix="quickfix",h.Refactor="refactor",h.RefactorExtract="refactor.extract",h.RefactorInline="refactor.inline",h.RefactorRewrite="refactor.rewrite",h.Source="source",h.SourceOrganizeImports="source.organizeImports",h.SourceFixAll="source.fixAll"}(me||(me={})),function(h){h.create=function create(h,m){var y={diagnostics:h};return null!=m&&(y.only=m),y},h.is=function is(h){var m=h;return Ae.defined(m)&&Ae.typedArray(m.diagnostics,x.is)&&(void 0===m.only||Ae.typedArray(m.only,Ae.string))}}(fe||(fe={})),function(h){h.create=function create(h,m,y){var v={title:h};return O.is(m)?v.command=m:v.edit=m,void 0!==y&&(v.kind=y),v},h.is=function is(h){var m=h;return m&&Ae.string(m.title)&&(void 0===m.diagnostics||Ae.typedArray(m.diagnostics,x.is))&&(void 0===m.kind||Ae.string(m.kind))&&(void 0!==m.edit||void 0!==m.command)&&(void 0===m.command||O.is(m.command))&&(void 0===m.isPreferred||Ae.boolean(m.isPreferred))&&(void 0===m.edit||Y.is(m.edit))}}(ye||(ye={})),function(h){h.create=function create(h,m){var y={range:h};return Ae.defined(m)&&(y.data=m),y},h.is=function is(h){var m=h;return Ae.defined(m)&&C.is(m.range)&&(Ae.undefined(m.command)||O.is(m.command))}}(ve||(ve={})),function(h){h.create=function create(h,m){return{tabSize:h,insertSpaces:m}},h.is=function is(h){var m=h;return Ae.defined(m)&&Ae.number(m.tabSize)&&Ae.boolean(m.insertSpaces)}}(Se||(Se={})),function(h){h.create=function create(h,m,y){return{range:h,target:m,data:y}},h.is=function is(h){var m=h;return Ae.defined(m)&&C.is(m.range)&&(Ae.undefined(m.target)||Ae.string(m.target))}}(Ee||(Ee={})),function(h){h.create=function create(h,m){return{range:h,parent:m}},h.is=function is(m){var y=m;return void 0!==y&&C.is(y.range)&&(void 0===y.parent||h.is(y.parent))}}(Ce||(Ce={}));var be,we=["\n","\r\n","\r"];!function(h){h.create=function create(h,m,y,v){return new Pe(h,m,y,v)},h.is=function is(h){var m=h;return!!(Ae.defined(m)&&Ae.string(m.uri)&&(Ae.undefined(m.languageId)||Ae.string(m.languageId))&&Ae.number(m.lineCount)&&Ae.func(m.getText)&&Ae.func(m.positionAt)&&Ae.func(m.offsetAt))},h.applyEdits=function applyEdits(h,m){for(var y=h.getText(),v=function mergeSort(h,m){if(h.length<=1)return h;var y=h.length/2|0,v=h.slice(0,y),C=h.slice(y);mergeSort(v,m),mergeSort(C,m);var T=0,w=0,A=0;for(;T<v.length&&w<C.length;){var P=m(v[T],C[w]);h[A++]=P<=0?v[T++]:C[w++]}for(;T<v.length;)h[A++]=v[T++];for(;w<C.length;)h[A++]=C[w++];return h}(m,(function(h,m){var y=h.range.start.line-m.range.start.line;return 0===y?h.range.start.character-m.range.start.character:y})),C=y.length,T=v.length-1;T>=0;T--){var w=v[T],A=h.offsetAt(w.range.start),P=h.offsetAt(w.range.end);if(!(P<=C))throw new Error("Overlapping edit");y=y.substring(0,A)+w.newText+y.substring(P,y.length),C=A}return y}}(be||(be={}));var Ae,Pe=function(){function FullTextDocument(h,m,y,v){this._uri=h,this._languageId=m,this._version=y,this._content=v,this._lineOffsets=void 0}return Object.defineProperty(FullTextDocument.prototype,"uri",{get:function(){return this._uri},enumerable:!0,configurable:!0}),Object.defineProperty(FullTextDocument.prototype,"languageId",{get:function(){return this._languageId},enumerable:!0,configurable:!0}),Object.defineProperty(FullTextDocument.prototype,"version",{get:function(){return this._version},enumerable:!0,configurable:!0}),FullTextDocument.prototype.getText=function(h){if(h){var m=this.offsetAt(h.start),y=this.offsetAt(h.end);return this._content.substring(m,y)}return this._content},FullTextDocument.prototype.update=function(h,m){this._content=h.text,this._version=m,this._lineOffsets=void 0},FullTextDocument.prototype.getLineOffsets=function(){if(void 0===this._lineOffsets){for(var h=[],m=this._content,y=!0,v=0;v<m.length;v++){y&&(h.push(v),y=!1);var C=m.charAt(v);y="\r"===C||"\n"===C,"\r"===C&&v+1<m.length&&"\n"===m.charAt(v+1)&&v++}y&&m.length>0&&h.push(m.length),this._lineOffsets=h}return this._lineOffsets},FullTextDocument.prototype.positionAt=function(h){h=Math.max(Math.min(h,this._content.length),0);var m=this.getLineOffsets(),y=0,C=m.length;if(0===C)return v.create(0,h);for(;y<C;){var T=Math.floor((y+C)/2);m[T]>h?C=T:y=T+1}var w=y-1;return v.create(w,h-m[w])},FullTextDocument.prototype.offsetAt=function(h){var m=this.getLineOffsets();if(h.line>=m.length)return this._content.length;if(h.line<0)return 0;var y=m[h.line],v=h.line+1<m.length?m[h.line+1]:this._content.length;return Math.max(Math.min(y+h.character,v),y)},Object.defineProperty(FullTextDocument.prototype,"lineCount",{get:function(){return this.getLineOffsets().length},enumerable:!0,configurable:!0}),FullTextDocument}();!function(h){var m=Object.prototype.toString;h.defined=function defined(h){return void 0!==h},h.undefined=function undefined(h){return void 0===h},h.boolean=function boolean(h){return!0===h||!1===h},h.string=function string(h){return"[object String]"===m.call(h)},h.number=function number(h){return"[object Number]"===m.call(h)},h.func=function func(h){return"[object Function]"===m.call(h)},h.objectLiteral=function objectLiteral(h){return null!==h&&"object"==typeof h},h.typedArray=function typedArray(h,m){return Array.isArray(h)&&h.every(m)}}(Ae||(Ae={}))},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0});const v=y(1424),C=y(59),T=y(45),w=y(1425);m.ImplementationRequest=w.ImplementationRequest;const A=y(1426);m.TypeDefinitionRequest=A.TypeDefinitionRequest;const P=y(1427);m.WorkspaceFoldersRequest=P.WorkspaceFoldersRequest,m.DidChangeWorkspaceFoldersNotification=P.DidChangeWorkspaceFoldersNotification;const k=y(1428);m.ConfigurationRequest=k.ConfigurationRequest;const R=y(1429);m.DocumentColorRequest=R.DocumentColorRequest,m.ColorPresentationRequest=R.ColorPresentationRequest;const M=y(1430);m.FoldingRangeRequest=M.FoldingRangeRequest;const N=y(1431);m.DeclarationRequest=N.DeclarationRequest;const D=y(1432);m.SelectionRangeRequest=D.SelectionRangeRequest;const I=y(1433);var x,O;m.WorkDoneProgress=I.WorkDoneProgress,m.WorkDoneProgressCreateRequest=I.WorkDoneProgressCreateRequest,m.WorkDoneProgressCancelNotification=I.WorkDoneProgressCancelNotification,function(h){h.is=function is(h){const m=h;return v.string(m.language)||v.string(m.scheme)||v.string(m.pattern)}}(x=m.DocumentFilter||(m.DocumentFilter={})),function(h){h.is=function is(h){if(!Array.isArray(h))return!1;for(let m of h)if(!v.string(m)&&!x.is(m))return!1;return!0}}(O=m.DocumentSelector||(m.DocumentSelector={})),function(h){h.type=new T.ProtocolRequestType("client/registerCapability")}(m.RegistrationRequest||(m.RegistrationRequest={})),function(h){h.type=new T.ProtocolRequestType("client/unregisterCapability")}(m.UnregistrationRequest||(m.UnregistrationRequest={})),function(h){h.Create="create",h.Rename="rename",h.Delete="delete"}(m.ResourceOperationKind||(m.ResourceOperationKind={})),function(h){h.Abort="abort",h.Transactional="transactional",h.TextOnlyTransactional="textOnlyTransactional",h.Undo="undo"}(m.FailureHandlingKind||(m.FailureHandlingKind={})),function(h){h.hasId=function hasId(h){const m=h;return m&&v.string(m.id)&&m.id.length>0}}(m.StaticRegistrationOptions||(m.StaticRegistrationOptions={})),function(h){h.is=function is(h){const m=h;return m&&(null===m.documentSelector||O.is(m.documentSelector))}}(m.TextDocumentRegistrationOptions||(m.TextDocumentRegistrationOptions={})),function(h){h.is=function is(h){const m=h;return v.objectLiteral(m)&&(void 0===m.workDoneProgress||v.boolean(m.workDoneProgress))},h.hasWorkDoneProgress=function hasWorkDoneProgress(h){const m=h;return m&&v.boolean(m.workDoneProgress)}}(m.WorkDoneProgressOptions||(m.WorkDoneProgressOptions={})),function(h){h.type=new T.ProtocolRequestType("initialize")}(m.InitializeRequest||(m.InitializeRequest={})),function(h){h.unknownProtocolVersion=1}(m.InitializeError||(m.InitializeError={})),function(h){h.type=new T.ProtocolNotificationType("initialized")}(m.InitializedNotification||(m.InitializedNotification={})),function(h){h.type=new T.ProtocolRequestType0("shutdown")}(m.ShutdownRequest||(m.ShutdownRequest={})),function(h){h.type=new T.ProtocolNotificationType0("exit")}(m.ExitNotification||(m.ExitNotification={})),function(h){h.type=new T.ProtocolNotificationType("workspace/didChangeConfiguration")}(m.DidChangeConfigurationNotification||(m.DidChangeConfigurationNotification={})),function(h){h.Error=1,h.Warning=2,h.Info=3,h.Log=4}(m.MessageType||(m.MessageType={})),function(h){h.type=new T.ProtocolNotificationType("window/showMessage")}(m.ShowMessageNotification||(m.ShowMessageNotification={})),function(h){h.type=new T.ProtocolRequestType("window/showMessageRequest")}(m.ShowMessageRequest||(m.ShowMessageRequest={})),function(h){h.type=new T.ProtocolNotificationType("window/logMessage")}(m.LogMessageNotification||(m.LogMessageNotification={})),function(h){h.type=new T.ProtocolNotificationType("telemetry/event")}(m.TelemetryEventNotification||(m.TelemetryEventNotification={})),function(h){h.None=0,h.Full=1,h.Incremental=2}(m.TextDocumentSyncKind||(m.TextDocumentSyncKind={})),function(h){h.method="textDocument/didOpen",h.type=new T.ProtocolNotificationType(h.method)}(m.DidOpenTextDocumentNotification||(m.DidOpenTextDocumentNotification={})),function(h){h.method="textDocument/didChange",h.type=new T.ProtocolNotificationType(h.method)}(m.DidChangeTextDocumentNotification||(m.DidChangeTextDocumentNotification={})),function(h){h.method="textDocument/didClose",h.type=new T.ProtocolNotificationType(h.method)}(m.DidCloseTextDocumentNotification||(m.DidCloseTextDocumentNotification={})),function(h){h.method="textDocument/didSave",h.type=new T.ProtocolNotificationType(h.method)}(m.DidSaveTextDocumentNotification||(m.DidSaveTextDocumentNotification={})),function(h){h.Manual=1,h.AfterDelay=2,h.FocusOut=3}(m.TextDocumentSaveReason||(m.TextDocumentSaveReason={})),function(h){h.method="textDocument/willSave",h.type=new T.ProtocolNotificationType(h.method)}(m.WillSaveTextDocumentNotification||(m.WillSaveTextDocumentNotification={})),function(h){h.method="textDocument/willSaveWaitUntil",h.type=new T.ProtocolRequestType(h.method)}(m.WillSaveTextDocumentWaitUntilRequest||(m.WillSaveTextDocumentWaitUntilRequest={})),function(h){h.type=new T.ProtocolNotificationType("workspace/didChangeWatchedFiles")}(m.DidChangeWatchedFilesNotification||(m.DidChangeWatchedFilesNotification={})),function(h){h.Created=1,h.Changed=2,h.Deleted=3}(m.FileChangeType||(m.FileChangeType={})),function(h){h.Create=1,h.Change=2,h.Delete=4}(m.WatchKind||(m.WatchKind={})),function(h){h.type=new T.ProtocolNotificationType("textDocument/publishDiagnostics")}(m.PublishDiagnosticsNotification||(m.PublishDiagnosticsNotification={})),function(h){h.Invoked=1,h.TriggerCharacter=2,h.TriggerForIncompleteCompletions=3}(m.CompletionTriggerKind||(m.CompletionTriggerKind={})),function(h){h.method="textDocument/completion",h.type=new T.ProtocolRequestType(h.method),h.resultType=new C.ProgressType}(m.CompletionRequest||(m.CompletionRequest={})),function(h){h.method="completionItem/resolve",h.type=new T.ProtocolRequestType(h.method)}(m.CompletionResolveRequest||(m.CompletionResolveRequest={})),function(h){h.method="textDocument/hover",h.type=new T.ProtocolRequestType(h.method)}(m.HoverRequest||(m.HoverRequest={})),function(h){h.Invoked=1,h.TriggerCharacter=2,h.ContentChange=3}(m.SignatureHelpTriggerKind||(m.SignatureHelpTriggerKind={})),function(h){h.method="textDocument/signatureHelp",h.type=new T.ProtocolRequestType(h.method)}(m.SignatureHelpRequest||(m.SignatureHelpRequest={})),function(h){h.method="textDocument/definition",h.type=new T.ProtocolRequestType(h.method),h.resultType=new C.ProgressType}(m.DefinitionRequest||(m.DefinitionRequest={})),function(h){h.method="textDocument/references",h.type=new T.ProtocolRequestType(h.method),h.resultType=new C.ProgressType}(m.ReferencesRequest||(m.ReferencesRequest={})),function(h){h.method="textDocument/documentHighlight",h.type=new T.ProtocolRequestType(h.method),h.resultType=new C.ProgressType}(m.DocumentHighlightRequest||(m.DocumentHighlightRequest={})),function(h){h.method="textDocument/documentSymbol",h.type=new T.ProtocolRequestType(h.method),h.resultType=new C.ProgressType}(m.DocumentSymbolRequest||(m.DocumentSymbolRequest={})),function(h){h.method="textDocument/codeAction",h.type=new T.ProtocolRequestType(h.method),h.resultType=new C.ProgressType}(m.CodeActionRequest||(m.CodeActionRequest={})),function(h){h.method="workspace/symbol",h.type=new T.ProtocolRequestType(h.method),h.resultType=new C.ProgressType}(m.WorkspaceSymbolRequest||(m.WorkspaceSymbolRequest={})),function(h){h.type=new T.ProtocolRequestType("textDocument/codeLens"),h.resultType=new C.ProgressType}(m.CodeLensRequest||(m.CodeLensRequest={})),function(h){h.type=new T.ProtocolRequestType("codeLens/resolve")}(m.CodeLensResolveRequest||(m.CodeLensResolveRequest={})),function(h){h.method="textDocument/documentLink",h.type=new T.ProtocolRequestType(h.method),h.resultType=new C.ProgressType}(m.DocumentLinkRequest||(m.DocumentLinkRequest={})),function(h){h.type=new T.ProtocolRequestType("documentLink/resolve")}(m.DocumentLinkResolveRequest||(m.DocumentLinkResolveRequest={})),function(h){h.method="textDocument/formatting",h.type=new T.ProtocolRequestType(h.method)}(m.DocumentFormattingRequest||(m.DocumentFormattingRequest={})),function(h){h.method="textDocument/rangeFormatting",h.type=new T.ProtocolRequestType(h.method)}(m.DocumentRangeFormattingRequest||(m.DocumentRangeFormattingRequest={})),function(h){h.method="textDocument/onTypeFormatting",h.type=new T.ProtocolRequestType(h.method)}(m.DocumentOnTypeFormattingRequest||(m.DocumentOnTypeFormattingRequest={})),function(h){h.method="textDocument/rename",h.type=new T.ProtocolRequestType(h.method)}(m.RenameRequest||(m.RenameRequest={})),function(h){h.method="textDocument/prepareRename",h.type=new T.ProtocolRequestType(h.method)}(m.PrepareRenameRequest||(m.PrepareRenameRequest={})),function(h){h.type=new T.ProtocolRequestType("workspace/executeCommand")}(m.ExecuteCommandRequest||(m.ExecuteCommandRequest={})),function(h){h.type=new T.ProtocolRequestType("workspace/applyEdit")}(m.ApplyWorkspaceEditRequest||(m.ApplyWorkspaceEditRequest={}))},function(h,m,y){"use strict";function string(h){return"string"==typeof h||h instanceof String}function array(h){return Array.isArray(h)}Object.defineProperty(m,"__esModule",{value:!0}),m.boolean=function boolean(h){return!0===h||!1===h},m.string=string,m.number=function number(h){return"number"==typeof h||h instanceof Number},m.error=function error(h){return h instanceof Error},m.func=function func(h){return"function"==typeof h},m.array=array,m.stringArray=function stringArray(h){return array(h)&&h.every(h=>string(h))},m.typedArray=function typedArray(h,m){return Array.isArray(h)&&h.every(m)},m.objectLiteral=function objectLiteral(h){return null!==h&&"object"==typeof h}},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0});const v=y(59),C=y(45);!function(h){h.method="textDocument/implementation",h.type=new C.ProtocolRequestType(h.method),h.resultType=new v.ProgressType}(m.ImplementationRequest||(m.ImplementationRequest={}))},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0});const v=y(59),C=y(45);!function(h){h.method="textDocument/typeDefinition",h.type=new C.ProtocolRequestType(h.method),h.resultType=new v.ProgressType}(m.TypeDefinitionRequest||(m.TypeDefinitionRequest={}))},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0});const v=y(45);!function(h){h.type=new v.ProtocolRequestType0("workspace/workspaceFolders")}(m.WorkspaceFoldersRequest||(m.WorkspaceFoldersRequest={})),function(h){h.type=new v.ProtocolNotificationType("workspace/didChangeWorkspaceFolders")}(m.DidChangeWorkspaceFoldersNotification||(m.DidChangeWorkspaceFoldersNotification={}))},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0});const v=y(45);!function(h){h.type=new v.ProtocolRequestType("workspace/configuration")}(m.ConfigurationRequest||(m.ConfigurationRequest={}))},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0});const v=y(59),C=y(45);!function(h){h.method="textDocument/documentColor",h.type=new C.ProtocolRequestType(h.method),h.resultType=new v.ProgressType}(m.DocumentColorRequest||(m.DocumentColorRequest={})),function(h){h.type=new C.ProtocolRequestType("textDocument/colorPresentation")}(m.ColorPresentationRequest||(m.ColorPresentationRequest={}))},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0});const v=y(59),C=y(45);!function(h){h.Comment="comment",h.Imports="imports",h.Region="region"}(m.FoldingRangeKind||(m.FoldingRangeKind={})),function(h){h.method="textDocument/foldingRange",h.type=new C.ProtocolRequestType(h.method),h.resultType=new v.ProgressType}(m.FoldingRangeRequest||(m.FoldingRangeRequest={}))},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0});const v=y(59),C=y(45);!function(h){h.method="textDocument/declaration",h.type=new C.ProtocolRequestType(h.method),h.resultType=new v.ProgressType}(m.DeclarationRequest||(m.DeclarationRequest={}))},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0});const v=y(59),C=y(45);!function(h){h.method="textDocument/selectionRange",h.type=new C.ProtocolRequestType(h.method),h.resultType=new v.ProgressType}(m.SelectionRangeRequest||(m.SelectionRangeRequest={}))},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0});const v=y(59),C=y(45);!function(h){h.type=new v.ProgressType}(m.WorkDoneProgress||(m.WorkDoneProgress={})),function(h){h.type=new C.ProtocolRequestType("window/workDoneProgress/create")}(m.WorkDoneProgressCreateRequest||(m.WorkDoneProgressCreateRequest={})),function(h){h.type=new C.ProtocolNotificationType("window/workDoneProgress/cancel")}(m.WorkDoneProgressCancelNotification||(m.WorkDoneProgressCancelNotification={}))},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0});const v=y(45);!function(h){h.method="textDocument/prepareCallHierarchy",h.type=new v.ProtocolRequestType(h.method)}(m.CallHierarchyPrepareRequest||(m.CallHierarchyPrepareRequest={})),function(h){h.method="callHierarchy/incomingCalls",h.type=new v.ProtocolRequestType(h.method)}(m.CallHierarchyIncomingCallsRequest||(m.CallHierarchyIncomingCallsRequest={})),function(h){h.method="callHierarchy/outgoingCalls",h.type=new v.ProtocolRequestType(h.method)}(m.CallHierarchyOutgoingCallsRequest||(m.CallHierarchyOutgoingCallsRequest={}))},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0});const v=y(45);!function(h){h.comment="comment",h.keyword="keyword",h.string="string",h.number="number",h.regexp="regexp",h.operator="operator",h.namespace="namespace",h.type="type",h.struct="struct",h.class="class",h.interface="interface",h.enum="enum",h.typeParameter="typeParameter",h.function="function",h.member="member",h.property="property",h.macro="macro",h.variable="variable",h.parameter="parameter",h.label="label"}(m.SemanticTokenTypes||(m.SemanticTokenTypes={})),function(h){h.documentation="documentation",h.declaration="declaration",h.definition="definition",h.reference="reference",h.static="static",h.abstract="abstract",h.deprecated="deprecated",h.async="async",h.volatile="volatile",h.readonly="readonly"}(m.SemanticTokenModifiers||(m.SemanticTokenModifiers={})),function(h){h.is=function is(h){const m=h;return void 0!==m&&(void 0===m.resultId||"string"==typeof m.resultId)&&Array.isArray(m.data)&&(0===m.data.length||"number"==typeof m.data[0])}}(m.SemanticTokens||(m.SemanticTokens={})),function(h){h.method="textDocument/semanticTokens",h.type=new v.ProtocolRequestType(h.method)}(m.SemanticTokensRequest||(m.SemanticTokensRequest={})),function(h){h.method="textDocument/semanticTokens/edits",h.type=new v.ProtocolRequestType(h.method)}(m.SemanticTokensEditsRequest||(m.SemanticTokensEditsRequest={})),function(h){h.method="textDocument/semanticTokens/range",h.type=new v.ProtocolRequestType(h.method)}(m.SemanticTokensRangeRequest||(m.SemanticTokensRangeRequest={}))},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0});m.Delayer=class Delayer{constructor(h){this.defaultDelay=h,this.timeout=void 0,this.completionPromise=void 0,this.onSuccess=void 0,this.task=void 0}trigger(h,m=this.defaultDelay){return this.task=h,m>=0&&this.cancelTimeout(),this.completionPromise||(this.completionPromise=new Promise(h=>{this.onSuccess=h}).then(()=>{this.completionPromise=void 0,this.onSuccess=void 0;var h=this.task();return this.task=void 0,h})),(m>=0||void 0===this.timeout)&&(this.timeout=setTimeout(()=>{this.timeout=void 0,this.onSuccess(void 0)},m>=0?m:this.defaultDelay)),this.completionPromise}forceDelivery(){if(!this.completionPromise)return;this.cancelTimeout();let h=this.task();return this.completionPromise=void 0,this.onSuccess=void 0,this.task=void 0,h}isTriggered(){return void 0!==this.timeout}cancel(){this.cancelTimeout(),this.completionPromise=void 0}cancelTimeout(){void 0!==this.timeout&&(clearTimeout(this.timeout),this.timeout=void 0)}}},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0});const v=y(116),C=y(72),T=y(0),w=y(30),A=y(115);function ensure(h,m){return void 0===h[m]&&(h[m]={}),h[m]}class ColorProviderFeature extends A.TextDocumentFeature{constructor(h){super(h,w.DocumentColorRequest.type)}fillClientCapabilities(h){ensure(ensure(h,"textDocument"),"colorProvider").dynamicRegistration=!0}initialize(h,m){if(!h.colorProvider)return;const y=h.colorProvider,T=C.string(y.id)&&y.id.length>0?y.id:v.generateUuid(),w=y.documentSelector||m;w&&this.register(this.messages,{id:T,registerOptions:Object.assign({},{documentSelector:w})})}registerLanguageProvider(h){let m=this._client,provideColorPresentations=(h,y,v)=>{const C={color:h,textDocument:m.code2ProtocolConverter.asTextDocumentIdentifier(y.document),range:m.code2ProtocolConverter.asRange(y.range)};return m.sendRequest(w.ColorPresentationRequest.type,C,v).then(this.asColorPresentations.bind(this),h=>(m.logFailedRequest(w.ColorPresentationRequest.type,h),Promise.resolve(null)))},provideDocumentColors=(h,y)=>{const v={textDocument:m.code2ProtocolConverter.asTextDocumentIdentifier(h)};return m.sendRequest(w.DocumentColorRequest.type,v,y).then(this.asColorInformations.bind(this),h=>(m.logFailedRequest(w.ColorPresentationRequest.type,h),Promise.resolve(null)))},y=m.clientOptions.middleware;return T.languages.registerColorProvider(h.documentSelector,{provideColorPresentations:(h,m,v)=>y.provideColorPresentations?y.provideColorPresentations(h,m,v,provideColorPresentations):provideColorPresentations(h,m,v),provideDocumentColors:(h,m)=>y.provideDocumentColors?y.provideDocumentColors(h,m,provideDocumentColors):provideDocumentColors(h,m)})}asColor(h){return new T.Color(h.red,h.green,h.blue,h.alpha)}asColorInformations(h){return Array.isArray(h)?h.map(h=>new T.ColorInformation(this._client.protocol2CodeConverter.asRange(h.range),this.asColor(h.color))):[]}asColorPresentations(h){return Array.isArray(h)?h.map(h=>{let m=new T.ColorPresentation(h.label);return m.additionalTextEdits=this._client.protocol2CodeConverter.asTextEdits(h.additionalTextEdits),m.textEdit=this._client.protocol2CodeConverter.asTextEdit(h.textEdit),m}):[]}}m.ColorProviderFeature=ColorProviderFeature},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0});const v=y(0),C=y(30);m.ConfigurationFeature=class ConfigurationFeature{constructor(h){this._client=h}fillClientCapabilities(h){h.workspace=h.workspace||{},h.workspace.configuration=!0}initialize(){let h=this._client;h.onRequest(C.ConfigurationRequest.type,(m,y)=>{let configuration=h=>{let m=[];for(let y of h.items){let h=void 0!==y.scopeUri&&null!==y.scopeUri?this._client.protocol2CodeConverter.asUri(y.scopeUri):void 0;m.push(this.getConfiguration(h,null!==y.section?y.section:void 0))}return m},v=h.clientOptions.middleware.workspace;return v&&v.configuration?v.configuration(m,y,configuration):configuration(m)})}getConfiguration(h,m){let y=null;if(m){let C=m.lastIndexOf(".");if(-1===C)y=v.workspace.getConfiguration(void 0,h).get(m);else{let h=v.workspace.getConfiguration(m.substr(0,C));h&&(y=h.get(m.substr(C+1)))}}else{let m=v.workspace.getConfiguration(void 0,h);y={};for(let h of Object.keys(m))m.has(h)&&(y[h]=m.get(h))}return y||null}}},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0});const v=y(116),C=y(72),T=y(0),w=y(30),A=y(115);function ensure(h,m){return void 0===h[m]&&(h[m]={}),h[m]}class ImplementationFeature extends A.TextDocumentFeature{constructor(h){super(h,w.ImplementationRequest.type)}fillClientCapabilities(h){ensure(ensure(h,"textDocument"),"implementation").dynamicRegistration=!0}initialize(h,m){if(h.implementationProvider)if(!0===h.implementationProvider){if(!m)return;this.register(this.messages,{id:v.generateUuid(),registerOptions:Object.assign({},{documentSelector:m})})}else{const y=h.implementationProvider,T=C.string(y.id)&&y.id.length>0?y.id:v.generateUuid(),w=y.documentSelector||m;w&&this.register(this.messages,{id:T,registerOptions:Object.assign({},{documentSelector:w})})}}registerLanguageProvider(h){let m=this._client,provideImplementation=(h,y,v)=>m.sendRequest(w.ImplementationRequest.type,m.code2ProtocolConverter.asTextDocumentPositionParams(h,y),v).then(m.protocol2CodeConverter.asDefinitionResult,h=>(m.logFailedRequest(w.ImplementationRequest.type,h),Promise.resolve(null))),y=m.clientOptions.middleware;return T.languages.registerImplementationProvider(h.documentSelector,{provideImplementation:(h,m,v)=>y.provideImplementation?y.provideImplementation(h,m,v,provideImplementation):provideImplementation(h,m,v)})}}m.ImplementationFeature=ImplementationFeature},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0});const v=y(116),C=y(72),T=y(0),w=y(30),A=y(115);function ensure(h,m){return void 0===h[m]&&(h[m]={}),h[m]}class TypeDefinitionFeature extends A.TextDocumentFeature{constructor(h){super(h,w.TypeDefinitionRequest.type)}fillClientCapabilities(h){ensure(ensure(h,"textDocument"),"typeDefinition").dynamicRegistration=!0}initialize(h,m){if(h.typeDefinitionProvider)if(!0===h.typeDefinitionProvider){if(!m)return;this.register(this.messages,{id:v.generateUuid(),registerOptions:Object.assign({},{documentSelector:m})})}else{const y=h.typeDefinitionProvider,T=C.string(y.id)&&y.id.length>0?y.id:v.generateUuid(),w=y.documentSelector||m;w&&this.register(this.messages,{id:T,registerOptions:Object.assign({},{documentSelector:w})})}}registerLanguageProvider(h){let m=this._client,provideTypeDefinition=(h,y,v)=>m.sendRequest(w.TypeDefinitionRequest.type,m.code2ProtocolConverter.asTextDocumentPositionParams(h,y),v).then(m.protocol2CodeConverter.asDefinitionResult,h=>(m.logFailedRequest(w.TypeDefinitionRequest.type,h),Promise.resolve(null))),y=m.clientOptions.middleware;return T.languages.registerTypeDefinitionProvider(h.documentSelector,{provideTypeDefinition:(h,m,v)=>y.provideTypeDefinition?y.provideTypeDefinition(h,m,v,provideTypeDefinition):provideTypeDefinition(h,m,v)})}}m.TypeDefinitionFeature=TypeDefinitionFeature},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0});const v=y(116),C=y(0),T=y(30);function access(h,m){if(void 0!==h)return h[m]}m.WorkspaceFoldersFeature=class WorkspaceFoldersFeature{constructor(h){this._client=h,this._listeners=new Map}get messages(){return T.DidChangeWorkspaceFoldersNotification.type}fillInitializeParams(h){let m=C.workspace.workspaceFolders;h.workspaceFolders=void 0===m?null:m.map(h=>this.asProtocol(h))}fillClientCapabilities(h){h.workspace=h.workspace||{},h.workspace.workspaceFolders=!0}initialize(h){let m=this._client;m.onRequest(T.WorkspaceFoldersRequest.type,h=>{let workspaceFolders=()=>{let h=C.workspace.workspaceFolders;return void 0===h?null:h.map(h=>this.asProtocol(h))},y=m.clientOptions.middleware.workspace;return y&&y.workspaceFolders?y.workspaceFolders(h,workspaceFolders):workspaceFolders()});let y,w=access(access(access(h,"workspace"),"workspaceFolders"),"changeNotifications");"string"==typeof w?y=w:!0===w&&(y=v.generateUuid()),y&&this.register(this.messages,{id:y,registerOptions:void 0})}register(h,m){let y=m.id,v=this._client,w=C.workspace.onDidChangeWorkspaceFolders(h=>{let didChangeWorkspaceFolders=h=>{let m={event:{added:h.added.map(h=>this.asProtocol(h)),removed:h.removed.map(h=>this.asProtocol(h))}};this._client.sendNotification(T.DidChangeWorkspaceFoldersNotification.type,m)},m=v.clientOptions.middleware.workspace;m&&m.didChangeWorkspaceFolders?m.didChangeWorkspaceFolders(h,didChangeWorkspaceFolders):didChangeWorkspaceFolders(h)});this._listeners.set(y,w)}unregister(h){let m=this._listeners.get(h);void 0!==m&&(this._listeners.delete(h),m.dispose())}dispose(){for(let h of this._listeners.values())h.dispose();this._listeners.clear()}asProtocol(h){return void 0===h?null:{uri:this._client.code2ProtocolConverter.asUri(h.uri),name:h.name}}}},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0});const v=y(116),C=y(72),T=y(0),w=y(30),A=y(115);function ensure(h,m){return void 0===h[m]&&(h[m]={}),h[m]}class FoldingRangeFeature extends A.TextDocumentFeature{constructor(h){super(h,w.FoldingRangeRequest.type)}fillClientCapabilities(h){let m=ensure(ensure(h,"textDocument"),"foldingRange");m.dynamicRegistration=!0,m.rangeLimit=5e3,m.lineFoldingOnly=!0}initialize(h,m){if(!h.foldingRangeProvider)return;const y=h.foldingRangeProvider,T=C.string(y.id)&&y.id.length>0?y.id:v.generateUuid(),w=y.documentSelector||m;w&&this.register(this.messages,{id:T,registerOptions:Object.assign({},{documentSelector:w})})}registerLanguageProvider(h){let m=this._client,provideFoldingRanges=(h,y,v)=>{const C={textDocument:m.code2ProtocolConverter.asTextDocumentIdentifier(h)};return m.sendRequest(w.FoldingRangeRequest.type,C,v).then(this.asFoldingRanges.bind(this),h=>(m.logFailedRequest(w.FoldingRangeRequest.type,h),Promise.resolve(null)))},y=m.clientOptions.middleware;return T.languages.registerFoldingRangeProvider(h.documentSelector,{provideFoldingRanges:(h,m,v)=>y.provideFoldingRanges?y.provideFoldingRanges(h,m,v,provideFoldingRanges):provideFoldingRanges(h,0,v)})}asFoldingRangeKind(h){if(h)switch(h){case w.FoldingRangeKind.Comment:return T.FoldingRangeKind.Comment;case w.FoldingRangeKind.Imports:return T.FoldingRangeKind.Imports;case w.FoldingRangeKind.Region:return T.FoldingRangeKind.Region}}asFoldingRanges(h){return Array.isArray(h)?h.map(h=>new T.FoldingRange(h.startLine,h.endLine,this.asFoldingRangeKind(h.kind))):[]}}m.FoldingRangeFeature=FoldingRangeFeature},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0});const v=y(7),C=y(18),T=y(31),w=y(41);function generatePipeName(){let h="vscode-lang-"+function makeRandomHexString(h){let m=["0","1","2","3","4","5","6","6","7","8","9","a","b","c","d","e","f"],y="";for(let v=0;v<h;v++){y+=m[Math.floor(m.length*Math.random())]}return y}(40);return"win32"===process.platform?"\\\\.\\pipe\\"+h+"-sock":v.join(C.tmpdir(),h+".sock")}m.fork=function fork(h,m,y,C){let A,P=!1,reject=h=>{P||(P=!0,C(h,void 0))},k=generatePipeName(),R=generatePipeName(),M=function generatePatchedEnv(h,m,y){let v={};for(let m in h)v[m]=h[m];return v.STDIN_PIPE_NAME=m,v.STDOUT_PIPE_NAME=y,v.ATOM_SHELL_INTERNAL_RUN_AS_NODE="1",v.ELECTRON_RUN_AS_NODE="1",v}(y.env||process.env,k,R),N=T.createServer(h=>{h.once("data",m=>{var y;A.stdin=T.connect(k),A.stdout=h,y=A,P||(P=!0,C(void 0,y))})});N.listen(R);let D=!1,closeServer=()=>{D||(D=!0,process.removeListener("exit",closeServer),N.close())},I=v.join(__dirname,"electronForkStart");A=w.fork(I,[h].concat(m),{silent:!0,cwd:y.cwd,env:M,execArgv:y.execArgv}),A.once("error",h=>{closeServer(),reject(h)}),A.once("exit",h=>{closeServer(),reject(h)}),process.once("exit",closeServer)}},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0});const v=y(41),C=y(7),T="win32"===process.platform,w="darwin"===process.platform,A="linux"===process.platform;m.terminate=function terminate(h,m){if(T)try{let y={stdio:["pipe","pipe","ignore"]};return m&&(y.cwd=m),v.execFileSync("taskkill",["/T","/F","/PID",h.pid.toString()],y),!0}catch(h){return!1}else{if(!A&&!w)return h.kill("SIGKILL"),!0;try{var y=C.join(__dirname,"terminateProcess.sh");return!v.spawnSync(y,[h.pid.toString()]).error}catch(h){return!1}}}},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0});const v=y(0),C=y(194),T=y(3);m.CommentsViewItem="comments";class CommentsTreeDataProvider extends T.TreeDataProviderBase{constructor(){super(m.CommentsViewItem,T.TreeDataProviderContext.SharedOrJoined)}registerService(h){return this.commentManager=h,h.onCommentCountChanged(()=>this.forceRefreshItems())}getChildrenItems(h){return Promise.resolve([])}getRootItem(){let h;if(C.commentsSupported()){const y=T.localize("sessionExplorer.commentsLabel").replace("$(count)",String(this.commentManager.commentCount));h=new T.TreeViewItem({type:m.CommentsViewItem,collapsibleState:v.TreeItemCollapsibleState.None,label:y,command:{title:"Focus comment panel...",command:"workbench.action.focusCommentsPanel"}})}return Promise.resolve(h)}}m.CommentsTreeDataProvider=CommentsTreeDataProvider},function(h,m,y){"use strict";var v=this&&this.__awaiter||function(h,m,y,v){return new(y||(y=Promise))((function(C,T){function fulfilled(h){try{step(v.next(h))}catch(h){T(h)}}function rejected(h){try{step(v.throw(h))}catch(h){T(h)}}function step(h){h.done?C(h.value):function adopt(h){return h instanceof y?h:new y((function(m){m(h)}))}(h.value).then(fulfilled,rejected)}step((v=v.apply(h,m||[])).next())}))};Object.defineProperty(m,"__esModule",{value:!0});const C=y(0),T=y(3),w=y(3),A=y(4);m.HostCoauthorCommitMessageUpdater=class HostCoauthorCommitMessageUpdater{constructor(h,m){this.disposables=[],this.coauthors=[],this.sourceControl=m,this.sessionContext=h.sessionContext(),this.workspaceUserService=h.workspaceUserService()}init(){return v(this,void 0,void 0,(function*(){this.workspaceUserService.onWorkspaceSessionChanged(this.onWorkspaceSessionChanged,this,this.disposables),C.workspace.onDidChangeConfiguration(h=>{h.affectsConfiguration("liveshare.populateGitCoAuthors")&&this.updateCommitMessageIfEnabled()},this.disposables)}))}dispose(){return v(this,void 0,void 0,(function*(){this.disposables.forEach(h=>h.dispose()),this.disposables=[],this.coauthors=[]}))}onWorkspaceSessionChanged({changeType:h,userProfile:m}){h===A.vsls.WorkspaceSessionChangeType.Joined&&this.addCoauthor(m)}addCoauthor(h){if(!h||h.isOwner||!h.name||!h.email||h.isAnonymous)return;const m=`Co-authored-by: ${h.name} <${h.email}>`;this.coauthors.includes(m)||this.coauthors.push(m),this.updateCommitMessageIfEnabled()}updateCommitMessageIfEnabled(){"always"!==T.Settings.get(T.SettingKeys.populateGitCoAuthors)||w.workspaceSessionInfoTracker.isReadOnly||this.sourceControl.updateCommitMessage(this.updateCoauthorsInCommitMessage.bind(this))}updateCoauthorsInCommitMessage(h){if(this.coauthors.length){(h=h||"").includes("Co-authored-by: ")||(h+="\n");for(const m of this.coauthors)h.includes(m)||(h+="\n"+m)}return h}}},function(h,m,y){"use strict";var v=this&&this.__awaiter||function(h,m,y,v){return new(y||(y=Promise))((function(C,T){function fulfilled(h){try{step(v.next(h))}catch(h){T(h)}}function rejected(h){try{step(v.throw(h))}catch(h){T(h)}}function step(h){h.done?C(h.value):function adopt(h){return h instanceof y?h:new y((function(m){m(h)}))}(h.value).then(fulfilled,rejected)}step((v=v.apply(h,m||[])).next())}))};Object.defineProperty(m,"__esModule",{value:!0});const C=y(1448),T=y(3),w=y(4),A={name:T.WellKnownRestrictedOperations.CodeAction};m.HostSourceControlService=class HostSourceControlService{constructor(h,m){this.providers=new Map,this.disposables=[],this.rpcServiceHandler=h.rpcServiceHandler(),this.workspaceService=h.workspaceService(),this.clientAccessCheck=m,this.fileService=h.fileService,this.session=h.sessionContext(),this.trace=h.trace().withName("SourceControl"),this.pathManager=h.pathManager()}init(){return v(this,void 0,void 0,(function*(){this.isActive||(this.isActive=!0,this.addProvider(new C.HostGitSourceControlProvider(this.fileService(),this.pathManager)),this.rpcServiceHandler.addRequestMethod(`${w.vsls.SourceControlService.name}.getAllSourceControls`,h=>this.getSourceControls(null,null,h)),this.rpcServiceHandler.addRequestMethod(`${w.vsls.SourceControlService.name}.getSourceControls`,(h,m)=>this.getSourceControls(h,null,m)),this.rpcServiceHandler.addRequestMethod(`${w.vsls.SourceControlService.name}.getSourceControl`,(h,m)=>this.getSourceControl(h,m)),this.rpcServiceHandler.addRequestMethod(`${w.vsls.SourceControlService.name}.getRecentVersions`,(h,m)=>this.getRecentVersions(h,m)),this.rpcServiceHandler.addRequestMethod(`${w.vsls.SourceControlService.name}.getRecentVersionsTillMergeVersion`,(h,m)=>this.getRecentVersionsTillMergeVersion(h,m)),this.rpcServiceHandler.addRequestMethod(`${w.vsls.SourceControlService.name}.getCurrentVersionName`,(h,m)=>this.getCurrentVersionName(h,m)),this.rpcServiceHandler.addRequestMethod(`${w.vsls.SourceControlService.name}.getRemoteVersionsNames`,(h,m)=>this.getRemoteVersionsNames(h,m)),this.rpcServiceHandler.addRequestMethod(`${w.vsls.SourceControlService.name}.getMergeVersion`,(h,m,y)=>this.getMergeVersion(h,m,y)),this.rpcServiceHandler.addRequestMethod(`${w.vsls.SourceControlService.name}.getDiffsForVersion`,(h,m,y)=>this.getDiffsForVersion(h,m,y)),this.rpcServiceHandler.addRequestMethod(`${w.vsls.SourceControlService.name}.getDiffForResource`,(h,m)=>this.getDiffForResource(h,m)),this.rpcServiceHandler.addRequestMethod(`${w.vsls.SourceControlService.name}.getResource`,(h,m)=>this.getResource(h,m)),this.rpcServiceHandler.addRequestMethodWithContext(`${w.vsls.SourceControlService.name}.cleanResources`,(h,m,y)=>this.cleanResources(h,m,y)),yield this.workspaceService.registerServicesAsync([`${w.vsls.SourceControlService.name}`],w.vsls.CollectionChangeType.Add))}))}dispose(){return v(this,void 0,void 0,(function*(){yield this.close()}))}close(){return v(this,void 0,void 0,(function*(){if(this.isActive){if(this.isActive=!1,this.session.isStartingCollaboration||this.session.isCollaborating)try{yield this.workspaceService.registerServicesAsync([`${w.vsls.SourceControlService.name}`],w.vsls.CollectionChangeType.Remove)}catch(h){}this.disposables.forEach(h=>h.dispose()),this.providers.forEach(h=>h.dispose()),this.providers.clear()}}))}addProvider(h){if(!h)throw new Error("provider is not defined");if(!this.isActive||this.providers.has(h.sourceControlId))return;this.providers.set(h.sourceControlId,h);const providerActivated=()=>{this.isActive&&(h.onResourceChanged(this.resourceChanged,this,this.disposables),h.onSourceControlChanged(this.sourceControlChanged,this,this.disposables),this.sourceControlChanged({change:w.vsls.SourceControlChange.Added,sourceControl:{sourceControlId:h.sourceControlId,instanceId:null}}))};h.isActive?providerActivated():h.activate().then(providerActivated,m=>{this.providers.delete(h.sourceControlId),this.providerActivationFailed(h,m)})}updateCommitMessage(h){if(h&&this.isActive)for(const m of this.providers.values())m.updateCommitMessages(h)}sourceControlChanged(h){this.isActive&&this.rpcServiceHandler.sendNotification(this.trace,`${w.vsls.SourceControlService.name}.sourceControlChanged`,h)}resourceChanged(h){this.isActive&&this.rpcServiceHandler.sendNotification(this.trace,`${w.vsls.SourceControlService.name}.resourceChanged`,h)}providerActivationFailed(h,m){this.trace.error(`'${h.sourceControlId}' host source control provider activation failed: ${m?m.message||m:"no reason provided"}`)}getSourceControl(h,m){return v(this,void 0,void 0,(function*(){const{sourceControlId:y,instanceId:v}=h,[C]=yield this.getSourceControls(y,v,m);return C||null}))}getSourceControls(h,m,y){return v(this,void 0,void 0,(function*(){if(!this.isActive)return[];const v=[];this.providers.forEach(C=>C.isActive&&(!h||C.sourceControlId===h)&&v.push(C.getSourceControls(m,y)));const C=yield Promise.all(v);return this.isActive?[].concat(...C):[]}))}getRecentVersions(h,m){return v(this,void 0,void 0,(function*(){if(!h||!this.isActive)return[];const{sourceControlId:y,instanceId:v}=h,C=this.providers.get(y);return C?yield C.getRecentVersions(v,m):[]}))}getRecentVersionsTillMergeVersion(h,m,y){return v(this,void 0,void 0,(function*(){if(!m||!this.isActive)return[];const{sourceControlId:v,instanceId:C}=m,T=this.providers.get(v);return T?yield T.getRecentVersionsTillMergeVersion(h,C,y):[]}))}getMergeVersion(h,m,y){return v(this,void 0,void 0,(function*(){if(!h||!this.isActive)return null;const{sourceControlId:v,instanceId:C}=h,T=this.providers.get(v);return T?yield T.getMergeVersion(C,m,y):null}))}getRemoteVersionsNames(h,m){if(!h||!this.isActive)return Promise.resolve([]);const{sourceControlId:y,instanceId:v}=h,C=this.providers.get(y);return C?Promise.resolve(C.getRemoteVersionsNames(v)):Promise.resolve([])}getCurrentVersionName(h,m){if(!h||!this.isActive)return Promise.resolve("");const{sourceControlId:y,instanceId:v}=h,C=this.providers.get(y);return C?Promise.resolve(C.getCurrentVersionName(v)):Promise.resolve("")}getDiffsForVersion(h,m,y){return v(this,void 0,void 0,(function*(){if(!h||!this.isActive)return[];const{sourceControlId:v,instanceId:C}=h,T=this.providers.get(v);return T?yield T.getDiffsForVersion(C,m,y):[]}))}getDiffForResource(h,m){return v(this,void 0,void 0,(function*(){if(!h||!this.isActive)return null;const y=this.providers.get(h.sourceControlId);return y?yield y.getDiffForResource(h,m):null}))}getResource(h,m){return v(this,void 0,void 0,(function*(){if(!h||!this.isActive)return"";let y;const v=h.sourceControlId;if(v)y=this.providers.get(v);else{let m=T.VSLS_SCHEME;const v=this.pathManager.protocol2CodeUriConverter(m+":"+h.path);for(const h of this.providers.values())if(h.isSourceControlled(v)){y=h;break}}return y?yield y.getResource(h,m):""}))}cleanResources(h,m,y){return v(this,void 0,void 0,(function*(){if(!h||!h.length||!this.isActive)return;if(this.clientAccessCheck&&!(yield this.clientAccessCheck().canPerformOperation(m,A)))return;const v=new Map;for(const m of h){const{sourceControlId:h}=m,y=v.get(h);y?y.push(m):this.providers.has(h)&&v.set(h,[m])}const C=[];for(const[h,m]of v)C.push(this.providers.get(h).cleanResources(m,y));yield Promise.all(C)}))}}},function(h,m,y){"use strict";var v=this&&this.__decorate||function(h,m,y,v){var C,T=arguments.length,w=T<3?m:null===v?v=Object.getOwnPropertyDescriptor(m,y):v;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)w=Reflect.decorate(h,m,y,v);else for(var A=h.length-1;A>=0;A--)(C=h[A])&&(w=(T<3?C(w):T>3?C(m,y,w):C(m,y))||w);return T>3&&w&&Object.defineProperty(m,y,w),w},C=this&&this.__metadata||function(h,m){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(h,m)},T=this&&this.__awaiter||function(h,m,y,v){return new(y||(y=Promise))((function(C,T){function fulfilled(h){try{step(v.next(h))}catch(h){T(h)}}function rejected(h){try{step(v.throw(h))}catch(h){T(h)}}function step(h){h.done?C(h.value):function adopt(h){return h instanceof y?h:new y((function(m){m(h)}))}(h.value).then(fulfilled,rejected)}step((v=v.apply(h,m||[])).next())}))};Object.defineProperty(m,"__esModule",{value:!0});const w=y(0),A=(y(1449),y(7)),P=y(7),k=y(0),R=y(3),M=y(5),N=y(3),D=y(4),I=y(159),x=["image/png","image/gif","image/jpeg","image/webp","image/tiff","image/bmp"];function gitParamsFromResource(h,m){if(!h||!h.path)return;let y=h.path;switch(h.type){case D.vsls.SourceControlResourceType.SpecificVerision:break;case D.vsls.SourceControlResourceType.Workspace:case D.vsls.SourceControlResourceType.WorkspaceWithSpecificVersion:y=m.protocolUri2CodeUriConverter(k.Uri.parse(`${N.VSLS_SCHEME}:${y}`)).fsPath;break;case D.vsls.SourceControlResourceType.External:if(y.startsWith("http:")||y.startsWith("https:"))return;y=m.protocolUri2CodeUriConverter(k.Uri.parse(y.startsWith(N.VSLS_SCHEME+":")?y:`${N.VSLS_SCHEME}:${y}`)).fsPath;break;default:return}const v=h.version?JSON.parse(h.version):{ref:""};return v.path=y,v}function resourceFromGitParams(h,m,y,v){if(h){if(void 0===y&&void 0===v)return resourceFromUri(h,m);if("file"===h.scheme)return{type:D.vsls.SourceControlResourceType.SpecificVerision,path:h.fsPath,version:JSON.stringify({ref:y,submoduleOf:v})}}}function resourceFromUri(h,m){if(!h)return;const y=m.code2protocolWorkspaceFilesOnly(h);return y?{type:D.vsls.SourceControlResourceType.Workspace,path:y.path}:void 0}function getChangeType(h){switch(h){case 10:return D.vsls.SourceControlChangeType.AddByThem;case 9:return D.vsls.SourceControlChangeType.AddByUs;case 13:return D.vsls.SourceControlChangeType.AddBoth;case 14:return D.vsls.SourceControlChangeType.DeleteBoth;case 15:return D.vsls.SourceControlChangeType.Conflict;case 6:return D.vsls.SourceControlChangeType.Delete;case 12:return D.vsls.SourceControlChangeType.DeleteByThem;case 11:return D.vsls.SourceControlChangeType.DeleteByUs;case 8:return D.vsls.SourceControlChangeType.Ignored;case 1:return D.vsls.SourceControlChangeType.Add;case 4:return D.vsls.SourceControlChangeType.IndexCopy;case 2:return D.vsls.SourceControlChangeType.IndexDelete;case 0:return D.vsls.SourceControlChangeType.IndexEdit;case 3:return D.vsls.SourceControlChangeType.Rename;case 5:return D.vsls.SourceControlChangeType.Edit;case 7:return D.vsls.SourceControlChangeType.Untracked;default:return}}function isDescendant(h,m){return h===m||(h.charAt(h.length-1)!==P.sep&&(h+=P.sep),function isWindowsPath(h){return/^[a-zA-Z]:\\/.test(h)}(h)&&(h=h.toLowerCase(),m=m.toLowerCase()),m.startsWith(h))}m.getChangeType=getChangeType;class HostGitSourceControlProvider{constructor(h,m){this.fileService=h,this.pathManager=m,this.instanceCount=0,this.rootUriToInstanceId=new Map,this.sourceControlChanged=new w.EventEmitter,this.sourceControlResourceChanged=new w.EventEmitter,this.disposables=[],this.changedInstances=new Set,this.resourceCache=new Map,this.isDisposed=!1,this.subscribedToRepoChanges=!1,this.sourceControlId="git",this.gitExtension=w.extensions.getExtension("vscode.git"),this.isActive&&(this.documentUriCacheCleanupTimer=I.setInterval(()=>this.cleanupDocumentUriCache(),3e5))}get gitApi(){try{return this.gitExtension&&this.gitExtension.exports.getAPI(1)}catch(h){}}get isActive(){return!!(this.gitExtension&&this.gitExtension.isActive&&this.gitApi)}activate(){return T(this,void 0,void 0,(function*(){if(!this.gitExtension)throw new Error("The VS Code Git extension is not enabled.");yield this.gitExtension.activate(),this.isDisposed||(this.subscribeToAllRepoChanges(),this.documentUriCacheCleanupTimer||(this.documentUriCacheCleanupTimer=I.setInterval(()=>this.cleanupDocumentUriCache(),3e5)))}))}getSourceControls(h,m){return T(this,void 0,void 0,(function*(){if(!this.isActive)return[];const m=this.gitApi.repositories.filter(m=>!h||this.isInstance(m,h)).map(h=>this.getVslsSourceControl(h));return(yield Promise.all(m)).filter(h=>h)}))}getRecentVersionsTillMergeVersion(h,m,y){return T(this,void 0,void 0,(function*(){const y=this.getRepoByInstanceId(m);if(!y)return[];if(!y.getGlobalConfig||!y.getLog){const h=y.state.HEAD&&this.getVersionFromCommitHash(y.state.HEAD.commit);return h?[h]:[]}const v=yield y.getLog({maxEntries:100}),C=v.findIndex(m=>m.hash===h);return C>=0&&C<v.length-1&&v.splice(C+1),v.map((h,m)=>this.getVersionFromCommit(h,m)).filter(h=>h)}))}getRemoteVersionsNames(h){const m=this.getRepoByInstanceId(h);return m?Promise.resolve(m.state.refs.map(h=>h.name)):Promise.resolve([])}getCurrentVersionName(h){const m=this.getRepoByInstanceId(h);return m?Promise.resolve(m.state.HEAD.name):Promise.resolve("")}getMergeVersion(h,m,y){return T(this,void 0,void 0,(function*(){const y=this.getRepoByInstanceId(h);if(!y)return null;const v=yield y.getBranch(m),C=yield y.getMergeBase(y.state.HEAD.name,v.name);return this.getVersionFromCommitHash(C)}))}getRecentVersions(h,m){return T(this,void 0,void 0,(function*(){const m=this.getRepoByInstanceId(h);if(!m)return[];if(!m.getGlobalConfig||!m.getLog){const h=m.state.HEAD&&this.getVersionFromCommitHash(m.state.HEAD.commit);return h?[h]:[]}let y="";try{y=yield m.getConfig("user.email")}catch(h){}if(!y)try{y=yield m.getGlobalConfig("user.email")}catch(h){}const v=yield m.getLog({maxEntries:100}),C=v.findIndex(h=>h.authorEmail!==y);return C>=0&&C<v.length-1&&v.splice(C+1),v.map((h,m)=>this.getVersionFromCommit(h,m)).filter(h=>h)}))}getVersionFromCommit(h,m){return h&&this.getVersionFromCommitHash(h.hash,h.message,m)}getVersionFromCommitHash(h,m,y){if(!h)return;const v=m?m.split("\n")[0]:`HEAD${y?"~"+y:""}`,C={ref:h};return{version:JSON.stringify(C),label:v,description:m}}getResource(h,m){return T(this,void 0,void 0,(function*(){if(!h||!this.isActive||this.isDisposed)return"";let{path:m,ref:y,submoduleOf:v}=gitParamsFromResource(h,this.pathManager);if(v){const h=this.getRepoContainingResource(v);return h?"index"===y?yield h.diffIndexWithHEAD(m):yield h.diffWithHEAD(m):""}const C=this.getRepoByInstanceId(h.instanceId)||this.getRepoContainingResource(m);if(!C)return"";const T=this.getInstanceId(C),w={resource:{type:h.type,path:h.path,version:h.version},timestamp:(new Date).getTime()},A=this.resourceCache.get(T);if(A?A.push(w):this.resourceCache.set(T,[w]),"~"===y){const h=k.Uri.file(m).toString(),[v]=C.state.indexChanges.filter(m=>m&&m.uri.toString()===h);y=v?"":"HEAD"}else/^~\d$/.test(y)&&(y=`:${y[1]}`);try{return yield C.show(y,m)}catch(h){return""}}))}getDiffForResource(h,m){return T(this,void 0,void 0,(function*(){if(!h||!h.path||!this.isActive||this.isDisposed)return null;const m=h.instanceId,y=h.groupId;if(!m||!y)return null;const v=this.getRepoByInstanceId(m);if(!v)return null;let C=null;switch(h.groupId){case"merge":C=v.state.mergeChanges;break;case"index":C=v.state.indexChanges;break;case"workingTree":C=v.state.workingTreeChanges;break;default:return null}const T=C.find(m=>{if(!m)return!1;const y=resourceFromUri(m.uri,this.pathManager);return y&&y.path===h.path});if(!T)return null;const w=T.uri;let A,P,k;try{A=yield new Promise((h,m)=>M.fileAccess.lstat(w.fsPath,(y,v)=>y?m(y):h(v)))}catch(h){}if(this.isDisposed)return null;if(A&&A.isDirectory()){const h=this.getRepositoryForSubmodule(w);if(h){const m="index"===y?"index":"wt",v=h.rootUri.fsPath;k=resourceFromGitParams(w,this.pathManager,m,v)}}else 12!==T.status&&(P=yield this.getLeftResource(T)),k=yield this.getRightResource(T);if(!k||this.isDisposed)return null;const R=getChangeType(T.status);return{left:P,right:k,title:this.getTitle(T),changeType:R}}))}getDiffsForVersion(h,m,y){return T(this,void 0,void 0,(function*(){const y=this.getRepoByInstanceId(h);if(!y||!m)return[];const v=JSON.parse(m);let C;if(y.diffWorkingDirectoryWith)C=yield y.diffWorkingDirectoryWith(v.ref);else{if(!y.state.HEAD||y.state.HEAD.commit!==v.ref)return[];C=[];const h=new Map(y.state.indexChanges.map(h=>[h.uri.toString(),h]));for(const m of y.state.workingTreeChanges)h.delete(m.uri.toString()),C.push(m);C.push(...h.values())}const T=C.map(h=>this.getResourceDiffFromChange(h,m)).filter(h=>h);return yield this.filterOutExternalHiddenExcludedFiles(T,h=>(h.right||h.left).path)}))}updateCommitMessages(h){if(this.isActive&&h)for(const m of this.gitApi.repositories){const y=m.inputBox.value,v=h(y);v!==y&&(m.inputBox.value=v)}}getResourceDiffFromChange(h,m){if(!h)return;let y=void 0;if(1!==h.status){if(y=resourceFromUri(h.originalUri,this.pathManager),y.type!==D.vsls.SourceControlResourceType.Workspace)return;y.type=D.vsls.SourceControlResourceType.WorkspaceWithSpecificVersion,y.version=m}const v=resourceFromUri(h.uri,this.pathManager);let C=getChangeType(h.status),T=A.basename(h.uri.fsPath);switch(h.status){case 5:T+=" (Modified)";break;case 7:case 1:T+=" (Added)",C=D.vsls.SourceControlChangeType.Add;break;case 3:T+=" (Renamed)";break;case 6:T+=" (Deleted)"}return{right:v,changeType:C,left:y,title:T}}cleanResources(h,m){return T(this,void 0,void 0,(function*(){if(!this.isActive||this.isDisposed)return;const m=new Map;for(const y of h){if(!y||!y.instanceId)continue;const h=y.instanceId,v=m.get(h);v?v.push(y):m.set(h,[y])}for(const[h,y]of m){const m=this.getRepoByInstanceId(h);if(!m)continue;const v=[];for(const h of y){const m=gitParamsFromResource(h,this.pathManager);m&&m.path&&v.push(m.path)}if(yield m.clean(v),this.isDisposed)return}}))}isSourceControlled(h){return!!this.getRepoContainingResource(h)}getRightResource(h){return T(this,void 0,void 0,(function*(){if(h)switch(h.status){case 0:case 1:case 4:case 3:return this.getResourceFromGitParams(h.uri,"");case 2:case 6:return this.getResourceFromGitParams(h.uri,"HEAD");case 11:return this.getResourceFromGitParams(h.uri,"~3");case 12:return this.getResourceFromGitParams(h.uri,"~2");case 5:case 7:case 8:const m=this.getRepoContainingResource(h.uri);if(!m)return;const y=h.uri.toString(),[v]=m.state.indexChanges.filter(h=>h.uri.toString()===y);return v&&v.renameUri?resourceFromGitParams(v.renameUri,this.pathManager):resourceFromGitParams(h.uri,this.pathManager);case 13:case 15:return resourceFromGitParams(h.uri,this.pathManager);default:return}}))}getLeftResource(h){return T(this,void 0,void 0,(function*(){if(h)switch(h.status){case 0:case 3:return this.getResourceFromGitParams(h.originalUri,"HEAD");case 5:return this.getResourceFromGitParams(h.uri,"~");case 12:return this.getResourceFromGitParams(h.uri,"");default:return}}))}getTitle(h){if(!h||!h.uri)return"";const m=A.basename(h.uri.fsPath);switch(h.status){case 0:case 3:return`${m} (Index)`;case 5:case 13:case 15:return`${m} (Working Tree)`;case 11:return`${m} (Theirs)`;case 12:return`${m} (Ours)`;default:return""}}getResourceFromGitParams(h,m){return T(this,void 0,void 0,(function*(){const y=this.getRepoContainingResource(h);if(!y)return resourceFromGitParams(h,this.pathManager,m);try{let v=m;if("~"===v){const m=h.toString(),[C]=y.state.indexChanges.filter(h=>h.uri&&h.uri.toString()===m);v=C?"":"HEAD"}const{size:C,object:T}=yield y.getObjectDetails(v,h.fsPath),{mimetype:w}=yield y.detectObjectType(T);if("text/plain"===w)return resourceFromGitParams(h,this.pathManager,m);if(C>1e6)return{type:D.vsls.SourceControlResourceType.External,path:`data:;label:${A.basename(h.fsPath)};description:${v},`};if(x.indexOf(w)>-1){const m=yield y.buffer(v,h.fsPath);return{type:D.vsls.SourceControlResourceType.External,path:`data:${w};label:${A.basename(h.fsPath)};description:${v};size:${C};base64,${m.toString("base64")}`}}return{type:D.vsls.SourceControlResourceType.External,path:`data:;label:${A.basename(h.fsPath)};description:${v},`}}catch(y){return resourceFromGitParams(h,this.pathManager,m)}}))}onSourceControlChanged(h,m,y){return this.subscribeToAllRepoChanges(),this.sourceControlChanged.event(h,m,y)}onResourceChanged(h,m,y){return this.subscribeToAllRepoChanges(),this.sourceControlResourceChanged.event(h,m,y)}dispose(){this.isDisposed=!0,this.disposables.forEach(h=>h.dispose()),this.documentUriCacheCleanupTimer&&(clearInterval(this.documentUriCacheCleanupTimer),this.documentUriCacheCleanupTimer=void 0)}getVslsSourceControl(h){return T(this,void 0,void 0,(function*(){if(!h)return;const m=h.rootUri?A.basename(h.rootUri.fsPath)||h.rootUri.fsPath:"";return{sourceControlId:this.sourceControlId,instanceId:this.getInstanceId(h),label:"Git",name:m,resourceGroups:yield this.getVslsResourceGroups(h)}}))}getVslsResourceGroups(h){return T(this,void 0,void 0,(function*(){if(!h)return[];if(!h.clean)return[{groupId:"unsupported",label:"N/A. Ask host to update VSCode to get SCC in collaboration session."}];const m=h.state;return[{groupId:"merge",label:"Merge Changes",hideWhenEmpty:!0,supportsOpenFile:!0,resourceStates:yield this.getVslsResourceStates(m.mergeChanges)},{groupId:"index",label:"Staged Changes",hideWhenEmpty:!0,supportsOpenChanges:!0,supportsOpenFile:!0,resourceStates:yield this.getVslsResourceStates(m.indexChanges)},{groupId:"workingTree",label:"Changes",supportsClean:!0,supportsOpenChanges:!0,supportsOpenFile:!0,resourceStates:yield this.getVslsResourceStates(m.workingTreeChanges)}]}))}getVslsResourceStates(h){return T(this,void 0,void 0,(function*(){const m=(h||[]).map(h=>this.getVslsResourceState(h)).filter(h=>h);return yield this.filterOutExternalHiddenExcludedFiles(m,h=>h.current.path)}))}filterOutExternalHiddenExcludedFiles(h,m){return T(this,void 0,void 0,(function*(){if(!h)return;if(!h.length)return[];const y=yield this.fileService.listAsync(h.map(m),{includeExcluded:!0,includeHidden:!0}),v=[];for(let m=0;m<h.length&&m<y.length;m++){const C=y[m].attributes;C!==D.vsls.FileAttributes.External&&C!==D.vsls.FileAttributes.Hidden&&C!==D.vsls.FileAttributes.Excluded&&v.push(h[m])}return v}))}getVslsResourceState(h){if(!h)return;const m=resourceFromGitParams(h.uri,this.pathManager);if(!m)return;const y={changeType:getChangeType(h.status),current:m};return h.originalUri&&h.uri&&h.uri.toString()!==h.originalUri.toString()&&(y.original=resourceFromGitParams(h.originalUri,this.pathManager)),y}subscribeToAllRepoChanges(){this.subscribedToRepoChanges||!this.isActive||this.isDisposed||(this.gitApi.onDidOpenRepository(this.onDidOpenRepository,this,this.disposables),this.gitApi.onDidCloseRepository(this.onDidCloseRepository,this,this.disposables),this.gitApi.repositories.forEach(h=>this.subscribeToRepoChanges(h)),this.subscribedToRepoChanges=!0)}subscribeToRepoChanges(h){h.state.onDidChange(()=>this.repoChanged(h),this,this.disposables)}repoChanged(h){this.fireSourceControlChangedEvent(h,D.vsls.SourceControlChange.Updated),this.changedInstances.add(this.getInstanceId(h)),this.eventuallyFireDocumentChangeEvents()}fireSourceControlChangedEvent(h,m){this.sourceControlChanged.fire({sourceControl:{sourceControlId:this.sourceControlId,instanceId:this.getInstanceId(h)},change:m})}eventuallyFireDocumentChangeEvents(){this.fireDocumentChangeEvents()}fireDocumentChangeEvents(){return T(this,void 0,void 0,(function*(){for(const h of this.changedInstances){const m=this.resourceCache.get(h);m&&m.length&&this.sourceControlResourceChanged.fire({sourceControl:{sourceControlId:this.sourceControlId,instanceId:h},resources:m.map(h=>h.resource)})}this.changedInstances.clear()}))}onDidOpenRepository(h){this.subscribeToRepoChanges(h),this.fireSourceControlChangedEvent(h,D.vsls.SourceControlChange.Added)}onDidCloseRepository(h){this.fireSourceControlChangedEvent(h,D.vsls.SourceControlChange.Removed)}getRepoByInstanceId(h){if(this.isActive&&!this.isDisposed&&h)return this.gitApi.repositories.find(m=>this.isInstance(m,h))}getInstanceId(h){if(!h||!h.rootUri)return;const m=h.rootUri.toString();let y=this.rootUriToInstanceId.get(m);return y||(this.instanceCount++,y=this.instanceCount.toString(10),this.rootUriToInstanceId.set(m,y)),y}isInstance(h,m){return h&&h.rootUri&&m&&this.rootUriToInstanceId.get(h.rootUri.toString())===m}getRepoContainingResource(h){if(h&&("string"==typeof h&&(h=k.Uri.file(h)),h instanceof k.Uri)){const m=h.fsPath;e:for(const h of this.gitApi.repositories.sort((h,m)=>h.rootUri.fsPath.length-m.rootUri.fsPath.length)){const y=h.rootUri.fsPath;if(isDescendant(y,m)){for(const v of h.state.submodules){if(isDescendant(A.join(y,v.path),m))continue e}return h}}}}getRepositoryForSubmodule(h){for(const m of this.gitApi.repositories)for(const y of m.state.submodules){if(A.join(m.rootUri.fsPath,y.path)===h.fsPath)return m}}cleanupDocumentUriCache(){const h=(new Date).getTime();for(const[m,y]of this.resourceCache){for(let m=y.length-1;m>=0;m--)h-y[m].timestamp>=18e4&&y.splice(m,1);y.length||this.resourceCache.delete(m)}}}v([R.memoize,C("design:type",Object),C("design:paramtypes",[])],HostGitSourceControlProvider.prototype,"gitApi",null),v([R.debounce(1100),C("design:type",Function),C("design:paramtypes",[]),C("design:returntype",void 0)],HostGitSourceControlProvider.prototype,"eventuallyFireDocumentChangeEvents",null),m.HostGitSourceControlProvider=HostGitSourceControlProvider},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0})},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0});const v=y(2),C=y(3),T=y(4),w=y(1451),A=y(579),P=y(194);m.dependencies=function(){const h={sourceControlService:v.lazyLoad(()=>C.dependencies.rpcFactory(T.vsls.SourceControlService,T.vsls.TraceSources.ClientSourceControl)),guestSourceControlManager:v.lazyLoad(()=>w.guestSourceControlManagerFactory(C.dependencies,h)),hostCommentService:v.lazyLoad(()=>new A.HostCommentService(C.dependencies)),commentService:v.lazyLoad(()=>C.sessionStateTracker.State===C.SessionState.Shared||C.sessionStateTracker.State===C.SessionState.SharingInProgress?h.hostCommentService():C.dependencies.rpcFactory(T.vsls.CommentService,T.vsls.TraceSources.ClientCommentService)),commentManager:v.lazyLoad(()=>P.commentManagerFactory(C.dependencies,h))};return h}()},function(h,m,y){"use strict";var v=this&&this.__decorate||function(h,m,y,v){var C,T=arguments.length,w=T<3?m:null===v?v=Object.getOwnPropertyDescriptor(m,y):v;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)w=Reflect.decorate(h,m,y,v);else for(var A=h.length-1;A>=0;A--)(C=h[A])&&(w=(T<3?C(w):T>3?C(m,y,w):C(m,y))||w);return T>3&&w&&Object.defineProperty(m,y,w),w},C=this&&this.__metadata||function(h,m){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(h,m)},T=this&&this.__awaiter||function(h,m,y,v){return new(y||(y=Promise))((function(C,T){function fulfilled(h){try{step(v.next(h))}catch(h){T(h)}}function rejected(h){try{step(v.throw(h))}catch(h){T(h)}}function step(h){h.done?C(h.value):function adopt(h){return h instanceof y?h:new y((function(m){m(h)}))}(h.value).then(fulfilled,rejected)}step((v=v.apply(h,m||[])).next())}))};Object.defineProperty(m,"__esModule",{value:!0});const w=y(0),A=y(7),P=y(0),k=y(3),R=y(4);function getUri(h){if(!h)return;const{resource:m,sccId:y,groupId:v}=h;if(!m||!m.path)return;const C=m.path;if(m.type===R.vsls.SourceControlResourceType.SpecificVerision||m.type===R.vsls.SourceControlResourceType.WorkspaceWithSpecificVersion){const T={path:C};return m.type===R.vsls.SourceControlResourceType.WorkspaceWithSpecificVersion&&(T.isWorkspace=!0),m.version&&(T.version=m.version),y&&(T.sccId=y),v&&(T.groupId=v),h.resourceUri&&(T.resourceUri=h.resourceUri.toString()),P.Uri.parse("vsls-scc://").with({query:JSON.stringify(T),path:C})}if(k.KNOWN_SCHEMES.find(h=>C.startsWith(h+":")))return P.Uri.parse(C);if(C.startsWith("file:"))return P.Uri.parse(C).with({scheme:k.VSLS_SCHEME});let T,w=m.path;switch(m.type){case R.vsls.SourceControlResourceType.Workspace:T=k.VSLS_SCHEME,w?(w=w.replace(/\\/g,"/"),w.startsWith("/")||(w="/"+w)):w="/";break;case R.vsls.SourceControlResourceType.External:T=k.VSLS_SCHEME;break;default:return}return P.Uri.parse(`${T}:${w}`)}function isDecorationEnabled(){return w.workspace.getConfiguration("git").get("decorations.enabled",!0)}function getVSCodeGroupId(h){if(!h||!h.groupId)return;let m="";return h.supportsClean&&(m+="clean_"),h.supportsOpenChanges&&(m+="openChanges_"),h.supportsOpenFile&&(m+="openFile_"),m+h.groupId.replace("~","~~").replace("_","~_")}class SccRegistration{constructor(h){this.decorationsChanged=new w.EventEmitter,this.disposables=[],this.decorations=new Map,this.groups=new Map,this.onDidChangeDecorations=this.decorationsChanged.event,this.id=++SccRegistration.registrationCount,SccRegistration.registrations.set(this.id,this),this.instanceId=h.instanceId,this.sourceControlId=h.sourceControlId;const m=h.name?P.Uri.file(`/${h.name}`):void 0;this.scc=w.scm.createSourceControl("vsls-scc",h.label,m),this.scc.inputBox.visible=!1,this.scc.quickDiffProvider=this,h.resourceGroups&&h.resourceGroups.forEach(h=>this.createResourceGroup(h)),this.updateDecorations(!1),w.window.registerDecorationProvider&&this.disposables.push(w.window.registerDecorationProvider(this))}provideDecoration(h,m){return this.decorations.get(h.toString())}provideOriginalResource(h){const m=SccRegistration.getResourceIdentity(h);if(m&&m.type===R.vsls.SourceControlResourceType.Workspace)return m.type=R.vsls.SourceControlResourceType.WorkspaceWithSpecificVersion,this.getUri({resource:m})}dispose(){this.disposables.forEach(h=>h.dispose()),this.disposables=[],this.scc.dispose(),SccRegistration.registrations.delete(this.id)}update(h){const m=!isDecorationEnabled(),y=h.resourceGroups||[];this.groups.forEach(h=>!y.find(m=>getVSCodeGroupId(m)===h.id)&&this.groups.delete(h.id)&&h.dispose()),y.forEach(h=>{const y=this.groups.get(getVSCodeGroupId(h));y?y.resourceStates=h.resourceStates.map(y=>new SccResourceState(this,h.groupId,y,m,h.supportsClean,h.supportsOpenChanges)):this.createResourceGroup(h)}),this.updateDecorations(!0)}getUri(h){return getUri(Object.assign({sccId:this.id},h))}static getResourceIdentity(h){if(h)switch(h.scheme){case k.VSLS_SCHEME:return h.toString().startsWith(k.PathManager.externalPrefix)?{path:h.path,type:R.vsls.SourceControlResourceType.External}:{path:h.path,type:R.vsls.SourceControlResourceType.Workspace};case"vsls-scc":const m=JSON.parse(h.query);if(!m||!m.path)return;const y=m.isWorkspace?R.vsls.SourceControlResourceType.WorkspaceWithSpecificVersion:R.vsls.SourceControlResourceType.SpecificVerision,v={path:m.path,type:y};m.version&&(v.version=m.version);const C=SccRegistration.registrations.get(m.sccId);return C&&(v.sourceControlId=C.sourceControlId,v.instanceId=C.instanceId),m.groupId&&(v.groupId=m.groupId),v}}getSccResources(h){if(!(h=h||w.window.activeTextEditor&&w.window.activeTextEditor.document.uri))return[];let m;if("vsls-scc"===h.scheme){const y=JSON.parse(h.query);if(!y||!y.resourceUri)return[];m=y.resourceUri}else m=h.toString();const y=[];for(const[,h]of this.groups)for(const v of h.resourceStates)v.resourceUri.toString()===m&&y.push(v);return y}updateDecorations(h){if(!w.window.registerDecorationProvider)return;const m=new Map;this.groups.forEach(h=>h.resourceStates.forEach(h=>{const y=h,v=y.resourceDecoration;v&&y.original&&m.set(y.original.toString(),v)}));const y=new Set([...this.decorations.keys()].concat([...m.keys()]));this.decorations=m,h&&this.decorationsChanged.fire([...y.values()].map(h=>P.Uri.parse(h)))}createResourceGroup(h){if(!h)return;const m=this.scc.createResourceGroup(getVSCodeGroupId(h),h.label);h.hideWhenEmpty&&(m.hideWhenEmpty=!0);const y=!isDecorationEnabled();m.resourceStates=h.resourceStates.map(m=>new SccResourceState(this,h.groupId,m,y,h.supportsClean,h.supportsOpenChanges)).filter(h=>h.resourceUri),this.groups.set(m.id,m)}}SccRegistration.registrationCount=0,SccRegistration.registrations=new Map;class SccResourceState{constructor(h,m,y,v,C,T){this.sccRegistration=h,this.groupId=m,this.useIcons=v,this.supportsClean=C,this.supportsOpenChanges=T,this.command={command:"liveshare.scc.openChange",title:"Open",arguments:[this]},this.current=y.current,this.changeType=y.changeType,this.resourceUri=h.getUri({resource:y.current,groupId:m}),this.original=h.getUri({resource:y.original,groupId:m})||this.resourceUri}get instanceId(){return this.sccRegistration.instanceId}get sourceControlId(){return this.sccRegistration.sourceControlId}get ResourceIdentity(){return{sourceControlId:this.sourceControlId,instanceId:this.instanceId,groupId:this.groupId,path:this.current.path,version:this.current.version,type:this.current.type}}get decorations(){const h=this.tooltip,m=this.strikeThrough,y=this.letter,v=this.color;return{strikeThrough:m,faded:!1,tooltip:h,light:this.useIcons?{iconPath:this.getIconPath("light")}:void 0,dark:this.useIcons?{iconPath:this.getIconPath("dark")}:void 0,letter:y,color:v,source:"vsls-scc.resource"}}get resourceDecoration(){if(!this.changeType||this.changeType===R.vsls.SourceControlChangeType.Delete||this.changeType===R.vsls.SourceControlChangeType.IndexDelete)return;return{bubble:!0,source:"git.resource",title:this.tooltip,letter:this.letter,color:this.color,priority:this.priority}}getUri(h){return this.sccRegistration.getUri(Object.assign({groupId:this.groupId,resourceUri:this.resourceUri},h))}getIconPath(h){switch(this.changeType){case R.vsls.SourceControlChangeType.IndexEdit:case R.vsls.SourceControlChangeType.Edit:return k.ExtensionUtil.getExtensionUri(`images/${h}/status-modified.svg`);case R.vsls.SourceControlChangeType.Add:return k.ExtensionUtil.getExtensionUri(`images/${h}/status-added.svg`);case R.vsls.SourceControlChangeType.IndexDelete:case R.vsls.SourceControlChangeType.Delete:return k.ExtensionUtil.getExtensionUri(`images/${h}/status-deleted.svg`);case R.vsls.SourceControlChangeType.Rename:return k.ExtensionUtil.getExtensionUri(`images/${h}/status-renamed.svg`);case R.vsls.SourceControlChangeType.IndexCopy:return k.ExtensionUtil.getExtensionUri(`images/${h}/status-copied.svg`);case R.vsls.SourceControlChangeType.Untracked:return k.ExtensionUtil.getExtensionUri(`images/${h}/status-untracked.svg`);case R.vsls.SourceControlChangeType.Ignored:return k.ExtensionUtil.getExtensionUri(`images/${h}/status-ignored.svg`);case R.vsls.SourceControlChangeType.DeleteBoth:case R.vsls.SourceControlChangeType.AddByUs:case R.vsls.SourceControlChangeType.DeleteByThem:case R.vsls.SourceControlChangeType.AddByThem:case R.vsls.SourceControlChangeType.DeleteByUs:case R.vsls.SourceControlChangeType.AddBoth:case R.vsls.SourceControlChangeType.Conflict:return k.ExtensionUtil.getExtensionUri(`images/${h}/status-conflict.svg`)}}get priority(){switch(this.changeType){case R.vsls.SourceControlChangeType.IndexEdit:case R.vsls.SourceControlChangeType.Edit:return 2;case R.vsls.SourceControlChangeType.Ignored:return 3;case R.vsls.SourceControlChangeType.IndexCopy:case R.vsls.SourceControlChangeType.DeleteBoth:case R.vsls.SourceControlChangeType.AddByUs:case R.vsls.SourceControlChangeType.DeleteByThem:case R.vsls.SourceControlChangeType.AddByThem:case R.vsls.SourceControlChangeType.DeleteByUs:case R.vsls.SourceControlChangeType.AddBoth:case R.vsls.SourceControlChangeType.Conflict:return 4;default:return 1}}get tooltip(){switch(this.changeType){case R.vsls.SourceControlChangeType.IndexEdit:return"Index Modified";case R.vsls.SourceControlChangeType.Edit:return"Modified";case R.vsls.SourceControlChangeType.Add:return"Index Added";case R.vsls.SourceControlChangeType.IndexDelete:return"Index Deleted";case R.vsls.SourceControlChangeType.Delete:return"Deleted";case R.vsls.SourceControlChangeType.Rename:return"Index Renamed";case R.vsls.SourceControlChangeType.IndexCopy:return"Index Copied";case R.vsls.SourceControlChangeType.Untracked:return"Untracked";case R.vsls.SourceControlChangeType.Ignored:return"Ignored";case R.vsls.SourceControlChangeType.DeleteBoth:return"Both Deleted";case R.vsls.SourceControlChangeType.AddByUs:return"Added By Us";case R.vsls.SourceControlChangeType.DeleteByThem:return"Deleted By Them";case R.vsls.SourceControlChangeType.AddByThem:return"Added By Them";case R.vsls.SourceControlChangeType.DeleteByUs:return"Deleted By Us";case R.vsls.SourceControlChangeType.AddBoth:return"Both Added";case R.vsls.SourceControlChangeType.Conflict:return"Both Modified";default:return""}}get letter(){switch(this.changeType){case R.vsls.SourceControlChangeType.IndexEdit:case R.vsls.SourceControlChangeType.Edit:return"M";case R.vsls.SourceControlChangeType.Add:return"A";case R.vsls.SourceControlChangeType.IndexDelete:case R.vsls.SourceControlChangeType.Delete:return"D";case R.vsls.SourceControlChangeType.Rename:return"R";case R.vsls.SourceControlChangeType.Untracked:return"U";case R.vsls.SourceControlChangeType.Ignored:return"I";case R.vsls.SourceControlChangeType.DeleteByThem:case R.vsls.SourceControlChangeType.DeleteByUs:return"D";case R.vsls.SourceControlChangeType.IndexCopy:case R.vsls.SourceControlChangeType.DeleteBoth:case R.vsls.SourceControlChangeType.AddByUs:case R.vsls.SourceControlChangeType.AddByThem:case R.vsls.SourceControlChangeType.AddBoth:case R.vsls.SourceControlChangeType.Conflict:return"C";default:return}}get color(){switch(this.changeType){case R.vsls.SourceControlChangeType.IndexEdit:case R.vsls.SourceControlChangeType.Edit:return new w.ThemeColor("gitDecoration.modifiedResourceForeground");case R.vsls.SourceControlChangeType.IndexDelete:case R.vsls.SourceControlChangeType.Delete:return new w.ThemeColor("gitDecoration.deletedResourceForeground");case R.vsls.SourceControlChangeType.Add:return new w.ThemeColor("gitDecoration.addedResourceForeground");case R.vsls.SourceControlChangeType.Rename:case R.vsls.SourceControlChangeType.Untracked:return new w.ThemeColor("gitDecoration.untrackedResourceForeground");case R.vsls.SourceControlChangeType.Ignored:return new w.ThemeColor("gitDecoration.ignoredResourceForeground");case R.vsls.SourceControlChangeType.IndexCopy:case R.vsls.SourceControlChangeType.DeleteBoth:case R.vsls.SourceControlChangeType.AddByUs:case R.vsls.SourceControlChangeType.DeleteByThem:case R.vsls.SourceControlChangeType.AddByThem:case R.vsls.SourceControlChangeType.DeleteByUs:case R.vsls.SourceControlChangeType.AddBoth:case R.vsls.SourceControlChangeType.Conflict:return new w.ThemeColor("gitDecoration.conflictingResourceForeground");default:return}}get strikeThrough(){switch(this.changeType){case R.vsls.SourceControlChangeType.Delete:case R.vsls.SourceControlChangeType.DeleteBoth:case R.vsls.SourceControlChangeType.DeleteByThem:case R.vsls.SourceControlChangeType.DeleteByUs:case R.vsls.SourceControlChangeType.IndexDelete:return!0;default:return!1}}}m.guestSourceControlManagerFactory=(h,m)=>{const{controllerDecorator:y,errorNotificationMethodDecorator:M,telemetryMethodDecorator:N}=h.methodDecorators();let D=class GuestSourceControlManager{constructor(h){this.service=h,this.sccRegistrations=[],this.disposables=[],this.isActive=!1}init(){return T(this,void 0,void 0,(function*(){this.isActive||(this.isActive=!0,this.disposables.push(w.workspace.registerTextDocumentContentProvider("vsls-scc",this)),k.ControllerHelper.register(this,this.disposables),yield this.addSourceControls(),this.isActive&&this.service.onSourceControlChanged(this.sourceControlChanged,this,this.disposables))}))}dispose(){return T(this,void 0,void 0,(function*(){this.isActive&&(this.isActive=!1,this.disposeSourceControls(),this.disposables.forEach(h=>h.dispose()),this.disposables=[])}))}provideTextDocumentContent(h,m){return T(this,void 0,void 0,(function*(){const y=SccRegistration.getResourceIdentity(h);return y?yield this.service.getResourceAsync(y,m):""}))}sourceControlChanged(h){if(!h||!this.isActive)return;const m=h.sourceControl;if(!m)return;const y=m.sourceControlId,v=m.instanceId;if(v)switch(h.change){case R.vsls.SourceControlChange.Added:this.addSourceControls(y,v);break;case R.vsls.SourceControlChange.Removed:this.disposeSourceControls(y,v);break;case R.vsls.SourceControlChange.Updated:this.updateSourceControl(y,v)}else this.disposeSourceControls(y),h.change!==R.vsls.SourceControlChange.Removed&&this.addSourceControls(y)}disposeSourceControls(h,m){if(h){for(let y=this.sccRegistrations.length-1;y>=0;y++)if(this.sccRegistrations[y].sourceControlId===h&&(!m||this.sccRegistrations[y].instanceId===m)){const[h]=this.sccRegistrations.splice(y,1);h.dispose()}}else this.sccRegistrations.forEach(h=>h.dispose()),this.sccRegistrations=[];this.updateSourceControlCountContext(this.sccRegistrations.length)}addSourceControls(h,m){return T(this,void 0,void 0,(function*(){try{const y=h?m?[yield this.service.getSourceControlAsync({sourceControlId:h,instanceId:m})]:yield this.service.getSourceControlsAsync(h):yield this.service.getAllSourceControlsAsync();if(!this.isActive)return;y.forEach(h=>this.sccRegistrations.push(new SccRegistration(h))),this.updateSourceControlCountContext(this.sccRegistrations.length)}catch(h){}}))}updateSourceControl(h,m){return T(this,void 0,void 0,(function*(){const y=this.sccRegistrations.find(y=>y.sourceControlId===h&&y.instanceId===m);if(y)try{const v=yield this.service.getSourceControlAsync({sourceControlId:h,instanceId:m});if(!this.isActive)return;v?y.update(v):this.disposeSourceControls(h,m)}catch(y){this.isActive||this.disposeSourceControls(h,m)}else yield this.addSourceControls(h,m)}))}openFile(h,...m){return T(this,void 0,void 0,(function*(){const y=h instanceof SccResourceState;let v;if(h)if(h instanceof P.Uri)switch(h.scheme){case k.VSLS_SCHEME:v=[h];break;case"vsls-scc":const m=JSON.parse(h.query);m.resourceUri&&(v=[P.Uri.parse(m.resourceUri)])}else{const y=h;if(!(y instanceof SccResourceState))return;y&&(v=[y,...m].filter(h=>h.changeType!==R.vsls.SourceControlChangeType.Delete&&h.changeType!==R.vsls.SourceControlChangeType.IndexDelete).map(h=>h.resourceUri))}else v=this.getSccResources().map(h=>h.resourceUri);if(!v||!v.length)return;const C=w.window.activeTextEditor;for(const h of v){const m={preserveFocus:y,preview:!1,viewColumn:w.ViewColumn.Active},v=yield w.workspace.openTextDocument(h);if(C&&C.document.uri.toString()===h.toString()){m.selection=C.selection;const h=C.visibleRanges;(yield w.window.showTextDocument(v,m)).revealRange(h[0])}else yield w.window.showTextDocument(v,m)}}))}openChanges(h,...m){return T(this,void 0,void 0,(function*(){const y=h instanceof SccResourceState,v=h instanceof P.Uri||!h;let C=[];h?h instanceof P.Uri?C=this.getSccResources(h):h instanceof SccResourceState&&(C=[...m,h]):C=this.getSccResources(),C=C.filter(h=>h.supportsOpenChanges);const T=1===C.length&&void 0;for(const h of C)yield this.openChange(h,T,y,v)}))}openChange(h,m,y,v){return T(this,void 0,void 0,(function*(){if(!h)return;const C=yield this.service.getDiffForResourceAsync(h.ResourceIdentity);if(!C)return;const T=h.getUri({resource:C.right}),A=h.getUri({resource:C.left}),P={preserveFocus:y,preview:m,viewColumn:w.ViewColumn.Active},k=w.window.activeTextEditor,R=T||A;v&&k&&k.document.uri.toString()===R.toString()&&(P.selection=k.selection),A&&T?yield w.commands.executeCommand("vscode.diff",A,T,C.title,P):yield w.commands.executeCommand("vscode.open",R,P,C.title)}))}updateSourceControlCountContext(h){w.commands.executeCommand("setContext","vslsSccOpenRepositoryCount",`${h}`)}clean(...h){return T(this,void 0,void 0,(function*(){if(!(h=h.filter(h=>!!h&&h.supportsClean)).length||!this.isActive)return;const m=h.reduce((h,m)=>h+(m.changeType===R.vsls.SourceControlChangeType.Untracked?1:0),0);let y,v="Discard Changes";1===h.length?m>0?(y=`Are you sure you want to DELETE ${A.basename(h[0].resourceUri.fsPath)}?`,v="Delete file"):h[0].changeType===R.vsls.SourceControlChangeType.Delete?(v="Restore file",y=`Are you sure you want to restore ${A.basename(h[0].resourceUri.fsPath)}?`):y=`Are you sure you want to discard changes in ${A.basename(h[0].resourceUri.fsPath)}?`:(h.every(h=>h.changeType===R.vsls.SourceControlChangeType.Delete)?(v="Restore files",y=`Are you sure you want to restore ${h.length} files?`):y=`Are you sure you want to discard changes in ${h.length} files?`,m>0&&(y=`${y}\n\nThis will DELETE ${m} untracked files!`)),(yield w.window.showWarningMessage(y,{modal:!0},v))===v&&(yield this.service.cleanResourcesAsync(h.map(h=>h.ResourceIdentity)))}))}cleanAll(h){return T(this,void 0,void 0,(function*(){h&&h.resourceStates&&(yield this.clean(...h.resourceStates))}))}getSccResources(h){return[].concat(...this.sccRegistrations.map(m=>m.getSccResources(h)))}revertChange(h,m,y){return T(this,void 0,void 0,(function*(){if(!h)return;const v=w.window.visibleTextEditors.find(m=>m.document.uri.toString()===h.toString());if(!v)return;const C=m[y],T=0===C.originalEndLineNumber,A=0===C.modifiedEndLineNumber;let P=void 0;if(!T){const m=SccRegistration.getResourceIdentity(h);if(!m||m.type!==R.vsls.SourceControlResourceType.Workspace)return;m.type=R.vsls.SourceControlResourceType.WorkspaceWithSpecificVersion;const y={resource:m},v=1===this.sccRegistrations.length?this.sccRegistrations[0].getUri(y):getUri(y);if(!v)return;P=(yield w.workspace.openTextDocument(v)).getText(new w.Range(C.originalStartLineNumber-1,0,C.originalEndLineNumber,0))}const k=v.selections,M=v.visibleRanges,N=!A&&new w.Range(C.modifiedStartLineNumber-1,0,C.modifiedEndLineNumber,0),D=new w.WorkspaceEdit;T?D.delete(h,N):A?D.insert(h,new w.Position(C.modifiedStartLineNumber,0),P):D.replace(h,N,P),w.workspace.applyEdit(D),yield v.document.save(),v.selections=k,v.revealRange(M[0])}))}};return v([M("Opening source-controlled resource",k.TelemetryEventNames.OPEN_SCC_RESOURCE_FAULT),N(k.TelemetryEventNames.OPEN_SCC_RESOURCE,k.TelemetryEventNames.OPEN_SCC_RESOURCE_FAULT,"GuestSourceControlManager.openFile"),k.commandBindingDecorator("liveshare.scc.openFile"),k.commandBindingDecorator("liveshare.scc.openFile2"),C("design:type",Function),C("design:paramtypes",[Object,SccResourceState]),C("design:returntype",Promise)],D.prototype,"openFile",null),v([M("Opening source-controlled changes",k.TelemetryEventNames.OPEN_SCC_CHANGE_FAULT),N(k.TelemetryEventNames.OPEN_SCC_CHANGE,k.TelemetryEventNames.OPEN_SCC_CHANGE_FAULT,"GuestSourceControlManager.openChanges"),k.commandBindingDecorator("liveshare.scc.openChange"),C("design:type",Function),C("design:paramtypes",[Object,SccResourceState]),C("design:returntype",Promise)],D.prototype,"openChanges",null),v([M("Discarding source-controlled changes",k.TelemetryEventNames.DISCARD_SCC_CHANGE_FAULT),N(k.TelemetryEventNames.DISCARD_SCC_CHANGE,k.TelemetryEventNames.DISCARD_SCC_CHANGE_FAULT,"GuestSourceControlManager.clean"),k.commandBindingDecorator("liveshare.scc.clean"),C("design:type",Function),C("design:paramtypes",[SccResourceState]),C("design:returntype",Promise)],D.prototype,"clean",null),v([M("Discarding all source-controlled changes",k.TelemetryEventNames.DISCARD_ALL_SCC_CHANGES_FAULT),N(k.TelemetryEventNames.DISCARD_ALL_SCC_CHANGES,k.TelemetryEventNames.DISCARD_ALL_SCC_CHANGES_FAULT,"GuestSourceControlManager.cleanAll"),k.commandBindingDecorator("liveshare.scc.cleanAll"),C("design:type",Function),C("design:paramtypes",[Object]),C("design:returntype",Promise)],D.prototype,"cleanAll",null),v([M("Revert change",k.TelemetryEventNames.REVERT_SCC_CHANGE_FAULT),N(k.TelemetryEventNames.REVERT_SCC_CHANGE,k.TelemetryEventNames.REVERT_SCC_CHANGE_FAULT,"GuestSourceControlManager.revertChange"),k.commandBindingDecorator("liveshare.scc.revertChange"),C("design:type",Function),C("design:paramtypes",[P.Uri,Array,Number]),C("design:returntype",Promise)],D.prototype,"revertChange",null),D=v([y,C("design:paramtypes",[Object])],D),new D(m.sourceControlService())}},function(h,m,y){"use strict";var v=this&&this.__awaiter||function(h,m,y,v){return new(y||(y=Promise))((function(C,T){function fulfilled(h){try{step(v.next(h))}catch(h){T(h)}}function rejected(h){try{step(v.throw(h))}catch(h){T(h)}}function step(h){h.done?C(h.value):function adopt(h){return h instanceof y?h:new y((function(m){m(h)}))}(h.value).then(fulfilled,rejected)}step((v=v.apply(h,m||[])).next())}))};Object.defineProperty(m,"__esModule",{value:!0});const C=y(0),T=y(585),w=y(5),A=y(3),P=y(4),k=y(1453),R=y(2);class WorkspaceTaskClient extends(w.Inittable(w.Disposable(Object))){constructor(h,m,y){super(),this.streamFactory=y,this.subscriptions=[],this.deferredInit=Promise.resolve(),this.taskCache={},this.hostTaskExecutions=[],this.pendingTaskMonitors=[],this.taskOutputCache={},this.accessControlManager=m,this.workspaceTaskService=h.rpcFactory(P.vsls.WorkspaceTaskService,P.vsls.TraceSources.ClientRpc),this.taskOutputService=h.rpcFactory(P.vsls.TaskOutputService,P.vsls.TraceSources.ClientRpc),this.trace=w.traceSource.withName("WorkspaceTaskClient"),this.sessionContext=h.sessionContext()}init(){const h=Object.create(null,{init:{get:()=>super.init}});return v(this,void 0,void 0,(function*(){yield h.init.call(this),this.subscriptions.push(C.tasks.onDidStartTask(h=>v(this,void 0,void 0,(function*(){return this.handleWorkspaceTaskStarted(h.execution)}))),C.tasks.onDidEndTask(h=>this.handleWorkspaceTaskEnded(h.execution)),C.tasks.onDidEndTaskProcess(h=>this.handleWorkspaceTaskProcessEnded(h.execution,h.exitCode)),this.workspaceTaskService.onTaskStarted(h=>this.handleHostTaskStarted(h.task,h.taskExecution)),this.workspaceTaskService.onTaskTerminated(h=>this.handleHostTaskTerminated(h.taskExecution)),this.accessControlManager.onDidRejectOperation(h=>v(this,void 0,void 0,(function*(){if(h.operation.name===A.WellKnownRestrictedOperations.RunTask){const m=h.operation;if(h.isReadOnlySession)return;h.isCurrentUserAnonymous?yield this.requestTaskRunPermissionAnonymous(m):yield this.requestTaskRunPermission(m)}}))),this.accessControlManager.onDidChangeOperationAccess(h=>v(this,void 0,void 0,(function*(){if(h.operation.name===A.WellKnownRestrictedOperations.RunTask){const m=h.operation;yield this.handleTaskRunPermissionChange(m,h.access)}})))),this.deferredInit=this.deferredInit.then(()=>this.initializeContext()).catch(()=>{})}))}initializeContext(){return v(this,void 0,void 0,(function*(){this.taskManagerContext=T.configure(()=>this.workspaceTaskService.getSupportedTasksAsync().catch(h=>[]),()=>this.pendingTaskMonitors),this.taskOutputService.onTaskOutputShared(h=>this.createTaskOutput(h.taskOutput));const h=yield this.taskOutputService.getTaskOutputsAsync();for(const m of h)yield this.createTaskOutput(m);const[m,y]=yield Promise.all([this.workspaceTaskService.getSupportedTasksAsync(),this.workspaceTaskService.getTaskExecutionsAsync()]);this.hostTaskExecutions.push(...y);for(const h of m){this.taskCache[h.uniqueId]={taskOnHost:h};const m=y.filter(m=>m.taskUid===h.uniqueId)[0];m&&(yield this.startMonitorTask(h,m))}}))}dispose(){const h=Object.create(null,{dispose:{get:()=>super.dispose}});return v(this,void 0,void 0,(function*(){yield this.deferredInit,this.subscriptions.forEach(h=>h.dispose()),this.taskManagerContext&&this.taskManagerContext.dispose(),Object.keys(this.taskOutputCache).map(h=>this.taskOutputCache[h]).forEach(h=>h.dispose()),yield h.dispose.call(this)}))}requestTaskRunPermission(h){return v(this,void 0,void 0,(function*(){"Request permission"===(yield w.NotificationUtil.showErrorMessage("The host doesn't allow guests to run tasks.",{modal:!1},{title:"Request permission"})).title&&(this.isAwaitingTaskRunPermission=!0,yield this.accessControlManager.requestOperationAccess({name:A.WellKnownRestrictedOperations.RunTask,sessionId:this.sessionContext.coeditingClient.clientID}))}))}requestTaskRunPermissionAnonymous(h){return v(this,void 0,void 0,(function*(){this.isUserAskedToSignIn||(this.isUserAskedToSignIn=!0,yield A.askToSignInAndReload("Cannot run tasks in read-only mode (anonymous). Sign in to proceed."),this.isUserAskedToSignIn=!1)}))}handleTaskRunPermissionChange(h,m){return v(this,void 0,void 0,(function*(){if(this.isAwaitingTaskRunPermission&&m===P.vsls.RestrictedOperationAccess.Allowed){const h="Run task";(yield w.NotificationUtil.showInformationMessage("The host has allowed guests to run tasks.",!1,{modal:!1},{title:h})).title===h&&(yield C.commands.executeCommand("workbench.action.tasks.runTask"))}}))}createTaskOutput(h){return v(this,void 0,void 0,(function*(){switch(h.options.contentType){case P.vsls.TaskOutputContentType.TextWithAnsiEscapeCodes:yield this.createTaskTerminal(h);break;case P.vsls.TaskOutputContentType.PlainText:yield this.createOutputChannel(h)}}))}handleWorkspaceTaskStarted(h){return v(this,void 0,void 0,(function*(){const m=WorkspaceTaskClient.getTaskDefinition(h.task),y=m?this.taskCache[m.taskUid]:void 0;if(y)if(this.trace.verbose(`local task started taskUid:${m.taskUid} executionId:${m.executionId}`),m.executionId)y.monitorTaskExecution=h,y.hostTaskExecution={taskUid:m.taskUid,id:m.executionId};else{y.monitorTaskExecution=h,y.hostTaskExecution=void 0,this.trace.verbose(`Running remote uniqueId:${y.taskOnHost.uniqueId}`),(yield this.workspaceTaskService.runTaskAsync(y.taskOnHost.uniqueId)).status===P.vsls.RunTaskStatus.RejectedByHost&&(yield C.window.showInformationMessage("Operation was rejected by host."),h.terminate())}}))}handleWorkspaceTaskEnded(h){const m=WorkspaceTaskClient.getTaskDefinition(h.task),y=m?this.taskCache[m.taskUid]:void 0;if(y&&(this.trace.verbose(`local task ended taskUid:${m.taskUid} executionId:${m.executionId}`),y.monitorTaskExecution===h)){y.monitorTaskExecution=void 0,y.hostTaskExecution=void 0;const h=this.hostTaskExecutions.filter(h=>h.taskUid===m.taskUid)[0];h&&h.id!==m.executionId&&R.defer(()=>v(this,void 0,void 0,(function*(){yield this.startMonitorTask(y.taskOnHost,h)})))}}handleWorkspaceTaskProcessEnded(h,m){return v(this,void 0,void 0,(function*(){const y=WorkspaceTaskClient.getTaskDefinition(h.task),v=y?this.taskCache[y.taskUid]:void 0;v&&(this.trace.verbose(`local task process ended taskUid:${y.taskUid} exitCode:${m}`),v.monitorTaskExecution===h&&v.hostTaskExecution&&(!this.hostTaskExecutions.some(h=>h.id===v.hostTaskExecution.id)||y.executionId&&0!==m||(yield this.workspaceTaskService.terminateTaskAsync(v.hostTaskExecution))))}))}handleHostTaskStarted(h,m){return v(this,void 0,void 0,(function*(){this.trace.verbose(`host task started uniqueId:${h.uniqueId} taskExecution:${JSON.stringify(m)}`),this.hostTaskExecutions.push(m);let y=this.getWorkspaceTaskInfo(h);y.monitorTaskExecution?y.hostTaskExecution||(y.hostTaskExecution=m):y.monitorTaskExecution=yield this.startMonitorTask(h,m)}))}handleHostTaskTerminated(h){this.trace.verbose(`host task terminated execution:${JSON.stringify(h)}`);const m=this.hostTaskExecutions.findIndex(m=>m.id===h.id);-1!==m&&this.hostTaskExecutions.splice(m,1);const y=this.taskCache[h.taskUid];y&&y.monitorTaskExecution&&y.monitorTaskExecution.terminate()}startMonitorTask(h,m){return v(this,void 0,void 0,(function*(){this.pendingTaskMonitors.push([h,m]);try{const m=yield C.tasks.fetchTasks({type:T.liveShareTaskType});for(const y of m.filter(m=>WorkspaceTaskClient.getTaskUid(m)===h.uniqueId))return yield C.tasks.executeTask(y)}finally{this.pendingTaskMonitors.pop()}}))}createTaskTerminal(h){return v(this,void 0,void 0,(function*(){if(this.taskOutputCache[h.id])return void this.taskOutputCache[h.id].terminal.show();this.trace.verbose(`creating task terminal info:${JSON.stringify(h)}`);const m=yield this.streamFactory(h.feed.streamMoniker),y=new k.StreamChannelTerminal(this.trace.createChild(`stream-channel:${h.id}`),m,!0),v={name:h.name,pty:y},T=C.window.createTerminal(v);T.show();const w=[this.taskOutputService.onTaskOutputClosed(m=>{m.taskOutput.id===h.id&&(disposeTaskOutput(),T.dispose())}),C.window.onDidCloseTerminal(h=>{h===T&&disposeTaskOutput()})],disposeTaskOutput=()=>{this.trace.verbose(`dispose task terminal info:${JSON.stringify(h)}`),m.dispose(),delete this.taskOutputCache[h.id],w.forEach(h=>h.dispose())};this.taskOutputCache[h.id]={taskOutput:h,terminal:T,dispose:()=>{disposeTaskOutput(),T.dispose()}}}))}createOutputChannel(h){return v(this,void 0,void 0,(function*(){if(this.taskOutputCache[h.id])return void this.taskOutputCache[h.id].outputChannel.show();this.trace.verbose(`create output channel info:${JSON.stringify(h)}`);const m=`${h.name} ${A.sharedTerminalName}`,y=C.window.createOutputChannel(m);y.show(!0);const T=yield this.streamFactory(h.feed.streamMoniker);T.onDataReceived(h=>{const m=h.toString();y.append(m)});const w=this.taskOutputService.onTaskOutputClosed(m=>{m.taskOutput.id===h.id&&(disposeTaskOutput(),y.dispose())}),disposeTaskOutput=()=>{this.trace.verbose(`dispose output channel info:${JSON.stringify(h)}`),delete this.taskOutputCache[h.id],T.dispose(),w.dispose()};this.taskOutputCache[h.id]={taskOutput:h,outputChannel:y,dispose:()=>v(this,void 0,void 0,(function*(){yield disposeTaskOutput(),y.dispose()}))}}))}getWorkspaceTaskInfo(h){const m=h.uniqueId;let y=this.taskCache[m];return y||(this.taskCache[m]={taskOnHost:h},y=this.taskCache[m]),y}static getTaskDefinition(h){if(h.definition.type===T.liveShareTaskType)return h.definition}static getTaskUid(h){if(h.definition.type===T.liveShareTaskType){return h.definition.taskUid}}}m.default=WorkspaceTaskClient},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0});const v=y(0),C=y(2);m.StreamChannelTerminal=class StreamChannelTerminal{constructor(h,m,y){this.logger=h,this.onDidWriteEmitter=new v.EventEmitter,this.initBuffers=[],this.onDidWrite=this.onDidWriteEmitter.event,m&&this.attach(m,y)}attach(h,m){this.streamChannel=h,this.isReadonly=m,this.disposable=h.onDataReceived(h=>{this.logger.verbose(`<- received length:${h.length} crc:${C.crc32(h)}`),this.fireDidWrite(h)})}open(h){this.isOpened=!0,this.initBuffers.forEach(h=>this.fireDidWrite(h)),this.initBuffers.length=0}close(){this.disposable&&this.disposable.dispose()}handleInput(h){if(this.isReadonly)return;const m=Buffer.from(h);this.logger.verbose(`-> send length:${m.length} crc:${C.crc32(m)}`),this.streamChannel.send(m).catch(h=>{this.logger.error("Failed to send stream channel data",h)})}fireDidWrite(h){if(this.isOpened){const m=h.toString(),y=Buffer.from(m.substr(1),"base64").toString("utf-8");this.onDidWriteEmitter.fire(y)}else this.initBuffers.push(h)}}},function(h,m,y){"use strict";var v=this&&this.__awaiter||function(h,m,y,v){return new(y||(y=Promise))((function(C,T){function fulfilled(h){try{step(v.next(h))}catch(h){T(h)}}function rejected(h){try{step(v.throw(h))}catch(h){T(h)}}function step(h){h.done?C(h.value):function adopt(h){return h instanceof y?h:new y((function(m){m(h)}))}(h.value).then(fulfilled,rejected)}step((v=v.apply(h,m||[])).next())}))};Object.defineProperty(m,"__esModule",{value:!0});const C=y(0),T=y(6),w=y(0),A=y(6),P=y(16),k=y(5),R=y(15),M=y(1455),N=y(1456),D=y(8),I=y(3),x=y(4);class WorkspaceTaskService extends(k.Inittable(k.Disposable(Object))){constructor(h){super(),this.taskOutputCache={},this.subscriptions=[],this.taskExecutions=[],this.completedExecutions=[],this.currentTasks=[],this.deferredInit=Promise.resolve(),this.dataProcessQueue=Promise.resolve(),this.rpcClient=h.rpcClient(),this.workspaceService=h.workspaceService(),this.clientAccessCheck=h.accessControlManager,this.workspaceAccessControlService=h.workspaceAccessControlService,this.taskOutputService=P.RpcProxy.create(x.vsls.TaskOutputService,this.rpcClient,k.traceSource.withName(x.vsls.TraceSources.ClientRpc)),this.streamManagerService=P.RpcProxy.create(x.vsls.StreamManagerService,this.rpcClient,k.traceSource.withName(x.vsls.TraceSources.ClientRpc)),this.streamService=P.RpcProxy.create(x.vsls.StreamService,this.rpcClient,k.traceSource.withName(x.vsls.TraceSources.ClientRpc)),this.trace=k.traceSource.withName("WorkspaceTaskService"),this.sessionContext=h.sessionContext(),WorkspaceTaskService.sessionTaskControlAllowed=!1}static get guestTaskControlAllowed(){return WorkspaceTaskService.sessionTaskControlAllowed||I.Settings.get(I.SettingKeys.allowGuestTaskControl)}init(){const h=Object.create(null,{init:{get:()=>super.init}});return v(this,void 0,void 0,(function*(){yield h.init.call(this),this.subscriptions.push(w.tasks.onDidStartTask(h=>this.handleTaskStarted(h.execution)),w.tasks.onDidEndTask(h=>this.handleTaskEnded(h.execution)),this.workspaceAccessControlService().onOpeationAccessRequested(h=>v(this,void 0,void 0,(function*(){h.operation.name===I.WellKnownRestrictedOperations.RunTask&&(yield this.grantRunTaskPermission(h.operation,h.sessionId))})))),this.subscriptions.push(C.window.onDidOpenTerminal(h=>this.createTaskOutputIfTaskTerminal(h))),this.deferredInit=this.deferredInit.then(()=>this.initializeContext()).catch(()=>{})}))}refreshTasks(){return v(this,void 0,void 0,(function*(){this.currentTasks=yield w.tasks.fetchTasks()}))}createTaskOutputIfTaskTerminal(h){if(I.isTaskTerminal(this.currentTasks,h)){const m=function createTerminalTask(h){const m=h.creationOptions.name,y=new T.Emitter,v=new T.Emitter,w=[];return C.window.onDidWriteTerminalData(m=>{m.terminal===h&&y.fire(m.data)},null,w),C.window.onDidCloseTerminal(m=>{m===h&&v.fire()},null,w),{name:m,onData:y.event,onClosed:v.event,dispose(){w.forEach(h=>h.dispose())}}}(h);this.createTaskOutput(m).then(()=>{},h=>{this.trace.error("failed to create task output",h)})}}initializeContext(){return v(this,void 0,void 0,(function*(){this.rpcClient.addRequestMethod("workspaceTask.getSupportedTasks",()=>this.getSupportedTasks()),this.rpcClient.addRequestMethod("workspaceTask.getTaskExecutions",()=>this.getTaskExecutions()),this.rpcClient.addRequestMethodWithContext("workspaceTask.runTask",(h,m)=>this.runTask(h,m)),this.rpcClient.addRequestMethod("workspaceTask.terminateTask",(h,m)=>this.terminateTask(h,m)),yield this.workspaceService.registerServicesAsync(["workspaceTask"],x.vsls.CollectionChangeType.Add),yield this.refreshTasks();for(const h of C.window.terminals)this.createTaskOutputIfTaskTerminal(h)}))}dispose(){const h=Object.create(null,{dispose:{get:()=>super.dispose}});return v(this,void 0,void 0,(function*(){yield this.deferredInit,this.subscriptions.forEach(h=>h.dispose()),Object.keys(this.taskOutputCache).map(h=>this.taskOutputCache[h]).forEach(h=>h.dispose()),yield this.workspaceService.registerServicesAsync(["workspaceTask"],x.vsls.CollectionChangeType.Remove),this.rpcClient.removeRequestMethod("workspaceTask.getSupportedTasks"),this.rpcClient.removeRequestMethod("workspaceTask.getTaskExecutions"),this.rpcClient.removeRequestMethod("workspaceTask.runTask"),this.rpcClient.removeRequestMethod("workspaceTask.terminateTask");const m=this.completedExecutions.reduce((h,m)=>Object.assign(Object.assign({},h),{[m[0]]:[...h[m[0]]||[],m[1]]}),{});Object.keys(m).forEach(h=>{M.WorkspaceTaskTelemetry.sendExecutionSummary(h,m[h])}),yield h.dispose.call(this)}))}grantRunTaskPermission(h,m){return v(this,void 0,void 0,(function*(){try{const y=this.sessionContext.collaboratorManager.getCollaborators()[m.toString(10)];if(!y)return;const v="Allow all guests to run tasks",T="Always allow",w="Deny",A=yield C.window.showInformationMessage(`${y.name} requested permission to run tasks.`,{modal:!1},v,T,w);A===v?WorkspaceTaskService.sessionTaskControlAllowed=!0:A===T&&(yield I.Settings.save(I.SettingKeys.allowGuestTaskControl,!0)),A!==v&&A!==T||(yield this.workspaceAccessControlService().setOperationAccessAsync(h,x.vsls.RestrictedOperationAccess.Allowed))}catch(m){const y=`Requesting access for '${h?h.name:"null"}' operation failed: ${m.message}`;this.trace.error(y),D.Telemetry.sendFault(I.TelemetryEventNames.REQUEST_OPERATION_ACCESS_FAULT,D.FaultType.NonBlockingFault,y,m)}}))}createTaskOutput(h){return v(this,void 0,void 0,(function*(){this.trace.verbose(`create task output for terminal:[${h.name}]`);const m=yield this.taskOutputService.shareTaskOutputAsync(h.name,{contentType:x.vsls.TaskOutputContentType.TextWithAnsiEscapeCodes}),y=m.feed.streamMoniker,C=yield this.streamManagerService.getStreamAsync(y.name,y.condition),processData=h=>v(this,void 0,void 0,(function*(){const m=Buffer.from(h).toString("base64");yield this.streamService.writeBytesAsync(C,"x"+m)}));h.onData(m=>{this.trace.verbose(`-> send terminal:[${h.name}] data. length:${m.length}`),this.dataProcessQueue=this.dataProcessQueue.then(()=>processData(m)).catch(h=>{this.trace.error("Rejected promise while processing terminal data")})}),h.onClosed(()=>v(this,void 0,void 0,(function*(){yield disposeTaskOutput()})));const disposeTaskOutput=()=>v(this,void 0,void 0,(function*(){this.trace.verbose(`dispose task output for terminal:[${h.name}]`),delete this.taskOutputCache[h.name],h.dispose(),yield this.streamService.disposeStreamAsync(C),yield this.taskOutputService.closeTaskOutputAsync(m.id)}));this.taskOutputCache[h.name]={taskOutput:m,streamId:C,dispose:disposeTaskOutput}}))}getSupportedTasks(){return v(this,void 0,void 0,(function*(){try{return(yield w.tasks.fetchTasks()).map(WorkspaceTaskService.getWorkspaceTask)}catch(h){return N.RemoteServiceTelemetry.sendServiceFault(WorkspaceTaskService.SERVICE_NAME,"getSupportedTasks",h),new A.ResponseError(A.ErrorCodes.UnknownErrorCode,h.message,R.errorToString(h))}}))}getTaskExecutions(){try{return Promise.resolve(this.taskExecutions.map(h=>h[0]))}catch(h){return N.RemoteServiceTelemetry.sendServiceFault(WorkspaceTaskService.SERVICE_NAME,"getTaskExecutions",h),new A.ResponseError(A.ErrorCodes.UnknownErrorCode,h.message,R.errorToString(h))}}runTask(h,m){return v(this,void 0,void 0,(function*(){let y={status:x.vsls.RunTaskStatus.TaskNotFound};try{const v=(yield w.tasks.fetchTasks()).filter(m=>m.name===h||WorkspaceTaskService.getTaskUid(m)===h)[0];if(v){if(!(yield this.clientAccessCheck().canPerformOperation(m,WorkspaceTaskService.runTaskOperation))){const y=yield this.clientAccessCheck().isClientReadOnly(m),v=this.clientAccessCheck().getContextSessionId(m),C={name:I.WellKnownRestrictedOperations.RunTask,sessionId:v?parseInt(v,10):void 0,taskUid:h};return yield this.clientAccessCheck().logRejectedOperation(C,y?x.vsls.RestrictedOperationAccess.RejectedInReadOnlySession:x.vsls.RestrictedOperationAccess.DisabledByHostConfiguration),this.trace.verbose(`run task id:${h} reject by host`),{status:x.vsls.RunTaskStatus.RejectedByHost}}this.trace.verbose(`execute task id:${h}`);const C=yield w.tasks.executeTask(v),T=WorkspaceTaskService.createMoniker(C);this.taskExecutions.push([T,{execution:C,startTime:Date.now()}]),y={status:x.vsls.RunTaskStatus.Started,taskExecution:T}}else this.trace.info(`task to run id:${h} not found`)}catch(m){return this.trace.error(`Failed to run task id:${h}`,m),N.RemoteServiceTelemetry.sendServiceFault(WorkspaceTaskService.SERVICE_NAME,"runTask",m),new A.ResponseError(A.ErrorCodes.UnknownErrorCode,m.message,R.errorToString(m))}return y}))}terminateTask(h,m){return v(this,void 0,void 0,(function*(){try{const y=this.taskExecutions.find(m=>m[0].id===h.id);if(y){if(!(WorkspaceTaskService.guestTaskControlAllowed&&(yield this.clientAccessCheck().canPerformOperation(m,WorkspaceTaskService.terminateTaskOperation))))return{status:x.vsls.RunTaskStatus.RejectedByHost};const h=y[1].execution;yield h.terminate()}}catch(h){return N.RemoteServiceTelemetry.sendServiceFault(WorkspaceTaskService.SERVICE_NAME,"terminateTask",h),new A.ResponseError(A.ErrorCodes.UnknownErrorCode,h.message,R.errorToString(h))}}))}handleTaskStarted(h){return v(this,void 0,void 0,(function*(){const m=this.taskExecutions.find(m=>m[1].execution===h);let y=void 0;m?y=m[0]:(y=WorkspaceTaskService.createMoniker(h),this.taskExecutions.push([y,{execution:h,startTime:Date.now()}])),yield this.rpcClient.sendNotification(this.trace,"workspaceTask.taskStarted",{taskExecution:y,change:x.vsls.TaskExecutionStatusChange.Started,task:WorkspaceTaskService.getWorkspaceTask(h.task)})}))}handleTaskEnded(h){return v(this,void 0,void 0,(function*(){const m=this.taskExecutions.findIndex(m=>m[1].execution===h);if(m>-1){const y=this.taskExecutions[m],v=WorkspaceTaskService.getTaskKind(y[1].execution.task)||"Unknown",C=Date.now()-y[1].startTime;this.completedExecutions.push([v,C]),yield this.rpcClient.sendNotification(this.trace,"workspaceTask.taskTerminated",{taskExecution:y[0],change:x.vsls.TaskExecutionStatusChange.Terminated,task:WorkspaceTaskService.getWorkspaceTask(h.task)}),this.taskExecutions.splice(m,1)}}))}static getTaskUid(h){return`${h.definition.type}:${h.name}`}static getTaskKind(h){switch(h.group){case C.TaskGroup.Build:return"build";case C.TaskGroup.Clean:return"clean";case C.TaskGroup.Rebuild:return"rebuild";case C.TaskGroup.Test:return"test";default:return}}static getWorkspaceTask(h){const m={uniqueId:WorkspaceTaskService.getTaskUid(h),name:h.name,source:h.source,kind:WorkspaceTaskService.getTaskKind(h)};switch(h.scope){case C.TaskScope.Global:m.scope=x.vsls.TaskScope.Global;break;case C.TaskScope.Workspace:m.scope=x.vsls.TaskScope.Workspace;break;default:m.scope=x.vsls.TaskScope.WorkspaceFolder,m.owningWorkspace=h.scope.index.toString()}return m}static createMoniker(h){const m=WorkspaceTaskService.getTaskUid(h.task);return{id:`${m}:${++WorkspaceTaskService.taskExecutionCounter}`,taskUid:m}}}m.WorkspaceTaskService=WorkspaceTaskService,WorkspaceTaskService.SERVICE_NAME="workspaceTask",WorkspaceTaskService.runTaskOperation={name:I.WellKnownRestrictedOperations.RunTask,isEnabled:()=>WorkspaceTaskService.guestTaskControlAllowed||{errorCode:x.vsls.ErrorCodes.OperationRejected,errorMessage:"Remote task execution is not allowed."}},WorkspaceTaskService.terminateTaskOperation={name:I.WellKnownRestrictedOperations.TerminateTask},WorkspaceTaskService.taskExecutionCounter=0},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0});const v=y(8),C=y(3);class WorkspaceTaskTelemetry{static sendExecutionSummary(h,m){let y=new v.TelemetryEvent(EventNames.EXECUTE_SHARED_TASK);y.addProperty(PropertyNames.TASK_KIND,h),y.addMeasure(PropertyNames.TOTAL_COUNT,m.length),y.addMeasure(PropertyNames.MAX_TIME,Math.max(...m)),y.addMeasure(PropertyNames.MIN_TIME,Math.min(...m)),y.addMeasure(PropertyNames.AVERAGE_TIME,m.reduce((h,m)=>h+m,0)/m.length),y.send()}}m.WorkspaceTaskTelemetry=WorkspaceTaskTelemetry,WorkspaceTaskTelemetry.FEATURE_PREFIX="WorkspaceTask/",WorkspaceTaskTelemetry.PROPERTY_PREFIX=C.TelemetryPropertyNames.FEATURE_NAME+"WorkspaceTask.";class EventNames{}EventNames.EXECUTE_SHARED_TASK="execute-task",EventNames.TASK_EXECUTION_ERROR=C.TelemetryEventNames.FAULT_PREFIX+"execute-task-error";class PropertyNames{}PropertyNames.TASK_KIND=C.TelemetryPropertyNames.FEATURE_NAME+"TaskKind",PropertyNames.TOTAL_COUNT=C.TelemetryPropertyNames.FEATURE_NAME+"TotalCount",PropertyNames.MAX_TIME=C.TelemetryPropertyNames.FEATURE_NAME+"MaxTime",PropertyNames.MIN_TIME=C.TelemetryPropertyNames.FEATURE_NAME+"MinTime",PropertyNames.AVERAGE_TIME=C.TelemetryPropertyNames.FEATURE_NAME+"AverageTime"},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0});const v=y(8),C=y(3);class RemoteServiceTelemetry{static sendRequestSummary(h,m,y){let C=new v.TelemetryEvent(EventNames.SERVICE_REQUEST);C.addProperty(PropertyNames.SERVICE_NAME,h),C.addProperty(PropertyNames.METHOD_NAME,m),C.addMeasure(PropertyNames.TOTAL_COUNT,y.length),C.addMeasure(PropertyNames.MAX_TIME,Math.max(...y)),C.addMeasure(PropertyNames.MIN_TIME,Math.min(...y)),C.addMeasure(PropertyNames.AVERAGE_TIME,y.reduce((h,m)=>h+m,0)/y.length),C.send()}static sendServiceFault(h,m,y){v.Telemetry.sendFault(EventNames.HANDLE_REQUEST_ERROR,v.FaultType.Error,`Error processing a service request '${h}.${m}'. ${y.message}`,y)}static sendClientFault(h,m,y){v.Telemetry.sendFault(EventNames.SEND_REQUEST_ERROR,v.FaultType.Error,`Error sending a remote service request '${h}.${m}'. ${y.message}`,y)}}m.RemoteServiceTelemetry=RemoteServiceTelemetry,RemoteServiceTelemetry.FEATURE_PREFIX="RemoteService/",RemoteServiceTelemetry.PROPERTY_PREFIX=C.TelemetryPropertyNames.FEATURE_NAME+"RemoteService.";class EventNames{}EventNames.SERVICE_REQUEST="service-request",EventNames.HANDLE_REQUEST_ERROR=C.TelemetryEventNames.FAULT_PREFIX+"handle-request-error",EventNames.SEND_REQUEST_ERROR=C.TelemetryEventNames.FAULT_PREFIX+"send-request-error";class PropertyNames{}PropertyNames.SERVICE_NAME=C.TelemetryPropertyNames.FEATURE_NAME+"ServiceName",PropertyNames.METHOD_NAME=C.TelemetryPropertyNames.FEATURE_NAME+"MethodName",PropertyNames.TOTAL_COUNT=C.TelemetryPropertyNames.FEATURE_NAME+"TotalCount",PropertyNames.MAX_TIME=C.TelemetryPropertyNames.FEATURE_NAME+"MaxTime",PropertyNames.MIN_TIME=C.TelemetryPropertyNames.FEATURE_NAME+"MinTime",PropertyNames.AVERAGE_TIME=C.TelemetryPropertyNames.FEATURE_NAME+"AverageTime"},function(h,m,y){"use strict";var v=this&&this.__awaiter||function(h,m,y,v){return new(y||(y=Promise))((function(C,T){function fulfilled(h){try{step(v.next(h))}catch(h){T(h)}}function rejected(h){try{step(v.throw(h))}catch(h){T(h)}}function step(h){h.done?C(h.value):function adopt(h){return h instanceof y?h:new y((function(m){m(h)}))}(h.value).then(fulfilled,rejected)}step((v=v.apply(h,m||[])).next())}))};Object.defineProperty(m,"__esModule",{value:!0});const C=y(4),T=y(6),w=y(2);let A=0,P=0,k=0;m.TaskOutputService=class TaskOutputService{constructor(h,m){this.workspaceServer=h,this.logger=m,this.onTaskOutputSharedEmitter=new T.Emitter,this.onTaskOutputFeedUpdatedEmitter=new T.Emitter,this.onTaskOutputClosedEmitter=new T.Emitter,this.taskOutputs=new Map,this.streamName="task_output",this.serviceInfo=C.vsls.TaskOutputService,this.onTaskOutputShared=this.onTaskOutputSharedEmitter.event,this.onTaskOutputFeedUpdated=this.onTaskOutputFeedUpdatedEmitter.event,this.onTaskOutputClosed=this.onTaskOutputClosedEmitter.event}getStream(h,m,y){return v(this,void 0,void 0,(function*(){return Array.from(this.taskOutputs.values()).map(h=>h.feed.tryOpen(m)).find(h=>null!==h)}))}getTaskOutputsAsync(h){return v(this,void 0,void 0,(function*(){return Array.from(this.taskOutputs.values()).map(h=>h.getInfo(!1))}))}shareTaskOutputAsync(h,m,y,C){return v(this,void 0,void 0,(function*(){this.workspaceServer.assertIsHost(C);const y=new TaskOutput(++P,h,m);return this.taskOutputs.set(P,y),this.onTaskOutputSharedEmitter.fire({taskOutput:y.getInfo(!1)}),y.getInfo(!0)}))}updateTaskOutputFeedAsync(h,m){w.notImplemented()}closeTaskOutputAsync(h,m,y){this.workspaceServer.assertIsHost(y);const v=this.taskOutputs.get(h);return v&&(this.taskOutputs.delete(h),this.onTaskOutputClosedEmitter.fire({taskOutput:v.getInfo(!1)}),v.feed.dispose()),Promise.resolve()}};class TaskOutput{constructor(h,m,y){this.id=h,this.name=m,this.options=y,this.feed=new TaskOutputFeed(++k,h)}getInfo(h){return{id:this.id,name:this.name,options:this.options,feed:{id:this.feed.id,streamMoniker:{name:"task_output",condition:h?this.feed.writeStreamMoniker:this.feed.readStreamMoniker}}}}}class TaskOutputFeed{constructor(h,m){this.id=h,this.outputBuffer=new TaskOutputBuffer,this.writeStreamMoniker=`${m}/${h}.master`,this.readStreamMoniker=`${m}/${h}.ro`}dispose(){this.outputBuffer.dispose()}tryOpen(h){return h===this.readStreamMoniker?[`${this.readStreamMoniker}/${++A}`,this.outputBuffer.openForReading()]:h===this.writeStreamMoniker?[`${this.writeStreamMoniker}/${++A}`,this.outputBuffer.openForWriting()]:null}}class TaskOutputBuffer{constructor(){this.onDataReceivedEmitter=new T.Emitter,this.onCloseEmitter=new T.Emitter}dispose(){this.onCloseEmitter.fire(void 0)}openForReading(){return{onDataReceived:this.onDataReceivedEmitter.event,onClosed:this.onCloseEmitter.event,send(h,m){w.notImplemented()},dispose(){},adjustWindow(h){},close:(h,m)=>Promise.resolve(),canWrite:!1}}openForWriting(){const h=this.onDataReceivedEmitter;return{onDataReceived:(new T.Emitter).event,onClosed:this.onCloseEmitter.event,send:(m,y)=>(h.fire(m),Promise.resolve()),dispose(){},adjustWindow(h){},close:(h,m)=>Promise.resolve(),canRead:!1}}}},function(h,m,y){"use strict";var v=this&&this.__awaiter||function(h,m,y,v){return new(y||(y=Promise))((function(C,T){function fulfilled(h){try{step(v.next(h))}catch(h){T(h)}}function rejected(h){try{step(v.throw(h))}catch(h){T(h)}}function step(h){h.done?C(h.value):function adopt(h){return h instanceof y?h:new y((function(m){m(h)}))}(h.value).then(fulfilled,rejected)}step((v=v.apply(h,m||[])).next())}))};Object.defineProperty(m,"__esModule",{value:!0});const C=y(587),T=y(3);m.lspClientActivator=function lspClientActivator(h,m,y){let w=!1;T.SessionContext.onCollaboratorsJoined(()=>v(this,void 0,void 0,(function*(){!w&&[T.SessionState.JoiningInProgress,T.SessionState.Joined].indexOf(T.sessionStateTracker.State)>=0&&(yield C.activateAsync(T.ExtensionUtil.context,m,[...h.registeredServices],y),w=!0)})))}},function(h,m){
/*!
Copyright (C) 2013-2017 by Andrea Giammarchi - @WebReflection

Permission is hereby granted, free of charge, to any person obtaining a copy
of this software and associated documentation files (the "Software"), to deal
in the Software without restriction, including without limitation the rights
to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
copies of the Software, and to permit persons to whom the Software is
furnished to do so, subject to the following conditions:

The above copyright notice and this permission notice shall be included in
all copies or substantial portions of the Software.

THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
THE SOFTWARE.

*/
var y="\\x"+("0"+"~".charCodeAt(0).toString(16)).slice(-2),v="\\"+y,C=new RegExp(y,"g"),T=new RegExp(v,"g"),w=new RegExp("(?:^|([^\\\\]))"+v),A=[].indexOf||function(h){for(var m=this.length;m--&&this[m]!==h;);return m},P=String;function regenerate(h,m,y){return m instanceof Array?function regenerateArray(h,m,y){for(var v=0,C=m.length;v<C;v++)m[v]=regenerate(h,m[v],y);return m}(h,m,y):m instanceof P?m.length?y.hasOwnProperty(m)?y[m]:y[m]=function retrieveFromPath(h,m){for(var y=0,v=m.length;y<v;h=h[m[y++].replace(T,"~")]);return h}(h,m.split("~")):h:m instanceof Object?function regenerateObject(h,m,y){for(var v in m)m.hasOwnProperty(v)&&(m[v]=regenerate(h,m[v],y));return m}(h,m,y):m}var k={stringify:function stringify(h,m,T,w){return k.parser.stringify(h,function generateReplacer(h,m,T){var w,P,k=!1,R=!!m,M=[],N=[h],D=[h],I=[T?"~":"[Circular]"],x=h,O=1;return R&&(P="object"==typeof m?function(h,y){return""!==h&&m.indexOf(h)<0?void 0:y}:m),function(h,m){return R&&(m=P.call(this,h,m)),k?(x!==this&&(w=O-A.call(N,this)-1,O-=w,N.splice(O,N.length),M.splice(O-1,M.length),x=this),"object"==typeof m&&m?(A.call(N,m)<0&&N.push(x=m),O=N.length,(w=A.call(D,m))<0?(w=D.push(m)-1,T?(M.push((""+h).replace(C,y)),I[w]="~"+M.join("~")):I[w]=I[0]):m=I[w]):"string"==typeof m&&T&&(m=m.replace(y,v).replace("~",y))):k=!0,m}}(h,m,!w),T)},parse:function parse(h,m){return k.parser.parse(h,function generateReviver(h){return function(m,C){var T="string"==typeof C;return T&&"~"===C.charAt(0)?new P(C.slice(1)):(""===m&&(C=regenerate(C,C,{})),T&&(C=C.replace(w,"$1~").replace(v,y)),h?h.call(this,m,C):C)}}(m))},parser:JSON};h.exports=k},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0});const v=y(0);m.asLocation=function asLocation(h,m){if(h)return new v.Location(m.asUri(h.uri),m.asRange(h.range))}},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0});const v=y(0),C=y(30),T=y(10);function isNumber(h){return"[object Number]"===Object.prototype.toString.call(h)}m.createConverterExtension=function createConverterExtension(h){function asLocation(m){if(m)return C.Location.create(h.asUri(m.uri),h.asRange(m.range))}function asLocationLink(m){if(m)return C.LocationLink.create(h.asUri(m.targetUri),h.asRange(m.targetRange),h.asRange(m.targetSelectionRange),h.asRange(m.originSelectionRange))}function asDocumentHighlight(m){let y=C.DocumentHighlight.create(h.asRange(m.range));return isNumber(m.kind)&&(y.kind=function asDocumentHighlightKind(h){switch(h){case v.DocumentHighlightKind.Text:return C.DocumentHighlightKind.Text;case v.DocumentHighlightKind.Read:return C.DocumentHighlightKind.Read;case v.DocumentHighlightKind.Write:return C.DocumentHighlightKind.Write;default:return C.DocumentHighlightKind.Text}}(m.kind)),y}function asSignatureInformation(h){let m=C.SignatureInformation.create(h.label);return h.documentation&&(m.documentation="string"==typeof h.documentation?h.documentation:h.documentation.value),h.parameters&&(m.parameters=function asParameterInformations(h){return h.parameters.map(m=>function asParameterInformation(h,m){let y=C.ParameterInformation.create(h.label);h.documentation&&(y.documentation="string"==typeof h.documentation?h.documentation:h.documentation.value);"string"!=typeof h.label&&(y.label=m.substr(h.label[0],h.label[1]-h.label[0]));return y}(m,h.label))}(h)),m}function asWorkspaceEdit(m){if(!m)return;let y={};return m.entries().forEach(m=>{y[h.asUri(m[0])]=m[1].map(m=>h.asTextEdit(m))}),{changes:y}}return{asHover:function asHover(m){return null==m?null:{range:h.asRange(m.range),contents:m.contents.map((h,m)=>function asHoverContent(h,m){return function isMarkdownString(h){return void 0!==h.value}(h)?m?`\n${h.value}`:h.value:T.isString(h)&&m?`\n${h}`:h}(h,m>0))}},asDefinitionResult:function asDefinitionResult(h){if(h)return Array.isArray(h)?h.map(h=>asLocation(h)):asLocation(h)},asDefinitionResultAlternate:function asDefinitionResultAlternate(m){if(m)return Array.isArray(m)?m.map(m=>C.Location.create(h.asUri(m.targetUri),h.asRange(m.targetRange))):void 0},asDefinitionLinkResult:function asDefinitionLinkResult(h){if(h)return h.map(h=>asLocationLink(h))},asLocation:asLocation,asLocationLink:asLocationLink,asReferences:function asReferences(h){if(h)return h.map(h=>asLocation(h))},asDocumentHighlights:function asDocumentHighlights(h){if(h)return h.map(asDocumentHighlight)},asSymbolInformations:function asSymbolInformations(m,y){if(m)return m.map(m=>function asSymbolInformation(m,y){const v=m.location?m.location.range:m.range,T=m.location?m.location.uri:y;let w=C.SymbolInformation.create(m.name,m.kind+1,h.asRange(v),h.asUri(T));m.containerName&&(w.containerName=m.containerName);return w}(m,y))},asSignatureHelp:function asSignatureHelp(h){if(!h)return;let m,y,v=[];return m=isNumber(h.activeSignature)?h.activeSignature:0,y=isNumber(h.activeParameter)?h.activeParameter:0,h.signatures&&(v=function asSignatureInformations(h){return h.map(asSignatureInformation)}(h.signatures)),{activeSignature:m,activeParameter:y,signatures:v}},asWorkspaceEdit:asWorkspaceEdit,asColorInformation:function asColorInformation(m){return{color:m.color,range:h.asRange(m.range)}},asColorPresentation:function asColorPresentation(m){let y={label:m.label,textEdit:h.asTextEdit(m.textEdit)};return m.additionalTextEdits&&(y.additionalTextEdits=m.additionalTextEdits.map(m=>h.asTextEdit(m))),y},asCodeAction:function asCodeAction(m){let y,v=m.kind?m.kind.value:void 0,T=m.command;if(m.edit)y=C.CodeAction.create(m.title,asWorkspaceEdit(m.edit),v),T&&(y.command=T);else{if(!T)throw new Error("Invalid CodeAction - neither command nor edit.");y=C.CodeAction.create(m.title,T,v)}return m.diagnostics&&(y.diagnostics=h.asDiagnostics(m.diagnostics)),y}}}},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0});const v=y(7),C=y(1463),T=y(1464),w=y(197),A=y(1467),P=y(591);m.CachedSearchProvider=class CachedSearchProvider{constructor(h){this.provider=h,this.caches=new Map}provideFileSearchResults(h,m,y){const v={query:h,options:m,token:y};let C=this.trySortedSearchFromCache(v);if(!C){const h=m.maxResults?Object.assign({},m,{maxResults:1e9}):m;v.options=h,C=this.doSortedSearch(v,this.provider)}return C.then(h=>h.map(h=>A.joinPath(m.folder,h.relativePath)))}doSortedSearch(h,m){const y=new Promise((y,v)=>{const C=[];this.doSearch(h,m,h=>C.push(h)).then(()=>y(C),v)});let v;return h.options.session&&(v=this.getOrCreateCache(h.options.session,h.options.folder),v.resultsToSearchCache[h.query.pattern]={finished:y},y.then(null,m=>{delete v.resultsToSearchCache[h.query.pattern]})),y.then(m=>{if(h.query.pattern){const y=v?v.scorerCache:Object.create(null);return this.sortResults(h,m,y)}return m})}getOrCreateCache(h,m,y=!0){if(!h)return null;if(!this.caches.has(h)){if(!y)return null;h.onCancellationRequested(()=>{this.caches.delete(h)}),this.caches.set(h,new Map)}if(!this.caches.get(h).has(m.toString())){if(!y)return null;this.caches.get(h).set(m.toString(),new Cache)}return this.caches.get(h).get(m.toString())}trySortedSearchFromCache(h){const m=this.getOrCreateCache(h.options.session,h.options.folder,!1);if(!m)return;const y=this.getResultsFromCache(m,h.query.pattern);return y?y.then(y=>this.sortResults(h,y,m.scorerCache)):void 0}sortResults(h,m,y){const v=T.prepareQuery(h.query.pattern);return C.topAsync(m,(h,m)=>T.compareItemsByScore(h,m,v,!0,k,y),h.options.maxResults||0,1e4)}getResultsFromCache(h,m,y){const C=m.indexOf(v.sep)>=0;let T=void 0;for(let y in h.resultsToSearchCache)if(m.startsWith(y)){if(C&&y.indexOf(v.sep)<0)continue;T=h.resultsToSearchCache[y];break}return T?T.finished.then(h=>{if(y&&y.isCancellationRequested)throw P.canceled();let v=[];const C=w.stripWildcards(m).toLowerCase();for(let m=0;m<h.length;m++){let y=h[m];w.fuzzyContains(y.relativePath,C)&&v.push(y)}return v}):null}doSearch(h,m,y){return m.provideFileSearchResults(h.options,{report:h=>{if(h){const m={relativePath:h,basename:v.basename(h)};y(m)}}},h.token)}clearCache(h){return delete this.caches[h],Promise.resolve(void 0)}};class Cache{constructor(){this.resultsToSearchCache=Object.create(null),this.scorerCache=Object.create(null)}}const k=new class{getItemLabel(h){return h.basename}getItemDescription(h){return h.relativePath.substr(0,h.relativePath.length-h.basename.length-1)}getItemPath(h){return h.relativePath}}},function(h,m,y){"use strict";var v=this&&this.__awaiter||function(h,m,y,v){return new(y||(y=Promise))((function(C,T){function fulfilled(h){try{step(v.next(h))}catch(h){T(h)}}function rejected(h){try{step(v.throw(h))}catch(h){T(h)}}function step(h){h.done?C(h.value):new y((function(m){m(h.value)})).then(fulfilled,rejected)}step((v=v.apply(h,m||[])).next())}))};Object.defineProperty(m,"__esModule",{value:!0});const C=y(591);function topStep(h,m,y,v,C){for(const T=y.length;v<C;v++){const C=h[v];if(m(C,y[T-1])<0){y.pop();const h=findFirstInSorted(y,h=>m(C,h)<0);y.splice(h,0,C)}}}function findFirstInSorted(h,m){let y=0,v=h.length;if(0===v)return 0;for(;y<v;){let C=Math.floor((y+v)/2);m(h[C])?v=C:y=C+1}return y}m.topAsync=function topAsync(h,m,y,T,w){return 0===y?Promise.resolve([]):new Promise((A,P)=>{(()=>v(this,void 0,void 0,(function*(){const v=h.length,A=h.slice(0,y).sort(m);for(let P=y,k=Math.min(y+T,v);P<v;P=k,k=Math.min(k+T,v)){if(P>y&&(yield new Promise(h=>setTimeout(h))),w&&w.isCancellationRequested)throw C.canceled();topStep(h,m,A,P,k)}return A})))().then(A,P)})},m.findFirstInSorted=findFirstInSorted},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0});const v=y(197),C=y(1465),T=y(1466),w="win32"===process.platform,A=(process.platform,"linux"===process.platform),P=w?"\\":"/",k=[0,[]];function score(h,m,y,v){if(!h||!m)return k;const C=h.length,T=m.length;if(C<T)return k;const w=h.toLowerCase();if(!v){if(-1===w.indexOf(y))return k}return function doScore(h,m,y,v,C,T){const w=[],A=[];for(let P=0;P<y;P++)for(let y=0;y<T;y++){const k=P*T+y,R=k-1,M=(P-1)*T+y-1,N=y>0?w[R]:0,D=P>0&&y>0?w[M]:0,I=P>0&&y>0?A[M]:0;let x;x=!D&&P>0?0:computeCharScore(h,m,P,v,C,y,I),x&&D+x>=N?(A[k]=I+1,w[k]=D+x):(A[k]=0,w[k]=N)}const P=[];let k=y-1,R=T-1;for(;k>=0&&R>=0;){0===A[k*T+R]||(P.push(R),k--),R--}return[w[y*T-1],P.reverse()]}(m,y,T,h,w,C)}function computeCharScore(h,m,y,v,T,w,A){let P=0;if(m[y]!==T[w])return P;if(P+=1,A>0&&(P+=5*A),h[y]===v[w]&&(P+=1),0===w)P+=8;else{const h=function scoreSeparatorAtPos(h){switch(h){case 47:case 92:return 5;case 95:case 45:case 46:case 32:case 39:case 34:case 58:return 4;default:return 0}}(v.charCodeAt(w-1));h?P+=h:C.isUpper(v.charCodeAt(w))&&(P+=1)}return P}m.score=score;const R=Object.freeze({score:0});function scoreItem(h,m,y,T,w){if(!h||!m.value)return R;const k=T.getItemLabel(h);if(!k)return R;const M=T.getItemDescription(h);let N;N=M?`${k}${M}${m.value}${y}`:`${k}${m.value}${y}`;const D=w[N];if(D)return D;const I=function doScoreItem(h,m,y,T,w){if(y&&A?T.original===y:v.equalsIgnoreCase(T.original,y))return{score:1<<18,labelMatch:[{start:0,end:h.length}],descriptionMatch:m?[{start:0,end:m.length}]:void 0};if(!y||!T.containsPathSeparator){const m=C.matchesPrefix(T.value,h);if(m)return{score:1<<17,labelMatch:m};const y=C.matchesCamelCase(T.value,h);if(y)return{score:65536,labelMatch:y};const[v,A]=score(h,T.value,T.lowercase,w);if(v)return{score:v+32768,labelMatch:C.createMatches(A)}}if(m){let v=m;y&&(v=`${m}${P}`);const A=v.length,k=`${v}${h}`,[R,M]=score(k,T.value,T.lowercase,w);if(R){const h=C.createMatches(M),m=[],y=[];return h.forEach(h=>{h.start<A&&h.end>A?(m.push({start:0,end:h.end-A}),y.push({start:h.start,end:A})):h.start>=A?m.push({start:h.start-A,end:h.end-A}):y.push(h)}),{score:R,labelMatch:m,descriptionMatch:y}}}return R}(k,M,T.getItemPath(h),m,y);return w[N]=I,I}function computeLabelAndDescriptionMatchDistance(h,m,y){let v=-1,C=-1;if(m.descriptionMatch&&m.descriptionMatch.length?v=m.descriptionMatch[0].start:m.labelMatch&&m.labelMatch.length&&(v=m.labelMatch[0].start),m.labelMatch&&m.labelMatch.length){if(C=m.labelMatch[m.labelMatch.length-1].end,m.descriptionMatch&&m.descriptionMatch.length){const m=y.getItemDescription(h);m&&(C+=m.length)}}else m.descriptionMatch&&m.descriptionMatch.length&&(C=m.descriptionMatch[m.descriptionMatch.length-1].end);return C-v}function fallbackCompare(h,m,y,v){const C=v.getItemLabel(h),w=v.getItemLabel(m),A=v.getItemDescription(h),P=v.getItemDescription(m),k=C.length+(A?A.length:0),R=w.length+(P?P.length:0);if(k!==R)return k-R;const M=v.getItemPath(h),N=v.getItemPath(m);return M&&N&&M.length!==N.length?M.length-N.length:C!==w?T.compareAnything(C,w,y.value):A&&P&&A!==P?T.compareAnything(A,P,y.value):M&&N&&M!==N?T.compareAnything(M,N,y.value):0}m.prepareQuery=function prepareQuery(h){h||(h="");let m=v.stripWildcards(h).replace(/\s/g,"");w&&(m=m.replace(/\//g,P));const y=m.toLowerCase(),C=m.indexOf(P)>=0;return{original:h,value:m,lowercase:y,containsPathSeparator:C}},m.scoreItem=scoreItem,m.compareItemsByScore=function compareItemsByScore(h,m,y,v,C,T,w=fallbackCompare){const A=scoreItem(h,y,v,C,T),P=scoreItem(m,y,v,C,T),k=A.score,R=P.score;if((k===1<<18||R===1<<18)&&k!==R)return k===1<<18?-1:1;if(k===1<<17||R===1<<17){if(k!==R)return k===1<<17?-1:1;const y=C.getItemLabel(h),v=C.getItemLabel(m);if(y.length!==v.length)return y.length-v.length}if(65536===k||65536===R){if(k!==R)return 65536===k?-1:1;const y=C.getItemLabel(h),v=C.getItemLabel(m),T=function compareByMatchLength(h,m){if(!((h||m)&&(h&&h.length||m&&m.length)))return 0;if(!m||!m.length)return-1;if(!h||!h.length)return 1;const y=h[0].start,v=h[h.length-1].end-y,C=m[0].start,T=m[m.length-1].end-C;return v===T?0:T<v?1:-1}(A.labelMatch,P.labelMatch);if(0!==T)return T;if(y.length!==v.length)return y.length-v.length}if(k>32768||R>32768){if(R<32768)return-1;if(k<32768)return 1}if(k!==R)return k>R?-1:1;const M=computeLabelAndDescriptionMatchDistance(h,A,C),N=computeLabelAndDescriptionMatchDistance(m,P,C);return M&&N&&M!==N?N>M?-1:1:w(h,m,y,C)},m.fallbackCompare=fallbackCompare},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0});const v=y(197);function isLower(h){return 97<=h&&h<=122}function isUpper(h){return 65<=h&&h<=90}function isNumber(h){return 48<=h&&h<=57}function isWhitespace(h){return 32===h||9===h||10===h||13===h}function isAlphanumeric(h){return isLower(h)||isUpper(h)||isNumber(h)}function nextAnchor(h,m){for(let y=m;y<h.length;y++){let m=h.charCodeAt(y);if(isUpper(m)||isNumber(m)||y>0&&!isAlphanumeric(h.charCodeAt(y-1)))return y}return h.length}function _matchesCamelCase(h,m,y,v){if(y===h.length)return[];if(v===m.length)return null;if(h[y]!==m[v].toLowerCase())return null;{let C=null,T=v+1;for(C=_matchesCamelCase(h,m,y+1,v+1);!C&&(T=nextAnchor(m,T))<m.length;)C=_matchesCamelCase(h,m,y+1,T),T++;return null===C?null:function join(h,m){return 0===m.length?m=[h]:h.end===m[0].start?m[0].start=h.start:m.unshift(h),m}({start:v,end:v+1},C)}}m.matchesPrefix=function _matchesPrefix(h,m,y){if(!y||y.length<m.length)return null;let C;C=h?v.startsWithIgnoreCase(y,m):0===y.indexOf(m);if(!C)return null;return m.length>0?[{start:0,end:m.length}]:[]}.bind(void 0,!0),m.isUpper=isUpper,m.matchesCamelCase=function matchesCamelCase(h,m){if(!m)return null;if(0===(m=m.trim()).length)return null;if(!function isCamelCasePattern(h){let m=0,y=0,v=0,C=0;for(let T=0;T<h.length;T++)v=h.charCodeAt(T),isUpper(v)&&m++,isLower(v)&&y++,isWhitespace(v)&&C++;return 0!==m&&0!==y||0!==C?m<=5:h.length<=30}(h))return null;if(m.length>60)return null;const y=function analyzeCamelCaseWord(h){let m=0,y=0,v=0,C=0,T=0;for(let w=0;w<h.length;w++)T=h.charCodeAt(w),isUpper(T)&&m++,isLower(T)&&y++,isAlphanumeric(T)&&v++,isNumber(T)&&C++;return{upperPercent:m/h.length,lowerPercent:y/h.length,alphaPercent:v/h.length,numericPercent:C/h.length}}(m);if(!function isCamelCaseWord(h){const{upperPercent:m,lowerPercent:y,alphaPercent:v,numericPercent:C}=h;return y>.2&&m<.8&&v>.6&&C<.2}(y)){if(!function isUpperCaseWord(h){const{upperPercent:m,lowerPercent:y}=h;return 0===y&&m>.6}(y))return null;m=m.toLowerCase()}let v=null,C=0;for(h=h.toLowerCase();C<m.length&&null===(v=_matchesCamelCase(h,m,0,C));)C=nextAnchor(m,C+1);return v},m.createMatches=function createMatches(h){let m,y,v=[];if(!h)return v;m=Array.isArray(h[1])?h[1]:h;for(const h of m)y&&y.end===h?y.end+=1:(y={start:h,end:h+1},v.push(y));return v}},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0});const v=y(197);let C,T;function setFileNameComparer(h){C=h,T=h.resolvedOptions().numeric}function compareFileNames(h,m,y=!1){if(C){const y=h||"",v=m||"",w=C.compare(y,v);return T&&0===w&&y!==v?y<v?-1:1:w}return noIntlCompareFileNames(h,m,y)}setFileNameComparer(new Intl.Collator(void 0,{numeric:!0,sensitivity:"base"})),m.setFileNameComparer=setFileNameComparer,m.compareFileNames=compareFileNames;const w=/^(.*?)(\.([^.]*))?$/;function noIntlCompareFileNames(h,m,y=!1){y||(h=h&&h.toLowerCase(),m=m&&m.toLowerCase());const[v,C]=extractNameAndExtension(h),[T,w]=extractNameAndExtension(m);return v!==T?v<T?-1:1:C===w?0:C<w?-1:1}function extractNameAndExtension(h){const m=h?w.exec(h):[];return[m&&m[1]||"",m&&m[3]||""]}function compareByPrefix(h,m,y){let C=h.toLowerCase(),T=m.toLowerCase(),w=v.startsWith(C,y),A=v.startsWith(T,y);if(w!==A)return w?-1:1;if(w&&A){if(C.length<T.length)return-1;if(C.length>T.length)return 1}return 0}m.noIntlCompareFileNames=noIntlCompareFileNames,m.compareAnything=function compareAnything(h,m,y){let C=h.toLowerCase(),T=m.toLowerCase();const w=compareByPrefix(h,m,y);if(w)return w;let A=v.endsWith(C,y);if(A!==v.endsWith(T,y))return A?-1:1;let P=compareFileNames(C,T);return 0!==P?P:C.localeCompare(T)},m.compareByPrefix=compareByPrefix},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0});const v=y(7);m.joinPath=function joinPath(h,m){const y=v.posix.join(h.path||"/",m);return h.with({path:y})}},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0});const v=y(298),C=y(3),T=y(4),w=y(5);m.default=async function default_1(h){const m=new v.BreakpointManager(!1,h.sourceEventService(),h.pathManager());await m.init();const y=new v.JoinDebugManager(h.rpcFactory(T.vsls.DebuggerHostService,T.vsls.TraceSources.DebugHost),C.SessionContext,h.fileSystemManager(),h.pathManager(),h.accessControlManager(),w.traceSource.withName(T.vsls.TraceSources.DebugRemote));await y.init(),C.ExtensionUtil.registerCommand("liveshare.debug",()=>y.attach()),h.enableCommands["liveshare.debug"]=()=>y.canAttach()}},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0});const v=y(18),C=y(7),T=y(0),w=y(5),A=y(3),P=y(104),k=y(593),R=y(573),M=y(325),N=y(594);class HubClientConnection extends P.LiveShareConnection{get type(){return P.TConnectionTypes.WorkspaceHub}async createWorkspaceClient(){return new R.WorkspaceHubClient(await k.hubRpcClient(),this.trace.createChild("workspace-hub-client"))}}function getConnectionClass(){if(M.isLiveshareHubEnabled())return HubClientConnection}m.getConnectionClass=getConnectionClass,m.joinWorkspace=async function joinWorkspace(h,m,y){if(M.isLiveshareHubEnabled()){const y=await N.createLiveshareConnectionOptions(h,A.dependencies,m);A.joinWithLocalConnectionHub(w.traceSource,y,getConnectionClass()).then(()=>{w.traceSource.info(`join completed for workspace:${h}`)}).catch(m=>{w.traceSource.info(`failed to join workspace:${h}`,m)})}const P=C.join(await async function createWorkspaceTemporaryFolder(h,m){let y=C.join(v.tmpdir(),`vsliveshare-workspace-tmp-${h}`);m&&(y+=`_${Date.now()}`);return await w.fileAccess.ensureDirAsync(y),y}(h,!1),`${A.Settings.get(A.SettingKeys.name)}.code-workspace`),k={folders:[{name:"Liveshare workspace",uri:`vsls:/?${h}`}],settings:{"files.hotExit":"off"},transient:!0};await w.fileAccess.writeFileAsync(P,JSON.stringify(k));const R=T.Uri.file(P);return await T.commands.executeCommand("vscode.openFolder",R,y),!0},m.leaveCollaboration=async function leaveCollaboration(){T.workspace.workspaceFolders?await T.commands.executeCommand("workbench.action.closeFolder"):await T.commands.executeCommand("workbench.action.closeAllEditors")}},function(h){h.exports=JSON.parse('{"name":"vsliveshare-web","version":"1.1.0-dev","scripts":{"test":"echo \\"no tests found.\\"","vscode:prepublish":"echo \\"nothing\\"","webview:build":"cd ../communications/webview && yarn build","compile":"../../common/node_modules/.bin/tsc -b ./","webpack:build":"yarn compile && yarn webview:build","watch":"../../common/node_modules/.bin/tsc -b -watch ./","build:webpack":"node ../../node_modules/webpack-cli/bin/cli.js --config webpack.browser.config","build:webpack-calling-service":"node ../../node_modules/webpack-cli/bin/cli.js --config ../callingService/webpack.browser.config","prewebpack":"cd ../../vsls-contracts && yarn generate-contracts","webpack-dev":"yarn webpack:build && yarn build:webpack -- --env=development","webpack-dev-deploy":"yarn webpack-dev && gulp deploy-web && gulp fixOutWebPackageContentsDev","webpack":"yarn webpack:build && yarn build:webpack && gulp deploy-web","calling-service-deploy":"gulp copy-webpack-calling-service","build:webpack-node":"node ../../common/node_modules/webpack-cli/bin/cli.js --config webpack.node.config","deploy-node":"yarn compile-port-forwarder && yarn compile-liveshare-hub && gulp deploy-node","webpack-node-browser":"yarn webpack:build && yarn build:webpack-node && yarn build:webpack && yarn deploy-node && gulp deploy-node-browser","webpack-node":"yarn webpack:build && yarn build:webpack-node && yarn deploy-node","webpack-node-dev":"yarn webpack:build && yarn build:webpack-node -- --env=development && yarn deploy-node","package-dev":"yarn webpack-node-dev && gulp package","package-node":"yarn webpack-node && gulp package","package":"yarn webpack-node-browser && gulp package","compile-dev":"yarn compile && gulp deploy-package-out","compile-port-forwarder":"cd ../../port-forwarder/hub && yarn webpack-node","compile-liveshare-hub":"cd ../hub && yarn webpack-node","build:lint":"../../node_modules/.bin/eslint src --ext ts","build:lint-fix":"../../node_modules/.bin/eslint src --ext ts --fix"},"dependencies":{"@vs/liveshare-core":"link:../core","@vs/liveshare-debug":"link:../debugging","@vs/liveshare-lsp":"link:../languageService","@vs/liveshare-contactservice":"link:../contactService","@vs/liveshare-reviews":"link:../reviews","@vs/liveshare-notebooks":"link:../notebooks","@vs/liveshare-servers":"link:../servers","@vs/liveshare-signalr-proxy":"link:../signalR-proxy","@vs/liveshare-communications":"link:../communications","@vs/liveshare-signalr":"link:../signalR","@vs/liveshare-terminals":"link:../terminals","@vs/liveshare-tasks":"link:../tasks","@vs/liveshare-api":"link:../api","@vs/vscode-command-framework":"link:../../vscode-command-framework","@vs/vso-workspace-client":"link:../../workspace/client","@vs/vso-workspace-client-hub":"link:../../workspace/client-hub","@vs/vso-rpc-signalr":"link:../../rpc/signalr","@vs/vso-node-utils":"link:../../node/utils","module-alias":"^2.2.2","vscode-jsonrpc":"^4.0.0"},"devDependencies":{"@types/node":"^10.14.8","copyfiles":"^2.1.1","gulp":"^4.0.2","nerdbank-gitversioning":"^3.4.220","terser-webpack-plugin":"^1.4.5"},"_moduleAliases":{"@extension-abstractions":"./src/node","@workspace-abstractions":"../../../node_modules/@vs/liveshare-workspace/dist/src/abstractions/node","@core-abstractions":"../../../node_modules/@vs/liveshare-core/dist/src/abstractions/node","@server-abstractions":"../../../node_modules/@vs/liveshare-servers/dist/src/abstractions/node","@vscode-abstractions":"../../../node_modules/@vs/vscode-command-framework/dist/src/abstractions/node","@api-abstractions":"../../../node_modules/@vs/liveshare-api/dist/src/abstractions/node"}}')},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0});const v=y(597),C=y(1472);m.registerGuestTerminalHandler=function registerGuestTerminalHandler(h,m){h.sessionStateManager().registerHandler(new v.GuestTerminalHandler(Object.assign(Object.assign({},h),{terminalEndpointBufferFactory:C.createTerminalEndpointBufferFactory(h,m)})))}},function(h,m,y){"use strict";var v=this&&this.__awaiter||function(h,m,y,v){return new(y||(y=Promise))((function(C,T){function fulfilled(h){try{step(v.next(h))}catch(h){T(h)}}function rejected(h){try{step(v.throw(h))}catch(h){T(h)}}function step(h){h.done?C(h.value):function adopt(h){return h instanceof y?h:new y((function(m){m(h)}))}(h.value).then(fulfilled,rejected)}step((v=v.apply(h,m||[])).next())}))};Object.defineProperty(m,"__esModule",{value:!0});const C=y(29),T=y(2);m.createTerminalEndpointBufferFactory=function createTerminalEndpointBufferFactory(h,m){return y=>v(this,void 0,void 0,(function*(){const C=yield h.streamManagerService().getStreamAsync(y.streamName,y.streamCondition),T=yield m.openStreamingChannel(C),w=new StreamChannel(T);let A=!1;return T.onClosed(()=>{A=!0}),{isDisposed:()=>A,readData:h=>v(this,void 0,void 0,(function*(){const m=yield w.read(1024,h);return m?m.toString():null})),writeData:(h,m)=>v(this,void 0,void 0,(function*(){const y=Buffer.from(h,"utf8");yield T.send(y,m)}))}}))};class StreamChannel extends C.BaseStream{constructor(h){super(),h.onDataReceived(h=>{this.onData(h)})}write(h,m){T.notImplemented()}close(h,m){T.notImplemented()}}},function(h,m,y){"use strict";var v=this&&this.__decorate||function(h,m,y,v){var C,T=arguments.length,w=T<3?m:null===v?v=Object.getOwnPropertyDescriptor(m,y):v;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)w=Reflect.decorate(h,m,y,v);else for(var A=h.length-1;A>=0;A--)(C=h[A])&&(w=(T<3?C(w):T>3?C(m,y,w):C(m,y))||w);return T>3&&w&&Object.defineProperty(m,y,w),w},C=this&&this.__metadata||function(h,m){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(h,m)},T=this&&this.__awaiter||function(h,m,y,v){return new(y||(y=Promise))((function(C,T){function fulfilled(h){try{step(v.next(h))}catch(h){T(h)}}function rejected(h){try{step(v.throw(h))}catch(h){T(h)}}function step(h){h.done?C(h.value):function adopt(h){return h instanceof y?h:new y((function(m){m(h)}))}(h.value).then(fulfilled,rejected)}step((v=v.apply(h,m||[])).next())}))};Object.defineProperty(m,"__esModule",{value:!0});const w=y(0),A=y(7),P=y(35),k=y(3),R=y(4),M=y(5),N=y(327),D=y(198),I=y(8),x=y(3);class UserPromptScraper extends(M.Inittable(M.Disposable(Object))){constructor(h){super(),this.terminalEntry=h}processData(h){const m=h.lastIndexOf("\r");if(-1!==m)this.terminalEntry.update(D.MetadataKey.prompt,h.substr(m));else{const m=this.terminalEntry.get(D.MetadataKey.prompt)||"";this.terminalEntry.update(D.MetadataKey.prompt,m.concat(h))}}}m.hostTerminalControllerFactory=h=>{const{controllerDecorator:m,telemetryMethodDecorator:y,errorNotificationMethodDecorator:O}=h.methodDecorators();let L=class HostTerminalController extends N.TerminalControllerBase{constructor(h){super(h.terminalService,M.traceSource.withName("HostTerminalController")),this.dependencies=h,this.workspaceAccessControlManager=h.workspaceAccessControlManager,this.workspaceAccessControlService=h.workspaceAccessControlService}dispose(){const h=Object.create(null,{dispose:{get:()=>super.dispose}});return T(this,void 0,void 0,(function*(){this.dataScraper&&this.dataScraper.dispose(),yield h.dispose.call(this)}))}activate(){const h=Object.create(null,{activate:{get:()=>super.activate}});return T(this,void 0,void 0,(function*(){if(this.isActivated)return!0;yield h.activate.call(this),x.ControllerHelper.register(this,this.sessionSubscriptions);const m=yield w.tasks.fetchTasks();this.workspaceAccessControlService().onOpeationAccessRequested(h=>T(this,void 0,void 0,(function*(){x.SessionContext.isCollaborating&&h.operation.name===x.WellKnownRestrictedOperations.WriteToSharedTerminal&&(yield this.requestOperationAccess(h.operation,h.sessionId))}))),k.Settings.get(k.SettingKeys.autoShareTerminals)&&(this.deferWork(()=>this.launchDataScraper(m,this.dependencies)),w.window.onDidOpenTerminal(h=>T(this,void 0,void 0,(function*(){x.isTaskTerminal(m,h)||x.isSharedTerminal(h)||(yield this.shareTerminalInternal(h))})),this,this.sessionSubscriptions),this.deferredWork=this.deferredWork.then(()=>T(this,void 0,void 0,(function*(){yield Promise.all(w.window.terminals.filter(h=>!x.isTaskTerminal(m,h)&&!x.isSharedTerminal(h)).map(h=>this.shareTerminalInternal(h)))}))).catch(h=>{this.trace.error(h.message)}));let y=k.Settings.get(k.SettingKeys.allowReadWriteTerminals);return yield k.ExtensionUtil.setCommandContext("liveshare:readOnlyTerminalsEnforced",void 0!==y&&!y),!0}))}shareTerminalInternal(h,m){return T(this,void 0,void 0,(function*(){const y=this.terminalCache.get(h),v=y?y.get(D.MetadataKey.prompt):null,C=P().replace(/-/g,"");let A;A=h.dimensions&&this.dependencies.handleChangeTerminalDimensions?h.dimensions:{columns:k.Settings.get(k.SettingKeys.sharedTerminalWidth),rows:k.Settings.get(k.SettingKeys.sharedTerminalWidth)};const R={name:(h.name||"terminal")+` ${k.sharedTerminalName}`,dataPipeName:C,rows:A.rows,cols:A.columns,readOnlyForGuests:null==m||m};let M=[],N=null;const O=new w.EventEmitter;w.window.onDidWriteTerminalData(m=>{m.terminal===h&&O.fire(m.data)},null,M);const L={onDataReceived:O.event,sendData:m=>{h.sendText(m.toString(),!1)}};let U;try{U=this.dependencies.forwardBuffer(R,L,v,this.trace),N=yield this.terminalService.startTerminalAsync(R)}catch(h){return this.trace.error(`Error running a shared terminal worker. ${h}`),I.Telemetry.sendFault(x.TelemetryEventNames.RUN_SHARED_TERMINAL_FAULT,I.FaultType.Error,null,h),void(null==U||U.dispose())}w.window.onDidChangeTerminalDimensions(h=>{this.dependencies.handleChangeTerminalDimensions&&this.dependencies.handleChangeTerminalDimensions(N.id,h.dimensions)},null,M),this.terminalService.onTerminalStopped(h=>T(this,void 0,void 0,(function*(){h.terminal.id===N.id&&(yield disposeTerminalWorker())})),null,M);const disposeTerminalWorker=h=>T(this,void 0,void 0,(function*(){var m;M.forEach(h=>h.dispose());try{h&&!(null===(m=this.terminalService.client)||void 0===m?void 0:m.isDisposed)&&(yield this.terminalService.stopTerminalAsync(N.id))}catch(h){}try{null==U||U.dispose()}catch(h){}}));this.terminalCache.register(h,N.id,!1,{dispose:()=>disposeTerminalWorker(!0)}),I.Telemetry.sendTelemetryEvent(x.TelemetryEventNames.SHARE_TERMINAL,{[x.TelemetryPropertyNames.SHARED_TERMINAL_READONLY]:(!1).toString()})}))}launchDataScraper(h,m){return T(this,void 0,void 0,(function*(){this.dataScraper=yield m.dataScrapingManager().registerDataScraper("user-prompt-scraper",m=>{if(x.isTaskTerminal(h,m)||x.isSharedTerminal(m))return null;const y=this.terminalCache.register(m);return new UserPromptScraper(y)})}))}requestOperationAccess(h,m){return T(this,void 0,void 0,(function*(){try{const y=yield this.requestReadWriteAccessForTerminal(h.terminalId,m);"boolean"==typeof y&&(yield this.workspaceAccessControlService().setOperationAccessAsync(h,y?R.vsls.RestrictedOperationAccess.Allowed:R.vsls.RestrictedOperationAccess.ExplicitlyRejectedByHost))}catch(m){const y=`Requesting access for '${h?h.name:"null"}' operation failed: ${m.message}`;this.trace.error(y),I.Telemetry.sendFault(x.TelemetryEventNames.REQUEST_OPERATION_ACCESS_FAULT,I.FaultType.NonBlockingFault,y,m)}}))}requestReadWriteAccessForTerminal(h,m){return T(this,void 0,void 0,(function*(){const y=(yield this.terminalService.getRunningTerminalsAsync()).find(m=>m.id===h),v=x.SessionContext.collaboratorManager.getCollaborators()[m.toString(10)];if(!y||!v)return;const C="Make the terminal read/write for everyone",T=yield w.window.showInformationMessage(`${v.name} requested permission to write to the '${y.options.name}' terminal`,{modal:!1},C,"Keep it read-only");if(T!==C)return"Keep it read-only"!==T&&void 0;yield this.setTerminalReadOnly(h,!1)}))}closeTerminal(h){return T(this,void 0,void 0,(function*(){if(!h)return!1;const m=yield this.terminalService.getRunningTerminalsAsync();for(const y of m.filter(m=>m.id===h.terminalId)){yield this.terminalService.stopTerminalAsync(y.id);break}return!0}))}makeTerminalReadOnly(h){return T(this,void 0,void 0,(function*(){return!!h&&(yield this.setTerminalReadOnly(h.terminalId,!0))}))}makeTerminalReadWrite(h){return T(this,void 0,void 0,(function*(){return!!h&&(yield this.setTerminalReadOnly(h.terminalId,!1))}))}setTerminalReadOnly(h,m){return T(this,void 0,void 0,(function*(){const y=yield this.terminalService.getRunningTerminalsAsync();for(const v of y.filter(m=>m.id===h)){yield this.terminalService.setTerminalReadOnlyForGuestsAsync(v.id,m),yield this.workspaceAccessControlManager().setOperationAccess({name:x.WellKnownRestrictedOperations.WriteToSharedTerminal,terminalId:h},m?R.vsls.RestrictedOperationAccess.DisabledByHostConfiguration:R.vsls.RestrictedOperationAccess.Allowed);break}return!0}))}shareTerminal(){return T(this,void 0,void 0,(function*(){try{let h=x.constants.READ_ONLY_LABEL,m=k.Settings.get(k.SettingKeys.allowReadWriteTerminals);if((x.workspaceSessionInfoTracker.isReadOnly||void 0===m||m)&&(h=yield w.window.showQuickPick([x.constants.READ_ONLY_LABEL,"Read/write"],{placeHolder:"Select the access level guests should have for this terminal"}),void 0===h))return;const y=this.dependencies.platform,v=w.workspace.getConfiguration(),C=`terminal.integrated.shell.${y}`,T=v.get(C)||("windows"===y?"powershell":"bash"),P=A.basename(T).toLowerCase(),R=`${"powershell.exe"===P?"ps":A.basename(P,A.extname(P))} ${k.sharedTerminalName}`,M=h===x.constants.READ_ONLY_LABEL,N=w.window.createTerminal(R);yield this.shareTerminalInternal(N,M),N.show(),I.Telemetry.sendTelemetryEvent(x.TelemetryEventNames.SHARE_TERMINAL,{[x.TelemetryPropertyNames.SHARED_TERMINAL_SHELL]:A.parse(T).name,[x.TelemetryPropertyNames.SHARED_TERMINAL_READONLY]:M.toString()})}catch(h){throw I.Telemetry.sendFault(x.TelemetryEventNames.SHARE_TERMINAL_FAULT,I.FaultType.Error,null,h),h}return!0}))}openTerminal(h){return T(this,void 0,void 0,(function*(){if(!h)return!1;const m=yield this.terminalService.getRunningTerminalsAsync();for(const y of m.filter(m=>m.id===h.terminalId)){this.showTerminal(y);break}return!0}))}};return v([O("Removing Terminal",x.TelemetryEventNames.REMOVE_TERMINAL_FAULT),y(x.TelemetryEventNames.REMOVE_TERMINAL,x.TelemetryEventNames.REMOVE_TERMINAL_FAULT,"RemoveTerminal"),x.commandBindingDecorator("liveshare.fileTreeExplorer.removeTerminal"),x.commandBindingDecorator("liveshare.activityBar.removeTerminal"),C("design:type",Function),C("design:paramtypes",[Object]),C("design:returntype",Promise)],L.prototype,"closeTerminal",null),v([O("Making Terminal Read-Only",x.TelemetryEventNames.MAKE_TERMINAL_READ_ONLY_FAULT),y(x.TelemetryEventNames.MAKE_TERMINAL_READ_ONLY,x.TelemetryEventNames.MAKE_TERMINAL_READ_ONLY_FAULT,"MakeTerminalReadOnly"),x.commandBindingDecorator("liveshare.fileTreeExplorer.makeTerminalReadOnly"),x.commandBindingDecorator("liveshare.activityBar.makeTerminalReadOnly"),C("design:type",Function),C("design:paramtypes",[Object]),C("design:returntype",Promise)],L.prototype,"makeTerminalReadOnly",null),v([O("Making Terminal Read/Write",x.TelemetryEventNames.MAKE_TERMINAL_READ_WRITE_FAULT),y(x.TelemetryEventNames.MAKE_TERMINAL_READ_WRITE,x.TelemetryEventNames.MAKE_TERMINAL_READ_WRITE_FAULT,"MakeTerminalReadWrite"),x.commandBindingDecorator("liveshare.fileTreeExplorer.makeTerminalReadWrite"),x.commandBindingDecorator("liveshare.activityBar.makeTerminalReadWrite"),C("design:type",Function),C("design:paramtypes",[Object]),C("design:returntype",Promise)],L.prototype,"makeTerminalReadWrite",null),v([O("Sharing Terminal",x.TelemetryEventNames.SHARE_TERMINAL_FAULT),y(x.TelemetryEventNames.SHARE_TERMINAL,x.TelemetryEventNames.SHARE_TERMINAL_FAULT,"ShareTerminal"),x.commandBindingDecorator("liveshare.shareTerminal"),x.commandBindingDecorator("liveshare.fileTreeExplorer.shareTerminal"),x.commandBindingDecorator("liveshare.activityBar.shareTerminal"),C("design:type",Function),C("design:paramtypes",[]),C("design:returntype",Promise)],L.prototype,"shareTerminal",null),v([O("Opening Terminal",x.TelemetryEventNames.OPEN_TERMINAL_FAULT),y(x.TelemetryEventNames.OPEN_TERMINAL,x.TelemetryEventNames.OPEN_TERMINAL_FAULT,"OpenTerminal"),x.commandBindingDecorator("liveshare.fileTreeExplorer.openTerminal"),x.commandBindingDecorator("liveshare.activityBar.openTerminal"),C("design:type",Function),C("design:paramtypes",[Object]),C("design:returntype",Promise)],L.prototype,"openTerminal",null),L=v([m,C("design:paramtypes",[Object])],L),new L(h)}},function(h,m,y){"use strict";var v=this&&this.__awaiter||function(h,m,y,v){return new(y||(y=Promise))((function(C,T){function fulfilled(h){try{step(v.next(h))}catch(h){T(h)}}function rejected(h){try{step(v.throw(h))}catch(h){T(h)}}function step(h){h.done?C(h.value):function adopt(h){return h instanceof y?h:new y((function(m){m(h)}))}(h.value).then(fulfilled,rejected)}step((v=v.apply(h,m||[])).next())}))};Object.defineProperty(m,"__esModule",{value:!0});const C=y(0),T=y(4),w=y(2);function throwIfRpcContext(h){if(h)throw new Error("This method can only be invoked by the host")}function createTerminalInfo(h,m){return{id:h,options:m,streamName:"terminal",streamCondition:h.toString()}}m.TerminalService=class TerminalService{constructor(h){this.workspaceServer=h,this.nextTerminalId=0,this.streamInfos=new Map,this.onTerminalStartedEmitter=new C.EventEmitter,this.onTerminalResizedEmitter=new C.EventEmitter,this.onTerminalStoppedEmitter=new C.EventEmitter,this.onTerminalReadOnlyChangedEmitter=new C.EventEmitter,this.streamName="terminal",this.serviceInfo=T.vsls.TerminalService,this.onTerminalStarted=this.onTerminalStartedEmitter.event,this.onTerminalResized=this.onTerminalResizedEmitter.event,this.onTerminalStopped=this.onTerminalStoppedEmitter.event,this.onTerminalReadOnlyChanged=this.onTerminalReadOnlyChangedEmitter.event}forwardBuffer(h,m,y){const v=++this.nextTerminalId;return this.streamInfos.set(v,[h,m,new C.EventEmitter]),{dispose:()=>{this.streamInfos.delete(v)}}}getStream(h,m,y){const T=this.streamInfos.get(Number(m));if(!T)throw new Error(`unknown terminal:${m}`);const w=T[0],A=T[1],P=this.workspaceServer.isOwner(h),k=new C.EventEmitter,R=A.onDataReceived(h=>{k.fire(Buffer.from(h))}),M=new C.EventEmitter,N=P||!w.readOnlyForGuests,D={onDataReceived:k.event,onClosed:M.event,send:(h,m)=>v(this,void 0,void 0,(function*(){N&&A.sendData(h.toString())})),dispose:()=>{R.dispose(),M.fire()},adjustWindow:h=>{},close:(h,m)=>Promise.resolve(),canWrite:N};return T[2].event(()=>{D.dispose()}),Promise.resolve([m,D])}fireTerminalResized(h,m){this.onTerminalResizedEmitter.fire({terminal:createTerminalInfo(h,{name:"",rows:m.rows,cols:m.columns,readOnlyForGuests:!0})})}startTerminalAsync(h,m,y){return v(this,void 0,void 0,(function*(){throwIfRpcContext(y);const m={id:this.nextTerminalId,options:h,streamName:this.streamName,streamCondition:this.nextTerminalId.toString()};return this.onTerminalStartedEmitter.fire({terminal:m}),m}))}getRunningTerminalsAsync(h){return v(this,void 0,void 0,(function*(){return Array.from(this.streamInfos.entries()).map(h=>({id:h[0],options:h[1][0],streamName:this.streamName,streamCondition:h[0].toString()}))}))}resizeTerminalAsync(h,m,y,C){return v(this,void 0,void 0,(function*(){return Promise.resolve()}))}stopTerminalAsync(h,m,y){throwIfRpcContext(y);const v=this.streamInfos.get(h);if(!v)throw new Error(`unknown terminal id:${h}`);return this.streamInfos.delete(h),v[2].fire(),this.onTerminalStoppedEmitter.fire({terminal:createTerminalInfo(h,v[0])}),Promise.resolve()}clearTerminalBufferAsync(h,m){w.notImplemented()}setTerminalReadOnlyForGuestsAsync(h,m,y,v){throwIfRpcContext(v);const C=this.streamInfos.get(h);if(!C)throw new Error(`unknown terminal id:${h}`);const T=C[0];return T.readOnlyForGuests!==m&&(T.readOnlyForGuests=m,this.onTerminalReadOnlyChangedEmitter.fire({terminal:createTerminalInfo(h,T)})),Promise.resolve()}}},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0}),m.NotebooksService={name:"notebooksService",methods:["getContentProviders","openNotebook","executeCell","executeNotebook","cancelCellExecution","cancelNotebookExecution","applyNotebookCellChanges","changeCellLanguage"],events:["didChangeCellOutputs","didChangeCellMetadata","didChangeNotebookCells","didChangeCellLanguage","didChangeCellExecutionState"]}},function(h,m,y){"use strict";var v=this&&this.__awaiter||function(h,m,y,v){return new(y||(y=Promise))((function(C,T){function fulfilled(h){try{step(v.next(h))}catch(h){T(h)}}function rejected(h){try{step(v.throw(h))}catch(h){T(h)}}function step(h){h.done?C(h.value):function adopt(h){return h instanceof y?h:new y((function(m){m(h)}))}(h.value).then(fulfilled,rejected)}step((v=v.apply(h,m||[])).next())}))};Object.defineProperty(m,"__esModule",{value:!0});const C=y(0),T=y(3),w=y(4),A=y(8),P=y(599),k=y(601);class HostNotebooksService extends k.notebooksServiceBase{constructor(h,m){super(),this.allowGuestExecuteCellsForSession=!1,this.executeCellOperation={name:T.WellKnownRestrictedOperations.ExecuteNotebookCell,isEnabled:()=>this.allowGuestExecuteCells()},this.cellManagers={},this.rpcClient=h.workspaceService().client,this.workspaceService=h.workspaceService(),this.pathManager=h.pathManager(),this.fileService=h.fileService,this.clientAccessCheck=m,this.workspaceAccessControlService=h.workspaceAccessControlService,this.session=h.sessionContext(),this.trace=h.trace().withName("Notebooks")}allowGuestExecuteCells(){return T.Settings.get(T.SettingKeys.allowGuestExecuteCells)||this.allowGuestExecuteCellsForSession}init(){const h=Object.create(null,{init:{get:()=>super.init}});var m;return v(this,void 0,void 0,(function*(){if(h.init.call(this),"function"==typeof(null===(m=C.notebooks)||void 0===m?void 0:m.onDidChangeCellOutputs)){try{this.disposables.push(C.notebooks.onDidChangeCellOutputs(h=>this.onDidChangeCellOutputs(h))),this.disposables.push(C.notebooks.onDidChangeCellMetadata(h=>this.onDidChangeCellMetadata(h))),this.disposables.push(C.notebooks.onDidChangeNotebookCellExecutionState(h=>this._onDidChangeNotebookCellExecutionState(h))),this.disposables.push(C.notebooks.onDidChangeNotebookCells(h=>this._onDidChangeNotebookCells(h))),this.disposables.push(C.workspace.onDidOpenNotebookDocument(h=>this._onDidOpenNotebookDocument(h))),C.workspace.notebookDocuments.forEach(h=>this.createCellManager(h))}catch(h){}this.allowGuestExecuteCellsForSession=!1,this.disposables.push(this.workspaceAccessControlService().onOpeationAccessRequested(h=>{T.SessionContext.isCollaborating&&h.operation.name===T.WellKnownRestrictedOperations.ExecuteNotebookCell&&this.requestExecuteCellsAccess(h.operation,h.sessionId)})),this.rpcClient.addRequestMethod("notebooksService.getContentProviders",h=>this.getContentProviders(h)),this.rpcClient.addRequestMethod("notebooksService.openNotebook",(h,m,y)=>this.openNotebook(h,m,y)),this.rpcClient.addRequestMethodWithContext("notebooksService.executeCell",(h,m,y,v,C)=>this.executeCell(h,m,y,v,C)),this.rpcClient.addRequestMethodWithContext("notebooksService.executeNotebook",(h,m,y,v)=>this.executeNotebook(h,m,y,v)),this.rpcClient.addRequestMethod("notebooksService.cancelCellExecution",(h,m,y,v)=>this.cancelCellExecution(h,m,y,v)),this.rpcClient.addRequestMethod("notebooksService.cancelNotebookExecution",(h,m,y)=>this.cancelNotebookExecution(h,m,y)),this.rpcClient.addRequestMethod("notebooksService.changeCellLanguage",(h,m,y,v)=>this.changeCellLanguage(h,m,y,v)),this.rpcClient.addRequestMethod("notebooksService.applyNotebookCellChanges",(h,m,y)=>this.applyNotebookCellChanges(h,m,y)),yield this.workspaceService.registerServicesAsync(["notebooksService"],w.vsls.CollectionChangeType.Add)}}))}createCellManager(h){const m=this.pathManager.localPathToRelativePath(h.uri);this.cellManagers[m]||(this.cellManagers[m]=new P.HostCellManager(h,this.pathManager,this.fileService,this.session.coeditingClient))}_onDidOpenNotebookDocument(h){this.createCellManager(h)}requestExecuteCellsAccess(h,m){return v(this,void 0,void 0,(function*(){try{const m=T.localize("notebooks.executeCellsAllowForSession"),y=T.localize("notebooks.executeCellsAllowAlways"),v=T.localize("notebooks.executeCellsReject"),A=yield C.window.showInformationMessage(T.localize("notebooks.executeCellsRequested"),m,y,v);A===m?this.allowGuestExecuteCellsForSession=!0:A===y&&T.Settings.save(T.SettingKeys.allowGuestExecuteCells,!0);const P=A===m||A===y?w.vsls.RestrictedOperationAccess.Allowed:w.vsls.RestrictedOperationAccess.ExplicitlyRejectedByHost;yield this.workspaceAccessControlService().setOperationAccessAsync(h,P)}catch(m){const y=`Requesting access for '${h?h.name:"null"}' operation failed: ${m.message}`;this.trace.error(y),A.Telemetry.sendFault(T.TelemetryEventNames.REQUEST_OPERATION_ACCESS_FAULT,A.FaultType.NonBlockingFault,y,m)}}))}getContentProviders(h){return v(this,void 0,void 0,(function*(){const h=yield C.commands.executeCommand("_resolveNotebookContentProvider");let m=[];return h&&(m=h.map(h=>({viewType:h.viewType,displayName:h.displayName,priority:"default",selector:h.filenamePattern.map(h=>"string"==typeof h?{filenamePattern:h}:{filenamePattern:h.include,excludeFileNamePattern:h.exclude})}))),m}))}openNotebook(h,m,y){return v(this,void 0,void 0,(function*(){if(yield this.fileService().isExcludedAsync(h,{enableMultipleRoots:!0}))throw new Error("Notebook unavailable");const y=this.pathManager.relativePathToLocalPath(h),v=yield C.workspace.openNotebookDocument(y);this.createCellManager(v),yield this.cellManagers[h].init();const w={usedNotebookType:v.notebookType!==m?v.notebookType:void 0,metadata:v.metadata,cells:v.getCells().map(h=>T.getNotebookCellData(h))};return w.languages=v.languages,w}))}applyNotebookCellChanges(h,m,y){T.assert(!!this.cellManagers[h],"Host should have cell manager for notebook guest is trying to modify"),this.cellManagers[h]&&this.cellManagers[h].applyChanges(m)}handleLanguageChange(h,m,y){const v={relativePath:this.pathManager.localPathToRelativePath(h),cellId:y,language:m};this.rpcClient.sendNotification(this.trace,"notebooksService.didChangeCellLanguage",v)}_onDidChangeNotebookCells(h){return v(this,void 0,void 0,(function*(){const m=this.pathManager.localPathToRelativePath(h.document.uri);if(T.assert(!!this.cellManagers[m],"Host should have cell manager for notebook being changed"),this.cellManagers[m]){const y=[...h.document.getCells()],v=yield this.cellManagers[m].onDidChangeNotebookCells(h);T.sortCells(y);const C={relativePath:m,changes:v,contentHash:T.getNotebookHash(y)};this.rpcClient.sendNotification(this.trace,"notebooksService.didChangeNotebookCells",C)}}))}ensureNotebookEditor(h,m){return v(this,void 0,void 0,(function*(){if(!C.window.visibleNotebookEditors.find(m=>m.document.uri.toString()===h.toString())){const m=yield C.workspace.openNotebookDocument(h);yield C.window.showNotebookDocument(m,{preserveFocus:!0})}}))}executeCell(h,m,y,A,P){return v(this,void 0,void 0,(function*(){if(!(yield this.clientAccessCheck().canPerformOperation(A,this.executeCellOperation))){const h=(yield this.clientAccessCheck().isClientReadOnly(A))?w.vsls.RestrictedOperationAccess.RejectedInReadOnlySession:w.vsls.RestrictedOperationAccess.DisabledByHostConfiguration;return void this.workspaceAccessControlService().rejectOperationAsync({name:T.WellKnownRestrictedOperations.ExecuteNotebookCell,sessionId:A.GuestSessionId},h)}const v=this.pathManager.relativePathToLocalPath(m);yield this.ensureNotebookEditor(v,y),C.commands.executeCommand("notebook.cell.execute",h,v)}))}executeNotebook(h,m,y,A){return v(this,void 0,void 0,(function*(){if(!(yield this.clientAccessCheck().canPerformOperation(y,this.executeCellOperation))){const h=(yield this.clientAccessCheck().isClientReadOnly(y))?w.vsls.RestrictedOperationAccess.RejectedInReadOnlySession:w.vsls.RestrictedOperationAccess.DisabledByHostConfiguration;return void this.workspaceAccessControlService().rejectOperationAsync({name:T.WellKnownRestrictedOperations.ExecuteNotebookCell,sessionId:y.GuestSessionId},h)}const v=this.pathManager.relativePathToLocalPath(h);yield this.ensureNotebookEditor(v,m),yield C.commands.executeCommand("notebook.execute",v)}))}cancelCellExecution(h,m,y,T){return v(this,void 0,void 0,(function*(){const v=this.pathManager.relativePathToLocalPath(m);yield this.ensureNotebookEditor(v,y),yield C.commands.executeCommand("notebook.cell.cancelExecution",h,v)}))}changeCellLanguage(h,m,y,w){return v(this,void 0,void 0,(function*(){const v=this.pathManager.relativePathToLocalPath(y),w=C.window.visibleNotebookEditors.find(h=>h.document.uri.path===v.path);if(!w)return;const A=w.document.getCells().find(m=>T.getCellId(m)===h);A&&A.document.languageId!==m&&C.languages.setTextDocumentLanguage(A.document,m)}))}cancelNotebookExecution(h,m,y){return v(this,void 0,void 0,(function*(){const y=this.pathManager.relativePathToLocalPath(h);yield this.ensureNotebookEditor(y,m),yield C.commands.executeCommand("notebook.cancelExecution",y)}))}onDidChangeCellOutputs(h){const m={relativePath:this.pathManager.localPathToRelativePath(h.document.uri),cells:h.cells.map(h=>({id:T.getCellId(h),outputs:[...h.outputs]}))};this.rpcClient.sendNotification(this.trace,"notebooksService.didChangeCellOutputs",m)}_onDidChangeNotebookCellExecutionState(h){var m,y;const v=T.getCellId(h.cell);if(!v)return void T.assert(!!v,"Host should have cell id for cell whose execution state is being changed");const C=h.cell.executionSummary,w={relativePath:this.pathManager.localPathToRelativePath(h.cell.notebook.uri),cellId:v,executionState:h.state,executionSummary:{success:null==C?void 0:C.success,timing:{startTime:null===(m=null==C?void 0:C.timing)||void 0===m?void 0:m.startTime,endTime:null===(y=null==C?void 0:C.timing)||void 0===y?void 0:y.endTime}}};this.rpcClient.sendNotification(this.trace,"notebooksService.didChangeCellExecutionState",w)}onDidChangeCellMetadata(h){const m={relativePath:this.pathManager.localPathToRelativePath(h.document.uri),cell:{id:T.getCellId(h.cell),metadata:h.cell.metadata}};this.rpcClient.sendNotification(this.trace,"notebooksService.didChangeCellMetadata",m)}dispose(){const h=Object.create(null,{dispose:{get:()=>super.dispose}});return v(this,void 0,void 0,(function*(){if(h.dispose.call(this),this.session.isStartingCollaboration||this.session.isCollaborating)try{yield this.workspaceService.registerServicesAsync(["notebooksService"],w.vsls.CollectionChangeType.Remove)}catch(h){}}))}}m.HostNotebooksService=HostNotebooksService},function(h,m,y){"use strict";var v=this&&this.__awaiter||function(h,m,y,v){return new(y||(y=Promise))((function(C,T){function fulfilled(h){try{step(v.next(h))}catch(h){T(h)}}function rejected(h){try{step(v.throw(h))}catch(h){T(h)}}function step(h){h.done?C(h.value):function adopt(h){return h instanceof y?h:new y((function(m){m(h)}))}(h.value).then(fulfilled,rejected)}step((v=v.apply(h,m||[])).next())}))};Object.defineProperty(m,"__esModule",{value:!0});const C=y(0),T=y(4),w=y(3),A=y(602),P=y(603),k=y(601),R=y(1478),M={name:w.WellKnownRestrictedOperations.ExecuteNotebookCell};class GuestNotebooksService extends k.notebooksServiceBase{constructor(h,m){super(),this.waitingForCellExecutionAccess=!1,this.hasRequestedCellExecutionAccess=!1,this.cellManagers={},this.remoteChangesQueue=Promise.resolve(),this.service=m,this.pathManager=h.pathManager(),this.session=h.sessionContext(),this.workspaceAccessControlService=h.workspaceAccessControlService,this.trace=h.trace().withName("Notebooks")}init(){const h=Object.create(null,{init:{get:()=>super.init}});var m,y,A;return v(this,void 0,void 0,(function*(){if(h.init.call(this),"function"==typeof(null===(m=C.notebooks)||void 0===m?void 0:m.onDidChangeCellOutputs)){try{C.workspace.notebookDocuments}catch(h){return}yield this.initContentProviders(),this.disposables.push(C.workspace.onDidOpenNotebookDocument(h=>this.onDidOpenNotebookDocument(h))),this.disposables.push(null===(y=C.notebooks)||void 0===y?void 0:y.onDidChangeNotebookCells(h=>this._onDidChangeNotebookCells(h))),this.disposables.push(this.workspaceAccessControlService().onOperationRejected(h=>v(this,void 0,void 0,(function*(){h.operation.name===w.WellKnownRestrictedOperations.ExecuteNotebookCell&&h.operation.sessionId===w.workspaceSessionInfoTracker.workspaceSessionInfo.sessionNumber&&this.executeNotebookCellRejected(h.access)})))),this.disposables.push(this.workspaceAccessControlService().onOperationAccessChanged(h=>v(this,void 0,void 0,(function*(){if(h.operation.name===w.WellKnownRestrictedOperations.ExecuteNotebookCell&&(h.access==T.vsls.RestrictedOperationAccess.Allowed&&this.hasRequestedCellExecutionAccess||this.waitingForCellExecutionAccess)){this.waitingForCellExecutionAccess=!1;const m=h.access===T.vsls.RestrictedOperationAccess.Allowed,y=m?w.localize("notebooks.executeCellsAccessGranted"):w.localize("notebooks.executeCellsAccessDenied");C.window.showInformationMessage(y),this.notebookController.handleExecutionRequests(m)}})))),"function"==typeof(null===(A=C.notebooks)||void 0===A?void 0:A.createNotebookController)&&(this.notebookController=new R.NotebookController(this.pathManager,this.service),this.notebookController.createNotebookController(),this.disposables.push(this.notebookController)),this.service.onDidChangeCellOutputs(h=>this.onDidChangeCellOutputs(h)),this.service.onDidChangeCellMetadata(h=>this.onHostDidChangeCellMetadata(h)),this.service.onDidChangeCellLanguage(h=>this.onHostDidChangeCellLanguage(h)),this.service.onDidChangeNotebookCells(h=>this.onHostDidChangeNotebookCells(h)),this.service.onDidChangeCellExecutionState(h=>this.onDidChangeCellExecutionState(h))}}))}onDidChangeCellOutputs(h){const m=C.window.visibleNotebookEditors.find(m=>m.document.uri.path===h.relativePath);m&&h.cells.forEach(h=>{const y=this.getCellFromActiveEditor(m,h.id);y&&this.notebookController.updateOutput(y,[...h.outputs])})}onDidChangeCellExecutionState(h){const m=C.window.visibleNotebookEditors.find(m=>m.document.uri.path===h.relativePath);if(!m)return;const y=this.getCellFromActiveEditor(m,h.cellId);y&&this.notebookController.updateExecutionState(y,h.relativePath,h.executionState,h.executionSummary.success)}getCellFromActiveEditor(h,m){return h.document.getCells().find(h=>w.getCellId(h)===m)}handleLanguageChange(h,m,y){const v=this.pathManager.localPathToRelativePath(h);this.service.changeCellLanguageAsync(y,m,v)}onDidOpenNotebookDocument(h){if(h.notebookType.startsWith(w.NotebookConstants.mirrorNotebookTypePrefix)){const m=this.pathManager.localPathToRelativePath(h.uri);this.cellManagers[m]||(this.cellManagers[m]=new A.GuestCellManager(h,this.pathManager,this.session.coeditingClient))}else C.window.showWarningMessage(w.localize("notebooks.openedWithLocalContentProvider"))}onHostDidChangeNotebookCells(h){this.cellManagers[h.relativePath]&&(this.remoteChangesQueue=this.remoteChangesQueue.then(()=>this.cellManagers[h.relativePath].onHostDidChangeNotebookCells(h)))}_onDidChangeNotebookCells(h){return v(this,void 0,void 0,(function*(){const m=this.pathManager.localPathToRelativePath(h.document.uri);if(w.assert(!!this.cellManagers[m],"Guest should have cell manager for notebook being changed"),this.cellManagers[m]){const y=yield this.cellManagers[m].onDidChangeNotebookCells(h);0!==y.length&&this.service.applyNotebookCellChangesAsync(m,y)}}))}executeNotebookCellRejected(h){return v(this,void 0,void 0,(function*(){if(h===T.vsls.RestrictedOperationAccess.RejectedInReadOnlySession)return void C.window.showInformationMessage(w.localize("notebooks.executeCellsReadOnly"));const m=w.localize("notebooks.executeCellsRequestAccess");(yield C.window.showInformationMessage(w.localize("notebooks.executeCellsLackingPermission"),m))===m?(this.hasRequestedCellExecutionAccess=!0,this.waitingForCellExecutionAccess=!0,this.workspaceAccessControlService().requestOperationAccessAsync(M)):this.notebookController.handleExecutionRequests(!1)}))}initContentProviders(){return v(this,void 0,void 0,(function*(){let h=[];try{h=yield this.service.getContentProvidersAsync()}catch(h){}h.forEach(h=>{const m=`${w.NotebookConstants.mirrorNotebookTypePrefix}${h.viewType}`,y=new P.NotebookContentProvider(h.viewType,this.service);this.disposables.push(C.workspace.registerNotebookContentProvider(m,y,{transientOutputs:!1,transientCellMetadata:{},transientDocumentMetadata:{}},{displayName:`Live Share - ${h.displayName}`,filenamePattern:h.selector.map(h=>h.excludeFileNamePattern?{include:h.filenamePattern,exclude:h.excludeFileNamePattern}:h.filenamePattern),exclusive:!0}))})}))}onHostDidChangeCellMetadata(h){const m=C.window.visibleNotebookEditors.find(m=>m.document.uri.path===h.relativePath);if(!m)return;const y=m.document.getCells().find(m=>w.getCellId(m)===h.cell.id);if(y){const v=new C.WorkspaceEdit;v.replaceNotebookCellMetadata(m.document.uri,y.index,h.cell.metadata),C.workspace.applyEdit(v)}}onHostDidChangeCellLanguage(h){const m=C.window.visibleNotebookEditors.find(m=>m.document.uri.path===h.relativePath);if(!m)return;const y=m.document.getCells().find(m=>w.getCellId(m)===h.cellId);y&&y.document.languageId!==h.language&&C.languages.setTextDocumentLanguage(y.document,h.language)}}m.GuestNotebooksService=GuestNotebooksService},function(h,m,y){"use strict";var v=this&&this.__awaiter||function(h,m,y,v){return new(y||(y=Promise))((function(C,T){function fulfilled(h){try{step(v.next(h))}catch(h){T(h)}}function rejected(h){try{step(v.throw(h))}catch(h){T(h)}}function step(h){h.done?C(h.value):function adopt(h){return h instanceof y?h:new y((function(m){m(h)}))}(h.value).then(fulfilled,rejected)}step((v=v.apply(h,m||[])).next())}))};Object.defineProperty(m,"__esModule",{value:!0});const C=y(3),T=y(0);m.NotebookController=class NotebookController{constructor(h,m){this.pathManager=h,this.service=m,this.runningExecutionTasks=new Map,this.label="Live Share Controller",this.id="LiveShare-Controller",this.notebookType="*",this.description="Visual Studio Live Share Controller",this.detail=C.localize("notebooks.kernelDetail"),this.executeHandler=(h,m,y)=>this.controllerHandler(h,m,y)}createNotebookController(){var h;this.controller=null===(h=T.notebooks)||void 0===h?void 0:h.createNotebookController(this.id,this.notebookType,this.label,this.executeHandler);for(let h of T.workspace.notebookDocuments)this.controller.updateNotebookAffinity(h,T.NotebookControllerAffinity.Preferred);return this.controller}controllerHandler(h,m,y){return v(this,void 0,void 0,(function*(){if(C.workspaceSessionInfoTracker.isReadOnly)T.window.showInformationMessage(C.localize("notebooks.executeCellsReadOnly"));else{for(var y of h)this.startExecutionTask(y,this.pathManager.localPathToRelativePath(y.notebook.uri));h.length!==m.cellCount?this.service.executeCellAsync({start:h[0].index,end:h[h.length-1].index+1},this.pathManager.localPathToRelativePath(m.uri),m.notebookType.substring(C.NotebookConstants.mirrorNotebookTypePrefix.length)):this.service.executeNotebookAsync(this.pathManager.localPathToRelativePath(m.uri),m.notebookType.substring(C.NotebookConstants.mirrorNotebookTypePrefix.length))}}))}_onDidCancelExecution(h){this.service.cancelCellExecutionAsync({start:h.range,end:h.range+1},h.path,h.type)}startExecutionTask(h,m){const y=this.controller.createNotebookCellExecution(h);y.token.onCancellationRequested(()=>this._onDidCancelExecution({range:h.index,path:m,type:h.notebook.notebookType})),y.start(),this.runningExecutionTasks.set(C.getCellId(h),{task:y,cell:h})}updateExecutionState(h,m,y,v){let w=this.getExecutionTask(C.getCellId(h));if(!w||y!=T.NotebookCellExecutionState.Executing)if(w||y!=T.NotebookCellExecutionState.Executing||this.startExecutionTask(h,m),y===T.NotebookCellExecutionState.Executing)try{w.start()}catch(h){}else if(y===T.NotebookCellExecutionState.Idle){let m=v;void 0===m&&(m=!1);try{w.end(m)}catch(h){}this.runningExecutionTasks.delete(C.getCellId(h))}}getExecutionTask(h){var m;return null===(m=this.runningExecutionTasks.get(h))||void 0===m?void 0:m.task}getExecutionCell(h){var m;return null===(m=this.runningExecutionTasks.get(h))||void 0===m?void 0:m.cell}updateOutput(h,m){try{let v=this.getExecutionTask(C.getCellId(h));const w=!!v;w||(v=this.controller.createNotebookCellExecution(h),v.start());let A=[],P=!0;if(0===m.length)A.push(new T.NotebookCellOutputItem(new Uint8Array,"text/html"));else for(var y of m[0].items){const h=Object.values(y.data);let m=new Uint8Array;"object"==typeof h[1]&&(m=Uint8Array.from(h[1])),A.push(new T.NotebookCellOutputItem(m,y.mime)),y.mime!==C.NotebookConstants.notebookErrorMimeType&&y.mime!==C.NotebookConstants.notebookStandardErrorMimeType||(P=!1)}v.replaceOutput(new T.NotebookCellOutput(A)),w||v.end(P)}catch(h){}}handleExecutionRequests(h){if(h)for(let h of this.runningExecutionTasks.keys()){const m=this.runningExecutionTasks.get(h).cell;this.service.executeCellAsync({start:m.index,end:m.index+1},this.pathManager.localPathToRelativePath(m.notebook.uri),m.notebook.notebookType.substring(C.NotebookConstants.mirrorNotebookTypePrefix.length))}else for(let h of this.runningExecutionTasks.keys())try{const m=this.runningExecutionTasks.get(h);m.task.end(!1),this.runningExecutionTasks.delete(C.getCellId(m.cell))}catch(h){}}dispose(){this.controller.dispose()}}},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0});const v=y(0),C=y(5),T=y(3);m.builder=function builder(h){return new SignInTokenCommand(h)};class SignInTokenCommand extends C.CommandBase{constructor(h){super(),this.dependencies=h}async invoke(h,m){if(T.userAuthStateTracker.IsSignedIn&&!T.userAuthStateTracker.isCurrentUserAnonymous())return void v.window.showInformationMessage("You are already signed in.");let y=await v.window.showInputBox({prompt:"Please enter your user code",ignoreFocusOut:!0});if(y)try{const h=await T.liveshareGithubStrategy.exchangeAuthorizationCode(y);h&&(await this.dependencies.authenticationProvider().attemptLoginVSCodeAccount(h),T.liveshareGithubStrategy.signalNewToken(h),T.sessionStateTracker.transition(T.SessionAction.SignInSuccess),v.window.showInformationMessage("User code setup succeeded"))}catch(h){await v.window.showErrorMessage(`Failed to use user code. Err: ${null==h?void 0:h.tostring()}`)}else T.sessionStateTracker.transition(T.SessionAction.SignInError)}}},function(h,m,y){"use strict";var v=this&&this.__decorate||function(h,m,y,v){var C,T=arguments.length,w=T<3?m:null===v?v=Object.getOwnPropertyDescriptor(m,y):v;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)w=Reflect.decorate(h,m,y,v);else for(var A=h.length-1;A>=0;A--)(C=h[A])&&(w=(T<3?C(w):T>3?C(m,y,w):C(m,y))||w);return T>3&&w&&Object.defineProperty(m,y,w),w};Object.defineProperty(m,"__esModule",{value:!0});const C=y(6),T=y(5),w=y(292),A=y(64),P=y(80),k=y(3),R=y(319),M=y(586),N=y(16),D=y(528),I=y(1481),x=y(508),O=y(488),L=y(4),U=y(2),B=y(326),W=y(592),q=y(598),Y=y(584),V=y(1506),$=y(1507),z=y(298),G={statusPostAuth:k.SessionAction.AttemptSharing,authAttemptMax:1};m.shareCommandBuilder=function shareCommandBuilder(h){return new X(h)},m.endCommandBuilder=function endCommandBuilder(h){return new EndCollaborationCommand(h)};let J=U.createDisposable(()=>{throw new Error("Invalid operation")}),X=class ShareCommand extends T.CommandBase{constructor(h){super(),this.dependencies=h}async invoke(h,m){var y;const v=k.createWorkspaceApi(this.dependencies),G=k.ShareCommandUtilities.buildShareInfo()[0],X=await O.createDirectConnectionProvider(T.traceSource.withName("DirectConnectionProvider"));let Z;X&&(G.connectLinks=X.connectLinks);try{Z=await v.createSharedWorkspace(G)}catch(h){throw T.traceSource.error("Failed to create the shared workspace",h),null==X||X.dispose(),h}const ee=[],te=new k.SourceEventService;ee.push(te);const re=new D.WorkspaceServer(Z,T.traceSource.withName("WorkspaceServer")),[ie,se]=N.createDuplexRpcMessageStreams(),oe=re.acceptRpcMessageStream(se);oe[0].listen();const ae=oe[1],ce=C.createMessageConnection(ie.reader,ie.writer);ce.listen(),this.dependencies.agentRpcServer.onHandleNoneRequest((h,m,...y)=>N.sendRpcRequest(ce,m,y)),this.dependencies.agentRpcServer.onHandleNoneNotification((h,m,...y)=>{N.rpcUtils.notifyConnections(re.rpcConnections.slice(1),m,y)}),ce.onNotification((h,...m)=>{this.dependencies.agentRpcServer.sendNotification(T.traceSource,h,m)});const le=this.dependencies.agentRpcServer.rpcConnections[0];re.onHandleNoneRequest((h,m,...y)=>N.sendRpcRequest(le,m,y)),re.onHandleNoneNotification((h,m,...y)=>{le.sendNotification(m,...y)});const ue=new k.WorkspaceAccessControlService(ae);ee.push(ue);const de=new k.WorkspaceUserService(h=>re.closeSshSession(h));ee.push(de);const he=new k.WorkspaceService(re,de,ue,v,T.traceSource.withName("WorkspaceService"));ee.push(he);const pe=[];pe.push(U.createDisposable(async()=>{he.fireConnectionStatusChanged(L.vsls.WorkspaceConnectionStatus.Disconnected,L.vsls.WorkspaceDisconnectedReason.SessionEnded),await v.deleteWorkspace(Z.workspaceInfo.id)})),pe.push(re),pe.push(ce),Z.workspaceInfo.relayLink&&pe.push(re.registerRpcServerProvider(I.createHybridRpcServerProvider(Z.workspaceInfo,T.traceSource.withName("AzureRelayProvider"))));const me=await P.dependencies.hubConnectionServiceFactory().getOrCreate();await me.setEnabled(!0);const fe=me.getOrCreateProxy(P.HubProxyType.RelayService);k.Settings.get("traceHubData")&&(fe.traceHubData=!0),pe.push(re.registerRpcServerProvider(x.createRelayHubProxyServerProvider(fe,Z.workspaceInfo.id,T.traceSource.withName("SignalRProvider")))),X&&pe.push(re.registerRpcServerProvider(X));const ye=await this.dependencies.authService().getCurrentUserAsync(),ve={id:ye.id,email:null!==(y=ye.emailAddress)&&void 0!==y?y:"",avatarUri:ye.avatarUri,userName:ye.userName,provider:ye.providerName,isAnonymous:!1,isOwner:!0,isHost:!0,isOnlineUser:!1,clientCapabilities:{extensionReadOnlySupport:!0,clientReadOnlySupport:!0}};re.addUserProfile(ve,{session:ae,connection:oe[0]}),this.dependencies.hostSessionId.value=ae;const Se={id:Z.workspaceInfo.id,name:Z.workspaceInfo.name,ownerId:ve.id,conversationId:Z.workspaceInfo.conversationId,sessionNumber:this.dependencies.hostSessionId(),accessControl:{defaultAccessControl:{isReadOnly:!1},userAccessControl:{}},connectionMode:L.vsls.ConnectionMode.Local,sessions:re.joinedProfiles,joinUri:Z.workspaceInfo.joinLink};k.workspaceSessionInfoTracker.workspaceSessionInfo=Se;const Ee=new k.AccessControlService(this.dependencies);this.dependencies.agentRpcServer.registerRpcService(Ee,Ee.serviceInfo);const Ce=new k.FileService(re,{},this.dependencies.pathManager(),this.dependencies.accessControlManager,T.traceSource.withName("FileService"),ae);ee.push(Ce),ee.push(new k.HostSyncService({},k.SessionContext,re,T.traceSource.withName("HostSyncService")));const _e=new w.ChatService(this.dependencies);ee.push(_e);const Te=new Y.TaskOutputService(re,T.traceSource.withName("TaskOutputService"));ee.push(Te),re.registerStreamProvider(Te),ee.forEach(h=>{re.registerRpcService(h,h.serviceInfo,h.contextMethods)}),re.addRequestMethodWithProgress(L.vsls.FileService.name+".getTextSearchResultsWithProgress",(h,m,y)=>Ce.getTextSearchResultsWithProgressAsync(h,m,y)),re.addRequestMethodWithProgress(L.vsls.FileService.name+".readTextWithProgress",(h,m,y,v)=>Ce.readTextWithProgressAsync(h,m,y,v)),await this.dependencies.accessControlManager().init(),pe.push(U.createDisposable(()=>this.dependencies.accessControlManager().dispose())),await B.initCoEditingContext(this.dependencies,!1),k.SessionContext.notJoining();const be=[];be.push(this.dependencies.coEditingCommands()),be.push(R.reviewsDependencies.hostCommentService()),be.push(R.reviewsDependencies.commentManager());const we=new R.HostSourceControlService(this.dependencies,this.dependencies.accessControlManager);be.push(we);const Ae=new R.HostCoauthorCommitMessageUpdater(this.dependencies,we);be.push(Ae),[V.registerHostTerminal,$.registerServerSharingService].forEach(h=>{const m=h(re,this.dependencies);m&&be.push(m)}),be.push(new Y.WorkspaceTaskService(this.dependencies)),be.push(new z.BreakpointManager(!0,this.dependencies.sourceEventService(),this.dependencies.pathManager())),be.push({init:async()=>{await this.dependencies.trackDebugManager().setShareState(!0)},dispose:async()=>{await this.dependencies.trackDebugManager().setShareState(!1)}}),be.push({init:()=>M.lspServer.activateAsync(he,this.dependencies.pathManager(),this.dependencies.accessControlManager,k.SessionContext,re),dispose:()=>M.lspServer.dispose()}),be.push(this.dependencies.pathManager());const Pe=new q.HostNotebooksService(this.dependencies,this.dependencies.accessControlManager);be.push(Pe),await Promise.all(be.map(h=>h.init())),pe.push(U.createDisposable(()=>Promise.all(be.map(h=>h.dispose())))),pe.push(await W.default(this.dependencies)),J=U.createDisposablesSeries(T.traceSource,...pe),await re.acceptConnections(),h&&h.access===A.Access.ReadOnly&&await this.dependencies.workspaceAccessControlManager().setReadOnly(!0),k.showInvitationLink(this.dependencies.workspaceAccessControlManager())}async onCancellationRequested(h,m){}};X=v([k.cancellationDecorator(),k.errorNotificationCommandDecorator("Starting collaboration session",k.TelemetryEventNames.SHARE_FAULT,!0,async(h,m,y)=>{}),k.telemetryCommandDecorator(k.TelemetryEventNames.SHARE_WORKSPACE,k.TelemetryEventNames.SHARE_FAULT,"Share",1,(h,m)=>{}),k.telemetryStatusCommandDecorator(),k.validationCommandDecorator(),k.sessionStateTransitionsCommandDecorator(k.SessionAction.AttemptSharing,k.SessionAction.SharingSuccess,k.SessionAction.SharingError),k.progressCommandDecorator(),k.authenticationCommandDecorator(G)],X);class EndCollaborationCommand extends T.CommandBase{constructor(h){super(),this.dependencies=h}invoke(h,m){return k.ExtensionUtil.runWithProgress(async()=>{this.dependencies.agentRpcServer.clear(),await J.dispose(),k.sessionStateTracker.transition(k.SessionAction.EndSharing)},{title:"Ending Collaboration Session"})}}},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0});var v=y(1482);m.createHybridRpcServerProvider=v.createHybridRpcServerProvider},function(h,m,y){"use strict";var v=this&&this.__importStar||function(h){if(h&&h.__esModule)return h;var m={};if(null!=h)for(var y in h)Object.hasOwnProperty.call(h,y)&&(m[y]=h[y]);return m.default=h,m};Object.defineProperty(m,"__esModule",{value:!0});const C=v(y(6)),T=y(182),w=y(1483),A=y(1484).relayedServer;m.createHybridRpcServerProvider=function createHybridRpcServerProvider(h,m){const y=new C.Emitter,v=new C.Emitter,P=new C.Emitter,k=T.SshHelpers.getRelayUri(h,"listen");return{name:"hybrid",onRpcStreamJoined:y.event,onClose:v.event,onError:P.event,acceptConnections(C){if(T.isNode()){const C=new A({server:k,token:h.relaySas,autoAcceptConnections:!0});C.on("connect",h=>{m.info(`Azure relay provider accepting connections on serverUrl:${k}`),y.fire(T.SshHelpers.createWebSocketStreamAdapter(h))}),C.on("close",(h,m,y)=>{v.fire(new Error(y))})}else{const h=new w.HybridConnectionsWebSocketServer({server:k},h=>T.SshHelpers.webSshStreamFactory(h).then(h=>y.fire(h)),m.createChild("HybridConnections"));h.on("error",h=>P.fire(h)),h.on("close",h=>v.fire(h))}return Promise.resolve()}}}},function(h,m,y){"use strict";var v=this&&this.__importStar||function(h){if(h&&h.__esModule)return h;var m={};if(null!=h)for(var y in h)Object.hasOwnProperty.call(h,y)&&(m[y]=h[y]);return m.default=h,m};Object.defineProperty(m,"__esModule",{value:!0});const C=v(y(13)),isDefinedAndNonNull=(h,m)=>void 0!==h[m]&&null!==h[m];class HybridConnectionsWebSocketServer extends C.EventEmitter{constructor(h,m,y){if(super(),this.callback=m,this.logger=y,h=Object.assign({server:null,token:null,verifyClient:null,handleProtocols:null,disableHixie:!1,clientTracking:!0,perMessageDeflate:!0,maxPayload:104857600,backlog:null},h),!isDefinedAndNonNull(h,"server"))throw new TypeError("'server' must be provided");this.listenUri=h.server,this.closeRequested=!1,this.options=h,this.clients=[],this.connectControlChannel()}close(h){var m;this.closeRequested=!0;let y=null;try{for(let h=0,m=this.clients.length;h<m;++h)this.clients[h].close();null===(m=this.controlChannel)||void 0===m||m.close()}catch(h){y=h}if(h)h(y);else if(y)throw y}connectControlChannel(){this.controlChannel=new WebSocket(this.listenUri),this.controlChannel.onerror=h=>{this.emit("error",h),this.closeRequested||this.connectControlChannel()},this.controlChannel.onopen=h=>{this.emit("listening"),this.logger.info(`Azure relay provider accepting connections on serverUrl:${this.options.server}`)},this.controlChannel.onclose=h=>{this.closeRequested?this.emit("close",this):this.connectControlChannel()},this.controlChannel.onmessage=h=>{const m=JSON.parse(h.data);isDefinedAndNonNull(m,"accept")&&this.accept(m)}}accept(h){this.logger.verbose(`accept -> message:${JSON.stringify(h)}`);const m=h.accept.address,y={headers:{}};for(let m=Object.keys(h.accept.connectHeaders),v=m.length;v;--v)y.headers[m[v-1].toLowerCase()]=h.accept.connectHeaders[m[v-1]];if(!y.headers["sec-websocket-key"])return void this.abortConnection(h,400,"Bad Request");const v=y.headers["sec-websocket-protocol"],C=this,completeHybridUpgrade=h=>{try{const y=new WebSocket(m,h);y.onerror=h=>{const m=C.clients.indexOf(y);-1!==m&&C.clients.splice(m,1)},C.callback(y),C.options.clientTracking&&(C.clients.push(y),y.onclose=()=>{const h=C.clients.indexOf(y);-1!==h&&C.clients.splice(h,1)})}catch(h){this.logger.error("completeHybridUpgrade failed",h)}};completeHybridUpgrade(void 0!==v?v.split(/, */)[0]:void 0)}abortConnection(h,m,y){const v=h.address+"&statusCode="+m+"&statusDescription="+encodeURIComponent(y);new WebSocket(v).onerror=h=>{this.emit("requestRejected",this)}}}m.HybridConnectionsWebSocketServer=HybridConnectionsWebSocketServer},function(h,m,y){"use strict";var v=y(11),C=y(1),T=y(20),w=h.exports=y(1486);w.createRelayToken=function createRelayToken(h,m,y,w){var A=T.parse(h);A.protocol="http",A.search=A.hash=A.port=null,A.pathname=A.pathname.replace("$hc/",""),h=T.format(A),w||(w=3600);var P=C().add(w,"seconds").unix(),k=encodeURIComponent(h)+"\n"+P,R=v.createHmac("sha256",y);R.update(k);var M=R.digest("base64");return"SharedAccessSignature sr="+encodeURIComponent(h)+"&sig="+encodeURIComponent(M)+"&se="+P+"&skn="+m},w.appendRelayToken=function appendRelayToken(h,m,y,v){var C=w.createRelayToken(h,m,y,v),A=T.parse(h);return A.search=A.search+"&sb-hc-token="+encodeURIComponent(C),T.format(A)},w.createRelayBaseUri=function createRelayBaseUri(h,m){return"wss://"+h+":443/$hc/"+m},w.createRelaySendUri=function createRelaySendUri(h,m,y,v){var C=w.createRelayBaseUri(h,m);return C=C+(-1==C.indexOf("?")?"?":"&")+"sb-hc-action=connect",null!=y&&(C=C+"&sb-hc-token="+encodeURIComponent(y)),null!=v&&(C=C+"&sb-hc-id="+encodeURIComponent(v)),C},w.createRelayListenUri=function createRelayListenUri(h,m,y,v){var C=w.createRelayBaseUri(h,m);return C=C+(-1==C.indexOf("?")?"?":"&")+"sb-hc-action=listen",null!=y&&(C=C+"&sb-hc-token="+encodeURIComponent(y)),null!=v&&(C=C+"&sb-hc-id="+encodeURIComponent(v)),C}},function(h,m,y){var v={"./af":604,"./af.js":604,"./ar":605,"./ar-dz":606,"./ar-dz.js":606,"./ar-kw":607,"./ar-kw.js":607,"./ar-ly":608,"./ar-ly.js":608,"./ar-ma":609,"./ar-ma.js":609,"./ar-sa":610,"./ar-sa.js":610,"./ar-tn":611,"./ar-tn.js":611,"./ar.js":605,"./az":612,"./az.js":612,"./be":613,"./be.js":613,"./bg":614,"./bg.js":614,"./bm":615,"./bm.js":615,"./bn":616,"./bn.js":616,"./bo":617,"./bo.js":617,"./br":618,"./br.js":618,"./bs":619,"./bs.js":619,"./ca":620,"./ca.js":620,"./cs":621,"./cs.js":621,"./cv":622,"./cv.js":622,"./cy":623,"./cy.js":623,"./da":624,"./da.js":624,"./de":625,"./de-at":626,"./de-at.js":626,"./de-ch":627,"./de-ch.js":627,"./de.js":625,"./dv":628,"./dv.js":628,"./el":629,"./el.js":629,"./en-au":630,"./en-au.js":630,"./en-ca":631,"./en-ca.js":631,"./en-gb":632,"./en-gb.js":632,"./en-ie":633,"./en-ie.js":633,"./en-il":634,"./en-il.js":634,"./en-in":635,"./en-in.js":635,"./en-nz":636,"./en-nz.js":636,"./en-sg":637,"./en-sg.js":637,"./eo":638,"./eo.js":638,"./es":639,"./es-do":640,"./es-do.js":640,"./es-us":641,"./es-us.js":641,"./es.js":639,"./et":642,"./et.js":642,"./eu":643,"./eu.js":643,"./fa":644,"./fa.js":644,"./fi":645,"./fi.js":645,"./fil":646,"./fil.js":646,"./fo":647,"./fo.js":647,"./fr":648,"./fr-ca":649,"./fr-ca.js":649,"./fr-ch":650,"./fr-ch.js":650,"./fr.js":648,"./fy":651,"./fy.js":651,"./ga":652,"./ga.js":652,"./gd":653,"./gd.js":653,"./gl":654,"./gl.js":654,"./gom-deva":655,"./gom-deva.js":655,"./gom-latn":656,"./gom-latn.js":656,"./gu":657,"./gu.js":657,"./he":658,"./he.js":658,"./hi":659,"./hi.js":659,"./hr":660,"./hr.js":660,"./hu":661,"./hu.js":661,"./hy-am":662,"./hy-am.js":662,"./id":663,"./id.js":663,"./is":664,"./is.js":664,"./it":665,"./it-ch":666,"./it-ch.js":666,"./it.js":665,"./ja":667,"./ja.js":667,"./jv":668,"./jv.js":668,"./ka":669,"./ka.js":669,"./kk":670,"./kk.js":670,"./km":671,"./km.js":671,"./kn":672,"./kn.js":672,"./ko":673,"./ko.js":673,"./ku":674,"./ku.js":674,"./ky":675,"./ky.js":675,"./lb":676,"./lb.js":676,"./lo":677,"./lo.js":677,"./lt":678,"./lt.js":678,"./lv":679,"./lv.js":679,"./me":680,"./me.js":680,"./mi":681,"./mi.js":681,"./mk":682,"./mk.js":682,"./ml":683,"./ml.js":683,"./mn":684,"./mn.js":684,"./mr":685,"./mr.js":685,"./ms":686,"./ms-my":687,"./ms-my.js":687,"./ms.js":686,"./mt":688,"./mt.js":688,"./my":689,"./my.js":689,"./nb":690,"./nb.js":690,"./ne":691,"./ne.js":691,"./nl":692,"./nl-be":693,"./nl-be.js":693,"./nl.js":692,"./nn":694,"./nn.js":694,"./oc-lnc":695,"./oc-lnc.js":695,"./pa-in":696,"./pa-in.js":696,"./pl":697,"./pl.js":697,"./pt":698,"./pt-br":699,"./pt-br.js":699,"./pt.js":698,"./ro":700,"./ro.js":700,"./ru":701,"./ru.js":701,"./sd":702,"./sd.js":702,"./se":703,"./se.js":703,"./si":704,"./si.js":704,"./sk":705,"./sk.js":705,"./sl":706,"./sl.js":706,"./sq":707,"./sq.js":707,"./sr":708,"./sr-cyrl":709,"./sr-cyrl.js":709,"./sr.js":708,"./ss":710,"./ss.js":710,"./sv":711,"./sv.js":711,"./sw":712,"./sw.js":712,"./ta":713,"./ta.js":713,"./te":714,"./te.js":714,"./tet":715,"./tet.js":715,"./tg":716,"./tg.js":716,"./th":717,"./th.js":717,"./tk":718,"./tk.js":718,"./tl-ph":719,"./tl-ph.js":719,"./tlh":720,"./tlh.js":720,"./tr":721,"./tr.js":721,"./tzl":722,"./tzl.js":722,"./tzm":723,"./tzm-latn":724,"./tzm-latn.js":724,"./tzm.js":723,"./ug-cn":725,"./ug-cn.js":725,"./uk":726,"./uk.js":726,"./ur":727,"./ur.js":727,"./uz":728,"./uz-latn":729,"./uz-latn.js":729,"./uz.js":728,"./vi":730,"./vi.js":730,"./x-pseudo":731,"./x-pseudo.js":731,"./yo":732,"./yo.js":732,"./zh-cn":733,"./zh-cn.js":733,"./zh-hk":734,"./zh-hk.js":734,"./zh-mo":735,"./zh-mo.js":735,"./zh-tw":736,"./zh-tw.js":736};function webpackContext(h){var m=webpackContextResolve(h);return y(m)}function webpackContextResolve(h){if(!y.o(v,h)){var m=new Error("Cannot find module '"+h+"'");throw m.code="MODULE_NOT_FOUND",m}return v[h]}webpackContext.keys=function webpackContextKeys(){return Object.keys(v)},webpackContext.resolve=webpackContextResolve,h.exports=webpackContext,webpackContext.id=1485},function(h,m,y){var v=y(199);h.exports={server:v.server,relayedServer:y(1503),client:v.client,router:v.router,frame:v.frame,request:v.request,relayedRequest:y(742),connection:v.connection,w3cwebsocket:v.w3cwebsocket,deprecation:v.deprecation,version:y(1504)}},function(h,m,y){h.exports={server:y(1488),client:y(740),router:y(1497),frame:y(739),request:y(738),connection:y(329),w3cwebsocket:y(1499),deprecation:y(1500),version:y(1501)}},function(h,m,y){var v=y(86).extend,C=y(86),T=y(10),w=y(328)("websocket:server"),A=y(13).EventEmitter,P=y(738),k=function WebSocketServer(h){A.call(this),this._handlers={upgrade:this.handleUpgrade.bind(this),requestAccepted:this.handleRequestAccepted.bind(this),requestResolved:this.handleRequestResolved.bind(this)},this.connections=[],this.pendingRequests=[],h&&this.mount(h)};T.inherits(k,A),k.prototype.mount=function(h){if(this.config={httpServer:null,maxReceivedFrameSize:65536,maxReceivedMessageSize:1048576,fragmentOutgoingMessages:!0,fragmentationThreshold:16384,keepalive:!0,keepaliveInterval:2e4,dropConnectionOnKeepaliveTimeout:!0,keepaliveGracePeriod:1e4,useNativeKeepalive:!1,assembleFragments:!0,autoAcceptConnections:!1,ignoreXForwardedFor:!1,disableNagleAlgorithm:!0,closeTimeout:5e3},v(this.config,h),!this.config.httpServer)throw new Error("You must specify an httpServer on which to mount the WebSocket server.");Array.isArray(this.config.httpServer)||(this.config.httpServer=[this.config.httpServer]);var m=this._handlers.upgrade;this.config.httpServer.forEach((function(h){h.on("upgrade",m)}))},k.prototype.unmount=function(){var h=this._handlers.upgrade;this.config.httpServer.forEach((function(m){m.removeListener("upgrade",h)}))},k.prototype.closeAllConnections=function(){this.connections.forEach((function(h){h.close()})),this.pendingRequests.forEach((function(h){process.nextTick((function(){h.reject(503)}))}))},k.prototype.broadcast=function(h){Buffer.isBuffer(h)?this.broadcastBytes(h):"function"==typeof h.toString&&this.broadcastUTF(h)},k.prototype.broadcastUTF=function(h){this.connections.forEach((function(m){m.sendUTF(h)}))},k.prototype.broadcastBytes=function(h){this.connections.forEach((function(m){m.sendBytes(h)}))},k.prototype.shutDown=function(){this.unmount(),this.closeAllConnections()},k.prototype.handleUpgrade=function(h,m){var y=this,v=new P(m,h,this.config);try{v.readHandshake()}catch(h){return v.reject(h.httpCode?h.httpCode:400,h.message,h.headers),void w("Invalid handshake: %s",h.message)}this.pendingRequests.push(v),v.once("requestAccepted",this._handlers.requestAccepted),v.once("requestResolved",this._handlers.requestResolved),m.once("close",(function(){y._handlers.requestResolved(v)})),!this.config.autoAcceptConnections&&C.eventEmitterListenerCount(this,"request")>0?this.emit("request",v):this.config.autoAcceptConnections?v.accept(v.requestedProtocols[0],v.origin):v.reject(404,"No handler is configured to accept the connection.")},k.prototype.handleRequestAccepted=function(h){var m=this;h.once("close",(function(y,v){m.handleConnectionClose(h,y,v)})),this.connections.push(h),this.emit("connect",h)},k.prototype.handleConnectionClose=function(h,m,y){var v=this.connections.indexOf(h);-1!==v&&this.connections.splice(v,1),this.emit("close",h,m,y)},k.prototype.handleRequestResolved=function(h){var m=this.pendingRequests.indexOf(h);-1!==m&&this.pendingRequests.splice(m,1)},h.exports=k},function(h,m,y){function load(){var h;try{h=m.storage.debug}catch(h){}return!h&&"undefined"!=typeof process&&"env"in process&&(h=process.env.DEBUG),h}(m=h.exports=y(737)).log=function log(){return"object"==typeof console&&console.log&&Function.prototype.apply.call(console.log,console,arguments)},m.formatArgs=function formatArgs(h){var y=this.useColors;if(h[0]=(y?"%c":"")+this.namespace+(y?" %c":" ")+h[0]+(y?"%c ":" ")+"+"+m.humanize(this.diff),!y)return;var v="color: "+this.color;h.splice(1,0,v,"color: inherit");var C=0,T=0;h[0].replace(/%[a-zA-Z%]/g,(function(h){"%%"!==h&&(C++,"%c"===h&&(T=C))})),h.splice(T,0,v)},m.save=function save(h){try{null==h?m.storage.removeItem("debug"):m.storage.debug=h}catch(h){}},m.load=load,m.useColors=function useColors(){if("undefined"!=typeof window&&window.process&&"renderer"===window.process.type)return!0;return"undefined"!=typeof document&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||"undefined"!=typeof window&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)},m.storage="undefined"!=typeof chrome&&void 0!==chrome.storage?chrome.storage.local:function localstorage(){try{return window.localStorage}catch(h){}}(),m.colors=["lightseagreen","forestgreen","goldenrod","dodgerblue","darkorchid","crimson"],m.formatters.j=function(h){try{return JSON.stringify(h)}catch(h){return"[UnexpectedJSONParseError]: "+h.message}},m.enable(load())},function(h,m){var y=1e3,v=6e4,C=60*v,T=24*C;function plural(h,m,y){if(!(h<m))return h<1.5*m?Math.floor(h/m)+" "+y:Math.ceil(h/m)+" "+y+"s"}h.exports=function(h,m){m=m||{};var w=typeof h;if("string"===w&&h.length>0)return function parse(h){if((h=String(h)).length>100)return;var m=/^((?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|years?|yrs?|y)?$/i.exec(h);if(!m)return;var w=parseFloat(m[1]);switch((m[2]||"ms").toLowerCase()){case"years":case"year":case"yrs":case"yr":case"y":return 315576e5*w;case"days":case"day":case"d":return w*T;case"hours":case"hour":case"hrs":case"hr":case"h":return w*C;case"minutes":case"minute":case"mins":case"min":case"m":return w*v;case"seconds":case"second":case"secs":case"sec":case"s":return w*y;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return w;default:return}}(h);if("number"===w&&!1===isNaN(h))return m.long?function fmtLong(h){return plural(h,T,"day")||plural(h,C,"hour")||plural(h,v,"minute")||plural(h,y,"second")||h+" ms"}(h):function fmtShort(h){if(h>=T)return Math.round(h/T)+"d";if(h>=C)return Math.round(h/C)+"h";if(h>=v)return Math.round(h/v)+"m";if(h>=y)return Math.round(h/y)+"s";return h+"ms"}(h);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(h))}},function(h,m,y){var v=y(88),C=y(10);(m=h.exports=y(737)).init=function init(h){h.inspectOpts={};for(var y=Object.keys(m.inspectOpts),v=0;v<y.length;v++)h.inspectOpts[y[v]]=m.inspectOpts[y[v]]},m.log=function log(){return w.write(C.format.apply(C,arguments)+"\n")},m.formatArgs=function formatArgs(h){var y=this.namespace;if(this.useColors){var v=this.color,C="  [3"+v+";1m"+y+" [0m";h[0]=C+h[0].split("\n").join("\n"+C),h.push("[3"+v+"m+"+m.humanize(this.diff)+"[0m")}else h[0]=(new Date).toUTCString()+" "+y+" "+h[0]},m.save=function save(h){null==h?delete process.env.DEBUG:process.env.DEBUG=h},m.load=load,m.useColors=function useColors(){return"colors"in m.inspectOpts?Boolean(m.inspectOpts.colors):v.isatty(T)},m.colors=[6,2,3,4,5,1],m.inspectOpts=Object.keys(process.env).filter((function(h){return/^debug_/i.test(h)})).reduce((function(h,m){var y=m.substring(6).toLowerCase().replace(/_([a-z])/g,(function(h,m){return m.toUpperCase()})),v=process.env[m];return v=!!/^(yes|on|true|enabled)$/i.test(v)||!/^(no|off|false|disabled)$/i.test(v)&&("null"===v?null:Number(v)),h[y]=v,h}),{});var T=parseInt(process.env.DEBUG_FD,10)||2;1!==T&&2!==T&&C.deprecate((function(){}),"except for stderr(2) and stdout(1), any other usage of DEBUG_FD is deprecated. Override debug.log if you want to use a different log function (https://git.io/debug_fd)")();var w=1===T?process.stdout:2===T?process.stderr:function createWritableStdioStream(h){var m;switch(process.binding("tty_wrap").guessHandleType(h)){case"TTY":(m=new v.WriteStream(h))._type="tty",m._handle&&m._handle.unref&&m._handle.unref();break;case"FILE":var C=y(21);(m=new C.SyncWriteStream(h,{autoClose:!1}))._type="fs";break;case"PIPE":case"TCP":var T=y(31);(m=new T.Socket({fd:h,readable:!1,writable:!0})).readable=!1,m.read=null,m._type="pipe",m._handle&&m._handle.unref&&m._handle.unref();break;default:throw new Error("Implement me. Unknown stream file type!")}return m.fd=h,m._isStdio=!0,m}(T);function load(){return process.env.DEBUG}m.formatters.o=function(h){return this.inspectOpts.colors=this.useColors,C.inspect(h,this.inspectOpts).split("\n").map((function(h){return h.trim()})).join(" ")},m.formatters.O=function(h){return this.inspectOpts.colors=this.useColors,C.inspect(h,this.inspectOpts)},m.enable(load())},function(h,m,y){
/*!
 * Copied from:
 * ws: a node.js websocket client
 * Copyright(c) 2011 Einar Otto Stangvik <einaros@gmail.com>
 * MIT Licensed
 */
try{h.exports=y(!function webpackMissingModule(){var h=new Error("Cannot find module '../build/Release/bufferutil'");throw h.code="MODULE_NOT_FOUND",h}())}catch(m){try{h.exports=y(!function webpackMissingModule(){var h=new Error("Cannot find module '../build/default/bufferutil'");throw h.code="MODULE_NOT_FOUND",h}())}catch(m){try{h.exports=y(1493)}catch(h){throw console.error("bufferutil.node seems to not have been built. Run npm install."),h}}}},function(h,m){
/*!
 * Copied from:
 * ws: a node.js websocket client
 * Copyright(c) 2011 Einar Otto Stangvik <einaros@gmail.com>
 * MIT Licensed
 */
h.exports.BufferUtil={merge:function(h,m){for(var y=0,v=0,C=m.length;v<C;++v){var T=m[v];T.copy(h,y),y+=T.length}},mask:function(h,m,y,v,C){for(var T=m.readUInt32LE(0),w=0;w<C-3;w+=4){var A=T^h.readUInt32LE(w);A<0&&(A=4294967296+A),y.writeUInt32LE(A,v+w)}switch(C%4){case 3:y[v+w+2]=h[w+2]^m[2];case 2:y[v+w+1]=h[w+1]^m[1];case 1:y[v+w]=h[w]^m[0]}},unmask:function(h,m){for(var y=m.readUInt32LE(0),v=h.length,C=0;C<v-3;C+=4){var T=y^h.readUInt32LE(C);T<0&&(T=4294967296+T),h.writeUInt32LE(T,C)}switch(v%4){case 3:h[C+2]=h[C+2]^m[2];case 2:h[C+1]=h[C+1]^m[1];case 1:h[C]=h[C]^m[0]}}}},function(h,m,y){var v=y(9).Buffer,C=y(13).EventEmitter,T=y(86).bufferAllocUnsafe;function BufferList(h){if(!(this instanceof BufferList))return new BufferList(h);C.call(this);var m=this;void 0===h&&(h={}),m.encoding=h.encoding;var y={next:null,buffer:null},w={next:null,buffer:null},A=0;m.__defineGetter__("length",(function(){return A}));var P=0;m.write=function(h){return y.buffer?(w.next={next:null,buffer:h},w=w.next):(y.buffer=h,w=y),A+=h.length,m.emit("write",h),!0},m.end=function(h){v.isBuffer(h)&&m.write(h)},m.push=function(){var h=[].concat.apply([],arguments);return h.forEach(m.write),m},m.forEach=function(h){if(!y.buffer)return T(0);if(y.buffer.length-P<=0)return m;for(var v={buffer:y.buffer.slice(P),next:y.next};v&&v.buffer;){if(h(v.buffer))break;v=v.next}return m},m.join=function(h,v){if(!y.buffer)return T(0);null==h&&(h=0),null==v&&(v=m.length);var C=T(v-h),w=0;return m.forEach((function(m){if(h<w+m.length&&w<v&&m.copy(C,Math.max(0,w-h),Math.max(0,h-w),Math.min(m.length,v-w)),(w+=m.length)>v)return!0})),C},m.joinInto=function(h,v,C,w){if(!y.buffer)return new T(0);null==C&&(C=0),null==w&&(w=m.length);var A=h;if(A.length-v<w-C)throw new Error("Insufficient space available in target Buffer.");var P=0;return m.forEach((function(h){if(C<P+h.length&&P<w&&h.copy(A,Math.max(v,v+P-C),Math.max(0,C-P),Math.min(h.length,w-P)),(P+=h.length)>w)return!0})),A},m.advance=function(h){for(P+=h,A-=h;y.buffer&&P>=y.buffer.length;)P-=y.buffer.length,y=y.next?y.next:{buffer:null,next:null};return null===y.buffer&&(w={next:null,buffer:null}),m.emit("advance",h),m},m.take=function(h,y){null==h?h=m.length:"number"!=typeof h&&(y=h,h=m.length);if(y||(y=m.encoding),y){var v="";return m.forEach((function(m){if(h<=0)return!0;v+=m.toString(y,0,Math.min(h,m.length)),h-=m.length})),v}return m.join(0,h)},m.toString=function(){return m.take("binary")}}h.exports=BufferList,h.exports.BufferList=BufferList,y(10).inherits(BufferList,C)},function(h,m,y){
/*!
 * UTF-8 Validation Code originally from:
 * ws: a node.js websocket client
 * Copyright(c) 2011 Einar Otto Stangvik <einaros@gmail.com>
 * MIT Licensed
 */
try{h.exports=y(!function webpackMissingModule(){var h=new Error("Cannot find module '../build/Release/validation'");throw h.code="MODULE_NOT_FOUND",h}())}catch(m){try{h.exports=y(!function webpackMissingModule(){var h=new Error("Cannot find module '../build/default/validation'");throw h.code="MODULE_NOT_FOUND",h}())}catch(m){try{h.exports=y(1496)}catch(h){throw console.error("validation.node seems not to have been built. Run npm install."),h}}}},function(h,m){
/*!
 * UTF-8 Validation Fallback Code originally from:
 * ws: a node.js websocket client
 * Copyright(c) 2011 Einar Otto Stangvik <einaros@gmail.com>
 * MIT Licensed
 */
h.exports.Validation={isValidUTF8:function(){return!0}}},function(h,m,y){var v=y(86).extend,C=y(10),T=y(13).EventEmitter,w=y(1498);function WebSocketRouter(h){T.call(this),this.config={server:null},h&&v(this.config,h),this.handlers=[],this._requestHandler=this.handleRequest.bind(this),this.config.server&&this.attachServer(this.config.server)}C.inherits(WebSocketRouter,T),WebSocketRouter.prototype.attachServer=function(h){if(!h)throw new Error("You must specify a WebSocketServer instance to attach to.");this.server=h,this.server.on("request",this._requestHandler)},WebSocketRouter.prototype.detachServer=function(){if(!this.server)throw new Error("Cannot detach from server: not attached.");this.server.removeListener("request",this._requestHandler),this.server=null},WebSocketRouter.prototype.mount=function(h,m,y){if(!h)throw new Error("You must specify a path for this handler.");if(m||(m="____no_protocol____"),!y)throw new Error("You must specify a callback for this handler.");if(!((h=this.pathToRegExp(h))instanceof RegExp))throw new Error("Path must be specified as either a string or a RegExp.");var v=h.toString();if(m=m.toLocaleLowerCase(),-1!==this.findHandlerIndex(v,m))throw new Error("You may only mount one handler per path/protocol combination.");this.handlers.push({path:h,pathString:v,protocol:m,callback:y})},WebSocketRouter.prototype.unmount=function(h,m){var y=this.findHandlerIndex(this.pathToRegExp(h).toString(),m);if(-1===y)throw new Error("Unable to find a route matching the specified path and protocol.");this.handlers.splice(y,1)},WebSocketRouter.prototype.findHandlerIndex=function(h,m){m=m.toLocaleLowerCase();for(var y=0,v=this.handlers.length;y<v;y++){var C=this.handlers[y];if(C.pathString===h&&C.protocol===m)return y}return-1},WebSocketRouter.prototype.pathToRegExp=function(h){return"string"==typeof h&&("*"===h?h=/^.*$/:(h=h.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&"),h=new RegExp("^"+h+"$"))),h},WebSocketRouter.prototype.handleRequest=function(h){var m=h.requestedProtocols;0===m.length&&(m=["____no_protocol____"]);for(var y=0;y<m.length;y++)for(var v=m[y].toLocaleLowerCase(),C=0,T=this.handlers.length;C<T;C++){var A=this.handlers[C];if(A.path.test(h.resourceURL.pathname)&&(v===A.protocol||"*"===A.protocol)){var P=new w(h,v);return void A.callback(P)}}h.reject(404,"No handler is available for the given request.")},h.exports=WebSocketRouter},function(h,m,y){var v=y(10),C=y(13).EventEmitter;function WebSocketRouterRequest(h,m){C.call(this),this.webSocketRequest=h,this.protocol="____no_protocol____"===m?null:m,this.origin=h.origin,this.resource=h.resource,this.resourceURL=h.resourceURL,this.httpRequest=h.httpRequest,this.remoteAddress=h.remoteAddress,this.webSocketVersion=h.webSocketVersion,this.requestedExtensions=h.requestedExtensions,this.cookies=h.cookies}v.inherits(WebSocketRouterRequest,C),WebSocketRouterRequest.prototype.accept=function(h,m){var y=this.webSocketRequest.accept(this.protocol,h,m);return this.emit("requestAccepted",y),y},WebSocketRouterRequest.prototype.reject=function(h,m,y){this.webSocketRequest.reject(h,m,y),this.emit("requestRejected",this)},h.exports=WebSocketRouterRequest},function(h,m,y){var v=y(740),C=y(477),T=y(478);const w=0,A=1,P=2,k=3;function W3CWebSocket(h,m,y,C,A,P){T.EventTarget.call(this),(P=P||{}).assembleFragments=!0;var k=this;this._url=h,this._readyState=w,this._protocol=void 0,this._extensions="",this._bufferedAmount=0,this._binaryType="arraybuffer",this._connection=void 0,this._client=new v(P),this._client.on("connect",(function(h){onConnect.call(k,h)})),this._client.on("connectFailed",(function(){onConnectFailed.call(k)})),this._client.connect(h,m,y,C,A)}function createCloseEvent(h,m){var y=new T.Event("close");return y.code=h,y.reason=m,y.wasClean=void 0===h||1e3===h,y}function createMessageEvent(h){var m=new T.Event("message");return m.data=h,m}function onConnect(h){var m=this;this._readyState=A,this._connection=h,this._protocol=h.protocol,this._extensions=h.extensions,this._connection.on("close",(function(h,y){onClose.call(m,h,y)})),this._connection.on("message",(function(h){onMessage.call(m,h)})),this.dispatchEvent(new T.Event("open"))}function onConnectFailed(){destroy.call(this),this._readyState=k;try{this.dispatchEvent(new T.Event("error"))}finally{this.dispatchEvent(createCloseEvent(1006,"connection failed"))}}function onClose(h,m){destroy.call(this),this._readyState=k,this.dispatchEvent(createCloseEvent(h,m||""))}function onMessage(h){if(h.utf8Data)this.dispatchEvent(createMessageEvent(h.utf8Data));else if(h.binaryData&&"arraybuffer"===this.binaryType){for(var m=h.binaryData,y=new ArrayBuffer(m.length),v=new Uint8Array(y),C=0,T=m.length;C<T;++C)v[C]=m[C];this.dispatchEvent(createMessageEvent(y))}}function destroy(){this._client.removeAllListeners(),this._connection&&this._connection.removeAllListeners()}h.exports=W3CWebSocket,Object.defineProperties(W3CWebSocket.prototype,{url:{get:function(){return this._url}},readyState:{get:function(){return this._readyState}},protocol:{get:function(){return this._protocol}},extensions:{get:function(){return this._extensions}},bufferedAmount:{get:function(){return this._bufferedAmount}}}),Object.defineProperties(W3CWebSocket.prototype,{binaryType:{get:function(){return this._binaryType},set:function(h){if("arraybuffer"!==h)throw new SyntaxError('just "arraybuffer" type allowed for "binaryType" attribute');this._binaryType=h}}}),[["CONNECTING",w],["OPEN",A],["CLOSING",P],["CLOSED",k]].forEach((function(h){Object.defineProperty(W3CWebSocket.prototype,h[0],{get:function(){return h[1]}})})),[["CONNECTING",w],["OPEN",A],["CLOSING",P],["CLOSED",k]].forEach((function(h){Object.defineProperty(W3CWebSocket,h[0],{get:function(){return h[1]}})})),W3CWebSocket.prototype.send=function(h){if(this._readyState!==A)throw new Error("cannot call send() while not connected");if("string"==typeof h||h instanceof String)this._connection.sendUTF(h);else if(h instanceof Buffer)this._connection.sendBytes(h);else{if(!h.byteLength&&0!==h.byteLength)throw new Error("unknown binary data:",h);h=C(h),this._connection.sendBytes(h)}},W3CWebSocket.prototype.close=function(h,m){switch(this._readyState){case w:onConnectFailed.call(this),this._client.on("connect",(function(y){h?y.close(h,m):y.close()}));break;case A:this._readyState=P,h?this._connection.close(h,m):this._connection.close()}}},function(h,m){var y={disableWarnings:!1,deprecationWarningMap:{},warn:function(h){!this.disableWarnings&&this.deprecationWarningMap[h]&&(console.warn("DEPRECATION WARNING: "+this.deprecationWarningMap[h]),this.deprecationWarningMap[h]=!1)}};h.exports=y},function(h,m,y){h.exports=y(1502).version},function(h){h.exports=JSON.parse('{"name":"websocket","description":"Websocket Client & Server Library implementing the WebSocket protocol as specified in RFC 6455.","keywords":["websocket","websockets","socket","networking","comet","push","RFC-6455","realtime","server","client"],"author":"Brian McKelvey <theturtle32@gmail.com> (https://github.com/theturtle32)","contributors":["Iaki Baz Castillo <ibc@aliax.net> (http://dev.sipdoc.net)"],"version":"1.0.31","repository":{"type":"git","url":"https://github.com/theturtle32/WebSocket-Node.git"},"homepage":"https://github.com/theturtle32/WebSocket-Node","engines":{"node":">=0.10.0"},"dependencies":{"debug":"^2.2.0","es5-ext":"^0.10.50","nan":"^2.14.0","typedarray-to-buffer":"^3.1.5","yaeti":"^0.0.6"},"devDependencies":{"buffer-equal":"^1.0.0","faucet":"^0.0.1","gulp":"^4.0.2","gulp-jshint":"^2.0.4","jshint-stylish":"^2.2.1","jshint":"^2.0.0","tape":"^4.9.1"},"config":{"verbose":false},"scripts":{"install":"(node-gyp rebuild 2> builderror.log) || (exit 0)","test":"faucet test/unit","gulp":"gulp"},"main":"index","directories":{"lib":"./lib"},"browser":"lib/browser.js","license":"Apache-2.0"}')},function(h,m,y){const v=y(741).extend,C=y(741),T=y(10),w=y(13).EventEmitter,A=y(199).client,P=y(742),k=(y(530),y(1));var isDefinedAndNonNull=function(h,m){return void 0!==h[m]&&null!==h[m]},R=function HybridConnectionsWebSocketServer(h){w.call(this),this.closeRequested=!1,this._handlers={requestAccepted:this.handleRequestAccepted.bind(this),requestResolved:this.handleRequestResolved.bind(this)},this.pendingRequests=[],this.connections=[],h&&this.open(h)};T.inherits(R,w),R.prototype.open=function(h){if(this.config={server:null,token:null,id:null,keepalive:!0,keepaliveInterval:2e4,dropConnectionOnKeepaliveTimeout:!0,keepaliveGracePeriod:1e4,useNativeKeepalive:!1,assembleFragments:!0,autoAcceptConnections:!1,ignoreXForwardedFor:!1,disableNagleAlgorithm:!0,closeTimeout:5e3},v(this.config,h),!this.config.server)throw new Error("You must specify a hybrid connections server address on which to open the WebSocket server.");this.listenUri=h.server,isDefinedAndNonNull(h,"id")&&(this.listenUri=listenUri+"&id="+h.id),function connectControlChannel(h){var m=null,y=null;if(null!=h.config.token){var v=null;"function"==typeof h.config.token?(y=new k.duration(1,"hours"),v=h.config.token()):v=h.config.token,m={ServiceBusAuthorization:v}}var T=null,w=new A;w.connect(h.listenUri,null,null,m),w.on("connect",(function(m){h.controlChannel=m,h.controlChannel.on("error",(function(m){h.emit("error",m),clearInterval(T),closeRequested||connectControlChannel(h)})),h.controlChannel.on("close",(function(m){clearInterval(T),closeRequested?(h.controlChannel=null,h.emit("close",h)):connectControlChannel(h)})),h.controlChannel.on("message",(function(m){if("utf8"===m.type)try{!function handleControl(h,m){isDefinedAndNonNull(m,"accept")&&function handleAccept(h,m){var y=new P(m.accept.address,m.accept.id,m.accept.connectHeaders,h.config);try{y.readHandshake()}catch(h){return y.reject(h.httpCode?h.httpCode:400,h.message,h.headers),void debug("Invalid handshake: %s",h.message)}h.pendingRequests.push(y),y.once("requestAccepted",h._handlers.requestAccepted),y.once("requestResolved",h._handlers.requestResolved),!h.config.autoAcceptConnections&&C.eventEmitterListenerCount(h,"request")>0?h.emit("request",y):h.config.autoAcceptConnections?y.accept(y.requestedProtocols[0],y.origin):y.reject(404,"No handler is configured to accept the connection.")}(h,m)}(h,JSON.parse(m.utf8Data))}catch(h){}}))})),w.on("connectFailed",(function(h){console.log(h)})),y&&(T=setInterval((function(){if(!h.closeRequested){var m=h.config.token();console.log("Renewing Token: "+m);var y={renewToken:{token:m}};h.controlChannel.send(JSON.stringify(y),(function(h){h&&console.log("renewToken error: "+h)}))}}),y.asMilliseconds()))}(this)},R.prototype.close=function(){this.closeRequested=!0,this.controlChannel&&this.controlChannel.close(),this.closeAllConnections()},R.prototype.closeAllConnections=function(){this.connections.forEach((function(h){h.close()}))},R.prototype.broadcast=function(h){Buffer.isBuffer(h)?this.broadcastBytes(h):"function"==typeof h.toString&&this.broadcastUTF(h)},R.prototype.broadcastUTF=function(h){this.connections.forEach((function(m){m.sendUTF(h)}))},R.prototype.broadcastBytes=function(h){this.connections.forEach((function(m){m.sendBytes(h)}))},R.prototype.shutDown=function(){this.closeAllConnections()},R.prototype.handleRequestAccepted=function(h){var m=this;h.once("close",(function(y,v){m.handleConnectionClose(h,y,v)})),this.connections.push(h),this.emit("connect",h)},R.prototype.handleRequestResolved=function(h){var m=this.pendingRequests.indexOf(h);-1!==m&&this.pendingRequests.splice(m,1)},R.prototype.handleConnectionClose=function(h,m){console.log(m)},h.exports=R},function(h,m,y){h.exports=y(1505).version},function(h){h.exports=JSON.parse('{"author":"Microsoft Corporation","name":"hyco-websocket","description":"","version":"1.0.5","license":"MIT","main":"index.js","homepage":"https://docs.microsoft.com/en-us/azure/service-bus-relay/","keywords":["websocket","websockets","socket","networking","comet","push","RFC-6455","realtime","server","client"],"repository":{"type":"git","url":"https://github.com/Azure/azure-relay-node.git"},"engines":{"node":">=0.8.0"},"dependencies":{"websocket":"latest","crypto":"latest","moment":"latest","url":"latest","events":"latest","querystring":"latest"},"config":{"verbose":false},"directories":{"lib":"./lib"}}')},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0});const v=y(595),C=y(5),T=y(2);m.registerHostTerminal=function registerHostTerminal(h,m){const y=new v.TerminalService(h),w={workspaceAccessControlManager:m.workspaceAccessControlManager,workspaceAccessControlService:m.workspaceAccessControlService,methodDecorators:m.methodDecorators,terminalService:T.lazyLoad(()=>y),dataScrapingManager:T.lazyLoad(()=>C.dataScrapingManagerInstance),forwardBuffer:(h,m,v,C)=>y.forwardBuffer(h,m,v),handleChangeTerminalDimensions(h,m){y.fireTerminalResized(h,m)}},A=v.hostTerminalControllerFactory(w);return h.registerRpcService(y,y.serviceInfo),h.registerStreamProvider(y),{init:async()=>{await A.activate()},dispose:()=>A.deactivate()}}},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0});const v=y(305),C=y(5);m.registerServerSharingService=function registerServerSharingService(h){const m=new v.ServerSharingService(h,C.traceSource.withName("ServerSharingService"));h.registerRpcService(m,m.serviceInfo),h.registerStreamProvider(m)}},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0});const v=y(0);m.queries=(decodeURIComponent((()=>{const h=v.workspace.workspaceFile;if(h&&h.query)return h.query})())||"").split("&"),m.queryParameter=h=>{const y=`${h}=`,v=m.queries.find(h=>h.startsWith(y));return v?v.substring(y.length):void 0},m.optionQuery=h=>"true"===m.queryParameter(h)},function(h,m,y){"use strict";y.r(m),y.d(m,"BrowserInfo",(function(){return v})),y.d(m,"NodeInfo",(function(){return C})),y.d(m,"SearchBotDeviceInfo",(function(){return T})),y.d(m,"BotInfo",(function(){return w})),y.d(m,"detect",(function(){return detect})),y.d(m,"browserName",(function(){return browserName})),y.d(m,"parseUserAgent",(function(){return parseUserAgent})),y.d(m,"detectOS",(function(){return detectOS})),y.d(m,"getNodeVersion",(function(){return getNodeVersion}));var __spreadArrays=function(){for(var h=0,m=0,y=arguments.length;m<y;m++)h+=arguments[m].length;var v=Array(h),C=0;for(m=0;m<y;m++)for(var T=arguments[m],w=0,A=T.length;w<A;w++,C++)v[C]=T[w];return v},v=function v(h,m,y){this.name=h,this.version=m,this.os=y,this.type="browser"},C=function C(h){this.version=h,this.type="node",this.name="node",this.os=process.platform},T=function T(h,m,y,v){this.name=h,this.version=m,this.os=y,this.bot=v,this.type="bot-device"},w=function w(){this.type="bot",this.bot=!0,this.name="bot",this.version=null,this.os=null},A=/(nuhk|Googlebot|Yammybot|Openbot|Slurp|MSNBot|Ask\ Jeeves\/Teoma|ia_archiver)/,P=[["aol",/AOLShield\/([0-9\._]+)/],["edge",/Edge\/([0-9\._]+)/],["edge-ios",/EdgiOS\/([0-9\._]+)/],["yandexbrowser",/YaBrowser\/([0-9\._]+)/],["vivaldi",/Vivaldi\/([0-9\.]+)/],["kakaotalk",/KAKAOTALK\s([0-9\.]+)/],["samsung",/SamsungBrowser\/([0-9\.]+)/],["silk",/\bSilk\/([0-9._-]+)\b/],["miui",/MiuiBrowser\/([0-9\.]+)$/],["beaker",/BeakerBrowser\/([0-9\.]+)/],["edge-chromium",/Edg\/([0-9\.]+)/],["chromium-webview",/(?!Chrom.*OPR)wv\).*Chrom(?:e|ium)\/([0-9\.]+)(:?\s|$)/],["chrome",/(?!Chrom.*OPR)Chrom(?:e|ium)\/([0-9\.]+)(:?\s|$)/],["phantomjs",/PhantomJS\/([0-9\.]+)(:?\s|$)/],["crios",/CriOS\/([0-9\.]+)(:?\s|$)/],["firefox",/Firefox\/([0-9\.]+)(?:\s|$)/],["fxios",/FxiOS\/([0-9\.]+)/],["opera-mini",/Opera Mini.*Version\/([0-9\.]+)/],["opera",/Opera\/([0-9\.]+)(?:\s|$)/],["opera",/OPR\/([0-9\.]+)(:?\s|$)/],["ie",/Trident\/7\.0.*rv\:([0-9\.]+).*\).*Gecko$/],["ie",/MSIE\s([0-9\.]+);.*Trident\/[4-7].0/],["ie",/MSIE\s(7\.0)/],["bb10",/BB10;\sTouch.*Version\/([0-9\.]+)/],["android",/Android\s([0-9\.]+)/],["ios",/Version\/([0-9\._]+).*Mobile.*Safari.*/],["safari",/Version\/([0-9\._]+).*Safari/],["facebook",/FBAV\/([0-9\.]+)/],["instagram",/Instagram\s([0-9\.]+)/],["ios-webview",/AppleWebKit\/([0-9\.]+).*Mobile/],["ios-webview",/AppleWebKit\/([0-9\.]+).*Gecko\)$/],["searchbot",/alexa|bot|crawl(er|ing)|facebookexternalhit|feedburner|google web preview|nagios|postrank|pingdom|slurp|spider|yahoo!|yandex/]],k=[["iOS",/iP(hone|od|ad)/],["Android OS",/Android/],["BlackBerry OS",/BlackBerry|BB10/],["Windows Mobile",/IEMobile/],["Amazon OS",/Kindle/],["Windows 3.11",/Win16/],["Windows 95",/(Windows 95)|(Win95)|(Windows_95)/],["Windows 98",/(Windows 98)|(Win98)/],["Windows 2000",/(Windows NT 5.0)|(Windows 2000)/],["Windows XP",/(Windows NT 5.1)|(Windows XP)/],["Windows Server 2003",/(Windows NT 5.2)/],["Windows Vista",/(Windows NT 6.0)/],["Windows 7",/(Windows NT 6.1)/],["Windows 8",/(Windows NT 6.2)/],["Windows 8.1",/(Windows NT 6.3)/],["Windows 10",/(Windows NT 10.0)/],["Windows ME",/Windows ME/],["Open BSD",/OpenBSD/],["Sun OS",/SunOS/],["Chrome OS",/CrOS/],["Linux",/(Linux)|(X11)/],["Mac OS",/(Mac_PowerPC)|(Macintosh)/],["QNX",/QNX/],["BeOS",/BeOS/],["OS/2",/OS\/2/]];function detect(h){return h?parseUserAgent(h):"undefined"!=typeof navigator?parseUserAgent(navigator.userAgent):getNodeVersion()}function matchUserAgent(h){return""!==h&&P.reduce((function(m,y){var v=y[0],C=y[1];if(m)return m;var T=C.exec(h);return!!T&&[v,T]}),!1)}function browserName(h){var m=matchUserAgent(h);return m?m[0]:null}function parseUserAgent(h){var m=matchUserAgent(h);if(!m)return null;var y=m[0],C=m[1];if("searchbot"===y)return new w;var P=C[1]&&C[1].split(/[._]/).slice(0,3);P?P.length<3&&(P=__spreadArrays(P,function createVersionParts(h){for(var m=[],y=0;y<h;y++)m.push("0");return m}(3-P.length))):P=[];var k=P.join("."),R=detectOS(h),M=A.exec(h);return M&&M[1]?new T(y,k,R,M[1]):new v(y,P.join("."),R)}function detectOS(h){for(var m=0,y=k.length;m<y;m++){var v=k[m],C=v[0];if(v[1].exec(h))return C}return null}function getNodeVersion(){return"undefined"!=typeof process&&process.version?new C(process.version.slice(1)):null}},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0});const v=y(4),C=y(1511),T=y(3);m.PlannedSessionsService=class PlannedSessionsService{constructor(h,m){this.workspaceApi=h,this.logger=m}async createPersistentWorkspaceAsync(h,m,y){const v=C.generateWorkspaceId(T.userAuthStateTracker.userInfo.id),w=new Date;w.setDate(w.getDate()+30);const A={id:v,isHostConnected:!1,expiresAt:w,label:h,areAnonymousGuestsAllowed:m};try{const h=await this.workspaceApi.postWorkspaceInfo(A),m={id:h.id,name:h.name,joinUri:h.joinLink,isHostConnected:h.isHostConnected,expiresAt:h.expiresAt,label:h.label};return this.logger.info(`Planned session created with id:${m.id}`),m}catch(h){throw this.logger.error("Failed to create planned session",h),h}}async deleteWorkspaceAsync(h,m){return await this.workspaceApi.deleteWorkspace(h)}async renameWorkspaceAsync(h,m,y){return await this.workspaceApi.rename(h,m)}async listWorkspacesAsync(h,m){const y=[];if(h.onlyManagedWorkspaces){const h=await this.workspaceApi.getManagedWorkspaces();y.push(...h.map(h=>({id:h.id,name:h.name,ownerId:h.ownerId,joinUri:h.joinLink,connectionStatus:v.vsls.WorkspaceConnectionStatus.Unknown,isHostConnected:h.isHostConnected,label:h.label,expiresAt:h.expiresAt,isReadyForConnection:h.isReadyForConnection})))}return y}}},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0});const v=y(18),C=y(11);function getDefaultSystemIdentifier(){const h=v.networkInterfaces(),m=Object.keys(h).find(m=>h[m].find(h=>{if(!h.internal&&h.mac)return h.mac}));return null!=m?m:process.env.COMPUTERNAME}m.generateWorkspaceId=function generateWorkspaceId(h,m,y){const v=[h,y||getDefaultSystemIdentifier()];return m&&v.push(...m.map(h=>h.toUpperCase())),C.createHash("sha256").update(v.join("\n")).digest("hex").substr(0,20)}},function(h,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0});const v=y(215),C=y(8);m.addTelemetryLogFilter=async function addTelemetryLogFilter(){const h=new v.TelemetryLogFilter;await h.init(),C.Telemetry.addFilter(h)}},function(h,m){h.exports=require("keytar")},function(h,m,y){"use strict";y.r(m),y.d(m,"VERSION",(function(){return Pe})),y.d(m,"MessagePackHubProtocol",(function(){return Ae}));var v,C,T=y(9),w=y(87),A=(v=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(h,m){h.__proto__=m}||function(h,m){for(var y in m)m.hasOwnProperty(y)&&(h[y]=m[y])},function(h,m){function __(){this.constructor=h}v(h,m),h.prototype=null===m?Object.create(m):(__.prototype=m.prototype,new __)}),P=function(h){function HttpError(m,y){var v=this,C=this.constructor.prototype;return(v=h.call(this,m)||this).statusCode=y,v.__proto__=C,v}return A(HttpError,h),HttpError}(Error),k=function(h){function TimeoutError(m){void 0===m&&(m="A timeout occurred.");var y=this,v=this.constructor.prototype;return(y=h.call(this,m)||this).__proto__=v,y}return A(TimeoutError,h),TimeoutError}(Error),R=function(h){function AbortError(m){void 0===m&&(m="An abort occurred.");var y=this,v=this.constructor.prototype;return(y=h.call(this,m)||this).__proto__=v,y}return A(AbortError,h),AbortError}(Error),M=Object.assign||function(h){for(var m,y=1,v=arguments.length;y<v;y++)for(var C in m=arguments[y])Object.prototype.hasOwnProperty.call(m,C)&&(h[C]=m[C]);return h},N=function N(h,m,y){this.statusCode=h,this.statusText=m,this.content=y},D=function(){function HttpClient(){}return HttpClient.prototype.get=function(h,m){return this.send(M({},m,{method:"GET",url:h}))},HttpClient.prototype.post=function(h,m){return this.send(M({},m,{method:"POST",url:h}))},HttpClient.prototype.delete=function(h,m){return this.send(M({},m,{method:"DELETE",url:h}))},HttpClient.prototype.getCookieString=function(h){return""},HttpClient}();!function(h){h[h.Trace=0]="Trace",h[h.Debug=1]="Debug",h[h.Information=2]="Information",h[h.Warning=3]="Warning",h[h.Error=4]="Error",h[h.Critical=5]="Critical",h[h.None=6]="None"}(C||(C={}));var I=function(){function NullLogger(){}return NullLogger.prototype.log=function(h,m){},NullLogger.instance=new NullLogger,NullLogger}(),x=Object.assign||function(h){for(var m,y=1,v=arguments.length;y<v;y++)for(var C in m=arguments[y])Object.prototype.hasOwnProperty.call(m,C)&&(h[C]=m[C]);return h},__awaiter=function(h,m,y,v){return new(y||(y=Promise))((function(C,T){function fulfilled(h){try{step(v.next(h))}catch(h){T(h)}}function rejected(h){try{step(v.throw(h))}catch(h){T(h)}}function step(h){h.done?C(h.value):new y((function(m){m(h.value)})).then(fulfilled,rejected)}step((v=v.apply(h,m||[])).next())}))},__generator=function(h,m){var y,v,C,T,w={label:0,sent:function(){if(1&C[0])throw C[1];return C[1]},trys:[],ops:[]};return T={next:verb(0),throw:verb(1),return:verb(2)},"function"==typeof Symbol&&(T[Symbol.iterator]=function(){return this}),T;function verb(T){return function(A){return function step(T){if(y)throw new TypeError("Generator is already executing.");for(;w;)try{if(y=1,v&&(C=2&T[0]?v.return:T[0]?v.throw||((C=v.return)&&C.call(v),0):v.next)&&!(C=C.call(v,T[1])).done)return C;switch(v=0,C&&(T=[2&T[0],C.value]),T[0]){case 0:case 1:C=T;break;case 4:return w.label++,{value:T[1],done:!1};case 5:w.label++,v=T[1],T=[0];continue;case 7:T=w.ops.pop(),w.trys.pop();continue;default:if(!(C=w.trys,(C=C.length>0&&C[C.length-1])||6!==T[0]&&2!==T[0])){w=0;continue}if(3===T[0]&&(!C||T[1]>C[0]&&T[1]<C[3])){w.label=T[1];break}if(6===T[0]&&w.label<C[1]){w.label=C[1],C=T;break}if(C&&w.label<C[2]){w.label=C[2],w.ops.push(T);break}C[2]&&w.ops.pop(),w.trys.pop();continue}T=m.call(h,w)}catch(h){T=[6,h],v=0}finally{y=C=0}if(5&T[0])throw T[1];return{value:T[0]?T[1]:void 0,done:!0}}([T,A])}}},O=function(){function Arg(){}return Arg.isRequired=function(h,m){if(null==h)throw new Error("The '"+m+"' argument is required.")},Arg.isNotEmpty=function(h,m){if(!h||h.match(/^\s*$/))throw new Error("The '"+m+"' argument should not be empty.")},Arg.isIn=function(h,m,y){if(!(h in m))throw new Error("Unknown "+y+" value: "+h+".")},Arg}(),L=function(){function Platform(){}return Object.defineProperty(Platform,"isBrowser",{get:function(){return"object"==typeof window},enumerable:!0,configurable:!0}),Object.defineProperty(Platform,"isWebWorker",{get:function(){return"object"==typeof self&&"importScripts"in self},enumerable:!0,configurable:!0}),Object.defineProperty(Platform,"isNode",{get:function(){return!this.isBrowser&&!this.isWebWorker},enumerable:!0,configurable:!0}),Platform}();function getDataDetail(h,m){var y="";return isArrayBuffer(h)?(y="Binary data of length "+h.byteLength,m&&(y+=". Content: '"+function formatArrayBuffer(h){var m=new Uint8Array(h),y="";return m.forEach((function(h){y+="0x"+(h<16?"0":"")+h.toString(16)+" "})),y.substr(0,y.length-1)}(h)+"'")):"string"==typeof h&&(y="String data of length "+h.length,m&&(y+=". Content: '"+h+"'")),y}function isArrayBuffer(h){return h&&"undefined"!=typeof ArrayBuffer&&(h instanceof ArrayBuffer||h.constructor&&"ArrayBuffer"===h.constructor.name)}function sendMessage(h,m,y,v,T,w,A,P,k){return __awaiter(this,void 0,void 0,(function(){var R,M,N,D,I,O,L,U;return __generator(this,(function(B){switch(B.label){case 0:return M={},T?[4,T()]:[3,2];case 1:(N=B.sent())&&((R={}).Authorization="Bearer "+N,M=R),B.label=2;case 2:return D=getUserAgentHeader(),I=D[0],O=D[1],M[I]=O,h.log(C.Trace,"("+m+" transport) sending data. "+getDataDetail(w,A)+"."),L=isArrayBuffer(w)?"arraybuffer":"text",[4,y.post(v,{content:w,headers:x({},M,k),responseType:L,withCredentials:P})];case 3:return U=B.sent(),h.log(C.Trace,"("+m+" transport) request complete. Response status: "+U.statusCode+"."),[2]}}))}))}var U=function(){function SubjectSubscription(h,m){this.subject=h,this.observer=m}return SubjectSubscription.prototype.dispose=function(){var h=this.subject.observers.indexOf(this.observer);h>-1&&this.subject.observers.splice(h,1),0===this.subject.observers.length&&this.subject.cancelCallback&&this.subject.cancelCallback().catch((function(h){}))},SubjectSubscription}(),B=function(){function ConsoleLogger(h){this.minimumLogLevel=h,this.outputConsole=console}return ConsoleLogger.prototype.log=function(h,m){if(h>=this.minimumLogLevel)switch(h){case C.Critical:case C.Error:this.outputConsole.error("["+(new Date).toISOString()+"] "+C[h]+": "+m);break;case C.Warning:this.outputConsole.warn("["+(new Date).toISOString()+"] "+C[h]+": "+m);break;case C.Information:this.outputConsole.info("["+(new Date).toISOString()+"] "+C[h]+": "+m);break;default:this.outputConsole.log("["+(new Date).toISOString()+"] "+C[h]+": "+m)}},ConsoleLogger}();function getUserAgentHeader(){var h="X-SignalR-User-Agent";return L.isNode&&(h="User-Agent"),[h,constructUserAgent("5.0.8",getOsName(),getRuntime(),getRuntimeVersion())]}function constructUserAgent(h,m,y,v){var C="Microsoft SignalR/",T=h.split(".");return C+=T[0]+"."+T[1],C+=" ("+h+"; ",C+=m&&""!==m?m+"; ":"Unknown OS; ",C+=""+y,C+=v?"; "+v:"; Unknown Runtime Version",C+=")"}function getOsName(){if(!L.isNode)return"";switch(process.platform){case"win32":return"Windows NT";case"darwin":return"macOS";case"linux":return"Linux";default:return process.platform}}function getRuntimeVersion(){if(L.isNode)return process.versions.node}function getRuntime(){return L.isNode?"NodeJS":"Browser"}var W=function(){var h=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(h,m){h.__proto__=m}||function(h,m){for(var y in m)m.hasOwnProperty(y)&&(h[y]=m[y])};return function(m,y){function __(){this.constructor=m}h(m,y),m.prototype=null===y?Object.create(y):(__.prototype=y.prototype,new __)}}(),q=Object.assign||function(h){for(var m,y=1,v=arguments.length;y<v;y++)for(var C in m=arguments[y])Object.prototype.hasOwnProperty.call(m,C)&&(h[C]=m[C]);return h},FetchHttpClient_awaiter=function(h,m,y,v){return new(y||(y=Promise))((function(C,T){function fulfilled(h){try{step(v.next(h))}catch(h){T(h)}}function rejected(h){try{step(v.throw(h))}catch(h){T(h)}}function step(h){h.done?C(h.value):new y((function(m){m(h.value)})).then(fulfilled,rejected)}step((v=v.apply(h,m||[])).next())}))},FetchHttpClient_generator=function(h,m){var y,v,C,T,w={label:0,sent:function(){if(1&C[0])throw C[1];return C[1]},trys:[],ops:[]};return T={next:verb(0),throw:verb(1),return:verb(2)},"function"==typeof Symbol&&(T[Symbol.iterator]=function(){return this}),T;function verb(T){return function(A){return function step(T){if(y)throw new TypeError("Generator is already executing.");for(;w;)try{if(y=1,v&&(C=2&T[0]?v.return:T[0]?v.throw||((C=v.return)&&C.call(v),0):v.next)&&!(C=C.call(v,T[1])).done)return C;switch(v=0,C&&(T=[2&T[0],C.value]),T[0]){case 0:case 1:C=T;break;case 4:return w.label++,{value:T[1],done:!1};case 5:w.label++,v=T[1],T=[0];continue;case 7:T=w.ops.pop(),w.trys.pop();continue;default:if(!(C=w.trys,(C=C.length>0&&C[C.length-1])||6!==T[0]&&2!==T[0])){w=0;continue}if(3===T[0]&&(!C||T[1]>C[0]&&T[1]<C[3])){w.label=T[1];break}if(6===T[0]&&w.label<C[1]){w.label=C[1],C=T;break}if(C&&w.label<C[2]){w.label=C[2],w.ops.push(T);break}C[2]&&w.ops.pop(),w.trys.pop();continue}T=m.call(h,w)}catch(h){T=[6,h],v=0}finally{y=C=0}if(5&T[0])throw T[1];return{value:T[0]?T[1]:void 0,done:!0}}([T,A])}}},Y=function(h){function FetchHttpClient(m){var y=h.call(this)||this;if(y.logger=m,"undefined"==typeof fetch){var v=require;y.jar=new(v("tough-cookie").CookieJar),y.fetchType=v("node-fetch"),y.fetchType=v("fetch-cookie")(y.fetchType,y.jar),y.abortControllerType=v("abort-controller")}else y.fetchType=fetch.bind(self),y.abortControllerType=AbortController;return y}return W(FetchHttpClient,h),FetchHttpClient.prototype.send=function(h){return FetchHttpClient_awaiter(this,void 0,void 0,(function(){var m,y,v,T,w,A,M,D=this;return FetchHttpClient_generator(this,(function(I){switch(I.label){case 0:if(h.abortSignal&&h.abortSignal.aborted)throw new R;if(!h.method)throw new Error("No method defined.");if(!h.url)throw new Error("No url defined.");m=new this.abortControllerType,h.abortSignal&&(h.abortSignal.onabort=function(){m.abort(),y=new R}),v=null,h.timeout&&(T=h.timeout,v=setTimeout((function(){m.abort(),D.logger.log(C.Warning,"Timeout from HTTP request."),y=new k}),T)),I.label=1;case 1:return I.trys.push([1,3,4,5]),[4,this.fetchType(h.url,{body:h.content,cache:"no-cache",credentials:!0===h.withCredentials?"include":"same-origin",headers:q({"Content-Type":"text/plain;charset=UTF-8","X-Requested-With":"XMLHttpRequest"},h.headers),method:h.method,mode:"cors",redirect:"manual",signal:m.signal})];case 2:return w=I.sent(),[3,5];case 3:if(A=I.sent(),y)throw y;throw this.logger.log(C.Warning,"Error from HTTP request. "+A+"."),A;case 4:return v&&clearTimeout(v),h.abortSignal&&(h.abortSignal.onabort=null),[7];case 5:if(!w.ok)throw new P(w.statusText,w.status);return[4,function deserializeContent(h,m){var y;switch(m){case"arraybuffer":y=h.arrayBuffer();break;case"text":y=h.text();break;case"blob":case"document":case"json":throw new Error(m+" is not supported.");default:y=h.text()}return y}(w,h.responseType)];case 6:return M=I.sent(),[2,new N(w.status,w.statusText,M)]}}))}))},FetchHttpClient.prototype.getCookieString=function(h){var m="";return L.isNode&&this.jar&&this.jar.getCookies(h,(function(h,y){return m=y.join("; ")})),m},FetchHttpClient}(D);var V,$=function(){var h=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(h,m){h.__proto__=m}||function(h,m){for(var y in m)m.hasOwnProperty(y)&&(h[y]=m[y])};return function(m,y){function __(){this.constructor=m}h(m,y),m.prototype=null===y?Object.create(y):(__.prototype=y.prototype,new __)}}(),z=function(h){function XhrHttpClient(m){var y=h.call(this)||this;return y.logger=m,y}return $(XhrHttpClient,h),XhrHttpClient.prototype.send=function(h){var m=this;return h.abortSignal&&h.abortSignal.aborted?Promise.reject(new R):h.method?h.url?new Promise((function(y,v){var T=new XMLHttpRequest;T.open(h.method,h.url,!0),T.withCredentials=void 0===h.withCredentials||h.withCredentials,T.setRequestHeader("X-Requested-With","XMLHttpRequest"),T.setRequestHeader("Content-Type","text/plain;charset=UTF-8");var w=h.headers;w&&Object.keys(w).forEach((function(h){T.setRequestHeader(h,w[h])})),h.responseType&&(T.responseType=h.responseType),h.abortSignal&&(h.abortSignal.onabort=function(){T.abort(),v(new R)}),h.timeout&&(T.timeout=h.timeout),T.onload=function(){h.abortSignal&&(h.abortSignal.onabort=null),T.status>=200&&T.status<300?y(new N(T.status,T.statusText,T.response||T.responseText)):v(new P(T.statusText,T.status))},T.onerror=function(){m.logger.log(C.Warning,"Error from HTTP request. "+T.status+": "+T.statusText+"."),v(new P(T.statusText,T.status))},T.ontimeout=function(){m.logger.log(C.Warning,"Timeout from HTTP request."),v(new k)},T.send(h.content||"")})):Promise.reject(new Error("No url defined.")):Promise.reject(new Error("No method defined."))},XhrHttpClient}(D),G=function(){var h=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(h,m){h.__proto__=m}||function(h,m){for(var y in m)m.hasOwnProperty(y)&&(h[y]=m[y])};return function(m,y){function __(){this.constructor=m}h(m,y),m.prototype=null===y?Object.create(y):(__.prototype=y.prototype,new __)}}(),J=function(h){function DefaultHttpClient(m){var y=h.call(this)||this;if("undefined"!=typeof fetch||L.isNode)y.httpClient=new Y(m);else{if("undefined"==typeof XMLHttpRequest)throw new Error("No usable HttpClient found.");y.httpClient=new z(m)}return y}return G(DefaultHttpClient,h),DefaultHttpClient.prototype.send=function(h){return h.abortSignal&&h.abortSignal.aborted?Promise.reject(new R):h.method?h.url?this.httpClient.send(h):Promise.reject(new Error("No url defined.")):Promise.reject(new Error("No method defined."))},DefaultHttpClient.prototype.getCookieString=function(h){return this.httpClient.getCookieString(h)},DefaultHttpClient}(D),X=function(){function TextMessageFormat(){}return TextMessageFormat.write=function(h){return""+h+TextMessageFormat.RecordSeparator},TextMessageFormat.parse=function(h){if(h[h.length-1]!==TextMessageFormat.RecordSeparator)throw new Error("Message is incomplete.");var m=h.split(TextMessageFormat.RecordSeparator);return m.pop(),m},TextMessageFormat.RecordSeparatorCode=30,TextMessageFormat.RecordSeparator=String.fromCharCode(TextMessageFormat.RecordSeparatorCode),TextMessageFormat}(),Z=function(){function HandshakeProtocol(){}return HandshakeProtocol.prototype.writeHandshakeRequest=function(h){return X.write(JSON.stringify(h))},HandshakeProtocol.prototype.parseHandshakeResponse=function(h){var m,y;if(isArrayBuffer(h)||"undefined"!=typeof Buffer&&h instanceof Buffer){var v=new Uint8Array(h);if(-1===(T=v.indexOf(X.RecordSeparatorCode)))throw new Error("Message is incomplete.");var C=T+1;m=String.fromCharCode.apply(null,v.slice(0,C)),y=v.byteLength>C?v.slice(C).buffer:null}else{var T,w=h;if(-1===(T=w.indexOf(X.RecordSeparator)))throw new Error("Message is incomplete.");C=T+1;m=w.substring(0,C),y=w.length>C?w.substring(C):null}var A=X.parse(m),P=JSON.parse(A[0]);if(P.type)throw new Error("Expected a handshake response from the server.");return[y,P]},HandshakeProtocol}();!function(h){h[h.Invocation=1]="Invocation",h[h.StreamItem=2]="StreamItem",h[h.Completion=3]="Completion",h[h.StreamInvocation=4]="StreamInvocation",h[h.CancelInvocation=5]="CancelInvocation",h[h.Ping=6]="Ping",h[h.Close=7]="Close"}(V||(V={}));var ee,te=function(){function Subject(){this.observers=[]}return Subject.prototype.next=function(h){for(var m=0,y=this.observers;m<y.length;m++){y[m].next(h)}},Subject.prototype.error=function(h){for(var m=0,y=this.observers;m<y.length;m++){var v=y[m];v.error&&v.error(h)}},Subject.prototype.complete=function(){for(var h=0,m=this.observers;h<m.length;h++){var y=m[h];y.complete&&y.complete()}},Subject.prototype.subscribe=function(h){return this.observers.push(h),new U(this,h)},Subject}(),HubConnection_awaiter=function(h,m,y,v){return new(y||(y=Promise))((function(C,T){function fulfilled(h){try{step(v.next(h))}catch(h){T(h)}}function rejected(h){try{step(v.throw(h))}catch(h){T(h)}}function step(h){h.done?C(h.value):new y((function(m){m(h.value)})).then(fulfilled,rejected)}step((v=v.apply(h,m||[])).next())}))},HubConnection_generator=function(h,m){var y,v,C,T,w={label:0,sent:function(){if(1&C[0])throw C[1];return C[1]},trys:[],ops:[]};return T={next:verb(0),throw:verb(1),return:verb(2)},"function"==typeof Symbol&&(T[Symbol.iterator]=function(){return this}),T;function verb(T){return function(A){return function step(T){if(y)throw new TypeError("Generator is already executing.");for(;w;)try{if(y=1,v&&(C=2&T[0]?v.return:T[0]?v.throw||((C=v.return)&&C.call(v),0):v.next)&&!(C=C.call(v,T[1])).done)return C;switch(v=0,C&&(T=[2&T[0],C.value]),T[0]){case 0:case 1:C=T;break;case 4:return w.label++,{value:T[1],done:!1};case 5:w.label++,v=T[1],T=[0];continue;case 7:T=w.ops.pop(),w.trys.pop();continue;default:if(!(C=w.trys,(C=C.length>0&&C[C.length-1])||6!==T[0]&&2!==T[0])){w=0;continue}if(3===T[0]&&(!C||T[1]>C[0]&&T[1]<C[3])){w.label=T[1];break}if(6===T[0]&&w.label<C[1]){w.label=C[1],C=T;break}if(C&&w.label<C[2]){w.label=C[2],w.ops.push(T);break}C[2]&&w.ops.pop(),w.trys.pop();continue}T=m.call(h,w)}catch(h){T=[6,h],v=0}finally{y=C=0}if(5&T[0])throw T[1];return{value:T[0]?T[1]:void 0,done:!0}}([T,A])}}};!function(h){h.Disconnected="Disconnected",h.Connecting="Connecting",h.Connected="Connected",h.Disconnecting="Disconnecting",h.Reconnecting="Reconnecting"}(ee||(ee={}));var re,ie,se=function(){function HubConnection(h,m,y,v){var C=this;this.nextKeepAlive=0,O.isRequired(h,"connection"),O.isRequired(m,"logger"),O.isRequired(y,"protocol"),this.serverTimeoutInMilliseconds=3e4,this.keepAliveIntervalInMilliseconds=15e3,this.logger=m,this.protocol=y,this.connection=h,this.reconnectPolicy=v,this.handshakeProtocol=new Z,this.connection.onreceive=function(h){return C.processIncomingData(h)},this.connection.onclose=function(h){return C.connectionClosed(h)},this.callbacks={},this.methods={},this.closedCallbacks=[],this.reconnectingCallbacks=[],this.reconnectedCallbacks=[],this.invocationId=0,this.receivedHandshakeResponse=!1,this.connectionState=ee.Disconnected,this.connectionStarted=!1,this.cachedPingMessage=this.protocol.writeMessage({type:V.Ping})}return HubConnection.create=function(h,m,y,v){return new HubConnection(h,m,y,v)},Object.defineProperty(HubConnection.prototype,"state",{get:function(){return this.connectionState},enumerable:!0,configurable:!0}),Object.defineProperty(HubConnection.prototype,"connectionId",{get:function(){return this.connection&&this.connection.connectionId||null},enumerable:!0,configurable:!0}),Object.defineProperty(HubConnection.prototype,"baseUrl",{get:function(){return this.connection.baseUrl||""},set:function(h){if(this.connectionState!==ee.Disconnected&&this.connectionState!==ee.Reconnecting)throw new Error("The HubConnection must be in the Disconnected or Reconnecting state to change the url.");if(!h)throw new Error("The HubConnection url must be a valid url.");this.connection.baseUrl=h},enumerable:!0,configurable:!0}),HubConnection.prototype.start=function(){return this.startPromise=this.startWithStateTransitions(),this.startPromise},HubConnection.prototype.startWithStateTransitions=function(){return HubConnection_awaiter(this,void 0,void 0,(function(){var h;return HubConnection_generator(this,(function(m){switch(m.label){case 0:if(this.connectionState!==ee.Disconnected)return[2,Promise.reject(new Error("Cannot start a HubConnection that is not in the 'Disconnected' state."))];this.connectionState=ee.Connecting,this.logger.log(C.Debug,"Starting HubConnection."),m.label=1;case 1:return m.trys.push([1,3,,4]),[4,this.startInternal()];case 2:return m.sent(),this.connectionState=ee.Connected,this.connectionStarted=!0,this.logger.log(C.Debug,"HubConnection connected successfully."),[3,4];case 3:return h=m.sent(),this.connectionState=ee.Disconnected,this.logger.log(C.Debug,"HubConnection failed to start successfully because of error '"+h+"'."),[2,Promise.reject(h)];case 4:return[2]}}))}))},HubConnection.prototype.startInternal=function(){return HubConnection_awaiter(this,void 0,void 0,(function(){var h,m,y,v=this;return HubConnection_generator(this,(function(T){switch(T.label){case 0:return this.stopDuringStartError=void 0,this.receivedHandshakeResponse=!1,h=new Promise((function(h,m){v.handshakeResolver=h,v.handshakeRejecter=m})),[4,this.connection.start(this.protocol.transferFormat)];case 1:T.sent(),T.label=2;case 2:return T.trys.push([2,5,,7]),m={protocol:this.protocol.name,version:this.protocol.version},this.logger.log(C.Debug,"Sending handshake request."),[4,this.sendMessage(this.handshakeProtocol.writeHandshakeRequest(m))];case 3:return T.sent(),this.logger.log(C.Information,"Using HubProtocol '"+this.protocol.name+"'."),this.cleanupTimeout(),this.resetTimeoutPeriod(),this.resetKeepAliveInterval(),[4,h];case 4:if(T.sent(),this.stopDuringStartError)throw this.stopDuringStartError;return[3,7];case 5:return y=T.sent(),this.logger.log(C.Debug,"Hub handshake failed with error '"+y+"' during start(). Stopping HubConnection."),this.cleanupTimeout(),this.cleanupPingTimer(),[4,this.connection.stop(y)];case 6:throw T.sent(),y;case 7:return[2]}}))}))},HubConnection.prototype.stop=function(){return HubConnection_awaiter(this,void 0,void 0,(function(){var h;return HubConnection_generator(this,(function(m){switch(m.label){case 0:return h=this.startPromise,this.stopPromise=this.stopInternal(),[4,this.stopPromise];case 1:m.sent(),m.label=2;case 2:return m.trys.push([2,4,,5]),[4,h];case 3:return m.sent(),[3,5];case 4:return m.sent(),[3,5];case 5:return[2]}}))}))},HubConnection.prototype.stopInternal=function(h){return this.connectionState===ee.Disconnected?(this.logger.log(C.Debug,"Call to HubConnection.stop("+h+") ignored because it is already in the disconnected state."),Promise.resolve()):this.connectionState===ee.Disconnecting?(this.logger.log(C.Debug,"Call to HttpConnection.stop("+h+") ignored because the connection is already in the disconnecting state."),this.stopPromise):(this.connectionState=ee.Disconnecting,this.logger.log(C.Debug,"Stopping HubConnection."),this.reconnectDelayHandle?(this.logger.log(C.Debug,"Connection stopped during reconnect delay. Done reconnecting."),clearTimeout(this.reconnectDelayHandle),this.reconnectDelayHandle=void 0,this.completeClose(),Promise.resolve()):(this.cleanupTimeout(),this.cleanupPingTimer(),this.stopDuringStartError=h||new Error("The connection was stopped before the hub handshake could complete."),this.connection.stop(h)))},HubConnection.prototype.stream=function(h){for(var m=this,y=[],v=1;v<arguments.length;v++)y[v-1]=arguments[v];var C,T=this.replaceStreamingParams(y),w=T[0],A=T[1],P=this.createStreamInvocation(h,y,A),k=new te;return k.cancelCallback=function(){var h=m.createCancelInvocation(P.invocationId);return delete m.callbacks[P.invocationId],C.then((function(){return m.sendWithProtocol(h)}))},this.callbacks[P.invocationId]=function(h,m){m?k.error(m):h&&(h.type===V.Completion?h.error?k.error(new Error(h.error)):k.complete():k.next(h.item))},C=this.sendWithProtocol(P).catch((function(h){k.error(h),delete m.callbacks[P.invocationId]})),this.launchStreams(w,C),k},HubConnection.prototype.sendMessage=function(h){return this.resetKeepAliveInterval(),this.connection.send(h)},HubConnection.prototype.sendWithProtocol=function(h){return this.sendMessage(this.protocol.writeMessage(h))},HubConnection.prototype.send=function(h){for(var m=[],y=1;y<arguments.length;y++)m[y-1]=arguments[y];var v=this.replaceStreamingParams(m),C=v[0],T=v[1],w=this.sendWithProtocol(this.createInvocation(h,m,!0,T));return this.launchStreams(C,w),w},HubConnection.prototype.invoke=function(h){for(var m=this,y=[],v=1;v<arguments.length;v++)y[v-1]=arguments[v];var C=this.replaceStreamingParams(y),T=C[0],w=C[1],A=this.createInvocation(h,y,!1,w),P=new Promise((function(h,y){m.callbacks[A.invocationId]=function(m,v){v?y(v):m&&(m.type===V.Completion?m.error?y(new Error(m.error)):h(m.result):y(new Error("Unexpected message type: "+m.type)))};var v=m.sendWithProtocol(A).catch((function(h){y(h),delete m.callbacks[A.invocationId]}));m.launchStreams(T,v)}));return P},HubConnection.prototype.on=function(h,m){h&&m&&(h=h.toLowerCase(),this.methods[h]||(this.methods[h]=[]),-1===this.methods[h].indexOf(m)&&this.methods[h].push(m))},HubConnection.prototype.off=function(h,m){if(h){h=h.toLowerCase();var y=this.methods[h];if(y)if(m){var v=y.indexOf(m);-1!==v&&(y.splice(v,1),0===y.length&&delete this.methods[h])}else delete this.methods[h]}},HubConnection.prototype.onclose=function(h){h&&this.closedCallbacks.push(h)},HubConnection.prototype.onreconnecting=function(h){h&&this.reconnectingCallbacks.push(h)},HubConnection.prototype.onreconnected=function(h){h&&this.reconnectedCallbacks.push(h)},HubConnection.prototype.processIncomingData=function(h){if(this.cleanupTimeout(),this.receivedHandshakeResponse||(h=this.processHandshakeResponse(h),this.receivedHandshakeResponse=!0),h)for(var m=0,y=this.protocol.parseMessages(h,this.logger);m<y.length;m++){var v=y[m];switch(v.type){case V.Invocation:this.invokeClientMethod(v);break;case V.StreamItem:case V.Completion:var T=this.callbacks[v.invocationId];T&&(v.type===V.Completion&&delete this.callbacks[v.invocationId],T(v));break;case V.Ping:break;case V.Close:this.logger.log(C.Information,"Close message received from server.");var w=v.error?new Error("Server returned an error on close: "+v.error):void 0;!0===v.allowReconnect?this.connection.stop(w):this.stopPromise=this.stopInternal(w);break;default:this.logger.log(C.Warning,"Invalid message type: "+v.type+".")}}this.resetTimeoutPeriod()},HubConnection.prototype.processHandshakeResponse=function(h){var m,y,v;try{v=(m=this.handshakeProtocol.parseHandshakeResponse(h))[0],y=m[1]}catch(h){var T="Error parsing handshake response: "+h;this.logger.log(C.Error,T);var w=new Error(T);throw this.handshakeRejecter(w),w}if(y.error){T="Server returned handshake error: "+y.error;this.logger.log(C.Error,T);w=new Error(T);throw this.handshakeRejecter(w),w}return this.logger.log(C.Debug,"Server handshake complete."),this.handshakeResolver(),v},HubConnection.prototype.resetKeepAliveInterval=function(){this.connection.features.inherentKeepAlive||(this.nextKeepAlive=(new Date).getTime()+this.keepAliveIntervalInMilliseconds,this.cleanupPingTimer())},HubConnection.prototype.resetTimeoutPeriod=function(){var h=this;if(!(this.connection.features&&this.connection.features.inherentKeepAlive||(this.timeoutHandle=setTimeout((function(){return h.serverTimeout()}),this.serverTimeoutInMilliseconds),void 0!==this.pingServerHandle))){var m=this.nextKeepAlive-(new Date).getTime();m<0&&(m=0),this.pingServerHandle=setTimeout((function(){return HubConnection_awaiter(h,void 0,void 0,(function(){return HubConnection_generator(this,(function(h){switch(h.label){case 0:if(this.connectionState!==ee.Connected)return[3,4];h.label=1;case 1:return h.trys.push([1,3,,4]),[4,this.sendMessage(this.cachedPingMessage)];case 2:return h.sent(),[3,4];case 3:return h.sent(),this.cleanupPingTimer(),[3,4];case 4:return[2]}}))}))}),m)}},HubConnection.prototype.serverTimeout=function(){this.connection.stop(new Error("Server timeout elapsed without receiving a message from the server."))},HubConnection.prototype.invokeClientMethod=function(h){var m=this,y=this.methods[h.target.toLowerCase()];if(y){try{y.forEach((function(y){return y.apply(m,h.arguments)}))}catch(m){this.logger.log(C.Error,"A callback for the method "+h.target.toLowerCase()+" threw error '"+m+"'.")}if(h.invocationId){var v="Server requested a response, which is not supported in this version of the client.";this.logger.log(C.Error,v),this.stopPromise=this.stopInternal(new Error(v))}}else this.logger.log(C.Warning,"No client method with the name '"+h.target+"' found.")},HubConnection.prototype.connectionClosed=function(h){this.logger.log(C.Debug,"HubConnection.connectionClosed("+h+") called while in state "+this.connectionState+"."),this.stopDuringStartError=this.stopDuringStartError||h||new Error("The underlying connection was closed before the hub handshake could complete."),this.handshakeResolver&&this.handshakeResolver(),this.cancelCallbacksWithError(h||new Error("Invocation canceled due to the underlying connection being closed.")),this.cleanupTimeout(),this.cleanupPingTimer(),this.connectionState===ee.Disconnecting?this.completeClose(h):this.connectionState===ee.Connected&&this.reconnectPolicy?this.reconnect(h):this.connectionState===ee.Connected&&this.completeClose(h)},HubConnection.prototype.completeClose=function(h){var m=this;if(this.connectionStarted){this.connectionState=ee.Disconnected,this.connectionStarted=!1;try{this.closedCallbacks.forEach((function(y){return y.apply(m,[h])}))}catch(m){this.logger.log(C.Error,"An onclose callback called with error '"+h+"' threw error '"+m+"'.")}}},HubConnection.prototype.reconnect=function(h){return HubConnection_awaiter(this,void 0,void 0,(function(){var m,y,v,T,w,A=this;return HubConnection_generator(this,(function(P){switch(P.label){case 0:if(m=Date.now(),y=0,v=void 0!==h?h:new Error("Attempting to reconnect due to a unknown error."),null===(T=this.getNextRetryDelay(y++,0,v)))return this.logger.log(C.Debug,"Connection not reconnecting because the IRetryPolicy returned null on the first reconnect attempt."),this.completeClose(h),[2];if(this.connectionState=ee.Reconnecting,h?this.logger.log(C.Information,"Connection reconnecting because of error '"+h+"'."):this.logger.log(C.Information,"Connection reconnecting."),this.onreconnecting){try{this.reconnectingCallbacks.forEach((function(m){return m.apply(A,[h])}))}catch(m){this.logger.log(C.Error,"An onreconnecting callback called with error '"+h+"' threw error '"+m+"'.")}if(this.connectionState!==ee.Reconnecting)return this.logger.log(C.Debug,"Connection left the reconnecting state in onreconnecting callback. Done reconnecting."),[2]}P.label=1;case 1:return null===T?[3,7]:(this.logger.log(C.Information,"Reconnect attempt number "+y+" will start in "+T+" ms."),[4,new Promise((function(h){A.reconnectDelayHandle=setTimeout(h,T)}))]);case 2:if(P.sent(),this.reconnectDelayHandle=void 0,this.connectionState!==ee.Reconnecting)return this.logger.log(C.Debug,"Connection left the reconnecting state during reconnect delay. Done reconnecting."),[2];P.label=3;case 3:return P.trys.push([3,5,,6]),[4,this.startInternal()];case 4:if(P.sent(),this.connectionState=ee.Connected,this.logger.log(C.Information,"HubConnection reconnected successfully."),this.onreconnected)try{this.reconnectedCallbacks.forEach((function(h){return h.apply(A,[A.connection.connectionId])}))}catch(h){this.logger.log(C.Error,"An onreconnected callback called with connectionId '"+this.connection.connectionId+"; threw error '"+h+"'.")}return[2];case 5:return w=P.sent(),this.logger.log(C.Information,"Reconnect attempt failed because of error '"+w+"'."),this.connectionState!==ee.Reconnecting?(this.logger.log(C.Debug,"Connection moved to the '"+this.connectionState+"' from the reconnecting state during reconnect attempt. Done reconnecting."),this.connectionState===ee.Disconnecting&&this.completeClose(),[2]):(v=w instanceof Error?w:new Error(w.toString()),T=this.getNextRetryDelay(y++,Date.now()-m,v),[3,6]);case 6:return[3,1];case 7:return this.logger.log(C.Information,"Reconnect retries have been exhausted after "+(Date.now()-m)+" ms and "+y+" failed attempts. Connection disconnecting."),this.completeClose(),[2]}}))}))},HubConnection.prototype.getNextRetryDelay=function(h,m,y){try{return this.reconnectPolicy.nextRetryDelayInMilliseconds({elapsedMilliseconds:m,previousRetryCount:h,retryReason:y})}catch(y){return this.logger.log(C.Error,"IRetryPolicy.nextRetryDelayInMilliseconds("+h+", "+m+") threw error '"+y+"'."),null}},HubConnection.prototype.cancelCallbacksWithError=function(h){var m=this.callbacks;this.callbacks={},Object.keys(m).forEach((function(y){(0,m[y])(null,h)}))},HubConnection.prototype.cleanupPingTimer=function(){this.pingServerHandle&&(clearTimeout(this.pingServerHandle),this.pingServerHandle=void 0)},HubConnection.prototype.cleanupTimeout=function(){this.timeoutHandle&&clearTimeout(this.timeoutHandle)},HubConnection.prototype.createInvocation=function(h,m,y,v){if(y)return 0!==v.length?{arguments:m,streamIds:v,target:h,type:V.Invocation}:{arguments:m,target:h,type:V.Invocation};var C=this.invocationId;return this.invocationId++,0!==v.length?{arguments:m,invocationId:C.toString(),streamIds:v,target:h,type:V.Invocation}:{arguments:m,invocationId:C.toString(),target:h,type:V.Invocation}},HubConnection.prototype.launchStreams=function(h,m){var y=this;if(0!==h.length){m||(m=Promise.resolve());var _loop_1=function(v){h[v].subscribe({complete:function(){m=m.then((function(){return y.sendWithProtocol(y.createCompletionMessage(v))}))},error:function(h){var C;C=h instanceof Error?h.message:h&&h.toString?h.toString():"Unknown error",m=m.then((function(){return y.sendWithProtocol(y.createCompletionMessage(v,C))}))},next:function(h){m=m.then((function(){return y.sendWithProtocol(y.createStreamItemMessage(v,h))}))}})};for(var v in h)_loop_1(v)}},HubConnection.prototype.replaceStreamingParams=function(h){for(var m=[],y=[],v=0;v<h.length;v++){var C=h[v];if(this.isObservable(C)){var T=this.invocationId;this.invocationId++,m[T]=C,y.push(T.toString()),h.splice(v,1)}}return[m,y]},HubConnection.prototype.isObservable=function(h){return h&&h.subscribe&&"function"==typeof h.subscribe},HubConnection.prototype.createStreamInvocation=function(h,m,y){var v=this.invocationId;return this.invocationId++,0!==y.length?{arguments:m,invocationId:v.toString(),streamIds:y,target:h,type:V.StreamInvocation}:{arguments:m,invocationId:v.toString(),target:h,type:V.StreamInvocation}},HubConnection.prototype.createCancelInvocation=function(h){return{invocationId:h,type:V.CancelInvocation}},HubConnection.prototype.createStreamItemMessage=function(h,m){return{invocationId:h,item:m,type:V.StreamItem}},HubConnection.prototype.createCompletionMessage=function(h,m,y){return m?{error:m,invocationId:h,type:V.Completion}:{invocationId:h,result:y,type:V.Completion}},HubConnection}(),oe=[0,2e3,1e4,3e4,null],ae=function(){function DefaultReconnectPolicy(h){this.retryDelays=void 0!==h?h.concat([null]):oe}return DefaultReconnectPolicy.prototype.nextRetryDelayInMilliseconds=function(h){return this.retryDelays[h.previousRetryCount]},DefaultReconnectPolicy}();!function(h){h[h.None=0]="None",h[h.WebSockets=1]="WebSockets",h[h.ServerSentEvents=2]="ServerSentEvents",h[h.LongPolling=4]="LongPolling"}(re||(re={})),function(h){h[h.Text=1]="Text",h[h.Binary=2]="Binary"}(ie||(ie={}));var ce=function(){function AbortController(){this.isAborted=!1,this.onabort=null}return AbortController.prototype.abort=function(){this.isAborted||(this.isAborted=!0,this.onabort&&this.onabort())},Object.defineProperty(AbortController.prototype,"signal",{get:function(){return this},enumerable:!0,configurable:!0}),Object.defineProperty(AbortController.prototype,"aborted",{get:function(){return this.isAborted},enumerable:!0,configurable:!0}),AbortController}(),le=Object.assign||function(h){for(var m,y=1,v=arguments.length;y<v;y++)for(var C in m=arguments[y])Object.prototype.hasOwnProperty.call(m,C)&&(h[C]=m[C]);return h},LongPollingTransport_awaiter=function(h,m,y,v){return new(y||(y=Promise))((function(C,T){function fulfilled(h){try{step(v.next(h))}catch(h){T(h)}}function rejected(h){try{step(v.throw(h))}catch(h){T(h)}}function step(h){h.done?C(h.value):new y((function(m){m(h.value)})).then(fulfilled,rejected)}step((v=v.apply(h,m||[])).next())}))},LongPollingTransport_generator=function(h,m){var y,v,C,T,w={label:0,sent:function(){if(1&C[0])throw C[1];return C[1]},trys:[],ops:[]};return T={next:verb(0),throw:verb(1),return:verb(2)},"function"==typeof Symbol&&(T[Symbol.iterator]=function(){return this}),T;function verb(T){return function(A){return function step(T){if(y)throw new TypeError("Generator is already executing.");for(;w;)try{if(y=1,v&&(C=2&T[0]?v.return:T[0]?v.throw||((C=v.return)&&C.call(v),0):v.next)&&!(C=C.call(v,T[1])).done)return C;switch(v=0,C&&(T=[2&T[0],C.value]),T[0]){case 0:case 1:C=T;break;case 4:return w.label++,{value:T[1],done:!1};case 5:w.label++,v=T[1],T=[0];continue;case 7:T=w.ops.pop(),w.trys.pop();continue;default:if(!(C=w.trys,(C=C.length>0&&C[C.length-1])||6!==T[0]&&2!==T[0])){w=0;continue}if(3===T[0]&&(!C||T[1]>C[0]&&T[1]<C[3])){w.label=T[1];break}if(6===T[0]&&w.label<C[1]){w.label=C[1],C=T;break}if(C&&w.label<C[2]){w.label=C[2],w.ops.push(T);break}C[2]&&w.ops.pop(),w.trys.pop();continue}T=m.call(h,w)}catch(h){T=[6,h],v=0}finally{y=C=0}if(5&T[0])throw T[1];return{value:T[0]?T[1]:void 0,done:!0}}([T,A])}}},ue=function(){function LongPollingTransport(h,m,y,v,C,T){this.httpClient=h,this.accessTokenFactory=m,this.logger=y,this.pollAbort=new ce,this.logMessageContent=v,this.withCredentials=C,this.headers=T,this.running=!1,this.onreceive=null,this.onclose=null}return Object.defineProperty(LongPollingTransport.prototype,"pollAborted",{get:function(){return this.pollAbort.aborted},enumerable:!0,configurable:!0}),LongPollingTransport.prototype.connect=function(h,m){return LongPollingTransport_awaiter(this,void 0,void 0,(function(){var y,v,T,w,A,k,R,M,N;return LongPollingTransport_generator(this,(function(D){switch(D.label){case 0:if(O.isRequired(h,"url"),O.isRequired(m,"transferFormat"),O.isIn(m,ie,"transferFormat"),this.url=h,this.logger.log(C.Trace,"(LongPolling transport) Connecting."),m===ie.Binary&&"undefined"!=typeof XMLHttpRequest&&"string"!=typeof(new XMLHttpRequest).responseType)throw new Error("Binary protocols over XmlHttpRequest not implementing advanced features are not supported.");return v=getUserAgentHeader(),T=v[0],w=v[1],A=le(((y={})[T]=w,y),this.headers),k={abortSignal:this.pollAbort.signal,headers:A,timeout:1e5,withCredentials:this.withCredentials},m===ie.Binary&&(k.responseType="arraybuffer"),[4,this.getAccessToken()];case 1:return R=D.sent(),this.updateHeaderToken(k,R),M=h+"&_="+Date.now(),this.logger.log(C.Trace,"(LongPolling transport) polling: "+M+"."),[4,this.httpClient.get(M,k)];case 2:return 200!==(N=D.sent()).statusCode?(this.logger.log(C.Error,"(LongPolling transport) Unexpected response code: "+N.statusCode+"."),this.closeError=new P(N.statusText||"",N.statusCode),this.running=!1):this.running=!0,this.receiving=this.poll(this.url,k),[2]}}))}))},LongPollingTransport.prototype.getAccessToken=function(){return LongPollingTransport_awaiter(this,void 0,void 0,(function(){return LongPollingTransport_generator(this,(function(h){switch(h.label){case 0:return this.accessTokenFactory?[4,this.accessTokenFactory()]:[3,2];case 1:return[2,h.sent()];case 2:return[2,null]}}))}))},LongPollingTransport.prototype.updateHeaderToken=function(h,m){h.headers||(h.headers={}),m?h.headers.Authorization="Bearer "+m:h.headers.Authorization&&delete h.headers.Authorization},LongPollingTransport.prototype.poll=function(h,m){return LongPollingTransport_awaiter(this,void 0,void 0,(function(){var y,v,T,w;return LongPollingTransport_generator(this,(function(A){switch(A.label){case 0:A.trys.push([0,,8,9]),A.label=1;case 1:return this.running?[4,this.getAccessToken()]:[3,7];case 2:y=A.sent(),this.updateHeaderToken(m,y),A.label=3;case 3:return A.trys.push([3,5,,6]),v=h+"&_="+Date.now(),this.logger.log(C.Trace,"(LongPolling transport) polling: "+v+"."),[4,this.httpClient.get(v,m)];case 4:return 204===(T=A.sent()).statusCode?(this.logger.log(C.Information,"(LongPolling transport) Poll terminated by server."),this.running=!1):200!==T.statusCode?(this.logger.log(C.Error,"(LongPolling transport) Unexpected response code: "+T.statusCode+"."),this.closeError=new P(T.statusText||"",T.statusCode),this.running=!1):T.content?(this.logger.log(C.Trace,"(LongPolling transport) data received. "+getDataDetail(T.content,this.logMessageContent)+"."),this.onreceive&&this.onreceive(T.content)):this.logger.log(C.Trace,"(LongPolling transport) Poll timed out, reissuing."),[3,6];case 5:return w=A.sent(),this.running?w instanceof k?this.logger.log(C.Trace,"(LongPolling transport) Poll timed out, reissuing."):(this.closeError=w,this.running=!1):this.logger.log(C.Trace,"(LongPolling transport) Poll errored after shutdown: "+w.message),[3,6];case 6:return[3,1];case 7:return[3,9];case 8:return this.logger.log(C.Trace,"(LongPolling transport) Polling complete."),this.pollAborted||this.raiseOnClose(),[7];case 9:return[2]}}))}))},LongPollingTransport.prototype.send=function(h){return LongPollingTransport_awaiter(this,void 0,void 0,(function(){return LongPollingTransport_generator(this,(function(m){return this.running?[2,sendMessage(this.logger,"LongPolling",this.httpClient,this.url,this.accessTokenFactory,h,this.logMessageContent,this.withCredentials,this.headers)]:[2,Promise.reject(new Error("Cannot send until the transport is connected"))]}))}))},LongPollingTransport.prototype.stop=function(){return LongPollingTransport_awaiter(this,void 0,void 0,(function(){var h,m,y,v,T,w;return LongPollingTransport_generator(this,(function(A){switch(A.label){case 0:this.logger.log(C.Trace,"(LongPolling transport) Stopping polling."),this.running=!1,this.pollAbort.abort(),A.label=1;case 1:return A.trys.push([1,,5,6]),[4,this.receiving];case 2:return A.sent(),this.logger.log(C.Trace,"(LongPolling transport) sending DELETE request to "+this.url+"."),h={},m=getUserAgentHeader(),y=m[0],v=m[1],h[y]=v,T={headers:le({},h,this.headers),withCredentials:this.withCredentials},[4,this.getAccessToken()];case 3:return w=A.sent(),this.updateHeaderToken(T,w),[4,this.httpClient.delete(this.url,T)];case 4:return A.sent(),this.logger.log(C.Trace,"(LongPolling transport) DELETE request sent."),[3,6];case 5:return this.logger.log(C.Trace,"(LongPolling transport) Stop finished."),this.raiseOnClose(),[7];case 6:return[2]}}))}))},LongPollingTransport.prototype.raiseOnClose=function(){if(this.onclose){var h="(LongPolling transport) Firing onclose event.";this.closeError&&(h+=" Error: "+this.closeError),this.logger.log(C.Trace,h),this.onclose(this.closeError)}},LongPollingTransport}(),de=Object.assign||function(h){for(var m,y=1,v=arguments.length;y<v;y++)for(var C in m=arguments[y])Object.prototype.hasOwnProperty.call(m,C)&&(h[C]=m[C]);return h},ServerSentEventsTransport_awaiter=function(h,m,y,v){return new(y||(y=Promise))((function(C,T){function fulfilled(h){try{step(v.next(h))}catch(h){T(h)}}function rejected(h){try{step(v.throw(h))}catch(h){T(h)}}function step(h){h.done?C(h.value):new y((function(m){m(h.value)})).then(fulfilled,rejected)}step((v=v.apply(h,m||[])).next())}))},ServerSentEventsTransport_generator=function(h,m){var y,v,C,T,w={label:0,sent:function(){if(1&C[0])throw C[1];return C[1]},trys:[],ops:[]};return T={next:verb(0),throw:verb(1),return:verb(2)},"function"==typeof Symbol&&(T[Symbol.iterator]=function(){return this}),T;function verb(T){return function(A){return function step(T){if(y)throw new TypeError("Generator is already executing.");for(;w;)try{if(y=1,v&&(C=2&T[0]?v.return:T[0]?v.throw||((C=v.return)&&C.call(v),0):v.next)&&!(C=C.call(v,T[1])).done)return C;switch(v=0,C&&(T=[2&T[0],C.value]),T[0]){case 0:case 1:C=T;break;case 4:return w.label++,{value:T[1],done:!1};case 5:w.label++,v=T[1],T=[0];continue;case 7:T=w.ops.pop(),w.trys.pop();continue;default:if(!(C=w.trys,(C=C.length>0&&C[C.length-1])||6!==T[0]&&2!==T[0])){w=0;continue}if(3===T[0]&&(!C||T[1]>C[0]&&T[1]<C[3])){w.label=T[1];break}if(6===T[0]&&w.label<C[1]){w.label=C[1],C=T;break}if(C&&w.label<C[2]){w.label=C[2],w.ops.push(T);break}C[2]&&w.ops.pop(),w.trys.pop();continue}T=m.call(h,w)}catch(h){T=[6,h],v=0}finally{y=C=0}if(5&T[0])throw T[1];return{value:T[0]?T[1]:void 0,done:!0}}([T,A])}}},he=function(){function ServerSentEventsTransport(h,m,y,v,C,T,w){this.httpClient=h,this.accessTokenFactory=m,this.logger=y,this.logMessageContent=v,this.withCredentials=T,this.eventSourceConstructor=C,this.headers=w,this.onreceive=null,this.onclose=null}return ServerSentEventsTransport.prototype.connect=function(h,m){return ServerSentEventsTransport_awaiter(this,void 0,void 0,(function(){var y,v=this;return ServerSentEventsTransport_generator(this,(function(T){switch(T.label){case 0:return O.isRequired(h,"url"),O.isRequired(m,"transferFormat"),O.isIn(m,ie,"transferFormat"),this.logger.log(C.Trace,"(SSE transport) Connecting."),this.url=h,this.accessTokenFactory?[4,this.accessTokenFactory()]:[3,2];case 1:(y=T.sent())&&(h+=(h.indexOf("?")<0?"?":"&")+"access_token="+encodeURIComponent(y)),T.label=2;case 2:return[2,new Promise((function(y,T){var w=!1;if(m===ie.Text){var A;if(L.isBrowser||L.isWebWorker)A=new v.eventSourceConstructor(h,{withCredentials:v.withCredentials});else{var P=v.httpClient.getCookieString(h),k={};k.Cookie=P;var R=getUserAgentHeader(),M=R[0],N=R[1];k[M]=N,A=new v.eventSourceConstructor(h,{withCredentials:v.withCredentials,headers:de({},k,v.headers)})}try{A.onmessage=function(h){if(v.onreceive)try{v.logger.log(C.Trace,"(SSE transport) data received. "+getDataDetail(h.data,v.logMessageContent)+"."),v.onreceive(h.data)}catch(h){return void v.close(h)}},A.onerror=function(h){var m=new Error(h.data||"Error occurred");w?v.close(m):T(m)},A.onopen=function(){v.logger.log(C.Information,"SSE connected to "+v.url),v.eventSource=A,w=!0,y()}}catch(h){return void T(h)}}else T(new Error("The Server-Sent Events transport only supports the 'Text' transfer format"))}))]}}))}))},ServerSentEventsTransport.prototype.send=function(h){return ServerSentEventsTransport_awaiter(this,void 0,void 0,(function(){return ServerSentEventsTransport_generator(this,(function(m){return this.eventSource?[2,sendMessage(this.logger,"SSE",this.httpClient,this.url,this.accessTokenFactory,h,this.logMessageContent,this.withCredentials,this.headers)]:[2,Promise.reject(new Error("Cannot send until the transport is connected"))]}))}))},ServerSentEventsTransport.prototype.stop=function(){return this.close(),Promise.resolve()},ServerSentEventsTransport.prototype.close=function(h){this.eventSource&&(this.eventSource.close(),this.eventSource=void 0,this.onclose&&this.onclose(h))},ServerSentEventsTransport}(),pe=Object.assign||function(h){for(var m,y=1,v=arguments.length;y<v;y++)for(var C in m=arguments[y])Object.prototype.hasOwnProperty.call(m,C)&&(h[C]=m[C]);return h},WebSocketTransport_awaiter=function(h,m,y,v){return new(y||(y=Promise))((function(C,T){function fulfilled(h){try{step(v.next(h))}catch(h){T(h)}}function rejected(h){try{step(v.throw(h))}catch(h){T(h)}}function step(h){h.done?C(h.value):new y((function(m){m(h.value)})).then(fulfilled,rejected)}step((v=v.apply(h,m||[])).next())}))},WebSocketTransport_generator=function(h,m){var y,v,C,T,w={label:0,sent:function(){if(1&C[0])throw C[1];return C[1]},trys:[],ops:[]};return T={next:verb(0),throw:verb(1),return:verb(2)},"function"==typeof Symbol&&(T[Symbol.iterator]=function(){return this}),T;function verb(T){return function(A){return function step(T){if(y)throw new TypeError("Generator is already executing.");for(;w;)try{if(y=1,v&&(C=2&T[0]?v.return:T[0]?v.throw||((C=v.return)&&C.call(v),0):v.next)&&!(C=C.call(v,T[1])).done)return C;switch(v=0,C&&(T=[2&T[0],C.value]),T[0]){case 0:case 1:C=T;break;case 4:return w.label++,{value:T[1],done:!1};case 5:w.label++,v=T[1],T=[0];continue;case 7:T=w.ops.pop(),w.trys.pop();continue;default:if(!(C=w.trys,(C=C.length>0&&C[C.length-1])||6!==T[0]&&2!==T[0])){w=0;continue}if(3===T[0]&&(!C||T[1]>C[0]&&T[1]<C[3])){w.label=T[1];break}if(6===T[0]&&w.label<C[1]){w.label=C[1],C=T;break}if(C&&w.label<C[2]){w.label=C[2],w.ops.push(T);break}C[2]&&w.ops.pop(),w.trys.pop();continue}T=m.call(h,w)}catch(h){T=[6,h],v=0}finally{y=C=0}if(5&T[0])throw T[1];return{value:T[0]?T[1]:void 0,done:!0}}([T,A])}}},me=function(){function WebSocketTransport(h,m,y,v,C,T){this.logger=y,this.accessTokenFactory=m,this.logMessageContent=v,this.webSocketConstructor=C,this.httpClient=h,this.onreceive=null,this.onclose=null,this.headers=T}return WebSocketTransport.prototype.connect=function(h,m){return WebSocketTransport_awaiter(this,void 0,void 0,(function(){var y,v=this;return WebSocketTransport_generator(this,(function(T){switch(T.label){case 0:return O.isRequired(h,"url"),O.isRequired(m,"transferFormat"),O.isIn(m,ie,"transferFormat"),this.logger.log(C.Trace,"(WebSockets transport) Connecting."),this.accessTokenFactory?[4,this.accessTokenFactory()]:[3,2];case 1:(y=T.sent())&&(h+=(h.indexOf("?")<0?"?":"&")+"access_token="+encodeURIComponent(y)),T.label=2;case 2:return[2,new Promise((function(y,T){var w;h=h.replace(/^http/,"ws");var A=v.httpClient.getCookieString(h),P=!1;if(L.isNode){var k={},R=getUserAgentHeader(),M=R[0],N=R[1];k[M]=N,A&&(k.Cookie=""+A),w=new v.webSocketConstructor(h,void 0,{headers:pe({},k,v.headers)})}w||(w=new v.webSocketConstructor(h)),m===ie.Binary&&(w.binaryType="arraybuffer"),w.onopen=function(m){v.logger.log(C.Information,"WebSocket connected to "+h+"."),v.webSocket=w,P=!0,y()},w.onerror=function(h){var m=null;m="undefined"!=typeof ErrorEvent&&h instanceof ErrorEvent?h.error:new Error("There was an error with the transport."),T(m)},w.onmessage=function(h){if(v.logger.log(C.Trace,"(WebSockets transport) data received. "+getDataDetail(h.data,v.logMessageContent)+"."),v.onreceive)try{v.onreceive(h.data)}catch(h){return void v.close(h)}},w.onclose=function(h){if(P)v.close(h);else{var m=null;m="undefined"!=typeof ErrorEvent&&h instanceof ErrorEvent?h.error:new Error("There was an error with the transport."),T(m)}}}))]}}))}))},WebSocketTransport.prototype.send=function(h){return this.webSocket&&this.webSocket.readyState===this.webSocketConstructor.OPEN?(this.logger.log(C.Trace,"(WebSockets transport) sending data. "+getDataDetail(h,this.logMessageContent)+"."),this.webSocket.send(h),Promise.resolve()):Promise.reject("WebSocket is not in the OPEN state")},WebSocketTransport.prototype.stop=function(){return this.webSocket&&this.close(void 0),Promise.resolve()},WebSocketTransport.prototype.close=function(h){this.webSocket&&(this.webSocket.onclose=function(){},this.webSocket.onmessage=function(){},this.webSocket.onerror=function(){},this.webSocket.close(),this.webSocket=void 0),this.logger.log(C.Trace,"(WebSockets transport) socket closed."),this.onclose&&(!this.isCloseEvent(h)||!1!==h.wasClean&&1e3===h.code?h instanceof Error?this.onclose(h):this.onclose():this.onclose(new Error("WebSocket closed with status code: "+h.code+" ("+h.reason+").")))},WebSocketTransport.prototype.isCloseEvent=function(h){return h&&"boolean"==typeof h.wasClean&&"number"==typeof h.code},WebSocketTransport}(),fe=Object.assign||function(h){for(var m,y=1,v=arguments.length;y<v;y++)for(var C in m=arguments[y])Object.prototype.hasOwnProperty.call(m,C)&&(h[C]=m[C]);return h},HttpConnection_awaiter=function(h,m,y,v){return new(y||(y=Promise))((function(C,T){function fulfilled(h){try{step(v.next(h))}catch(h){T(h)}}function rejected(h){try{step(v.throw(h))}catch(h){T(h)}}function step(h){h.done?C(h.value):new y((function(m){m(h.value)})).then(fulfilled,rejected)}step((v=v.apply(h,m||[])).next())}))},HttpConnection_generator=function(h,m){var y,v,C,T,w={label:0,sent:function(){if(1&C[0])throw C[1];return C[1]},trys:[],ops:[]};return T={next:verb(0),throw:verb(1),return:verb(2)},"function"==typeof Symbol&&(T[Symbol.iterator]=function(){return this}),T;function verb(T){return function(A){return function step(T){if(y)throw new TypeError("Generator is already executing.");for(;w;)try{if(y=1,v&&(C=2&T[0]?v.return:T[0]?v.throw||((C=v.return)&&C.call(v),0):v.next)&&!(C=C.call(v,T[1])).done)return C;switch(v=0,C&&(T=[2&T[0],C.value]),T[0]){case 0:case 1:C=T;break;case 4:return w.label++,{value:T[1],done:!1};case 5:w.label++,v=T[1],T=[0];continue;case 7:T=w.ops.pop(),w.trys.pop();continue;default:if(!(C=w.trys,(C=C.length>0&&C[C.length-1])||6!==T[0]&&2!==T[0])){w=0;continue}if(3===T[0]&&(!C||T[1]>C[0]&&T[1]<C[3])){w.label=T[1];break}if(6===T[0]&&w.label<C[1]){w.label=C[1],C=T;break}if(C&&w.label<C[2]){w.label=C[2],w.ops.push(T);break}C[2]&&w.ops.pop(),w.trys.pop();continue}T=m.call(h,w)}catch(h){T=[6,h],v=0}finally{y=C=0}if(5&T[0])throw T[1];return{value:T[0]?T[1]:void 0,done:!0}}([T,A])}}},ye=function(){function HttpConnection(h,m){if(void 0===m&&(m={}),this.stopPromiseResolver=function(){},this.features={},this.negotiateVersion=1,O.isRequired(h,"url"),this.logger=function createLogger(h){return void 0===h?new B(C.Information):null===h?I.instance:h.log?h:new B(h)}(m.logger),this.baseUrl=this.resolveUrl(h),(m=m||{}).logMessageContent=void 0!==m.logMessageContent&&m.logMessageContent,"boolean"!=typeof m.withCredentials&&void 0!==m.withCredentials)throw new Error("withCredentials option was not a 'boolean' or 'undefined' value");m.withCredentials=void 0===m.withCredentials||m.withCredentials;var y=null,v=null;if(L.isNode){var T=require;y=T("ws"),v=T("eventsource")}L.isNode||"undefined"==typeof WebSocket||m.WebSocket?L.isNode&&!m.WebSocket&&y&&(m.WebSocket=y):m.WebSocket=WebSocket,L.isNode||"undefined"==typeof EventSource||m.EventSource?L.isNode&&!m.EventSource&&void 0!==v&&(m.EventSource=v):m.EventSource=EventSource,this.httpClient=m.httpClient||new J(this.logger),this.connectionState="Disconnected",this.connectionStarted=!1,this.options=m,this.onreceive=null,this.onclose=null}return HttpConnection.prototype.start=function(h){return HttpConnection_awaiter(this,void 0,void 0,(function(){var m;return HttpConnection_generator(this,(function(y){switch(y.label){case 0:return h=h||ie.Binary,O.isIn(h,ie,"transferFormat"),this.logger.log(C.Debug,"Starting connection with transfer format '"+ie[h]+"'."),"Disconnected"!==this.connectionState?[2,Promise.reject(new Error("Cannot start an HttpConnection that is not in the 'Disconnected' state."))]:(this.connectionState="Connecting",this.startInternalPromise=this.startInternal(h),[4,this.startInternalPromise]);case 1:return y.sent(),"Disconnecting"!==this.connectionState?[3,3]:(m="Failed to start the HttpConnection before stop() was called.",this.logger.log(C.Error,m),[4,this.stopPromise]);case 2:return y.sent(),[2,Promise.reject(new Error(m))];case 3:if("Connected"!==this.connectionState)return m="HttpConnection.startInternal completed gracefully but didn't enter the connection into the connected state!",this.logger.log(C.Error,m),[2,Promise.reject(new Error(m))];y.label=4;case 4:return this.connectionStarted=!0,[2]}}))}))},HttpConnection.prototype.send=function(h){return"Connected"!==this.connectionState?Promise.reject(new Error("Cannot send data if the connection is not in the 'Connected' State.")):(this.sendQueue||(this.sendQueue=new ve(this.transport)),this.sendQueue.send(h))},HttpConnection.prototype.stop=function(h){return HttpConnection_awaiter(this,void 0,void 0,(function(){var m=this;return HttpConnection_generator(this,(function(y){switch(y.label){case 0:return"Disconnected"===this.connectionState?(this.logger.log(C.Debug,"Call to HttpConnection.stop("+h+") ignored because the connection is already in the disconnected state."),[2,Promise.resolve()]):"Disconnecting"===this.connectionState?(this.logger.log(C.Debug,"Call to HttpConnection.stop("+h+") ignored because the connection is already in the disconnecting state."),[2,this.stopPromise]):(this.connectionState="Disconnecting",this.stopPromise=new Promise((function(h){m.stopPromiseResolver=h})),[4,this.stopInternal(h)]);case 1:return y.sent(),[4,this.stopPromise];case 2:return y.sent(),[2]}}))}))},HttpConnection.prototype.stopInternal=function(h){return HttpConnection_awaiter(this,void 0,void 0,(function(){var m;return HttpConnection_generator(this,(function(y){switch(y.label){case 0:this.stopError=h,y.label=1;case 1:return y.trys.push([1,3,,4]),[4,this.startInternalPromise];case 2:return y.sent(),[3,4];case 3:return y.sent(),[3,4];case 4:if(!this.transport)return[3,9];y.label=5;case 5:return y.trys.push([5,7,,8]),[4,this.transport.stop()];case 6:return y.sent(),[3,8];case 7:return m=y.sent(),this.logger.log(C.Error,"HttpConnection.transport.stop() threw error '"+m+"'."),this.stopConnection(),[3,8];case 8:return this.transport=void 0,[3,10];case 9:this.logger.log(C.Debug,"HttpConnection.transport is undefined in HttpConnection.stop() because start() failed."),y.label=10;case 10:return[2]}}))}))},HttpConnection.prototype.startInternal=function(h){return HttpConnection_awaiter(this,void 0,void 0,(function(){var m,y,v,T,w,A;return HttpConnection_generator(this,(function(P){switch(P.label){case 0:m=this.baseUrl,this.accessTokenFactory=this.options.accessTokenFactory,P.label=1;case 1:return P.trys.push([1,12,,13]),this.options.skipNegotiation?this.options.transport!==re.WebSockets?[3,3]:(this.transport=this.constructTransport(re.WebSockets),[4,this.startTransport(m,h)]):[3,5];case 2:return P.sent(),[3,4];case 3:throw new Error("Negotiation can only be skipped when using the WebSocket transport directly.");case 4:return[3,11];case 5:y=null,v=0,T=function(){var h;return HttpConnection_generator(this,(function(C){switch(C.label){case 0:return[4,w.getNegotiationResponse(m)];case 1:if(y=C.sent(),"Disconnecting"===w.connectionState||"Disconnected"===w.connectionState)throw new Error("The connection was stopped during negotiation.");if(y.error)throw new Error(y.error);if(y.ProtocolVersion)throw new Error("Detected a connection attempt to an ASP.NET SignalR Server. This client only supports connecting to an ASP.NET Core SignalR Server. See https://aka.ms/signalr-core-differences for details.");return y.url&&(m=y.url),y.accessToken&&(h=y.accessToken,w.accessTokenFactory=function(){return h}),v++,[2]}}))},w=this,P.label=6;case 6:return[5,T()];case 7:P.sent(),P.label=8;case 8:if(y.url&&v<100)return[3,6];P.label=9;case 9:if(100===v&&y.url)throw new Error("Negotiate redirection limit exceeded.");return[4,this.createTransport(m,this.options.transport,y,h)];case 10:P.sent(),P.label=11;case 11:return this.transport instanceof ue&&(this.features.inherentKeepAlive=!0),"Connecting"===this.connectionState&&(this.logger.log(C.Debug,"The HttpConnection connected successfully."),this.connectionState="Connected"),[3,13];case 12:return A=P.sent(),this.logger.log(C.Error,"Failed to start the connection: "+A),this.connectionState="Disconnected",this.transport=void 0,this.stopPromiseResolver(),[2,Promise.reject(A)];case 13:return[2]}}))}))},HttpConnection.prototype.getNegotiationResponse=function(h){return HttpConnection_awaiter(this,void 0,void 0,(function(){var m,y,v,T,w,A,P,k,R;return HttpConnection_generator(this,(function(M){switch(M.label){case 0:return m={},this.accessTokenFactory?[4,this.accessTokenFactory()]:[3,2];case 1:(y=M.sent())&&(m.Authorization="Bearer "+y),M.label=2;case 2:v=getUserAgentHeader(),T=v[0],w=v[1],m[T]=w,A=this.resolveNegotiateUrl(h),this.logger.log(C.Debug,"Sending negotiation request: "+A+"."),M.label=3;case 3:return M.trys.push([3,5,,6]),[4,this.httpClient.post(A,{content:"",headers:fe({},m,this.options.headers),withCredentials:this.options.withCredentials})];case 4:return 200!==(P=M.sent()).statusCode?[2,Promise.reject(new Error("Unexpected status code returned from negotiate '"+P.statusCode+"'"))]:((!(k=JSON.parse(P.content)).negotiateVersion||k.negotiateVersion<1)&&(k.connectionToken=k.connectionId),[2,k]);case 5:return R=M.sent(),this.logger.log(C.Error,"Failed to complete negotiation with the server: "+R),[2,Promise.reject(R)];case 6:return[2]}}))}))},HttpConnection.prototype.createConnectUrl=function(h,m){return m?h+(-1===h.indexOf("?")?"?":"&")+"id="+m:h},HttpConnection.prototype.createTransport=function(h,m,y,v){return HttpConnection_awaiter(this,void 0,void 0,(function(){var T,w,A,P,k,R,M,N,D,I,x;return HttpConnection_generator(this,(function(O){switch(O.label){case 0:return T=this.createConnectUrl(h,y.connectionToken),this.isITransport(m)?(this.logger.log(C.Debug,"Connection was provided an instance of ITransport, using that directly."),this.transport=m,[4,this.startTransport(T,v)]):[3,2];case 1:return O.sent(),this.connectionId=y.connectionId,[2];case 2:w=[],A=y.availableTransports||[],P=y,k=0,R=A,O.label=3;case 3:return k<R.length?(M=R[k],(N=this.resolveTransportOrError(M,m,v))instanceof Error?(w.push(M.transport+" failed: "+N),[3,12]):[3,4]):[3,13];case 4:if(!this.isITransport(N))return[3,12];if(this.transport=N,P)return[3,9];O.label=5;case 5:return O.trys.push([5,7,,8]),[4,this.getNegotiationResponse(h)];case 6:return P=O.sent(),[3,8];case 7:return D=O.sent(),[2,Promise.reject(D)];case 8:T=this.createConnectUrl(h,P.connectionToken),O.label=9;case 9:return O.trys.push([9,11,,12]),[4,this.startTransport(T,v)];case 10:return O.sent(),this.connectionId=P.connectionId,[2];case 11:return I=O.sent(),this.logger.log(C.Error,"Failed to start the transport '"+M.transport+"': "+I),P=void 0,w.push(M.transport+" failed: "+I),"Connecting"!==this.connectionState?(x="Failed to select transport before stop() was called.",this.logger.log(C.Debug,x),[2,Promise.reject(new Error(x))]):[3,12];case 12:return k++,[3,3];case 13:return w.length>0?[2,Promise.reject(new Error("Unable to connect to the server with any of the available transports. "+w.join(" ")))]:[2,Promise.reject(new Error("None of the transports supported by the client are supported by the server."))]}}))}))},HttpConnection.prototype.constructTransport=function(h){switch(h){case re.WebSockets:if(!this.options.WebSocket)throw new Error("'WebSocket' is not supported in your environment.");return new me(this.httpClient,this.accessTokenFactory,this.logger,this.options.logMessageContent||!1,this.options.WebSocket,this.options.headers||{});case re.ServerSentEvents:if(!this.options.EventSource)throw new Error("'EventSource' is not supported in your environment.");return new he(this.httpClient,this.accessTokenFactory,this.logger,this.options.logMessageContent||!1,this.options.EventSource,this.options.withCredentials,this.options.headers||{});case re.LongPolling:return new ue(this.httpClient,this.accessTokenFactory,this.logger,this.options.logMessageContent||!1,this.options.withCredentials,this.options.headers||{});default:throw new Error("Unknown transport: "+h+".")}},HttpConnection.prototype.startTransport=function(h,m){var y=this;return this.transport.onreceive=this.onreceive,this.transport.onclose=function(h){return y.stopConnection(h)},this.transport.connect(h,m)},HttpConnection.prototype.resolveTransportOrError=function(h,m,y){var v=re[h.transport];if(null==v)return this.logger.log(C.Debug,"Skipping transport '"+h.transport+"' because it is not supported by this client."),new Error("Skipping transport '"+h.transport+"' because it is not supported by this client.");if(!function transportMatches(h,m){return!h||0!=(m&h)}(m,v))return this.logger.log(C.Debug,"Skipping transport '"+re[v]+"' because it was disabled by the client."),new Error("'"+re[v]+"' is disabled by the client.");if(!(h.transferFormats.map((function(h){return ie[h]})).indexOf(y)>=0))return this.logger.log(C.Debug,"Skipping transport '"+re[v]+"' because it does not support the requested transfer format '"+ie[y]+"'."),new Error("'"+re[v]+"' does not support "+ie[y]+".");if(v===re.WebSockets&&!this.options.WebSocket||v===re.ServerSentEvents&&!this.options.EventSource)return this.logger.log(C.Debug,"Skipping transport '"+re[v]+"' because it is not supported in your environment.'"),new Error("'"+re[v]+"' is not supported in your environment.");this.logger.log(C.Debug,"Selecting transport '"+re[v]+"'.");try{return this.constructTransport(v)}catch(h){return h}},HttpConnection.prototype.isITransport=function(h){return h&&"object"==typeof h&&"connect"in h},HttpConnection.prototype.stopConnection=function(h){var m=this;if(this.logger.log(C.Debug,"HttpConnection.stopConnection("+h+") called while in state "+this.connectionState+"."),this.transport=void 0,h=this.stopError||h,this.stopError=void 0,"Disconnected"!==this.connectionState){if("Connecting"===this.connectionState)throw this.logger.log(C.Warning,"Call to HttpConnection.stopConnection("+h+") was ignored because the connection is still in the connecting state."),new Error("HttpConnection.stopConnection("+h+") was called while the connection is still in the connecting state.");if("Disconnecting"===this.connectionState&&this.stopPromiseResolver(),h?this.logger.log(C.Error,"Connection disconnected with error '"+h+"'."):this.logger.log(C.Information,"Connection disconnected."),this.sendQueue&&(this.sendQueue.stop().catch((function(h){m.logger.log(C.Error,"TransportSendQueue.stop() threw error '"+h+"'.")})),this.sendQueue=void 0),this.connectionId=void 0,this.connectionState="Disconnected",this.connectionStarted){this.connectionStarted=!1;try{this.onclose&&this.onclose(h)}catch(m){this.logger.log(C.Error,"HttpConnection.onclose("+h+") threw error '"+m+"'.")}}}else this.logger.log(C.Debug,"Call to HttpConnection.stopConnection("+h+") was ignored because the connection is already in the disconnected state.")},HttpConnection.prototype.resolveUrl=function(h){if(0===h.lastIndexOf("https://",0)||0===h.lastIndexOf("http://",0))return h;if(!L.isBrowser||!window.document)throw new Error("Cannot resolve '"+h+"'.");var m=window.document.createElement("a");return m.href=h,this.logger.log(C.Information,"Normalizing '"+h+"' to '"+m.href+"'."),m.href},HttpConnection.prototype.resolveNegotiateUrl=function(h){var m=h.indexOf("?"),y=h.substring(0,-1===m?h.length:m);return"/"!==y[y.length-1]&&(y+="/"),y+="negotiate",-1===(y+=-1===m?"":h.substring(m)).indexOf("negotiateVersion")&&(y+=-1===m?"?":"&",y+="negotiateVersion="+this.negotiateVersion),y},HttpConnection}();var ve=function(){function TransportSendQueue(h){this.transport=h,this.buffer=[],this.executing=!0,this.sendBufferedData=new Se,this.transportResult=new Se,this.sendLoopPromise=this.sendLoop()}return TransportSendQueue.prototype.send=function(h){return this.bufferData(h),this.transportResult||(this.transportResult=new Se),this.transportResult.promise},TransportSendQueue.prototype.stop=function(){return this.executing=!1,this.sendBufferedData.resolve(),this.sendLoopPromise},TransportSendQueue.prototype.bufferData=function(h){if(this.buffer.length&&typeof this.buffer[0]!=typeof h)throw new Error("Expected data to be of type "+typeof this.buffer+" but was of type "+typeof h);this.buffer.push(h),this.sendBufferedData.resolve()},TransportSendQueue.prototype.sendLoop=function(){return HttpConnection_awaiter(this,void 0,void 0,(function(){var h,m,y;return HttpConnection_generator(this,(function(v){switch(v.label){case 0:return[4,this.sendBufferedData.promise];case 1:if(v.sent(),!this.executing)return this.transportResult&&this.transportResult.reject("Connection stopped."),[3,6];this.sendBufferedData=new Se,h=this.transportResult,this.transportResult=void 0,m="string"==typeof this.buffer[0]?this.buffer.join(""):TransportSendQueue.concatBuffers(this.buffer),this.buffer.length=0,v.label=2;case 2:return v.trys.push([2,4,,5]),[4,this.transport.send(m)];case 3:return v.sent(),h.resolve(),[3,5];case 4:return y=v.sent(),h.reject(y),[3,5];case 5:return[3,0];case 6:return[2]}}))}))},TransportSendQueue.concatBuffers=function(h){for(var m=h.map((function(h){return h.byteLength})).reduce((function(h,m){return h+m})),y=new Uint8Array(m),v=0,C=0,T=h;C<T.length;C++){var w=T[C];y.set(new Uint8Array(w),v),v+=w.byteLength}return y.buffer},TransportSendQueue}(),Se=function(){function PromiseSource(){var h=this;this.promise=new Promise((function(m,y){var v;return v=[m,y],h.resolver=v[0],h.rejecter=v[1],v}))}return PromiseSource.prototype.resolve=function(){this.resolver()},PromiseSource.prototype.reject=function(h){this.rejecter(h)},PromiseSource}(),Ee=function(){function JsonHubProtocol(){this.name="json",this.version=1,this.transferFormat=ie.Text}return JsonHubProtocol.prototype.parseMessages=function(h,m){if("string"!=typeof h)throw new Error("Invalid input for JSON hub protocol. Expected a string.");if(!h)return[];null===m&&(m=I.instance);for(var y=[],v=0,T=X.parse(h);v<T.length;v++){var w=T[v],A=JSON.parse(w);if("number"!=typeof A.type)throw new Error("Invalid payload.");switch(A.type){case V.Invocation:this.isInvocationMessage(A);break;case V.StreamItem:this.isStreamItemMessage(A);break;case V.Completion:this.isCompletionMessage(A);break;case V.Ping:case V.Close:break;default:m.log(C.Information,"Unknown message type '"+A.type+"' ignored.");continue}y.push(A)}return y},JsonHubProtocol.prototype.writeMessage=function(h){return X.write(JSON.stringify(h))},JsonHubProtocol.prototype.isInvocationMessage=function(h){this.assertNotEmptyString(h.target,"Invalid payload for Invocation message."),void 0!==h.invocationId&&this.assertNotEmptyString(h.invocationId,"Invalid payload for Invocation message.")},JsonHubProtocol.prototype.isStreamItemMessage=function(h){if(this.assertNotEmptyString(h.invocationId,"Invalid payload for StreamItem message."),void 0===h.item)throw new Error("Invalid payload for StreamItem message.")},JsonHubProtocol.prototype.isCompletionMessage=function(h){if(h.result&&h.error)throw new Error("Invalid payload for Completion message.");!h.result&&h.error&&this.assertNotEmptyString(h.error,"Invalid payload for Completion message."),this.assertNotEmptyString(h.invocationId,"Invalid payload for Completion message.")},JsonHubProtocol.prototype.assertNotEmptyString=function(h,m){if("string"!=typeof h||""===h)throw new Error(m)},JsonHubProtocol}(),Ce=Object.assign||function(h){for(var m,y=1,v=arguments.length;y<v;y++)for(var C in m=arguments[y])Object.prototype.hasOwnProperty.call(m,C)&&(h[C]=m[C]);return h},_e={trace:C.Trace,debug:C.Debug,info:C.Information,information:C.Information,warn:C.Warning,warning:C.Warning,error:C.Error,critical:C.Critical,none:C.None};!function(){function HubConnectionBuilder(){}HubConnectionBuilder.prototype.configureLogging=function(h){if(O.isRequired(h,"logging"),function isLogger(h){return void 0!==h.log}(h))this.logger=h;else if("string"==typeof h){var m=function parseLogLevel(h){var m=_e[h.toLowerCase()];if(void 0!==m)return m;throw new Error("Unknown log level: "+h)}(h);this.logger=new B(m)}else this.logger=new B(h);return this},HubConnectionBuilder.prototype.withUrl=function(h,m){return O.isRequired(h,"url"),O.isNotEmpty(h,"url"),this.url=h,this.httpConnectionOptions=Ce({},this.httpConnectionOptions,"object"==typeof m?m:{transport:m}),this},HubConnectionBuilder.prototype.withHubProtocol=function(h){return O.isRequired(h,"protocol"),this.protocol=h,this},HubConnectionBuilder.prototype.withAutomaticReconnect=function(h){if(this.reconnectPolicy)throw new Error("A reconnectPolicy has already been set.");return h?Array.isArray(h)?this.reconnectPolicy=new ae(h):this.reconnectPolicy=h:this.reconnectPolicy=new ae,this},HubConnectionBuilder.prototype.build=function(){var h=this.httpConnectionOptions||{};if(void 0===h.logger&&(h.logger=this.logger),!this.url)throw new Error("The 'HubConnectionBuilder.withUrl' method must be called before building the connection.");var m=new ye(this.url,h);return se.create(m,this.logger||I.instance,this.protocol||new Ee,this.reconnectPolicy)}}();var Te=function(){function BinaryMessageFormat(){}return BinaryMessageFormat.write=function(h){var m=h.byteLength||h.length,y=[];do{var v=127&m;(m>>=7)>0&&(v|=128),y.push(v)}while(m>0);m=h.byteLength||h.length;var C=new Uint8Array(y.length+m);return C.set(y,0),C.set(h,y.length),C.buffer},BinaryMessageFormat.parse=function(h){for(var m=[],y=new Uint8Array(h),v=[0,7,14,21,28],C=0;C<h.byteLength;){var T=0,w=0,A=void 0;do{w|=(127&(A=y[C+T]))<<v[T],T++}while(T<Math.min(5,h.byteLength-C)&&0!=(128&A));if(0!=(128&A)&&T<5)throw new Error("Cannot read message size.");if(5===T&&A>7)throw new Error("Messages bigger than 2GB are not supported.");if(!(y.byteLength>=C+T+w))throw new Error("Incomplete message.");m.push(y.slice?y.slice(C+T,C+T+w):y.subarray(C+T,C+T+w)),C=C+T+w}return m},BinaryMessageFormat}();var be=Object.assign||function(h){for(var m,y=1,v=arguments.length;y<v;y++)for(var C in m=arguments[y])Object.prototype.hasOwnProperty.call(m,C)&&(h[C]=m[C]);return h},we=new Uint8Array([145,V.Ping]),Ae=function(){function MessagePackHubProtocol(h){this.name="messagepack",this.version=1,this.transferFormat=ie.Binary,this.errorResult=1,this.voidResult=2,this.nonVoidResult=3,h&&(this.messagePackOptions=be({},h,{compatibilityMode:!1}))}return MessagePackHubProtocol.prototype.parseMessages=function(h,m){if(!(h instanceof T.Buffer||function Utils_isArrayBuffer(h){return h&&"undefined"!=typeof ArrayBuffer&&(h instanceof ArrayBuffer||h.constructor&&"ArrayBuffer"===h.constructor.name)}(h)))throw new Error("Invalid input for MessagePack hub protocol. Expected an ArrayBuffer or Buffer.");null===m&&(m=I.instance);for(var y=[],v=0,C=Te.parse(h);v<C.length;v++){var w=C[v],A=this.parseMessage(w,m);A&&y.push(A)}return y},MessagePackHubProtocol.prototype.writeMessage=function(h){switch(h.type){case V.Invocation:return this.writeInvocation(h);case V.StreamInvocation:return this.writeStreamInvocation(h);case V.StreamItem:return this.writeStreamItem(h);case V.Completion:return this.writeCompletion(h);case V.Ping:return Te.write(we);case V.CancelInvocation:return this.writeCancelInvocation(h);default:throw new Error("Invalid message type.")}},MessagePackHubProtocol.prototype.parseMessage=function(h,m){if(0===h.length)throw new Error("Invalid payload.");var y=w(this.messagePackOptions).decode(T.Buffer.from(h));if(0===y.length||!(y instanceof Array))throw new Error("Invalid payload.");var v=y[0];switch(v){case V.Invocation:return this.createInvocationMessage(this.readHeaders(y),y);case V.StreamItem:return this.createStreamItemMessage(this.readHeaders(y),y);case V.Completion:return this.createCompletionMessage(this.readHeaders(y),y);case V.Ping:return this.createPingMessage(y);case V.Close:return this.createCloseMessage(y);default:return m.log(C.Information,"Unknown message type '"+v+"' ignored."),null}},MessagePackHubProtocol.prototype.createCloseMessage=function(h){if(h.length<2)throw new Error("Invalid payload for Close message.");return{allowReconnect:h.length>=3?h[2]:void 0,error:h[1],type:V.Close}},MessagePackHubProtocol.prototype.createPingMessage=function(h){if(h.length<1)throw new Error("Invalid payload for Ping message.");return{type:V.Ping}},MessagePackHubProtocol.prototype.createInvocationMessage=function(h,m){if(m.length<5)throw new Error("Invalid payload for Invocation message.");var y=m[2];return y?{arguments:m[4],headers:h,invocationId:y,streamIds:[],target:m[3],type:V.Invocation}:{arguments:m[4],headers:h,streamIds:[],target:m[3],type:V.Invocation}},MessagePackHubProtocol.prototype.createStreamItemMessage=function(h,m){if(m.length<4)throw new Error("Invalid payload for StreamItem message.");return{headers:h,invocationId:m[2],item:m[3],type:V.StreamItem}},MessagePackHubProtocol.prototype.createCompletionMessage=function(h,m){if(m.length<4)throw new Error("Invalid payload for Completion message.");var y,v,C=m[3];if(C!==this.voidResult&&m.length<5)throw new Error("Invalid payload for Completion message.");switch(C){case this.errorResult:y=m[4];break;case this.nonVoidResult:v=m[4]}return{error:y,headers:h,invocationId:m[2],result:v,type:V.Completion}},MessagePackHubProtocol.prototype.writeInvocation=function(h){var m,y=w(this.messagePackOptions);return m=h.streamIds?y.encode([V.Invocation,h.headers||{},h.invocationId||null,h.target,h.arguments,h.streamIds]):y.encode([V.Invocation,h.headers||{},h.invocationId||null,h.target,h.arguments]),Te.write(m.slice())},MessagePackHubProtocol.prototype.writeStreamInvocation=function(h){var m,y=w(this.messagePackOptions);return m=h.streamIds?y.encode([V.StreamInvocation,h.headers||{},h.invocationId,h.target,h.arguments,h.streamIds]):y.encode([V.StreamInvocation,h.headers||{},h.invocationId,h.target,h.arguments]),Te.write(m.slice())},MessagePackHubProtocol.prototype.writeStreamItem=function(h){var m=w(this.messagePackOptions).encode([V.StreamItem,h.headers||{},h.invocationId,h.item]);return Te.write(m.slice())},MessagePackHubProtocol.prototype.writeCompletion=function(h){var m,y=w(this.messagePackOptions),v=h.error?this.errorResult:h.result?this.nonVoidResult:this.voidResult;switch(v){case this.errorResult:m=y.encode([V.Completion,h.headers||{},h.invocationId,v,h.error]);break;case this.voidResult:m=y.encode([V.Completion,h.headers||{},h.invocationId,v]);break;case this.nonVoidResult:m=y.encode([V.Completion,h.headers||{},h.invocationId,v,h.result])}return Te.write(m.slice())},MessagePackHubProtocol.prototype.writeCancelInvocation=function(h){var m=w(this.messagePackOptions).encode([V.CancelInvocation,h.headers||{},h.invocationId]);return Te.write(m.slice())},MessagePackHubProtocol.prototype.readHeaders=function(h){var m=h[1];if("object"!=typeof m)throw new Error("Invalid headers.");return m},MessagePackHubProtocol}(),Pe="5.0.8"}]);